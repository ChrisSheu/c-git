cscope 15 $HOME/workspace/LIBCURL/curl-7.37.1 -q 0000016672 0003107604
	@CMake/CurlTests.c

22 #ifde‡
TIME_WITH_SYS_TIME


25 
	~<sys/ty≥s.h
>

26 
	~<sys/time.h
>

27 
	~<time.h
>

30 
	$maö
 ()

32 i‡((
tm
 *) 0)

36 
	}
}

40 #ifde‡
HAVE_FCNTL_O_NONBLOCK


43 
	~<sys/ty≥s.h
>

44 
	~<uni°d.h
>

45 
	~<f˙é.h
>

47 #i‡
deföed
(
sun
Ë|| deföed(
__sun__
) || \

48 
deföed
(
__SUNPRO_C
Ë|| 
	$deföed
(
__SUNPRO_CC
)

49 #i‡
	`deföed
(
__SVR4
Ë|| deföed(
__§v4__
)

50 
	#PLATFORM_SOLARIS


	)

52 
	#PLATFORM_SUNOS4


	)

55 #i‡(
	`deföed
(
_AIX
Ë|| deföed(
__xlC__
)Ë&& !deföed(
_AIX41
)

56 
	#PLATFORM_AIX_V3


	)

59 #i‡
	`deföed
(
PLATFORM_SUNOS4
Ë|| deföed(
PLATFORM_AIX_V3
Ë|| deföed(
__BEOS__
)

64 
	$maö
 ()

67 
Êags
 = 0;

68 if(0 !
	`f˙é
(0, 
F_SETFL
, 
Êags
 | 
O_NONBLOCK
))

71 
	}
}

74 #ifde‡
HAVE_GETHOSTBYADDR_R_5


75 
	~<sys/ty≥s.h
>

76 
	~<√tdb.h
>

78 
	$maö
 ()

81 * 
addªss
;

82 
Àngth
;

83 
ty≥
;

84 
ho°ít
 
h
;

85 
ho°ít_d©a
 
hd©a
;

86 
rc
;

87 #i‚de‡
gëho°byaddr_r


88 ()
gëho°byaddr_r
;

90 
rc
 = 
	`gëho°byaddr_r
(
addªss
, 
Àngth
, 
ty≥
, &
h
, &
hd©a
);

93 
	}
}

95 #ifde‡
HAVE_GETHOSTBYADDR_R_5_REENTRANT


96 
	#_REENTRANT


	)

97 
	~<sys/ty≥s.h
>

98 
	~<√tdb.h
>

100 
	$maö
 ()

103 * 
addªss
;

104 
Àngth
;
q


105 
ty≥
;

106 
ho°ít
 
h
;

107 
ho°ít_d©a
 
hd©a
;

108 
rc
;

109 #i‚de‡
gëho°byaddr_r


110 ()
gëho°byaddr_r
;

112 
rc
 = 
	`gëho°byaddr_r
(
addªss
, 
Àngth
, 
ty≥
, &
h
, &
hd©a
);

115 
	}
}

117 #ifde‡
HAVE_GETHOSTBYADDR_R_7


118 
	~<sys/ty≥s.h
>

119 
	~<√tdb.h
>

121 
	$maö
 ()

124 * 
addªss
;

125 
Àngth
;

126 
ty≥
;

127 
ho°ít
 
h
;

128 
buf„r
[8192];

129 
h_î∫›
;

130 
ho°ít
 * 
hp
;

132 #i‚de‡
gëho°byaddr_r


133 ()
gëho°byaddr_r
;

135 
hp
 = 
	`gëho°byaddr_r
(
addªss
, 
Àngth
, 
ty≥
, &
h
,

136 
buf„r
, 8192, &
h_î∫›
);

139 
	}
}

141 #ifde‡
HAVE_GETHOSTBYADDR_R_7_REENTRANT


142 
	#_REENTRANT


	)

143 
	~<sys/ty≥s.h
>

144 
	~<√tdb.h
>

146 
	$maö
 ()

149 * 
addªss
;

150 
Àngth
;

151 
ty≥
;

152 
ho°ít
 
h
;

153 
buf„r
[8192];

154 
h_î∫›
;

155 
ho°ít
 * 
hp
;

157 #i‚de‡
gëho°byaddr_r


158 ()
gëho°byaddr_r
;

160 
hp
 = 
	`gëho°byaddr_r
(
addªss
, 
Àngth
, 
ty≥
, &
h
,

161 
buf„r
, 8192, &
h_î∫›
);

164 
	}
}

166 #ifde‡
HAVE_GETHOSTBYADDR_R_8


167 
	~<sys/ty≥s.h
>

168 
	~<√tdb.h
>

170 
	$maö
 ()

173 * 
addªss
;

174 
Àngth
;

175 
ty≥
;

176 
ho°ít
 
h
;

177 
buf„r
[8192];

178 
h_î∫›
;

179 
ho°ít
 * 
hp
;

180 
rc
;

182 #i‚de‡
gëho°byaddr_r


183 ()
gëho°byaddr_r
;

185 
rc
 = 
	`gëho°byaddr_r
(
addªss
, 
Àngth
, 
ty≥
, &
h
,

186 
buf„r
, 8192, &
hp
, &
h_î∫›
);

189 
	}
}

191 #ifde‡
HAVE_GETHOSTBYADDR_R_8_REENTRANT


192 
	#_REENTRANT


	)

193 
	~<sys/ty≥s.h
>

194 
	~<√tdb.h
>

196 
	$maö
 ()

199 * 
addªss
;

200 
Àngth
;

201 
ty≥
;

202 
ho°ít
 
h
;

203 
buf„r
[8192];

204 
h_î∫›
;

205 
ho°ít
 * 
hp
;

206 
rc
;

208 #i‚de‡
gëho°byaddr_r


209 ()
gëho°byaddr_r
;

211 
rc
 = 
	`gëho°byaddr_r
(
addªss
, 
Àngth
, 
ty≥
, &
h
,

212 
buf„r
, 8192, &
hp
, &
h_î∫›
);

215 
	}
}

217 #ifde‡
HAVE_GETHOSTBYNAME_R_3


218 
	~<°rög.h
>

219 
	~<sys/ty≥s.h
>

220 
	~<√tdb.h
>

221 #unde‡
NULL


222 
	#NULL
 (*)0

	)

225 
	$maö
 ()

228 
ho°ít_d©a
 
d©a
;

229 #i‚de‡
gëho°by«me_r


230 ()
gëho°by«me_r
;

232 
	`gëho°by«me_r
(
NULL
, NULL, NULL);

235 
	}
}

237 #ifde‡
HAVE_GETHOSTBYNAME_R_3_REENTRANT


238 
	#_REENTRANT


	)

239 
	~<°rög.h
>

240 
	~<sys/ty≥s.h
>

241 
	~<√tdb.h
>

242 #unde‡
NULL


243 
	#NULL
 (*)0

	)

246 
	$maö
 ()

249 
ho°ít_d©a
 
d©a
;

250 #i‚de‡
gëho°by«me_r


251 ()
gëho°by«me_r
;

253 
	`gëho°by«me_r
(
NULL
, NULL, NULL);

256 
	}
}

258 #ifde‡
HAVE_GETHOSTBYNAME_R_5


259 
	~<sys/ty≥s.h
>

260 
	~<√töë/ö.h
>

261 
	~<√tdb.h
>

262 #unde‡
NULL


263 
	#NULL
 (*)0

	)

266 
	$maö
 ()

268 #i‚de‡
gëho°by«me_r


269 ()
gëho°by«me_r
;

271 
	`gëho°by«me_r
(
NULL
, NULL, NULL, 0, NULL);

274 
	}
}

276 #ifde‡
HAVE_GETHOSTBYNAME_R_5_REENTRANT


277 
	#_REENTRANT


	)

278 
	~<sys/ty≥s.h
>

279 
	~<√tdb.h
>

280 #unde‡
NULL


281 
	#NULL
 (*)0

	)

284 
	$maö
 ()

287 #i‚de‡
gëho°by«me_r


288 ()
gëho°by«me_r
;

290 
	`gëho°by«me_r
(
NULL
, NULL, NULL, 0, NULL);

293 
	}
}

295 #ifde‡
HAVE_GETHOSTBYNAME_R_6


296 
	~<sys/ty≥s.h
>

297 
	~<√tdb.h
>

298 #unde‡
NULL


299 
	#NULL
 (*)0

	)

302 
	$maö
 ()

305 #i‚de‡
gëho°by«me_r


306 ()
gëho°by«me_r
;

308 
	`gëho°by«me_r
(
NULL
, NULL, NULL, 0, NULL, NULL);

311 
	}
}

313 #ifde‡
HAVE_GETHOSTBYNAME_R_6_REENTRANT


314 
	#_REENTRANT


	)

315 
	~<sys/ty≥s.h
>

316 
	~<√tdb.h
>

317 #unde‡
NULL


318 
	#NULL
 (*)0

	)

321 
	$maö
 ()

324 #i‚de‡
gëho°by«me_r


325 ()
gëho°by«me_r
;

327 
	`gëho°by«me_r
(
NULL
, NULL, NULL, 0, NULL, NULL);

330 
	}
}

332 #ifde‡
HAVE_SOCKLEN_T


333 #ifde‡
_WIN32


334 
	~<ws2t˝ù.h
>

336 
	~<sys/ty≥s.h
>

337 
	~<sys/sockë.h
>

340 
	$maö
 ()

342 i‡((
sockÀn_t
 *) 0)

344 i‡( (
sockÀn_t
))

348 
	}
}

350 #ifde‡
HAVE_IN_ADDR_T


351 
	~<sys/ty≥s.h
>

352 
	~<sys/sockë.h
>

353 
	~<¨∑/öë.h
>

356 
	$maö
 ()

358 i‡((
ö_addr_t
 *) 0)

360 i‡( (
ö_addr_t
))

364 
	}
}

367 #ifde‡
HAVE_BOOL_T


368 #ifde‡
HAVE_SYS_TYPES_H


369 
	~<sys/ty≥s.h
>

371 #ifde‡
HAVE_STDBOOL_H


372 
	~<°dboﬁ.h
>

375 
	$maö
 ()

377 i‡( (
boﬁ
 *) )

381 
	}
}

384 #ifde‡
STDC_HEADERS


385 
	~<°dlib.h
>

386 
	~<°d¨g.h
>

387 
	~<°rög.h
>

388 
	~<Êﬂt.h
>

389 
	$maö
(Ë{  0; 
	}
}

391 #ifde‡
RETSIGTYPE_TEST


392 
	~<sys/ty≥s.h
>

393 
	~<sig«l.h
>

394 #ifde‡
sig«l


395 #unde‡
sig«l


397 #ifde‡
__˝lu•lus


398 "C" (*
sig«l
 (, (*)()))();

400 (*
	`sig«l
 ()) ();

404 
	$maö
 ()

407 
	}
}

409 #ifde‡
HAVE_INET_NTOA_R_DECL


410 
	~<¨∑/öë.h
>

412 (*
	gfunc_ty≥
)();

414 
	$maö
()

416 #i‚de‡
öë_¡ﬂ_r


417 
func_ty≥
 
func
;

418 
func
 = (
func_ty≥
)
öë_¡ﬂ_r
;

421 
	}
}

423 #ifde‡
HAVE_INET_NTOA_R_DECL_REENTRANT


424 
	#_REENTRANT


	)

425 
	~<¨∑/öë.h
>

427 (*
	gfunc_ty≥
)();

429 
	$maö
()

431 #i‚de‡
öë_¡ﬂ_r


432 
func_ty≥
 
func
;

433 
func
 = (
func_ty≥
)&
öë_¡ﬂ_r
;

436 
	}
}

438 #ifde‡
HAVE_GETADDRINFO


439 
	~<√tdb.h
>

440 
	~<sys/ty≥s.h
>

441 
	~<sys/sockë.h
>

443 
	$maö
() {

444 
addröfo
 
höts
, *
ai
;

445 
îr‹
;

447 
	`mem£t
(&
höts
, 0, (hints));

448 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

449 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

450 #i‚de‡
gëaddröfo


451 ()
gëaddröfo
;

453 
îr‹
 = 
	`gëaddröfo
("127.0.0.1", "8080", &
höts
, &
ai
);

454 i‡(
îr‹
) {

458 
	}
}

460 #ifde‡
HAVE_FILE_OFFSET_BITS


461 #ifde‡
_FILE_OFFSET_BITS


462 #unde‡
_FILE_OFFSET_BITS


464 
	#_FILE_OFFSET_BITS
 64

	)

465 
	~<sys/ty≥s.h
>

470 
	#LARGE_OFF_T
 (((
off_t
Ë1 << 62Ë- 1 + ((off_tË1 << 62))

	)

471 
	goff_t_is_œrge
[(
LARGE_OFF_T
 % 2147483629 == 721

472 && 
LARGE_OFF_T
 % 2147483647 == 1)

474 
	$maö
 (Ë{ ;  0; 
	}
}

476 #ifde‡
HAVE_IOCTLSOCKET


478 #ifde‡
HAVE_WINDOWS_H


479 #i‚de‡
WIN32_LEAN_AND_MEAN


480 
	#WIN32_LEAN_AND_MEAN


	)

482 
	~<wödows.h
>

483 #ifde‡
HAVE_WINSOCK2_H


484 
	~<wösock2.h
>

486 #ifde‡
HAVE_WINSOCK_H


487 
	~<wösock.h
>

493 
	$maö
 ()

497 
sockë
;

498 
Êags
 = 
	`io˘lsockë
(
sockë
, 
FIONBIO
, &flags);

502 
	}
}

505 #ifde‡
HAVE_IOCTLSOCKET_CAMEL


507 #ifde‡
HAVE_WINDOWS_H


508 #i‚de‡
WIN32_LEAN_AND_MEAN


509 
	#WIN32_LEAN_AND_MEAN


	)

511 
	~<wödows.h
>

512 #ifde‡
HAVE_WINSOCK2_H


513 
	~<wösock2.h
>

515 #ifde‡
HAVE_WINSOCK_H


516 
	~<wösock.h
>

522 
	$maö
 ()

526 if(0 !
	`Io˘lSockë
(0, 0, 0))

530 
	}
}

532 #ifde‡
HAVE_IOCTLSOCKET_CAMEL_FIONBIO


534 #ifde‡
HAVE_WINDOWS_H


535 #i‚de‡
WIN32_LEAN_AND_MEAN


536 
	#WIN32_LEAN_AND_MEAN


	)

538 
	~<wödows.h
>

539 #ifde‡
HAVE_WINSOCK2_H


540 
	~<wösock2.h
>

542 #ifde‡
HAVE_WINSOCK_H


543 
	~<wösock.h
>

549 
	$maö
 ()

553 
Êags
 = 0;

554 if(0 !
	`io˘lsockë
(0, 
FIONBIO
, &
Êags
))

558 
	}
}

560 #ifde‡
HAVE_IOCTLSOCKET_FIONBIO


562 #ifde‡
HAVE_WINDOWS_H


563 #i‚de‡
WIN32_LEAN_AND_MEAN


564 
	#WIN32_LEAN_AND_MEAN


	)

566 
	~<wödows.h
>

567 #ifde‡
HAVE_WINSOCK2_H


568 
	~<wösock2.h
>

570 #ifde‡
HAVE_WINSOCK_H


571 
	~<wösock.h
>

577 
	$maö
 ()

580 
Êags
 = 0;

581 if(0 !
	`io˘lsockë
(0, 
FIONBIO
, &
Êags
))

586 
	}
}

588 #ifde‡
HAVE_IOCTL_FIONBIO


591 #ifde‡
HAVE_SYS_TYPES_H


592 
	~<sys/ty≥s.h
>

594 #ifde‡
HAVE_UNISTD_H


595 
	~<uni°d.h
>

597 #ifde‡
HAVE_SYS_SOCKET_H


598 
	~<sys/sockë.h
>

600 #ifde‡
HAVE_SYS_IOCTL_H


601 
	~<sys/io˘l.h
>

603 #ifde‡
HAVE_STROPTS_H


604 
	~<°r›ts.h
>

608 
	$maö
 ()

611 
Êags
 = 0;

612 if(0 !
	`io˘l
(0, 
FIONBIO
, &
Êags
))

617 
	}
}

619 #ifde‡
HAVE_IOCTL_SIOCGIFADDR


622 #ifde‡
HAVE_SYS_TYPES_H


623 
	~<sys/ty≥s.h
>

625 #ifde‡
HAVE_UNISTD_H


626 
	~<uni°d.h
>

628 #ifde‡
HAVE_SYS_SOCKET_H


629 
	~<sys/sockë.h
>

631 #ifde‡
HAVE_SYS_IOCTL_H


632 
	~<sys/io˘l.h
>

634 #ifde‡
HAVE_STROPTS_H


635 
	~<°r›ts.h
>

637 
	~<√t/if.h
>

640 
	$maö
 ()

642 
i‰eq
 
i‰
;

643 if(0 !
	`io˘l
(0, 
SIOCGIFADDR
, &
i‰
))

648 
	}
}

650 #ifde‡
HAVE_SETSOCKOPT_SO_NONBLOCK


652 #ifde‡
HAVE_WINDOWS_H


653 #i‚de‡
WIN32_LEAN_AND_MEAN


654 
	#WIN32_LEAN_AND_MEAN


	)

656 
	~<wödows.h
>

657 #ifde‡
HAVE_WINSOCK2_H


658 
	~<wösock2.h
>

660 #ifde‡
HAVE_WINSOCK_H


661 
	~<wösock.h
>

666 #ifde‡
HAVE_SYS_TYPES_H


667 
	~<sys/ty≥s.h
>

669 #ifde‡
HAVE_SYS_SOCKET_H


670 
	~<sys/sockë.h
>

675 
	$maö
 ()

677 if(0 !
	`£tsock›t
(0, 
SOL_SOCKET
, 
SO_NONBLOCK
, 0, 0))

681 
	}
}

683 #ifde‡
HAVE_GLIBC_STRERROR_R


684 
	~<°rög.h
>

685 
	~<î∫o.h
>

687 
	$maö
 () {

688 
buf„r
[1024];

689 *
°rög
 =

690 
	`°ªº‹_r
(
EACCES
, 
buf„r
, (buffer));

692 if(!
°rög
 || !string[0])

695 
	}
}

697 #ifde‡
HAVE_POSIX_STRERROR_R


698 
	~<°rög.h
>

699 
	~<î∫o.h
>

701 
	$maö
 () {

702 
buf„r
[1024];

703 
îr‹
 =

704 
	`°ªº‹_r
(
EACCES
, 
buf„r
, (buffer));

707 if(!
buf„r
[0] || 
îr‹
)

710 
	}
}

	@docs/examples/10-at-a-time.c

28 
	~<î∫o.h
>

29 
	~<°dlib.h
>

30 
	~<°rög.h
>

31 #i‚de‡
WIN32


32 
	~<uni°d.h
>

34 
	~<cuæ/mu…i.h
>

36 c⁄° *
	guæs
[] = {

88 
	#MAX
 10

	)

89 
	#CNT
 (
uæs
)/(*Ë

	)

91 
size_t
 
	$cb
(*
d
, 
size_t
 
n
, size_à
l
, *
p
)

94 ()
d
;

95 ()
p
;

96  
n
*
l
;

97 
	}
}

99 
	$öô
(
CURLM
 *
cm
, 
i
)

101 
CURL
 *
eh
 = 
	`cuæ_ósy_öô
();

103 
	`cuæ_ósy_£t›t
(
eh
, 
CURLOPT_WRITEFUNCTION
, 
cb
);

104 
	`cuæ_ósy_£t›t
(
eh
, 
CURLOPT_HEADER
, 0L);

105 
	`cuæ_ósy_£t›t
(
eh
, 
CURLOPT_URL
, 
uæs
[
i
]);

106 
	`cuæ_ósy_£t›t
(
eh
, 
CURLOPT_PRIVATE
, 
uæs
[
i
]);

107 
	`cuæ_ósy_£t›t
(
eh
, 
CURLOPT_VERBOSE
, 0L);

109 
	`cuæ_mu…i_add_h™dÀ
(
cm
, 
eh
);

110 
	}
}

112 
	$maö
()

114 
CURLM
 *
cm
;

115 
CURLMsg
 *
msg
;

116 
L
;

117 
C
=0;

118 
M
, 
Q
, 
U
 = -1;

119 
fd_£t
 
R
, 
W
, 
E
;

120 
timevÆ
 
T
;

122 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

124 
cm
 = 
	`cuæ_mu…i_öô
();

128 
	`cuæ_mu…i_£t›t
(
cm
, 
CURLMOPT_MAXCONNECTS
, ()
MAX
);

130 
C
 = 0; C < 
MAX
; ++C) {

131 
	`öô
(
cm
, 
C
);

134 
U
) {

135 
	`cuæ_mu…i_≥rf‹m
(
cm
, &
U
);

137 i‡(
U
) {

138 
	`FD_ZERO
(&
R
);

139 
	`FD_ZERO
(&
W
);

140 
	`FD_ZERO
(&
E
);

142 i‡(
	`cuæ_mu…i_fd£t
(
cm
, &
R
, &
W
, &
E
, &
M
)) {

143 
	`Ârötf
(
°dîr
, "E: curl_multi_fdset\n");

144  
EXIT_FAILURE
;

147 i‡(
	`cuæ_mu…i_timeout
(
cm
, &
L
)) {

148 
	`Ârötf
(
°dîr
, "E: curl_multi_timeout\n");

149  
EXIT_FAILURE
;

151 i‡(
L
 == -1)

152 
L
 = 100;

154 i‡(
M
 == -1) {

155 #ifde‡
WIN32


156 
	`SÀï
(
L
);

158 
	`¶ìp
(
L
 / 1000);

161 
T
.
tv_£c
 = 
L
/1000;

162 
T
.
tv_u£c
 = (
L
%1000)*1000;

164 i‡(0 > 
	`£À˘
(
M
+1, &
R
, &
W
, &
E
, &
T
)) {

165 
	`Ârötf
(
°dîr
, "E: select(%i,,,,%li): %i: %s\n",

166 
M
+1, 
L
, 
î∫o
, 
	`°ªº‹
(errno));

167  
EXIT_FAILURE
;

172 (
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
cm
, &
Q
))) {

173 i‡(
msg
->msg =
CURLMSG_DONE
) {

174 *
uæ
;

175 
CURL
 *
e
 = 
msg
->
ósy_h™dÀ
;

176 
	`cuæ_ósy_gëöfo
(
msg
->
ósy_h™dÀ
, 
CURLINFO_PRIVATE
, &
uæ
);

177 
	`Ârötf
(
°dîr
, "R: %d - %s <%s>\n",

178 
msg
->
d©a
.
ªsu…
, 
	`cuæ_ósy_°ªº‹
(msg->d©a.ªsu…), 
uæ
);

179 
	`cuæ_mu…i_ªmove_h™dÀ
(
cm
, 
e
);

180 
	`cuæ_ósy_˛ónup
(
e
);

183 
	`Ârötf
(
°dîr
, "E: CURLMsg (%d)\n", 
msg
->msg);

185 i‡(
C
 < 
CNT
) {

186 
	`öô
(
cm
, 
C
++);

187 
U
++;

193 
	`cuæ_mu…i_˛ónup
(
cm
);

194 
	`cuæ_globÆ_˛ónup
();

196  
EXIT_SUCCESS
;

197 
	}
}

	@docs/examples/anyauthput.c

22 
	~<°dio.h
>

23 
	~<f˙é.h
>

24 #ifde‡
WIN32


25 
	~<io.h
>

27 #ifde‡
__VMS


28 
	töçå_t
;

30 #i‡!
deföed
(
_AIX
Ë&& !deföed(
__sgi
Ë&& !deföed(
__osf__
)

31 
	~<°döt.h
>

33 
	~<uni°d.h
>

35 
	~<sys/ty≥s.h
>

36 
	~<sys/°©.h
>

38 #ifde‡
_MSC_VER


39 #ifde‡
_WIN64


40 
__öt64
 
	töçå_t
;

42 
	töçå_t
;

46 
	~<cuæ/cuæ.h
>

48 #i‡
LIBCURL_VERSION_NUM
 < 0x070c03

52 #i‚de‡
TRUE


53 
	#TRUE
 1

	)

56 #i‡
deföed
(
_AIX
Ë|| deföed(
__sgi
Ë|| deföed(
__osf__
)

57 #i‚de‡
öçå_t


58 
	#öçå_t
 

	)

74 
cuæi€º
 
	$my_io˘l
(
CURL
 *
h™dÀ
, 
cuæiocmd
 
cmd
, *
u£Ω
)

76 
öçå_t
 
fd
 = (öçå_t)
u£Ω
;

78 ()
h™dÀ
;

80 
cmd
) {

81 
CURLIOCMD_RESTARTREAD
:

83 if(-1 =
	`l£ek
(
fd
, 0, 
SEEK_SET
))

85  
CURLIOE_FAILRESTART
;

90  
CURLIOE_UNKNOWNCMD
;

92  
CURLIOE_OK
;

93 
	}
}

96 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

98 
size_t
 
ªtcode
;

99 
cuæ_off_t
 
ƒód
;

101 
öçå_t
 
fd
 = (öçå_t)
°ªam
;

103 
ªtcode
 = 
	`ªad
(
fd
, 
±r
, 
size
 * 
nmemb
);

105 
ƒód
 = (
cuæ_off_t
)
ªtcode
;

107 
	`Ârötf
(
°dîr
, "*** Wêªad %" 
CURL_FORMAT_CURL_OFF_T


108 " byã†‰om fûe\n", 
ƒód
);

110  
ªtcode
;

111 
	}
}

113 
	$maö
(
¨gc
, **
¨gv
)

115 
CURL
 *
cuæ
;

116 
CURLcode
 
ªs
;

117 
öçå_t
 
hd
 ;

118 
°©
 
fûe_öfo
;

120 *
fûe
;

121 *
uæ
;

123 if(
¨gc
 < 3)

126 
fûe

¨gv
[1];

127 
uæ
 = 
¨gv
[2];

130 
hd
 = 
	`›í
(
fûe
, 
O_RDONLY
) ;

131 
	`f°©
(
hd
, &
fûe_öfo
);

134 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

137 
cuæ
 = 
	`cuæ_ósy_öô
();

138 if(
cuæ
) {

140 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

143 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, (*)
hd
);

146 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_IOCTLFUNCTION
, 
my_io˘l
);

149 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_IOCTLDATA
, (*)
hd
);

152 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L) ;

156 
	`cuæ_ósy_£t›t
(
cuæ
,
CURLOPT_URL
, 
uæ
);

160 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE_LARGE
,

161 (
cuæ_off_t
)
fûe_öfo
.
°_size
);

166 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HTTPAUTH
, ()
CURLAUTH_ANY
);

169 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERPWD
, "user:password");

172 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

174 if(
ªs
 !
CURLE_OK
)

175 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

176 
	`cuæ_ósy_°ªº‹
(
ªs
));

179 
	`cuæ_ósy_˛ónup
(
cuæ
);

181 
	`˛o£
(
hd
);

183 
	`cuæ_globÆ_˛ónup
();

185 
	}
}

	@docs/examples/asiohiper.cpp

48 
	~<cuæ/cuæ.h
>

49 
	~<boo°/asio.hµ
>

50 
	~<boo°/böd.hµ
>

52 
	#MSG_OUT
 
°dout


	)

57 
	gboo°
::
asio
::
io_£rvi˚
 io_service;

58 
	gboo°
::
asio
::
dódlöe_timî
 
timî
(
io_£rvi˚
);

59 
	g°d
::
m≠
<
cuæ_sockë_t
, 
	gboo°
::
asio
::
ù
::
t˝
::
sockë
 *> 
sockë_m≠
;

62 
	s_GlobÆInfo


64 
CURLM
 *
	mmu…i
;

65 
	m°ûl_ru¬ög
;

66 } 
	tGlobÆInfo
;

69 
	s_C⁄nInfo


71 
CURL
 *
	mósy
;

72 *
	muæ
;

73 
GlobÆInfo
 *
	mglobÆ
;

74 
	mîr‹
[
CURL_ERROR_SIZE
];

75 } 
	tC⁄nInfo
;

77 
timî_cb
(c⁄° 
boo°
::
sy°em
::
îr‹_code
 & 
îr‹
, 
GlobÆInfo
 *
g
);

80 
	$mu…i_timî_cb
(
CURLM
 *
mu…i
, 
timeout_ms
, 
GlobÆInfo
 *
g
)

82 
	`Ârötf
(
MSG_OUT
, "\nmu…i_timî_cb:Åimeout_m†%ld", 
timeout_ms
);

85 
timî
.
	`ˇn˚l
();

87 i‡–
timeout_ms
 > 0 )

90 
timî
.
	`expúes_‰om_now
(
boo°
::
posix_time
::
	`mûli£c
(
timeout_ms
));

91 
timî
.
	`async_waô
(
boo°
::
	`böd
(&
timî_cb
, 
_1
, 
g
));

96 
boo°
::
sy°em
::
îr‹_code
 
îr‹
;

97 
	`timî_cb
(
îr‹
, 
g
);

101 
	}
}

104 
	$mcode_‹_dõ
(c⁄° *
whîe
, 
CURLMcode
 
code
)

106 i‡–
CURLM_OK
 !
code
 )

108 c⁄° *
s
;

109  
code
 )

111 
CURLM_CALL_MULTI_PERFORM
: 
s
="CURLM_CALL_MULTI_PERFORM"; ;

112 
CURLM_BAD_HANDLE
: 
s
="CURLM_BAD_HANDLE"; ;

113 
CURLM_BAD_EASY_HANDLE
: 
s
="CURLM_BAD_EASY_HANDLE"; ;

114 
CURLM_OUT_OF_MEMORY
: 
s
="CURLM_OUT_OF_MEMORY"; ;

115 
CURLM_INTERNAL_ERROR
: 
s
="CURLM_INTERNAL_ERROR"; ;

116 
CURLM_UNKNOWN_OPTION
: 
s
="CURLM_UNKNOWN_OPTION"; ;

117 
CURLM_LAST
: 
s
="CURLM_LAST"; ;

118 : 
s
="CURLM_unknown";

120 
CURLM_BAD_SOCKET
: 
s
="CURLM_BAD_SOCKET";

121 
	`Ârötf
(
MSG_OUT
, "\nERROR: %†ªtu∫†%s", 
whîe
, 
s
);

125 
	`Ârötf
(
MSG_OUT
, "\nERROR: %†ªtu∫†%s", 
whîe
, 
s
);

126 
	`exô
(
code
);

128 
	}
}

131 
	$check_mu…i_öfo
(
GlobÆInfo
 *
g
)

133 *
eff_uæ
;

134 
CURLMsg
 *
msg
;

135 
msgs_À·
;

136 
C⁄nInfo
 *
c⁄n
;

137 
CURL
 *
ósy
;

138 
CURLcode
 
ªs
;

140 
	`Ârötf
(
MSG_OUT
, "\nREMAINING: %d", 
g
->
°ûl_ru¬ög
);

142 (
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
g
->
mu…i
, &
msgs_À·
)))

144 i‡(
msg
->msg =
CURLMSG_DONE
)

146 
ósy
 = 
msg
->
ósy_h™dÀ
;

147 
ªs
 = 
msg
->
d©a
.
ªsu…
;

148 
	`cuæ_ósy_gëöfo
(
ósy
, 
CURLINFO_PRIVATE
, &
c⁄n
);

149 
	`cuæ_ósy_gëöfo
(
ósy
, 
CURLINFO_EFFECTIVE_URL
, &
eff_uæ
);

150 
	`Ârötf
(
MSG_OUT
, "\nDONE: %†=> (%dË%s", 
eff_uæ
, 
ªs
, 
c⁄n
->
îr‹
);

151 
	`cuæ_mu…i_ªmove_h™dÀ
(
g
->
mu…i
, 
ósy
);

152 
	`‰ì
(
c⁄n
->
uæ
);

153 
	`cuæ_ósy_˛ónup
(
ósy
);

154 
	`‰ì
(
c⁄n
);

157 
	}
}

160 
	$evít_cb
(
GlobÆInfo
 * 
g
, 
boo°
::
asio
::
ù
::
t˝
::
sockë
 * 
t˝_sockë
, 
a˘i⁄
)

162 
	`Ârötf
(
MSG_OUT
, "\√vít_cb:á˘i⁄=%d", 
a˘i⁄
);

164 
CURLMcode
 
rc
;

165 
rc
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
g
->
mu…i
, 
t˝_sockë
->
	`«tive_h™dÀ
(), 
a˘i⁄
, &g->
°ûl_ru¬ög
);

167 
	`mcode_‹_dõ
("evít_cb: cuæ_mu…i_sockë_a˘i⁄", 
rc
);

168 
	`check_mu…i_öfo
(
g
);

170 i‡–
g
->
°ûl_ru¬ög
 <= 0 )

172 
	`Ârötf
(
MSG_OUT
, "\nlastÅransfer done, killÅimeout");

173 
timî
.
	`ˇn˚l
();

175 
	}
}

178 
	$timî_cb
(c⁄° 
boo°
::
sy°em
::
îr‹_code
 & 
îr‹
, 
GlobÆInfo
 *
g
)

180 i‡–!
îr‹
)

182 
	`Ârötf
(
MSG_OUT
, "\ntimer_cb: ");

184 
CURLMcode
 
rc
;

185 
rc
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
g
->
mu…i
, 
CURL_SOCKET_TIMEOUT
, 0, &g->
°ûl_ru¬ög
);

187 
	`mcode_‹_dõ
("timî_cb: cuæ_mu…i_sockë_a˘i⁄", 
rc
);

188 
	`check_mu…i_öfo
(
g
);

190 
	}
}

193 
	$ªmsock
(*
f
, 
GlobÆInfo
 *
g
)

195 
	`Ârötf
(
MSG_OUT
, "\nremsock: ");

197 i‡–
f
 )

199 
	`‰ì
(
f
);

201 
	}
}

203 
	$£tsock
(*
fdp
, 
cuæ_sockë_t
 
s
, 
CURL
*
e
, 
a˘
, 
GlobÆInfo
*
g
)

205 
	`Ârötf
(
MSG_OUT
, "\n£tsock: sockë=%d,á˘=%d, fdp=%p", 
s
, 
a˘
, 
fdp
);

207 
°d
::
m≠
<
cuæ_sockë_t
, 
boo°
::
asio
::
ù
::
t˝
::
sockë
 *>::
ôî©‹
 
ô
 = 
sockë_m≠
.
	`föd
(
s
);

209 i‡–
ô
 =
sockë_m≠
.
	`íd
() )

211 
	`Ârötf
(
MSG_OUT
, "\nsockë %d i†®c-¨e†sockë, ign‹ög", 
s
);

215 
boo°
::
asio
::
ù
::
t˝
::
sockë
 * 
t˝_sockë
 = 
ô
->
£c⁄d
;

217 *
fdp
 = 
a˘
;

219 i‡–
a˘
 =
CURL_POLL_IN
 )

221 
	`Ârötf
(
MSG_OUT
, "\nwatching for socketÅo becomeÑeadable");

223 
t˝_sockë
->
	`async_ªad_some
(
boo°
::
asio
::
	`nuŒ_buf„rs
(),

224 
boo°
::
	`böd
(&
evít_cb
, 
g
,

225 
t˝_sockë
,

226 
a˘
));

228 i‡–
a˘
 =
CURL_POLL_OUT
 )

230 
	`Ârötf
(
MSG_OUT
, "\nwatching for socketÅo become writable");

232 
t˝_sockë
->
	`async_wrôe_some
(
boo°
::
asio
::
	`nuŒ_buf„rs
(),

233 
boo°
::
	`böd
(&
evít_cb
, 
g
,

234 
t˝_sockë
,

235 
a˘
));

237 i‡–
a˘
 =
CURL_POLL_INOUT
 )

239 
	`Ârötf
(
MSG_OUT
, "\nwatching for socketÅo becomeÑeadable & writable");

241 
t˝_sockë
->
	`async_ªad_some
(
boo°
::
asio
::
	`nuŒ_buf„rs
(),

242 
boo°
::
	`böd
(&
evít_cb
, 
g
,

243 
t˝_sockë
,

244 
a˘
));

246 
t˝_sockë
->
	`async_wrôe_some
(
boo°
::
asio
::
	`nuŒ_buf„rs
(),

247 
boo°
::
	`böd
(&
evít_cb
, 
g
,

248 
t˝_sockë
,

249 
a˘
));

251 
	}
}

254 
	$addsock
(
cuæ_sockë_t
 
s
, 
CURL
 *
ósy
, 
a˘i⁄
, 
GlobÆInfo
 *
g
)

256 *
fdp
 = (*)
	`ˇŒoc
((), 1);

258 
	`£tsock
(
fdp
, 
s
, 
ósy
, 
a˘i⁄
, 
g
);

259 
	`cuæ_mu…i_assign
(
g
->
mu…i
, 
s
, 
fdp
);

260 
	}
}

263 
	$sock_cb
(
CURL
 *
e
, 
cuæ_sockë_t
 
s
, 
wh©
, *
cbp
, *
sockp
)

265 
	`Ârötf
(
MSG_OUT
, "\nsock_cb: sockë=%d, wh©=%d, sockp=%p", 
s
, 
wh©
, 
sockp
);

267 
GlobÆInfo
 *
g
 = (GlobÆInfo*Ë
cbp
;

268 *
a˘i⁄p
 = (*Ë
sockp
;

269 c⁄° *
wh©°r
[]={ "none", "IN", "OUT", "INOUT", "REMOVE"};

271 
	`Ârötf
(
MSG_OUT
,

272 "\nsockë cÆlback: s=%dÉ=%∞wh©=%†", 
s
, 
e
, 
wh©°r
[
wh©
]);

274 i‡–
wh©
 =
CURL_POLL_REMOVE
 )

276 
	`Ârötf
(
MSG_OUT
, "\n");

277 
	`ªmsock
(
a˘i⁄p
, 
g
);

281 i‡–!
a˘i⁄p
 )

283 
	`Ârötf
(
MSG_OUT
, "\nAddög d©a: %s", 
wh©°r
[
wh©
]);

284 
	`addsock
(
s
, 
e
, 
wh©
, 
g
);

288 
	`Ârötf
(
MSG_OUT
,

290 
wh©°r
[*
a˘i⁄p
], wh©°r[
wh©
]);

291 
	`£tsock
(
a˘i⁄p
, 
s
, 
e
, 
wh©
, 
g
);

295 
	}
}

299 
size_t
 
	$wrôe_cb
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
d©a
)

302 
size_t
 
wrôãn
 = 
size
 * 
nmemb
;

303 * 
pBuf„r
 = (*)
	`mÆloc
(
wrôãn
 + 1);

305 
	`°∫˝y
(
pBuf„r
, (c⁄° *)
±r
, 
wrôãn
);

306 
pBuf„r
 [
wrôãn
] = '\0';

308 
	`Ârötf
(
MSG_OUT
, "%s", 
pBuf„r
);

310 
	`‰ì
(
pBuf„r
);

312  
wrôãn
;

313 
	}
}

317 
	$¥og_cb
 (*
p
, 
d…ŸÆ
, 
d ow
, 
u…
,

318 
u 
)

320 
C⁄nInfo
 *
c⁄n
 = (C⁄nInfÿ*)
p
;

321 ()
u…
;

322 ()
u 
;

324 
	`Ârötf
(
MSG_OUT
, "\nProgªss: %†(%g/%g)", 
c⁄n
->
uæ
, 
d ow
, 
d…ŸÆ
);

325 
	`Ârötf
(
MSG_OUT
, "\nProgªss: %†(%g)", 
c⁄n
->
uæ
, 
u…
);

328 
	}
}

331 
cuæ_sockë_t
 
	$›ísockë
(*
˛õ¡p
,

332 
cuæsockty≥
 
puΩo£
,

333 
cuæ_sockaddr
 *
addªss
)

335 
	`Ârötf
(
MSG_OUT
, "\nopensocket :");

337 
cuæ_sockë_t
 
sockfd
 = 
CURL_SOCKET_BAD
;

340 i‡(
puΩo£
 =
CURLSOCKTYPE_IPCXN
 && 
addªss
->
Ámûy
 =
AF_INET
)

343 
boo°
::
asio
::
ù
::
t˝
::
sockë
 *
t˝_sockë
 = 
√w
 boo°::asio::ù::t˝::
	`sockë
(
io_£rvi˚
);

346 
boo°
::
sy°em
::
îr‹_code
 
ec
;

347 
t˝_sockë
->
	`›í
(
boo°
::
asio
::
ù
::
t˝
::
	`v4
(), 
ec
);

349 i‡(
ec
)

352 
°d
::
cout
 << std::
ídl
 << "Couldn'à›í sockë [" << 
ec
 << "][" <<Éc.
	`mesßge
() << "]";

353 
	`Ârötf
(
MSG_OUT
, "\nERROR: Returning CURL_SOCKET_BADÅo signalÉrror");

357 
sockfd
 = 
t˝_sockë
->
	`«tive_h™dÀ
();

358 
	`Ârötf
(
MSG_OUT
, "\nO≥√d sockë %d", 
sockfd
);

361 
sockë_m≠
.
	`ö£π
(
°d
::
∑ú
<
cuæ_sockë_t
, 
boo°
::
asio
::
ù
::
t˝
::
sockë
 *>(
sockfd
, 
t˝_sockë
));

365  
sockfd
;

366 
	}
}

369 
	$˛o£sockë
(*
˛õ¡p
, 
cuæ_sockë_t
 
ôem
)

371 
	`Ârötf
(
MSG_OUT
, "\n˛o£sockë : %d", 
ôem
);

373 
°d
::
m≠
<
cuæ_sockë_t
, 
boo°
::
asio
::
ù
::
t˝
::
sockë
 *>::
ôî©‹
 
ô
 = 
sockë_m≠
.
	`föd
(
ôem
);

375 i‡–
ô
 !
sockë_m≠
.
	`íd
() )

377 
dñëe
 
ô
->
£c⁄d
;

378 
sockë_m≠
.
	`îa£
(
ô
);

382 
	}
}

385 
	$√w_c⁄n
(*
uæ
, 
GlobÆInfo
 *
g
 )

387 
C⁄nInfo
 *
c⁄n
;

388 
CURLMcode
 
rc
;

390 
c⁄n
 = (
C⁄nInfo
 *)
	`ˇŒoc
(1, (ConnInfo));

391 
	`mem£t
(
c⁄n
, 0, (
C⁄nInfo
));

392 
c⁄n
->
îr‹
[0]='\0';

394 
c⁄n
->
ósy
 = 
	`cuæ_ósy_öô
();

396 i‡–!
c⁄n
->
ósy
 )

398 
	`Ârötf
(
MSG_OUT
, "\ncurl_easy_init() failed,Éxiting!");

399 
	`exô
(2);

401 
c⁄n
->
globÆ
 = 
g
;

402 
c⁄n
->
uæ
 = 
	`°rdup
(url);

403 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_URL
, c⁄n->
uæ
);

404 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_cb
);

405 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_WRITEDATA
, &conn);

406 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_VERBOSE
, 1L);

407 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_ERRORBUFFER
, c⁄n->
îr‹
);

408 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PRIVATE
, conn);

409 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_NOPROGRESS
, 1L);

410 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PROGRESSFUNCTION
, 
¥og_cb
);

411 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PROGRESSDATA
, conn);

412 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_LOW_SPEED_TIME
, 3L);

413 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_LOW_SPEED_LIMIT
, 10L);

416 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_OPENSOCKETFUNCTION
, 
›ísockë
);

419 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_CLOSESOCKETFUNCTION
, 
˛o£sockë
);

421 
	`Ârötf
(
MSG_OUT
,

422 "\nAddögÉasy %∞tÿmu…ò%∞(%s)", 
c⁄n
->
ósy
, 
g
->
mu…i
, 
uæ
);

423 
rc
 = 
	`cuæ_mu…i_add_h™dÀ
(
g
->
mu…i
, 
c⁄n
->
ósy
);

424 
	`mcode_‹_dõ
("√w_c⁄n: cuæ_mu…i_add_h™dÀ", 
rc
);

428 
	}
}

430 
	$maö
(
¨gc
, **
¨gv
)

432 
GlobÆInfo
 
g
;

433 
CURLMcode
 
rc
;

434 ()
¨gc
;

435 ()
¨gv
;

437 
	`mem£t
(&
g
, 0, (
GlobÆInfo
));

438 
g
.
mu…i
 = 
	`cuæ_mu…i_öô
();

440 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_SOCKETFUNCTION
, 
sock_cb
);

441 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_SOCKETDATA
, &g);

442 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_TIMERFUNCTION
, 
mu…i_timî_cb
);

443 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_TIMERDATA
, &g);

445 
	`√w_c⁄n
((*)"www.googÀ.com", &
g
);

448 
io_£rvi˚
.
	`run
();

450 
	`cuæ_mu…i_˛ónup
(
g
.
mu…i
);

452 
	`Ârötf
(
MSG_OUT
, "\ndone.\n");

454 
	}
}

	@docs/examples/cacertinmem.c

33 
	~<›ís¶/s¶.h
>

34 
	~<cuæ/cuæ.h
>

35 
	~<°dio.h
>

37 
size_t
 
	$wrôefun˘i⁄
–*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

39 
	`fwrôe
(
±r
,
size
,
nmemb
,
°ªam
);

40 (
nmemb
*
size
);

41 
	}
}

43 
CURLcode
 
	$s¶˘x_fun˘i⁄
(
CURL
 * 
cuæ
, * 
s¶˘x
, * 
∑rm
)

45 
X509_STORE
 * 
°‹e
;

46 
X509
 * 
˚π
=
NULL
;

47 
BIO
 * 
bio
;

48 * 
my≥m
 =

91 
bio
=
	`BIO_√w_mem_buf
(
my≥m
, -1);

95 
	`PEM_ªad_bio_X509
(
bio
, &
˚π
, 0, 
NULL
);

96 i‡(
˚π
 =
NULL
)

97 
	`¥ötf
("PEM_read_bio_X509 failed...\n");

100 
°‹e
=
	`SSL_CTX_gë_˚π_°‹e
((
SSL_CTX
 *)
s¶˘x
);

103 i‡(
	`X509_STORE_add_˚π
(
°‹e
, 
˚π
)==0)

104 
	`¥ötf
("errorádding certificate\n");

107 
	`X509_‰ì
(
˚π
);

108 
	`BIO_‰ì
(
bio
);

111  
CURLE_OK
 ;

112 
	}
}

114 
	$maö
()

116 
CURL
 * 
ch
;

117 
CURLcode
 
rv
;

119 
rv
=
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

120 
ch
=
	`cuæ_ósy_öô
();

121 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_VERBOSE
, 0L);

122 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_HEADER
, 0L);

123 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_NOPROGRESS
, 1L);

124 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_NOSIGNAL
, 1L);

125 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_WRITEFUNCTION
, *
wrôefun˘i⁄
);

126 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_WRITEDATA
, 
°dout
);

127 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_HEADERFUNCTION
, *
wrôefun˘i⁄
);

128 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_HEADERDATA
, 
°dîr
);

129 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_SSLCERTTYPE
,"PEM");

130 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_SSL_VERIFYPEER
,1L);

131 
rv
=
	`cuæ_ósy_£t›t
(
ch
, 
CURLOPT_URL
, "https://www.example.com/");

135 
rv
=
	`cuæ_ósy_≥rf‹m
(
ch
);

136 i‡(
rv
==
CURLE_OK
)

137 
	`¥ötf
("***Åransfer succeeded ***\n");

139 
	`¥ötf
("***Åransfer failed ***\n");

145 
rv
=
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_SSL_CTX_FUNCTION
, *
s¶˘x_fun˘i⁄
);

146 
rv
=
	`cuæ_ósy_≥rf‹m
(
ch
);

147 i‡(
rv
==
CURLE_OK
)

148 
	`¥ötf
("***Åransfer succeeded ***\n");

150 
	`¥ötf
("***Åransfer failed ***\n");

152 
	`cuæ_ósy_˛ónup
(
ch
);

153 
	`cuæ_globÆ_˛ónup
();

154  
rv
;

155 
	}
}

	@docs/examples/certinfo.c

22 
	~<°dio.h
>

24 
	~<cuæ/cuæ.h
>

26 
size_t
 
	$wrfu
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

28 ()
°ªam
;

29 ()
±r
;

30  
size
 * 
nmemb
;

31 
	}
}

33 
	$maö
()

35 
CURL
 *
cuæ
;

36 
CURLcode
 
ªs
;

38 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

40 
cuæ
 = 
	`cuæ_ósy_öô
();

41 if(
cuæ
) {

42 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "https://www.example.com/");

44 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
wrfu
);

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

47 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYHOST
, 0L);

49 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 0L);

50 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CERTINFO
, 1L);

52 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

54 if(!
ªs
) {

56 
cuæ_¶i°
 *
to_öfo
;

57 
cuæ_˚πöfo
 *
to_˚πöfo
;

58 } 
±r
;

60 
±r
.
to_öfo
 = 
NULL
;

62 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_CERTINFO
, &
±r
.
to_öfo
);

64 if(!
ªs
 && 
±r
.
to_öfo
) {

65 
i
;

67 
	`¥ötf
("%d cîts!\n", 
±r
.
to_˚πöfo
->
num_of_˚πs
);

69 
i
 = 0; i < 
±r
.
to_˚πöfo
->
num_of_˚πs
; i++) {

70 
cuæ_¶i°
 *
¶i°
;

72 
¶i°
 = 
±r
.
to_˚πöfo
->
˚πöfo
[
i
]; sli°; sli° = sli°->
√xt
)

73 
	`¥ötf
("%s\n", 
¶i°
->
d©a
);

80 
	`cuæ_ósy_˛ónup
(
cuæ
);

83 
	`cuæ_globÆ_˛ónup
();

86 
	}
}

	@docs/examples/chkspeed.c

32 
	~<°dio.h
>

33 
	~<°dlib.h
>

34 
	~<°rög.h
>

35 
	~<time.h
>

37 
	~<cuæ/cuæ.h
>

39 
	#URL_BASE
 "hâp://•ìdã°.your.domaö/"

	)

40 
	#URL_1M
 
URL_BASE
 "fûe_1M.bö"

	)

41 
	#URL_2M
 
URL_BASE
 "fûe_2M.bö"

	)

42 
	#URL_5M
 
URL_BASE
 "fûe_5M.bö"

	)

43 
	#URL_10M
 
URL_BASE
 "fûe_10M.bö"

	)

44 
	#URL_20M
 
URL_BASE
 "fûe_20M.bö"

	)

45 
	#URL_50M
 
URL_BASE
 "fûe_50M.bö"

	)

46 
	#URL_100M
 
URL_BASE
 "fûe_100M.bö"

	)

48 
	#CHKSPEED_VERSION
 "1.0"

	)

50 
size_t
 
	$WrôeCÆlback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
d©a
)

54 ()
±r
;

55 ()
d©a
;

56  (
size_t
)(
size
 * 
nmemb
);

57 
	}
}

59 
	$maö
(
¨gc
, *
¨gv
[])

61 
CURL
 *
cuæ_h™dÀ
;

62 
CURLcode
 
ªs
;

63 
¥èŒ
 = 0, 
¥t£p
 = 0, 
¥âime
 = 0;

64 c⁄° *
uæ
 = 
URL_1M
;

65 *
≠≤ame
 = 
¨gv
[0];

67 i‡(
¨gc
 > 1) {

69 
¨gc
--, 
¨gv
++; *argv;árgc--,árgv++) {

70 i‡(
	`°∫ˇ£cmp
(*
¨gv
, "-", 1) == 0) {

71 i‡(
	`°∫ˇ£cmp
(*
¨gv
, "-H", 2) == 0) {

72 
	`Ârötf
(
°dîr
,

74 
≠≤ame
);

75 
	`exô
(1);

76 } i‡(
	`°∫ˇ£cmp
(*
¨gv
, "-V", 2) == 0) {

77 
	`Ârötf
(
°dîr
, "\r%s %s - %s\n",

78 
≠≤ame
, 
CHKSPEED_VERSION
, 
	`cuæ_vîsi⁄
());

79 
	`exô
(1);

80 } i‡(
	`°∫ˇ£cmp
(*
¨gv
, "-A", 2) == 0) {

81 
¥èŒ
 = 1;

82 } i‡(
	`°∫ˇ£cmp
(*
¨gv
, "-X", 2) == 0) {

83 
¥t£p
 = 1;

84 } i‡(
	`°∫ˇ£cmp
(*
¨gv
, "-T", 2) == 0) {

85 
¥âime
 = 1;

86 } i‡(
	`°∫ˇ£cmp
(*
¨gv
, "-M=", 3) == 0) {

87 
m
 = 
	`°πﬁ
((*
¨gv
)+3, 
NULL
, 10);

88 
m
) {

89 1: 
uæ
 = 
URL_1M
;

91 2: 
uæ
 = 
URL_2M
;

93 5: 
uæ
 = 
URL_5M
;

95 10: 
uæ
 = 
URL_10M
;

97 20: 
uæ
 = 
URL_20M
;

99 50: 
uæ
 = 
URL_50M
;

101 100: 
uæ
 = 
URL_100M
;

103 : 
	`Ârötf
(
°dîr
, "\r%s: invalidÖarameter %s\n",

104 
≠≤ame
, *
¨gv
 + 3);

105 
	`exô
(1);

108 
	`Ârötf
(
°dîr
, "\r%s: invalid or unknown option %s\n",

109 
≠≤ame
, *
¨gv
);

110 
	`exô
(1);

113 
uæ
 = *
¨gv
;

119 i‡(
¥t£p
) {

120 
	`¥ötf
("-------------------------------------------------\n");

123 i‡(
¥âime
) {

124 
time_t
 
t
 = 
	`time
(
NULL
);

125 
	`¥ötf
("Loˇ…ime: %s", 
	`˘ime
(&
t
));

129 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

132 
cuæ_h™dÀ
 = 
	`cuæ_ósy_öô
();

135 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_URL
, 
uæ
);

138 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_WRITEFUNCTION
, 
WrôeCÆlback
);

142 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_USERAGENT
,

143 "libcuæ-•ìdcheckî/" 
CHKSPEED_VERSION
);

146 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ_h™dÀ
);

148 if(
CURLE_OK
 =
ªs
) {

149 
vÆ
;

152 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ_h™dÀ
, 
CURLINFO_SIZE_DOWNLOAD
, &
vÆ
);

153 if((
CURLE_OK
 =
ªs
Ë&& (
vÆ
>0))

154 
	`¥ötf
("D©®dow∆ﬂded: %0.0‡byãs.\n", 
vÆ
);

157 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ_h™dÀ
, 
CURLINFO_TOTAL_TIME
, &
vÆ
);

158 if((
CURLE_OK
 =
ªs
Ë&& (
vÆ
>0))

159 
	`¥ötf
("TŸÆ dow∆ﬂdÅime: %0.3‡£c.\n", 
vÆ
);

162 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ_h™dÀ
, 
CURLINFO_SPEED_DOWNLOAD
, &
vÆ
);

163 if((
CURLE_OK
 =
ªs
Ë&& (
vÆ
>0))

164 
	`¥ötf
("Avîagêdow∆ﬂd s≥ed: %0.3‡kbyã/£c.\n", 
vÆ
 / 1024);

166 i‡(
¥èŒ
) {

168 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ_h™dÀ
, 
CURLINFO_NAMELOOKUP_TIME
, &
vÆ
);

169 if((
CURLE_OK
 =
ªs
Ë&& (
vÆ
>0))

170 
	`¥ötf
("Namêlooku∞time: %0.3‡£c.\n", 
vÆ
);

173 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ_h™dÀ
, 
CURLINFO_CONNECT_TIME
, &
vÆ
);

174 if((
CURLE_OK
 =
ªs
Ë&& (
vÆ
>0))

175 
	`¥ötf
("C⁄√˘Åime: %0.3‡£c.\n", 
vÆ
);

179 
	`Ârötf
(
°dîr
, "Error while fetching '%s' : %s\n",

180 
uæ
, 
	`cuæ_ósy_°ªº‹
(
ªs
));

184 
	`cuæ_ósy_˛ónup
(
cuæ_h™dÀ
);

187 
	`cuæ_globÆ_˛ónup
();

190 
	}
}

	@docs/examples/cookie_interface.c

24 
	~<°dio.h
>

25 
	~<°rög.h
>

26 
	~<°dlib.h
>

27 
	~<î∫o.h
>

28 
	~<time.h
>

30 
	~<cuæ/cuæ.h
>

33 
	$¥öt_cookõs
(
CURL
 *
cuæ
)

35 
CURLcode
 
ªs
;

36 
cuæ_¶i°
 *
cookõs
;

37 
cuæ_¶i°
 *
nc
;

38 
i
;

40 
	`¥ötf
("Cookies, curl knows:\n");

41 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_COOKIELIST
, &
cookõs
);

42 i‡(
ªs
 !
CURLE_OK
) {

43 
	`Ârötf
(
°dîr
, "Cuæ cuæ_ósy_gëöfÿÁûed: %s\n", 
	`cuæ_ósy_°ªº‹
(
ªs
));

44 
	`exô
(1);

46 
nc
 = 
cookõs
, 
i
 = 1;

47 
nc
) {

48 
	`¥ötf
("[%d]: %s\n", 
i
, 
nc
->
d©a
);

49 
nc
 =Çc->
√xt
;

50 
i
++;

52 i‡(
i
 == 1) {

53 
	`¥ötf
("(none)\n");

55 
	`cuæ_¶i°_‰ì_Æl
(
cookõs
);

56 
	}
}

59 
	$maö
()

61 
CURL
 *
cuæ
;

62 
CURLcode
 
ªs
;

64 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

65 
cuæ
 = 
	`cuæ_ósy_öô
();

66 i‡(
cuæ
) {

67 
∆öe
[256];

69 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://www.example.com/");

70 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

71 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_COOKIEFILE
, "");

72 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

73 i‡(
ªs
 !
CURLE_OK
) {

74 
	`Ârötf
(
°dîr
, "CuæÖîf‹m faûed: %s\n", 
	`cuæ_ósy_°ªº‹
(
ªs
));

78 
	`¥öt_cookõs
(
cuæ
);

80 
	`¥ötf
("Erasing curl's knowledge of cookies!\n");

81 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_COOKIELIST
, "ALL");

83 
	`¥öt_cookõs
(
cuæ
);

85 
	`¥ötf
("-----------------------------------------------\n"

87 #ifde‡
WIN32


88 
	#¢¥ötf
 
_¢¥ötf


	)

91 
	`¢¥ötf
(
∆öe
, (nline), "%s\t%s\t%s\t%s\t%lu\t%s\t%s",

92 ".googÀ.com", "TRUE", "/", "FALSE", ()
	`time
(
NULL
) + 31337UL, "PREF", "hello google, iÜike you very much!");

93 
ªs
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_COOKIELIST
, 
∆öe
);

94 i‡(
ªs
 !
CURLE_OK
) {

95 
	`Ârötf
(
°dîr
, "Cuæ cuæ_ósy_£t›àÁûed: %s\n", 
	`cuæ_ósy_°ªº‹
(
ªs
));

100 
	`¢¥ötf
(
∆öe
, (nline),

103 
ªs
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_COOKIELIST
, 
∆öe
);

104 i‡(
ªs
 !
CURLE_OK
) {

105 
	`Ârötf
(
°dîr
, "Cuæ cuæ_ósy_£t›àÁûed: %s\n", 
	`cuæ_ósy_°ªº‹
(
ªs
));

109 
	`¥öt_cookõs
(
cuæ
);

111 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

112 i‡(
ªs
 !
CURLE_OK
) {

113 
	`Ârötf
(
°dîr
, "CuæÖîf‹m faûed: %s\n", 
	`cuæ_ósy_°ªº‹
(
ªs
));

118 
	`Ârötf
(
°dîr
, "Curl init failed!\n");

122 
	`cuæ_globÆ_˛ónup
();

124 
	}
}

	@docs/examples/curlgtk.c

12 
	~<°dio.h
>

13 
	~<gtk/gtk.h
>

15 
	~<cuæ/cuæ.h
>

17 
GtkWidgë
 *
	gB¨
;

19 
size_t
 
	$my_wrôe_func
(*
±r
, 
size_t
 
size
, size_à
nmemb
, 
FILE
 *
°ªam
)

21  
	`fwrôe
(
±r
, 
size
, 
nmemb
, 
°ªam
);

22 
	}
}

24 
size_t
 
	$my_ªad_func
(*
±r
, 
size_t
 
size
, size_à
nmemb
, 
FILE
 *
°ªam
)

26  
	`‰ód
(
±r
, 
size
, 
nmemb
, 
°ªam
);

27 
	}
}

29 
	$my_¥ogªss_func
(
GtkWidgë
 *
b¨
,

30 
t
,

31 
d
,

32 
u…ŸÆ
,

33 
u ow
)

36 
	`gdk_thªads_íãr
();

37 
	`gtk_¥ogªss_£t_vÆue
(
	`GTK_PROGRESS
(
b¨
), 
d
*100.0/
t
);

38 
	`gdk_thªads_Àave
();

40 
	}
}

42 *
	$my_thªad
(*
±r
)

44 
CURL
 *
cuæ
;

45 
CURLcode
 
ªs
;

46 
FILE
 *
outfûe
;

47 
gch¨
 *
uæ
 = 
±r
;

49 
cuæ
 = 
	`cuæ_ósy_öô
();

50 if(
cuæ
)

52 
outfûe
 = 
	`f›í
("test.curl", "w");

54 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
uæ
);

55 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
outfûe
);

56 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
my_wrôe_func
);

57 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
my_ªad_func
);

58 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_NOPROGRESS
, 0L);

59 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PROGRESSFUNCTION
, 
my_¥ogªss_func
);

60 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PROGRESSDATA
, 
B¨
);

62 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

64 
	`f˛o£
(
outfûe
);

66 
	`cuæ_ósy_˛ónup
(
cuæ
);

69  
NULL
;

70 
	}
}

72 
	$maö
(
¨gc
, **
¨gv
)

74 
GtkWidgë
 *
Wödow
, *
Føme
, *
Føme2
;

75 
GtkAdju°mít
 *
adj
;

78 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

81 
	`g_thªad_öô
(
NULL
);

83 
	`gtk_öô
(&
¨gc
, &
¨gv
);

84 
Wödow
 = 
	`gtk_wödow_√w
(
GTK_WINDOW_TOPLEVEL
);

85 
Føme
 = 
	`gtk_‰ame_√w
(
NULL
);

86 
	`gtk_‰ame_£t_shadow_ty≥
(
	`GTK_FRAME
(
Føme
), 
GTK_SHADOW_OUT
);

87 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
Wödow
), 
Føme
);

88 
Føme2
 = 
	`gtk_‰ame_√w
(
NULL
);

89 
	`gtk_‰ame_£t_shadow_ty≥
(
	`GTK_FRAME
(
Føme2
), 
GTK_SHADOW_IN
);

90 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
Føme
), 
Føme2
);

91 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
Føme2
), 5);

92 
adj
 = (
GtkAdju°mít
*)
	`gtk_adju°mít_√w
(0, 0, 100, 0, 0, 0);

93 
B¨
 = 
	`gtk_¥ogªss_b¨_√w_wôh_adju°mít
(
adj
);

94 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
Føme2
), 
B¨
);

95 
	`gtk_widgë_show_Æl
(
Wödow
);

97 i‡(!
	`g_thªad_¸óã
(&
my_thªad
, 
¨gv
[1], 
FALSE
, 
NULL
) != 0)

98 
	`g_w¨nög
("can't createÅheÅhread");

101 
	`gdk_thªads_íãr
();

102 
	`gtk_maö
();

103 
	`gdk_thªads_Àave
();

105 
	}
}

	@docs/examples/curlx.c

82 
	~<°dio.h
>

83 
	~<°dlib.h
>

84 
	~<°rög.h
>

85 
	~<cuæ/cuæ.h
>

86 
	~<›ís¶/x509v3.h
>

87 
	~<›ís¶/x509_vfy.h
>

88 
	~<›ís¶/¸y±o.h
>

89 
	~<›ís¶/lhash.h
>

90 
	~<›ís¶/obje˘s.h
>

91 
	~<›ís¶/îr.h
>

92 
	~<›ís¶/evp.h
>

93 
	~<›ís¶/x509.h
>

94 
	~<›ís¶/pkcs12.h
>

95 
	~<›ís¶/bio.h
>

96 
	~<›ís¶/s¶.h
>

98 c⁄° *
	gcuæx_ußge
[]={

108 
NULL


123 
	#ZERO_NULL
 0

	)

127 
	ss¶˘x∑rm_°
 {

128 * 
	mp12fûe
 ;

129 c⁄° * 
	mp°
 ;

130 
PKCS12
 * 
	mp12
 ;

131 
EVP_PKEY
 * 
	mpkey
 ;

132 
X509
 * 
	mu£r˚π
 ;

133 
STACK_OF
(
X509
Ë* 
	mˇ
 ;

134 
CURL
 * 
	mcuæ
;

135 
BIO
 * 
	mîr‹bio
;

136 
	mac˚s°y≥
 ;

137 
	mvîbo£
;

139 } 
	ts¶˘x∑rm
;

143 *
	$i2s_ASN1_IA5STRING
–
ASN1_IA5STRING
 *
ü5
)

145 *
tmp
;

146 if(!
ü5
 || !ü5->
Àngth
)

147  
NULL
;

148 
tmp
 = 
	`OPENSSL_mÆloc
(
ü5
->
Àngth
 + 1);

149 
	`mem˝y
(
tmp
, 
ü5
->
d©a
, ia5->
Àngth
);

150 
tmp
[
ü5
->
Àngth
] = 0;

151  
tmp
;

152 
	}
}

156 *
	$my_gë_ext
(
X509
 * 
˚π
, c⁄° 
ty≥
, 
exãnsi⁄ty≥
) {

158 
i
;

159 
	`STACK_OF
(
ACCESS_DESCRIPTION
Ë* 
ac˚ssöfo
 ;

160 
ac˚ssöfo
 = 
	`X509_gë_ext_d2i
(
˚π
, 
exãnsi⁄ty≥
, 
NULL
, NULL) ;

162 i‡(!
	`sk_ACCESS_DESCRIPTION_num
(
ac˚ssöfo
))

163  
NULL
;

164 
i
 = 0; i < 
	`sk_ACCESS_DESCRIPTION_num
(
ac˚ssöfo
); i++) {

165 
ACCESS_DESCRIPTION
 * 
ad
 = 
	`sk_ACCESS_DESCRIPTION_vÆue
(
ac˚ssöfo
, 
i
);

166 i‡(
	`OBJ_obj2nid
(
ad
->
mëhod
Ë=
ty≥
) {

167 i‡(
ad
->
loˇti⁄
->
ty≥
 =
GEN_URI
) {

168  
	`i2s_ASN1_IA5STRING
(
ad
->
loˇti⁄
->
d
.
ü5
);

170  
NULL
;

173  
NULL
;

174 
	}
}

182 
	$s¶_≠p_vîify_ˇŒback
(
X509_STORE_CTX
 *
˘x
, *
¨g
)

184 
s¶˘x∑rm
 * 
p
 = (s¶˘x∑rm *Ë
¨g
;

185 
ok
;

187 i‡(
p
->
vîbo£
 > 2)

188 
	`BIO_¥ötf
(
p
->
îr‹bio
,"entering ssl_app_verify_callback\n");

190 i‡((
ok

	`X509_vîify_˚π
(
˘x
)Ë&& ctx->
˚π
) {

191 * 
ac˚ssöfo
 ;

192 i‡(
p
->
vîbo£
 > 1)

193 
	`X509_¥öt_ex
(
p
->
îr‹bio
,
˘x
->
˚π
,0,0);

195 i‡(
ac˚ssöfo
 = 
	`my_gë_ext
(
˘x
->
˚π
,
p
->
ac˚s°y≥
 ,
NID_söfo_ac˚ss
)) {

196 i‡(
p
->
vîbo£
)

197 
	`BIO_¥ötf
(
p
->
îr‹bio
,"Sëtög URL from SIAÅo: %s\n", 
ac˚ssöfo
);

199 
	`cuæ_ósy_£t›t
(
p
->
cuæ
, 
CURLOPT_URL
,
ac˚ssöfo
);

201 i‡(
ac˚ssöfo
 = 
	`my_gë_ext
(
˘x
->
˚π
,
p
->
ac˚s°y≥
,

202 
NID_öfo_ac˚ss
)) {

203 i‡(
p
->
vîbo£
)

204 
	`BIO_¥ötf
(
p
->
îr‹bio
,"Sëtög URL from AIAÅo: %s\n", 
ac˚ssöfo
);

206 
	`cuæ_ósy_£t›t
(
p
->
cuæ
, 
CURLOPT_URL
,
ac˚ssöfo
);

209 i‡(
p
->
vîbo£
 > 2)

210 
	`BIO_¥ötf
(
p
->
îr‹bio
,"Àavög s¶_≠p_vîify_ˇŒback wôh %d\n", 
ok
);

211 (
ok
);

212 
	}
}

222 
CURLcode
 
	$s¶˘xfun
(
CURL
 * 
cuæ
, * 
s¶˘x
, * 
∑rm
) {

224 
s¶˘x∑rm
 * 
p
 = (s¶˘x∑rm *Ë
∑rm
;

225 
SSL_CTX
 * 
˘x
 = (SSL_CTX *Ë
s¶˘x
 ;

227 i‡(!
	`SSL_CTX_u£_˚πifiˇã
(
˘x
,
p
->
u£r˚π
)) {

228 
	`BIO_¥ötf
(
p
->
îr‹bio
, "SSL_CTX_u£_˚πifiˇãÖrobÀm\n"); 
îr
;

230 i‡(!
	`SSL_CTX_u£_Priv©eKey
(
˘x
,
p
->
pkey
)) {

231 
	`BIO_¥ötf
(
p
->
îr‹bio
, "SSL_CTX_u£_Priv©eKey\n"); 
îr
;

234 i‡(!
	`SSL_CTX_check_¥iv©e_key
(
˘x
)) {

235 
	`BIO_¥ötf
(
p
->
îr‹bio
, "SSL_CTX_check_¥iv©e_key\n"); 
îr
;

238 
	`SSL_CTX_£t_quõt_shutdown
(
˘x
,1);

239 
	`SSL_CTX_£t_cùhî_li°
(
˘x
,"RC4-MD5");

240 
	`SSL_CTX_£t_mode
(
˘x
, 
SSL_MODE_AUTO_RETRY
);

242 
	`X509_STORE_add_˚π
(
	`SSL_CTX_gë_˚π_°‹e
(
˘x
), 
	`sk_X509_vÆue
(
p
->
ˇ
, 
	`sk_X509_num
(p->ca)-1));

244 
	`SSL_CTX_£t_vîify_dïth
(
˘x
,2);

246 
	`SSL_CTX_£t_vîify
(
˘x
,
SSL_VERIFY_PEER
,
ZERO_NULL
);

248 
	`SSL_CTX_£t_˚π_vîify_ˇŒback
(
˘x
, 
s¶_≠p_vîify_ˇŒback
, 
∑rm
);

251  
CURLE_OK
 ;

252 
îr
:

253 
	`ERR_¥öt_îr‹s
(
p
->
îr‹bio
);

254  
CURLE_SSL_CERTPROBLEM
;

256 
	}
}

258 
	$maö
(
¨gc
, **
¨gv
) {

260 
BIO
* 
ö
=
NULL
;

261 
BIO
* 
out
=
NULL
;

263 * 
outfûe
 = 
NULL
;

264 * 
öfûe
 = 
NULL
 ;

266 
èbLígth
=100;

267 *
bö¨y±r
;

268 * 
mimëy≥
;

269 * 
mimëy≥ac˚±
=
NULL
;

270 * 
c⁄ã¡ty≥
;

271 c⁄° ** 
µ
;

272 * 
ho°p‹tuæ
 = 
NULL
;

273 
BIO
 * 
p12bio
 ;

274 **
¨gs
 = 
¨gv
 + 1;

275 * 
£rvîuæ
;

276 
s¶˘x∑rm
 
p
;

277 *
ª•⁄£
;

279 
CURLcode
 
ªs
;

280 
cuæ_¶i°
 * 
hódîs
=
NULL
;

281 
bad¨g
=0;

283 
bö¨y±r
 = 
	`mÆloc
(
èbLígth
);

285 
p
.
vîbo£
 = 0;

286 
p
.
îr‹bio
 = 
	`BIO_√w_Â
 (
°dîr
, 
BIO_NOCLOSE
);

288 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

292 
	`O≥nSSL_add_Æl_cùhîs
();

293 
	`O≥nSSL_add_Æl_dige°s
();

294 
	`ERR_lﬂd_¸y±o_°rögs
();

298 *
¨gs
 && *args[0] == '-') {

299 i‡(!
	`°rcmp
 (*
¨gs
, "-in")) {

300 i‡(
¨gs
[1]) {

301 
öfûe
=*(++
¨gs
);

302 } 
bad¨g
=1;

303 } i‡(!
	`°rcmp
 (*
¨gs
, "-out")) {

304 i‡(
¨gs
[1]) {

305 
outfûe
=*(++
¨gs
);

306 } 
bad¨g
=1;

307 } i‡(!
	`°rcmp
 (*
¨gs
, "-p12")) {

308 i‡(
¨gs
[1]) {

309 
p
.
p12fûe
 = *(++
¨gs
);

310 } 
bad¨g
=1;

311 } i‡(
	`°rcmp
(*
¨gs
,"-envpass") == 0) {

312 i‡(
¨gs
[1]) {

313 
p
.
p°
 = 
	`gëív
(*(++
¨gs
));

314 } 
bad¨g
=1;

315 } i‡(
	`°rcmp
(*
¨gs
,"-connect") == 0) {

316 i‡(
¨gs
[1]) {

317 
ho°p‹tuæ
 = *(++
¨gs
);

318 } 
bad¨g
=1;

319 } i‡(
	`°rcmp
(*
¨gs
,"-mimetype") == 0) {

320 i‡(
¨gs
[1]) {

321 
mimëy≥
 = *(++
¨gs
);

322 } 
bad¨g
=1;

323 } i‡(
	`°rcmp
(*
¨gs
,"-acceptmime") == 0) {

324 i‡(
¨gs
[1]) {

325 
mimëy≥ac˚±
 = *(++
¨gs
);

326 } 
bad¨g
=1;

327 } i‡(
	`°rcmp
(*
¨gs
,"-accesstype") == 0) {

328 i‡(
¨gs
[1]) {

329 i‡((
p
.
ac˚s°y≥
 = 
	`OBJ_obj2nid
(
	`OBJ_txt2obj
(*++
¨gs
,0))Ë=0Ë
bad¨g
=1;

330 } 
bad¨g
=1;

331 } i‡(
	`°rcmp
(*
¨gs
,"-verbose") == 0) {

332 
p
.
vîbo£
++;

333 } 
bad¨g
=1;

334 
¨gs
++;

337 i‡(
mimëy≥
==
NULL
 || 
mimëy≥ac˚±
 =NULLË
bad¨g
 = 1;

339 i‡(
bad¨g
) {

340 
µ
=
cuæx_ußge
; (*µ !
NULL
);Öp++)

341 
	`BIO_¥ötf
(
p
.
îr‹bio
,"%s\n",*
µ
);

342 
	`BIO_¥ötf
(
p
.
îr‹bio
,"\n");

343 
îr
;

350 i‡((
ö
=
	`BIO_√w
(
	`BIO_s_fûe
())Ë=
NULL
) {

351 
	`BIO_¥ötf
(
p
.
îr‹bio
, "Error setting input bio\n");

352 
îr
;

353 } i‡(
öfûe
 =
NULL
)

354 
	`BIO_£t_Â
(
ö
,
°dö
,
BIO_NOCLOSE
|
BIO_FP_TEXT
);

355 i‡(
	`BIO_ªad_fûíame
(
ö
,
öfûe
) <= 0) {

356 
	`BIO_¥ötf
(
p
.
îr‹bio
, "Eº‹ o≥nög i≈uàfûê%s\n", 
öfûe
);

357 
	`BIO_‰ì
(
ö
);

358 
îr
;

363 i‡((
out
=
	`BIO_√w
(
	`BIO_s_fûe
())Ë=
NULL
) {

364 
	`BIO_¥ötf
(
p
.
îr‹bio
, "Error setting output bio.\n");

365 
îr
;

366 } i‡(
outfûe
 =
NULL
)

367 
	`BIO_£t_Â
(
out
,
°dout
,
BIO_NOCLOSE
|
BIO_FP_TEXT
);

368 i‡(
	`BIO_wrôe_fûíame
(
out
,
outfûe
) <= 0) {

369 
	`BIO_¥ötf
(
p
.
îr‹bio
, "Eº‹ o≥nög ouçuàfûê%s\n", 
outfûe
);

370 
	`BIO_‰ì
(
out
);

371 
îr
;

375 
p
.
îr‹bio
 = 
	`BIO_√w_Â
 (
°dîr
, 
BIO_NOCLOSE
);

377 i‡(!(
p
.
cuæ
 = 
	`cuæ_ósy_öô
())) {

378 
	`BIO_¥ötf
(
p
.
îr‹bio
, "Cannot init curlÜib\n");

379 
îr
;

384 i‡(!(
p12bio
 = 
	`BIO_√w_fûe
(
p
.
p12fûe
 , "rb"))) {

385 
	`BIO_¥ötf
(
p
.
îr‹bio
, "Eº‹ o≥nög P12 fûê%s\n",Ö.
p12fûe
); 
îr
;

387 i‡(!(
p
.
p12
 = 
	`d2i_PKCS12_bio
 (
p12bio
, 
NULL
))) {

388 
	`BIO_¥ötf
(
p
.
îr‹bio
, "C™nŸ decodêP12 såu˘uª %s\n",Ö.
p12fûe
); 
îr
;

391 
p
.
ˇ

NULL
;

392 i‡(!(
	`PKCS12_∑r£
 (
p
.
p12
,Ö.
p°
, &’.
pkey
), &’.
u£r˚π
), &’.
ˇ
) ) )) {

393 
	`BIO_¥ötf
(
p
.
îr‹bio
,"InvÆid P12 såu˘uª i¿%s\n",Ö.
p12fûe
); 
îr
;

396 i‡(
	`sk_X509_num
(
p
.
ˇ
) <= 0) {

397 
	`BIO_¥ötf
(
p
.
îr‹bio
,"Nÿåu°w‹thy CA giví.%s\n",Ö.
p12fûe
); 
îr
;

400 i‡(
p
.
vîbo£
 > 1)

401 
	`X509_¥öt_ex
(
p
.
îr‹bio
,p.
u£r˚π
,0,0);

405 i‡(
ho°p‹tuæ
) {

406 
£rvîuæ
 = 
	`mÆloc
(9+
	`°æí
(
ho°p‹tuæ
));

407 
	`•rötf
(
£rvîuæ
,"hâps://%s",
ho°p‹tuæ
);

409 i‡(
p
.
ac˚s°y≥
 != 0) {

410 i‡(!(
£rvîuæ
 = 
	`my_gë_ext
(
p
.
u£r˚π
,p.
ac˚s°y≥
,
NID_öfo_ac˚ss
))) {

411 
j
=0;

412 
	`BIO_¥ötf
(
p
.
îr‹bio
,"no service URL in user cert "

414 
j
=0;j<
	`sk_X509_num
(
p
.
ˇ
);j++) {

415 i‡((
£rvîuæ
 = 
	`my_gë_ext
(
	`sk_X509_vÆue
(
p
.
ˇ
,
j
),p.
ac˚s°y≥
,

416 
NID_öfo_ac˚ss
)))

418 i‡((
£rvîuæ
 = 
	`my_gë_ext
(
	`sk_X509_vÆue
(
p
.
ˇ
,
j
),p.
ac˚s°y≥
,

419 
NID_söfo_ac˚ss
)))

425 i‡(!
£rvîuæ
) {

426 
	`BIO_¥ötf
(
p
.
îr‹bio
, "no service URL in certificats,"

429 
îr
;

432 i‡(
p
.
vîbo£
)

433 
	`BIO_¥ötf
(
p
.
îr‹bio
, "Sîvi˚ URL: <%s>\n", 
£rvîuæ
);

435 
	`cuæ_ósy_£t›t
(
p
.
cuæ
, 
CURLOPT_URL
, 
£rvîuæ
);

439 
	`cuæ_ósy_£t›t
(
p
.
cuæ
, 
CURLOPT_POSTFIELDS
, 
bö¨y±r
);

440 
	`cuæ_ósy_£t›t
(
p
.
cuæ
, 
CURLOPT_POSTFIELDSIZE
,()
èbLígth
);

444 
c⁄ã¡ty≥
 = 
	`mÆloc
(15+
	`°æí
(
mimëy≥
));

445 
	`•rötf
(
c⁄ã¡ty≥
,"C⁄ã¡-ty≥: %s",
mimëy≥
);

446 
hódîs
 = 
	`cuæ_¶i°_≠≥nd
(hódîs,
c⁄ã¡ty≥
);

447 
	`cuæ_ósy_£t›t
(
p
.
cuæ
, 
CURLOPT_HTTPHEADER
, 
hódîs
);

449 i‡(
p
.
vîbo£
)

450 
	`BIO_¥ötf
(
p
.
îr‹bio
, "Sîvi˚ URL: <%s>\n", 
£rvîuæ
);

453 
FILE
 *
outÂ
;

454 
	`BIO_gë_Â
(
out
,&
outÂ
);

455 
	`cuæ_ósy_£t›t
(
p
.
cuæ
, 
CURLOPT_WRITEDATA
, 
outÂ
);

458 
ªs
 = 
	`cuæ_ósy_£t›t
(
p
.
cuæ
, 
CURLOPT_SSL_CTX_FUNCTION
, 
s¶˘xfun
) ;

460 i‡(
ªs
 !
CURLE_OK
)

461 
	`BIO_¥ötf
(
p
.
îr‹bio
,"%d %s=%d %d\n", 
__LINE__
, "CURLOPT_SSL_CTX_FUNCTION",
CURLOPT_SSL_CTX_FUNCTION
,
ªs
);

463 
	`cuæ_ósy_£t›t
(
p
.
cuæ
, 
CURLOPT_SSL_CTX_DATA
, &p);

466 
lu
; 
i
=0;

467 (
lu
 = 
	`BIO_ªad
 (
ö
,&
bö¨y±r
[
i
],
èbLígth
-i)) >0 ) {

468 
i
+=
lu
;

469 i‡(
i
=
èbLígth
) {

470 
èbLígth
+=100;

471 
bö¨y±r
=
	`ªÆloc
(bö¨y±r,
èbLígth
);

474 
èbLígth
 = 
i
;

478 
	`cuæ_ósy_£t›t
(
p
.
cuæ
, 
CURLOPT_POSTFIELDS
, 
bö¨y±r
);

479 
	`cuæ_ósy_£t›t
(
p
.
cuæ
, 
CURLOPT_POSTFIELDSIZE
,()
èbLígth
);

484 
	`BIO_¥ötf
(
p
.
îr‹bio
,"%d %†%d\n", 
__LINE__
, "curl_easy_perform",

485 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
p
.
cuæ
));

487 
ªsu…
 =
	`cuæ_ósy_gëöfo
(
p
.
cuæ
,
CURLINFO_CONTENT_TYPE
,&
ª•⁄£
);

488 if–
mimëy≥ac˚±
 && 
p
.
vîbo£
)

489 if(!
	`°rcmp
(
mimëy≥ac˚±
,
ª•⁄£
))

490 
	`BIO_¥ötf
(
p
.
îr‹bio
,"theÑesponse hasá correct mimetype : %s\n",

491 
ª•⁄£
);

493 
	`BIO_¥ötf
(
p
.
îr‹bio
,"theÑeponse doesn\'t hasánácceptable "

495 
ª•⁄£
,
mimëy≥ac˚±
);

502 
	`cuæ_¶i°_‰ì_Æl
(
hódîs
);

505 
	`cuæ_ósy_˛ónup
(
p
.
cuæ
);

507 
	`BIO_‰ì
(
ö
);

508 
	`BIO_‰ì
(
out
);

509  (
EXIT_SUCCESS
);

511 
îr
: 
	`BIO_¥ötf
(
p
.
îr‹bio
,"error");

512 
	`exô
(1);

513 
	}
}

	@docs/examples/debug.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

25 
	sd©a
 {

26 
	måa˚_ascii
;

30 
	$dump
(c⁄° *
ãxt
,

31 
FILE
 *
°ªam
, *
±r
, 
size_t
 
size
,

32 
nohex
)

34 
size_t
 
i
;

35 
size_t
 
c
;

37 
width
=0x10;

39 if(
nohex
)

41 
width
 = 0x40;

43 
	`Ârötf
(
°ªam
, "%s, %10.10ld bytes (0x%8.8lx)\n",

44 
ãxt
, ()
size
, ()size);

46 
i
=0; i<
size
; i+
width
) {

48 
	`Ârötf
(
°ªam
, "%4.4lx: ", ()
i
);

50 if(!
nohex
) {

52 
c
 = 0; c < 
width
; c++)

53 if(
i
+
c
 < 
size
)

54 
	`Ârötf
(
°ªam
, "%02x ", 
±r
[
i
+
c
]);

56 
	`Âuts
(" ", 
°ªam
);

59 
c
 = 0; (¯< 
width
Ë&& (
i
+¯< 
size
); c++) {

61 i‡(
nohex
 && (
i
+
c
+1 < 
size
Ë&& 
±r
[i+c]==0x0D &&Ötr[i+c+1]==0x0A) {

62 
i
+=(
c
+2-
width
);

65 
	`Ârötf
(
°ªam
, "%c",

66 (
±r
[
i
+
c
]>=0x20) && (ptr[i+c]<0x80)?ptr[i+c]:'.');

68 i‡(
nohex
 && (
i
+
c
+2 < 
size
Ë&& 
±r
[i+c+1]==0x0D &&Ötr[i+c+2]==0x0A) {

69 
i
+=(
c
+3-
width
);

73 
	`Âutc
('\n', 
°ªam
);

75 
	`fÊush
(
°ªam
);

76 
	}
}

79 
	$my_åa˚
(
CURL
 *
h™dÀ
, 
cuæ_öfŸy≥
 
ty≥
,

80 *
d©a
, 
size_t
 
size
,

81 *
u£Ω
)

83 
d©a
 *
c⁄fig
 = (d©®*)
u£Ω
;

84 c⁄° *
ãxt
;

85 ()
h™dÀ
;

87 
ty≥
) {

88 
CURLINFO_TEXT
:

89 
	`Ârötf
(
°dîr
, "=Info: %s", 
d©a
);

93 
CURLINFO_HEADER_OUT
:

94 
ãxt
 = "=> Send header";

96 
CURLINFO_DATA_OUT
:

97 
ãxt
 = "=> Send data";

99 
CURLINFO_SSL_DATA_OUT
:

100 
ãxt
 = "=> Send SSL data";

102 
CURLINFO_HEADER_IN
:

103 
ãxt
 = "<= Recv header";

105 
CURLINFO_DATA_IN
:

106 
ãxt
 = "<= Recv data";

108 
CURLINFO_SSL_DATA_IN
:

109 
ãxt
 = "<= Recv SSL data";

113 
	`dump
(
ãxt
, 
°dîr
, (*)
d©a
, 
size
, 
c⁄fig
->
åa˚_ascii
);

115 
	}
}

117 
	$maö
()

119 
CURL
 *
cuæ
;

120 
CURLcode
 
ªs
;

121 
d©a
 
c⁄fig
;

123 
c⁄fig
.
åa˚_ascii
 = 1;

125 
cuæ
 = 
	`cuæ_ósy_öô
();

126 if(
cuæ
) {

127 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_DEBUGFUNCTION
, 
my_åa˚
);

128 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_DEBUGDATA
, &
c⁄fig
);

131 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

134 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_FOLLOWLOCATION
, 1L);

136 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com/");

137 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

139 if(
ªs
 !
CURLE_OK
)

140 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

141 
	`cuæ_ósy_°ªº‹
(
ªs
));

144 
	`cuæ_ósy_˛ónup
(
cuæ
);

147 
	}
}

	@docs/examples/evhiperfifo.c

59 
	~<°dio.h
>

60 
	~<°rög.h
>

61 
	~<°dlib.h
>

62 
	~<sys/time.h
>

63 
	~<time.h
>

64 
	~<uni°d.h
>

65 
	~<sys/pﬁl.h
>

66 
	~<cuæ/cuæ.h
>

67 
	~<ev.h
>

68 
	~<f˙é.h
>

69 
	~<sys/°©.h
>

70 
	~<î∫o.h
>

72 
	#DPRINT
(
x
...Ë
	`¥ötf
(x)

	)

74 
	#MSG_OUT
 
°dout


	)

78 
	s_GlobÆInfo


80 
ev_lo›
 *
	mlo›
;

81 
ev_io
 
	mfifo_evít
;

82 
ev_timî
 
	mtimî_evít
;

83 
CURLM
 *
	mmu…i
;

84 
	m°ûl_ru¬ög
;

85 
FILE
* 
	möput
;

86 } 
	tGlobÆInfo
;

90 
	s_C⁄nInfo


92 
CURL
 *
	mósy
;

93 *
	muæ
;

94 
GlobÆInfo
 *
	mglobÆ
;

95 
	mîr‹
[
CURL_ERROR_SIZE
];

96 } 
	tC⁄nInfo
;

100 
	s_SockInfo


102 
cuæ_sockë_t
 
	msockfd
;

103 
CURL
 *
	mósy
;

104 
	ma˘i⁄
;

105 
	mtimeout
;

106 
ev_io
 
	mev
;

107 
	mev£t
;

108 
GlobÆInfo
 *
	mglobÆ
;

109 } 
	tSockInfo
;

111 
timî_cb
(
EV_P_
 
ev_timî
 *
w
, 
ªvíts
);

114 
	$mu…i_timî_cb
(
CURLM
 *
mu…i
, 
timeout_ms
, 
GlobÆInfo
 *
g
)

116 
	`DPRINT
("%†%li\n", 
__PRETTY_FUNCTION__
, 
timeout_ms
);

117 
	`ev_timî_°›
(
g
->
lo›
, &g->
timî_evít
);

118 i‡(
timeout_ms
 > 0)

120 
t
 = 
timeout_ms
 / 1000;

121 
	`ev_timî_öô
(&
g
->
timî_evít
, 
timî_cb
, 
t
, 0.);

122 
	`ev_timî_°¨t
(
g
->
lo›
, &g->
timî_evít
);

124 
	`timî_cb
(
g
->
lo›
, &g->
timî_evít
, 0);

126 
	}
}

129 
	$mcode_‹_dõ
(c⁄° *
whîe
, 
CURLMcode
 
code
)

131 i‡–
CURLM_OK
 !
code
 )

133 c⁄° *
s
;

134  
code
 )

136 
CURLM_BAD_HANDLE
: 
s
="CURLM_BAD_HANDLE"; ;

137 
CURLM_BAD_EASY_HANDLE
: 
s
="CURLM_BAD_EASY_HANDLE"; ;

138 
CURLM_OUT_OF_MEMORY
: 
s
="CURLM_OUT_OF_MEMORY"; ;

139 
CURLM_INTERNAL_ERROR
: 
s
="CURLM_INTERNAL_ERROR"; ;

140 
CURLM_UNKNOWN_OPTION
: 
s
="CURLM_UNKNOWN_OPTION"; ;

141 
CURLM_LAST
: 
s
="CURLM_LAST"; ;

142 : 
s
="CURLM_unknown";

144 
CURLM_BAD_SOCKET
: 
s
="CURLM_BAD_SOCKET";

145 
	`Ârötf
(
MSG_OUT
, "ERROR: %†ªtu∫†%s\n", 
whîe
, 
s
);

149 
	`Ârötf
(
MSG_OUT
, "ERROR: %†ªtu∫†%s\n", 
whîe
, 
s
);

150 
	`exô
(
code
);

152 
	}
}

157 
	$check_mu…i_öfo
(
GlobÆInfo
 *
g
)

159 *
eff_uæ
;

160 
CURLMsg
 *
msg
;

161 
msgs_À·
;

162 
C⁄nInfo
 *
c⁄n
;

163 
CURL
 *
ósy
;

164 
CURLcode
 
ªs
;

166 
	`Ârötf
(
MSG_OUT
, "REMAINING: %d\n", 
g
->
°ûl_ru¬ög
);

167 (
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
g
->
mu…i
, &
msgs_À·
))) {

168 i‡(
msg
->msg =
CURLMSG_DONE
) {

169 
ósy
 = 
msg
->
ósy_h™dÀ
;

170 
ªs
 = 
msg
->
d©a
.
ªsu…
;

171 
	`cuæ_ósy_gëöfo
(
ósy
, 
CURLINFO_PRIVATE
, &
c⁄n
);

172 
	`cuæ_ósy_gëöfo
(
ósy
, 
CURLINFO_EFFECTIVE_URL
, &
eff_uæ
);

173 
	`Ârötf
(
MSG_OUT
, "DONE: %†=> (%dË%s\n", 
eff_uæ
, 
ªs
, 
c⁄n
->
îr‹
);

174 
	`cuæ_mu…i_ªmove_h™dÀ
(
g
->
mu…i
, 
ósy
);

175 
	`‰ì
(
c⁄n
->
uæ
);

176 
	`cuæ_ósy_˛ónup
(
ósy
);

177 
	`‰ì
(
c⁄n
);

180 
	}
}

185 
	$evít_cb
(
EV_P_
 
ev_io
 *
w
, 
ªvíts
)

187 
	`DPRINT
("%† w %∞ªvít†%i\n", 
__PRETTY_FUNCTION__
, 
w
, 
ªvíts
);

188 
GlobÆInfo
 *
g
 = (GlobÆInfo*Ë
w
->
d©a
;

189 
CURLMcode
 
rc
;

191 
a˘i⁄
 = (
ªvíts
&
EV_READ
?
CURL_POLL_IN
:0)|

192 (
ªvíts
&
EV_WRITE
?
CURL_POLL_OUT
:0);

193 
rc
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
g
->
mu…i
, 
w
->
fd
, 
a˘i⁄
, &g->
°ûl_ru¬ög
);

194 
	`mcode_‹_dõ
("evít_cb: cuæ_mu…i_sockë_a˘i⁄", 
rc
);

195 
	`check_mu…i_öfo
(
g
);

196 i‡–
g
->
°ûl_ru¬ög
 <= 0 )

198 
	`Ârötf
(
MSG_OUT
, "lastÅransfer done, killÅimeout\n");

199 
	`ev_timî_°›
(
g
->
lo›
, &g->
timî_evít
);

201 
	}
}

204 
	$timî_cb
(
EV_P_
 
ev_timî
 *
w
, 
ªvíts
)

206 
	`DPRINT
("%† w %∞ªvít†%i\n", 
__PRETTY_FUNCTION__
, 
w
, 
ªvíts
);

208 
GlobÆInfo
 *
g
 = (GlobÆInfÿ*)
w
->
d©a
;

209 
CURLMcode
 
rc
;

211 
rc
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
g
->
mu…i
, 
CURL_SOCKET_TIMEOUT
, 0, &g->
°ûl_ru¬ög
);

212 
	`mcode_‹_dõ
("timî_cb: cuæ_mu…i_sockë_a˘i⁄", 
rc
);

213 
	`check_mu…i_öfo
(
g
);

214 
	}
}

217 
	$ªmsock
(
SockInfo
 *
f
, 
GlobÆInfo
 *
g
)

219 
	`¥ötf
("%† \n", 
__PRETTY_FUNCTION__
);

220 i‡–
f
 )

222 i‡–
f
->
ev£t
 )

223 
	`ev_io_°›
(
g
->
lo›
, &
f
->
ev
);

224 
	`‰ì
(
f
);

226 
	}
}

231 
	$£tsock
(
SockInfo
*
f
, 
cuæ_sockë_t
 
s
, 
CURL
*
e
, 
a˘
, 
GlobÆInfo
*
g
)

233 
	`¥ötf
("%† \n", 
__PRETTY_FUNCTION__
);

235 
köd
 = (
a˘
&
CURL_POLL_IN
?
EV_READ
:0)|◊˘&
CURL_POLL_OUT
?
EV_WRITE
:0);

237 
f
->
sockfd
 = 
s
;

238 
f
->
a˘i⁄
 = 
a˘
;

239 
f
->
ósy
 = 
e
;

240 i‡–
f
->
ev£t
 )

241 
	`ev_io_°›
(
g
->
lo›
, &
f
->
ev
);

242 
	`ev_io_öô
(&
f
->
ev
, 
evít_cb
, f->
sockfd
, 
köd
);

243 
f
->
ev
.
d©a
 = 
g
;

244 
f
->
ev£t
=1;

245 
	`ev_io_°¨t
(
g
->
lo›
, &
f
->
ev
);

246 
	}
}

251 
	$addsock
(
cuæ_sockë_t
 
s
, 
CURL
 *
ósy
, 
a˘i⁄
, 
GlobÆInfo
 *
g
)

253 
SockInfo
 *
fdp
 = 
	`ˇŒoc
((SockInfo), 1);

255 
fdp
->
globÆ
 = 
g
;

256 
	`£tsock
(
fdp
, 
s
, 
ósy
, 
a˘i⁄
, 
g
);

257 
	`cuæ_mu…i_assign
(
g
->
mu…i
, 
s
, 
fdp
);

258 
	}
}

261 
	$sock_cb
(
CURL
 *
e
, 
cuæ_sockë_t
 
s
, 
wh©
, *
cbp
, *
sockp
)

263 
	`DPRINT
("%sÉ %p s %i what %i cbp %p sockp %p\n",

264 
__PRETTY_FUNCTION__
, 
e
, 
s
, 
wh©
, 
cbp
, 
sockp
);

266 
GlobÆInfo
 *
g
 = (GlobÆInfo*Ë
cbp
;

267 
SockInfo
 *
fdp
 = (SockInfo*Ë
sockp
;

268 c⁄° *
wh©°r
[]={ "none", "IN", "OUT", "INOUT", "REMOVE"};

270 
	`Ârötf
(
MSG_OUT
,

271 "sockë cÆlback: s=%dÉ=%∞wh©=%†", 
s
, 
e
, 
wh©°r
[
wh©
]);

272 i‡–
wh©
 =
CURL_POLL_REMOVE
 )

274 
	`Ârötf
(
MSG_OUT
, "\n");

275 
	`ªmsock
(
fdp
, 
g
);

278 i‡–!
fdp
 )

280 
	`Ârötf
(
MSG_OUT
, "Addög d©a: %s\n", 
wh©°r
[
wh©
]);

281 
	`addsock
(
s
, 
e
, 
wh©
, 
g
);

284 
	`Ârötf
(
MSG_OUT
,

286 
wh©°r
[
fdp
->
a˘i⁄
], wh©°r[
wh©
]);

287 
	`£tsock
(
fdp
, 
s
, 
e
, 
wh©
, 
g
);

291 
	}
}

295 
size_t
 
	$wrôe_cb
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
d©a
)

297 
size_t
 
ªÆsize
 = 
size
 * 
nmemb
;

298 
C⁄nInfo
 *
c⁄n
 = (C⁄nInfo*Ë
d©a
;

299 ()
±r
;

300 ()
c⁄n
;

301  
ªÆsize
;

302 
	}
}

306 
	$¥og_cb
 (*
p
, 
d…ŸÆ
, 
d ow
, 
u…
,

307 
u 
)

309 
C⁄nInfo
 *
c⁄n
 = (C⁄nInfÿ*)
p
;

310 ()
u…
;

311 ()
u 
;

313 
	`Ârötf
(
MSG_OUT
, "Progªss: %†(%g/%g)\n", 
c⁄n
->
uæ
, 
d ow
, 
d…ŸÆ
);

315 
	}
}

319 
	$√w_c⁄n
(*
uæ
, 
GlobÆInfo
 *
g
 )

321 
C⁄nInfo
 *
c⁄n
;

322 
CURLMcode
 
rc
;

324 
c⁄n
 = 
	`ˇŒoc
(1, (
C⁄nInfo
));

325 
	`mem£t
(
c⁄n
, 0, (
C⁄nInfo
));

326 
c⁄n
->
îr‹
[0]='\0';

328 
c⁄n
->
ósy
 = 
	`cuæ_ósy_öô
();

329 i‡–!
c⁄n
->
ósy
 )

331 
	`Ârötf
(
MSG_OUT
, "curl_easy_init() failed,Éxiting!\n");

332 
	`exô
(2);

334 
c⁄n
->
globÆ
 = 
g
;

335 
c⁄n
->
uæ
 = 
	`°rdup
(url);

336 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_URL
, c⁄n->
uæ
);

337 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_cb
);

338 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_WRITEDATA
, conn);

339 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_VERBOSE
, 1L);

340 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_ERRORBUFFER
, c⁄n->
îr‹
);

341 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PRIVATE
, conn);

342 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_NOPROGRESS
, 0L);

343 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PROGRESSFUNCTION
, 
¥og_cb
);

344 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PROGRESSDATA
, conn);

345 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_LOW_SPEED_TIME
, 3L);

346 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_LOW_SPEED_LIMIT
, 10L);

348 
	`Ârötf
(
MSG_OUT
,

349 "AddögÉasy %∞tÿmu…ò%∞(%s)\n", 
c⁄n
->
ósy
, 
g
->
mu…i
, 
uæ
);

350 
rc
 = 
	`cuæ_mu…i_add_h™dÀ
(
g
->
mu…i
, 
c⁄n
->
ósy
);

351 
	`mcode_‹_dõ
("√w_c⁄n: cuæ_mu…i_add_h™dÀ", 
rc
);

355 
	}
}

358 
	$fifo_cb
(
EV_P_
 
ev_io
 *
w
, 
ªvíts
)

360 
s
[1024];

361 
rv
=0;

362 
n
=0;

363 
GlobÆInfo
 *
g
 = (GlobÆInfÿ*)
w
->
d©a
;

367 
s
[0]='\0';

368 
rv
=
	`fsˇnf
(
g
->
öput
, "%1023s%n", 
s
, &
n
);

369 
s
[
n
]='\0';

370 i‡–
n
 && 
s
[0] )

372 
	`√w_c⁄n
(
s
,
g
);

374 }  
rv
 !
EOF
 );

375 
	}
}

378 
	$öô_fifo
 (
GlobÆInfo
 *
g
)

380 
°©
 
°
;

381 c⁄° *
fifo
 = "hiper.fifo";

382 
cuæ_sockë_t
 
sockfd
;

384 
	`Ârötf
(
MSG_OUT
, "Cª©ögÇamedÖùê\"%s\"\n", 
fifo
);

385 i‡–
	`l°©
 (
fifo
, &
°
) == 0 )

387 i‡–(
°
.
°_mode
 & 
S_IFMT
Ë=
S_IFREG
 )

389 
î∫o
 = 
EEXIST
;

390 
	`≥º‹
("lstat");

391 
	`exô
 (1);

394 
	`u∆ök
(
fifo
);

395 i‡–
	`mkfifo
 (
fifo
, 0600) == -1 )

397 
	`≥º‹
("mkfifo");

398 
	`exô
 (1);

400 
sockfd
 = 
	`›í
(
fifo
, 
O_RDWR
 | 
O_NONBLOCK
, 0);

401 i‡–
sockfd
 == -1 )

403 
	`≥º‹
("open");

404 
	`exô
 (1);

406 
g
->
öput
 = 
	`fd›í
(
sockfd
, "r");

408 
	`Ârötf
(
MSG_OUT
, "Now,ÖùêsomêURL'†ötÿ> %s\n", 
fifo
);

409 
	`ev_io_öô
(&
g
->
fifo_evít
, 
fifo_cb
, 
sockfd
, 
EV_READ
);

410 
	`ev_io_°¨t
(
g
->
lo›
, &g->
fifo_evít
);

412 
	}
}

414 
	$maö
(
¨gc
, **
¨gv
)

416 
GlobÆInfo
 
g
;

417 
CURLMcode
 
rc
;

418 ()
¨gc
;

419 ()
¨gv
;

421 
	`mem£t
(&
g
, 0, (
GlobÆInfo
));

422 
g
.
lo›
 = 
	`ev_deÁu…_lo›
(0);

424 
	`öô_fifo
(&
g
);

425 
g
.
mu…i
 = 
	`cuæ_mu…i_öô
();

427 
	`ev_timî_öô
(&
g
.
timî_evít
, 
timî_cb
, 0., 0.);

428 
g
.
timî_evít
.
d©a
 = &g;

429 
g
.
fifo_evít
.
d©a
 = &g;

430 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_SOCKETFUNCTION
, 
sock_cb
);

431 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_SOCKETDATA
, &g);

432 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_TIMERFUNCTION
, 
mu…i_timî_cb
);

433 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_TIMERDATA
, &g);

438 
	`ev_lo›
(
g
.
lo›
, 0);

439 
	`cuæ_mu…i_˛ónup
(
g
.
mu…i
);

441 
	}
}

	@docs/examples/externalsocket.c

26 
	~<°dio.h
>

27 
	~<°rög.h
>

28 
	~<°dlib.h
>

29 
	~<cuæ/cuæ.h
>

31 #ifde‡
WIN32


32 
	~<wödows.h
>

33 
	~<wösock2.h
>

34 
	~<ws2t˝ù.h
>

35 
	#˛o£
 
˛o£sockë


	)

37 
	~<sys/ty≥s.h
>

38 
	~<sys/sockë.h
>

39 
	~<√töë/ö.h
>

40 
	~<¨∑/öë.h
>

41 
	~<uni°d.h
>

44 
	~<î∫o.h
>

47 
	#IPADDR
 "127.0.0.1"

	)

48 
	#PORTNUM
 80

	)

50 #i‚de‡
INADDR_NONE


51 
	#INADDR_NONE
 0xffffffff

	)

54 
size_t
 
	$wrôe_d©a
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

56 
wrôãn
 = 
	`fwrôe
(
±r
, 
size
, 
nmemb
, (
FILE
 *)
°ªam
);

57  
wrôãn
;

58 
	}
}

60 
cuæ_sockë_t
 
	$›ísockë
(*
˛õ¡p
,

61 
cuæsockty≥
 
puΩo£
,

62 
cuæ_sockaddr
 *
addªss
)

64 
cuæ_sockë_t
 
sockfd
;

65 ()
puΩo£
;

66 ()
addªss
;

67 
sockfd
 = *(
cuæ_sockë_t
 *)
˛õ¡p
;

70  
sockfd
;

71 
	}
}

73 
	$sock›t_ˇŒback
(*
˛õ¡p
, 
cuæ_sockë_t
 
cuæfd
,

74 
cuæsockty≥
 
puΩo£
)

76 ()
˛õ¡p
;

77 ()
cuæfd
;

78 ()
puΩo£
;

80  
CURL_SOCKOPT_ALREADY_CONNECTED
;

81 
	}
}

83 
	$maö
()

85 
CURL
 *
cuæ
;

86 
CURLcode
 
ªs
;

87 
sockaddr_ö
 
£rvaddr
;

88 
cuæ_sockë_t
 
sockfd
;

90 #ifde‡
WIN32


91 
WSADATA
 
wßD©a
;

92 
öôwß
;

94 if((
öôwß
 = 
	`WSASèπup
(
	`MAKEWORD
(2,0), &
wßD©a
)) != 0) {

95 
	`¥ötf
("WSASèπu∞Áûed: %d\n", 
öôwß
);

100 
cuæ
 = 
	`cuæ_ósy_öô
();

101 if(
cuæ
) {

106 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://99.99.99.99:9999");

109 if–(
sockfd
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0)Ë=
CURL_SOCKET_BAD
 ) {

110 
	`¥ötf
("Error creatingÜistening socket.\n");

114 
	`mem£t
(&
£rvaddr
, 0, (servaddr));

115 
£rvaddr
.
sö_Ámûy
 = 
AF_INET
;

116 
£rvaddr
.
sö_p‹t
 = 
	`ht⁄s
(
PORTNUM
);

118 i‡(
INADDR_NONE
 =(
£rvaddr
.
sö_addr
.
s_addr
 = 
	`öë_addr
(
IPADDR
)))

121 if(
	`c⁄√˘
(
sockfd
,(
sockaddr
 *Ë&
£rvaddr
, (servaddr)) ==

123 
	`˛o£
(
sockfd
);

124 
	`¥ötf
("˛õ¡Éº‹: c⁄√˘: %s\n", 
	`°ªº‹
(
î∫o
));

129 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_NOPROGRESS
, 1L);

132 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_d©a
);

135 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_OPENSOCKETFUNCTION
, 
›ísockë
);

136 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_OPENSOCKETDATA
, &
sockfd
);

139 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SOCKOPTFUNCTION
, 
sock›t_ˇŒback
);

141 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1);

143 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

145 
	`cuæ_ósy_˛ónup
(
cuæ
);

147 if(
ªs
) {

148 
	`¥ötf
("libcuæÉº‹: %d\n", 
ªs
);

153 
	}
}

	@docs/examples/fileupload.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

24 
	~<sys/°©.h
>

25 
	~<f˙é.h
>

27 
	$maö
()

29 
CURL
 *
cuæ
;

30 
CURLcode
 
ªs
;

31 
°©
 
fûe_öfo
;

32 
•ìd_u∂ﬂd
, 
tŸÆ_time
;

33 
FILE
 *
fd
;

35 
fd
 = 
	`f›í
("debugit", "rb");

36 if(!
fd
) {

42 if(
	`f°©
(
	`fûío
(
fd
), &
fûe_öfo
) != 0) {

47 
cuæ
 = 
	`cuæ_ósy_öô
();

48 if(
cuæ
) {

50 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
,

54 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

57 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, 
fd
);

60 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE_LARGE
,

61 (
cuæ_off_t
)
fûe_öfo
.
°_size
);

64 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

66 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

68 if(
ªs
 !
CURLE_OK
) {

69 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

70 
	`cuæ_ósy_°ªº‹
(
ªs
));

75 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_SPEED_UPLOAD
, &
•ìd_u∂ﬂd
);

76 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_TOTAL_TIME
, &
tŸÆ_time
);

78 
	`Ârötf
(
°dîr
, "Speed: %.3f bytes/sec during %.3f seconds\n",

79 
•ìd_u∂ﬂd
, 
tŸÆ_time
);

83 
	`cuæ_ósy_˛ónup
(
cuæ
);

86 
	}
}

	@docs/examples/fopen.c

46 
	~<°dio.h
>

47 
	~<°rög.h
>

48 #i‚de‡
WIN32


49 
	~<sys/time.h
>

51 
	~<°dlib.h
>

52 
	~<î∫o.h
>

54 
	~<cuæ/cuæ.h
>

56 
	efcuæ_ty≥_e
 {

57 
	mCFTYPE_NONE
=0,

58 
	mCFTYPE_FILE
=1,

59 
	mCFTYPE_CURL
=2

62 
	sfcuæ_d©a


64 
fcuæ_ty≥_e
 
	mty≥
;

66 
CURL
 *
	mcuæ
;

67 
FILE
 *
	mfûe
;

68 } 
	mh™dÀ
;

70 *
	mbuf„r
;

71 
size_t
 
	mbuf„r_Àn
;

72 
size_t
 
	mbuf„r_pos
;

73 
	m°ûl_ru¬ög
;

76 
fcuæ_d©a
 
	tURL_FILE
;

79 
URL_FILE
 *
uæ_f›í
(c⁄° *
uæ
,c⁄° *
›î©i⁄
);

80 
uæ_f˛o£
(
URL_FILE
 *
fûe
);

81 
uæ_„of
(
URL_FILE
 *
fûe
);

82 
size_t
 
uæ_‰ód
(*
±r
, size_à
size
, size_à
nmemb
, 
URL_FILE
 *
fûe
);

83 * 
uæ_fgës
(*
±r
, 
size_t
 
size
, 
URL_FILE
 *
fûe
);

84 
uæ_ªwöd
(
URL_FILE
 *
fûe
);

87 
CURLM
 *
	gmu…i_h™dÀ
;

90 
size_t
 
	$wrôe_ˇŒback
(*
buf„r
,

91 
size_t
 
size
,

92 
size_t
 
nôems
,

93 *
u£Ω
)

95 *
√wbuff
;

96 
size_t
 
ªmbuff
;

98 
URL_FILE
 *
uæ
 = (URL_FILE *)
u£Ω
;

99 
size
 *
nôems
;

101 
ªmbuff
=
uæ
->
buf„r_Àn
 - uæ->
buf„r_pos
;

103 if(
size
 > 
ªmbuff
) {

105 
√wbuff
=
	`ªÆloc
(
uæ
->
buf„r
,uæ->
buf„r_Àn
 + (
size
 - 
ªmbuff
));

106 if(
√wbuff
==
NULL
) {

107 
	`Ârötf
(
°dîr
,"callback buffer grow failed\n");

108 
size
=
ªmbuff
;

112 
uæ
->
buf„r_Àn
+=
size
 - 
ªmbuff
;

113 
uæ
->
buf„r
=
√wbuff
;

117 
	`mem˝y
(&
uæ
->
buf„r
[uæ->
buf„r_pos
], buf„r, 
size
);

118 
uæ
->
buf„r_pos
 +
size
;

120  
size
;

121 
	}
}

124 
	$fûl_buf„r
(
URL_FILE
 *
fûe
, 
size_t
 
w™t
)

126 
fd_£t
 
fdªad
;

127 
fd_£t
 
fdwrôe
;

128 
fd_£t
 
fdex˚p
;

129 
timevÆ
 
timeout
;

130 
rc
;

135 if((!
fûe
->
°ûl_ru¬ög
Ë|| (fûe->
buf„r_pos
 > 
w™t
))

140 
maxfd
 = -1;

141 
cuæ_timeo
 = -1;

143 
	`FD_ZERO
(&
fdªad
);

144 
	`FD_ZERO
(&
fdwrôe
);

145 
	`FD_ZERO
(&
fdex˚p
);

148 
timeout
.
tv_£c
 = 60;

149 
timeout
.
tv_u£c
 = 0;

151 
	`cuæ_mu…i_timeout
(
mu…i_h™dÀ
, &
cuæ_timeo
);

152 if(
cuæ_timeo
 >= 0) {

153 
timeout
.
tv_£c
 = 
cuæ_timeo
 / 1000;

154 if(
timeout
.
tv_£c
 > 1)

155 
timeout
.
tv_£c
 = 1;

157 
timeout
.
tv_u£c
 = (
cuæ_timeo
 % 1000) * 1000;

161 
	`cuæ_mu…i_fd£t
(
mu…i_h™dÀ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

169 
rc
 = 
	`£À˘
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

171 
rc
) {

179 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
fûe
->
°ûl_ru¬ög
);

182 } 
fûe
->
°ûl_ru¬ög
 && (fûe->
buf„r_pos
 < 
w™t
));

184 
	}
}

187 
	$u£_buf„r
(
URL_FILE
 *
fûe
,
w™t
)

190 if((
fûe
->
buf„r_pos
 - 
w™t
) <=0) {

192 if(
fûe
->
buf„r
)

193 
	`‰ì
(
fûe
->
buf„r
);

195 
fûe
->
buf„r
=
NULL
;

196 
fûe
->
buf„r_pos
=0;

197 
fûe
->
buf„r_Àn
=0;

201 
	`memmove
(
fûe
->
buf„r
,

202 &
fûe
->
buf„r
[
w™t
],

203 (
fûe
->
buf„r_pos
 - 
w™t
));

205 
fûe
->
buf„r_pos
 -
w™t
;

208 
	}
}

210 
URL_FILE
 *
	$uæ_f›í
(c⁄° *
uæ
,c⁄° *
›î©i⁄
)

215 
URL_FILE
 *
fûe
;

216 ()
›î©i⁄
;

218 
fûe
 = 
	`mÆloc
((
URL_FILE
));

219 if(!
fûe
)

220  
NULL
;

222 
	`mem£t
(
fûe
, 0, (
URL_FILE
));

224 if((
fûe
->
h™dÀ
.fûe=
	`f›í
(
uæ
,
›î©i⁄
)))

225 
fûe
->
ty≥
 = 
CFTYPE_FILE
;

228 
fûe
->
ty≥
 = 
CFTYPE_CURL
;

229 
fûe
->
h™dÀ
.
cuæ
 = 
	`cuæ_ósy_öô
();

231 
	`cuæ_ósy_£t›t
(
fûe
->
h™dÀ
.
cuæ
, 
CURLOPT_URL
, 
uæ
);

232 
	`cuæ_ósy_£t›t
(
fûe
->
h™dÀ
.
cuæ
, 
CURLOPT_WRITEDATA
, file);

233 
	`cuæ_ósy_£t›t
(
fûe
->
h™dÀ
.
cuæ
, 
CURLOPT_VERBOSE
, 0L);

234 
	`cuæ_ósy_£t›t
(
fûe
->
h™dÀ
.
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_ˇŒback
);

236 if(!
mu…i_h™dÀ
)

237 
mu…i_h™dÀ
 = 
	`cuæ_mu…i_öô
();

239 
	`cuæ_mu…i_add_h™dÀ
(
mu…i_h™dÀ
, 
fûe
->
h™dÀ
.
cuæ
);

242 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
fûe
->
°ûl_ru¬ög
);

244 if((
fûe
->
buf„r_pos
 =0Ë&& (!fûe->
°ûl_ru¬ög
)) {

248 
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…i_h™dÀ
, 
fûe
->
h™dÀ
.
cuæ
);

251 
	`cuæ_ósy_˛ónup
(
fûe
->
h™dÀ
.
cuæ
);

253 
	`‰ì
(
fûe
);

255 
fûe
 = 
NULL
;

258  
fûe
;

259 
	}
}

261 
	$uæ_f˛o£
(
URL_FILE
 *
fûe
)

263 
ªt
=0;

265 
fûe
->
ty≥
) {

266 
CFTYPE_FILE
:

267 
ªt
=
	`f˛o£
(
fûe
->
h™dÀ
.file);

270 
CFTYPE_CURL
:

272 
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…i_h™dÀ
, 
fûe
->
h™dÀ
.
cuæ
);

275 
	`cuæ_ósy_˛ónup
(
fûe
->
h™dÀ
.
cuæ
);

279 
ªt
=
EOF
;

280 
î∫o
=
EBADF
;

284 if(
fûe
->
buf„r
)

285 
	`‰ì
(
fûe
->
buf„r
);

287 
	`‰ì
(
fûe
);

289  
ªt
;

290 
	}
}

292 
	$uæ_„of
(
URL_FILE
 *
fûe
)

294 
ªt
=0;

296 
fûe
->
ty≥
) {

297 
CFTYPE_FILE
:

298 
ªt
=
	`„of
(
fûe
->
h™dÀ
.file);

301 
CFTYPE_CURL
:

302 if((
fûe
->
buf„r_pos
 =0Ë&& (!fûe->
°ûl_ru¬ög
))

303 
ªt
 = 1;

307 
ªt
=-1;

308 
î∫o
=
EBADF
;

311  
ªt
;

312 
	}
}

314 
size_t
 
	$uæ_‰ód
(*
±r
, 
size_t
 
size
, size_à
nmemb
, 
URL_FILE
 *
fûe
)

316 
size_t
 
w™t
;

318 
fûe
->
ty≥
) {

319 
CFTYPE_FILE
:

320 
w™t
=
	`‰ód
(
±r
,
size
,
nmemb
,
fûe
->
h™dÀ
.file);

323 
CFTYPE_CURL
:

324 
w™t
 = 
nmemb
 * 
size
;

326 
	`fûl_buf„r
(
fûe
,
w™t
);

330 if(!
fûe
->
buf„r_pos
)

334 if(
fûe
->
buf„r_pos
 < 
w™t
)

335 
w™t
 = 
fûe
->
buf„r_pos
;

338 
	`mem˝y
(
±r
, 
fûe
->
buf„r
, 
w™t
);

340 
	`u£_buf„r
(
fûe
,
w™t
);

342 
w™t
 = w™à/ 
size
;

346 
w™t
=0;

347 
î∫o
=
EBADF
;

351  
w™t
;

352 
	}
}

354 *
	$uæ_fgës
(*
±r
, 
size_t
 
size
, 
URL_FILE
 *
fûe
)

356 
size_t
 
w™t
 = 
size
 - 1;

357 
size_t
 
lo›
;

359 
fûe
->
ty≥
) {

360 
CFTYPE_FILE
:

361 
±r
 = 
	`fgës
’å,
size
,
fûe
->
h™dÀ
.file);

364 
CFTYPE_CURL
:

365 
	`fûl_buf„r
(
fûe
,
w™t
);

369 if(!
fûe
->
buf„r_pos
)

370  
NULL
;

373 if(
fûe
->
buf„r_pos
 < 
w™t
)

374 
w™t
 = 
fûe
->
buf„r_pos
;

378 
lo›
=0;lo› < 
w™t
;loop++) {

379 if(
fûe
->
buf„r
[
lo›
] == '\n') {

380 
w™t
=
lo›
+1;

386 
	`mem˝y
(
±r
, 
fûe
->
buf„r
, 
w™t
);

387 
±r
[
w™t
]=0;

389 
	`u£_buf„r
(
fûe
,
w™t
);

394 
±r
=
NULL
;

395 
î∫o
=
EBADF
;

399  
±r
;

400 
	}
}

402 
	$uæ_ªwöd
(
URL_FILE
 *
fûe
)

404 
fûe
->
ty≥
) {

405 
CFTYPE_FILE
:

406 
	`ªwöd
(
fûe
->
h™dÀ
.file);

409 
CFTYPE_CURL
:

411 
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…i_h™dÀ
, 
fûe
->
h™dÀ
.
cuæ
);

414 
	`cuæ_mu…i_add_h™dÀ
(
mu…i_h™dÀ
, 
fûe
->
h™dÀ
.
cuæ
);

417 if(
fûe
->
buf„r
)

418 
	`‰ì
(
fûe
->
buf„r
);

420 
fûe
->
buf„r
=
NULL
;

421 
fûe
->
buf„r_pos
=0;

422 
fûe
->
buf„r_Àn
=0;

429 
	}
}

434 
	$maö
(
¨gc
, *
¨gv
[])

436 
URL_FILE
 *
h™dÀ
;

437 
FILE
 *
outf
;

439 
ƒód
;

440 
buf„r
[256];

441 c⁄° *
uæ
;

443 if(
¨gc
 < 2)

444 
uæ
="http://192.168.7.3/testfile";

446 
uæ
=
¨gv
[1];

449 
outf
=
	`f›í
("fgets.test","w+");

450 if(!
outf
) {

451 
	`≥º‹
("couldn't open fgets output file\n");

455 
h™dÀ
 = 
	`uæ_f›í
(
uæ
, "r");

456 if(!
h™dÀ
) {

457 
	`¥ötf
("couldn'àuæ_f›í(Ë%s\n", 
uæ
);

458 
	`f˛o£
(
outf
);

462 !
	`uæ_„of
(
h™dÀ
)) {

463 
	`uæ_fgës
(
buf„r
,(buf„r),
h™dÀ
);

464 
	`fwrôe
(
buf„r
,1,
	`°æí
(buf„r),
outf
);

467 
	`uæ_f˛o£
(
h™dÀ
);

469 
	`f˛o£
(
outf
);

473 
outf
=
	`f›í
("fread.test","w+");

474 if(!
outf
) {

475 
	`≥º‹
("couldn't open fread output file\n");

479 
h™dÀ
 = 
	`uæ_f›í
("testfile", "r");

480 if(!
h™dÀ
) {

481 
	`¥ötf
("couldn't url_fopen()Åestfile\n");

482 
	`f˛o£
(
outf
);

487 
ƒód
 = 
	`uæ_‰ód
(
buf„r
, 1,(buf„r), 
h™dÀ
);

488 
	`fwrôe
(
buf„r
,1,
ƒód
,
outf
);

489 } 
ƒód
);

491 
	`uæ_f˛o£
(
h™dÀ
);

493 
	`f˛o£
(
outf
);

497 
outf
=
	`f›í
("rewind.test","w+");

498 if(!
outf
) {

499 
	`≥º‹
("couldn't open fread output file\n");

503 
h™dÀ
 = 
	`uæ_f›í
("testfile", "r");

504 if(!
h™dÀ
) {

505 
	`¥ötf
("couldn't url_fopen()Åestfile\n");

506 
	`f˛o£
(
outf
);

510 
ƒód
 = 
	`uæ_‰ód
(
buf„r
, 1,(buf„r), 
h™dÀ
);

511 
	`fwrôe
(
buf„r
,1,
ƒód
,
outf
);

512 
	`uæ_ªwöd
(
h™dÀ
);

514 
buf„r
[0]='\n';

515 
	`fwrôe
(
buf„r
,1,1,
outf
);

517 
ƒód
 = 
	`uæ_‰ód
(
buf„r
, 1,(buf„r), 
h™dÀ
);

518 
	`fwrôe
(
buf„r
,1,
ƒód
,
outf
);

521 
	`uæ_f˛o£
(
h™dÀ
);

523 
	`f˛o£
(
outf
);

527 
	}
}

	@docs/examples/ftp-wildcard.c

22 
	~<cuæ/cuæ.h
>

23 
	~<°dio.h
>

25 
	sˇŒback_d©a
 {

26 
FILE
 *
	mouçut
;

29 
fûe_is_commög
(
cuæ_fûeöfo
 *
föfo
,

30 
ˇŒback_d©a
 *
d©a
,

31 
ªmaös
);

33 
fûe_is_dow∆ﬂded
(
ˇŒback_d©a
 *
d©a
);

35 
size_t
 
wrôe_ô
(*
buff
, size_à
size
, size_à
nmemb
,

36 *
cb_d©a
);

38 
	$maö
(
¨gc
, **
¨gv
)

40 
rc
 = 
CURLE_OK
;

43 
CURL
 *
h™dÀ
;

46 
ˇŒback_d©a
 
d©a
 = { 0 };

49 
rc
 = 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

50 if(
rc
)

51  
rc
;

54 
h™dÀ
 = 
	`cuæ_ósy_öô
();

55 if(!
h™dÀ
) {

56 
	`cuæ_globÆ_˛ónup
();

57  
CURLE_OUT_OF_MEMORY
;

61 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
CURLOPT_WILDCARDMATCH
, 1L);

64 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
CURLOPT_CHUNK_BGN_FUNCTION
, 
fûe_is_commög
);

67 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
CURLOPT_CHUNK_END_FUNCTION
, 
fûe_is_dow∆ﬂded
);

70 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_ô
);

73 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
CURLOPT_CHUNK_DATA
, &
d©a
);

74 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
CURLOPT_WRITEDATA
, &
d©a
);

79 if(
¨gc
 == 2)

80 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
CURLOPT_URL
, 
¨gv
[1]);

82 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
CURLOPT_URL
, "ftp://example.com/test/*");

85 
rc
 = 
	`cuæ_ósy_≥rf‹m
(
h™dÀ
);

87 
	`cuæ_ósy_˛ónup
(
h™dÀ
);

88 
	`cuæ_globÆ_˛ónup
();

89  
rc
;

90 
	}
}

92 
	$fûe_is_commög
(
cuæ_fûeöfo
 *
föfo
,

93 
ˇŒback_d©a
 *
d©a
,

94 
ªmaös
)

96 
	`¥ötf
("%3d %40†%10luB ", 
ªmaös
, 
föfo
->
fûíame
,

97 ()
föfo
->
size
);

99 
föfo
->
fûëy≥
) {

100 
CURLFILETYPE_DIRECTORY
:

101 
	`¥ötf
(" DIR\n");

103 
CURLFILETYPE_FILE
:

104 
	`¥ötf
("FILE ");

107 
	`¥ötf
("OTHER\n");

111 if(
föfo
->
fûëy≥
 =
CURLFILETYPE_FILE
) {

113 if(
föfo
->
size
 > 50) {

114 
	`¥ötf
("SKIPPED\n");

115  
CURL_CHUNK_BGN_FUNC_SKIP
;

118 
d©a
->
ouçut
 = 
	`f›í
(
föfo
->
fûíame
, "w");

119 if(!
d©a
->
ouçut
) {

120  
CURL_CHUNK_BGN_FUNC_FAIL
;

124  
CURL_CHUNK_BGN_FUNC_OK
;

125 
	}
}

127 
	$fûe_is_dow∆ﬂded
(
ˇŒback_d©a
 *
d©a
)

129 if(
d©a
->
ouçut
) {

130 
	`¥ötf
("DOWNLOADED\n");

131 
	`f˛o£
(
d©a
->
ouçut
);

132 
d©a
->
ouçut
 = 0x0;

134  
CURL_CHUNK_END_FUNC_OK
;

135 
	}
}

137 
size_t
 
	$wrôe_ô
(*
buff
, 
size_t
 
size
, size_à
nmemb
,

138 *
cb_d©a
)

140 
ˇŒback_d©a
 *
d©a
 = 
cb_d©a
;

141 
size_t
 
wrôãn
 = 0;

142 if(
d©a
->
ouçut
)

143 
wrôãn
 = 
	`fwrôe
(
buff
, 
size
, 
nmemb
, 
d©a
->
ouçut
);

146 
wrôãn
 = 
	`fwrôe
(
buff
, 
size
, 
nmemb
, 
°dout
);

147  
wrôãn
;

148 
	}
}

	@docs/examples/ftpget.c

22 
	~<°dio.h
>

24 
	~<cuæ/cuæ.h
>

33 
	sFçFûe
 {

34 c⁄° *
	mfûíame
;

35 
FILE
 *
	m°ªam
;

38 
size_t
 
	$my_fwrôe
(*
buf„r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

40 
FçFûe
 *
out
=(FçFûê*)
°ªam
;

41 if(
out
 && !out->
°ªam
) {

43 
out
->
°ªam
=
	`f›í
(out->
fûíame
, "wb");

44 if(!
out
->
°ªam
)

47  
	`fwrôe
(
buf„r
, 
size
, 
nmemb
, 
out
->
°ªam
);

48 
	}
}

51 
	$maö
()

53 
CURL
 *
cuæ
;

54 
CURLcode
 
ªs
;

55 
FçFûe
 
·pfûe
={

57 
NULL


60 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

62 
cuæ
 = 
	`cuæ_ósy_öô
();

63 if(
cuæ
) {

67 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
,

70 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
my_fwrôe
);

72 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, &
·pfûe
);

75 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

77 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

80 
	`cuæ_ósy_˛ónup
(
cuæ
);

82 if(
CURLE_OK
 !
ªs
) {

84 
	`Ârötf
(
°dîr
, "cuæÅﬁd u†%d\n", 
ªs
);

88 if(
·pfûe
.
°ªam
)

89 
	`f˛o£
(
·pfûe
.
°ªam
);

91 
	`cuæ_globÆ_˛ónup
();

94 
	}
}

	@docs/examples/ftpgetinfo.c

22 
	~<°dio.h
>

23 
	~<°rög.h
>

25 
	~<cuæ/cuæ.h
>

32 
size_t
 
	$throw_away
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
d©a
)

34 ()
±r
;

35 ()
d©a
;

38  (
size_t
)(
size
 * 
nmemb
);

39 
	}
}

41 
	$maö
()

43 
·puæ
[] = "ftp://ftp.example.com/gnu/binutils/binutils-2.19.1.tar.bz2";

44 
CURL
 *
cuæ
;

45 
CURLcode
 
ªs
;

46 
fûëime
 = -1;

47 
fûesize
 = 0.0;

48 c⁄° *
fûíame
 = 
	`°ºchr
(
·puæ
, '/') + 1;

50 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

52 
cuæ
 = 
	`cuæ_ósy_öô
();

53 if(
cuæ
) {

54 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
·puæ
);

56 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_NOBODY
, 1L);

58 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_FILETIME
, 1L);

60 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HEADERFUNCTION
, 
throw_away
);

61 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 0L);

65 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

67 if(
CURLE_OK
 =
ªs
) {

69 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_FILETIME
, &
fûëime
);

70 if((
CURLE_OK
 =
ªs
Ë&& (
fûëime
 >= 0)) {

71 
time_t
 
fûe_time
 = (time_t)
fûëime
;

72 
	`¥ötf
("fûëimê%s: %s", 
fûíame
, 
	`˘ime
(&
fûe_time
));

74 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_CONTENT_LENGTH_DOWNLOAD
, &
fûesize
);

75 if((
CURLE_OK
 =
ªs
Ë&& (
fûesize
>0.0))

76 
	`¥ötf
("fûesizê%s: %0.0‡byãs\n", 
fûíame
, 
fûesize
);

79 
	`Ârötf
(
°dîr
, "cuæÅﬁd u†%d\n", 
ªs
);

83 
	`cuæ_ósy_˛ónup
(
cuæ
);

86 
	`cuæ_globÆ_˛ónup
();

89 
	}
}

	@docs/examples/ftpgetresp.c

22 
	~<°dio.h
>

24 
	~<cuæ/cuæ.h
>

33 
size_t


34 
	$wrôe_ª•⁄£
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
d©a
)

36 
FILE
 *
wrôehîe
 = (FILE *)
d©a
;

37  
	`fwrôe
(
±r
, 
size
, 
nmemb
, 
wrôehîe
);

38 
	}
}

40 
	$maö
()

42 
CURL
 *
cuæ
;

43 
CURLcode
 
ªs
;

44 
FILE
 *
·pfûe
;

45 
FILE
 *
ª•fûe
;

48 
·pfûe
 = 
	`f›í
("ftp-list", "wb");

51 
ª•fûe
 = 
	`f›í
("ftp-responses", "wb");

53 
cuæ
 = 
	`cuæ_ósy_öô
();

54 if(
cuæ
) {

56 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "ftp://ftp.example.com/");

57 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
·pfûe
);

60 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HEADERFUNCTION
, 
wrôe_ª•⁄£
);

61 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HEADERDATA
, 
ª•fûe
);

62 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

64 if(
ªs
 !
CURLE_OK
)

65 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

66 
	`cuæ_ósy_°ªº‹
(
ªs
));

69 
	`cuæ_ósy_˛ónup
(
cuæ
);

72 
	`f˛o£
(
·pfûe
);

73 
	`f˛o£
(
ª•fûe
);

76 
	}
}

	@docs/examples/ftpsget.c

23 
	~<°dio.h
>

25 
	~<cuæ/cuæ.h
>

34 
	sFçFûe
 {

35 c⁄° *
	mfûíame
;

36 
FILE
 *
	m°ªam
;

39 
size_t
 
	$my_fwrôe
(*
buf„r
, 
size_t
 
size
, size_à
nmemb
,

40 *
°ªam
)

42 
FçFûe
 *
out
=(FçFûê*)
°ªam
;

43 if(
out
 && !out->
°ªam
) {

45 
out
->
°ªam
=
	`f›í
(out->
fûíame
, "wb");

46 if(!
out
->
°ªam
)

49  
	`fwrôe
(
buf„r
, 
size
, 
nmemb
, 
out
->
°ªam
);

50 
	}
}

53 
	$maö
()

55 
CURL
 *
cuæ
;

56 
CURLcode
 
ªs
;

57 
FçFûe
 
·pfûe
={

59 
NULL


62 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

64 
cuæ
 = 
	`cuæ_ósy_öô
();

65 if(
cuæ
) {

71 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
,

74 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
my_fwrôe
);

76 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, &
·pfûe
);

79 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USE_SSL
, 
CURLUSESSL_ALL
);

82 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

84 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

87 
	`cuæ_ósy_˛ónup
(
cuæ
);

89 if(
CURLE_OK
 !
ªs
) {

91 
	`Ârötf
(
°dîr
, "cuæÅﬁd u†%d\n", 
ªs
);

95 if(
·pfûe
.
°ªam
)

96 
	`f˛o£
(
·pfûe
.
°ªam
);

98 
	`cuæ_globÆ_˛ónup
();

101 
	}
}

	@docs/examples/ftpupload.c

22 
	~<°dio.h
>

23 
	~<°rög.h
>

25 
	~<cuæ/cuæ.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<sys/°©.h
>

28 
	~<f˙é.h
>

29 
	~<î∫o.h
>

30 #ifde‡
WIN32


31 
	~<io.h
>

33 
	~<uni°d.h
>

43 
	#LOCAL_FILE
 "/tmp/u∂ﬂdthis.txt"

	)

44 
	#UPLOAD_FILE_AS
 "whûe-u∂ﬂdög.txt"

	)

45 
	#REMOTE_URL
 "·p://exam∂e.com/" 
UPLOAD_FILE_AS


	)

46 
	#RENAME_FILE_TO
 "ª«med-™d-föe.txt"

	)

52 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

54 
cuæ_off_t
 
ƒód
;

58 
size_t
 
ªtcode
 = 
	`‰ód
(
±r
, 
size
, 
nmemb
, 
°ªam
);

60 
ƒód
 = (
cuæ_off_t
)
ªtcode
;

62 
	`Ârötf
(
°dîr
, "*** Wêªad %" 
CURL_FORMAT_CURL_OFF_T


63 " byã†‰om fûe\n", 
ƒód
);

64  
ªtcode
;

65 
	}
}

67 
	$maö
()

69 
CURL
 *
cuæ
;

70 
CURLcode
 
ªs
;

71 
FILE
 *
hd_§c
;

72 
°©
 
fûe_öfo
;

73 
cuæ_off_t
 
fsize
;

75 
cuæ_¶i°
 *
hódîli°
=
NULL
;

76 c⁄° 
buf_1
 [] = "RNFR " 
UPLOAD_FILE_AS
;

77 c⁄° 
buf_2
 [] = "RNTO " 
RENAME_FILE_TO
;

80 if(
	`°©
(
LOCAL_FILE
, &
fûe_öfo
)) {

81 
	`¥ötf
("Could¡ o≥¿'%s': %s\n", 
LOCAL_FILE
, 
	`°ªº‹
(
î∫o
));

84 
fsize
 = (
cuæ_off_t
)
fûe_öfo
.
°_size
;

86 
	`¥ötf
("Loˇ»fûêsize: %" 
CURL_FORMAT_CURL_OFF_T
 " byãs.\n", 
fsize
);

89 
hd_§c
 = 
	`f›í
(
LOCAL_FILE
, "rb");

92 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

95 
cuæ
 = 
	`cuæ_ósy_öô
();

96 if(
cuæ
) {

98 
hódîli°
 = 
	`cuæ_¶i°_≠≥nd
(hódîli°, 
buf_1
);

99 
hódîli°
 = 
	`cuæ_¶i°_≠≥nd
(hódîli°, 
buf_2
);

102 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

105 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

108 
	`cuæ_ósy_£t›t
(
cuæ
,
CURLOPT_URL
, 
REMOTE_URL
);

111 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_POSTQUOTE
, 
hódîli°
);

114 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, 
hd_§c
);

120 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE_LARGE
,

121 (
cuæ_off_t
)
fsize
);

124 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

126 if(
ªs
 !
CURLE_OK
)

127 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

128 
	`cuæ_ósy_°ªº‹
(
ªs
));

131 
	`cuæ_¶i°_‰ì_Æl
 (
hódîli°
);

134 
	`cuæ_ósy_˛ónup
(
cuæ
);

136 
	`f˛o£
(
hd_§c
);

138 
	`cuæ_globÆ_˛ónup
();

140 
	}
}

	@docs/examples/ftpuploadresume.c

31 
	~<°dlib.h
>

32 
	~<°dio.h
>

34 
	~<cuæ/cuæ.h
>

36 #i‡
deföed
(
_MSC_VER
) && (_MSC_VER < 1300)

37 #îr‹ 
_¢sˇnf
 
ªquúes
 
MSVC
 7.0 
‹
 
œãr
.

42 #i‡
deföed
(
__MINGW32__
Ë&& !deföed(
__MINGW64__
)

43 
__cde˛
 
_¢sˇnf
(c⁄° * 
öput
, 
size_t
 
Àngth
, c⁄° * 
f‹m©
, ...);

48 
size_t
 
	$gëc⁄ã¡Àngthfunc
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

50 
r
;

51 
Àn
 = 0;

54 
r
 = 
	`_¢sˇnf
(
±r
, 
size
 * 
nmemb
, "C⁄ã¡-Lígth: %ld\n", &
Àn
);

56 i‡(
r
)

57 *((*Ë
°ªam
Ë
Àn
;

59  
size
 * 
nmemb
;

60 
	}
}

63 
size_t
 
	$disˇrdfunc
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

65  
size
 * 
nmemb
;

66 
	}
}

69 
size_t
 
	$ªadfunc
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

71 
FILE
 *
f
 = 
°ªam
;

72 
size_t
 
n
;

74 i‡(
	`„º‹
(
f
))

75  
CURL_READFUNC_ABORT
;

77 
n
 = 
	`‰ód
(
±r
, 
size
, 
nmemb
, 
f
) * size;

79  
n
;

80 
	}
}

83 
	$u∂ﬂd
(
CURL
 *
cuæh™dÀ
, c⁄° * 
ªmŸï©h
, c⁄° * 
loˇÕ©h
,

84 
timeout
, 
åõs
)

86 
FILE
 *
f
;

87 
u∂ﬂded_Àn
 = 0;

88 
CURLcode
 
r
 = 
CURLE_GOT_NOTHING
;

89 
c
;

91 
f
 = 
	`f›í
(
loˇÕ©h
, "rb");

92 i‡(
f
 =
NULL
) {

93 
	`≥º‹
(
NULL
);

97 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_UPLOAD
, 1L);

99 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_URL
, 
ªmŸï©h
);

101 i‡(
timeout
)

102 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_FTP_RESPONSE_TIMEOUT
, 
timeout
);

104 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_HEADERFUNCTION
, 
gëc⁄ã¡Àngthfunc
);

105 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_HEADERDATA
, &
u∂ﬂded_Àn
);

107 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_WRITEFUNCTION
, 
disˇrdfunc
);

109 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_READFUNCTION
, 
ªadfunc
);

110 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_READDATA
, 
f
);

112 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_FTPPORT
, "-");

113 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_FTP_CREATE_MISSING_DIRS
, 1L);

115 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_VERBOSE
, 1L);

117 
c
 = 0; (
r
 !
CURLE_OK
Ë&& (¯< 
åõs
); c++) {

119 i‡(
c
) {

130 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_NOBODY
, 1L);

131 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_HEADER
, 1L);

133 
r
 = 
	`cuæ_ósy_≥rf‹m
(
cuæh™dÀ
);

134 i‡(
r
 !
CURLE_OK
)

137 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_NOBODY
, 0L);

138 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_HEADER
, 0L);

140 
	`f£ek
(
f
, 
u∂ﬂded_Àn
, 
SEEK_SET
);

142 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_APPEND
, 1L);

145 
	`cuæ_ósy_£t›t
(
cuæh™dÀ
, 
CURLOPT_APPEND
, 0L);

148 
r
 = 
	`cuæ_ósy_≥rf‹m
(
cuæh™dÀ
);

151 
	`f˛o£
(
f
);

153 i‡(
r
 =
CURLE_OK
)

156 
	`Ârötf
(
°dîr
, "%s\n", 
	`cuæ_ósy_°ªº‹
(
r
));

159 
	}
}

161 
	$maö
(
c
, **
¨gv
)

163 
CURL
 *
cuæh™dÀ
 = 
NULL
;

165 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

166 
cuæh™dÀ
 = 
	`cuæ_ósy_öô
();

168 
	`u∂ﬂd
(
cuæh™dÀ
, "ftp://user:pass@example.com/path/file", "C:\\file", 0, 3);

170 
	`cuæ_ósy_˛ónup
(
cuæh™dÀ
);

171 
	`cuæ_globÆ_˛ónup
();

174 
	}
}

	@docs/examples/getinfo.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

25 
	$maö
()

27 
CURL
 *
cuæ
;

28 
CURLcode
 
ªs
;

31 
cuæ
 = 
	`cuæ_ósy_öô
();

32 if(
cuæ
) {

34 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://www.example.com/");

36 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

38 if(
CURLE_OK
 =
ªs
) {

39 *
˘
;

42 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_CONTENT_TYPE
, &
˘
);

44 if((
CURLE_OK
 =
ªs
Ë&& 
˘
)

45 
	`¥ötf
("Wêª˚ived C⁄ã¡-Ty≥: %s\n", 
˘
);

50 
	`cuæ_ósy_˛ónup
(
cuæ
);

53 
	}
}

	@docs/examples/getinmemory.c

26 
	~<°dio.h
>

27 
	~<°dlib.h
>

28 
	~<°rög.h
>

30 
	~<cuæ/cuæ.h
>

32 
	sMem‹ySåu˘
 {

33 *
	mmem‹y
;

34 
size_t
 
	msize
;

38 
size_t


39 
	$WrôeMem‹yCÆlback
(*
c⁄ã¡s
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

41 
size_t
 
ªÆsize
 = 
size
 * 
nmemb
;

42 
Mem‹ySåu˘
 *
mem
 = (Mem‹ySåu˘ *)
u£Ω
;

44 
mem
->
mem‹y
 = 
	`ªÆloc
(mem->mem‹y, mem->
size
 + 
ªÆsize
 + 1);

45 if(
mem
->
mem‹y
 =
NULL
) {

47 
	`¥ötf
("notÉnough memory (reallocÑeturned NULL)\n");

51 
	`mem˝y
(&(
mem
->
mem‹y
[mem->
size
]), 
c⁄ã¡s
, 
ªÆsize
);

52 
mem
->
size
 +
ªÆsize
;

53 
mem
->
mem‹y
[mem->
size
] = 0;

55  
ªÆsize
;

56 
	}
}

59 
	$maö
()

61 
CURL
 *
cuæ_h™dÀ
;

62 
CURLcode
 
ªs
;

64 
Mem‹ySåu˘
 
chunk
;

66 
chunk
.
mem‹y
 = 
	`mÆloc
(1);

67 
chunk
.
size
 = 0;

69 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

72 
cuæ_h™dÀ
 = 
	`cuæ_ósy_öô
();

75 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_URL
, "http://www.example.com/");

78 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_WRITEFUNCTION
, 
WrôeMem‹yCÆlback
);

81 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_WRITEDATA
, (*)&
chunk
);

85 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_USERAGENT
, "libcurl-agent/1.0");

88 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ_h™dÀ
);

91 if(
ªs
 !
CURLE_OK
) {

92 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

93 
	`cuæ_ósy_°ªº‹
(
ªs
));

103 
	`¥ötf
("%lu byã†ªåõved\n", ()
chunk
.
size
);

107 
	`cuæ_ósy_˛ónup
(
cuæ_h™dÀ
);

109 if(
chunk
.
mem‹y
)

110 
	`‰ì
(
chunk
.
mem‹y
);

113 
	`cuæ_globÆ_˛ónup
();

116 
	}
}

	@docs/examples/ghiper.c

54 
	~<glib.h
>

55 
	~<sys/°©.h
>

56 
	~<uni°d.h
>

57 
	~<f˙é.h
>

58 
	~<°dlib.h
>

59 
	~<°dio.h
>

60 
	~<î∫o.h
>

61 
	~<cuæ/cuæ.h
>

64 
	#MSG_OUT
 
g_¥öt


	)

65 
	#SHOW_VERBOSE
 0

	)

66 
	#SHOW_PROGRESS
 0

	)

71 
	s_GlobÆInfo
 {

72 
CURLM
 *
	mmu…i
;

73 
guöt
 
	mtimî_evít
;

74 
	m°ûl_ru¬ög
;

75 } 
	tGlobÆInfo
;

80 
	s_C⁄nInfo
 {

81 
CURL
 *
	mósy
;

82 *
	muæ
;

83 
GlobÆInfo
 *
	mglobÆ
;

84 
	mîr‹
[
CURL_ERROR_SIZE
];

85 } 
	tC⁄nInfo
;

89 
	s_SockInfo
 {

90 
cuæ_sockë_t
 
	msockfd
;

91 
CURL
 *
	mósy
;

92 
	ma˘i⁄
;

93 
	mtimeout
;

94 
GIOCh™√l
 *
	mch
;

95 
guöt
 
	mev
;

96 
GlobÆInfo
 *
	mglobÆ
;

97 } 
	tSockInfo
;

103 
	$mcode_‹_dõ
(c⁄° *
whîe
, 
CURLMcode
 
code
) {

104 i‡–
CURLM_OK
 !
code
 ) {

105 c⁄° *
s
;

106 
code
) {

107 
CURLM_BAD_HANDLE
: 
s
="CURLM_BAD_HANDLE"; ;

108 
CURLM_BAD_EASY_HANDLE
: 
s
="CURLM_BAD_EASY_HANDLE"; ;

109 
CURLM_OUT_OF_MEMORY
: 
s
="CURLM_OUT_OF_MEMORY"; ;

110 
CURLM_INTERNAL_ERROR
: 
s
="CURLM_INTERNAL_ERROR"; ;

111 
CURLM_BAD_SOCKET
: 
s
="CURLM_BAD_SOCKET"; ;

112 
CURLM_UNKNOWN_OPTION
: 
s
="CURLM_UNKNOWN_OPTION"; ;

113 
CURLM_LAST
: 
s
="CURLM_LAST"; ;

114 : 
s
="CURLM_unknown";

116 
	`MSG_OUT
("ERROR: %†ªtu∫†%s\n", 
whîe
, 
s
);

117 
	`exô
(
code
);

119 
	}
}

124 
	$check_mu…i_öfo
(
GlobÆInfo
 *
g
)

126 *
eff_uæ
;

127 
CURLMsg
 *
msg
;

128 
msgs_À·
;

129 
C⁄nInfo
 *
c⁄n
;

130 
CURL
 *
ósy
;

131 
CURLcode
 
ªs
;

133 
	`MSG_OUT
("REMAINING: %d\n", 
g
->
°ûl_ru¬ög
);

134 (
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
g
->
mu…i
, &
msgs_À·
))) {

135 i‡(
msg
->msg =
CURLMSG_DONE
) {

136 
ósy
 = 
msg
->
ósy_h™dÀ
;

137 
ªs
 = 
msg
->
d©a
.
ªsu…
;

138 
	`cuæ_ósy_gëöfo
(
ósy
, 
CURLINFO_PRIVATE
, &
c⁄n
);

139 
	`cuæ_ósy_gëöfo
(
ósy
, 
CURLINFO_EFFECTIVE_URL
, &
eff_uæ
);

140 
	`MSG_OUT
("DONE: %†=> (%dË%s\n", 
eff_uæ
, 
ªs
, 
c⁄n
->
îr‹
);

141 
	`cuæ_mu…i_ªmove_h™dÀ
(
g
->
mu…i
, 
ósy
);

142 
	`‰ì
(
c⁄n
->
uæ
);

143 
	`cuæ_ósy_˛ónup
(
ósy
);

144 
	`‰ì
(
c⁄n
);

147 
	}
}

152 
gboﬁón
 
	$timî_cb
(
gpoöãr
 
d©a
)

154 
GlobÆInfo
 *
g
 = (GlobÆInfÿ*)
d©a
;

155 
CURLMcode
 
rc
;

157 
rc
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
g
->
mu…i
,

158 
CURL_SOCKET_TIMEOUT
, 0, &
g
->
°ûl_ru¬ög
);

159 
	`mcode_‹_dõ
("timî_cb: cuæ_mu…i_sockë_a˘i⁄", 
rc
);

160 
	`check_mu…i_öfo
(
g
);

161  
FALSE
;

162 
	}
}

167 
	$upd©e_timeout_cb
(
CURLM
 *
mu…i
, 
timeout_ms
, *
u£Ω
)

169 
timevÆ
 
timeout
;

170 
GlobÆInfo
 *
g
=(GlobÆInfÿ*)
u£Ω
;

171 
timeout
.
tv_£c
 = 
timeout_ms
/1000;

172 
timeout
.
tv_u£c
 = (
timeout_ms
%1000)*1000;

174 
	`MSG_OUT
("*** update_timeout_cb %ld => %ld:%ld ***\n",

175 
timeout_ms
, 
timeout
.
tv_£c
,Åimeout.
tv_u£c
);

177 
g
->
timî_evít
 = 
	`g_timeout_add
(
timeout_ms
, 
timî_cb
, g);

179 
	}
}

185 
gboﬁón
 
	$evít_cb
(
GIOCh™√l
 *
ch
, 
GIOC⁄dôi⁄
 
c⁄dôi⁄
, 
gpoöãr
 
d©a
)

187 
GlobÆInfo
 *
g
 = (GlobÆInfo*Ë
d©a
;

188 
CURLMcode
 
rc
;

189 
fd
=
	`g_io_ch™√l_unix_gë_fd
(
ch
);

191 
a˘i⁄
 =

192 (
c⁄dôi⁄
 & 
G_IO_IN
 ? 
CURL_CSELECT_IN
 : 0) |

193 (
c⁄dôi⁄
 & 
G_IO_OUT
 ? 
CURL_CSELECT_OUT
 : 0);

195 
rc
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
g
->
mu…i
, 
fd
, 
a˘i⁄
, &g->
°ûl_ru¬ög
);

196 
	`mcode_‹_dõ
("evít_cb: cuæ_mu…i_sockë_a˘i⁄", 
rc
);

198 
	`check_mu…i_öfo
(
g
);

199 if(
g
->
°ûl_ru¬ög
) {

200  
TRUE
;

202 
	`MSG_OUT
("lastÅransfer done, killÅimeout\n");

203 i‡(
g
->
timî_evít
Ë{ 
	`g_sour˚_ªmove
(g->timer_event); }

204  
FALSE
;

206 
	}
}

211 
	$ªmsock
(
SockInfo
 *
f
)

213 i‡(!
f
) { ; }

214 i‡(
f
->
ev
Ë{ 
	`g_sour˚_ªmove
(f->ev); }

215 
	`g_‰ì
(
f
);

216 
	}
}

221 
	$£tsock
(
SockInfo
*
f
, 
cuæ_sockë_t
 
s
, 
CURL
*
e
, 
a˘
, 
GlobÆInfo
*
g
)

223 
GIOC⁄dôi⁄
 
köd
 =

224 (
a˘
&
CURL_POLL_IN
?
G_IO_IN
:0)|◊˘&
CURL_POLL_OUT
?
G_IO_OUT
:0);

226 
f
->
sockfd
 = 
s
;

227 
f
->
a˘i⁄
 = 
a˘
;

228 
f
->
ósy
 = 
e
;

229 i‡(
f
->
ev
Ë{ 
	`g_sour˚_ªmove
(f->ev); }

230 
f
->
ev
=
	`g_io_add_w©ch
(f->
ch
, 
köd
, 
evít_cb
,
g
);

232 
	}
}

237 
	$addsock
(
cuæ_sockë_t
 
s
, 
CURL
 *
ósy
, 
a˘i⁄
, 
GlobÆInfo
 *
g
)

239 
SockInfo
 *
fdp
 = 
	`g_mÆloc0
((SockInfo));

241 
fdp
->
globÆ
 = 
g
;

242 
fdp
->
ch
=
	`g_io_ch™√l_unix_√w
(
s
);

243 
	`£tsock
(
fdp
, 
s
, 
ósy
, 
a˘i⁄
, 
g
);

244 
	`cuæ_mu…i_assign
(
g
->
mu…i
, 
s
, 
fdp
);

245 
	}
}

250 
	$sock_cb
(
CURL
 *
e
, 
cuæ_sockë_t
 
s
, 
wh©
, *
cbp
, *
sockp
)

252 
GlobÆInfo
 *
g
 = (GlobÆInfo*Ë
cbp
;

253 
SockInfo
 *
fdp
 = (SockInfo*Ë
sockp
;

254 c⁄° *
wh©°r
[]={ "none", "IN", "OUT", "INOUT", "REMOVE" };

256 
	`MSG_OUT
("sockë cÆlback: s=%dÉ=%∞wh©=%†", 
s
, 
e
, 
wh©°r
[
wh©
]);

257 i‡(
wh©
 =
CURL_POLL_REMOVE
) {

258 
	`MSG_OUT
("\n");

259 
	`ªmsock
(
fdp
);

261 i‡(!
fdp
) {

262 
	`MSG_OUT
("Adding data: %s%s\n",

263 
wh©
&
CURL_POLL_IN
?"READ":"",

264 
wh©
&
CURL_POLL_OUT
?"WRITE":"" );

265 
	`addsock
(
s
, 
e
, 
wh©
, 
g
);

268 
	`MSG_OUT
(

269 "Ch™gögá˘i⁄ from %dÅÿ%d\n", 
fdp
->
a˘i⁄
, 
wh©
);

270 
	`£tsock
(
fdp
, 
s
, 
e
, 
wh©
, 
g
);

274 
	}
}

279 
size_t
 
	$wrôe_cb
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
d©a
)

281 
size_t
 
ªÆsize
 = 
size
 * 
nmemb
;

282 
C⁄nInfo
 *
c⁄n
 = (C⁄nInfo*Ë
d©a
;

283 ()
±r
;

284 ()
c⁄n
;

285  
ªÆsize
;

286 
	}
}

291 
	$¥og_cb
 (*
p
, 
d…ŸÆ
, 
d ow
, 
u…
, 
u 
)

293 
C⁄nInfo
 *
c⁄n
 = (C⁄nInfÿ*)
p
;

294 
	`MSG_OUT
("Progªss: %†(%g/%g)\n", 
c⁄n
->
uæ
, 
d ow
, 
d…ŸÆ
);

296 
	}
}

301 
	$√w_c⁄n
(*
uæ
, 
GlobÆInfo
 *
g
 )

303 
C⁄nInfo
 *
c⁄n
;

304 
CURLMcode
 
rc
;

306 
c⁄n
 = 
	`g_mÆloc0
((
C⁄nInfo
));

308 
c⁄n
->
îr‹
[0]='\0';

310 
c⁄n
->
ósy
 = 
	`cuæ_ósy_öô
();

311 i‡(!
c⁄n
->
ósy
) {

312 
	`MSG_OUT
("curl_easy_init() failed,Éxiting!\n");

313 
	`exô
(2);

315 
c⁄n
->
globÆ
 = 
g
;

316 
c⁄n
->
uæ
 = 
	`g_°rdup
(url);

317 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_URL
, c⁄n->
uæ
);

318 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_cb
);

319 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_WRITEDATA
, &conn);

320 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_VERBOSE
, ()
SHOW_VERBOSE
);

321 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_ERRORBUFFER
, c⁄n->
îr‹
);

322 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PRIVATE
, conn);

323 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_NOPROGRESS
, 
SHOW_PROGRESS
?0L:1L);

324 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PROGRESSFUNCTION
, 
¥og_cb
);

325 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PROGRESSDATA
, conn);

326 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_FOLLOWLOCATION
, 1L);

327 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_CONNECTTIMEOUT
, 30L);

328 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_LOW_SPEED_LIMIT
, 1L);

329 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_LOW_SPEED_TIME
, 30L);

331 
	`MSG_OUT
("AddögÉasy %∞tÿmu…ò%∞(%s)\n", 
c⁄n
->
ósy
, 
g
->
mu…i
, 
uæ
);

332 
rc
 =
	`cuæ_mu…i_add_h™dÀ
(
g
->
mu…i
, 
c⁄n
->
ósy
);

333 
	`mcode_‹_dõ
("√w_c⁄n: cuæ_mu…i_add_h™dÀ", 
rc
);

337 
	}
}

341 
gboﬁón
 
	$fifo_cb
 (
GIOCh™√l
 *
ch
, 
GIOC⁄dôi⁄
 
c⁄dôi⁄
, 
gpoöãr
 
d©a
)

343 
	#BUF_SIZE
 1024

	)

344 
gsize
 
Àn
, 
ç
;

345 
gch¨
 *
buf
, *
tmp
, *
Æl
=
NULL
;

346 
GIOSètus
 
rv
;

349 
GEº‹
 *
îr
=
NULL
;

350 
rv
 = 
	`g_io_ch™√l_ªad_löe
 (
ch
,&
buf
,&
Àn
,&
ç
,&
îr
);

351 i‡–
buf
 ) {

352 i‡(
ç
Ë{ 
buf
[tp]='\0'; }

353 
	`√w_c⁄n
(
buf
,(
GlobÆInfo
*)
d©a
);

354 
	`g_‰ì
(
buf
);

356 
buf
 = 
	`g_mÆloc
(
BUF_SIZE
+1);

357 
TRUE
) {

358 
buf
[
BUF_SIZE
]='\0';

359 
	`g_io_ch™√l_ªad_ch¨s
(
ch
,
buf
,
BUF_SIZE
,&
Àn
,&
îr
);

360 i‡(
Àn
) {

361 
buf
[
Àn
]='\0';

362 i‡(
Æl
) {

363 
tmp
=
Æl
;

364 
Æl
=
	`g_°rdup_¥ötf
("%s%s", 
tmp
, 
buf
);

365 
	`g_‰ì
(
tmp
);

367 
Æl
 = 
	`g_°rdup
(
buf
);

373 i‡(
Æl
) {

374 
	`√w_c⁄n
(
Æl
,(
GlobÆInfo
*)
d©a
);

375 
	`g_‰ì
(
Æl
);

377 
	`g_‰ì
(
buf
);

379 i‡–
îr
 ) {

380 
	`g_îr‹
("fifo_cb: %s", 
îr
->
mesßge
);

381 
	`g_‰ì
(
îr
);

384 }  (
Àn
Ë&& (
rv
 =
G_IO_STATUS_NORMAL
) );

385  
TRUE
;

386 
	}
}

391 
	$öô_fifo
()

393 
°©
 
°
;

394 c⁄° *
fifo
 = "hiper.fifo";

395 
sockë
;

397 i‡(
	`l°©
 (
fifo
, &
°
) == 0) {

398 i‡((
°
.
°_mode
 & 
S_IFMT
Ë=
S_IFREG
) {

399 
î∫o
 = 
EEXIST
;

400 
	`≥º‹
("lstat");

401 
	`exô
 (1);

405 
	`u∆ök
 (
fifo
);

406 i‡(
	`mkfifo
 (
fifo
, 0600) == -1) {

407 
	`≥º‹
("mkfifo");

408 
	`exô
 (1);

411 
sockë
 = 
	`›í
 (
fifo
, 
O_RDWR
 | 
O_NONBLOCK
, 0);

413 i‡(
sockë
 == -1) {

414 
	`≥º‹
("open");

415 
	`exô
 (1);

417 
	`MSG_OUT
("Now,ÖùêsomêURL'†ötÿ> %s\n", 
fifo
);

419  
sockë
;

421 
	}
}

426 
	$maö
(
¨gc
, **
¨gv
)

428 
GlobÆInfo
 *
g
;

429 
CURLMcode
 
rc
;

430 
GMaöLo›
*
gmaö
;

431 
fd
;

432 
GIOCh™√l
* 
ch
;

433 
g
=
	`g_mÆloc0
((
GlobÆInfo
));

435 
fd
=
	`öô_fifo
();

436 
ch
=
	`g_io_ch™√l_unix_√w
(
fd
);

437 
	`g_io_add_w©ch
(
ch
,
G_IO_IN
,
fifo_cb
,
g
);

438 
gmaö
=
	`g_maö_lo›_√w
(
NULL
,
FALSE
);

439 
g
->
mu…i
 = 
	`cuæ_mu…i_öô
();

440 
	`cuæ_mu…i_£t›t
(
g
->
mu…i
, 
CURLMOPT_SOCKETFUNCTION
, 
sock_cb
);

441 
	`cuæ_mu…i_£t›t
(
g
->
mu…i
, 
CURLMOPT_SOCKETDATA
, g);

442 
	`cuæ_mu…i_£t›t
(
g
->
mu…i
, 
CURLMOPT_TIMERFUNCTION
, 
upd©e_timeout_cb
);

443 
	`cuæ_mu…i_£t›t
(
g
->
mu…i
, 
CURLMOPT_TIMERDATA
, g);

448 
	`g_maö_lo›_run
(
gmaö
);

449 
	`cuæ_mu…i_˛ónup
(
g
->
mu…i
);

451 
	}
}

	@docs/examples/hiperfifo.c

56 
	~<°dio.h
>

57 
	~<°rög.h
>

58 
	~<°dlib.h
>

59 
	~<sys/time.h
>

60 
	~<time.h
>

61 
	~<uni°d.h
>

62 
	~<sys/pﬁl.h
>

63 
	~<cuæ/cuæ.h
>

64 
	~<evít2/evít.h
>

65 
	~<f˙é.h
>

66 
	~<sys/°©.h
>

67 
	~<î∫o.h
>

70 
	#MSG_OUT
 
°dout


	)

74 
	s_GlobÆInfo


76 
evít_ba£
 *
	mevba£
;

77 
evít
 *
	mfifo_evít
;

78 
evít
 *
	mtimî_evít
;

79 
CURLM
 *
	mmu…i
;

80 
	m°ûl_ru¬ög
;

81 
FILE
* 
	möput
;

82 } 
	tGlobÆInfo
;

86 
	s_C⁄nInfo


88 
CURL
 *
	mósy
;

89 *
	muæ
;

90 
GlobÆInfo
 *
	mglobÆ
;

91 
	mîr‹
[
CURL_ERROR_SIZE
];

92 } 
	tC⁄nInfo
;

96 
	s_SockInfo


98 
cuæ_sockë_t
 
	msockfd
;

99 
CURL
 *
	mósy
;

100 
	ma˘i⁄
;

101 
	mtimeout
;

102 
evít
 *
	mev
;

103 
	mev£t
;

104 
GlobÆInfo
 *
	mglobÆ
;

105 } 
	tSockInfo
;

110 
	$mu…i_timî_cb
(
CURLM
 *
mu…i
, 
timeout_ms
, 
GlobÆInfo
 *
g
)

112 
timevÆ
 
timeout
;

113 ()
mu…i
;

115 
timeout
.
tv_£c
 = 
timeout_ms
/1000;

116 
timeout
.
tv_u£c
 = (
timeout_ms
%1000)*1000;

117 
	`Ârötf
(
MSG_OUT
, "mu…i_timî_cb: SëtögÅimeouàtÿ%ld ms\n", 
timeout_ms
);

118 
	`evtimî_add
(
g
->
timî_evít
, &
timeout
);

120 
	}
}

123 
	$mcode_‹_dõ
(c⁄° *
whîe
, 
CURLMcode
 
code
)

125 i‡–
CURLM_OK
 !
code
 ) {

126 c⁄° *
s
;

127 
code
) {

128 
CURLM_BAD_HANDLE
: 
s
="CURLM_BAD_HANDLE"; ;

129 
CURLM_BAD_EASY_HANDLE
: 
s
="CURLM_BAD_EASY_HANDLE"; ;

130 
CURLM_OUT_OF_MEMORY
: 
s
="CURLM_OUT_OF_MEMORY"; ;

131 
CURLM_INTERNAL_ERROR
: 
s
="CURLM_INTERNAL_ERROR"; ;

132 
CURLM_UNKNOWN_OPTION
: 
s
="CURLM_UNKNOWN_OPTION"; ;

133 
CURLM_LAST
: 
s
="CURLM_LAST"; ;

134 : 
s
="CURLM_unknown";

136 
CURLM_BAD_SOCKET
: 
s
="CURLM_BAD_SOCKET";

137 
	`Ârötf
(
MSG_OUT
, "ERROR: %†ªtu∫†%s\n", 
whîe
, 
s
);

141 
	`Ârötf
(
MSG_OUT
, "ERROR: %†ªtu∫†%s\n", 
whîe
, 
s
);

142 
	`exô
(
code
);

144 
	}
}

149 
	$check_mu…i_öfo
(
GlobÆInfo
 *
g
)

151 *
eff_uæ
;

152 
CURLMsg
 *
msg
;

153 
msgs_À·
;

154 
C⁄nInfo
 *
c⁄n
;

155 
CURL
 *
ósy
;

156 
CURLcode
 
ªs
;

158 
	`Ârötf
(
MSG_OUT
, "REMAINING: %d\n", 
g
->
°ûl_ru¬ög
);

159 (
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
g
->
mu…i
, &
msgs_À·
))) {

160 i‡(
msg
->msg =
CURLMSG_DONE
) {

161 
ósy
 = 
msg
->
ósy_h™dÀ
;

162 
ªs
 = 
msg
->
d©a
.
ªsu…
;

163 
	`cuæ_ósy_gëöfo
(
ósy
, 
CURLINFO_PRIVATE
, &
c⁄n
);

164 
	`cuæ_ósy_gëöfo
(
ósy
, 
CURLINFO_EFFECTIVE_URL
, &
eff_uæ
);

165 
	`Ârötf
(
MSG_OUT
, "DONE: %†=> (%dË%s\n", 
eff_uæ
, 
ªs
, 
c⁄n
->
îr‹
);

166 
	`cuæ_mu…i_ªmove_h™dÀ
(
g
->
mu…i
, 
ósy
);

167 
	`‰ì
(
c⁄n
->
uæ
);

168 
	`cuæ_ósy_˛ónup
(
ósy
);

169 
	`‰ì
(
c⁄n
);

172 
	}
}

177 
	$evít_cb
(
fd
, 
köd
, *
u£Ω
)

179 
GlobÆInfo
 *
g
 = (GlobÆInfo*Ë
u£Ω
;

180 
CURLMcode
 
rc
;

182 
a˘i⁄
 =

183 (
köd
 & 
EV_READ
 ? 
CURL_CSELECT_IN
 : 0) |

184 (
köd
 & 
EV_WRITE
 ? 
CURL_CSELECT_OUT
 : 0);

186 
rc
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
g
->
mu…i
, 
fd
, 
a˘i⁄
, &g->
°ûl_ru¬ög
);

187 
	`mcode_‹_dõ
("evít_cb: cuæ_mu…i_sockë_a˘i⁄", 
rc
);

189 
	`check_mu…i_öfo
(
g
);

190 i‡–
g
->
°ûl_ru¬ög
 <= 0 ) {

191 
	`Ârötf
(
MSG_OUT
, "lastÅransfer done, killÅimeout\n");

192 i‡(
	`evtimî_≥ndög
(
g
->
timî_evít
, 
NULL
)) {

193 
	`evtimî_dñ
(
g
->
timî_evít
);

196 
	}
}

201 
	$timî_cb
(
fd
, 
köd
, *
u£Ω
)

203 
GlobÆInfo
 *
g
 = (GlobÆInfÿ*)
u£Ω
;

204 
CURLMcode
 
rc
;

205 ()
fd
;

206 ()
köd
;

208 
rc
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
g
->
mu…i
,

209 
CURL_SOCKET_TIMEOUT
, 0, &
g
->
°ûl_ru¬ög
);

210 
	`mcode_‹_dõ
("timî_cb: cuæ_mu…i_sockë_a˘i⁄", 
rc
);

211 
	`check_mu…i_öfo
(
g
);

212 
	}
}

217 
	$ªmsock
(
SockInfo
 *
f
)

219 i‡(
f
) {

220 i‡(
f
->
ev£t
)

221 
	`evít_‰ì
(
f
->
ev
);

222 
	`‰ì
(
f
);

224 
	}
}

229 
	$£tsock
(
SockInfo
*
f
, 
cuæ_sockë_t
 
s
, 
CURL
*
e
, 
a˘
, 
GlobÆInfo
*
g
)

231 
köd
 =

232 (
a˘
&
CURL_POLL_IN
?
EV_READ
:0)|◊˘&
CURL_POLL_OUT
?
EV_WRITE
:0)|
EV_PERSIST
;

234 
f
->
sockfd
 = 
s
;

235 
f
->
a˘i⁄
 = 
a˘
;

236 
f
->
ósy
 = 
e
;

237 i‡(
f
->
ev£t
)

238 
	`evít_‰ì
(
f
->
ev
);

239 
f
->
ev
 = 
	`evít_√w
(
g
->
evba£
, f->
sockfd
, 
köd
, 
evít_cb
, g);

240 
f
->
ev£t
 = 1;

241 
	`evít_add
(
f
->
ev
, 
NULL
);

242 
	}
}

247 
	$addsock
(
cuæ_sockë_t
 
s
, 
CURL
 *
ósy
, 
a˘i⁄
, 
GlobÆInfo
 *
g
)

249 
SockInfo
 *
fdp
 = 
	`ˇŒoc
((SockInfo), 1);

251 
fdp
->
globÆ
 = 
g
;

252 
	`£tsock
(
fdp
, 
s
, 
ósy
, 
a˘i⁄
, 
g
);

253 
	`cuæ_mu…i_assign
(
g
->
mu…i
, 
s
, 
fdp
);

254 
	}
}

257 
	$sock_cb
(
CURL
 *
e
, 
cuæ_sockë_t
 
s
, 
wh©
, *
cbp
, *
sockp
)

259 
GlobÆInfo
 *
g
 = (GlobÆInfo*Ë
cbp
;

260 
SockInfo
 *
fdp
 = (SockInfo*Ë
sockp
;

261 c⁄° *
wh©°r
[]={ "none", "IN", "OUT", "INOUT", "REMOVE" };

263 
	`Ârötf
(
MSG_OUT
,

264 "sockë cÆlback: s=%dÉ=%∞wh©=%†", 
s
, 
e
, 
wh©°r
[
wh©
]);

265 i‡(
wh©
 =
CURL_POLL_REMOVE
) {

266 
	`Ârötf
(
MSG_OUT
, "\n");

267 
	`ªmsock
(
fdp
);

270 i‡(!
fdp
) {

271 
	`Ârötf
(
MSG_OUT
, "Addög d©a: %s\n", 
wh©°r
[
wh©
]);

272 
	`addsock
(
s
, 
e
, 
wh©
, 
g
);

275 
	`Ârötf
(
MSG_OUT
,

277 
wh©°r
[
fdp
->
a˘i⁄
], wh©°r[
wh©
]);

278 
	`£tsock
(
fdp
, 
s
, 
e
, 
wh©
, 
g
);

282 
	}
}

287 
size_t
 
	$wrôe_cb
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
d©a
)

289 
size_t
 
ªÆsize
 = 
size
 * 
nmemb
;

290 
C⁄nInfo
 *
c⁄n
 = (C⁄nInfo*Ë
d©a
;

291 ()
±r
;

292 ()
c⁄n
;

293  
ªÆsize
;

294 
	}
}

298 
	$¥og_cb
 (*
p
, 
d…ŸÆ
, 
d ow
, 
u…
,

299 
u 
)

301 
C⁄nInfo
 *
c⁄n
 = (C⁄nInfÿ*)
p
;

302 ()
u…
;

303 ()
u 
;

305 
	`Ârötf
(
MSG_OUT
, "Progªss: %†(%g/%g)\n", 
c⁄n
->
uæ
, 
d ow
, 
d…ŸÆ
);

307 
	}
}

311 
	$√w_c⁄n
(*
uæ
, 
GlobÆInfo
 *
g
 )

313 
C⁄nInfo
 *
c⁄n
;

314 
CURLMcode
 
rc
;

316 
c⁄n
 = 
	`ˇŒoc
(1, (
C⁄nInfo
));

317 
	`mem£t
(
c⁄n
, 0, (
C⁄nInfo
));

318 
c⁄n
->
îr‹
[0]='\0';

320 
c⁄n
->
ósy
 = 
	`cuæ_ósy_öô
();

321 i‡(!
c⁄n
->
ósy
) {

322 
	`Ârötf
(
MSG_OUT
, "curl_easy_init() failed,Éxiting!\n");

323 
	`exô
(2);

325 
c⁄n
->
globÆ
 = 
g
;

326 
c⁄n
->
uæ
 = 
	`°rdup
(url);

327 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_URL
, c⁄n->
uæ
);

328 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_cb
);

329 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_WRITEDATA
, &conn);

330 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_VERBOSE
, 1L);

331 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_ERRORBUFFER
, c⁄n->
îr‹
);

332 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PRIVATE
, conn);

333 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_NOPROGRESS
, 0L);

334 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PROGRESSFUNCTION
, 
¥og_cb
);

335 
	`cuæ_ósy_£t›t
(
c⁄n
->
ósy
, 
CURLOPT_PROGRESSDATA
, conn);

336 
	`Ârötf
(
MSG_OUT
,

337 "AddögÉasy %∞tÿmu…ò%∞(%s)\n", 
c⁄n
->
ósy
, 
g
->
mu…i
, 
uæ
);

338 
rc
 = 
	`cuæ_mu…i_add_h™dÀ
(
g
->
mu…i
, 
c⁄n
->
ósy
);

339 
	`mcode_‹_dõ
("√w_c⁄n: cuæ_mu…i_add_h™dÀ", 
rc
);

343 
	}
}

346 
	$fifo_cb
(
fd
, 
evít
, *
¨g
)

348 
s
[1024];

349 
rv
=0;

350 
n
=0;

351 
GlobÆInfo
 *
g
 = (GlobÆInfÿ*)
¨g
;

352 ()
fd
;

353 ()
evít
;

356 
s
[0]='\0';

357 
rv
=
	`fsˇnf
(
g
->
öput
, "%1023s%n", 
s
, &
n
);

358 
s
[
n
]='\0';

359 i‡–
n
 && 
s
[0] ) {

360 
	`√w_c⁄n
(
s
,
¨g
);

362 }  
rv
 !
EOF
);

363 
	}
}

366 c⁄° *
	gfifo
 = "hiper.fifo";

367 
	$öô_fifo
 (
GlobÆInfo
 *
g
)

369 
°©
 
°
;

370 
cuæ_sockë_t
 
sockfd
;

372 
	`Ârötf
(
MSG_OUT
, "Cª©ögÇamedÖùê\"%s\"\n", 
fifo
);

373 i‡(
	`l°©
 (
fifo
, &
°
) == 0) {

374 i‡((
°
.
°_mode
 & 
S_IFMT
Ë=
S_IFREG
) {

375 
î∫o
 = 
EEXIST
;

376 
	`≥º‹
("lstat");

377 
	`exô
 (1);

380 
	`u∆ök
(
fifo
);

381 i‡(
	`mkfifo
 (
fifo
, 0600) == -1) {

382 
	`≥º‹
("mkfifo");

383 
	`exô
 (1);

385 
sockfd
 = 
	`›í
(
fifo
, 
O_RDWR
 | 
O_NONBLOCK
, 0);

386 i‡(
sockfd
 == -1) {

387 
	`≥º‹
("open");

388 
	`exô
 (1);

390 
g
->
öput
 = 
	`fd›í
(
sockfd
, "r");

392 
	`Ârötf
(
MSG_OUT
, "Now,ÖùêsomêURL'†ötÿ> %s\n", 
fifo
);

393 
g
->
fifo_evít
 = 
	`evít_√w
(g->
evba£
, 
sockfd
, 
EV_READ
|
EV_PERSIST
, 
fifo_cb
, g);

394 
	`evít_add
(
g
->
fifo_evít
, 
NULL
);

396 
	}
}

398 
	$˛ón_fifo
(
GlobÆInfo
 *
g
)

400 
	`evít_‰ì
(
g
->
fifo_evít
);

401 
	`f˛o£
(
g
->
öput
);

402 
	`u∆ök
(
fifo
);

403 
	}
}

405 
	$maö
(
¨gc
, **
¨gv
)

407 
GlobÆInfo
 
g
;

408 ()
¨gc
;

409 ()
¨gv
;

411 
	`mem£t
(&
g
, 0, (
GlobÆInfo
));

412 
g
.
evba£
 = 
	`evít_ba£_√w
();

413 
	`öô_fifo
(&
g
);

414 
g
.
mu…i
 = 
	`cuæ_mu…i_öô
();

415 
g
.
timî_evít
 = 
	`evtimî_√w
(g.
evba£
, 
timî_cb
, &g);

418 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_SOCKETFUNCTION
, 
sock_cb
);

419 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_SOCKETDATA
, &g);

420 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_TIMERFUNCTION
, 
mu…i_timî_cb
);

421 
	`cuæ_mu…i_£t›t
(
g
.
mu…i
, 
CURLMOPT_TIMERDATA
, &g);

426 
	`evít_ba£_di•©ch
(
g
.
evba£
);

430 
	`˛ón_fifo
(&
g
);

431 
	`evít_‰ì
(
g
.
timî_evít
);

432 
	`evít_ba£_‰ì
(
g
.
evba£
);

433 
	`cuæ_mu…i_˛ónup
(
g
.
mu…i
);

435 
	}
}

	@docs/examples/href_extractor.c

32 
	~<°dio.h
>

33 
	~<cuæ/cuæ.h
>

34 
	~<html°ªam∑r£r.h
>

37 
size_t
 
	$wrôe_ˇŒback
(*
buf„r
, 
size_t
 
size
, size_à
nmemb
,

38 *
h•
)

40 
size_t
 
ªÆsize
 = 
size
 * 
nmemb
, 
p
;

41 
p
 = 0;Ö < 
ªÆsize
;Ö++) {

42 
	`html_∑r£r_ch¨_∑r£
(
h•
, ((*)
buf„r
)[
p
]);

43 i‡(
	`html_∑r£r_cmp_èg
(
h•
, "a", 1))

44 i‡(
	`html_∑r£r_cmp_©å
(
h•
, "href", 4))

45 i‡(
	`html_∑r£r_is_ö
(
h•
, 
HTML_VALUE_ENDED
)) {

46 
	`html_∑r£r_vÆ
(
h•
)[
	`html_∑r£r_vÆ_Àngth
(hsp)] = '\0';

47 
	`¥ötf
("%s\n", 
	`html_∑r£r_vÆ
(
h•
));

50  
ªÆsize
;

51 
	}
}

53 
	$maö
(
¨gc
, *
¨gv
[])

55 
èg
[1], 
©å
[4], 
vÆ
[128];

56 
CURL
 *
cuæ
;

57 
HTMLSTREAMPARSER
 *
h•
;

59 i‡(
¨gc
 != 2) {

60 
	`¥ötf
("Ußge: %†URL\n", 
¨gv
[0]);

61  
EXIT_FAILURE
;

64 
cuæ
 = 
	`cuæ_ósy_öô
();

66 
h•
 = 
	`html_∑r£r_öô
();

68 
	`html_∑r£r_£t_èg_to_lowî
(
h•
, 1);

69 
	`html_∑r£r_£t_©å_to_lowî
(
h•
, 1);

70 
	`html_∑r£r_£t_èg_buf„r
(
h•
, 
èg
, (tag));

71 
	`html_∑r£r_£t_©å_buf„r
(
h•
, 
©å
, (attr));

72 
	`html_∑r£r_£t_vÆ_buf„r
(
h•
, 
vÆ
, (val)-1);

74 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
¨gv
[1]);

75 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_ˇŒback
);

76 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
h•
);

77 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_FOLLOWLOCATION
, 1L);

79 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

81 
	`cuæ_ósy_˛ónup
(
cuæ
);

83 
	`html_∑r£r_˛ónup
(
h•
);

85  
EXIT_SUCCESS
;

86 
	}
}

	@docs/examples/htmltidy.c

31 
	~<°dio.h
>

32 
	~<tidy/tidy.h
>

33 
	~<tidy/buffio.h
>

34 
	~<cuæ/cuæ.h
>

37 
uöt
 
	$wrôe_cb
(*
ö
, 
uöt
 
size
, uöà
nmemb
, 
TidyBuf„r
 *
out
)

39 
uöt
 
r
;

40 
r
 = 
size
 * 
nmemb
;

41 
	`tidyBufAµíd
–
out
, 
ö
, 
r
 );

42 (
r
);

43 
	}
}

46 
	$dumpNode
(
TidyDoc
 
doc
, 
TidyNode
 
äod
, 
ödít
 )

48 
TidyNode
 
chûd
;

49  
chûd
 = 
	`tidyGëChûd
(
äod
); chûd; chûd = 
	`tidyGëNext
(child) )

51 
˘mb°r
 
«me
 = 
	`tidyNodeGëName
–
chûd
 );

52 i‡–
«me
 )

55 
TidyAâr
 
©å
;

56 
	`¥ötf
–"%*.*s%†", 
ödít
, indít, "<", 
«me
);

58  
©å
=
	`tidyAârFú°
(
chûd
);áâr;áâr=
	`tidyAârNext
(attr) ) {

59 
	`¥ötf
(
	`tidyAârName
(
©å
));

60 
	`tidyAârVÆue
(
©å
)?
	`¥ötf
("=\"%s\" ",

61 
	`tidyAârVÆue
(
©å
)):
	`¥ötf
(" ");

63 
	`¥ötf
( ">\n");

67 
TidyBuf„r
 
buf
;

68 
	`tidyBufInô
(&
buf
);

69 
	`tidyNodeGëText
(
doc
, 
chûd
, &
buf
);

70 
	`¥ötf
("%*.*s\n", 
ödít
, indít, 
buf
.
bp
?(*)buf.bp:"");

71 
	`tidyBufFªe
(&
buf
);

73 
	`dumpNode
–
doc
, 
chûd
, 
ödít
 + 4 );

75 
	}
}

78 
	$maö
(
¨gc
, **
¨gv
 )

80 
CURL
 *
cuæ
;

81 
cuæ_îrbuf
[
CURL_ERROR_SIZE
];

82 
TidyDoc
 
tdoc
;

83 
TidyBuf„r
 
docbuf
 = {0};

84 
TidyBuf„r
 
tidy_îrbuf
 = {0};

85 
îr
;

86 i‡–
¨gc
 == 2) {

87 
cuæ
 = 
	`cuæ_ósy_öô
();

88 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
¨gv
[1]);

89 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_ERRORBUFFER
, 
cuæ_îrbuf
);

90 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_NOPROGRESS
, 0L);

91 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

92 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_cb
);

94 
tdoc
 = 
	`tidyCª©e
();

95 
	`tidyO±SëBoﬁ
(
tdoc
, 
TidyF‹˚Ouçut
, 
yes
);

96 
	`tidyO±SëI¡
(
tdoc
, 
TidyWøpLí
, 4096);

97 
	`tidySëEº‹Buf„r
–
tdoc
, &
tidy_îrbuf
 );

98 
	`tidyBufInô
(&
docbuf
);

100 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, &
docbuf
);

101 
îr
=
	`cuæ_ósy_≥rf‹m
(
cuæ
);

102 i‡–!
îr
 ) {

103 
îr
 = 
	`tidyP¨£Buf„r
(
tdoc
, &
docbuf
);

104 i‡–
îr
 >= 0 ) {

105 
îr
 = 
	`tidyCÀ™AndRïaú
(
tdoc
);

106 i‡–
îr
 >= 0 ) {

107 
îr
 = 
	`tidyRunDügno°ics
(
tdoc
);

108 i‡–
îr
 >= 0 ) {

109 
	`dumpNode
–
tdoc
, 
	`tidyGëRoŸ
(tdoc), 0 );

110 
	`Ârötf
(
°dîr
, "%s\n", 
tidy_îrbuf
.
bp
);

116 
	`Ârötf
(
°dîr
, "%s\n", 
cuæ_îrbuf
);

119 
	`cuæ_ósy_˛ónup
(
cuæ
);

120 
	`tidyBufFªe
(&
docbuf
);

121 
	`tidyBufFªe
(&
tidy_îrbuf
);

122 
	`tidyRñó£
(
tdoc
);

123 (
îr
);

127 
	`¥ötf
–"ußge: %†<uæ>\n", 
¨gv
[0] );

130 
	}
}

	@docs/examples/htmltitle.cpp

31 
	~<°dio.h
>

32 
	~<°rög.h
>

33 
	~<°dlib.h
>

34 
	~<°rög
>

35 
	~<cuæ/cuæ.h
>

36 
	~<libxml/HTML∑r£r.h
>

42 #ifde‡
_MSC_VER


43 
	#COMPARE
(
a
, 
b
Ë(!
	`°ricmp
(◊), (b)))

	)

45 
	#COMPARE
(
a
, 
b
Ë(!
	`°rˇ£cmp
(◊), (b)))

	)

52 
	sC⁄ãxt


54 
C⁄ãxt
(): 
addTôÀ
(
Ál£
) { }

56 
boﬁ
 
addTôÀ
;

57 
	m°d
::
°rög
 
tôÀ
;

63 
	gîr‹Buf„r
[
CURL_ERROR_SIZE
];

64 
	g°d
::
°rög
 
buf„r
;

70 
	$wrôî
(*
d©a
, 
size_t
 
size
, size_à
nmemb
,

71 
°d
::
°rög
 *
wrôîD©a
)

73 i‡(
wrôîD©a
 =
NULL
)

76 
wrôîD©a
->
	`≠≥nd
(
d©a
, 
size
*
nmemb
);

78  
size
 * 
nmemb
;

79 
	}
}

85 
boﬁ
 
	$öô
(
CURL
 *&
c⁄n
, *
uæ
)

87 
CURLcode
 
code
;

89 
c⁄n
 = 
	`cuæ_ósy_öô
();

91 i‡(
c⁄n
 =
NULL
)

93 
	`Ârötf
(
°dîr
, "FailedÅo create CURL connection\n");

95 
	`exô
(
EXIT_FAILURE
);

98 
code
 = 
	`cuæ_ósy_£t›t
(
c⁄n
, 
CURLOPT_ERRORBUFFER
, 
îr‹Buf„r
);

99 i‡(
code
 !
CURLE_OK
)

101 
	`Ârötf
(
°dîr
, "FaûedÅÿ£àîr‹ buf„∏[%d]\n", 
code
);

103  
Ál£
;

106 
code
 = 
	`cuæ_ósy_£t›t
(
c⁄n
, 
CURLOPT_URL
, 
uæ
);

107 i‡(
code
 !
CURLE_OK
)

109 
	`Ârötf
(
°dîr
, "FaûedÅÿ£àURL [%s]\n", 
îr‹Buf„r
);

111  
Ál£
;

114 
code
 = 
	`cuæ_ósy_£t›t
(
c⁄n
, 
CURLOPT_FOLLOWLOCATION
, 1L);

115 i‡(
code
 !
CURLE_OK
)

117 
	`Ârötf
(
°dîr
, "FaûedÅÿ£àªdúe˘ o±i⁄ [%s]\n", 
îr‹Buf„r
);

119  
Ál£
;

122 
code
 = 
	`cuæ_ósy_£t›t
(
c⁄n
, 
CURLOPT_WRITEFUNCTION
, 
wrôî
);

123 i‡(
code
 !
CURLE_OK
)

125 
	`Ârötf
(
°dîr
, "FaûedÅÿ£àwrôî [%s]\n", 
îr‹Buf„r
);

127  
Ál£
;

130 
code
 = 
	`cuæ_ósy_£t›t
(
c⁄n
, 
CURLOPT_WRITEDATA
, &
buf„r
);

131 i‡(
code
 !
CURLE_OK
)

133 
	`Ârötf
(
°dîr
, "FaûedÅÿ£àwrôêd©®[%s]\n", 
îr‹Buf„r
);

135  
Ál£
;

138  
åue
;

139 
	}
}

145 
	$SèπEÀmít
(*
voidC⁄ãxt
,

146 c⁄° 
xmlCh¨
 *
«me
,

147 c⁄° 
xmlCh¨
 **
©åibuãs
)

149 
C⁄ãxt
 *
c⁄ãxt
 = (C⁄ãxà*)
voidC⁄ãxt
;

151 i‡(
	`COMPARE
((*)
«me
, "TITLE"))

153 
c⁄ãxt
->
tôÀ
 = "";

154 
c⁄ãxt
->
addTôÀ
 = 
åue
;

156 (Ë
©åibuãs
;

157 
	}
}

163 
	$EndEÀmít
(*
voidC⁄ãxt
,

164 c⁄° 
xmlCh¨
 *
«me
)

166 
C⁄ãxt
 *
c⁄ãxt
 = (C⁄ãxà*)
voidC⁄ãxt
;

168 i‡(
	`COMPARE
((*)
«me
, "TITLE"))

169 
c⁄ãxt
->
addTôÀ
 = 
Ál£
;

170 
	}
}

176 
	$h™dÀCh¨a˘îs
(
C⁄ãxt
 *
c⁄ãxt
,

177 c⁄° 
xmlCh¨
 *
ch¨s
,

178 
Àngth
)

180 i‡(
c⁄ãxt
->
addTôÀ
)

181 
c⁄ãxt
->
tôÀ
.
	`≠≥nd
((*)
ch¨s
, 
Àngth
);

182 
	}
}

188 
	$Ch¨a˘îs
(*
voidC⁄ãxt
,

189 c⁄° 
xmlCh¨
 *
ch¨s
,

190 
Àngth
)

192 
C⁄ãxt
 *
c⁄ãxt
 = (C⁄ãxà*)
voidC⁄ãxt
;

194 
	`h™dÀCh¨a˘îs
(
c⁄ãxt
, 
ch¨s
, 
Àngth
);

195 
	}
}

201 
	$cd©a
(*
voidC⁄ãxt
,

202 c⁄° 
xmlCh¨
 *
ch¨s
,

203 
Àngth
)

205 
C⁄ãxt
 *
c⁄ãxt
 = (C⁄ãxà*)
voidC⁄ãxt
;

207 
	`h™dÀCh¨a˘îs
(
c⁄ãxt
, 
ch¨s
, 
Àngth
);

208 
	}
}

214 
htmlSAXH™dÀr
 
	gßxH™dÀr
 =

216 
NULL
,

217 
NULL
,

218 
NULL
,

219 
NULL
,

220 
NULL
,

221 
NULL
,

222 
NULL
,

223 
NULL
,

224 
NULL
,

225 
NULL
,

226 
NULL
,

227 
NULL
,

228 
NULL
,

229 
NULL
,

230 
SèπEÀmít
,

231 
EndEÀmít
,

232 
NULL
,

233 
Ch¨a˘îs
,

234 
NULL
,

235 
NULL
,

236 
NULL
,

237 
NULL
,

238 
NULL
,

239 
NULL
,

240 
NULL
,

241 
cd©a
,

242 
NULL


249 
	$∑r£Html
(c⁄° 
°d
::
°rög
 &
html
,

250 
°d
::
°rög
 &
tôÀ
)

252 
htmlP¨£rCtxtPå
 
˘xt
;

253 
C⁄ãxt
 
c⁄ãxt
;

255 
˘xt
 = 
	`htmlCª©ePushP¨£rCtxt
(&
ßxH™dÀr
, &
c⁄ãxt
, "", 0, "",

256 
XML_CHAR_ENCODING_NONE
);

258 
	`htmlP¨£Chunk
(
˘xt
, 
html
.
	`c_°r
(), html.
	`size
(), 0);

259 
	`htmlP¨£Chunk
(
˘xt
, "", 0, 1);

261 
	`htmlFªeP¨£rCtxt
(
˘xt
);

263 
tôÀ
 = 
c⁄ãxt
.title;

264 
	}
}

266 
	$maö
(
¨gc
, *
¨gv
[])

268 
CURL
 *
c⁄n
 = 
NULL
;

269 
CURLcode
 
code
;

270 
°d
::
°rög
 
tôÀ
;

274 i‡(
¨gc
 != 2)

276 
	`Ârötf
(
°dîr
, "Ußge: %†<uæ>\n", 
¨gv
[0]);

278 
	`exô
(
EXIT_FAILURE
);

281 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

285 i‡(!
	`öô
(
c⁄n
, 
¨gv
[1]))

287 
	`Ârötf
(
°dîr
, "Connection initializion failed\n");

289 
	`exô
(
EXIT_FAILURE
);

294 
code
 = 
	`cuæ_ósy_≥rf‹m
(
c⁄n
);

295 
	`cuæ_ósy_˛ónup
(
c⁄n
);

297 i‡(
code
 !
CURLE_OK
)

299 
	`Ârötf
(
°dîr
, "FaûedÅÿgë '%s' [%s]\n", 
¨gv
[1], 
îr‹Buf„r
);

301 
	`exô
(
EXIT_FAILURE
);

306 
	`∑r£Html
(
buf„r
, 
tôÀ
);

310 
	`¥ötf
("TôÀ: %s\n", 
tôÀ
.
	`c_°r
());

312  
EXIT_SUCCESS
;

313 
	}
}

	@docs/examples/http-post.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

25 
	$maö
()

27 
CURL
 *
cuæ
;

28 
CURLcode
 
ªs
;

31 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

34 
cuæ
 = 
	`cuæ_ósy_öô
();

35 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://postit.example.com/moo.cgi");

41 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, "name=daniel&project=curl");

44 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

46 if(
ªs
 !
CURLE_OK
)

47 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

48 
	`cuæ_ósy_°ªº‹
(
ªs
));

51 
	`cuæ_ósy_˛ónup
(
cuæ
);

53 
	`cuæ_globÆ_˛ónup
();

55 
	}
}

	@docs/examples/httpcustomheader.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

25 
	$maö
()

27 
CURL
 *
cuæ
;

28 
CURLcode
 
ªs
;

30 
cuæ
 = 
	`cuæ_ósy_öô
();

31 if(
cuæ
) {

32 
cuæ_¶i°
 *
chunk
 = 
NULL
;

34 
chunk
 = 
	`cuæ_¶i°_≠≥nd
(chunk, "Accept: moo");

35 
chunk
 = 
	`cuæ_¶i°_≠≥nd
(chunk, "Another: yes");

38 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "localhost");

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

40 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

42 if(
ªs
 !
CURLE_OK
)

43 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

44 
	`cuæ_ósy_°ªº‹
(
ªs
));

47 
ªs
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
chunk
);

48 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

50 if(
ªs
 !
CURLE_OK
)

51 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

52 
	`cuæ_ósy_°ªº‹
(
ªs
));

55 
	`cuæ_ósy_˛ónup
(
cuæ
);

58 
	`cuæ_¶i°_‰ì_Æl
(
chunk
);

61 
	}
}

	@docs/examples/httpput.c

22 
	~<°dio.h
>

23 
	~<f˙é.h
>

24 
	~<sys/°©.h
>

25 
	~<cuæ/cuæ.h
>

37 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

39 
size_t
 
ªtcode
;

40 
cuæ_off_t
 
ƒód
;

45 
ªtcode
 = 
	`‰ód
(
±r
, 
size
, 
nmemb
, 
°ªam
);

47 
ƒód
 = (
cuæ_off_t
)
ªtcode
;

49 
	`Ârötf
(
°dîr
, "*** Wêªad %" 
CURL_FORMAT_CURL_OFF_T


50 " byã†‰om fûe\n", 
ƒód
);

52  
ªtcode
;

53 
	}
}

55 
	$maö
(
¨gc
, **
¨gv
)

57 
CURL
 *
cuæ
;

58 
CURLcode
 
ªs
;

59 
FILE
 * 
hd_§c
 ;

60 
°©
 
fûe_öfo
;

62 *
fûe
;

63 *
uæ
;

65 if(
¨gc
 < 3)

68 
fûe

¨gv
[1];

69 
uæ
 = 
¨gv
[2];

72 
	`°©
(
fûe
, &
fûe_öfo
);

77 
hd_§c
 = 
	`f›í
(
fûe
, "rb");

80 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

83 
cuæ
 = 
	`cuæ_ósy_öô
();

84 if(
cuæ
) {

86 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

89 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

92 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PUT
, 1L);

96 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
uæ
);

99 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, 
hd_§c
);

103 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE_LARGE
,

104 (
cuæ_off_t
)
fûe_öfo
.
°_size
);

107 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

109 if(
ªs
 !
CURLE_OK
)

110 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

111 
	`cuæ_ósy_°ªº‹
(
ªs
));

114 
	`cuæ_ósy_˛ónup
(
cuæ
);

116 
	`f˛o£
(
hd_§c
);

118 
	`cuæ_globÆ_˛ónup
();

120 
	}
}

	@docs/examples/https.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

25 
	$maö
()

27 
CURL
 *
cuæ
;

28 
CURLcode
 
ªs
;

30 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

32 
cuæ
 = 
	`cuæ_ósy_öô
();

33 if(
cuæ
) {

34 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "https://example.com/");

36 #ifde‡
SKIP_PEER_VERIFICATION


47 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

50 #ifde‡
SKIP_HOSTNAME_VERIFICATION


57 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYHOST
, 0L);

61 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

63 if(
ªs
 !
CURLE_OK
)

64 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

65 
	`cuæ_ósy_°ªº‹
(
ªs
));

68 
	`cuæ_ósy_˛ónup
(
cuæ
);

71 
	`cuæ_globÆ_˛ónup
();

74 
	}
}

	@docs/examples/imap-append.c

22 
	~<°dio.h
>

23 
	~<°rög.h
>

24 
	~<cuæ/cuæ.h
>

32 
	#FROM
 "<£ndî@exam∂e.‹g>"

	)

33 
	#TO
 "<addªs£e@exam∂e.√t>"

	)

34 
	#CC
 "<öfo@exam∂e.‹g>"

	)

36 c⁄° *
	g∑ylﬂd_ãxt
[] = {

38 "To: " 
TO
 "\r\n",

39 "From: " 
FROM
 "(Example User)\r\n",

40 "Cc: " 
CC
 "(AnotherÉxample User)\r\n",

48 
NULL


51 
	su∂ﬂd_°©us
 {

52 
	mlöes_ªad
;

55 
size_t
 
	$∑ylﬂd_sour˚
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

57 
u∂ﬂd_°©us
 *
u∂ﬂd_˘x
 = (u∂ﬂd_°©u†*)
u£Ω
;

58 c⁄° *
d©a
;

60 if((
size
 =0Ë|| (
nmemb
 == 0) || ((size*nmemb) < 1)) {

64 
d©a
 = 
∑ylﬂd_ãxt
[
u∂ﬂd_˘x
->
löes_ªad
];

66 if(
d©a
) {

67 
size_t
 
Àn
 = 
	`°æí
(
d©a
);

68 
	`mem˝y
(
±r
, 
d©a
, 
Àn
);

69 
u∂ﬂd_˘x
->
löes_ªad
++;

71  
Àn
;

75 
	}
}

77 
	$maö
()

79 
CURL
 *
cuæ
;

80 
CURLcode
 
ªs
 = 
CURLE_OK
;

81 
u∂ﬂd_°©us
 
u∂ﬂd_˘x
;

83 
u∂ﬂd_˘x
.
löes_ªad
 = 0;

85 
cuæ
 = 
	`cuæ_ósy_öô
();

86 if(
cuæ
) {

88 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

89 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

94 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com/100");

99 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
∑ylﬂd_sour˚
);

100 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
u∂ﬂd_˘x
);

101 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

104 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

107 if(
ªs
 !
CURLE_OK
)

108 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

109 
	`cuæ_ósy_°ªº‹
(
ªs
));

112 
	`cuæ_ósy_˛ónup
(
cuæ
);

115  ()
ªs
;

116 
	}
}

	@docs/examples/imap-copy.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com/INBOX");

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "COPY 1 FOLDER");

53 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

56 if(
ªs
 !
CURLE_OK
)

57 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

58 
	`cuæ_ósy_°ªº‹
(
ªs
));

61 
	`cuæ_ósy_˛ónup
(
cuæ
);

64  ()
ªs
;

65 
	}
}

	@docs/examples/imap-create.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com");

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "CREATE FOLDER");

49 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

52 if(
ªs
 !
CURLE_OK
)

53 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

54 
	`cuæ_ósy_°ªº‹
(
ªs
));

57 
	`cuæ_ósy_˛ónup
(
cuæ
);

60  ()
ªs
;

61 
	}
}

	@docs/examples/imap-delete.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com");

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "DELETE FOLDER");

49 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

52 if(
ªs
 !
CURLE_OK
)

53 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

54 
	`cuæ_ósy_°ªº‹
(
ªs
));

57 
	`cuæ_ósy_˛ónup
(
cuæ
);

60  ()
ªs
;

61 
	}
}

	@docs/examples/imap-examine.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com");

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "EXAMINE OUTBOX");

49 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

52 if(
ªs
 !
CURLE_OK
)

53 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

54 
	`cuæ_ósy_°ªº‹
(
ªs
));

57 
	`cuæ_ósy_˛ónup
(
cuæ
);

60  ()
ªs
;

61 
	}
}

	@docs/examples/imap-fetch.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com/INBOX/;UID=1");

46 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

49 if(
ªs
 !
CURLE_OK
)

50 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

51 
	`cuæ_ósy_°ªº‹
(
ªs
));

54 
	`cuæ_ósy_˛ónup
(
cuæ
);

57  ()
ªs
;

58 
	}
}

	@docs/examples/imap-list.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

45 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com");

48 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

51 if(
ªs
 !
CURLE_OK
)

52 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

53 
	`cuæ_ósy_°ªº‹
(
ªs
));

56 
	`cuæ_ósy_˛ónup
(
cuæ
);

59  ()
ªs
;

60 
	}
}

	@docs/examples/imap-lsub.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com");

47 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "LSUB \"\" *");

50 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

53 if(
ªs
 !
CURLE_OK
)

54 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

55 
	`cuæ_ósy_°ªº‹
(
ªs
));

58 
	`cuæ_ósy_˛ónup
(
cuæ
);

61  ()
ªs
;

62 
	}
}

	@docs/examples/imap-multi.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

32 
	#MULTI_PERFORM_HANG_TIMEOUT
 60 * 1000

	)

34 
timevÆ
 
	$tvnow
()

36 
timevÆ
 
now
;

39 
now
.
tv_£c
 = ()
	`time
(
NULL
);

40 
now
.
tv_u£c
 = 0;

42  
now
;

43 
	}
}

45 
	$tvdiff
(
timevÆ
 
√wî
, timevÆ 
ﬁdî
)

47  (
√wî
.
tv_£c
 - 
ﬁdî
.tv_sec) * 1000 +

48 (
√wî
.
tv_u£c
 - 
ﬁdî
.tv_usec) / 1000;

49 
	}
}

51 
	$maö
()

53 
CURL
 *
cuæ
;

54 
CURLM
 *
mcuæ
;

55 
°ûl_ru¬ög
 = 1;

56 
timevÆ
 
mp_°¨t
;

58 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

60 
cuæ
 = 
	`cuæ_ósy_öô
();

61 if(!
cuæ
)

64 
mcuæ
 = 
	`cuæ_mu…i_öô
();

65 if(!
mcuæ
)

69 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

70 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

73 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com/INBOX/;UID=1");

76 
	`cuæ_mu…i_add_h™dÀ
(
mcuæ
, 
cuæ
);

79 
mp_°¨t
 = 
	`tvnow
();

82 
	`cuæ_mu…i_≥rf‹m
(
mcuæ
, &
°ûl_ru¬ög
);

84 
°ûl_ru¬ög
) {

85 
timevÆ
 
timeout
;

86 
fd_£t
 
fdªad
;

87 
fd_£t
 
fdwrôe
;

88 
fd_£t
 
fdex˚p
;

89 
maxfd
 = -1;

90 
rc
;

92 
cuæ_timeo
 = -1;

95 
	`FD_ZERO
(&
fdªad
);

96 
	`FD_ZERO
(&
fdwrôe
);

97 
	`FD_ZERO
(&
fdex˚p
);

100 
timeout
.
tv_£c
 = 1;

101 
timeout
.
tv_u£c
 = 0;

103 
	`cuæ_mu…i_timeout
(
mcuæ
, &
cuæ_timeo
);

104 if(
cuæ_timeo
 >= 0) {

105 
timeout
.
tv_£c
 = 
cuæ_timeo
 / 1000;

106 if(
timeout
.
tv_£c
 > 1)

107 
timeout
.
tv_£c
 = 1;

109 
timeout
.
tv_u£c
 = (
cuæ_timeo
 % 1000) * 1000;

113 
	`cuæ_mu…i_fd£t
(
mcuæ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

120 
rc
 = 
	`£À˘
(
maxfd
 + 1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

122 if(
	`tvdiff
(
	`tvnow
(), 
mp_°¨t
Ë> 
MULTI_PERFORM_HANG_TIMEOUT
) {

123 
	`Ârötf
(
°dîr
,

128 
rc
) {

133 
	`cuæ_mu…i_≥rf‹m
(
mcuæ
, &
°ûl_ru¬ög
);

139 
	`cuæ_mu…i_ªmove_h™dÀ
(
mcuæ
, 
cuæ
);

140 
	`cuæ_mu…i_˛ónup
(
mcuæ
);

141 
	`cuæ_ósy_˛ónup
(
cuæ
);

142 
	`cuæ_globÆ_˛ónup
();

145 
	}
}

	@docs/examples/imap-noop.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com");

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "NOOP");

49 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

52 if(
ªs
 !
CURLE_OK
)

53 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

54 
	`cuæ_ósy_°ªº‹
(
ªs
));

57 
	`cuæ_ósy_˛ónup
(
cuæ
);

60  ()
ªs
;

61 
	}
}

	@docs/examples/imap-search.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com/INBOX");

50 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "SEARCH NEW");

53 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

56 if(
ªs
 !
CURLE_OK
)

57 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

58 
	`cuæ_ósy_°ªº‹
(
ªs
));

61 
	`cuæ_ósy_˛ónup
(
cuæ
);

64  ()
ªs
;

65 
	}
}

	@docs/examples/imap-ssl.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

32 
	$maö
()

34 
CURL
 *
cuæ
;

35 
CURLcode
 
ªs
 = 
CURLE_OK
;

37 
cuæ
 = 
	`cuæ_ósy_öô
();

38 if(
cuæ
) {

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

41 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

45 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imaps://imap.example.com/INBOX/;UID=1");

55 #ifde‡
SKIP_PEER_VERIFICATION


56 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

63 #ifde‡
SKIP_HOSTNAME_VERFICATION


64 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYHOST
, 0L);

70 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

73 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

76 if(
ªs
 !
CURLE_OK
)

77 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

78 
	`cuæ_ósy_°ªº‹
(
ªs
));

81 
	`cuæ_ósy_˛ónup
(
cuæ
);

84  ()
ªs
;

85 
	}
}

	@docs/examples/imap-store.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com/INBOX");

48 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "STORE 1 +Flags \\Deleted");

51 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

54 if(
ªs
 !
CURLE_OK
)

55 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

56 
	`cuæ_ósy_°ªº‹
(
ªs
));

60 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "EXPUNGE");

63 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

66 if(
ªs
 !
CURLE_OK
)

67 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

68 
	`cuæ_ósy_°ªº‹
(
ªs
));

72 
	`cuæ_ósy_˛ónup
(
cuæ
);

75  ()
ªs
;

76 
	}
}

	@docs/examples/imap-tls.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

32 
	$maö
()

34 
CURL
 *
cuæ
;

35 
CURLcode
 
ªs
 = 
CURLE_OK
;

37 
cuæ
 = 
	`cuæ_ósy_öô
();

38 if(
cuæ
) {

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

41 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

44 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "imap://imap.example.com/INBOX/;UID=1");

51 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USE_SSL
, ()
CURLUSESSL_ALL
);

64 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CAINFO
, "/path/to/certificate.pem");

69 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

72 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

75 if(
ªs
 !
CURLE_OK
)

76 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

77 
	`cuæ_ósy_°ªº‹
(
ªs
));

80 
	`cuæ_ósy_˛ónup
(
cuæ
);

83  ()
ªs
;

84 
	}
}

	@docs/examples/multi-app.c

24 
	~<°dio.h
>

25 
	~<°rög.h
>

28 
	~<sys/time.h
>

29 
	~<uni°d.h
>

32 
	~<cuæ/cuæ.h
>

38 
	#HANDLECOUNT
 2

	)

39 
	#HTTP_HANDLE
 0

	)

40 
	#FTP_HANDLE
 1

	)

42 
	$maö
()

44 
CURL
 *
h™dÀs
[
HANDLECOUNT
];

45 
CURLM
 *
mu…i_h™dÀ
;

47 
°ûl_ru¬ög
;

48 
i
;

50 
CURLMsg
 *
msg
;

51 
msgs_À·
;

54 
i
=0; i<
HANDLECOUNT
; i++)

55 
h™dÀs
[
i
] = 
	`cuæ_ósy_öô
();

58 
	`cuæ_ósy_£t›t
(
h™dÀs
[
HTTP_HANDLE
], 
CURLOPT_URL
, "http://example.com");

60 
	`cuæ_ósy_£t›t
(
h™dÀs
[
FTP_HANDLE
], 
CURLOPT_URL
, "ftp://example.com");

61 
	`cuæ_ósy_£t›t
(
h™dÀs
[
FTP_HANDLE
], 
CURLOPT_UPLOAD
, 1L);

64 
mu…i_h™dÀ
 = 
	`cuæ_mu…i_öô
();

67 
i
=0; i<
HANDLECOUNT
; i++)

68 
	`cuæ_mu…i_add_h™dÀ
(
mu…i_h™dÀ
, 
h™dÀs
[
i
]);

71 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

74 
timevÆ
 
timeout
;

75 
rc
;

77 
fd_£t
 
fdªad
;

78 
fd_£t
 
fdwrôe
;

79 
fd_£t
 
fdex˚p
;

80 
maxfd
 = -1;

82 
cuæ_timeo
 = -1;

84 
	`FD_ZERO
(&
fdªad
);

85 
	`FD_ZERO
(&
fdwrôe
);

86 
	`FD_ZERO
(&
fdex˚p
);

89 
timeout
.
tv_£c
 = 1;

90 
timeout
.
tv_u£c
 = 0;

92 
	`cuæ_mu…i_timeout
(
mu…i_h™dÀ
, &
cuæ_timeo
);

93 if(
cuæ_timeo
 >= 0) {

94 
timeout
.
tv_£c
 = 
cuæ_timeo
 / 1000;

95 if(
timeout
.
tv_£c
 > 1)

96 
timeout
.
tv_£c
 = 1;

98 
timeout
.
tv_u£c
 = (
cuæ_timeo
 % 1000) * 1000;

102 
	`cuæ_mu…i_fd£t
(
mu…i_h™dÀ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

110 
rc
 = 
	`£À˘
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

112 
rc
) {

118 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

121 } 
°ûl_ru¬ög
);

124 (
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
mu…i_h™dÀ
, &
msgs_À·
))) {

125 i‡(
msg
->msg =
CURLMSG_DONE
) {

126 
idx
, 
found
 = 0;

129 
idx
=0; idx<
HANDLECOUNT
; idx++) {

130 
found
 = (
msg
->
ósy_h™dÀ
 =
h™dÀs
[
idx
]);

131 if(
found
)

135 
idx
) {

136 
HTTP_HANDLE
:

137 
	`¥ötf
("HTTPÅøns„∏com∂ëed wôh sètu†%d\n", 
msg
->
d©a
.
ªsu…
);

139 
FTP_HANDLE
:

140 
	`¥ötf
("FTPÅøns„∏com∂ëed wôh sètu†%d\n", 
msg
->
d©a
.
ªsu…
);

146 
	`cuæ_mu…i_˛ónup
(
mu…i_h™dÀ
);

149 
i
=0; i<
HANDLECOUNT
; i++)

150 
	`cuæ_ósy_˛ónup
(
h™dÀs
[
i
]);

153 
	}
}

	@docs/examples/multi-debugcallback.c

24 
	~<°dio.h
>

25 
	~<°rög.h
>

28 
	~<sys/time.h
>

29 
	~<uni°d.h
>

32 
	~<cuæ/cuæ.h
>

34 
	tboﬁ
;

35 
	#TRUE
 1

	)

38 
	$dump
(c⁄° *
ãxt
,

39 
FILE
 *
°ªam
, *
±r
, 
size_t
 
size
,

40 
boﬁ
 
nohex
)

42 
size_t
 
i
;

43 
size_t
 
c
;

45 
width
=0x10;

47 if(
nohex
)

49 
width
 = 0x40;

51 
	`Ârötf
(
°ªam
, "%s, %10.10ld bytes (0x%8.8lx)\n",

52 
ãxt
, ()
size
, ()size);

54 
i
=0; i<
size
; i+
width
) {

56 
	`Ârötf
(
°ªam
, "%4.4lx: ", ()
i
);

58 if(!
nohex
) {

60 
c
 = 0; c < 
width
; c++)

61 if(
i
+
c
 < 
size
)

62 
	`Ârötf
(
°ªam
, "%02x ", 
±r
[
i
+
c
]);

64 
	`Âuts
(" ", 
°ªam
);

67 
c
 = 0; (¯< 
width
Ë&& (
i
+¯< 
size
); c++) {

69 i‡(
nohex
 && (
i
+
c
+1 < 
size
Ë&& 
±r
[i+c]==0x0D &&Ötr[i+c+1]==0x0A) {

70 
i
+=(
c
+2-
width
);

73 
	`Ârötf
(
°ªam
, "%c",

74 (
±r
[
i
+
c
]>=0x20) && (ptr[i+c]<0x80)?ptr[i+c]:'.');

76 i‡(
nohex
 && (
i
+
c
+2 < 
size
Ë&& 
±r
[i+c+1]==0x0D &&Ötr[i+c+2]==0x0A) {

77 
i
+=(
c
+3-
width
);

81 
	`Âutc
('\n', 
°ªam
);

83 
	`fÊush
(
°ªam
);

84 
	}
}

87 
	$my_åa˚
(
CURL
 *
h™dÀ
, 
cuæ_öfŸy≥
 
ty≥
,

88 *
d©a
, 
size_t
 
size
,

89 *
u£Ω
)

91 c⁄° *
ãxt
;

93 ()
u£Ω
;

94 ()
h™dÀ
;

96 
ty≥
) {

97 
CURLINFO_TEXT
:

98 
	`Ârötf
(
°dîr
, "=Info: %s", 
d©a
);

102 
CURLINFO_HEADER_OUT
:

103 
ãxt
 = "=> Send header";

105 
CURLINFO_DATA_OUT
:

106 
ãxt
 = "=> Send data";

108 
CURLINFO_HEADER_IN
:

109 
ãxt
 = "<= Recv header";

111 
CURLINFO_DATA_IN
:

112 
ãxt
 = "<= Recv data";

116 
	`dump
(
ãxt
, 
°dîr
, 
d©a
, 
size
, 
TRUE
);

118 
	}
}

123 
	$maö
()

125 
CURL
 *
hâp_h™dÀ
;

126 
CURLM
 *
mu…i_h™dÀ
;

128 
°ûl_ru¬ög
;

130 
hâp_h™dÀ
 = 
	`cuæ_ósy_öô
();

133 
	`cuæ_ósy_£t›t
(
hâp_h™dÀ
, 
CURLOPT_URL
, "http://www.example.com/");

135 
	`cuæ_ósy_£t›t
(
hâp_h™dÀ
, 
CURLOPT_DEBUGFUNCTION
, 
my_åa˚
);

136 
	`cuæ_ósy_£t›t
(
hâp_h™dÀ
, 
CURLOPT_VERBOSE
, 1L);

139 
mu…i_h™dÀ
 = 
	`cuæ_mu…i_öô
();

142 
	`cuæ_mu…i_add_h™dÀ
(
mu…i_h™dÀ
, 
hâp_h™dÀ
);

145 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

148 
timevÆ
 
timeout
;

149 
rc
;

151 
fd_£t
 
fdªad
;

152 
fd_£t
 
fdwrôe
;

153 
fd_£t
 
fdex˚p
;

154 
maxfd
 = -1;

156 
cuæ_timeo
 = -1;

158 
	`FD_ZERO
(&
fdªad
);

159 
	`FD_ZERO
(&
fdwrôe
);

160 
	`FD_ZERO
(&
fdex˚p
);

163 
timeout
.
tv_£c
 = 1;

164 
timeout
.
tv_u£c
 = 0;

166 
	`cuæ_mu…i_timeout
(
mu…i_h™dÀ
, &
cuæ_timeo
);

167 if(
cuæ_timeo
 >= 0) {

168 
timeout
.
tv_£c
 = 
cuæ_timeo
 / 1000;

169 if(
timeout
.
tv_£c
 > 1)

170 
timeout
.
tv_£c
 = 1;

172 
timeout
.
tv_u£c
 = (
cuæ_timeo
 % 1000) * 1000;

176 
	`cuæ_mu…i_fd£t
(
mu…i_h™dÀ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

184 
rc
 = 
	`£À˘
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

186 
rc
) {

189 
°ûl_ru¬ög
 = 0;

190 
	`¥ötf
("select()ÑeturnsÉrror,Åhis is badness\n");

195 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

198 } 
°ûl_ru¬ög
);

200 
	`cuæ_mu…i_˛ónup
(
mu…i_h™dÀ
);

202 
	`cuæ_ósy_˛ónup
(
hâp_h™dÀ
);

205 
	}
}

	@docs/examples/multi-double.c

22 
	~<°dio.h
>

23 
	~<°rög.h
>

26 
	~<sys/time.h
>

27 
	~<uni°d.h
>

30 
	~<cuæ/cuæ.h
>

35 
	$maö
()

37 
CURL
 *
hâp_h™dÀ
;

38 
CURL
 *
hâp_h™dÀ2
;

39 
CURLM
 *
mu…i_h™dÀ
;

41 
°ûl_ru¬ög
;

43 
hâp_h™dÀ
 = 
	`cuæ_ósy_öô
();

44 
hâp_h™dÀ2
 = 
	`cuæ_ósy_öô
();

47 
	`cuæ_ósy_£t›t
(
hâp_h™dÀ
, 
CURLOPT_URL
, "http://www.example.com/");

50 
	`cuæ_ósy_£t›t
(
hâp_h™dÀ2
, 
CURLOPT_URL
, "http://localhost/");

53 
mu…i_h™dÀ
 = 
	`cuæ_mu…i_öô
();

56 
	`cuæ_mu…i_add_h™dÀ
(
mu…i_h™dÀ
, 
hâp_h™dÀ
);

57 
	`cuæ_mu…i_add_h™dÀ
(
mu…i_h™dÀ
, 
hâp_h™dÀ2
);

60 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

63 
timevÆ
 
timeout
;

64 
rc
;

66 
fd_£t
 
fdªad
;

67 
fd_£t
 
fdwrôe
;

68 
fd_£t
 
fdex˚p
;

69 
maxfd
 = -1;

71 
cuæ_timeo
 = -1;

73 
	`FD_ZERO
(&
fdªad
);

74 
	`FD_ZERO
(&
fdwrôe
);

75 
	`FD_ZERO
(&
fdex˚p
);

78 
timeout
.
tv_£c
 = 1;

79 
timeout
.
tv_u£c
 = 0;

81 
	`cuæ_mu…i_timeout
(
mu…i_h™dÀ
, &
cuæ_timeo
);

82 if(
cuæ_timeo
 >= 0) {

83 
timeout
.
tv_£c
 = 
cuæ_timeo
 / 1000;

84 if(
timeout
.
tv_£c
 > 1)

85 
timeout
.
tv_£c
 = 1;

87 
timeout
.
tv_u£c
 = (
cuæ_timeo
 % 1000) * 1000;

91 
	`cuæ_mu…i_fd£t
(
mu…i_h™dÀ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

99 
rc
 = 
	`£À˘
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

101 
rc
) {

108 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

111 } 
°ûl_ru¬ög
);

113 
	`cuæ_mu…i_˛ónup
(
mu…i_h™dÀ
);

115 
	`cuæ_ósy_˛ónup
(
hâp_h™dÀ
);

116 
	`cuæ_ósy_˛ónup
(
hâp_h™dÀ2
);

119 
	}
}

	@docs/examples/multi-post.c

24 
	~<°dio.h
>

25 
	~<°rög.h
>

26 
	~<sys/time.h
>

28 
	~<cuæ/cuæ.h
>

30 
	$maö
()

32 
CURL
 *
cuæ
;

34 
CURLM
 *
mu…i_h™dÀ
;

35 
°ûl_ru¬ög
;

37 
cuæ_hâµo°
 *
f‹mpo°
=
NULL
;

38 
cuæ_hâµo°
 *
œ°±r
=
NULL
;

39 
cuæ_¶i°
 *
hódîli°
=
NULL
;

40 c⁄° 
buf
[] = "Expect:";

44 
	`cuæ_f‹madd
(&
f‹mpo°
,

45 &
œ°±r
,

46 
CURLFORM_COPYNAME
, "sendfile",

47 
CURLFORM_FILE
, "postit2.c",

48 
CURLFORM_END
);

51 
	`cuæ_f‹madd
(&
f‹mpo°
,

52 &
œ°±r
,

53 
CURLFORM_COPYNAME
, "filename",

54 
CURLFORM_COPYCONTENTS
, "postit2.c",

55 
CURLFORM_END
);

58 
	`cuæ_f‹madd
(&
f‹mpo°
,

59 &
œ°±r
,

60 
CURLFORM_COPYNAME
, "submit",

61 
CURLFORM_COPYCONTENTS
, "send",

62 
CURLFORM_END
);

64 
cuæ
 = 
	`cuæ_ósy_öô
();

65 
mu…i_h™dÀ
 = 
	`cuæ_mu…i_öô
();

69 
hódîli°
 = 
	`cuæ_¶i°_≠≥nd
(hódîli°, 
buf
);

70 if(
cuæ
 && 
mu…i_h™dÀ
) {

73 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://www.example.com/upload.cgi");

74 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

76 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
hódîli°
);

77 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HTTPPOST
, 
f‹mpo°
);

79 
	`cuæ_mu…i_add_h™dÀ
(
mu…i_h™dÀ
, 
cuæ
);

81 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

84 
timevÆ
 
timeout
;

85 
rc
;

87 
fd_£t
 
fdªad
;

88 
fd_£t
 
fdwrôe
;

89 
fd_£t
 
fdex˚p
;

90 
maxfd
 = -1;

92 
cuæ_timeo
 = -1;

94 
	`FD_ZERO
(&
fdªad
);

95 
	`FD_ZERO
(&
fdwrôe
);

96 
	`FD_ZERO
(&
fdex˚p
);

99 
timeout
.
tv_£c
 = 1;

100 
timeout
.
tv_u£c
 = 0;

102 
	`cuæ_mu…i_timeout
(
mu…i_h™dÀ
, &
cuæ_timeo
);

103 if(
cuæ_timeo
 >= 0) {

104 
timeout
.
tv_£c
 = 
cuæ_timeo
 / 1000;

105 if(
timeout
.
tv_£c
 > 1)

106 
timeout
.
tv_£c
 = 1;

108 
timeout
.
tv_u£c
 = (
cuæ_timeo
 % 1000) * 1000;

112 
	`cuæ_mu…i_fd£t
(
mu…i_h™dÀ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

120 
rc
 = 
	`£À˘
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

122 
rc
) {

129 
	`¥ötf
("perform!\n");

130 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

131 
	`¥ötf
("ru¬ög: %d!\n", 
°ûl_ru¬ög
);

134 } 
°ûl_ru¬ög
);

136 
	`cuæ_mu…i_˛ónup
(
mu…i_h™dÀ
);

139 
	`cuæ_ósy_˛ónup
(
cuæ
);

142 
	`cuæ_f‹m‰ì
(
f‹mpo°
);

145 
	`cuæ_¶i°_‰ì_Æl
 (
hódîli°
);

148 
	}
}

	@docs/examples/multi-single.c

24 
	~<°dio.h
>

25 
	~<°rög.h
>

28 
	~<sys/time.h
>

29 
	~<uni°d.h
>

32 
	~<cuæ/cuæ.h
>

37 
	$maö
()

39 
CURL
 *
hâp_h™dÀ
;

40 
CURLM
 *
mu…i_h™dÀ
;

42 
°ûl_ru¬ög
;

44 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

46 
hâp_h™dÀ
 = 
	`cuæ_ósy_öô
();

49 
	`cuæ_ósy_£t›t
(
hâp_h™dÀ
, 
CURLOPT_URL
, "http://www.example.com/");

52 
mu…i_h™dÀ
 = 
	`cuæ_mu…i_öô
();

55 
	`cuæ_mu…i_add_h™dÀ
(
mu…i_h™dÀ
, 
hâp_h™dÀ
);

58 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

61 
timevÆ
 
timeout
;

62 
rc
;

64 
fd_£t
 
fdªad
;

65 
fd_£t
 
fdwrôe
;

66 
fd_£t
 
fdex˚p
;

67 
maxfd
 = -1;

69 
cuæ_timeo
 = -1;

71 
	`FD_ZERO
(&
fdªad
);

72 
	`FD_ZERO
(&
fdwrôe
);

73 
	`FD_ZERO
(&
fdex˚p
);

76 
timeout
.
tv_£c
 = 1;

77 
timeout
.
tv_u£c
 = 0;

79 
	`cuæ_mu…i_timeout
(
mu…i_h™dÀ
, &
cuæ_timeo
);

80 if(
cuæ_timeo
 >= 0) {

81 
timeout
.
tv_£c
 = 
cuæ_timeo
 / 1000;

82 if(
timeout
.
tv_£c
 > 1)

83 
timeout
.
tv_£c
 = 1;

85 
timeout
.
tv_u£c
 = (
cuæ_timeo
 % 1000) * 1000;

89 
	`cuæ_mu…i_fd£t
(
mu…i_h™dÀ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

97 
rc
 = 
	`£À˘
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

99 
rc
) {

102 
°ûl_ru¬ög
 = 0;

103 
	`¥ötf
("select()ÑeturnsÉrror,Åhis is badness\n");

108 
	`cuæ_mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

111 } 
°ûl_ru¬ög
);

113 
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…i_h™dÀ
, 
hâp_h™dÀ
);

115 
	`cuæ_ósy_˛ónup
(
hâp_h™dÀ
);

117 
	`cuæ_mu…i_˛ónup
(
mu…i_h™dÀ
);

119 
	`cuæ_globÆ_˛ónup
();

122 
	}
}

	@docs/examples/multi-uv.c

37 
	~<°dio.h
>

38 
	~<°dlib.h
>

39 
	~<uv.h
>

40 
	~<cuæ/cuæ.h
>

42 
uv_lo›_t
 *
	glo›
;

43 
CURLM
 *
	gcuæ_h™dÀ
;

44 
uv_timî_t
 
	gtimeout
;

46 
	scuæ_c⁄ãxt_s
 {

47 
uv_pﬁl_t
 
	mpﬁl_h™dÀ
;

48 
cuæ_sockë_t
 
	msockfd
;

49 } 
	tcuæ_c⁄ãxt_t
;

51 
cuæ_c⁄ãxt_t
* 
	$¸óã_cuæ_c⁄ãxt
(
cuæ_sockë_t
 
sockfd
)

53 
cuæ_c⁄ãxt_t
 *
c⁄ãxt
;

55 
c⁄ãxt
 = (
cuæ_c⁄ãxt_t
 *Ë
	`mÆloc
( *context);

57 
c⁄ãxt
->
sockfd
 = sockfd;

59 
	`uv_pﬁl_öô_sockë
(
lo›
, &
c⁄ãxt
->
pﬁl_h™dÀ
, 
sockfd
);

60 
c⁄ãxt
->
pﬁl_h™dÀ
.
d©a
 = context;

62  
c⁄ãxt
;

63 
	}
}

65 
	$cuæ_˛o£_cb
(
uv_h™dÀ_t
 *
h™dÀ
)

67 
cuæ_c⁄ãxt_t
* 
c⁄ãxt
 = (cuæ_c⁄ãxt_t*Ë
h™dÀ
->
d©a
;

68 
	`‰ì
(
c⁄ãxt
);

69 
	}
}

71 
	$de°roy_cuæ_c⁄ãxt
(
cuæ_c⁄ãxt_t
 *
c⁄ãxt
)

73 
	`uv_˛o£
((
uv_h™dÀ_t
*Ë&
c⁄ãxt
->
pﬁl_h™dÀ
, 
cuæ_˛o£_cb
);

74 
	}
}

77 
	$add_dow∆ﬂd
(c⁄° *
uæ
, 
num
)

79 
fûíame
[50];

80 
FILE
 *
fûe
;

81 
CURL
 *
h™dÀ
;

83 
	`•rötf
(
fûíame
, "%d.dow∆ﬂd", 
num
);

85 
fûe
 = 
	`f›í
(
fûíame
, "w");

86 i‡(
fûe
 =
NULL
) {

87 
	`Ârötf
(
°dîr
, "Eº‹ o≥nög %s\n", 
fûíame
);

91 
h™dÀ
 = 
	`cuæ_ósy_öô
();

92 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
CURLOPT_WRITEDATA
, 
fûe
);

93 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
CURLOPT_URL
, 
uæ
);

94 
	`cuæ_mu…i_add_h™dÀ
(
cuæ_h™dÀ
, 
h™dÀ
);

95 
	`Ârötf
(
°dîr
, "Added dow∆ﬂd %†-> %s\n", 
uæ
, 
fûíame
);

96 
	}
}

98 
	$cuæ_≥rf‹m
(
uv_pﬁl_t
 *
ªq
, 
°©us
, 
evíts
)

100 
ru¬ög_h™dÀs
;

101 
Êags
 = 0;

102 
cuæ_c⁄ãxt_t
 *
c⁄ãxt
;

103 *
d⁄e_uæ
;

104 
CURLMsg
 *
mesßge
;

105 
≥ndög
;

107 
	`uv_timî_°›
(&
timeout
);

109 i‡(
evíts
 & 
UV_READABLE
)

110 
Êags
 |
CURL_CSELECT_IN
;

111 i‡(
evíts
 & 
UV_WRITABLE
)

112 
Êags
 |
CURL_CSELECT_OUT
;

114 
c⁄ãxt
 = (
cuæ_c⁄ãxt_t
*)
ªq
;

116 
	`cuæ_mu…i_sockë_a˘i⁄
(
cuæ_h™dÀ
, 
c⁄ãxt
->
sockfd
, 
Êags
,

117 &
ru¬ög_h™dÀs
);

119 (
mesßge
 = 
	`cuæ_mu…i_öfo_ªad
(
cuæ_h™dÀ
, &
≥ndög
))) {

120 
mesßge
->
msg
) {

121 
CURLMSG_DONE
:

122 
	`cuæ_ósy_gëöfo
(
mesßge
->
ósy_h™dÀ
, 
CURLINFO_EFFECTIVE_URL
,

123 &
d⁄e_uæ
);

124 
	`¥ötf
("%†DONE\n", 
d⁄e_uæ
);

126 
	`cuæ_mu…i_ªmove_h™dÀ
(
cuæ_h™dÀ
, 
mesßge
->
ósy_h™dÀ
);

127 
	`cuæ_ósy_˛ónup
(
mesßge
->
ósy_h™dÀ
);

131 
	`Ârötf
(
°dîr
, "CURLMSG default\n");

132 
	`ab‹t
();

135 
	}
}

137 
	$⁄_timeout
(
uv_timî_t
 *
ªq
, 
°©us
)

139 
ru¬ög_h™dÀs
;

140 
	`cuæ_mu…i_sockë_a˘i⁄
(
cuæ_h™dÀ
, 
CURL_SOCKET_TIMEOUT
, 0,

141 &
ru¬ög_h™dÀs
);

142 
	}
}

144 
	$°¨t_timeout
(
CURLM
 *
mu…i
, 
timeout_ms
, *
u£Ω
)

146 i‡(
timeout_ms
 <= 0)

147 
timeout_ms
 = 1;

149 
	`uv_timî_°¨t
(&
timeout
, 
⁄_timeout
, 
timeout_ms
, 0);

150 
	}
}

152 
	$h™dÀ_sockë
(
CURL
 *
ósy
, 
cuæ_sockë_t
 
s
, 
a˘i⁄
, *
u£Ω
,

153 *
sockëp
)

155 
cuæ_c⁄ãxt_t
 *
cuæ_c⁄ãxt
;

156 i‡(
a˘i⁄
 =
CURL_POLL_IN
 ||á˘i⁄ =
CURL_POLL_OUT
) {

157 i‡(
sockëp
) {

158 
cuæ_c⁄ãxt
 = (
cuæ_c⁄ãxt_t
*Ë
sockëp
;

161 
cuæ_c⁄ãxt
 = 
	`¸óã_cuæ_c⁄ãxt
(
s
);

163 
	`cuæ_mu…i_assign
(
cuæ_h™dÀ
, 
s
, (*Ë
cuæ_c⁄ãxt
);

166 
a˘i⁄
) {

167 
CURL_POLL_IN
:

168 
	`uv_pﬁl_°¨t
(&
cuæ_c⁄ãxt
->
pﬁl_h™dÀ
, 
UV_READABLE
, 
cuæ_≥rf‹m
);

170 
CURL_POLL_OUT
:

171 
	`uv_pﬁl_°¨t
(&
cuæ_c⁄ãxt
->
pﬁl_h™dÀ
, 
UV_WRITABLE
, 
cuæ_≥rf‹m
);

173 
CURL_POLL_REMOVE
:

174 i‡(
sockëp
) {

175 
	`uv_pﬁl_°›
(&((
cuæ_c⁄ãxt_t
*)
sockëp
)->
pﬁl_h™dÀ
);

176 
	`de°roy_cuæ_c⁄ãxt
((
cuæ_c⁄ãxt_t
*Ë
sockëp
);

177 
	`cuæ_mu…i_assign
(
cuæ_h™dÀ
, 
s
, 
NULL
);

181 
	`ab‹t
();

185 
	}
}

187 
	$maö
(
¨gc
, **
¨gv
)

189 
lo›
 = 
	`uv_deÁu…_lo›
();

191 i‡(
¨gc
 <= 1)

194 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
)) {

195 
	`Ârötf
(
°dîr
, "CouldÇot init cURL\n");

199 
	`uv_timî_öô
(
lo›
, &
timeout
);

201 
cuæ_h™dÀ
 = 
	`cuæ_mu…i_öô
();

202 
	`cuæ_mu…i_£t›t
(
cuæ_h™dÀ
, 
CURLMOPT_SOCKETFUNCTION
, 
h™dÀ_sockë
);

203 
	`cuæ_mu…i_£t›t
(
cuæ_h™dÀ
, 
CURLMOPT_TIMERFUNCTION
, 
°¨t_timeout
);

205 
¨gc
-- > 1) {

206 
	`add_dow∆ﬂd
(
¨gv
[
¨gc
],árgc);

209 
	`uv_run
(
lo›
, 
UV_RUN_DEFAULT
);

210 
	`cuæ_mu…i_˛ónup
(
cuæ_h™dÀ
);

212 
	}
}

	@docs/examples/multithread.c

25 
	~<°dio.h
>

26 
	~<±hªad.h
>

27 
	~<cuæ/cuæ.h
>

29 
	#NUMT
 4

	)

40 c⁄° * c⁄° 
	guæs
[
NUMT
]= {

47 *
	$puŒ_⁄e_uæ
(*
uæ
)

49 
CURL
 *
cuæ
;

51 
cuæ
 = 
	`cuæ_ósy_öô
();

52 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
uæ
);

53 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

54 
	`cuæ_ósy_˛ónup
(
cuæ
);

56  
NULL
;

57 
	}
}

66 
	$maö
(
¨gc
, **
¨gv
)

68 
±hªad_t
 
tid
[
NUMT
];

69 
i
;

70 
îr‹
;

73 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

75 
i
=0; i< 
NUMT
; i++) {

76 
îr‹
 = 
	`±hªad_¸óã
(&
tid
[
i
],

77 
NULL
,

78 
puŒ_⁄e_uæ
,

79 (*)
uæs
[
i
]);

80 if(0 !
îr‹
)

81 
	`Ârötf
(
°dîr
, "Couldn'àru¿thªadÇumbî %d,Éºnÿ%d\n", 
i
, 
îr‹
);

83 
	`Ârötf
(
°dîr
, "Thªad %d, gë†%s\n", 
i
, 
uæs
[i]);

87 
i
=0; i< 
NUMT
; i++) {

88 
îr‹
 = 
	`±hªad_joö
(
tid
[
i
], 
NULL
);

89 
	`Ârötf
(
°dîr
, "Thªad %dÅîmö©ed\n", 
i
);

93 
	}
}

	@docs/examples/opensslthreadlock.c

32 
	~<°dio.h
>

33 
	~<±hªad.h
>

34 
	~<›ís¶/îr.h
>

36 
	#MUTEX_TYPE
 
±hªad_muãx_t


	)

37 
	#MUTEX_SETUP
(
x
Ë
	`±hªad_muãx_öô
(&(x), 
NULL
)

	)

38 
	#MUTEX_CLEANUP
(
x
Ë
	`±hªad_muãx_de°roy
(&(x))

	)

39 
	#MUTEX_LOCK
(
x
Ë
	`±hªad_muãx_lock
(&(x))

	)

40 
	#MUTEX_UNLOCK
(
x
Ë
	`±hªad_muãx_u∆ock
(&(x))

	)

41 
	#THREAD_ID
 
	`±hªad_£lf
–)

	)

44 
	$h™dÀ_îr‹
(c⁄° *
fûe
, 
löío
, c⁄° *
msg
){

45 
	`Ârötf
(
°dîr
, "** %s:%d %s\n", 
fûe
, 
löío
, 
msg
);

46 
	`ERR_¥öt_îr‹s_Â
(
°dîr
);

48 
	}
}

51 
MUTEX_TYPE
 *
	gmuãx_buf

NULL
;

54 
	$lockög_fun˘i⁄
(
mode
, 
n
, c⁄° * 
fûe
, 
löe
)

56 i‡(
mode
 & 
CRYPTO_LOCK
)

57 
	`MUTEX_LOCK
(
muãx_buf
[
n
]);

59 
	`MUTEX_UNLOCK
(
muãx_buf
[
n
]);

60 
	}
}

62 
	$id_fun˘i⁄
()

64  (()
THREAD_ID
);

65 
	}
}

67 
	$thªad_£tup
()

69 
i
;

71 
muãx_buf
 = 
	`mÆloc
(
	`CRYPTO_num_locks
–Ë* (
MUTEX_TYPE
));

72 i‡(!
muãx_buf
)

74 
i
 = 0; i < 
	`CRYPTO_num_locks
( ); i++)

75 
	`MUTEX_SETUP
(
muãx_buf
[
i
]);

76 
	`CRYPTO_£t_id_ˇŒback
(
id_fun˘i⁄
);

77 
	`CRYPTO_£t_lockög_ˇŒback
(
lockög_fun˘i⁄
);

79 
	}
}

81 
	$thªad_˛ónup
()

83 
i
;

85 i‡(!
muãx_buf
)

87 
	`CRYPTO_£t_id_ˇŒback
(
NULL
);

88 
	`CRYPTO_£t_lockög_ˇŒback
(
NULL
);

89 
i
 = 0; i < 
	`CRYPTO_num_locks
( ); i++)

90 
	`MUTEX_CLEANUP
(
muãx_buf
[
i
]);

91 
	`‰ì
(
muãx_buf
);

92 
muãx_buf
 = 
NULL
;

94 
	}
}

	@docs/examples/persistant.c

22 
	~<°dio.h
>

23 
	~<uni°d.h
>

24 
	~<cuæ/cuæ.h
>

26 
	$maö
()

28 
CURL
 *
cuæ
;

29 
CURLcode
 
ªs
;

31 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

33 
cuæ
 = 
	`cuæ_ósy_öô
();

34 if(
cuæ
) {

35 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

36 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com/");

42 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

44 if(
ªs
 !
CURLE_OK
)

45 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

46 
	`cuæ_ósy_°ªº‹
(
ªs
));

50 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com/docs/");

53 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

55 if(
ªs
 !
CURLE_OK
)

56 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

57 
	`cuæ_ósy_°ªº‹
(
ªs
));

60 
	`cuæ_ósy_˛ónup
(
cuæ
);

64 
	}
}

	@docs/examples/pop3-dele.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "pop3://pop.example.com/1");

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "DELE");

49 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_NOBODY
, 1L);

52 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

55 if(
ªs
 !
CURLE_OK
)

56 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

57 
	`cuæ_ósy_°ªº‹
(
ªs
));

60 
	`cuæ_ósy_˛ónup
(
cuæ
);

63  ()
ªs
;

64 
	}
}

	@docs/examples/pop3-list.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "pop3://pop.example.com");

46 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

49 if(
ªs
 !
CURLE_OK
)

50 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

51 
	`cuæ_ósy_°ªº‹
(
ªs
));

54 
	`cuæ_ósy_˛ónup
(
cuæ
);

57  ()
ªs
;

58 
	}
}

	@docs/examples/pop3-multi.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

32 
	#MULTI_PERFORM_HANG_TIMEOUT
 60 * 1000

	)

34 
timevÆ
 
	$tvnow
()

36 
timevÆ
 
now
;

39 
now
.
tv_£c
 = ()
	`time
(
NULL
);

40 
now
.
tv_u£c
 = 0;

42  
now
;

43 
	}
}

45 
	$tvdiff
(
timevÆ
 
√wî
, timevÆ 
ﬁdî
)

47  (
√wî
.
tv_£c
 - 
ﬁdî
.tv_sec) * 1000 +

48 (
√wî
.
tv_u£c
 - 
ﬁdî
.tv_usec) / 1000;

49 
	}
}

51 
	$maö
()

53 
CURL
 *
cuæ
;

54 
CURLM
 *
mcuæ
;

55 
°ûl_ru¬ög
 = 1;

56 
timevÆ
 
mp_°¨t
;

58 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

60 
cuæ
 = 
	`cuæ_ósy_öô
();

61 if(!
cuæ
)

64 
mcuæ
 = 
	`cuæ_mu…i_öô
();

65 if(!
mcuæ
)

69 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

70 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

73 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "pop3://pop.example.com/1");

76 
	`cuæ_mu…i_add_h™dÀ
(
mcuæ
, 
cuæ
);

79 
mp_°¨t
 = 
	`tvnow
();

82 
	`cuæ_mu…i_≥rf‹m
(
mcuæ
, &
°ûl_ru¬ög
);

84 
°ûl_ru¬ög
) {

85 
timevÆ
 
timeout
;

86 
fd_£t
 
fdªad
;

87 
fd_£t
 
fdwrôe
;

88 
fd_£t
 
fdex˚p
;

89 
maxfd
 = -1;

90 
rc
;

92 
cuæ_timeo
 = -1;

95 
	`FD_ZERO
(&
fdªad
);

96 
	`FD_ZERO
(&
fdwrôe
);

97 
	`FD_ZERO
(&
fdex˚p
);

100 
timeout
.
tv_£c
 = 1;

101 
timeout
.
tv_u£c
 = 0;

103 
	`cuæ_mu…i_timeout
(
mcuæ
, &
cuæ_timeo
);

104 if(
cuæ_timeo
 >= 0) {

105 
timeout
.
tv_£c
 = 
cuæ_timeo
 / 1000;

106 if(
timeout
.
tv_£c
 > 1)

107 
timeout
.
tv_£c
 = 1;

109 
timeout
.
tv_u£c
 = (
cuæ_timeo
 % 1000) * 1000;

113 
	`cuæ_mu…i_fd£t
(
mcuæ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

120 
rc
 = 
	`£À˘
(
maxfd
 + 1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

122 if(
	`tvdiff
(
	`tvnow
(), 
mp_°¨t
Ë> 
MULTI_PERFORM_HANG_TIMEOUT
) {

123 
	`Ârötf
(
°dîr
,

128 
rc
) {

133 
	`cuæ_mu…i_≥rf‹m
(
mcuæ
, &
°ûl_ru¬ög
);

139 
	`cuæ_mu…i_ªmove_h™dÀ
(
mcuæ
, 
cuæ
);

140 
	`cuæ_mu…i_˛ónup
(
mcuæ
);

141 
	`cuæ_ósy_˛ónup
(
cuæ
);

142 
	`cuæ_globÆ_˛ónup
();

145 
	}
}

	@docs/examples/pop3-noop.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "pop3://pop.example.com");

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "NOOP");

49 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_NOBODY
, 1L);

52 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

55 if(
ªs
 !
CURLE_OK
)

56 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

57 
	`cuæ_ósy_°ªº‹
(
ªs
));

60 
	`cuæ_ósy_˛ónup
(
cuæ
);

63  ()
ªs
;

64 
	}
}

	@docs/examples/pop3-retr.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "pop3://pop.example.com/1");

46 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

49 if(
ªs
 !
CURLE_OK
)

50 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

51 
	`cuæ_ósy_°ªº‹
(
ªs
));

54 
	`cuæ_ósy_˛ónup
(
cuæ
);

57  ()
ªs
;

58 
	}
}

	@docs/examples/pop3-ssl.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

32 
	$maö
()

34 
CURL
 *
cuæ
;

35 
CURLcode
 
ªs
 = 
CURLE_OK
;

37 
cuæ
 = 
	`cuæ_ósy_öô
();

38 if(
cuæ
) {

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

41 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

45 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "pop3s://pop.example.com/1");

55 #ifde‡
SKIP_PEER_VERIFICATION


56 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

63 #ifde‡
SKIP_HOSTNAME_VERFICATION


64 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYHOST
, 0L);

70 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

73 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

76 if(
ªs
 !
CURLE_OK
)

77 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

78 
	`cuæ_ósy_°ªº‹
(
ªs
));

81 
	`cuæ_ósy_˛ónup
(
cuæ
);

84  ()
ªs
;

85 
	}
}

	@docs/examples/pop3-stat.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "pop3://pop.example.com");

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "STAT");

49 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_NOBODY
, 1L);

52 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

55 if(
ªs
 !
CURLE_OK
)

56 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

57 
	`cuæ_ósy_°ªº‹
(
ªs
));

60 
	`cuæ_ósy_˛ónup
(
cuæ
);

63  ()
ªs
;

64 
	}
}

	@docs/examples/pop3-tls.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

32 
	$maö
()

34 
CURL
 *
cuæ
;

35 
CURLcode
 
ªs
 = 
CURLE_OK
;

37 
cuæ
 = 
	`cuæ_ósy_öô
();

38 if(
cuæ
) {

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

41 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

44 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "pop3://pop.example.com/1");

51 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USE_SSL
, ()
CURLUSESSL_ALL
);

64 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CAINFO
, "/path/to/certificate.pem");

69 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

72 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

75 if(
ªs
 !
CURLE_OK
)

76 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

77 
	`cuæ_ósy_°ªº‹
(
ªs
));

80 
	`cuæ_ósy_˛ónup
(
cuæ
);

83  ()
ªs
;

84 
	}
}

	@docs/examples/pop3-top.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "pop3://pop.example.com");

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "TOP 1 0");

49 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

52 if(
ªs
 !
CURLE_OK
)

53 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

54 
	`cuæ_ósy_°ªº‹
(
ªs
));

57 
	`cuæ_ósy_˛ónup
(
cuæ
);

60  ()
ªs
;

61 
	}
}

	@docs/examples/pop3-uidl.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

31 
	$maö
()

33 
CURL
 *
cuæ
;

34 
CURLcode
 
ªs
 = 
CURLE_OK
;

36 
cuæ
 = 
	`cuæ_ósy_öô
();

37 if(
cuæ
) {

39 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "pop3://pop.example.com");

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "UIDL");

49 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

52 if(
ªs
 !
CURLE_OK
)

53 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

54 
	`cuæ_ósy_°ªº‹
(
ªs
));

57 
	`cuæ_ósy_˛ónup
(
cuæ
);

60  ()
ªs
;

61 
	}
}

	@docs/examples/post-callback.c

25 
	~<°dio.h
>

26 
	~<°rög.h
>

27 
	~<cuæ/cuæ.h
>

29 c⁄° 
	gd©a
[]="this is what weÖostÅoÅhe silly web server";

31 
	sWrôeThis
 {

32 c⁄° *
	mªad±r
;

33 
	msizñe·
;

36 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

38 
WrôeThis
 *
pooh
 = (WrôeThi†*)
u£Ω
;

40 if(
size
*
nmemb
 < 1)

43 if(
pooh
->
sizñe·
) {

44 *(*)
±r
 = 
pooh
->
ªad±r
[0];

45 
pooh
->
ªad±r
++;

46 
pooh
->
sizñe·
--;

51 
	}
}

53 
	$maö
()

55 
CURL
 *
cuæ
;

56 
CURLcode
 
ªs
;

58 
WrôeThis
 
pooh
;

60 
pooh
.
ªad±r
 = 
d©a
;

61 
pooh
.
sizñe·
 = ()
	`°æí
(
d©a
);

64 
ªs
 = 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

66 if(
ªs
 !
CURLE_OK
) {

67 
	`Ârötf
(
°dîr
, "curl_global_init() failed: %s\n",

68 
	`cuæ_ósy_°ªº‹
(
ªs
));

73 
cuæ
 = 
	`cuæ_ósy_öô
();

74 if(
cuæ
) {

76 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com/index.cgi");

79 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

82 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

85 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
pooh
);

88 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

97 #ifde‡
USE_CHUNKED


99 
cuæ_¶i°
 *
chunk
 = 
NULL
;

101 
chunk
 = 
	`cuæ_¶i°_≠≥nd
(chunk, "Transfer-Encoding: chunked");

102 
ªs
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
chunk
);

109 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, 
pooh
.
sizñe·
);

112 #ifde‡
DISABLE_EXPECT


122 
cuæ_¶i°
 *
chunk
 = 
NULL
;

124 
chunk
 = 
	`cuæ_¶i°_≠≥nd
(chunk, "Expect:");

125 
ªs
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
chunk
);

132 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

134 if(
ªs
 !
CURLE_OK
)

135 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

136 
	`cuæ_ósy_°ªº‹
(
ªs
));

139 
	`cuæ_ósy_˛ónup
(
cuæ
);

141 
	`cuæ_globÆ_˛ónup
();

143 
	}
}

	@docs/examples/postinmemory.c

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<°rög.h
>

25 
	~<cuæ/cuæ.h
>

27 
	sMem‹ySåu˘
 {

28 *
	mmem‹y
;

29 
size_t
 
	msize
;

32 
size_t


33 
	$WrôeMem‹yCÆlback
(*
c⁄ã¡s
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

35 
size_t
 
ªÆsize
 = 
size
 * 
nmemb
;

36 
Mem‹ySåu˘
 *
mem
 = (Mem‹ySåu˘ *)
u£Ω
;

38 
mem
->
mem‹y
 = 
	`ªÆloc
(mem->mem‹y, mem->
size
 + 
ªÆsize
 + 1);

39 if(
mem
->
mem‹y
 =
NULL
) {

41 
	`¥ötf
("notÉnough memory (reallocÑeturned NULL)\n");

45 
	`mem˝y
(&(
mem
->
mem‹y
[mem->
size
]), 
c⁄ã¡s
, 
ªÆsize
);

46 
mem
->
size
 +
ªÆsize
;

47 
mem
->
mem‹y
[mem->
size
] = 0;

49  
ªÆsize
;

50 
	}
}

52 
	$maö
()

54 
CURL
 *
cuæ
;

55 
CURLcode
 
ªs
;

56 
Mem‹ySåu˘
 
chunk
;

57 c⁄° *
po°this
="Field=1&Field=2&Field=3";

59 
chunk
.
mem‹y
 = 
	`mÆloc
(1);

60 
chunk
.
size
 = 0;

62 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

63 
cuæ
 = 
	`cuæ_ósy_öô
();

64 if(
cuæ
) {

66 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://www.example.org/");

69 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
WrôeMem‹yCÆlback
);

72 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, (*)&
chunk
);

76 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERAGENT
, "libcurl-agent/1.0");

78 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, 
po°this
);

82 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, ()
	`°æí
(
po°this
));

85 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

87 if(
ªs
 !
CURLE_OK
) {

88 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

89 
	`cuæ_ósy_°ªº‹
(
ªs
));

98 
	`¥ötf
("%s\n",
chunk
.
mem‹y
);

102 
	`cuæ_ósy_˛ónup
(
cuæ
);

104 if(
chunk
.
mem‹y
)

105 
	`‰ì
(
chunk
.
mem‹y
);

108 
	`cuæ_globÆ_˛ónup
();

111 
	}
}

	@docs/examples/postit2.c

36 
	~<°dio.h
>

37 
	~<°rög.h
>

39 
	~<cuæ/cuæ.h
>

41 
	$maö
(
¨gc
, *
¨gv
[])

43 
CURL
 *
cuæ
;

44 
CURLcode
 
ªs
;

46 
cuæ_hâµo°
 *
f‹mpo°
=
NULL
;

47 
cuæ_hâµo°
 *
œ°±r
=
NULL
;

48 
cuæ_¶i°
 *
hódîli°
=
NULL
;

49 c⁄° 
buf
[] = "Expect:";

51 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

54 
	`cuæ_f‹madd
(&
f‹mpo°
,

55 &
œ°±r
,

56 
CURLFORM_COPYNAME
, "sendfile",

57 
CURLFORM_FILE
, "postit2.c",

58 
CURLFORM_END
);

61 
	`cuæ_f‹madd
(&
f‹mpo°
,

62 &
œ°±r
,

63 
CURLFORM_COPYNAME
, "filename",

64 
CURLFORM_COPYCONTENTS
, "postit2.c",

65 
CURLFORM_END
);

69 
	`cuæ_f‹madd
(&
f‹mpo°
,

70 &
œ°±r
,

71 
CURLFORM_COPYNAME
, "submit",

72 
CURLFORM_COPYCONTENTS
, "send",

73 
CURLFORM_END
);

75 
cuæ
 = 
	`cuæ_ósy_öô
();

78 
hódîli°
 = 
	`cuæ_¶i°_≠≥nd
(hódîli°, 
buf
);

79 if(
cuæ
) {

81 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com/examplepost.cgi");

82 i‡–(
¨gc
 =2Ë&& (!
	`°rcmp
(
¨gv
[1], "noexpectheader")) )

84 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
hódîli°
);

85 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HTTPPOST
, 
f‹mpo°
);

88 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

90 if(
ªs
 !
CURLE_OK
)

91 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

92 
	`cuæ_ósy_°ªº‹
(
ªs
));

95 
	`cuæ_ósy_˛ónup
(
cuæ
);

98 
	`cuæ_f‹m‰ì
(
f‹mpo°
);

100 
	`cuæ_¶i°_‰ì_Æl
 (
hódîli°
);

103 
	}
}

	@docs/examples/progressfunc.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

25 
	#STOP_DOWNLOAD_AFTER_THIS_MANY_BYTES
 6000

	)

26 
	#MINIMAL_PROGRESS_FUNCTIONALITY_INTERVAL
 3

	)

28 
	smy¥ogªss
 {

29 
	mœ°ru¡ime
;

30 
CURL
 *
	mcuæ
;

34 
	$x„röfo
(*
p
,

35 
cuæ_off_t
 
d…ŸÆ
, cuæ_off_à
d ow
,

36 
cuæ_off_t
 
u…ŸÆ
, cuæ_off_à
u ow
)

38 
my¥ogªss
 *
myp
 = (my¥ogªs†*)
p
;

39 
CURL
 *
cuæ
 = 
myp
->curl;

40 
cuπime
 = 0;

42 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_TOTAL_TIME
, &
cuπime
);

47 if((
cuπime
 - 
myp
->
œ°ru¡ime
Ë>
MINIMAL_PROGRESS_FUNCTIONALITY_INTERVAL
) {

48 
myp
->
œ°ru¡ime
 = 
cuπime
;

49 
	`Ârötf
(
°dîr
, "TOTAL TIME: %‡\r\n", 
cuπime
);

52 
	`Ârötf
(
°dîr
, "UP: %" 
CURL_FORMAT_CURL_OFF_T
 " of %" CURL_FORMAT_CURL_OFF_T

53 " DOWN: %" 
CURL_FORMAT_CURL_OFF_T
 " of %" CURL_FORMAT_CURL_OFF_T

55 
u ow
, 
u…ŸÆ
, 
d ow
, 
d…ŸÆ
);

57 if(
d ow
 > 
STOP_DOWNLOAD_AFTER_THIS_MANY_BYTES
)

60 
	}
}

63 
	$ﬁdî_¥ogªss
(*
p
,

64 
d…ŸÆ
, 
d ow
,

65 
u…ŸÆ
, 
u ow
)

67  
	`x„röfo
(
p
,

68 (
cuæ_off_t
)
d…ŸÆ
,

69 (
cuæ_off_t
)
d ow
,

70 (
cuæ_off_t
)
u…ŸÆ
,

71 (
cuæ_off_t
)
u ow
);

72 
	}
}

75 
	$maö
()

77 
CURL
 *
cuæ
;

78 
CURLcode
 
ªs
 = 
CURLE_OK
;

79 
my¥ogªss
 
¥og
;

81 
cuæ
 = 
	`cuæ_ósy_öô
();

82 if(
cuæ
) {

83 
¥og
.
œ°ru¡ime
 = 0;

84 
¥og
.
cuæ
 = curl;

86 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com/");

88 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PROGRESSFUNCTION
, 
ﬁdî_¥ogªss
);

90 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PROGRESSDATA
, &
¥og
);

92 #i‡
LIBCURL_VERSION_NUM
 >= 0x072000

103 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_XFERINFOFUNCTION
, 
x„röfo
);

106 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_XFERINFODATA
, &
¥og
);

109 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_NOPROGRESS
, 0L);

110 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

112 if(
ªs
 !
CURLE_OK
)

113 
	`Ârötf
(
°dîr
, "%s\n", 
	`cuæ_ósy_°ªº‹
(
ªs
));

116 
	`cuæ_ósy_˛ónup
(
cuæ
);

118  ()
ªs
;

119 
	}
}

	@docs/examples/resolve.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

25 
	$maö
()

27 
CURL
 *
cuæ
;

28 
CURLcode
 
ªs
 = 
CURLE_OK
;

29 
cuæ_¶i°
 *
ho°
 = 
NULL
;

36 
ho°
 = 
	`cuæ_¶i°_≠≥nd
(
NULL
, "example.com:80:127.0.0.1");

38 
cuæ
 = 
	`cuæ_ósy_öô
();

39 if(
cuæ
) {

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RESOLVE
, 
ho°
);

41 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com");

42 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

45 
	`cuæ_ósy_˛ónup
(
cuæ
);

48 
	`cuæ_¶i°_‰ì_Æl
(
ho°
);

50  ()
ªs
;

51 
	}
}

	@docs/examples/rtsp.c

31 
	~<°dio.h
>

32 
	~<°dlib.h
>

33 
	~<°rög.h
>

35 #i‡
deföed
 (
WIN32
)

36 
	~<c⁄io.h
>

38 
	~<ãrmios.h
>

39 
	~<uni°d.h
>

41 
	$_gëch
()

43 
ãrmios
 
ﬁdt
, 
√wt
;

44 
ch
;

45 
	`tcgë©å
–
STDIN_FILENO
, &
ﬁdt
 );

46 
√wt
 = 
ﬁdt
;

47 
√wt
.
c_lÊag
 &~–
ICANON
 | 
ECHO
 );

48 
	`tc£èâr
–
STDIN_FILENO
, 
TCSANOW
, &
√wt
 );

49 
ch
 = 
	`gëch¨
();

50 
	`tc£èâr
–
STDIN_FILENO
, 
TCSANOW
, &
ﬁdt
 );

51  
ch
;

52 
	}
}

55 
	~<cuæ/cuæ.h
>

57 
	#VERSION_STR
 "V1.0"

	)

60 
	#my_cuæ_ósy_£t›t
(
A
, 
B
, 
C
) \

61 i‡((
ªs
 = 
	`cuæ_ósy_£t›t
((
A
), (
B
), (
C
))Ë!
CURLE_OK
) \

62 
	`Ârötf
(
°dîr
, "curl_easy_setopt(%s, %s, %s) failed: %d\n", \

63 #A, #B, #C, 
ªs
);

	)

65 
	#my_cuæ_ósy_≥rf‹m
(
A
) \

66 i‡((
ªs
 = 
	`cuæ_ósy_≥rf‹m
((
A
))Ë!
CURLE_OK
) \

67 
	`Ârötf
(
°dîr
, "cuæ_ósy_≥rf‹m(%sËÁûed: %d\n", #A, 
ªs
);

	)

71 
	$π•_›ti⁄s
(
CURL
 *
cuæ
, c⁄° *
uri
)

73 
CURLcode
 
ªs
 = 
CURLE_OK
;

74 
	`¥ötf
("\nRTSP: OPTIONS %s\n", 
uri
);

75 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
uri
);

76 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, ()
CURL_RTSPREQ_OPTIONS
);

77 
	`my_cuæ_ósy_≥rf‹m
(
cuæ
);

78 
	}
}

82 
	$π•_des¸ibe
(
CURL
 *
cuæ
, c⁄° *
uri
,

83 c⁄° *
sdp_fûíame
)

85 
CURLcode
 
ªs
 = 
CURLE_OK
;

86 
FILE
 *
sdp_Â
 = 
	`f›í
(
sdp_fûíame
, "wt");

87 
	`¥ötf
("\nRTSP: DESCRIBE %s\n", 
uri
);

88 i‡(
sdp_Â
 =
NULL
) {

89 
	`Ârötf
(
°dîr
, "CouldÇŸ o≥¿'%s' f‹ wrôög\n", 
sdp_fûíame
);

90 
sdp_Â
 = 
°dout
;

93 
	`¥ötf
("Wrôög SDPÅÿ'%s'\n", 
sdp_fûíame
);

95 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
sdp_Â
);

96 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, ()
CURL_RTSPREQ_DESCRIBE
);

97 
	`my_cuæ_ósy_≥rf‹m
(
cuæ
);

98 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
°dout
);

99 i‡(
sdp_Â
 !
°dout
) {

100 
	`f˛o£
(
sdp_Â
);

102 
	}
}

105 
	$π•_£tup
(
CURL
 *
cuæ
, c⁄° *
uri
, c⁄° *
å™•‹t
)

107 
CURLcode
 
ªs
 = 
CURLE_OK
;

108 
	`¥ötf
("\nRTSP: SETUP %s\n", 
uri
);

109 
	`¥ötf
(" TRANSPORT %s\n", 
å™•‹t
);

110 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
uri
);

111 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RTSP_TRANSPORT
, 
å™•‹t
);

112 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, ()
CURL_RTSPREQ_SETUP
);

113 
	`my_cuæ_ósy_≥rf‹m
(
cuæ
);

114 
	}
}

118 
	$π•_∂ay
(
CURL
 *
cuæ
, c⁄° *
uri
, c⁄° *
ønge
)

120 
CURLcode
 
ªs
 = 
CURLE_OK
;

121 
	`¥ötf
("\nRTSP: PLAY %s\n", 
uri
);

122 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
uri
);

123 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RANGE
, 
ønge
);

124 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, ()
CURL_RTSPREQ_PLAY
);

125 
	`my_cuæ_ósy_≥rf‹m
(
cuæ
);

126 
	}
}

130 
	$π•_ã¨down
(
CURL
 *
cuæ
, c⁄° *
uri
)

132 
CURLcode
 
ªs
 = 
CURLE_OK
;

133 
	`¥ötf
("\nRTSP: TEARDOWN %s\n", 
uri
);

134 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, ()
CURL_RTSPREQ_TEARDOWN
);

135 
	`my_cuæ_ósy_≥rf‹m
(
cuæ
);

136 
	}
}

140 
	$gë_sdp_fûíame
(c⁄° *
uæ
, *
sdp_fûíame
)

142 c⁄° *
s
 = 
	`°ºchr
(
uæ
, '/');

143 
	`°r˝y
(
sdp_fûíame
, "video.sdp");

144 i‡(
s
 !
NULL
) {

145 
s
++;

146 i‡(
s
[0] != '\0') {

147 
	`•rötf
(
sdp_fûíame
, "%s.sdp", 
s
);

150 
	}
}

154 
	$gë_medü_c⁄åﬁ_©åibuã
(c⁄° *
sdp_fûíame
,

155 *
c⁄åﬁ
)

157 
max_Àn
 = 256;

158 *
s
 = 
	`mÆloc
(
max_Àn
);

159 
FILE
 *
sdp_Â
 = 
	`f›í
(
sdp_fûíame
, "rt");

160 
c⁄åﬁ
[0] = '\0';

161 i‡(
sdp_Â
 !
NULL
) {

162 
	`fgës
(
s
, 
max_Àn
 - 2, 
sdp_Â
Ë!
NULL
) {

163 
	`ssˇnf
(
s
, "á = c⁄åﬁ: %s", 
c⁄åﬁ
);

165 
	`f˛o£
(
sdp_Â
);

167 
	`‰ì
(
s
);

168 
	}
}

172 
	$maö
(
¨gc
, * c⁄° 
¨gv
[])

175 c⁄° *
å™•‹t
 = "RTP/AVP;unicast;client_port=1234-1235";

177 c⁄° *
å™•‹t
 = "RTP/AVP/TCP;unicast;client_port=1234-1235";

179 c⁄° *
ønge
 = "0.000-";

180 
rc
 = 
EXIT_SUCCESS
;

181 *
ba£_«me
 = 
NULL
;

183 
	`¥ötf
("\nRTSPÑeque° %s\n", 
VERSION_STR
);

184 
	`¥ötf
(" Project web site: http://code.google.com/p/rtsprequest/\n");

185 
	`¥ötf
(" Requires cURL V7.20 or greater\n\n");

188 i‡((
¨gc
 != 2) && (argc != 3)) {

189 
ba£_«me
 = 
	`°ºchr
(
¨gv
[0], '/');

190 i‡(
ba£_«me
 =
NULL
) {

191 
ba£_«me
 = 
	`°ºchr
(
¨gv
[0], '\\');

193 i‡(
ba£_«me
 =
NULL
) {

194 
ba£_«me
 = 
¨gv
[0];

196 
ba£_«me
++;

198 
	`¥ötf
("Ußge: %†uæ [å™•‹t]\n", 
ba£_«me
);

199 
	`¥ötf
(" url of video server\n");

200 
	`¥ötf
("Åransport (optional) specifier for media streamÖrotocol\n");

201 
	`¥ötf
(" deÁu…Åøn•‹t: %s\n", 
å™•‹t
);

202 
	`¥ötf
("Exam∂e: %†π•://192.168.0.2/medü/video1\n\n", 
ba£_«me
);

203 
rc
 = 
EXIT_FAILURE
;

205 c⁄° *
uæ
 = 
¨gv
[1];

206 *
uri
 = 
	`mÆloc
(
	`°æí
(
uæ
) + 32);

207 *
sdp_fûíame
 = 
	`mÆloc
(
	`°æí
(
uæ
) + 32);

208 *
c⁄åﬁ
 = 
	`mÆloc
(
	`°æí
(
uæ
) + 32);

209 
CURLcode
 
ªs
;

210 
	`gë_sdp_fûíame
(
uæ
, 
sdp_fûíame
);

211 i‡(
¨gc
 == 3) {

212 
å™•‹t
 = 
¨gv
[2];

216 
ªs
 = 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

217 i‡(
ªs
 =
CURLE_OK
) {

218 
cuæ_vîsi⁄_öfo_d©a
 *
d©a
 = 
	`cuæ_vîsi⁄_öfo
(
CURLVERSION_NOW
);

219 
CURL
 *
cuæ
;

220 
	`Ârötf
(
°dîr
, " cURL V%†lﬂded\n", 
d©a
->
vîsi⁄
);

223 
cuæ
 = 
	`cuæ_ósy_öô
();

224 i‡(
cuæ
 !
NULL
) {

225 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 0L);

226 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_NOPROGRESS
, 1L);

227 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HEADERDATA
, 
°dout
);

228 
	`my_cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
uæ
);

231 
	`•rötf
(
uri
, "%s", 
uæ
);

232 
	`π•_›ti⁄s
(
cuæ
, 
uri
);

235 
	`π•_des¸ibe
(
cuæ
, 
uri
, 
sdp_fûíame
);

238 
	`gë_medü_c⁄åﬁ_©åibuã
(
sdp_fûíame
, 
c⁄åﬁ
);

241 
	`•rötf
(
uri
, "%s/%s", 
uæ
, 
c⁄åﬁ
);

242 
	`π•_£tup
(
cuæ
, 
uri
, 
å™•‹t
);

245 
	`•rötf
(
uri
, "%s/", 
uæ
);

246 
	`π•_∂ay
(
cuæ
, 
uri
, 
ønge
);

247 
	`¥ötf
("Playing video,Öressány keyÅo stop ...");

248 
	`_gëch
();

249 
	`¥ötf
("\n");

252 
	`π•_ã¨down
(
cuæ
, 
uri
);

255 
	`cuæ_ósy_˛ónup
(
cuæ
);

256 
cuæ
 = 
NULL
;

258 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

260 
	`cuæ_globÆ_˛ónup
();

262 
	`Ârötf
(
°dîr
, "curl_global_init(%s) failed: %d\n",

263 "CURL_GLOBAL_ALL", 
ªs
);

265 
	`‰ì
(
c⁄åﬁ
);

266 
	`‰ì
(
sdp_fûíame
);

267 
	`‰ì
(
uri
);

270  
rc
;

271 
	}
}

	@docs/examples/sampleconv.c

39 
	~<°dio.h
>

40 
	~<cuæ/cuæ.h
>

42 
CURLcode
 
	$my_c⁄v_‰om_ascii_to_ebcdic
(*
buf„r
, 
size_t
 
Àngth
)

44 *
ãmµåö
, *
ãmµåout
;

45 
size_t
 
byãs
 = 
Àngth
;

46 
rc
;

47 
ãmµåö
 = 
ãmµåout
 = 
buf„r
;

48 
rc
 = 
	`∂©f‹m_a2e
(&
ãmµåö
, &
byãs
, &
ãmµåout
, &bytes);

49 i‡(
rc
 =
PLATFORM_CONV_OK
) {

50 (
CURLE_OK
);

52 (
CURLE_CONV_FAILED
);

54 
	}
}

56 
CURLcode
 
	$my_c⁄v_‰om_ebcdic_to_ascii
(*
buf„r
, 
size_t
 
Àngth
)

58 *
ãmµåö
, *
ãmµåout
;

59 
size_t
 
byãs
 = 
Àngth
;

60 
rc
;

61 
ãmµåö
 = 
ãmµåout
 = 
buf„r
;

62 
rc
 = 
	`∂©f‹m_e2a
(&
ãmµåö
, &
byãs
, &
ãmµåout
, &bytes);

63 i‡(
rc
 =
PLATFORM_CONV_OK
) {

64 (
CURLE_OK
);

66 (
CURLE_CONV_FAILED
);

68 
	}
}

70 
CURLcode
 
	$my_c⁄v_‰om_utf8_to_ebcdic
(*
buf„r
, 
size_t
 
Àngth
)

72 *
ãmµåö
, *
ãmµåout
;

73 
size_t
 
byãs
 = 
Àngth
;

74 
rc
;

75 
ãmµåö
 = 
ãmµåout
 = 
buf„r
;

76 
rc
 = 
	`∂©f‹m_u2e
(&
ãmµåö
, &
byãs
, &
ãmµåout
, &bytes);

77 i‡(
rc
 =
PLATFORM_CONV_OK
) {

78 (
CURLE_OK
);

80 (
CURLE_CONV_FAILED
);

82 
	}
}

84 
	$maö
()

86 
CURL
 *
cuæ
;

87 
CURLcode
 
ªs
;

89 
cuæ
 = 
	`cuæ_ósy_öô
();

90 if(
cuæ
) {

91 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com");

94 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CONV_FROM_NETWORK_FUNCTION
,

95 
my_c⁄v_‰om_ascii_to_ebcdic
);

96 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CONV_TO_NETWORK_FUNCTION
,

97 
my_c⁄v_‰om_ebcdic_to_ascii
);

98 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CONV_FROM_UTF8_FUNCTION
,

99 
my_c⁄v_‰om_utf8_to_ebcdic
);

101 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

104 
	`cuæ_ósy_˛ónup
(
cuæ
);

107 
	}
}

	@docs/examples/sendrecv.c

24 
	~<°dio.h
>

25 
	~<°rög.h
>

26 
	~<cuæ/cuæ.h
>

29 
	$waô_⁄_sockë
(
cuæ_sockë_t
 
sockfd
, 
f‹_ªcv
, 
timeout_ms
)

31 
timevÆ
 
tv
;

32 
fd_£t
 
öfd
, 
outfd
, 
îrfd
;

33 
ªs
;

35 
tv
.
tv_£c
 = 
timeout_ms
 / 1000;

36 
tv
.
tv_u£c
(
timeout_ms
 % 1000) * 1000;

38 
	`FD_ZERO
(&
öfd
);

39 
	`FD_ZERO
(&
outfd
);

40 
	`FD_ZERO
(&
îrfd
);

42 
	`FD_SET
(
sockfd
, &
îrfd
);

44 if(
f‹_ªcv
)

46 
	`FD_SET
(
sockfd
, &
öfd
);

50 
	`FD_SET
(
sockfd
, &
outfd
);

54 
ªs
 = 
	`£À˘
(
sockfd
 + 1, &
öfd
, &
outfd
, &
îrfd
, &
tv
);

55  
ªs
;

56 
	}
}

58 
	$maö
()

60 
CURL
 *
cuæ
;

61 
CURLcode
 
ªs
;

63 c⁄° *
ªque°
 = "GET / HTTP/1.0\r\nHost:Éxample.com\r\n\r\n";

64 
cuæ_sockë_t
 
sockfd
;

65 
sockexå
;

66 
size_t
 
iﬁí
;

67 
cuæ_off_t
 
ƒód
;

69 
cuæ
 = 
	`cuæ_ósy_öô
();

70 if(
cuæ
) {

71 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com");

73 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CONNECT_ONLY
, 1L);

74 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

76 if(
CURLE_OK
 !
ªs
)

78 
	`¥ötf
("Eº‹: %s\n", 
	`°ªº‹
(
ªs
));

86 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_LASTSOCKET
, &
sockexå
);

88 if(
CURLE_OK
 !
ªs
)

90 
	`¥ötf
("Eº‹: %s\n", 
	`cuæ_ósy_°ªº‹
(
ªs
));

94 
sockfd
 = 
sockexå
;

97 if(!
	`waô_⁄_sockë
(
sockfd
, 0, 60000L))

99 
	`¥ötf
("Error:Åimeout.\n");

103 
	`puts
("SendingÑequest.");

106 
ªs
 = 
	`cuæ_ósy_£nd
(
cuæ
, 
ªque°
, 
	`°æí
‘eque°), &
iﬁí
);

108 if(
CURLE_OK
 !
ªs
)

110 
	`¥ötf
("Eº‹: %s\n", 
	`cuæ_ósy_°ªº‹
(
ªs
));

113 
	`puts
("ReadingÑesponse.");

118 
buf
[1024];

120 
	`waô_⁄_sockë
(
sockfd
, 1, 60000L);

121 
ªs
 = 
	`cuæ_ósy_ªcv
(
cuæ
, 
buf
, 1024, &
iﬁí
);

123 if(
CURLE_OK
 !
ªs
)

126 
ƒód
 = (
cuæ_off_t
)
iﬁí
;

128 
	`¥ötf
("Re˚ived %" 
CURL_FORMAT_CURL_OFF_T
 " byãs.\n", 
ƒód
);

132 
	`cuæ_ósy_˛ónup
(
cuæ
);

135 
	}
}

	@docs/examples/sepheaders.c

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

26 
	~<cuæ/cuæ.h
>

28 
size_t
 
	$wrôe_d©a
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

30 
wrôãn
 = 
	`fwrôe
(
±r
, 
size
, 
nmemb
, (
FILE
 *)
°ªam
);

31  
wrôãn
;

32 
	}
}

34 
	$maö
()

36 
CURL
 *
cuæ_h™dÀ
;

37 c⁄° *
hódîfûíame
 = "head.out";

38 
FILE
 *
hódîfûe
;

39 c⁄° *
bodyfûíame
 = "body.out";

40 
FILE
 *
bodyfûe
;

42 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

45 
cuæ_h™dÀ
 = 
	`cuæ_ósy_öô
();

48 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_URL
, "http://example.com");

51 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_NOPROGRESS
, 1L);

54 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_d©a
);

57 
hódîfûe
 = 
	`f›í
(
hódîfûíame
,"wb");

58 i‡(
hódîfûe
 =
NULL
) {

59 
	`cuæ_ósy_˛ónup
(
cuæ_h™dÀ
);

62 
bodyfûe
 = 
	`f›í
(
bodyfûíame
,"wb");

63 i‡(
bodyfûe
 =
NULL
) {

64 
	`cuæ_ósy_˛ónup
(
cuæ_h™dÀ
);

69 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_HEADERDATA
, 
hódîfûe
);

72 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_WRITEDATA
, 
bodyfûe
);

75 
	`cuæ_ósy_≥rf‹m
(
cuæ_h™dÀ
);

78 
	`f˛o£
(
hódîfûe
);

81 
	`f˛o£
(
bodyfûe
);

84 
	`cuæ_ósy_˛ónup
(
cuæ_h™dÀ
);

87 
	}
}

	@docs/examples/sessioninfo.c

26 
	~<°dio.h
>

28 
	~<cuæ/cuæ.h
>

29 
	~<gnués/gnués.h
>

31 
CURL
 *
	gcuæ
;

33 
size_t
 
	$wrfu
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

35 c⁄° 
cuæ_és£ssi⁄öfo
 *
öfo
;

36 
˚π_li°_size
;

37 c⁄° 
gnués_d©um_t
 *
chaöp
;

38 
CURLcode
 
ªs
;

40 ()
°ªam
;

41 ()
±r
;

43 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_TLS_SESSION
, &
öfo
);

45 if(!
ªs
) {

46 
öfo
->
backíd
) {

47 
CURLSSLBACKEND_GNUTLS
:

49 
chaöp
 = 
	`gnués_˚πifiˇã_gë_≥îs
(
öfo
->
öã∫Æs
, &
˚π_li°_size
);

50 if((
chaöp
Ë&& (
˚π_li°_size
)) {

51 
i
;

53 
i
 = 0; i < 
˚π_li°_size
; i++) {

54 
gnués_x509_¸t_t
 
˚π
;

55 
gnués_d©um_t
 
dn
;

57 if(
GNUTLS_E_SUCCESS
 =
	`gnués_x509_¸t_öô
(&
˚π
)) {

58 if(
GNUTLS_E_SUCCESS
 ==

59 
	`gnués_x509_¸t_imp‹t
(
˚π
, &
chaöp
[
i
], 
GNUTLS_X509_FMT_DER
)) {

60 if(
GNUTLS_E_SUCCESS
 ==

61 
	`gnués_x509_¸t_¥öt
(
˚π
, 
GNUTLS_CRT_PRINT_FULL
, &
dn
)) {

62 
	`Ârötf
(
°dîr
, "Cîtifiˇã #%d: %.*s", 
i
, 
dn
.
size
, dn.
d©a
);

64 
	`gnués_‰ì
(
dn
.
d©a
);

68 
	`gnués_x509_¸t_deöô
(
˚π
);

73 
CURLSSLBACKEND_NONE
:

79  
size
 * 
nmemb
;

80 
	}
}

82 
	$maö
()

84 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

86 
cuæ
 = 
	`cuæ_ósy_öô
();

87 if(
cuæ
) {

88 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "https://www.example.com/");

90 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
wrfu
);

92 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

93 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYHOST
, 0L);

95 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 0L);

97 (Ë
	`cuæ_ósy_≥rf‹m
(
cuæ
);

99 
	`cuæ_ósy_˛ónup
(
cuæ
);

102 
	`cuæ_globÆ_˛ónup
();

105 
	}
}

	@docs/examples/sftpget.c

23 
	~<°dio.h
>

25 
	~<cuæ/cuæ.h
>

28 #unde‡
DISABLE_SSH_AGENT


37 
	sFçFûe
 {

38 c⁄° *
	mfûíame
;

39 
FILE
 *
	m°ªam
;

42 
size_t
 
	$my_fwrôe
(*
buf„r
, 
size_t
 
size
, size_à
nmemb
,

43 *
°ªam
)

45 
FçFûe
 *
out
=(FçFûê*)
°ªam
;

46 if(
out
 && !out->
°ªam
) {

48 
out
->
°ªam
=
	`f›í
(out->
fûíame
, "wb");

49 if(!
out
->
°ªam
)

52  
	`fwrôe
(
buf„r
, 
size
, 
nmemb
, 
out
->
°ªam
);

53 
	}
}

56 
	$maö
()

58 
CURL
 *
cuæ
;

59 
CURLcode
 
ªs
;

60 
FçFûe
 
·pfûe
={

62 
NULL


65 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

67 
cuæ
 = 
	`cuæ_ósy_öô
();

68 if(
cuæ
) {

72 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
,

75 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
my_fwrôe
);

77 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, &
·pfûe
);

79 #i‚de‡
DISABLE_SSH_AGENT


83 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSH_AUTH_TYPES
, 
CURLSSH_AUTH_AGENT
);

87 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

89 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

92 
	`cuæ_ósy_˛ónup
(
cuæ
);

94 if(
CURLE_OK
 !
ªs
) {

96 
	`Ârötf
(
°dîr
, "cuæÅﬁd u†%d\n", 
ªs
);

100 if(
·pfûe
.
°ªam
)

101 
	`f˛o£
(
·pfûe
.
°ªam
);

103 
	`cuæ_globÆ_˛ónup
();

106 
	}
}

	@docs/examples/simple.c

22 
	~<°dio.h
>

23 
	~<cuæ/cuæ.h
>

25 
	$maö
()

27 
CURL
 *
cuæ
;

28 
CURLcode
 
ªs
;

30 
cuæ
 = 
	`cuæ_ósy_öô
();

31 if(
cuæ
) {

32 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com");

34 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_FOLLOWLOCATION
, 1L);

37 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

39 if(
ªs
 !
CURLE_OK
)

40 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

41 
	`cuæ_ósy_°ªº‹
(
ªs
));

44 
	`cuæ_ósy_˛ónup
(
cuæ
);

47 
	}
}

	@docs/examples/simplepost.c

22 
	~<°dio.h
>

23 
	~<°rög.h
>

24 
	~<cuæ/cuæ.h
>

26 
	$maö
()

28 
CURL
 *
cuæ
;

29 
CURLcode
 
ªs
;

31 c⁄° *
po°this
="moo mooo moo moo";

33 
cuæ
 = 
	`cuæ_ósy_öô
();

34 if(
cuæ
) {

35 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "http://example.com");

36 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, 
po°this
);

40 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, ()
	`°æí
(
po°this
));

43 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

45 if(
ªs
 !
CURLE_OK
)

46 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

47 
	`cuæ_ósy_°ªº‹
(
ªs
));

50 
	`cuæ_ósy_˛ónup
(
cuæ
);

53 
	}
}

	@docs/examples/simplessl.c

22 
	~<°dio.h
>

24 
	~<cuæ/cuæ.h
>

44 
	$maö
()

46 
i
;

47 
CURL
 *
cuæ
;

48 
CURLcode
 
ªs
;

49 
FILE
 *
hódîfûe
;

50 c⁄° *
pPas•hø£
 = 
NULL
;

52 c⁄° *
pCîtFûe
 = "testcert.pem";

53 c⁄° *
pCACîtFûe
="cacert.pem";

55 c⁄° *
pKeyName
;

56 c⁄° *
pKeyTy≥
;

58 c⁄° *
pEngöe
;

60 #ifde‡
USE_ENGINE


61 
pKeyName
 = "rsa_test";

62 
pKeyTy≥
 = "ENG";

63 
pEngöe
 = "chil";

65 
pKeyName
 = "testkey.pem";

66 
pKeyTy≥
 = "PEM";

67 
pEngöe
 = 
NULL
;

70 
hódîfûe
 = 
	`f›í
("dumpit", "w");

72 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

74 
cuæ
 = 
	`cuæ_ósy_öô
();

75 if(
cuæ
) {

77 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "HTTPS://your.favourite.ssl.site");

78 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HEADERDATA
, 
hódîfûe
);

80 
i
 = 0; i < 1; i++)

82 i‡(
pEngöe
)

84 i‡(
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSLENGINE
,
pEngöe
Ë!
CURLE_OK
)

86 
	`Ârötf
(
°dîr
,"can't set cryptoÉngine\n");

89 i‡(
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSLENGINE_DEFAULT
,1LË!
CURLE_OK
)

93 
	`Ârötf
(
°dîr
,"can't set cryptoÉngineás default\n");

99 
	`cuæ_ósy_£t›t
(
cuæ
,
CURLOPT_SSLCERTTYPE
,"PEM");

102 
	`cuæ_ósy_£t›t
(
cuæ
,
CURLOPT_SSLCERT
,
pCîtFûe
);

106 i‡(
pPas•hø£
)

107 
	`cuæ_ósy_£t›t
(
cuæ
,
CURLOPT_KEYPASSWD
,
pPas•hø£
);

111 
	`cuæ_ósy_£t›t
(
cuæ
,
CURLOPT_SSLKEYTYPE
,
pKeyTy≥
);

114 
	`cuæ_ósy_£t›t
(
cuæ
,
CURLOPT_SSLKEY
,
pKeyName
);

117 
	`cuæ_ósy_£t›t
(
cuæ
,
CURLOPT_CAINFO
,
pCACîtFûe
);

120 
	`cuæ_ósy_£t›t
(
cuæ
,
CURLOPT_SSL_VERIFYPEER
,1L);

123 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

125 if(
ªs
 !
CURLE_OK
)

126 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

127 
	`cuæ_ósy_°ªº‹
(
ªs
));

132 
	`cuæ_ósy_˛ónup
(
cuæ
);

135 
	`cuæ_globÆ_˛ónup
();

138 
	}
}

	@docs/examples/smooth-gtk-thread.c

33 
	~<°dio.h
>

34 
	~<gtk/gtk.h
>

35 
	~<glib.h
>

36 
	~<uni°d.h
>

37 
	~<±hªad.h
>

39 
	~<cuæ/cuæ.h
>

41 
	#NUMT
 4

	)

43 
±hªad_muãx_t
 
	glock
 = 
PTHREAD_MUTEX_INITIALIZER
;

44 
	gj
 = 0;

45 
göt
 
	gnum_uæs
 = 9;

46 c⁄° * c⁄° 
	guæs
[]= {

58 
size_t
 
	$wrôe_fûe
(*
±r
, 
size_t
 
size
, size_à
nmemb
, 
FILE
 *
°ªam
)

61  
	`fwrôe
(
±r
, 
size
, 
nmemb
, 
°ªam
);

62 
	}
}

65 *
	$puŒ_⁄e_uæ
(*
NaN
)

67 
CURL
 *
cuæ
;

68 
CURLcode
 
ªs
;

69 
gch¨
 *
hâp
;

70 
FILE
 *
outfûe
;

73 
	`±hªad_muãx_lock
(&
lock
);

74  
j
 < 
num_uæs
 )

76 
	`¥ötf
("j = %d\n", 
j
);

78 
hâp
 =

79 
	`g_°rdup_¥ötf
("xoap.weather.com/weather/local/%s?cc=*&dayf=5&unit=i\n",

80 
uæs
[
j
]);

82 
	`¥ötf
–"hâ∞%s", 
hâp
 );

84 
cuæ
 = 
	`cuæ_ósy_öô
();

85 if(
cuæ
)

88 
outfûe
 = 
	`f›í
(
uæs
[
j
], "w");

92 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
hâp
);

95 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
outfûe
);

96 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_fûe
);

98 
j
++;

99 
	`±hªad_muãx_u∆ock
(&
lock
);

101 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

103 
	`f˛o£
(
outfûe
);

104 
	`¥ötf
("fclose\n");

106 
	`cuæ_ósy_˛ónup
(
cuæ
);

108 
	`g_‰ì
 (
hâp
);

111 
	`¶ìp
(1);

114  
NULL
;

115 
	}
}

118 
gboﬁón
 
	$pul£_b¨
(
gpoöãr
 
d©a
)

120 
	`gdk_thªads_íãr
();

121 
	`gtk_¥ogªss_b¨_pul£
 (
	`GTK_PROGRESS_BAR
 (
d©a
));

122 
	`gdk_thªads_Àave
();

127  
TRUE
;

128 
	}
}

130 *
	$¸óã_thªad
(*
¥ogªss_b¨
)

132 
±hªad_t
 
tid
[
NUMT
];

133 
i
;

134 
îr‹
;

137 
i
=0; i < 
NUMT
 && i < 
num_uæs
 ; i++) {

138 
îr‹
 = 
	`±hªad_¸óã
(&
tid
[
i
],

139 
NULL
,

140 
puŒ_⁄e_uæ
,

141 
NULL
);

142 if(0 !
îr‹
)

143 
	`Ârötf
(
°dîr
, "Couldn'àru¿thªadÇumbî %d,Éºnÿ%d\n", 
i
, 
îr‹
);

145 
	`Ârötf
(
°dîr
, "Thªad %d, gë†%s\n", 
i
, 
uæs
[i]);

149 
i
=0; i < 
NUMT
 && i < 
num_uæs
; i++) {

150 
îr‹
 = 
	`±hªad_joö
(
tid
[
i
], 
NULL
);

151 
	`Ârötf
(
°dîr
, "Thªad %dÅîmö©ed\n", 
i
);

156 
	`g_sour˚_ªmove
(
	`GPOINTER_TO_INT
(
	`g_obje˘_gë_d©a
(
	`G_OBJECT
(
¥ogªss_b¨
),

160 
	`gtk_widgë_de°roy
(
¥ogªss_b¨
);

166  
NULL
;

168 
	}
}

170 
gboﬁón
 
	$cb_dñëe
(
GtkWidgë
 *
wödow
, 
gpoöãr
 
d©a
)

172 
	`gtk_maö_quô
();

173  
FALSE
;

174 
	}
}

176 
	$maö
(
¨gc
, **
¨gv
)

178 
GtkWidgë
 *
t›_wödow
, *
outside_‰ame
, *
öside_‰ame
, *
¥ogªss_b¨
;

181 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

184 
	`g_thªad_öô
(
NULL
);

185 
	`gdk_thªads_öô
 ();

186 
	`gdk_thªads_íãr
 ();

188 
	`gtk_öô
(&
¨gc
, &
¨gv
);

191 
t›_wödow
 = 
	`gtk_wödow_√w
(
GTK_WINDOW_TOPLEVEL
);

194 
outside_‰ame
 = 
	`gtk_‰ame_√w
(
NULL
);

195 
	`gtk_‰ame_£t_shadow_ty≥
(
	`GTK_FRAME
(
outside_‰ame
), 
GTK_SHADOW_OUT
);

196 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
t›_wödow
), 
outside_‰ame
);

199 
öside_‰ame
 = 
	`gtk_‰ame_√w
(
NULL
);

200 
	`gtk_‰ame_£t_shadow_ty≥
(
	`GTK_FRAME
(
öside_‰ame
), 
GTK_SHADOW_IN
);

201 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
öside_‰ame
), 5);

202 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
outside_‰ame
), 
öside_‰ame
);

205 
¥ogªss_b¨
 = 
	`gtk_¥ogªss_b¨_√w
();

206 
	`gtk_¥ogªss_b¨_pul£
 (
	`GTK_PROGRESS_BAR
 (
¥ogªss_b¨
));

208 
göt
 
pul£_ªf
 = 
	`g_timeout_add
 (300, 
pul£_b¨
, 
¥ogªss_b¨
);

209 
	`g_obje˘_£t_d©a
(
	`G_OBJECT
(
¥ogªss_b¨
), "pulse_id",

210 
	`GINT_TO_POINTER
(
pul£_ªf
));

211 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
öside_‰ame
), 
¥ogªss_b¨
);

213 
	`gtk_widgë_show_Æl
(
t›_wödow
);

214 
	`¥ötf
("gtk_widget_show_all\n");

216 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
t›_wödow
), "delete-event",

217 
	`G_CALLBACK
(
cb_dñëe
), 
NULL
);

219 i‡(!
	`g_thªad_¸óã
(&
¸óã_thªad
, 
¥ogªss_b¨
, 
FALSE
, 
NULL
) != 0)

220 
	`g_w¨nög
("can't createÅheÅhread");

222 
	`gtk_maö
();

223 
	`gdk_thªads_Àave
();

224 
	`¥ötf
("gdk_threads_leave\n");

227 
	}
}

	@docs/examples/smtp-expn.c

22 
	~<°dio.h
>

23 
	~<°rög.h
>

24 
	~<cuæ/cuæ.h
>

34 
	$maö
()

36 
CURL
 *
cuæ
;

37 
CURLcode
 
ªs
;

38 
cuæ_¶i°
 *
ªcùõ¡s
 = 
NULL
;

40 
cuæ
 = 
	`cuæ_ósy_öô
();

41 if(
cuæ
) {

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "smtp://mail.example.com");

46 
ªcùõ¡s
 = 
	`cuæ_¶i°_≠≥nd
(recipients, "Friends");

47 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_RCPT
, 
ªcùõ¡s
);

50 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, "EXPN");

53 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

56 if(
ªs
 !
CURLE_OK
)

57 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

58 
	`cuæ_ósy_°ªº‹
(
ªs
));

61 
	`cuæ_¶i°_‰ì_Æl
(
ªcùõ¡s
);

69 
	`cuæ_ósy_˛ónup
(
cuæ
);

73 
	}
}

	@docs/examples/smtp-mail.c

22 
	~<°dio.h
>

23 
	~<°rög.h
>

24 
	~<cuæ/cuæ.h
>

33 
	#FROM
 "<£ndî@exam∂e.‹g>"

	)

34 
	#TO
 "<addªs£e@exam∂e.√t>"

	)

35 
	#CC
 "<öfo@exam∂e.‹g>"

	)

37 c⁄° *
	g∑ylﬂd_ãxt
[] = {

39 "To: " 
TO
 "\r\n",

40 "From: " 
FROM
 "(Example User)\r\n",

41 "Cc: " 
CC
 "(AnotherÉxample User)\r\n",

49 
NULL


52 
	su∂ﬂd_°©us
 {

53 
	mlöes_ªad
;

56 
size_t
 
	$∑ylﬂd_sour˚
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

58 
u∂ﬂd_°©us
 *
u∂ﬂd_˘x
 = (u∂ﬂd_°©u†*)
u£Ω
;

59 c⁄° *
d©a
;

61 if((
size
 =0Ë|| (
nmemb
 == 0) || ((size*nmemb) < 1)) {

65 
d©a
 = 
∑ylﬂd_ãxt
[
u∂ﬂd_˘x
->
löes_ªad
];

67 if(
d©a
) {

68 
size_t
 
Àn
 = 
	`°æí
(
d©a
);

69 
	`mem˝y
(
±r
, 
d©a
, 
Àn
);

70 
u∂ﬂd_˘x
->
löes_ªad
++;

72  
Àn
;

76 
	}
}

78 
	$maö
()

80 
CURL
 *
cuæ
;

81 
CURLcode
 
ªs
 = 
CURLE_OK
;

82 
cuæ_¶i°
 *
ªcùõ¡s
 = 
NULL
;

83 
u∂ﬂd_°©us
 
u∂ﬂd_˘x
;

85 
u∂ﬂd_˘x
.
löes_ªad
 = 0;

87 
cuæ
 = 
	`cuæ_ósy_öô
();

88 if(
cuæ
) {

90 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "smtp://mail.example.com");

98 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_FROM
, 
FROM
);

103 
ªcùõ¡s
 = 
	`cuæ_¶i°_≠≥nd
‘ecùõ¡s, 
TO
);

104 
ªcùõ¡s
 = 
	`cuæ_¶i°_≠≥nd
‘ecùõ¡s, 
CC
);

105 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_RCPT
, 
ªcùõ¡s
);

110 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
∑ylﬂd_sour˚
);

111 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
u∂ﬂd_˘x
);

112 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

115 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

118 if(
ªs
 !
CURLE_OK
)

119 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

120 
	`cuæ_ósy_°ªº‹
(
ªs
));

123 
	`cuæ_¶i°_‰ì_Æl
(
ªcùõ¡s
);

133 
	`cuæ_ósy_˛ónup
(
cuæ
);

136  ()
ªs
;

137 
	}
}

	@docs/examples/smtp-multi.c

22 
	~<°rög.h
>

23 
	~<cuæ/cuæ.h
>

32 
	#FROM
 "<£ndî@exam∂e.com>"

	)

33 
	#TO
 "<ªcùõ¡@exam∂e.com>"

	)

34 
	#CC
 "<öfo@exam∂e.com>"

	)

36 
	#MULTI_PERFORM_HANG_TIMEOUT
 60 * 1000

	)

38 c⁄° *
	g∑ylﬂd_ãxt
[] = {

40 "To: " 
TO
 "\r\n",

41 "From: " 
FROM
 "(Example User)\r\n",

42 "Cc: " 
CC
 "(AnotherÉxample User)\r\n",

50 
NULL


53 
	su∂ﬂd_°©us
 {

54 
	mlöes_ªad
;

57 
size_t
 
	$∑ylﬂd_sour˚
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

59 
u∂ﬂd_°©us
 *
u∂ﬂd_˘x
 = (u∂ﬂd_°©u†*)
u£Ω
;

60 c⁄° *
d©a
;

62 if((
size
 =0Ë|| (
nmemb
 == 0) || ((size*nmemb) < 1)) {

66 
d©a
 = 
∑ylﬂd_ãxt
[
u∂ﬂd_˘x
->
löes_ªad
];

68 if(
d©a
) {

69 
size_t
 
Àn
 = 
	`°æí
(
d©a
);

70 
	`mem˝y
(
±r
, 
d©a
, 
Àn
);

71 
u∂ﬂd_˘x
->
löes_ªad
++;

73  
Àn
;

77 
	}
}

79 
timevÆ
 
	$tvnow
()

81 
timevÆ
 
now
;

84 
now
.
tv_£c
 = ()
	`time
(
NULL
);

85 
now
.
tv_u£c
 = 0;

87  
now
;

88 
	}
}

90 
	$tvdiff
(
timevÆ
 
√wî
, timevÆ 
ﬁdî
)

92  (
√wî
.
tv_£c
 - 
ﬁdî
.tv_sec) * 1000 +

93 (
√wî
.
tv_u£c
 - 
ﬁdî
.tv_usec) / 1000;

94 
	}
}

96 
	$maö
()

98 
CURL
 *
cuæ
;

99 
CURLM
 *
mcuæ
;

100 
°ûl_ru¬ög
 = 1;

101 
timevÆ
 
mp_°¨t
;

102 
cuæ_¶i°
 *
ªcùõ¡s
 = 
NULL
;

103 
u∂ﬂd_°©us
 
u∂ﬂd_˘x
;

105 
u∂ﬂd_˘x
.
löes_ªad
 = 0;

107 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

109 
cuæ
 = 
	`cuæ_ósy_öô
();

110 if(!
cuæ
)

113 
mcuæ
 = 
	`cuæ_mu…i_öô
();

114 if(!
mcuæ
)

118 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "smtp://mail.example.com");

126 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_FROM
, 
FROM
);

131 
ªcùõ¡s
 = 
	`cuæ_¶i°_≠≥nd
‘ecùõ¡s, 
TO
);

132 
ªcùõ¡s
 = 
	`cuæ_¶i°_≠≥nd
‘ecùõ¡s, 
CC
);

133 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_RCPT
, 
ªcùõ¡s
);

138 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
∑ylﬂd_sour˚
);

139 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
u∂ﬂd_˘x
);

140 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

143 
	`cuæ_mu…i_add_h™dÀ
(
mcuæ
, 
cuæ
);

146 
mp_°¨t
 = 
	`tvnow
();

149 
	`cuæ_mu…i_≥rf‹m
(
mcuæ
, &
°ûl_ru¬ög
);

151 
°ûl_ru¬ög
) {

152 
timevÆ
 
timeout
;

153 
fd_£t
 
fdªad
;

154 
fd_£t
 
fdwrôe
;

155 
fd_£t
 
fdex˚p
;

156 
maxfd
 = -1;

157 
rc
;

159 
cuæ_timeo
 = -1;

162 
	`FD_ZERO
(&
fdªad
);

163 
	`FD_ZERO
(&
fdwrôe
);

164 
	`FD_ZERO
(&
fdex˚p
);

167 
timeout
.
tv_£c
 = 1;

168 
timeout
.
tv_u£c
 = 0;

170 
	`cuæ_mu…i_timeout
(
mcuæ
, &
cuæ_timeo
);

171 if(
cuæ_timeo
 >= 0) {

172 
timeout
.
tv_£c
 = 
cuæ_timeo
 / 1000;

173 if(
timeout
.
tv_£c
 > 1)

174 
timeout
.
tv_£c
 = 1;

176 
timeout
.
tv_u£c
 = (
cuæ_timeo
 % 1000) * 1000;

180 
	`cuæ_mu…i_fd£t
(
mcuæ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

187 
rc
 = 
	`£À˘
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

189 if(
	`tvdiff
(
	`tvnow
(), 
mp_°¨t
Ë> 
MULTI_PERFORM_HANG_TIMEOUT
) {

190 
	`Ârötf
(
°dîr
,

195 
rc
) {

200 
	`cuæ_mu…i_≥rf‹m
(
mcuæ
, &
°ûl_ru¬ög
);

206 
	`cuæ_¶i°_‰ì_Æl
(
ªcùõ¡s
);

209 
	`cuæ_mu…i_ªmove_h™dÀ
(
mcuæ
, 
cuæ
);

210 
	`cuæ_mu…i_˛ónup
(
mcuæ
);

211 
	`cuæ_ósy_˛ónup
(
cuæ
);

212 
	`cuæ_globÆ_˛ónup
();

215 
	}
}

	@docs/examples/smtp-ssl.c

22 
	~<°dio.h
>

23 
	~<°rög.h
>

24 
	~<cuæ/cuæ.h
>

34 
	#FROM
 "<£ndî@exam∂e.‹g>"

	)

35 
	#TO
 "<addªs£e@exam∂e.√t>"

	)

36 
	#CC
 "<öfo@exam∂e.‹g>"

	)

38 c⁄° *
	g∑ylﬂd_ãxt
[] = {

40 "To: " 
TO
 "\r\n",

41 "From: " 
FROM
 "(Example User)\r\n",

42 "Cc: " 
CC
 "(AnotherÉxample User)\r\n",

50 
NULL


53 
	su∂ﬂd_°©us
 {

54 
	mlöes_ªad
;

57 
size_t
 
	$∑ylﬂd_sour˚
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

59 
u∂ﬂd_°©us
 *
u∂ﬂd_˘x
 = (u∂ﬂd_°©u†*)
u£Ω
;

60 c⁄° *
d©a
;

62 if((
size
 =0Ë|| (
nmemb
 == 0) || ((size*nmemb) < 1)) {

66 
d©a
 = 
∑ylﬂd_ãxt
[
u∂ﬂd_˘x
->
löes_ªad
];

68 if(
d©a
) {

69 
size_t
 
Àn
 = 
	`°æí
(
d©a
);

70 
	`mem˝y
(
±r
, 
d©a
, 
Àn
);

71 
u∂ﬂd_˘x
->
löes_ªad
++;

73  
Àn
;

77 
	}
}

79 
	$maö
()

81 
CURL
 *
cuæ
;

82 
CURLcode
 
ªs
 = 
CURLE_OK
;

83 
cuæ_¶i°
 *
ªcùõ¡s
 = 
NULL
;

84 
u∂ﬂd_°©us
 
u∂ﬂd_˘x
;

86 
u∂ﬂd_˘x
.
löes_ªad
 = 0;

88 
cuæ
 = 
	`cuæ_ósy_öô
();

89 if(
cuæ
) {

91 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

92 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

96 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "smtps://mainserver.example.net");

106 #ifde‡
SKIP_PEER_VERIFICATION


107 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

114 #ifde‡
SKIP_HOSTNAME_VERFICATION


115 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYHOST
, 0L);

124 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_FROM
, 
FROM
);

129 
ªcùõ¡s
 = 
	`cuæ_¶i°_≠≥nd
‘ecùõ¡s, 
TO
);

130 
ªcùõ¡s
 = 
	`cuæ_¶i°_≠≥nd
‘ecùõ¡s, 
CC
);

131 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_RCPT
, 
ªcùõ¡s
);

136 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
∑ylﬂd_sour˚
);

137 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
u∂ﬂd_˘x
);

138 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

143 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

146 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

149 if(
ªs
 !
CURLE_OK
)

150 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

151 
	`cuæ_ósy_°ªº‹
(
ªs
));

154 
	`cuæ_¶i°_‰ì_Æl
(
ªcùõ¡s
);

157 
	`cuæ_ósy_˛ónup
(
cuæ
);

160  ()
ªs
;

161 
	}
}

	@docs/examples/smtp-tls.c

22 
	~<°dio.h
>

23 
	~<°rög.h
>

24 
	~<cuæ/cuæ.h
>

34 
	#FROM
 "<£ndî@exam∂e.‹g>"

	)

35 
	#TO
 "<addªs£e@exam∂e.√t>"

	)

36 
	#CC
 "<öfo@exam∂e.‹g>"

	)

38 c⁄° *
	g∑ylﬂd_ãxt
[] = {

40 "To: " 
TO
 "\r\n",

41 "From: " 
FROM
 "(Example User)\r\n",

42 "Cc: " 
CC
 "(AnotherÉxample User)\r\n",

50 
NULL


53 
	su∂ﬂd_°©us
 {

54 
	mlöes_ªad
;

57 
size_t
 
	$∑ylﬂd_sour˚
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

59 
u∂ﬂd_°©us
 *
u∂ﬂd_˘x
 = (u∂ﬂd_°©u†*)
u£Ω
;

60 c⁄° *
d©a
;

62 if((
size
 =0Ë|| (
nmemb
 == 0) || ((size*nmemb) < 1)) {

66 
d©a
 = 
∑ylﬂd_ãxt
[
u∂ﬂd_˘x
->
löes_ªad
];

68 if(
d©a
) {

69 
size_t
 
Àn
 = 
	`°æí
(
d©a
);

70 
	`mem˝y
(
±r
, 
d©a
, 
Àn
);

71 
u∂ﬂd_˘x
->
löes_ªad
++;

73  
Àn
;

77 
	}
}

79 
	$maö
()

81 
CURL
 *
cuæ
;

82 
CURLcode
 
ªs
 = 
CURLE_OK
;

83 
cuæ_¶i°
 *
ªcùõ¡s
 = 
NULL
;

84 
u∂ﬂd_°©us
 
u∂ﬂd_˘x
;

86 
u∂ﬂd_˘x
.
löes_ªad
 = 0;

88 
cuæ
 = 
	`cuæ_ósy_öô
();

89 if(
cuæ
) {

91 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, "user");

92 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, "secret");

98 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "smtp://mainserver.example.net:587");

105 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USE_SSL
, ()
CURLUSESSL_ALL
);

118 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CAINFO
, "/path/to/certificate.pem");

126 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_FROM
, 
FROM
);

131 
ªcùõ¡s
 = 
	`cuæ_¶i°_≠≥nd
‘ecùõ¡s, 
TO
);

132 
ªcùõ¡s
 = 
	`cuæ_¶i°_≠≥nd
‘ecùõ¡s, 
CC
);

133 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_RCPT
, 
ªcùõ¡s
);

138 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
∑ylﬂd_sour˚
);

139 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
u∂ﬂd_˘x
);

140 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

145 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

148 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

151 if(
ªs
 !
CURLE_OK
)

152 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

153 
	`cuæ_ósy_°ªº‹
(
ªs
));

156 
	`cuæ_¶i°_‰ì_Æl
(
ªcùõ¡s
);

159 
	`cuæ_ósy_˛ónup
(
cuæ
);

162  ()
ªs
;

163 
	}
}

	@docs/examples/smtp-vrfy.c

22 
	~<°dio.h
>

23 
	~<°rög.h
>

24 
	~<cuæ/cuæ.h
>

37 
	$maö
()

39 
CURL
 *
cuæ
;

40 
CURLcode
 
ªs
;

41 
cuæ_¶i°
 *
ªcùõ¡s
 = 
NULL
;

43 
cuæ
 = 
	`cuæ_ósy_öô
();

44 if(
cuæ
) {

46 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, "smtp://mail.example.com");

49 
ªcùõ¡s
 = 
	`cuæ_¶i°_≠≥nd
(recipients, "<recipient@example.com>");

50 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_RCPT
, 
ªcùõ¡s
);

53 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

56 if(
ªs
 !
CURLE_OK
)

57 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

58 
	`cuæ_ósy_°ªº‹
(
ªs
));

61 
	`cuæ_¶i°_‰ì_Æl
(
ªcùõ¡s
);

69 
	`cuæ_ósy_˛ónup
(
cuæ
);

73 
	}
}

	@docs/examples/synctime.c

84 
	~<°dio.h
>

85 
	~<time.h
>

86 #i‚de‡
__CYGWIN__


87 
	~<wödows.h
>

89 
	~<cuæ/cuæ.h
>

92 
	#MAX_STRING
 256

	)

93 
	#MAX_STRING1
 
MAX_STRING
+1

	)

97 
	mhâp_¥oxy
[
MAX_STRING1
];

98 
	m¥oxy_u£r
[
MAX_STRING1
];

99 
	mtime£rvî
[
MAX_STRING1
];

100 } 
	tc⁄f_t
;

102 c⁄° 
	gDeÁu…TimeSîvî
[4][
MAX_STRING1
] =

110 c⁄° *
	gDaySå
[] = {"Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"};

111 c⁄° *
	gMthSå
[] = {"Jan", "Feb", "Mar", "Apr", "May", "Jun",

114 
	gShowAŒHódî
;

115 
	gAutoSyncTime
;

116 
SYSTEMTIME
 
	gSYSTime
;

117 
SYSTEMTIME
 
	gLOCALTime
;

119 
	#HTTP_COMMAND_HEAD
 0

	)

120 
	#HTTP_COMMAND_GET
 1

	)

123 
size_t
 
	$SyncTime_CURL_WrôeOuçut
(*
±r
, 
size_t
 
size
, size_à
nmemb
,

124 *
°ªam
)

126 
	`fwrôe
(
±r
, 
size
, 
nmemb
, 
°ªam
);

127 (
nmemb
*
size
);

128 
	}
}

130 
size_t
 
	$SyncTime_CURL_WrôeHódî
(*
±r
, 
size_t
 
size
, size_à
nmemb
,

131 *
°ªam
)

133 
i
, 
RëVÆ
;

134 
TmpSå1
[26], 
TmpSå2
[26];

136 i‡(
ShowAŒHódî
 == 1)

137 
	`Ârötf
(
°dîr
, "%s", (*)(
±r
));

139 i‡(
	`°∫cmp
((*)(
±r
), "Date:", 5) == 0) {

140 i‡(
ShowAŒHódî
 == 0)

141 
	`Ârötf
(
°dîr
, "HTTP Sîvî. %s", (*)(
±r
));

143 i‡(
AutoSyncTime
 == 1) {

144 *
TmpSå1
 = 0;

145 *
TmpSå2
 = 0;

146 i‡(
	`°æí
((*)(
±r
)) > 50)

148 
AutoSyncTime
 = 0;

150 
RëVÆ
 = 
	`ssˇnf
 ((*)(
±r
), "Date: %s %hu %s %hu %hu:%hu:%hu",

151 
TmpSå1
, &
SYSTime
.
wDay
, 
TmpSå2
, &SYSTime.
wYór
,

152 &
SYSTime
.
wHour
, &SYSTime.
wMöuã
, &SYSTime.
wSec⁄d
);

154 i‡(
RëVÆ
 == 7) {

156 
SYSTime
.
wMûli£c⁄ds
 = 500;

157 
i
=0; i<12; i++) {

158 i‡(
	`°rcmp
(
MthSå
[
i
], 
TmpSå2
) == 0) {

159 
SYSTime
.
wM⁄th
 = 
i
+1;

163 
AutoSyncTime
 = 3;

166 
AutoSyncTime
 = 0;

172 i‡(
	`°∫cmp
((*)(
±r
), "X-Cache: HIT", 12) == 0) {

173 
	`Ârötf
(
°dîr
, "ERROR: HTTP Server data is cached."

175 
AutoSyncTime
 = 0;

177 (
nmemb
*
size
);

178 
	}
}

180 
	$SyncTime_CURL_Inô
(
CURL
 *
cuæ
, *
¥oxy_p‹t
,

181 *
¥oxy_u£r_∑ssw‹d
)

183 i‡(
	`°æí
(
¥oxy_p‹t
) > 0)

184 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
¥oxy_p‹t
);

186 i‡(
	`°æí
(
¥oxy_u£r_∑ssw‹d
) > 0)

187 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PROXYUSERPWD
, 
¥oxy_u£r_∑ssw‹d
);

190 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERAGENT
,

192 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, *
SyncTime_CURL_WrôeOuçut
);

193 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HEADERFUNCTION
, *
SyncTime_CURL_WrôeHódî
);

194 
	}
}

196 
	$SyncTime_CURL_Fëch
(
CURL
 *
cuæ
, *
URL_Så
, *
OutFûeName
,

197 
HâpGëBody
)

199 
FILE
 *
outfûe
;

200 
CURLcode
 
ªs
;

202 
outfûe
 = 
NULL
;

203 i‡(
HâpGëBody
 =
HTTP_COMMAND_HEAD
)

204 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_NOBODY
, 1L);

206 
outfûe
 = 
	`f›í
(
OutFûeName
, "wb");

207 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
outfûe
);

210 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL_Så
);

211 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

212 i‡(
outfûe
 !
NULL
)

213 
	`f˛o£
(
outfûe
);

214  
ªs
;

215 
	}
}

217 
	$showUßge
()

219 
	`Ârötf
(
°dîr
, "SYNCTIME: Synchronising computer clock withÅime server"

221 
	`Ârötf
(
°dîr
, "Usage : SYNCTIME [Option]\n");

222 
	`Ârötf
(
°dîr
, "Options :\n");

223 
	`Ârötf
(
°dîr
, " --server=WEBSERVER UseÅhisÅime server instead"

225 
	`Ârötf
(
°dîr
, " --showall Showáll HTTP header.\n");

226 
	`Ârötf
(
°dîr
, " --synctime Synchronising computer clock"

228 
	`Ârötf
(
°dîr
, " --proxy-user=USER[:PASS] SetÖroxy usernameánd"

230 
	`Ârötf
(
°dîr
, " --proxy=HOST[:PORT] Use HTTPÖroxy on given"

232 
	`Ârötf
(
°dîr
, " --help PrintÅhis help.\n");

233 
	`Ârötf
(
°dîr
, "\n");

235 
	}
}

237 
	$c⁄f_öô
(
c⁄f_t
 *
c⁄f
)

239 
i
;

241 *
c⁄f
->
hâp_¥oxy
 = 0;

242 
i
=0; i<
MAX_STRING1
; i++)

243 
c⁄f
->
¥oxy_u£r
[
i
] = 0;

244 *
c⁄f
->
time£rvî
 = 0;

246 
	}
}

248 
	$maö
(
¨gc
, *
¨gv
[])

250 
CURL
 *
cuæ
;

251 
c⁄f_t
 
c⁄f
[1];

252 
O±i⁄Index
;

253 
tm
 *
…
;

254 
tm
 *
gmt
;

255 
time_t
 
â
;

256 
time_t
 
â_loˇl
;

257 
time_t
 
â_gmt
;

258 
tz⁄ediffFlﬂt
;

259 
tz⁄ediffW‹d
;

260 
timeBuf
[61];

261 
tz⁄eBuf
[16];

262 
RëVÆue
;

264 
O±i⁄Index
 = 0;

265 
ShowAŒHódî
 = 0;

266 
AutoSyncTime
 = 0;

267 
RëVÆue
 = 0;

268 
	`c⁄f_öô
(
c⁄f
);

270 i‡(
¨gc
 > 1) {

271 
O±i⁄Index
 < 
¨gc
) {

272 i‡(
	`°∫cmp
(
¨gv
[
O±i⁄Index
], "--server=", 9) == 0)

273 
	`¢¥ötf
(
c⁄f
->
time£rvî
, 
MAX_STRING
, "%s", &
¨gv
[
O±i⁄Index
][9]);

275 i‡(
	`°rcmp
(
¨gv
[
O±i⁄Index
], "--showall") == 0)

276 
ShowAŒHódî
 = 1;

278 i‡(
	`°rcmp
(
¨gv
[
O±i⁄Index
], "--synctime") == 0)

279 
AutoSyncTime
 = 1;

281 i‡(
	`°∫cmp
(
¨gv
[
O±i⁄Index
], "--proxy-user=", 13) == 0)

282 
	`¢¥ötf
(
c⁄f
->
¥oxy_u£r
, 
MAX_STRING
, "%s", &
¨gv
[
O±i⁄Index
][13]);

284 i‡(
	`°∫cmp
(
¨gv
[
O±i⁄Index
], "--proxy=", 8) == 0)

285 
	`¢¥ötf
(
c⁄f
->
hâp_¥oxy
, 
MAX_STRING
, "%s", &
¨gv
[
O±i⁄Index
][8]);

287 i‡((
	`°rcmp
(
¨gv
[
O±i⁄Index
], "--help") == 0) ||

288 (
	`°rcmp
(
¨gv
[
O±i⁄Index
], "/?") == 0)) {

289 
	`showUßge
();

292 
O±i⁄Index
++;

296 i‡(*
c⁄f
->
time£rvî
 == 0)

297 
	`¢¥ötf
(
c⁄f
->
time£rvî
, 
MAX_STRING
, "%s", 
DeÁu…TimeSîvî
[0]);

300 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

301 
cuæ
 = 
	`cuæ_ósy_öô
();

302 i‡(
cuæ
) {

303 
	`SyncTime_CURL_Inô
(
cuæ
, 
c⁄f
->
hâp_¥oxy
, c⁄f->
¥oxy_u£r
);

306 
â
 = 
	`time
(0);

307 
…
 = 
	`loˇ…ime
(&
â
);

308 
â_loˇl
 = 
	`mktime
(
…
);

309 
gmt
 = 
	`gmtime
(&
â
);

310 
â_gmt
 = 
	`mktime
(
gmt
);

311 
tz⁄ediffFlﬂt
 = 
	`dif·ime
(
â_loˇl
, 
â_gmt
);

312 
tz⁄ediffW‹d
 = ()(
tz⁄ediffFlﬂt
/3600.0);

314 i‡(()(
tz⁄ediffW‹d
 * 3600Ë=
tz⁄ediffFlﬂt
)

315 
	`¢¥ötf
(
tz⁄eBuf
, 15, "%+03d'00'", 
tz⁄ediffW‹d
);

317 
	`¢¥ötf
(
tz⁄eBuf
, 15, "%+03d'30'", 
tz⁄ediffW‹d
);

320 
	`GëSy°emTime
(&
SYSTime
);

321 
	`GëLoˇlTime
(&
LOCALTime
);

322 
	`¢¥ötf
(
timeBuf
, 60, "%s, %02d %s %04d %02d:%02d:%02d.%03d, ",

323 
DaySå
[
LOCALTime
.
wDayOfWìk
], LOCALTime.
wDay
,

324 
MthSå
[
LOCALTime
.
wM⁄th
-1], LOCALTime.
wYór
,

325 
LOCALTime
.
wHour
, LOCALTime.
wMöuã
, LOCALTime.
wSec⁄d
,

326 
LOCALTime
.
wMûli£c⁄ds
);

328 
	`Ârötf
(
°dîr
, "Fëch: %s\n\n", 
c⁄f
->
time£rvî
);

329 
	`Ârötf
(
°dîr
, "Bef‹êHTTP. D©e: %s%s\n\n", 
timeBuf
, 
tz⁄eBuf
);

332 
	`SyncTime_CURL_Fëch
(
cuæ
, 
c⁄f
->
time£rvî
, "index.htm",

333 
HTTP_COMMAND_HEAD
);

335 
	`GëLoˇlTime
(&
LOCALTime
);

336 
	`¢¥ötf
(
timeBuf
, 60, "%s, %02d %s %04d %02d:%02d:%02d.%03d, ",

337 
DaySå
[
LOCALTime
.
wDayOfWìk
], LOCALTime.
wDay
,

338 
MthSå
[
LOCALTime
.
wM⁄th
-1], LOCALTime.
wYór
,

339 
LOCALTime
.
wHour
, LOCALTime.
wMöuã
, LOCALTime.
wSec⁄d
,

340 
LOCALTime
.
wMûli£c⁄ds
);

341 
	`Ârötf
(
°dîr
, "\nA·î HTTP. D©e: %s%s\n", 
timeBuf
, 
tz⁄eBuf
);

343 i‡(
AutoSyncTime
 == 3) {

345 i‡(!
	`SëSy°emTime
(&
SYSTime
)) {

346 
	`Ârötf
(
°dîr
, "ERROR: UnableÅo set systemÅime.\n");

347 
RëVÆue
 = 1;

351 
	`GëLoˇlTime
(&
LOCALTime
);

352 
	`¢¥ötf
(
timeBuf
, 60, "%s, %02d %s %04d %02d:%02d:%02d.%03d, ",

353 
DaySå
[
LOCALTime
.
wDayOfWìk
], LOCALTime.
wDay
,

354 
MthSå
[
LOCALTime
.
wM⁄th
-1], LOCALTime.
wYór
,

355 
LOCALTime
.
wHour
, LOCALTime.
wMöuã
, LOCALTime.
wSec⁄d
,

356 
LOCALTime
.
wMûli£c⁄ds
);

357 
	`Ârötf
(
°dîr
, "\nNew Sy°em'†D©e: %s%s\n", 
timeBuf
, 
tz⁄eBuf
);

362 
	`c⁄f_öô
(
c⁄f
);

363 
	`cuæ_ósy_˛ónup
(
cuæ
);

365  
RëVÆue
;

366 
	}
}

	@docs/examples/threaded-ssl.c

32 
	#USE_OPENSSL


	)

34 
	~<°dio.h
>

35 
	~<±hªad.h
>

36 
	~<cuæ/cuæ.h
>

38 
	#NUMT
 4

	)

41 
±hªad_muãx_t
 *
	glock¨øy
;

43 #ifde‡
USE_OPENSSL


44 
	~<›ís¶/¸y±o.h
>

45 
	$lock_ˇŒback
(
mode
, 
ty≥
, *
fûe
, 
löe
)

47 ()
fûe
;

48 ()
löe
;

49 i‡(
mode
 & 
CRYPTO_LOCK
) {

50 
	`±hªad_muãx_lock
(&(
lock¨øy
[
ty≥
]));

53 
	`±hªad_muãx_u∆ock
(&(
lock¨øy
[
ty≥
]));

55 
	}
}

57 
	$thªad_id
()

59 
ªt
;

61 
ªt
=()
	`±hªad_£lf
();

62 (
ªt
);

63 
	}
}

65 
	$öô_locks
()

67 
i
;

69 
lock¨øy
=(
±hªad_muãx_t
 *)
	`OPENSSL_mÆloc
(
	`CRYPTO_num_locks
() *

70 (
±hªad_muãx_t
));

71 
i
=0; i<
	`CRYPTO_num_locks
(); i++) {

72 
	`±hªad_muãx_öô
(&(
lock¨øy
[
i
]),
NULL
);

75 
	`CRYPTO_£t_id_ˇŒback
(((*)())
thªad_id
);

76 
	`CRYPTO_£t_lockög_ˇŒback
(((*)())
lock_ˇŒback
);

77 
	}
}

79 
	$kûl_locks
()

81 
i
;

83 
	`CRYPTO_£t_lockög_ˇŒback
(
NULL
);

84 
i
=0; i<
	`CRYPTO_num_locks
(); i++)

85 
	`±hªad_muãx_de°roy
(&(
lock¨øy
[
i
]));

87 
	`OPENSSL_‰ì
(
lock¨øy
);

88 
	}
}

91 #ifde‡
USE_GNUTLS


92 
	~<g¸y±.h
>

93 
	~<î∫o.h
>

95 
	gGCRY_THREAD_OPTION_PTHREAD_IMPL
;

97 
	$öô_locks
()

99 
	`g¸y_c⁄åﬁ
(
GCRYCTL_SET_THREAD_CBS
);

100 
	}
}

102 
	#kûl_locks
()

	)

106 c⁄° * c⁄° 
	guæs
[]= {

113 *
	$puŒ_⁄e_uæ
(*
uæ
)

115 
CURL
 *
cuæ
;

117 
cuæ
 = 
	`cuæ_ósy_öô
();

118 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
uæ
);

121 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

122 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYHOST
, 0L);

123 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

124 
	`cuæ_ósy_˛ónup
(
cuæ
);

126  
NULL
;

127 
	}
}

129 
	$maö
(
¨gc
, **
¨gv
)

131 
±hªad_t
 
tid
[
NUMT
];

132 
i
;

133 
îr‹
;

134 ()
¨gc
;

135 ()
¨gv
;

138 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

140 
	`öô_locks
();

142 
i
=0; i< 
NUMT
; i++) {

143 
îr‹
 = 
	`±hªad_¸óã
(&
tid
[
i
],

144 
NULL
,

145 
puŒ_⁄e_uæ
,

146 (*)
uæs
[
i
]);

147 if(0 !
îr‹
)

148 
	`Ârötf
(
°dîr
, "Couldn'àru¿thªadÇumbî %d,Éºnÿ%d\n", 
i
, 
îr‹
);

150 
	`Ârötf
(
°dîr
, "Thªad %d, gë†%s\n", 
i
, 
uæs
[i]);

154 
i
=0; i< 
NUMT
; i++) {

155 
îr‹
 = 
	`±hªad_joö
(
tid
[
i
], 
NULL
);

156 
	`Ârötf
(
°dîr
, "Thªad %dÅîmö©ed\n", 
i
);

159 
	`kûl_locks
();

162 
	}
}

	@docs/examples/url2file.c

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

26 
	~<cuæ/cuæ.h
>

28 
size_t
 
	$wrôe_d©a
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

30 
size_t
 
wrôãn
 = 
	`fwrôe
(
±r
, 
size
, 
nmemb
, (
FILE
 *)
°ªam
);

31  
wrôãn
;

32 
	}
}

34 
	$maö
(
¨gc
, *
¨gv
[])

36 
CURL
 *
cuæ_h™dÀ
;

37 c⁄° *
∑gefûíame
 = "page.out";

38 
FILE
 *
∑gefûe
;

40 if(
¨gc
 < 2 ) {

41 
	`¥ötf
("Ußge: %†<URL>\n", 
¨gv
[0]);

45 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

48 
cuæ_h™dÀ
 = 
	`cuæ_ósy_öô
();

51 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_URL
, 
¨gv
[1]);

54 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_VERBOSE
, 1L);

57 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_NOPROGRESS
, 1L);

60 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_d©a
);

63 
∑gefûe
 = 
	`f›í
(
∑gefûíame
, "wb");

64 i‡(
∑gefûe
) {

67 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_WRITEDATA
, 
∑gefûe
);

70 
	`cuæ_ósy_≥rf‹m
(
cuæ_h™dÀ
);

73 
	`f˛o£
(
∑gefûe
);

77 
	`cuæ_ósy_˛ónup
(
cuæ_h™dÀ
);

80 
	}
}

	@docs/examples/usercertinmem.c

30 
	~<›ís¶/s¶.h
>

31 
	~<›ís¶/x509.h
>

32 
	~<›ís¶/≥m.h
>

33 
	~<cuæ/cuæ.h
>

34 
	~<°dio.h
>

36 
size_t
 
	$wrôefun˘i⁄
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

38 
	`fwrôe
(
±r
,
size
,
nmemb
,
°ªam
);

39 (
nmemb
*
size
);

40 
	}
}

42 
CURLcode
 
	$s¶˘x_fun˘i⁄
(
CURL
 *
cuæ
, *
s¶˘x
, *
∑rm
)

44 
X509
 *
˚π
 = 
NULL
;

45 
BIO
 *
bio
 = 
NULL
;

46 
BIO
 *
kbio
 = 
NULL
;

47 
RSA
 *
rß
 = 
NULL
;

48 
ªt
;

50 c⁄° *
my≥m
 =

94 c⁄° *
mykey
 =

114 ()
cuæ
;

115 ()
∑rm
;

118 
bio
 = 
	`BIO_√w_mem_buf
((*)
my≥m
, -1);

120 i‡(
bio
 =
NULL
) {

121 
	`¥ötf
("BIO_new_mem_buf failed\n");

127 
˚π
 = 
	`PEM_ªad_bio_X509
(
bio
, 
NULL
, 0, NULL);

128 i‡(
˚π
 =
NULL
) {

129 
	`¥ötf
("PEM_read_bio_X509 failed...\n");

133 
ªt
 = 
	`SSL_CTX_u£_˚πifiˇã
((
SSL_CTX
*)
s¶˘x
, 
˚π
);

134 i‡(
ªt
 != 1) {

135 
	`¥ötf
("Use certificate failed\n");

139 
kbio
 = 
	`BIO_√w_mem_buf
((*)
mykey
, -1);

140 i‡(
kbio
 =
NULL
) {

141 
	`¥ötf
("BIO_new_mem_buf failed\n");

145 
rß
 = 
	`PEM_ªad_bio_RSAPriv©eKey
(
kbio
, 
NULL
, 0, NULL);

146 i‡(
rß
 =
NULL
) {

147 
	`¥ötf
("FailedÅo create key bio\n");

151 
ªt
 = 
	`SSL_CTX_u£_RSAPriv©eKey
((
SSL_CTX
*)
s¶˘x
, 
rß
);

152 i‡(
ªt
 != 1) {

153 
	`¥ötf
("Use Key failed\n");

157 i‡(
bio
)

158 
	`BIO_‰ì
(
bio
);

160 i‡(
kbio
)

161 
	`BIO_‰ì
(
kbio
);

163 i‡(
rß
)

164 
	`RSA_‰ì
(
rß
);

166 i‡(
˚π
)

167 
	`X509_‰ì
(
˚π
);

170  
CURLE_OK
 ;

171 
	}
}

173 
	$maö
()

175 
CURL
 *
ch
;

176 
CURLcode
 
rv
;

178 
rv
 = 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

179 
ch
 = 
	`cuæ_ósy_öô
();

180 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_VERBOSE
, 0L);

181 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_HEADER
, 0L);

182 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_NOPROGRESS
, 1L);

183 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_NOSIGNAL
, 1L);

184 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_WRITEFUNCTION
, *
wrôefun˘i⁄
);

185 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_WRITEDATA
, 
°dout
);

186 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_HEADERFUNCTION
, *
wrôefun˘i⁄
);

187 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_HEADERDATA
, 
°dîr
);

188 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_SSLCERTTYPE
,"PEM");

193 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_SSL_VERIFYPEER
, 0L);

194 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_SSL_VERIFYHOST
, 0L);

195 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
, 
CURLOPT_URL
, "https://www.example.com/");

196 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
, 
CURLOPT_SSLKEYTYPE
, "PEM");

200 
rv
 = 
	`cuæ_ósy_≥rf‹m
(
ch
);

201 i‡(
rv
==
CURLE_OK
) {

202 
	`¥ötf
("***Åransfer succeeded ***\n");

205 
	`¥ötf
("***Åransfer failed ***\n");

212 
rv
 = 
	`cuæ_ósy_£t›t
(
ch
,
CURLOPT_SSL_CTX_FUNCTION
, *
s¶˘x_fun˘i⁄
);

213 
rv
 = 
	`cuæ_ósy_≥rf‹m
(
ch
);

214 i‡(
rv
==
CURLE_OK
) {

215 
	`¥ötf
("***Åransfer succeeded ***\n");

218 
	`¥ötf
("***Åransfer failed ***\n");

221 
	`cuæ_ósy_˛ónup
(
ch
);

222 
	`cuæ_globÆ_˛ónup
();

223  
rv
;

224 
	}
}

	@docs/examples/xmlstream.c

31 
	~<°dio.h
>

32 
	~<°dlib.h
>

33 
	~<°rög.h
>

34 
	~<as£π.h
>

36 
	~<ex∑t.h
>

37 
	~<cuæ/cuæ.h
>

39 
	sMem‹ySåu˘
 {

40 *
	mmem‹y
;

41 
size_t
 
	msize
;

44 
	sP¨£rSåu˘
 {

45 
	mok
;

46 
size_t
 
	mègs
;

47 
size_t
 
	mdïth
;

48 
Mem‹ySåu˘
 
	mch¨a˘îs
;

51 
	$°¨tEÀmít
(*
u£rD©a
, c⁄° 
XML_Ch¨
 *
«me
, c⁄° XML_Ch¨ **
©ts
)

53 
P¨£rSåu˘
 *
°©e
 = (P¨£rSåu˘ *Ë
u£rD©a
;

54 
°©e
->
ègs
++;

55 
°©e
->
dïth
++;

58 
	`‰ì
(
°©e
->
ch¨a˘îs
.
mem‹y
);

59 
°©e
->
ch¨a˘îs
.
mem‹y
 = 
NULL
;

60 
°©e
->
ch¨a˘îs
.
size
 = 0;

61 
	}
}

63 
	$ch¨a˘îD©aH™dÀr
(*
u£rD©a
, c⁄° 
XML_Ch¨
 *
s
, 
Àn
)

65 
P¨£rSåu˘
 *
°©e
 = (P¨£rSåu˘ *Ë
u£rD©a
;

66 
Mem‹ySåu˘
 *
mem
 = &
°©e
->
ch¨a˘îs
;

68 
mem
->
mem‹y
 = 
	`ªÆloc
(mem->mem‹y, mem->
size
 + 
Àn
 + 1);

69 if(
mem
->
mem‹y
 =
NULL
) {

71 
	`Ârötf
(
°dîr
, "NotÉnough memory (reallocÑeturned NULL).\n");

72 
°©e
->
ok
 = 0;

76 
	`mem˝y
(&(
mem
->
mem‹y
[mem->
size
]), 
s
, 
Àn
);

77 
mem
->
size
 +
Àn
;

78 
mem
->
mem‹y
[mem->
size
] = 0;

79 
	}
}

81 
	$ídEÀmít
(*
u£rD©a
, c⁄° 
XML_Ch¨
 *
«me
)

83 
P¨£rSåu˘
 *
°©e
 = (P¨£rSåu˘ *Ë
u£rD©a
;

84 
°©e
->
dïth
--;

86 
	`¥ötf
("%5lu %10lu %s\n", 
°©e
->
dïth
, sèã->
ch¨a˘îs
.
size
, 
«me
);

87 
	}
}

89 
size_t
 
	$∑r£SåómCÆlback
(*
c⁄ã¡s
, 
size_t
 
Àngth
, size_à
nmemb
, *
u£Ω
)

91 
XML_P¨£r
 
∑r£r
 = (XML_P¨£rË
u£Ω
;

92 
size_t
 
ªÆ_size
 = 
Àngth
 * 
nmemb
;

93 
P¨£rSåu˘
 *
°©e
 = (P¨£rSåu˘ *Ë
	`XML_GëU£rD©a
(
∑r£r
);

96 i‡(
°©e
->
ok
 && 
	`XML_P¨£
(
∑r£r
, 
c⁄ã¡s
, 
ªÆ_size
, 0) == 0) {

97 
îr‹_code
 = 
	`XML_GëEº‹Code
(
∑r£r
);

98 
	`Ârötf
(
°dîr
, "ParsingÑesponse buffer ofÜength %lu failed withÉrror code %d (%s).\n",

99 
ªÆ_size
, 
îr‹_code
, 
	`XML_Eº‹Såög
(error_code));

100 
°©e
->
ok
 = 0;

103  
ªÆ_size
;

104 
	}
}

106 
	$maö
()

108 
CURL
 *
cuæ_h™dÀ
;

109 
CURLcode
 
ªs
;

110 
XML_P¨£r
 
∑r£r
;

111 
P¨£rSåu˘
 
°©e
;

114 
	`mem£t
(&
°©e
, 0, (
P¨£rSåu˘
));

115 
°©e
.
ok
 = 1;

118 
∑r£r
 = 
	`XML_P¨£rCª©eNS
(
NULL
, '\0');

119 
	`XML_SëU£rD©a
(
∑r£r
, &
°©e
);

120 
	`XML_SëEÀmítH™dÀr
(
∑r£r
, 
°¨tEÀmít
, 
ídEÀmít
);

121 
	`XML_SëCh¨a˘îD©aH™dÀr
(
∑r£r
, 
ch¨a˘îD©aH™dÀr
);

124 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
 ^ 
CURL_GLOBAL_SSL
);

125 
cuæ_h™dÀ
 = 
	`cuæ_ósy_öô
();

126 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_URL
, "http://www.w3schools.com/xml/simple.xml");

127 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_WRITEFUNCTION
, 
∑r£SåómCÆlback
);

128 
	`cuæ_ósy_£t›t
(
cuæ_h™dÀ
, 
CURLOPT_WRITEDATA
, (*)
∑r£r
);

130 
	`¥ötf
("Depth Characters Closing Tag\n");

133 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ_h™dÀ
);

134 if(
ªs
 !
CURLE_OK
) {

135 
	`Ârötf
(
°dîr
, "curl_easy_perform() failed: %s\n",

136 
	`cuæ_ósy_°ªº‹
(
ªs
));

138 i‡(
°©e
.
ok
) {

140 i‡(
	`XML_P¨£
(
∑r£r
, 
NULL
, 0, 1) == 0) {

141 
îr‹_code
 = 
	`XML_GëEº‹Code
(
∑r£r
);

142 
	`Ârötf
(
°dîr
, "FinalizingÖarsing failed withÉrror code %d (%s).\n",

143 
îr‹_code
, 
	`XML_Eº‹Såög
(error_code));

146 
	`¥ötf
(" --------------\n");

147 
	`¥ötf
(" %luÅag†tŸÆ\n", 
°©e
.
ègs
);

152 
	`‰ì
(
°©e
.
ch¨a˘îs
.
mem‹y
);

153 
	`XML_P¨£rFªe
(
∑r£r
);

154 
	`cuæ_ósy_˛ónup
(
cuæ_h™dÀ
);

155 
	`cuæ_globÆ_˛ónup
();

158 
	}
}

	@include/curl/curl.h

1 #i‚de‡
__CURL_CURL_H


2 
	#__CURL_CURL_H


	)

33 
	~"cuævî.h
"

34 
	~"cuæbuûd.h
"

35 
	~"cuæruÀs.h
"

41 #i‡(
deföed
(
_WIN32
Ë|| deföed(
__WIN32__
)) && \

42 !
deföed
(
WIN32
Ë&& !
	$deföed
(
__SYMBIAN32__
)

43 
	#WIN32


	)

46 
	~<°dio.h
>

47 
	~<limôs.h
>

49 #i‡
	`deföed
(
__FªeBSD__
) && (__FreeBSD__ >= 2)

51 
	~<o§ñd©e.h
>

55 
	~<sys/ty≥s.h
>

56 
	~<time.h
>

58 #i‡
	`deföed
(
WIN32
Ë&& !deföed(
_WIN32_WCE
Ë&& !deföed(
__CYGWIN__
)

59 #i‡!(
	`deföed
(
_WINSOCKAPI_
Ë|| deföed(
_WINSOCK_H
Ë|| deföed(
__LWIP_OPT_H__
))

62 
	~<wösock2.h
>

63 
	~<ws2t˝ù.h
>

70 #i‡
	`deföed
(
_AIX
Ë|| deföed(
__NOVELL_LIBC__
Ë|| deföed(
__NëBSD__
) || \

71 
	`deföed
(
__möix
Ë|| deföed(
__SYMBIAN32__
Ë|| deföed(
__INTEGRITY
) || \

72 
	`deföed
(
ANDROID
Ë|| deföed(
__ANDROID__
Ë|| deföed(
__O≥nBSD__
) || \

73 (
	`deföed
(
__FªeBSD_vîsi⁄
) && (__FreeBSD_version < 800000))

74 
	~<sys/£À˘.h
>

77 #i‡!
	`deföed
(
WIN32
Ë&& !deföed(
_WIN32_WCE
)

78 
	~<sys/sockë.h
>

81 #i‡!
	`deföed
(
WIN32
Ë&& !deföed(
__WATCOMC__
Ë&& !deföed(
__VXWORKS__
)

82 
	~<sys/time.h
>

85 #ifde‡
__BEOS__


86 
	~<suµ‹t/Suµ‹tDefs.h
>

89 #ifde‡ 
__˝lu•lus


93 
	tCURL
;

99 #ifde‡
CURL_STATICLIB


100 
	#CURL_EXTERN


	)

101 #ñi‡
	`deföed
(
WIN32
Ë|| deföed(
_WIN32
Ë|| deföed(
__SYMBIAN32__
)

102 #i‡
	`deföed
(
BUILDING_LIBCURL
)

103 
	#CURL_EXTERN
 
	`__de˛•ec
(
dŒexp‹t
)

	)

105 
	#CURL_EXTERN
 
	`__de˛•ec
(
dŒimp‹t
)

	)

107 #ñi‡
	`deföed
(
BUILDING_LIBCURL
Ë&& deföed(
CURL_HIDDEN_SYMBOLS
)

108 
	#CURL_EXTERN
 
CURL_EXTERN_SYMBOL


	)

110 
	#CURL_EXTERN


	)

113 #i‚de‡
cuæ_sockë_ty≥def


115 #i‡
	`deföed
(
WIN32
Ë&& !deföed(
__LWIP_OPT_H__
)

116 
SOCKET
 
	tcuæ_sockë_t
;

117 
	#CURL_SOCKET_BAD
 
INVALID_SOCKET


	)

119 
	tcuæ_sockë_t
;

120 
	#CURL_SOCKET_BAD
 -1

	)

122 
	#cuæ_sockë_ty≥def


	)

125 
	scuæ_hâµo°
 {

126 
cuæ_hâµo°
 *
√xt
;

127 *
«me
;

128 
«mñígth
;

129 *
c⁄ã¡s
;

130 
c⁄ã¡¶ígth
;

131 *
buf„r
;

132 
buf„æígth
;

133 *
c⁄ã¡ty≥
;

134 
cuæ_¶i°
* 
c⁄ã¡hódî
;

135 
cuæ_hâµo°
 *
m‹e
;

138 
Êags
;

139 
	#HTTPPOST_FILENAME
 (1<<0Ë

	)

140 
	#HTTPPOST_READFILE
 (1<<1Ë

	)

141 
	#HTTPPOST_PTRNAME
 (1<<2Ë

	)

143 
	#HTTPPOST_PTRCONTENTS
 (1<<3Ë

	)

145 
	#HTTPPOST_BUFFER
 (1<<4Ë

	)

146 
	#HTTPPOST_PTRBUFFER
 (1<<5Ë

	)

147 
	#HTTPPOST_CALLBACK
 (1<<6Ë

	)

152 *
showfûíame
;

155 *
u£Ω
;

161 (*
	tcuæ_¥ogªss_ˇŒback
)(*
	t˛õ¡p
,

162 
	td…ŸÆ
,

163 
	td ow
,

164 
	tu…ŸÆ
,

165 
	tu ow
);

169 (*
	tcuæ_x„röfo_ˇŒback
)(*
	t˛õ¡p
,

170 
	tcuæ_off_t
 
	td…ŸÆ
,

171 
	tcuæ_off_t
 
	td ow
,

172 
	tcuæ_off_t
 
	tu…ŸÆ
,

173 
	tcuæ_off_t
 
	tu ow
);

175 #i‚de‡
CURL_MAX_WRITE_SIZE


182 
	#CURL_MAX_WRITE_SIZE
 16384

	)

185 #i‚de‡
CURL_MAX_HTTP_HEADER


189 
	#CURL_MAX_HTTP_HEADER
 (100*1024)

	)

194 
	#CURL_WRITEFUNC_PAUSE
 0x10000001

	)

196 
	`size_t
 (*
	tcuæ_wrôe_ˇŒback
)(*
	tbuf„r
,

197 
	tsize_t
 
	tsize
,

198 
	tsize_t
 
	tnôems
,

199 *
	tout°ªam
);

205 
CURLFILETYPE_FILE
 = 0,

206 
CURLFILETYPE_DIRECTORY
,

207 
CURLFILETYPE_SYMLINK
,

208 
CURLFILETYPE_DEVICE_BLOCK
,

209 
CURLFILETYPE_DEVICE_CHAR
,

210 
CURLFILETYPE_NAMEDPIPE
,

211 
CURLFILETYPE_SOCKET
,

212 
CURLFILETYPE_DOOR
,

214 
CURLFILETYPE_UNKNOWN


215 } 
	tcuæfûëy≥
;

217 
	#CURLFINFOFLAG_KNOWN_FILENAME
 (1<<0)

	)

218 
	#CURLFINFOFLAG_KNOWN_FILETYPE
 (1<<1)

	)

219 
	#CURLFINFOFLAG_KNOWN_TIME
 (1<<2)

	)

220 
	#CURLFINFOFLAG_KNOWN_PERM
 (1<<3)

	)

221 
	#CURLFINFOFLAG_KNOWN_UID
 (1<<4)

	)

222 
	#CURLFINFOFLAG_KNOWN_GID
 (1<<5)

	)

223 
	#CURLFINFOFLAG_KNOWN_SIZE
 (1<<6)

	)

224 
	#CURLFINFOFLAG_KNOWN_HLINKCOUNT
 (1<<7)

	)

230 
	scuæ_fûeöfo
 {

231 *
fûíame
;

232 
cuæfûëy≥
 
fûëy≥
;

233 
time_t
 
time
;

234 
≥rm
;

235 
uid
;

236 
gid
;

237 
cuæ_off_t
 
size
;

238 
h¨dlöks
;

242 *
time
;

243 *
≥rm
;

244 *
u£r
;

245 *
group
;

246 *
èrgë
;

247 } 
°rögs
;

249 
Êags
;

252 * 
b_d©a
;

253 
size_t
 
b_size
;

254 
size_t
 
b_u£d
;

258 
	#CURL_CHUNK_BGN_FUNC_OK
 0

	)

259 
	#CURL_CHUNK_BGN_FUNC_FAIL
 1

	)

260 
	#CURL_CHUNK_BGN_FUNC_SKIP
 2

	)

265 (*
	tcuæ_chunk_bgn_ˇŒback
)(c⁄° *
	tå™s„r_öfo
,

266 *
	t±r
,

267 
	tªmaös
);

270 
	#CURL_CHUNK_END_FUNC_OK
 0

	)

271 
	#CURL_CHUNK_END_FUNC_FAIL
 1

	)

279 (*
	tcuæ_chunk_íd_ˇŒback
)(*
	t±r
);

282 
	#CURL_FNMATCHFUNC_MATCH
 0

	)

283 
	#CURL_FNMATCHFUNC_NOMATCH
 1

	)

284 
	#CURL_FNMATCHFUNC_FAIL
 2

	)

288 (*
	tcuæ_‚m©ch_ˇŒback
)(*
	t±r
,

289 c⁄° *
	t∑âîn
,

290 c⁄° *
	t°rög
);

293 
	#CURL_SEEKFUNC_OK
 0

	)

294 
	#CURL_SEEKFUNC_FAIL
 1

	)

295 
	#CURL_SEEKFUNC_CANTSEEK
 2

	)

297 (*
	tcuæ_£ek_ˇŒback
)(*
	tö°ªam
,

298 
	tcuæ_off_t
 
	toff£t
,

299 
	t‹igö
);

303 
	#CURL_READFUNC_ABORT
 0x10000000

	)

306 
	#CURL_READFUNC_PAUSE
 0x10000001

	)

308 
	`size_t
 (*
	tcuæ_ªad_ˇŒback
)(*
	tbuf„r
,

309 
	tsize_t
 
	tsize
,

310 
	tsize_t
 
	tnôems
,

311 *
	tö°ªam
);

314 
CURLSOCKTYPE_IPCXN
,

315 
CURLSOCKTYPE_ACCEPT
,

316 
CURLSOCKTYPE_LAST


317 } 
	tcuæsockty≥
;

321 
	#CURL_SOCKOPT_OK
 0

	)

322 
	#CURL_SOCKOPT_ERROR
 1

	)

324 
	#CURL_SOCKOPT_ALREADY_CONNECTED
 2

	)

326 (*
	tcuæ_sock›t_ˇŒback
)(*
	t˛õ¡p
,

327 
	tcuæ_sockë_t
 
	tcuæfd
,

328 
	tcuæsockty≥
 
	tpuΩo£
);

330 
	scuæ_sockaddr
 {

331 
Ámûy
;

332 
sockty≥
;

333 
¥Ÿocﬁ
;

334 
addæí
;

337 
sockaddr
 
addr
;

340 
cuæ_sockë_t


341 (*
	tcuæ_›ísockë_ˇŒback
)(*
	t˛õ¡p
,

342 
	tcuæsockty≥
 
	tpuΩo£
,

343 
	tcuæ_sockaddr
 *
	taddªss
);

346 (*
	tcuæ_˛o£sockë_ˇŒback
)(*
	t˛õ¡p
, 
	tcuæ_sockë_t
 
	tôem
);

349 
CURLIOE_OK
,

350 
CURLIOE_UNKNOWNCMD
,

351 
CURLIOE_FAILRESTART
,

352 
CURLIOE_LAST


353 } 
	tcuæi€º
;

356 
CURLIOCMD_NOP
,

357 
CURLIOCMD_RESTARTREAD
,

358 
CURLIOCMD_LAST


359 } 
	tcuæiocmd
;

361 
	`cuæi€º
 (*
	tcuæ_io˘l_ˇŒback
)(
	tCURL
 *
	th™dÀ
,

362 
	tcmd
,

363 *
	t˛õ¡p
);

371 *(*
	tcuæ_mÆloc_ˇŒback
)(
	tsize_t
 
	tsize
);

372 (*
	tcuæ_‰ì_ˇŒback
)(*
	t±r
);

373 *(*
	tcuæ_ªÆloc_ˇŒback
)(*
	t±r
, 
	tsize_t
 
	tsize
);

374 *(*
	tcuæ_°rdup_ˇŒback
)(c⁄° *
	t°r
);

375 *(*
	tcuæ_ˇŒoc_ˇŒback
)(
	tsize_t
 
	tnmemb
, size_à
	tsize
);

379 
CURLINFO_TEXT
 = 0,

380 
CURLINFO_HEADER_IN
,

381 
CURLINFO_HEADER_OUT
,

382 
CURLINFO_DATA_IN
,

383 
CURLINFO_DATA_OUT
,

384 
CURLINFO_SSL_DATA_IN
,

385 
CURLINFO_SSL_DATA_OUT
,

386 
CURLINFO_END


387 } 
	tcuæ_öfŸy≥
;

389 (*
	tcuæ_debug_ˇŒback
)

390 (
	tCURL
 *
	th™dÀ
,

391 
	tcuæ_öfŸy≥
 
	tty≥
,

392 *
	td©a
,

393 
	tsize_t
 
	tsize
,

394 *
	tu£Ωå
);

404 
CURLE_OK
 = 0,

405 
CURLE_UNSUPPORTED_PROTOCOL
,

406 
CURLE_FAILED_INIT
,

407 
CURLE_URL_MALFORMAT
,

408 
CURLE_NOT_BUILT_IN
,

410 
CURLE_COULDNT_RESOLVE_PROXY
,

411 
CURLE_COULDNT_RESOLVE_HOST
,

412 
CURLE_COULDNT_CONNECT
,

413 
CURLE_FTP_WEIRD_SERVER_REPLY
,

414 
CURLE_REMOTE_ACCESS_DENIED
,

417 
CURLE_FTP_ACCEPT_FAILED
,

419 
CURLE_FTP_WEIRD_PASS_REPLY
,

420 
CURLE_FTP_ACCEPT_TIMEOUT
,

423 
CURLE_FTP_WEIRD_PASV_REPLY
,

424 
CURLE_FTP_WEIRD_227_FORMAT
,

425 
CURLE_FTP_CANT_GET_HOST
,

426 
CURLE_OBSOLETE16
,

427 
CURLE_FTP_COULDNT_SET_TYPE
,

428 
CURLE_PARTIAL_FILE
,

429 
CURLE_FTP_COULDNT_RETR_FILE
,

430 
CURLE_OBSOLETE20
,

431 
CURLE_QUOTE_ERROR
,

432 
CURLE_HTTP_RETURNED_ERROR
,

433 
CURLE_WRITE_ERROR
,

434 
CURLE_OBSOLETE24
,

435 
CURLE_UPLOAD_FAILED
,

436 
CURLE_READ_ERROR
,

437 
CURLE_OUT_OF_MEMORY
,

442 
CURLE_OPERATION_TIMEDOUT
,

443 
CURLE_OBSOLETE29
,

444 
CURLE_FTP_PORT_FAILED
,

445 
CURLE_FTP_COULDNT_USE_REST
,

446 
CURLE_OBSOLETE32
,

447 
CURLE_RANGE_ERROR
,

448 
CURLE_HTTP_POST_ERROR
,

449 
CURLE_SSL_CONNECT_ERROR
,

450 
CURLE_BAD_DOWNLOAD_RESUME
,

451 
CURLE_FILE_COULDNT_READ_FILE
,

452 
CURLE_LDAP_CANNOT_BIND
,

453 
CURLE_LDAP_SEARCH_FAILED
,

454 
CURLE_OBSOLETE40
,

455 
CURLE_FUNCTION_NOT_FOUND
,

456 
CURLE_ABORTED_BY_CALLBACK
,

457 
CURLE_BAD_FUNCTION_ARGUMENT
,

458 
CURLE_OBSOLETE44
,

459 
CURLE_INTERFACE_FAILED
,

460 
CURLE_OBSOLETE46
,

461 
CURLE_TOO_MANY_REDIRECTS
 ,

462 
CURLE_UNKNOWN_OPTION
,

463 
CURLE_TELNET_OPTION_SYNTAX
 ,

464 
CURLE_OBSOLETE50
,

465 
CURLE_PEER_FAILED_VERIFICATION
,

467 
CURLE_GOT_NOTHING
,

468 
CURLE_SSL_ENGINE_NOTFOUND
,

469 
CURLE_SSL_ENGINE_SETFAILED
,

471 
CURLE_SEND_ERROR
,

472 
CURLE_RECV_ERROR
,

473 
CURLE_OBSOLETE57
,

474 
CURLE_SSL_CERTPROBLEM
,

475 
CURLE_SSL_CIPHER
,

476 
CURLE_SSL_CACERT
,

477 
CURLE_BAD_CONTENT_ENCODING
,

478 
CURLE_LDAP_INVALID_URL
,

479 
CURLE_FILESIZE_EXCEEDED
,

480 
CURLE_USE_SSL_FAILED
,

481 
CURLE_SEND_FAIL_REWIND
,

483 
CURLE_SSL_ENGINE_INITFAILED
,

484 
CURLE_LOGIN_DENIED
,

486 
CURLE_TFTP_NOTFOUND
,

487 
CURLE_TFTP_PERM
,

488 
CURLE_REMOTE_DISK_FULL
,

489 
CURLE_TFTP_ILLEGAL
,

490 
CURLE_TFTP_UNKNOWNID
,

491 
CURLE_REMOTE_FILE_EXISTS
,

492 
CURLE_TFTP_NOSUCHUSER
,

493 
CURLE_CONV_FAILED
,

494 
CURLE_CONV_REQD
,

499 
CURLE_SSL_CACERT_BADFILE
,

501 
CURLE_REMOTE_FILE_NOT_FOUND
,

502 
CURLE_SSH
,

506 
CURLE_SSL_SHUTDOWN_FAILED
,

508 
CURLE_AGAIN
,

511 
CURLE_SSL_CRL_BADFILE
,

513 
CURLE_SSL_ISSUER_ERROR
,

515 
CURLE_FTP_PRET_FAILED
,

516 
CURLE_RTSP_CSEQ_ERROR
,

517 
CURLE_RTSP_SESSION_ERROR
,

518 
CURLE_FTP_BAD_FILE_LIST
,

519 
CURLE_CHUNK_FAILED
,

520 
CURLE_NO_CONNECTION_AVAILABLE
,

522 
CURL_LAST


523 } 
	tCURLcode
;

525 #i‚de‡
CURL_NO_OLDIES


529 
	#CURLE_OBSOLETE10
 
CURLE_FTP_ACCEPT_FAILED


	)

530 
	#CURLE_OBSOLETE12
 
CURLE_FTP_ACCEPT_TIMEOUT


	)

533 
	#CURLOPT_ENCODING
 
CURLOPT_ACCEPT_ENCODING


	)

536 
	#CURLE_UNKNOWN_TELNET_OPTION
 
CURLE_UNKNOWN_OPTION


	)

540 
	#CURLE_SSL_PEER_CERTIFICATE
 
CURLE_PEER_FAILED_VERIFICATION


	)

544 
	#CURLE_OBSOLETE
 
CURLE_OBSOLETE50


	)

545 
	#CURLE_BAD_PASSWORD_ENTERED
 
CURLE_OBSOLETE46


	)

546 
	#CURLE_BAD_CALLING_ORDER
 
CURLE_OBSOLETE44


	)

547 
	#CURLE_FTP_USER_PASSWORD_INCORRECT
 
CURLE_OBSOLETE10


	)

548 
	#CURLE_FTP_CANT_RECONNECT
 
CURLE_OBSOLETE16


	)

549 
	#CURLE_FTP_COULDNT_GET_SIZE
 
CURLE_OBSOLETE32


	)

550 
	#CURLE_FTP_COULDNT_SET_ASCII
 
CURLE_OBSOLETE29


	)

551 
	#CURLE_FTP_WEIRD_USER_REPLY
 
CURLE_OBSOLETE12


	)

552 
	#CURLE_FTP_WRITE_ERROR
 
CURLE_OBSOLETE20


	)

553 
	#CURLE_LIBRARY_NOT_FOUND
 
CURLE_OBSOLETE40


	)

554 
	#CURLE_MALFORMAT_USER
 
CURLE_OBSOLETE24


	)

555 
	#CURLE_SHARE_IN_USE
 
CURLE_OBSOLETE57


	)

556 
	#CURLE_URL_MALFORMAT_USER
 
CURLE_NOT_BUILT_IN


	)

558 
	#CURLE_FTP_ACCESS_DENIED
 
CURLE_REMOTE_ACCESS_DENIED


	)

559 
	#CURLE_FTP_COULDNT_SET_BINARY
 
CURLE_FTP_COULDNT_SET_TYPE


	)

560 
	#CURLE_FTP_QUOTE_ERROR
 
CURLE_QUOTE_ERROR


	)

561 
	#CURLE_TFTP_DISKFULL
 
CURLE_REMOTE_DISK_FULL


	)

562 
	#CURLE_TFTP_EXISTS
 
CURLE_REMOTE_FILE_EXISTS


	)

563 
	#CURLE_HTTP_RANGE_ERROR
 
CURLE_RANGE_ERROR


	)

564 
	#CURLE_FTP_SSL_FAILED
 
CURLE_USE_SSL_FAILED


	)

568 
	#CURLE_OPERATION_TIMEOUTED
 
CURLE_OPERATION_TIMEDOUT


	)

570 
	#CURLE_HTTP_NOT_FOUND
 
CURLE_HTTP_RETURNED_ERROR


	)

571 
	#CURLE_HTTP_PORT_FAILED
 
CURLE_INTERFACE_FAILED


	)

572 
	#CURLE_FTP_COULDNT_STOR_FILE
 
CURLE_UPLOAD_FAILED


	)

574 
	#CURLE_FTP_PARTIAL_FILE
 
CURLE_PARTIAL_FILE


	)

575 
	#CURLE_FTP_BAD_DOWNLOAD_RESUME
 
CURLE_BAD_DOWNLOAD_RESUME


	)

580 
	#CURLE_ALREADY_COMPLETE
 99999

	)

583 
	#CURLOPT_FILE
 
CURLOPT_WRITEDATA


	)

584 
	#CURLOPT_INFILE
 
CURLOPT_READDATA


	)

585 
	#CURLOPT_WRITEHEADER
 
CURLOPT_HEADERDATA


	)

589 
	#CURLOPT_WRITEINFO
 
CURLOPT_OBSOLETE40


	)

590 
	#CURLOPT_CLOSEPOLICY
 
CURLOPT_OBSOLETE72


	)

595 
	`CURLcode
 (*
	tcuæ_c⁄v_ˇŒback
)(*
	tbuf„r
, 
	tsize_t
 
	tÀngth
);

597 
	`CURLcode
 (*
	tcuæ_s¶_˘x_ˇŒback
)(
	tCURL
 *
	tcuæ
,

598 *
	ts¶_˘x
,

600 *
	tu£Ωå
);

603 
CURLPROXY_HTTP
 = 0,

605 
CURLPROXY_HTTP_1_0
 = 1,

607 
CURLPROXY_SOCKS4
 = 4,

609 
CURLPROXY_SOCKS5
 = 5,

610 
CURLPROXY_SOCKS4A
 = 6,

611 
CURLPROXY_SOCKS5_HOSTNAME
 = 7

614 } 
	tcuæ_¥oxyty≥
;

632 
	#CURLAUTH_NONE
 (()0)

	)

633 
	#CURLAUTH_BASIC
 ((()1)<<0)

	)

634 
	#CURLAUTH_DIGEST
 ((()1)<<1)

	)

635 
	#CURLAUTH_GSSNEGOTIATE
 ((()1)<<2)

	)

636 
	#CURLAUTH_NTLM
 ((()1)<<3)

	)

637 
	#CURLAUTH_DIGEST_IE
 ((()1)<<4)

	)

638 
	#CURLAUTH_NTLM_WB
 ((()1)<<5)

	)

639 
	#CURLAUTH_ONLY
 ((()1)<<31)

	)

640 
	#CURLAUTH_ANY
 (~
CURLAUTH_DIGEST_IE
)

	)

641 
	#CURLAUTH_ANYSAFE
 (~(
CURLAUTH_BASIC
|
CURLAUTH_DIGEST_IE
))

	)

643 
	#CURLSSH_AUTH_ANY
 ~0

	)

644 
	#CURLSSH_AUTH_NONE
 0

	)

645 
	#CURLSSH_AUTH_PUBLICKEY
 (1<<0Ë

	)

646 
	#CURLSSH_AUTH_PASSWORD
 (1<<1Ë

	)

647 
	#CURLSSH_AUTH_HOST
 (1<<2Ë

	)

648 
	#CURLSSH_AUTH_KEYBOARD
 (1<<3Ë

	)

649 
	#CURLSSH_AUTH_AGENT
 (1<<4Ë

	)

650 
	#CURLSSH_AUTH_DEFAULT
 
CURLSSH_AUTH_ANY


	)

652 
	#CURLGSSAPI_DELEGATION_NONE
 0

	)

653 
	#CURLGSSAPI_DELEGATION_POLICY_FLAG
 (1<<0Ë

	)

654 
	#CURLGSSAPI_DELEGATION_FLAG
 (1<<1Ë

	)

656 
	#CURL_ERROR_SIZE
 256

	)

658 
	ecuæ_khty≥
 {

659 
CURLKHTYPE_UNKNOWN
,

660 
CURLKHTYPE_RSA1
,

661 
CURLKHTYPE_RSA
,

662 
CURLKHTYPE_DSS


665 
	scuæ_khkey
 {

666 c⁄° *
key
;

668 
size_t
 
Àn
;

669 
cuæ_khty≥
 
keyty≥
;

674 
	ecuæ_kh°©
 {

675 
CURLKHSTAT_FINE_ADD_TO_FILE
,

676 
CURLKHSTAT_FINE
,

677 
CURLKHSTAT_REJECT
,

678 
CURLKHSTAT_DEFER
,

681 
CURLKHSTAT_LAST


685 
	ecuæ_khm©ch
 {

686 
CURLKHMATCH_OK
,

687 
CURLKHMATCH_MISMATCH
,

688 
CURLKHMATCH_MISSING
,

689 
CURLKHMATCH_LAST


693 (*
	tcuæ_sshkeyˇŒback
Ë(
	tCURL
 *
	tósy
,

694 c⁄° 
	tcuæ_khkey
 *
	tknownkey
,

695 c⁄° 
	tcuæ_khkey
 *
	tfoundkey
,

696 
	tcuæ_khm©ch
,

697 *
	t˛õ¡p
);

701 
CURLUSESSL_NONE
,

702 
CURLUSESSL_TRY
,

703 
CURLUSESSL_CONTROL
,

704 
CURLUSESSL_ALL
,

705 
CURLUSESSL_LAST


706 } 
	tcuæ_u£s¶
;

715 
	#CURLSSLOPT_ALLOW_BEAST
 (1<<0)

	)

717 #i‚de‡
CURL_NO_OLDIES


723 
	#CURLFTPSSL_NONE
 
CURLUSESSL_NONE


	)

724 
	#CURLFTPSSL_TRY
 
CURLUSESSL_TRY


	)

725 
	#CURLFTPSSL_CONTROL
 
CURLUSESSL_CONTROL


	)

726 
	#CURLFTPSSL_ALL
 
CURLUSESSL_ALL


	)

727 
	#CURLFTPSSL_LAST
 
CURLUSESSL_LAST


	)

728 
	#cuæ_·ps¶
 
cuæ_u£s¶


	)

733 
CURLFTPSSL_CCC_NONE
,

734 
CURLFTPSSL_CCC_PASSIVE
,

735 
CURLFTPSSL_CCC_ACTIVE
,

736 
CURLFTPSSL_CCC_LAST


737 } 
	tcuæ_·pccc
;

741 
CURLFTPAUTH_DEFAULT
,

742 
CURLFTPAUTH_SSL
,

743 
CURLFTPAUTH_TLS
,

744 
CURLFTPAUTH_LAST


745 } 
	tcuæ_·∑uth
;

749 
CURLFTP_CREATE_DIR_NONE
,

750 
CURLFTP_CREATE_DIR
,

753 
CURLFTP_CREATE_DIR_RETRY
,

755 
CURLFTP_CREATE_DIR_LAST


756 } 
	tcuæ_·p¸óãdú
;

760 
CURLFTPMETHOD_DEFAULT
,

761 
CURLFTPMETHOD_MULTICWD
,

762 
CURLFTPMETHOD_NOCWD
,

763 
CURLFTPMETHOD_SINGLECWD
,

764 
CURLFTPMETHOD_LAST


765 } 
	tcuæ_·pmëhod
;

768 
	#CURLHEADER_UNIFIED
 0

	)

769 
	#CURLHEADER_SEPARATE
 (1<<0)

	)

772 
	#CURLPROTO_HTTP
 (1<<0)

	)

773 
	#CURLPROTO_HTTPS
 (1<<1)

	)

774 
	#CURLPROTO_FTP
 (1<<2)

	)

775 
	#CURLPROTO_FTPS
 (1<<3)

	)

776 
	#CURLPROTO_SCP
 (1<<4)

	)

777 
	#CURLPROTO_SFTP
 (1<<5)

	)

778 
	#CURLPROTO_TELNET
 (1<<6)

	)

779 
	#CURLPROTO_LDAP
 (1<<7)

	)

780 
	#CURLPROTO_LDAPS
 (1<<8)

	)

781 
	#CURLPROTO_DICT
 (1<<9)

	)

782 
	#CURLPROTO_FILE
 (1<<10)

	)

783 
	#CURLPROTO_TFTP
 (1<<11)

	)

784 
	#CURLPROTO_IMAP
 (1<<12)

	)

785 
	#CURLPROTO_IMAPS
 (1<<13)

	)

786 
	#CURLPROTO_POP3
 (1<<14)

	)

787 
	#CURLPROTO_POP3S
 (1<<15)

	)

788 
	#CURLPROTO_SMTP
 (1<<16)

	)

789 
	#CURLPROTO_SMTPS
 (1<<17)

	)

790 
	#CURLPROTO_RTSP
 (1<<18)

	)

791 
	#CURLPROTO_RTMP
 (1<<19)

	)

792 
	#CURLPROTO_RTMPT
 (1<<20)

	)

793 
	#CURLPROTO_RTMPE
 (1<<21)

	)

794 
	#CURLPROTO_RTMPTE
 (1<<22)

	)

795 
	#CURLPROTO_RTMPS
 (1<<23)

	)

796 
	#CURLPROTO_RTMPTS
 (1<<24)

	)

797 
	#CURLPROTO_GOPHER
 (1<<25)

	)

798 
	#CURLPROTO_ALL
 (~0Ë

	)

802 
	#CURLOPTTYPE_LONG
 0

	)

803 
	#CURLOPTTYPE_OBJECTPOINT
 10000

	)

804 
	#CURLOPTTYPE_FUNCTIONPOINT
 20000

	)

805 
	#CURLOPTTYPE_OFF_T
 30000

	)

810 #ifde‡
CINIT


811 #unde‡
CINIT


814 #ifde‡
CURL_ISOCPP


815 
	#CINIT
(
«
,
t
,
nu
Ë
CURLOPT_
 ##Ç®
CURLOPTTYPE_
 ##Å + 
	)
nu

818 
	#LONG
 
CURLOPTTYPE_LONG


	)

819 
	#OBJECTPOINT
 
CURLOPTTYPE_OBJECTPOINT


	)

820 
	#FUNCTIONPOINT
 
CURLOPTTYPE_FUNCTIONPOINT


	)

821 
	#OFF_T
 
CURLOPTTYPE_OFF_T


	)

822 
	#CINIT
(
«me
,
ty≥
,
numbî
Ë
CURLOPT_
Çamêty≥ + 
	)
number

833 
	`CINIT
(
WRITEDATA
, 
OBJECTPOINT
, 1),

836 
	`CINIT
(
URL
, 
OBJECTPOINT
, 2),

839 
	`CINIT
(
PORT
, 
LONG
, 3),

842 
	`CINIT
(
PROXY
, 
OBJECTPOINT
, 4),

845 
	`CINIT
(
USERPWD
, 
OBJECTPOINT
, 5),

848 
	`CINIT
(
PROXYUSERPWD
, 
OBJECTPOINT
, 6),

851 
	`CINIT
(
RANGE
, 
OBJECTPOINT
, 7),

856 
	`CINIT
(
READDATA
, 
OBJECTPOINT
, 9),

860 
	`CINIT
(
ERRORBUFFER
, 
OBJECTPOINT
, 10),

864 
	`CINIT
(
WRITEFUNCTION
, 
FUNCTIONPOINT
, 11),

868 
	`CINIT
(
READFUNCTION
, 
FUNCTIONPOINT
, 12),

871 
	`CINIT
(
TIMEOUT
, 
LONG
, 13),

882 
	`CINIT
(
INFILESIZE
, 
LONG
, 14),

885 
	`CINIT
(
POSTFIELDS
, 
OBJECTPOINT
, 15),

888 
	`CINIT
(
REFERER
, 
OBJECTPOINT
, 16),

892 
	`CINIT
(
FTPPORT
, 
OBJECTPOINT
, 17),

895 
	`CINIT
(
USERAGENT
, 
OBJECTPOINT
, 18),

904 
	`CINIT
(
LOW_SPEED_LIMIT
, 
LONG
, 19),

907 
	`CINIT
(
LOW_SPEED_TIME
, 
LONG
, 20),

915 
	`CINIT
(
RESUME_FROM
, 
LONG
, 21),

918 
	`CINIT
(
COOKIE
, 
OBJECTPOINT
, 22),

922 
	`CINIT
(
HTTPHEADER
, 
OBJECTPOINT
, 23),

925 
	`CINIT
(
HTTPPOST
, 
OBJECTPOINT
, 24),

928 
	`CINIT
(
SSLCERT
, 
OBJECTPOINT
, 25),

931 
	`CINIT
(
KEYPASSWD
, 
OBJECTPOINT
, 26),

934 
	`CINIT
(
CRLF
, 
LONG
, 27),

937 
	`CINIT
(
QUOTE
, 
OBJECTPOINT
, 28),

941 
	`CINIT
(
HEADERDATA
, 
OBJECTPOINT
, 29),

945 
	`CINIT
(
COOKIEFILE
, 
OBJECTPOINT
, 31),

949 
	`CINIT
(
SSLVERSION
, 
LONG
, 32),

952 
	`CINIT
(
TIMECONDITION
, 
LONG
, 33),

956 
	`CINIT
(
TIMEVALUE
, 
LONG
, 34),

964 
	`CINIT
(
CUSTOMREQUEST
, 
OBJECTPOINT
, 36),

967 
	`CINIT
(
STDERR
, 
OBJECTPOINT
, 37),

972 
	`CINIT
(
POSTQUOTE
, 
OBJECTPOINT
, 39),

974 
	`CINIT
(
OBSOLETE40
, 
OBJECTPOINT
, 40),

976 
	`CINIT
(
VERBOSE
, 
LONG
, 41),

977 
	`CINIT
(
HEADER
, 
LONG
, 42),

978 
	`CINIT
(
NOPROGRESS
, 
LONG
, 43),

979 
	`CINIT
(
NOBODY
, 
LONG
, 44),

980 
	`CINIT
(
FAILONERROR
, 
LONG
, 45),

981 
	`CINIT
(
UPLOAD
, 
LONG
, 46),

982 
	`CINIT
(
POST
, 
LONG
, 47),

983 
	`CINIT
(
DIRLISTONLY
, 
LONG
, 48),

985 
	`CINIT
(
APPEND
, 
LONG
, 50),

989 
	`CINIT
(
NETRC
, 
LONG
, 51),

991 
	`CINIT
(
FOLLOWLOCATION
, 
LONG
, 52),

993 
	`CINIT
(
TRANSFERTEXT
, 
LONG
, 53),

994 
	`CINIT
(
PUT
, 
LONG
, 54),

1002 
	`CINIT
(
PROGRESSFUNCTION
, 
FUNCTIONPOINT
, 56),

1006 
	`CINIT
(
PROGRESSDATA
, 
OBJECTPOINT
, 57),

1007 
	#CURLOPT_XFERINFODATA
 
CURLOPT_PROGRESSDATA


	)

1010 
	`CINIT
(
AUTOREFERER
, 
LONG
, 58),

1014 
	`CINIT
(
PROXYPORT
, 
LONG
, 59),

1017 
	`CINIT
(
POSTFIELDSIZE
, 
LONG
, 60),

1020 
	`CINIT
(
HTTPPROXYTUNNEL
, 
LONG
, 61),

1023 
	`CINIT
(
INTERFACE
, 
OBJECTPOINT
, 62),

1028 
	`CINIT
(
KRBLEVEL
, 
OBJECTPOINT
, 63),

1031 
	`CINIT
(
SSL_VERIFYPEER
, 
LONG
, 64),

1035 
	`CINIT
(
CAINFO
, 
OBJECTPOINT
, 65),

1041 
	`CINIT
(
MAXREDIRS
, 
LONG
, 68),

1045 
	`CINIT
(
FILETIME
, 
LONG
, 69),

1048 
	`CINIT
(
TELNETOPTIONS
, 
OBJECTPOINT
, 70),

1051 
	`CINIT
(
MAXCONNECTS
, 
LONG
, 71),

1053 
	`CINIT
(
OBSOLETE72
, 
LONG
, 72),

1060 
	`CINIT
(
FRESH_CONNECT
, 
LONG
, 74),

1065 
	`CINIT
(
FORBID_REUSE
, 
LONG
, 75),

1069 
	`CINIT
(
RANDOM_FILE
, 
OBJECTPOINT
, 76),

1072 
	`CINIT
(
EGDSOCKET
, 
OBJECTPOINT
, 77),

1076 
	`CINIT
(
CONNECTTIMEOUT
, 
LONG
, 78),

1080 
	`CINIT
(
HEADERFUNCTION
, 
FUNCTIONPOINT
, 79),

1085 
	`CINIT
(
HTTPGET
, 
LONG
, 80),

1090 
	`CINIT
(
SSL_VERIFYHOST
, 
LONG
, 81),

1094 
	`CINIT
(
COOKIEJAR
, 
OBJECTPOINT
, 82),

1097 
	`CINIT
(
SSL_CIPHER_LIST
, 
OBJECTPOINT
, 83),

1101 
	`CINIT
(
HTTP_VERSION
, 
LONG
, 84),

1106 
	`CINIT
(
FTP_USE_EPSV
, 
LONG
, 85),

1109 
	`CINIT
(
SSLCERTTYPE
, 
OBJECTPOINT
, 86),

1112 
	`CINIT
(
SSLKEY
, 
OBJECTPOINT
, 87),

1115 
	`CINIT
(
SSLKEYTYPE
, 
OBJECTPOINT
, 88),

1118 
	`CINIT
(
SSLENGINE
, 
OBJECTPOINT
, 89),

1123 
	`CINIT
(
SSLENGINE_DEFAULT
, 
LONG
, 90),

1126 
	`CINIT
(
DNS_USE_GLOBAL_CACHE
, 
LONG
, 91),

1129 
	`CINIT
(
DNS_CACHE_TIMEOUT
, 
LONG
, 92),

1132 
	`CINIT
(
PREQUOTE
, 
OBJECTPOINT
, 93),

1135 
	`CINIT
(
DEBUGFUNCTION
, 
FUNCTIONPOINT
, 94),

1138 
	`CINIT
(
DEBUGDATA
, 
OBJECTPOINT
, 95),

1141 
	`CINIT
(
COOKIESESSION
, 
LONG
, 96),

1145 
	`CINIT
(
CAPATH
, 
OBJECTPOINT
, 97),

1148 
	`CINIT
(
BUFFERSIZE
, 
LONG
, 98),

1153 
	`CINIT
(
NOSIGNAL
, 
LONG
, 99),

1156 
	`CINIT
(
SHARE
, 
OBJECTPOINT
, 100),

1160 
	`CINIT
(
PROXYTYPE
, 
LONG
, 101),

1165 
	`CINIT
(
ACCEPT_ENCODING
, 
OBJECTPOINT
, 102),

1168 
	`CINIT
(
PRIVATE
, 
OBJECTPOINT
, 103),

1171 
	`CINIT
(
HTTP200ALIASES
, 
OBJECTPOINT
, 104),

1176 
	`CINIT
(
UNRESTRICTED_AUTH
, 
LONG
, 105),

1181 
	`CINIT
(
FTP_USE_EPRT
, 
LONG
, 106),

1186 
	`CINIT
(
HTTPAUTH
, 
LONG
, 107),

1191 
	`CINIT
(
SSL_CTX_FUNCTION
, 
FUNCTIONPOINT
, 108),

1195 
	`CINIT
(
SSL_CTX_DATA
, 
OBJECTPOINT
, 109),

1201 
	`CINIT
(
FTP_CREATE_MISSING_DIRS
, 
LONG
, 110),

1206 
	`CINIT
(
PROXYAUTH
, 
LONG
, 111),

1212 
	`CINIT
(
FTP_RESPONSE_TIMEOUT
, 
LONG
, 112),

1213 
	#CURLOPT_SERVER_RESPONSE_TIMEOUT
 
CURLOPT_FTP_RESPONSE_TIMEOUT


	)

1218 
	`CINIT
(
IPRESOLVE
, 
LONG
, 113),

1225 
	`CINIT
(
MAXFILESIZE
, 
LONG
, 114),

1230 
	`CINIT
(
INFILESIZE_LARGE
, 
OFF_T
, 115),

1235 
	`CINIT
(
RESUME_FROM_LARGE
, 
OFF_T
, 116),

1240 
	`CINIT
(
MAXFILESIZE_LARGE
, 
OFF_T
, 117),

1246 
	`CINIT
(
NETRC_FILE
, 
OBJECTPOINT
, 118),

1253 
	`CINIT
(
USE_SSL
, 
LONG
, 119),

1256 
	`CINIT
(
POSTFIELDSIZE_LARGE
, 
OFF_T
, 120),

1259 
	`CINIT
(
TCP_NODELAY
, 
LONG
, 121),

1279 
	`CINIT
(
FTPSSLAUTH
, 
LONG
, 129),

1281 
	`CINIT
(
IOCTLFUNCTION
, 
FUNCTIONPOINT
, 130),

1282 
	`CINIT
(
IOCTLDATA
, 
OBJECTPOINT
, 131),

1289 
	`CINIT
(
FTP_ACCOUNT
, 
OBJECTPOINT
, 134),

1292 
	`CINIT
(
COOKIELIST
, 
OBJECTPOINT
, 135),

1295 
	`CINIT
(
IGNORE_CONTENT_LENGTH
, 
LONG
, 136),

1301 
	`CINIT
(
FTP_SKIP_PASV_IP
, 
LONG
, 137),

1305 
	`CINIT
(
FTP_FILEMETHOD
, 
LONG
, 138),

1308 
	`CINIT
(
LOCALPORT
, 
LONG
, 139),

1313 
	`CINIT
(
LOCALPORTRANGE
, 
LONG
, 140),

1317 
	`CINIT
(
CONNECT_ONLY
, 
LONG
, 141),

1321 
	`CINIT
(
CONV_FROM_NETWORK_FUNCTION
, 
FUNCTIONPOINT
, 142),

1325 
	`CINIT
(
CONV_TO_NETWORK_FUNCTION
, 
FUNCTIONPOINT
, 143),

1330 
	`CINIT
(
CONV_FROM_UTF8_FUNCTION
, 
FUNCTIONPOINT
, 144),

1334 
	`CINIT
(
MAX_SEND_SPEED_LARGE
, 
OFF_T
, 145),

1335 
	`CINIT
(
MAX_RECV_SPEED_LARGE
, 
OFF_T
, 146),

1338 
	`CINIT
(
FTP_ALTERNATIVE_TO_USER
, 
OBJECTPOINT
, 147),

1341 
	`CINIT
(
SOCKOPTFUNCTION
, 
FUNCTIONPOINT
, 148),

1342 
	`CINIT
(
SOCKOPTDATA
, 
OBJECTPOINT
, 149),

1346 
	`CINIT
(
SSL_SESSIONID_CACHE
, 
LONG
, 150),

1349 
	`CINIT
(
SSH_AUTH_TYPES
, 
LONG
, 151),

1352 
	`CINIT
(
SSH_PUBLIC_KEYFILE
, 
OBJECTPOINT
, 152),

1353 
	`CINIT
(
SSH_PRIVATE_KEYFILE
, 
OBJECTPOINT
, 153),

1356 
	`CINIT
(
FTP_SSL_CCC
, 
LONG
, 154),

1359 
	`CINIT
(
TIMEOUT_MS
, 
LONG
, 155),

1360 
	`CINIT
(
CONNECTTIMEOUT_MS
, 
LONG
, 156),

1364 
	`CINIT
(
HTTP_TRANSFER_DECODING
, 
LONG
, 157),

1365 
	`CINIT
(
HTTP_CONTENT_DECODING
, 
LONG
, 158),

1369 
	`CINIT
(
NEW_FILE_PERMS
, 
LONG
, 159),

1370 
	`CINIT
(
NEW_DIRECTORY_PERMS
, 
LONG
, 160),

1374 
	`CINIT
(
POSTREDIR
, 
LONG
, 161),

1377 
	`CINIT
(
SSH_HOST_PUBLIC_KEY_MD5
, 
OBJECTPOINT
, 162),

1383 
	`CINIT
(
OPENSOCKETFUNCTION
, 
FUNCTIONPOINT
, 163),

1384 
	`CINIT
(
OPENSOCKETDATA
, 
OBJECTPOINT
, 164),

1387 
	`CINIT
(
COPYPOSTFIELDS
, 
OBJECTPOINT
, 165),

1390 
	`CINIT
(
PROXY_TRANSFER_MODE
, 
LONG
, 166),

1393 
	`CINIT
(
SEEKFUNCTION
, 
FUNCTIONPOINT
, 167),

1394 
	`CINIT
(
SEEKDATA
, 
OBJECTPOINT
, 168),

1397 
	`CINIT
(
CRLFILE
, 
OBJECTPOINT
, 169),

1400 
	`CINIT
(
ISSUERCERT
, 
OBJECTPOINT
, 170),

1403 
	`CINIT
(
ADDRESS_SCOPE
, 
LONG
, 171),

1407 
	`CINIT
(
CERTINFO
, 
LONG
, 172),

1410 
	`CINIT
(
USERNAME
, 
OBJECTPOINT
, 173),

1411 
	`CINIT
(
PASSWORD
, 
OBJECTPOINT
, 174),

1414 
	`CINIT
(
PROXYUSERNAME
, 
OBJECTPOINT
, 175),

1415 
	`CINIT
(
PROXYPASSWORD
, 
OBJECTPOINT
, 176),

1424 
	`CINIT
(
NOPROXY
, 
OBJECTPOINT
, 177),

1427 
	`CINIT
(
TFTP_BLKSIZE
, 
LONG
, 178),

1430 
	`CINIT
(
SOCKS5_GSSAPI_SERVICE
, 
OBJECTPOINT
, 179),

1433 
	`CINIT
(
SOCKS5_GSSAPI_NEC
, 
LONG
, 180),

1439 
	`CINIT
(
PROTOCOLS
, 
LONG
, 181),

1445 
	`CINIT
(
REDIR_PROTOCOLS
, 
LONG
, 182),

1448 
	`CINIT
(
SSH_KNOWNHOSTS
, 
OBJECTPOINT
, 183),

1452 
	`CINIT
(
SSH_KEYFUNCTION
, 
FUNCTIONPOINT
, 184),

1455 
	`CINIT
(
SSH_KEYDATA
, 
OBJECTPOINT
, 185),

1458 
	`CINIT
(
MAIL_FROM
, 
OBJECTPOINT
, 186),

1461 
	`CINIT
(
MAIL_RCPT
, 
OBJECTPOINT
, 187),

1464 
	`CINIT
(
FTP_USE_PRET
, 
LONG
, 188),

1467 
	`CINIT
(
RTSP_REQUEST
, 
LONG
, 189),

1470 
	`CINIT
(
RTSP_SESSION_ID
, 
OBJECTPOINT
, 190),

1473 
	`CINIT
(
RTSP_STREAM_URI
, 
OBJECTPOINT
, 191),

1476 
	`CINIT
(
RTSP_TRANSPORT
, 
OBJECTPOINT
, 192),

1479 
	`CINIT
(
RTSP_CLIENT_CSEQ
, 
LONG
, 193),

1482 
	`CINIT
(
RTSP_SERVER_CSEQ
, 
LONG
, 194),

1485 
	`CINIT
(
INTERLEAVEDATA
, 
OBJECTPOINT
, 195),

1488 
	`CINIT
(
INTERLEAVEFUNCTION
, 
FUNCTIONPOINT
, 196),

1491 
	`CINIT
(
WILDCARDMATCH
, 
LONG
, 197),

1495 
	`CINIT
(
CHUNK_BGN_FUNCTION
, 
FUNCTIONPOINT
, 198),

1499 
	`CINIT
(
CHUNK_END_FUNCTION
, 
FUNCTIONPOINT
, 199),

1502 
	`CINIT
(
FNMATCH_FUNCTION
, 
FUNCTIONPOINT
, 200),

1505 
	`CINIT
(
CHUNK_DATA
, 
OBJECTPOINT
, 201),

1508 
	`CINIT
(
FNMATCH_DATA
, 
OBJECTPOINT
, 202),

1511 
	`CINIT
(
RESOLVE
, 
OBJECTPOINT
, 203),

1514 
	`CINIT
(
TLSAUTH_USERNAME
, 
OBJECTPOINT
, 204),

1517 
	`CINIT
(
TLSAUTH_PASSWORD
, 
OBJECTPOINT
, 205),

1520 
	`CINIT
(
TLSAUTH_TYPE
, 
OBJECTPOINT
, 206),

1532 
	`CINIT
(
TRANSFER_ENCODING
, 
LONG
, 207),

1536 
	`CINIT
(
CLOSESOCKETFUNCTION
, 
FUNCTIONPOINT
, 208),

1537 
	`CINIT
(
CLOSESOCKETDATA
, 
OBJECTPOINT
, 209),

1540 
	`CINIT
(
GSSAPI_DELEGATION
, 
LONG
, 210),

1543 
	`CINIT
(
DNS_SERVERS
, 
OBJECTPOINT
, 211),

1547 
	`CINIT
(
ACCEPTTIMEOUT_MS
, 
LONG
, 212),

1550 
	`CINIT
(
TCP_KEEPALIVE
, 
LONG
, 213),

1553 
	`CINIT
(
TCP_KEEPIDLE
, 
LONG
, 214),

1554 
	`CINIT
(
TCP_KEEPINTVL
, 
LONG
, 215),

1557 
	`CINIT
(
SSL_OPTIONS
, 
LONG
, 216),

1560 
	`CINIT
(
MAIL_AUTH
, 
OBJECTPOINT
, 217),

1563 
	`CINIT
(
SASL_IR
, 
LONG
, 218),

1568 
	`CINIT
(
XFERINFOFUNCTION
, 
FUNCTIONPOINT
, 219),

1571 
	`CINIT
(
XOAUTH2_BEARER
, 
OBJECTPOINT
, 220),

1576 
	`CINIT
(
DNS_INTERFACE
, 
OBJECTPOINT
, 221),

1580 
	`CINIT
(
DNS_LOCAL_IP4
, 
OBJECTPOINT
, 222),

1584 
	`CINIT
(
DNS_LOCAL_IP6
, 
OBJECTPOINT
, 223),

1587 
	`CINIT
(
LOGIN_OPTIONS
, 
OBJECTPOINT
, 224),

1590 
	`CINIT
(
SSL_ENABLE_NPN
, 
LONG
, 225),

1593 
	`CINIT
(
SSL_ENABLE_ALPN
, 
LONG
, 226),

1597 
	`CINIT
(
EXPECT_100_TIMEOUT_MS
, 
LONG
, 227),

1601 
	`CINIT
(
PROXYHEADER
, 
OBJECTPOINT
, 228),

1604 
	`CINIT
(
HEADEROPT
, 
LONG
, 229),

1606 
CURLOPT_LASTENTRY


1607 } 
	tCURL›ti⁄
;

1609 #i‚de‡
CURL_NO_OLDIES


1616 
	#CURLOPT_POST301
 
CURLOPT_POSTREDIR


	)

1621 
	#CURLOPT_SSLKEYPASSWD
 
CURLOPT_KEYPASSWD


	)

1622 
	#CURLOPT_FTPAPPEND
 
CURLOPT_APPEND


	)

1623 
	#CURLOPT_FTPLISTONLY
 
CURLOPT_DIRLISTONLY


	)

1624 
	#CURLOPT_FTP_SSL
 
CURLOPT_USE_SSL


	)

1628 
	#CURLOPT_SSLCERTPASSWD
 
CURLOPT_KEYPASSWD


	)

1629 
	#CURLOPT_KRB4LEVEL
 
CURLOPT_KRBLEVEL


	)

1633 #unde‡
CURLOPT_DNS_USE_GLOBAL_CACHE


1640 
	#CURL_IPRESOLVE_WHATEVER
 0

	)

1642 
	#CURL_IPRESOLVE_V4
 1

	)

1643 
	#CURL_IPRESOLVE_V6
 2

	)

1646 
	#CURLOPT_RTSPHEADER
 
CURLOPT_HTTPHEADER


	)

1650 
CURL_HTTP_VERSION_NONE
,

1653 
CURL_HTTP_VERSION_1_0
,

1654 
CURL_HTTP_VERSION_1_1
,

1655 
CURL_HTTP_VERSION_2_0
,

1657 
CURL_HTTP_VERSION_LAST


1664 
CURL_RTSPREQ_NONE
,

1665 
CURL_RTSPREQ_OPTIONS
,

1666 
CURL_RTSPREQ_DESCRIBE
,

1667 
CURL_RTSPREQ_ANNOUNCE
,

1668 
CURL_RTSPREQ_SETUP
,

1669 
CURL_RTSPREQ_PLAY
,

1670 
CURL_RTSPREQ_PAUSE
,

1671 
CURL_RTSPREQ_TEARDOWN
,

1672 
CURL_RTSPREQ_GET_PARAMETER
,

1673 
CURL_RTSPREQ_SET_PARAMETER
,

1674 
CURL_RTSPREQ_RECORD
,

1675 
CURL_RTSPREQ_RECEIVE
,

1676 
CURL_RTSPREQ_LAST


1680 
	eCURL_NETRC_OPTION
 {

1681 
CURL_NETRC_IGNORED
,

1683 
CURL_NETRC_OPTIONAL
,

1685 
CURL_NETRC_REQUIRED
,

1688 
CURL_NETRC_LAST


1692 
CURL_SSLVERSION_DEFAULT
,

1693 
CURL_SSLVERSION_TLSv1
,

1694 
CURL_SSLVERSION_SSLv2
,

1695 
CURL_SSLVERSION_SSLv3
,

1696 
CURL_SSLVERSION_TLSv1_0
,

1697 
CURL_SSLVERSION_TLSv1_1
,

1698 
CURL_SSLVERSION_TLSv1_2
,

1700 
CURL_SSLVERSION_LAST


1703 
	eCURL_TLSAUTH
 {

1704 
CURL_TLSAUTH_NONE
,

1705 
CURL_TLSAUTH_SRP
,

1706 
CURL_TLSAUTH_LAST


1714 
	#CURL_REDIR_GET_ALL
 0

	)

1715 
	#CURL_REDIR_POST_301
 1

	)

1716 
	#CURL_REDIR_POST_302
 2

	)

1717 
	#CURL_REDIR_POST_303
 4

	)

1718 
	#CURL_REDIR_POST_ALL
 \

1719 (
CURL_REDIR_POST_301
|
CURL_REDIR_POST_302
|
CURL_REDIR_POST_303
)

	)

1722 
CURL_TIMECOND_NONE
,

1724 
CURL_TIMECOND_IFMODSINCE
,

1725 
CURL_TIMECOND_IFUNMODSINCE
,

1726 
CURL_TIMECOND_LASTMOD
,

1728 
CURL_TIMECOND_LAST


1729 } 
	tcuæ_TimeC⁄d
;

1734 
CURL_EXTERN
 (
cuæ_°ªquÆ
)(c⁄° *
s1
, c⁄° *
s2
);

1735 
CURL_EXTERN
 (
cuæ_°∫equÆ
)(c⁄° *
s1
, c⁄° *
s2
, 
size_t
 
n
);

1738 #ifde‡
CFINIT


1739 #unde‡
CFINIT


1742 #ifde‡
CURL_ISOCPP


1743 
	#CFINIT
(
«me
Ë
CURLFORM_
 ## 
	)
name

1746 
	#CFINIT
(
«me
Ë
CURLFORM_
 
	)
name

1750 
	`CFINIT
(
NOTHING
),

1753 
	`CFINIT
(
COPYNAME
),

1754 
	`CFINIT
(
PTRNAME
),

1755 
	`CFINIT
(
NAMELENGTH
),

1756 
	`CFINIT
(
COPYCONTENTS
),

1757 
	`CFINIT
(
PTRCONTENTS
),

1758 
	`CFINIT
(
CONTENTSLENGTH
),

1759 
	`CFINIT
(
FILECONTENT
),

1760 
	`CFINIT
(
ARRAY
),

1761 
	`CFINIT
(
OBSOLETE
),

1762 
	`CFINIT
(
FILE
),

1764 
	`CFINIT
(
BUFFER
),

1765 
	`CFINIT
(
BUFFERPTR
),

1766 
	`CFINIT
(
BUFFERLENGTH
),

1768 
	`CFINIT
(
CONTENTTYPE
),

1769 
	`CFINIT
(
CONTENTHEADER
),

1770 
	`CFINIT
(
FILENAME
),

1771 
	`CFINIT
(
END
),

1772 
	`CFINIT
(
OBSOLETE2
),

1774 
	`CFINIT
(
STREAM
),

1776 
CURLFORM_LASTENTRY


1777 } 
	tCURLf‹m›ti⁄
;

1779 #unde‡
CFINIT


1782 
	scuæ_f‹ms
 {

1783 
CURLf‹m›ti⁄
 
›ti⁄
;

1784 c⁄° *
vÆue
;

1804 
CURL_FORMADD_OK
,

1806 
CURL_FORMADD_MEMORY
,

1807 
CURL_FORMADD_OPTION_TWICE
,

1808 
CURL_FORMADD_NULL
,

1809 
CURL_FORMADD_UNKNOWN_OPTION
,

1810 
CURL_FORMADD_INCOMPLETE
,

1811 
CURL_FORMADD_ILLEGAL_ARRAY
,

1812 
CURL_FORMADD_DISABLED
,

1814 
CURL_FORMADD_LAST


1815 } 
	tCURLFORMcode
;

1826 
CURL_EXTERN
 
CURLFORMcode
 
	`cuæ_f‹madd
(
cuæ_hâµo°
 **
hâµo°
,

1827 
cuæ_hâµo°
 **
œ°_po°
,

1838 
	`size_t
 (*
	tcuæ_f‹mgë_ˇŒback
)(*
	t¨g
, c⁄° *
	tbuf
,

1839 
	tsize_t
 
	tÀn
);

1851 
CURL_EXTERN
 
	`cuæ_f‹mgë
(
cuæ_hâµo°
 *
f‹m
, *
¨g
,

1852 
cuæ_f‹mgë_ˇŒback
 
≠≥nd
);

1860 
CURL_EXTERN
 
	`cuæ_f‹m‰ì
(
cuæ_hâµo°
 *
f‹m
);

1870 
CURL_EXTERN
 *
	`cuæ_gëív
(c⁄° *
v¨übÀ
);

1879 
CURL_EXTERN
 *
	`cuæ_vîsi⁄
();

1890 
CURL_EXTERN
 *
	`cuæ_ósy_esˇ≥
(
CURL
 *
h™dÀ
,

1891 c⁄° *
°rög
,

1892 
Àngth
);

1895 
CURL_EXTERN
 *
	`cuæ_esˇ≥
(c⁄° *
°rög
,

1896 
Àngth
);

1910 
CURL_EXTERN
 *
	`cuæ_ósy_u√sˇ≥
(
CURL
 *
h™dÀ
,

1911 c⁄° *
°rög
,

1912 
Àngth
,

1913 *
ouéígth
);

1916 
CURL_EXTERN
 *
	`cuæ_u√sˇ≥
(c⁄° *
°rög
,

1917 
Àngth
);

1927 
CURL_EXTERN
 
	`cuæ_‰ì
(*
p
);

1939 
CURL_EXTERN
 
CURLcode
 
	`cuæ_globÆ_öô
(
Êags
);

1954 
CURL_EXTERN
 
CURLcode
 
	`cuæ_globÆ_öô_mem
(
Êags
,

1955 
cuæ_mÆloc_ˇŒback
 
m
,

1956 
cuæ_‰ì_ˇŒback
 
f
,

1957 
cuæ_ªÆloc_ˇŒback
 
r
,

1958 
cuæ_°rdup_ˇŒback
 
s
,

1959 
cuæ_ˇŒoc_ˇŒback
 
c
);

1969 
CURL_EXTERN
 
	`cuæ_globÆ_˛ónup
();

1972 
	scuæ_¶i°
 {

1973 *
d©a
;

1974 
cuæ_¶i°
 *
√xt
;

1985 
CURL_EXTERN
 
cuæ_¶i°
 *
	`cuæ_¶i°_≠≥nd
(curl_slist *,

1995 
CURL_EXTERN
 
	`cuæ_¶i°_‰ì_Æl
(
cuæ_¶i°
 *);

2006 
CURL_EXTERN
 
time_t
 
	`cuæ_gëd©e
(c⁄° *
p
, c⁄°Åime_à*
unu£d
);

2010 
	scuæ_˚πöfo
 {

2011 
num_of_˚πs
;

2012 
cuæ_¶i°
 **
˚πöfo
;

2019 
CURLSSLBACKEND_NONE
 = 0,

2020 
CURLSSLBACKEND_OPENSSL
 = 1,

2021 
CURLSSLBACKEND_GNUTLS
 = 2,

2022 
CURLSSLBACKEND_NSS
 = 3,

2023 
CURLSSLBACKEND_QSOSSL
 = 4,

2024 
CURLSSLBACKEND_GSKIT
 = 5,

2025 
CURLSSLBACKEND_POLARSSL
 = 6,

2026 
CURLSSLBACKEND_CYASSL
 = 7,

2027 
CURLSSLBACKEND_SCHANNEL
 = 8,

2028 
CURLSSLBACKEND_DARWINSSL
 = 9

2029 } 
	tcuæ_s¶backíd
;

2034 
	scuæ_és£ssi⁄öfo
 {

2035 
cuæ_s¶backíd
 
backíd
;

2036 *
öã∫Æs
;

2039 
	#CURLINFO_STRING
 0x100000

	)

2040 
	#CURLINFO_LONG
 0x200000

	)

2041 
	#CURLINFO_DOUBLE
 0x300000

	)

2042 
	#CURLINFO_SLIST
 0x400000

	)

2043 
	#CURLINFO_MASK
 0x0fffff

	)

2044 
	#CURLINFO_TYPEMASK
 0xf00000

	)

2047 
CURLINFO_NONE
,

2048 
CURLINFO_EFFECTIVE_URL
 = 
CURLINFO_STRING
 + 1,

2049 
CURLINFO_RESPONSE_CODE
 = 
CURLINFO_LONG
 + 2,

2050 
CURLINFO_TOTAL_TIME
 = 
CURLINFO_DOUBLE
 + 3,

2051 
CURLINFO_NAMELOOKUP_TIME
 = 
CURLINFO_DOUBLE
 + 4,

2052 
CURLINFO_CONNECT_TIME
 = 
CURLINFO_DOUBLE
 + 5,

2053 
CURLINFO_PRETRANSFER_TIME
 = 
CURLINFO_DOUBLE
 + 6,

2054 
CURLINFO_SIZE_UPLOAD
 = 
CURLINFO_DOUBLE
 + 7,

2055 
CURLINFO_SIZE_DOWNLOAD
 = 
CURLINFO_DOUBLE
 + 8,

2056 
CURLINFO_SPEED_DOWNLOAD
 = 
CURLINFO_DOUBLE
 + 9,

2057 
CURLINFO_SPEED_UPLOAD
 = 
CURLINFO_DOUBLE
 + 10,

2058 
CURLINFO_HEADER_SIZE
 = 
CURLINFO_LONG
 + 11,

2059 
CURLINFO_REQUEST_SIZE
 = 
CURLINFO_LONG
 + 12,

2060 
CURLINFO_SSL_VERIFYRESULT
 = 
CURLINFO_LONG
 + 13,

2061 
CURLINFO_FILETIME
 = 
CURLINFO_LONG
 + 14,

2062 
CURLINFO_CONTENT_LENGTH_DOWNLOAD
 = 
CURLINFO_DOUBLE
 + 15,

2063 
CURLINFO_CONTENT_LENGTH_UPLOAD
 = 
CURLINFO_DOUBLE
 + 16,

2064 
CURLINFO_STARTTRANSFER_TIME
 = 
CURLINFO_DOUBLE
 + 17,

2065 
CURLINFO_CONTENT_TYPE
 = 
CURLINFO_STRING
 + 18,

2066 
CURLINFO_REDIRECT_TIME
 = 
CURLINFO_DOUBLE
 + 19,

2067 
CURLINFO_REDIRECT_COUNT
 = 
CURLINFO_LONG
 + 20,

2068 
CURLINFO_PRIVATE
 = 
CURLINFO_STRING
 + 21,

2069 
CURLINFO_HTTP_CONNECTCODE
 = 
CURLINFO_LONG
 + 22,

2070 
CURLINFO_HTTPAUTH_AVAIL
 = 
CURLINFO_LONG
 + 23,

2071 
CURLINFO_PROXYAUTH_AVAIL
 = 
CURLINFO_LONG
 + 24,

2072 
CURLINFO_OS_ERRNO
 = 
CURLINFO_LONG
 + 25,

2073 
CURLINFO_NUM_CONNECTS
 = 
CURLINFO_LONG
 + 26,

2074 
CURLINFO_SSL_ENGINES
 = 
CURLINFO_SLIST
 + 27,

2075 
CURLINFO_COOKIELIST
 = 
CURLINFO_SLIST
 + 28,

2076 
CURLINFO_LASTSOCKET
 = 
CURLINFO_LONG
 + 29,

2077 
CURLINFO_FTP_ENTRY_PATH
 = 
CURLINFO_STRING
 + 30,

2078 
CURLINFO_REDIRECT_URL
 = 
CURLINFO_STRING
 + 31,

2079 
CURLINFO_PRIMARY_IP
 = 
CURLINFO_STRING
 + 32,

2080 
CURLINFO_APPCONNECT_TIME
 = 
CURLINFO_DOUBLE
 + 33,

2081 
CURLINFO_CERTINFO
 = 
CURLINFO_SLIST
 + 34,

2082 
CURLINFO_CONDITION_UNMET
 = 
CURLINFO_LONG
 + 35,

2083 
CURLINFO_RTSP_SESSION_ID
 = 
CURLINFO_STRING
 + 36,

2084 
CURLINFO_RTSP_CLIENT_CSEQ
 = 
CURLINFO_LONG
 + 37,

2085 
CURLINFO_RTSP_SERVER_CSEQ
 = 
CURLINFO_LONG
 + 38,

2086 
CURLINFO_RTSP_CSEQ_RECV
 = 
CURLINFO_LONG
 + 39,

2087 
CURLINFO_PRIMARY_PORT
 = 
CURLINFO_LONG
 + 40,

2088 
CURLINFO_LOCAL_IP
 = 
CURLINFO_STRING
 + 41,

2089 
CURLINFO_LOCAL_PORT
 = 
CURLINFO_LONG
 + 42,

2090 
CURLINFO_TLS_SESSION
 = 
CURLINFO_SLIST
 + 43,

2093 
CURLINFO_LASTONE
 = 43

2094 } 
	tCURLINFO
;

2098 
	#CURLINFO_HTTP_CODE
 
CURLINFO_RESPONSE_CODE


	)

2101 
CURLCLOSEPOLICY_NONE
,

2103 
CURLCLOSEPOLICY_OLDEST
,

2104 
CURLCLOSEPOLICY_LEAST_RECENTLY_USED
,

2105 
CURLCLOSEPOLICY_LEAST_TRAFFIC
,

2106 
CURLCLOSEPOLICY_SLOWEST
,

2107 
CURLCLOSEPOLICY_CALLBACK
,

2109 
CURLCLOSEPOLICY_LAST


2110 } 
	tcuæ_˛o£pﬁicy
;

2112 
	#CURL_GLOBAL_SSL
 (1<<0)

	)

2113 
	#CURL_GLOBAL_WIN32
 (1<<1)

	)

2114 
	#CURL_GLOBAL_ALL
 (
CURL_GLOBAL_SSL
|
CURL_GLOBAL_WIN32
)

	)

2115 
	#CURL_GLOBAL_NOTHING
 0

	)

2116 
	#CURL_GLOBAL_DEFAULT
 
CURL_GLOBAL_ALL


	)

2117 
	#CURL_GLOBAL_ACK_EINTR
 (1<<2)

	)

2126 
CURL_LOCK_DATA_NONE
 = 0,

2131 
CURL_LOCK_DATA_SHARE
,

2132 
CURL_LOCK_DATA_COOKIE
,

2133 
CURL_LOCK_DATA_DNS
,

2134 
CURL_LOCK_DATA_SSL_SESSION
,

2135 
CURL_LOCK_DATA_CONNECT
,

2136 
CURL_LOCK_DATA_LAST


2137 } 
	tcuæ_lock_d©a
;

2141 
CURL_LOCK_ACCESS_NONE
 = 0,

2142 
CURL_LOCK_ACCESS_SHARED
 = 1,

2143 
CURL_LOCK_ACCESS_SINGLE
 = 2,

2144 
CURL_LOCK_ACCESS_LAST


2145 } 
	tcuæ_lock_ac˚ss
;

2147 (*
	tcuæ_lock_fun˘i⁄
)(
	tCURL
 *
	th™dÀ
,

2148 
	tcuæ_lock_d©a
 
	td©a
,

2149 
	tcuæ_lock_ac˚ss
 
	tlockty≥
,

2150 *
	tu£Ωå
);

2151 (*
	tcuæ_u∆ock_fun˘i⁄
)(
	tCURL
 *
	th™dÀ
,

2152 
	tcuæ_lock_d©a
 
	td©a
,

2153 *
	tu£Ωå
);

2155 
	tCURLSH
;

2158 
CURLSHE_OK
,

2159 
CURLSHE_BAD_OPTION
,

2160 
CURLSHE_IN_USE
,

2161 
CURLSHE_INVALID
,

2162 
CURLSHE_NOMEM
,

2163 
CURLSHE_NOT_BUILT_IN
,

2164 
CURLSHE_LAST


2165 } 
	tCURLSHcode
;

2168 
CURLSHOPT_NONE
,

2169 
CURLSHOPT_SHARE
,

2170 
CURLSHOPT_UNSHARE
,

2171 
CURLSHOPT_LOCKFUNC
,

2172 
CURLSHOPT_UNLOCKFUNC
,

2173 
CURLSHOPT_USERDATA
,

2175 
CURLSHOPT_LAST


2176 } 
	tCURLSH›ti⁄
;

2178 
CURL_EXTERN
 
CURLSH
 *
	`cuæ_sh¨e_öô
();

2179 
CURL_EXTERN
 
CURLSHcode
 
	`cuæ_sh¨e_£t›t
(
CURLSH
 *, 
CURLSH›ti⁄
 
›ti⁄
, ...);

2180 
CURL_EXTERN
 
CURLSHcode
 
	`cuæ_sh¨e_˛ónup
(
CURLSH
 *);

2187 
CURLVERSION_FIRST
,

2188 
CURLVERSION_SECOND
,

2189 
CURLVERSION_THIRD
,

2190 
CURLVERSION_FOURTH
,

2191 
CURLVERSION_LAST


2192 } 
	tCURLvîsi⁄
;

2199 
	#CURLVERSION_NOW
 
CURLVERSION_FOURTH


	)

2202 
CURLvîsi⁄
 
age
;

2203 c⁄° *
vîsi⁄
;

2204 
vîsi⁄_num
;

2205 c⁄° *
ho°
;

2206 
„©uªs
;

2207 c⁄° *
s¶_vîsi⁄
;

2208 
s¶_vîsi⁄_num
;

2209 c⁄° *
libz_vîsi⁄
;

2211 c⁄° * c⁄° *
¥Ÿocﬁs
;

2214 c⁄° *
¨es
;

2215 
¨es_num
;

2218 c⁄° *
libidn
;

2223 
ic⁄v_vî_num
;

2225 c⁄° *
libssh_vîsi⁄
;

2227 } 
	tcuæ_vîsi⁄_öfo_d©a
;

2229 
	#CURL_VERSION_IPV6
 (1<<0Ë

	)

2230 
	#CURL_VERSION_KERBEROS4
 (1<<1Ë

	)

2231 
	#CURL_VERSION_SSL
 (1<<2Ë

	)

2232 
	#CURL_VERSION_LIBZ
 (1<<3Ë

	)

2233 
	#CURL_VERSION_NTLM
 (1<<4Ë

	)

2234 
	#CURL_VERSION_GSSNEGOTIATE
 (1<<5Ë

	)

2235 
	#CURL_VERSION_DEBUG
 (1<<6Ë

	)

2236 
	#CURL_VERSION_ASYNCHDNS
 (1<<7Ë

	)

2237 
	#CURL_VERSION_SPNEGO
 (1<<8Ë

	)

2238 
	#CURL_VERSION_LARGEFILE
 (1<<9Ë

	)

2239 
	#CURL_VERSION_IDN
 (1<<10Ë

	)

2240 
	#CURL_VERSION_SSPI
 (1<<11Ë

	)

2241 
	#CURL_VERSION_CONV
 (1<<12Ë

	)

2242 
	#CURL_VERSION_CURLDEBUG
 (1<<13Ë

	)

2243 
	#CURL_VERSION_TLSAUTH_SRP
 (1<<14Ë

	)

2244 
	#CURL_VERSION_NTLM_WB
 (1<<15Ë

	)

2245 
	#CURL_VERSION_HTTP2
 (1<<16Ë

	)

2255 
CURL_EXTERN
 
cuæ_vîsi⁄_öfo_d©a
 *
	`cuæ_vîsi⁄_öfo
(
CURLvîsi⁄
);

2266 
CURL_EXTERN
 c⁄° *
	`cuæ_ósy_°ªº‹
(
CURLcode
);

2277 
CURL_EXTERN
 c⁄° *
	`cuæ_sh¨e_°ªº‹
(
CURLSHcode
);

2288 
CURL_EXTERN
 
CURLcode
 
	`cuæ_ósy_∑u£
(
CURL
 *
h™dÀ
, 
bômask
);

2290 
	#CURLPAUSE_RECV
 (1<<0)

	)

2291 
	#CURLPAUSE_RECV_CONT
 (0)

	)

2293 
	#CURLPAUSE_SEND
 (1<<2)

	)

2294 
	#CURLPAUSE_SEND_CONT
 (0)

	)

2296 
	#CURLPAUSE_ALL
 (
CURLPAUSE_RECV
|
CURLPAUSE_SEND
)

	)

2297 
	#CURLPAUSE_CONT
 (
CURLPAUSE_RECV_CONT
|
CURLPAUSE_SEND_CONT
)

	)

2299 #ifde‡ 
__˝lu•lus


2300 
	}
}

2305 
	~"ósy.h
"

2306 
	~"mu…i.h
"

2309 #i‡
deföed
(
__GNUC__
Ë&& deföed(
__GNUC_MINOR__
) && \

2310 ((
__GNUC__
 > 4Ë|| (__GNUC__ =4 && 
__GNUC_MINOR__
 >= 3)) && \

2311 !
deföed
(
__˝lu•lus
Ë&& !
	$deföed
(
CURL_DISABLE_TYPECHECK
)

2312 
	~"ty≥check-gcc.h
"

2314 #i‡
	`deföed
(
__STDC__
) && (__STDC__ >= 1)

2318 
	#cuæ_ósy_£t›t
(
h™dÀ
,
›t
,
∑øm
Ë
	`cuæ_ósy_£t›t
(h™dÀ,›t,∑øm)

	)

2319 
	#cuæ_ósy_gëöfo
(
h™dÀ
,
öfo
,
¨g
Ë
	`cuæ_ósy_gëöfo
(h™dÀ,öfo,¨g)

	)

2320 
	#cuæ_sh¨e_£t›t
(
sh¨e
,
›t
,
∑øm
Ë
	`cuæ_sh¨e_£t›t
(sh¨e,›t,∑øm)

	)

2321 
	#cuæ_mu…i_£t›t
(
h™dÀ
,
›t
,
∑øm
Ë
	`cuæ_mu…i_£t›t
(h™dÀ,›t,∑øm)

	)

	@include/curl/curlbuild.h

2 #i‚de‡
__CURL_CURLBUILD_H


3 
	#__CURL_CURLBUILD_H


	)

61 #ifde‡
CURL_SIZEOF_LONG


63 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_SIZEOF_LONG_Æªady_deföed


66 #ifde‡
CURL_TYPEOF_CURL_SOCKLEN_T


68 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_TYPEOF_CURL_SOCKLEN_T_Æªady_deföed


71 #ifde‡
CURL_SIZEOF_CURL_SOCKLEN_T


73 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_SIZEOF_CURL_SOCKLEN_T_Æªady_deföed


76 #ifde‡
CURL_TYPEOF_CURL_OFF_T


78 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_TYPEOF_CURL_OFF_T_Æªady_deföed


81 #ifde‡
CURL_FORMAT_CURL_OFF_T


83 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_FORMAT_CURL_OFF_T_Æªady_deföed


86 #ifde‡
CURL_FORMAT_CURL_OFF_TU


88 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_FORMAT_CURL_OFF_TU_Æªady_deföed


91 #ifde‡
CURL_FORMAT_OFF_T


93 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_FORMAT_OFF_T_Æªady_deföed


96 #ifde‡
CURL_SIZEOF_CURL_OFF_T


98 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_SIZEOF_CURL_OFF_T_Æªady_deföed


101 #ifde‡
CURL_SUFFIX_CURL_OFF_T


103 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_SUFFIX_CURL_OFF_T_Æªady_deföed


106 #ifde‡
CURL_SUFFIX_CURL_OFF_TU


108 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_SUFFIX_CURL_OFF_TU_Æªady_deföed


118 #ifde‡
CURL_PULL_WS2TCPIP_H


119 #i‚de‡
WIN32_LEAN_AND_MEAN


120 
	#WIN32_LEAN_AND_MEAN


	)

122 
	~<wödows.h
>

123 
	~<wösock2.h
>

124 
	~<ws2t˝ù.h
>

129 
	#CURL_PULL_SYS_TYPES_H
 1

	)

130 #ifde‡
CURL_PULL_SYS_TYPES_H


131 
	~<sys/ty≥s.h
>

136 
	#CURL_PULL_STDINT_H
 1

	)

137 #ifde‡
CURL_PULL_STDINT_H


138 
	~<°döt.h
>

143 
	#CURL_PULL_INTTYPES_H
 1

	)

144 #ifde‡
CURL_PULL_INTTYPES_H


145 
	~<öây≥s.h
>

150 
	#CURL_PULL_SYS_SOCKET_H
 1

	)

151 #ifde‡
CURL_PULL_SYS_SOCKET_H


152 
	~<sys/sockë.h
>

158 #ifde‡
CURL_PULL_SYS_POLL_H


159 
	~<sys/pﬁl.h
>

163 
	#CURL_SIZEOF_LONG
 4

	)

166 
	#CURL_TYPEOF_CURL_SOCKLEN_T
 
sockÀn_t


	)

169 
	#CURL_SIZEOF_CURL_SOCKLEN_T
 4

	)

172 
CURL_TYPEOF_CURL_SOCKLEN_T
 
	tcuæ_sockÀn_t
;

175 
	#CURL_TYPEOF_CURL_OFF_T
 
öt64_t


	)

178 
CURL_TYPEOF_CURL_OFF_T
 
	tcuæ_off_t
;

181 
	#CURL_FORMAT_CURL_OFF_T
 "Œd"

	)

184 
	#CURL_FORMAT_CURL_OFF_TU
 "Œu"

	)

187 
	#CURL_FORMAT_OFF_T
 "%Œd"

	)

190 
	#CURL_SIZEOF_CURL_OFF_T
 8

	)

193 
	#CURL_SUFFIX_CURL_OFF_T
 
LL


	)

196 
	#CURL_SUFFIX_CURL_OFF_TU
 
ULL


	)

	@include/curl/curlrules.h

1 #i‚de‡
__CURL_CURLRULES_H


2 
	#__CURL_CURLRULES_H


	)

78 #i‚de‡
CURL_SIZEOF_LONG


80 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_SIZEOF_LONG_is_missög


83 #i‚de‡
CURL_TYPEOF_CURL_SOCKLEN_T


85 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_TYPEOF_CURL_SOCKLEN_T_is_missög


88 #i‚de‡
CURL_SIZEOF_CURL_SOCKLEN_T


90 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_SIZEOF_CURL_SOCKLEN_T_is_missög


93 #i‚de‡
CURL_TYPEOF_CURL_OFF_T


95 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_TYPEOF_CURL_OFF_T_is_missög


98 #i‚de‡
CURL_FORMAT_CURL_OFF_T


100 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_FORMAT_CURL_OFF_T_is_missög


103 #i‚de‡
CURL_FORMAT_CURL_OFF_TU


105 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_FORMAT_CURL_OFF_TU_is_missög


108 #i‚de‡
CURL_FORMAT_OFF_T


110 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_FORMAT_OFF_T_is_missög


113 #i‚de‡
CURL_SIZEOF_CURL_OFF_T


115 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_SIZEOF_CURL_OFF_T_is_missög


118 #i‚de‡
CURL_SUFFIX_CURL_OFF_T


120 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_SUFFIX_CURL_OFF_T_is_missög


123 #i‚de‡
CURL_SUFFIX_CURL_OFF_TU


125 
Eº‹
 
	gCompû©i⁄_ab‹ãd_CURL_SUFFIX_CURL_OFF_TU_is_missög


132 
	#CuæchkszEQ
(
t
, 
s
Ë—Ë=†? 1 : -1

	)

134 
	#CuæchkszGE
(
t1
, 
t2
Ë—1Ë>—2Ë? 1 : -1

	)

142 
	t__cuæ_ruÀ_01__


143 [
CuæchkszEQ
(, 
CURL_SIZEOF_LONG
)];

152 
	t__cuæ_ruÀ_02__


153 [
CuæchkszEQ
(
cuæ_off_t
, 
CURL_SIZEOF_CURL_OFF_T
)];

162 
	t__cuæ_ruÀ_03__


163 [
CuæchkszGE
(
cuæ_off_t
, )];

172 
	t__cuæ_ruÀ_04__


173 [
CuæchkszEQ
(
cuæ_sockÀn_t
, 
CURL_SIZEOF_CURL_SOCKLEN_T
)];

182 
	t__cuæ_ruÀ_05__


183 [
CuæchkszGE
(
cuæ_sockÀn_t
, )];

204 #i‡
deföed
(
__STDC__
Ë|| deföed(
_MSC_VER
Ë|| deföed(
__˝lu•lus
) || \

205 
deföed
(
__HP_aCC
Ë|| deföed(
__BORLANDC__
Ë|| deföed(
__LCC__
) || \

206 
deföed
(
__POCC__
Ë|| deföed(
__SALFORDC__
Ë|| deföed(
__HIGHC__
) || \

207 
	$deföed
(
__ILEC400__
)

209 
	#CURL_ISOCPP


	)

212 #unde‡
CURL_ISOCPP


219 #i‡
	`deföed
(
__BORLANDC__
) && (__BORLANDC__ == 0x0551)

220 
	#__CURL_OFF_T_C_HLPR2
(
x
Ë
	)
x

221 
	#__CURL_OFF_T_C_HLPR1
(
x
Ë
	`__CURL_OFF_T_C_HLPR2
(x)

	)

222 
	#CURL_OFF_T_C
(
VÆ
Ë
	`__CURL_OFF_T_C_HLPR1
(Val) ## \

223 
	`__CURL_OFF_T_C_HLPR1
(
CURL_SUFFIX_CURL_OFF_T
)

	)

224 
	#CURL_OFF_TU_C
(
VÆ
Ë
	`__CURL_OFF_T_C_HLPR1
(Val) ## \

225 
	`__CURL_OFF_T_C_HLPR1
(
CURL_SUFFIX_CURL_OFF_TU
)

	)

227 #ifde‡
CURL_ISOCPP


228 
	#__CURL_OFF_T_C_HLPR2
(
VÆ
,
Suffix
ËVÆ ## 
	)
Suffix

230 
	#__CURL_OFF_T_C_HLPR2
(
VÆ
,
Suffix
ËVÆ 
	)
Suffix

232 
	#__CURL_OFF_T_C_HLPR1
(
VÆ
,
Suffix
Ë
	`__CURL_OFF_T_C_HLPR2
(VÆ,Suffix)

	)

233 
	#CURL_OFF_T_C
(
VÆ
Ë
	`__CURL_OFF_T_C_HLPR1
(VÆ,
CURL_SUFFIX_CURL_OFF_T
)

	)

234 
	#CURL_OFF_TU_C
(
VÆ
Ë
	`__CURL_OFF_T_C_HLPR1
(VÆ,
CURL_SUFFIX_CURL_OFF_TU
)

	)

241 #unde‡
CuæchkszEQ


242 #unde‡
CuæchkszGE


248 #unde‡
CURL_PULL_WS2TCPIP_H


249 #unde‡
CURL_PULL_SYS_TYPES_H


250 #unde‡
CURL_PULL_SYS_SOCKET_H


251 #unde‡
CURL_PULL_SYS_POLL_H


252 #unde‡
CURL_PULL_STDINT_H


253 #unde‡
CURL_PULL_INTTYPES_H


255 #unde‡
CURL_TYPEOF_CURL_SOCKLEN_T


256 #unde‡
CURL_TYPEOF_CURL_OFF_T


258 #ifde‡
CURL_NO_OLDIES


259 #unde‡
CURL_FORMAT_OFF_T


	@include/curl/curlver.h

1 #i‚de‡
__CURL_CURLVER_H


2 
	#__CURL_CURLVER_H


	)

29 
	#LIBCURL_COPYRIGHT
 "1996 - 2014 D™õ»Sãnbîg, <d™õl@haxx.£>."

	)

33 
	#LIBCURL_VERSION
 "7.37.1"

	)

37 
	#LIBCURL_VERSION_MAJOR
 7

	)

38 
	#LIBCURL_VERSION_MINOR
 37

	)

39 
	#LIBCURL_VERSION_PATCH
 1

	)

56 
	#LIBCURL_VERSION_NUM
 0x072501

	)

67 
	#LIBCURL_TIMESTAMP
 "Wed Ju»16 14:37:07 UTC 2014"

	)

	@include/curl/easy.h

1 #i‚de‡
__CURL_EASY_H


2 
	#__CURL_EASY_H


	)

24 #ifde‡ 
__˝lu•lus


28 
CURL_EXTERN
 
CURL
 *
cuæ_ósy_öô
();

29 
CURL_EXTERN
 
CURLcode
 
cuæ_ósy_£t›t
(
CURL
 *
cuæ
, 
CURL›ti⁄
 
›ti⁄
, ...);

30 
CURL_EXTERN
 
CURLcode
 
cuæ_ósy_≥rf‹m
(
CURL
 *
cuæ
);

31 
CURL_EXTERN
 
cuæ_ósy_˛ónup
(
CURL
 *
cuæ
);

46 
CURL_EXTERN
 
CURLcode
 
cuæ_ósy_gëöfo
(
CURL
 *
cuæ
, 
CURLINFO
 
öfo
, ...);

61 
CURL_EXTERN
 
CURL
* 
cuæ_ósy_duph™dÀ
(CURL *
cuæ
);

74 
CURL_EXTERN
 
cuæ_ósy_ª£t
(
CURL
 *
cuæ
);

84 
CURL_EXTERN
 
CURLcode
 
cuæ_ósy_ªcv
(
CURL
 *
cuæ
, *
buf„r
, 
size_t
 
buÊí
,

85 
size_t
 *
n
);

95 
CURL_EXTERN
 
CURLcode
 
cuæ_ósy_£nd
(
CURL
 *
cuæ
, c⁄° *
buf„r
,

96 
size_t
 
buÊí
, size_à*
n
);

98 #ifde‡ 
__˝lu•lus


	@include/curl/mprintf.h

1 #i‚de‡
__CURL_MPRINTF_H


2 
	#__CURL_MPRINTF_H


	)

25 
	~<°d¨g.h
>

26 
	~<°dio.h
>

28 
	~"cuæ.h
"

30 #ifde‡ 
__˝lu•lus


34 
CURL_EXTERN
 
cuæ_m¥ötf
(c⁄° *
f‹m©
, ...);

35 
CURL_EXTERN
 
cuæ_mÂrötf
(
FILE
 *
fd
, c⁄° *
f‹m©
, ...);

36 
CURL_EXTERN
 
cuæ_m•rötf
(*
buf„r
, c⁄° *
f‹m©
, ...);

37 
CURL_EXTERN
 
cuæ_m¢¥ötf
(*
buf„r
, 
size_t
 
maxÀngth
,

38 c⁄° *
f‹m©
, ...);

39 
CURL_EXTERN
 
cuæ_mv¥ötf
(c⁄° *
f‹m©
, 
va_li°
 
¨gs
);

40 
CURL_EXTERN
 
cuæ_mvÂrötf
(
FILE
 *
fd
, c⁄° *
f‹m©
, 
va_li°
 
¨gs
);

41 
CURL_EXTERN
 
cuæ_mv•rötf
(*
buf„r
, c⁄° *
f‹m©
, 
va_li°
 
¨gs
);

42 
CURL_EXTERN
 
cuæ_mv¢¥ötf
(*
buf„r
, 
size_t
 
maxÀngth
,

43 c⁄° *
f‹m©
, 
va_li°
 
¨gs
);

44 
CURL_EXTERN
 *
cuæ_m≠rötf
(c⁄° *
f‹m©
, ...);

45 
CURL_EXTERN
 *
cuæ_mv≠rötf
(c⁄° *
f‹m©
, 
va_li°
 
¨gs
);

47 #ifde‡
_MPRINTF_REPLACE


48 #unde‡
¥ötf


49 #unde‡
Ârötf


50 #unde‡
•rötf


51 #unde‡
v•rötf


52 #unde‡
¢¥ötf


53 #unde‡
v¥ötf


54 #unde‡
vÂrötf


55 #unde‡
v¢¥ötf


56 #unde‡
≠rötf


57 #unde‡
v≠rötf


58 
	#¥ötf
 
cuæ_m¥ötf


	)

59 
	#Ârötf
 
cuæ_mÂrötf


	)

60 #ifde‡
CURLDEBUG


63 
	#•rötf
 
•rötf_was_u£d


	)

64 
	#v•rötf
 
v•rötf_was_u£d


	)

66 
	#•rötf
 
cuæ_m•rötf


	)

67 
	#v•rötf
 
cuæ_mv•rötf


	)

69 
	#¢¥ötf
 
cuæ_m¢¥ötf


	)

70 
	#v¥ötf
 
cuæ_mv¥ötf


	)

71 
	#vÂrötf
 
cuæ_mvÂrötf


	)

72 
	#v¢¥ötf
 
cuæ_mv¢¥ötf


	)

73 
	#≠rötf
 
cuæ_m≠rötf


	)

74 
	#v≠rötf
 
cuæ_mv≠rötf


	)

77 #ifde‡ 
__˝lu•lus


	@include/curl/multi.h

1 #i‚de‡
__CURL_MULTI_H


2 
	#__CURL_MULTI_H


	)

49 
	~"cuæ.h
"

51 #ifde‡ 
__˝lu•lus


55 
	tCURLM
;

58 
CURLM_CALL_MULTI_PERFORM
 = -1,

60 
CURLM_OK
,

61 
CURLM_BAD_HANDLE
,

62 
CURLM_BAD_EASY_HANDLE
,

63 
CURLM_OUT_OF_MEMORY
,

64 
CURLM_INTERNAL_ERROR
,

65 
CURLM_BAD_SOCKET
,

66 
CURLM_UNKNOWN_OPTION
,

67 
CURLM_ADDED_ALREADY
,

69 
CURLM_LAST


70 } 
	tCURLMcode
;

75 
	#CURLM_CALL_MULTI_SOCKET
 
CURLM_CALL_MULTI_PERFORM


	)

78 
CURLMSG_NONE
,

79 
CURLMSG_DONE
,

81 
CURLMSG_LAST


82 } 
	tCURLMSG
;

84 
	sCURLMsg
 {

85 
CURLMSG
 
msg
;

86 
CURL
 *
ósy_h™dÀ
;

88 *
wh©evî
;

89 
CURLcode
 
ªsu…
;

90 } 
d©a
;

92 
CURLMsg
 
	tCURLMsg
;

97 
	#CURL_WAIT_POLLIN
 0x0001

	)

98 
	#CURL_WAIT_POLLPRI
 0x0002

	)

99 
	#CURL_WAIT_POLLOUT
 0x0004

	)

101 
	scuæ_waôfd
 {

102 
cuæ_sockë_t
 
fd
;

103 
evíts
;

104 
ªvíts
;

114 
CURL_EXTERN
 
CURLM
 *
cuæ_mu…i_öô
();

123 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_add_h™dÀ
(
CURLM
 *
mu…i_h™dÀ
,

124 
CURL
 *
cuæ_h™dÀ
);

133 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_ªmove_h™dÀ
(
CURLM
 *
mu…i_h™dÀ
,

134 
CURL
 *
cuæ_h™dÀ
);

145 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_fd£t
(
CURLM
 *
mu…i_h™dÀ
,

146 
fd_£t
 *
ªad_fd_£t
,

147 
fd_£t
 *
wrôe_fd_£t
,

148 
fd_£t
 *
exc_fd_£t
,

149 *
max_fd
);

159 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_waô
(
CURLM
 *
mu…i_h™dÀ
,

160 
cuæ_waôfd
 
exåa_fds
[],

161 
exåa_nfds
,

162 
timeout_ms
,

163 *
ªt
);

181 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_≥rf‹m
(
CURLM
 *
mu…i_h™dÀ
,

182 *
ru¬ög_h™dÀs
);

194 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_˛ónup
(
CURLM
 *
mu…i_h™dÀ
);

224 
CURL_EXTERN
 
CURLMsg
 *
cuæ_mu…i_öfo_ªad
(
CURLM
 *
mu…i_h™dÀ
,

225 *
msgs_ö_queue
);

236 
CURL_EXTERN
 c⁄° *
cuæ_mu…i_°ªº‹
(
CURLMcode
);

247 
	#CURL_POLL_NONE
 0

	)

248 
	#CURL_POLL_IN
 1

	)

249 
	#CURL_POLL_OUT
 2

	)

250 
	#CURL_POLL_INOUT
 3

	)

251 
	#CURL_POLL_REMOVE
 4

	)

253 
	#CURL_SOCKET_TIMEOUT
 
CURL_SOCKET_BAD


	)

255 
	#CURL_CSELECT_IN
 0x01

	)

256 
	#CURL_CSELECT_OUT
 0x02

	)

257 
	#CURL_CSELECT_ERR
 0x04

	)

259 (*
cuæ_sockë_ˇŒback
)(
	tCURL
 *
	tósy
,

260 
	tcuæ_sockë_t
 
	ts
,

261 
	twh©
,

262 *
	tu£Ω
,

264 *
	tsockëp
);

276 (*
cuæ_mu…i_timî_ˇŒback
)(
	tCURLM
 *
	tmu…i
,

277 
	ttimeout_ms
,

278 *
	tu£Ω
);

281 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_sockë
(
CURLM
 *
mu…i_h™dÀ
, 
cuæ_sockë_t
 
s
,

282 *
ru¬ög_h™dÀs
);

284 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_sockë_a˘i⁄
(
CURLM
 *
mu…i_h™dÀ
,

285 
cuæ_sockë_t
 
s
,

286 
ev_bômask
,

287 *
ru¬ög_h™dÀs
);

289 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_sockë_Æl
(
CURLM
 *
mu…i_h™dÀ
,

290 *
ru¬ög_h™dÀs
);

292 #i‚de‡
CURL_ALLOW_OLD_MULTI_SOCKET


296 
	#cuæ_mu…i_sockë
(
x
,
y
,
z
Ë
	`cuæ_mu…i_sockë_a˘i⁄
(x,y,0,z)

	)

308 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_timeout
(
CURLM
 *
mu…i_h™dÀ
,

309 *
mûli£c⁄ds
);

311 #unde‡
CINIT


313 #ifde‡
CURL_ISOCPP


314 
	#CINIT
(
«me
,
ty≥
,
num
Ë
CURLMOPT_
 ##Çamê
CURLOPTTYPE_
 ##Åy≥ + 
	)
num

317 
	#LONG
 
CURLOPTTYPE_LONG


	)

318 
	#OBJECTPOINT
 
CURLOPTTYPE_OBJECTPOINT


	)

319 
	#FUNCTIONPOINT
 
CURLOPTTYPE_FUNCTIONPOINT


	)

320 
	#OFF_T
 
CURLOPTTYPE_OFF_T


	)

321 
	#CINIT
(
«me
,
ty≥
,
numbî
Ë
CURLMOPT_
Çamêty≥ + 
	)
number

326 
CINIT
(
SOCKETFUNCTION
, 
FUNCTIONPOINT
, 1),

329 
CINIT
(
SOCKETDATA
, 
OBJECTPOINT
, 2),

332 
CINIT
(
PIPELINING
, 
LONG
, 3),

335 
CINIT
(
TIMERFUNCTION
, 
FUNCTIONPOINT
, 4),

338 
CINIT
(
TIMERDATA
, 
OBJECTPOINT
, 5),

341 
CINIT
(
MAXCONNECTS
, 
LONG
, 6),

344 
CINIT
(
MAX_HOST_CONNECTIONS
, 
LONG
, 7),

347 
CINIT
(
MAX_PIPELINE_LENGTH
, 
LONG
, 8),

351 
CINIT
(
CONTENT_LENGTH_PENALTY_SIZE
, 
OFF_T
, 9),

355 
CINIT
(
CHUNK_LENGTH_PENALTY_SIZE
, 
OFF_T
, 10),

359 
CINIT
(
PIPELINING_SITE_BL
, 
OBJECTPOINT
, 11),

363 
CINIT
(
PIPELINING_SERVER_BL
, 
OBJECTPOINT
, 12),

366 
CINIT
(
MAX_TOTAL_CONNECTIONS
, 
LONG
, 13),

368 
CURLMOPT_LASTENTRY


369 } 
	tCURLM›ti⁄
;

379 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_£t›t
(
CURLM
 *
mu…i_h™dÀ
,

380 
CURLM›ti⁄
 
›ti⁄
, ...);

392 
CURL_EXTERN
 
CURLMcode
 
cuæ_mu…i_assign
(
CURLM
 *
mu…i_h™dÀ
,

393 
cuæ_sockë_t
 
sockfd
, *
sockp
);

395 #ifde‡
__˝lu•lus


	@include/curl/stdcheaders.h

1 #i‚de‡
__STDC_HEADERS_H


2 
	#__STDC_HEADERS_H


	)

25 
	~<sys/ty≥s.h
>

27 
size_t
 
‰ód
 (*, size_t, size_t, 
FILE
 *);

28 
size_t
 
fwrôe
 (c⁄° *, size_t, size_t, 
FILE
 *);

30 
°rˇ£cmp
(const *, const *);

31 
°∫ˇ£cmp
(c⁄° *, c⁄° *, 
size_t
);

	@include/curl/typecheck-gcc.h

1 #i‚de‡
__CURL_TYPECHECK_GCC_H


2 
	#__CURL_TYPECHECK_GCC_H


	)

41 
	#cuæ_ósy_£t›t
(
h™dÀ
, 
›ti⁄
, 
vÆue
) \

42 
	`__exãnsi⁄__
 ({ \

43 
	`__ty≥of__
 (
›ti⁄
Ë
_cuæ_›t
 = option; \

44 if(
	`__buûtö_c⁄°™t_p
(
_cuæ_›t
)) { \

45 if(
	`_cuæ_is_l⁄g_›ti⁄
(
_cuæ_›t
)) \

46 if(!
	`_cuæ_is_l⁄g
(
vÆue
)) \

47 
	`_cuæ_ósy_£t›t_îr_l⁄g
(); \

48 if(
	`_cuæ_is_off_t_›ti⁄
(
_cuæ_›t
)) \

49 if(!
	`_cuæ_is_off_t
(
vÆue
)) \

50 
	`_cuæ_ósy_£t›t_îr_cuæ_off_t
(); \

51 if(
	`_cuæ_is_°rög_›ti⁄
(
_cuæ_›t
)) \

52 if(!
	`_cuæ_is_°rög
(
vÆue
)) \

53 
	`_cuæ_ósy_£t›t_îr_°rög
(); \

54 if(
	`_cuæ_is_wrôe_cb_›ti⁄
(
_cuæ_›t
)) \

55 if(!
	`_cuæ_is_wrôe_cb
(
vÆue
)) \

56 
	`_cuæ_ósy_£t›t_îr_wrôe_ˇŒback
(); \

57 if((
_cuæ_›t
Ë=
CURLOPT_READFUNCTION
) \

58 if(!
	`_cuæ_is_ªad_cb
(
vÆue
)) \

59 
	`_cuæ_ósy_£t›t_îr_ªad_cb
(); \

60 if((
_cuæ_›t
Ë=
CURLOPT_IOCTLFUNCTION
) \

61 if(!
	`_cuæ_is_io˘l_cb
(
vÆue
)) \

62 
	`_cuæ_ósy_£t›t_îr_io˘l_cb
(); \

63 if((
_cuæ_›t
Ë=
CURLOPT_SOCKOPTFUNCTION
) \

64 if(!
	`_cuæ_is_sock›t_cb
(
vÆue
)) \

65 
	`_cuæ_ósy_£t›t_îr_sock›t_cb
(); \

66 if((
_cuæ_›t
Ë=
CURLOPT_OPENSOCKETFUNCTION
) \

67 if(!
	`_cuæ_is_›ísockë_cb
(
vÆue
)) \

68 
	`_cuæ_ósy_£t›t_îr_›ísockë_cb
(); \

69 if((
_cuæ_›t
Ë=
CURLOPT_PROGRESSFUNCTION
) \

70 if(!
	`_cuæ_is_¥ogªss_cb
(
vÆue
)) \

71 
	`_cuæ_ósy_£t›t_îr_¥ogªss_cb
(); \

72 if((
_cuæ_›t
Ë=
CURLOPT_DEBUGFUNCTION
) \

73 if(!
	`_cuæ_is_debug_cb
(
vÆue
)) \

74 
	`_cuæ_ósy_£t›t_îr_debug_cb
(); \

75 if((
_cuæ_›t
Ë=
CURLOPT_SSL_CTX_FUNCTION
) \

76 if(!
	`_cuæ_is_s¶_˘x_cb
(
vÆue
)) \

77 
	`_cuæ_ósy_£t›t_îr_s¶_˘x_cb
(); \

78 if(
	`_cuæ_is_c⁄v_cb_›ti⁄
(
_cuæ_›t
)) \

79 if(!
	`_cuæ_is_c⁄v_cb
(
vÆue
)) \

80 
	`_cuæ_ósy_£t›t_îr_c⁄v_cb
(); \

81 if((
_cuæ_›t
Ë=
CURLOPT_SEEKFUNCTION
) \

82 if(!
	`_cuæ_is_£ek_cb
(
vÆue
)) \

83 
	`_cuæ_ósy_£t›t_îr_£ek_cb
(); \

84 if(
	`_cuæ_is_cb_d©a_›ti⁄
(
_cuæ_›t
)) \

85 if(!
	`_cuæ_is_cb_d©a
(
vÆue
)) \

86 
	`_cuæ_ósy_£t›t_îr_cb_d©a
(); \

87 if((
_cuæ_›t
Ë=
CURLOPT_ERRORBUFFER
) \

88 if(!
	`_cuæ_is_îr‹_buf„r
(
vÆue
)) \

89 
	`_cuæ_ósy_£t›t_îr_îr‹_buf„r
(); \

90 if((
_cuæ_›t
Ë=
CURLOPT_STDERR
) \

91 if(!
	`_cuæ_is_FILE
(
vÆue
)) \

92 
	`_cuæ_ósy_£t›t_îr_FILE
(); \

93 if(
	`_cuæ_is_po°fõlds_›ti⁄
(
_cuæ_›t
)) \

94 if(!
	`_cuæ_is_po°fõlds
(
vÆue
)) \

95 
	`_cuæ_ósy_£t›t_îr_po°fõlds
(); \

96 if((
_cuæ_›t
Ë=
CURLOPT_HTTPPOST
) \

97 if(!
	`_cuæ_is_¨r
((
vÆue
), 
cuæ_hâµo°
)) \

98 
	`_cuæ_ósy_£t›t_îr_cuæ_hâpo°
(); \

99 if(
	`_cuæ_is_¶i°_›ti⁄
(
_cuæ_›t
)) \

100 if(!
	`_cuæ_is_¨r
((
vÆue
), 
cuæ_¶i°
)) \

101 
	`_cuæ_ósy_£t›t_îr_cuæ_¶i°
(); \

102 if((
_cuæ_›t
Ë=
CURLOPT_SHARE
) \

103 if(!
	`_cuæ_is_±r
((
vÆue
), 
CURLSH
)) \

104 
	`_cuæ_ósy_£t›t_îr_CURLSH
(); \

106 
	`cuæ_ósy_£t›t
(
h™dÀ
, 
_cuæ_›t
, 
vÆue
); \

107 })

	)

111 
	#cuæ_ósy_gëöfo
(
h™dÀ
, 
öfo
, 
¨g
) \

112 
	`__exãnsi⁄__
 ({ \

113 
	`__ty≥of__
 (
öfo
Ë
_cuæ_öfo
 = info; \

114 if(
	`__buûtö_c⁄°™t_p
(
_cuæ_öfo
)) { \

115 if(
	`_cuæ_is_°rög_öfo
(
_cuæ_öfo
)) \

116 if(!
	`_cuæ_is_¨r
((
¨g
), *)) \

117 
	`_cuæ_ósy_gëöfo_îr_°rög
(); \

118 if(
	`_cuæ_is_l⁄g_öfo
(
_cuæ_öfo
)) \

119 if(!
	`_cuæ_is_¨r
((
¨g
), )) \

120 
	`_cuæ_ósy_gëöfo_îr_l⁄g
(); \

121 if(
	`_cuæ_is_doubÀ_öfo
(
_cuæ_öfo
)) \

122 if(!
	`_cuæ_is_¨r
((
¨g
), )) \

123 
	`_cuæ_ósy_gëöfo_îr_doubÀ
(); \

124 if(
	`_cuæ_is_¶i°_öfo
(
_cuæ_öfo
)) \

125 if(!
	`_cuæ_is_¨r
((
¨g
), 
cuæ_¶i°
 *)) \

126 
	`_cuæ_ósy_gëöfo_îr_cuæ_¶i°
(); \

128 
	`cuæ_ósy_gëöfo
(
h™dÀ
, 
_cuæ_öfo
, 
¨g
); \

129 })

	)

135 
	#cuæ_sh¨e_£t›t
(
sh¨e
,
›t
,
∑øm
Ë
	`cuæ_sh¨e_£t›t
(sh¨e,›t,∑øm)

	)

136 
	#cuæ_mu…i_£t›t
(
h™dÀ
,
›t
,
∑øm
Ë
	`cuæ_mu…i_£t›t
(h™dÀ,›t,∑øm)

	)

143 
	#_CURL_WARNING
(
id
, 
mesßge
) \

144 
	`__©åibuã__
((
	`__w¨nög__
(
mesßge
))) \

145 
	`__©åibuã__
((
__unu£d__
)Ë__©åibuã__((
__noölöe__
)) \

146 
	`id
(Ë{ 
	`__asm__
(""); }

	)

148 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_l⁄g
,

150 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_cuæ_off_t
,

152 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_°rög
,

156 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_wrôe_ˇŒback
,

158 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_ªad_cb
,

160 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_io˘l_cb
,

162 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_sock›t_cb
,

164 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_›ísockë_cb
,

168 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_¥ogªss_cb
,

170 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_debug_cb
,

172 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_s¶_˘x_cb
,

174 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_c⁄v_cb
,

176 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_£ek_cb
,

178 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_cb_d©a
,

181 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_îr‹_buf„r
,

184 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_FILE
,

186 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_po°fõlds
,

188 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_cuæ_hâpo°
,

190 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_cuæ_¶i°
,

192 
_CURL_WARNING
(
_cuæ_ósy_£t›t_îr_CURLSH
,

195 
_CURL_WARNING
(
_cuæ_ósy_gëöfo_îr_°rög
,

197 
_CURL_WARNING
(
_cuæ_ósy_gëöfo_îr_l⁄g
,

199 
_CURL_WARNING
(
_cuæ_ósy_gëöfo_îr_doubÀ
,

201 
_CURL_WARNING
(
_cuæ_ósy_gëöfo_îr_cuæ_¶i°
,

213 
	#_cuæ_is_l⁄g_›ti⁄
(
›ti⁄
) \

214 (0 < (
›ti⁄
Ë&& (›ti⁄Ë< 
CURLOPTTYPE_OBJECTPOINT
)

	)

216 
	#_cuæ_is_off_t_›ti⁄
(
›ti⁄
) \

217 ((
›ti⁄
Ë> 
CURLOPTTYPE_OFF_T
)

	)

220 
	#_cuæ_is_°rög_›ti⁄
(
›ti⁄
) \

221 ((
›ti⁄
Ë=
CURLOPT_URL
 || \

222 (
›ti⁄
Ë=
CURLOPT_PROXY
 || \

223 (
›ti⁄
Ë=
CURLOPT_INTERFACE
 || \

224 (
›ti⁄
Ë=
CURLOPT_NETRC_FILE
 || \

225 (
›ti⁄
Ë=
CURLOPT_USERPWD
 || \

226 (
›ti⁄
Ë=
CURLOPT_USERNAME
 || \

227 (
›ti⁄
Ë=
CURLOPT_PASSWORD
 || \

228 (
›ti⁄
Ë=
CURLOPT_PROXYUSERPWD
 || \

229 (
›ti⁄
Ë=
CURLOPT_PROXYUSERNAME
 || \

230 (
›ti⁄
Ë=
CURLOPT_PROXYPASSWORD
 || \

231 (
›ti⁄
Ë=
CURLOPT_NOPROXY
 || \

232 (
›ti⁄
Ë=
CURLOPT_ACCEPT_ENCODING
 || \

233 (
›ti⁄
Ë=
CURLOPT_REFERER
 || \

234 (
›ti⁄
Ë=
CURLOPT_USERAGENT
 || \

235 (
›ti⁄
Ë=
CURLOPT_COOKIE
 || \

236 (
›ti⁄
Ë=
CURLOPT_COOKIEFILE
 || \

237 (
›ti⁄
Ë=
CURLOPT_COOKIEJAR
 || \

238 (
›ti⁄
Ë=
CURLOPT_COOKIELIST
 || \

239 (
›ti⁄
Ë=
CURLOPT_FTPPORT
 || \

240 (
›ti⁄
Ë=
CURLOPT_FTP_ALTERNATIVE_TO_USER
 || \

241 (
›ti⁄
Ë=
CURLOPT_FTP_ACCOUNT
 || \

242 (
›ti⁄
Ë=
CURLOPT_RANGE
 || \

243 (
›ti⁄
Ë=
CURLOPT_CUSTOMREQUEST
 || \

244 (
›ti⁄
Ë=
CURLOPT_SSLCERT
 || \

245 (
›ti⁄
Ë=
CURLOPT_SSLCERTTYPE
 || \

246 (
›ti⁄
Ë=
CURLOPT_SSLKEY
 || \

247 (
›ti⁄
Ë=
CURLOPT_SSLKEYTYPE
 || \

248 (
›ti⁄
Ë=
CURLOPT_KEYPASSWD
 || \

249 (
›ti⁄
Ë=
CURLOPT_SSLENGINE
 || \

250 (
›ti⁄
Ë=
CURLOPT_CAINFO
 || \

251 (
›ti⁄
Ë=
CURLOPT_CAPATH
 || \

252 (
›ti⁄
Ë=
CURLOPT_RANDOM_FILE
 || \

253 (
›ti⁄
Ë=
CURLOPT_EGDSOCKET
 || \

254 (
›ti⁄
Ë=
CURLOPT_SSL_CIPHER_LIST
 || \

255 (
›ti⁄
Ë=
CURLOPT_KRBLEVEL
 || \

256 (
›ti⁄
Ë=
CURLOPT_SSH_HOST_PUBLIC_KEY_MD5
 || \

257 (
›ti⁄
Ë=
CURLOPT_SSH_PUBLIC_KEYFILE
 || \

258 (
›ti⁄
Ë=
CURLOPT_SSH_PRIVATE_KEYFILE
 || \

259 (
›ti⁄
Ë=
CURLOPT_CRLFILE
 || \

260 (
›ti⁄
Ë=
CURLOPT_ISSUERCERT
 || \

261 (
›ti⁄
Ë=
CURLOPT_SOCKS5_GSSAPI_SERVICE
 || \

262 (
›ti⁄
Ë=
CURLOPT_SSH_KNOWNHOSTS
 || \

263 (
›ti⁄
Ë=
CURLOPT_MAIL_FROM
 || \

264 (
›ti⁄
Ë=
CURLOPT_RTSP_SESSION_ID
 || \

265 (
›ti⁄
Ë=
CURLOPT_RTSP_STREAM_URI
 || \

266 (
›ti⁄
Ë=
CURLOPT_RTSP_TRANSPORT
 || \

267 (
›ti⁄
Ë=
CURLOPT_XOAUTH2_BEARER
 || \

268 (
›ti⁄
Ë=
CURLOPT_DNS_SERVERS
 || \

269 (
›ti⁄
Ë=
CURLOPT_DNS_INTERFACE
 || \

270 (
›ti⁄
Ë=
CURLOPT_DNS_LOCAL_IP4
 || \

271 (
›ti⁄
Ë=
CURLOPT_DNS_LOCAL_IP6
 || \

272 (
›ti⁄
Ë=
CURLOPT_LOGIN_OPTIONS
 || \

273 0)

	)

276 
	#_cuæ_is_wrôe_cb_›ti⁄
(
›ti⁄
) \

277 ((
›ti⁄
Ë=
CURLOPT_HEADERFUNCTION
 || \

278 (
›ti⁄
Ë=
CURLOPT_WRITEFUNCTION
)

	)

281 
	#_cuæ_is_c⁄v_cb_›ti⁄
(
›ti⁄
) \

282 ((
›ti⁄
Ë=
CURLOPT_CONV_TO_NETWORK_FUNCTION
 || \

283 (
›ti⁄
Ë=
CURLOPT_CONV_FROM_NETWORK_FUNCTION
 || \

284 (
›ti⁄
Ë=
CURLOPT_CONV_FROM_UTF8_FUNCTION
)

	)

287 
	#_cuæ_is_cb_d©a_›ti⁄
(
›ti⁄
) \

288 ((
›ti⁄
Ë=
CURLOPT_WRITEDATA
 || \

289 (
›ti⁄
Ë=
CURLOPT_READDATA
 || \

290 (
›ti⁄
Ë=
CURLOPT_IOCTLDATA
 || \

291 (
›ti⁄
Ë=
CURLOPT_SOCKOPTDATA
 || \

292 (
›ti⁄
Ë=
CURLOPT_OPENSOCKETDATA
 || \

293 (
›ti⁄
Ë=
CURLOPT_PROGRESSDATA
 || \

294 (
›ti⁄
Ë=
CURLOPT_HEADERDATA
 || \

295 (
›ti⁄
Ë=
CURLOPT_DEBUGDATA
 || \

296 (
›ti⁄
Ë=
CURLOPT_SSL_CTX_DATA
 || \

297 (
›ti⁄
Ë=
CURLOPT_SEEKDATA
 || \

298 (
›ti⁄
Ë=
CURLOPT_PRIVATE
 || \

299 (
›ti⁄
Ë=
CURLOPT_SSH_KEYDATA
 || \

300 (
›ti⁄
Ë=
CURLOPT_INTERLEAVEDATA
 || \

301 (
›ti⁄
Ë=
CURLOPT_CHUNK_DATA
 || \

302 (
›ti⁄
Ë=
CURLOPT_FNMATCH_DATA
 || \

303 0)

	)

306 
	#_cuæ_is_po°fõlds_›ti⁄
(
›ti⁄
) \

307 ((
›ti⁄
Ë=
CURLOPT_POSTFIELDS
 || \

308 (
›ti⁄
Ë=
CURLOPT_COPYPOSTFIELDS
 || \

309 0)

	)

312 
	#_cuæ_is_¶i°_›ti⁄
(
›ti⁄
) \

313 ((
›ti⁄
Ë=
CURLOPT_HTTPHEADER
 || \

314 (
›ti⁄
Ë=
CURLOPT_HTTP200ALIASES
 || \

315 (
›ti⁄
Ë=
CURLOPT_QUOTE
 || \

316 (
›ti⁄
Ë=
CURLOPT_POSTQUOTE
 || \

317 (
›ti⁄
Ë=
CURLOPT_PREQUOTE
 || \

318 (
›ti⁄
Ë=
CURLOPT_TELNETOPTIONS
 || \

319 (
›ti⁄
Ë=
CURLOPT_MAIL_RCPT
 || \

320 0)

	)

325 
	#_cuæ_is_°rög_öfo
(
öfo
) \

326 (
CURLINFO_STRING
 < (
öfo
Ë&& (öfoË< 
CURLINFO_LONG
)

	)

329 
	#_cuæ_is_l⁄g_öfo
(
öfo
) \

330 (
CURLINFO_LONG
 < (
öfo
Ë&& (öfoË< 
CURLINFO_DOUBLE
)

	)

333 
	#_cuæ_is_doubÀ_öfo
(
öfo
) \

334 (
CURLINFO_DOUBLE
 < (
öfo
Ë&& (öfoË< 
CURLINFO_SLIST
)

	)

337 
	#_cuæ_is_¶i°_öfo
(
öfo
) \

338 (
CURLINFO_SLIST
 < (
öfo
))

	)

353 
	#_cuæ_is_™y_±r
(
ex¥
) \

354 ((
ex¥
Ë=(*))

	)

358 
	#_cuæ_is_NULL
(
ex¥
) \

359 (
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), __ty≥of__(
NULL
)))

	)

362 
	#_cuæ_is_±r
(
ex¥
, 
ty≥
) \

363 (
	`_cuæ_is_NULL
(
ex¥
) || \

364 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
ty≥
 *) || \

365 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), c⁄° 
ty≥
 *))

	)

368 
	#_cuæ_is_¨r
(
ex¥
, 
ty≥
) \

369 (
	`_cuæ_is_±r
((
ex¥
), 
ty≥
) || \

370 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
ty≥
 []))

	)

373 
	#_cuæ_is_°rög
(
ex¥
) \

374 (
	`_cuæ_is_¨r
((
ex¥
), ) || \

375 
	`_cuæ_is_¨r
((
ex¥
), signed ) || \

376 
	`_cuæ_is_¨r
((
ex¥
), ))

	)

381 
	#_cuæ_is_l⁄g
(
ex¥
) \

382 (
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), ) || \

383 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), signed ) || \

384 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), ) || \

385 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), ) || \

386 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), signed ) || \

387 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), ) || \

388 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), ) || \

389 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), signed ) || \

390 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), ) || \

391 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), ) || \

392 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), signed ) || \

393 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), ))

	)

396 
	#_cuæ_is_off_t
(
ex¥
) \

397 (
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_off_t
))

	)

401 
	#_cuæ_is_îr‹_buf„r
(
ex¥
) \

402 (
	`_cuæ_is_NULL
(
ex¥
) || \

403 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), *) || \

404 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), []))

	)

408 
	#_cuæ_is_cb_d©a
(
ex¥
) \

409 (
	`_cuæ_is_±r
((
ex¥
), ) || \

410 
	`_cuæ_is_±r
((
ex¥
), 
FILE
))

	)

412 
	#_cuæ_is_cb_d©a
(
ex¥
) \

413 
	`_cuæ_is_™y_±r
(
ex¥
)

	)

417 
	#_cuæ_is_FILE
(
ex¥
) \

418 (
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
FILE
 *))

	)

421 
	#_cuæ_is_po°fõlds
(
ex¥
) \

422 (
	`_cuæ_is_±r
((
ex¥
), ) || \

423 
	`_cuæ_is_¨r
((
ex¥
), ))

	)

431 
	#_cuæ_ˇŒback_com∑tibÀ
(
func
, 
ty≥
) \

432 (
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
func
), 
ty≥
) || \

433 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
func
), 
ty≥
*))

	)

436 
	#_cuæ_is_ªad_cb
(
ex¥
) \

437 (
	`_cuæ_is_NULL
(
ex¥
) || \

438 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), __ty≥of__(
‰ód
)) || \

439 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_ªad_ˇŒback
) || \

440 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_ªad_ˇŒback1
) || \

441 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_ªad_ˇŒback2
) || \

442 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_ªad_ˇŒback3
) || \

443 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_ªad_ˇŒback4
) || \

444 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_ªad_ˇŒback5
) || \

445 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_ªad_ˇŒback6
))

	)

446 
	$size_t
 (
	t_cuæ_ªad_ˇŒback1
)(*, 
	tsize_t
, size_t, *);

447 
	$size_t
 (
	t_cuæ_ªad_ˇŒback2
)(*, 
	tsize_t
, size_t, const *);

448 
	$size_t
 (
	t_cuæ_ªad_ˇŒback3
)(*, 
	tsize_t
, size_t, 
	tFILE
*);

449 
	$size_t
 (
	t_cuæ_ªad_ˇŒback4
)(*, 
	tsize_t
, size_t, *);

450 
	$size_t
 (
	t_cuæ_ªad_ˇŒback5
)(*, 
	tsize_t
, size_t, const *);

451 
	$size_t
 (
	t_cuæ_ªad_ˇŒback6
)(*, 
	tsize_t
, size_t, 
	tFILE
*);

454 
	#_cuæ_is_wrôe_cb
(
ex¥
) \

455 (
	`_cuæ_is_ªad_cb
(
ex¥
) || \

456 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), __ty≥of__(
fwrôe
)) || \

457 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_wrôe_ˇŒback
) || \

458 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_wrôe_ˇŒback1
) || \

459 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_wrôe_ˇŒback2
) || \

460 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_wrôe_ˇŒback3
) || \

461 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_wrôe_ˇŒback4
) || \

462 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_wrôe_ˇŒback5
) || \

463 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_wrôe_ˇŒback6
))

	)

464 
	$size_t
 (
	t_cuæ_wrôe_ˇŒback1
)(c⁄° *, 
	tsize_t
, size_t, *);

465 
	$size_t
 (
	t_cuæ_wrôe_ˇŒback2
)(c⁄° *, 
	tsize_t
, size_t,

467 
	$size_t
 (
	t_cuæ_wrôe_ˇŒback3
)(c⁄° *, 
	tsize_t
, size_t, 
	tFILE
*);

468 
	$size_t
 (
	t_cuæ_wrôe_ˇŒback4
)(c⁄° *, 
	tsize_t
, size_t, *);

469 
	$size_t
 (
	t_cuæ_wrôe_ˇŒback5
)(c⁄° *, 
	tsize_t
, size_t,

471 
	$size_t
 (
	t_cuæ_wrôe_ˇŒback6
)(c⁄° *, 
	tsize_t
, size_t, 
	tFILE
*);

474 
	#_cuæ_is_io˘l_cb
(
ex¥
) \

475 (
	`_cuæ_is_NULL
(
ex¥
) || \

476 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_io˘l_ˇŒback
) || \

477 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_io˘l_ˇŒback1
) || \

478 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_io˘l_ˇŒback2
) || \

479 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_io˘l_ˇŒback3
) || \

480 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_io˘l_ˇŒback4
))

	)

481 
	$cuæi€º
 (
	t_cuæ_io˘l_ˇŒback1
)(
	tCURL
 *, , *);

482 
	$cuæi€º
 (
	t_cuæ_io˘l_ˇŒback2
)(
	tCURL
 *, , const *);

483 
	$cuæi€º
 (
	t_cuæ_io˘l_ˇŒback3
)(
	tCURL
 *, 
	tcuæiocmd
, *);

484 
	$cuæi€º
 (
	t_cuæ_io˘l_ˇŒback4
)(
	tCURL
 *, 
	tcuæiocmd
, const *);

487 
	#_cuæ_is_sock›t_cb
(
ex¥
) \

488 (
	`_cuæ_is_NULL
(
ex¥
) || \

489 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_sock›t_ˇŒback
) || \

490 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_sock›t_ˇŒback1
) || \

491 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_sock›t_ˇŒback2
))

	)

492 (
	t_cuæ_sock›t_ˇŒback1
)(*, 
	tcuæ_sockë_t
, 
	tcuæsockty≥
);

493 (
	t_cuæ_sock›t_ˇŒback2
)(c⁄° *, 
	tcuæ_sockë_t
,

494 
	tcuæsockty≥
);

498 
	#_cuæ_is_›ísockë_cb
(
ex¥
) \

499 (
	`_cuæ_is_NULL
(
ex¥
) || \

500 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_›ísockë_ˇŒback
) ||\

501 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_›ísockë_ˇŒback1
) || \

502 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_›ísockë_ˇŒback2
) || \

503 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_›ísockë_ˇŒback3
) || \

504 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_›ísockë_ˇŒback4
))

	)

505 
	$cuæ_sockë_t
 (
	t_cuæ_›ísockë_ˇŒback1
)

506 (*, 
	tcuæsockty≥
, 
	tcuæ_sockaddr
 *);

507 
	$cuæ_sockë_t
 (
	t_cuæ_›ísockë_ˇŒback2
)

508 (*, 
	tcuæsockty≥
, c⁄° 
	tcuæ_sockaddr
 *);

509 
	$cuæ_sockë_t
 (
	t_cuæ_›ísockë_ˇŒback3
)

510 (c⁄° *, 
	tcuæsockty≥
, 
	tcuæ_sockaddr
 *);

511 
	$cuæ_sockë_t
 (
	t_cuæ_›ísockë_ˇŒback4
)

512 (c⁄° *, 
	tcuæsockty≥
, c⁄° 
	tcuæ_sockaddr
 *);

515 
	#_cuæ_is_¥ogªss_cb
(
ex¥
) \

516 (
	`_cuæ_is_NULL
(
ex¥
) || \

517 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_¥ogªss_ˇŒback
) || \

518 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_¥ogªss_ˇŒback1
) || \

519 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_¥ogªss_ˇŒback2
))

	)

520 (
	t_cuæ_¥ogªss_ˇŒback1
)(*,

522 (
	t_cuæ_¥ogªss_ˇŒback2
)(const *,

526 
	#_cuæ_is_debug_cb
(
ex¥
) \

527 (
	`_cuæ_is_NULL
(
ex¥
) || \

528 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_debug_ˇŒback
) || \

529 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_debug_ˇŒback1
) || \

530 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_debug_ˇŒback2
) || \

531 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_debug_ˇŒback3
) || \

532 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_debug_ˇŒback4
) || \

533 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_debug_ˇŒback5
) || \

534 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_debug_ˇŒback6
) || \

535 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_debug_ˇŒback7
) || \

536 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_debug_ˇŒback8
))

	)

537 (
	t_cuæ_debug_ˇŒback1
Ë(
	tCURL
 *,

538 
	tcuæ_öfŸy≥
, *, 
	tsize_t
, *);

539 (
	t_cuæ_debug_ˇŒback2
Ë(
	tCURL
 *,

540 
	tcuæ_öfŸy≥
, *, 
	tsize_t
, const *);

541 (
	t_cuæ_debug_ˇŒback3
Ë(
	tCURL
 *,

542 
	tcuæ_öfŸy≥
, c⁄° *, 
	tsize_t
, *);

543 (
	t_cuæ_debug_ˇŒback4
Ë(
	tCURL
 *,

544 
	tcuæ_öfŸy≥
, c⁄° *, 
	tsize_t
, const *);

545 (
	t_cuæ_debug_ˇŒback5
Ë(
	tCURL
 *,

546 
	tcuæ_öfŸy≥
, *, 
	tsize_t
, *);

547 (
	t_cuæ_debug_ˇŒback6
Ë(
	tCURL
 *,

548 
	tcuæ_öfŸy≥
, *, 
	tsize_t
, const *);

549 (
	t_cuæ_debug_ˇŒback7
Ë(
	tCURL
 *,

550 
	tcuæ_öfŸy≥
, c⁄° *, 
	tsize_t
, *);

551 (
	t_cuæ_debug_ˇŒback8
Ë(
	tCURL
 *,

552 
	tcuæ_öfŸy≥
, c⁄° *, 
	tsize_t
, const *);

556 
	#_cuæ_is_s¶_˘x_cb
(
ex¥
) \

557 (
	`_cuæ_is_NULL
(
ex¥
) || \

558 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_s¶_˘x_ˇŒback
) || \

559 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_s¶_˘x_ˇŒback1
) || \

560 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_s¶_˘x_ˇŒback2
) || \

561 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_s¶_˘x_ˇŒback3
) || \

562 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_s¶_˘x_ˇŒback4
) || \

563 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_s¶_˘x_ˇŒback5
) || \

564 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_s¶_˘x_ˇŒback6
) || \

565 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_s¶_˘x_ˇŒback7
) || \

566 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_s¶_˘x_ˇŒback8
))

	)

567 
	$CURLcode
 (
	t_cuæ_s¶_˘x_ˇŒback1
)(
	tCURL
 *, *, *);

568 
	$CURLcode
 (
	t_cuæ_s¶_˘x_ˇŒback2
)(
	tCURL
 *, *, const *);

569 
	$CURLcode
 (
	t_cuæ_s¶_˘x_ˇŒback3
)(
	tCURL
 *, const *, *);

570 
	$CURLcode
 (
	t_cuæ_s¶_˘x_ˇŒback4
)(
	tCURL
 *, const *, const *);

571 #ifde‡
HEADER_SSL_H


575 
	$CURLcode
 (
	t_cuæ_s¶_˘x_ˇŒback5
)(
	tCURL
 *, 
	tSSL_CTX
, *);

576 
	$CURLcode
 (
	t_cuæ_s¶_˘x_ˇŒback6
)(
	tCURL
 *, 
	tSSL_CTX
, const *);

577 
	$CURLcode
 (
	t_cuæ_s¶_˘x_ˇŒback7
)(
	tCURL
 *, c⁄° 
	tSSL_CTX
, *);

578 
	$CURLcode
 (
	t_cuæ_s¶_˘x_ˇŒback8
)(
	tCURL
 *, c⁄° 
	tSSL_CTX
,

581 
_cuæ_s¶_˘x_ˇŒback1
 
	t_cuæ_s¶_˘x_ˇŒback5
;

582 
_cuæ_s¶_˘x_ˇŒback1
 
	t_cuæ_s¶_˘x_ˇŒback6
;

583 
_cuæ_s¶_˘x_ˇŒback1
 
	t_cuæ_s¶_˘x_ˇŒback7
;

584 
_cuæ_s¶_˘x_ˇŒback1
 
	t_cuæ_s¶_˘x_ˇŒback8
;

588 
	#_cuæ_is_c⁄v_cb
(
ex¥
) \

589 (
	`_cuæ_is_NULL
(
ex¥
) || \

590 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_c⁄v_ˇŒback
) || \

591 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_c⁄v_ˇŒback1
) || \

592 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_c⁄v_ˇŒback2
) || \

593 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_c⁄v_ˇŒback3
) || \

594 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_c⁄v_ˇŒback4
))

	)

595 
	$CURLcode
 (*
	t_cuæ_c⁄v_ˇŒback1
)(*, 
	tsize_t
 
	tÀngth
);

596 
	$CURLcode
 (*
	t_cuæ_c⁄v_ˇŒback2
)(c⁄° *, 
	tsize_t
 
	tÀngth
);

597 
	$CURLcode
 (*
	t_cuæ_c⁄v_ˇŒback3
)(*, 
	tsize_t
 
	tÀngth
);

598 
	$CURLcode
 (*
	t_cuæ_c⁄v_ˇŒback4
)(c⁄° *, 
	tsize_t
 
	tÀngth
);

601 
	#_cuæ_is_£ek_cb
(
ex¥
) \

602 (
	`_cuæ_is_NULL
(
ex¥
) || \

603 
	`__buûtö_ty≥s_com∑tibÀ_p
(
	`__ty≥of__
(
ex¥
), 
cuæ_£ek_ˇŒback
) || \

604 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_£ek_ˇŒback1
) || \

605 
	`_cuæ_ˇŒback_com∑tibÀ
((
ex¥
), 
_cuæ_£ek_ˇŒback2
))

	)

606 
	$CURLcode
 (*
	t_cuæ_£ek_ˇŒback1
)(*, 
	tcuæ_off_t
, );

607 
	$CURLcode
 (*
	t_cuæ_£ek_ˇŒback2
)(c⁄° *, 
	tcuæ_off_t
, );

	@lib/amigaos.c

23 
	~"cuæ_£tup.h
"

25 #i‡
deföed
(
__AMIGA__
Ë&& !deföed(
__ixemul__
)

27 
	~<amô˝/sockëba£ègs.h
>

29 
	~"amigaos.h
"

31 
Libøry
 *
	gSockëBa£
 = 
NULL
;

32 
î∫o
, 
h_î∫o
;

34 #ifde‡
__libnix__


35 
	~<°abs.h
>

36 
__ªque°
(c⁄° *
msg
);

38 
	#__ªque°
–
msg
 ) 
	`Prötf
–msg "\n\a")

	)

41 
	$Cuæ_amiga_˛ónup
()

43 if(
SockëBa£
) {

44 
	`Clo£Libøry
(
SockëBa£
);

45 
SockëBa£
 = 
NULL
;

47 
	}
}

49 
boﬁ
 
	$Cuæ_amiga_öô
()

51 if(!
SockëBa£
)

52 
SockëBa£
 = 
	`O≥nLibøry
("bsdsocket.library", 4);

54 if(!
SockëBa£
) {

55 
	`__ªque°
("No TCP/IP StackÑunning!");

56  
FALSE
;

59 if(
	`SockëBa£Tags
(
	`SBTM_SETVAL
(
	`SBTC_ERRNOPTR
((
î∫o
))), (
ULONG
) &errno,

60 
	`SBTM_SETVAL
(
SBTC_LOGTAGPTR
), (
ULONG
) "cURL",

61 
TAG_DONE
)) {

62 
	`__ªque°
("SocketBaseTags ERROR");

63  
FALSE
;

66 #i‚de‡
__libnix__


67 
	`©exô
(
Cuæ_amiga_˛ónup
);

70  
TRUE
;

71 
	}
}

73 #ifde‡
__libnix__


74 
ADD2EXIT
(
Cuæ_amiga_˛ónup
,-50);

	@lib/amigaos.h

1 #i‚de‡
HEADER_CURL_AMIGAOS_H


2 
	#HEADER_CURL_AMIGAOS_H


	)

24 
	~"cuæ_£tup.h
"

26 #i‡
deföed
(
__AMIGA__
Ë&& !deföed(
__ixemul__
)

28 
boﬁ
 
Cuæ_amiga_öô
();

29 
Cuæ_amiga_˛ónup
();

33 
	#Cuæ_amiga_öô
(Ë1

	)

34 
	#Cuæ_amiga_˛ónup
(Ë
Cuæ_n›_°mt


	)

	@lib/arpa_telnet.h

1 #i‚de‡
HEADER_CURL_ARPA_TELNET_H


2 
	#HEADER_CURL_ARPA_TELNET_H


	)

24 #i‚de‡
CURL_DISABLE_TELNET


28 
	#CURL_TELOPT_BINARY
 0

	)

29 
	#CURL_TELOPT_ECHO
 1

	)

30 
	#CURL_TELOPT_SGA
 3

	)

31 
	#CURL_TELOPT_EXOPL
 255

	)

32 
	#CURL_TELOPT_TTYPE
 24

	)

33 
	#CURL_TELOPT_NAWS
 31

	)

34 
	#CURL_TELOPT_XDISPLOC
 35

	)

36 
	#CURL_TELOPT_NEW_ENVIRON
 39

	)

37 
	#CURL_NEW_ENV_VAR
 0

	)

38 
	#CURL_NEW_ENV_VALUE
 1

	)

43 c⁄° * c⁄° 
	gã ë›ti⁄s
[]=

57 
	#CURL_TELOPT_MAXIMUM
 
CURL_TELOPT_NEW_ENVIRON


	)

59 
	#CURL_TELOPT_OK
(
x
Ë((xË<
CURL_TELOPT_MAXIMUM
)

	)

60 
	#CURL_TELOPT
(
x
Ë
ã ë›ti⁄s
[x]

	)

62 
	#CURL_NTELOPTS
 40

	)

67 
	#CURL_xEOF
 236

	)

68 
	#CURL_SE
 240

	)

69 
	#CURL_NOP
 241

	)

70 
	#CURL_DM
 242

	)

71 
	#CURL_GA
 249

	)

72 
	#CURL_SB
 250

	)

73 
	#CURL_WILL
 251

	)

74 
	#CURL_WONT
 252

	)

75 
	#CURL_DO
 253

	)

76 
	#CURL_DONT
 254

	)

77 
	#CURL_IAC
 255

	)

82 c⁄° * c⁄° 
	gã ëcmds
[]=

90 
	#CURL_TELCMD_MINIMUM
 
CURL_xEOF


	)

91 
	#CURL_TELCMD_MAXIMUM
 
CURL_IAC


	)

93 
	#CURL_TELQUAL_IS
 0

	)

94 
	#CURL_TELQUAL_SEND
 1

	)

95 
	#CURL_TELQUAL_INFO
 2

	)

96 
	#CURL_TELQUAL_NAME
 3

	)

98 
	#CURL_TELCMD_OK
(
x
Ë–(()(xË>
CURL_TELCMD_MINIMUM
) && \

99 (()(
x
Ë<
CURL_TELCMD_MAXIMUM
Ë)

	)

100 
	#CURL_TELCMD
(
x
Ë
ã ëcmds
[(x)-
CURL_TELCMD_MINIMUM
]

	)

	@lib/asyn-ares.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_LIMITS_H


26 
	~<limôs.h
>

28 #ifde‡
HAVE_NETINET_IN_H


29 
	~<√töë/ö.h
>

31 #ifde‡
HAVE_NETDB_H


32 
	~<√tdb.h
>

34 #ifde‡
HAVE_ARPA_INET_H


35 
	~<¨∑/öë.h
>

37 #ifde‡
__VMS


38 
	~<ö.h
>

39 
	~<öë.h
>

42 #ifde‡
HAVE_PROCESS_H


43 
	~<¥o˚ss.h
>

46 #i‡(
deföed
(
NETWARE
Ë&& deföed(
__NOVELL_LIBC__
))

47 #unde‡
ö_addr_t


48 
	#ö_addr_t
 

	)

57 #ifde‡
CURLRES_ARES


59 
	~"uæd©a.h
"

60 
	~"£ndf.h
"

61 
	~"ho°ù.h
"

62 
	~"hash.h
"

63 
	~"sh¨e.h
"

64 
	~"°ªº‹.h
"

65 
	~"uæ.h
"

66 
	~"mu…iif.h
"

67 
	~"öë_±⁄.h
"

68 
	~"c⁄√˘.h
"

69 
	~"£À˘.h
"

70 
	~"¥ogªss.h
"

72 
	#_MPRINTF_REPLACE


	)

73 
	~<cuæ/m¥ötf.h
>

75 #i‡
deföed
(
CURL_STATICLIB
Ë&& !deföed(
CARES_STATICLIB
) && \

76 (
deföed
(
WIN32
Ë|| deföed(
_WIN32
Ë|| 
	$deföed
(
__SYMBIAN32__
))

77 
	#CARES_STATICLIB


	)

79 
	~<¨es.h
>

80 
	~<¨es_vîsi⁄.h
>

83 #i‡
ARES_VERSION
 >= 0x010500

85 
	#HAVE_CARES_CALLBACK_TIMEOUTS
 1

	)

88 
	~"cuæ_mem‹y.h
"

90 
	~"memdebug.h
"

92 
	sResﬁvîResu…s
 {

93 
num_≥ndög
;

94 
Cuæ_addröfo
 *
ãmp_ai
;

95 
œ°_°©us
;

103 
	$Cuæ_ªsﬁvî_globÆ_öô
()

105 #ifde‡
CARES_HAVE_ARES_LIBRARY_INIT


106 if(
	`¨es_libøry_öô
(
ARES_LIB_INIT_ALL
)) {

107  
CURLE_FAILED_INIT
;

110  
CURLE_OK
;

111 
	}
}

119 
	$Cuæ_ªsﬁvî_globÆ_˛ónup
()

121 #ifde‡
CARES_HAVE_ARES_LIBRARY_CLEANUP


122 
	`¨es_libøry_˛ónup
();

124 
	}
}

133 
CURLcode
 
	$Cuæ_ªsﬁvî_öô
(**
ªsﬁvî
)

135 
°©us
 = 
	`¨es_öô
((
¨es_ch™√l
*)
ªsﬁvî
);

136 if(
°©us
 !
ARES_SUCCESS
) {

137 if(
°©us
 =
ARES_ENOMEM
)

138  
CURLE_OUT_OF_MEMORY
;

140  
CURLE_FAILED_INIT
;

142  
CURLE_OK
;

145 
	}
}

154 
	$Cuæ_ªsﬁvî_˛ónup
(*
ªsﬁvî
)

156 
	`¨es_de°roy
((
¨es_ch™√l
)
ªsﬁvî
);

157 
	}
}

166 
	$Cuæ_ªsﬁvî_duph™dÀ
(**
to
, *
‰om
)

169 if(
ARES_SUCCESS
 !
	`¨es_dup
((
¨es_ch™√l
*)
to
,◊ªs_ch™√l)
‰om
))

170  
CURLE_FAILED_INIT
;

171  
CURLE_OK
;

172 
	}
}

174 
de°roy_async_d©a
 (
Cuæ_async
 *
async
);

179 
	$Cuæ_ªsﬁvî_ˇn˚l
(
c⁄√˘d©a
 *
c⁄n
)

181 if(
c⁄n
 && c⁄n->
d©a
 && c⁄n->d©a->
°©e
.
ªsﬁvî
)

182 
	`¨es_ˇn˚l
((
¨es_ch™√l
)
c⁄n
->
d©a
->
°©e
.
ªsﬁvî
);

183 
	`de°roy_async_d©a
(&
c⁄n
->
async
);

184 
	}
}

189 
	$de°roy_async_d©a
 (
Cuæ_async
 *
async
)

191 if(
async
->
ho°«me
)

192 
	`‰ì
(
async
->
ho°«me
);

194 if(
async
->
os_•ecific
) {

195 
ResﬁvîResu…s
 *
ªs
 = (ResﬁvîResu…†*)
async
->
os_•ecific
;

196 if(
ªs
) {

197 if(
ªs
->
ãmp_ai
) {

198 
	`Cuæ_‰ìaddröfo
(
ªs
->
ãmp_ai
);

199 
ªs
->
ãmp_ai
 = 
NULL
;

201 
	`‰ì
(
ªs
);

203 
async
->
os_•ecific
 = 
NULL
;

206 
async
->
ho°«me
 = 
NULL
;

207 
	}
}

218 
	$Cuæ_ªsﬁvî_gësock
(
c⁄√˘d©a
 *
c⁄n
,

219 
cuæ_sockë_t
 *
socks
,

220 
numsocks
)

223 
timevÆ
 
maxtime
;

224 
timevÆ
 
timebuf
;

225 
timevÆ
 *
timeout
;

226 
mûli
;

227 
max
 = 
	`¨es_gësock
((
¨es_ch™√l
)
c⁄n
->
d©a
->
°©e
.
ªsﬁvî
,

228 (
¨es_sockë_t
 *)
socks
, 
numsocks
);

230 
maxtime
.
tv_£c
 = 
CURL_TIMEOUT_RESOLVE
;

231 
maxtime
.
tv_u£c
 = 0;

233 
timeout
 = 
	`¨es_timeout
((
¨es_ch™√l
)
c⁄n
->
d©a
->
°©e
.
ªsﬁvî
, &
maxtime
,

234 &
timebuf
);

235 
mûli
 = (
timeout
->
tv_£c
 * 1000Ë+ (timeout->
tv_u£c
/1000);

236 if(
mûli
 == 0)

237 
mûli
 += 10;

238 
	`Cuæ_expúe
(
c⁄n
->
d©a
, 
mûli
);

240  
max
;

241 
	}
}

253 
	$waô≥rf‹m
(
c⁄√˘d©a
 *
c⁄n
, 
timeout_ms
)

255 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

256 
nfds
;

257 
bômask
;

258 
¨es_sockë_t
 
socks
[
ARES_GETSOCK_MAXNUM
];

259 
pﬁlfd
 
pfd
[
ARES_GETSOCK_MAXNUM
];

260 
i
;

261 
num
 = 0;

263 
bômask
 = 
	`¨es_gësock
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
, 
socks
,

264 
ARES_GETSOCK_MAXNUM
);

266 
i
=0; i < 
ARES_GETSOCK_MAXNUM
; i++) {

267 
pfd
[
i
].
evíts
 = 0;

268 
pfd
[
i
].
ªvíts
 = 0;

269 if(
	`ARES_GETSOCK_READABLE
(
bômask
, 
i
)) {

270 
pfd
[
i
].
fd
 = 
socks
[i];

271 
pfd
[
i
].
evíts
 |
POLLRDNORM
|
POLLIN
;

273 if(
	`ARES_GETSOCK_WRITABLE
(
bômask
, 
i
)) {

274 
pfd
[
i
].
fd
 = 
socks
[i];

275 
pfd
[
i
].
evíts
 |
POLLWRNORM
|
POLLOUT
;

277 if(
pfd
[
i
].
evíts
 != 0)

278 
num
++;

283 if(
num
)

284 
nfds
 = 
	`Cuæ_pﬁl
(
pfd
, 
num
, 
timeout_ms
);

286 
nfds
 = 0;

288 if(!
nfds
)

291 
	`¨es_¥o˚ss_fd
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
, 
ARES_SOCKET_BAD
,

292 
ARES_SOCKET_BAD
);

295 
i
=0; i < 
num
; i++)

296 
	`¨es_¥o˚ss_fd
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
,

297 
pfd
[
i
].
ªvíts
 & (
POLLRDNORM
|
POLLIN
)?

298 
pfd
[
i
].
fd
:
ARES_SOCKET_BAD
,

299 
pfd
[
i
].
ªvíts
 & (
POLLWRNORM
|
POLLOUT
)?

300 
pfd
[
i
].
fd
:
ARES_SOCKET_BAD
);

302  
nfds
;

303 
	}
}

312 
CURLcode
 
	$Cuæ_ªsﬁvî_is_ªsﬁved
(
c⁄√˘d©a
 *
c⁄n
,

313 
Cuæ_dns_íåy
 **
dns
)

315 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

316 
ResﬁvîResu…s
 *
ªs
 = (ResolverResults *)

317 
c⁄n
->
async
.
os_•ecific
;

318 
CURLcode
 
rc
 = 
CURLE_OK
;

320 *
dns
 = 
NULL
;

322 
	`waô≥rf‹m
(
c⁄n
, 0);

324 if(
ªs
 && !ªs->
num_≥ndög
) {

325 ()
	`Cuæ_addröfo_ˇŒback
(
c⁄n
, 
ªs
->
œ°_°©us
,Ñes->
ãmp_ai
);

328 
ªs
->
ãmp_ai
 = 
NULL
;

329 if(!
c⁄n
->
async
.
dns
) {

330 
	`Áûf
(
d©a
, "CouldÇotÑesolve: %s (%s)",

331 
c⁄n
->
async
.
ho°«me
, 
	`¨es_°ªº‹
(c⁄n->async.
°©us
));

332 
rc
 = 
c⁄n
->
bôs
.
¥oxy
?
CURLE_COULDNT_RESOLVE_PROXY
:

333 
CURLE_COULDNT_RESOLVE_HOST
;

336 *
dns
 = 
c⁄n
->
async
.dns;

338 
	`de°roy_async_d©a
(&
c⁄n
->
async
);

341  
rc
;

342 
	}
}

355 
CURLcode
 
	$Cuæ_ªsﬁvî_waô_ªsﬁv
(
c⁄√˘d©a
 *
c⁄n
,

356 
Cuæ_dns_íåy
 **
íåy
)

358 
CURLcode
 
rc
=
CURLE_OK
;

359 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

360 
timeout
;

361 
timevÆ
 
now
 = 
	`Cuæ_tvnow
();

362 
Cuæ_dns_íåy
 *
ãmp_íåy
;

364 
timeout
 = 
	`Cuæ_timñe·
(
d©a
, &
now
, 
TRUE
);

365 if(!
timeout
)

366 
timeout
 = 
CURL_TIMEOUT_RESOLVE
 * 1000;

370 
timevÆ
 *
tvp
, 
tv
, 
°‹e
;

371 
timediff
;

372 
ôimeout
;

373 
timeout_ms
;

375 
ôimeout
 = (
timeout
 > ()
INT_MAX
) ? INT_MAX : ()timeout;

377 
°‹e
.
tv_£c
 = 
ôimeout
/1000;

378 
°‹e
.
tv_u£c
 = (
ôimeout
%1000)*1000;

380 
tvp
 = 
	`¨es_timeout
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
, &
°‹e
, &
tv
);

385 if(!
tvp
->
tv_£c
)

386 
timeout_ms
 = ()(
tvp
->
tv_u£c
/1000);

388 
timeout_ms
 = 1000;

390 
	`waô≥rf‹m
(
c⁄n
, 
timeout_ms
);

391 
	`Cuæ_ªsﬁvî_is_ªsﬁved
(
c⁄n
,&
ãmp_íåy
);

393 if(
c⁄n
->
async
.
d⁄e
)

396 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
)) {

397 
rc
 = 
CURLE_ABORTED_BY_CALLBACK
;

398 
timeout
 = -1;

401 
timevÆ
 
now2
 = 
	`Cuæ_tvnow
();

402 
timediff
 = 
	`Cuæ_tvdiff
(
now2
, 
now
);

403 
timeout
 -
timediff
?timediff:1;

404 
now
 = 
now2
;

406 if(
timeout
 < 0) {

408 
	`¨es_ˇn˚l
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
);

416 if(
íåy
)

417 *
íåy
 = 
c⁄n
->
async
.
dns
;

419 if(
rc
)

424 
	`c⁄n˛o£
(
c⁄n
, "c-aresÑesolve failed");

426  
rc
;

427 
	}
}

430 
	$compound_ªsu…s
(
ResﬁvîResu…s
 *
ªs
,

431 
Cuæ_addröfo
 *
ai
)

433 
Cuæ_addröfo
 *
ai_èû
;

434 if(!
ai
)

436 
ai_èû
 = 
ai
;

438 
ai_èû
->
ai_√xt
)

439 
ai_èû
 =ái_èû->
ai_√xt
;

442 
ai_èû
->
ai_√xt
 = 
ªs
->
ãmp_ai
;

443 
ªs
->
ãmp_ai
 = 
ai
;

444 
	}
}

451 
quîy_com∂ëed_cb
(*
¨g
,

452 
°©us
,

453 #ifde‡
HAVE_CARES_CALLBACK_TIMEOUTS


454 
timeouts
,

456 
ho°ít
 *hostent)

458 
c⁄√˘d©a
 *
	gc⁄n
 = (c⁄√˘d©®*)
¨g
;

459 
ResﬁvîResu…s
 *
	gªs
;

461 #ifde‡
HAVE_CARES_CALLBACK_TIMEOUTS


462 ()
	gtimeouts
;

465 if(
	gARES_EDESTRUCTION
 =
°©us
)

470 
	gªs
 = (
ResﬁvîResu…s
 *)
c⁄n
->
async
.
os_•ecific
;

471 
	gªs
->
	gnum_≥ndög
--;

473 if(
	gCURL_ASYNC_SUCCESS
 =
°©us
) {

474 
Cuæ_addröfo
 *
ai
 = 
Cuæ_he2ai
(
ho°ít
, 
c⁄n
->
async
.
p‹t
);

475 if(
	gai
) {

476 
compound_ªsu…s
(
ªs
, 
ai
);

480 if(
	gªs
->
	gœ°_°©us
 !
ARES_SUCCESS
)

481 
ªs
->
œ°_°©us
 = 
°©us
;

492 
Cuæ_addröfo
 *
	$Cuæ_ªsﬁvî_gëaddröfo
(
c⁄√˘d©a
 *
c⁄n
,

493 c⁄° *
ho°«me
,

494 
p‹t
,

495 *
waôp
)

497 *
buÂ
;

498 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

499 
ö_addr
 
ö
;

500 
Ámûy
 = 
PF_INET
;

501 #ifde‡
ENABLE_IPV6


502 
ö6_addr
 
ö6
;

505 *
waôp
 = 0;

508 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
ho°«me
, &
ö
) > 0) {

510  
	`Cuæ_ù2addr
(
AF_INET
, &
ö
, 
ho°«me
, 
p‹t
);

513 #ifde‡
ENABLE_IPV6


515 if(
	`Cuæ_öë_±⁄
 (
AF_INET6
, 
ho°«me
, &
ö6
) > 0)

517  
	`Cuæ_ù2addr
(
AF_INET6
, &
ö6
, 
ho°«me
, 
p‹t
);

519 
c⁄n
->
ù_vîsi⁄
) {

521 #i‡
ARES_VERSION
 >= 0x010601

522 
Ámûy
 = 
PF_UNSPEC
;

527 
CURL_IPRESOLVE_V4
:

528 
Ámûy
 = 
PF_INET
;

530 
CURL_IPRESOLVE_V6
:

531 
Ámûy
 = 
PF_INET6
;

536 
buÂ
 = 
	`°rdup
(
ho°«me
);

537 if(
buÂ
) {

538 
ResﬁvîResu…s
 *
ªs
 = 
NULL
;

539 
	`Cuæ_ß„‰ì
(
c⁄n
->
async
.
ho°«me
);

540 
c⁄n
->
async
.
ho°«me
 = 
buÂ
;

541 
c⁄n
->
async
.
p‹t
 =Öort;

542 
c⁄n
->
async
.
d⁄e
 = 
FALSE
;

543 
c⁄n
->
async
.
°©us
 = 0;

544 
c⁄n
->
async
.
dns
 = 
NULL
;

545 
ªs
 = 
	`ˇŒoc
((
ResﬁvîResu…s
),1);

546 if(!
ªs
) {

547 
	`Cuæ_ß„‰ì
(
c⁄n
->
async
.
ho°«me
);

548 
c⁄n
->
async
.
ho°«me
 = 
NULL
;

549  
NULL
;

551 
c⁄n
->
async
.
os_•ecific
 = 
ªs
;

554 
ªs
->
œ°_°©us
 = 
ARES_ENOTFOUND
;

555 #ifde‡
ENABLE_IPV6


556 if(
Ámûy
 =
PF_UNSPEC
) {

557 if(
	`Cuæ_ùv6w‹ks
()) {

558 
ªs
->
num_≥ndög
 = 2;

561 
	`¨es_gëho°by«me
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
, 
ho°«me
,

562 
PF_INET
, 
quîy_com∂ëed_cb
, 
c⁄n
);

563 
	`¨es_gëho°by«me
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
, 
ho°«me
,

564 
PF_INET6
, 
quîy_com∂ëed_cb
, 
c⁄n
);

567 
ªs
->
num_≥ndög
 = 1;

570 
	`¨es_gëho°by«me
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
, 
ho°«me
,

571 
PF_INET
, 
quîy_com∂ëed_cb
, 
c⁄n
);

577 
ªs
->
num_≥ndög
 = 1;

580 
	`¨es_gëho°by«me
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
, 
ho°«me
, 
Ámûy
,

581 
quîy_com∂ëed_cb
, 
c⁄n
);

584 *
waôp
 = 1;

586  
NULL
;

587 
	}
}

589 
CURLcode
 
	$Cuæ_£t_dns_£rvîs
(
Sessi⁄H™dÀ
 *
d©a
,

590 *
£rvîs
)

592 
CURLcode
 
ªsu…
 = 
CURLE_NOT_BUILT_IN
;

593 
¨es_ªsu…
;

601 if(!(
£rvîs
 && servers[0]))

602  
CURLE_OK
;

604 #i‡(
ARES_VERSION
 >= 0x010704)

605 
¨es_ªsu…
 = 
	`¨es_£t_£rvîs_csv
(
d©a
->
°©e
.
ªsﬁvî
, 
£rvîs
);

606 
¨es_ªsu…
) {

607 
ARES_SUCCESS
:

608 
ªsu…
 = 
CURLE_OK
;

610 
ARES_ENOMEM
:

611 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

613 
ARES_ENOTINITIALIZED
:

614 
ARES_ENODATA
:

615 
ARES_EBADSTR
:

617 
ªsu…
 = 
CURLE_BAD_FUNCTION_ARGUMENT
;

621 ()
d©a
;

622 ()(
¨es_ªsu…
);

624  
ªsu…
;

625 
	}
}

627 
CURLcode
 
	$Cuæ_£t_dns_öãrÁ˚
(
Sessi⁄H™dÀ
 *
d©a
,

628 c⁄° *
öãrf
)

630 #i‡(
ARES_VERSION
 >= 0x010704)

631 if(!
öãrf
)

632 
öãrf
 = "";

634 
	`¨es_£t_loˇl_dev
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
, 
öãrf
);

636  
CURLE_OK
;

638 ()
d©a
;

639 ()
öãrf
;

640  
CURLE_NOT_BUILT_IN
;

642 
	}
}

644 
CURLcode
 
	$Cuæ_£t_dns_loˇl_ù4
(
Sessi⁄H™dÀ
 *
d©a
,

645 c⁄° *
loˇl_ù4
)

647 #i‡(
ARES_VERSION
 >= 0x010704)

648 
ö_addr
 
a4
;

650 if((!
loˇl_ù4
) || (local_ip4[0] == 0)) {

651 
a4
.
s_addr
 = 0;

654 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
loˇl_ù4
, &
a4
) != 1) {

655  
CURLE_BAD_FUNCTION_ARGUMENT
;

659 
	`¨es_£t_loˇl_ù4
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
, 
	`¡ohl
(
a4
.
s_addr
));

661  
CURLE_OK
;

663 ()
d©a
;

664 ()
loˇl_ù4
;

665  
CURLE_NOT_BUILT_IN
;

667 
	}
}

669 
CURLcode
 
	$Cuæ_£t_dns_loˇl_ù6
(
Sessi⁄H™dÀ
 *
d©a
,

670 c⁄° *
loˇl_ù6
)

672 #i‡(
ARES_VERSION
 >= 0x010704)

673 
a6
[
INET6_ADDRSTRLEN
];

675 if((!
loˇl_ù6
) || (local_ip6[0] == 0)) {

677 
	`mem£t
(
a6
, 0, (a6));

680 if(
	`Cuæ_öë_±⁄
(
AF_INET6
, 
loˇl_ù6
, 
a6
) != 1) {

681  
CURLE_BAD_FUNCTION_ARGUMENT
;

685 
	`¨es_£t_loˇl_ù6
((
¨es_ch™√l
)
d©a
->
°©e
.
ªsﬁvî
, 
a6
);

687  
CURLE_OK
;

689 ()
d©a
;

690 ()
loˇl_ù6
;

691  
CURLE_NOT_BUILT_IN
;

693 
	}
}

	@lib/asyn-thread.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_NETINET_IN_H


26 
	~<√töë/ö.h
>

28 #ifde‡
HAVE_NETDB_H


29 
	~<√tdb.h
>

31 #ifde‡
HAVE_ARPA_INET_H


32 
	~<¨∑/öë.h
>

34 #ifde‡
__VMS


35 
	~<ö.h
>

36 
	~<öë.h
>

39 #i‡
deföed
(
USE_THREADS_POSIX
)

40 #ifde‡
HAVE_PTHREAD_H


41 
	~<±hªad.h
>

43 #ñi‡
deföed
(
USE_THREADS_WIN32
)

44 #ifde‡
HAVE_PROCESS_H


45 
	~<¥o˚ss.h
>

49 #i‡(
deföed
(
NETWARE
Ë&& deföed(
__NOVELL_LIBC__
))

50 #unde‡
ö_addr_t


51 
	#ö_addr_t
 

	)

54 #ifde‡
HAVE_GETADDRINFO


55 
	#RESOLVER_ENOMEM
 
EAI_MEMORY


	)

57 
	#RESOLVER_ENOMEM
 
ENOMEM


	)

60 
	~"uæd©a.h
"

61 
	~"£ndf.h
"

62 
	~"ho°ù.h
"

63 
	~"hash.h
"

64 
	~"sh¨e.h
"

65 
	~"°ªº‹.h
"

66 
	~"uæ.h
"

67 
	~"mu…iif.h
"

68 
	~"öë_±⁄.h
"

69 
	~"öë_¡›.h
"

70 
	~"cuæ_thªads.h
"

71 
	~"c⁄√˘.h
"

73 
	#_MPRINTF_REPLACE


	)

74 
	~<cuæ/m¥ötf.h
>

76 
	~"cuæ_mem‹y.h
"

78 
	~"memdebug.h
"

83 #ifde‡
CURLRES_THREADED


90 
	$Cuæ_ªsﬁvî_globÆ_öô
()

92  
CURLE_OK
;

93 
	}
}

100 
	$Cuæ_ªsﬁvî_globÆ_˛ónup
()

102 
	}
}

110 
CURLcode
 
	$Cuæ_ªsﬁvî_öô
(**
ªsﬁvî
)

112 ()
ªsﬁvî
;

113  
CURLE_OK
;

114 
	}
}

122 
	$Cuæ_ªsﬁvî_˛ónup
(*
ªsﬁvî
)

124 ()
ªsﬁvî
;

125 
	}
}

133 
	$Cuæ_ªsﬁvî_duph™dÀ
(**
to
, *
‰om
)

135 ()
to
;

136 ()
‰om
;

137  
CURLE_OK
;

138 
	}
}

140 
de°roy_async_d©a
(
Cuæ_async
 *);

145 
	$Cuæ_ªsﬁvî_ˇn˚l
(
c⁄√˘d©a
 *
c⁄n
)

147 
	`de°roy_async_d©a
(&
c⁄n
->
async
);

148 
	}
}

151 
boﬁ
 
öô_ªsﬁve_thªad
(
c⁄√˘d©a
 *
c⁄n
,

152 c⁄° *
ho°«me
, 
p‹t
,

153 c⁄° 
addröfo
 *
höts
);

157 
	sthªad_sync_d©a
 {

158 
cuæ_muãx_t
 * 
	mmtx
;

159 
	md⁄e
;

161 * 
	mho°«me
;

163 
	mp‹t
;

164 
	msock_îr‹
;

165 
Cuæ_addröfo
 *
	mªs
;

166 #ifde‡
HAVE_GETADDRINFO


167 
addröfo
 
	mhöts
;

171 
	sthªad_d©a
 {

172 
cuæ_thªad_t
 
	mthªad_hnd
;

173 
	mpﬁl_öãrvÆ
;

174 
	möãrvÆ_íd
;

175 
thªad_sync_d©a
 
	mtsd
;

178 
thªad_sync_d©a
 *
	$c⁄n_thªad_sync_d©a
(
c⁄√˘d©a
 *
c⁄n
)

180  &(((
thªad_d©a
 *)
c⁄n
->
async
.
os_•ecific
)->
tsd
);

181 
	}
}

183 
	#CONN_THREAD_SYNC_DATA
(
c⁄n
Ë&(((c⁄n)->
async
.
os_•ecific
)->
tsd
);

	)

187 
	$de°roy_thªad_sync_d©a
(
thªad_sync_d©a
 * 
tsd
)

189 if(
tsd
->
mtx
) {

190 
	`Cuæ_muãx_de°roy
(
tsd
->
mtx
);

191 
	`‰ì
(
tsd
->
mtx
);

194 if(
tsd
->
ho°«me
)

195 
	`‰ì
(
tsd
->
ho°«me
);

197 if(
tsd
->
ªs
)

198 
	`Cuæ_‰ìaddröfo
(
tsd
->
ªs
);

200 
	`mem£t
(
tsd
,0,(*tsd));

201 
	}
}

205 
	$öô_thªad_sync_d©a
(
thªad_sync_d©a
 * 
tsd
,

206 c⁄° * 
ho°«me
,

207 
p‹t
,

208 c⁄° 
addröfo
 *
höts
)

210 
	`mem£t
(
tsd
, 0, (*tsd));

212 
tsd
->
p‹t
 =Öort;

213 #ifde‡
HAVE_GETADDRINFO


214 
	`DEBUGASSERT
(
höts
);

215 
tsd
->
höts
 = *hints;

217 (Ë
höts
;

220 
tsd
->
mtx
 = 
	`mÆloc
((
cuæ_muãx_t
));

221 if(
tsd
->
mtx
 =
NULL
)

222 
îr_exô
;

224 
	`Cuæ_muãx_öô
(
tsd
->
mtx
);

226 
tsd
->
sock_îr‹
 = 
CURL_ASYNC_SUCCESS
;

231 
tsd
->
ho°«me
 = 
	`°rdup
(hostname);

232 if(!
tsd
->
ho°«me
)

233 
îr_exô
;

237 
îr_exô
:

239 
	`de°roy_thªad_sync_d©a
(
tsd
);

241 
	}
}

243 
	$gëaddröfo_com∂ëe
(
c⁄√˘d©a
 *
c⁄n
)

245 
thªad_sync_d©a
 *
tsd
 = 
	`c⁄n_thªad_sync_d©a
(
c⁄n
);

246 
rc
;

248 
rc
 = 
	`Cuæ_addröfo_ˇŒback
(
c⁄n
, 
tsd
->
sock_îr‹
,Åsd->
ªs
);

252 
tsd
->
ªs
 = 
NULL
;

254  
rc
;

255 
	}
}

258 #ifde‡
HAVE_GETADDRINFO


266 
CURL_STDCALL
 
	$gëaddröfo_thªad
 (*
¨g
)

268 
thªad_sync_d©a
 *
tsd
 = (thªad_sync_d©a*)
¨g
;

269 
£rvi˚
[12];

270 
rc
;

272 
	`¢¥ötf
(
£rvi˚
, (£rvi˚), "%d", 
tsd
->
p‹t
);

274 
rc
 = 
	`Cuæ_gëaddröfo_ex
(
tsd
->
ho°«me
, 
£rvi˚
, &tsd->
höts
, &tsd->
ªs
);

276 if(
rc
 != 0) {

277 
tsd
->
sock_îr‹
 = 
SOCKERRNO
?SOCKERRNO:
rc
;

278 if(
tsd
->
sock_îr‹
 == 0)

279 
tsd
->
sock_îr‹
 = 
RESOLVER_ENOMEM
;

282 
	`Cuæ_muãx_acquúe
(
tsd
->
mtx
);

283 
tsd
->
d⁄e
 = 1;

284 
	`Cuæ_muãx_ªÀa£
(
tsd
->
mtx
);

287 
	}
}

294 
CURL_STDCALL
 
	$gëho°by«me_thªad
 (*
¨g
)

296 
thªad_sync_d©a
 *
tsd
 = (thªad_sync_d©®*)
¨g
;

298 
tsd
->
ªs
 = 
	`Cuæ_ùv4_ªsﬁve_r
—sd->
ho°«me
,Åsd->
p‹t
);

300 if(!
tsd
->
ªs
) {

301 
tsd
->
sock_îr‹
 = 
SOCKERRNO
;

302 if(
tsd
->
sock_îr‹
 == 0)

303 
tsd
->
sock_îr‹
 = 
RESOLVER_ENOMEM
;

306 
	`Cuæ_muãx_acquúe
(
tsd
->
mtx
);

307 
tsd
->
d⁄e
 = 1;

308 
	`Cuæ_muãx_ªÀa£
(
tsd
->
mtx
);

311 
	}
}

318 
	$de°roy_async_d©a
 (
Cuæ_async
 *
async
)

320 if(
async
->
ho°«me
)

321 
	`‰ì
(
async
->
ho°«me
);

323 if(
async
->
os_•ecific
) {

324 
thªad_d©a
 *
td
 = (thªad_d©a*Ë
async
->
os_•ecific
;

326 if(
td
->
thªad_hnd
 !
cuæ_thªad_t_nuŒ
)

327 
	`Cuæ_thªad_joö
(&
td
->
thªad_hnd
);

329 
	`de°roy_thªad_sync_d©a
(&
td
->
tsd
);

331 
	`‰ì
(
async
->
os_•ecific
);

333 
async
->
ho°«me
 = 
NULL
;

334 
async
->
os_•ecific
 = 
NULL
;

335 
	}
}

343 
boﬁ
 
	$öô_ªsﬁve_thªad
 (
c⁄√˘d©a
 *
c⁄n
,

344 c⁄° *
ho°«me
, 
p‹t
,

345 c⁄° 
addröfo
 *
höts
)

347 
thªad_d©a
 *
td
 = 
	`ˇŒoc
(1, (thread_data));

348 
îr
 = 
RESOLVER_ENOMEM
;

350 
c⁄n
->
async
.
os_•ecific
 = (*Ë
td
;

351 if(!
td
)

352 
îr_exô
;

354 
c⁄n
->
async
.
p‹t
 =Öort;

355 
c⁄n
->
async
.
d⁄e
 = 
FALSE
;

356 
c⁄n
->
async
.
°©us
 = 0;

357 
c⁄n
->
async
.
dns
 = 
NULL
;

358 
td
->
thªad_hnd
 = 
cuæ_thªad_t_nuŒ
;

360 if(!
	`öô_thªad_sync_d©a
(&
td
->
tsd
, 
ho°«me
, 
p‹t
, 
höts
))

361 
îr_exô
;

363 
	`Cuæ_ß„‰ì
(
c⁄n
->
async
.
ho°«me
);

364 
c⁄n
->
async
.
ho°«me
 = 
	`°rdup
(hostname);

365 if(!
c⁄n
->
async
.
ho°«me
)

366 
îr_exô
;

368 #ifde‡
HAVE_GETADDRINFO


369 
td
->
thªad_hnd
 = 
	`Cuæ_thªad_¸óã
(
gëaddröfo_thªad
, &td->
tsd
);

371 
td
->
thªad_hnd
 = 
	`Cuæ_thªad_¸óã
(
gëho°by«me_thªad
, &td->
tsd
);

374 if(!
td
->
thªad_hnd
) {

375 #i‚de‡
_WIN32_WCE


376 
îr
 = 
î∫o
;

378 
îr_exô
;

381  
TRUE
;

383 
îr_exô
:

384 
	`de°roy_async_d©a
(&
c⁄n
->
async
);

386 
	`SET_ERRNO
(
îr
);

388  
FALSE
;

389 
	}
}

396 
CURLcode
 
	$ªsﬁvî_îr‹
(
c⁄√˘d©a
 *
c⁄n
)

398 c⁄° *
ho°_‹_¥oxy
;

399 
CURLcode
 
rc
;

400 if(
c⁄n
->
bôs
.
hâµroxy
) {

401 
ho°_‹_¥oxy
 = "proxy";

402 
rc
 = 
CURLE_COULDNT_RESOLVE_PROXY
;

405 
ho°_‹_¥oxy
 = "host";

406 
rc
 = 
CURLE_COULDNT_RESOLVE_HOST
;

409 
	`Áûf
(
c⁄n
->
d©a
, "CouldÇŸÑesﬁvê%s: %s", 
ho°_‹_¥oxy
,

410 
c⁄n
->
async
.
ho°«me
);

411  
rc
;

412 
	}
}

424 
CURLcode
 
	$Cuæ_ªsﬁvî_waô_ªsﬁv
(
c⁄√˘d©a
 *
c⁄n
,

425 
Cuæ_dns_íåy
 **
íåy
)

427 
thªad_d©a
 *
td
 = (thªad_d©a*Ë
c⁄n
->
async
.
os_•ecific
;

428 
CURLcode
 
rc
 = 
CURLE_OK
;

430 
	`DEBUGASSERT
(
c⁄n
 && 
td
);

433 if(
	`Cuæ_thªad_joö
(&
td
->
thªad_hnd
))

434 
rc
 = 
	`gëaddröfo_com∂ëe
(
c⁄n
);

436 
	`DEBUGASSERT
(0);

438 
c⁄n
->
async
.
d⁄e
 = 
TRUE
;

440 if(
íåy
)

441 *
íåy
 = 
c⁄n
->
async
.
dns
;

443 if(!
c⁄n
->
async
.
dns
)

445 
rc
 = 
	`ªsﬁvî_îr‹
(
c⁄n
);

447 
	`de°roy_async_d©a
(&
c⁄n
->
async
);

449 if(!
c⁄n
->
async
.
dns
)

450 
	`c⁄n˛o£
(
c⁄n
, "asynchÑesolve failed");

452  (
rc
);

453 
	}
}

460 
CURLcode
 
	$Cuæ_ªsﬁvî_is_ªsﬁved
(
c⁄√˘d©a
 *
c⁄n
,

461 
Cuæ_dns_íåy
 **
íåy
)

463 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

464 
thªad_d©a
 *
td
 = (thªad_d©a*Ë
c⁄n
->
async
.
os_•ecific
;

465 
d⁄e
 = 0;

467 *
íåy
 = 
NULL
;

469 if(!
td
) {

470 
	`DEBUGASSERT
(
td
);

471  
CURLE_COULDNT_RESOLVE_HOST
;

474 
	`Cuæ_muãx_acquúe
(
td
->
tsd
.
mtx
);

475 
d⁄e
 = 
td
->
tsd
.done;

476 
	`Cuæ_muãx_ªÀa£
(
td
->
tsd
.
mtx
);

478 if(
d⁄e
) {

479 
	`gëaddröfo_com∂ëe
(
c⁄n
);

481 if(!
c⁄n
->
async
.
dns
) {

482 
CURLcode
 
rc
 = 
	`ªsﬁvî_îr‹
(
c⁄n
);

483 
	`de°roy_async_d©a
(&
c⁄n
->
async
);

484  
rc
;

486 
	`de°roy_async_d©a
(&
c⁄n
->
async
);

487 *
íåy
 = 
c⁄n
->
async
.
dns
;

491 
ñ≠£d
 = 
	`Cuæ_tvdiff
(
	`Cuæ_tvnow
(), 
d©a
->
¥ogªss
.
t_°¨tsögÀ
);

492 if(
ñ≠£d
 < 0)

493 
ñ≠£d
 = 0;

495 if(
td
->
pﬁl_öãrvÆ
 == 0)

497 
td
->
pﬁl_öãrvÆ
 = 1;

498 if(
ñ≠£d
 >
td
->
öãrvÆ_íd
)

500 
td
->
pﬁl_öãrvÆ
 *= 2;

502 if(
td
->
pﬁl_öãrvÆ
 > 250)

503 
td
->
pﬁl_öãrvÆ
 = 250;

505 
td
->
öãrvÆ_íd
 = 
ñ≠£d
 +Åd->
pﬁl_öãrvÆ
;

506 
	`Cuæ_expúe
(
c⁄n
->
d©a
, 
td
->
pﬁl_öãrvÆ
);

509  
CURLE_OK
;

510 
	}
}

512 
	$Cuæ_ªsﬁvî_gësock
(
c⁄√˘d©a
 *
c⁄n
,

513 
cuæ_sockë_t
 *
socks
,

514 
numsocks
)

516 ()
c⁄n
;

517 ()
socks
;

518 ()
numsocks
;

520 
	}
}

522 #i‚de‡
HAVE_GETADDRINFO


526 
Cuæ_addröfo
 *
	$Cuæ_ªsﬁvî_gëaddröfo
(
c⁄√˘d©a
 *
c⁄n
,

527 c⁄° *
ho°«me
,

528 
p‹t
,

529 *
waôp
)

531 
ö_addr
 
ö
;

533 *
waôp
 = 0;

535 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
ho°«me
, &
ö
) > 0)

537  
	`Cuæ_ù2addr
(
AF_INET
, &
ö
, 
ho°«me
, 
p‹t
);

540 if(
	`öô_ªsﬁve_thªad
(
c⁄n
, 
ho°«me
, 
p‹t
, 
NULL
)) {

541 *
waôp
 = 1;

542  
NULL
;

546  
	`Cuæ_ùv4_ªsﬁve_r
(
ho°«me
, 
p‹t
);

547 
	}
}

554 
Cuæ_addröfo
 *
	$Cuæ_ªsﬁvî_gëaddröfo
(
c⁄√˘d©a
 *
c⁄n
,

555 c⁄° *
ho°«me
,

556 
p‹t
,

557 *
waôp
)

559 
addröfo
 
höts
;

560 
ö_addr
 
ö
;

561 
Cuæ_addröfo
 *
ªs
;

562 
îr‹
;

563 
sbuf
[12];

564 
pf
 = 
PF_INET
;

565 #ifde‡
CURLRES_IPV6


566 
ö6_addr
 
ö6
;

569 *
waôp
 = 0;

572 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
ho°«me
, &
ö
) > 0)

574  
	`Cuæ_ù2addr
(
AF_INET
, &
ö
, 
ho°«me
, 
p‹t
);

576 #ifde‡
CURLRES_IPV6


578 if(
	`Cuæ_öë_±⁄
 (
AF_INET6
, 
ho°«me
, &
ö6
) > 0)

580  
	`Cuæ_ù2addr
(
AF_INET6
, &
ö6
, 
ho°«me
, 
p‹t
);

585 
c⁄n
->
ù_vîsi⁄
) {

586 
CURL_IPRESOLVE_V4
:

587 
pf
 = 
PF_INET
;

589 
CURL_IPRESOLVE_V6
:

590 
pf
 = 
PF_INET6
;

593 
pf
 = 
PF_UNSPEC
;

597 if((
pf
 !
PF_INET
Ë&& !
	`Cuæ_ùv6w‹ks
())

599 
pf
 = 
PF_INET
;

603 
	`mem£t
(&
höts
, 0, (hints));

604 
höts
.
ai_Ámûy
 = 
pf
;

605 
höts
.
ai_sockty≥
 = 
c⁄n
->
sockty≥
;

607 
	`¢¥ötf
(
sbuf
, (sbuf), "%d", 
p‹t
);

610 if(
	`öô_ªsﬁve_thªad
(
c⁄n
, 
ho°«me
, 
p‹t
, &
höts
)) {

611 *
waôp
 = 1;

612  
NULL
;

616 
	`öfof
(
c⁄n
->
d©a
, "init_resolve_thread() failed for %s; %s\n",

617 
ho°«me
, 
	`Cuæ_°ªº‹
(
c⁄n
, 
ERRNO
));

619 
îr‹
 = 
	`Cuæ_gëaddröfo_ex
(
ho°«me
, 
sbuf
, &
höts
, &
ªs
);

620 if(
îr‹
) {

621 
	`öfof
(
c⁄n
->
d©a
, "getaddrinfo() failed for %s:%d; %s\n",

622 
ho°«me
, 
p‹t
, 
	`Cuæ_°ªº‹
(
c⁄n
, 
SOCKERRNO
));

623  
NULL
;

625  
ªs
;

626 
	}
}

630 
CURLcode
 
	$Cuæ_£t_dns_£rvîs
(
Sessi⁄H™dÀ
 *
d©a
,

631 *
£rvîs
)

633 ()
d©a
;

634 ()
£rvîs
;

635  
CURLE_NOT_BUILT_IN
;

637 
	}
}

639 
CURLcode
 
	$Cuæ_£t_dns_öãrÁ˚
(
Sessi⁄H™dÀ
 *
d©a
,

640 c⁄° *
öãrf
)

642 ()
d©a
;

643 ()
öãrf
;

644  
CURLE_NOT_BUILT_IN
;

645 
	}
}

647 
CURLcode
 
	$Cuæ_£t_dns_loˇl_ù4
(
Sessi⁄H™dÀ
 *
d©a
,

648 c⁄° *
loˇl_ù4
)

650 ()
d©a
;

651 ()
loˇl_ù4
;

652  
CURLE_NOT_BUILT_IN
;

653 
	}
}

655 
CURLcode
 
	$Cuæ_£t_dns_loˇl_ù6
(
Sessi⁄H™dÀ
 *
d©a
,

656 c⁄° *
loˇl_ù6
)

658 ()
d©a
;

659 ()
loˇl_ù6
;

660  
CURLE_NOT_BUILT_IN
;

661 
	}
}

	@lib/asyn.h

1 #i‚de‡
HEADER_CURL_ASYN_H


2 
	#HEADER_CURL_ASYN_H


	)

25 
	~"cuæ_£tup.h
"

26 
	~"cuæ_addröfo.h
"

28 
	gaddröfo
;

29 
	gho°ít
;

30 
	gSessi⁄H™dÀ
;

31 
	gc⁄√˘d©a
;

32 
	gCuæ_dns_íåy
;

47 
Cuæ_ªsﬁvî_globÆ_öô
();

53 
Cuæ_ªsﬁvî_globÆ_˛ónup
();

63 
CURLcode
 
Cuæ_ªsﬁvî_öô
(**
ªsﬁvî
);

72 
Cuæ_ªsﬁvî_˛ónup
(*
ªsﬁvî
);

82 
Cuæ_ªsﬁvî_duph™dÀ
(**
to
, *
‰om
);

91 
Cuæ_ªsﬁvî_ˇn˚l
(
c⁄√˘d©a
 *
c⁄n
);

101 
Cuæ_ªsﬁvî_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
sock
,

102 
numsocks
);

113 
CURLcode
 
Cuæ_ªsﬁvî_is_ªsﬁved
(
c⁄√˘d©a
 *
c⁄n
,

114 
Cuæ_dns_íåy
 **
dns
);

128 
CURLcode
 
Cuæ_ªsﬁvî_waô_ªsﬁv
(
c⁄√˘d©a
 *
c⁄n
,

129 
Cuæ_dns_íåy
 **
dn£¡ry
);

142 
Cuæ_addröfo
 *
Cuæ_ªsﬁvî_gëaddröfo
(
c⁄√˘d©a
 *
c⁄n
,

143 c⁄° *
ho°«me
,

144 
p‹t
,

145 *
waôp
);

147 #i‚de‡
CURLRES_ASYNCH


149 
	#Cuæ_ªsﬁvî_ˇn˚l
(
x
Ë
Cuæ_n›_°mt


	)

150 
	#Cuæ_ªsﬁvî_is_ªsﬁved
(
x
,
y
Ë
CURLE_COULDNT_RESOLVE_HOST


	)

151 
	#Cuæ_ªsﬁvî_waô_ªsﬁv
(
x
,
y
Ë
CURLE_COULDNT_RESOLVE_HOST


	)

152 
	#Cuæ_ªsﬁvî_gësock
(
x
,
y
,
z
Ë0

	)

153 
	#Cuæ_ªsﬁvî_duph™dÀ
(
x
,
y
Ë
CURLE_OK


	)

154 
	#Cuæ_ªsﬁvî_öô
(
x
Ë
CURLE_OK


	)

155 
	#Cuæ_ªsﬁvî_globÆ_öô
(Ë
CURLE_OK


	)

156 
	#Cuæ_ªsﬁvî_globÆ_˛ónup
(Ë
Cuæ_n›_°mt


	)

157 
	#Cuæ_ªsﬁvî_˛ónup
(
x
Ë
Cuæ_n›_°mt


	)

160 #ifde‡
CURLRES_ASYNCH


161 
	#Cuæ_ªsﬁvî_asynch
(Ë1

	)

163 
	#Cuæ_ªsﬁvî_asynch
(Ë0

	)

	@lib/base64.c

25 
	~"cuæ_£tup.h
"

27 
	#_MPRINTF_REPLACE


	)

28 
	~<cuæ/m¥ötf.h
>

30 
	~"uæd©a.h
"

31 
	~"w¨∆ess.h
"

32 
	~"cuæ_ba£64.h
"

33 
	~"cuæ_mem‹y.h
"

34 
	~"n⁄-ascii.h
"

37 
	~"memdebug.h
"

40 c⁄° 
	gèbÀ64
[]=

43 
size_t
 
	$decodeQu™tum
(*
de°
, c⁄° *
§c
)

45 
size_t
 
∑ddög
 = 0;

46 c⁄° *
s
, *
p
;

47 
i
, 
v
, 
x
 = 0;

49 
i
 = 0, 
s
 = 
§c
; i < 4; i++, s++) {

50 
v
 = 0;

52 if(*
s
 == '=') {

53 
x
 = (x << 6);

54 
∑ddög
++;

57 
p
 = 
èbÀ64
;

59 *
p
 && (*∞!*
s
)) {

60 
v
++;

61 
p
++;

64 if(*
p
 =*
s
)

65 
x
 = (x << 6Ë+ 
v
;

71 if(
∑ddög
 < 1)

72 
de°
[2] = 
	`cuæx_u…ouc
(
x
 & 0xFFUL);

74 
x
 >>= 8;

75 if(
∑ddög
 < 2)

76 
de°
[1] = 
	`cuæx_u…ouc
(
x
 & 0xFFUL);

78 
x
 >>= 8;

79 
de°
[0] = 
	`cuæx_u…ouc
(
x
 & 0xFFUL);

81  3 - 
∑ddög
;

82 
	}
}

98 
CURLcode
 
	$Cuæ_ba£64_decode
(c⁄° *
§c
,

99 **
ouçå
, 
size_t
 *
ouéí
)

101 
size_t
 
§˛í
 = 0;

102 
size_t
 
Àngth
 = 0;

103 
size_t
 
∑ddög
 = 0;

104 
size_t
 
i
;

105 
size_t
 
ªsu…
;

106 
size_t
 
numQu™tums
;

107 
size_t
 
øwÀn
 = 0;

108 *
pos
;

109 *
√w°r
;

111 *
ouçå
 = 
NULL
;

112 *
ouéí
 = 0;

113 
§˛í
 = 
	`°æí
(
§c
);

116 if(!
§˛í
 || srclen % 4)

117  
CURLE_BAD_CONTENT_ENCODING
;

120 (
§c
[
Àngth
] != '=') && src[length])

121 
Àngth
++;

124 if(
§c
[
Àngth
] == '=') {

125 
∑ddög
++;

126 if(
§c
[
Àngth
 + 1] == '=')

127 
∑ddög
++;

131 if(
Àngth
 + 
∑ddög
 !
§˛í
)

132  
CURLE_BAD_CONTENT_ENCODING
;

135 
numQu™tums
 = 
§˛í
 / 4;

138 
øwÀn
 = (
numQu™tums
 * 3Ë- 
∑ddög
;

141 
√w°r
 = 
	`mÆloc
(
øwÀn
 + 1);

142 if(!
√w°r
)

143  
CURLE_OUT_OF_MEMORY
;

145 
pos
 = 
√w°r
;

148 
i
 = 0; i < 
numQu™tums
; i++) {

149 
ªsu…
 = 
	`decodeQu™tum
(
pos
, 
§c
);

150 if(!
ªsu…
) {

151 
	`Cuæ_ß„‰ì
(
√w°r
);

153  
CURLE_BAD_CONTENT_ENCODING
;

156 
pos
 +
ªsu…
;

157 
§c
 += 4;

161 *
pos
 = '\0';

164 *
ouçå
 = 
√w°r
;

165 *
ouéí
 = 
øwÀn
;

167  
CURLE_OK
;

168 
	}
}

187 
CURLcode
 
	$Cuæ_ba£64_ícode
(
Sessi⁄H™dÀ
 *
d©a
,

188 c⁄° *
öputbuff
, 
size_t
 
ösize
,

189 **
ouçå
, 
size_t
 *
ouéí
)

191 
CURLcode
 
îr‹
;

192 
ibuf
[3];

193 
obuf
[4];

194 
i
;

195 
öpuç¨ts
;

196 *
ouçut
;

197 *
ba£64d©a
;

198 *
c⁄vbuf
 = 
NULL
;

200 c⁄° *
öd©a
 = 
öputbuff
;

202 *
ouçå
 = 
NULL
;

203 *
ouéí
 = 0;

205 if(0 =
ösize
)

206 
ösize
 = 
	`°æí
(
öd©a
);

208 
ba£64d©a
 = 
ouçut
 = 
	`mÆloc
(
ösize
*4/3+4);

209 if(
NULL
 =
ouçut
)

210  
CURLE_OUT_OF_MEMORY
;

217 
îr‹
 = 
	`Cuæ_c⁄vît_˛⁄e
(
d©a
, 
öd©a
, 
ösize
, &
c⁄vbuf
);

218 if(
îr‹
) {

219 
	`‰ì
(
ouçut
);

220  
îr‹
;

223 if(
c⁄vbuf
)

224 
öd©a
 = (*)
c⁄vbuf
;

226 
ösize
 > 0) {

227 
i
 = 
öpuç¨ts
 = 0; i < 3; i++) {

228 if(
ösize
 > 0) {

229 
öpuç¨ts
++;

230 
ibuf
[
i
] = (Ë*
öd©a
;

231 
öd©a
++;

232 
ösize
--;

235 
ibuf
[
i
] = 0;

238 
obuf
[0] = (Ë((
ibuf
[0] & 0xFC) >> 2);

239 
obuf
[1] = (Ë(((
ibuf
[0] & 0x03) << 4) | \

240 ((
ibuf
[1] & 0xF0) >> 4));

241 
obuf
[2] = (Ë(((
ibuf
[1] & 0x0F) << 2) | \

242 ((
ibuf
[2] & 0xC0) >> 6));

243 
obuf
[3] = (Ë(
ibuf
[2] & 0x3F);

245 
öpuç¨ts
) {

247 
	`¢¥ötf
(
ouçut
, 5, "%c%c==",

248 
èbÀ64
[
obuf
[0]],

249 
èbÀ64
[
obuf
[1]]);

252 
	`¢¥ötf
(
ouçut
, 5, "%c%c%c=",

253 
èbÀ64
[
obuf
[0]],

254 
èbÀ64
[
obuf
[1]],

255 
èbÀ64
[
obuf
[2]]);

258 
	`¢¥ötf
(
ouçut
, 5, "%c%c%c%c",

259 
èbÀ64
[
obuf
[0]],

260 
èbÀ64
[
obuf
[1]],

261 
èbÀ64
[
obuf
[2]],

262 
èbÀ64
[
obuf
[3]] );

265 
ouçut
 += 4;

267 *
ouçut
 = '\0';

268 *
ouçå
 = 
ba£64d©a
;

270 if(
c⁄vbuf
)

271 
	`‰ì
(
c⁄vbuf
);

273 *
ouéí
 = 
	`°æí
(
ba£64d©a
);

275  
CURLE_OK
;

276 
	}
}

	@lib/bundles.c

24 
	~"cuæ_£tup.h
"

26 
	~<cuæ/cuæ.h
>

28 
	~"uæd©a.h
"

29 
	~"uæ.h
"

30 
	~"¥ogªss.h
"

31 
	~"mu…iif.h
"

32 
	~"bundÀs.h
"

33 
	~"£ndf.h
"

34 
	~"øw°r.h
"

36 
	~"cuæ_mem‹y.h
"

38 
	~"memdebug.h
"

40 
	$c⁄n_Œi°_dt‹
(*
u£r
, *
ñemít
)

42 
c⁄√˘d©a
 *
d©a
 = 
ñemít
;

43 ()
u£r
;

45 
d©a
->
bundÀ
 = 
NULL
;

46 
	}
}

48 
CURLcode
 
	$Cuæ_bundÀ_¸óã
(
Sessi⁄H™dÀ
 *
d©a
,

49 
c⁄√˘bundÀ
 **
cb_±r
)

51 ()
d©a
;

52 
	`DEBUGASSERT
(*
cb_±r
 =
NULL
);

53 *
cb_±r
 = 
	`mÆloc
((
c⁄√˘bundÀ
));

54 if(!*
cb_±r
)

55  
CURLE_OUT_OF_MEMORY
;

57 (*
cb_±r
)->
num_c⁄√˘i⁄s
 = 0;

58 (*
cb_±r
)->
£rvî_suµ‹ts_pùñöög
 = 
FALSE
;

60 (*
cb_±r
)->
c⁄n_li°
 = 
	`Cuæ_Œi°_Æloc
((
cuæ_Œi°_dt‹
Ë
c⁄n_Œi°_dt‹
);

61 if(!(*
cb_±r
)->
c⁄n_li°
) {

62 
	`Cuæ_ß„‰ì
(*
cb_±r
);

63  
CURLE_OUT_OF_MEMORY
;

65  
CURLE_OK
;

66 
	}
}

68 
	$Cuæ_bundÀ_de°roy
(
c⁄√˘bundÀ
 *
cb_±r
)

70 if(!
cb_±r
)

73 if(
cb_±r
->
c⁄n_li°
) {

74 
	`Cuæ_Œi°_de°roy
(
cb_±r
->
c⁄n_li°
, 
NULL
);

75 
cb_±r
->
c⁄n_li°
 = 
NULL
;

77 
	`Cuæ_ß„‰ì
(
cb_±r
);

78 
	}
}

81 
CURLcode
 
	$Cuæ_bundÀ_add_c⁄n
(
c⁄√˘bundÀ
 *
cb_±r
,

82 
c⁄√˘d©a
 *
c⁄n
)

84 if(!
	`Cuæ_Œi°_ö£π_√xt
(
cb_±r
->
c⁄n_li°
, cb_±r->c⁄n_li°->
èû
, 
c⁄n
))

85  
CURLE_OUT_OF_MEMORY
;

87 
c⁄n
->
bundÀ
 = 
cb_±r
;

89 
cb_±r
->
num_c⁄√˘i⁄s
++;

90  
CURLE_OK
;

91 
	}
}

94 
	$Cuæ_bundÀ_ªmove_c⁄n
(
c⁄√˘bundÀ
 *
cb_±r
,

95 
c⁄√˘d©a
 *
c⁄n
)

97 
cuæ_Œi°_ñemít
 *
cuº
;

99 
cuº
 = 
cb_±r
->
c⁄n_li°
->
hód
;

100 
cuº
) {

101 if(
cuº
->
±r
 =
c⁄n
) {

102 
	`Cuæ_Œi°_ªmove
(
cb_±r
->
c⁄n_li°
, 
cuº
, 
NULL
);

103 
cb_±r
->
num_c⁄√˘i⁄s
--;

104 
c⁄n
->
bundÀ
 = 
NULL
;

107 
cuº
 = cuº->
√xt
;

110 
	}
}

	@lib/bundles.h

1 #i‚de‡
HEADER_CURL_BUNDLES_H


2 
	#HEADER_CURL_BUNDLES_H


	)

25 
	sc⁄√˘bundÀ
 {

26 
boﬁ
 
	m£rvî_suµ‹ts_pùñöög
;

28 
size_t
 
	mnum_c⁄√˘i⁄s
;

29 
cuæ_Œi°
 *
	mc⁄n_li°
;

32 
CURLcode
 
Cuæ_bundÀ_¸óã
(
Sessi⁄H™dÀ
 *
d©a
,

33 
c⁄√˘bundÀ
 **
cb_±r
);

35 
Cuæ_bundÀ_de°roy
(
c⁄√˘bundÀ
 *
cb_±r
);

37 
CURLcode
 
Cuæ_bundÀ_add_c⁄n
(
c⁄√˘bundÀ
 *
cb_±r
,

38 
c⁄√˘d©a
 *
c⁄n
);

40 
Cuæ_bundÀ_ªmove_c⁄n
(
c⁄√˘bundÀ
 *
cb_±r
,

41 
c⁄√˘d©a
 *
c⁄n
);

	@lib/config-amigaos.h

1 #i‚de‡
HEADER_CURL_CONFIG_AMIGAOS_H


2 
	#HEADER_CURL_CONFIG_AMIGAOS_H


	)

29 #ifde‡
__AMIGA__


31 
	#HAVE_ARPA_INET_H
 1

	)

32 
	#HAVE_CLOSESOCKET_CAMEL
 1

	)

33 
	#HAVE_ERRNO_H
 1

	)

34 
	#HAVE_GETHOSTBYADDR
 1

	)

35 
	#HAVE_INET_ADDR
 1

	)

36 
	#HAVE_INTTYPES_H
 1

	)

37 
	#HAVE_IOCTLSOCKET_CAMEL
 1

	)

38 
	#HAVE_IOCTLSOCKET_CAMEL_FIONBIO
 1

	)

39 
	#HAVE_LIBCRYPTO
 1

	)

40 
	#HAVE_LIBSSL
 1

	)

41 
	#HAVE_LIBZ
 1

	)

42 
	#HAVE_LONGLONG
 1

	)

43 
	#HAVE_MALLOC_H
 1

	)

44 
	#HAVE_MEMORY_H
 1

	)

45 
	#HAVE_NETDB_H
 1

	)

46 
	#HAVE_NETINET_IN_H
 1

	)

47 
	#HAVE_NET_IF_H
 1

	)

48 
	#HAVE_OPENSSL_CRYPTO_H
 1

	)

49 
	#HAVE_OPENSSL_ERR_H
 1

	)

50 
	#HAVE_OPENSSL_PEM_H
 1

	)

51 
	#HAVE_OPENSSL_RSA_H
 1

	)

52 
	#HAVE_OPENSSL_SSL_H
 1

	)

53 
	#HAVE_OPENSSL_X509_H
 1

	)

54 
	#HAVE_PERROR
 1

	)

55 
	#HAVE_PWD_H
 1

	)

56 
	#HAVE_RAND_EGD
 1

	)

57 
	#HAVE_RAND_STATUS
 1

	)

58 
	#HAVE_SELECT
 1

	)

59 
	#HAVE_SETJMP_H
 1

	)

60 
	#HAVE_SGTTY_H
 1

	)

61 
	#HAVE_SIGNAL
 1

	)

62 
	#HAVE_SIGNAL_H
 1

	)

63 
	#HAVE_SIG_ATOMIC_T
 1

	)

64 
	#HAVE_SOCKET
 1

	)

65 
	#HAVE_STRCASECMP
 1

	)

66 
	#HAVE_STRDUP
 1

	)

67 
	#HAVE_STRFTIME
 1

	)

68 
	#HAVE_STRICMP
 1

	)

69 
	#HAVE_STRINGS_H
 1

	)

70 
	#HAVE_STRING_H
 1

	)

71 
	#HAVE_STRSTR
 1

	)

72 
	#HAVE_STRUCT_TIMEVAL
 1

	)

73 
	#HAVE_SYS_PARAM_H
 1

	)

74 
	#HAVE_SYS_SOCKET_H
 1

	)

75 
	#HAVE_SYS_SOCKIO_H
 1

	)

76 
	#HAVE_SYS_STAT_H
 1

	)

77 
	#HAVE_SYS_TIME_H
 1

	)

78 
	#HAVE_SYS_TYPES_H
 1

	)

79 
	#HAVE_TIME_H
 1

	)

80 
	#HAVE_UNAME
 1

	)

81 
	#HAVE_UNISTD_H
 1

	)

82 
	#HAVE_UTIME
 1

	)

83 
	#HAVE_UTIME_H
 1

	)

84 
	#HAVE_WRITABLE_ARGV
 1

	)

85 
	#HAVE_ZLIB_H
 1

	)

86 
	#HAVE_SYS_IOCTL_H
 1

	)

88 
	#NEED_MALLOC_H
 1

	)

90 
	#SIZEOF_INT
 4

	)

91 
	#SIZEOF_SHORT
 2

	)

92 
	#SIZEOF_SIZE_T
 4

	)

94 
	#USE_MANUAL
 1

	)

95 
	#USE_OPENSSL
 1

	)

96 
	#USE_SSLEAY
 1

	)

97 
	#CURL_DISABLE_LDAP
 1

	)

99 
	#OS
 "AmigaOS"

	)

101 
	#PACKAGE
 "cuæ"

	)

102 
	#PACKAGE_BUGREPORT
 "cuæ-bug@haxx.£"

	)

103 
	#PACKAGE_NAME
 "cuæ"

	)

104 
	#PACKAGE_STRING
 "cuæ -"

	)

105 
	#PACKAGE_TARNAME
 "cuæ"

	)

106 
	#PACKAGE_VERSION
 "-"

	)

107 
	#CURL_CA_BUNDLE
 "s:cuæ-ˇ-bundÀ.¸t"

	)

109 
	#RETSIGTYPE
 

	)

110 
	#SELECT_TYPE_ARG1
 

	)

111 
	#SELECT_TYPE_ARG234
 (
fd_£t
 *)

	)

112 
	#SELECT_TYPE_ARG5
 (
timevÆ
 *)

	)

114 
	#STDC_HEADERS
 1

	)

115 
	#TIME_WITH_SYS_TIME
 1

	)

117 
	#ö_addr_t
 

	)

119 #i‚de‡
F_OK


120 
	#F_OK
 0

	)

123 #i‚de‡
O_RDONLY


124 
	#O_RDONLY
 0x0000

	)

127 #i‚de‡
LONG_MAX


128 
	#LONG_MAX
 0x7fffffffL

	)

131 #i‚de‡
LONG_MIN


132 
	#LONG_MIN
 (-0x7fffffffL-1)

	)

135 
	#HAVE_GETNAMEINFO
 1

	)

136 
	#GETNAMEINFO_QUAL_ARG1
 c⁄°

	)

137 
	#GETNAMEINFO_TYPE_ARG1
 
sockaddr
 *

	)

138 
	#GETNAMEINFO_TYPE_ARG2
 

	)

139 
	#GETNAMEINFO_TYPE_ARG46
 
size_t


	)

140 
	#GETNAMEINFO_TYPE_ARG7
 

	)

142 
	#HAVE_RECV
 1

	)

143 
	#RECV_TYPE_ARG1
 

	)

144 
	#RECV_TYPE_ARG2
 *

	)

145 
	#RECV_TYPE_ARG3
 

	)

146 
	#RECV_TYPE_ARG4
 

	)

147 
	#RECV_TYPE_RETV
 

	)

149 
	#HAVE_RECVFROM
 1

	)

150 
	#RECVFROM_TYPE_ARG1
 

	)

151 
	#RECVFROM_TYPE_ARG2
 

	)

152 
	#RECVFROM_TYPE_ARG3
 

	)

153 
	#RECVFROM_TYPE_ARG4
 

	)

154 
	#RECVFROM_TYPE_ARG5
 
sockaddr


	)

155 
	#RECVFROM_TYPE_ARG6
 

	)

156 
	#RECVFROM_TYPE_RETV
 

	)

158 
	#HAVE_SEND
 1

	)

159 
	#SEND_TYPE_ARG1
 

	)

160 
	#SEND_QUAL_ARG2
 c⁄°

	)

161 
	#SEND_TYPE_ARG2
 *

	)

162 
	#SEND_TYPE_ARG3
 

	)

163 
	#SEND_TYPE_ARG4
 

	)

164 
	#SEND_TYPE_RETV
 

	)

	@lib/config-dos.h

1 #i‚de‡
HEADER_CURL_CONFIG_DOS_H


2 
	#HEADER_CURL_CONFIG_DOS_H


	)

30 #i‡
deföed
(
DJGPP
)

31 
	#OS
 "MSDOS/djgµ"

	)

32 #ñi‡
deföed
(
__HIGHC__
)

33 
	#OS
 "MSDOS/HighC"

	)

34 #ñi‡
deföed
(
__WATCOMC__
)

35 
	#OS
 "MSDOS/W©com"

	)

37 
	#OS
 "MSDOS/?"

	)

40 
	#PACKAGE
 "cuæ"

	)

42 
	#HAVE_ARPA_INET_H
 1

	)

43 
	#HAVE_ERRNO_H
 1

	)

44 
	#HAVE_FCNTL_H
 1

	)

45 
	#HAVE_GETADDRINFO
 1

	)

46 
	#HAVE_GETNAMEINFO
 1

	)

47 
	#HAVE_GETPROTOBYNAME
 1

	)

48 
	#HAVE_GETTIMEOFDAY
 1

	)

49 
	#HAVE_IO_H
 1

	)

50 
	#HAVE_IOCTL
 1

	)

51 
	#HAVE_IOCTL_FIONBIO
 1

	)

52 
	#HAVE_IOCTLSOCKET
 1

	)

53 
	#HAVE_IOCTLSOCKET_FIONBIO
 1

	)

54 
	#HAVE_LIMITS_H
 1

	)

55 
	#HAVE_LOCALE_H
 1

	)

56 
	#HAVE_LONGLONG
 1

	)

57 
	#HAVE_MEMORY_H
 1

	)

58 
	#HAVE_NETDB_H
 1

	)

59 
	#HAVE_NETINET_IN_H
 1

	)

60 
	#HAVE_NETINET_TCP_H
 1

	)

61 
	#HAVE_NET_IF_H
 1

	)

62 
	#HAVE_PROCESS_H
 1

	)

63 
	#HAVE_RECV
 1

	)

64 
	#HAVE_RECVFROM
 1

	)

65 
	#HAVE_SELECT
 1

	)

66 
	#HAVE_SEND
 1

	)

67 
	#HAVE_SETJMP_H
 1

	)

68 
	#HAVE_SETLOCALE
 1

	)

69 
	#HAVE_SETMODE
 1

	)

70 
	#HAVE_SIGNAL
 1

	)

71 
	#HAVE_SOCKET
 1

	)

72 
	#HAVE_SPNEGO
 1

	)

73 
	#HAVE_STRDUP
 1

	)

74 
	#HAVE_STRICMP
 1

	)

75 
	#HAVE_STRTOLL
 1

	)

76 
	#HAVE_STRUCT_TIMEVAL
 1

	)

77 
	#HAVE_STRUCT_IN6_ADDR
 1

	)

78 
	#HAVE_SYS_IOCTL_H
 1

	)

79 
	#HAVE_SYS_SOCKET_H
 1

	)

80 
	#HAVE_SYS_STAT_H
 1

	)

81 
	#HAVE_SYS_TYPES_H
 1

	)

82 
	#HAVE_TIME_H
 1

	)

83 
	#HAVE_UNISTD_H
 1

	)

85 
	#NEED_MALLOC_H
 1

	)

87 
	#RETSIGTYPE
 

	)

88 
	#SIZEOF_INT
 4

	)

89 
	#SIZEOF_LONG_DOUBLE
 16

	)

90 
	#SIZEOF_SHORT
 2

	)

91 
	#SIZEOF_SIZE_T
 4

	)

92 
	#STDC_HEADERS
 1

	)

93 
	#TIME_WITH_SYS_TIME
 1

	)

97 
	#SEND_TYPE_ARG1
 

	)

98 
	#SEND_QUAL_ARG2
 c⁄°

	)

99 
	#SEND_TYPE_ARG2
 *

	)

100 
	#SEND_TYPE_ARG3
 

	)

101 
	#SEND_TYPE_ARG4
 

	)

102 
	#SEND_TYPE_RETV
 

	)

104 
	#RECV_TYPE_ARG1
 

	)

105 
	#RECV_TYPE_ARG2
 *

	)

106 
	#RECV_TYPE_ARG3
 

	)

107 
	#RECV_TYPE_ARG4
 

	)

108 
	#RECV_TYPE_RETV
 

	)

110 
	#RECVFROM_TYPE_ARG1
 

	)

111 
	#RECVFROM_TYPE_ARG2
 

	)

112 
	#RECVFROM_TYPE_ARG3
 

	)

113 
	#RECVFROM_TYPE_ARG4
 

	)

114 
	#RECVFROM_TYPE_ARG5
 
sockaddr


	)

115 
	#RECVFROM_TYPE_ARG6
 

	)

116 
	#RECVFROM_TYPE_RETV
 

	)

117 
	#RECVFROM_TYPE_ARG2_IS_VOID
 1

	)

119 
	#GETNAMEINFO_QUAL_ARG1
 c⁄°

	)

120 
	#GETNAMEINFO_TYPE_ARG1
 
sockaddr
 *

	)

121 
	#GETNAMEINFO_TYPE_ARG2
 

	)

122 
	#GETNAMEINFO_TYPE_ARG46
 

	)

123 
	#GETNAMEINFO_TYPE_ARG7
 

	)

125 
	#BSD


	)

131 #ifde‡
USE_ZLIB


132 
	#HAVE_ZLIB_H
 1

	)

133 
	#HAVE_LIBZ
 1

	)

137 #ifde‡
USE_SSLEAY


138 
	#HAVE_CRYPTO_CLEANUP_ALL_EX_DATA
 1

	)

139 
	#HAVE_OPENSSL_ENGINE_H
 1

	)

140 
	#OPENSSL_NO_KRB5
 1

	)

141 
	#USE_OPENSSL
 1

	)

145 
	#CURL_DISABLE_LDAP
 1

	)

147 
	#ö_addr_t
 
u_l⁄g


	)

149 #i‡
deföed
(
__HIGHC__
) || \

150 (
deföed
(
__GNUC__
Ë&& (
	g__GNUC__
 < 4))

151 
	#ssize_t
 

	)

154 
	#CURL_CA_BUNDLE
 
	`gëív
("CURL_CA_BUNDLE")

	)

158 #i‡
deföed
(
DJGPP
)

159 
	#HAVE_BASENAME
 1

	)

160 
	#HAVE_STRCASECMP
 1

	)

161 
	#HAVE_SIGACTION
 1

	)

162 
	#HAVE_SIGSETJMP
 1

	)

163 
	#HAVE_SYS_TIME_H
 1

	)

164 
	#HAVE_TERMIOS_H
 1

	)

165 
	#HAVE_VARIADIC_MACROS_GCC
 1

	)

168 #i‡(
DJGPP_MINOR
 < 4)

169 
	#_MPRINTF_REPLACE


	)

172 #ñi‡
deföed
(
__WATCOMC__
)

173 
	#HAVE_STRCASECMP
 1

	)

175 #ñi‡
deföed
(
__HIGHC__
)

176 
	#HAVE_SYS_TIME_H
 1

	)

177 
	#°ªº‹
(
e
Ë
	`°ªº‹_s_
(”))

	)

180 #ifde‡
MSDOS


181 
	#HAVE_CLOSE_S
 1

	)

184 #unde‡
w‹d


185 #unde‡
byã


	@lib/config-mac.h

1 #i‚de‡
HEADER_CURL_CONFIG_MAC_H


2 
	#HEADER_CURL_CONFIG_MAC_H


	)

31 
	#OS
 "mac"

	)

34 
	#USE_MANUAL
 1

	)

36 
	#HAVE_ERRNO_H
 1

	)

37 
	#HAVE_NETINET_IN_H
 1

	)

38 
	#HAVE_SYS_SOCKET_H
 1

	)

39 
	#HAVE_SYS_SELECT_H
 1

	)

40 
	#HAVE_NETDB_H
 1

	)

41 
	#HAVE_ARPA_INET_H
 1

	)

42 
	#HAVE_UNISTD_H
 1

	)

43 
	#HAVE_NET_IF_H
 1

	)

44 
	#HAVE_SYS_TYPES_H
 1

	)

45 
	#HAVE_GETTIMEOFDAY
 1

	)

46 
	#HAVE_FCNTL_H
 1

	)

47 
	#HAVE_SYS_STAT_H
 1

	)

48 
	#HAVE_ALLOCA_H
 1

	)

49 
	#HAVE_STDLIB_H
 1

	)

50 
	#HAVE_TIME_H
 1

	)

51 
	#HAVE_UTIME_H
 1

	)

52 
	#HAVE_SYS_TIME_H
 1

	)

53 
	#HAVE_SYS_UTIME_H
 1

	)

55 
	#TIME_WITH_SYS_TIME
 1

	)

57 
	#HAVE_ALARM
 1

	)

58 
	#HAVE_FTRUNCATE
 1

	)

59 
	#HAVE_UTIME
 1

	)

60 
	#HAVE_SETVBUF
 1

	)

61 
	#HAVE_STRFTIME
 1

	)

62 
	#HAVE_INET_ADDR
 1

	)

63 
	#HAVE_MEMCPY
 1

	)

64 
	#HAVE_SELECT
 1

	)

65 
	#HAVE_SOCKET
 1

	)

66 
	#HAVE_STRUCT_TIMEVAL
 1

	)

68 
	#HAVE_SIGACTION
 1

	)

69 
	#HAVE_SIGNAL_H
 1

	)

70 
	#HAVE_SIG_ATOMIC_T
 1

	)

72 #ifde‡
MACOS_SSL_SUPPORT


73 
	#USE_SSLEAY
 1

	)

74 
	#USE_OPENSSL
 1

	)

77 
	#CURL_DISABLE_LDAP
 1

	)

79 
	#HAVE_RAND_STATUS
 1

	)

80 
	#HAVE_RAND_EGD
 1

	)

82 
	#HAVE_IOCTL
 1

	)

83 
	#HAVE_IOCTL_FIONBIO
 1

	)

85 
	#RETSIGTYPE
 

	)

87 
	#SIZEOF_INT
 4

	)

88 
	#SIZEOF_SHORT
 2

	)

89 
	#SIZEOF_SIZE_T
 4

	)

91 
	#HAVE_GETNAMEINFO
 1

	)

92 
	#GETNAMEINFO_QUAL_ARG1
 c⁄°

	)

93 
	#GETNAMEINFO_TYPE_ARG1
 
sockaddr
 *

	)

94 
	#GETNAMEINFO_TYPE_ARG2
 
sockÀn_t


	)

95 
	#GETNAMEINFO_TYPE_ARG46
 
size_t


	)

96 
	#GETNAMEINFO_TYPE_ARG7
 

	)

98 
	#HAVE_RECV
 1

	)

99 
	#RECV_TYPE_ARG1
 

	)

100 
	#RECV_TYPE_ARG2
 *

	)

101 
	#RECV_TYPE_ARG3
 
size_t


	)

102 
	#RECV_TYPE_ARG4
 

	)

103 
	#RECV_TYPE_RETV
 
ssize_t


	)

105 
	#HAVE_RECVFROM
 1

	)

106 
	#RECVFROM_TYPE_ARG1
 

	)

107 
	#RECVFROM_TYPE_ARG2
 

	)

108 
	#RECVFROM_TYPE_ARG3
 
size_t


	)

109 
	#RECVFROM_TYPE_ARG4
 

	)

110 
	#RECVFROM_TYPE_ARG5
 
sockaddr


	)

111 
	#RECVFROM_TYPE_ARG6
 

	)

112 
	#RECVFROM_TYPE_RETV
 
ssize_t


	)

113 
	#RECVFROM_TYPE_ARG2_IS_VOID
 1

	)

115 
	#HAVE_SEND
 1

	)

116 
	#SEND_TYPE_ARG1
 

	)

117 
	#SEND_QUAL_ARG2
 c⁄°

	)

118 
	#SEND_TYPE_ARG2
 *

	)

119 
	#SEND_TYPE_ARG3
 
size_T


	)

120 
	#SEND_TYPE_ARG4
 

	)

121 
	#SEND_TYPE_RETV
 
ssize_t


	)

123 
	#HAVE_EXTRA_STRICMP_H
 1

	)

124 
	#HAVE_EXTRA_STRDUP_H
 1

	)

	@lib/config-os400.h

1 #i‚de‡
HEADER_CURL_CONFIG_OS400_H


2 
	#HEADER_CURL_CONFIG_OS400_H


	)

31 #unde‡
PACKAGE


34 #unde‡
VERSION


37 #unde‡
HAVE_GETPASS


40 
	#OS
 "OS/400"

	)

43 
	#HAVE_GETHOSTBYADDR_R_5


	)

46 #unde‡
HAVE_GETHOSTBYADDR_R_7


49 #unde‡
HAVE_GETHOSTBYADDR_R_8


57 #unde‡
HAVE_GETHOSTBYNAME_R


58 #unde‡
HAVE_GETHOSTBYNAME_R_3


59 #unde‡
HAVE_GETHOSTBYNAME_R_5


60 #unde‡
HAVE_GETHOSTBYNAME_R_6


61 
	#HAVE_GETADDRINFO


	)

62 
	#HAVE_GETADDRINFO_THREADSAFE


	)

65 #unde‡
NEED_REENTRANT


68 #unde‡
HAVE_KRB4


71 
	#ENABLE_IPV6


	)

74 
	#HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID
 1

	)

77 #unde‡
ssize_t


80 #unde‡
RANDOM_FILE


83 #unde‡
EGD_SOCKET


86 
	#HAVE_ALARM
 1

	)

89 #unde‡
HAVE_ALLOCA_H


92 
	#HAVE_ARPA_INET_H


	)

95 #unde‡
HAVE_CLOSESOCKET


98 #unde‡
HAVE_CRYPTO_H


101 #unde‡
HAVE_DES_H


104 
	#HAVE_ERRNO_H


	)

107 #unde‡
HAVE_ERR_H


110 
	#HAVE_FCNTL_H


	)

113 
	#HAVE_GETEUID


	)

116 
	#HAVE_GETHOSTBYADDR


	)

119 
	#HAVE_GETHOSTBYADDR_R


	)

122 
	#HAVE_GETHOSTNAME


	)

125 #unde‡
HAVE_GETOPT_H


128 #unde‡
HAVE_GETPASS_R


131 
	#HAVE_GETPWUID


	)

134 
	#HAVE_GETSERVBYNAME


	)

137 
	#HAVE_GETTIMEOFDAY


	)

140 
	#HAVE_STRUCT_TIMEVAL


	)

143 
	#HAVE_INET_ADDR


	)

146 
	#HAVE_INTTYPES_H


	)

149 #unde‡
HAVE_IO_H


152 #unde‡
HAVE_KRB_GET_OUR_IP_FOR_REALM


155 #unde‡
HAVE_KRB_H


158 #unde‡
HAVE_LIBCRYPTO


161 #unde‡
HAVE_LIBNSL


164 #unde‡
HAVE_LIBRESOLV


167 #unde‡
HAVE_LIBRESOLVE


170 #unde‡
HAVE_LIBSOCKET


173 #unde‡
HAVE_LIBSSL


176 
	#HAVE_GSSAPI


	)

179 #unde‡
HAVE_LIBUCB


182 
	#HAVE_LOCALTIME_R


	)

185 
	#HAVE_MALLOC_H


	)

191 #unde‡
HAVE_MEMORY_H


194 
	#HAVE_NETDB_H


	)

197 #unde‡
HAVE_NETINET_IF_ETHER_H


200 
	#HAVE_NETINET_IN_H


	)

203 
	#HAVE_NET_IF_H


	)

206 #unde‡
HAVE_OPENSSL_CRYPTO_H


209 #unde‡
HAVE_OPENSSL_ERR_H


212 #unde‡
HAVE_OPENSSL_PEM_H


215 #unde‡
HAVE_OPENSSL_RSA_H


218 #unde‡
HAVE_OPENSSL_SSL_H


221 #unde‡
HAVE_OPENSSL_X509_H


224 #unde‡
HAVE_PEM_H


227 
	#HAVE_PERROR


	)

230 
	#HAVE_PWD_H


	)

233 #unde‡
HAVE_RAND_EGD


236 #unde‡
HAVE_RAND_SCREEN


239 #unde‡
HAVE_RAND_STATUS


242 #unde‡
HAVE_RSA_H


245 
	#HAVE_SELECT


	)

248 
	#HAVE_SETVBUF


	)

251 #unde‡
HAVE_SGTTY_H


254 
	#HAVE_SIGACTION


	)

257 #unde‡
HAVE_SIGNAL


260 
	#HAVE_SIGNAL_H


	)

263 
	#HAVE_SIG_ATOMIC_T


	)

266 #unde‡
HAVE_SIG_ATOMIC_T_VOLATILE


269 
	#HAVE_SOCKET


	)

272 #unde‡
HAVE_SSL_H


275 #unde‡
HAVE_STDINT_H


278 
	#HAVE_STDLIB_H


	)

283 
	#__˝lu•lus__°rögs__


	)

286 #unde‡
HAVE_STRCASECMP


289 
	#HAVE_STRCMPI


	)

292 
	#HAVE_STRICMP


	)

295 
	#HAVE_STRDUP


	)

299 
	#HAVE_STRFTIME


	)

302 
	#HAVE_STRINGS_H


	)

305 
	#HAVE_STRING_H


	)

308 #unde‡
HAVE_STRLCPY


311 #unde‡
HAVE_STROPTS_H


314 
	#HAVE_STRSTR


	)

317 
	#HAVE_STRTOK_R


	)

320 #unde‡
HAVE_STRTOLL


323 
	#HAVE_SYS_PARAM_H


	)

326 #unde‡
HAVE_SYS_SELECT_H


329 
	#HAVE_SYS_SOCKET_H


	)

332 #unde‡
HAVE_SYS_SOCKIO_H


335 
	#HAVE_SYS_STAT_H


	)

338 
	#HAVE_SYS_TIME_H


	)

341 
	#HAVE_SYS_TYPES_H


	)

344 
	#HAVE_SYS_UN_H


	)

347 
	#HAVE_SYS_IOCTL_H


	)

350 #unde‡
HAVE_TCGETATTR


353 #unde‡
HAVE_TCSETATTR


356 #unde‡
HAVE_TERMIOS_H


359 #unde‡
HAVE_TERMIO_H


362 
	#HAVE_TIME_H


	)

365 #unde‡
HAVE_UNAME


368 
	#HAVE_UNISTD_H


	)

371 #unde‡
HAVE_WINSOCK_H


374 #unde‡
HAVE_X509_H


377 #unde‡
PACKAGE


380 
	#RETSIGTYPE
 

	)

383 
	#SIZEOF_INT
 4

	)

386 
	#SIZEOF_LONG_DOUBLE
 8

	)

389 
	#HAVE_LONGLONG


	)

392 
	#SIZEOF_LONG_LONG
 8

	)

395 
	#SIZEOF_SHORT
 2

	)

398 
	#SIZEOF_SIZE_T
 8

	)

402 
	#HAVE_LL


	)

405 
	#HAVE_STRUCT_SOCKADDR_STORAGE


	)

408 
	#STDC_HEADERS


	)

411 
	#TIME_WITH_SYS_TIME


	)

414 #unde‡
VERSION


417 #unde‡
_FILE_OFFSET_BITS


420 
	#_LARGE_FILES


	)

426 
	#ö_addr_t
 

	)

429 #unde‡
size_t


432 
	#HAVE_IOCTL


	)

435 
	#HAVE_IOCTL_FIONBIO


	)

438 
	#HAVE_IOCTL_SIOCGIFADDR


	)

441 #unde‡
CURL_DISABLE_LDAP


444 
	#CURL_EXTERN_SYMBOL


	)

451 
	#HAVE_GETNAMEINFO


	)

454 
	#GETNAMEINFO_QUAL_ARG1
 c⁄°

	)

457 
	#GETNAMEINFO_TYPE_ARG1
 
sockaddr
 *

	)

460 
	#GETNAMEINFO_TYPE_ARG2
 
sockÀn_t


	)

463 
	#GETNAMEINFO_TYPE_ARG46
 
sockÀn_t


	)

466 
	#GETNAMEINFO_TYPE_ARG7
 

	)

469 
	#HAVE_RECV


	)

472 
	#RECV_TYPE_ARG1
 

	)

475 
	#RECV_TYPE_ARG2
 *

	)

478 
	#RECV_TYPE_ARG3
 

	)

481 
	#RECV_TYPE_ARG4
 

	)

484 
	#RECV_TYPE_RETV
 

	)

487 
	#HAVE_RECVFROM


	)

490 
	#RECVFROM_TYPE_ARG1
 

	)

493 
	#RECVFROM_TYPE_ARG2
 

	)

496 
	#RECVFROM_TYPE_ARG3
 

	)

499 
	#RECVFROM_TYPE_ARG4
 

	)

502 
	#RECVFROM_TYPE_ARG5
 
sockaddr


	)

505 
	#RECVFROM_TYPE_ARG6
 

	)

508 
	#RECVFROM_TYPE_RETV
 

	)

511 
	#HAVE_SEND


	)

514 
	#SEND_TYPE_ARG1
 

	)

517 
	#SEND_QUAL_ARG2


	)

520 
	#SEND_TYPE_ARG2
 *

	)

523 
	#SEND_TYPE_ARG3
 

	)

526 
	#SEND_TYPE_ARG4
 

	)

529 
	#SEND_TYPE_RETV
 

	)

532 #unde‡
USE_QSOSSL


535 
	#USE_GSKIT


	)

538 
	#CURL_CA_BUNDLE
 "/QIBM/U£rD©a/ICSS/Cît/Sîvî/DEFAULT.KDB"

	)

546 
	#__±r128


	)

547 
	#qadπ_u£_Âutc_ölöe


	)

548 
	#qadπ_u£_‰ód_ölöe


	)

549 
	#qadπ_u£_fwrôe_ölöe


	)

	@lib/config-riscos.h

1 #i‚de‡
HEADER_CURL_CONFIG_RISCOS_H


2 
	#HEADER_CURL_CONFIG_RISCOS_H


	)

30 #unde‡
PACKAGE


33 #unde‡
VERSION


36 #unde‡
HAVE_GETPASS


39 
	#OS
 "ARM-RISC OS"

	)

42 
	#USE_MANUAL


	)

45 #unde‡
HAVE_GETHOSTBYADDR_R_5


48 #unde‡
HAVE_GETHOSTBYADDR_R_7


51 #unde‡
HAVE_GETHOSTBYADDR_R_8


54 #unde‡
HAVE_GETHOSTBYNAME_R_3


57 #unde‡
HAVE_GETHOSTBYNAME_R_5


60 #unde‡
HAVE_GETHOSTBYNAME_R_6


63 #unde‡
NEED_REENTRANT


66 #unde‡
HAVE_KRB4


69 #unde‡
ENABLE_IPV6


72 
	#HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID
 1

	)

75 #unde‡
ssize_t


78 #unde‡
RANDOM_FILE


81 #unde‡
EGD_SOCKET


84 #unde‡
ENABLE_IPV6


87 
	#HAVE_ALARM


	)

90 
	#HAVE_ALLOCA_H


	)

93 
	#HAVE_ARPA_INET_H


	)

96 #unde‡
HAVE_CLOSESOCKET


99 #unde‡
HAVE_CRYPTO_H


102 #unde‡
HAVE_DES_H


105 
	#HAVE_ERRNO_H


	)

108 #unde‡
HAVE_ERR_H


111 
	#HAVE_FCNTL_H


	)

114 
	#HAVE_FTRUNCATE


	)

117 
	#HAVE_GETADDRINFO


	)

120 #unde‡
HAVE_GETEUID


123 
	#HAVE_GETHOSTBYADDR


	)

126 #unde‡
HAVE_GETHOSTBYADDR_R


129 #unde‡
HAVE_GETHOSTBYNAME_R


132 
	#HAVE_GETHOSTNAME


	)

135 
	#HAVE_GETOPT_H


	)

138 #unde‡
HAVE_GETPASS_R


141 #unde‡
HAVE_GETPWUID


144 #unde‡
HAVE_GETSERVBYNAME


147 
	#HAVE_GETTIMEOFDAY


	)

150 
	#HAVE_STRUCT_TIMEVAL


	)

153 #unde‡
HAVE_INET_ADDR


156 
	#HAVE_INTTYPES_H


	)

159 #unde‡
HAVE_IO_H


162 #unde‡
HAVE_KRB_GET_OUR_IP_FOR_REALM


165 #unde‡
HAVE_KRB_H


168 #unde‡
HAVE_LIBCRYPTO


171 #unde‡
HAVE_LIBNSL


174 #unde‡
HAVE_LIBRESOLV


177 #unde‡
HAVE_LIBRESOLVE


180 #unde‡
HAVE_LIBSOCKET


183 #unde‡
HAVE_LIBSSL


186 #unde‡
HAVE_LIBUCB


189 #unde‡
HAVE_LOCALTIME_R


192 
	#HAVE_MALLOC_H


	)

198 #unde‡
HAVE_MEMORY_H


201 
	#HAVE_NETDB_H


	)

204 #unde‡
HAVE_NETINET_IF_ETHER_H


207 
	#HAVE_NETINET_IN_H


	)

210 
	#HAVE_NET_IF_H


	)

213 #unde‡
HAVE_OPENSSL_CRYPTO_H


216 #unde‡
HAVE_OPENSSL_ERR_H


219 #unde‡
HAVE_OPENSSL_PEM_H


222 #unde‡
HAVE_OPENSSL_RSA_H


225 #unde‡
HAVE_OPENSSL_SSL_H


228 #unde‡
HAVE_OPENSSL_X509_H


231 #unde‡
HAVE_PEM_H


234 #unde‡
HAVE_PERROR


237 #unde‡
HAVE_PWD_H


240 #unde‡
HAVE_RAND_EGD


243 #unde‡
HAVE_RAND_SCREEN


246 #unde‡
HAVE_RAND_STATUS


249 #unde‡
HAVE_RSA_H


252 
	#HAVE_SELECT


	)

255 #unde‡
HAVE_SETVBUF


258 
	#HAVE_SGTTY_H


	)

261 #unde‡
HAVE_SIGACTION


264 
	#HAVE_SIGNAL


	)

267 
	#HAVE_SIGNAL_H


	)

270 
	#HAVE_SIG_ATOMIC_T


	)

273 #unde‡
HAVE_SIG_ATOMIC_T_VOLATILE


276 
	#HAVE_SOCKET


	)

279 #unde‡
HAVE_SSL_H


282 #unde‡
HAVE_STDINT_H


285 
	#HAVE_STDLIB_H


	)

288 #unde‡
HAVE_STRCASECMP


291 #unde‡
HAVE_STRCMPI


294 
	#HAVE_STRDUP


	)

297 
	#HAVE_STRFTIME


	)

300 
	#HAVE_STRICMP


	)

303 #unde‡
HAVE_STRINGS_H


306 
	#HAVE_STRING_H


	)

309 #unde‡
HAVE_STRLCPY


312 
	#HAVE_STRSTR


	)

315 #unde‡
HAVE_STRTOK_R


318 #unde‡
HAVE_STRTOLL


321 #unde‡
HAVE_SYS_PARAM_H


324 #unde‡
HAVE_SYS_SELECT_H


327 
	#HAVE_SYS_SOCKET_H


	)

330 #unde‡
HAVE_SYS_SOCKIO_H


333 #unde‡
HAVE_SYS_STAT_H


336 
	#HAVE_SYS_TIME_H


	)

339 
	#HAVE_SYS_TYPES_H


	)

342 
	#HAVE_TCGETATTR


	)

345 
	#HAVE_TCSETATTR


	)

348 
	#HAVE_TERMIOS_H


	)

351 #unde‡
HAVE_TERMIO_H


354 #unde‡
HAVE_TIME_H


357 
	#HAVE_UNAME


	)

360 
	#HAVE_UNISTD_H


	)

363 #unde‡
HAVE_WINSOCK_H


366 #unde‡
HAVE_X509_H


369 #unde‡
PACKAGE


372 
	#RETSIGTYPE
 

	)

375 
	#SIZEOF_INT
 4

	)

378 #unde‡
SIZEOF_LONG_DOUBLE


381 #unde‡
SIZEOF_LONG_LONG


384 
	#SIZEOF_SHORT
 2

	)

387 
	#SIZEOF_SIZE_T
 4

	)

390 #unde‡
STDC_HEADERS


393 #unde‡
TIME_WITH_SYS_TIME


396 #unde‡
VERSION


401 #i‚de‡
_ALL_SOURCE


402 #unde‡
_ALL_SOURCE


406 #unde‡
_FILE_OFFSET_BITS


409 #unde‡
_LARGE_FILES


415 #unde‡
size_t


418 #unde‡
ssize_t


421 
	#HAVE_IOCTL


	)

424 
	#HAVE_IOCTL_FIONBIO


	)

427 
	#CURL_DISABLE_LDAP


	)

430 
	#HAVE_GETNAMEINFO
 1

	)

433 
	#GETNAMEINFO_QUAL_ARG1
 c⁄°

	)

436 
	#GETNAMEINFO_TYPE_ARG1
 
sockaddr
 *

	)

439 
	#GETNAMEINFO_TYPE_ARG2
 
sockÀn_t


	)

442 
	#GETNAMEINFO_TYPE_ARG46
 
size_t


	)

445 
	#GETNAMEINFO_TYPE_ARG7
 

	)

448 
	#HAVE_RECV
 1

	)

451 
	#RECV_TYPE_ARG1
 

	)

454 
	#RECV_TYPE_ARG2
 *

	)

457 
	#RECV_TYPE_ARG3
 
size_t


	)

460 
	#RECV_TYPE_ARG4
 

	)

463 
	#RECV_TYPE_RETV
 
ssize_t


	)

466 
	#HAVE_RECVFROM
 1

	)

469 
	#RECVFROM_TYPE_ARG1
 

	)

472 
	#RECVFROM_TYPE_ARG2
 

	)

475 
	#RECVFROM_TYPE_ARG2_IS_VOID


	)

478 
	#RECVFROM_TYPE_ARG3
 
size_t


	)

481 
	#RECVFROM_TYPE_ARG4
 

	)

484 
	#RECVFROM_TYPE_ARG5
 
sockaddr


	)

487 
	#RECVFROM_TYPE_ARG6
 

	)

490 
	#RECVFROM_TYPE_RETV
 
ssize_t


	)

493 
	#HAVE_SEND
 1

	)

496 
	#SEND_TYPE_ARG1
 

	)

499 
	#SEND_QUAL_ARG2
 c⁄°

	)

502 
	#SEND_TYPE_ARG2
 *

	)

505 
	#SEND_TYPE_ARG3
 
size_t


	)

508 
	#SEND_TYPE_ARG4
 

	)

511 
	#SEND_TYPE_RETV
 
ssize_t


	)

	@lib/config-symbian.h

1 #i‚de‡
HEADER_CURL_CONFIG_SYMBIAN_H


2 
	#HEADER_CURL_CONFIG_SYMBIAN_H


	)

54 
	#CURL_DISABLE_LDAP
 1

	)

57 
	#CURL_DISABLE_LDAPS
 1

	)

78 
	#ENABLE_IPV6
 1

	)

81 
	#HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID
 1

	)

84 
	#GETNAMEINFO_QUAL_ARG1
 c⁄°

	)

87 
	#GETNAMEINFO_TYPE_ARG1
 
sockaddr
 *

	)

90 
	#GETNAMEINFO_TYPE_ARG2
 
sockÀn_t


	)

93 
	#GETNAMEINFO_TYPE_ARG46
 
size_t


	)

96 
	#GETNAMEINFO_TYPE_ARG7
 

	)

102 
	#HAVE_ARPA_INET_H
 1

	)

108 
	#HAVE_ASSERT_H
 1

	)

129 
	#HAVE_DLFCN_H
 1

	)

135 
	#HAVE_ERRNO_H
 1

	)

138 
	#HAVE_ERR_H
 1

	)

141 
	#HAVE_FCNTL_H
 1

	)

144 
	#HAVE_FCNTL
 1

	)

147 
	#HAVE_FCNTL_O_NONBLOCK
 1

	)

153 
	#HAVE_FTRUNCATE
 1

	)

156 
	#HAVE_GETADDRINFO
 1

	)

159 
	#HAVE_GETEUID
 1

	)

162 
	#HAVE_GETHOSTBYADDR
 1

	)

165 
	#HAVE_GETHOSTBYNAME
 1

	)

180 
	#HAVE_GETNAMEINFO
 1

	)

186 
	#HAVE_GETPPID
 1

	)

189 
	#HAVE_GETPROTOBYNAME
 1

	)

192 
	#HAVE_GETPWUID
 1

	)

198 
	#HAVE_GETTIMEOFDAY
 1

	)

204 
	#HAVE_GMTIME_R
 1

	)

246 
	#HAVE_INTTYPES_H
 1

	)

249 
	#HAVE_IOCTL
 1

	)

252 
	#HAVE_IOCTL_FIONBIO
 1

	)

321 
	#HAVE_LIMITS_H
 1

	)

324 
	#HAVE_LL
 1

	)

327 
	#HAVE_LOCALE_H
 1

	)

330 
	#HAVE_LOCALTIME_R
 1

	)

333 
	#HAVE_LONGLONG
 1

	)

339 
	#HAVE_MEMORY_H
 1

	)

345 
	#HAVE_NETDB_H
 1

	)

348 
	#HAVE_NETINET_IN_H
 1

	)

354 
	#HAVE_NET_IF_H
 1

	)

394 
	#HAVE_PERROR
 1

	)

397 
	#HAVE_PIPE
 1

	)

409 
	#HAVE_POSIX_STRERROR_R
 1

	)

412 
	#HAVE_PWD_H
 1

	)

415 
	#HAVE_RAND_EGD
 1

	)

424 
	#HAVE_RECV
 1

	)

427 
	#HAVE_RECVFROM
 1

	)

433 
	#HAVE_SELECT
 1

	)

436 
	#HAVE_SEND
 1

	)

439 
	#HAVE_SETJMP_H
 1

	)

442 
	#HAVE_SETLOCALE
 1

	)

469 
	#HAVE_SIGNAL_H
 1

	)

481 
	#HAVE_SOCKET
 1

	)

493 
	#HAVE_STDBOOL_H
 1

	)

496 
	#HAVE_STDINT_H
 1

	)

499 
	#HAVE_STDIO_H
 1

	)

502 
	#HAVE_STDLIB_H
 1

	)

505 
	#HAVE_STRCASECMP
 1

	)

511 
	#HAVE_STRDUP
 1

	)

514 
	#HAVE_STRERROR_R
 1

	)

520 
	#HAVE_STRINGS_H
 1

	)

523 
	#HAVE_STRING_H
 1

	)

526 
	#HAVE_STRLCPY
 1

	)

529 
	#HAVE_STRSTR
 1

	)

532 
	#HAVE_STRTOK_R
 1

	)

535 
	#HAVE_STRTOLL
 1

	)

538 
	#HAVE_STRUCT_SOCKADDR_STORAGE
 1

	)

541 
	#HAVE_STRUCT_TIMEVAL
 1

	)

544 
	#HAVE_SYS_FILIO_H
 1

	)

547 
	#HAVE_SYS_IOCTL_H
 1

	)

550 
	#HAVE_SYS_PARAM_H
 1

	)

556 
	#HAVE_SYS_RESOURCE_H
 1

	)

559 
	#HAVE_SYS_SELECT_H
 1

	)

562 
	#HAVE_SYS_SOCKET_H
 1

	)

565 
	#HAVE_SYS_SOCKIO_H
 1

	)

568 
	#HAVE_SYS_STAT_H
 1

	)

571 
	#HAVE_SYS_TIME_H
 1

	)

574 
	#HAVE_SYS_TYPES_H
 1

	)

586 
	#HAVE_TIME_H
 1

	)

595 
	#HAVE_UNAME
 1

	)

598 
	#HAVE_UNISTD_H
 1

	)

601 
	#HAVE_UTIME
 1

	)

604 
	#HAVE_UTIME_H
 1

	)

607 
	#HAVE_VARIADIC_MACROS_C99
 1

	)

649 #ifde‡
__WINS__


650 
	#OS
 "i386-pc-ïoc32"

	)

651 #ñi‡
__MARM__


652 
	#OS
 "¨m-unknown-ïoc32"

	)

655 
	#OS
 "unknown-unknown-ïoc32"

	)

679 
	#RECV_TYPE_ARG1
 

	)

680 
	#RECV_TYPE_ARG2
 *

	)

681 
	#RECV_TYPE_ARG3
 
size_t


	)

682 
	#RECV_TYPE_ARG4
 

	)

683 
	#RECV_TYPE_RETV
 
ssize_t


	)

685 
	#RECVFROM_TYPE_ARG1
 

	)

686 
	#RECVFROM_TYPE_ARG2
 

	)

687 
	#RECVFROM_TYPE_ARG3
 
size_t


	)

688 
	#RECVFROM_TYPE_ARG4
 

	)

689 
	#RECVFROM_TYPE_ARG5
 
sockaddr


	)

690 
	#RECVFROM_TYPE_ARG6
 
size_t


	)

691 
	#RECVFROM_TYPE_RETV
 
ssize_t


	)

692 
	#RECVFROM_TYPE_ARG2_IS_VOID
 1

	)

694 
	#SEND_TYPE_ARG1
 

	)

695 
	#SEND_QUAL_ARG2
 c⁄°

	)

696 
	#SEND_TYPE_ARG2
 *

	)

697 
	#SEND_TYPE_ARG3
 
size_t


	)

698 
	#SEND_TYPE_ARG4
 

	)

699 
	#SEND_TYPE_RETV
 
ssize_t


	)

706 
	#SELECT_TYPE_ARG1
 

	)

709 
	#SELECT_TYPE_ARG234
 (
fd_£t
 *)

	)

712 
	#SELECT_TYPE_ARG5
 (
timevÆ
 *)

	)

715 
	#SIZEOF_INT
 4

	)

718 
	#SIZEOF_OFF_T
 8

	)

721 
	#SIZEOF_SHORT
 2

	)

724 
	#SIZEOF_SIZE_T
 4

	)

727 
	#SIZEOF_TIME_T
 4

	)

730 
	#STDC_HEADERS
 1

	)

733 
	#TIME_WITH_SYS_TIME
 1

	)

768 #i‚de‡
_ALL_SOURCE


773 
	#_FILE_OFFSET_BITS
 64

	)

786 #i‚de‡
__˝lu•lus


798 #ifde‡
_DEBUG


803 #i‚de‡
__LONG_LONG_SUPPORTED


804 
	#__LONG_LONG_SUPPORTED


	)

808 #ifde‡
HAVE_LIBZ


809 
	#HAVE_ZLIB_H
 1

	)

813 #ifde‡
USE_SSLEAY


815 
	#USE_OPENSSL


	)

	@lib/config-tpf.h

1 #i‚de‡
HEADER_CURL_CONFIG_TPF_H


2 
	#HEADER_CURL_CONFIG_TPF_H


	)

93 
	#HAVE_ALARM
 1

	)

96 
	#HAVE_ARPA_INET_H
 1

	)

102 
	#HAVE_ASSERT_H
 1

	)

105 
	#HAVE_BASENAME
 1

	)

112 
	#HAVE_CRYPTO_CLEANUP_ALL_EX_DATA
 1

	)

116 
	#HAVE_CRYPTO_H
 1

	)

120 
	#HAVE_DES_H
 1

	)

124 
	#HAVE_ENGINE_LOAD_BUILTIN_ENGINES
 1

	)

127 
	#HAVE_ERRNO_H
 1

	)

131 
	#HAVE_ERR_H
 1

	)

134 
	#HAVE_FCNTL_H
 1

	)

137 
	#HAVE_FCNTL
 1

	)

140 
	#HAVE_FCNTL_O_NONBLOCK
 1

	)

144 
	#HAVE_FORK
 1

	)

147 
	#HAVE_FTRUNCATE
 1

	)

153 
	#HAVE_GETEUID
 1

	)

156 
	#HAVE_GETHOSTBYADDR
 1

	)

159 
	#HAVE_GETHOSTBYNAME
 1

	)

183 
	#HAVE_GETPWUID
 1

	)

189 
	#HAVE_GETTIMEOFDAY
 1

	)

193 
	#HAVE_GLIBC_STRERROR_R
 1

	)

196 
	#HAVE_GMTIME_R
 1

	)

211 
	#HAVE_ICONV
 1

	)

223 
	#HAVE_INET_ADDR
 1

	)

232 
	#HAVE_INTTYPES_H
 1

	)

235 
	#HAVE_IOCTL
 1

	)

238 
	#HAVE_IOCTL_FIONBIO
 1

	)

281 
	#HAVE_LIBSSL
 1

	)

287 
	#HAVE_LIMITS_H
 1

	)

290 
	#HAVE_LL
 1

	)

293 
	#HAVE_LOCALE_H
 1

	)

296 
	#HAVE_LOCALTIME_R
 1

	)

299 
	#HAVE_LONGLONG
 1

	)

305 
	#HAVE_MEMORY_H
 1

	)

308 
	#HAVE_NETDB_H
 1

	)

311 
	#HAVE_NETINET_IN_H
 1

	)

317 
	#HAVE_NET_IF_H
 1

	)

327 
	#HAVE_OPENSSL_CRYPTO_H
 1

	)

331 
	#HAVE_OPENSSL_ENGINE_H
 1

	)

335 
	#HAVE_OPENSSL_ERR_H
 1

	)

339 
	#HAVE_OPENSSL_PEM_H
 1

	)

343 
	#HAVE_OPENSSL_PKCS12_H
 1

	)

347 
	#HAVE_OPENSSL_RSA_H
 1

	)

351 
	#HAVE_OPENSSL_SSL_H
 1

	)

355 
	#HAVE_OPENSSL_X509_H
 1

	)

359 
	#HAVE_PEM_H
 1

	)

362 
	#HAVE_PERROR
 1

	)

365 
	#HAVE_PIPE
 1

	)

377 
	#HAVE_PWD_H
 1

	)

381 
	#HAVE_RAND_EGD
 1

	)

388 
	#HAVE_RAND_STATUS
 1

	)

392 
	#HAVE_RSA_H
 1

	)

395 
	#HAVE_SELECT
 1

	)

398 
	#HAVE_SETJMP_H
 1

	)

401 
	#HAVE_SETLOCALE
 1

	)

404 
	#HAVE_SETRLIMIT
 1

	)

416 
	#HAVE_SIGACTION
 1

	)

422 
	#HAVE_SIGNAL
 1

	)

425 
	#HAVE_SIGNAL_H
 1

	)

428 
	#HAVE_SIG_ATOMIC_T
 1

	)

437 
	#HAVE_SOCKET
 1

	)

444 
	#HAVE_SSL_H
 1

	)

447 
	#HAVE_STDINT_H
 1

	)

450 
	#HAVE_STDLIB_H
 1

	)

453 
	#HAVE_STRCASECMP
 1

	)

459 
	#HAVE_STRDUP
 1

	)

462 
	#HAVE_STRERROR_R
 1

	)

466 
	#HAVE_STRICMP
 1

	)

469 
	#HAVE_STRINGS_H
 1

	)

472 
	#HAVE_STRING_H
 1

	)

478 
	#HAVE_STRSTR
 1

	)

481 
	#HAVE_STRTOK_R
 1

	)

484 
	#HAVE_STRTOLL
 1

	)

490 
	#HAVE_STRUCT_TIMEVAL
 1

	)

493 
	#HAVE_SYS_FILIO_H
 1

	)

496 
	#HAVE_SYS_IOCTL_H
 1

	)

499 
	#HAVE_SYS_PARAM_H
 1

	)

505 
	#HAVE_SYS_RESOURCE_H
 1

	)

508 
	#HAVE_SYS_SELECT_H
 1

	)

511 
	#HAVE_SYS_SOCKET_H
 1

	)

515 
	#HAVE_SYS_SOCKIO_H
 1

	)

518 
	#HAVE_SYS_STAT_H
 1

	)

521 
	#HAVE_SYS_TIME_H
 1

	)

524 
	#HAVE_SYS_TYPES_H
 1

	)

536 
	#HAVE_TIME_H
 1

	)

545 
	#HAVE_UNISTD_H
 1

	)

548 
	#HAVE_UTIME
 1

	)

551 
	#HAVE_UTIME_H
 1

	)

578 
	#OS
 "s390x-ibm-çf"

	)

581 
	#PACKAGE
 "cuæ"

	)

584 
	#PACKAGE_BUGREPORT
 "®suôabÀ cuæ maûögÜi° => hâp://cuæ.haxx.£/maû/"

	)

587 
	#PACKAGE_NAME
 "cuæ"

	)

590 
	#PACKAGE_STRING
 "cuæ -"

	)

593 
	#PACKAGE_TARNAME
 "cuæ"

	)

596 
	#PACKAGE_VERSION
 "-"

	)

602 
	#RETSIGTYPE
 

	)

605 
	#SELECT_TYPE_ARG1
 

	)

608 
	#SELECT_TYPE_ARG234
 (
fd_£t
 *)

	)

611 
	#SELECT_TYPE_ARG5
 (
timevÆ
 *)

	)

614 
	#SIZEOF_INT
 4

	)

617 
	#SIZEOF_OFF_T
 8

	)

620 
	#SIZEOF_SHORT
 2

	)

623 
	#SIZEOF_SIZE_T
 8

	)

626 
	#SIZEOF_TIME_T
 8

	)

629 
	#STDC_HEADERS
 1

	)

632 
	#TIME_WITH_SYS_TIME
 1

	)

656 
	#VERSION
 "nŸ-u£d"

	)

664 #i‚de‡
_ALL_SOURCE


705 
	#HAVE_RECV
 1

	)

708 
	#RECV_TYPE_ARG1
 

	)

711 
	#RECV_TYPE_ARG2
 *

	)

714 
	#RECV_TYPE_ARG3
 

	)

717 
	#RECV_TYPE_ARG4
 

	)

720 
	#RECV_TYPE_RETV
 

	)

723 
	#HAVE_RECVFROM
 1

	)

726 
	#RECVFROM_TYPE_ARG1
 

	)

729 
	#RECVFROM_TYPE_ARG2
 

	)

732 
	#RECVFROM_TYPE_ARG3
 

	)

735 
	#RECVFROM_TYPE_ARG4
 

	)

738 
	#RECVFROM_TYPE_ARG5
 
sockaddr


	)

741 
	#RECVFROM_TYPE_ARG6
 

	)

744 
	#RECVFROM_TYPE_RETV
 

	)

747 
	#HAVE_SEND
 1

	)

750 
	#SEND_TYPE_ARG1
 

	)

753 
	#SEND_QUAL_ARG2
 c⁄°

	)

756 
	#SEND_TYPE_ARG2
 *

	)

759 
	#SEND_TYPE_ARG3
 

	)

762 
	#SEND_TYPE_ARG4
 

	)

765 
	#SEND_TYPE_RETV
 

	)

767 
	#CURL_DOES_CONVERSIONS


	)

768 #i‚de‡
CURL_ICONV_CODESET_OF_HOST


769 
	#CURL_ICONV_CODESET_OF_HOST
 "IBM-1047"

	)

	@lib/config-vxworks.h

1 #i‚de‡
HEADER_CURL_CONFIG_VXWORKS_H


2 
	#HEADER_CURL_CONFIG_VXWORKS_H


	)

48 
	#CURL_DISABLE_FTP
 1

	)

54 
	#CURL_DISABLE_LDAP
 1

	)

57 
	#CURL_DISABLE_LDAPS
 1

	)

60 
	#CURL_DISABLE_NTLM
 1

	)

66 
	#CURL_DISABLE_TELNET
 1

	)

69 
	#CURL_DISABLE_TFTP
 1

	)

84 
	#ENABLE_IPV6
 1

	)

87 
	#GETNAMEINFO_QUAL_ARG1
 c⁄°

	)

90 
	#GETNAMEINFO_TYPE_ARG1
 
sockaddr
 *

	)

93 
	#GETNAMEINFO_TYPE_ARG2
 
sockÀn_t


	)

96 
	#GETNAMEINFO_TYPE_ARG46
 
size_t


	)

99 
	#GETNAMEINFO_TYPE_ARG7
 

	)

102 
	#GETSERVBYPORT_R_ARGS
 6

	)

105 
	#GETSERVBYPORT_R_BUFSIZE
 4096

	)

108 
	#HAVE_ALARM
 1

	)

111 
	#HAVE_ALLOCA_H
 1

	)

114 
	#HAVE_ARPA_INET_H
 1

	)

120 
	#HAVE_ASSERT_H
 1

	)

126 
	#HAVE_BOOL_T
 1

	)

135 
	#HAVE_CRYPTO_CLEANUP_ALL_EX_DATA
 1

	)

144 
	#HAVE_DLFCN_H
 1

	)

147 
	#HAVE_ENGINE_LOAD_BUILTIN_ENGINES
 1

	)

150 
	#HAVE_ERRNO_H
 1

	)

156 
	#HAVE_FCNTL
 1

	)

159 
	#HAVE_FCNTL_H
 1

	)

162 
	#HAVE_FCNTL_O_NONBLOCK
 1

	)

165 
	#HAVE_FDOPEN
 1

	)

168 
	#HAVE_FORK
 1

	)

171 
	#HAVE_FREEADDRINFO
 1

	)

174 
	#HAVE_FREEIFADDRS
 1

	)

177 
	#HAVE_FTRUNCATE
 1

	)

180 
	#HAVE_GETADDRINFO
 1

	)

186 
	#HAVE_GETHOSTBYADDR
 1

	)

189 
	#HAVE_GETHOSTBYADDR_R
 1

	)

198 
	#HAVE_GETHOSTBYADDR_R_8
 1

	)

201 
	#HAVE_GETHOSTBYNAME
 1

	)

216 
	#HAVE_GETHOSTNAME
 1

	)

222 
	#HAVE_GETNAMEINFO
 1

	)

228 
	#HAVE_GETPPID
 1

	)

231 
	#HAVE_GETPROTOBYNAME
 1

	)

237 
	#HAVE_GETRLIMIT
 1

	)

249 
	#HAVE_GMTIME_R
 1

	)

285 
	#HAVE_INET_ADDR
 1

	)

303 
	#HAVE_INTTYPES_H
 1

	)

306 
	#HAVE_IOCTL
 1

	)

322 
	#HAVE_IOCTL_FIONBIO
 1

	)

325 
	#HAVE_IOCTL_SIOCGIFADDR
 1

	)

328 
	#HAVE_IO_H
 1

	)

382 
	#HAVE_LIBSSL
 1

	)

385 
	#HAVE_LIBZ
 1

	)

388 
	#HAVE_LIMITS_H
 1

	)

391 
	#HAVE_LL
 1

	)

394 
	#HAVE_LOCALE_H
 1

	)

397 
	#HAVE_LOCALTIME_R
 1

	)

400 
	#HAVE_LONGLONG
 1

	)

403 
	#HAVE_MALLOC_H
 1

	)

406 
	#HAVE_MEMORY_H
 1

	)

412 
	#HAVE_NETDB_H
 1

	)

415 
	#HAVE_NETINET_IN_H
 1

	)

418 
	#HAVE_NETINET_TCP_H
 1

	)

421 
	#HAVE_NET_IF_H
 1

	)

431 
	#HAVE_OPENSSL_CRYPTO_H
 1

	)

434 
	#HAVE_OPENSSL_ENGINE_H
 1

	)

437 
	#HAVE_OPENSSL_ERR_H
 1

	)

440 
	#HAVE_OPENSSL_PEM_H
 1

	)

443 
	#HAVE_OPENSSL_PKCS12_H
 1

	)

446 
	#HAVE_OPENSSL_RSA_H
 1

	)

449 
	#HAVE_OPENSSL_SSL_H
 1

	)

452 
	#HAVE_OPENSSL_X509_H
 1

	)

458 
	#HAVE_PERROR
 1

	)

461 
	#HAVE_PIPE
 1

	)

479 
	#HAVE_RAND_EGD
 1

	)

485 
	#HAVE_RAND_STATUS
 1

	)

488 
	#HAVE_RECV
 1

	)

491 
	#HAVE_RECVFROM
 1

	)

497 
	#HAVE_SELECT
 1

	)

500 
	#HAVE_SEND
 1

	)

503 
	#HAVE_SETJMP_H
 1

	)

506 
	#HAVE_SETLOCALE
 1

	)

509 
	#HAVE_SETMODE
 1

	)

512 
	#HAVE_SETRLIMIT
 1

	)

515 
	#HAVE_SETSOCKOPT
 1

	)

524 
	#HAVE_SIGACTION
 1

	)

527 
	#HAVE_SIGINTERRUPT
 1

	)

530 
	#HAVE_SIGNAL
 1

	)

533 
	#HAVE_SIGNAL_H
 1

	)

539 
	#HAVE_SIG_ATOMIC_T
 1

	)

545 
	#HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID
 1

	)

548 
	#HAVE_SOCKET
 1

	)

554 
	#HAVE_SSL_GET_SHUTDOWN
 1

	)

560 
	#HAVE_STDBOOL_H
 1

	)

566 
	#HAVE_STDIO_H
 1

	)

569 
	#HAVE_STDLIB_H
 1

	)

572 
	#HAVE_STRCASECMP
 1

	)

578 
	#HAVE_STRDUP
 1

	)

581 
	#HAVE_STRERROR_R
 1

	)

587 
	#HAVE_STRINGS_H
 1

	)

590 
	#HAVE_STRING_H
 1

	)

596 
	#HAVE_STRNCASECMP
 1

	)

608 
	#HAVE_STRSTR
 1

	)

611 
	#HAVE_STRTOK_R
 1

	)

617 
	#HAVE_STRUCT_SOCKADDR_STORAGE
 1

	)

620 
	#HAVE_STRUCT_TIMEVAL
 1

	)

626 
	#HAVE_SYS_IOCTL_H
 1

	)

635 
	#HAVE_SYS_RESOURCE_H
 1

	)

641 
	#HAVE_SYS_SOCKET_H
 1

	)

647 
	#HAVE_SYS_STAT_H
 1

	)

653 
	#HAVE_SYS_TYPES_H
 1

	)

656 
	#HAVE_SYS_UIO_H
 1

	)

659 
	#HAVE_SYS_UN_H
 1

	)

662 
	#HAVE_SYS_UTIME_H
 1

	)

665 
	#HAVE_TERMIOS_H
 1

	)

668 
	#HAVE_TERMIO_H
 1

	)

671 
	#HAVE_TIME_H
 1

	)

680 
	#HAVE_UNAME
 1

	)

683 
	#HAVE_UNISTD_H
 1

	)

686 
	#HAVE_UTIME
 1

	)

689 
	#HAVE_UTIME_H
 1

	)

692 
	#HAVE_VARIADIC_MACROS_C99
 1

	)

695 
	#HAVE_VARIADIC_MACROS_GCC
 1

	)

698 
	#HAVE_VXWORKS_STRERROR_R
 1

	)

716 
	#HAVE_WRITABLE_ARGV
 1

	)

719 
	#HAVE_WRITEV
 1

	)

728 
	#HAVE_ZLIB_H
 1

	)

746 
	#OPEN_NEEDS_ARG3
 1

	)

749 
	#OS
 "unknown-unknown-vxw‹ks"

	)

752 
	#PACKAGE
 "cuæ"

	)

755 
	#RANDOM_FILE
 "/dev/uøndom"

	)

758 
	#RECVFROM_TYPE_ARG1
 

	)

761 
	#RECVFROM_TYPE_ARG2
 

	)

764 
	#RECVFROM_TYPE_ARG2_IS_VOID
 1

	)

767 
	#RECVFROM_TYPE_ARG3
 
size_t


	)

770 
	#RECVFROM_TYPE_ARG4
 

	)

773 
	#RECVFROM_TYPE_ARG5
 
sockaddr


	)

779 
	#RECVFROM_TYPE_ARG6
 
sockÀn_t


	)

785 
	#RECVFROM_TYPE_RETV
 

	)

788 
	#RECV_TYPE_ARG1
 

	)

791 
	#RECV_TYPE_ARG2
 *

	)

794 
	#RECV_TYPE_ARG3
 
size_t


	)

797 
	#RECV_TYPE_ARG4
 

	)

800 
	#RECV_TYPE_RETV
 

	)

803 
	#RETSIGTYPE
 

	)

806 
	#SELECT_QUAL_ARG5


	)

809 
	#SELECT_TYPE_ARG1
 

	)

812 
	#SELECT_TYPE_ARG234
 
fd_£t
 *

	)

815 
	#SELECT_TYPE_ARG5
 
timevÆ
 *

	)

818 
	#SELECT_TYPE_RETV
 

	)

821 
	#SEND_QUAL_ARG2
 c⁄°

	)

824 
	#SEND_TYPE_ARG1
 

	)

827 
	#SEND_TYPE_ARG2
 *

	)

830 
	#SEND_TYPE_ARG3
 
size_t


	)

833 
	#SEND_TYPE_ARG4
 

	)

836 
	#SEND_TYPE_RETV
 

	)

839 
	#SIZEOF_INT
 4

	)

842 
	#SIZEOF_LONG
 4

	)

845 
	#SIZEOF_OFF_T
 8

	)

848 
	#SIZEOF_SHORT
 2

	)

851 
	#SIZEOF_SIZE_T
 4

	)

854 
	#SIZEOF_TIME_T
 4

	)

857 
	#SIZEOF_VOIDP
 4

	)

860 
	#STDC_HEADERS
 1

	)

881 
	#USE_MANUAL
 1

	)

887 
	#USE_OPENSSL
 1

	)

890 
	#USE_SSLEAY
 1

	)

906 #i‚de‡
_ALL_SOURCE


924 #i‚de‡
__˝lu•lus


	@lib/config-win32.h

1 #i‚de‡
HEADER_CURL_CONFIG_WIN32_H


2 
	#HEADER_CURL_CONFIG_WIN32_H


	)

37 
	#HAVE_ASSERT_H
 1

	)

43 
	#HAVE_ERRNO_H
 1

	)

49 
	#HAVE_FCNTL_H
 1

	)

52 #i‡
deföed
(
__MINGW32__
Ë|| deföed(
__POCC__
)

53 
	#HAVE_GETOPT_H
 1

	)

57 #i‡
deföed
(
_MSC_VER
) && (_MSC_VER >= 1800)

58 
	#HAVE_INTTYPES_H
 1

	)

62 
	#HAVE_IO_H
 1

	)

65 
	#HAVE_LIMITS_H
 1

	)

68 
	#HAVE_LOCALE_H
 1

	)

71 #i‡!
deföed
(
__SALFORDC__
Ë&& !deföed(
__POCC__
)

72 
	#NEED_MALLOC_H
 1

	)

82 #i‚de‡
__SALFORDC__


83 
	#HAVE_PROCESS_H
 1

	)

87 
	#HAVE_SIGNAL_H
 1

	)

96 #i‡
deföed
(
_MSC_VER
) && (_MSC_VER >= 1800)

97 
	#HAVE_STDBOOL_H
 1

	)

101 
	#HAVE_STDLIB_H
 1

	)

116 
	#HAVE_SYS_STAT_H
 1

	)

122 
	#HAVE_SYS_TYPES_H
 1

	)

125 #i‚de‡
__BORLANDC__


126 
	#HAVE_SYS_UTIME_H
 1

	)

136 
	#HAVE_TIME_H
 1

	)

139 #i‡
deföed
(
__MINGW32__
Ë|| deföed(
__WATCOMC__
Ë|| deföed(
__LCC__
) || \

140 
	$deföed
(
__POCC__
)

141 
	#HAVE_UNISTD_H
 1

	)

145 
	#HAVE_WINDOWS_H
 1

	)

148 
	#HAVE_WINSOCK_H
 1

	)

151 #i‚de‡
__SALFORDC__


152 
	#HAVE_WINSOCK2_H
 1

	)

156 #i‚de‡
__SALFORDC__


157 
	#HAVE_WS2TCPIP_H
 1

	)

165 
	#HAVE_SIG_ATOMIC_T
 1

	)

168 
	#STDC_HEADERS
 1

	)

174 #i‡
	`deföed
(
_MSC_VER
) && (_MSC_VER >= 1800)

175 
	#HAVE_BOOL_T
 1

	)

183 
	#HAVE_CLOSESOCKET
 1

	)

189 
	#HAVE_FTRUNCATE
 1

	)

192 
	#HAVE_GETHOSTBYADDR
 1

	)

195 
	#HAVE_GETHOSTNAME
 1

	)

201 
	#HAVE_GETSERVBYNAME
 1

	)

204 
	#HAVE_GETPROTOBYNAME


	)

210 
	#HAVE_INET_ADDR
 1

	)

213 
	#HAVE_IOCTLSOCKET
 1

	)

216 
	#HAVE_IOCTLSOCKET_FIONBIO
 1

	)

219 
	#HAVE_PERROR
 1

	)

222 
	#HAVE_RAND_SCREEN
 1

	)

225 
	#HAVE_RAND_STATUS
 1

	)

229 
	#HAVE_CRYPTO_CLEANUP_ALL_EX_DATA
 1

	)

232 
	#HAVE_SELECT
 1

	)

235 
	#HAVE_SETLOCALE
 1

	)

238 
	#HAVE_SETMODE
 1

	)

241 
	#HAVE_SETVBUF
 1

	)

244 
	#HAVE_SOCKET
 1

	)

250 
	#HAVE_STRDUP
 1

	)

253 
	#HAVE_STRFTIME
 1

	)

256 
	#HAVE_STRICMP
 1

	)

262 
	#HAVE_STRNICMP
 1

	)

265 
	#HAVE_STRSTR
 1

	)

268 #i‡
	`deföed
(
__MINGW32__
Ë|| deföed(
__WATCOMC__
Ë|| deföed(
__POCC__
) || \

269 (
	`deföed
(
_MSC_VER
) && (_MSC_VER >= 1800))

270 
	#HAVE_STRTOLL
 1

	)

280 #i‚de‡
__BORLANDC__


281 
	#HAVE_UTIME
 1

	)

285 
	#GETNAMEINFO_QUAL_ARG1
 c⁄°

	)

288 
	#GETNAMEINFO_TYPE_ARG1
 
sockaddr
 *

	)

291 
	#GETNAMEINFO_TYPE_ARG2
 
sockÀn_t


	)

294 
	#GETNAMEINFO_TYPE_ARG46
 
DWORD


	)

297 
	#GETNAMEINFO_TYPE_ARG7
 

	)

300 
	#HAVE_RECV
 1

	)

303 
	#RECV_TYPE_ARG1
 
SOCKET


	)

306 
	#RECV_TYPE_ARG2
 *

	)

309 
	#RECV_TYPE_ARG3
 

	)

312 
	#RECV_TYPE_ARG4
 

	)

315 
	#RECV_TYPE_RETV
 

	)

318 
	#HAVE_RECVFROM
 1

	)

321 
	#RECVFROM_TYPE_ARG1
 
SOCKET


	)

324 
	#RECVFROM_TYPE_ARG2
 

	)

327 
	#RECVFROM_TYPE_ARG3
 

	)

330 
	#RECVFROM_TYPE_ARG4
 

	)

333 
	#RECVFROM_TYPE_ARG5
 
sockaddr


	)

336 
	#RECVFROM_TYPE_ARG6
 

	)

339 
	#RECVFROM_TYPE_RETV
 

	)

342 
	#HAVE_SEND
 1

	)

345 
	#SEND_TYPE_ARG1
 
SOCKET


	)

348 
	#SEND_QUAL_ARG2
 c⁄°

	)

351 
	#SEND_TYPE_ARG2
 *

	)

354 
	#SEND_TYPE_ARG3
 

	)

357 
	#SEND_TYPE_ARG4
 

	)

360 
	#SEND_TYPE_RETV
 

	)

367 
	#ö_addr_t
 

	)

370 
	#RETSIGTYPE
 

	)

373 #i‚de‡
_SSIZE_T_DEFINED


374 #i‡(
	`deföed
(
__WATCOMC__
) && (__WATCOMC__ >= 1240)) || \

375 
	`deföed
(
__POCC__
) || \

376 
	$deföed
(
__MINGW32__
)

377 #ñi‡
	`deföed
(
_WIN64
)

378 
	#_SSIZE_T_DEFINED


	)

379 
	#ssize_t
 
__öt64


	)

381 
	#_SSIZE_T_DEFINED


	)

382 
	#ssize_t
 

	)

391 
	#SIZEOF_INT
 4

	)

394 
	#SIZEOF_LONG_DOUBLE
 16

	)

400 
	#SIZEOF_SHORT
 2

	)

403 #i‡
	`deföed
(
_WIN64
)

404 
	#SIZEOF_SIZE_T
 8

	)

406 
	#SIZEOF_SIZE_T
 4

	)

416 #ifde‡
USE_LWIPSOCK


417 #unde‡
USE_WINSOCK


418 #unde‡
HAVE_WINSOCK_H


419 #unde‡
HAVE_WINSOCK2_H


420 #unde‡
HAVE_WS2TCPIP_H


421 #unde‡
HAVE_ERRNO_H


422 #unde‡
HAVE_GETHOSTNAME


423 #unde‡
HAVE_GETNAMEINFO


424 #unde‡
LWIP_POSIX_SOCKETS_IO_NAMES


425 #unde‡
RECV_TYPE_ARG1


426 #unde‡
RECV_TYPE_ARG3


427 #unde‡
SEND_TYPE_ARG1


428 #unde‡
SEND_TYPE_ARG3


429 
	#HAVE_FREEADDRINFO


	)

430 
	#HAVE_GETADDRINFO


	)

431 
	#HAVE_GETHOSTBYNAME


	)

432 
	#HAVE_GETHOSTBYNAME_R


	)

433 
	#HAVE_GETHOSTBYNAME_R_6


	)

434 
	#LWIP_POSIX_SOCKETS_IO_NAMES
 0

	)

435 
	#RECV_TYPE_ARG1
 

	)

436 
	#RECV_TYPE_ARG3
 
size_t


	)

437 
	#SEND_TYPE_ARG1
 

	)

438 
	#SEND_TYPE_ARG3
 
size_t


	)

445 #ifde‡
USE_WATT32


446 
	~<t˝.h
>

447 #unde‡
byã


448 #unde‡
w‹d


449 #unde‡
USE_WINSOCK


450 #unde‡
HAVE_WINSOCK_H


451 #unde‡
HAVE_WINSOCK2_H


452 #unde‡
HAVE_WS2TCPIP_H


453 
	#HAVE_GETADDRINFO


	)

454 
	#HAVE_GETNAMEINFO


	)

455 
	#HAVE_SYS_IOCTL_H


	)

456 
	#HAVE_SYS_SOCKET_H


	)

457 
	#HAVE_NETINET_IN_H


	)

458 
	#HAVE_NETDB_H


	)

459 
	#HAVE_ARPA_INET_H


	)

460 
	#HAVE_FREEADDRINFO


	)

461 
	#SOCKET
 

	)

479 #i‡
	`deföed
(
_MSC_VER
) && (_MSC_VER >= 1400)

480 
	#HAVE_VARIADIC_MACROS_C99
 1

	)

484 #i‡
	`deföed
(
__MINGW32__
Ë|| deföed(
__WATCOMC__
) || \

485 (
	`deföed
(
_MSC_VER
) && (_MSC_VER >= 1310))

486 
	#HAVE_LONGLONG
 1

	)

490 #i‡
	`deföed
(
_MSC_VER
) && (_MSC_VER >= 1400)

491 
	#_CRT_SECURE_NO_DEPRECATE
 1

	)

492 
	#_CRT_NONSTDC_NO_DEPRECATE
 1

	)

497 #i‡
	`deföed
(
_MSC_VER
) && (_MSC_VER >= 1400)

498 #i‚de‡
_USE_32BIT_TIME_T


499 
	#SIZEOF_TIME_T
 8

	)

501 
	#SIZEOF_TIME_T
 4

	)

511 #i‡
	`deföed
(
_MSC_VER
) && (_MSC_VER >= 1500)

512 
	#VS2008_MIN_TARGET
 0x0500

	)

519 #i‡
	`deföed
(
_MSC_VER
) && (_MSC_VER >= 1500)

520 
	#VS2008_DEF_TARGET
 0x0501

	)

524 #i‡
	`deföed
(
_MSC_VER
) && (_MSC_VER >= 1500)

525 #i‚de‡
_WIN32_WINNT


526 
	#_WIN32_WINNT
 
VS2008_DEF_TARGET


	)

528 #i‚de‡
WINVER


529 
	#WINVER
 
VS2008_DEF_TARGET


	)

531 #i‡(
_WIN32_WINNT
 < 
VS2008_MIN_TARGET
Ë|| (
WINVER
 < VS2008_MIN_TARGET)

532 #îr‹ 
VS2008
 
d€s
 
nŸ
 
suµ‹t
 
Wödows
 
buûd
 
èrgës
 
¥i‹
 
to
 Windows 2000

538 #i‡
	`deföed
(
__POCC__
) && (__POCC__ >= 500)

539 #i‚de‡
_WIN32_WINNT


540 
	#_WIN32_WINNT
 0x0500

	)

542 #i‚de‡
WINVER


543 
	#WINVER
 0x0500

	)

549 #i‡
	`deföed
(
HAVE_WS2TCPIP_H
)

550 #i‡
	`deföed
(
__POCC__
)

551 
	#HAVE_FREEADDRINFO
 1

	)

552 
	#HAVE_GETADDRINFO
 1

	)

553 
	#HAVE_GETADDRINFO_THREADSAFE
 1

	)

554 
	#HAVE_GETNAMEINFO
 1

	)

555 #ñi‡
	`deföed
(
_WIN32_WINNT
) && (_WIN32_WINNT >= 0x0501)

556 
	#HAVE_FREEADDRINFO
 1

	)

557 
	#HAVE_GETADDRINFO
 1

	)

558 
	#HAVE_GETADDRINFO_THREADSAFE
 1

	)

559 
	#HAVE_GETNAMEINFO
 1

	)

560 #ñi‡
	`deföed
(
_MSC_VER
) && (_MSC_VER >= 1200)

561 
	#HAVE_FREEADDRINFO
 1

	)

562 
	#HAVE_GETADDRINFO
 1

	)

563 
	#HAVE_GETADDRINFO_THREADSAFE
 1

	)

564 
	#HAVE_GETNAMEINFO
 1

	)

568 #i‡
	`deföed
(
__POCC__
)

569 #i‚de‡
_MSC_VER


570 #îr‹ 
Mi¸oso·
 
exãnsi⁄s
 /
Ze
 
compûî
 
›ti⁄
 
is
 
ªquúed


572 #i‚de‡
__POCC__OLDNAMES


573 #îr‹ 
Com∑tibûôy
 
«mes
 /
Go
 
compûî
 
›ti⁄
 
is
 
ªquúed


582 #i‡!
	`deföed
(
__SALFORDC__
Ë&& !deföed(
__BORLANDC__
)

583 
	#HAVE_STRUCT_SOCKADDR_STORAGE
 1

	)

587 
	#HAVE_STRUCT_TIMEVAL
 1

	)

590 
	#HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID
 1

	)

592 #i‡
HAVE_WINSOCK2_H
 && 
	`deföed
(
_WIN32_WINNT
) && (_WIN32_WINNT >= 0x0600)

593 
	#HAVE_STRUCT_POLLFD
 1

	)

600 #i‡
	`deföed
(
_MSC_VER
Ë&& !deföed(
_WIN32_WCE
)

601 #i‡(
_MSC_VER
 >900Ë&& (
_INTEGRAL_MAX_BITS
 >= 64)

602 
	#USE_WIN32_LARGE_FILES


	)

604 
	#USE_WIN32_SMALL_FILES


	)

608 #i‡
	`deföed
(
__MINGW32__
Ë&& !deföed(
USE_WIN32_LARGE_FILES
)

609 
	#USE_WIN32_LARGE_FILES


	)

612 #i‡
	`deföed
(
__WATCOMC__
Ë&& !deföed(
USE_WIN32_LARGE_FILES
)

613 
	#USE_WIN32_LARGE_FILES


	)

616 #i‡
	`deföed
(
__POCC__
)

617 #unde‡
USE_WIN32_LARGE_FILES


620 #i‡!
	`deföed
(
USE_WIN32_LARGE_FILES
Ë&& !deföed(
USE_WIN32_SMALL_FILES
)

621 
	#USE_WIN32_SMALL_FILES


	)

636 #i‡!
	`deföed
(
USE_SYNC_DNS
Ë&& !deföed(
USE_ARES
) && \

637 !
	$deföed
(
USE_THREADS_WIN32
)

638 
	#USE_THREADS_WIN32
 1

	)

641 #i‡
	`deföed
(
USE_ARES
Ë&& deföed(
USE_THREADS_WIN32
)

649 #i‡
	`deföed
(
CURL_HAS_NOVELL_LDAPSDK
Ë|| deföed(
CURL_HAS_MOZILLA_LDAPSDK
)

650 #unde‡
CURL_LDAP_WIN


651 
	#HAVE_LDAP_SSL_H
 1

	)

652 
	#HAVE_LDAP_URL_PARSE
 1

	)

653 #ñi‡
	`deföed
(
CURL_HAS_OPENLDAP_LDAPSDK
)

654 #unde‡
CURL_LDAP_WIN


655 
	#HAVE_LDAP_URL_PARSE
 1

	)

657 #unde‡
HAVE_LDAP_URL_PARSE


658 
	#CURL_LDAP_WIN
 1

	)

661 #i‡
	`deföed
(
__WATCOMC__
Ë&& deföed(
CURL_LDAP_WIN
)

662 #i‡
__WATCOMC__
 < 1280

663 
	#WINBERAPI
 
	`__de˛•ec
(
cde˛
)

	)

664 
	#WINLDAPAPI
 
	`__de˛•ec
(
cde˛
)

	)

668 #i‡
	`deföed
(
__POCC__
Ë&& deföed(
CURL_LDAP_WIN
)

669 
	#CURL_DISABLE_LDAP
 1

	)

677 #unde‡
OS


678 #i‡
	`deföed
(
_M_IX86
Ë|| deföed(
__i386__
)

679 
	#OS
 "i386-pc-wö32"

	)

680 #ñi‡
	`deföed
(
_M_X64
Ë|| deföed(
__x86_64__
)

681 
	#OS
 "x86_64-pc-wö32"

	)

682 #ñi‡
	`deföed
(
_M_IA64
)

683 
	#OS
 "ü64-pc-wö32"

	)

685 
	#OS
 "unknown-pc-wö32"

	)

689 
	#PACKAGE
 "cuæ"

	)

692 
	#USE_MANUAL
 1

	)

694 #i‡
	`deföed
(
__POCC__
Ë|| (
USE_IPV6
)

695 
	#ENABLE_IPV6
 1

	)

	@lib/config-win32ce.h

1 #i‚de‡
HEADER_CURL_CONFIG_WIN32CE_H


2 
	#HEADER_CURL_CONFIG_WIN32CE_H


	)

49 
	#HAVE_FCNTL_H
 1

	)

55 
	#HAVE_IO_H
 1

	)

58 
	#HAVE_LIMITS_H
 1

	)

61 
	#NEED_MALLOC_H
 1

	)

70 
	#HAVE_SIGNAL_H
 1

	)

79 
	#HAVE_STDLIB_H
 1

	)

97 
	#HAVE_SYS_STAT_H
 1

	)

106 
	#HAVE_SYS_UTIME_H
 1

	)

115 
	#HAVE_TIME_H
 1

	)

118 #i‡
deföed
(
__MINGW32__
Ë|| deföed(
__WATCOMC__
Ë|| deföed(
__LCC__
)

119 
	#HAVE_UNISTD_H
 1

	)

123 
	#HAVE_WINDOWS_H
 1

	)

126 
	#HAVE_WINSOCK_H
 1

	)

139 
	#HAVE_SIG_ATOMIC_T
 1

	)

142 
	#STDC_HEADERS
 1

	)

152 
	#HAVE_CLOSESOCKET
 1

	)

158 
	#HAVE_GETHOSTBYADDR
 1

	)

161 
	#HAVE_GETHOSTNAME
 1

	)

167 
	#HAVE_GETSERVBYNAME
 1

	)

173 
	#HAVE_INET_ADDR
 1

	)

176 
	#HAVE_IOCTLSOCKET
 1

	)

179 
	#HAVE_IOCTLSOCKET_FIONBIO
 1

	)

182 
	#HAVE_PERROR
 1

	)

185 
	#HAVE_RAND_SCREEN
 1

	)

188 
	#HAVE_RAND_STATUS
 1

	)

191 
	#HAVE_SELECT
 1

	)

194 
	#HAVE_SETVBUF
 1

	)

197 
	#HAVE_SOCKET
 1

	)

218 
	#HAVE_STRSTR
 1

	)

221 #i‡
deföed
(
__MINGW32__
Ë|| deföed(
__WATCOMC__
)

222 
	#HAVE_STRTOLL
 1

	)

232 
	#HAVE_UTIME
 1

	)

235 
	#HAVE_GETNAMEINFO
 1

	)

238 
	#GETNAMEINFO_QUAL_ARG1
 c⁄°

	)

241 
	#GETNAMEINFO_TYPE_ARG1
 
sockaddr
 *

	)

244 
	#GETNAMEINFO_TYPE_ARG2
 
sockÀn_t


	)

247 
	#GETNAMEINFO_TYPE_ARG46
 
DWORD


	)

250 
	#GETNAMEINFO_TYPE_ARG7
 

	)

253 
	#HAVE_RECV
 1

	)

256 
	#RECV_TYPE_ARG1
 
SOCKET


	)

259 
	#RECV_TYPE_ARG2
 *

	)

262 
	#RECV_TYPE_ARG3
 

	)

265 
	#RECV_TYPE_ARG4
 

	)

268 
	#RECV_TYPE_RETV
 

	)

271 
	#HAVE_RECVFROM
 1

	)

274 
	#RECVFROM_TYPE_ARG1
 
SOCKET


	)

277 
	#RECVFROM_TYPE_ARG2
 

	)

280 
	#RECVFROM_TYPE_ARG3
 

	)

283 
	#RECVFROM_TYPE_ARG4
 

	)

286 
	#RECVFROM_TYPE_ARG5
 
sockaddr


	)

289 
	#RECVFROM_TYPE_ARG6
 

	)

292 
	#RECVFROM_TYPE_RETV
 

	)

295 
	#HAVE_SEND
 1

	)

298 
	#SEND_TYPE_ARG1
 
SOCKET


	)

301 
	#SEND_QUAL_ARG2
 c⁄°

	)

304 
	#SEND_TYPE_ARG2
 *

	)

307 
	#SEND_TYPE_ARG3
 

	)

310 
	#SEND_TYPE_ARG4
 

	)

313 
	#SEND_TYPE_RETV
 

	)

320 
	#ö_addr_t
 

	)

323 
	#RETSIGTYPE
 

	)

326 #i‡(
deföed
(
__WATCOMC__
Ë&& (__WATCOMC__ >1240)Ë|| deföed(
__POCC__
)

327 #ñi‡
deföed
(
_WIN64
)

328 
	#ssize_t
 
__öt64


	)

330 
	#ssize_t
 

	)

338 
	#SIZEOF_INT
 4

	)

341 
	#SIZEOF_LONG_DOUBLE
 16

	)

347 
	#SIZEOF_SHORT
 2

	)

350 #i‡
deföed
(
_WIN64
)

351 
	#SIZEOF_SIZE_T
 8

	)

353 
	#SIZEOF_SIZE_T
 4

	)

364 
	#HAVE_STRUCT_TIMEVAL
 1

	)

367 
	#HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID
 1

	)

377 #i‡
deföed
(
_MSC_VER
) && (_MSC_VER >= 1400)

378 
	#_CRT_SECURE_NO_DEPRECATE
 1

	)

379 
	#_CRT_NONSTDC_NO_DEPRECATE
 1

	)

384 #i‡
deföed
(
_MSC_VER
) && (_MSC_VER >= 1400)

385 #i‚de‡
_USE_32BIT_TIME_T


386 
	#SIZEOF_TIME_T
 8

	)

388 
	#SIZEOF_TIME_T
 4

	)

396 #i‡
deföed
(
_MSC_VER
Ë&& !deföed(
_WIN32_WCE
)

397 #i‡(
_MSC_VER
 >900Ë&& (
_INTEGRAL_MAX_BITS
 >= 64)

398 
	#USE_WIN32_LARGE_FILES


	)

400 
	#USE_WIN32_SMALL_FILES


	)

404 #i‡!
deföed
(
USE_WIN32_LARGE_FILES
Ë&& !deföed(
USE_WIN32_SMALL_FILES
)

405 
	#USE_WIN32_SMALL_FILES


	)

412 
	#CURL_LDAP_WIN
 1

	)

413 #unde‡
HAVE_LDAP_URL_PARSE


420 #unde‡
OS


421 
	#OS
 "i386-pc-wö32˚"

	)

424 
	#PACKAGE
 "cuæ"

	)

430 #i‚de‡
UNICODE


431 
	#UNICODE


	)

434 #i‚de‡
_UNICODE


435 
	#_UNICODE


	)

438 
	#CURL_DISABLE_FILE
 1

	)

439 
	#CURL_DISABLE_TELNET
 1

	)

440 
	#CURL_DISABLE_LDAP
 1

	)

442 
	#ENOSPC
 1

	)

443 
	#ENOMEM
 2

	)

444 
	#EAGAIN
 3

	)

446 
°©
(c⁄° *
∑th
,°© *
buf„r
 );

	@lib/conncache.c

24 
	~"cuæ_£tup.h
"

26 
	~<cuæ/cuæ.h
>

28 
	~"uæd©a.h
"

29 
	~"uæ.h
"

30 
	~"¥ogªss.h
"

31 
	~"mu…iif.h
"

32 
	~"£ndf.h
"

33 
	~"øw°r.h
"

34 
	~"bundÀs.h
"

35 
	~"c⁄nˇche.h
"

37 
	~"cuæ_mem‹y.h
"

39 
	~"memdebug.h
"

41 
	$‰ì_bundÀ_hash_íåy
(*
‰ìthis
)

43 
c⁄√˘bundÀ
 *
b
 = (c⁄√˘bundÀ *Ë
‰ìthis
;

45 
	`Cuæ_bundÀ_de°roy
(
b
);

46 
	}
}

48 
c⁄nˇche
 *
	$Cuæ_c⁄nˇche_öô
(
size
)

50 
c⁄nˇche
 *
c⁄nc
;

52 
c⁄nc
 = 
	`ˇŒoc
(1, (
c⁄nˇche
));

53 if(!
c⁄nc
)

54  
NULL
;

56 
c⁄nc
->
hash
 = 
	`Cuæ_hash_Æloc
(
size
, 
Cuæ_hash_°r
,

57 
Cuæ_°r_key_com∑ª
, 
‰ì_bundÀ_hash_íåy
);

59 if(!
c⁄nc
->
hash
) {

60 
	`‰ì
(
c⁄nc
);

61  
NULL
;

64  
c⁄nc
;

65 
	}
}

67 
	$Cuæ_c⁄nˇche_de°roy
(
c⁄nˇche
 *
c⁄nc
)

69 if(
c⁄nc
) {

70 
	`Cuæ_hash_de°roy
(
c⁄nc
->
hash
);

71 
c⁄nc
->
hash
 = 
NULL
;

72 
	`‰ì
(
c⁄nc
);

74 
	}
}

76 
c⁄√˘bundÀ
 *
	$Cuæ_c⁄nˇche_föd_bundÀ
(
c⁄nˇche
 *
c⁄nc
,

77 *
ho°«me
)

79 
c⁄√˘bundÀ
 *
bundÀ
 = 
NULL
;

81 if(
c⁄nc
)

82 
bundÀ
 = 
	`Cuæ_hash_pick
(
c⁄nc
->
hash
, 
ho°«me
, 
	`°æí
(hostname)+1);

84  
bundÀ
;

85 
	}
}

87 
boﬁ
 
	$c⁄nˇche_add_bundÀ
(
c⁄nˇche
 *
c⁄nc
,

88 *
ho°«me
,

89 
c⁄√˘bundÀ
 *
bundÀ
)

91 *
p
;

93 
p
 = 
	`Cuæ_hash_add
(
c⁄nc
->
hash
, 
ho°«me
, 
	`°æí
(ho°«me)+1, 
bundÀ
);

95  
p
?
TRUE
:
FALSE
;

96 
	}
}

98 
	$c⁄nˇche_ªmove_bundÀ
(
c⁄nˇche
 *
c⁄nc
,

99 
c⁄√˘bundÀ
 *
bundÀ
)

101 
cuæ_hash_ôî©‹
 
ôî
;

102 
cuæ_hash_ñemít
 *
he
;

104 if(!
c⁄nc
)

107 
	`Cuæ_hash_°¨t_ôî©e
(
c⁄nc
->
hash
, &
ôî
);

109 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

110 
he
) {

111 if(
he
->
±r
 =
bundÀ
) {

114 
	`Cuæ_hash_dñëe
(
c⁄nc
->
hash
, 
he
->
key
, he->
key_Àn
);

118 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

120 
	}
}

122 
CURLcode
 
	$Cuæ_c⁄nˇche_add_c⁄n
(
c⁄nˇche
 *
c⁄nc
,

123 
c⁄√˘d©a
 *
c⁄n
)

125 
CURLcode
 
ªsu…
;

126 
c⁄√˘bundÀ
 *
bundÀ
;

127 
c⁄√˘bundÀ
 *
√w_bundÀ
 = 
NULL
;

128 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

130 
bundÀ
 = 
	`Cuæ_c⁄nˇche_föd_bundÀ
(
d©a
->
°©e
.
c⁄n_ˇche
,

131 
c⁄n
->
ho°
.
«me
);

132 if(!
bundÀ
) {

133 
ªsu…
 = 
	`Cuæ_bundÀ_¸óã
(
d©a
, &
√w_bundÀ
);

134 if(
ªsu…
 !
CURLE_OK
)

135  
ªsu…
;

137 if(!
	`c⁄nˇche_add_bundÀ
(
d©a
->
°©e
.
c⁄n_ˇche
,

138 
c⁄n
->
ho°
.
«me
, 
√w_bundÀ
)) {

139 
	`Cuæ_bundÀ_de°roy
(
√w_bundÀ
);

140  
CURLE_OUT_OF_MEMORY
;

142 
bundÀ
 = 
√w_bundÀ
;

145 
ªsu…
 = 
	`Cuæ_bundÀ_add_c⁄n
(
bundÀ
, 
c⁄n
);

146 if(
ªsu…
 !
CURLE_OK
) {

147 if(
√w_bundÀ
)

148 
	`c⁄nˇche_ªmove_bundÀ
(
d©a
->
°©e
.
c⁄n_ˇche
, 
√w_bundÀ
);

149  
ªsu…
;

152 
c⁄n
->
c⁄√˘i⁄_id
 = 
c⁄nc
->
√xt_c⁄√˘i⁄_id
++;

153 
c⁄nc
->
num_c⁄√˘i⁄s
++;

155  
CURLE_OK
;

156 
	}
}

158 
	$Cuæ_c⁄nˇche_ªmove_c⁄n
(
c⁄nˇche
 *
c⁄nc
,

159 
c⁄√˘d©a
 *
c⁄n
)

161 
c⁄√˘bundÀ
 *
bundÀ
 = 
c⁄n
->bundle;

165 if(
bundÀ
) {

166 
	`Cuæ_bundÀ_ªmove_c⁄n
(
bundÀ
, 
c⁄n
);

167 if(
bundÀ
->
num_c⁄√˘i⁄s
 == 0) {

168 
	`c⁄nˇche_ªmove_bundÀ
(
c⁄nc
, 
bundÀ
);

171 if(
c⁄nc
) {

172 
c⁄nc
->
num_c⁄√˘i⁄s
--;

174 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "The cacheÇow contains %d members\n",

175 
c⁄nc
->
num_c⁄√˘i⁄s
));

178 
	}
}

186 
Cuæ_c⁄nˇche_f‹óch
(
c⁄nˇche
 *
c⁄nc
,

187 *
∑øm
,

188 (*
func
)(
c⁄√˘d©a
 *
c⁄n
, *
∑øm
))

190 
cuæ_hash_ôî©‹
 
ôî
;

191 
cuæ_Œi°_ñemít
 *
cuº
;

192 
cuæ_hash_ñemít
 *
he
;

194 if(!
c⁄nc
)

197 
	`Cuæ_hash_°¨t_ôî©e
(
c⁄nc
->
hash
, &
ôî
);

199 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

200 
he
) {

201 
c⁄√˘bundÀ
 *
bundÀ
;

202 
c⁄√˘d©a
 *
c⁄n
;

204 
bundÀ
 = 
he
->
±r
;

206 
cuº
 = 
bundÀ
->
c⁄n_li°
->
hód
;

207 
cuº
) {

210 
c⁄n
 = 
cuº
->
±r
;

211 
cuº
 = cuº->
√xt
;

213 if(1 =
	`func
(
c⁄n
, 
∑øm
))

217 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

219 
	}
}

223 
c⁄√˘d©a
 *

224 
	$Cuæ_c⁄nˇche_föd_fú°_c⁄√˘i⁄
(
c⁄nˇche
 *
c⁄nc
)

226 
cuæ_hash_ôî©‹
 
ôî
;

227 
cuæ_Œi°_ñemít
 *
cuº
;

228 
cuæ_hash_ñemít
 *
he
;

229 
c⁄√˘bundÀ
 *
bundÀ
;

231 
	`Cuæ_hash_°¨t_ôî©e
(
c⁄nc
->
hash
, &
ôî
);

233 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

234 
he
) {

235 
bundÀ
 = 
he
->
±r
;

237 
cuº
 = 
bundÀ
->
c⁄n_li°
->
hód
;

238 if(
cuº
) {

239  
cuº
->
±r
;

242 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

245  
NULL
;

246 
	}
}

251 
	$Cuæ_c⁄nˇche_¥öt
(
c⁄nˇche
 *
c⁄nc
)

253 
cuæ_hash_ôî©‹
 
ôî
;

254 
cuæ_Œi°_ñemít
 *
cuº
;

255 
cuæ_hash_ñemít
 *
he
;

257 if(!
c⁄nc
)

260 
	`Ârötf
(
°dîr
, "=Bundle cache=\n");

262 
	`Cuæ_hash_°¨t_ôî©e
(
c⁄nc
->
hash
, &
ôî
);

264 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

265 
he
) {

266 
c⁄√˘bundÀ
 *
bundÀ
;

267 
c⁄√˘d©a
 *
c⁄n
;

269 
bundÀ
 = 
he
->
±r
;

271 
	`Ârötf
(
°dîr
, "%†-", 
he
->
key
);

272 
cuº
 = 
bundÀ
->
c⁄n_li°
->
hód
;

273 
cuº
) {

274 
c⁄n
 = 
cuº
->
±r
;

276 
	`Ârötf
(
°dîr
, " [%∞%d]", (*)
c⁄n
, c⁄n->
öu£
);

277 
cuº
 = cuº->
√xt
;

279 
	`Ârötf
(
°dîr
, "\n");

281 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

283 
	}
}

	@lib/conncache.h

1 #i‚de‡
HEADER_CURL_CONNCACHE_H


2 
	#HEADER_CURL_CONNCACHE_H


	)

25 
	sc⁄nˇche
 {

26 
cuæ_hash
 *
	mhash
;

27 
size_t
 
	mnum_c⁄√˘i⁄s
;

28 
size_t
 
	m√xt_c⁄√˘i⁄_id
;

31 
c⁄nˇche
 *
Cuæ_c⁄nˇche_öô
(
size
);

33 
Cuæ_c⁄nˇche_de°roy
(
c⁄nˇche
 *
c⁄nc
);

35 
c⁄√˘bundÀ
 *
Cuæ_c⁄nˇche_föd_bundÀ
(
c⁄nˇche
 *
c⁄nc
,

36 *
ho°«me
);

38 
CURLcode
 
Cuæ_c⁄nˇche_add_c⁄n
(
c⁄nˇche
 *
c⁄nc
,

39 
c⁄√˘d©a
 *
c⁄n
);

41 
Cuæ_c⁄nˇche_ªmove_c⁄n
(
c⁄nˇche
 *
c⁄nc
,

42 
c⁄√˘d©a
 *
c⁄n
);

44 
Cuæ_c⁄nˇche_f‹óch
(
c⁄nˇche
 *
c⁄nc
,

45 *
∑øm
,

46 (*
func
)(
c⁄√˘d©a
 *
c⁄n
,

47 *
∑øm
));

49 
c⁄√˘d©a
 *

50 
	`Cuæ_c⁄nˇche_föd_fú°_c⁄√˘i⁄
(
c⁄nˇche
 *
c⁄nc
);

52 
	`Cuæ_c⁄nˇche_¥öt
(
c⁄nˇche
 *
c⁄nc
);

	@lib/connect.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_NETINET_IN_H


26 
	~<√töë/ö.h
>

28 #ifde‡
HAVE_SYS_UN_H


29 
	~<sys/un.h
>

31 #ifde‡
HAVE_NETINET_TCP_H


32 
	~<√töë/t˝.h
>

34 #ifde‡
HAVE_SYS_IOCTL_H


35 
	~<sys/io˘l.h
>

37 #ifde‡
HAVE_NETDB_H


38 
	~<√tdb.h
>

40 #ifde‡
HAVE_FCNTL_H


41 
	~<f˙é.h
>

43 #ifde‡
HAVE_ARPA_INET_H


44 
	~<¨∑/öë.h
>

47 #i‡(
deföed
(
HAVE_IOCTL_FIONBIO
Ë&& deföed(
NETWARE
))

48 
	~<sys/fûio.h
>

50 #ifde‡
NETWARE


51 #unde‡
ö_addr_t


52 
	#ö_addr_t
 

	)

54 #ifde‡
__VMS


55 
	~<ö.h
>

56 
	~<öë.h
>

59 
	#_MPRINTF_REPLACE


	)

60 
	~<cuæ/m¥ötf.h
>

62 
	~"uæd©a.h
"

63 
	~"£ndf.h
"

64 
	~"if2ù.h
"

65 
	~"°ªº‹.h
"

66 
	~"c⁄√˘.h
"

67 
	~"cuæ_mem‹y.h
"

68 
	~"£À˘.h
"

69 
	~"uæ.h
"

70 
	~"mu…iif.h
"

71 
	~"sockaddr.h
"

72 
	~"öë_¡›.h
"

73 
	~"öë_±⁄.h
"

74 
	~"vés/vés.h
"

75 
	~"¥ogªss.h
"

76 
	~"w¨∆ess.h
"

77 
	~"c⁄nˇche.h
"

78 
	~"mu…ih™dÀ.h
"

81 
	~"memdebug.h
"

83 #ifde‡
__SYMBIAN32__


85 #unde‡
SO_NOSIGPIPE


88 
boﬁ
 
vîifyc⁄√˘
(
cuæ_sockë_t
 
sockfd
, *
îr‹
);

90 #i‡
deföed
(
__Døg⁄Fly__
Ë|| deföed(
HAVE_WINSOCK_H
)

92 
	#KEEPALIVE_FACTOR
(
x
Ë(x *1000)

	)

94 
	#KEEPALIVE_FACTOR
(
x
)

	)

97 #i‡
deföed
(
HAVE_WINSOCK_H
Ë&& !deföed(
SIO_KEEPALIVE_VALS
)

98 
	#SIO_KEEPALIVE_VALS
 
	`_WSAIOW
(
IOC_VENDOR
,4)

	)

100 
	st˝_kì∑live
 {

101 
u_l⁄g
 
	m⁄off
;

102 
u_l⁄g
 
	mkì∑livëime
;

103 
u_l⁄g
 
	mkì∑liveöãrvÆ
;

108 
	$t˝kì∑live
(
Sessi⁄H™dÀ
 *
d©a
,

109 
cuæ_sockë_t
 
sockfd
)

111 
›tvÆ
 = 
d©a
->
£t
.
t˝_kì∑live
?1:0;

114 if(
	`£tsock›t
(
sockfd
, 
SOL_SOCKET
, 
SO_KEEPALIVE
,

115 (*)&
›tvÆ
, (optval)) < 0) {

116 
	`öfof
(
d©a
, "FaûedÅÿ£àSO_KEEPALIVE o¿fd %d\n", 
sockfd
);

119 #i‡
	`deföed
(
SIO_KEEPALIVE_VALS
)

120 
t˝_kì∑live
 
vÆs
;

121 
DWORD
 
dummy
;

122 
vÆs
.
⁄off
 = 1;

123 
›tvÆ
 = 
	`cuæx_¶tosi
(
d©a
->
£t
.
t˝_kìpidÀ
);

124 
	`KEEPALIVE_FACTOR
(
›tvÆ
);

125 
vÆs
.
kì∑livëime
 = 
›tvÆ
;

126 
›tvÆ
 = 
	`cuæx_¶tosi
(
d©a
->
£t
.
t˝_kìpötvl
);

127 
	`KEEPALIVE_FACTOR
(
›tvÆ
);

128 
vÆs
.
kì∑liveöãrvÆ
 = 
›tvÆ
;

129 if(
	`WSAIo˘l
(
sockfd
, 
SIO_KEEPALIVE_VALS
, (
LPVOID
Ë&
vÆs
, (vals),

130 
NULL
, 0, &
dummy
, NULL, NULL) != 0) {

131 
	`öfof
(
d©a
, "FailedÅo set SIO_KEEPALIVE_VALS on fd %d: %d\n",

132 ()
sockfd
, 
	`WSAGëLa°Eº‹
());

135 #ifde‡
TCP_KEEPIDLE


136 
›tvÆ
 = 
	`cuæx_¶tosi
(
d©a
->
£t
.
t˝_kìpidÀ
);

137 
	`KEEPALIVE_FACTOR
(
›tvÆ
);

138 if(
	`£tsock›t
(
sockfd
, 
IPPROTO_TCP
, 
TCP_KEEPIDLE
,

139 (*)&
›tvÆ
, (optval)) < 0) {

140 
	`öfof
(
d©a
, "FaûedÅÿ£àTCP_KEEPIDLE o¿fd %d\n", 
sockfd
);

143 #ifde‡
TCP_KEEPINTVL


144 
›tvÆ
 = 
	`cuæx_¶tosi
(
d©a
->
£t
.
t˝_kìpötvl
);

145 
	`KEEPALIVE_FACTOR
(
›tvÆ
);

146 if(
	`£tsock›t
(
sockfd
, 
IPPROTO_TCP
, 
TCP_KEEPINTVL
,

147 (*)&
›tvÆ
, (optval)) < 0) {

148 
	`öfof
(
d©a
, "FaûedÅÿ£àTCP_KEEPINTVL o¿fd %d\n", 
sockfd
);

151 #ifde‡
TCP_KEEPALIVE


153 
›tvÆ
 = 
	`cuæx_¶tosi
(
d©a
->
£t
.
t˝_kìpidÀ
);

154 
	`KEEPALIVE_FACTOR
(
›tvÆ
);

155 if(
	`£tsock›t
(
sockfd
, 
IPPROTO_TCP
, 
TCP_KEEPALIVE
,

156 (*)&
›tvÆ
, (optval)) < 0) {

157 
	`öfof
(
d©a
, "FaûedÅÿ£àTCP_KEEPALIVE o¿fd %d\n", 
sockfd
);

162 
	}
}

164 
CURLcode


165 
sögÀùc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

166 c⁄° 
Cuæ_addröfo
 *
ai
,

167 
cuæ_sockë_t
 *
sock
);

183 
	$Cuæ_timñe·
(
Sessi⁄H™dÀ
 *
d©a
,

184 
timevÆ
 *
nowp
,

185 
boﬁ
 
durögc⁄√˘
)

187 
timeout_£t
 = 0;

188 
timeout_ms
 = 
durögc⁄√˘
?
DEFAULT_CONNECT_TIMEOUT
:0;

189 
timevÆ
 
now
;

193 if(
d©a
->
£t
.
timeout
 > 0)

194 
timeout_£t
 |= 1;

195 if(
durögc⁄√˘
 && (
d©a
->
£t
.
c⁄√˘timeout
 > 0))

196 
timeout_£t
 |= 2;

198 
timeout_£t
) {

200 
timeout_ms
 = 
d©a
->
£t
.
timeout
;

203 
timeout_ms
 = 
d©a
->
£t
.
c⁄√˘timeout
;

206 if(
d©a
->
£t
.
timeout
 < d©a->£t.
c⁄√˘timeout
)

207 
timeout_ms
 = 
d©a
->
£t
.
timeout
;

209 
timeout_ms
 = 
d©a
->
£t
.
c⁄√˘timeout
;

213 if(!
durögc⁄√˘
)

221 if(!
nowp
) {

222 
now
 = 
	`Cuæ_tvnow
();

223 
nowp
 = &
now
;

227 if(
durögc⁄√˘
)

229 
timeout_ms
 -
	`Cuæ_tvdiff
(*
nowp
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
);

232 
timeout_ms
 -
	`Cuæ_tvdiff
(*
nowp
, 
d©a
->
¥ogªss
.
t_°¨t›
);

233 if(!
timeout_ms
)

237  
timeout_ms
;

238 
	}
}

240 
CURLcode
 
	$bödloˇl
(
c⁄√˘d©a
 *
c⁄n
,

241 
cuæ_sockë_t
 
sockfd
, 
af
)

243 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

245 
Cuæ_sockaddr_°‹age
 
ß
;

246 
sockaddr
 *
sock
 = (sockadd∏*)&
ß
;

247 
cuæ_sockÀn_t
 
sizeof_ß
 = 0;

248 
sockaddr_ö
 *
si4
 = (sockaddr_ö *)&
ß
;

249 #ifde‡
ENABLE_IPV6


250 
sockaddr_ö6
 *
si6
 = (sockaddr_ö6 *)&
ß
;

253 
Cuæ_dns_íåy
 *
h
=
NULL
;

254 
p‹t
 = 
d©a
->
£t
.
loˇÕ‹t
;

257 
p‹äum
 = 
d©a
->
£t
.
loˇÕ‹å™ge
;

258 c⁄° *
dev
 = 
d©a
->
£t
.
°r
[
STRING_DEVICE
];

259 
îr‹
;

260 
myho°
[256] = "";

261 
d⁄e
 = 0;

262 
boﬁ
 
is_öãrÁ˚
 = 
FALSE
;

263 
boﬁ
 
is_ho°
 = 
FALSE
;

264 c⁄° *
if_¥efix
 = "if!";

265 c⁄° *
ho°_¥efix
 = "host!";

270 if(!
dev
 && !
p‹t
)

272  
CURLE_OK
;

274 
	`mem£t
(&
ß
, 0, (
Cuæ_sockaddr_°‹age
));

276 if(
dev
 && (
	`°æí
(dev)<255) ) {

277 if(
	`°∫cmp
(
if_¥efix
, 
dev
, 
	`°æí
(if_prefix)) == 0) {

278 
dev
 +
	`°æí
(
if_¥efix
);

279 
is_öãrÁ˚
 = 
TRUE
;

281 if(
	`°∫cmp
(
ho°_¥efix
, 
dev
, 
	`°æí
(host_prefix)) == 0) {

282 
dev
 +
	`°æí
(
ho°_¥efix
);

283 
is_ho°
 = 
TRUE
;

287 if(!
is_ho°
) {

288 
	`Cuæ_if2ù
(
af
, 
c⁄n
->
sc›e
, 
dev
, 
myho°
, (myhost))) {

289 
IF2IP_NOT_FOUND
:

290 if(
is_öãrÁ˚
) {

292 
	`Áûf
(
d©a
, "Couldn'àbödÅÿöãrÁ˚ '%s'", 
dev
);

293  
CURLE_INTERFACE_FAILED
;

296 
IF2IP_AF_NOT_SUPPORTED
:

298  
CURLE_UNSUPPORTED_PROTOCOL
;

299 
IF2IP_FOUND
:

300 
is_öãrÁ˚
 = 
TRUE
;

304 
	`öfof
(
d©a
, "Local Interface %s is ip %s usingáddress family %i\n",

305 
dev
, 
myho°
, 
af
);

306 
d⁄e
 = 1;

308 #ifde‡
SO_BINDTODEVICE


320 if(
	`£tsock›t
(
sockfd
, 
SOL_SOCKET
, 
SO_BINDTODEVICE
,

321 
dev
, (
cuæ_sockÀn_t
)
	`°æí
(dev)+1) != 0) {

322 
îr‹
 = 
SOCKERRNO
;

323 
	`öfof
(
d©a
, "SO_BINDTODEVICE %s failed withÉrrno %d: %s;"

325 
dev
, 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

334 if(!
is_öãrÁ˚
) {

343 
ùvî
 = 
c⁄n
->
ù_vîsi⁄
;

344 
rc
;

346 if(
af
 =
AF_INET
)

347 
c⁄n
->
ù_vîsi⁄
 = 
CURL_IPRESOLVE_V4
;

348 #ifde‡
ENABLE_IPV6


349 if(
af
 =
AF_INET6
)

350 
c⁄n
->
ù_vîsi⁄
 = 
CURL_IPRESOLVE_V6
;

353 
rc
 = 
	`Cuæ_ªsﬁv
(
c⁄n
, 
dev
, 0, &
h
);

354 if(
rc
 =
CURLRESOLV_PENDING
)

355 ()
	`Cuæ_ªsﬁvî_waô_ªsﬁv
(
c⁄n
, &
h
);

356 
c⁄n
->
ù_vîsi⁄
 = 
ùvî
;

358 if(
h
) {

360 
	`Cuæ_¥öèbÀ_addªss
(
h
->
addr
, 
myho°
, (myhost));

361 
	`öfof
(
d©a
, "Name '%s' family %iÑesolvedÅo '%s' family %i\n",

362 
dev
, 
af
, 
myho°
, 
h
->
addr
->
ai_Ámûy
);

363 
	`Cuæ_ªsﬁv_u∆ock
(
d©a
, 
h
);

364 
d⁄e
 = 1;

371 
d⁄e
 = -1;

375 if(
d⁄e
 > 0) {

376 #ifde‡
ENABLE_IPV6


378 if(
af
 =
AF_INET6
) {

379 #ifde‡
HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID


380 *
sc›e_±r
 = 
	`°rchr
(
myho°
, '%');

381 if(
sc›e_±r
)

382 *(
sc›e_±r
++) = 0;

384 if(
	`Cuæ_öë_±⁄
(
AF_INET6
, 
myho°
, &
si6
->
sö6_addr
) > 0) {

385 
si6
->
sö6_Ámûy
 = 
AF_INET6
;

386 
si6
->
sö6_p‹t
 = 
	`ht⁄s
(
p‹t
);

387 #ifde‡
HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID


388 if(
sc›e_±r
)

393 
si6
->
sö6_sc›e_id
 = 
	`©oi
(
sc›e_±r
);

396 
sizeof_ß
 = (
sockaddr_ö6
);

401 if((
af
 =
AF_INET
) &&

402 (
	`Cuæ_öë_±⁄
(
AF_INET
, 
myho°
, &
si4
->
sö_addr
) > 0)) {

403 
si4
->
sö_Ámûy
 = 
AF_INET
;

404 
si4
->
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

405 
sizeof_ß
 = (
sockaddr_ö
);

409 if(
d⁄e
 < 1) {

410 
	`Áûf
(
d©a
, "Couldn'àbödÅÿ'%s'", 
dev
);

411  
CURLE_INTERFACE_FAILED
;

416 #ifde‡
ENABLE_IPV6


417 if(
af
 =
AF_INET6
) {

418 
si6
->
sö6_Ámûy
 = 
AF_INET6
;

419 
si6
->
sö6_p‹t
 = 
	`ht⁄s
(
p‹t
);

420 
sizeof_ß
 = (
sockaddr_ö6
);

424 if(
af
 =
AF_INET
) {

425 
si4
->
sö_Ámûy
 = 
AF_INET
;

426 
si4
->
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

427 
sizeof_ß
 = (
sockaddr_ö
);

432 if(
	`böd
(
sockfd
, 
sock
, 
sizeof_ß
) >= 0) {

434 
Cuæ_sockaddr_°‹age
 
add
;

435 
cuæ_sockÀn_t
 
size
 = (
add
);

436 
	`mem£t
(&
add
, 0, (
Cuæ_sockaddr_°‹age
));

437 if(
	`gësock«me
(
sockfd
, (
sockaddr
 *Ë&
add
, &
size
) < 0) {

438 
d©a
->
°©e
.
os_î∫o
 = 
îr‹
 = 
SOCKERRNO
;

439 
	`Áûf
(
d©a
, "getsockname() failed withÉrrno %d: %s",

440 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

441  
CURLE_INTERFACE_FAILED
;

443 
	`öfof
(
d©a
, "Loˇ»p‹t: %hu\n", 
p‹t
);

444 
c⁄n
->
bôs
.
bound
 = 
TRUE
;

445  
CURLE_OK
;

448 if(--
p‹äum
 > 0) {

449 
	`öfof
(
d©a
, "BödÅÿloˇ»p‹à%hu faûed,ÅryögÇext\n", 
p‹t
);

450 
p‹t
++;

452 if(
sock
->
ß_Ámûy
 =
AF_INET
)

453 
si4
->
sö_p‹t
 = 
	`¡ohs
(
p‹t
);

454 #ifde‡
ENABLE_IPV6


456 
si6
->
sö6_p‹t
 = 
	`¡ohs
(
p‹t
);

463 
d©a
->
°©e
.
os_î∫o
 = 
îr‹
 = 
SOCKERRNO
;

464 
	`Áûf
(
d©a
, "bind failed withÉrrno %d: %s",

465 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

467  
CURLE_INTERFACE_FAILED
;

468 
	}
}

473 
boﬁ
 
	$vîifyc⁄√˘
(
cuæ_sockë_t
 
sockfd
, *
îr‹
)

475 
boﬁ
 
rc
 = 
TRUE
;

476 #ifde‡
SO_ERROR


477 
îr
 = 0;

478 
cuæ_sockÀn_t
 
îrSize
 = (
îr
);

480 #ifde‡
WIN32


497 #ifde‡
_WIN32_WCE


498 
	`SÀï
(0);

500 
	`SÀïEx
(0, 
FALSE
);

505 if(0 !
	`gësock›t
(
sockfd
, 
SOL_SOCKET
, 
SO_ERROR
, (*)&
îr
, &
îrSize
))

506 
îr
 = 
SOCKERRNO
;

507 #ifde‡
_WIN32_WCE


509 if(
WSAENOPROTOOPT
 =
îr
) {

510 
	`SET_SOCKERRNO
(0);

511 
îr
 = 0;

514 #ifde‡
__möix


516 if(
EBADIOCTL
 =
îr
) {

517 
	`SET_SOCKERRNO
(0);

518 
îr
 = 0;

521 if((0 =
îr
Ë|| (
EISCONN
 ==Érr))

523 
rc
 = 
TRUE
;

526 
rc
 = 
FALSE
;

527 if(
îr‹
)

528 *
îr‹
 = 
îr
;

530 ()
sockfd
;

531 if(
îr‹
)

532 *
îr‹
 = 
SOCKERRNO
;

534  
rc
;

535 
	}
}

539 
CURLcode
 
	$åy√xtù
(
c⁄√˘d©a
 *
c⁄n
,

540 
socködex
,

541 
ãmpödex
)

543 
CURLcode
 
rc
 = 
CURLE_COULDNT_CONNECT
;

549 
cuæ_sockë_t
 
fd_to_˛o£
 = 
c⁄n
->
ãmpsock
[
ãmpödex
];

550 
c⁄n
->
ãmpsock
[
ãmpödex
] = 
CURL_SOCKET_BAD
;

552 if(
socködex
 =
FIRSTSOCKET
) {

553 
Cuæ_addröfo
 *
ai
 = 
NULL
;

554 
Ámûy
 = 
AF_UNSPEC
;

556 if(
c⁄n
->
ãm∑ddr
[
ãmpödex
]) {

558 
Ámûy
 = 
c⁄n
->
ãm∑ddr
[
ãmpödex
]->
ai_Ámûy
;

559 
ai
 = 
c⁄n
->
ãm∑ddr
[
ãmpödex
]->
ai_√xt
;

561 if(
c⁄n
->
ãm∑ddr
[0]) {

563 
fú°Ámûy
 = 
c⁄n
->
ãm∑ddr
[0]->
ai_Ámûy
;

564 #ifde‡
ENABLE_IPV6


565 
Ámûy
 = (
fú°Ámûy
 =
AF_INET
Ë? 
AF_INET6
 : AF_INET;

567 
Ámûy
 = 
fú°Ámûy
;

569 
ai
 = 
c⁄n
->
ãm∑ddr
[0]->
ai_√xt
;

572 
ai
) {

573 
ai
 &&ái->
ai_Ámûy
 !
Ámûy
)

574 
ai
 =ái->
ai_√xt
;

576 if(
ai
) {

577 
rc
 = 
	`sögÀùc⁄√˘
(
c⁄n
, 
ai
, &c⁄n->
ãmpsock
[
ãmpödex
]);

578 if(
rc
 =
CURLE_COULDNT_CONNECT
) {

579 
ai
 =ái->
ai_√xt
;

582 
c⁄n
->
ãm∑ddr
[
ãmpödex
] = 
ai
;

588 if(
fd_to_˛o£
 !
CURL_SOCKET_BAD
)

589 
	`Cuæ_˛o£sockë
(
c⁄n
, 
fd_to_˛o£
);

591  
rc
;

592 
	}
}

596 
	$Cuæ_≥rsi°c⁄nöfo
(
c⁄√˘d©a
 *
c⁄n
)

598 
	`mem˝y
(
c⁄n
->
d©a
->
öfo
.
c⁄n_¥im¨y_ù
, c⁄n->
¥im¨y_ù
, 
MAX_IPADR_LEN
);

599 
	`mem˝y
(
c⁄n
->
d©a
->
öfo
.
c⁄n_loˇl_ù
, c⁄n->
loˇl_ù
, 
MAX_IPADR_LEN
);

600 
c⁄n
->
d©a
->
öfo
.
c⁄n_¥im¨y_p‹t
 = c⁄n->
¥im¨y_p‹t
;

601 
c⁄n
->
d©a
->
öfo
.
c⁄n_loˇl_p‹t
 = c⁄n->
loˇl_p‹t
;

602 
	}
}

605 
boﬁ
 
	$gëaddªssöfo
(
sockaddr
* 
ß
, * 
addr
,

606 * 
p‹t
)

608 
us_p‹t
;

609 
sockaddr_ö
* 
si
 = 
NULL
;

610 #ifde‡
ENABLE_IPV6


611 
sockaddr_ö6
* 
si6
 = 
NULL
;

613 #i‡
	`deföed
(
HAVE_SYS_UN_H
Ë&& deföed(
AF_UNIX
)

614 
sockaddr_un
* 
su
 = 
NULL
;

617 
ß
->
ß_Ámûy
) {

618 
AF_INET
:

619 
si
 = (
sockaddr_ö
*Ë
ß
;

620 if(
	`Cuæ_öë_¡›
(
ß
->
ß_Ámûy
, &
si
->
sö_addr
,

621 
addr
, 
MAX_IPADR_LEN
)) {

622 
us_p‹t
 = 
	`¡ohs
(
si
->
sö_p‹t
);

623 *
p‹t
 = 
us_p‹t
;

624  
TRUE
;

627 #ifde‡
ENABLE_IPV6


628 
AF_INET6
:

629 
si6
 = (
sockaddr_ö6
*)
ß
;

630 if(
	`Cuæ_öë_¡›
(
ß
->
ß_Ámûy
, &
si6
->
sö6_addr
,

631 
addr
, 
MAX_IPADR_LEN
)) {

632 
us_p‹t
 = 
	`¡ohs
(
si6
->
sö6_p‹t
);

633 *
p‹t
 = 
us_p‹t
;

634  
TRUE
;

638 #i‡
	`deföed
(
HAVE_SYS_UN_H
Ë&& deföed(
AF_UNIX
)

639 
AF_UNIX
:

640 
su
 = (
sockaddr_un
*)
ß
;

641 
	`¢¥ötf
(
addr
, 
MAX_IPADR_LEN
, "%s", 
su
->
sun_∑th
);

642 *
p‹t
 = 0;

643  
TRUE
;

649 
addr
[0] = '\0';

650 *
p‹t
 = 0;

652  
FALSE
;

653 
	}
}

657 
	$Cuæ_upd©ec⁄nöfo
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 
sockfd
)

659 
îr‹
;

660 
cuæ_sockÀn_t
 
Àn
;

661 
Cuæ_sockaddr_°‹age
 
s§em
;

662 
Cuæ_sockaddr_°‹age
 
s¶oc
;

663 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

665 if(
c⁄n
->
sockty≥
 =
SOCK_DGRAM
)

669 if(!
c⁄n
->
bôs
.
ªu£
) {

671 
Àn
 = (
Cuæ_sockaddr_°‹age
);

672 if(
	`gë≥î«me
(
sockfd
, (
sockaddr
*Ë&
s§em
, &
Àn
)) {

673 
îr‹
 = 
SOCKERRNO
;

674 
	`Áûf
(
d©a
, "getpeername() failed withÉrrno %d: %s",

675 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

679 
Àn
 = (
Cuæ_sockaddr_°‹age
);

680 if(
	`gësock«me
(
sockfd
, (
sockaddr
*Ë&
s¶oc
, &
Àn
)) {

681 
îr‹
 = 
SOCKERRNO
;

682 
	`Áûf
(
d©a
, "getsockname() failed withÉrrno %d: %s",

683 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

687 if(!
	`gëaddªssöfo
((
sockaddr
*)&
s§em
,

688 
c⁄n
->
¥im¨y_ù
, &c⁄n->
¥im¨y_p‹t
)) {

689 
îr‹
 = 
ERRNO
;

690 
	`Áûf
(
d©a
, "ssrem inet_ntop() failed withÉrrno %d: %s",

691 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

694 
	`mem˝y
(
c⁄n
->
ù_addr_°r
, c⁄n->
¥im¨y_ù
, 
MAX_IPADR_LEN
);

696 if(!
	`gëaddªssöfo
((
sockaddr
*)&
s¶oc
,

697 
c⁄n
->
loˇl_ù
, &c⁄n->
loˇl_p‹t
)) {

698 
îr‹
 = 
ERRNO
;

699 
	`Áûf
(
d©a
, "ssloc inet_ntop() failed withÉrrno %d: %s",

700 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

707 
	`Cuæ_≥rsi°c⁄nöfo
(
c⁄n
);

708 
	}
}

714 
CURLcode
 
	$Cuæ_is_c⁄√˘ed
(
c⁄√˘d©a
 *
c⁄n
,

715 
socködex
,

716 
boﬁ
 *
c⁄√˘ed
)

718 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

719 
CURLcode
 
code
 = 
CURLE_OK
;

720 
Ælow
;

721 
îr‹
 = 0;

722 
timevÆ
 
now
;

723 
ªsu…
;

724 
i
;

726 
	`DEBUGASSERT
(
socködex
 >
FIRSTSOCKET
 && socködex <
SECONDARYSOCKET
);

728 *
c⁄√˘ed
 = 
FALSE
;

730 if(
c⁄n
->
bôs
.
t˝c⁄√˘
[
socködex
]) {

732 *
c⁄√˘ed
 = 
TRUE
;

733  
CURLE_OK
;

736 
now
 = 
	`Cuæ_tvnow
();

739 
Ælow
 = 
	`Cuæ_timñe·
(
d©a
, &
now
, 
TRUE
);

741 if(
Ælow
 < 0) {

743 
	`Áûf
(
d©a
, "ConnectionÅime-out");

744  
CURLE_OPERATION_TIMEDOUT
;

747 
i
=0; i<2; i++) {

748 if(
c⁄n
->
ãmpsock
[
i
] =
CURL_SOCKET_BAD
)

751 #ifde‡
m≥ix


755 ()
	`vîifyc⁄√˘
(
c⁄n
->
ãmpsock
[
i
], 
NULL
);

759 
ªsu…
 = 
	`Cuæ_sockë_ªady
(
CURL_SOCKET_BAD
, 
c⁄n
->
ãmpsock
[
i
], 0);

761 if(
ªsu…
 == 0) {

762 if(
	`cuæx_tvdiff
(
now
, 
c⁄n
->
c⁄√˘time
Ë>c⁄n->
timeoutms_≥r_addr
) {

763 
	`öfof
(
d©a
, "After %ldms connectÅime, move on!\n",

764 
c⁄n
->
timeoutms_≥r_addr
);

765 
îr‹
 = 
ETIMEDOUT
;

769 if(
i
 =0 && 
c⁄n
->
ãm∑ddr
[1] =
NULL
 &&

770 
	`cuæx_tvdiff
(
now
, 
c⁄n
->
c⁄√˘time
Ë>
HAPPY_EYEBALLS_TIMEOUT
) {

771 
	`åy√xtù
(
c⁄n
, 
socködex
, 1);

774 if(
ªsu…
 =
CURL_CSELECT_OUT
) {

775 if(
	`vîifyc⁄√˘
(
c⁄n
->
ãmpsock
[
i
], &
îr‹
)) {

777 
Ÿhî
 = 
i
 ^ 1;

780 
c⁄n
->
sock
[
socködex
] = c⁄n->
ãmpsock
[
i
];

781 
c⁄n
->
ù_addr
 = c⁄n->
ãm∑ddr
[
i
];

782 
c⁄n
->
ãmpsock
[
i
] = 
CURL_SOCKET_BAD
;

785 if(
c⁄n
->
ãmpsock
[
Ÿhî
] !
CURL_SOCKET_BAD
) {

786 
	`Cuæ_˛o£sockë
(
c⁄n
, c⁄n->
ãmpsock
[
Ÿhî
]);

787 
c⁄n
->
ãmpsock
[
Ÿhî
] = 
CURL_SOCKET_BAD
;

791 
code
 = 
	`Cuæ_c⁄√˘ed_¥oxy
(
c⁄n
, 
socködex
);

792 if(
code
)

793  
code
;

795 
c⁄n
->
bôs
.
t˝c⁄√˘
[
socködex
] = 
TRUE
;

797 *
c⁄√˘ed
 = 
TRUE
;

798 if(
socködex
 =
FIRSTSOCKET
)

799 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_CONNECT
);

800 
	`Cuæ_upd©ec⁄nöfo
(
c⁄n
, c⁄n->
sock
[
socködex
]);

801 
	`Cuæ_vîbo£c⁄√˘
(
c⁄n
);

803  
CURLE_OK
;

806 
	`öfof
(
d©a
, "Connection failed\n");

808 if(
ªsu…
 & 
CURL_CSELECT_ERR
)

809 ()
	`vîifyc⁄√˘
(
c⁄n
->
ãmpsock
[
i
], &
îr‹
);

815 if(
îr‹
) {

816 
ùaddªss
[
MAX_IPADR_LEN
];

817 
d©a
->
°©e
.
os_î∫o
 = 
îr‹
;

818 
	`SET_SOCKERRNO
(
îr‹
);

819 if(
c⁄n
->
ãm∑ddr
[
i
]) {

820 
	`Cuæ_¥öèbÀ_addªss
(
c⁄n
->
ãm∑ddr
[
i
], 
ùaddªss
, 
MAX_IPADR_LEN
);

821 
	`öfof
(
d©a
, "connectÅo %sÖort %ld failed: %s\n",

822 
ùaddªss
, 
c⁄n
->
p‹t
, 
	`Cuæ_°ªº‹
(c⁄n, 
îr‹
));

824 
c⁄n
->
timeoutms_≥r_addr
 = c⁄n->
ãm∑ddr
[
i
]->
ai_√xt
 =
NULL
 ?

825 
Ælow
 :állow / 2;

827 
code
 = 
	`åy√xtù
(
c⁄n
, 
socködex
, 
i
);

832 if(
code
) {

837 if(
c⁄n
->
ãm∑ddr
[1] =
NULL
) {

838 
rc
;

839 
rc
 = 
	`åy√xtù
(
c⁄n
, 
socködex
, 1);

840 if(
rc
 =
CURLE_OK
)

841  
CURLE_OK
;

844 
	`Áûf
(
d©a
, "FailedÅo connectÅo %sÖort %ld: %s",

845 
c⁄n
->
bôs
.
¥oxy
?c⁄n->¥oxy.
«me
:c⁄n->
ho°
.name,

846 
c⁄n
->
p‹t
, 
	`Cuæ_°ªº‹
(c⁄n, 
îr‹
));

849  
code
;

850 
	}
}

852 
	$t˝nodñay
(
c⁄√˘d©a
 *
c⁄n
,

853 
cuæ_sockë_t
 
sockfd
)

855 #ifde‡
TCP_NODELAY


856 
Sessi⁄H™dÀ
 *
d©a

c⁄n
->data;

857 
cuæ_sockÀn_t
 
⁄off
 = (cuæ_sockÀn_tË
d©a
->
£t
.
t˝_nodñay
;

858 
Àvñ
 = 
IPPROTO_TCP
;

868 
¥Ÿ€¡
 *
≥
 = 
	`gë¥Ÿoby«me
("tcp");

869 if(
≥
)

870 
Àvñ
 = 
≥
->
p_¥Ÿo
;

873 if(
	`£tsock›t
(
sockfd
, 
Àvñ
, 
TCP_NODELAY
, (*)&
⁄off
,

874 (
⁄off
)) < 0)

875 
	`öfof
(
d©a
, "CouldÇot set TCP_NODELAY: %s\n",

876 
	`Cuæ_°ªº‹
(
c⁄n
, 
SOCKERRNO
));

878 
	`öfof
(
d©a
,"TCP_NODELAY set\n");

880 ()
c⁄n
;

881 ()
sockfd
;

883 
	}
}

885 #ifde‡
SO_NOSIGPIPE


890 
	$nosigpùe
(
c⁄√˘d©a
 *
c⁄n
,

891 
cuæ_sockë_t
 
sockfd
)

893 
Sessi⁄H™dÀ
 *
d©a

c⁄n
->data;

894 
⁄off
 = 1;

895 if(
	`£tsock›t
(
sockfd
, 
SOL_SOCKET
, 
SO_NOSIGPIPE
, (*)&
⁄off
,

896 (
⁄off
)) < 0)

897 
	`öfof
(
d©a
, "CouldÇot set SO_NOSIGPIPE: %s\n",

898 
	`Cuæ_°ªº‹
(
c⁄n
, 
SOCKERRNO
));

899 
	}
}

901 
	#nosigpùe
(
x
,
y
Ë
Cuæ_n›_°mt


	)

904 #ifde‡
USE_WINSOCK


917 
	#DETECT_OS_NONE
 0

	)

918 
	#DETECT_OS_PREVISTA
 1

	)

919 
	#DETECT_OS_VISTA_OR_LATER
 2

	)

921 
	$Cuæ_¢dbuf£t
(
cuæ_sockë_t
 
sockfd
)

923 
vÆ
 = 
CURL_MAX_WRITE_SIZE
 + 32;

924 
curvÆ
 = 0;

925 
cuæí
 = (
curvÆ
);

926 
DWORD
 
maj‹Vîsi⁄
 = 6;

928 
dëe˘OsSèã
 = 
DETECT_OS_NONE
;

930 if(
dëe˘OsSèã
 =
DETECT_OS_NONE
) {

931 #i‡!
	`deföed
(
_WIN32_WINNT
Ë|| !deföed(
_WIN32_WINNT_WIN2K
) || \

932 (
_WIN32_WINNT
 < 
_WIN32_WINNT_WIN2K
)

933 
OSVERSIONINFO
 
osvî
;

935 
	`mem£t
(&
osvî
, 0, (osver));

936 
osvî
.
dwOSVîsi⁄InfoSize
 = (osver);

938 
dëe˘OsSèã
 = 
DETECT_OS_PREVISTA
;

939 if(
	`GëVîsi⁄Ex
(&
osvî
)) {

940 if(
osvî
.
dwMaj‹Vîsi⁄
 >
maj‹Vîsi⁄
)

941 
dëe˘OsSèã
 = 
DETECT_OS_VISTA_OR_LATER
;

944 
ULONGLONG
 
maj‹Vîsi⁄Mask
;

945 
OSVERSIONINFOEX
 
osvî
;

947 
	`mem£t
(&
osvî
, 0, (osver));

948 
osvî
.
dwOSVîsi⁄InfoSize
 = (osver);

949 
osvî
.
dwMaj‹Vîsi⁄
 = 
maj‹Vîsi⁄
;

950 
maj‹Vîsi⁄Mask
 = 
	`VîSëC⁄dôi⁄Mask
(0, 
VER_MAJORVERSION
,

951 
VER_GREATER_EQUAL
);

953 if(
	`VîifyVîsi⁄Info
(&
osvî
, 
VER_MAJORVERSION
, 
maj‹Vîsi⁄Mask
))

954 
dëe˘OsSèã
 = 
DETECT_OS_VISTA_OR_LATER
;

956 
dëe˘OsSèã
 = 
DETECT_OS_PREVISTA
;

960 if(
dëe˘OsSèã
 =
DETECT_OS_VISTA_OR_LATER
)

963 if(
	`gësock›t
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, (*)&
curvÆ
, &
cuæí
) == 0)

964 if(
curvÆ
 > 
vÆ
)

967 
	`£tsock›t
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, (c⁄° *)&
vÆ
, (val));

968 
	}
}

980 
CURLcode


981 
	$sögÀùc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

982 c⁄° 
Cuæ_addröfo
 *
ai
,

983 
cuæ_sockë_t
 *
sockp
)

985 
Cuæ_sockaddr_ex
 
addr
;

986 
rc
;

987 
îr‹
 = 0;

988 
boﬁ
 
isc⁄√˘ed
 = 
FALSE
;

989 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

990 
cuæ_sockë_t
 
sockfd
;

991 
CURLcode
 
ªs
 = 
CURLE_OK
;

992 
ùaddªss
[
MAX_IPADR_LEN
];

993 
p‹t
;

995 *
sockp
 = 
CURL_SOCKET_BAD
;

997 
ªs
 = 
	`Cuæ_sockë
(
c⁄n
, 
ai
, &
addr
, &
sockfd
);

998 if(
ªs
)

1002  
CURLE_OK
;

1005 if(!
	`gëaddªssöfo
((
sockaddr
*)&
addr
.
ß_addr
,

1006 
ùaddªss
, &
p‹t
)) {

1008 
îr‹
 = 
ERRNO
;

1009 
	`Áûf
(
d©a
, "sa_addr inet_ntop() failed withÉrrno %d: %s",

1010 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

1011 
	`Cuæ_˛o£sockë
(
c⁄n
, 
sockfd
);

1012  
CURLE_OK
;

1014 
	`öfof
(
d©a
, " Tryög %s...\n", 
ùaddªss
);

1016 if(
d©a
->
£t
.
t˝_nodñay
)

1017 
	`t˝nodñay
(
c⁄n
, 
sockfd
);

1019 
	`nosigpùe
(
c⁄n
, 
sockfd
);

1021 
	`Cuæ_¢dbuf£t
(
sockfd
);

1023 if(
d©a
->
£t
.
t˝_kì∑live
)

1024 
	`t˝kì∑live
(
d©a
, 
sockfd
);

1026 if(
d©a
->
£t
.
fsock›t
) {

1028 
îr‹
 = 
d©a
->
£t
.
	`fsock›t
(d©a->£t.
sock›t_˛õ¡
,

1029 
sockfd
,

1030 
CURLSOCKTYPE_IPCXN
);

1032 if(
îr‹
 =
CURL_SOCKOPT_ALREADY_CONNECTED
)

1033 
isc⁄√˘ed
 = 
TRUE
;

1034 if(
îr‹
) {

1035 
	`Cuæ_˛o£sockë
(
c⁄n
, 
sockfd
);

1036  
CURLE_ABORTED_BY_CALLBACK
;

1041 
ªs
 = 
	`bödloˇl
(
c⁄n
, 
sockfd
, 
addr
.
Ámûy
);

1042 if(
ªs
) {

1043 
	`Cuæ_˛o£sockë
(
c⁄n
, 
sockfd
);

1044 if(
ªs
 =
CURLE_UNSUPPORTED_PROTOCOL
) {

1047  
CURLE_OK
;

1049  
ªs
;

1053 
	`cuæx_n⁄block
(
sockfd
, 
TRUE
);

1055 
c⁄n
->
c⁄√˘time
 = 
	`Cuæ_tvnow
();

1056 if(
c⁄n
->
num_addr
 > 1)

1057 
	`Cuæ_expúe
(
d©a
, 
c⁄n
->
timeoutms_≥r_addr
);

1060 if(!
isc⁄√˘ed
 && (
c⁄n
->
sockty≥
 =
SOCK_STREAM
)) {

1061 
rc
 = 
	`c⁄√˘
(
sockfd
, &
addr
.
ß_addr
,áddr.
addæí
);

1062 if(-1 =
rc
)

1063 
îr‹
 = 
SOCKERRNO
;

1066 *
sockp
 = 
sockfd
;

1067  
CURLE_OK
;

1070 #ifde‡
ENABLE_IPV6


1071 
c⁄n
->
bôs
.
ùv6
 = (
addr
.
Ámûy
 =
AF_INET6
)?
TRUE
:
FALSE
;

1074 if(-1 =
rc
) {

1075 
îr‹
) {

1076 
EINPROGRESS
:

1077 
EWOULDBLOCK
:

1078 #i‡
	`deföed
(
EAGAIN
)

1079 #i‡(
EAGAIN
Ë!(
EWOULDBLOCK
)

1084 
EAGAIN
:

1087 
ªs
 = 
CURLE_OK
;

1092 
	`öfof
(
d©a
, "Immediate connect fail for %s: %s\n",

1093 
ùaddªss
, 
	`Cuæ_°ªº‹
(
c⁄n
,
îr‹
));

1094 
d©a
->
°©e
.
os_î∫o
 = 
îr‹
;

1097 
	`Cuæ_˛o£sockë
(
c⁄n
, 
sockfd
);

1098 
ªs
 = 
CURLE_COULDNT_CONNECT
;

1102 if(!
ªs
)

1103 *
sockp
 = 
sockfd
;

1105  
ªs
;

1106 
	}
}

1114 
CURLcode
 
	$Cuæ_c⁄√˘ho°
(
c⁄√˘d©a
 *
c⁄n
,

1115 c⁄° 
Cuæ_dns_íåy
 *
ªmŸeho°
)

1117 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1118 
timevÆ
 
bef‹e
 = 
	`Cuæ_tvnow
();

1119 
CURLcode
 
ªs
 = 
CURLE_COULDNT_CONNECT
;

1121 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, &
bef‹e
, 
TRUE
);

1123 if(
timeout_ms
 < 0) {

1125 
	`Áûf
(
d©a
, "ConnectionÅime-out");

1126  
CURLE_OPERATION_TIMEDOUT
;

1129 
c⁄n
->
num_addr
 = 
	`Cuæ_num_addªs£s
(
ªmŸeho°
->
addr
);

1130 
c⁄n
->
ãm∑ddr
[0] = 
ªmŸeho°
->
addr
;

1131 
c⁄n
->
ãm∑ddr
[1] = 
NULL
;

1132 
c⁄n
->
ãmpsock
[0] = 
CURL_SOCKET_BAD
;

1133 
c⁄n
->
ãmpsock
[1] = 
CURL_SOCKET_BAD
;

1134 
	`Cuæ_expúe
(
c⁄n
->
d©a
, 
HAPPY_EYEBALLS_TIMEOUT
);

1137 
c⁄n
->
timeoutms_≥r_addr
 =

1138 
c⁄n
->
ãm∑ddr
[0]->
ai_√xt
 =
NULL
 ? 
timeout_ms
 :Åimeout_ms / 2;

1141 
c⁄n
->
ãm∑ddr
[0]) {

1142 
ªs
 = 
	`sögÀùc⁄√˘
(
c⁄n
, c⁄n->
ãm∑ddr
[0], &(c⁄n->
ãmpsock
[0]));

1143 if(
ªs
 =
CURLE_OK
)

1145 
c⁄n
->
ãm∑ddr
[0] = c⁄n->ãm∑ddr[0]->
ai_√xt
;

1148 if(
c⁄n
->
ãmpsock
[0] =
CURL_SOCKET_BAD
)

1149  
ªs
;

1151 
d©a
->
öfo
.
numc⁄√˘s
++;

1153  
CURLE_OK
;

1154 
	}
}

1156 
	sc⁄nföd
 {

1157 
c⁄√˘d©a
 *
	mtoföd
;

1158 
boﬁ
 
	mfound
;

1161 
	$c⁄n_is_c⁄n
(
c⁄√˘d©a
 *
c⁄n
, *
∑øm
)

1163 
c⁄nföd
 *
f
 = (c⁄nföd *)
∑øm
;

1164 if(
c⁄n
 =
f
->
toföd
) {

1165 
f
->
found
 = 
TRUE
;

1169 
	}
}

1177 
cuæ_sockë_t
 
	$Cuæ_gëc⁄√˘öfo
(
Sessi⁄H™dÀ
 *
d©a
,

1178 
c⁄√˘d©a
 **
c⁄≈
)

1180 
cuæ_sockë_t
 
sockfd
;

1182 
	`DEBUGASSERT
(
d©a
);

1186 if(
d©a
->
°©e
.
œ°c⁄√˘
 && d©a->
mu…i_ósy
) {

1187 
c⁄√˘d©a
 *
c
 = 
d©a
->
°©e
.
œ°c⁄√˘
;

1188 
c⁄nföd
 
föd
;

1189 
föd
.
toföd
 = 
d©a
->
°©e
.
œ°c⁄√˘
;

1190 
föd
.
found
 = 
FALSE
;

1192 
	`Cuæ_c⁄nˇche_f‹óch
(
d©a
->
mu…i_ósy
->
c⁄n_ˇche
, &
föd
, 
c⁄n_is_c⁄n
);

1194 if(!
föd
.
found
) {

1195 
d©a
->
°©e
.
œ°c⁄√˘
 = 
NULL
;

1196  
CURL_SOCKET_BAD
;

1199 if(
c⁄≈
)

1201 *
c⁄≈
 = 
c
;

1202 
sockfd
 = 
c
->
sock
[
FIRSTSOCKET
];

1205 if(
c
->
s¶
[
FIRSTSOCKET
].
u£
) {

1207 if(!
	`Cuæ_s¶_check_cxn
(
c
))

1208  
CURL_SOCKET_BAD
;

1211 #ifde‡
MSG_PEEK


1214 
buf
;

1215 if(
	`ªcv
((
RECV_TYPE_ARG1
)
c
->
sock
[
FIRSTSOCKET
], (
RECV_TYPE_ARG2
)&
buf
,

1216 (
RECV_TYPE_ARG3
)1, (
RECV_TYPE_ARG4
)
MSG_PEEK
) == 0) {

1217  
CURL_SOCKET_BAD
;

1223  
CURL_SOCKET_BAD
;

1225  
sockfd
;

1226 
	}
}

1233 
	$Cuæ_˛o£sockë
(
c⁄√˘d©a
 *
c⁄n
,

1234 
cuæ_sockë_t
 
sock
)

1236 if(
c⁄n
 && c⁄n->
f˛o£sockë
) {

1237 if((
sock
 =
c⁄n
->sock[
SECONDARYSOCKET
]) &&

1238 
c⁄n
->
sock_ac˚±ed
[
SECONDARYSOCKET
])

1242 
c⁄n
->
sock_ac˚±ed
[
SECONDARYSOCKET
] = 
FALSE
;

1244  
c⁄n
->
	`f˛o£sockë
(c⁄n->
˛o£sockë_˛õ¡
, 
sock
);

1246 
	`s˛o£
(
sock
);

1248 if(
c⁄n
)

1250 
	`Cuæ_mu…i_˛o£d
(
c⁄n
, 
sock
);

1253 
	}
}

1264 
CURLcode
 
	$Cuæ_sockë
(
c⁄√˘d©a
 *
c⁄n
,

1265 c⁄° 
Cuæ_addröfo
 *
ai
,

1266 
Cuæ_sockaddr_ex
 *
addr
,

1267 
cuæ_sockë_t
 *
sockfd
)

1269 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1270 
Cuæ_sockaddr_ex
 
dummy
;

1272 if(!
addr
)

1274 
addr
 = &
dummy
;

1284 
addr
->
Ámûy
 = 
ai
->
ai_Ámûy
;

1285 
addr
->
sockty≥
 = 
c⁄n
->socktype;

1286 
addr
->
¥Ÿocﬁ
 = 
c⁄n
->
sockty≥
==
SOCK_DGRAM
?
IPPROTO_UDP
:
ai
->
ai_¥Ÿocﬁ
;

1287 
addr
->
addæí
 = 
ai
->
ai_addæí
;

1289 if(
addr
->
addæí
 > (
Cuæ_sockaddr_°‹age
))

1290 
addr
->
addæí
 = (
Cuæ_sockaddr_°‹age
);

1291 
	`mem˝y
(&
addr
->
ß_addr
, 
ai
->
ai_addr
,áddr->
addæí
);

1293 if(
d©a
->
£t
.
f›ísockë
)

1303 *
sockfd
 = 
d©a
->
£t
.
	`f›ísockë
(d©a->£t.
›ísockë_˛õ¡
,

1304 
CURLSOCKTYPE_IPCXN
,

1305 (
cuæ_sockaddr
 *)
addr
);

1308 *
sockfd
 = 
	`sockë
(
addr
->
Ámûy
,áddr->
sockty≥
,áddr->
¥Ÿocﬁ
);

1310 if(*
sockfd
 =
CURL_SOCKET_BAD
)

1312  
CURLE_COULDNT_CONNECT
;

1314 #i‡
	`deföed
(
ENABLE_IPV6
Ë&& deföed(
HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID
)

1315 if(
c⁄n
->
sc›e
 && (
addr
->
Ámûy
 =
AF_INET6
)) {

1316 
sockaddr_ö6
 * c⁄° 
ß6
 = (*)&
addr
->
ß_addr
;

1317 
ß6
->
sö6_sc›e_id
 = 
c⁄n
->
sc›e
;

1321  
CURLE_OK
;

1323 
	}
}

1325 #ifde‡
CURLDEBUG


1332 
	$Cuæ_c⁄nc⁄åﬁ
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
˛o£ô
,

1333 c⁄° *
ªas⁄
)

1335 
	`öfof
(
c⁄n
->
d©a
, "M¨ked f‹ [%s]: %s\n", 
˛o£ô
?"closure":"keepálive",

1336 
ªas⁄
);

1337 
c⁄n
->
bôs
.
˛o£
 = 
˛o£ô
;

1339 
	}
}

	@lib/connect.h

1 #i‚de‡
HEADER_CURL_CONNECT_H


2 
	#HEADER_CURL_CONNECT_H


	)

24 
	~"cuæ_£tup.h
"

26 
	~"n⁄block.h
"

27 
	~"sockaddr.h
"

29 
CURLcode
 
Cuæ_is_c⁄√˘ed
(
c⁄√˘d©a
 *
c⁄n
,

30 
socködex
,

31 
boﬁ
 *
c⁄√˘ed
);

33 
CURLcode
 
Cuæ_c⁄√˘ho°
(
c⁄√˘d©a
 *
c⁄n
,

34 c⁄° 
Cuæ_dns_íåy
 *
ho°
);

38 
Cuæ_timñe·
(
Sessi⁄H™dÀ
 *
d©a
,

39 
timevÆ
 *
nowp
,

40 
boﬁ
 
durögc⁄√˘
);

42 
	#DEFAULT_CONNECT_TIMEOUT
 300000

	)

43 
	#HAPPY_EYEBALLS_TIMEOUT
 200

	)

52 
cuæ_sockë_t
 
Cuæ_gëc⁄√˘öfo
(
Sessi⁄H™dÀ
 *
d©a
,

53 
c⁄√˘d©a
 **
c⁄≈
);

55 #ifde‡
USE_WINSOCK


65 
Cuæ_¢dbuf£t
(
cuæ_sockë_t
 
sockfd
);

67 
	#Cuæ_¢dbuf£t
(
y
Ë
Cuæ_n›_°mt


	)

70 
Cuæ_upd©ec⁄nöfo
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 
sockfd
);

71 
Cuæ_≥rsi°c⁄nöfo
(
c⁄√˘d©a
 *
c⁄n
);

72 
Cuæ_˛o£sockë
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 
sock
);

81 
	sCuæ_sockaddr_ex
 {

82 
	mÁmûy
;

83 
	msockty≥
;

84 
	m¥Ÿocﬁ
;

85 
	maddæí
;

87 
sockaddr
 
	maddr
;

88 
Cuæ_sockaddr_°‹age
 
	mbuff
;

89 } 
	m_ß_ex_u
;

91 
	#ß_addr
 
_ß_ex_u
.
addr


	)

100 
CURLcode
 
Cuæ_sockë
(
c⁄√˘d©a
 *
c⁄n
,

101 c⁄° 
Cuæ_addröfo
 *
ai
,

102 
Cuæ_sockaddr_ex
 *
addr
,

103 
cuæ_sockë_t
 *
sockfd
);

105 #ifde‡
CURLDEBUG


110 
Cuæ_c⁄nc⁄åﬁ
(
c⁄√˘d©a
 *
c⁄n
,

111 
boﬁ
 
˛o£ô
,

112 c⁄° *
ªas⁄
);

113 
	#c⁄n˛o£
(
x
,
y
Ë
	`Cuæ_c⁄nc⁄åﬁ
(x,
TRUE
, y)

	)

114 
	#c⁄nkìp
(
x
,
y
Ë
	`Cuæ_c⁄nc⁄åﬁ
(x, 
FALSE
, y)

	)

117 
	#c⁄n˛o£
(
x
,
y
Ë(x)->
bôs
.
˛o£
 = 
TRUE


	)

118 
	#c⁄nkìp
(
x
,
y
Ë(x)->
bôs
.
˛o£
 = 
FALSE


	)

	@lib/content_encoding.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_LIBZ


27 
	~"uæd©a.h
"

28 
	~<cuæ/cuæ.h
>

29 
	~"£ndf.h
"

30 
	~"c⁄ã¡_ícodög.h
"

31 
	~"cuæ_mem‹y.h
"

33 
	~"memdebug.h
"

37 
	#OLD_ZLIB_SUPPORT
 1

	)

39 
	#DSIZ
 
CURL_MAX_WRITE_SIZE


	)

41 
	#GZIP_MAGIC_0
 0x1f

	)

42 
	#GZIP_MAGIC_1
 0x8b

	)

45 
	#ASCII_FLAG
 0x01

	)

46 
	#HEAD_CRC
 0x02

	)

47 
	#EXTRA_FIELD
 0x04

	)

48 
	#ORIG_NAME
 0x08

	)

49 
	#COMMENT
 0x10

	)

50 
	#RESERVED
 0xE0

	)

52 
voidpf


53 
	$zÆloc_cb
(
voidpf
 
›aque
, 
ôems
, 
size
)

55 (Ë
›aque
;

57  (
voidpf
Ë
	`ˇŒoc
(
ôems
, 
size
);

58 
	}
}

61 
	$z‰ì_cb
(
voidpf
 
›aque
, voidp‡
±r
)

63 (Ë
›aque
;

64 
	`‰ì
(
±r
);

65 
	}
}

67 
CURLcode


68 
	$¥o˚ss_zlib_îr‹
(
c⁄√˘d©a
 *
c⁄n
, 
z_°ªam
 *
z
)

70 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

71 if(
z
->
msg
)

72 
	`Áûf
 (
d©a
, "Error whileÖrocessing content unencoding: %s",

73 
z
->
msg
);

75 
	`Áûf
 (
d©a
, "Error whileÖrocessing content unencoding: "

78  
CURLE_BAD_CONTENT_ENCODING
;

79 
	}
}

81 
CURLcode


82 
	$exô_zlib
(
z_°ªam
 *
z
, 
zlibInôSèã
 *
zlib_öô
, 
CURLcode
 
ªsu…
)

84 
	`öÊ©eEnd
(
z
);

85 *
zlib_öô
 = 
ZLIB_UNINIT
;

86  
ªsu…
;

87 
	}
}

89 
CURLcode


90 
	$öÊ©e_°ªam
(
c⁄√˘d©a
 *
c⁄n
,

91 
SögÀReque°
 *
k
)

93 
Ælow_ª°¨t
 = 1;

94 
z_°ªam
 *
z
 = &
k
->z;

95 
uI¡
 
ƒód
 = 
z
->
avaû_ö
;

96 
Byãf
 *
‹ig_ö
 = 
z
->
√xt_ö
;

97 
°©us
;

98 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

99 *
decomp
;

103 
decomp
 = 
	`mÆloc
(
DSIZ
);

104 if(
decomp
 =
NULL
) {

105  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
CURLE_OUT_OF_MEMORY
);

112 
z
->
√xt_out
 = (
Byãf
 *)
decomp
;

113 
z
->
avaû_out
 = 
DSIZ
;

115 
°©us
 = 
	`öÊ©e
(
z
, 
Z_SYNC_FLUSH
);

116 if(
°©us
 =
Z_OK
 || sètu†=
Z_STREAM_END
) {

117 
Ælow_ª°¨t
 = 0;

118 if((
DSIZ
 - 
z
->
avaû_out
Ë&& (!
k
->
ign‹ebody
)) {

119 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
decomp
,

120 
DSIZ
 - 
z
->
avaû_out
);

122 if(
ªsu…
) {

123 
	`‰ì
(
decomp
);

124  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
ªsu…
);

129 if(
°©us
 =
Z_STREAM_END
) {

130 
	`‰ì
(
decomp
);

131 if(
	`öÊ©eEnd
(
z
Ë=
Z_OK
)

132  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
ªsu…
);

134  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
	`¥o˚ss_zlib_îr‹
(
c⁄n
, z));

140 if(
z
->
avaû_ö
 == 0) {

141 
	`‰ì
(
decomp
);

142  
ªsu…
;

145 if(
Ælow_ª°¨t
 && 
°©us
 =
Z_DATA_ERROR
) {

149 (Ë
	`öÊ©eEnd
(
z
);

150 if(
	`öÊ©eInô2
(
z
, -
MAX_WBITS
Ë!
Z_OK
) {

151 
	`‰ì
(
decomp
);

152  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
	`¥o˚ss_zlib_îr‹
(
c⁄n
, z));

154 
z
->
√xt_ö
 = 
‹ig_ö
;

155 
z
->
avaû_ö
 = 
ƒód
;

156 
Ælow_ª°¨t
 = 0;

160 
	`‰ì
(
decomp
);

161  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
	`¥o˚ss_zlib_îr‹
(
c⁄n
, z));

165 
	}
}

167 
CURLcode


168 
	$Cuæ_u√ncode_deÊ©e_wrôe
(
c⁄√˘d©a
 *
c⁄n
,

169 
SögÀReque°
 *
k
,

170 
ssize_t
 
ƒód
)

172 
z_°ªam
 *
z
 = &
k
->z;

175 if(
k
->
zlib_öô
 =
ZLIB_UNINIT
) {

176 
	`mem£t
(
z
, 0, (
z_°ªam
));

177 
z
->
zÆloc
 = (
Æloc_func
)
zÆloc_cb
;

178 
z
->
z‰ì
 = (
‰ì_func
)
z‰ì_cb
;

180 if(
	`öÊ©eInô
(
z
Ë!
Z_OK
)

181  
	`¥o˚ss_zlib_îr‹
(
c⁄n
, 
z
);

182 
k
->
zlib_öô
 = 
ZLIB_INIT
;

186 
z
->
√xt_ö
 = (
Byãf
 *)
k
->
°r
;

187 
z
->
avaû_ö
 = (
uI¡
)
ƒód
;

190  
	`öÊ©e_°ªam
(
c⁄n
, 
k
);

191 
	}
}

193 #ifde‡
OLD_ZLIB_SUPPORT


196 
	mGZIP_OK
,

197 
	mGZIP_BAD
,

198 
	mGZIP_UNDERFLOW


199 } 
	$check_gzù_hódî
(c⁄° *
d©a
, 
ssize_t
 
Àn
, ssize_à*
hódîÀn
)

201 
mëhod
, 
Êags
;

202 c⁄° 
ssize_t
 
tŸÆÀn
 = 
Àn
;

205 if(
Àn
 < 10)

206  
GZIP_UNDERFLOW
;

208 if((
d©a
[0] !
GZIP_MAGIC_0
Ë|| (d©a[1] !
GZIP_MAGIC_1
))

209  
GZIP_BAD
;

211 
mëhod
 = 
d©a
[2];

212 
Êags
 = 
d©a
[3];

214 if(
mëhod
 !
Z_DEFLATED
 || (
Êags
 & 
RESERVED
) != 0) {

216  
GZIP_BAD
;

220 
Àn
 -= 10;

221 
d©a
 += 10;

223 if(
Êags
 & 
EXTRA_FIELD
) {

224 
ssize_t
 
exåa_Àn
;

226 if(
Àn
 < 2)

227  
GZIP_UNDERFLOW
;

229 
exåa_Àn
 = (
d©a
[1] << 8) | data[0];

231 if(
Àn
 < (
exåa_Àn
+2))

232  
GZIP_UNDERFLOW
;

234 
Àn
 -(
exåa_Àn
 + 2);

235 
d©a
 +(
exåa_Àn
 + 2);

238 if(
Êags
 & 
ORIG_NAME
) {

240 
Àn
 && *
d©a
) {

241 --
Àn
;

242 ++
d©a
;

244 if(!
Àn
 || *
d©a
)

245  
GZIP_UNDERFLOW
;

248 --
Àn
;

249 ++
d©a
;

252 if(
Êags
 & 
COMMENT
) {

254 
Àn
 && *
d©a
) {

255 --
Àn
;

256 ++
d©a
;

258 if(!
Àn
 || *
d©a
)

259  
GZIP_UNDERFLOW
;

262 --
Àn
;

265 if(
Êags
 & 
HEAD_CRC
) {

266 if(
Àn
 < 2)

267  
GZIP_UNDERFLOW
;

269 
Àn
 -= 2;

272 *
hódîÀn
 = 
tŸÆÀn
 - 
Àn
;

273  
GZIP_OK
;

274 
	}
}

277 
CURLcode


278 
	$Cuæ_u√ncode_gzù_wrôe
(
c⁄√˘d©a
 *
c⁄n
,

279 
SögÀReque°
 *
k
,

280 
ssize_t
 
ƒód
)

282 
z_°ªam
 *
z
 = &
k
->z;

285 if(
k
->
zlib_öô
 =
ZLIB_UNINIT
) {

286 
	`mem£t
(
z
, 0, (
z_°ªam
));

287 
z
->
zÆloc
 = (
Æloc_func
)
zÆloc_cb
;

288 
z
->
z‰ì
 = (
‰ì_func
)
z‰ì_cb
;

290 if(
	`°rcmp
(
	`zlibVîsi⁄
(), "1.2.0.4") >= 0) {

292 if(
	`öÊ©eInô2
(
z
, 
MAX_WBITS
+32Ë!
Z_OK
) {

293  
	`¥o˚ss_zlib_îr‹
(
c⁄n
, 
z
);

295 
k
->
zlib_öô
 = 
ZLIB_INIT_GZIP
;

299 if(
	`öÊ©eInô2
(
z
, -
MAX_WBITS
Ë!
Z_OK
) {

300  
	`¥o˚ss_zlib_îr‹
(
c⁄n
, 
z
);

302 
k
->
zlib_öô
 = 
ZLIB_INIT
;

306 if(
k
->
zlib_öô
 =
ZLIB_INIT_GZIP
) {

308 
z
->
√xt_ö
 = (
Byãf
 *)
k
->
°r
;

309 
z
->
avaû_ö
 = (
uI¡
)
ƒód
;

311  
	`öÊ©e_°ªam
(
c⁄n
, 
k
);

314 #i‚de‡
OLD_ZLIB_SUPPORT


317  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
CURLE_FUNCTION_NOT_FOUND
);

330 
k
->
zlib_öô
) {

332 
ZLIB_INIT
:

335 
ssize_t
 
hÀn
;

337 
	`check_gzù_hódî
((*)
k
->
°r
, 
ƒód
, &
hÀn
)) {

338 
GZIP_OK
:

339 
z
->
√xt_ö
 = (
Byãf
 *)
k
->
°r
 + 
hÀn
;

340 
z
->
avaû_ö
 = (
uI¡
)(
ƒód
 - 
hÀn
);

341 
k
->
zlib_öô
 = 
ZLIB_GZIP_INFLATING
;

344 
GZIP_UNDERFLOW
:

352 
z
->
avaû_ö
 = (
uI¡
)
ƒód
;

353 
z
->
√xt_ö
 = 
	`mÆloc
(z->
avaû_ö
);

354 if(
z
->
√xt_ö
 =
NULL
) {

355  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
CURLE_OUT_OF_MEMORY
);

357 
	`mem˝y
(
z
->
√xt_ö
, 
k
->
°r
, z->
avaû_ö
);

358 
k
->
zlib_öô
 = 
ZLIB_GZIP_HEADER
;

360  
CURLE_OK
;

362 
GZIP_BAD
:

364  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
	`¥o˚ss_zlib_îr‹
(
c⁄n
, z));

370 
ZLIB_GZIP_HEADER
:

373 
ssize_t
 
hÀn
;

374 *
ﬁdblock
 = 
z
->
√xt_ö
;

376 
z
->
avaû_ö
 +(
uI¡
)
ƒód
;

377 
z
->
√xt_ö
 = 
	`ªÆloc
(z->√xt_ö, z->
avaû_ö
);

378 if(
z
->
√xt_ö
 =
NULL
) {

379 
	`‰ì
(
ﬁdblock
);

380  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
CURLE_OUT_OF_MEMORY
);

383 
	`mem˝y
(
z
->
√xt_ö
 + z->
avaû_ö
 - 
ƒód
, 
k
->
°r
,Çread);

385 
	`check_gzù_hódî
(
z
->
√xt_ö
, z->
avaû_ö
, &
hÀn
)) {

386 
GZIP_OK
:

388 
	`‰ì
(
z
->
√xt_ö
);

390 
z
->
√xt_ö
 = (
Byãf
 *)
k
->
°r
 + 
hÀn
 + 
ƒód
 - z->
avaû_ö
;

391 
z
->
avaû_ö
 = (
uI¡
)(z->avaû_ö - 
hÀn
);

392 
k
->
zlib_öô
 = 
ZLIB_GZIP_INFLATING
;

395 
GZIP_UNDERFLOW
:

397  
CURLE_OK
;

399 
GZIP_BAD
:

401 
	`‰ì
(
z
->
√xt_ö
);

402  
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
	`¥o˚ss_zlib_îr‹
(
c⁄n
, z));

408 
ZLIB_GZIP_INFLATING
:

411 
z
->
√xt_ö
 = (
Byãf
 *)
k
->
°r
;

412 
z
->
avaû_ö
 = (
uI¡
)
ƒód
;

416 if(
z
->
avaû_ö
 == 0) {

418  
CURLE_OK
;

422  
	`öÊ©e_°ªam
(
c⁄n
, 
k
);

424 
	}
}

426 
	$Cuæ_u√ncode_˛ónup
(
c⁄√˘d©a
 *
c⁄n
)

428 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

429 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

430 
z_°ªam
 *
z
 = &
k
->z;

431 if(
k
->
zlib_öô
 !
ZLIB_UNINIT
)

432 (Ë
	`exô_zlib
(
z
, &
k
->
zlib_öô
, 
CURLE_OK
);

433 
	}
}

	@lib/content_encoding.h

1 #i‚de‡
HEADER_CURL_CONTENT_ENCODING_H


2 
	#HEADER_CURL_CONTENT_ENCODING_H


	)

24 
	~"cuæ_£tup.h
"

29 #ifde‡
HAVE_LIBZ


30 
	#ALL_CONTENT_ENCODINGS
 "deÊ©e, gzù"

	)

32 
Cuæ_u√ncode_˛ónup
(
c⁄√˘d©a
 *
c⁄n
);

34 
	#ALL_CONTENT_ENCODINGS
 "idítôy"

	)

35 
	#Cuæ_u√ncode_˛ónup
(
x
Ë
Cuæ_n›_°mt


	)

38 
CURLcode
 
Cuæ_u√ncode_deÊ©e_wrôe
(
c⁄√˘d©a
 *
c⁄n
,

39 
SögÀReque°
 *
ªq
,

40 
ssize_t
 
ƒód
);

42 
CURLcode


43 
Cuæ_u√ncode_gzù_wrôe
(
c⁄√˘d©a
 *
c⁄n
,

44 
SögÀReque°
 *
k
,

45 
ssize_t
 
ƒód
);

	@lib/cookie.c

80 
	~"cuæ_£tup.h
"

82 #i‡!
deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_COOKIES
)

84 
	#_MPRINTF_REPLACE


	)

85 
	~<cuæ/m¥ötf.h
>

87 
	~"uæd©a.h
"

88 
	~"cookõ.h
"

89 
	~"°ªquÆ.h
"

90 
	~"°πok.h
"

91 
	~"£ndf.h
"

92 
	~"¶i°.h
"

93 
	~"cuæ_mem‹y.h
"

94 
	~"sh¨e.h
"

95 
	~"°πoof·.h
"

96 
	~"øw°r.h
"

97 
	~"cuæ_memrchr.h
"

100 
	~"memdebug.h
"

102 
	$‰ìcookõ
(
Cookõ
 *
co
)

104 if(
co
->
expúe°r
)

105 
	`‰ì
(
co
->
expúe°r
);

106 if(
co
->
domaö
)

107 
	`‰ì
(
co
->
domaö
);

108 if(
co
->
∑th
)

109 
	`‰ì
(
co
->
∑th
);

110 if(
co
->
•©h
)

111 
	`‰ì
(
co
->
•©h
);

112 if(
co
->
«me
)

113 
	`‰ì
(
co
->
«me
);

114 if(
co
->
vÆue
)

115 
	`‰ì
(
co
->
vÆue
);

116 if(
co
->
maxage
)

117 
	`‰ì
(
co
->
maxage
);

118 if(
co
->
vîsi⁄
)

119 
	`‰ì
(
co
->
vîsi⁄
);

121 
	`‰ì
(
co
);

122 
	}
}

124 
boﬁ
 
	$èûm©ch
(c⁄° *
cooke_domaö
, c⁄° *
ho°«me
)

126 
size_t
 
cookõ_domaö_Àn
 = 
	`°æí
(
cooke_domaö
);

127 
size_t
 
ho°«me_Àn
 = 
	`°æí
(
ho°«me
);

129 if(
ho°«me_Àn
 < 
cookõ_domaö_Àn
)

130  
FALSE
;

132 if(!
	`Cuæ_øw_equÆ
(
cooke_domaö
, 
ho°«me
+
ho°«me_Àn
-
cookõ_domaö_Àn
))

133  
FALSE
;

142 if(
ho°«me_Àn
 =
cookõ_domaö_Àn
)

143  
TRUE
;

144 if('.' =*(
ho°«me
 + 
ho°«me_Àn
 - 
cookõ_domaö_Àn
 - 1))

145  
TRUE
;

146  
FALSE
;

147 
	}
}

153 
boﬁ
 
	$∑thm©ch
(c⁄° * 
cookõ_∑th
, c⁄° * 
ªque°_uri
)

155 
size_t
 
cookõ_∑th_Àn
;

156 
size_t
 
uri_∑th_Àn
;

157 * 
uri_∑th
 = 
NULL
;

158 * 
pos
;

159 
boﬁ
 
ªt
 = 
FALSE
;

162 
cookõ_∑th_Àn
 = 
	`°æí
(
cookõ_∑th
);

163 if(1 =
cookõ_∑th_Àn
) {

165  
TRUE
;

168 
uri_∑th
 = 
	`°rdup
(
ªque°_uri
);

169 if(!
uri_∑th
)

170  
FALSE
;

171 
pos
 = 
	`°rchr
(
uri_∑th
, '?');

172 if(
pos
)

173 *
pos
 = 0x0;

176 if(0 =
	`°æí
(
uri_∑th
) || uri_path[0] != '/') {

177 
	`‰ì
(
uri_∑th
);

178 
uri_∑th
 = 
	`°rdup
("/");

179 if(!
uri_∑th
)

180  
FALSE
;

192 
uri_∑th_Àn
 = 
	`°æí
(
uri_∑th
);

194 if(
uri_∑th_Àn
 < 
cookõ_∑th_Àn
) {

195 
ªt
 = 
FALSE
;

196 
∑thm©ched
;

200 if(
	`°∫cmp
(
cookõ_∑th
, 
uri_∑th
, 
cookõ_∑th_Àn
)) {

201 
ªt
 = 
FALSE
;

202 
∑thm©ched
;

206 if(
cookõ_∑th_Àn
 =
uri_∑th_Àn
) {

207 
ªt
 = 
TRUE
;

208 
∑thm©ched
;

212 if(
uri_∑th
[
cookõ_∑th_Àn
] == '/') {

213 
ªt
 = 
TRUE
;

214 
∑thm©ched
;

217 
ªt
 = 
FALSE
;

219 
∑thm©ched
:

220 
	`‰ì
(
uri_∑th
);

221  
ªt
;

222 
	}
}

227 *
	$ßnôize_cookõ_∑th
(c⁄° *
cookõ_∑th
)

229 
size_t
 
Àn
;

230 *
√w_∑th
 = 
	`°rdup
(
cookõ_∑th
);

231 if(!
√w_∑th
)

232  
NULL
;

235 if(
√w_∑th
[0] == '\"') {

236 
	`memmove
((*)
√w_∑th
, (c⁄° *)“ew_∑th + 1), 
	`°æí
(new_path));

238 if(
√w_∑th
[
	`°æí
(new_path) - 1] == '\"') {

239 
√w_∑th
[
	`°æí
(new_path) - 1] = 0x0;

243 if(
√w_∑th
[0] != '/') {

245 
	`‰ì
(
√w_∑th
);

246 
√w_∑th
 = 
	`°rdup
("/");

247  
√w_∑th
;

251 
Àn
 = 
	`°æí
(
√w_∑th
);

252 if(1 < 
Àn
 && 
√w_∑th
[len - 1] == '/') {

253 
√w_∑th
[
Àn
 - 1] = 0x0;

256  
√w_∑th
;

257 
	}
}

262 
	$Cuæ_cookõ_lﬂdfûes
(
Sessi⁄H™dÀ
 *
d©a
)

264 
cuæ_¶i°
 *
li°
 = 
d©a
->
ch™ge
.
cookõli°
;

265 if(
li°
) {

266 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
, 
CURL_LOCK_ACCESS_SINGLE
);

267 
li°
) {

268 
d©a
->
cookõs
 = 
	`Cuæ_cookõ_öô
(data,

269 
li°
->
d©a
,

270 
d©a
->
cookõs
,

271 
d©a
->
£t
.
cookõ£ssi⁄
);

272 
li°
 =Üi°->
√xt
;

274 
	`cuæ_¶i°_‰ì_Æl
(
d©a
->
ch™ge
.
cookõli°
);

275 
d©a
->
ch™ge
.
cookõli°
 = 
NULL
;

276 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
);

278 
	}
}

286 
	$°r°‹e
(**
°r
, c⁄° *
√w°r
)

288 if(*
°r
)

289 
	`‰ì
(*
°r
);

290 *
°r
 = 
	`°rdup
(
√w°r
);

291 
	}
}

296 
	$ªmove_expúed
(
CookõInfo
 *
cookõs
)

298 
Cookõ
 *
co
, *
nx
, *
pv
;

299 
cuæ_off_t
 
now
 = (cuæ_off_t)
	`time
(
NULL
);

301 
co
 = 
cookõs
->cookies;

302 
pv
 = 
NULL
;

303 
co
) {

304 
nx
 = 
co
->
√xt
;

305 if((
co
->
expúe°r
 || co->
maxage
Ë&& co->
expúes
 < 
now
) {

306 if(
co
 =
cookõs
->cookies) {

307 
cookõs
->cookõ†
co
->
√xt
;

310 
pv
->
√xt
 = 
co
->next;

312 
cookõs
->
numcookõs
--;

313 
	`‰ìcookõ
(
co
);

316 
pv
 = 
co
;

318 
co
 = 
nx
;

320 
	}
}

333 
Cookõ
 *

334 
	$Cuæ_cookõ_add
(
Sessi⁄H™dÀ
 *
d©a
,

339 
CookõInfo
 *
c
,

340 
boﬁ
 
hâphódî
,

341 *
löïå
,

342 c⁄° *
domaö
,

343 c⁄° *
∑th
)

347 
Cookõ
 *
˛i°
;

348 
«me
[
MAX_NAME
];

349 
Cookõ
 *
co
;

350 
Cookõ
 *
œ°c
=
NULL
;

351 
time_t
 
now
 = 
	`time
(
NULL
);

352 
boﬁ
 
ª∂a˚_ﬁd
 = 
FALSE
;

353 
boﬁ
 
badcookõ
 = 
FALSE
;

355 #ifde‡
CURL_DISABLE_VERBOSE_STRINGS


356 ()
d©a
;

360 
co
 = 
	`ˇŒoc
(1, (
Cookõ
));

361 if(!
co
)

362  
NULL
;

364 if(
hâphódî
) {

366 c⁄° *
±r
;

367 c⁄° *
£mùå
;

368 *
wh©
;

370 
wh©
 = 
	`mÆloc
(
MAX_COOKIE_LINE
);

371 if(!
wh©
) {

372 
	`‰ì
(
co
);

373  
NULL
;

376 
£mùå
=
	`°rchr
(
löïå
, ';');

378 *
löïå
 && 
	`ISBLANK
(*lineptr))

379 
löïå
++;

381 
±r
 = 
löïå
;

384 
«me
[0]=
wh©
[0]=0;

385 if(1 <
	`ssˇnf
(
±r
, "%" 
MAX_NAME_TXT
 "[^;\r\n =]=%"

386 
MAX_COOKIE_LINE_TXT
 "[^;\r\n]",

387 
«me
, 
wh©
)) {

391 c⁄° *
wh©±r
;

392 
boﬁ
 
d⁄e
 = 
FALSE
;

393 
boﬁ
 
£p
;

394 
size_t
 
Àn
=
	`°æí
(
wh©
);

395 c⁄° *
ído‚
 = &
±r
[ 
	`°æí
(
«me
) ];

398 *
ído‚
 && 
	`ISBLANK
(*endofn))

399 
ído‚
++;

402 
£p
 = (*
ído‚
 ='=')?
TRUE
:
FALSE
;

405 
Àn
 && 
	`ISBLANK
(
wh©
[len-1])) {

406 
wh©
[
Àn
-1]=0;

407 
Àn
--;

411 
wh©±r
=
wh©
;

412 *
wh©±r
 && 
	`ISBLANK
(*whatptr))

413 
wh©±r
++;

415 if(!
Àn
) {

418 
d⁄e
 = 
TRUE
;

419 if(
	`Cuæ_øw_equÆ
("£cuª", 
«me
))

420 
co
->
£cuª
 = 
TRUE
;

421 if(
	`Cuæ_øw_equÆ
("hâp⁄ly", 
«me
))

422 
co
->
hâp⁄ly
 = 
TRUE
;

423 if(
£p
)

425 
d⁄e
 = 
FALSE
;

427 if(
d⁄e
)

429 if(
	`Cuæ_øw_equÆ
("∑th", 
«me
)) {

430 
	`°r°‹e
(&
co
->
∑th
, 
wh©±r
);

431 if(!
co
->
∑th
) {

432 
badcookõ
 = 
TRUE
;

435 
co
->
•©h
 = 
	`ßnôize_cookõ_∑th
(co->
∑th
);

436 if(!
co
->
•©h
) {

437 
badcookõ
 = 
TRUE
;

441 if(
	`Cuæ_øw_equÆ
("domaö", 
«me
)) {

445 if('.' =
wh©±r
[0])

446 
wh©±r
++;

448 if(!
domaö
 || 
	`èûm©ch
(
wh©±r
, domain)) {

449 c⁄° *
èû±r
=
wh©±r
;

450 if(
èû±r
[0] == '.')

451 
èû±r
++;

452 
	`°r°‹e
(&
co
->
domaö
, 
èû±r
);

454 if(!
co
->
domaö
) {

455 
badcookõ
 = 
TRUE
;

458 
co
->
èûm©ch
=
TRUE
;

465 
badcookõ
=
TRUE
;

466 
	`öfof
(
d©a
, "skipped cookie with badÅailmatch domain: %s\n",

467 
wh©±r
);

470 if(
	`Cuæ_øw_equÆ
("vîsi⁄", 
«me
)) {

471 
	`°r°‹e
(&
co
->
vîsi⁄
, 
wh©±r
);

472 if(!
co
->
vîsi⁄
) {

473 
badcookõ
 = 
TRUE
;

477 if(
	`Cuæ_øw_equÆ
("max-age", 
«me
)) {

487 
	`°r°‹e
(&
co
->
maxage
, 
wh©±r
);

488 if(!
co
->
maxage
) {

489 
badcookõ
 = 
TRUE
;

493 if(
	`Cuæ_øw_equÆ
("expúes", 
«me
)) {

494 
	`°r°‹e
(&
co
->
expúe°r
, 
wh©±r
);

495 if(!
co
->
expúe°r
) {

496 
badcookõ
 = 
TRUE
;

500 if(!
co
->
«me
) {

501 
co
->
«me
 = 
	`°rdup
(name);

502 
co
->
vÆue
 = 
	`°rdup
(
wh©±r
);

503 if(!
co
->
«me
 || !co->
vÆue
) {

504 
badcookõ
 = 
TRUE
;

516 if(!
£mùå
 || !*semiptr) {

518 
£mùå
 = 
NULL
;

522 
±r
=
£mùå
+1;

523 *
±r
 && 
	`ISBLANK
(*ptr))

524 
±r
++;

525 
£mùå
=
	`°rchr
(
±r
, ';');

527 if(!
£mùå
 && *
±r
)

530 
£mùå
=
	`°rchr
(
±r
, '\0');

531 } 
£mùå
);

533 if(
co
->
maxage
) {

534 
co
->
expúes
 =

535 
	`cuæx_°πoof·
((*
co
->
maxage
=='\"')?

536 &
co
->
maxage
[1]:&co->maxage[0], 
NULL
, 10);

537 if(
CURL_OFF_T_MAX
 - 
now
 < 
co
->
expúes
)

539 
co
->
expúes
 = 
CURL_OFF_T_MAX
;

541 
co
->
expúes
 +
now
;

543 if(
co
->
expúe°r
) {

546 
co
->
expúes
 = 
	`cuæ_gëd©e
(co->
expúe°r
, 
NULL
);

551 if(
co
->
expúes
 == 0)

552 
co
->
expúes
 = 1;

553 if(
co
->
expúes
 < 0)

554 
co
->
expúes
 = 0;

557 if(!
badcookõ
 && !
co
->
domaö
) {

558 if(
domaö
) {

560 
co
->
domaö
=
	`°rdup
(domain);

561 if(!
co
->
domaö
)

562 
badcookõ
 = 
TRUE
;

566 if(!
badcookõ
 && !
co
->
∑th
 &&Öath) {

570 *
quîyp
 = 
	`°rchr
(
∑th
, '?');

574 *
íd¶ash
;

575 if(!
quîyp
)

576 
íd¶ash
 = 
	`°ºchr
(
∑th
, '/');

578 
íd¶ash
 = 
	`memrchr
(
∑th
, '/', (
size_t
)(
quîyp
 -Öath));

579 if(
íd¶ash
) {

580 
size_t
 
∑thÀn
 = (size_t)(
íd¶ash
-
∑th
+1);

581 
co
->
∑th
=
	`mÆloc
(
∑thÀn
+1);

582 if(
co
->
∑th
) {

583 
	`mem˝y
(
co
->
∑th
,Ö©h, 
∑thÀn
);

584 
co
->
∑th
[
∑thÀn
]=0;

585 
co
->
•©h
 = 
	`ßnôize_cookõ_∑th
(co->
∑th
);

586 if(!
co
->
•©h
)

587 
badcookõ
 = 
TRUE
;

590 
badcookõ
 = 
TRUE
;

594 
	`‰ì
(
wh©
);

596 if(
badcookõ
 || !
co
->
«me
) {

599 
	`‰ìcookõ
(
co
);

600  
NULL
;

607 *
±r
;

608 *
fú°±r
;

609 *
tok_buf
=
NULL
;

610 
fõlds
;

619 if(
	`°∫cmp
(
löïå
, "#HttpOnly_", 10) == 0) {

620 
löïå
 += 10;

621 
co
->
hâp⁄ly
 = 
TRUE
;

624 if(
löïå
[0]=='#') {

626 
	`‰ì
(
co
);

627  
NULL
;

630 
±r
=
	`°rchr
(
löïå
, '\r');

631 if(
±r
)

632 *
±r
=0;

633 
±r
=
	`°rchr
(
löïå
, '\n');

634 if(
±r
)

635 *
±r
=0;

637 
fú°±r
=
	`°πok_r
(
löïå
, "\t", &
tok_buf
);

641 
±r
=
fú°±r
, 
fõlds
=0;Öå && !
badcookõ
;

642 
±r
=
	`°πok_r
(
NULL
, "\t", &
tok_buf
), 
fõlds
++) {

643 
fõlds
) {

645 if(
±r
[0]=='.')

646 
±r
++;

647 
co
->
domaö
 = 
	`°rdup
(
±r
);

648 if(!
co
->
domaö
)

649 
badcookõ
 = 
TRUE
;

662 
co
->
èûm©ch
 = 
	`Cuæ_øw_equÆ
(
±r
, "TRUE")?
TRUE
:
FALSE
;

668 if(
	`°rcmp
("TRUE", 
±r
) && strcmp("FALSE",Ötr)) {

670 
co
->
∑th
 = 
	`°rdup
(
±r
);

671 if(!
co
->
∑th
)

672 
badcookõ
 = 
TRUE
;

674 
co
->
•©h
 = 
	`ßnôize_cookõ_∑th
(co->
∑th
);

675 if(!
co
->
•©h
) {

676 
badcookõ
 = 
TRUE
;

682 
co
->
∑th
 = 
	`°rdup
("/");

683 if(!
co
->
∑th
)

684 
badcookõ
 = 
TRUE
;

685 
co
->
•©h
 = 
	`°rdup
("/");

686 if(!
co
->
•©h
)

687 
badcookõ
 = 
TRUE
;

688 
fõlds
++;

691 
co
->
£cuª
 = 
	`Cuæ_øw_equÆ
(
±r
, "TRUE")?
TRUE
:
FALSE
;

694 
co
->
expúes
 = 
	`cuæx_°πoof·
(
±r
, 
NULL
, 10);

697 
co
->
«me
 = 
	`°rdup
(
±r
);

698 if(!
co
->
«me
)

699 
badcookõ
 = 
TRUE
;

702 
co
->
vÆue
 = 
	`°rdup
(
±r
);

703 if(!
co
->
vÆue
)

704 
badcookõ
 = 
TRUE
;

708 if(6 =
fõlds
) {

710 
co
->
vÆue
 = 
	`°rdup
("");

711 if(!
co
->
vÆue
)

712 
badcookõ
 = 
TRUE
;

714 
fõlds
++;

717 if(!
badcookõ
 && (7 !
fõlds
))

719 
badcookõ
 = 
TRUE
;

721 if(
badcookõ
) {

722 
	`‰ìcookõ
(
co
);

723  
NULL
;

728 if(!
c
->
ru¬ög
 &&

729 
c
->
√w£ssi⁄
 &&

730 !
co
->
expúes
) {

731 
	`‰ìcookõ
(
co
);

732  
NULL
;

735 
co
->
livecookõ
 = 
c
->
ru¬ög
;

742 
	`ªmove_expúed
(
c
);

744 
˛i°
 = 
c
->
cookõs
;

745 
ª∂a˚_ﬁd
 = 
FALSE
;

746 
˛i°
) {

747 if(
	`Cuæ_øw_equÆ
(
˛i°
->
«me
, 
co
->name)) {

750 if(
˛i°
->
domaö
 && 
co
->domain) {

751 if(
	`Cuæ_øw_equÆ
(
˛i°
->
domaö
, 
co
->domain))

753 
ª∂a˚_ﬁd
=
TRUE
;

755 if(!
˛i°
->
domaö
 && !
co
->domain)

756 
ª∂a˚_ﬁd
 = 
TRUE
;

758 if(
ª∂a˚_ﬁd
) {

761 if(
˛i°
->
•©h
 && 
co
->spath) {

762 if(
	`Cuæ_øw_equÆ
(
˛i°
->
•©h
, 
co
->spath)) {

763 
ª∂a˚_ﬁd
 = 
TRUE
;

766 
ª∂a˚_ﬁd
 = 
FALSE
;

768 if(!
˛i°
->
•©h
 && !
co
->spath)

769 
ª∂a˚_ﬁd
 = 
TRUE
;

771 
ª∂a˚_ﬁd
 = 
FALSE
;

775 if(
ª∂a˚_ﬁd
 && !
co
->
livecookõ
 && 
˛i°
->livecookie) {

782 
	`‰ìcookõ
(
co
);

783  
NULL
;

786 if(
ª∂a˚_ﬁd
) {

787 
co
->
√xt
 = 
˛i°
->next;

790 
	`‰ì
(
˛i°
->
«me
);

791 if(
˛i°
->
vÆue
)

792 
	`‰ì
(
˛i°
->
vÆue
);

793 if(
˛i°
->
domaö
)

794 
	`‰ì
(
˛i°
->
domaö
);

795 if(
˛i°
->
∑th
)

796 
	`‰ì
(
˛i°
->
∑th
);

797 if(
˛i°
->
•©h
)

798 
	`‰ì
(
˛i°
->
•©h
);

799 if(
˛i°
->
expúe°r
)

800 
	`‰ì
(
˛i°
->
expúe°r
);

802 if(
˛i°
->
vîsi⁄
)

803 
	`‰ì
(
˛i°
->
vîsi⁄
);

804 if(
˛i°
->
maxage
)

805 
	`‰ì
(
˛i°
->
maxage
);

807 *
˛i°
 = *
co
;

809 
	`‰ì
(
co
);

810 
co
 = 
˛i°
;

815 
œ°c
 = 
˛i°
;

816 
˛i°
 = cli°->
√xt
;

817 } 
˛i°
);

821 
œ°c
 = 
˛i°
;

822 
˛i°
 = cli°->
√xt
;

825 if(
c
->
ru¬ög
)

827 
	`öfof
(
d©a
, "%s cookie %s=\"%s\" for domain %s,Öath %s, "

828 "expúê%" 
CURL_FORMAT_CURL_OFF_T
 "\n",

829 
ª∂a˚_ﬁd
?"Rïœ˚d":"Added", 
co
->
«me
, co->
vÆue
,

830 
co
->
domaö
, co->
∑th
, co->
expúes
);

832 if(!
ª∂a˚_ﬁd
) {

834 if(
œ°c
)

835 
œ°c
->
√xt
 = 
co
;

837 
c
->
cookõs
 = 
co
;

838 
c
->
numcookõs
++;

841  
co
;

842 
	}
}

854 
CookõInfo
 *
	$Cuæ_cookõ_öô
(
Sessi⁄H™dÀ
 *
d©a
,

855 c⁄° *
fûe
,

856 
CookõInfo
 *
öc
,

857 
boﬁ
 
√w£ssi⁄
)

859 
CookõInfo
 *
c
;

860 
FILE
 *
Â
;

861 
boﬁ
 
‰omfûe
=
TRUE
;

863 if(
NULL
 =
öc
) {

865 
c
 = 
	`ˇŒoc
(1, (
CookõInfo
));

866 if(!
c
)

867  
NULL
;

868 
c
->
fûíame
 = 
	`°rdup
(
fûe
?file:"none");

872 
c
 = 
öc
;

874 
c
->
ru¬ög
 = 
FALSE
;

876 if(
fûe
 && 
	`°ªquÆ
(file, "-")) {

877 
Â
 = 
°dö
;

878 
‰omfûe
=
FALSE
;

880 if(
fûe
 && !*file) {

882 
Â
 = 
NULL
;

885 
Â
 = 
fûe
?
	`f›í
(fûe, "r"):
NULL
;

887 
c
->
√w£ssi⁄
 =Çewsession;

889 if(
Â
) {

890 *
löïå
;

891 
boﬁ
 
hódîlöe
;

893 *
löe
 = 
	`mÆloc
(
MAX_COOKIE_LINE
);

894 if(
löe
) {

895 
	`fgës
(
löe
, 
MAX_COOKIE_LINE
, 
Â
)) {

896 if(
	`check¥efix
("Së-Cookõ:", 
löe
)) {

898 
löïå
=&
löe
[11];

899 
hódîlöe
=
TRUE
;

902 
löïå
=
löe
;

903 
hódîlöe
=
FALSE
;

905 *
löïå
 && 
	`ISBLANK
(*lineptr))

906 
löïå
++;

908 
	`Cuæ_cookõ_add
(
d©a
, 
c
, 
hódîlöe
, 
löïå
, 
NULL
, NULL);

910 
	`‰ì
(
löe
);

912 if(
‰omfûe
)

913 
	`f˛o£
(
Â
);

916 
c
->
ru¬ög
 = 
TRUE
;

918  
c
;

919 
	}
}

922 
	$cookõ_s‹t
(c⁄° *
p1
, c⁄° *
p2
)

924 
Cookõ
 *
c1
 = *(Cookõ **)
p1
;

925 
Cookõ
 *
c2
 = *(Cookõ **)
p2
;

926 
size_t
 
l1
, 
l2
;

929 
l1
 = 
c1
->
∑th
 ? 
	`°æí
(c1->path) : 0;

930 
l2
 = 
c2
->
∑th
 ? 
	`°æí
(c2->path) : 0;

932 if(
l1
 !
l2
)

933  (
l2
 > 
l1
) ? 1 : -1 ;

936 
l1
 = 
c1
->
domaö
 ? 
	`°æí
(c1->domain) : 0;

937 
l2
 = 
c2
->
domaö
 ? 
	`°æí
(c2->domain) : 0;

939 if(
l1
 !
l2
)

940  (
l2
 > 
l1
) ? 1 : -1 ;

943 if(
c1
->
«me
 && 
c2
->name)

944  
	`°rcmp
(
c1
->
«me
, 
c2
->name);

948 
	}
}

962 
Cookõ
 *
	$Cuæ_cookõ_gëli°
(
CookõInfo
 *
c
,

963 c⁄° *
ho°
, c⁄° *
∑th
,

964 
boﬁ
 
£cuª
)

966 
Cookõ
 *
√wco
;

967 
Cookõ
 *
co
;

968 
time_t
 
now
 = 
	`time
(
NULL
);

969 
Cookõ
 *
maöco
=
NULL
;

970 
size_t
 
m©ches
 = 0;

972 if(!
c
 || !c->
cookõs
)

973  
NULL
;

976 
	`ªmove_expúed
(
c
);

978 
co
 = 
c
->
cookõs
;

980 
co
) {

984 if((!
co
->
expúes
 || (co->expúe†> 
now
)) &&

985 (
co
->
£cuª
?£cuª:
TRUE
)) {

988 if(!
co
->
domaö
 ||

989 (
co
->
èûm©ch
 && 
	`èûm©ch
(co->
domaö
, 
ho°
)) ||

990 (!
co
->
èûm©ch
 && 
	`Cuæ_øw_equÆ
(
ho°
, co->
domaö
)) ) {

996 if(!
co
->
•©h
 || 
	`∑thm©ch
(co->•©h, 
∑th
) ) {

1001 
√wco
 = 
	`mÆloc
((
Cookõ
));

1002 if(
√wco
) {

1004 
	`mem˝y
(
√wco
, 
co
, (
Cookõ
));

1007 
√wco
->
√xt
 = 
maöco
;

1010 
maöco
 = 
√wco
;

1012 
m©ches
++;

1015 
Áû
:

1017 
maöco
) {

1018 
co
 = 
maöco
->
√xt
;

1019 
	`‰ì
(
maöco
);

1020 
maöco
 = 
co
;

1023  
NULL
;

1028 
co
 = co->
√xt
;

1031 if(
m©ches
) {

1035 
Cookõ
 **
¨øy
;

1036 
size_t
 
i
;

1039 
¨øy
 = 
	`mÆloc
((
Cookõ
 *Ë* 
m©ches
);

1040 if(!
¨øy
)

1041 
Áû
;

1043 
co
 = 
maöco
;

1045 
i
=0; 
co
; cÿco->
√xt
)

1046 
¨øy
[
i
++] = 
co
;

1049 
	`qs‹t
(
¨øy
, 
m©ches
, (
Cookõ
 *), 
cookõ_s‹t
);

1053 
maöco
 = 
¨øy
[0];

1054 
i
=0; i<
m©ches
-1; i++)

1055 
¨øy
[
i
]->
√xt
 =árray[i+1];

1056 
¨øy
[
m©ches
-1]->
√xt
 = 
NULL
;

1058 
	`‰ì
(
¨øy
);

1061  
maöco
;

1062 
	}
}

1071 
	$Cuæ_cookõ_˛óøŒ
(
CookõInfo
 *
cookõs
)

1073 if(
cookõs
) {

1074 
	`Cuæ_cookõ_‰ìli°
(
cookõs
->cookõs, 
TRUE
);

1075 
cookõs
->cookõ†
NULL
;

1076 
cookõs
->
numcookõs
 = 0;

1078 
	}
}

1091 
	$Cuæ_cookõ_‰ìli°
(
Cookõ
 *
co
, 
boﬁ
 
cookõ°oo
)

1093 
Cookõ
 *
√xt
;

1094 if(
co
) {

1095 
co
) {

1096 
√xt
 = 
co
->next;

1097 if(
cookõ°oo
)

1098 
	`‰ìcookõ
(
co
);

1100 
	`‰ì
(
co
);

1102 
co
 = 
√xt
;

1105 
	}
}

1115 
	$Cuæ_cookõ_˛ór£ss
(
CookõInfo
 *
cookõs
)

1117 
Cookõ
 *
fú°
, *
cuº
, *
√xt
, *
¥ev
 = 
NULL
;

1119 if(!
cookõs
 || !cookies->cookies)

1122 
fú°
 = 
cuº
 = 
¥ev
 = 
cookõs
->cookies;

1124 ; 
cuº
; cuº = 
√xt
) {

1125 
√xt
 = 
cuº
->next;

1126 if(!
cuº
->
expúes
) {

1127 if(
fú°
 =
cuº
)

1128 
fú°
 = 
√xt
;

1130 if(
¥ev
 =
cuº
)

1131 
¥ev
 = 
√xt
;

1133 
¥ev
->
√xt
 =Çext;

1135 
	`‰ìcookõ
(
cuº
);

1136 
cookõs
->
numcookõs
--;

1139 
¥ev
 = 
cuº
;

1142 
cookõs
->cookõ†
fú°
;

1143 
	}
}

1153 
	$Cuæ_cookõ_˛ónup
(
CookõInfo
 *
c
)

1155 
Cookõ
 *
co
;

1156 
Cookõ
 *
√xt
;

1157 if(
c
) {

1158 if(
c
->
fûíame
)

1159 
	`‰ì
(
c
->
fûíame
);

1160 
co
 = 
c
->
cookõs
;

1162 
co
) {

1163 
√xt
 = 
co
->next;

1164 
	`‰ìcookõ
(
co
);

1165 
co
 = 
√xt
;

1167 
	`‰ì
(
c
);

1169 
	}
}

1177 *
	$gë_√tsˇ≥_f‹m©
(c⁄° 
Cookõ
 *
co
)

1179  
	`≠rötf
(

1185 "%" 
CURL_FORMAT_CURL_OFF_T
 "\t"

1188 
co
->
hâp⁄ly
?"#HttpOnly_":"",

1191 (
co
->
èûm©ch
 && co->
domaö
 && co->domain[0] != '.')? ".":"",

1192 
co
->
domaö
?co->domain:"unknown",

1193 
co
->
èûm©ch
?"TRUE":"FALSE",

1194 
co
->
∑th
?co->path:"/",

1195 
co
->
£cuª
?"TRUE":"FALSE",

1196 
co
->
expúes
,

1197 
co
->
«me
,

1198 
co
->
vÆue
?co->value:"");

1199 
	}
}

1209 
	$cookõ_ouçut
(
CookõInfo
 *
c
, c⁄° *
dumphîe
)

1211 
Cookõ
 *
co
;

1212 
FILE
 *
out
;

1213 
boﬁ
 
u£_°dout
=
FALSE
;

1215 if((
NULL
 =
c
Ë|| (0 =c->
numcookõs
))

1221 
	`ªmove_expúed
(
c
);

1223 if(
	`°ªquÆ
("-", 
dumphîe
)) {

1225 
out
 = 
°dout
;

1226 
u£_°dout
=
TRUE
;

1229 
out
 = 
	`f›í
(
dumphîe
, "w");

1230 if(!
out
)

1234 if(
c
) {

1235 *
f‹m©_±r
;

1237 
	`Âuts
("# Netscape HTTP Cookie File\n"

1240 
out
);

1241 
co
 = 
c
->
cookõs
;

1243 
co
) {

1244 
f‹m©_±r
 = 
	`gë_√tsˇ≥_f‹m©
(
co
);

1245 if(
f‹m©_±r
 =
NULL
) {

1246 
	`Ârötf
(
out
, "#\n# FatalÜibcurlÉrror\n");

1247 if(!
u£_°dout
)

1248 
	`f˛o£
(
out
);

1251 
	`Ârötf
(
out
, "%s\n", 
f‹m©_±r
);

1252 
	`‰ì
(
f‹m©_±r
);

1253 
co
=co->
√xt
;

1257 if(!
u£_°dout
)

1258 
	`f˛o£
(
out
);

1261 
	}
}

1263 
cuæ_¶i°
 *
	$Cuæ_cookõ_li°
(
Sessi⁄H™dÀ
 *
d©a
)

1265 
cuæ_¶i°
 *
li°
 = 
NULL
;

1266 
cuæ_¶i°
 *
beg
;

1267 
Cookõ
 *
c
;

1268 *
löe
;

1270 if((
d©a
->
cookõs
 =
NULL
) ||

1271 (
d©a
->
cookõs
->
numcookõs
 == 0))

1272  
NULL
;

1274 
c
 = 
d©a
->
cookõs
->cookies;

1276 
c
) {

1278 
löe
 = 
	`gë_√tsˇ≥_f‹m©
(
c
);

1279 if(!
löe
) {

1280 
	`cuæ_¶i°_‰ì_Æl
(
li°
);

1281  
NULL
;

1283 
beg
 = 
	`Cuæ_¶i°_≠≥nd_nodup
(
li°
, 
löe
);

1284 if(!
beg
) {

1285 
	`‰ì
(
löe
);

1286 
	`cuæ_¶i°_‰ì_Æl
(
li°
);

1287  
NULL
;

1289 
li°
 = 
beg
;

1290 
c
 = c->
√xt
;

1293  
li°
;

1294 
	}
}

1296 
	$Cuæ_Êush_cookõs
(
Sessi⁄H™dÀ
 *
d©a
, 
˛ónup
)

1298 if(
d©a
->
£t
.
°r
[
STRING_COOKIEJAR
]) {

1299 if(
d©a
->
ch™ge
.
cookõli°
) {

1303 
	`Cuæ_cookõ_lﬂdfûes
(
d©a
);

1306 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
, 
CURL_LOCK_ACCESS_SINGLE
);

1309 if(
	`cookõ_ouçut
(
d©a
->
cookõs
, d©a->
£t
.
°r
[
STRING_COOKIEJAR
]))

1310 
	`öfof
(
d©a
, "WARNING: failedÅo save cookies in %s\n",

1311 
d©a
->
£t
.
°r
[
STRING_COOKIEJAR
]);

1314 if(
˛ónup
 && 
d©a
->
ch™ge
.
cookõli°
) {

1317 
	`cuæ_¶i°_‰ì_Æl
(
d©a
->
ch™ge
.
cookõli°
);

1318 
d©a
->
ch™ge
.
cookõli°
 = 
NULL
;

1320 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
, 
CURL_LOCK_ACCESS_SINGLE
);

1323 if(
˛ónup
 && (!
d©a
->
sh¨e
 || (d©a->
cookõs
 != data->share->cookies))) {

1324 
	`Cuæ_cookõ_˛ónup
(
d©a
->
cookõs
);

1326 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
);

1327 
	}
}

	@lib/cookie.h

1 #i‚de‡
HEADER_CURL_COOKIE_H


2 
	#HEADER_CURL_COOKIE_H


	)

24 
	~"cuæ_£tup.h
"

26 
	~<cuæ/cuæ.h
>

28 
	sCookõ
 {

29 
Cookõ
 *
	m√xt
;

30 *
	m«me
;

31 *
	mvÆue
;

32 *
	m∑th
;

33 *
	m•©h
;

34 *
	mdomaö
;

35 
cuæ_off_t
 
	mexpúes
;

36 *
	mexpúe°r
;

37 
boﬁ
 
	mèûm©ch
;

40 *
	mvîsi⁄
;

41 *
	mmaxage
;

43 
boﬁ
 
	m£cuª
;

44 
boﬁ
 
	mlivecookõ
;

45 
boﬁ
 
	mhâp⁄ly
;

48 
	sCookõInfo
 {

50 
Cookõ
 *
	mcookõs
;

52 *
	mfûíame
;

53 
boﬁ
 
	mru¬ög
;

54 
	mnumcookõs
;

55 
boﬁ
 
	m√w£ssi⁄
;

66 
	#MAX_COOKIE_LINE
 5000

	)

67 
	#MAX_COOKIE_LINE_TXT
 "4999"

	)

70 
	#MAX_NAME
 1024

	)

71 
	#MAX_NAME_TXT
 "1023"

	)

73 
	gSessi⁄H™dÀ
;

79 
Cookõ
 *
Cuæ_cookõ_add
(
Sessi⁄H™dÀ
 *
d©a
,

80 
CookõInfo
 *, 
boﬁ
 
hódî
, *
löïå
,

81 c⁄° *
domaö
, c⁄° *
∑th
);

83 
Cookõ
 *
Cuæ_cookõ_gëli°
(
CookõInfo
 *, const *,

84 c⁄° *, 
boﬁ
);

85 
Cuæ_cookõ_‰ìli°
(
Cookõ
 *
cookõs
, 
boﬁ
 
cookõ°oo
);

86 
Cuæ_cookõ_˛óøŒ
(
CookõInfo
 *
cookõs
);

87 
Cuæ_cookõ_˛ór£ss
(
CookõInfo
 *
cookõs
);

89 #i‡
deföed
(
CURL_DISABLE_HTTP
Ë|| deföed(
CURL_DISABLE_COOKIES
)

90 
	#Cuæ_cookõ_li°
(
x
Ë
NULL


	)

91 
	#Cuæ_cookõ_lﬂdfûes
(
x
Ë
Cuæ_n›_°mt


	)

92 
	#Cuæ_cookõ_öô
(
x
,
y
,
z
,
w
Ë
NULL


	)

93 
	#Cuæ_cookõ_˛ónup
(
x
Ë
Cuæ_n›_°mt


	)

94 
	#Cuæ_Êush_cookõs
(
x
,
y
Ë
Cuæ_n›_°mt


	)

96 
Cuæ_Êush_cookõs
(
Sessi⁄H™dÀ
 *
d©a
, 
˛ónup
);

97 
Cuæ_cookõ_˛ónup
(
CookõInfo
 *);

98 
CookõInfo
 *
Cuæ_cookõ_öô
(
Sessi⁄H™dÀ
 *
d©a
,

99 c⁄° *, 
CookõInfo
 *, 
boﬁ
);

100 
cuæ_¶i°
 *
Cuæ_cookõ_li°
(
Sessi⁄H™dÀ
 *
d©a
);

101 
Cuæ_cookõ_lﬂdfûes
(
Sessi⁄H™dÀ
 *
d©a
);

	@lib/curl_addrinfo.c

23 
	~"cuæ_£tup.h
"

25 
	~<cuæ/cuæ.h
>

27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

30 #ifde‡
HAVE_NETDB_H


31 
	~<√tdb.h
>

33 #ifde‡
HAVE_ARPA_INET_H


34 
	~<¨∑/öë.h
>

37 #ifde‡
__VMS


38 
	~<ö.h
>

39 
	~<öë.h
>

42 #i‡
deföed
(
NETWARE
Ë&& deföed(
__NOVELL_LIBC__
)

43 #unde‡
ö_addr_t


44 
	#ö_addr_t
 

	)

47 
	~"cuæ_addröfo.h
"

48 
	~"öë_±⁄.h
"

49 
	~"w¨∆ess.h
"

51 
	#_MPRINTF_REPLACE


	)

52 
	~<cuæ/m¥ötf.h
>

54 
	~"cuæ_mem‹y.h
"

56 
	~"memdebug.h
"

68 #i‡
deföed
(
__INTEL_COMPILER
) && (__INTEL_COMPILER == 910) && \

69 
deföed
(
__OPTIMIZE__
Ë&& deföed(
__unix__
Ë&& 
	$deföed
(
__i386__
)

71 
	#vquÆifõr
 vﬁ©ûe

	)

73 
	#vquÆifõr


	)

77 
	$Cuæ_‰ìaddröfo
(
Cuæ_addröfo
 *
ˇhód
)

79 
Cuæ_addröfo
 *
vquÆifõr
 
ˇ√xt
;

80 
Cuæ_addröfo
 *
ˇ
;

82 
ˇ
 = 
ˇhód
; c®!
NULL
; c®
ˇ√xt
) {

84 if(
ˇ
->
ai_addr
)

85 
	`‰ì
(
ˇ
->
ai_addr
);

87 if(
ˇ
->
ai_ˇn⁄«me
)

88 
	`‰ì
(
ˇ
->
ai_ˇn⁄«me
);

90 
ˇ√xt
 = 
ˇ
->
ai_√xt
;

92 
	`‰ì
(
ˇ
);

94 
	}
}

97 #ifde‡
HAVE_GETADDRINFO


113 
	$Cuæ_gëaddröfo_ex
(c⁄° *
nodíame
,

114 c⁄° *
£rv«me
,

115 c⁄° 
addröfo
 *
höts
,

116 
Cuæ_addröfo
 **
ªsu…
)

118 c⁄° 
addröfo
 *
ai
;

119 
addröfo
 *
aihód
;

120 
Cuæ_addröfo
 *
ˇfú°
 = 
NULL
;

121 
Cuæ_addröfo
 *
ˇœ°
 = 
NULL
;

122 
Cuæ_addröfo
 *
ˇ
;

123 
size_t
 
ss_size
;

124 
îr‹
;

126 *
ªsu…
 = 
NULL
;

128 
îr‹
 = 
	`gëaddröfo
(
nodíame
, 
£rv«me
, 
höts
, &
aihód
);

129 if(
îr‹
)

130  
îr‹
;

134 
ai
 = 
aihód
;áò!
NULL
;áòai->
ai_√xt
) {

138 if(
ai
->
ai_Ámûy
 =
AF_INET
)

139 
ss_size
 = (
sockaddr_ö
);

140 #ifde‡
ENABLE_IPV6


141 if(
ai
->
ai_Ámûy
 =
AF_INET6
)

142 
ss_size
 = (
sockaddr_ö6
);

148 if((
ai
->
ai_addr
 =
NULL
Ë|| !◊i->
ai_addæí
 > 0))

152 if((
size_t
)
ai
->
ai_addæí
 < 
ss_size
)

155 if((
ˇ
 = 
	`mÆloc
((
Cuæ_addröfo
))Ë=
NULL
) {

156 
îr‹
 = 
EAI_MEMORY
;

163 
ˇ
->
ai_Êags
 = 
ai
->ai_flags;

164 
ˇ
->
ai_Ámûy
 = 
ai
->ai_family;

165 
ˇ
->
ai_sockty≥
 = 
ai
->ai_socktype;

166 
ˇ
->
ai_¥Ÿocﬁ
 = 
ai
->ai_protocol;

167 
ˇ
->
ai_addæí
 = (
cuæ_sockÀn_t
)
ss_size
;

168 
ˇ
->
ai_addr
 = 
NULL
;

169 
ˇ
->
ai_ˇn⁄«me
 = 
NULL
;

170 
ˇ
->
ai_√xt
 = 
NULL
;

172 if((
ˇ
->
ai_addr
 = 
	`mÆloc
(
ss_size
)Ë=
NULL
) {

173 
îr‹
 = 
EAI_MEMORY
;

174 
	`‰ì
(
ˇ
);

177 
	`mem˝y
(
ˇ
->
ai_addr
, 
ai
->ai_addr, 
ss_size
);

179 if(
ai
->
ai_ˇn⁄«me
 !
NULL
) {

180 if((
ˇ
->
ai_ˇn⁄«me
 = 
	`°rdup
(
ai
->ai_ˇn⁄«me)Ë=
NULL
) {

181 
îr‹
 = 
EAI_MEMORY
;

182 
	`‰ì
(
ˇ
->
ai_addr
);

183 
	`‰ì
(
ˇ
);

189 if(!
ˇfú°
)

190 
ˇfú°
 = 
ˇ
;

193 if(
ˇœ°
)

194 
ˇœ°
->
ai_√xt
 = 
ˇ
;

195 
ˇœ°
 = 
ˇ
;

200 if(
aihód
)

201 
	`‰ìaddröfo
(
aihód
);

204 if(
îr‹
) {

205 
	`Cuæ_‰ìaddröfo
(
ˇfú°
);

206 
ˇfú°
 = 
NULL
;

208 if(!
ˇfú°
) {

209 #ifde‡
EAI_NONAME


211 
îr‹
 = 
EAI_NONAME
;

214 
îr‹
 = 
EAI_NODATA
;

216 #ifde‡
USE_WINSOCK


217 
	`SET_SOCKERRNO
(
îr‹
);

221 *
ªsu…
 = 
ˇfú°
;

224  
îr‹
;

225 
	}
}

270 
Cuæ_addröfo
 *

271 
	$Cuæ_he2ai
(c⁄° 
ho°ít
 *
he
, 
p‹t
)

273 
Cuæ_addröfo
 *
ai
;

274 
Cuæ_addröfo
 *
¥evai
 = 
NULL
;

275 
Cuæ_addröfo
 *
fú°ai
 = 
NULL
;

276 
sockaddr_ö
 *
addr
;

277 #ifde‡
ENABLE_IPV6


278 
sockaddr_ö6
 *
addr6
;

280 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

281 
i
;

282 *
cuº
;

284 if(!
he
)

286  
NULL
;

288 
	`DEBUGASSERT
((
he
->
h_«me
 !
NULL
Ë&& (he->
h_addr_li°
 != NULL));

290 
i
=0; (
cuº
 = 
he
->
h_addr_li°
[i]Ë!
NULL
; i++) {

292 
size_t
 
ss_size
;

293 #ifde‡
ENABLE_IPV6


294 if(
he
->
h_addπy≥
 =
AF_INET6
)

295 
ss_size
 =  (
sockaddr_ö6
);

298 
ss_size
 =  (
sockaddr_ö
);

300 if((
ai
 = 
	`ˇŒoc
(1, (
Cuæ_addröfo
))Ë=
NULL
) {

301 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

304 if((
ai
->
ai_ˇn⁄«me
 = 
	`°rdup
(
he
->
h_«me
)Ë=
NULL
) {

305 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

306 
	`‰ì
(
ai
);

309 if((
ai
->
ai_addr
 = 
	`ˇŒoc
(1, 
ss_size
)Ë=
NULL
) {

310 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

311 
	`‰ì
(
ai
->
ai_ˇn⁄«me
);

312 
	`‰ì
(
ai
);

316 if(!
fú°ai
)

318 
fú°ai
 = 
ai
;

320 if(
¥evai
)

322 
¥evai
->
ai_√xt
 = 
ai
;

324 
ai
->
ai_Ámûy
 = 
he
->
h_addπy≥
;

328 
ai
->
ai_sockty≥
 = 
SOCK_STREAM
;

330 
ai
->
ai_addæí
 = (
cuæ_sockÀn_t
)
ss_size
;

334 
ai
->
ai_Ámûy
) {

335 
AF_INET
:

336 
addr
 = (*)
ai
->
ai_addr
;

338 
	`mem˝y
(&
addr
->
sö_addr
, 
cuº
, (
ö_addr
));

339 
addr
->
sö_Ámûy
 = ()(
he
->
h_addπy≥
);

340 
addr
->
sö_p‹t
 = 
	`ht⁄s
(()
p‹t
);

343 #ifde‡
ENABLE_IPV6


344 
AF_INET6
:

345 
addr6
 = (*)
ai
->
ai_addr
;

347 
	`mem˝y
(&
addr6
->
sö6_addr
, 
cuº
, (
ö6_addr
));

348 
addr6
->
sö6_Ámûy
 = ()(
he
->
h_addπy≥
);

349 
addr6
->
sö6_p‹t
 = 
	`ht⁄s
(()
p‹t
);

354 
¥evai
 = 
ai
;

357 if(
ªsu…
 !
CURLE_OK
) {

358 
	`Cuæ_‰ìaddröfo
(
fú°ai
);

359 
fú°ai
 = 
NULL
;

362  
fú°ai
;

363 
	}
}

366 
	s«mebuff
 {

367 
ho°ít
 
	mho°íåy
;

369 
ö_addr
 
	möa4
;

370 #ifde‡
ENABLE_IPV6


371 
ö6_addr
 
	möa6
;

373 } 
	maddª¡ry
;

374 *
	mh_addr_li°
[2];

387 
Cuæ_addröfo
 *

388 
	$Cuæ_ù2addr
(
af
, c⁄° *
öaddr
, c⁄° *
ho°«me
, 
p‹t
)

390 
Cuæ_addröfo
 *
ai
;

392 #i‡
	`deföed
(
__VMS
) && \

393 
	`deföed
(
__INITIAL_POINTER_SIZE
) && (__INITIAL_POINTER_SIZE == 64)

394 #¥agm®
poöãr_size
 
ßve


395 #¥agm®
poöãr_size
 

396 #¥agm®
mesßge
 
dißbÀ
 
PTRMISMATCH


399 
ho°ít
 *
h
;

400 
«mebuff
 *
buf
;

401 *
addª¡ry
;

402 *
ho°°r
;

403 
size_t
 
addrsize
;

405 
	`DEBUGASSERT
(
öaddr
 && 
ho°«me
);

407 
buf
 = 
	`mÆloc
((
«mebuff
));

408 if(!
buf
)

409  
NULL
;

411 
ho°°r
 = 
	`°rdup
(
ho°«me
);

412 if(!
ho°°r
) {

413 
	`‰ì
(
buf
);

414  
NULL
;

417 
af
) {

418 
AF_INET
:

419 
addrsize
 = (
ö_addr
);

420 
addª¡ry
 = (*)&
buf
->addª¡ry.
öa4
;

421 
	`mem˝y
(
addª¡ry
, 
öaddr
, (
ö_addr
));

423 #ifde‡
ENABLE_IPV6


424 
AF_INET6
:

425 
addrsize
 = (
ö6_addr
);

426 
addª¡ry
 = (*)&
buf
->addª¡ry.
öa6
;

427 
	`mem˝y
(
addª¡ry
, 
öaddr
, (
ö6_addr
));

431 
	`‰ì
(
ho°°r
);

432 
	`‰ì
(
buf
);

433  
NULL
;

436 
h
 = &
buf
->
ho°íåy
;

437 
h
->
h_«me
 = 
ho°°r
;

438 
h
->
h_Æü£s
 = 
NULL
;

439 
h
->
h_addπy≥
 = ()
af
;

440 
h
->
h_Àngth
 = ()
addrsize
;

441 
h
->
h_addr_li°
 = &
buf
->h_addr_list[0];

442 
h
->
h_addr_li°
[0] = 
addª¡ry
;

443 
h
->
h_addr_li°
[1] = 
NULL
;

445 #i‡
	`deföed
(
__VMS
) && \

446 
	`deföed
(
__INITIAL_POINTER_SIZE
) && (__INITIAL_POINTER_SIZE == 64)

447 #¥agm®
poöãr_size
 
ª°‹e


448 #¥agm®
mesßge
 
íabÀ
 
PTRMISMATCH


451 
ai
 = 
	`Cuæ_he2ai
(
h
, 
p‹t
);

453 
	`‰ì
(
ho°°r
);

454 
	`‰ì
(
buf
);

456  
ai
;

457 
	}
}

463 
Cuæ_addröfo
 *
	$Cuæ_°r2addr
(*
addªss
, 
p‹t
)

465 
ö_addr
 
ö
;

466 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
addªss
, &
ö
) > 0)

468  
	`Cuæ_ù2addr
(
AF_INET
, &
ö
, 
addªss
, 
p‹t
);

469 #ifde‡
ENABLE_IPV6


471 
ö6_addr
 
ö6
;

472 if(
	`Cuæ_öë_±⁄
(
AF_INET6
, 
addªss
, &
ö6
) > 0)

474  
	`Cuæ_ù2addr
(
AF_INET6
, &
ö6
, 
addªss
, 
p‹t
);

477  
NULL
;

478 
	}
}

480 #i‡
deföed
(
CURLDEBUG
Ë&& deföed(
HAVE_FREEADDRINFO
)

490 
	$cuæ_do‰ìaddröfo
(
addröfo
 *
‰ìthis
,

491 
löe
, c⁄° *
sour˚
)

493 (
‰ìaddröfo
)(
‰ìthis
);

494 
	`cuæ_memlog
("ADDR %s:%d freeaddrinfo(%p)\n",

495 
sour˚
, 
löe
, (*)
‰ìthis
);

496 
	}
}

500 #i‡
deföed
(
CURLDEBUG
Ë&& deföed(
HAVE_GETADDRINFO
)

510 
	$cuæ_dogëaddröfo
(c⁄° *
ho°«me
,

511 c⁄° *
£rvi˚
,

512 c⁄° 
addröfo
 *
höts
,

513 
addröfo
 **
ªsu…
,

514 
löe
, c⁄° *
sour˚
)

516 
ªs
=(
gëaddröfo
)(
ho°«me
, 
£rvi˚
, 
höts
, 
ªsu…
);

517 if(0 =
ªs
)

519 
	`cuæ_memlog
("ADDR %s:%d getaddrinfo() = %p\n",

520 
sour˚
, 
löe
, (*)*
ªsu…
);

522 
	`cuæ_memlog
("ADDR %s:%d getaddrinfo() failed\n",

523 
sour˚
, 
löe
);

524  
ªs
;

525 
	}
}

	@lib/curl_addrinfo.h

1 #i‚de‡
HEADER_CURL_ADDRINFO_H


2 
	#HEADER_CURL_ADDRINFO_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

30 #ifde‡
HAVE_NETDB_H


31 
	~<√tdb.h
>

33 #ifde‡
HAVE_ARPA_INET_H


34 
	~<¨∑/öë.h
>

37 #ifde‡
__VMS


38 
	~<ö.h
>

39 
	~<öë.h
>

40 
	~<°dlib.h
>

51 
	sCuæ_addröfo
 {

52 
	mai_Êags
;

53 
	mai_Ámûy
;

54 
	mai_sockty≥
;

55 
	mai_¥Ÿocﬁ
;

56 
cuæ_sockÀn_t
 
	mai_addæí
;

57 *
	mai_ˇn⁄«me
;

58 
sockaddr
 *
	mai_addr
;

59 
Cuæ_addröfo
 *
	mai_√xt
;

61 
Cuæ_addröfo
 
	tCuæ_addröfo
;

64 
Cuæ_‰ìaddröfo
(
Cuæ_addröfo
 *
ˇhód
);

66 #ifde‡
HAVE_GETADDRINFO


68 
Cuæ_gëaddröfo_ex
(c⁄° *
nodíame
,

69 c⁄° *
£rv«me
,

70 c⁄° 
addröfo
 *
höts
,

71 
Cuæ_addröfo
 **
ªsu…
);

74 
Cuæ_addröfo
 *

75 
Cuæ_he2ai
(c⁄° 
ho°ít
 *
he
, 
p‹t
);

77 
Cuæ_addröfo
 *

78 
Cuæ_ù2addr
(
af
, c⁄° *
öaddr
, c⁄° *
ho°«me
, 
p‹t
);

80 
Cuæ_addröfo
 *
Cuæ_°r2addr
(*
dŸãd
, 
p‹t
);

82 #i‡
deföed
(
CURLDEBUG
Ë&& deföed(
HAVE_FREEADDRINFO
)

84 
cuæ_do‰ìaddröfo
(
addröfo
 *
‰ìthis
,

85 
löe
, c⁄° *
sour˚
);

88 #i‡
deföed
(
CURLDEBUG
Ë&& deföed(
HAVE_GETADDRINFO
)

90 
cuæ_dogëaddröfo
(c⁄° *
ho°«me
,

91 c⁄° *
£rvi˚
,

92 c⁄° 
addröfo
 *
höts
,

93 
addröfo
 **
ªsu…
,

94 
löe
, c⁄° *
sour˚
);

	@lib/curl_base64.h

1 #i‚de‡
HEADER_CURL_BASE64_H


2 
	#HEADER_CURL_BASE64_H


	)

25 
CURLcode
 
Cuæ_ba£64_ícode
(
Sessi⁄H™dÀ
 *
d©a
,

26 c⁄° *
öputbuff
, 
size_t
 
ösize
,

27 **
ouçå
, 
size_t
 *
ouéí
);

29 
CURLcode
 
Cuæ_ba£64_decode
(c⁄° *
§c
,

30 **
ouçå
, 
size_t
 *
ouéí
);

	@lib/curl_config.h

5 
	#CURL_CA_BUNDLE
 "/ëc/s¶/˚πs/ˇ-˚πifiˇãs.¸t"

	)

35 
	#CURL_DISABLE_LDAP
 1

	)

38 
	#CURL_DISABLE_LDAPS
 1

	)

68 
	#CURL_EXTERN_SYMBOL
 
	`__©åibuã__
 ((
	`__visibûôy__
 ("deÁu…")))

	)

77 
	#ENABLE_IPV6
 1

	)

80 
	#GETHOSTNAME_TYPE_ARG2
 

	)

83 
	#GETNAMEINFO_QUAL_ARG1
 c⁄°

	)

86 
	#GETNAMEINFO_TYPE_ARG1
 
sockaddr
 *

	)

89 
	#GETNAMEINFO_TYPE_ARG2
 
sockÀn_t


	)

92 
	#GETNAMEINFO_TYPE_ARG46
 
size_t


	)

95 
	#GETNAMEINFO_TYPE_ARG7
 

	)

98 
	#GETSERVBYPORT_R_ARGS
 6

	)

101 
	#GETSERVBYPORT_R_BUFSIZE
 4096

	)

104 
	#HAVE_ALARM
 1

	)

107 
	#HAVE_ALLOCA_H
 1

	)

110 
	#HAVE_ARPA_INET_H
 1

	)

113 
	#HAVE_ARPA_TFTP_H
 1

	)

116 
	#HAVE_ASSERT_H
 1

	)

119 
	#HAVE_BASENAME
 1

	)

122 
	#HAVE_BOOL_T
 1

	)

125 
	#HAVE_CLOCK_GETTIME_MONOTONIC
 1

	)

134 
	#HAVE_CONNECT
 1

	)

146 
	#HAVE_DLFCN_H
 1

	)

155 
	#HAVE_ERRNO_H
 1

	)

161 
	#HAVE_FCNTL
 1

	)

164 
	#HAVE_FCNTL_H
 1

	)

167 
	#HAVE_FCNTL_O_NONBLOCK
 1

	)

170 
	#HAVE_FDOPEN
 1

	)

173 
	#HAVE_FORK
 1

	)

176 
	#HAVE_FREEADDRINFO
 1

	)

179 
	#HAVE_FREEIFADDRS
 1

	)

182 
	#HAVE_FSETXATTR
 1

	)

185 
	#HAVE_FSETXATTR_5
 1

	)

191 
	#HAVE_FTRUNCATE
 1

	)

194 
	#HAVE_GAI_STRERROR
 1

	)

197 
	#HAVE_GETADDRINFO
 1

	)

200 
	#HAVE_GETADDRINFO_THREADSAFE
 1

	)

203 
	#HAVE_GETEUID
 1

	)

206 
	#HAVE_GETHOSTBYADDR
 1

	)

209 
	#HAVE_GETHOSTBYADDR_R
 1

	)

218 
	#HAVE_GETHOSTBYADDR_R_8
 1

	)

221 
	#HAVE_GETHOSTBYNAME
 1

	)

224 
	#HAVE_GETHOSTBYNAME_R
 1

	)

233 
	#HAVE_GETHOSTBYNAME_R_6
 1

	)

236 
	#HAVE_GETHOSTNAME
 1

	)

239 
	#HAVE_GETIFADDRS
 1

	)

242 
	#HAVE_GETNAMEINFO
 1

	)

248 
	#HAVE_GETPPID
 1

	)

251 
	#HAVE_GETPROTOBYNAME
 1

	)

254 
	#HAVE_GETPWUID
 1

	)

257 
	#HAVE_GETPWUID_R
 1

	)

260 
	#HAVE_GETRLIMIT
 1

	)

263 
	#HAVE_GETSERVBYPORT_R
 1

	)

266 
	#HAVE_GETTIMEOFDAY
 1

	)

272 
	#HAVE_GMTIME_R
 1

	)

308 
	#HAVE_IFADDRS_H
 1

	)

311 
	#HAVE_IF_NAMETOINDEX
 1

	)

314 
	#HAVE_INET_ADDR
 1

	)

326 
	#HAVE_INET_NTOP
 1

	)

329 
	#HAVE_INET_PTON
 1

	)

332 
	#HAVE_INTTYPES_H
 1

	)

335 
	#HAVE_IOCTL
 1

	)

351 
	#HAVE_IOCTL_FIONBIO
 1

	)

354 
	#HAVE_IOCTL_SIOCGIFADDR
 1

	)

372 
	#HAVE_LDAP_SSL
 1

	)

381 
	#HAVE_LIBGEN_H
 1

	)

417 
	#HAVE_LIBZ
 1

	)

420 
	#HAVE_LIMITS_H
 1

	)

423 
	#HAVE_LL
 1

	)

426 
	#HAVE_LOCALE_H
 1

	)

429 
	#HAVE_LOCALTIME_R
 1

	)

432 
	#HAVE_LONGLONG
 1

	)

435 
	#HAVE_MALLOC_H
 1

	)

438 
	#HAVE_MEMORY_H
 1

	)

444 
	#HAVE_MSG_NOSIGNAL
 1

	)

447 
	#HAVE_NETDB_H
 1

	)

450 
	#HAVE_NETINET_IN_H
 1

	)

453 
	#HAVE_NETINET_TCP_H
 1

	)

456 
	#HAVE_NET_IF_H
 1

	)

496 
	#HAVE_PERROR
 1

	)

499 
	#HAVE_PIPE
 1

	)

502 
	#HAVE_POLL
 1

	)

505 
	#HAVE_POLL_FINE
 1

	)

508 
	#HAVE_POLL_H
 1

	)

511 
	#HAVE_POSIX_STRERROR_R
 1

	)

517 
	#HAVE_PWD_H
 1

	)

529 
	#HAVE_RECV
 1

	)

535 
	#HAVE_SELECT
 1

	)

538 
	#HAVE_SEND
 1

	)

541 
	#HAVE_SETJMP_H
 1

	)

544 
	#HAVE_SETLOCALE
 1

	)

550 
	#HAVE_SETRLIMIT
 1

	)

553 
	#HAVE_SETSOCKOPT
 1

	)

559 
	#HAVE_SGTTY_H
 1

	)

562 
	#HAVE_SIGACTION
 1

	)

565 
	#HAVE_SIGINTERRUPT
 1

	)

568 
	#HAVE_SIGNAL
 1

	)

571 
	#HAVE_SIGNAL_H
 1

	)

574 
	#HAVE_SIGSETJMP
 1

	)

577 
	#HAVE_SIG_ATOMIC_T
 1

	)

583 
	#HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID
 1

	)

586 
	#HAVE_SOCKET
 1

	)

589 
	#HAVE_SOCKETPAIR
 1

	)

619 
	#HAVE_STDBOOL_H
 1

	)

622 
	#HAVE_STDINT_H
 1

	)

625 
	#HAVE_STDIO_H
 1

	)

628 
	#HAVE_STDLIB_H
 1

	)

631 
	#HAVE_STRCASECMP
 1

	)

637 
	#HAVE_STRDUP
 1

	)

640 
	#HAVE_STRERROR_R
 1

	)

646 
	#HAVE_STRINGS_H
 1

	)

649 
	#HAVE_STRING_H
 1

	)

652 
	#HAVE_STRNCASECMP
 1

	)

661 
	#HAVE_STROPTS_H
 1

	)

664 
	#HAVE_STRSTR
 1

	)

667 
	#HAVE_STRTOK_R
 1

	)

670 
	#HAVE_STRTOLL
 1

	)

673 
	#HAVE_STRUCT_SOCKADDR_STORAGE
 1

	)

676 
	#HAVE_STRUCT_TIMEVAL
 1

	)

682 
	#HAVE_SYS_IOCTL_H
 1

	)

685 
	#HAVE_SYS_PARAM_H
 1

	)

688 
	#HAVE_SYS_POLL_H
 1

	)

691 
	#HAVE_SYS_RESOURCE_H
 1

	)

694 
	#HAVE_SYS_SELECT_H
 1

	)

697 
	#HAVE_SYS_SOCKET_H
 1

	)

703 
	#HAVE_SYS_STAT_H
 1

	)

706 
	#HAVE_SYS_TIME_H
 1

	)

709 
	#HAVE_SYS_TYPES_H
 1

	)

712 
	#HAVE_SYS_UIO_H
 1

	)

715 
	#HAVE_SYS_UN_H
 1

	)

721 
	#HAVE_SYS_WAIT_H
 1

	)

724 
	#HAVE_SYS_XATTR_H
 1

	)

727 
	#HAVE_TERMIOS_H
 1

	)

730 
	#HAVE_TERMIO_H
 1

	)

733 
	#HAVE_TIME_H
 1

	)

742 
	#HAVE_UNAME
 1

	)

745 
	#HAVE_UNISTD_H
 1

	)

748 
	#HAVE_UTIME
 1

	)

751 
	#HAVE_UTIME_H
 1

	)

754 
	#HAVE_VARIADIC_MACROS_C99
 1

	)

757 
	#HAVE_VARIADIC_MACROS_GCC
 1

	)

775 
	#HAVE_WRITABLE_ARGV
 1

	)

778 
	#HAVE_WRITEV
 1

	)

787 
	#HAVE_ZLIB_H
 1

	)

791 
	#LT_OBJDIR
 ".libs/"

	)

815 
	#OS
 "i586-pc-löux-gnu"

	)

818 
	#PACKAGE
 "cuæ"

	)

821 
	#PACKAGE_BUGREPORT
 "®suôabÀ cuæ maûögÜi°: hâp://cuæ.haxx.£/maû/"

	)

824 
	#PACKAGE_NAME
 "cuæ"

	)

827 
	#PACKAGE_STRING
 "cuæ -"

	)

830 
	#PACKAGE_TARNAME
 "cuæ"

	)

833 
	#PACKAGE_URL
 ""

	)

836 
	#PACKAGE_VERSION
 "-"

	)

842 
	#RECV_TYPE_ARG1
 

	)

845 
	#RECV_TYPE_ARG2
 *

	)

848 
	#RECV_TYPE_ARG3
 
size_t


	)

851 
	#RECV_TYPE_ARG4
 

	)

854 
	#RECV_TYPE_RETV
 

	)

857 
	#RETSIGTYPE
 

	)

860 
	#SELECT_QUAL_ARG5


	)

863 
	#SELECT_TYPE_ARG1
 

	)

866 
	#SELECT_TYPE_ARG234
 
fd_£t
 *

	)

869 
	#SELECT_TYPE_ARG5
 
timevÆ
 *

	)

872 
	#SELECT_TYPE_RETV
 

	)

875 
	#SEND_QUAL_ARG2
 c⁄°

	)

878 
	#SEND_TYPE_ARG1
 

	)

881 
	#SEND_TYPE_ARG2
 *

	)

884 
	#SEND_TYPE_ARG3
 
size_t


	)

887 
	#SEND_TYPE_ARG4
 

	)

890 
	#SEND_TYPE_RETV
 

	)

893 
	#SIZEOF_INT
 4

	)

896 
	#SIZEOF_LONG
 4

	)

902 
	#SIZEOF_OFF_T
 8

	)

905 
	#SIZEOF_SHORT
 2

	)

908 
	#SIZEOF_SIZE_T
 4

	)

911 
	#SIZEOF_TIME_T
 4

	)

914 
	#SIZEOF_VOIDP
 4

	)

917 
	#STDC_HEADERS
 1

	)

920 
	#STRERROR_R_TYPE_ARG3
 
size_t


	)

923 
	#TIME_WITH_SYS_TIME
 1

	)

950 
	#USE_MANUAL
 1

	)

1000 
	#VERSION
 "-"

	)

1009 #i‚de‡
_ALL_SOURCE


1014 #i‚de‡
_DARWIN_USE_64_BIT_INODE


1015 
	#_DARWIN_USE_64_BIT_INODE
 1

	)

1019 
	#_FILE_OFFSET_BITS
 64

	)

1032 #i‚de‡
__˝lu•lus


	@lib/curl_fnmatch.c

23 
	~"cuæ_£tup.h
"

25 
	~"cuæ_‚m©ch.h
"

27 
	#_MPRINTF_REPLACE


	)

28 
	~<cuæ/m¥ötf.h
>

30 
	~"cuæ_mem‹y.h
"

32 
	~"memdebug.h
"

34 
	#CURLFNM_CHARSET_LEN
 ((Ë* 256)

	)

35 
	#CURLFNM_CHSET_SIZE
 (
CURLFNM_CHARSET_LEN
 + 15)

	)

37 
	#CURLFNM_NEGATE
 
CURLFNM_CHARSET_LEN


	)

39 
	#CURLFNM_ALNUM
 (
CURLFNM_CHARSET_LEN
 + 1)

	)

40 
	#CURLFNM_DIGIT
 (
CURLFNM_CHARSET_LEN
 + 2)

	)

41 
	#CURLFNM_XDIGIT
 (
CURLFNM_CHARSET_LEN
 + 3)

	)

42 
	#CURLFNM_ALPHA
 (
CURLFNM_CHARSET_LEN
 + 4)

	)

43 
	#CURLFNM_PRINT
 (
CURLFNM_CHARSET_LEN
 + 5)

	)

44 
	#CURLFNM_BLANK
 (
CURLFNM_CHARSET_LEN
 + 6)

	)

45 
	#CURLFNM_LOWER
 (
CURLFNM_CHARSET_LEN
 + 7)

	)

46 
	#CURLFNM_GRAPH
 (
CURLFNM_CHARSET_LEN
 + 8)

	)

47 
	#CURLFNM_SPACE
 (
CURLFNM_CHARSET_LEN
 + 9)

	)

48 
	#CURLFNM_UPPER
 (
CURLFNM_CHARSET_LEN
 + 10)

	)

51 
	mCURLFNM_LOOP_DEFAULT
 = 0,

52 
	mCURLFNM_LOOP_BACKSLASH


53 } 
	tlo›_°©e
;

56 
	mCURLFNM_SCHS_DEFAULT
 = 0,

57 
	mCURLFNM_SCHS_MAYRANGE
,

58 
	mCURLFNM_SCHS_MAYRANGE2
,

59 
	mCURLFNM_SCHS_RIGHTBR
,

60 
	mCURLFNM_SCHS_RIGHTBRLEFTBR


61 } 
	t£tch¨£t_°©e
;

64 
	mCURLFNM_PKW_INIT
 = 0,

65 
	mCURLFNM_PKW_DDOT


66 } 
	t∑r£key_°©e
;

68 
	#SETCHARSET_OK
 1

	)

69 
	#SETCHARSET_FAIL
 0

	)

71 
	$∑r£keyw‹d
(**
∑âîn
, *
ch¨£t
)

73 
∑r£key_°©e
 
°©e
 = 
CURLFNM_PKW_INIT
;

74 
	#KEYLEN
 10

	)

75 
keyw‹d
[
KEYLEN
] = { 0 };

76 
found
 = 
FALSE
;

77 
i
;

78 *
p
 = *
∑âîn
;

79 
i
 = 0; !
found
; i++) {

80 
c
 = *
p
++;

81 if(
i
 >
KEYLEN
)

82  
SETCHARSET_FAIL
;

83 
°©e
) {

84 
CURLFNM_PKW_INIT
:

85 if(
	`ISALPHA
(
c
Ë&& 
	`ISLOWER
(c))

86 
keyw‹d
[
i
] = 
c
;

87 if(
c
 == ':')

88 
°©e
 = 
CURLFNM_PKW_DDOT
;

92 
CURLFNM_PKW_DDOT
:

93 if(
c
 == ']')

94 
found
 = 
TRUE
;

96  
SETCHARSET_FAIL
;

99 #unde‡
KEYLEN


101 *
∑âîn
 = 
p
;

102 if(
	`°rcmp
(
keyw‹d
, "digit") == 0)

103 
ch¨£t
[
CURLFNM_DIGIT
] = 1;

104 if(
	`°rcmp
(
keyw‹d
, "alnum") == 0)

105 
ch¨£t
[
CURLFNM_ALNUM
] = 1;

106 if(
	`°rcmp
(
keyw‹d
, "alpha") == 0)

107 
ch¨£t
[
CURLFNM_ALPHA
] = 1;

108 if(
	`°rcmp
(
keyw‹d
, "xdigit") == 0)

109 
ch¨£t
[
CURLFNM_XDIGIT
] = 1;

110 if(
	`°rcmp
(
keyw‹d
, "print") == 0)

111 
ch¨£t
[
CURLFNM_PRINT
] = 1;

112 if(
	`°rcmp
(
keyw‹d
, "graph") == 0)

113 
ch¨£t
[
CURLFNM_GRAPH
] = 1;

114 if(
	`°rcmp
(
keyw‹d
, "space") == 0)

115 
ch¨£t
[
CURLFNM_SPACE
] = 1;

116 if(
	`°rcmp
(
keyw‹d
, "blank") == 0)

117 
ch¨£t
[
CURLFNM_BLANK
] = 1;

118 if(
	`°rcmp
(
keyw‹d
, "upper") == 0)

119 
ch¨£t
[
CURLFNM_UPPER
] = 1;

120 if(
	`°rcmp
(
keyw‹d
, "lower") == 0)

121 
ch¨£t
[
CURLFNM_LOWER
] = 1;

123  
SETCHARSET_FAIL
;

124  
SETCHARSET_OK
;

125 
	}
}

128 
	$£tch¨£t
(**
p
, *
ch¨£t
)

130 
£tch¨£t_°©e
 
°©e
 = 
CURLFNM_SCHS_DEFAULT
;

131 
ønge°¨t
 = 0;

132 
œ°ch¨
 = 0;

133 
boﬁ
 
somëhög_found
 = 
FALSE
;

134 
c
;

136 
c
 = **
p
;

137 
°©e
) {

138 
CURLFNM_SCHS_DEFAULT
:

139 if(
	`ISALNUM
(
c
)) {

140 
ønge°¨t
 = 
c
;

141 
ch¨£t
[
c
] = 1;

142 (*
p
)++;

143 
°©e
 = 
CURLFNM_SCHS_MAYRANGE
;

144 
somëhög_found
 = 
TRUE
;

146 if(
c
 == ']') {

147 if(
somëhög_found
)

148  
SETCHARSET_OK
;

150 
somëhög_found
 = 
TRUE
;

151 
°©e
 = 
CURLFNM_SCHS_RIGHTBR
;

152 
ch¨£t
[
c
] = 1;

153 (*
p
)++;

155 if(
c
 == '[') {

156 
c2
 = *((*
p
)+1);

157 if(
c2
 == ':') {

158 (*
p
) += 2;

159 if(
	`∑r£keyw‹d
(
p
, 
ch¨£t
)) {

160 
°©e
 = 
CURLFNM_SCHS_DEFAULT
;

163  
SETCHARSET_FAIL
;

166 
ch¨£t
[
c
] = 1;

167 (*
p
)++;

169 
somëhög_found
 = 
TRUE
;

171 if(
c
 == '?' || c == '*') {

172 
somëhög_found
 = 
TRUE
;

173 
ch¨£t
[
c
] = 1;

174 (*
p
)++;

176 if(
c
 == '^' || c == '!') {

177 if(!
somëhög_found
) {

178 if(
ch¨£t
[
CURLFNM_NEGATE
]) {

179 
ch¨£t
[
c
] = 1;

180 
somëhög_found
 = 
TRUE
;

183 
ch¨£t
[
CURLFNM_NEGATE
] = 1;

186 
ch¨£t
[
c
] = 1;

187 (*
p
)++;

189 if(
c
 == '\\') {

190 
c
 = *(++(*
p
));

191 if(
	`ISPRINT
((
c
))) {

192 
somëhög_found
 = 
TRUE
;

193 
°©e
 = 
CURLFNM_SCHS_MAYRANGE
;

194 
ch¨£t
[
c
] = 1;

195 
ønge°¨t
 = 
c
;

196 (*
p
)++;

199  
SETCHARSET_FAIL
;

201 if(
c
 == '\0') {

202  
SETCHARSET_FAIL
;

205 
ch¨£t
[
c
] = 1;

206 (*
p
)++;

207 
somëhög_found
 = 
TRUE
;

210 
CURLFNM_SCHS_MAYRANGE
:

211 if(
c
 == '-') {

212 
ch¨£t
[
c
] = 1;

213 (*
p
)++;

214 
œ°ch¨
 = '-';

215 
°©e
 = 
CURLFNM_SCHS_MAYRANGE2
;

217 if(
c
 == '[') {

218 
°©e
 = 
CURLFNM_SCHS_DEFAULT
;

220 if(
	`ISALNUM
(
c
)) {

221 
ch¨£t
[
c
] = 1;

222 (*
p
)++;

224 if(
c
 == '\\') {

225 
c
 = *(++(*
p
));

226 if(
	`ISPRINT
(
c
)) {

227 
ch¨£t
[
c
] = 1;

228 (*
p
)++;

231  
SETCHARSET_FAIL
;

233 if(
c
 == ']') {

234  
SETCHARSET_OK
;

237  
SETCHARSET_FAIL
;

239 
CURLFNM_SCHS_MAYRANGE2
:

240 if(
c
 == '\\') {

241 
c
 = *(++(*
p
));

242 if(!
	`ISPRINT
(
c
))

243  
SETCHARSET_FAIL
;

245 if(
c
 == ']') {

246  
SETCHARSET_OK
;

248 if(
c
 == '\\') {

249 
c
 = *(++(*
p
));

250 if(
	`ISPRINT
(
c
)) {

251 
ch¨£t
[
c
] = 1;

252 
°©e
 = 
CURLFNM_SCHS_DEFAULT
;

253 (*
p
)++;

256  
SETCHARSET_FAIL
;

258 if(
c
 >
ønge°¨t
) {

259 if((
	`ISLOWER
(
c
Ë&& ISLOWER(
ønge°¨t
)) ||

260 (
	`ISDIGIT
(
c
Ë&& ISDIGIT(
ønge°¨t
)) ||

261 (
	`ISUPPER
(
c
Ë&& ISUPPER(
ønge°¨t
))) {

262 
ch¨£t
[
œ°ch¨
] = 0;

263 
ønge°¨t
++;

264 
ønge°¨t
++ <
c
)

265 
ch¨£t
[
ønge°¨t
-1] = 1;

266 (*
p
)++;

267 
°©e
 = 
CURLFNM_SCHS_DEFAULT
;

270  
SETCHARSET_FAIL
;

273 
CURLFNM_SCHS_RIGHTBR
:

274 if(
c
 == '[') {

275 
°©e
 = 
CURLFNM_SCHS_RIGHTBRLEFTBR
;

276 
ch¨£t
[
c
] = 1;

277 (*
p
)++;

279 if(
c
 == ']') {

280  
SETCHARSET_OK
;

282 if(
c
 == '\0') {

283  
SETCHARSET_FAIL
;

285 if(
	`ISPRINT
(
c
)) {

286 
ch¨£t
[
c
] = 1;

287 (*
p
)++;

288 
°©e
 = 
CURLFNM_SCHS_DEFAULT
;

294 
Áû
;

296 
CURLFNM_SCHS_RIGHTBRLEFTBR
:

297 if(
c
 == ']') {

298  
SETCHARSET_OK
;

301 
°©e
 = 
CURLFNM_SCHS_DEFAULT
;

302 
ch¨£t
[
c
] = 1;

303 (*
p
)++;

308 
Áû
:

309  
SETCHARSET_FAIL
;

310 
	}
}

312 
	$lo›
(c⁄° *
∑âîn
, c⁄° *
°rög
)

314 
lo›_°©e
 
°©e
 = 
CURLFNM_LOOP_DEFAULT
;

315 *
p
 = (*)
∑âîn
;

316 *
s
 = (*)
°rög
;

317 
ch¨£t
[
CURLFNM_CHSET_SIZE
] = { 0 };

318 
rc
 = 0;

321 
°©e
) {

322 
CURLFNM_LOOP_DEFAULT
:

323 if(*
p
 == '*') {

324 *(
p
+1) == '*')

325 
p
++;

326 if(*
s
 ='\0' && *(
p
+1) == '\0')

327  
CURL_FNMATCH_MATCH
;

328 
rc
 = 
	`lo›
(
p
 + 1, 
s
);

329 if(
rc
 =
CURL_FNMATCH_MATCH
)

330  
CURL_FNMATCH_MATCH
;

331 if(*
s
)

332 
s
++;

334  
CURL_FNMATCH_NOMATCH
;

336 if(*
p
 == '?') {

337 if(
	`ISPRINT
(*
s
)) {

338 
s
++;

339 
p
++;

341 if(*
s
 == '\0')

342  
CURL_FNMATCH_NOMATCH
;

344  
CURL_FNMATCH_FAIL
;

346 if(*
p
 == '\0') {

347 if(*
s
 == '\0')

348  
CURL_FNMATCH_MATCH
;

350  
CURL_FNMATCH_NOMATCH
;

352 if(*
p
 == '\\') {

353 
°©e
 = 
CURLFNM_LOOP_BACKSLASH
;

354 
p
++;

356 if(*
p
 == '[') {

357 *
µ
 = 
p
+1;

358 if(
	`£tch¨£t
(&
µ
, 
ch¨£t
)) {

359 
found
 = 
FALSE
;

360 if(
ch¨£t
[()*
s
])

361 
found
 = 
TRUE
;

362 if(
ch¨£t
[
CURLFNM_ALNUM
])

363 
found
 = 
	`ISALNUM
(*
s
);

364 if(
ch¨£t
[
CURLFNM_ALPHA
])

365 
found
 = 
	`ISALPHA
(*
s
);

366 if(
ch¨£t
[
CURLFNM_DIGIT
])

367 
found
 = 
	`ISDIGIT
(*
s
);

368 if(
ch¨£t
[
CURLFNM_XDIGIT
])

369 
found
 = 
	`ISXDIGIT
(*
s
);

370 if(
ch¨£t
[
CURLFNM_PRINT
])

371 
found
 = 
	`ISPRINT
(*
s
);

372 if(
ch¨£t
[
CURLFNM_SPACE
])

373 
found
 = 
	`ISSPACE
(*
s
);

374 if(
ch¨£t
[
CURLFNM_UPPER
])

375 
found
 = 
	`ISUPPER
(*
s
);

376 if(
ch¨£t
[
CURLFNM_LOWER
])

377 
found
 = 
	`ISLOWER
(*
s
);

378 if(
ch¨£t
[
CURLFNM_BLANK
])

379 
found
 = 
	`ISBLANK
(*
s
);

380 if(
ch¨£t
[
CURLFNM_GRAPH
])

381 
found
 = 
	`ISGRAPH
(*
s
);

383 if(
ch¨£t
[
CURLFNM_NEGATE
])

384 
found
 = !found;

386 if(
found
) {

387 
p
 = 
µ
+1;

388 
s
++;

389 
	`mem£t
(
ch¨£t
, 0, 
CURLFNM_CHSET_SIZE
);

392  
CURL_FNMATCH_NOMATCH
;

395  
CURL_FNMATCH_FAIL
;

398 if(*
p
++ !*
s
++)

399  
CURL_FNMATCH_NOMATCH
;

402 
CURLFNM_LOOP_BACKSLASH
:

403 if(
	`ISPRINT
(*
p
)) {

404 if(*
p
++ =*
s
++)

405 
°©e
 = 
CURLFNM_LOOP_DEFAULT
;

407  
CURL_FNMATCH_NOMATCH
;

410  
CURL_FNMATCH_FAIL
;

414 
	}
}

419 
	$Cuæ_‚m©ch
(*
±r
, c⁄° *
∑âîn
, c⁄° *
°rög
)

421 ()
±r
;

423 if(!
∑âîn
 || !
°rög
) {

424  
CURL_FNMATCH_FAIL
;

426  
	`lo›
((*)
∑âîn
, (*)
°rög
);

427 
	}
}

	@lib/curl_fnmatch.h

1 #i‚de‡
HEADER_CURL_FNMATCH_H


2 
	#HEADER_CURL_FNMATCH_H


	)

25 
	#CURL_FNMATCH_MATCH
 0

	)

26 
	#CURL_FNMATCH_NOMATCH
 1

	)

27 
	#CURL_FNMATCH_FAIL
 2

	)

42 
Cuæ_‚m©ch
(*
±r
, c⁄° *
∑âîn
, c⁄° *
°rög
);

	@lib/curl_gethostname.c

23 
	~"cuæ_£tup.h
"

25 
	~"cuæ_gëho°«me.h
"

51 
	$Cuæ_gëho°«me
(*
«me
, 
GETHOSTNAME_TYPE_ARG2
 
«mñí
) {

53 #i‚de‡
HAVE_GETHOSTNAME


56 (Ë
«me
;

57 (Ë
«mñí
;

61 
îr
;

62 * 
dŸ
;

64 #ifde‡
DEBUGBUILD


67 c⁄° *
f‹˚_ho°«me
 = 
	`gëív
("CURL_GETHOSTNAME");

68 if(
f‹˚_ho°«me
) {

69 
	`°∫˝y
(
«me
, 
f‹˚_ho°«me
, 
«mñí
);

70 
îr
 = 0;

73 
«me
[0] = '\0';

74 
îr
 = 
	`gëho°«me
(
«me
, 
«mñí
);

82 
«me
[0] = '\0';

83 
îr
 = 
	`gëho°«me
(
«me
, 
«mñí
);

87 
«me
[
«mñí
 - 1] = '\0';

89 if(
îr
)

90  
îr
;

93 
dŸ
 = 
	`°rchr
(
«me
, '.');

94 if(
dŸ
)

95 *
dŸ
 = '\0';

100 
	}
}

	@lib/curl_gethostname.h

1 #i‚de‡
HEADER_CURL_GETHOSTNAME_H


2 
	#HEADER_CURL_GETHOSTNAME_H


	)

26 
	#HOSTNAME_MAX
 1024

	)

29 
Cuæ_gëho°«me
(*
«me
, 
GETHOSTNAME_TYPE_ARG2
 
«mñí
);

	@lib/curl_gssapi.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_GSSAPI


27 
	~"cuæ_gsßpi.h
"

28 
	~"£ndf.h
"

30 
OM_uöt32
 
	$Cuæ_gss_öô_£c_c⁄ãxt
(

31 
Sessi⁄H™dÀ
 *
d©a
,

32 
OM_uöt32
 * 
mö‹_°©us
,

33 
gss_˘x_id_t
 * 
c⁄ãxt
,

34 
gss_«me_t
 
èrgë_«me
,

35 
gss_ch™√l_bödögs_t
 
öput_ch™_bödögs
,

36 
gss_buf„r_t
 
öput_tokí
,

37 
gss_buf„r_t
 
ouçut_tokí
,

38 
OM_uöt32
 * 
ªt_Êags
)

40 
OM_uöt32
 
ªq_Êags
 = 
GSS_C_MUTUAL_FLAG
 | 
GSS_C_REPLAY_FLAG
;

42 if(
d©a
->
£t
.
gsßpi_dñeg©i⁄
 & 
CURLGSSAPI_DELEGATION_POLICY_FLAG
) {

43 #ifde‡
GSS_C_DELEG_POLICY_FLAG


44 
ªq_Êags
 |
GSS_C_DELEG_POLICY_FLAG
;

46 
	`öfof
(
d©a
, "warning: support for CURLGSSAPI_DELEGATION_POLICY_FLAGÇot "

51 if(
d©a
->
£t
.
gsßpi_dñeg©i⁄
 & 
CURLGSSAPI_DELEGATION_FLAG
)

52 
ªq_Êags
 |
GSS_C_DELEG_FLAG
;

54  
	`gss_öô_£c_c⁄ãxt
(
mö‹_°©us
,

55 
GSS_C_NO_CREDENTIAL
,

56 
c⁄ãxt
,

57 
èrgë_«me
,

58 
GSS_C_NO_OID
,

59 
ªq_Êags
,

61 
öput_ch™_bödögs
,

62 
öput_tokí
,

63 
NULL
,

64 
ouçut_tokí
,

65 
ªt_Êags
,

66 
NULL
 );

67 
	}
}

	@lib/curl_gssapi.h

1 #i‚de‡
HEADER_CURL_GSSAPI_H


2 
	#HEADER_CURL_GSSAPI_H


	)

25 
	~"cuæ_£tup.h
"

26 
	~"uæd©a.h
"

28 #ifde‡
HAVE_GSSAPI


30 #ifde‡
HAVE_GSSGNU


31 
	~<gss.h
>

32 #ñi‡
deföed
 
HAVE_GSSMIT


34 
	~<gsßpi/gsßpi.h
>

35 
	~<gsßpi/gsßpi_gíîic.h
>

36 
	~<gsßpi/gsßpi_krb5.h
>

39 
	~<gsßpi.h
>

45 
OM_uöt32
 
Cuæ_gss_öô_£c_c⁄ãxt
(

46 
Sessi⁄H™dÀ
 *
d©a
,

47 
OM_uöt32
 * 
mö‹_°©us
,

48 
gss_˘x_id_t
 * 
c⁄ãxt
,

49 
gss_«me_t
 
èrgë_«me
,

50 
gss_ch™√l_bödögs_t
 
öput_ch™_bödögs
,

51 
gss_buf„r_t
 
öput_tokí
,

52 
gss_buf„r_t
 
ouçut_tokí
,

53 
OM_uöt32
 * 
ªt_Êags
);

	@lib/curl_hmac.h

1 #i‚de‡
HEADER_CURL_HMAC_H


2 
	#HEADER_CURL_HMAC_H


	)

25 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


27 (* 
	tHMAC_höô_func
)(* 
	tc⁄ãxt
);

28 (* 
	tHMAC_hupd©e_func
)(* 
	tc⁄ãxt
,

29 c⁄° * 
	td©a
,

30 
	tÀn
);

31 (* 
	tHMAC_hföÆ_func
)(* 
	tªsu…
, * 
	tc⁄ãxt
);

37 
HMAC_höô_func
 
hmac_höô
;

38 
HMAC_hupd©e_func
 
hmac_hupd©e
;

39 
HMAC_hföÆ_func
 
hmac_hföÆ
;

40 
hmac_˘xtsize
;

41 
hmac_maxkeyÀn
;

42 
hmac_ªsu…Àn
;

43 } 
	tHMAC_∑øms
;

49 c⁄° 
HMAC_∑øms
 * 
hmac_hash
;

50 * 
hmac_hash˘xt1
;

51 * 
hmac_hash˘xt2
;

52 } 
	tHMAC_c⁄ãxt
;

57 
HMAC_c⁄ãxt
 * 
	`Cuæ_HMAC_öô
(c⁄° 
HMAC_∑øms
 * 
hash∑øms
,

58 c⁄° * 
key
,

59 
keyÀn
);

60 
	`Cuæ_HMAC_upd©e
(
HMAC_c⁄ãxt
 * 
c⁄ãxt
,

61 c⁄° * 
d©a
,

62 
Àn
);

63 
	`Cuæ_HMAC_föÆ
(
HMAC_c⁄ãxt
 * 
c⁄ãxt
, * 
ªsu…
);

	@lib/curl_ldap.h

1 #i‚de‡
HEADER_CURL_LDAP_H


2 
	#HEADER_CURL_LDAP_H


	)

24 #i‚de‡
CURL_DISABLE_LDAP


25 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_ld≠
;

27 #i‡!
deföed
(
CURL_DISABLE_LDAPS
) && \

28 ((
deföed
(
USE_OPENLDAP
Ë&& deföed(
USE_SSL
)) || \

29 (!
deföed
(
USE_OPENLDAP
Ë&& 
	$deföed
(
HAVE_LDAP_SSL
)))

30 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_ld≠s
;

	@lib/curl_md4.h

1 #i‚de‡
HEADER_CURL_MD4_H


2 
	#HEADER_CURL_MD4_H


	)

25 
	~"cuæ_£tup.h
"

29 #ifde‡
USE_NSS


30 
Cuæ_md4ô
(*
ouçut
, c⁄° *
öput
, 
size_t
 
Àn
);

	@lib/curl_md5.h

1 #i‚de‡
HEADER_CURL_MD5_H


2 
	#HEADER_CURL_MD5_H


	)

25 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


26 
	~"cuæ_hmac.h
"

28 
	#MD5_DIGEST_LEN
 16

	)

30 (* 
	tCuæ_MD5_öô_func
)(*
	tc⁄ãxt
);

31 (* 
	tCuæ_MD5_upd©e_func
)(*
	tc⁄ãxt
,

32 c⁄° *
	td©a
,

33 
	tÀn
);

34 (* 
	tCuæ_MD5_föÆ_func
)(*
	tªsu…
, *
	tc⁄ãxt
);

37 
Cuæ_MD5_öô_func
 
md5_öô_func
;

38 
Cuæ_MD5_upd©e_func
 
md5_upd©e_func
;

39 
Cuæ_MD5_föÆ_func
 
md5_föÆ_func
;

40 
md5_˘xtsize
;

41 
md5_ªsu…Àn
;

42 } 
	tMD5_∑øms
;

45 c⁄° 
MD5_∑øms
 *
md5_hash
;

46 *
md5_hash˘x
;

47 } 
	tMD5_c⁄ãxt
;

49 c⁄° 
MD5_∑øms
 
Cuæ_DIGEST_MD5
[1];

50 c⁄° 
HMAC_∑øms
 
Cuæ_HMAC_MD5
[1];

52 
	`Cuæ_md5ô
(*
ouçut
,

53 c⁄° *
öput
);

55 
MD5_c⁄ãxt
 * 
	`Cuæ_MD5_öô
(c⁄° 
MD5_∑øms
 *
md5∑øms
);

56 
	`Cuæ_MD5_upd©e
(
MD5_c⁄ãxt
 *
c⁄ãxt
,

57 c⁄° *
d©a
,

58 
Àn
);

59 
	`Cuæ_MD5_föÆ
(
MD5_c⁄ãxt
 *
c⁄ãxt
, *
ªsu…
);

	@lib/curl_memory.h

1 #i‚de‡
HEADER_CURL_MEMORY_H


2 
	#HEADER_CURL_MEMORY_H


	)

77 #ifde‡
HEADER_CURL_MEMDEBUG_H


81 #i‚de‡
CURLX_NO_MEMORY_CALLBACKS


83 
	~<cuæ/cuæ.h
>

85 
cuæ_mÆloc_ˇŒback
 
Cuæ_cmÆloc
;

86 
cuæ_‰ì_ˇŒback
 
Cuæ_c‰ì
;

87 
cuæ_ªÆloc_ˇŒback
 
Cuæ_¸óŒoc
;

88 
cuæ_°rdup_ˇŒback
 
Cuæ_c°rdup
;

89 
cuæ_ˇŒoc_ˇŒback
 
Cuæ_cˇŒoc
;

90 #i‡
deföed
(
WIN32
Ë&& deföed(
UNICODE
)

91 
cuæ_wcsdup_ˇŒback
 
Cuæ_cwcsdup
;

94 #i‚de‡
CURLDEBUG


105 #unde‡
°rdup


106 
	#°rdup
(
±r
Ë
	`Cuæ_c°rdup
’å)

	)

107 #unde‡
mÆloc


108 
	#mÆloc
(
size
Ë
	`Cuæ_cmÆloc
(size)

	)

109 #unde‡
ˇŒoc


110 
	#ˇŒoc
(
nbñem
,
size
Ë
	`Cuæ_cˇŒoc
“bñem, size)

	)

111 #unde‡
ªÆloc


112 
	#ªÆloc
(
±r
,
size
Ë
	`Cuæ_¸óŒoc
’å, size)

	)

113 #unde‡
‰ì


114 
	#‰ì
(
±r
Ë
	`Cuæ_c‰ì
’å)

	)

116 #ifde‡
WIN32


117 #ifde‡
UNICODE


118 #unde‡
wcsdup


119 
	#wcsdup
(
±r
Ë
	`Cuæ_cwcsdup
’å)

	)

120 #unde‡
_wcsdup


121 
	#_wcsdup
(
±r
Ë
	`Cuæ_cwcsdup
’å)

	)

122 #unde‡
_tcsdup


123 
	#_tcsdup
(
±r
Ë
	`Cuæ_cwcsdup
’å)

	)

125 #unde‡
_tcsdup


126 
	#_tcsdup
(
±r
Ë
	`Cuæ_c°rdup
’å)

	)

134 #i‚de‡
MEMDEBUG_NODEFINES


135 
	#MEMDEBUG_NODEFINES


	)

	@lib/curl_memrchr.c

23 
	~"cuæ_£tup.h
"

25 
	~"cuæ_memrchr.h
"

27 
	#_MPRINTF_REPLACE


	)

28 
	~<cuæ/m¥ötf.h
>

30 
	~"cuæ_mem‹y.h
"

32 
	~"memdebug.h
"

34 #i‚de‡
HAVE_MEMRCHR


46 
	$Cuæ_memrchr
(c⁄° *
s
, 
c
, 
size_t
 
n
)

48 c⁄° *
p
 = 
s
;

49 c⁄° *
q
 = 
s
;

51 
p
 +
n
 - 1;

53 
p
 >
q
) {

54 if(*
p
 =()
c
)

55  (*)
p
;

56 
p
--;

59  
NULL
;

60 
	}
}

	@lib/curl_memrchr.h

1 #i‚de‡
HEADER_CURL_MEMRCHR_H


2 
	#HEADER_CURL_MEMRCHR_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
HAVE_MEMRCHR


29 #ifde‡
HAVE_STRING_H


30 
	~<°rög.h
>

32 #ifde‡
HAVE_STRINGS_H


33 
	~<°rögs.h
>

38 *
Cuæ_memrchr
(c⁄° *
s
, 
c
, 
size_t
 
n
);

40 
	#memrchr
(
x
,
y
,
z
Ë
	`Cuæ_memrchr
((x),(y),(z))

	)

	@lib/curl_multibyte.c

23 
	~"cuæ_£tup.h
"

25 #i‡
deföed
(
USE_WIN32_IDN
Ë|| (deföed(
USE_WINDOWS_SSPI
Ë&& deföed(
UNICODE
))

31 
	~"cuæ_mu…ibyã.h
"

33 
	#_MPRINTF_REPLACE


	)

34 
	~<cuæ/m¥ötf.h
>

36 
	~"cuæ_mem‹y.h
"

38 
	~"memdebug.h
"

40 
wch¨_t
 *
	$Cuæ_c⁄vît_UTF8_to_wch¨
(c⁄° *
°r_utf8
)

42 
wch¨_t
 *
°r_w
 = 
NULL
;

44 if(
°r_utf8
) {

45 
°r_w_Àn
 = 
	`Mu…iByãToWideCh¨
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
,

46 
°r_utf8
, -1, 
NULL
, 0);

47 if(
°r_w_Àn
 > 0) {

48 
°r_w
 = 
	`mÆloc
(
°r_w_Àn
 * (
wch¨_t
));

49 if(
°r_w
) {

50 if(
	`Mu…iByãToWideCh¨
(
CP_UTF8
, 0, 
°r_utf8
, -1, 
°r_w
,

51 
°r_w_Àn
) == 0) {

52 
	`Cuæ_ß„‰ì
(
°r_w
);

58  
°r_w
;

59 
	}
}

61 *
	$Cuæ_c⁄vît_wch¨_to_UTF8
(c⁄° 
wch¨_t
 *
°r_w
)

63 *
°r_utf8
 = 
NULL
;

65 if(
°r_w
) {

66 
°r_utf8_Àn
 = 
	`WideCh¨ToMu…iByã
(
CP_UTF8
, 0, 
°r_w
, -1, 
NULL
,

67 0, 
NULL
, NULL);

68 if(
°r_utf8_Àn
 > 0) {

69 
°r_utf8
 = 
	`mÆloc
(
°r_utf8_Àn
 * (
wch¨_t
));

70 if(
°r_utf8
) {

71 if(
	`WideCh¨ToMu…iByã
(
CP_UTF8
, 0, 
°r_w
, -1, 
°r_utf8
, 
°r_utf8_Àn
,

72 
NULL
, 
FALSE
) == 0) {

73 
	`Cuæ_ß„‰ì
(
°r_utf8
);

79  
°r_utf8
;

80 
	}
}

	@lib/curl_multibyte.h

1 #i‚de‡
HEADER_CURL_MULTIBYTE_H


2 
	#HEADER_CURL_MULTIBYTE_H


	)

24 
	~"cuæ_£tup.h
"

26 #i‡
deföed
(
USE_WIN32_IDN
Ë|| (deföed(
USE_WINDOWS_SSPI
Ë&& deföed(
UNICODE
))

32 
wch¨_t
 *
Cuæ_c⁄vît_UTF8_to_wch¨
(c⁄° *
°r_utf8
);

33 *
Cuæ_c⁄vît_wch¨_to_UTF8
(c⁄° 
wch¨_t
 *
°r_w
);

38 #i‡
deföed
(
USE_WIN32_IDN
Ë|| deföed(
USE_WINDOWS_SSPI
)

58 #ifde‡
UNICODE


60 
	#Cuæ_c⁄vît_UTF8_to_tch¨
(
±r
Ë
	`Cuæ_c⁄vît_UTF8_to_wch¨
(’å))

	)

61 
	#Cuæ_c⁄vît_tch¨_to_UTF8
(
±r
Ë
	`Cuæ_c⁄vît_wch¨_to_UTF8
(’å))

	)

62 
	#Cuæ_unicode‰ì
(
±r
) \

63 dÿ{if((
±r
)Ë{
	`‰ì
(’å)); (±rË
NULL
;}} 
WHILE_FALSE


	)

66 *
	mtch¨_±r
;

67 c⁄° *
	mc⁄°_tch¨_±r
;

68 *
	mtbyã_±r
;

69 c⁄° *
	mc⁄°_tbyã_±r
;

70 } 
	txch¨p_u
;

74 
	#Cuæ_c⁄vît_UTF8_to_tch¨
(
±r
Ë’å)

	)

75 
	#Cuæ_c⁄vît_tch¨_to_UTF8
(
±r
Ë’å)

	)

76 
	#Cuæ_unicode‰ì
(
±r
) \

77 dÿ{(
±r
Ë
NULL
;} 
WHILE_FALSE


	)

80 *
	mtch¨_±r
;

81 c⁄° *
	mc⁄°_tch¨_±r
;

82 *
	mtbyã_±r
;

83 c⁄° *
	mc⁄°_tbyã_±r
;

84 } 
	txch¨p_u
;

	@lib/curl_ntlm.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
USE_NTLM


34 
	#DEBUG_ME
 0

	)

36 
	~"uæd©a.h
"

37 
	~"£ndf.h
"

38 
	~"øw°r.h
"

39 
	~"cuæ_¡lm.h
"

40 
	~"cuæ_¡lm_msgs.h
"

41 
	~"cuæ_¡lm_wb.h
"

42 
	~"uæ.h
"

43 
	~"cuæ_mem‹y.h
"

45 
	#_MPRINTF_REPLACE


	)

46 
	~<cuæ/m¥ötf.h
>

48 #i‡
deföed
(
USE_NSS
)

49 
	~"vés/nssg.h
"

50 #ñi‡
deföed
(
USE_WINDOWS_SSPI
)

51 
	~"cuæ_s•i.h
"

55 
	~"memdebug.h
"

57 #i‡
DEBUG_ME


58 
	#DEBUG_OUT
(
x
Ë
	)
x

60 
	#DEBUG_OUT
(
x
Ë
Cuæ_n›_°mt


	)

63 
CURLcode
 
	$Cuæ_öput_¡lm
(
c⁄√˘d©a
 *
c⁄n
,

64 
boﬁ
 
¥oxy
,

65 c⁄° *
hódî
)

69 
¡lmd©a
 *
¡lm
;

70 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

72 #ifde‡
USE_NSS


73 
ªsu…
 = 
	`Cuæ_nss_f‹˚_öô
(
c⁄n
->
d©a
);

74 if(
ªsu…
)

75  
ªsu…
;

78 
¡lm
 = 
¥oxy
 ? &
c⁄n
->
¥oxy¡lm
 : &conn->ntlm;

80 if(
	`check¥efix
("NTLM", 
hódî
)) {

81 
hódî
 +
	`°æí
("NTLM");

83 *
hódî
 && 
	`ISSPACE
(*header))

84 
hódî
++;

86 if(*
hódî
) {

87 
ªsu…
 = 
	`Cuæ_¡lm_decode_ty≥2_mesßge
(
c⁄n
->
d©a
, 
hódî
, 
¡lm
);

88 if(
CURLE_OK
 !
ªsu…
)

89  
ªsu…
;

91 
¡lm
->
°©e
 = 
NTLMSTATE_TYPE2
;

94 if(
¡lm
->
°©e
 =
NTLMSTATE_TYPE3
) {

95 
	`öfof
(
c⁄n
->
d©a
, "NTLM handshakeÑejected\n");

96 
	`Cuæ_hâp_¡lm_˛ónup
(
c⁄n
);

97 
¡lm
->
°©e
 = 
NTLMSTATE_NONE
;

98  
CURLE_REMOTE_ACCESS_DENIED
;

100 if(
¡lm
->
°©e
 >
NTLMSTATE_TYPE1
) {

101 
	`öfof
(
c⁄n
->
d©a
, "NTLM handshake failure (internalÉrror)\n");

102  
CURLE_REMOTE_ACCESS_DENIED
;

105 
¡lm
->
°©e
 = 
NTLMSTATE_TYPE1
;

109  
ªsu…
;

110 
	}
}

115 
CURLcode
 
	$Cuæ_ouçut_¡lm
(
c⁄√˘d©a
 *
c⁄n
,

116 
boﬁ
 
¥oxy
)

118 *
ba£64
 = 
NULL
;

119 
size_t
 
Àn
 = 0;

120 
CURLcode
 
îr‹
;

124 **
Ælocu£Ωwd
;

127 c⁄° *
u£Ω
;

128 c⁄° *
∑sswdp
;

131 
¡lmd©a
 *
¡lm
;

132 
auth
 *
authp
;

134 
	`DEBUGASSERT
(
c⁄n
);

135 
	`DEBUGASSERT
(
c⁄n
->
d©a
);

137 #ifde‡
USE_NSS


138 if(
CURLE_OK
 !
	`Cuæ_nss_f‹˚_öô
(
c⁄n
->
d©a
))

139  
CURLE_OUT_OF_MEMORY
;

142 if(
¥oxy
) {

143 
Ælocu£Ωwd
 = &
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
;

144 
u£Ω
 = 
c⁄n
->
¥oxyu£r
;

145 
∑sswdp
 = 
c⁄n
->
¥oxy∑sswd
;

146 
¡lm
 = &
c⁄n
->
¥oxy¡lm
;

147 
authp
 = &
c⁄n
->
d©a
->
°©e
.
auth¥oxy
;

150 
Ælocu£Ωwd
 = &
c⁄n
->
Ælo˝å
.
u£Ωwd
;

151 
u£Ω
 = 
c⁄n
->
u£r
;

152 
∑sswdp
 = 
c⁄n
->
∑sswd
;

153 
¡lm
 = &
c⁄n
->ntlm;

154 
authp
 = &
c⁄n
->
d©a
->
°©e
.
authho°
;

156 
authp
->
d⁄e
 = 
FALSE
;

159 if(!
u£Ω
)

160 
u£Ω
 = "";

162 if(!
∑sswdp
)

163 
∑sswdp
 = "";

165 #ifde‡
USE_WINDOWS_SSPI


166 if(
s_hSecDŒ
 =
NULL
) {

168 
CURLcode
 
îr
 = 
	`Cuæ_s•i_globÆ_öô
();

169 if(
s_hSecDŒ
 =
NULL
)

170  
îr
;

174 
¡lm
->
°©e
) {

175 
NTLMSTATE_TYPE1
:

178 
îr‹
 = 
	`Cuæ_¡lm_¸óã_ty≥1_mesßge
(
u£Ω
, 
∑sswdp
, 
¡lm
, &
ba£64
,

179 &
Àn
);

180 if(
îr‹
)

181  
îr‹
;

183 if(
ba£64
) {

184 
	`Cuæ_ß„‰ì
(*
Ælocu£Ωwd
);

185 *
Ælocu£Ωwd
 = 
	`≠rötf
("%sAuthorization: NTLM %s\r\n",

186 
¥oxy
 ? "Proxy-" : "",

187 
ba£64
);

188 
	`‰ì
(
ba£64
);

189 if(!*
Ælocu£Ωwd
)

190  
CURLE_OUT_OF_MEMORY
;

191 
	`DEBUG_OUT
(
	`Ârötf
(
°dîr
, "**** Hódî %s\¿", *
Ælocu£Ωwd
));

195 
NTLMSTATE_TYPE2
:

197 
îr‹
 = 
	`Cuæ_¡lm_¸óã_ty≥3_mesßge
(
c⁄n
->
d©a
, 
u£Ω
, 
∑sswdp
,

198 
¡lm
, &
ba£64
, &
Àn
);

199 if(
îr‹
)

200  
îr‹
;

202 if(
ba£64
) {

203 
	`Cuæ_ß„‰ì
(*
Ælocu£Ωwd
);

204 *
Ælocu£Ωwd
 = 
	`≠rötf
("%sAuthorization: NTLM %s\r\n",

205 
¥oxy
 ? "Proxy-" : "",

206 
ba£64
);

207 
	`‰ì
(
ba£64
);

208 if(!*
Ælocu£Ωwd
)

209  
CURLE_OUT_OF_MEMORY
;

210 
	`DEBUG_OUT
(
	`Ârötf
(
°dîr
, "**** %s\¿", *
Ælocu£Ωwd
));

212 
¡lm
->
°©e
 = 
NTLMSTATE_TYPE3
;

213 
authp
->
d⁄e
 = 
TRUE
;

217 
NTLMSTATE_TYPE3
:

220 
	`Cuæ_ß„‰ì
(*
Ælocu£Ωwd
);

221 
authp
->
d⁄e
 = 
TRUE
;

225  
CURLE_OK
;

226 
	}
}

228 
	$Cuæ_hâp_¡lm_˛ónup
(
c⁄√˘d©a
 *
c⁄n
)

230 #ifde‡
USE_WINDOWS_SSPI


231 
	`Cuæ_¡lm_s•i_˛ónup
(&
c⁄n
->
¡lm
);

232 
	`Cuæ_¡lm_s•i_˛ónup
(&
c⁄n
->
¥oxy¡lm
);

233 #ñi‡
	`deföed
(
NTLM_WB_ENABLED
)

234 
	`Cuæ_¡lm_wb_˛ónup
(
c⁄n
);

236 ()
c⁄n
;

239 #i‚de‡
USE_WINDOWS_SSPI


240 
	`Cuæ_ß„‰ì
(
c⁄n
->
¡lm
.
èrgë_öfo
);

241 
c⁄n
->
¡lm
.
èrgë_öfo_Àn
 = 0;

243 
	`Cuæ_ß„‰ì
(
c⁄n
->
¥oxy¡lm
.
èrgë_öfo
);

244 
c⁄n
->
¥oxy¡lm
.
èrgë_öfo_Àn
 = 0;

246 
	}
}

	@lib/curl_ntlm.h

1 #i‚de‡
HEADER_CURL_NTLM_H


2 
	#HEADER_CURL_NTLM_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
USE_NTLM


30 
CURLcode
 
Cuæ_öput_¡lm
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
,

31 c⁄° *
hódî
);

34 
CURLcode
 
Cuæ_ouçut_¡lm
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
);

36 
Cuæ_hâp_¡lm_˛ónup
(
c⁄√˘d©a
 *
c⁄n
);

40 
	#Cuæ_hâp_¡lm_˛ónup
(
a
Ë
Cuæ_n›_°mt


	)

	@lib/curl_ntlm_core.c

23 
	~"cuæ_£tup.h
"

25 #i‡
deföed
(
USE_NTLM
Ë&& !deföed(
USE_WINDOWS_SSPI
)

34 #ifde‡
USE_SSLEAY


36 #ifde‡
USE_OPENSSL


37 
	~<›ís¶/des.h
>

38 #i‚de‡
OPENSSL_NO_MD4


39 
	~<›ís¶/md4.h
>

41 
	~<›ís¶/md5.h
>

42 
	~<›ís¶/s¶.h
>

43 
	~<›ís¶/ønd.h
>

45 
	~<des.h
>

46 #i‚de‡
OPENSSL_NO_MD4


47 
	~<md4.h
>

49 
	~<md5.h
>

50 
	~<s¶.h
>

51 
	~<ønd.h
>

53 #i‡(
OPENSSL_VERSION_NUMBER
 < 0x00907001L)

54 
	#DES_key_scheduÀ
 
des_key_scheduÀ


	)

55 
	#DES_cblock
 
des_cblock


	)

56 
	#DES_£t_odd_∑rôy
 
des_£t_odd_∑rôy


	)

57 
	#DES_£t_key
 
des_£t_key


	)

58 
	#DES_ecb_í¸y±
 
des_ecb_í¸y±


	)

59 
	#DESKEY
(
x
Ë
	)
x

60 
	#DESKEYARG
(
x
Ë
	)
x

62 
	#DESKEYARG
(
x
Ë*
	)
x

63 
	#DESKEY
(
x
Ë&
	)
x

66 #ñi‡
deföed
(
USE_GNUTLS_NETTLE
)

68 
	~<√âÀ/des.h
>

69 
	~<√âÀ/md4.h
>

71 #ñi‡
deföed
(
USE_GNUTLS
)

73 
	~<g¸y±.h
>

74 
	#MD5_DIGEST_LENGTH
 16

	)

75 
	#MD4_DIGEST_LENGTH
 16

	)

77 #ñi‡
deföed
(
USE_NSS
)

79 
	~<nss.h
>

80 
	~<pk11pub.h
>

81 
	~<hasht.h
>

82 
	~"cuæ_md4.h
"

83 
	#MD5_DIGEST_LENGTH
 
MD5_LENGTH


	)

85 #ñi‡
deföed
(
USE_DARWINSSL
)

87 
	~<Comm⁄Cry±o/Comm⁄Cry±‹.h
>

88 
	~<Comm⁄Cry±o/Comm⁄Dige°.h
>

94 
	~"uæd©a.h
"

95 
	~"n⁄-ascii.h
"

96 
	~"øw°r.h
"

97 
	~"cuæ_mem‹y.h
"

98 
	~"cuæ_¡lm_c‹e.h
"

99 
	~"cuæ_md5.h
"

100 
	~"cuæ_hmac.h
"

101 
	~"w¨∆ess.h
"

103 
	#_MPRINTF_REPLACE


	)

104 
	~<cuæ/m¥ötf.h
>

107 
	~"memdebug.h
"

109 
	#NTLM_HMAC_MD5_LEN
 (16)

	)

110 
	#NTLMv2_BLOB_SIGNATURE
 "\x01\x01\x00\x00"

	)

111 
	#NTLMv2_BLOB_LEN
 (44 -16 + 
¡lm
->
èrgë_öfo_Àn
 + 4)

	)

113 #ifde‡
USE_SSLEAY


118 
£tup_des_key
(c⁄° *
key_56
,

119 
DES_key_scheduÀ
 
	$DESKEYARG
(
ks
))

121 
DES_cblock
 
key
;

123 
key
[0] = 
key_56
[0];

124 
key
[1] = ()(((
key_56
[0] << 7) & 0xFF) | (key_56[1] >> 1));

125 
key
[2] = ()(((
key_56
[1] << 6) & 0xFF) | (key_56[2] >> 2));

126 
key
[3] = ()(((
key_56
[2] << 5) & 0xFF) | (key_56[3] >> 3));

127 
key
[4] = ()(((
key_56
[3] << 4) & 0xFF) | (key_56[4] >> 4));

128 
key
[5] = ()(((
key_56
[4] << 3) & 0xFF) | (key_56[5] >> 5));

129 
key
[6] = ()(((
key_56
[5] << 2) & 0xFF) | (key_56[6] >> 6));

130 
key
[7] = (Ë((
key_56
[6] << 1) & 0xFF);

132 
	`DES_£t_odd_∑rôy
(&
key
);

133 
	`DES_£t_key
(&
key
, 
ks
);

134 
	}
}

141 
	$exãnd_key_56_to_64
(c⁄° *
key_56
, *
key
)

143 
key
[0] = 
key_56
[0];

144 
key
[1] = ()(((
key_56
[0] << 7) & 0xFF) | (key_56[1] >> 1));

145 
key
[2] = ()(((
key_56
[1] << 6) & 0xFF) | (key_56[2] >> 2));

146 
key
[3] = ()(((
key_56
[2] << 5) & 0xFF) | (key_56[3] >> 3));

147 
key
[4] = ()(((
key_56
[3] << 4) & 0xFF) | (key_56[4] >> 4));

148 
key
[5] = ()(((
key_56
[4] << 3) & 0xFF) | (key_56[5] >> 5));

149 
key
[6] = ()(((
key_56
[5] << 2) & 0xFF) | (key_56[6] >> 6));

150 
key
[7] = (Ë((
key_56
[6] << 1) & 0xFF);

151 
	}
}

153 #i‡
deföed
(
USE_GNUTLS_NETTLE
)

155 
	$£tup_des_key
(c⁄° *
key_56
,

156 
des_˘x
 *
des
)

158 
key
[8];

159 
	`exãnd_key_56_to_64
(
key_56
, 
key
);

160 
	`des_£t_key
(
des
, (c⁄° 
uöt8_t
*)
key
);

161 
	}
}

163 #ñi‡
deföed
(
USE_GNUTLS
)

168 
	$£tup_des_key
(c⁄° *
key_56
,

169 
g¸y_cùhî_hd_t
 *
des
)

171 
key
[8];

172 
	`exãnd_key_56_to_64
(
key_56
, 
key
);

173 
	`g¸y_cùhî_£tkey
(*
des
, 
key
, 8);

174 
	}
}

176 #ñi‡
deföed
(
USE_NSS
)

183 
boﬁ
 
	$í¸y±_des
(c⁄° *
ö
, *
out
,

184 c⁄° *
key_56
)

186 c⁄° 
CK_MECHANISM_TYPE
 
mech
 = 
CKM_DES_ECB
;

187 
PK11SlŸInfo
 *
¶Ÿ
 = 
NULL
;

188 
key
[8];

189 
SECIãm
 
key_ôem
;

190 
PK11SymKey
 *
symkey
 = 
NULL
;

191 
SECIãm
 *
∑øm
 = 
NULL
;

192 
PK11C⁄ãxt
 *
˘x
 = 
NULL
;

193 
out_Àn
;

194 
boﬁ
 
rv
 = 
FALSE
;

197 
¶Ÿ
 = 
	`PK11_GëI¡î«lKeySlŸ
();

198 if(!
¶Ÿ
)

199  
FALSE
;

202 
	`exãnd_key_56_to_64
(
key_56
, 
key
);

203 
key_ôem
.
d©a
 = (*)
key
;

204 
key_ôem
.
Àn
 = 8;

205 
symkey
 = 
	`PK11_Imp‹tSymKey
(
¶Ÿ
, 
mech
, 
PK11_OrigöUnwøp
, 
CKA_ENCRYPT
,

206 &
key_ôem
, 
NULL
);

207 if(!
symkey
)

208 
Áû
;

211 
∑øm
 = 
	`PK11_P¨amFromIV
(
mech
, 
NULL
);

212 if(!
∑øm
)

213 
Áû
;

214 
˘x
 = 
	`PK11_Cª©eC⁄ãxtBySymKey
(
mech
, 
CKA_ENCRYPT
, 
symkey
, 
∑øm
);

215 if(!
˘x
)

216 
Áû
;

219 if(
SECSuc˚ss
 =
	`PK11_CùhîOp
(
˘x
, 
out
, &
out_Àn
, 8,

220 (*)
ö
, 8)

221 && 
SECSuc˚ss
 =
	`PK11_FöÆize
(
˘x
))

222 
rv
 = 
TRUE
;

224 
Áû
:

226 if(
˘x
)

227 
	`PK11_De°royC⁄ãxt
(
˘x
, 
PR_TRUE
);

228 if(
symkey
)

229 
	`PK11_FªeSymKey
(
symkey
);

230 if(
∑øm
)

231 
	`SECITEM_FªeIãm
(
∑øm
, 
PR_TRUE
);

232 
	`PK11_FªeSlŸ
(
¶Ÿ
);

233  
rv
;

234 
	}
}

236 #ñi‡
deföed
(
USE_DARWINSSL
)

238 
boﬁ
 
	$í¸y±_des
(c⁄° *
ö
, *
out
,

239 c⁄° *
key_56
)

241 
key
[8];

242 
size_t
 
out_Àn
;

243 
CCCry±‹Sètus
 
îr
;

245 
	`exãnd_key_56_to_64
(
key_56
, 
key
);

246 
îr
 = 
	`CCCry±
(
kCCEn¸y±
, 
kCCAlg‹ôhmDES
, 
kCCO±i⁄ECBMode
, 
key
,

247 
kCCKeySizeDES
, 
NULL
, 
ö
, 8 , 
out
,

248 8 , &
out_Àn
);

249  
îr
 =
kCCSuc˚ss
;

250 
	}
}

261 
	$Cuæ_¡lm_c‹e_lm_ª•
(c⁄° *
keys
,

262 c⁄° *
∂aöãxt
,

263 *
ªsu…s
)

265 #ifde‡
USE_SSLEAY


266 
DES_key_scheduÀ
 
ks
;

268 
	`£tup_des_key
(
keys
, 
	`DESKEY
(
ks
));

269 
	`DES_ecb_í¸y±
((
DES_cblock
*Ë
∂aöãxt
, (DES_cblock*Ë
ªsu…s
,

270 
	`DESKEY
(
ks
), 
DES_ENCRYPT
);

272 
	`£tup_des_key
(
keys
 + 7, 
	`DESKEY
(
ks
));

273 
	`DES_ecb_í¸y±
((
DES_cblock
*Ë
∂aöãxt
, (DES_cblock*Ë(
ªsu…s
 + 8),

274 
	`DESKEY
(
ks
), 
DES_ENCRYPT
);

276 
	`£tup_des_key
(
keys
 + 14, 
	`DESKEY
(
ks
));

277 
	`DES_ecb_í¸y±
((
DES_cblock
*Ë
∂aöãxt
, (DES_cblock*Ë(
ªsu…s
 + 16),

278 
	`DESKEY
(
ks
), 
DES_ENCRYPT
);

279 #ñi‡
	`deföed
(
USE_GNUTLS_NETTLE
)

280 
des_˘x
 
des
;

281 
	`£tup_des_key
(
keys
, &
des
);

282 
	`des_í¸y±
(&
des
, 8, 
ªsu…s
, 
∂aöãxt
);

283 
	`£tup_des_key
(
keys
 + 7, &
des
);

284 
	`des_í¸y±
(&
des
, 8, 
ªsu…s
 + 8, 
∂aöãxt
);

285 
	`£tup_des_key
(
keys
 + 14, &
des
);

286 
	`des_í¸y±
(&
des
, 8, 
ªsu…s
 + 16, 
∂aöãxt
);

287 #ñi‡
	`deföed
(
USE_GNUTLS
)

288 
g¸y_cùhî_hd_t
 
des
;

290 
	`g¸y_cùhî_›í
(&
des
, 
GCRY_CIPHER_DES
, 
GCRY_CIPHER_MODE_ECB
, 0);

291 
	`£tup_des_key
(
keys
, &
des
);

292 
	`g¸y_cùhî_í¸y±
(
des
, 
ªsu…s
, 8, 
∂aöãxt
, 8);

293 
	`g¸y_cùhî_˛o£
(
des
);

295 
	`g¸y_cùhî_›í
(&
des
, 
GCRY_CIPHER_DES
, 
GCRY_CIPHER_MODE_ECB
, 0);

296 
	`£tup_des_key
(
keys
 + 7, &
des
);

297 
	`g¸y_cùhî_í¸y±
(
des
, 
ªsu…s
 + 8, 8, 
∂aöãxt
, 8);

298 
	`g¸y_cùhî_˛o£
(
des
);

300 
	`g¸y_cùhî_›í
(&
des
, 
GCRY_CIPHER_DES
, 
GCRY_CIPHER_MODE_ECB
, 0);

301 
	`£tup_des_key
(
keys
 + 14, &
des
);

302 
	`g¸y_cùhî_í¸y±
(
des
, 
ªsu…s
 + 16, 8, 
∂aöãxt
, 8);

303 
	`g¸y_cùhî_˛o£
(
des
);

304 #ñi‡
	`deföed
(
USE_NSS
Ë|| deföed(
USE_DARWINSSL
)

305 
	`í¸y±_des
(
∂aöãxt
, 
ªsu…s
, 
keys
);

306 
	`í¸y±_des
(
∂aöãxt
, 
ªsu…s
 + 8, 
keys
 + 7);

307 
	`í¸y±_des
(
∂aöãxt
, 
ªsu…s
 + 16, 
keys
 + 14);

309 
	}
}

314 
	$Cuæ_¡lm_c‹e_mk_lm_hash
(
Sessi⁄H™dÀ
 *
d©a
,

315 c⁄° *
∑ssw‹d
,

316 *
lmbuf„r
 )

318 
CURLcode
 
ªs
;

319 
pw
[14];

320 c⁄° 
magic
[] = {

323 
size_t
 
Àn
 = 
	`CURLMIN
(
	`°æí
(
∑ssw‹d
), 14);

325 
	`Cuæ_°∫touµî
((*)
pw
, 
∑ssw‹d
, 
Àn
);

326 
	`mem£t
(&
pw
[
Àn
], 0, 14 -Üen);

332 
ªs
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
d©a
, (*)
pw
, 14);

333 if(
ªs
)

339 #ifde‡
USE_SSLEAY


340 
DES_key_scheduÀ
 
ks
;

342 
	`£tup_des_key
(
pw
, 
	`DESKEY
(
ks
));

343 
	`DES_ecb_í¸y±
((
DES_cblock
 *)
magic
, (DES_cblock *)
lmbuf„r
,

344 
	`DESKEY
(
ks
), 
DES_ENCRYPT
);

346 
	`£tup_des_key
(
pw
 + 7, 
	`DESKEY
(
ks
));

347 
	`DES_ecb_í¸y±
((
DES_cblock
 *)
magic
, (DES_cblock *)(
lmbuf„r
 + 8),

348 
	`DESKEY
(
ks
), 
DES_ENCRYPT
);

349 #ñi‡
	`deföed
(
USE_GNUTLS_NETTLE
)

350 
des_˘x
 
des
;

351 
	`£tup_des_key
(
pw
, &
des
);

352 
	`des_í¸y±
(&
des
, 8, 
lmbuf„r
, 
magic
);

353 
	`£tup_des_key
(
pw
 + 7, &
des
);

354 
	`des_í¸y±
(&
des
, 8, 
lmbuf„r
 + 8, 
magic
);

355 #ñi‡
	`deföed
(
USE_GNUTLS
)

356 
g¸y_cùhî_hd_t
 
des
;

358 
	`g¸y_cùhî_›í
(&
des
, 
GCRY_CIPHER_DES
, 
GCRY_CIPHER_MODE_ECB
, 0);

359 
	`£tup_des_key
(
pw
, &
des
);

360 
	`g¸y_cùhî_í¸y±
(
des
, 
lmbuf„r
, 8, 
magic
, 8);

361 
	`g¸y_cùhî_˛o£
(
des
);

363 
	`g¸y_cùhî_›í
(&
des
, 
GCRY_CIPHER_DES
, 
GCRY_CIPHER_MODE_ECB
, 0);

364 
	`£tup_des_key
(
pw
 + 7, &
des
);

365 
	`g¸y_cùhî_í¸y±
(
des
, 
lmbuf„r
 + 8, 8, 
magic
, 8);

366 
	`g¸y_cùhî_˛o£
(
des
);

367 #ñi‡
	`deföed
(
USE_NSS
Ë|| deföed(
USE_DARWINSSL
)

368 
	`í¸y±_des
(
magic
, 
lmbuf„r
, 
pw
);

369 
	`í¸y±_des
(
magic
, 
lmbuf„r
 + 8, 
pw
 + 7);

372 
	`mem£t
(
lmbuf„r
 + 16, 0, 21 - 16);

374 
	}
}

376 #i‡
USE_NTRESPONSES


377 
	$ascii_to_unicode_À
(*
de°
, c⁄° *
§c
,

378 
size_t
 
§˛í
)

380 
size_t
 
i
;

381 
i
 = 0; i < 
§˛í
; i++) {

382 
de°
[2 * 
i
] = ()
§c
[i];

383 
de°
[2 * 
i
 + 1] = '\0';

385 
	}
}

387 
	$ascii_uµîˇ£_to_unicode_À
(*
de°
,

388 c⁄° *
§c
, 
size_t
 
§˛í
)

390 
size_t
 
i
;

391 
i
 = 0; i < 
§˛í
; i++) {

392 
de°
[2 * 
i
] = ()(
	`touµî
(
§c
[i]));

393 
de°
[2 * 
i
 + 1] = '\0';

395 
	}
}

397 
	$wrôe32_À
(c⁄° 
vÆue
, *
buf„r
)

399 
buf„r
[0] = ()(
vÆue
 & 0x000000FF);

400 
buf„r
[1] = ()((
vÆue
 & 0x0000FF00) >> 8);

401 
buf„r
[2] = ()((
vÆue
 & 0x00FF0000) >> 16);

402 
buf„r
[3] = ()((
vÆue
 & 0xFF000000) >> 24);

403 
	}
}

405 #i‡
deföed
(
HAVE_LONGLONG
)

406 
	$wrôe64_À
(c⁄° 
vÆue
, *
buf„r
)

408 
	$wrôe64_À
(c⁄° 
__öt64
 
vÆue
, *
buf„r
)

411 
	`wrôe32_À
(()
vÆue
, 
buf„r
);

412 
	`wrôe32_À
(()(
vÆue
 >> 32), 
buf„r
 + 4);

413 
	}
}

418 
CURLcode
 
	$Cuæ_¡lm_c‹e_mk_¡_hash
(
Sessi⁄H™dÀ
 *
d©a
,

419 c⁄° *
∑ssw‹d
,

420 *
¡buf„r
 )

422 
size_t
 
Àn
 = 
	`°æí
(
∑ssw‹d
);

423 *
pw
 = 
	`mÆloc
(
Àn
 * 2);

424 
CURLcode
 
ªsu…
;

425 if(!
pw
)

426  
CURLE_OUT_OF_MEMORY
;

428 
	`ascii_to_unicode_À
(
pw
, 
∑ssw‹d
, 
Àn
);

434 
ªsu…
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
d©a
, (*)
pw
, 
Àn
 * 2);

435 if(
ªsu…
)

436  
ªsu…
;

440 #ifde‡
USE_SSLEAY


441 
MD4_CTX
 
MD4pw
;

442 
	`MD4_Inô
(&
MD4pw
);

443 
	`MD4_Upd©e
(&
MD4pw
, 
pw
, 2 * 
Àn
);

444 
	`MD4_FöÆ
(
¡buf„r
, &
MD4pw
);

445 #ñi‡
	`deföed
(
USE_GNUTLS_NETTLE
)

446 
md4_˘x
 
MD4pw
;

447 
	`md4_öô
(&
MD4pw
);

448 
	`md4_upd©e
(&
MD4pw
, ()(2 * 
Àn
), 
pw
);

449 
	`md4_dige°
(&
MD4pw
, 
MD4_DIGEST_SIZE
, 
¡buf„r
);

450 #ñi‡
	`deföed
(
USE_GNUTLS
)

451 
g¸y_md_hd_t
 
MD4pw
;

452 
	`g¸y_md_›í
(&
MD4pw
, 
GCRY_MD_MD4
, 0);

453 
	`g¸y_md_wrôe
(
MD4pw
, 
pw
, 2 * 
Àn
);

454 
	`mem˝y
 (
¡buf„r
, 
	`g¸y_md_ªad
 (
MD4pw
, 0), 
MD4_DIGEST_LENGTH
);

455 
	`g¸y_md_˛o£
(
MD4pw
);

456 #ñi‡
	`deföed
(
USE_NSS
)

457 
	`Cuæ_md4ô
(
¡buf„r
, 
pw
, 2 * 
Àn
);

458 #ñi‡
	`deföed
(
USE_DARWINSSL
)

459 ()
	`CC_MD4
(
pw
, (
CC_LONG
)(2 * 
Àn
), 
¡buf„r
);

462 
	`mem£t
(
¡buf„r
 + 16, 0, 21 - 16);

465 
	`‰ì
(
pw
);

467  
CURLE_OK
;

468 
	}
}

471 
CURLcode
 
	$Cuæ_hmac_md5
(c⁄° *
key
, 
keyÀn
,

472 c⁄° *
d©a
, 
d©Æí
,

473 *
ouçut
)

475 
HMAC_c⁄ãxt
 *
˘xt
 = 
	`Cuæ_HMAC_öô
(
Cuæ_HMAC_MD5
, 
key
, 
keyÀn
);

477 if(!
˘xt
)

478  
CURLE_OUT_OF_MEMORY
;

481 
	`Cuæ_HMAC_upd©e
(
˘xt
, 
d©a
, 
d©Æí
);

484 
	`Cuæ_HMAC_föÆ
(
˘xt
, 
ouçut
);

486  
CURLE_OK
;

487 
	}
}

492 
CURLcode
 
	$Cuæ_¡lm_c‹e_mk_¡lmv2_hash
(c⁄° *
u£r
, 
size_t
 
u£æí
,

493 c⁄° *
domaö
, 
size_t
 
domÀn
,

494 *
¡lmhash
,

495 *
¡lmv2hash
)

498 
size_t
 
idítôy_Àn
 = (
u£æí
 + 
domÀn
) * 2;

499 *
idítôy
 = 
	`mÆloc
(
idítôy_Àn
);

500 
CURLcode
 
ªs
 = 
CURLE_OK
;

502 if(!
idítôy
)

503  
CURLE_OUT_OF_MEMORY
;

505 
	`ascii_uµîˇ£_to_unicode_À
(
idítôy
, 
u£r
, 
u£æí
);

506 
	`ascii_to_unicode_À
(
idítôy
 + (
u£æí
 << 1), 
domaö
, 
domÀn
);

508 
ªs
 = 
	`Cuæ_hmac_md5
(
¡lmhash
, 16, 
idítôy
, 
	`cuæx_uztoui
(
idítôy_Àn
),

509 
¡lmv2hash
);

511 
	`Cuæ_ß„‰ì
(
idítôy
);

513  
ªs
;

514 
	}
}

533 
CURLcode
 
	$Cuæ_¡lm_c‹e_mk_¡lmv2_ª•
(*
¡lmv2hash
,

534 *
chÆÀnge_˛õ¡
,

535 
¡lmd©a
 *
¡lm
,

536 **
¡ª•
,

537 *
¡ª•_Àn
)

554 
Àn
 = 0;

555 *
±r
 = 
NULL
;

556 
hmac_ouçut
[
NTLM_HMAC_MD5_LEN
];

557 #i‡
	`deföed
(
HAVE_LONGLONG
)

558 
tw
;

560 
__öt64
 
tw
;

562 
CURLcode
 
ªs
 = 
CURLE_OK
;

565 #ifde‡
DEBUGBUILD


566 *
f‹˚_time°amp
 = 
	`gëív
("CURL_FORCETIME");

567 if(
f‹˚_time°amp
)

568 
tw
 = 11644473600ULL * 10000000ULL;

571 
tw
 = (()
	`time
(
NULL
) + 11644473600ULL) * 10000000ULL;

574 
Àn
 = 
NTLM_HMAC_MD5_LEN
 + 
NTLMv2_BLOB_LEN
;

577 
±r
 = 
	`mÆloc
(
Àn
);

578 if(!
±r
)

579  
CURLE_OUT_OF_MEMORY
;

581 
	`mem£t
(
±r
, 0, 
Àn
);

584 
	`¢¥ötf
((*)
±r
 + 
NTLM_HMAC_MD5_LEN
, 
NTLMv2_BLOB_LEN
,

585 
NTLMv2_BLOB_SIGNATURE


589 
	`wrôe64_À
(
tw
, 
±r
 + 24);

590 
	`mem˝y
(
±r
 + 32, 
chÆÀnge_˛õ¡
, 8);

591 
	`mem˝y
(
±r
 + 44, 
¡lm
->
èrgë_öfo
,Çém->
èrgë_öfo_Àn
);

594 
	`mem˝y
(
±r
 + 8, &
¡lm
->
n⁄˚
[0], 8);

595 
ªs
 = 
	`Cuæ_hmac_md5
(
¡lmv2hash
, 
NTLM_HMAC_MD5_LEN
, 
±r
 + 8,

596 
NTLMv2_BLOB_LEN
 + 8, 
hmac_ouçut
);

597 if(
ªs
) {

598 
	`Cuæ_ß„‰ì
(
±r
);

599  
ªs
;

603 
	`mem˝y
(
±r
, 
hmac_ouçut
, 
NTLM_HMAC_MD5_LEN
);

606 *
¡ª•
 = 
±r
;

607 *
¡ª•_Àn
 = 
Àn
;

609  
ªs
;

610 
	}
}

626 
CURLcode
 
	$Cuæ_¡lm_c‹e_mk_lmv2_ª•
(*
¡lmv2hash
,

627 *
chÆÀnge_˛õ¡
,

628 *
chÆÀnge_£rvî
,

629 *
lmª•
)

631 
d©a
[16];

632 
hmac_ouçut
[16];

633 
CURLcode
 
ªs
 = 
CURLE_OK
;

635 
	`mem˝y
(&
d©a
[0], 
chÆÀnge_£rvî
, 8);

636 
	`mem˝y
(&
d©a
[8], 
chÆÀnge_˛õ¡
, 8);

638 
ªs
 = 
	`Cuæ_hmac_md5
(
¡lmv2hash
, 16, &
d©a
[0], 16, 
hmac_ouçut
);

639 if(
ªs
)

640  
ªs
;

643 
	`mem˝y
(
lmª•
, 
hmac_ouçut
, 16);

644 
	`mem˝y
(
lmª•
+16, 
chÆÀnge_˛õ¡
, 8);

646  
ªs
;

647 
	}
}

	@lib/curl_ntlm_core.h

1 #i‚de‡
HEADER_CURL_NTLM_CORE_H


2 
	#HEADER_CURL_NTLM_CORE_H


	)

25 
	~"cuæ_£tup.h
"

27 #i‡
deföed
(
USE_NTLM
Ë&& !deföed(
USE_WINDOWS_SSPI
)

29 #ifde‡
USE_SSLEAY


30 #i‡!
deföed
(
OPENSSL_VERSION_NUMBER
) && \

31 !
deföed
(
HEADER_SSL_H
Ë&& !
	$deföed
(
HEADER_MD5_H
)

34 #ifde‡
OPENSSL_NO_MD4


35 
	#USE_NTRESPONSES
 0

	)

36 
	#USE_NTLM2SESSION
 0

	)

47 #i‚de‡
USE_NTRESPONSES


48 
	#USE_NTRESPONSES
 1

	)

49 
	#USE_NTLM2SESSION
 1

	)

52 
	`Cuæ_¡lm_c‹e_lm_ª•
(c⁄° *
keys
,

53 c⁄° *
∂aöãxt
,

54 *
ªsu…s
);

56 
	`Cuæ_¡lm_c‹e_mk_lm_hash
(
Sessi⁄H™dÀ
 *
d©a
,

57 c⁄° *
∑ssw‹d
,

58 *
lmbuf„r
 );

60 #i‡
USE_NTRESPONSES


61 
CURLcode
 
	`Cuæ_hmac_md5
(c⁄° *
key
, 
keyÀn
,

62 c⁄° *
d©a
, 
d©Æí
,

63 *
ouçut
);

65 
CURLcode
 
	`Cuæ_¡lm_c‹e_mk_¡_hash
(
Sessi⁄H™dÀ
 *
d©a
,

66 c⁄° *
∑ssw‹d
,

67 *
¡buf„r
 );

69 
CURLcode
 
	`Cuæ_¡lm_c‹e_mk_¡lmv2_hash
(c⁄° *
u£r
, 
size_t
 
u£æí
,

70 c⁄° *
domaö
, 
size_t
 
domÀn
,

71 *
¡lmhash
,

72 *
¡lmv2hash
);

74 
CURLcode
 
	`Cuæ_¡lm_c‹e_mk_¡lmv2_ª•
(*
¡lmv2hash
,

75 *
chÆÀnge_˛õ¡
,

76 
¡lmd©a
 *
¡lm
,

77 **
¡ª•
,

78 *
¡ª•_Àn
);

80 
CURLcode
 
	`Cuæ_¡lm_c‹e_mk_lmv2_ª•
(*
¡lmv2hash
,

81 *
chÆÀnge_˛õ¡
,

82 *
chÆÀnge_£rvî
,

83 *
lmª•
);

	@lib/curl_ntlm_msgs.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
USE_NTLM


34 
	#DEBUG_ME
 0

	)

36 
	~"uæd©a.h
"

37 
	~"n⁄-ascii.h
"

38 
	~"£ndf.h
"

39 
	~"cuæ_ba£64.h
"

40 
	~"cuæ_¡lm_c‹e.h
"

41 
	~"cuæ_gëho°«me.h
"

42 
	~"cuæ_mu…ibyã.h
"

43 
	~"w¨∆ess.h
"

44 
	~"cuæ_mem‹y.h
"

46 #ifde‡
USE_WINDOWS_SSPI


47 
	~"cuæ_s•i.h
"

50 
	~"vés/vés.h
"

52 
	#BUILDING_CURL_NTLM_MSGS_C


	)

53 
	~"cuæ_¡lm_msgs.h
"

55 
	#_MPRINTF_REPLACE


	)

56 
	~<cuæ/m¥ötf.h
>

59 
	~"memdebug.h
"

62 
	#NTLMSSP_SIGNATURE
 "\x4e\x54\x4c\x4d\x53\x53\x50"

	)

64 
	#SHORTPAIR
(
x
Ë((xË& 0xff), (((xË>> 8Ë& 0xff)

	)

65 
	#LONGQUARTET
(
x
) ((x) & 0xff), (((x) >> 8) & 0xff), \

66 (((
x
Ë>> 16Ë& 0xff), (((xË>> 24Ë& 0xff)

	)

68 #i‡
DEBUG_ME


69 
	#DEBUG_OUT
(
x
Ë
	)
x

70 
	$¡lm_¥öt_Êags
(
FILE
 *
h™dÀ
, 
Êags
)

72 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_UNICODE
)

73 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_UNICODE ");

74 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_OEM
)

75 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_OEM ");

76 if(
Êags
 & 
NTLMFLAG_REQUEST_TARGET
)

77 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_REQUEST_TARGET ");

78 if(
Êags
 & (1<<3))

79 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_UNKNOWN_3 ");

80 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_SIGN
)

81 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_SIGN ");

82 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_SEAL
)

83 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_SEAL ");

84 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_DATAGRAM_STYLE
)

85 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_DATAGRAM_STYLE ");

86 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_LM_KEY
)

87 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_LM_KEY ");

88 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_NETWARE
)

89 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_NETWARE ");

90 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_NTLM_KEY
)

91 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_NTLM_KEY ");

92 if(
Êags
 & (1<<10))

93 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_UNKNOWN_10 ");

94 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_ANONYMOUS
)

95 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_ANONYMOUS ");

96 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_DOMAIN_SUPPLIED
)

97 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_DOMAIN_SUPPLIED ");

98 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_WORKSTATION_SUPPLIED
)

99 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_WORKSTATION_SUPPLIED ");

100 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_LOCAL_CALL
)

101 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_LOCAL_CALL ");

102 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_ALWAYS_SIGN
)

103 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_ALWAYS_SIGN ");

104 if(
Êags
 & 
NTLMFLAG_TARGET_TYPE_DOMAIN
)

105 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_TARGET_TYPE_DOMAIN ");

106 if(
Êags
 & 
NTLMFLAG_TARGET_TYPE_SERVER
)

107 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_TARGET_TYPE_SERVER ");

108 if(
Êags
 & 
NTLMFLAG_TARGET_TYPE_SHARE
)

109 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_TARGET_TYPE_SHARE ");

110 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_NTLM2_KEY
)

111 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_NTLM2_KEY ");

112 if(
Êags
 & 
NTLMFLAG_REQUEST_INIT_RESPONSE
)

113 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_REQUEST_INIT_RESPONSE ");

114 if(
Êags
 & 
NTLMFLAG_REQUEST_ACCEPT_RESPONSE
)

115 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_REQUEST_ACCEPT_RESPONSE ");

116 if(
Êags
 & 
NTLMFLAG_REQUEST_NONNT_SESSION_KEY
)

117 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_REQUEST_NONNT_SESSION_KEY ");

118 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_TARGET_INFO
)

119 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_TARGET_INFO ");

120 if(
Êags
 & (1<<24))

121 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_UNKNOWN_24 ");

122 if(
Êags
 & (1<<25))

123 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_UNKNOWN_25 ");

124 if(
Êags
 & (1<<26))

125 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_UNKNOWN_26 ");

126 if(
Êags
 & (1<<27))

127 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_UNKNOWN_27 ");

128 if(
Êags
 & (1<<28))

129 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_UNKNOWN_28 ");

130 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_128
)

131 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_128 ");

132 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_KEY_EXCHANGE
)

133 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_KEY_EXCHANGE ");

134 if(
Êags
 & 
NTLMFLAG_NEGOTIATE_56
)

135 
	`Ârötf
(
h™dÀ
, "NTLMFLAG_NEGOTIATE_56 ");

136 
	}
}

138 
	$¡lm_¥öt_hex
(
FILE
 *
h™dÀ
, c⁄° *
buf
, 
size_t
 
Àn
)

140 c⁄° *
p
 = 
buf
;

141 ()
h™dÀ
;

142 
	`Ârötf
(
°dîr
, "0x");

143 
Àn
-- > 0)

144 
	`Ârötf
(
°dîr
, "%02.2x", ()*
p
++);

145 
	}
}

147 
	#DEBUG_OUT
(
x
Ë
Cuæ_n›_°mt


	)

150 #i‚de‡
USE_WINDOWS_SSPI


156 
	$ªadöt_À
(*
buf
)

158  (()
buf
[0]) | (()buf[1] << 8) |

159 (()
buf
[2] << 16) | (()buf[3] << 24);

160 
	}
}

167 
	$ªadsh‹t_À
(*
buf
)

169  (()
buf
[0]) | (()buf[1] << 8);

170 
	}
}

187 
CURLcode
 
	$Cuæ_¡lm_decode_ty≥2_èrgë
(
Sessi⁄H™dÀ
 *
d©a
,

188 *
buf„r
,

189 
size_t
 
size
,

190 
¡lmd©a
 *
¡lm
)

192 
èrgë_öfo_Àn
 = 0;

193 
èrgë_öfo_off£t
 = 0;

195 
	`Cuæ_ß„‰ì
(
¡lm
->
èrgë_öfo
);

196 
¡lm
->
èrgë_öfo_Àn
 = 0;

198 if(
size
 >= 48) {

199 
èrgë_öfo_Àn
 = 
	`ªadsh‹t_À
(&
buf„r
[40]);

200 
èrgë_öfo_off£t
 = 
	`ªadöt_À
(&
buf„r
[44]);

201 if(
èrgë_öfo_Àn
 > 0) {

202 if(((
èrgë_öfo_off£t
 + 
èrgë_öfo_Àn
Ë> 
size
) ||

203 (
èrgë_öfo_off£t
 < 48)) {

204 
	`öfof
(
d©a
, "NTLM handshake failure (badÅype-2 message). "

206  
CURLE_REMOTE_ACCESS_DENIED
;

209 
¡lm
->
èrgë_öfo
 = 
	`mÆloc
(
èrgë_öfo_Àn
);

210 if(!
¡lm
->
èrgë_öfo
)

211  
CURLE_OUT_OF_MEMORY
;

213 
	`mem˝y
(
¡lm
->
èrgë_öfo
, &
buf„r
[
èrgë_öfo_off£t
], 
èrgë_öfo_Àn
);

214 
¡lm
->
èrgë_öfo_Àn
 =Åarget_info_len;

220  
CURLE_OK
;

221 
	}
}

258 
CURLcode
 
	$Cuæ_¡lm_decode_ty≥2_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

259 c⁄° *
hódî
,

260 
¡lmd©a
 *
¡lm
)

262 #i‚de‡
USE_WINDOWS_SSPI


263 c⁄° 
ty≥2_m¨kî
[] = { 0x02, 0x00, 0x00, 0x00 };

282 
size_t
 
size
 = 0;

283 *
buf„r
 = 
NULL
;

284 
CURLcode
 
îr‹
;

286 #i‡
	`deföed
(
CURL_DISABLE_VERBOSE_STRINGS
Ë|| deföed(
USE_WINDOWS_SSPI
)

287 ()
d©a
;

290 
îr‹
 = 
	`Cuæ_ba£64_decode
(
hódî
, &
buf„r
, &
size
);

291 if(
îr‹
)

292  
îr‹
;

294 if(!
buf„r
) {

295 
	`öfof
(
d©a
, "NTLM handshake failure (unhandled condition)\n");

296  
CURLE_REMOTE_ACCESS_DENIED
;

299 #ifde‡
USE_WINDOWS_SSPI


300 
¡lm
->
ty≥_2
 = 
	`mÆloc
(
size
 + 1);

301 if(
¡lm
->
ty≥_2
 =
NULL
) {

302 
	`‰ì
(
buf„r
);

303  
CURLE_OUT_OF_MEMORY
;

305 
¡lm
->
n_ty≥_2
 = 
	`cuæx_uztoul
(
size
);

306 
	`mem˝y
(
¡lm
->
ty≥_2
, 
buf„r
, 
size
);

308 
¡lm
->
Êags
 = 0;

310 if((
size
 < 32) ||

311 (
	`memcmp
(
buf„r
, 
NTLMSSP_SIGNATURE
, 8) != 0) ||

312 (
	`memcmp
(
buf„r
 + 8, 
ty≥2_m¨kî
, (type2_marker)) != 0)) {

314 
	`‰ì
(
buf„r
);

315 
	`öfof
(
d©a
, "NTLM handshake failure (badÅype-2 message)\n");

316  
CURLE_REMOTE_ACCESS_DENIED
;

319 
¡lm
->
Êags
 = 
	`ªadöt_À
(&
buf„r
[20]);

320 
	`mem˝y
(
¡lm
->
n⁄˚
, &
buf„r
[24], 8);

322 if(
¡lm
->
Êags
 & 
NTLMFLAG_NEGOTIATE_TARGET_INFO
) {

323 
îr‹
 = 
	`Cuæ_¡lm_decode_ty≥2_èrgë
(
d©a
, 
buf„r
, 
size
, 
¡lm
);

324 if(
îr‹
) {

325 
	`‰ì
(
buf„r
);

326 
	`öfof
(
d©a
, "NTLM handshake failure (badÅype-2 message)\n");

327  
îr‹
;

331 
	`DEBUG_OUT
({

332 
	`Ârötf
(
°dîr
, "**** TYPE2 hódî fœgs=0x%08.8lx ", 
¡lm
->
Êags
);

333 
	`¡lm_¥öt_Êags
(
°dîr
, 
¡lm
->
Êags
);

334 
	`Ârötf
(
°dîr
, "\nÇonce=");

335 
	`¡lm_¥öt_hex
(
°dîr
, (*)
¡lm
->
n⁄˚
, 8);

336 
	`Ârötf
(
°dîr
, "\n****\n");

337 
	`Ârötf
(
°dîr
, "**** Hódî %s\¿", 
hódî
);

340 
	`‰ì
(
buf„r
);

342  
CURLE_OK
;

343 
	}
}

345 #ifde‡
USE_WINDOWS_SSPI


346 
	$Cuæ_¡lm_s•i_˛ónup
(
¡lmd©a
 *
¡lm
)

348 
	`Cuæ_ß„‰ì
(
¡lm
->
ty≥_2
);

350 if(
¡lm
->
has_h™dÀs
) {

351 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
¡lm
->
c_h™dÀ
);

352 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¡lm
->
h™dÀ
);

353 
¡lm
->
has_h™dÀs
 = 0;

356 
	`Cuæ_s•i_‰ì_idítôy
(
¡lm
->
p_idítôy
);

357 
¡lm
->
p_idítôy
 = 
NULL
;

358 
	}
}

361 #i‚de‡
USE_WINDOWS_SSPI


364 
	$unicode˝y
(*
de°
, c⁄° *
§c
, 
size_t
 
Àngth
)

366 
size_t
 
i
;

367 
i
 = 0; i < 
Àngth
; i++) {

368 
de°
[2 * 
i
] = ()
§c
[i];

369 
de°
[2 * 
i
 + 1] = '\0';

371 
	}
}

392 
CURLcode
 
	$Cuæ_¡lm_¸óã_ty≥1_mesßge
(c⁄° *
u£Ω
,

393 c⁄° *
∑sswdp
,

394 
¡lmd©a
 *
¡lm
,

395 **
ouçå
,

396 
size_t
 *
ouéí
)

412 
¡lmbuf
[
NTLM_BUFSIZE
];

413 
size_t
 
size
;

415 #ifde‡
USE_WINDOWS_SSPI


417 
SecBuf„r
 
ty≥_1_buf
;

418 
SecBuf„rDesc
 
ty≥_1_desc
;

419 
SECURITY_STATUS
 
°©us
;

420 
©ås
;

421 
TimeSèmp
 
tsDummy
;

423 
	`Cuæ_¡lm_s•i_˛ónup
(
¡lm
);

425 if(
u£Ω
 && *userp) {

426 
CURLcode
 
ªsu…
;

429 
ªsu…
 = 
	`Cuæ_¸óã_s•i_idítôy
(
u£Ω
, 
∑sswdp
, &
¡lm
->
idítôy
);

430 if(
ªsu…
)

431  
ªsu…
;

434 
¡lm
->
p_idítôy
 = &¡lm->
idítôy
;

438 
¡lm
->
p_idítôy
 = 
NULL
;

441 
°©us
 = 
s_pSecFn
->
	`AcquúeCªdítülsH™dÀ
(
NULL
,

442 (
TCHAR
 *Ë
	`TEXT
("NTLM"),

443 
SECPKG_CRED_OUTBOUND
, 
NULL
,

444 
¡lm
->
p_idítôy
, 
NULL
, NULL,

445 &
¡lm
->
h™dÀ
, &
tsDummy
);

446 if(
°©us
 !
SEC_E_OK
)

447  
CURLE_OUT_OF_MEMORY
;

450 
ty≥_1_desc
.
ulVîsi⁄
 = 
SECBUFFER_VERSION
;

451 
ty≥_1_desc
.
cBuf„rs
 = 1;

452 
ty≥_1_desc
.
pBuf„rs
 = &
ty≥_1_buf
;

453 
ty≥_1_buf
.
cbBuf„r
 = 
NTLM_BUFSIZE
;

454 
ty≥_1_buf
.
Buf„rTy≥
 = 
SECBUFFER_TOKEN
;

455 
ty≥_1_buf
.
pvBuf„r
 = 
¡lmbuf
;

458 
°©us
 = 
s_pSecFn
->
	`InôülizeSecurôyC⁄ãxt
(&
¡lm
->
h™dÀ
, 
NULL
,

459 (
TCHAR
 *Ë
	`TEXT
(""),

460 
ISC_REQ_CONFIDENTIALITY
 |

461 
ISC_REQ_REPLAY_DETECT
 |

462 
ISC_REQ_CONNECTION
,

463 0, 
SECURITY_NETWORK_DREP
,

464 
NULL
, 0,

465 &
¡lm
->
c_h™dÀ
, &
ty≥_1_desc
,

466 &
©ås
, &
tsDummy
);

468 if(
°©us
 =
SEC_I_COMPLETE_AND_CONTINUE
 ||

469 
°©us
 =
SEC_I_CONTINUE_NEEDED
)

470 
s_pSecFn
->
	`Com∂ëeAuthTokí
(&
¡lm
->
c_h™dÀ
, &
ty≥_1_desc
);

471 if(
°©us
 !
SEC_E_OK
) {

472 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¡lm
->
h™dÀ
);

473  
CURLE_RECV_ERROR
;

476 
¡lm
->
has_h™dÀs
 = 1;

477 
size
 = 
ty≥_1_buf
.
cbBuf„r
;

481 c⁄° *
ho°
 = "";

482 c⁄° *
domaö
 = "";

483 
size_t
 
ho°Àn
 = 0;

484 
size_t
 
domÀn
 = 0;

485 
size_t
 
ho°off
 = 0;

486 
size_t
 
domoff
 = 
ho°off
 + 
ho°Àn
;

488 ()
u£Ω
;

489 ()
∑sswdp
;

490 ()
¡lm
;

492 #i‡
USE_NTLM2SESSION


493 
	#NTLM2FLAG
 
NTLMFLAG_NEGOTIATE_NTLM2_KEY


	)

495 
	#NTLM2FLAG
 0

	)

497 
	`¢¥ötf
((*)
¡lmbuf
, 
NTLM_BUFSIZE
,

498 
NTLMSSP_SIGNATURE
 "%c"

514 
	`LONGQUARTET
(
NTLMFLAG_NEGOTIATE_OEM
 |

515 
NTLMFLAG_REQUEST_TARGET
 |

516 
NTLMFLAG_NEGOTIATE_NTLM_KEY
 |

517 
NTLM2FLAG
 |

518 
NTLMFLAG_NEGOTIATE_ALWAYS_SIGN
),

519 
	`SHORTPAIR
(
domÀn
),

520 
	`SHORTPAIR
(
domÀn
),

521 
	`SHORTPAIR
(
domoff
),

523 
	`SHORTPAIR
(
ho°Àn
),

524 
	`SHORTPAIR
(
ho°Àn
),

525 
	`SHORTPAIR
(
ho°off
),

527 
ho°
,

528 
domaö
 );

531 
size
 = 32 + 
ho°Àn
 + 
domÀn
;

535 
	`DEBUG_OUT
({

536 
	`Ârötf
(
°dîr
, "* TYPE1 header flags=0x%02.2x%02.2x%02.2x%02.2x "

538 
	`LONGQUARTET
(
NTLMFLAG_NEGOTIATE_OEM
 |

539 
NTLMFLAG_REQUEST_TARGET
 |

540 
NTLMFLAG_NEGOTIATE_NTLM_KEY
 |

541 
NTLM2FLAG
 |

542 
NTLMFLAG_NEGOTIATE_ALWAYS_SIGN
),

543 
NTLMFLAG_NEGOTIATE_OEM
 |

544 
NTLMFLAG_REQUEST_TARGET
 |

545 
NTLMFLAG_NEGOTIATE_NTLM_KEY
 |

546 
NTLM2FLAG
 |

547 
NTLMFLAG_NEGOTIATE_ALWAYS_SIGN
);

548 
	`¡lm_¥öt_Êags
(
°dîr
,

549 
NTLMFLAG_NEGOTIATE_OEM
 |

550 
NTLMFLAG_REQUEST_TARGET
 |

551 
NTLMFLAG_NEGOTIATE_NTLM_KEY
 |

552 
NTLM2FLAG
 |

553 
NTLMFLAG_NEGOTIATE_ALWAYS_SIGN
);

554 
	`Ârötf
(
°dîr
, "\n****\n");

558  
	`Cuæ_ba£64_ícode
(
NULL
, (*)
¡lmbuf
, 
size
, 
ouçå
, 
ouéí
);

559 
	}
}

580 
CURLcode
 
	$Cuæ_¡lm_¸óã_ty≥3_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

581 c⁄° *
u£Ω
,

582 c⁄° *
∑sswdp
,

583 
¡lmd©a
 *
¡lm
,

584 **
ouçå
,

585 
size_t
 *
ouéí
)

605 
¡lmbuf
[
NTLM_BUFSIZE
];

606 
size_t
 
size
;

608 #ifde‡
USE_WINDOWS_SSPI


609 
SecBuf„r
 
ty≥_2_buf
;

610 
SecBuf„r
 
ty≥_3_buf
;

611 
SecBuf„rDesc
 
ty≥_2_desc
;

612 
SecBuf„rDesc
 
ty≥_3_desc
;

613 
SECURITY_STATUS
 
°©us
;

614 
©ås
;

615 
TimeSèmp
 
tsDummy
;

617 ()
∑sswdp
;

618 ()
u£Ω
;

619 ()
d©a
;

622 
ty≥_2_desc
.
ulVîsi⁄
 = 
SECBUFFER_VERSION
;

623 
ty≥_2_desc
.
cBuf„rs
 = 1;

624 
ty≥_2_desc
.
pBuf„rs
 = &
ty≥_2_buf
;

625 
ty≥_2_buf
.
Buf„rTy≥
 = 
SECBUFFER_TOKEN
;

626 
ty≥_2_buf
.
pvBuf„r
 = 
¡lm
->
ty≥_2
;

627 
ty≥_2_buf
.
cbBuf„r
 = 
¡lm
->
n_ty≥_2
;

630 
ty≥_3_desc
.
ulVîsi⁄
 = 
SECBUFFER_VERSION
;

631 
ty≥_3_desc
.
cBuf„rs
 = 1;

632 
ty≥_3_desc
.
pBuf„rs
 = &
ty≥_3_buf
;

633 
ty≥_3_buf
.
Buf„rTy≥
 = 
SECBUFFER_TOKEN
;

634 
ty≥_3_buf
.
pvBuf„r
 = 
¡lmbuf
;

635 
ty≥_3_buf
.
cbBuf„r
 = 
NTLM_BUFSIZE
;

638 
°©us
 = 
s_pSecFn
->
	`InôülizeSecurôyC⁄ãxt
(&
¡lm
->
h™dÀ
,

639 &
¡lm
->
c_h™dÀ
,

640 (
TCHAR
 *Ë
	`TEXT
(""),

641 
ISC_REQ_CONFIDENTIALITY
 |

642 
ISC_REQ_REPLAY_DETECT
 |

643 
ISC_REQ_CONNECTION
,

644 0, 
SECURITY_NETWORK_DREP
,

645 &
ty≥_2_desc
,

646 0, &
¡lm
->
c_h™dÀ
,

647 &
ty≥_3_desc
,

648 &
©ås
, &
tsDummy
);

649 if(
°©us
 !
SEC_E_OK
)

650  
CURLE_RECV_ERROR
;

652 
size
 = 
ty≥_3_buf
.
cbBuf„r
;

654 
	`Cuæ_¡lm_s•i_˛ónup
(
¡lm
);

657 
lmª•off
;

658 
lmª•
[24];

659 #i‡
USE_NTRESPONSES


660 
¡ª•off
;

661 
¡ª•Àn
 = 24;

662 
¡ª•
[24];

663 *
±r_¡ª•
 = &
¡ª•
[0];

664 *
¡lmv2ª•
 = 
NULL
;

666 
boﬁ
 
unicode
 = (
¡lm
->
Êags
 & 
NTLMFLAG_NEGOTIATE_UNICODE
Ë? 
TRUE
 : 
FALSE
;

667 
ho°
[
HOSTNAME_MAX
 + 1] = "";

668 c⁄° *
u£r
;

669 c⁄° *
domaö
 = "";

670 
size_t
 
ho°off
 = 0;

671 
size_t
 
u£roff
 = 0;

672 
size_t
 
domoff
 = 0;

673 
size_t
 
ho°Àn
 = 0;

674 
size_t
 
u£æí
 = 0;

675 
size_t
 
domÀn
 = 0;

676 
CURLcode
 
ªs
 = 
CURLE_OK
;

678 
u£r
 = 
	`°rchr
(
u£Ω
, '\\');

679 if(!
u£r
)

680 
u£r
 = 
	`°rchr
(
u£Ω
, '/');

682 if(
u£r
) {

683 
domaö
 = 
u£Ω
;

684 
domÀn
 = (
u£r
 - 
domaö
);

685 
u£r
++;

688 
u£r
 = 
u£Ω
;

690 if(
u£r
)

691 
u£æí
 = 
	`°æí
(
u£r
);

695 if(
	`Cuæ_gëho°«me
(
ho°
, (host))) {

696 
	`öfof
(
d©a
, "gethostname() failed, continuing without!\n");

697 
ho°Àn
 = 0;

700 
ho°Àn
 = 
	`°æí
(
ho°
);

703 #i‡
USE_NTRESPONSES


704 if(
¡lm
->
èrgë_öfo_Àn
) {

705 
¡buf„r
[0x18];

706 
íå›y
[2];

707 
¡lmv2hash
[0x18];

709 
íå›y
[0] = 
	`Cuæ_ønd
(
d©a
);

710 
íå›y
[1] = 
	`Cuæ_ønd
(
d©a
);

712 
ªs
 = 
	`Cuæ_¡lm_c‹e_mk_¡_hash
(
d©a
, 
∑sswdp
, 
¡buf„r
);

713 if(
ªs
)

714  
ªs
;

716 
ªs
 = 
	`Cuæ_¡lm_c‹e_mk_¡lmv2_hash
(
u£r
, 
u£æí
, 
domaö
, 
domÀn
,

717 
¡buf„r
, 
¡lmv2hash
);

718 if(
ªs
)

719  
ªs
;

722 
ªs
 = 
	`Cuæ_¡lm_c‹e_mk_lmv2_ª•
(
¡lmv2hash
,

723 (*)&
íå›y
[0],

724 &
¡lm
->
n⁄˚
[0], 
lmª•
);

725 if(
ªs
)

726  
ªs
;

729 
ªs
 = 
	`Cuæ_¡lm_c‹e_mk_¡lmv2_ª•
(
¡lmv2hash
,

730 (*)&
íå›y
[0],

731 
¡lm
, &
¡lmv2ª•
, &
¡ª•Àn
);

732 if(
ªs
)

733  
ªs
;

735 
±r_¡ª•
 = 
¡lmv2ª•
;

740 #i‡
USE_NTLM2SESSION


742 if(
¡lm
->
Êags
 & 
NTLMFLAG_NEGOTIATE_NTLM2_KEY
) {

743 
¡buf„r
[0x18];

744 
tmp
[0x18];

745 
md5sum
[
MD5_DIGEST_LENGTH
];

746 
íå›y
[2];

749 
íå›y
[0] = 
	`Cuæ_ønd
(
d©a
);

750 
íå›y
[1] = 
	`Cuæ_ønd
(
d©a
);

753 
	`mem˝y
(
lmª•
, 
íå›y
, 8);

756 
	`mem£t
(
lmª•
 + 8, 0, 0x10);

759 
	`mem˝y
(
tmp
, &
¡lm
->
n⁄˚
[0], 8);

760 
	`mem˝y
(
tmp
 + 8, 
íå›y
, 8);

762 
	`Cuæ_s¶_md5sum
(
tmp
, 16, 
md5sum
, 
MD5_DIGEST_LENGTH
);

766 if(
CURLE_OUT_OF_MEMORY
 ==

767 
	`Cuæ_¡lm_c‹e_mk_¡_hash
(
d©a
, 
∑sswdp
, 
¡buf„r
))

768  
CURLE_OUT_OF_MEMORY
;

770 
	`Cuæ_¡lm_c‹e_lm_ª•
(
¡buf„r
, 
md5sum
, 
¡ª•
);

779 #i‡
USE_NTRESPONSES


780 
¡buf„r
[0x18];

782 
lmbuf„r
[0x18];

784 #i‡
USE_NTRESPONSES


785 if(
CURLE_OUT_OF_MEMORY
 ==

786 
	`Cuæ_¡lm_c‹e_mk_¡_hash
(
d©a
, 
∑sswdp
, 
¡buf„r
))

787  
CURLE_OUT_OF_MEMORY
;

788 
	`Cuæ_¡lm_c‹e_lm_ª•
(
¡buf„r
, &
¡lm
->
n⁄˚
[0], 
¡ª•
);

791 
	`Cuæ_¡lm_c‹e_mk_lm_hash
(
d©a
, 
∑sswdp
, 
lmbuf„r
);

792 
	`Cuæ_¡lm_c‹e_lm_ª•
(
lmbuf„r
, &
¡lm
->
n⁄˚
[0], 
lmª•
);

798 if(
unicode
) {

799 
domÀn
 = domlen * 2;

800 
u£æí
 = userlen * 2;

801 
ho°Àn
 = hostlen * 2;

804 
lmª•off
 = 64;

805 #i‡
USE_NTRESPONSES


806 
¡ª•off
 = 
lmª•off
 + 0x18;

807 
domoff
 = 
¡ª•off
 + 
¡ª•Àn
;

809 
domoff
 = 
lmª•off
 + 0x18;

811 
u£roff
 = 
domoff
 + 
domÀn
;

812 
ho°off
 = 
u£roff
 + 
u£æí
;

815 
size
 = 
	`¢¥ötf
((*)
¡lmbuf
, 
NTLM_BUFSIZE
,

816 
NTLMSSP_SIGNATURE
 "%c"

860 
	`SHORTPAIR
(0x18),

861 
	`SHORTPAIR
(0x18),

862 
	`SHORTPAIR
(
lmª•off
),

865 #i‡
USE_NTRESPONSES


866 
	`SHORTPAIR
(
¡ª•Àn
),

867 
	`SHORTPAIR
(
¡ª•Àn
),

868 
	`SHORTPAIR
(
¡ª•off
),

876 
	`SHORTPAIR
(
domÀn
),

877 
	`SHORTPAIR
(
domÀn
),

878 
	`SHORTPAIR
(
domoff
),

881 
	`SHORTPAIR
(
u£æí
),

882 
	`SHORTPAIR
(
u£æí
),

883 
	`SHORTPAIR
(
u£roff
),

886 
	`SHORTPAIR
(
ho°Àn
),

887 
	`SHORTPAIR
(
ho°Àn
),

888 
	`SHORTPAIR
(
ho°off
),

896 
	`LONGQUARTET
(
¡lm
->
Êags
));

898 
	`DEBUGASSERT
(
size
 == 64);

899 
	`DEBUGASSERT
(
size
 =(
size_t
)
lmª•off
);

902 if(
size
 < (
NTLM_BUFSIZE
 - 0x18)) {

903 
	`mem˝y
(&
¡lmbuf
[
size
], 
lmª•
, 0x18);

904 
size
 += 0x18;

907 
	`DEBUG_OUT
({

908 
	`Ârötf
(
°dîr
, "**** TYPE3 headerÜmresp=");

909 
	`¡lm_¥öt_hex
(
°dîr
, (*)&
¡lmbuf
[
lmª•off
], 0x18);

912 #i‡
USE_NTRESPONSES


913 if(
size
 < (
NTLM_BUFSIZE
 - 
¡ª•Àn
)) {

914 
	`DEBUGASSERT
(
size
 =(
size_t
)
¡ª•off
);

915 
	`mem˝y
(&
¡lmbuf
[
size
], 
±r_¡ª•
, 
¡ª•Àn
);

916 
size
 +
¡ª•Àn
;

919 
	`DEBUG_OUT
({

920 
	`Ârötf
(
°dîr
, "\nÇtresp=");

921 
	`¡lm_¥öt_hex
(
°dîr
, (*)&
¡lmbuf
[
¡ª•off
], 
¡ª•Àn
);

924 
	`Cuæ_ß„‰ì
(
¡lmv2ª•
);

928 
	`DEBUG_OUT
({

929 
	`Ârötf
(
°dîr
, "\n flags=0x%02.2x%02.2x%02.2x%02.2x 0x%08.8x ",

930 
	`LONGQUARTET
(
¡lm
->
Êags
),Çtlm->flags);

931 
	`¡lm_¥öt_Êags
(
°dîr
, 
¡lm
->
Êags
);

932 
	`Ârötf
(
°dîr
, "\n****\n");

937 if(
size
 + 
u£æí
 + 
domÀn
 + 
ho°Àn
 >
NTLM_BUFSIZE
) {

938 
	`Áûf
(
d©a
, "user + domain + hostÇameÅoo big");

939  
CURLE_OUT_OF_MEMORY
;

942 
	`DEBUGASSERT
(
size
 =
domoff
);

943 if(
unicode
)

944 
	`unicode˝y
(&
¡lmbuf
[
size
], 
domaö
, 
domÀn
 / 2);

946 
	`mem˝y
(&
¡lmbuf
[
size
], 
domaö
, 
domÀn
);

948 
size
 +
domÀn
;

950 
	`DEBUGASSERT
(
size
 =
u£roff
);

951 if(
unicode
)

952 
	`unicode˝y
(&
¡lmbuf
[
size
], 
u£r
, 
u£æí
 / 2);

954 
	`mem˝y
(&
¡lmbuf
[
size
], 
u£r
, 
u£æí
);

956 
size
 +
u£æí
;

958 
	`DEBUGASSERT
(
size
 =
ho°off
);

959 if(
unicode
)

960 
	`unicode˝y
(&
¡lmbuf
[
size
], 
ho°
, 
ho°Àn
 / 2);

962 
	`mem˝y
(&
¡lmbuf
[
size
], 
ho°
, 
ho°Àn
);

964 
size
 +
ho°Àn
;

967 
ªs
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
d©a
, (*)&
¡lmbuf
[
domoff
],

968 
size
 - 
domoff
);

969 if(
ªs
)

970  
CURLE_CONV_FAILED
;

975  
	`Cuæ_ba£64_ícode
(
NULL
, (*)
¡lmbuf
, 
size
, 
ouçå
, 
ouéí
);

976 
	}
}

	@lib/curl_ntlm_msgs.h

1 #i‚de‡
HEADER_CURL_NTLM_MSGS_H


2 
	#HEADER_CURL_NTLM_MSGS_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
USE_NTLM


30 
CURLcode
 
Cuæ_¡lm_¸óã_ty≥1_mesßge
(c⁄° *
u£Ω
,

31 c⁄° *
∑sswdp
,

32 
¡lmd©a
 *
¡lm
,

33 **
ouçå
,

34 
size_t
 *
ouéí
);

37 
CURLcode
 
Cuæ_¡lm_¸óã_ty≥3_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

38 c⁄° *
u£Ω
,

39 c⁄° *
∑sswdp
,

40 
¡lmd©a
 *
¡lm
,

41 **
ouçå
,

42 
size_t
 *
ouéí
);

45 
CURLcode
 
Cuæ_¡lm_decode_ty≥2_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

46 c⁄° * 
hódî
,

47 
¡lmd©a
* 
¡lm
);

50 
CURLcode
 
Cuæ_¡lm_decode_ty≥2_èrgë
(
Sessi⁄H™dÀ
 *
d©a
,

51 * 
buf„r
,

52 
size_t
 
size
,

53 
¡lmd©a
* 
¡lm
);

57 #ifde‡
USE_WINDOWS_SSPI


58 
Cuæ_¡lm_s•i_˛ónup
(
¡lmd©a
 *
¡lm
);

60 
	#Cuæ_¡lm_s•i_˛ónup
(
x
)

	)

64 
	#NTLM_BUFSIZE
 1024

	)

67 #ifde‡
BUILDING_CURL_NTLM_MSGS_C


71 
	#NTLMFLAG_NEGOTIATE_UNICODE
 (1<<0)

	)

75 
	#NTLMFLAG_NEGOTIATE_OEM
 (1<<1)

	)

78 
	#NTLMFLAG_REQUEST_TARGET
 (1<<2)

	)

83 
	#NTLMFLAG_NEGOTIATE_SIGN
 (1<<4)

	)

87 
	#NTLMFLAG_NEGOTIATE_SEAL
 (1<<5)

	)

91 
	#NTLMFLAG_NEGOTIATE_DATAGRAM_STYLE
 (1<<6)

	)

94 
	#NTLMFLAG_NEGOTIATE_LM_KEY
 (1<<7)

	)

98 
	#NTLMFLAG_NEGOTIATE_NETWARE
 (1<<8)

	)

101 
	#NTLMFLAG_NEGOTIATE_NTLM_KEY
 (1<<9)

	)

106 
	#NTLMFLAG_NEGOTIATE_ANONYMOUS
 (1<<11)

	)

110 
	#NTLMFLAG_NEGOTIATE_DOMAIN_SUPPLIED
 (1<<12)

	)

114 
	#NTLMFLAG_NEGOTIATE_WORKSTATION_SUPPLIED
 (1<<13)

	)

118 
	#NTLMFLAG_NEGOTIATE_LOCAL_CALL
 (1<<14)

	)

123 
	#NTLMFLAG_NEGOTIATE_ALWAYS_SIGN
 (1<<15)

	)

127 
	#NTLMFLAG_TARGET_TYPE_DOMAIN
 (1<<16)

	)

131 
	#NTLMFLAG_TARGET_TYPE_SERVER
 (1<<17)

	)

135 
	#NTLMFLAG_TARGET_TYPE_SHARE
 (1<<18)

	)

140 
	#NTLMFLAG_NEGOTIATE_NTLM2_KEY
 (1<<19)

	)

144 
	#NTLMFLAG_REQUEST_INIT_RESPONSE
 (1<<20)

	)

147 
	#NTLMFLAG_REQUEST_ACCEPT_RESPONSE
 (1<<21)

	)

150 
	#NTLMFLAG_REQUEST_NONNT_SESSION_KEY
 (1<<22)

	)

153 
	#NTLMFLAG_NEGOTIATE_TARGET_INFO
 (1<<23)

	)

163 
	#NTLMFLAG_NEGOTIATE_128
 (1<<29)

	)

166 
	#NTLMFLAG_NEGOTIATE_KEY_EXCHANGE
 (1<<30)

	)

170 
	#NTLMFLAG_NEGOTIATE_56
 (1<<31)

	)

	@lib/curl_ntlm_wb.c

23 
	~"cuæ_£tup.h
"

25 #i‡
deföed
(
USE_NTLM
Ë&& deföed(
NTLM_WB_ENABLED
)

34 
	#DEBUG_ME
 0

	)

36 #ifde‡
HAVE_SYS_WAIT_H


37 
	~<sys/waô.h
>

39 #ifde‡
HAVE_SIGNAL_H


40 
	~<sig«l.h
>

43 
	~"uæd©a.h
"

44 
	~"£ndf.h
"

45 
	~"£À˘.h
"

46 
	~"cuæ_¡lm_msgs.h
"

47 
	~"cuæ_¡lm_wb.h
"

48 
	~"uæ.h
"

49 
	~"°ªº‹.h
"

50 
	~"cuæ_mem‹y.h
"

52 
	#_MPRINTF_REPLACE


	)

53 
	~<cuæ/m¥ötf.h
>

56 
	~"memdebug.h
"

58 #i‡
DEBUG_ME


59 
	#DEBUG_OUT
(
x
Ë
	)
x

61 
	#DEBUG_OUT
(
x
Ë
Cuæ_n›_°mt


	)

66 #i‡
deföed
(
HAVE_CLOSESOCKET
)

67 
	#s˛o£_nﬁog
(
x
Ë
	`˛o£sockë
((x))

	)

68 #ñi‡
deföed
(
HAVE_CLOSESOCKET_CAMEL
)

69 
	#s˛o£_nﬁog
(
x
Ë
	`Clo£Sockë
((x))

	)

71 
	#s˛o£_nﬁog
(
x
Ë
	`˛o£
((x))

	)

74 
	$Cuæ_¡lm_wb_˛ónup
(
c⁄√˘d©a
 *
c⁄n
)

76 if(
c⁄n
->
¡lm_auth_hÕr_sockë
 !
CURL_SOCKET_BAD
) {

77 
	`s˛o£
(
c⁄n
->
¡lm_auth_hÕr_sockë
);

78 
c⁄n
->
¡lm_auth_hÕr_sockë
 = 
CURL_SOCKET_BAD
;

81 if(
c⁄n
->
¡lm_auth_hÕr_pid
) {

82 
i
;

83 
i
 = 0; i < 4; i++) {

84 
pid_t
 
ªt
 = 
	`waôpid
(
c⁄n
->
¡lm_auth_hÕr_pid
, 
NULL
, 
WNOHANG
);

85 if(
ªt
 =
c⁄n
->
¡lm_auth_hÕr_pid
 || 
î∫o
 =
ECHILD
)

87 
i
) {

89 
	`kûl
(
c⁄n
->
¡lm_auth_hÕr_pid
, 
SIGTERM
);

94 
	`Cuæ_waô_ms
(1);

97 
	`kûl
(
c⁄n
->
¡lm_auth_hÕr_pid
, 
SIGKILL
);

103 
c⁄n
->
¡lm_auth_hÕr_pid
 = 0;

106 
	`Cuæ_ß„‰ì
(
c⁄n
->
chÆÀnge_hódî
);

107 
c⁄n
->
chÆÀnge_hódî
 = 
NULL
;

108 
	`Cuæ_ß„‰ì
(
c⁄n
->
ª•⁄£_hódî
);

109 
c⁄n
->
ª•⁄£_hódî
 = 
NULL
;

110 
	}
}

112 
CURLcode
 
	$¡lm_wb_öô
(
c⁄√˘d©a
 *
c⁄n
, c⁄° *
u£Ω
)

114 
cuæ_sockë_t
 
sockfds
[2];

115 
pid_t
 
chûd_pid
;

116 c⁄° *
u£∫ame
;

117 *
¶ash
, *
domaö
 = 
NULL
;

118 c⁄° *
¡lm_auth
 = 
NULL
;

119 *
¡lm_auth_Æloc
 = 
NULL
;

120 
îr‹
;

123 if(
c⁄n
->
¡lm_auth_hÕr_sockë
 !
CURL_SOCKET_BAD
 ||

124 
c⁄n
->
¡lm_auth_hÕr_pid
)

125  
CURLE_OK
;

127 
u£∫ame
 = 
u£Ω
;

128 
¶ash
 = 
	`°Ωbrk
(
u£∫ame
, "\\/");

129 if(
¶ash
) {

130 if((
domaö
 = 
	`°rdup
(
u£∫ame
)Ë=
NULL
)

131  
CURLE_OUT_OF_MEMORY
;

132 
¶ash
 = 
domaö
 + (¶ash - 
u£∫ame
);

133 *
¶ash
 = '\0';

134 
u£∫ame
 = u£∫amê+ (
¶ash
 - 
domaö
) + 1;

141 #ifde‡
DEBUGBUILD


142 
¡lm_auth_Æloc
 = 
	`cuæ_gëív
("CURL_NTLM_WB_FILE");

143 if(
¡lm_auth_Æloc
)

144 
¡lm_auth
 = 
¡lm_auth_Æloc
;

147 
¡lm_auth
 = 
NTLM_WB_FILE
;

149 if(
	`ac˚ss
(
¡lm_auth
, 
X_OK
) != 0) {

150 
îr‹
 = 
ERRNO
;

151 
	`Áûf
(
c⁄n
->
d©a
, "CouldÇotáccessÇtlm_auth: %sÉrrno %d: %s",

152 
¡lm_auth
, 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

153 
d⁄e
;

156 if(
	`sockë∑ú
(
AF_UNIX
, 
SOCK_STREAM
, 0, 
sockfds
)) {

157 
îr‹
 = 
ERRNO
;

158 
	`Áûf
(
c⁄n
->
d©a
, "CouldÇot open socketÖair.Érrno %d: %s",

159 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

160 
d⁄e
;

163 
chûd_pid
 = 
	`f‹k
();

164 if(
chûd_pid
 == -1) {

165 
îr‹
 = 
ERRNO
;

166 
	`s˛o£
(
sockfds
[0]);

167 
	`s˛o£
(
sockfds
[1]);

168 
	`Áûf
(
c⁄n
->
d©a
, "CouldÇot fork.Érrno %d: %s",

169 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

170 
d⁄e
;

172 if(!
chûd_pid
) {

178 
	`s˛o£_nﬁog
(
sockfds
[0]);

179 if(
	`dup2
(
sockfds
[1], 
STDIN_FILENO
) == -1) {

180 
îr‹
 = 
ERRNO
;

181 
	`Áûf
(
c⁄n
->
d©a
, "CouldÇotÑedirect child stdin.Érrno %d: %s",

182 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

183 
	`exô
(1);

186 if(
	`dup2
(
sockfds
[1], 
STDOUT_FILENO
) == -1) {

187 
îr‹
 = 
ERRNO
;

188 
	`Áûf
(
c⁄n
->
d©a
, "CouldÇotÑedirect child stdout.Érrno %d: %s",

189 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

190 
	`exô
(1);

193 if(
domaö
)

194 
	`exe˛
(
¡lm_auth
,Çtlm_auth,

197 "--u£∫ame", 
u£∫ame
,

198 "--domaö", 
domaö
,

199 
NULL
);

201 
	`exe˛
(
¡lm_auth
,Çtlm_auth,

204 "--u£∫ame", 
u£∫ame
,

205 
NULL
);

207 
îr‹
 = 
ERRNO
;

208 
	`s˛o£_nﬁog
(
sockfds
[1]);

209 
	`Áûf
(
c⁄n
->
d©a
, "CouldÇotÉxecl().Érrno %d: %s",

210 
îr‹
, 
	`Cuæ_°ªº‹
(
c⁄n
,Érror));

211 
	`exô
(1);

214 
	`s˛o£
(
sockfds
[1]);

215 
c⁄n
->
¡lm_auth_hÕr_sockë
 = 
sockfds
[0];

216 
c⁄n
->
¡lm_auth_hÕr_pid
 = 
chûd_pid
;

217 
	`Cuæ_ß„‰ì
(
domaö
);

218 
	`Cuæ_ß„‰ì
(
¡lm_auth_Æloc
);

219  
CURLE_OK
;

221 
d⁄e
:

222 
	`Cuæ_ß„‰ì
(
domaö
);

223 
	`Cuæ_ß„‰ì
(
¡lm_auth_Æloc
);

224  
CURLE_REMOTE_ACCESS_DENIED
;

225 
	}
}

227 
CURLcode
 
	$¡lm_wb_ª•⁄£
(
c⁄√˘d©a
 *
c⁄n
,

228 c⁄° *
öput
, 
cuæ¡lm
 
°©e
)

230 
ssize_t
 
size
;

231 
buf
[
NTLM_BUFSIZE
];

232 *
tmpbuf
 = 
buf
;

233 
size_t
 
Àn_ö
 = 
	`°æí
(
öput
);

234 
size_t
 
Àn_out
 = (
buf
);

236 
Àn_ö
 > 0) {

237 
ssize_t
 
wrôãn
 = 
	`swrôe
(
c⁄n
->
¡lm_auth_hÕr_sockë
, 
öput
, 
Àn_ö
);

238 if(
wrôãn
 == -1) {

240 if(
î∫o
 =
EINTR
)

243 
d⁄e
;

245 
öput
 +
wrôãn
;

246 
Àn_ö
 -
wrôãn
;

249 
Àn_out
 > 0) {

250 
size
 = 
	`§ód
(
c⁄n
->
¡lm_auth_hÕr_sockë
, 
tmpbuf
, 
Àn_out
);

251 if(
size
 == -1) {

252 if(
î∫o
 =
EINTR
)

254 
d⁄e
;

256 if(
size
 == 0)

257 
d⁄e
;

258 if(
tmpbuf
[
size
 - 1] == '\n') {

259 
tmpbuf
[
size
 - 1] = '\0';

260 
wrföish
;

262 
tmpbuf
 +
size
;

263 
Àn_out
 -
size
;

265 
d⁄e
;

266 
wrföish
:

268 if(
°©e
 =
NTLMSTATE_TYPE1
 &&

269 
size
 == 3 &&

270 
buf
[0] == 'P' && buf[1] == 'W')

271  
CURLE_REMOTE_ACCESS_DENIED
;

273 if(
size
 < 4)

274 
d⁄e
;

275 if(
°©e
 =
NTLMSTATE_TYPE1
 &&

276 (
buf
[0]!='Y' || buf[1]!='R' || buf[2]!=' '))

277 
d⁄e
;

278 if(
°©e
 =
NTLMSTATE_TYPE2
 &&

279 (
buf
[0]!='K' || buf[1]!='K' || buf[2]!=' ') &&

280 (
buf
[0]!='A' || buf[1]!='F' || buf[2]!=' '))

281 
d⁄e
;

283 
c⁄n
->
ª•⁄£_hódî
 = 
	`≠rötf
("NTLM %.*s", 
size
 - 4, 
buf
 + 3);

284  
CURLE_OK
;

285 
d⁄e
:

286  
CURLE_REMOTE_ACCESS_DENIED
;

287 
	}
}

293 
CURLcode
 
	$Cuæ_ouçut_¡lm_wb
(
c⁄√˘d©a
 *
c⁄n
,

294 
boﬁ
 
¥oxy
)

298 **
Ælocu£Ωwd
;

300 c⁄° *
u£Ω
;

302 
¡lmd©a
 *
¡lm
;

303 
auth
 *
authp
;

305 
CURLcode
 
ªs
 = 
CURLE_OK
;

306 *
öput
;

308 
	`DEBUGASSERT
(
c⁄n
);

309 
	`DEBUGASSERT
(
c⁄n
->
d©a
);

311 if(
¥oxy
) {

312 
Ælocu£Ωwd
 = &
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
;

313 
u£Ω
 = 
c⁄n
->
¥oxyu£r
;

314 
¡lm
 = &
c⁄n
->
¥oxy¡lm
;

315 
authp
 = &
c⁄n
->
d©a
->
°©e
.
auth¥oxy
;

318 
Ælocu£Ωwd
 = &
c⁄n
->
Ælo˝å
.
u£Ωwd
;

319 
u£Ω
 = 
c⁄n
->
u£r
;

320 
¡lm
 = &
c⁄n
->ntlm;

321 
authp
 = &
c⁄n
->
d©a
->
°©e
.
authho°
;

323 
authp
->
d⁄e
 = 
FALSE
;

326 if(!
u£Ω
)

327 
u£Ω
="";

329 
¡lm
->
°©e
) {

330 
NTLMSTATE_TYPE1
:

345 
ªs
 = 
	`¡lm_wb_öô
(
c⁄n
, 
u£Ω
);

346 if(
ªs
)

347  
ªs
;

348 
ªs
 = 
	`¡lm_wb_ª•⁄£
(
c⁄n
, "YR\n", 
¡lm
->
°©e
);

349 if(
ªs
)

350  
ªs
;

352 
	`Cuæ_ß„‰ì
(*
Ælocu£Ωwd
);

353 *
Ælocu£Ωwd
 = 
	`≠rötf
("%sAuthorization: %s\r\n",

354 
¥oxy
 ? "Proxy-" : "",

355 
c⁄n
->
ª•⁄£_hódî
);

356 
	`DEBUG_OUT
(
	`Ârötf
(
°dîr
, "**** Hódî %s\¿", *
Ælocu£Ωwd
));

357 
	`Cuæ_ß„‰ì
(
c⁄n
->
ª•⁄£_hódî
);

358 
c⁄n
->
ª•⁄£_hódî
 = 
NULL
;

360 
NTLMSTATE_TYPE2
:

361 
öput
 = 
	`≠rötf
("TT %s\n", 
c⁄n
->
chÆÀnge_hódî
);

362 if(!
öput
)

363  
CURLE_OUT_OF_MEMORY
;

364 
ªs
 = 
	`¡lm_wb_ª•⁄£
(
c⁄n
, 
öput
, 
¡lm
->
°©e
);

365 
	`‰ì
(
öput
);

366 
öput
 = 
NULL
;

367 if(
ªs
)

368  
ªs
;

370 
	`Cuæ_ß„‰ì
(*
Ælocu£Ωwd
);

371 *
Ælocu£Ωwd
 = 
	`≠rötf
("%sAuthorization: %s\r\n",

372 
¥oxy
 ? "Proxy-" : "",

373 
c⁄n
->
ª•⁄£_hódî
);

374 
	`DEBUG_OUT
(
	`Ârötf
(
°dîr
, "**** %s\¿", *
Ælocu£Ωwd
));

375 
¡lm
->
°©e
 = 
NTLMSTATE_TYPE3
;

376 
authp
->
d⁄e
 = 
TRUE
;

377 
	`Cuæ_¡lm_wb_˛ónup
(
c⁄n
);

379 
NTLMSTATE_TYPE3
:

382 if(*
Ælocu£Ωwd
) {

383 
	`‰ì
(*
Ælocu£Ωwd
);

384 *
Ælocu£Ωwd
=
NULL
;

386 
authp
->
d⁄e
 = 
TRUE
;

390  
CURLE_OK
;

391 
	}
}

	@lib/curl_ntlm_wb.h

1 #i‚de‡
HEADER_CURL_NTLM_WB_H


2 
	#HEADER_CURL_NTLM_WB_H


	)

25 
	~"cuæ_£tup.h
"

27 #i‡
deföed
(
USE_NTLM
Ë&& deföed(
NTLM_WB_ENABLED
)

31 
CURLcode
 
Cuæ_ouçut_¡lm_wb
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
);

33 
Cuæ_¡lm_wb_˛ónup
(
c⁄√˘d©a
 *
c⁄n
);

	@lib/curl_rtmp.c

24 
	~"cuæ_£tup.h
"

26 #ifde‡
USE_LIBRTMP


28 
	~"uæd©a.h
"

29 
	~"n⁄block.h
"

30 
	~"¥ogªss.h
"

31 
	~"å™s„r.h
"

32 
	~"w¨∆ess.h
"

33 
	~<cuæ/cuæ.h
>

34 
	~<libπmp/πmp.h
>

36 
	#_MPRINTF_REPLACE


	)

37 
	~<cuæ/m¥ötf.h
>

39 
	~"cuæ_mem‹y.h
"

41 
	~"memdebug.h
"

43 #ifde‡
_WIN32


44 
	#£tsock›t
(
a
,
b
,
c
,
d
,
e
Ë(
£tsock›t
)◊,b,c,(c⁄° *)d,(Î)

	)

45 
	#SET_RCVTIMEO
(
tv
,
s
Ëtv = s*1000

	)

47 
	#SET_RCVTIMEO
(
tv
,
s
Ë
timevÆ
Åv = {s,0}

	)

50 
	#DEF_BUFTIME
 (2*60*60*1000Ë

	)

52 
CURLcode
 
πmp_£tup
(
c⁄√˘d©a
 *
c⁄n
);

53 
CURLcode
 
πmp_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

54 
CURLcode
 
πmp_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, CURLcode, 
boﬁ
 
¥em©uª
);

55 
CURLcode
 
πmp_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

56 
CURLcode
 
πmp_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód
);

58 
Cuæ_ªcv
 
	gπmp_ªcv
;

59 
Cuæ_£nd
 
	gπmp_£nd
;

65 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_πmp
 = {

67 
πmp_£tup
,

68 
πmp_do
,

69 
πmp_d⁄e
,

70 
ZERO_NULL
,

71 
πmp_c⁄√˘
,

72 
ZERO_NULL
,

73 
ZERO_NULL
,

74 
ZERO_NULL
,

75 
ZERO_NULL
,

76 
ZERO_NULL
,

77 
ZERO_NULL
,

78 
πmp_disc⁄√˘
,

79 
ZERO_NULL
,

80 
PORT_RTMP
,

81 
CURLPROTO_RTMP
,

82 
PROTOPT_NONE


85 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_πm±
 = {

87 
πmp_£tup
,

88 
πmp_do
,

89 
πmp_d⁄e
,

90 
ZERO_NULL
,

91 
πmp_c⁄√˘
,

92 
ZERO_NULL
,

93 
ZERO_NULL
,

94 
ZERO_NULL
,

95 
ZERO_NULL
,

96 
ZERO_NULL
,

97 
ZERO_NULL
,

98 
πmp_disc⁄√˘
,

99 
ZERO_NULL
,

100 
PORT_RTMPT
,

101 
CURLPROTO_RTMPT
,

102 
PROTOPT_NONE


105 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_πm≥
 = {

107 
πmp_£tup
,

108 
πmp_do
,

109 
πmp_d⁄e
,

110 
ZERO_NULL
,

111 
πmp_c⁄√˘
,

112 
ZERO_NULL
,

113 
ZERO_NULL
,

114 
ZERO_NULL
,

115 
ZERO_NULL
,

116 
ZERO_NULL
,

117 
ZERO_NULL
,

118 
πmp_disc⁄√˘
,

119 
ZERO_NULL
,

120 
PORT_RTMP
,

121 
CURLPROTO_RTMPE
,

122 
PROTOPT_NONE


125 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_πm±e
 = {

127 
πmp_£tup
,

128 
πmp_do
,

129 
πmp_d⁄e
,

130 
ZERO_NULL
,

131 
πmp_c⁄√˘
,

132 
ZERO_NULL
,

133 
ZERO_NULL
,

134 
ZERO_NULL
,

135 
ZERO_NULL
,

136 
ZERO_NULL
,

137 
ZERO_NULL
,

138 
πmp_disc⁄√˘
,

139 
ZERO_NULL
,

140 
PORT_RTMPT
,

141 
CURLPROTO_RTMPTE
,

142 
PROTOPT_NONE


145 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_πmps
 = {

147 
πmp_£tup
,

148 
πmp_do
,

149 
πmp_d⁄e
,

150 
ZERO_NULL
,

151 
πmp_c⁄√˘
,

152 
ZERO_NULL
,

153 
ZERO_NULL
,

154 
ZERO_NULL
,

155 
ZERO_NULL
,

156 
ZERO_NULL
,

157 
ZERO_NULL
,

158 
πmp_disc⁄√˘
,

159 
ZERO_NULL
,

160 
PORT_RTMPS
,

161 
CURLPROTO_RTMPS
,

162 
PROTOPT_NONE


165 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_πm±s
 = {

167 
πmp_£tup
,

168 
πmp_do
,

169 
πmp_d⁄e
,

170 
ZERO_NULL
,

171 
πmp_c⁄√˘
,

172 
ZERO_NULL
,

173 
ZERO_NULL
,

174 
ZERO_NULL
,

175 
ZERO_NULL
,

176 
ZERO_NULL
,

177 
ZERO_NULL
,

178 
πmp_disc⁄√˘
,

179 
ZERO_NULL
,

180 
PORT_RTMPS
,

181 
CURLPROTO_RTMPTS
,

182 
PROTOPT_NONE


185 
CURLcode
 
	$πmp_£tup
(
c⁄√˘d©a
 *
c⁄n
)

187 
RTMP
 *
r
 = 
	`RTMP_AŒoc
();

189 if(!
r
)

190  
CURLE_OUT_OF_MEMORY
;

192 
	`RTMP_Inô
(
r
);

193 
	`RTMP_SëBuf„rMS
(
r
, 
DEF_BUFTIME
);

194 if(!
	`RTMP_SëupURL
(
r
, 
c⁄n
->
d©a
->
ch™ge
.
uæ
)) {

195 
	`RTMP_Fªe
(
r
);

196  
CURLE_URL_MALFORMAT
;

198 
c⁄n
->
¥Ÿo
.
gíîic
 = 
r
;

199  
CURLE_OK
;

200 
	}
}

202 
CURLcode
 
	$πmp_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

204 
RTMP
 *
r
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

205 
	`SET_RCVTIMEO
(
tv
,10);

207 
r
->
m_sb
.
sb_sockë
 = 
c⁄n
->
sock
[
FIRSTSOCKET
];

212 if(
c⁄n
->
d©a
->
£t
.
u∂ﬂd
)

213 
r
->
Lök
.
¥Ÿocﬁ
 |
RTMP_FEATURE_WRITE
;

216 if(!(
r
->
Lök
.
lFœgs
 & 
RTMP_LF_LIVE
) &&

217 !(
r
->
Lök
.
¥Ÿocﬁ
 & 
RTMP_FEATURE_HTTP
))

218 
r
->
Lök
.
lFœgs
 |
RTMP_LF_BUFX
;

220 
	`cuæx_n⁄block
(
r
->
m_sb
.
sb_sockë
, 
FALSE
);

221 
	`£tsock›t
(
r
->
m_sb
.
sb_sockë
, 
SOL_SOCKET
, 
SO_RCVTIMEO
,

222 (*)&
tv
, (tv));

224 if(!
	`RTMP_C⁄√˘1
(
r
, 
NULL
))

225  
CURLE_FAILED_INIT
;

228 
r
->
m_bSídCou¡î
 = 
åue
;

230 *
d⁄e
 = 
TRUE
;

231 
c⁄n
->
ªcv
[
FIRSTSOCKET
] = 
πmp_ªcv
;

232 
c⁄n
->
£nd
[
FIRSTSOCKET
] = 
πmp_£nd
;

233  
CURLE_OK
;

234 
	}
}

236 
CURLcode
 
	$πmp_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

238 
RTMP
 *
r
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

240 if(!
	`RTMP_C⁄√˘Såóm
(
r
, 0))

241  
CURLE_FAILED_INIT
;

243 if(
c⁄n
->
d©a
->
£t
.
u∂ﬂd
) {

244 
	`Cuæ_pgrsSëU∂ﬂdSize
(
c⁄n
->
d©a
, c⁄n->d©a->
°©e
.
öfûesize
);

245 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, 
FIRSTSOCKET
, NULL);

248 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
FALSE
, 
NULL
, -1, NULL);

249 *
d⁄e
 = 
TRUE
;

250  
CURLE_OK
;

251 
	}
}

253 
CURLcode
 
	$πmp_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
°©us
,

254 
boﬁ
 
¥em©uª
)

256 ()
c⁄n
;

257 ()
°©us
;

258 ()
¥em©uª
;

260  
CURLE_OK
;

261 
	}
}

263 
CURLcode
 
	$πmp_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

264 
boﬁ
 
dód_c⁄√˘i⁄
)

266 
RTMP
 *
r
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

267 ()
dód_c⁄√˘i⁄
;

268 if(
r
) {

269 
c⁄n
->
¥Ÿo
.
gíîic
 = 
NULL
;

270 
	`RTMP_Clo£
(
r
);

271 
	`RTMP_Fªe
(
r
);

273  
CURLE_OK
;

274 
	}
}

276 
ssize_t
 
	$πmp_ªcv
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
, *
buf
,

277 
size_t
 
Àn
, 
CURLcode
 *
îr
)

279 
RTMP
 *
r
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

280 
ssize_t
 
ƒód
;

282 ()
socködex
;

284 
ƒód
 = 
	`RTMP_Ród
(
r
, 
buf
, 
	`cuæx_uztosi
(
Àn
));

285 if(
ƒód
 < 0) {

286 if(
r
->
m_ªad
.
°©us
 =
RTMP_READ_COMPLETE
 ||

287 
r
->
m_ªad
.
°©us
 =
RTMP_READ_EOF
) {

288 
c⁄n
->
d©a
->
ªq
.
size
 = c⁄n->d©a->ªq.
byãcou¡
;

289 
ƒód
 = 0;

292 *
îr
 = 
CURLE_RECV_ERROR
;

294  
ƒód
;

295 
	}
}

297 
ssize_t
 
	$πmp_£nd
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

298 c⁄° *
buf
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

300 
RTMP
 *
r
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

301 
ssize_t
 
num
;

303 ()
socködex
;

305 
num
 = 
	`RTMP_Wrôe
(
r
, (*)
buf
, 
	`cuæx_uztosi
(
Àn
));

306 if(
num
 < 0)

307 *
îr
 = 
CURLE_SEND_ERROR
;

309  
num
;

310 
	}
}

	@lib/curl_rtmp.h

1 #i‚de‡
HEADER_CURL_RTMP_H


2 
	#HEADER_CURL_RTMP_H


	)

24 #ifde‡
USE_LIBRTMP


25 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_πmp
;

26 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_πm±
;

27 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_πm≥
;

28 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_πm±e
;

29 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_πmps
;

30 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_πm±s
;

	@lib/curl_sasl.c

30 
	~"cuæ_£tup.h
"

32 
	~<cuæ/cuæ.h
>

33 
	~"uæd©a.h
"

35 
	~"cuæ_ba£64.h
"

36 
	~"cuæ_md5.h
"

37 
	~"vés/vés.h
"

38 
	~"cuæ_hmac.h
"

39 
	~"cuæ_¡lm_msgs.h
"

40 
	~"cuæ_ß¶.h
"

41 
	~"w¨∆ess.h
"

42 
	~"cuæ_mem‹y.h
"

43 
	~"°πok.h
"

44 
	~"øw°r.h
"

46 #ifde‡
USE_NSS


47 
	~"vés/nssg.h
"

50 
	#_MPRINTF_REPLACE


	)

51 
	~<cuæ/m¥ötf.h
>

54 
	~"memdebug.h
"

56 #i‡!
deföed
(
CURL_DISABLE_CRYPTO_AUTH
Ë&& !deföed(
USE_WINDOWS_SSPI
)

57 
	#DIGEST_QOP_VALUE_AUTH
 (1 << 0)

	)

58 
	#DIGEST_QOP_VALUE_AUTH_INT
 (1 << 1)

	)

59 
	#DIGEST_QOP_VALUE_AUTH_CONF
 (1 << 2)

	)

61 
	#DIGEST_QOP_VALUE_STRING_AUTH
 "auth"

	)

62 
	#DIGEST_QOP_VALUE_STRING_AUTH_INT
 "auth-öt"

	)

63 
	#DIGEST_QOP_VALUE_STRING_AUTH_CONF
 "auth-c⁄f"

	)

68 
boﬁ
 
	$ß¶_dige°_gë_key_vÆue
(c⁄° *
chlg
,

69 c⁄° *
key
,

70 *
vÆue
,

71 
size_t
 
max_vÆ_Àn
,

72 
íd_ch¨
)

74 *
föd_pos
;

75 
size_t
 
i
;

77 
föd_pos
 = 
	`°r°r
(
chlg
, 
key
);

78 if(!
föd_pos
)

79  
FALSE
;

81 
föd_pos
 +
	`°æí
(
key
);

83 
i
 = 0; *
föd_pos
 && *föd_po†!
íd_ch¨
 && i < 
max_vÆ_Àn
 - 1; ++i)

84 
vÆue
[
i
] = *
föd_pos
++;

85 
vÆue
[
i
] = '\0';

87  
TRUE
;

88 
	}
}

90 
CURLcode
 
	$ß¶_dige°_gë_q›_vÆues
(c⁄° *
›ti⁄s
, *
vÆue
)

92 *
tmp
;

93 *
tokí
;

94 *
tok_buf
;

97 *
vÆue
 = 0;

101 
tmp
 = 
	`°rdup
(
›ti⁄s
);

102 if(!
tmp
)

103  
CURLE_OUT_OF_MEMORY
;

105 
tokí
 = 
	`°πok_r
(
tmp
, ",", &
tok_buf
);

106 
tokí
 !
NULL
) {

107 if(
	`Cuæ_øw_equÆ
(
tokí
, 
DIGEST_QOP_VALUE_STRING_AUTH
))

108 *
vÆue
 |
DIGEST_QOP_VALUE_AUTH
;

109 if(
	`Cuæ_øw_equÆ
(
tokí
, 
DIGEST_QOP_VALUE_STRING_AUTH_INT
))

110 *
vÆue
 |
DIGEST_QOP_VALUE_AUTH_INT
;

111 if(
	`Cuæ_øw_equÆ
(
tokí
, 
DIGEST_QOP_VALUE_STRING_AUTH_CONF
))

112 *
vÆue
 |
DIGEST_QOP_VALUE_AUTH_CONF
;

114 
tokí
 = 
	`°πok_r
(
NULL
, ",", &
tok_buf
);

117 
	`Cuæ_ß„‰ì
(
tmp
);

119  
CURLE_OK
;

120 
	}
}

140 
CURLcode
 
	$Cuæ_ß¶_¸óã_∂aö_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

141 c⁄° *
u£Ω
,

142 c⁄° *
∑sswdp
,

143 **
ouçå
, 
size_t
 *
ouéí
)

145 
CURLcode
 
ªsu…
;

146 *
∂aöauth
;

147 
size_t
 
uÀn
;

148 
size_t
 
∂í
;

150 
uÀn
 = 
	`°æí
(
u£Ω
);

151 
∂í
 = 
	`°æí
(
∑sswdp
);

153 
∂aöauth
 = 
	`mÆloc
(2 * 
uÀn
 + 
∂í
 + 2);

154 if(!
∂aöauth
) {

155 *
ouéí
 = 0;

156 *
ouçå
 = 
NULL
;

157  
CURLE_OUT_OF_MEMORY
;

161 
	`mem˝y
(
∂aöauth
, 
u£Ω
, 
uÀn
);

162 
∂aöauth
[
uÀn
] = '\0';

163 
	`mem˝y
(
∂aöauth
 + 
uÀn
 + 1, 
u£Ω
, ulen);

164 
∂aöauth
[2 * 
uÀn
 + 1] = '\0';

165 
	`mem˝y
(
∂aöauth
 + 2 * 
uÀn
 + 2, 
∑sswdp
, 
∂í
);

168 
ªsu…
 = 
	`Cuæ_ba£64_ícode
(
d©a
, 
∂aöauth
, 2 * 
uÀn
 + 
∂í
 + 2, 
ouçå
,

169 
ouéí
);

170 
	`Cuæ_ß„‰ì
(
∂aöauth
);

171  
ªsu…
;

172 
	}
}

190 
CURLcode
 
	$Cuæ_ß¶_¸óã_logö_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

191 c⁄° *
vÆuï
, **
ouçå
,

192 
size_t
 *
ouéí
)

194 
size_t
 
vÀn
 = 
	`°æí
(
vÆuï
);

196 if(!
vÀn
) {

198 *
ouçå
 = 
	`°rdup
("=");

199 if(*
ouçå
) {

200 *
ouéí
 = (
size_t
) 1;

201  
CURLE_OK
;

204 *
ouéí
 = 0;

205  
CURLE_OUT_OF_MEMORY
;

209  
	`Cuæ_ba£64_ícode
(
d©a
, 
vÆuï
, 
vÀn
, 
ouçå
, 
ouéí
);

210 
	}
}

212 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


227 
CURLcode
 
	$Cuæ_ß¶_decode_¸am_md5_mesßge
(c⁄° *
chlg64
, **
ouçå
,

228 
size_t
 *
ouéí
)

230 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

231 
size_t
 
chlg64Àn
 = 
	`°æí
(
chlg64
);

233 *
ouçå
 = 
NULL
;

234 *
ouéí
 = 0;

237 if(
chlg64Àn
 && *
chlg64
 != '=')

238 
ªsu…
 = 
	`Cuæ_ba£64_decode
(
chlg64
, (**Ë
ouçå
, 
ouéí
);

240  
ªsu…
;

241 
	}
}

261 
CURLcode
 
	$Cuæ_ß¶_¸óã_¸am_md5_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

262 c⁄° *
chlg
,

263 c⁄° *
u£Ω
,

264 c⁄° *
∑sswdp
,

265 **
ouçå
, 
size_t
 *
ouéí
)

267 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

268 
size_t
 
chlgÀn
 = 0;

269 
HMAC_c⁄ãxt
 *
˘xt
;

270 
dige°
[
MD5_DIGEST_LEN
];

271 *
ª•⁄£
;

273 if(
chlg
)

274 
chlgÀn
 = 
	`°æí
(
chlg
);

277 
˘xt
 = 
	`Cuæ_HMAC_öô
(
Cuæ_HMAC_MD5
,

278 (c⁄° *Ë
∑sswdp
,

279 
	`cuæx_uztoui
(
	`°æí
(
∑sswdp
)));

280 if(!
˘xt
)

281  
CURLE_OUT_OF_MEMORY
;

284 if(
chlgÀn
 > 0)

285 
	`Cuæ_HMAC_upd©e
(
˘xt
, (c⁄° *Ë
chlg
,

286 
	`cuæx_uztoui
(
chlgÀn
));

289 
	`Cuæ_HMAC_föÆ
(
˘xt
, 
dige°
);

292 
ª•⁄£
 = 
	`≠rötf
(

294 
u£Ω
, 
dige°
[0], digest[1], digest[2], digest[3], digest[4],

295 
dige°
[5], digest[6], digest[7], digest[8], digest[9], digest[10],

296 
dige°
[11], digest[12], digest[13], digest[14], digest[15]);

297 if(!
ª•⁄£
)

298  
CURLE_OUT_OF_MEMORY
;

301 
ªsu…
 = 
	`Cuæ_ba£64_ícode
(
d©a
, 
ª•⁄£
, 0, 
ouçå
, 
ouéí
);

303 
	`Cuæ_ß„‰ì
(
ª•⁄£
);

305  
ªsu…
;

306 
	}
}

308 #i‚de‡
USE_WINDOWS_SSPI


329 
CURLcode
 
	$ß¶_decode_dige°_md5_mesßge
(c⁄° *
chlg64
,

330 *
n⁄˚
, 
size_t
 
∆í
,

331 *
ªÆm
, 
size_t
 
æí
,

332 *
Æg
, 
size_t
 
Æí
,

333 *
q›
, 
size_t
 
qÀn
)

335 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

336 *
chlg
 = 
NULL
;

337 
size_t
 
chlgÀn
 = 0;

338 
size_t
 
chlg64Àn
 = 
	`°æí
(
chlg64
);

341 if(
chlg64Àn
 && *
chlg64
 != '=') {

342 
ªsu…
 = 
	`Cuæ_ba£64_decode
(
chlg64
, &
chlg
, &
chlgÀn
);

343 if(
ªsu…
)

344  
ªsu…
;

348 if(!
chlg
)

349  
CURLE_BAD_CONTENT_ENCODING
;

352 if(!
	`ß¶_dige°_gë_key_vÆue
((*)
chlg
, "n⁄˚=\"", 
n⁄˚
, 
∆í
, '\"')) {

353 
	`Cuæ_ß„‰ì
(
chlg
);

354  
CURLE_BAD_CONTENT_ENCODING
;

358 if(!
	`ß¶_dige°_gë_key_vÆue
((*)
chlg
, "ªÆm=\"", 
ªÆm
, 
æí
, '\"')) {

360 
	`°r˝y
(
ªÆm
, "");

364 if(!
	`ß¶_dige°_gë_key_vÆue
((*)
chlg
, "Æg‹ôhm=", 
Æg
, 
Æí
, ',')) {

365 
	`Cuæ_ß„‰ì
(
chlg
);

366  
CURLE_BAD_CONTENT_ENCODING
;

370 if(!
	`ß¶_dige°_gë_key_vÆue
((*)
chlg
, "q›=\"", 
q›
, 
qÀn
, '\"')) {

371 
	`Cuæ_ß„‰ì
(
chlg
);

372  
CURLE_BAD_CONTENT_ENCODING
;

375 
	`Cuæ_ß„‰ì
(
chlg
);

377  
CURLE_OK
;

378 
	}
}

399 
CURLcode
 
	$Cuæ_ß¶_¸óã_dige°_md5_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

400 c⁄° *
chlg64
,

401 c⁄° *
u£Ω
,

402 c⁄° *
∑sswdp
,

403 c⁄° *
£rvi˚
,

404 **
ouçå
, 
size_t
 *
ouéí
)

406 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

407 
size_t
 
i
;

408 
MD5_c⁄ãxt
 *
˘xt
;

409 *
ª•⁄£
 = 
NULL
;

410 
dige°
[
MD5_DIGEST_LEN
];

411 
HA1_hex
[2 * 
MD5_DIGEST_LEN
 + 1];

412 
HA2_hex
[2 * 
MD5_DIGEST_LEN
 + 1];

413 
ª•_hash_hex
[2 * 
MD5_DIGEST_LEN
 + 1];

414 
n⁄˚
[64];

415 
ªÆm
[128];

416 
Æg‹ôhm
[64];

417 
q›_›ti⁄s
[64];

418 
q›_vÆues
;

419 
˙⁄˚
[33];

420 
íå›y
[4];

421 
n⁄˚Cou¡
[] = "00000001";

422 
mëhod
[] = "AUTHENTICATE";

423 
q›
[] = 
DIGEST_QOP_VALUE_STRING_AUTH
;

424 
uri
[128];

427 
ªsu…
 = 
	`ß¶_decode_dige°_md5_mesßge
(
chlg64
, 
n⁄˚
, (nonce),

428 
ªÆm
, (realm),

429 
Æg‹ôhm
, (algorithm),

430 
q›_›ti⁄s
, (qop_options));

431 if(
ªsu…
)

432  
ªsu…
;

435 if(
	`°rcmp
(
Æg‹ôhm
, "md5-sess") != 0)

436  
CURLE_BAD_CONTENT_ENCODING
;

439 
ªsu…
 = 
	`ß¶_dige°_gë_q›_vÆues
(
q›_›ti⁄s
, &
q›_vÆues
);

440 if(
ªsu…
)

441  
ªsu…
;

444 if(!(
q›_vÆues
 & 
DIGEST_QOP_VALUE_AUTH
))

445  
CURLE_BAD_CONTENT_ENCODING
;

448 
íå›y
[0] = 
	`Cuæ_ønd
(
d©a
);

449 
íå›y
[1] = 
	`Cuæ_ønd
(
d©a
);

450 
íå›y
[2] = 
	`Cuæ_ønd
(
d©a
);

451 
íå›y
[3] = 
	`Cuæ_ønd
(
d©a
);

454 
	`¢¥ötf
(
˙⁄˚
, (cnonce), "%08x%08x%08x%08x",

455 
íå›y
[0],Éntropy[1],Éntropy[2],Éntropy[3]);

458 
˘xt
 = 
	`Cuæ_MD5_öô
(
Cuæ_DIGEST_MD5
);

459 if(!
˘xt
)

460  
CURLE_OUT_OF_MEMORY
;

462 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
u£Ω
,

463 
	`cuæx_uztoui
(
	`°æí
(
u£Ω
)));

464 
	`Cuæ_MD5_upd©e
(
˘xt
, (const *) ":", 1);

465 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
ªÆm
,

466 
	`cuæx_uztoui
(
	`°æí
(
ªÆm
)));

467 
	`Cuæ_MD5_upd©e
(
˘xt
, (const *) ":", 1);

468 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
∑sswdp
,

469 
	`cuæx_uztoui
(
	`°æí
(
∑sswdp
)));

470 
	`Cuæ_MD5_föÆ
(
˘xt
, 
dige°
);

472 
˘xt
 = 
	`Cuæ_MD5_öô
(
Cuæ_DIGEST_MD5
);

473 if(!
˘xt
)

474  
CURLE_OUT_OF_MEMORY
;

476 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
dige°
, 
MD5_DIGEST_LEN
);

477 
	`Cuæ_MD5_upd©e
(
˘xt
, (const *) ":", 1);

478 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
n⁄˚
,

479 
	`cuæx_uztoui
(
	`°æí
(
n⁄˚
)));

480 
	`Cuæ_MD5_upd©e
(
˘xt
, (const *) ":", 1);

481 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
˙⁄˚
,

482 
	`cuæx_uztoui
(
	`°æí
(
˙⁄˚
)));

483 
	`Cuæ_MD5_föÆ
(
˘xt
, 
dige°
);

486 
i
 = 0; i < 
MD5_DIGEST_LEN
; i++)

487 
	`¢¥ötf
(&
HA1_hex
[2 * 
i
], 3, "%02x", 
dige°
[i]);

490 
	`¢¥ötf
(
uri
, (uri), "%s/%s", 
£rvi˚
, 
ªÆm
);

493 
˘xt
 = 
	`Cuæ_MD5_öô
(
Cuæ_DIGEST_MD5
);

494 if(!
˘xt
)

495  
CURLE_OUT_OF_MEMORY
;

497 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
mëhod
,

498 
	`cuæx_uztoui
(
	`°æí
(
mëhod
)));

499 
	`Cuæ_MD5_upd©e
(
˘xt
, (const *) ":", 1);

500 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
uri
,

501 
	`cuæx_uztoui
(
	`°æí
(
uri
)));

502 
	`Cuæ_MD5_föÆ
(
˘xt
, 
dige°
);

504 
i
 = 0; i < 
MD5_DIGEST_LEN
; i++)

505 
	`¢¥ötf
(&
HA2_hex
[2 * 
i
], 3, "%02x", 
dige°
[i]);

508 
˘xt
 = 
	`Cuæ_MD5_öô
(
Cuæ_DIGEST_MD5
);

509 if(!
˘xt
)

510  
CURLE_OUT_OF_MEMORY
;

512 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
HA1_hex
, 2 * 
MD5_DIGEST_LEN
);

513 
	`Cuæ_MD5_upd©e
(
˘xt
, (const *) ":", 1);

514 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
n⁄˚
,

515 
	`cuæx_uztoui
(
	`°æí
(
n⁄˚
)));

516 
	`Cuæ_MD5_upd©e
(
˘xt
, (const *) ":", 1);

518 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
n⁄˚Cou¡
,

519 
	`cuæx_uztoui
(
	`°æí
(
n⁄˚Cou¡
)));

520 
	`Cuæ_MD5_upd©e
(
˘xt
, (const *) ":", 1);

521 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
˙⁄˚
,

522 
	`cuæx_uztoui
(
	`°æí
(
˙⁄˚
)));

523 
	`Cuæ_MD5_upd©e
(
˘xt
, (const *) ":", 1);

524 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
q›
,

525 
	`cuæx_uztoui
(
	`°æí
(
q›
)));

526 
	`Cuæ_MD5_upd©e
(
˘xt
, (const *) ":", 1);

528 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
HA2_hex
, 2 * 
MD5_DIGEST_LEN
);

529 
	`Cuæ_MD5_föÆ
(
˘xt
, 
dige°
);

531 
i
 = 0; i < 
MD5_DIGEST_LEN
; i++)

532 
	`¢¥ötf
(&
ª•_hash_hex
[2 * 
i
], 3, "%02x", 
dige°
[i]);

535 
ª•⁄£
 = 
	`≠rötf
("username=\"%s\",realm=\"%s\",nonce=\"%s\","

538 
u£Ω
, 
ªÆm
, 
n⁄˚
,

539 
˙⁄˚
, 
n⁄˚Cou¡
, 
uri
, 
ª•_hash_hex
, 
q›
);

540 if(!
ª•⁄£
)

541  
CURLE_OUT_OF_MEMORY
;

544 
ªsu…
 = 
	`Cuæ_ba£64_ícode
(
d©a
, 
ª•⁄£
, 0, 
ouçå
, 
ouéí
);

546 
	`‰ì
(
ª•⁄£
);

547  
ªsu…
;

548 
	}
}

553 #ifde‡
USE_NTLM


574 
CURLcode
 
	$Cuæ_ß¶_¸óã_¡lm_ty≥1_mesßge
(c⁄° *
u£Ω
,

575 c⁄° *
∑sswdp
,

576 
¡lmd©a
 *
¡lm
,

577 **
ouçå
, 
size_t
 *
ouéí
)

579  
	`Cuæ_¡lm_¸óã_ty≥1_mesßge
(
u£Ω
, 
∑sswdp
, 
¡lm
, 
ouçå
, 
ouéí
);

580 
	}
}

595 
CURLcode
 
	$Cuæ_ß¶_decode_¡lm_ty≥2_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

596 c⁄° *
ty≥2msg
,

597 
¡lmd©a
 *
¡lm
)

599 #ifde‡
USE_NSS


600 
CURLcode
 
ªsu…
;

603 
ªsu…
 = 
	`Cuæ_nss_f‹˚_öô
(
d©a
);

604 if(
ªsu…
)

605  
ªsu…
;

608  
	`Cuæ_¡lm_decode_ty≥2_mesßge
(
d©a
, 
ty≥2msg
, 
¡lm
);

609 
	}
}

629 
CURLcode
 
	$Cuæ_ß¶_¸óã_¡lm_ty≥3_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

630 c⁄° *
u£Ω
,

631 c⁄° *
∑sswdp
,

632 
¡lmd©a
 *
¡lm
,

633 **
ouçå
, 
size_t
 *
ouéí
)

635  
	`Cuæ_¡lm_¸óã_ty≥3_mesßge
(
d©a
, 
u£Ω
, 
∑sswdp
, 
¡lm
, 
ouçå
,

636 
ouéí
);

637 
	}
}

657 
CURLcode
 
	$Cuæ_ß¶_¸óã_xﬂuth2_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

658 c⁄° *
u£r
,

659 c⁄° *
bóªr
,

660 **
ouçå
, 
size_t
 *
ouéí
)

662 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

663 *
xﬂuth
 = 
NULL
;

666 
xﬂuth
 = 
	`≠rötf
("u£r=%s\1auth=Bóª∏%s\1\1", 
u£r
, 
bóªr
);

667 if(!
xﬂuth
)

668  
CURLE_OUT_OF_MEMORY
;

671 
ªsu…
 = 
	`Cuæ_ba£64_ícode
(
d©a
, 
xﬂuth
, 
	`°æí
(xﬂuth), 
ouçå
, 
ouéí
);

673 
	`Cuæ_ß„‰ì
(
xﬂuth
);

675  
ªsu…
;

676 
	}
}

689 
	$Cuæ_ß¶_˛ónup
(
c⁄√˘d©a
 *
c⁄n
, 
authu£d
)

691 #ifde‡
USE_NTLM


693 if(
authu£d
 =
SASL_MECH_NTLM
) {

694 
	`Cuæ_¡lm_s•i_˛ónup
(&
c⁄n
->
¡lm
);

696 ()
c⁄n
;

699 ()
c⁄n
;

700 ()
authu£d
;

702 
	}
}

	@lib/curl_sasl.h

1 #i‚de‡
HEADER_CURL_SASL_H


2 
	#HEADER_CURL_SASL_H


	)

25 
	~<cuæ/cuæ.h
>

27 
	gSessi⁄H™dÀ
;

28 
	gc⁄√˘d©a
;

29 
	g¡lmd©a
;

32 
	#SASL_AUTH_NONE
 0

	)

33 
	#SASL_AUTH_ANY
 ~0U

	)

36 
	#SASL_MECH_LOGIN
 (1 << 0)

	)

37 
	#SASL_MECH_PLAIN
 (1 << 1)

	)

38 
	#SASL_MECH_CRAM_MD5
 (1 << 2)

	)

39 
	#SASL_MECH_DIGEST_MD5
 (1 << 3)

	)

40 
	#SASL_MECH_GSSAPI
 (1 << 4)

	)

41 
	#SASL_MECH_EXTERNAL
 (1 << 5)

	)

42 
	#SASL_MECH_NTLM
 (1 << 6)

	)

43 
	#SASL_MECH_XOAUTH2
 (1 << 7)

	)

46 
	#SASL_MECH_STRING_LOGIN
 "LOGIN"

	)

47 
	#SASL_MECH_STRING_PLAIN
 "PLAIN"

	)

48 
	#SASL_MECH_STRING_CRAM_MD5
 "CRAM-MD5"

	)

49 
	#SASL_MECH_STRING_DIGEST_MD5
 "DIGEST-MD5"

	)

50 
	#SASL_MECH_STRING_GSSAPI
 "GSSAPI"

	)

51 
	#SASL_MECH_STRING_EXTERNAL
 "EXTERNAL"

	)

52 
	#SASL_MECH_STRING_NTLM
 "NTLM"

	)

53 
	#SASL_MECH_STRING_XOAUTH2
 "XOAUTH2"

	)

56 
	#ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
mech
) \

57 (
w‹dÀn
 =((
mech
) - 1) / () && \

58 !
	`memcmp
(
löe
, 
mech
, 
w‹dÀn
))

	)

61 
CURLcode
 
Cuæ_ß¶_¸óã_∂aö_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

62 c⁄° *
u£Ω
,

63 c⁄° *
∑sswdp
,

64 **
ouçå
, 
size_t
 *
ouéí
);

68 
CURLcode
 
Cuæ_ß¶_¸óã_logö_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

69 c⁄° *
vÆuï
, **
ouçå
,

70 
size_t
 *
ouéí
);

72 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


74 
CURLcode
 
Cuæ_ß¶_decode_¸am_md5_mesßge
(c⁄° *
chlg64
, **
ouçå
,

75 
size_t
 *
ouéí
);

78 
CURLcode
 
Cuæ_ß¶_¸óã_¸am_md5_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

79 c⁄° *
chlg
,

80 c⁄° *
u£r
,

81 c⁄° *
∑sswdp
,

82 **
ouçå
, 
size_t
 *
ouéí
);

85 
CURLcode
 
Cuæ_ß¶_¸óã_dige°_md5_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

86 c⁄° *
chlg64
,

87 c⁄° *
u£Ω
,

88 c⁄° *
∑sswdp
,

89 c⁄° *
£rvi˚
,

90 **
ouçå
, 
size_t
 *
ouéí
);

93 #ifde‡
USE_NTLM


95 
CURLcode
 
Cuæ_ß¶_¸óã_¡lm_ty≥1_mesßge
(c⁄° *
u£Ω
,

96 c⁄° *
∑sswdp
,

97 
¡lmd©a
 *
¡lm
,

98 **
ouçå
,

99 
size_t
 *
ouéí
);

102 
CURLcode
 
Cuæ_ß¶_decode_¡lm_ty≥2_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

103 c⁄° *
ty≥2msg
,

104 
¡lmd©a
 *
¡lm
);

107 
CURLcode
 
Cuæ_ß¶_¸óã_¡lm_ty≥3_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

108 c⁄° *
u£Ω
,

109 c⁄° *
∑sswdp
,

110 
¡lmd©a
 *
¡lm
,

111 **
ouçå
, 
size_t
 *
ouéí
);

117 
CURLcode
 
Cuæ_ß¶_¸óã_xﬂuth2_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

118 c⁄° *
u£r
,

119 c⁄° *
bóªr
,

120 **
ouçå
, 
size_t
 *
ouéí
);

124 
Cuæ_ß¶_˛ónup
(
c⁄√˘d©a
 *
c⁄n
, 
authu£d
);

	@lib/curl_sasl_sspi.c

26 
	~"cuæ_£tup.h
"

28 #i‡
deföed
(
USE_WINDOWS_SSPI
Ë&& !deföed(
CURL_DISABLE_CRYPTO_AUTH
)

30 
	~<cuæ/cuæ.h
>

32 
	~"cuæ_ß¶.h
"

33 
	~"uæd©a.h
"

34 
	~"cuæ_ba£64.h
"

35 
	~"w¨∆ess.h
"

36 
	~"cuæ_mem‹y.h
"

38 
	#_MPRINTF_REPLACE


	)

39 
	~<cuæ/m¥ötf.h
>

42 
	~"memdebug.h
"

63 
CURLcode
 
	$Cuæ_ß¶_¸óã_dige°_md5_mesßge
(
Sessi⁄H™dÀ
 *
d©a
,

64 c⁄° *
chlg64
,

65 c⁄° *
u£Ω
,

66 c⁄° *
∑sswdp
,

67 c⁄° *
£rvi˚
,

68 **
ouçå
, 
size_t
 *
ouéí
)

70 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

71 *
•n
 = 
NULL
;

72 
size_t
 
chlgÀn
 = 0;

73 *
chlg
 = 
NULL
;

74 
ª•
[1024];

75 
CªdH™dÀ
 
h™dÀ
;

76 
CtxtH™dÀ
 
˘x
;

77 
PSecPkgInfo
 
SecurôyPackage
;

78 
SEC_WINNT_AUTH_IDENTITY
 
idítôy
;

79 
SecBuf„r
 
chlg_buf
;

80 
SecBuf„r
 
ª•_buf
;

81 
SecBuf„rDesc
 
chlg_desc
;

82 
SecBuf„rDesc
 
ª•_desc
;

83 
SECURITY_STATUS
 
°©us
;

84 
©ås
;

85 
TimeSèmp
 
tsDummy
;

88 if(
	`°æí
(
chlg64
) && *chlg64 != '=') {

89 
ªsu…
 = 
	`Cuæ_ba£64_decode
(
chlg64
, &
chlg
, &
chlgÀn
);

90 if(
ªsu…
)

91  
ªsu…
;

95 if(!
chlg
)

96  
CURLE_BAD_CONTENT_ENCODING
;

100 if(!
u£Ω
 || !*userp) {

101 
	`Cuæ_ß„‰ì
(
chlg
);

102  
CURLE_LOGIN_DENIED
;

106 
°©us
 = 
s_pSecFn
->
	`QuîySecurôyPackageInfo
((
TCHAR
 *Ë
	`TEXT
("WDigest"),

107 &
SecurôyPackage
);

108 if(
°©us
 !
SEC_E_OK
) {

109 
	`Cuæ_ß„‰ì
(
chlg
);

110  
CURLE_NOT_BUILT_IN
;

114 
•n
 = 
	`≠rötf
("%s/%s", 
£rvi˚
, 
d©a
->
ósy_c⁄n
->
ho°
.
«me
);

115 if(!
•n
)

116  
CURLE_OUT_OF_MEMORY
;

119 
ªsu…
 = 
	`Cuæ_¸óã_s•i_idítôy
(
u£Ω
, 
∑sswdp
, &
idítôy
);

120 if(
ªsu…
) {

121 
	`Cuæ_ß„‰ì
(
•n
);

122 
	`Cuæ_ß„‰ì
(
chlg
);

124  
ªsu…
;

128 
°©us
 = 
s_pSecFn
->
	`AcquúeCªdítülsH™dÀ
(
NULL
,

129 (
TCHAR
 *Ë
	`TEXT
("WDigest"),

130 
SECPKG_CRED_OUTBOUND
, 
NULL
,

131 &
idítôy
, 
NULL
, NULL,

132 &
h™dÀ
, &
tsDummy
);

134 if(
°©us
 !
SEC_E_OK
) {

135 
	`Cuæ_s•i_‰ì_idítôy
(&
idítôy
);

136 
	`Cuæ_ß„‰ì
(
•n
);

137 
	`Cuæ_ß„‰ì
(
chlg
);

139  
CURLE_OUT_OF_MEMORY
;

143 
chlg_desc
.
ulVîsi⁄
 = 
SECBUFFER_VERSION
;

144 
chlg_desc
.
cBuf„rs
 = 1;

145 
chlg_desc
.
pBuf„rs
 = &
chlg_buf
;

146 
chlg_buf
.
Buf„rTy≥
 = 
SECBUFFER_TOKEN
;

147 
chlg_buf
.
pvBuf„r
 = 
chlg
;

148 
chlg_buf
.
cbBuf„r
 = 
	`cuæx_uztoul
(
chlgÀn
);

151 
ª•_desc
.
ulVîsi⁄
 = 
SECBUFFER_VERSION
;

152 
ª•_desc
.
cBuf„rs
 = 1;

153 
ª•_desc
.
pBuf„rs
 = &
ª•_buf
;

154 
ª•_buf
.
Buf„rTy≥
 = 
SECBUFFER_TOKEN
;

155 
ª•_buf
.
pvBuf„r
 = 
ª•
;

156 
ª•_buf
.
cbBuf„r
 = (
ª•
);

159 
°©us
 = 
s_pSecFn
->
	`InôülizeSecurôyC⁄ãxt
(&
h™dÀ
,

160 
NULL
,

161 (
TCHAR
 *Ë
•n
,

163 &
chlg_desc
,

164 0, &
˘x
,

165 &
ª•_desc
,

166 &
©ås
, &
tsDummy
);

168 if(
°©us
 =
SEC_I_COMPLETE_AND_CONTINUE
 ||

169 
°©us
 =
SEC_I_CONTINUE_NEEDED
)

170 
s_pSecFn
->
	`Com∂ëeAuthTokí
(&
h™dÀ
, &
ª•_desc
);

171 if(
°©us
 !
SEC_E_OK
) {

172 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
h™dÀ
);

173 
	`Cuæ_s•i_‰ì_idítôy
(&
idítôy
);

174 
	`Cuæ_ß„‰ì
(
•n
);

175 
	`Cuæ_ß„‰ì
(
chlg
);

177  
CURLE_RECV_ERROR
;

181 
ªsu…
 = 
	`Cuæ_ba£64_ícode
(
d©a
, (*)
ª•
, 
ª•_buf
.
cbBuf„r
, 
ouçå
,

182 
ouéí
);

185 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
˘x
);

186 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
h™dÀ
);

189 
	`Cuæ_s•i_‰ì_idítôy
(&
idítôy
);

192 
	`Cuæ_ß„‰ì
(
•n
);

195 
	`Cuæ_ß„‰ì
(
chlg
);

197  
ªsu…
;

198 
	}
}

	@lib/curl_sec.h

1 #i‚de‡
HEADER_CURL_SECURITY_H


2 
	#HEADER_CURL_SECURITY_H


	)

25 
	sCuæ_£c_˛õ¡_mech
 {

26 c⁄° *
	m«me
;

27 
size_t
 
	msize
;

28 (*
	möô
)(*);

29 (*
	mauth
)(*, 
	mc⁄√˘d©a
 *);

30 (*
	míd
)(*);

31 (*
	mcheck_¥Ÿ
)(*, );

32 (*
	movîhód
)(*, , );

33 (*
	mícode
)(*, c⁄° *, , , **, 
	mc⁄√˘d©a
 *);

34 (*
	mdecode
)(*, *, , , 
	mc⁄√˘d©a
 *);

37 
	#AUTH_OK
 0

	)

38 
	#AUTH_CONTINUE
 1

	)

39 
	#AUTH_ERROR
 2

	)

41 #ifde‡
HAVE_GSSAPI


42 
Cuæ_£c_ªad_msg
 (
c⁄√˘d©a
 *
c⁄n
, *,

43 
¥Ÿe˘i⁄_Àvñ
);

44 
Cuæ_£c_íd
 (
c⁄√˘d©a
 *);

45 
CURLcode
 
Cuæ_£c_logö
 (
c⁄√˘d©a
 *);

46 
Cuæ_£c_ªque°_¥Ÿ
 (
c⁄√˘d©a
 *
c⁄n
, c⁄° *
Àvñ
);

48 
Cuæ_£c_˛õ¡_mech
 
Cuæ_krb5_˛õ¡_mech
;

	@lib/curl_setup.h

1 #i‚de‡
HEADER_CURL_SETUP_H


2 
	#HEADER_CURL_SETUP_H


	)

29 #i‡(
deföed
(
_WIN32
Ë|| deföed(
__WIN32__
)Ë&& !deföed(
WIN32
) && \

30 !
	$deföed
(
__SYMBIAN32__
)

31 
	#WIN32


	)

39 #ifde‡
HAVE_CONFIG_H


41 
	~"cuæ_c⁄fig.h
"

45 #ifde‡
_WIN32_WCE


46 
	~"c⁄fig-wö32˚.h
"

48 #ifde‡
WIN32


49 
	~"c⁄fig-wö32.h
"

53 #i‡
	`deföed
(
macötosh
Ë&& deföed(
__MRC__
)

54 
	~"c⁄fig-mac.h
"

57 #ifde‡
__riscos__


58 
	~"c⁄fig-riscos.h
"

61 #ifde‡
__AMIGA__


62 
	~"c⁄fig-amigaos.h
"

65 #ifde‡
__SYMBIAN32__


66 
	~"c⁄fig-symbün.h
"

69 #ifde‡
__OS400__


70 
	~"c⁄fig-os400.h
"

73 #ifde‡
TPF


74 
	~"c⁄fig-çf.h
"

77 #ifde‡
__VXWORKS__


78 
	~"c⁄fig-vxw‹ks.h
"

97 #ifde‡
NEED_THREAD_SAFE


98 #i‚de‡
_THREAD_SAFE


99 
	#_THREAD_SAFE


	)

109 #ifde‡
NEED_REENTRANT


110 #i‚de‡
_REENTRANT


111 
	#_REENTRANT


	)

116 #i‡
	`deföed
(
sun
Ë|| deföed(
__sun
)

117 #i‚de‡
_POSIX_PTHREAD_SEMANTICS


118 
	#_POSIX_PTHREAD_SEMANTICS
 1

	)

132 
	~<cuæ/cuæbuûd.h
>

138 
	~<cuæ/cuæruÀs.h
>

144 #ifde‡
SIZEOF_CURL_OFF_T


146 
Eº‹
 
Compû©i⁄_ab‹ãd_SIZEOF_CURL_OFF_T_shÆl_nŸ_be_deföed


153 #ifde‡
HTTP_ONLY


154 #i‚de‡
CURL_DISABLE_TFTP


155 
	#CURL_DISABLE_TFTP


	)

157 #i‚de‡
CURL_DISABLE_FTP


158 
	#CURL_DISABLE_FTP


	)

160 #i‚de‡
CURL_DISABLE_LDAP


161 
	#CURL_DISABLE_LDAP


	)

163 #i‚de‡
CURL_DISABLE_TELNET


164 
	#CURL_DISABLE_TELNET


	)

166 #i‚de‡
CURL_DISABLE_DICT


167 
	#CURL_DISABLE_DICT


	)

169 #i‚de‡
CURL_DISABLE_FILE


170 
	#CURL_DISABLE_FILE


	)

172 #i‚de‡
CURL_DISABLE_RTSP


173 
	#CURL_DISABLE_RTSP


	)

175 #i‚de‡
CURL_DISABLE_POP3


176 
	#CURL_DISABLE_POP3


	)

178 #i‚de‡
CURL_DISABLE_IMAP


179 
	#CURL_DISABLE_IMAP


	)

181 #i‚de‡
CURL_DISABLE_SMTP


182 
	#CURL_DISABLE_SMTP


	)

184 #i‚de‡
CURL_DISABLE_RTSP


185 
	#CURL_DISABLE_RTSP


	)

187 #i‚de‡
CURL_DISABLE_RTMP


188 
	#CURL_DISABLE_RTMP


	)

190 #i‚de‡
CURL_DISABLE_GOPHER


191 
	#CURL_DISABLE_GOPHER


	)

199 #i‡
	`deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_RTSP
)

200 
	#CURL_DISABLE_RTSP


	)

212 #ifde‡
__OS400__


213 
	~"£tup-os400.h
"

220 #ifde‡
__VMS


221 
	~"£tup-vms.h
"

235 #ifde‡
HAVE_WINDOWS_H


236 #i‡
	`deföed
(
UNICODE
Ë&& !deföed(
_UNICODE
)

237 
	#_UNICODE


	)

239 #i‡
	`deföed
(
_UNICODE
Ë&& !deföed(
UNICODE
)

240 
	#UNICODE


	)

242 #i‚de‡
WIN32_LEAN_AND_MEAN


243 
	#WIN32_LEAN_AND_MEAN


	)

245 
	~<wödows.h
>

246 #ifde‡
HAVE_WINSOCK2_H


247 
	~<wösock2.h
>

248 #ifde‡
HAVE_WS2TCPIP_H


249 
	~<ws2t˝ù.h
>

252 #ifde‡
HAVE_WINSOCK_H


253 
	~<wösock.h
>

256 
	~<tch¨.h
>

257 #ifde‡
UNICODE


258 
wch¨_t
 *(*
	tcuæ_wcsdup_ˇŒback
)(c⁄° 
	twch¨_t
 *
	t°r
);

268 #unde‡
USE_WINSOCK


270 #ifde‡
HAVE_WINSOCK2_H


271 
	#USE_WINSOCK
 2

	)

273 #ifde‡
HAVE_WINSOCK_H


274 
	#USE_WINSOCK
 1

	)

278 #ifde‡
USE_LWIPSOCK


279 
	~<lwù/öô.h
>

280 
	~<lwù/sockës.h
>

281 
	~<lwù/√tdb.h
>

284 #ifde‡
HAVE_EXTRA_STRICMP_H


285 
	~<exåa/°ricmp.h
>

288 #ifde‡
HAVE_EXTRA_STRDUP_H


289 
	~<exåa/°rdup.h
>

292 #ifde‡
TPF


293 
	~<°rögs.h
>

294 
	~<°rög.h
>

295 
	~<°dlib.h
>

296 
	~<sys/sockë.h
>

297 
	~<√tdb.h
>

298 
	~<çf/syßpi.h
>

300 
	#£À˘
(
a
,
b
,
c
,
d
,
e
Ë
	`çf_£À˘_libcuæ
◊,b,c,d,e)

	)

303 #ifde‡
__VXWORKS__


304 
	~<sockLib.h
>

305 
	~<ioLib.h
>

308 #ifde‡
__AMIGA__


309 #i‚de‡
__ixemul__


310 
	~<exec/ty≥s.h
>

311 
	~<exec/execba£.h
>

312 
	~<¥Ÿo/exec.h
>

313 
	~<¥Ÿo/dos.h
>

314 
	#£À˘
(
a
,
b
,
c
,
d
,
e
Ë
	`WaôSñe˘
◊,b,c,d,e,0)

	)

318 
	~<°dio.h
>

319 #ifde‡
HAVE_ASSERT_H


320 
	~<as£π.h
>

323 #ifde‡
__TANDEM


324 
	~<Êoss.h
>

327 #i‚de‡
STDC_HEADERS


328 
	~<cuæ/°dchódîs.h
>

331 #ifde‡
__POCC__


332 
	~<sys/ty≥s.h
>

333 
	~<uni°d.h
>

334 
	#sys_√º
 
EILSEQ


	)

340 #ifde‡
__SALFORDC__


341 #¥agm®
suµªss
 353

342 #¥agm®
suµªss
 593

343 #¥agm®
suµªss
 61

344 #¥agm®
suµªss
 106

345 
	~<˛ib.h
>

352 #ifde‡
USE_WIN32_LARGE_FILES


353 
	~<io.h
>

354 
	~<sys/ty≥s.h
>

355 
	~<sys/°©.h
>

356 #unde‡
l£ek


357 
	#l£ek
(
fdes
,
off£t
,
whí˚
Ë
	`_l£eki64
(fdes, off£t, whí˚)

	)

358 #unde‡
f°©


359 
	#f°©
(
fdes
,
°p
Ë
	`_f°©i64
(fdes, sç)

	)

360 #unde‡
°©


361 
	#°©
(
‚ame
,
°p
Ë
	`_°©i64
(‚ame, sç)

	)

362 
	#°ru˘_°©
 
_°©i64


	)

363 
	#LSEEK_ERROR
 (
__öt64
)-1

	)

370 #ifde‡
USE_WIN32_SMALL_FILES


371 
	~<io.h
>

372 
	~<sys/ty≥s.h
>

373 
	~<sys/°©.h
>

374 #i‚de‡
_WIN32_WCE


375 #unde‡
l£ek


376 
	#l£ek
(
fdes
,
off£t
,
whí˚
Ë
	`_l£ek
(fdes, ()off£t, whí˚)

	)

377 
	#f°©
(
fdes
,
°p
Ë
	`_f°©
(fdes, sç)

	)

378 
	#°©
(
‚ame
,
°p
Ë
	`_°©
(‚ame, sç)

	)

379 
	#°ru˘_°©
 
_°©


	)

381 
	#LSEEK_ERROR
 ()-1

	)

384 #i‚de‡
°ru˘_°©


385 
	#°ru˘_°©
 
°©


	)

388 #i‚de‡
LSEEK_ERROR


389 
	#LSEEK_ERROR
 (
off_t
)-1

	)

396 #i‚de‡
SIZEOF_OFF_T


397 #i‡
	`deföed
(
__VMS
Ë&& !deföed(
__VAX
)

398 #i‡
	`deföed
(
_LARGEFILE
)

399 
	#SIZEOF_OFF_T
 8

	)

401 #ñi‡
	`deföed
(
__OS400__
Ë&& deföed(
__ILEC400__
)

402 #i‡
	`deföed
(
_LARGE_FILES
)

403 
	#SIZEOF_OFF_T
 8

	)

405 #ñi‡
	`deföed
(
__MVS__
Ë&& deföed(
__IBMC__
)

406 #i‡
	`deföed
(
_LP64
Ë|| deföed(
_LARGE_FILES
)

407 
	#SIZEOF_OFF_T
 8

	)

409 #ñi‡
	`deföed
(
__370__
Ë&& deföed(
__IBMC__
)

410 #i‡
	`deföed
(
_LP64
Ë|| deföed(
_LARGE_FILES
)

411 
	#SIZEOF_OFF_T
 8

	)

414 #i‚de‡
SIZEOF_OFF_T


415 
	#SIZEOF_OFF_T
 4

	)

423 #i‚de‡
GETHOSTNAME_TYPE_ARG2


424 #ifde‡
USE_WINSOCK


425 
	#GETHOSTNAME_TYPE_ARG2
 

	)

427 
	#GETHOSTNAME_TYPE_ARG2
 
size_t


	)

437 #ifde‡
WIN32


439 
	#DIR_CHAR
 "\\"

	)

440 
	#DOT_CHAR
 "_"

	)

444 #ifde‡
MSDOS


446 
	~<sys/io˘l.h
>

447 
	#£À˘
(
n
,
r
,
w
,
x
,
t
Ë
	`£À˘_s
“,r,w,x,t)

	)

448 
	#io˘l
(
x
,
y
,
z
Ë
	`io˘lsockë
(x,y,(*)(z))

	)

449 
	~<t˝.h
>

450 #ifde‡
w‹d


451 #unde‡
w‹d


453 #ifde‡
byã


454 #unde‡
byã


459 #ifde‡
__möix


461 * 
	`°πok_r
(*
s
, c⁄° *
dñim
, **
œ°
);

462 
tm
 * 
	`gmtime_r
(c⁄° 
time_t
 * c⁄° 
timï
, tm *
tmp
);

465 
	#DIR_CHAR
 "/"

	)

466 #i‚de‡
DOT_CHAR


467 
	#DOT_CHAR
 "."

	)

470 #ifde‡
MSDOS


471 #unde‡
DOT_CHAR


472 
	#DOT_CHAR
 "_"

	)

475 #i‚de‡
fûío


476 
	`fûío
–
FILE
 *
°ªam
);

486 #i‡
	`deföed
(
_MSC_VER
Ë&& !deföed(
__POCC__
)

487 #i‡!
	`deföed
(
HAVE_WS2TCPIP_H
) || \

488 ((
_MSC_VER
 < 1300Ë&& !
	$deföed
(
INET6_ADDRSTRLEN
))

489 #unde‡
HAVE_GETADDRINFO_THREADSAFE


490 #unde‡
HAVE_FREEADDRINFO


491 #unde‡
HAVE_GETADDRINFO


492 #unde‡
HAVE_GETNAMEINFO


493 #unde‡
ENABLE_IPV6


506 #i‡
	`deföed
(
__LCC__
Ë&& deföed(
WIN32
)

507 #unde‡
USE_THREADS_POSIX


508 #unde‡
USE_THREADS_WIN32


516 #i‡
	`deföed
(
_MSC_VER
Ë&& !deföed(
__POCC__
Ë&& !deföed(
_MT
)

517 #unde‡
USE_THREADS_POSIX


518 #unde‡
USE_THREADS_WIN32


525 #ifde‡
USE_ARES


526 
	#CURLRES_ASYNCH


	)

527 
	#CURLRES_ARES


	)

529 #unde‡
HAVE_GETADDRINFO


530 #unde‡
HAVE_GETHOSTBYNAME


531 #ñi‡
	`deföed
(
USE_THREADS_POSIX
Ë|| deföed(
USE_THREADS_WIN32
)

532 
	#CURLRES_ASYNCH


	)

533 
	#CURLRES_THREADED


	)

535 
	#CURLRES_SYNCH


	)

538 #ifde‡
ENABLE_IPV6


539 
	#CURLRES_IPV6


	)

541 
	#CURLRES_IPV4


	)

550 #i‡
	`deföed
(
USE_WINSOCK
) && (USE_WINSOCK != 2)

551 
	#CURL_DISABLE_TELNET
 1

	)

560 #i‡
	`deföed
(
_MSC_VER
Ë&& !deföed(
__POCC__
)

561 #i‡!
	`deföed
(
HAVE_WINSOCK2_H
Ë|| ((
_MSC_VER
 < 1300Ë&& !deföed(
IPPROTO_ESP
))

562 #unde‡
HAVE_STRUCT_SOCKADDR_STORAGE


572 #i‡
	`deföed
(
_MSC_VER
Ë&& !deföed(
__POCC__
)

573 #i‡!
	`deföed
(
HAVE_WINDOWS_H
Ë|| ((
_MSC_VER
 < 1300Ë&& !deföed(
_FILETIME_
))

574 #i‡!
	`deföed
(
ALLOW_MSVC6_WITHOUT_PSDK
)

575 #îr‹ 
MSVC
 6.0 
ªquúes
 "Febru¨y 2003 Pœtf‹m SDK" 
a
.
k
.a. \

578 
	#CURL_DISABLE_LDAP
 1

	)

583 #ifde‡
NETWARE


584 
	`√tw¨e_öô
();

585 #i‚de‡
__NOVELL_LIBC__


586 
	~<sys/bsdskt.h
>

587 
	~<sys/timevÆ.h
>

591 #i‡
	`deföed
(
HAVE_LIBIDN
Ë&& deföed(
HAVE_TLD_H
)

594 
	#USE_LIBIDN


	)

597 #i‚de‡
SIZEOF_TIME_T


599 
	#SIZEOF_TIME_T
 4

	)

602 
	#LIBIDN_REQUIRED_VERSION
 "0.4.1"

	)

604 #i‡
	`deföed
(
USE_GNUTLS
Ë|| deföed(
USE_SSLEAY
Ë|| deföed(
USE_NSS
) || \

605 
	`deföed
(
USE_QSOSSL
Ë|| deföed(
USE_POLARSSL
Ë|| deföed(
USE_AXTLS
) || \

606 
	`deföed
(
USE_CYASSL
Ë|| deföed(
USE_SCHANNEL
) || \

607 
	`deföed
(
USE_DARWINSSL
Ë|| 
	$deföed
(
USE_GSKIT
)

608 
	#USE_SSL


	)

611 #i‡!
	`deföed
(
CURL_DISABLE_CRYPTO_AUTH
) && \

612 (
	`deföed
(
HAVE_GSSAPI
Ë|| 
	$deföed
(
USE_WINDOWS_SSPI
))

613 
	#USE_HTTP_NEGOTIATE


	)

617 #i‡!
	`deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_NTLM
) && \

618 !
	$deföed
(
CURL_DISABLE_CRYPTO_AUTH
)

619 #i‡
	`deföed
(
USE_SSLEAY
Ë|| deföed(
USE_WINDOWS_SSPI
) || \

620 
	`deföed
(
USE_GNUTLS
Ë|| deföed(
USE_NSS
Ë|| 
	$deföed
(
USE_DARWINSSL
)

621 
	#USE_NTLM


	)

626 #i‡
	`deföed
(
CURL_WANTS_CA_BUNDLE_ENV
Ë&& !deföed(
CURL_CA_BUNDLE
)

627 
	#CURL_CA_BUNDLE
 
	`gëív
("CURL_CA_BUNDLE")

	)

636 #i‡
	`deföed
(
__GNUC__
) && ((__GNUC__ >= 3) || \

637 ((
__GNUC__
 =2Ë&& 
	`deföed
(
__GNUC_MINOR__
) && (__GNUC_MINOR__ >= 7)))

638 
	#UNUSED_PARAM
 
	`__©åibuã__
((
__unu£d__
))

	)

640 
	#UNUSED_PARAM


	)

647 #i‚de‡
HEADER_CURL_SETUP_ONCE_H


648 
	~"cuæ_£tup_⁄˚.h
"

655 #i‚de‡
Cuæ_n›_°mt


656 
	#Cuæ_n›_°mt
 dÿ{ 
	}
} 
WHILE_FALSE


	)

663 #i‡
deföed
(
__LWIP_OPT_H__
)

664 #i‡
deföed
(
SOCKET
) || \

665 
deföed
(
USE_WINSOCK
) || \

666 
deföed
(
HAVE_WINSOCK_H
) || \

667 
deföed
(
HAVE_WINSOCK2_H
) || \

668 
	$deföed
(
HAVE_WS2TCPIP_H
)

677 #ifde‡
USE_WINSOCK


678 
	#SHUT_RD
 0x00

	)

679 
	#SHUT_WR
 0x01

	)

680 
	#SHUT_RDWR
 0x02

	)

684 #i‡!
	`deföed
(
S_ISREG
Ë&& deföed(
S_IFMT
Ë&& deföed(
S_IFREG
)

685 
	#S_ISREG
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFREG
)

	)

689 #i‡!
	`deföed
(
S_ISDIR
Ë&& deföed(
S_IFMT
Ë&& deföed(
S_IFDIR
)

690 
	#S_ISDIR
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFDIR
)

	)

	@lib/curl_setup_once.h

1 #i‚de‡
HEADER_CURL_SETUP_ONCE_H


2 
	#HEADER_CURL_SETUP_ONCE_H


	)

30 
	~<°dio.h
>

31 
	~<°dlib.h
>

32 
	~<°rög.h
>

33 
	~<°d¨g.h
>

34 
	~<˘y≥.h
>

36 #ifde‡
HAVE_ERRNO_H


37 
	~<î∫o.h
>

40 #ifde‡
HAVE_SYS_TYPES_H


41 
	~<sys/ty≥s.h
>

44 #ifde‡
NEED_MALLOC_H


45 
	~<mÆloc.h
>

48 #ifde‡
NEED_MEMORY_H


49 
	~<mem‹y.h
>

52 #ifde‡
HAVE_SYS_STAT_H


53 
	~<sys/°©.h
>

56 #ifde‡
HAVE_SYS_TIME_H


57 
	~<sys/time.h
>

58 #ifde‡
TIME_WITH_SYS_TIME


59 
	~<time.h
>

62 #ifde‡
HAVE_TIME_H


63 
	~<time.h
>

67 #ifde‡
WIN32


68 
	~<io.h
>

69 
	~<f˙é.h
>

72 #i‡
deföed
(
HAVE_STDBOOL_H
Ë&& deföed(
HAVE_BOOL_T
)

73 
	~<°dboﬁ.h
>

76 #ifde‡
HAVE_UNISTD_H


77 
	~<uni°d.h
>

80 #ifde‡
__hpux


81 #i‡!
deföed
(
_XOPEN_SOURCE_EXTENDED
Ë|| deföed(
_KERNEL
)

82 #ifde‡
_APP32_64BIT_OFF_T


83 
	#OLD_APP32_64BIT_OFF_T
 
_APP32_64BIT_OFF_T


	)

84 #unde‡
_APP32_64BIT_OFF_T


86 #unde‡
OLD_APP32_64BIT_OFF_T


91 #ifde‡
HAVE_SYS_SOCKET_H


92 
	~<sys/sockë.h
>

95 #ifde‡
__hpux


96 #i‡!
deföed
(
_XOPEN_SOURCE_EXTENDED
Ë|| deföed(
_KERNEL
)

97 #ifde‡
OLD_APP32_64BIT_OFF_T


98 
	#_APP32_64BIT_OFF_T
 
OLD_APP32_64BIT_OFF_T


	)

99 #unde‡
OLD_APP32_64BIT_OFF_T


109 #i‚de‡
HAVE_STRUCT_TIMEVAL


110 
	stimevÆ
 {

111 
	mtv_£c
;

112 
	mtv_u£c
;

122 #ifde‡
HAVE_MSG_NOSIGNAL


123 
	#SEND_4TH_ARG
 
MSG_NOSIGNAL


	)

125 
	#SEND_4TH_ARG
 0

	)

129 #i‡
deföed
(
__möix
)

131 
	#§ód
(
x
,
y
,
z
Ë(
ssize_t
)
	`ªad
((
RECV_TYPE_ARG1
)(x), \

132 (
RECV_TYPE_ARG2
)(
y
), \

133 (
RECV_TYPE_ARG3
)(
z
))

	)

135 #ñi‡
deföed
(
HAVE_RECV
)

158 #i‡!
deföed
(
RECV_TYPE_ARG1
) || \

159 !
deföed
(
RECV_TYPE_ARG2
) || \

160 !
deföed
(
RECV_TYPE_ARG3
) || \

161 !
deföed
(
RECV_TYPE_ARG4
) || \

162 !
	$deföed
(
RECV_TYPE_RETV
)

164 
Eº‹
 
Missög_deföôi⁄_of_ªtu∫_™d_¨gumíts_ty≥s_of_ªcv


167 
	#§ód
(
x
,
y
,
z
Ë(
ssize_t
)
	`ªcv
((
RECV_TYPE_ARG1
)(x), \

168 (
RECV_TYPE_ARG2
)(
y
), \

169 (
RECV_TYPE_ARG3
)(
z
), \

170 (
RECV_TYPE_ARG4
)(0))

	)

173 #i‚de‡
§ód


175 
Eº‹
 
Missög_deföôi⁄_of_ma¸o_§ód


181 #i‡
	`deföed
(
__möix
)

183 
	#swrôe
(
x
,
y
,
z
Ë(
ssize_t
)
	`wrôe
((
SEND_TYPE_ARG1
)(x), \

184 (
SEND_TYPE_ARG2
)(
y
), \

185 (
SEND_TYPE_ARG3
)(
z
))

	)

187 #ñi‡
	`deföed
(
HAVE_SEND
)

188 #i‡!
	`deföed
(
SEND_TYPE_ARG1
) || \

189 !
	`deföed
(
SEND_QUAL_ARG2
) || \

190 !
	`deföed
(
SEND_TYPE_ARG2
) || \

191 !
	`deföed
(
SEND_TYPE_ARG3
) || \

192 !
	`deföed
(
SEND_TYPE_ARG4
) || \

193 !
	$deföed
(
SEND_TYPE_RETV
)

195 
Eº‹
 
Missög_deföôi⁄_of_ªtu∫_™d_¨gumíts_ty≥s_of_£nd


198 
	#swrôe
(
x
,
y
,
z
Ë(
ssize_t
)
	`£nd
((
SEND_TYPE_ARG1
)(x), \

199 (
SEND_TYPE_ARG2
)(
y
), \

200 (
SEND_TYPE_ARG3
)(
z
), \

201 (
SEND_TYPE_ARG4
)(
SEND_4TH_ARG
))

	)

204 #i‚de‡
swrôe


206 
Eº‹
 
Missög_deföôi⁄_of_ma¸o_swrôe


213 #i‡
	`deföed
(
HAVE_RECVFROM
)

217 #i‡!
	`deföed
(
RECVFROM_TYPE_ARG1
) || \

218 !
	`deföed
(
RECVFROM_TYPE_ARG2
) || \

219 !
	`deföed
(
RECVFROM_TYPE_ARG3
) || \

220 !
	`deföed
(
RECVFROM_TYPE_ARG4
) || \

221 !
	`deföed
(
RECVFROM_TYPE_ARG5
) || \

222 !
	`deföed
(
RECVFROM_TYPE_ARG6
) || \

223 !
	$deföed
(
RECVFROM_TYPE_RETV
)

225 
Eº‹
 
Missög_deföôi⁄_of_ªtu∫_™d_¨gumíts_ty≥s_of_ªcv‰om


228 
	#§ód‰om
(
s
,
b
,
bl
,
f
,
Ê
Ë(
ssize_t
)
	`ªcv‰om
((
RECVFROM_TYPE_ARG1
) (s), \

229 (
RECVFROM_TYPE_ARG2
 *)(
b
), \

230 (
RECVFROM_TYPE_ARG3
Ë(
bl
), \

231 (
RECVFROM_TYPE_ARG4
) (0), \

232 (
RECVFROM_TYPE_ARG5
 *)(
f
), \

233 (
RECVFROM_TYPE_ARG6
 *)(
Ê
))

	)

236 #i‚de‡
§ód‰om


238 
Eº‹
 
Missög_deföôi⁄_of_ma¸o_§ód‰om


244 #ifde‡
RECVFROM_TYPE_ARG6_IS_VOID


245 
	#RECVFROM_ARG6_T
 

	)

247 
	#RECVFROM_ARG6_T
 
RECVFROM_TYPE_ARG6


	)

256 #i‡
	`deföed
(
HAVE_CLOSESOCKET
)

257 
	#s˛o£
(
x
Ë
	`˛o£sockë
((x))

	)

258 #ñi‡
	`deföed
(
HAVE_CLOSESOCKET_CAMEL
)

259 
	#s˛o£
(
x
Ë
	`Clo£Sockë
((x))

	)

260 #ñi‡
	`deföed
(
HAVE_CLOSE_S
)

261 
	#s˛o£
(
x
Ë
	`˛o£_s
((x))

	)

262 #ñi‡
	`deföed
(
USE_LWIPSOCK
)

263 
	#s˛o£
(
x
Ë
	`lwù_˛o£
((x))

	)

265 
	#s˛o£
(
x
Ë
	`˛o£
((x))

	)

271 #i‡
	`deföed
(
USE_LWIPSOCK
)

272 
	#sf˙é
 
lwù_f˙é


	)

274 
	#sf˙é
 
f˙é


	)

282 
	#ISSPACE
(
x
Ë(
	`is•a˚
((Ë(()x)))

	)

283 
	#ISDIGIT
(
x
Ë(
	`isdigô
((Ë(()x)))

	)

284 
	#ISALNUM
(
x
Ë(
	`iß um
((Ë(()x)))

	)

285 
	#ISXDIGIT
(
x
Ë(
	`isxdigô
((Ë(()x)))

	)

286 
	#ISGRAPH
(
x
Ë(
	`isgøph
((Ë(()x)))

	)

287 
	#ISALPHA
(
x
Ë(
	`ißÕha
((Ë(()x)))

	)

288 
	#ISPRINT
(
x
Ë(
	`i•röt
((Ë(()x)))

	)

289 
	#ISUPPER
(
x
Ë(
	`isuµî
((Ë(()x)))

	)

290 
	#ISLOWER
(
x
Ë(
	`i¶owî
((Ë(()x)))

	)

291 
	#ISASCII
(
x
Ë(
	`ißscii
((Ë(()x)))

	)

293 
	#ISBLANK
(
x
) ()(((()x) == ' ') || \

294 ((()
x
Ë='\t'))

	)

296 
	#TOLOWER
(
x
Ë(
	`tﬁowî
((Ë(()x)))

	)

303 #i‡
	`deföed
(
__hpux
Ë&& !deföed(
HAVE_BOOL_T
)

304 
	tboﬁ
;

305 
	#Ál£
 0

	)

306 
	#åue
 1

	)

307 
	#HAVE_BOOL_T


	)

318 #i‚de‡
HAVE_BOOL_T


320 
boﬁ_Ál£
 = 0,

321 
boﬁ_åue
 = 1

322 } 
	tboﬁ
;

330 
	#Ál£
 
boﬁ_Ál£


	)

331 
	#åue
 
boﬁ_åue


	)

332 
	#HAVE_BOOL_T


	)

343 #i‚de‡
TRUE


344 
	#TRUE
 
åue


	)

346 #i‚de‡
FALSE


347 
	#FALSE
 
Ál£


	)

356 
	#WHILE_FALSE
 0)

	)

358 #i‡
	`deföed
(
_MSC_VER
Ë&& !deföed(
__POCC__
)

359 #unde‡
WHILE_FALSE


360 #i‡(
_MSC_VER
 < 1500)

361 
	#WHILE_FALSE
 1, 0)

	)

363 
	#WHILE_FALSE
 \

364 
	`__¥agma
(
	`w¨nög
(
push
)) \

365 
	`__¥agma
(
	`w¨nög
(
dißbÀ
:4127)) \

367 
	`__¥agma
(
	`w¨nög
(
p›
))

	)

376 #i‚de‡
HAVE_SIG_ATOMIC_T


377 
	tsig_©omic_t
;

378 
	#HAVE_SIG_ATOMIC_T


	)

386 #ifde‡
HAVE_SIG_ATOMIC_T_VOLATILE


387 
	#SIG_ATOMIC_T
 
sig_©omic_t


	)

389 
	#SIG_ATOMIC_T
 vﬁ©ûê
sig_©omic_t


	)

397 #i‚de‡
RETSIGTYPE


398 
	#RETSIGTYPE
 

	)

406 #ifde‡
DEBUGBUILD


407 
	#DEBUGF
(
x
Ë
	)
x

409 
	#DEBUGF
(
x
Ëdÿ{ 
	}
} 
WHILE_FALSE


	)

417 #i‡
deföed
(
DEBUGBUILD
Ë&& deföed(
HAVE_ASSERT_H
)

418 
	#DEBUGASSERT
(
x
Ë
	`as£π
(x)

	)

420 
	#DEBUGASSERT
(
x
Ëdÿ{ } 
WHILE_FALSE


	)

429 #ifde‡
USE_WINSOCK


430 
	#SOCKERRNO
 (()
	`WSAGëLa°Eº‹
())

	)

431 
	#SET_SOCKERRNO
(
x
Ë(
	`WSASëLa°Eº‹
(()(x)))

	)

433 
	#SOCKERRNO
 (
î∫o
)

	)

434 
	#SET_SOCKERRNO
(
x
Ë(
î∫o
 = (x))

	)

443 #i‡
deföed
(
WIN32
Ë&& !deföed(
USE_LWIPSOCK
)

444 
	#ERRNO
 (()
	`GëLa°Eº‹
())

	)

445 
	#SET_ERRNO
(
x
Ë(
	`SëLa°Eº‹
((
DWORD
)(x)))

	)

447 
	#ERRNO
 (
î∫o
)

	)

448 
	#SET_ERRNO
(
x
Ë(
î∫o
 = (x))

	)

456 #ifde‡
USE_WINSOCK


457 #unde‡
EBADF


458 
	#EBADF
 
WSAEBADF


	)

459 #unde‡
EINTR


460 
	#EINTR
 
WSAEINTR


	)

461 #unde‡
EINVAL


462 
	#EINVAL
 
WSAEINVAL


	)

463 #unde‡
EWOULDBLOCK


464 
	#EWOULDBLOCK
 
WSAEWOULDBLOCK


	)

465 #unde‡
EINPROGRESS


466 
	#EINPROGRESS
 
WSAEINPROGRESS


	)

467 #unde‡
EALREADY


468 
	#EALREADY
 
WSAEALREADY


	)

469 #unde‡
ENOTSOCK


470 
	#ENOTSOCK
 
WSAENOTSOCK


	)

471 #unde‡
EDESTADDRREQ


472 
	#EDESTADDRREQ
 
WSAEDESTADDRREQ


	)

473 #unde‡
EMSGSIZE


474 
	#EMSGSIZE
 
WSAEMSGSIZE


	)

475 #unde‡
EPROTOTYPE


476 
	#EPROTOTYPE
 
WSAEPROTOTYPE


	)

477 #unde‡
ENOPROTOOPT


478 
	#ENOPROTOOPT
 
WSAENOPROTOOPT


	)

479 #unde‡
EPROTONOSUPPORT


480 
	#EPROTONOSUPPORT
 
WSAEPROTONOSUPPORT


	)

481 
	#ESOCKTNOSUPPORT
 
WSAESOCKTNOSUPPORT


	)

482 #unde‡
EOPNOTSUPP


483 
	#EOPNOTSUPP
 
WSAEOPNOTSUPP


	)

484 
	#EPFNOSUPPORT
 
WSAEPFNOSUPPORT


	)

485 #unde‡
EAFNOSUPPORT


486 
	#EAFNOSUPPORT
 
WSAEAFNOSUPPORT


	)

487 #unde‡
EADDRINUSE


488 
	#EADDRINUSE
 
WSAEADDRINUSE


	)

489 #unde‡
EADDRNOTAVAIL


490 
	#EADDRNOTAVAIL
 
WSAEADDRNOTAVAIL


	)

491 #unde‡
ENETDOWN


492 
	#ENETDOWN
 
WSAENETDOWN


	)

493 #unde‡
ENETUNREACH


494 
	#ENETUNREACH
 
WSAENETUNREACH


	)

495 #unde‡
ENETRESET


496 
	#ENETRESET
 
WSAENETRESET


	)

497 #unde‡
ECONNABORTED


498 
	#ECONNABORTED
 
WSAECONNABORTED


	)

499 #unde‡
ECONNRESET


500 
	#ECONNRESET
 
WSAECONNRESET


	)

501 #unde‡
ENOBUFS


502 
	#ENOBUFS
 
WSAENOBUFS


	)

503 #unde‡
EISCONN


504 
	#EISCONN
 
WSAEISCONN


	)

505 #unde‡
ENOTCONN


506 
	#ENOTCONN
 
WSAENOTCONN


	)

507 
	#ESHUTDOWN
 
WSAESHUTDOWN


	)

508 
	#ETOOMANYREFS
 
WSAETOOMANYREFS


	)

509 #unde‡
ETIMEDOUT


510 
	#ETIMEDOUT
 
WSAETIMEDOUT


	)

511 #unde‡
ECONNREFUSED


512 
	#ECONNREFUSED
 
WSAECONNREFUSED


	)

513 #unde‡
ELOOP


514 
	#ELOOP
 
WSAELOOP


	)

515 #i‚de‡
ENAMETOOLONG


516 
	#ENAMETOOLONG
 
WSAENAMETOOLONG


	)

518 
	#EHOSTDOWN
 
WSAEHOSTDOWN


	)

519 #unde‡
EHOSTUNREACH


520 
	#EHOSTUNREACH
 
WSAEHOSTUNREACH


	)

521 #i‚de‡
ENOTEMPTY


522 
	#ENOTEMPTY
 
WSAENOTEMPTY


	)

524 
	#EPROCLIM
 
WSAEPROCLIM


	)

525 
	#EUSERS
 
WSAEUSERS


	)

526 
	#EDQUOT
 
WSAEDQUOT


	)

527 
	#ESTALE
 
WSAESTALE


	)

528 
	#EREMOTE
 
WSAEREMOTE


	)

535 #ifde‡
__VMS


536 
	#¨gv_ôem_t
 
__ch¨_±r32


	)

538 
	#¨gv_ôem_t
 *

	)

547 
	#ZERO_NULL
 0

	)

	@lib/curl_sspi.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
USE_WINDOWS_SSPI


27 
	~<cuæ/cuæ.h
>

29 
	~"cuæ_s•i.h
"

31 
	#_MPRINTF_REPLACE


	)

32 
	~<cuæ/m¥ötf.h
>

34 
	~"cuæ_mem‹y.h
"

35 
	~"cuæ_mu…ibyã.h
"

36 
	~"w¨∆ess.h
"

39 
	~"memdebug.h
"

42 
	$PSecurôyFun˘i⁄TabÀ
 (
	tAPIENTRY
 *
	tINITSECURITYINTERFACE_FN
)(
	tVOID
);

45 #ifde‡
UNICODE


46 #ifde‡
_WIN32_WCE


47 
	#SECURITYENTRYPOINT
 
L
"InôSecurôyI¡îÁ˚W"

	)

49 
	#SECURITYENTRYPOINT
 "InôSecurôyI¡îÁ˚W"

	)

52 
	#SECURITYENTRYPOINT
 "InôSecurôyI¡îÁ˚A"

	)

56 
HMODULE
 
s_hSecDŒ
 = 
NULL
;

59 
PSecurôyFun˘i⁄TabÀ
 
s_pSecFn
 = 
NULL
;

72 
CURLcode
 
	$Cuæ_s•i_globÆ_öô
()

74 
boﬁ
 
£curôyDŒ
 = 
FALSE
;

75 
INITSECURITYINTERFACE_FN
 
pInôSecurôyI¡îÁ˚
;

78 if(!
s_hSecDŒ
) {

82 
DWORD
 
maj‹Vîsi⁄
 = 4;

83 
DWORD
 
∂©f‹mId
 = 
VER_PLATFORM_WIN32_NT
;

85 #i‡!
	`deföed
(
_WIN32_WINNT
Ë|| !deföed(
_WIN32_WINNT_WIN2K
) || \

86 (
_WIN32_WINNT
 < 
_WIN32_WINNT_WIN2K
)

87 
OSVERSIONINFO
 
osvî
;

89 
	`mem£t
(&
osvî
, 0, (osver));

90 
osvî
.
dwOSVîsi⁄InfoSize
 = (osver);

93 if(!
	`GëVîsi⁄Ex
(&
osvî
))

94  
CURLE_FAILED_INIT
;

97 if(
osvî
.
dwMaj‹Vîsi⁄
 =
maj‹Vîsi⁄
 &&

98 
osvî
.
dwPœtf‹mId
 =
∂©f‹mId
)

99 
£curôyDŒ
 = 
TRUE
;

101 
ULONGLONG
 
maj‹Vîsi⁄Mask
;

102 
ULONGLONG
 
∂©f‹mIdMask
;

103 
OSVERSIONINFOEX
 
osvî
;

105 
	`mem£t
(&
osvî
, 0, (osver));

106 
osvî
.
dwOSVîsi⁄InfoSize
 = (osver);

107 
osvî
.
dwMaj‹Vîsi⁄
 = 
maj‹Vîsi⁄
;

108 
osvî
.
dwPœtf‹mId
 = 
∂©f‹mId
;

109 
maj‹Vîsi⁄Mask
 = 
	`VîSëC⁄dôi⁄Mask
(0, 
VER_MAJORVERSION
, 
VER_EQUAL
);

110 
∂©f‹mIdMask
 = 
	`VîSëC⁄dôi⁄Mask
(0, 
VER_PLATFORMID
, 
VER_EQUAL
);

113 if(
	`VîifyVîsi⁄Info
(&
osvî
, 
VER_MAJORVERSION
, 
maj‹Vîsi⁄Mask
) &&

114 
	`VîifyVîsi⁄Info
(&
osvî
, 
VER_PLATFORMID
, 
∂©f‹mIdMask
))

115 
£curôyDŒ
 = 
TRUE
;

119 if(
£curôyDŒ
)

120 
s_hSecDŒ
 = 
	`LﬂdLibøry
(
	`TEXT
("security.dll"));

122 
s_hSecDŒ
 = 
	`LﬂdLibøry
(
	`TEXT
("secur32.dll"));

123 if(!
s_hSecDŒ
)

124  
CURLE_FAILED_INIT
;

127 
pInôSecurôyI¡îÁ˚
 = (
INITSECURITYINTERFACE_FN
)

128 
	`GëProcAddªss
(
s_hSecDŒ
, 
SECURITYENTRYPOINT
);

129 if(!
pInôSecurôyI¡îÁ˚
)

130  
CURLE_FAILED_INIT
;

133 
s_pSecFn
 = 
	`pInôSecurôyI¡îÁ˚
();

134 if(!
s_pSecFn
)

135  
CURLE_FAILED_INIT
;

138  
CURLE_OK
;

139 
	}
}

147 
	$Cuæ_s•i_globÆ_˛ónup
()

149 if(
s_hSecDŒ
) {

150 
	`FªeLibøry
(
s_hSecDŒ
);

151 
s_hSecDŒ
 = 
NULL
;

152 
s_pSecFn
 = 
NULL
;

154 
	}
}

170 
CURLcode
 
	$Cuæ_¸óã_s•i_idítôy
(c⁄° *
u£Ω
, c⁄° *
∑sswdp
,

171 
SEC_WINNT_AUTH_IDENTITY
 *
idítôy
)

173 
xch¨p_u
 
u£ønddomaö
;

174 
xch¨p_u
 
u£r
, 
dup_u£r
;

175 
xch¨p_u
 
domaö
, 
dup_domaö
;

176 
xch¨p_u
 
∑sswd
, 
dup_∑sswd
;

177 
size_t
 
domÀn
 = 0;

179 
domaö
.
c⁄°_tch¨_±r
 = 
	`TEXT
("");

182 
	`mem£t
(
idítôy
, 0, (*identity));

184 
u£ønddomaö
.
tch¨_±r
 = 
	`Cuæ_c⁄vît_UTF8_to_tch¨
((*)
u£Ω
);

185 if(!
u£ønddomaö
.
tch¨_±r
)

186  
CURLE_OUT_OF_MEMORY
;

188 
u£r
.
c⁄°_tch¨_±r
 = 
	`_tcschr
(
u£ønddomaö
.c⁄°_tch¨_±r, 
	`TEXT
('\\'));

189 if(!
u£r
.
c⁄°_tch¨_±r
)

190 
u£r
.
c⁄°_tch¨_±r
 = 
	`_tcschr
(
u£ønddomaö
.c⁄°_tch¨_±r, 
	`TEXT
('/'));

192 if(
u£r
.
tch¨_±r
) {

193 
domaö
.
tch¨_±r
 = 
u£ønddomaö
.tchar_ptr;

194 
domÀn
 = 
u£r
.
tch¨_±r
 - 
u£ønddomaö
.tchar_ptr;

195 
u£r
.
tch¨_±r
++;

198 
u£r
.
tch¨_±r
 = 
u£ønddomaö
.tchar_ptr;

199 
domaö
.
c⁄°_tch¨_±r
 = 
	`TEXT
("");

200 
domÀn
 = 0;

204 
dup_u£r
.
tch¨_±r
 = 
	`_tcsdup
(
u£r
.tchar_ptr);

205 if(!
dup_u£r
.
tch¨_±r
) {

206 
	`Cuæ_unicode‰ì
(
u£ønddomaö
.
tch¨_±r
);

207  
CURLE_OUT_OF_MEMORY
;

209 
idítôy
->
U£r
 = 
dup_u£r
.
tbyã_±r
;

210 
idítôy
->
U£rLígth
 = 
	`cuæx_uztoul
(
	`_tc¶í
(
dup_u£r
.
tch¨_±r
));

211 
dup_u£r
.
tch¨_±r
 = 
NULL
;

214 
dup_domaö
.
tch¨_±r
 = 
	`mÆloc
((
TCHAR
Ë* (
domÀn
 + 1));

215 if(!
dup_domaö
.
tch¨_±r
) {

216 
	`Cuæ_unicode‰ì
(
u£ønddomaö
.
tch¨_±r
);

217  
CURLE_OUT_OF_MEMORY
;

219 
	`_tc¢˝y
(
dup_domaö
.
tch¨_±r
, 
domaö
.tch¨_±r, 
domÀn
);

220 *(
dup_domaö
.
tch¨_±r
 + 
domÀn
Ë
	`TEXT
('\0');

221 
idítôy
->
Domaö
 = 
dup_domaö
.
tbyã_±r
;

222 
idítôy
->
DomaöLígth
 = 
	`cuæx_uztoul
(
domÀn
);

223 
dup_domaö
.
tch¨_±r
 = 
NULL
;

225 
	`Cuæ_unicode‰ì
(
u£ønddomaö
.
tch¨_±r
);

228 
∑sswd
.
tch¨_±r
 = 
	`Cuæ_c⁄vît_UTF8_to_tch¨
((*)
∑sswdp
);

229 if(!
∑sswd
.
tch¨_±r
)

230  
CURLE_OUT_OF_MEMORY
;

231 
dup_∑sswd
.
tch¨_±r
 = 
	`_tcsdup
(
∑sswd
.tchar_ptr);

232 if(!
dup_∑sswd
.
tch¨_±r
) {

233 
	`Cuæ_unicode‰ì
(
∑sswd
.
tch¨_±r
);

234  
CURLE_OUT_OF_MEMORY
;

236 
idítôy
->
Passw‹d
 = 
dup_∑sswd
.
tbyã_±r
;

237 
idítôy
->
Passw‹dLígth
 = 
	`cuæx_uztoul
(
	`_tc¶í
(
dup_∑sswd
.
tch¨_±r
));

238 
dup_∑sswd
.
tch¨_±r
 = 
NULL
;

240 
	`Cuæ_unicode‰ì
(
∑sswd
.
tch¨_±r
);

243 
idítôy
->
Fœgs
 = 
SECFLAG_WINNT_AUTH_IDENTITY
;

245  
CURLE_OK
;

246 
	}
}

248 
	$Cuæ_s•i_‰ì_idítôy
(
SEC_WINNT_AUTH_IDENTITY
 *
idítôy
)

250 if(
idítôy
) {

251 
	`Cuæ_ß„‰ì
(
idítôy
->
U£r
);

252 
	`Cuæ_ß„‰ì
(
idítôy
->
Passw‹d
);

253 
	`Cuæ_ß„‰ì
(
idítôy
->
Domaö
);

255 
	}
}

	@lib/curl_sspi.h

1 #i‚de‡
HEADER_CURL_SSPI_H


2 
	#HEADER_CURL_SSPI_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
USE_WINDOWS_SSPI


29 
	~<cuæ/cuæ.h
>

36 #unde‡
SECURITY_WIN32


37 #unde‡
SECURITY_KERNEL


38 
	#SECURITY_WIN32
 1

	)

39 
	~<£curôy.h
>

40 
	~<s•i.h
>

41 
	~<Ωc.h
>

43 
CURLcode
 
Cuæ_s•i_globÆ_öô
();

44 
Cuæ_s•i_globÆ_˛ónup
();

47 
CURLcode
 
Cuæ_¸óã_s•i_idítôy
(c⁄° *
u£Ω
, c⁄° *
∑sswdp
,

48 
SEC_WINNT_AUTH_IDENTITY
 *
idítôy
);

51 
Cuæ_s•i_‰ì_idítôy
(
SEC_WINNT_AUTH_IDENTITY
 *
idítôy
);

55 
HMODULE
 
s_hSecDŒ
;

56 
PSecurôyFun˘i⁄TabÀ
 
s_pSecFn
;

60 #i‚de‡
SEC_E_INSUFFICIENT_MEMORY


61 
	#SEC_E_INSUFFICIENT_MEMORY
 ((
HRESULT
)0x80090300L)

	)

63 #i‚de‡
SEC_E_INVALID_HANDLE


64 
	#SEC_E_INVALID_HANDLE
 ((
HRESULT
)0x80090301L)

	)

66 #i‚de‡
SEC_E_UNSUPPORTED_FUNCTION


67 
	#SEC_E_UNSUPPORTED_FUNCTION
 ((
HRESULT
)0x80090302L)

	)

69 #i‚de‡
SEC_E_TARGET_UNKNOWN


70 
	#SEC_E_TARGET_UNKNOWN
 ((
HRESULT
)0x80090303L)

	)

72 #i‚de‡
SEC_E_INTERNAL_ERROR


73 
	#SEC_E_INTERNAL_ERROR
 ((
HRESULT
)0x80090304L)

	)

75 #i‚de‡
SEC_E_SECPKG_NOT_FOUND


76 
	#SEC_E_SECPKG_NOT_FOUND
 ((
HRESULT
)0x80090305L)

	)

78 #i‚de‡
SEC_E_NOT_OWNER


79 
	#SEC_E_NOT_OWNER
 ((
HRESULT
)0x80090306L)

	)

81 #i‚de‡
SEC_E_CANNOT_INSTALL


82 
	#SEC_E_CANNOT_INSTALL
 ((
HRESULT
)0x80090307L)

	)

84 #i‚de‡
SEC_E_INVALID_TOKEN


85 
	#SEC_E_INVALID_TOKEN
 ((
HRESULT
)0x80090308L)

	)

87 #i‚de‡
SEC_E_CANNOT_PACK


88 
	#SEC_E_CANNOT_PACK
 ((
HRESULT
)0x80090309L)

	)

90 #i‚de‡
SEC_E_QOP_NOT_SUPPORTED


91 
	#SEC_E_QOP_NOT_SUPPORTED
 ((
HRESULT
)0x8009030AL)

	)

93 #i‚de‡
SEC_E_NO_IMPERSONATION


94 
	#SEC_E_NO_IMPERSONATION
 ((
HRESULT
)0x8009030BL)

	)

96 #i‚de‡
SEC_E_LOGON_DENIED


97 
	#SEC_E_LOGON_DENIED
 ((
HRESULT
)0x8009030CL)

	)

99 #i‚de‡
SEC_E_UNKNOWN_CREDENTIALS


100 
	#SEC_E_UNKNOWN_CREDENTIALS
 ((
HRESULT
)0x8009030DL)

	)

102 #i‚de‡
SEC_E_NO_CREDENTIALS


103 
	#SEC_E_NO_CREDENTIALS
 ((
HRESULT
)0x8009030EL)

	)

105 #i‚de‡
SEC_E_MESSAGE_ALTERED


106 
	#SEC_E_MESSAGE_ALTERED
 ((
HRESULT
)0x8009030FL)

	)

108 #i‚de‡
SEC_E_OUT_OF_SEQUENCE


109 
	#SEC_E_OUT_OF_SEQUENCE
 ((
HRESULT
)0x80090310L)

	)

111 #i‚de‡
SEC_E_NO_AUTHENTICATING_AUTHORITY


112 
	#SEC_E_NO_AUTHENTICATING_AUTHORITY
 ((
HRESULT
)0x80090311L)

	)

114 #i‚de‡
SEC_E_BAD_PKGID


115 
	#SEC_E_BAD_PKGID
 ((
HRESULT
)0x80090316L)

	)

117 #i‚de‡
SEC_E_CONTEXT_EXPIRED


118 
	#SEC_E_CONTEXT_EXPIRED
 ((
HRESULT
)0x80090317L)

	)

120 #i‚de‡
SEC_E_INCOMPLETE_MESSAGE


121 
	#SEC_E_INCOMPLETE_MESSAGE
 ((
HRESULT
)0x80090318L)

	)

123 #i‚de‡
SEC_E_INCOMPLETE_CREDENTIALS


124 
	#SEC_E_INCOMPLETE_CREDENTIALS
 ((
HRESULT
)0x80090320L)

	)

126 #i‚de‡
SEC_E_BUFFER_TOO_SMALL


127 
	#SEC_E_BUFFER_TOO_SMALL
 ((
HRESULT
)0x80090321L)

	)

129 #i‚de‡
SEC_E_WRONG_PRINCIPAL


130 
	#SEC_E_WRONG_PRINCIPAL
 ((
HRESULT
)0x80090322L)

	)

132 #i‚de‡
SEC_E_TIME_SKEW


133 
	#SEC_E_TIME_SKEW
 ((
HRESULT
)0x80090324L)

	)

135 #i‚de‡
SEC_E_UNTRUSTED_ROOT


136 
	#SEC_E_UNTRUSTED_ROOT
 ((
HRESULT
)0x80090325L)

	)

138 #i‚de‡
SEC_E_ILLEGAL_MESSAGE


139 
	#SEC_E_ILLEGAL_MESSAGE
 ((
HRESULT
)0x80090326L)

	)

141 #i‚de‡
SEC_E_CERT_UNKNOWN


142 
	#SEC_E_CERT_UNKNOWN
 ((
HRESULT
)0x80090327L)

	)

144 #i‚de‡
SEC_E_CERT_EXPIRED


145 
	#SEC_E_CERT_EXPIRED
 ((
HRESULT
)0x80090328L)

	)

147 #i‚de‡
SEC_E_ENCRYPT_FAILURE


148 
	#SEC_E_ENCRYPT_FAILURE
 ((
HRESULT
)0x80090329L)

	)

150 #i‚de‡
SEC_E_DECRYPT_FAILURE


151 
	#SEC_E_DECRYPT_FAILURE
 ((
HRESULT
)0x80090330L)

	)

153 #i‚de‡
SEC_E_ALGORITHM_MISMATCH


154 
	#SEC_E_ALGORITHM_MISMATCH
 ((
HRESULT
)0x80090331L)

	)

156 #i‚de‡
SEC_E_SECURITY_QOS_FAILED


157 
	#SEC_E_SECURITY_QOS_FAILED
 ((
HRESULT
)0x80090332L)

	)

159 #i‚de‡
SEC_E_UNFINISHED_CONTEXT_DELETED


160 
	#SEC_E_UNFINISHED_CONTEXT_DELETED
 ((
HRESULT
)0x80090333L)

	)

162 #i‚de‡
SEC_E_NO_TGT_REPLY


163 
	#SEC_E_NO_TGT_REPLY
 ((
HRESULT
)0x80090334L)

	)

165 #i‚de‡
SEC_E_NO_IP_ADDRESSES


166 
	#SEC_E_NO_IP_ADDRESSES
 ((
HRESULT
)0x80090335L)

	)

168 #i‚de‡
SEC_E_WRONG_CREDENTIAL_HANDLE


169 
	#SEC_E_WRONG_CREDENTIAL_HANDLE
 ((
HRESULT
)0x80090336L)

	)

171 #i‚de‡
SEC_E_CRYPTO_SYSTEM_INVALID


172 
	#SEC_E_CRYPTO_SYSTEM_INVALID
 ((
HRESULT
)0x80090337L)

	)

174 #i‚de‡
SEC_E_MAX_REFERRALS_EXCEEDED


175 
	#SEC_E_MAX_REFERRALS_EXCEEDED
 ((
HRESULT
)0x80090338L)

	)

177 #i‚de‡
SEC_E_MUST_BE_KDC


178 
	#SEC_E_MUST_BE_KDC
 ((
HRESULT
)0x80090339L)

	)

180 #i‚de‡
SEC_E_STRONG_CRYPTO_NOT_SUPPORTED


181 
	#SEC_E_STRONG_CRYPTO_NOT_SUPPORTED
 ((
HRESULT
)0x8009033AL)

	)

183 #i‚de‡
SEC_E_TOO_MANY_PRINCIPALS


184 
	#SEC_E_TOO_MANY_PRINCIPALS
 ((
HRESULT
)0x8009033BL)

	)

186 #i‚de‡
SEC_E_NO_PA_DATA


187 
	#SEC_E_NO_PA_DATA
 ((
HRESULT
)0x8009033CL)

	)

189 #i‚de‡
SEC_E_PKINIT_NAME_MISMATCH


190 
	#SEC_E_PKINIT_NAME_MISMATCH
 ((
HRESULT
)0x8009033DL)

	)

192 #i‚de‡
SEC_E_SMARTCARD_LOGON_REQUIRED


193 
	#SEC_E_SMARTCARD_LOGON_REQUIRED
 ((
HRESULT
)0x8009033EL)

	)

195 #i‚de‡
SEC_E_SHUTDOWN_IN_PROGRESS


196 
	#SEC_E_SHUTDOWN_IN_PROGRESS
 ((
HRESULT
)0x8009033FL)

	)

198 #i‚de‡
SEC_E_KDC_INVALID_REQUEST


199 
	#SEC_E_KDC_INVALID_REQUEST
 ((
HRESULT
)0x80090340L)

	)

201 #i‚de‡
SEC_E_KDC_UNABLE_TO_REFER


202 
	#SEC_E_KDC_UNABLE_TO_REFER
 ((
HRESULT
)0x80090341L)

	)

204 #i‚de‡
SEC_E_KDC_UNKNOWN_ETYPE


205 
	#SEC_E_KDC_UNKNOWN_ETYPE
 ((
HRESULT
)0x80090342L)

	)

207 #i‚de‡
SEC_E_UNSUPPORTED_PREAUTH


208 
	#SEC_E_UNSUPPORTED_PREAUTH
 ((
HRESULT
)0x80090343L)

	)

210 #i‚de‡
SEC_E_DELEGATION_REQUIRED


211 
	#SEC_E_DELEGATION_REQUIRED
 ((
HRESULT
)0x80090345L)

	)

213 #i‚de‡
SEC_E_BAD_BINDINGS


214 
	#SEC_E_BAD_BINDINGS
 ((
HRESULT
)0x80090346L)

	)

216 #i‚de‡
SEC_E_MULTIPLE_ACCOUNTS


217 
	#SEC_E_MULTIPLE_ACCOUNTS
 ((
HRESULT
)0x80090347L)

	)

219 #i‚de‡
SEC_E_NO_KERB_KEY


220 
	#SEC_E_NO_KERB_KEY
 ((
HRESULT
)0x80090348L)

	)

222 #i‚de‡
SEC_E_CERT_WRONG_USAGE


223 
	#SEC_E_CERT_WRONG_USAGE
 ((
HRESULT
)0x80090349L)

	)

225 #i‚de‡
SEC_E_DOWNGRADE_DETECTED


226 
	#SEC_E_DOWNGRADE_DETECTED
 ((
HRESULT
)0x80090350L)

	)

228 #i‚de‡
SEC_E_SMARTCARD_CERT_REVOKED


229 
	#SEC_E_SMARTCARD_CERT_REVOKED
 ((
HRESULT
)0x80090351L)

	)

231 #i‚de‡
SEC_E_ISSUING_CA_UNTRUSTED


232 
	#SEC_E_ISSUING_CA_UNTRUSTED
 ((
HRESULT
)0x80090352L)

	)

234 #i‚de‡
SEC_E_REVOCATION_OFFLINE_C


235 
	#SEC_E_REVOCATION_OFFLINE_C
 ((
HRESULT
)0x80090353L)

	)

237 #i‚de‡
SEC_E_PKINIT_CLIENT_FAILURE


238 
	#SEC_E_PKINIT_CLIENT_FAILURE
 ((
HRESULT
)0x80090354L)

	)

240 #i‚de‡
SEC_E_SMARTCARD_CERT_EXPIRED


241 
	#SEC_E_SMARTCARD_CERT_EXPIRED
 ((
HRESULT
)0x80090355L)

	)

243 #i‚de‡
SEC_E_NO_S4U_PROT_SUPPORT


244 
	#SEC_E_NO_S4U_PROT_SUPPORT
 ((
HRESULT
)0x80090356L)

	)

246 #i‚de‡
SEC_E_CROSSREALM_DELEGATION_FAILURE


247 
	#SEC_E_CROSSREALM_DELEGATION_FAILURE
 ((
HRESULT
)0x80090357L)

	)

249 #i‚de‡
SEC_E_REVOCATION_OFFLINE_KDC


250 
	#SEC_E_REVOCATION_OFFLINE_KDC
 ((
HRESULT
)0x80090358L)

	)

252 #i‚de‡
SEC_E_ISSUING_CA_UNTRUSTED_KDC


253 
	#SEC_E_ISSUING_CA_UNTRUSTED_KDC
 ((
HRESULT
)0x80090359L)

	)

255 #i‚de‡
SEC_E_KDC_CERT_EXPIRED


256 
	#SEC_E_KDC_CERT_EXPIRED
 ((
HRESULT
)0x8009035AL)

	)

258 #i‚de‡
SEC_E_KDC_CERT_REVOKED


259 
	#SEC_E_KDC_CERT_REVOKED
 ((
HRESULT
)0x8009035BL)

	)

261 #i‚de‡
SEC_E_INVALID_PARAMETER


262 
	#SEC_E_INVALID_PARAMETER
 ((
HRESULT
)0x8009035DL)

	)

264 #i‚de‡
SEC_E_DELEGATION_POLICY


265 
	#SEC_E_DELEGATION_POLICY
 ((
HRESULT
)0x8009035EL)

	)

267 #i‚de‡
SEC_E_POLICY_NLTM_ONLY


268 
	#SEC_E_POLICY_NLTM_ONLY
 ((
HRESULT
)0x8009035FL)

	)

271 #i‚de‡
SEC_I_CONTINUE_NEEDED


272 
	#SEC_I_CONTINUE_NEEDED
 ((
HRESULT
)0x00090312L)

	)

274 #i‚de‡
SEC_I_COMPLETE_NEEDED


275 
	#SEC_I_COMPLETE_NEEDED
 ((
HRESULT
)0x00090313L)

	)

277 #i‚de‡
SEC_I_COMPLETE_AND_CONTINUE


278 
	#SEC_I_COMPLETE_AND_CONTINUE
 ((
HRESULT
)0x00090314L)

	)

280 #i‚de‡
SEC_I_LOCAL_LOGON


281 
	#SEC_I_LOCAL_LOGON
 ((
HRESULT
)0x00090315L)

	)

283 #i‚de‡
SEC_I_CONTEXT_EXPIRED


284 
	#SEC_I_CONTEXT_EXPIRED
 ((
HRESULT
)0x00090317L)

	)

286 #i‚de‡
SEC_I_INCOMPLETE_CREDENTIALS


287 
	#SEC_I_INCOMPLETE_CREDENTIALS
 ((
HRESULT
)0x00090320L)

	)

289 #i‚de‡
SEC_I_RENEGOTIATE


290 
	#SEC_I_RENEGOTIATE
 ((
HRESULT
)0x00090321L)

	)

292 #i‚de‡
SEC_I_NO_LSA_CONTEXT


293 
	#SEC_I_NO_LSA_CONTEXT
 ((
HRESULT
)0x00090323L)

	)

295 #i‚de‡
SEC_I_SIGNATURE_NEEDED


296 
	#SEC_I_SIGNATURE_NEEDED
 ((
HRESULT
)0x0009035CL)

	)

299 #ifde‡
UNICODE


300 
	#SECFLAG_WINNT_AUTH_IDENTITY
 \

301 ()
SEC_WINNT_AUTH_IDENTITY_UNICODE


	)

303 
	#SECFLAG_WINNT_AUTH_IDENTITY
 \

304 ()
SEC_WINNT_AUTH_IDENTITY_ANSI


	)

	@lib/curl_threads.c

23 
	~"cuæ_£tup.h
"

25 #i‡
deföed
(
USE_THREADS_POSIX
)

26 #ifde‡
HAVE_PTHREAD_H


27 
	~<±hªad.h
>

29 #ñi‡
deföed
(
USE_THREADS_WIN32
)

30 #ifde‡
HAVE_PROCESS_H


31 
	~<¥o˚ss.h
>

35 
	~"cuæ_thªads.h
"

37 
	#_MPRINTF_REPLACE


	)

38 
	~<cuæ/m¥ötf.h
>

40 
	~"cuæ_mem‹y.h
"

42 
	~"memdebug.h
"

44 #i‡
deföed
(
USE_THREADS_POSIX
)

46 
	scuæ_a˘uÆ_ˇŒ
 {

47 (*
	mfunc
)(*);

48 *
	m¨g
;

51 *
	$cuæ_thªad_¸óã_thunk
(*
¨g
)

53 
cuæ_a˘uÆ_ˇŒ
 * 
ac
 = 
¨g
;

54 (*
func
)(*Ë
ac
->func;

55 *
ªÆ_¨g
 = 
ac
->
¨g
;

57 
	`‰ì
(
ac
);

59 (*
func
)(
ªÆ_¨g
);

62 
	}
}

64 
cuæ_thªad_t
 
Cuæ_thªad_¸óã
((*
func
Ë(*), *
¨g
)

66 
cuæ_thªad_t
 
t
 = 
	`mÆloc
((
±hªad_t
));

67 
cuæ_a˘uÆ_ˇŒ
 *
ac
 = 
	`mÆloc
((curl_actual_call));

68 if(!(
ac
 && 
t
))

69 
îr
;

71 
ac
->
func
 = func;

72 
ac
->
¨g
 =árg;

74 if(
	`±hªad_¸óã
(
t
, 
NULL
, 
cuæ_thªad_¸óã_thunk
, 
ac
) != 0)

75 
îr
;

77  
t
;

79 
îr
:

80 
	`Cuæ_ß„‰ì
(
t
);

81 
	`Cuæ_ß„‰ì
(
ac
);

82  
cuæ_thªad_t_nuŒ
;

83 
	}
}

85 
	$Cuæ_thªad_de°roy
(
cuæ_thªad_t
 
hnd
)

87 if(
hnd
 !
cuæ_thªad_t_nuŒ
) {

88 
	`±hªad_dëach
(*
hnd
);

89 
	`‰ì
(
hnd
);

91 
	}
}

93 
	$Cuæ_thªad_joö
(
cuæ_thªad_t
 *
hnd
)

95 
ªt
 = (
	`±hªad_joö
(**
hnd
, 
NULL
) == 0);

97 
	`‰ì
(*
hnd
);

98 *
hnd
 = 
cuæ_thªad_t_nuŒ
;

100  
ªt
;

101 
	}
}

103 #ñi‡
deföed
(
USE_THREADS_WIN32
)

105 
cuæ_thªad_t
 
Cuæ_thªad_¸óã
((
CURL_STDCALL
 *
func
) (*),

106 *
¨g
)

108 #ifde‡
_WIN32_WCE


109  
	`Cª©eThªad
(
NULL
, 0, 
func
, 
¨g
, 0, NULL);

111 
cuæ_thªad_t
 
t
;

112 
t
 = (
cuæ_thªad_t
)
	`_begöthªadex
(
NULL
, 0, 
func
, 
¨g
, 0, NULL);

113 if((
t
 =0Ë|| (à=(
cuæ_thªad_t
)-1L))

114  
cuæ_thªad_t_nuŒ
;

115  
t
;

117 
	}
}

119 
	$Cuæ_thªad_de°roy
(
cuæ_thªad_t
 
hnd
)

121 
	`Clo£H™dÀ
(
hnd
);

122 
	}
}

124 
	$Cuæ_thªad_joö
(
cuæ_thªad_t
 *
hnd
)

126 
ªt
 = (
	`WaôF‹SögÀObje˘
(*
hnd
, 
INFINITE
Ë=
WAIT_OBJECT_0
);

128 
	`Cuæ_thªad_de°roy
(*
hnd
);

130 *
hnd
 = 
cuæ_thªad_t_nuŒ
;

132  
ªt
;

133 
	}
}

	@lib/curl_threads.h

1 #i‚de‡
HEADER_CURL_THREADS_H


2 
	#HEADER_CURL_THREADS_H


	)

24 
	~"cuæ_£tup.h
"

26 #i‡
deföed
(
USE_THREADS_POSIX
)

27 
	#CURL_STDCALL


	)

28 
	#cuæ_muãx_t
 
±hªad_muãx_t


	)

29 
	#cuæ_thªad_t
 
±hªad_t
 *

	)

30 
	#cuæ_thªad_t_nuŒ
 (
±hªad_t
 *)0

	)

31 
	#Cuæ_muãx_öô
(
m
Ë
	`±hªad_muãx_öô
(m, 
NULL
)

	)

32 
	#Cuæ_muãx_acquúe
(
m
Ë
	`±hªad_muãx_lock
(m)

	)

33 
	#Cuæ_muãx_ªÀa£
(
m
Ë
	`±hªad_muãx_u∆ock
(m)

	)

34 
	#Cuæ_muãx_de°roy
(
m
Ë
	`±hªad_muãx_de°roy
(m)

	)

35 #ñi‡
deföed
(
USE_THREADS_WIN32
)

36 
	#CURL_STDCALL
 
__°dˇŒ


	)

37 
	#cuæ_muãx_t
 
CRITICAL_SECTION


	)

38 
	#cuæ_thªad_t
 
HANDLE


	)

39 
	#cuæ_thªad_t_nuŒ
 (
HANDLE
)0

	)

40 
	#Cuæ_muãx_öô
(
m
Ë
	`InôülizeCrôiˇlSe˘i⁄
(m)

	)

41 
	#Cuæ_muãx_acquúe
(
m
Ë
	`E¡îCrôiˇlSe˘i⁄
(m)

	)

42 
	#Cuæ_muãx_ªÀa£
(
m
Ë
	`LóveCrôiˇlSe˘i⁄
(m)

	)

43 
	#Cuæ_muãx_de°roy
(
m
Ë
	`DñëeCrôiˇlSe˘i⁄
(m)

	)

46 #i‡
deföed
(
USE_THREADS_POSIX
Ë|| deföed(
USE_THREADS_WIN32
)

48 
cuæ_thªad_t
 
Cuæ_thªad_¸óã
((
CURL_STDCALL
 *
func
) (*),

49 *
¨g
);

51 
	`Cuæ_thªad_de°roy
(
cuæ_thªad_t
 
hnd
);

53 
	`Cuæ_thªad_joö
(
cuæ_thªad_t
 *
hnd
);

	@lib/curlx.h

1 #i‚de‡
HEADER_CURL_CURLX_H


2 
	#HEADER_CURL_CURLX_H


	)

32 
	~<cuæ/m¥ötf.h
>

37 
	~"°ªquÆ.h
"

40 
	~"°πoof·.h
"

45 
	~"timevÆ.h
"

55 
	~"n⁄block.h
"

58 
	~"w¨∆ess.h
"

75 
	#cuæx_gëív
 
cuæ_gëív


	)

76 
	#cuæx_°ªquÆ
 
cuæ_°ªquÆ


	)

77 
	#cuæx_°∫equÆ
 
cuæ_°∫equÆ


	)

78 
	#cuæx_øw_equÆ
 
Cuæ_øw_equÆ


	)

79 
	#cuæx_mv¢¥ötf
 
cuæ_mv¢¥ötf


	)

80 
	#cuæx_m¢¥ötf
 
cuæ_m¢¥ötf


	)

81 
	#cuæx_m≠rötf
 
cuæ_m≠rötf


	)

82 
	#cuæx_mv≠rötf
 
cuæ_mv≠rötf


	)

83 
	#cuæx_m•rötf
 
cuæ_m•rötf


	)

84 
	#cuæx_m¥ötf
 
cuæ_m¥ötf


	)

85 
	#cuæx_mÂrötf
 
cuæ_mÂrötf


	)

86 
	#cuæx_mv•rötf
 
cuæ_mv•rötf


	)

87 
	#cuæx_mv¥ötf
 
cuæ_mv¥ötf


	)

88 
	#cuæx_mvÂrötf
 
cuæ_mvÂrötf


	)

90 #ifde‡
ENABLE_CURLX_PRINTF


95 #unde‡
¥ötf


96 #unde‡
Ârötf


97 #unde‡
•rötf


98 #unde‡
¢¥ötf


99 #unde‡
v¥ötf


100 #unde‡
vÂrötf


101 #unde‡
v•rötf


102 #unde‡
v¢¥ötf


103 #unde‡
≠rötf


104 #unde‡
v≠rötf


106 
	#¥ötf
 
cuæx_m¥ötf


	)

107 
	#Ârötf
 
cuæx_mÂrötf


	)

108 
	#•rötf
 
cuæx_m•rötf


	)

109 
	#¢¥ötf
 
cuæx_m¢¥ötf


	)

110 
	#v¥ötf
 
cuæx_mv¥ötf


	)

111 
	#vÂrötf
 
cuæx_mvÂrötf


	)

112 
	#v•rötf
 
cuæx_mv•rötf


	)

113 
	#v¢¥ötf
 
cuæx_mv¢¥ötf


	)

114 
	#≠rötf
 
cuæx_m≠rötf


	)

115 
	#v≠rötf
 
cuæx_mv≠rötf


	)

	@lib/dict.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_DICT


27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

30 #ifde‡
HAVE_NETDB_H


31 
	~<√tdb.h
>

33 #ifde‡
HAVE_ARPA_INET_H


34 
	~<¨∑/öë.h
>

36 #ifde‡
HAVE_NET_IF_H


37 
	~<√t/if.h
>

39 #ifde‡
HAVE_SYS_IOCTL_H


40 
	~<sys/io˘l.h
>

43 #ifde‡
HAVE_SYS_PARAM_H


44 
	~<sys/∑øm.h
>

47 #ifde‡
HAVE_SYS_SELECT_H


48 
	~<sys/£À˘.h
>

51 
	~"uæd©a.h
"

52 
	~<cuæ/cuæ.h
>

53 
	~"å™s„r.h
"

54 
	~"£ndf.h
"

56 
	~"¥ogªss.h
"

57 
	~"°ªquÆ.h
"

58 
	~"di˘.h
"

59 
	~"øw°r.h
"

61 
	#_MPRINTF_REPLACE


	)

62 
	~<cuæ/m¥ötf.h
>

64 
	~"cuæ_mem‹y.h
"

66 
	~"memdebug.h
"

72 
CURLcode
 
di˘_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

78 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_di˘
 = {

80 
ZERO_NULL
,

81 
di˘_do
,

82 
ZERO_NULL
,

83 
ZERO_NULL
,

84 
ZERO_NULL
,

85 
ZERO_NULL
,

86 
ZERO_NULL
,

87 
ZERO_NULL
,

88 
ZERO_NULL
,

89 
ZERO_NULL
,

90 
ZERO_NULL
,

91 
ZERO_NULL
,

92 
ZERO_NULL
,

93 
PORT_DICT
,

94 
CURLPROTO_DICT
,

95 
PROTOPT_NONE
 | 
PROTOPT_NOURLQUERY


98 *
	$u√sˇ≥_w‹d
(
Sessi⁄H™dÀ
 *
d©a
, c⁄° *
öputbuff
)

100 *
√wp
;

101 *
di˘p
;

102 *
±r
;

103 
Àn
;

104 
byã
;

105 
ﬁí
=0;

107 
√wp
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
, 
öputbuff
, 0, &
Àn
);

108 if(!
√wp
)

109  
NULL
;

111 
di˘p
 = 
	`mÆloc
(((
size_t
)
Àn
)*2 + 1);

112 if(
di˘p
) {

115 
±r
 = 
√wp
;

116 (
byã
 = *
±r
) != 0;

117 
±r
++) {

118 if((
byã
 <= 32) || (byte == 127) ||

119 (
byã
 == '\'') || (byte == '\"') || (byte == '\\')) {

120 
di˘p
[
ﬁí
++] = '\\';

122 
di˘p
[
ﬁí
++] = 
byã
;

124 
di˘p
[
ﬁí
]=0;

126 
	`‰ì
(
√wp
);

127  
di˘p
;

128 
	}
}

130 
CURLcode
 
	$di˘_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

132 *
w‹d
;

133 *
ew‹d
;

134 *
µ©h
;

135 *
d©aba£
 = 
NULL
;

136 *
°øãgy
 = 
NULL
;

137 *
¡hdef
 = 
NULL
;

139 
CURLcode
 
ªsu…
=
CURLE_OK
;

140 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

141 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
FIRSTSOCKET
];

143 *
∑th
 = 
d©a
->
°©e
.path;

144 
cuæ_off_t
 *
byãcou¡
 = &
d©a
->
ªq
.bytecount;

146 *
d⁄e
 = 
TRUE
;

148 if(
c⁄n
->
bôs
.
u£r_∑sswd
) {

152 if(
	`Cuæ_øw_√quÆ
(
∑th
, 
DICT_MATCH
, (DICT_MATCH)-1) ||

153 
	`Cuæ_øw_√quÆ
(
∑th
, 
DICT_MATCH2
, (DICT_MATCH2)-1) ||

154 
	`Cuæ_øw_√quÆ
(
∑th
, 
DICT_MATCH3
, (DICT_MATCH3)-1)) {

156 
w‹d
 = 
	`°rchr
(
∑th
, ':');

157 if(
w‹d
) {

158 
w‹d
++;

159 
d©aba£
 = 
	`°rchr
(
w‹d
, ':');

160 if(
d©aba£
) {

161 *
d©aba£
++ = ()0;

162 
°øãgy
 = 
	`°rchr
(
d©aba£
, ':');

163 if(
°øãgy
) {

164 *
°øãgy
++ = ()0;

165 
¡hdef
 = 
	`°rchr
(
°øãgy
, ':');

166 if(
¡hdef
) {

167 *
¡hdef
 = ()0;

173 if((
w‹d
 =
NULL
) || (*word == ()0)) {

174 
	`öfof
(
d©a
, "lookup word is missing\n");

175 
w‹d
=(*)"default";

177 if((
d©aba£
 =
NULL
) || (*database == ()0)) {

178 
d©aba£
 = (*)"!";

180 if((
°øãgy
 =
NULL
) || (*strategy == ()0)) {

181 
°øãgy
 = (*)".";

184 
ew‹d
 = 
	`u√sˇ≥_w‹d
(
d©a
, 
w‹d
);

185 if(!
ew‹d
)

186  
CURLE_OUT_OF_MEMORY
;

188 
ªsu…
 = 
	`Cuæ_£ndf
(
sockfd
, 
c⁄n
,

189 "CLIENT " 
LIBCURL_NAME
 " " 
LIBCURL_VERSION
 "\r\n"

196 
d©aba£
,

197 
°øãgy
,

198 
ew‹d


201 
	`‰ì
(
ew‹d
);

203 if(
ªsu…
) {

204 
	`Áûf
(
d©a
, "Failed sending DICTÑequest");

205  
ªsu…
;

207 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
FALSE
, 
byãcou¡
,

208 -1, 
NULL
);

210 if(
	`Cuæ_øw_√quÆ
(
∑th
, 
DICT_DEFINE
, (DICT_DEFINE)-1) ||

211 
	`Cuæ_øw_√quÆ
(
∑th
, 
DICT_DEFINE2
, (DICT_DEFINE2)-1) ||

212 
	`Cuæ_øw_√quÆ
(
∑th
, 
DICT_DEFINE3
, (DICT_DEFINE3)-1)) {

214 
w‹d
 = 
	`°rchr
(
∑th
, ':');

215 if(
w‹d
) {

216 
w‹d
++;

217 
d©aba£
 = 
	`°rchr
(
w‹d
, ':');

218 if(
d©aba£
) {

219 *
d©aba£
++ = ()0;

220 
¡hdef
 = 
	`°rchr
(
d©aba£
, ':');

221 if(
¡hdef
) {

222 *
¡hdef
 = ()0;

227 if((
w‹d
 =
NULL
) || (*word == ()0)) {

228 
	`öfof
(
d©a
, "lookup word is missing\n");

229 
w‹d
=(*)"default";

231 if((
d©aba£
 =
NULL
) || (*database == ()0)) {

232 
d©aba£
 = (*)"!";

235 
ew‹d
 = 
	`u√sˇ≥_w‹d
(
d©a
, 
w‹d
);

236 if(!
ew‹d
)

237  
CURLE_OUT_OF_MEMORY
;

239 
ªsu…
 = 
	`Cuæ_£ndf
(
sockfd
, 
c⁄n
,

240 "CLIENT " 
LIBCURL_NAME
 " " 
LIBCURL_VERSION
 "\r\n"

245 
d©aba£
,

246 
ew‹d
);

248 
	`‰ì
(
ew‹d
);

250 if(
ªsu…
) {

251 
	`Áûf
(
d©a
, "Failed sending DICTÑequest");

252  
ªsu…
;

254 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
FALSE
, 
byãcou¡
,

255 -1, 
NULL
);

259 
µ©h
 = 
	`°rchr
(
∑th
, '/');

260 if(
µ©h
) {

261 
i
;

263 
µ©h
++;

264 
i
 = 0; 
µ©h
[i]; i++) {

265 if(
µ©h
[
i
] == ':')

266 
µ©h
[
i
] = ' ';

268 
ªsu…
 = 
	`Cuæ_£ndf
(
sockfd
, 
c⁄n
,

269 "CLIENT " 
LIBCURL_NAME
 " " 
LIBCURL_VERSION
 "\r\n"

271 "QUIT\r\n", 
µ©h
);

272 if(
ªsu…
) {

273 
	`Áûf
(
d©a
, "Failed sending DICTÑequest");

274  
ªsu…
;

277 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
FALSE
, 
byãcou¡
, -1, 
NULL
);

281  
CURLE_OK
;

282 
	}
}

	@lib/dict.h

1 #i‚de‡
HEADER_CURL_DICT_H


2 
	#HEADER_CURL_DICT_H


	)

25 #i‚de‡
CURL_DISABLE_DICT


26 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_di˘
;

	@lib/dotdot.c

23 
	~"cuæ_£tup.h
"

25 
	~"dŸdŸ.h
"

27 
	~"cuæ_mem‹y.h
"

29 
	~"memdebug.h
"

50 *
	$Cuæ_dedŸdŸify
(c⁄° *
öput
)

52 
size_t
 
öÀn
 = 
	`°æí
(
öput
);

53 *
˛⁄e
;

54 
size_t
 
˛í
 = 
öÀn
;

55 *
out
 = 
	`mÆloc
(
öÀn
+1);

56 *
ouçå
;

57 *
‹g˛⁄e
;

58 *
quîyp
;

59 if(!
out
)

60  
NULL
;

63 
˛⁄e
 = 
	`°rdup
(
öput
);

64 if(!
˛⁄e
) {

65 
	`‰ì
(
out
);

66  
NULL
;

68 
‹g˛⁄e
 = 
˛⁄e
;

69 
ouçå
 = 
out
;

76 
quîyp
 = 
	`°rchr
(
˛⁄e
, '?');

77 if(
quîyp
)

78 *
quîyp
 = 0;

85 if(!
	`°∫cmp
("./", 
˛⁄e
, 2)) {

86 
˛⁄e
+=2;

87 
˛í
-=2;

89 if(!
	`°∫cmp
("../", 
˛⁄e
, 3)) {

90 
˛⁄e
+=3;

91 
˛í
-=3;

97 if(!
	`°∫cmp
("/./", 
˛⁄e
, 3)) {

98 
˛⁄e
+=2;

99 
˛í
-=2;

101 if(!
	`°rcmp
("/.", 
˛⁄e
)) {

102 
˛⁄e
[1]='/';

103 
˛⁄e
++;

104 
˛í
-=1;

112 if(!
	`°∫cmp
("/../", 
˛⁄e
, 4)) {

113 
˛⁄e
+=3;

114 
˛í
-=3;

116 
ouçå
 > 
out
) {

117 
ouçå
--;

118 if(*
ouçå
 == '/')

121 *
ouçå
 = 0;

123 if(!
	`°rcmp
("/..", 
˛⁄e
)) {

124 
˛⁄e
[2]='/';

125 
˛⁄e
+=2;

126 
˛í
-=2;

128 
ouçå
 > 
out
) {

129 
ouçå
--;

130 if(*
ouçå
 == '/')

133 *
ouçå
 = 0;

139 if(!
	`°rcmp
(".", 
˛⁄e
) || !strcmp("..", clone)) {

140 *
˛⁄e
=0;

150 *
ouçå
++ = *
˛⁄e
++;

151 
˛í
--;

152 } *
˛⁄e
 && (*clone != '/'));

153 *
ouçå
 = 0;

156 } *
˛⁄e
);

158 if(
quîyp
) {

159 
size_t
 
qÀn
;

163 
size_t
 
oödex
 = 
quîyp
 - 
‹g˛⁄e
;

164 
qÀn
 = 
	`°æí
(&
öput
[
oödex
]);

165 
	`mem˝y
(
ouçå
, &
öput
[
oödex
], 
qÀn
+1);

168 
	`‰ì
(
‹g˛⁄e
);

169  
out
;

170 
	}
}

	@lib/dotdot.h

1 #i‚de‡
HEADER_CURL_DOTDOT_H


2 
	#HEADER_CURL_DOTDOT_H


	)

24 *
Cuæ_dedŸdŸify
(c⁄° *
öput
);

	@lib/easy.c

23 
	~"cuæ_£tup.h
"

29 #ifde‡
CURLX_NO_MEMORY_CALLBACKS


33 #ifde‡
HAVE_NETINET_IN_H


34 
	~<√töë/ö.h
>

36 #ifde‡
HAVE_NETDB_H


37 
	~<√tdb.h
>

39 #ifde‡
HAVE_ARPA_INET_H


40 
	~<¨∑/öë.h
>

42 #ifde‡
HAVE_NET_IF_H


43 
	~<√t/if.h
>

45 #ifde‡
HAVE_SYS_IOCTL_H


46 
	~<sys/io˘l.h
>

49 #ifde‡
HAVE_SYS_PARAM_H


50 
	~<sys/∑øm.h
>

53 
	~"°ªquÆ.h
"

54 
	~"uæd©a.h
"

55 
	~<cuæ/cuæ.h
>

56 
	~"å™s„r.h
"

57 
	~"vés/vés.h
"

58 
	~"uæ.h
"

59 
	~"gëöfo.h
"

60 
	~"ho°ù.h
"

61 
	~"sh¨e.h
"

62 
	~"°rdup.h
"

63 
	~"cuæ_mem‹y.h
"

64 
	~"¥ogªss.h
"

65 
	~"ósyif.h
"

66 
	~"£À˘.h
"

67 
	~"£ndf.h
"

68 
	~"cuæ_¡lm.h
"

69 
	~"c⁄√˘.h
"

70 
	~"¶i°.h
"

71 
	~"amigaos.h
"

72 
	~"n⁄-ascii.h
"

73 
	~"w¨∆ess.h
"

74 
	~"c⁄nˇche.h
"

75 
	~"mu…iif.h
"

76 
	~"sigpùe.h
"

78 
	#_MPRINTF_REPLACE


	)

79 
	~<cuæ/m¥ötf.h
>

82 
	~"memdebug.h
"

86 
	$wö32_˛ónup
()

88 #ifde‡
USE_WINSOCK


89 
	`WSACÀ™up
();

91 #ifde‡
USE_WINDOWS_SSPI


92 
	`Cuæ_s•i_globÆ_˛ónup
();

94 
	}
}

98 
CURLcode
 
	$wö32_öô
()

100 #ifde‡
USE_WINSOCK


101 
WORD
 
wVîsi⁄Reque°ed
;

102 
WSADATA
 
wßD©a
;

103 
ªs
;

105 #i‡
	`deföed
(
ENABLE_IPV6
Ë&& (
USE_WINSOCK
 < 2)

106 
Eº‹
 
IPV6_ªquúes_wösock2


109 
wVîsi⁄Reque°ed
 = 
	`MAKEWORD
(
USE_WINSOCK
, USE_WINSOCK);

111 
ªs
 = 
	`WSASèπup
(
wVîsi⁄Reque°ed
, &
wßD©a
);

113 if(
ªs
 != 0)

116  
CURLE_FAILED_INIT
;

124 if(
	`LOBYTE
–
wßD©a
.
wVîsi⁄
 ) !LOBYTE(
wVîsi⁄Reque°ed
) ||

125 
	`HIBYTE
–
wßD©a
.
wVîsi⁄
 ) !HIBYTE(
wVîsi⁄Reque°ed
) ) {

129 
	`WSACÀ™up
();

130  
CURLE_FAILED_INIT
;

133 #ñi‡
	`deföed
(
USE_LWIPSOCK
)

134 
	`lwù_öô
();

137 #ifde‡
USE_WINDOWS_SSPI


139 
CURLcode
 
îr
 = 
	`Cuæ_s•i_globÆ_öô
();

140 if(
îr
 !
CURLE_OK
)

141  
îr
;

145  
CURLE_OK
;

146 
	}
}

148 #ifde‡
USE_LIBIDN


154 
	$id«_öô
 ()

156 #ifde‡
WIN32


157 
buf
[60];

158 
UINT
 
˝
 = 
	`GëACP
();

160 if(!
	`gëív
("CHARSET"Ë&& 
˝
 > 0) {

161 
	`¢¥ötf
(
buf
, (buf), "CHARSET=˝%u", 
˝
);

162 
	`puãnv
(
buf
);

167 
	}
}

171 
	göôülized
;

172 
	göô_Êags
;

179 #i‡
deföed
(
_WIN32_WCE
)

180 
	#sy°em_°rdup
 
_°rdup


	)

181 #ñi‡!
deföed
(
HAVE_STRDUP
)

182 
	#sy°em_°rdup
 
cuæx_°rdup


	)

184 
	#sy°em_°rdup
 
°rdup


	)

187 #i‡
deföed
(
_MSC_VER
Ë&& deföed(
_DLL
Ë&& !deföed(
__POCC__
)

188 #¥agm®
w¨nög
(
dißbÀ
:4232)

191 #i‚de‡
__SYMBIAN32__


196 
cuæ_mÆloc_ˇŒback
 
	gCuæ_cmÆloc
 = (cuæ_mÆloc_ˇŒback)
mÆloc
;

197 
cuæ_‰ì_ˇŒback
 
	gCuæ_c‰ì
 = (cuæ_‰ì_ˇŒback)
‰ì
;

198 
cuæ_ªÆloc_ˇŒback
 
	gCuæ_¸óŒoc
 = (cuæ_ªÆloc_ˇŒback)
ªÆloc
;

199 
cuæ_°rdup_ˇŒback
 
	gCuæ_c°rdup
 = (cuæ_°rdup_ˇŒback)
sy°em_°rdup
;

200 
cuæ_ˇŒoc_ˇŒback
 
	gCuæ_cˇŒoc
 = (cuæ_ˇŒoc_ˇŒback)
ˇŒoc
;

201 #i‡
deföed
(
WIN32
Ë&& deföed(
UNICODE
)

202 
cuæ_wcsdup_ˇŒback
 
	gCuæ_cwcsdup
 = (cuæ_wcsdup_ˇŒback)
_wcsdup
;

209 
cuæ_mÆloc_ˇŒback
 
	gCuæ_cmÆloc
;

210 
cuæ_‰ì_ˇŒback
 
	gCuæ_c‰ì
;

211 
cuæ_ªÆloc_ˇŒback
 
	gCuæ_¸óŒoc
;

212 
cuæ_°rdup_ˇŒback
 
	gCuæ_c°rdup
;

213 
cuæ_ˇŒoc_ˇŒback
 
	gCuæ_cˇŒoc
;

216 #i‡
deföed
(
_MSC_VER
Ë&& deföed(
_DLL
Ë&& !deföed(
__POCC__
)

217 #¥agm®
w¨nög
(:4232)

224 
CURLcode
 
	$cuæ_globÆ_öô
(
Êags
)

226 if(
öôülized
++)

227  
CURLE_OK
;

230 
Cuæ_cmÆloc
 = (
cuæ_mÆloc_ˇŒback
)
mÆloc
;

231 
Cuæ_c‰ì
 = (
cuæ_‰ì_ˇŒback
)
‰ì
;

232 
Cuæ_¸óŒoc
 = (
cuæ_ªÆloc_ˇŒback
)
ªÆloc
;

233 
Cuæ_c°rdup
 = (
cuæ_°rdup_ˇŒback
)
sy°em_°rdup
;

234 
Cuæ_cˇŒoc
 = (
cuæ_ˇŒoc_ˇŒback
)
ˇŒoc
;

235 #i‡
	`deföed
(
WIN32
Ë&& deföed(
UNICODE
)

236 
Cuæ_cwcsdup
 = (
cuæ_wcsdup_ˇŒback
)
_wcsdup
;

239 if(
Êags
 & 
CURL_GLOBAL_SSL
)

240 if(!
	`Cuæ_s¶_öô
()) {

241 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Error: Curl_ssl_init failed\n"));

242  
CURLE_FAILED_INIT
;

245 if(
Êags
 & 
CURL_GLOBAL_WIN32
)

246 if(
	`wö32_öô
(Ë!
CURLE_OK
) {

247 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Error: win32_init failed\n"));

248  
CURLE_FAILED_INIT
;

251 #ifde‡
__AMIGA__


252 if(!
	`Cuæ_amiga_öô
()) {

253 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Error: Curl_amiga_init failed\n"));

254  
CURLE_FAILED_INIT
;

258 #ifde‡
NETWARE


259 if(
	`√tw¨e_öô
()) {

260 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Warning: LONGÇamespaceÇotávailable\n"));

264 #ifde‡
USE_LIBIDN


265 
	`id«_öô
();

268 if(
	`Cuæ_ªsﬁvî_globÆ_öô
(Ë!
CURLE_OK
) {

269 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Error:Ñesolver_global_init failed\n"));

270  
CURLE_FAILED_INIT
;

273 #i‡
	`deföed
(
USE_LIBSSH2
Ë&& deföed(
HAVE_LIBSSH2_INIT
)

274 if(
	`libssh2_öô
(0)) {

275 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Error:Üibssh2_init failed\n"));

276  
CURLE_FAILED_INIT
;

280 if(
Êags
 & 
CURL_GLOBAL_ACK_EINTR
)

281 
Cuæ_ack_eöå
 = 1;

283 
öô_Êags
 = 
Êags
;

285  
CURLE_OK
;

286 
	}
}

292 
CURLcode
 
	$cuæ_globÆ_öô_mem
(
Êags
, 
cuæ_mÆloc_ˇŒback
 
m
,

293 
cuæ_‰ì_ˇŒback
 
f
, 
cuæ_ªÆloc_ˇŒback
 
r
,

294 
cuæ_°rdup_ˇŒback
 
s
, 
cuæ_ˇŒoc_ˇŒback
 
c
)

296 
CURLcode
 
code
 = 
CURLE_OK
;

299 if(!
m
 || !
f
 || !
r
 || !
s
 || !
c
)

300  
CURLE_FAILED_INIT
;

302 if(
öôülized
) {

306 
öôülized
++;

307  
CURLE_OK
;

311 
code
 = 
	`cuæ_globÆ_öô
(
Êags
);

312 if(
code
 =
CURLE_OK
) {

313 
Cuæ_cmÆloc
 = 
m
;

314 
Cuæ_c‰ì
 = 
f
;

315 
Cuæ_c°rdup
 = 
s
;

316 
Cuæ_¸óŒoc
 = 
r
;

317 
Cuæ_cˇŒoc
 = 
c
;

320  
code
;

321 
	}
}

327 
	$cuæ_globÆ_˛ónup
()

329 if(!
öôülized
)

332 if(--
öôülized
)

335 
	`Cuæ_globÆ_ho°_ˇche_dt‹
();

337 if(
öô_Êags
 & 
CURL_GLOBAL_SSL
)

338 
	`Cuæ_s¶_˛ónup
();

340 
	`Cuæ_ªsﬁvî_globÆ_˛ónup
();

342 if(
öô_Êags
 & 
CURL_GLOBAL_WIN32
)

343 
	`wö32_˛ónup
();

345 
	`Cuæ_amiga_˛ónup
();

347 #i‡
	`deföed
(
USE_LIBSSH2
Ë&& deföed(
HAVE_LIBSSH2_EXIT
)

348 ()
	`libssh2_exô
();

351 
öô_Êags
 = 0;

352 
	}
}

358 
CURL
 *
	$cuæ_ósy_öô
()

360 
CURLcode
 
ªs
;

361 
Sessi⁄H™dÀ
 *
d©a
;

364 if(!
öôülized
) {

365 
ªs
 = 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

366 if(
ªs
) {

368 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Error: curl_global_init failed\n"));

369  
NULL
;

374 
ªs
 = 
	`Cuæ_›í
(&
d©a
);

375 if(
ªs
 !
CURLE_OK
) {

376 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Error: Curl_open failed\n"));

377  
NULL
;

380  
d©a
;

381 
	}
}

388 #unde‡
cuæ_ósy_£t›t


389 
CURLcode
 
	$cuæ_ósy_£t›t
(
CURL
 *
cuæ
, 
CURL›ti⁄
 
èg
, ...)

391 
va_li°
 
¨g
;

392 
Sessi⁄H™dÀ
 *
d©a
 = 
cuæ
;

393 
CURLcode
 
ªt
;

395 if(!
cuæ
)

396  
CURLE_BAD_FUNCTION_ARGUMENT
;

398 
	`va_°¨t
(
¨g
, 
èg
);

400 
ªt
 = 
	`Cuæ_£t›t
(
d©a
, 
èg
, 
¨g
);

402 
	`va_íd
(
¨g
);

403  
ªt
;

404 
	}
}

406 #ifde‡
CURLDEBUG


408 
	ssockëm⁄ô‹
 {

409 
sockëm⁄ô‹
 *
	m√xt
;

410 
pﬁlfd
 
	msockë
;

413 
	sevíts
 {

414 
	mms
;

415 
boﬁ
 
	mmsbump
;

416 
	mnum_sockës
;

417 
sockëm⁄ô‹
 *
	mli°
;

418 
	mru¬ög_h™dÀs
;

427 
	$evíts_timî
(
CURLM
 *
mu…i
,

428 
timeout_ms
,

429 *
u£Ω
)

431 
evíts
 *
ev
 = 
u£Ω
;

432 ()
mu…i
;

433 if(
timeout_ms
 == -1)

435 
timeout_ms
 = 0;

436 if(
timeout_ms
 == 0)

438 
timeout_ms
 = 1;

440 
ev
->
ms
 = 
timeout_ms
;

441 
ev
->
msbump
 = 
TRUE
;

443 
	}
}

450 
	$pﬁl2c£À˘
(
pﬁlmask
)

452 
omask
=0;

453 if(
pﬁlmask
 & 
POLLIN
)

454 
omask
 |
CURL_CSELECT_IN
;

455 if(
pﬁlmask
 & 
POLLOUT
)

456 
omask
 |
CURL_CSELECT_OUT
;

457 if(
pﬁlmask
 & 
POLLERR
)

458 
omask
 |
CURL_CSELECT_ERR
;

459  
omask
;

460 
	}
}

467 
	$sockëcb2pﬁl
(
pﬁlmask
)

469 
omask
=0;

470 if(
pﬁlmask
 & 
CURL_POLL_IN
)

471 
omask
 |
POLLIN
;

472 if(
pﬁlmask
 & 
CURL_POLL_OUT
)

473 
omask
 |
POLLOUT
;

474  
omask
;

475 
	}
}

482 
	$evíts_sockë
(
CURL
 *
ósy
,

483 
cuæ_sockë_t
 
s
,

484 
wh©
,

485 *
u£Ω
,

487 *
sockëp
)

490 
evíts
 *
ev
 = 
u£Ω
;

491 
sockëm⁄ô‹
 *
m
;

492 
sockëm⁄ô‹
 *
¥ev
=
NULL
;

493 ()
sockëp
;

495 
m
 = 
ev
->
li°
;

496 
m
) {

497 if(
m
->
sockë
.
fd
 =
s
) {

499 if(
wh©
 =
CURL_POLL_REMOVE
) {

500 
sockëm⁄ô‹
 *
nxt
 = 
m
->
√xt
;

502 if(
¥ev
)

503 
¥ev
->
√xt
 = 
nxt
;

505 
ev
->
li°
 = 
nxt
;

506 
	`‰ì
(
m
);

507 
m
 = 
nxt
;

508 
	`öfof
(
ósy
, "sockë cb: sockë %d REMOVED\n", 
s
);

513 
m
->
sockë
.
evíts
 = 
	`sockëcb2pﬁl
(
wh©
);

514 
	`öfof
(
ósy
, "sockë cb: sockë %d UPDATEDá†%s%s\n", 
s
,

515 
wh©
&
CURL_POLL_IN
?"IN":"",

516 
wh©
&
CURL_POLL_OUT
?"OUT":"");

520 
¥ev
 = 
m
;

521 
m
 = m->
√xt
;

523 if(!
m
) {

524 if(
wh©
 =
CURL_POLL_REMOVE
) {

531 
m
 = 
	`mÆloc
((
sockëm⁄ô‹
));

532 
m
->
√xt
 = 
ev
->
li°
;

533 
m
->
sockë
.
fd
 = 
s
;

534 
m
->
sockë
.
evíts
 = 
	`sockëcb2pﬁl
(
wh©
);

535 
m
->
sockë
.
ªvíts
 = 0;

536 
ev
->
li°
 = 
m
;

537 
	`öfof
(
ósy
, "sockë cb: sockë %d ADDEDá†%s%s\n", 
s
,

538 
wh©
&
CURL_POLL_IN
?"IN":"",

539 
wh©
&
CURL_POLL_OUT
?"OUT":"");

544 
	}
}

552 
	$evíts_£tup
(
CURLM
 *
mu…i
, 
evíts
 *
ev
)

555 
	`cuæ_mu…i_£t›t
(
mu…i
, 
CURLMOPT_TIMERFUNCTION
, 
evíts_timî
);

556 
	`cuæ_mu…i_£t›t
(
mu…i
, 
CURLMOPT_TIMERDATA
, 
ev
);

559 
	`cuæ_mu…i_£t›t
(
mu…i
, 
CURLMOPT_SOCKETFUNCTION
, 
evíts_sockë
);

560 
	`cuæ_mu…i_£t›t
(
mu…i
, 
CURLMOPT_SOCKETDATA
, 
ev
);

561 
	}
}

569 
CURLcode
 
	$waô_‹_timeout
(
Cuæ_mu…i
 *
mu…i
, 
evíts
 *
ev
)

571 
boﬁ
 
d⁄e
 = 
FALSE
;

572 
CURLMcode
 
mcode
;

573 
CURLcode
 
rc
 = 
CURLE_OK
;

575 !
d⁄e
) {

576 
CURLMsg
 *
msg
;

577 
sockëm⁄ô‹
 *
m
;

578 
pﬁlfd
 *
f
;

579 
pﬁlfd
 
fds
[4];

580 
numfds
=0;

581 
pﬁÃc
;

582 
i
;

583 
timevÆ
 
bef‹e
;

584 
timevÆ
 
a·î
;

587 
m
 = 
ev
->
li°
, 
f
=&
fds
[0]; m; m = m->
√xt
) {

588 
f
->
fd
 = 
m
->
sockë
.fd;

589 
f
->
evíts
 = 
m
->
sockë
.events;

590 
f
->
ªvíts
 = 0;

592 
f
++;

593 
numfds
++;

597 
bef‹e
 = 
	`cuæx_tvnow
();

600 
pﬁÃc
 = 
	`Cuæ_pﬁl
(
fds
, 
numfds
, ()
ev
->
ms
);

602 
a·î
 = 
	`cuæx_tvnow
();

604 
ev
->
msbump
 = 
FALSE
;

606 if(0 =
pﬁÃc
) {

608 
ev
->
ms
 = 0;

610 
mcode
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
mu…i
, 
CURL_SOCKET_TIMEOUT
, 0,

611 &
ev
->
ru¬ög_h™dÀs
);

613 if(
pﬁÃc
 > 0) {

615 
i
 = 0; i< 
numfds
; i++) {

616 if(
fds
[
i
].
ªvíts
) {

618 
a˘
 = 
	`pﬁl2c£À˘
(
fds
[
i
].
ªvíts
);

619 
	`öfof
(
mu…i
->
ósyp
, "call curl_multi_socket_action( socket %d )\n",

620 
fds
[
i
].
fd
);

621 
mcode
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
mu…i
, 
fds
[
i
].
fd
, 
a˘
,

622 &
ev
->
ru¬ög_h™dÀs
);

626 if(!
ev
->
msbump
)

630 
ev
->
ms
 +
	`cuæx_tvdiff
(
a·î
, 
bef‹e
);

633 if(
mcode
)

634  
CURLE_URL_MALFORMAT
;

638 
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
mu…i
, &
pﬁÃc
);

639 if(
msg
) {

640 
rc
 = 
msg
->
d©a
.
ªsu…
;

641 
d⁄e
 = 
TRUE
;

645  
rc
;

646 
	}
}

653 
CURLcode
 
	$ósy_evíts
(
CURLM
 *
mu…i
)

655 
evíts
 
evs
{2, 
FALSE
, 0, 
NULL
, 0};

658 
	`evíts_£tup
(
mu…i
, &
evs
);

660  
	`waô_‹_timeout
(
mu…i
, &
evs
);

661 
	}
}

664 
	#ósy_evíts
(
x
Ë
CURLE_NOT_BUILT_IN


	)

667 
CURLcode
 
	$ósy_å™s„r
(
CURLM
 *
mu…i
)

669 
boﬁ
 
d⁄e
 = 
FALSE
;

670 
CURLMcode
 
mcode
 = 
CURLM_OK
;

671 
CURLcode
 
code
 = 
CURLE_OK
;

672 
timevÆ
 
bef‹e
;

673 
wôhout_fds
 = 0;

676 !
d⁄e
 && !
mcode
) {

677 
°ûl_ru¬ög
 = 0;

678 
ªt
;

680 
bef‹e
 = 
	`cuæx_tvnow
();

681 
mcode
 = 
	`cuæ_mu…i_waô
(
mu…i
, 
NULL
, 0, 1000, &
ªt
);

683 if(
mcode
 =
CURLM_OK
) {

684 if(
ªt
 == -1) {

686 
code
 = 
CURLE_RECV_ERROR
;

689 if(
ªt
 == 0) {

690 
timevÆ
 
a·î
 = 
	`cuæx_tvnow
();

694 if(
	`cuæx_tvdiff
(
a·î
, 
bef‹e
) <= 10) {

695 
wôhout_fds
++;

696 if(
wôhout_fds
 > 2) {

697 
¶ìp_ms
 = 
wôhout_fds
 < 10 ? (1 << (without_fds-1)): 1000;

698 
	`Cuæ_waô_ms
(
¶ìp_ms
);

703 
wôhout_fds
 = 0;

707 
wôhout_fds
 = 0;

709 
mcode
 = 
	`cuæ_mu…i_≥rf‹m
(
mu…i
, &
°ûl_ru¬ög
);

713 if((
mcode
 =
CURLM_OK
Ë&& !
°ûl_ru¬ög
) {

714 
rc
;

715 
CURLMsg
 *
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
mu…i
, &
rc
);

716 if(
msg
) {

717 
code
 = 
msg
->
d©a
.
ªsu…
;

718 
d⁄e
 = 
TRUE
;

724 if(
mcode
) {

725  (
mcode
 =
CURLM_OUT_OF_MEMORY
Ë? 
CURLE_OUT_OF_MEMORY
 :

728 
CURLE_BAD_FUNCTION_ARGUMENT
;

731  
code
;

732 
	}
}

752 
CURLcode
 
	$ósy_≥rf‹m
(
Sessi⁄H™dÀ
 *
d©a
, 
boﬁ
 
evíts
)

754 
CURLM
 *
mu…i
;

755 
CURLMcode
 
mcode
;

756 
CURLcode
 
code
 = 
CURLE_OK
;

757 
	`SIGPIPE_VARIABLE
(
pùe_°
);

759 if(!
d©a
)

760  
CURLE_BAD_FUNCTION_ARGUMENT
;

762 if(
d©a
->
mu…i
) {

763 
	`Áûf
(
d©a
, "easy handleálready used in multi handle");

764  
CURLE_FAILED_INIT
;

767 if(
d©a
->
mu…i_ósy
)

768 
mu…i
 = 
d©a
->
mu…i_ósy
;

772 
mu…i
 = 
	`Cuæ_mu…i_h™dÀ
(1, 3);

773 if(!
mu…i
)

774  
CURLE_OUT_OF_MEMORY
;

775 
d©a
->
mu…i_ósy
 = 
mu…i
;

779 
	`cuæ_mu…i_£t›t
(
mu…i
, 
CURLMOPT_MAXCONNECTS
, 
d©a
->
£t
.
maxc⁄√˘s
);

781 
mcode
 = 
	`cuæ_mu…i_add_h™dÀ
(
mu…i
, 
d©a
);

782 if(
mcode
) {

783 
	`cuæ_mu…i_˛ónup
(
mu…i
);

784 if(
mcode
 =
CURLM_OUT_OF_MEMORY
)

785  
CURLE_OUT_OF_MEMORY
;

787  
CURLE_FAILED_INIT
;

790 
	`sigpùe_ign‹e
(
d©a
, &
pùe_°
);

794 
d©a
->
mu…i
 = multi;

797 
code
 = 
evíts
 ? 
	`ósy_evíts
(
mu…i
Ë: 
	`ósy_å™s„r
(multi);

801 ()
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…i
, 
d©a
);

803 
	`sigpùe_ª°‹e
(&
pùe_°
);

806  
code
;

807 
	}
}

814 
CURLcode
 
	$cuæ_ósy_≥rf‹m
(
CURL
 *
ósy
)

816  
	`ósy_≥rf‹m
(
ósy
, 
FALSE
);

817 
	}
}

819 #ifde‡
CURLDEBUG


824 
CURLcode
 
	$cuæ_ósy_≥rf‹m_ev
(
CURL
 *
ósy
)

826  
	`ósy_≥rf‹m
(
ósy
, 
TRUE
);

827 
	}
}

835 
	$cuæ_ósy_˛ónup
(
CURL
 *
cuæ
)

837 
Sessi⁄H™dÀ
 *
d©a
 = (Sessi⁄H™dÀ *)
cuæ
;

838 
	`SIGPIPE_VARIABLE
(
pùe_°
);

840 if(!
d©a
)

843 
	`sigpùe_ign‹e
(
d©a
, &
pùe_°
);

844 
	`Cuæ_˛o£
(
d©a
);

845 
	`sigpùe_ª°‹e
(&
pùe_°
);

846 
	}
}

852 #unde‡
cuæ_ósy_gëöfo


853 
CURLcode
 
	$cuæ_ósy_gëöfo
(
CURL
 *
cuæ
, 
CURLINFO
 
öfo
, ...)

855 
va_li°
 
¨g
;

856 *
∑ømp
;

857 
CURLcode
 
ªt
;

858 
Sessi⁄H™dÀ
 *
d©a
 = (Sessi⁄H™dÀ *)
cuæ
;

860 
	`va_°¨t
(
¨g
, 
öfo
);

861 
∑ømp
 = 
	`va_¨g
(
¨g
, *);

863 
ªt
 = 
	`Cuæ_gëöfo
(
d©a
, 
öfo
, 
∑ømp
);

865 
	`va_íd
(
¨g
);

866  
ªt
;

867 
	}
}

874 
CURL
 *
	$cuæ_ósy_duph™dÀ
(
CURL
 *
öcuæ
)

876 
Sessi⁄H™dÀ
 *
d©a
=(Sessi⁄H™dÀ *)
öcuæ
;

878 
Sessi⁄H™dÀ
 *
outcuæ
 = 
	`ˇŒoc
(1, (SessionHandle));

879 if(
NULL
 =
outcuæ
)

880 
Áû
;

887 
outcuæ
->
°©e
.
hódîbuff
 = 
	`mÆloc
(
HEADERSIZE
);

888 if(!
outcuæ
->
°©e
.
hódîbuff
)

889 
Áû
;

890 
outcuæ
->
°©e
.
hódîsize
 = 
HEADERSIZE
;

893 if(
	`Cuæ_dup£t
(
outcuæ
, 
d©a
Ë!
CURLE_OK
)

894 
Áû
;

897 
outcuæ
->
°©e
.
c⁄n_ˇche
 = 
NULL
;

899 
outcuæ
->
°©e
.
œ°c⁄√˘
 = 
NULL
;

901 
outcuæ
->
¥ogªss
.
Êags
 = 
d©a
->progress.flags;

902 
outcuæ
->
¥ogªss
.
ˇŒback
 = 
d©a
->progress.callback;

904 if(
d©a
->
cookõs
) {

907 
outcuæ
->
cookõs
 = 
	`Cuæ_cookõ_öô
(
d©a
,

908 
d©a
->
cookõs
->
fûíame
,

909 
outcuæ
->
cookõs
,

910 
d©a
->
£t
.
cookõ£ssi⁄
);

911 if(!
outcuæ
->
cookõs
)

912 
Áû
;

916 if(
d©a
->
ch™ge
.
cookõli°
) {

917 
outcuæ
->
ch™ge
.
cookõli°
 =

918 
	`Cuæ_¶i°_du∂iˇã
(
d©a
->
ch™ge
.
cookõli°
);

919 if(!
outcuæ
->
ch™ge
.
cookõli°
)

920 
Áû
;

923 if(
d©a
->
ch™ge
.
uæ
) {

924 
outcuæ
->
ch™ge
.
uæ
 = 
	`°rdup
(
d©a
->change.url);

925 if(!
outcuæ
->
ch™ge
.
uæ
)

926 
Áû
;

927 
outcuæ
->
ch™ge
.
uæ_Æloc
 = 
TRUE
;

930 if(
d©a
->
ch™ge
.
ª„ªr
) {

931 
outcuæ
->
ch™ge
.
ª„ªr
 = 
	`°rdup
(
d©a
->change.referer);

932 if(!
outcuæ
->
ch™ge
.
ª„ªr
)

933 
Áû
;

934 
outcuæ
->
ch™ge
.
ª„ªr_Æloc
 = 
TRUE
;

938 if(
	`Cuæ_ªsﬁvî_duph™dÀ
(&
outcuæ
->
°©e
.
ªsﬁvî
,

939 
d©a
->
°©e
.
ªsﬁvî
Ë!
CURLE_OK
)

940 
Áû
;

942 
	`Cuæ_c⁄vît_£tup
(
outcuæ
);

944 
outcuæ
->
magic
 = 
CURLEASY_MAGIC_NUMBER
;

948  
outcuæ
;

950 
Áû
:

952 if(
outcuæ
) {

953 
	`cuæ_¶i°_‰ì_Æl
(
outcuæ
->
ch™ge
.
cookõli°
);

954 
outcuæ
->
ch™ge
.
cookõli°
 = 
NULL
;

955 
	`Cuæ_ß„‰ì
(
outcuæ
->
°©e
.
hódîbuff
);

956 
	`Cuæ_ß„‰ì
(
outcuæ
->
ch™ge
.
uæ
);

957 
	`Cuæ_ß„‰ì
(
outcuæ
->
ch™ge
.
ª„ªr
);

958 
	`Cuæ_‰ì£t
(
outcuæ
);

959 
	`‰ì
(
outcuæ
);

962  
NULL
;

963 
	}
}

969 
	$cuæ_ósy_ª£t
(
CURL
 *
cuæ
)

971 
Sessi⁄H™dÀ
 *
d©a
 = (Sessi⁄H™dÀ *)
cuæ
;

973 
	`Cuæ_ß„‰ì
(
d©a
->
°©e
.
∑thbuf„r
);

975 
d©a
->
°©e
.
∑th
 = 
NULL
;

977 
	`Cuæ_‰ì_ªque°_°©e
(
d©a
);

980 
	`Cuæ_‰ì£t
(
d©a
);

981 
	`mem£t
(&
d©a
->
£t
, 0, (
U£rDeföed
));

982 ()
	`Cuæ_öô_u£rdeföed
(&
d©a
->
£t
);

985 
	`mem£t
(&
d©a
->
¥ogªss
, 0, (
Progªss
));

987 
d©a
->
¥ogªss
.
Êags
 |
PGRS_HIDE
;

988 
d©a
->
°©e
.
cuºít_•ìd
 = -1;

989 
	}
}

1001 
CURLcode
 
	$cuæ_ósy_∑u£
(
CURL
 *
cuæ
, 
a˘i⁄
)

1003 
Sessi⁄H™dÀ
 *
d©a
 = (Sessi⁄H™dÀ *)
cuæ
;

1004 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

1005 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1008 
√w°©e
 = 
k
->
kìp⁄
 &~ (
KEEP_RECV_PAUSE
| 
KEEP_SEND_PAUSE
);

1011 
√w°©e
 |((
a˘i⁄
 & 
CURLPAUSE_RECV
)?
KEEP_RECV_PAUSE
:0) |

1012 ((
a˘i⁄
 & 
CURLPAUSE_SEND
)?
KEEP_SEND_PAUSE
:0);

1015 
k
->
kìp⁄
 = 
√w°©e
;

1017 if(!(
√w°©e
 & 
KEEP_RECV_PAUSE
Ë&& 
d©a
->
°©e
.
ãmpwrôe
) {

1024 *
ãmpwrôe
 = 
d©a
->
°©e
.tempwrite;

1025 *
‰ìwrôe
 = 
ãmpwrôe
;

1026 
size_t
 
ãmpsize
 = 
d©a
->
°©e
.
ãmpwrôesize
;

1027 
ãm±y≥
 = 
d©a
->
°©e
.
ãmpwrôëy≥
;

1028 
size_t
 
chunkÀn
;

1033 
d©a
->
°©e
.
ãmpwrôe
 = 
NULL
;

1046 
chunkÀn
 = (
ãmpsize
 > 
CURL_MAX_WRITE_SIZE
)?CURL_MAX_WRITE_SIZE:tempsize;

1048 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
d©a
->
ósy_c⁄n
,

1049 
ãm±y≥
, 
ãmpwrôe
, 
chunkÀn
);

1050 if(
ªsu…
)

1054 if(
d©a
->
°©e
.
ãmpwrôe
 && (
ãmpsize
 - 
chunkÀn
)) {

1061 *
√w±r
;

1065 
√w±r
 = 
	`ªÆloc
(
d©a
->
°©e
.
ãmpwrôe
, 
ãmpsize
);

1067 if(!
√w±r
) {

1068 
	`‰ì
(
d©a
->
°©e
.
ãmpwrôe
);

1069 
d©a
->
°©e
.
ãmpwrôe
 = 
NULL
;

1070 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1074 
d©a
->
°©e
.
ãmpwrôe
 = 
√w±r
;

1075 
	`mem˝y
(
√w±r
, 
ãmpwrôe
, 
ãmpsize
);

1076 
d©a
->
°©e
.
ãmpwrôesize
 = 
ãmpsize
;

1081 
ãmpsize
 -
chunkÀn
;

1082 
ãmpwrôe
 +
chunkÀn
;

1085 } (
ªsu…
 =
CURLE_OK
Ë&& 
ãmpsize
);

1087 
	`‰ì
(
‰ìwrôe
);

1092 if(!
ªsu…
 &&

1093 ((
√w°©e
&(
KEEP_RECV_PAUSE
|
KEEP_SEND_PAUSE
)) !=

1094 (
KEEP_RECV_PAUSE
|
KEEP_SEND_PAUSE
)) )

1095 
	`Cuæ_expúe
(
d©a
, 1);

1097  
ªsu…
;

1098 
	}
}

1101 
CURLcode
 
	$ósy_c⁄√˘i⁄
(
Sessi⁄H™dÀ
 *
d©a
,

1102 
cuæ_sockë_t
 *
sfd
,

1103 
c⁄√˘d©a
 **
c⁄≈
)

1105 if(
d©a
 =
NULL
)

1106  
CURLE_BAD_FUNCTION_ARGUMENT
;

1109 if(!
d©a
->
£t
.
c⁄√˘_⁄ly
) {

1110 
	`Áûf
(
d©a
, "CONNECT_ONLY isÑequired!");

1111  
CURLE_UNSUPPORTED_PROTOCOL
;

1114 *
sfd
 = 
	`Cuæ_gëc⁄√˘öfo
(
d©a
, 
c⁄≈
);

1116 if(*
sfd
 =
CURL_SOCKET_BAD
) {

1117 
	`Áûf
(
d©a
, "FailedÅo getÑecent socket");

1118  
CURLE_UNSUPPORTED_PROTOCOL
;

1121  
CURLE_OK
;

1122 
	}
}

1129 
CURLcode
 
	$cuæ_ósy_ªcv
(
CURL
 *
cuæ
, *
buf„r
, 
size_t
 
buÊí
, size_à*
n
)

1131 
cuæ_sockë_t
 
sfd
;

1132 
CURLcode
 
ªt
;

1133 
ssize_t
 
n1
;

1134 
c⁄√˘d©a
 *
c
;

1135 
Sessi⁄H™dÀ
 *
d©a
 = (Sessi⁄H™dÀ *)
cuæ
;

1137 
ªt
 = 
	`ósy_c⁄√˘i⁄
(
d©a
, &
sfd
, &
c
);

1138 if(
ªt
)

1139  
ªt
;

1141 *
n
 = 0;

1142 
ªt
 = 
	`Cuæ_ªad
(
c
, 
sfd
, 
buf„r
, 
buÊí
, &
n1
);

1144 if(
ªt
 !
CURLE_OK
)

1145  
ªt
;

1147 *
n
 = (
size_t
)
n1
;

1149  
CURLE_OK
;

1150 
	}
}

1156 
CURLcode
 
	$cuæ_ósy_£nd
(
CURL
 *
cuæ
, c⁄° *
buf„r
, 
size_t
 
buÊí
,

1157 
size_t
 *
n
)

1159 
cuæ_sockë_t
 
sfd
;

1160 
CURLcode
 
ªt
;

1161 
ssize_t
 
n1
;

1162 
c⁄√˘d©a
 *
c
 = 
NULL
;

1163 
Sessi⁄H™dÀ
 *
d©a
 = (Sessi⁄H™dÀ *)
cuæ
;

1165 
ªt
 = 
	`ósy_c⁄√˘i⁄
(
d©a
, &
sfd
, &
c
);

1166 if(
ªt
)

1167  
ªt
;

1169 *
n
 = 0;

1170 
ªt
 = 
	`Cuæ_wrôe
(
c
, 
sfd
, 
buf„r
, 
buÊí
, &
n1
);

1172 if(
n1
 == -1)

1173  
CURLE_SEND_ERROR
;

1176 if((
CURLE_OK
 =
ªt
Ë&& (0 =
n1
))

1177  
CURLE_AGAIN
;

1179 *
n
 = (
size_t
)
n1
;

1181  
ªt
;

1182 
	}
}

	@lib/easyif.h

1 #i‚de‡
HEADER_CURL_EASYIF_H


2 
	#HEADER_CURL_EASYIF_H


	)

28 #ifde‡
CURLDEBUG


29 
CURL_EXTERN
 
CURLcode
 
cuæ_ósy_≥rf‹m_ev
(
CURL
 *
ósy
);

	@lib/escape.c

26 
	~"cuæ_£tup.h
"

28 
	~<cuæ/cuæ.h
>

30 
	~"cuæ_mem‹y.h
"

31 
	~"uæd©a.h
"

32 
	~"w¨∆ess.h
"

33 
	~"n⁄-ascii.h
"

34 
	~"esˇ≥.h
"

36 
	#_MPRINTF_REPLACE


	)

37 
	~<cuæ/m¥ötf.h
>

40 
	~"memdebug.h
"

46 
boﬁ
 
	$Cuæ_isuƒe£rved
(
ö
)

48 
ö
) {

62  
TRUE
;

66  
FALSE
;

67 
	}
}

70 *
	$cuæ_esˇ≥
(c⁄° *
°rög
, 
öÀngth
)

72  
	`cuæ_ósy_esˇ≥
(
NULL
, 
°rög
, 
öÀngth
);

73 
	}
}

76 *
	$cuæ_u√sˇ≥
(c⁄° *
°rög
, 
Àngth
)

78  
	`cuæ_ósy_u√sˇ≥
(
NULL
, 
°rög
, 
Àngth
, NULL);

79 
	}
}

81 *
	$cuæ_ósy_esˇ≥
(
CURL
 *
h™dÀ
, c⁄° *
°rög
, 
öÀngth
)

83 
size_t
 
Æloc
 = (
öÀngth
?(size_t)öÀngth:
	`°æí
(
°rög
))+1;

84 *
ns
;

85 *
ã°ög_±r
 = 
NULL
;

86 
ö
;

87 
size_t
 
√wÀn
 = 
Æloc
;

88 
size_t
 
°rödex
=0;

89 
size_t
 
Àngth
;

90 
CURLcode
 
ªs
;

92 
ns
 = 
	`mÆloc
(
Æloc
);

93 if(!
ns
)

94  
NULL
;

96 
Àngth
 = 
Æloc
-1;

97 
Àngth
--) {

98 
ö
 = *
°rög
;

100 if(
	`Cuæ_isuƒe£rved
(
ö
))

102 
ns
[
°rödex
++]=
ö
;

105 
√wÀn
 += 2;

106 if(
√wÀn
 > 
Æloc
) {

107 
Æloc
 *= 2;

108 
ã°ög_±r
 = 
	`ªÆloc
(
ns
, 
Æloc
);

109 if(!
ã°ög_±r
) {

110 
	`‰ì
–
ns
 );

111  
NULL
;

114 
ns
 = 
ã°ög_±r
;

118 
ªs
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
h™dÀ
, &
ö
, 1);

119 if(
ªs
) {

121 
	`‰ì
(
ns
);

122  
NULL
;

125 
	`¢¥ötf
(&
ns
[
°rödex
], 4, "%%%02X", 
ö
);

127 
°rödex
+=3;

129 
°rög
++;

131 
ns
[
°rödex
]=0;

132  
ns
;

133 
	}
}

145 
CURLcode
 
	$Cuæ_uædecode
(
Sessi⁄H™dÀ
 *
d©a
,

146 c⁄° *
°rög
, 
size_t
 
Àngth
,

147 **
o°rög
, 
size_t
 *
ﬁí
,

148 
boﬁ
 
ªje˘_˘æ
)

150 
size_t
 
Æloc
 = (
Àngth
?Àngth:
	`°æí
(
°rög
))+1;

151 *
ns
 = 
	`mÆloc
(
Æloc
);

152 
ö
;

153 
size_t
 
°rödex
=0;

154 
hex
;

155 
CURLcode
 
ªs
;

157 if(!
ns
)

158  
CURLE_OUT_OF_MEMORY
;

160 --
Æloc
 > 0) {

161 
ö
 = *
°rög
;

162 if(('%' =
ö
Ë&& (
Æloc
 > 2) &&

163 
	`ISXDIGIT
(
°rög
[1]) && ISXDIGIT(string[2])) {

165 
hex°r
[3];

166 *
±r
;

167 
hex°r
[0] = 
°rög
[1];

168 
hex°r
[1] = 
°rög
[2];

169 
hex°r
[2] = 0;

171 
hex
 = 
	`°πoul
(
hex°r
, &
±r
, 16);

173 
ö
 = 
	`cuæx_u…ouc
(
hex
);

175 
ªs
 = 
	`Cuæ_c⁄vît_‰om_√tw‹k
(
d©a
, &
ö
, 1);

176 if(
ªs
) {

178 
	`‰ì
(
ns
);

179  
ªs
;

182 
°rög
+=2;

183 
Æloc
-=2;

185 if(
ªje˘_˘æ
 && (
ö
 < 0x20)) {

186 
	`‰ì
(
ns
);

187  
CURLE_URL_MALFORMAT
;

190 
ns
[
°rödex
++] = 
ö
;

191 
°rög
++;

193 
ns
[
°rödex
]=0;

195 if(
ﬁí
)

197 *
ﬁí
 = 
°rödex
;

200 *
o°rög
 = 
ns
;

202  
CURLE_OK
;

203 
	}
}

211 *
	$cuæ_ósy_u√sˇ≥
(
CURL
 *
h™dÀ
, c⁄° *
°rög
, 
Àngth
,

212 *
ﬁí
)

214 *
°r
 = 
NULL
;

215 
size_t
 
öpuéí
 = 
Àngth
;

216 
size_t
 
ouçuéí
;

217 
CURLcode
 
ªs
 = 
	`Cuæ_uædecode
(
h™dÀ
, 
°rög
, 
öpuéí
, &
°r
, &
ouçuéí
,

218 
FALSE
);

219 if(
ªs
)

220  
NULL
;

221 if(
ﬁí
)

222 *
ﬁí
 = 
	`cuæx_uztosi
(
ouçuéí
);

223  
°r
;

224 
	}
}

229 
	$cuæ_‰ì
(*
p
)

231 if(
p
)

232 
	`‰ì
(
p
);

233 
	}
}

	@lib/escape.h

1 #i‚de‡
HEADER_CURL_ESCAPE_H


2 
	#HEADER_CURL_ESCAPE_H


	)

27 
CURLcode
 
Cuæ_uædecode
(
Sessi⁄H™dÀ
 *
d©a
,

28 c⁄° *
°rög
, 
size_t
 
Àngth
,

29 **
o°rög
, 
size_t
 *
ﬁí
,

30 
boﬁ
 
ªje˘_¸lf
);

	@lib/file.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_FILE


27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

30 #ifde‡
HAVE_NETDB_H


31 
	~<√tdb.h
>

33 #ifde‡
HAVE_ARPA_INET_H


34 
	~<¨∑/öë.h
>

36 #ifde‡
HAVE_NET_IF_H


37 
	~<√t/if.h
>

39 #ifde‡
HAVE_SYS_IOCTL_H


40 
	~<sys/io˘l.h
>

43 #ifde‡
HAVE_SYS_PARAM_H


44 
	~<sys/∑øm.h
>

47 #ifde‡
HAVE_FCNTL_H


48 
	~<f˙é.h
>

51 
	~"°πoof·.h
"

52 
	~"uæd©a.h
"

53 
	~<cuæ/cuæ.h
>

54 
	~"¥ogªss.h
"

55 
	~"£ndf.h
"

56 
	~"esˇ≥.h
"

57 
	~"fûe.h
"

58 
	~"•ìdcheck.h
"

59 
	~"gëöfo.h
"

60 
	~"å™s„r.h
"

61 
	~"uæ.h
"

62 
	~"cuæ_mem‹y.h
"

63 
	~"∑r£d©e.h
"

64 
	~"w¨∆ess.h
"

66 
	#_MPRINTF_REPLACE


	)

67 
	~<cuæ/m¥ötf.h
>

70 
	~"memdebug.h
"

72 #i‡
deföed
(
WIN32
Ë|| deföed(
MSDOS
Ë|| deföed(
__EMX__
) || \

73 
	$deföed
(
__SYMBIAN32__
)

74 
	#DOS_FILESYSTEM
 1

	)

77 #ifde‡
OPEN_NEEDS_ARG3


78 
	#›í_ªad⁄ly
(
p
,
f
Ë
	`›í
(’),(f),(0))

	)

80 
	#›í_ªad⁄ly
(
p
,
f
Ë
	`›í
(’),(f))

	)

87 
CURLcode
 
	`fûe_do
(
c⁄√˘d©a
 *, 
boﬁ
 *
d⁄e
);

88 
CURLcode
 
	`fûe_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

89 
CURLcode
 
°©us
, 
boﬁ
 
¥em©uª
);

90 
CURLcode
 
	`fûe_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

91 
CURLcode
 
	`fûe_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

92 
boﬁ
 
dód_c⁄√˘i⁄
);

93 
CURLcode
 
	`fûe_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
);

99 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_fûe
 = {

101 
fûe_£tup_c⁄√˘i⁄
,

102 
fûe_do
,

103 
fûe_d⁄e
,

104 
ZERO_NULL
,

105 
fûe_c⁄√˘
,

106 
ZERO_NULL
,

107 
ZERO_NULL
,

108 
ZERO_NULL
,

109 
ZERO_NULL
,

110 
ZERO_NULL
,

111 
ZERO_NULL
,

112 
fûe_disc⁄√˘
,

113 
ZERO_NULL
,

115 
CURLPROTO_FILE
,

116 
PROTOPT_NONETWORK
 | 
PROTOPT_NOURLQUERY


117 
	}
};

120 
CURLcode
 
	$fûe_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
)

123 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
 = 
	`ˇŒoc
(1, (
FILEPROTO
));

124 if(!
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
)

125  
CURLE_OUT_OF_MEMORY
;

127  
CURLE_OK
;

128 
	}
}

135 
CURLcode
 
	$fûe_ønge
(
c⁄√˘d©a
 *
c⁄n
)

137 
cuæ_off_t
 
‰om
, 
to
;

138 
cuæ_off_t
 
tŸÆsize
=-1;

139 *
±r
;

140 *
±r2
;

141 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

143 if(
d©a
->
°©e
.
u£_ønge
 && d©a->°©e.
ønge
) {

144 
‰om
=
	`cuæx_°πoof·
(
d©a
->
°©e
.
ønge
, &
±r
, 0);

145 *
±r
 && (
	`ISSPACE
(*ptr) || (*ptr=='-')))

146 
±r
++;

147 
to
=
	`cuæx_°πoof·
(
±r
, &
±r2
, 0);

148 if(
±r
 =
±r2
) {

150 
to
=-1;

152 if((-1 =
to
Ë&& (
‰om
>=0)) {

154 
d©a
->
°©e
.
ªsume_‰om
 = 
‰om
;

155 
	`DEBUGF
(
	`öfof
(
d©a
, "RANGE %" 
CURL_FORMAT_CURL_OFF_T
 "ÅoÉnd of file\n",

156 
‰om
));

158 if(
‰om
 < 0) {

160 
d©a
->
ªq
.
maxdow∆ﬂd
 = -
‰om
;

161 
d©a
->
°©e
.
ªsume_‰om
 = 
‰om
;

162 
	`DEBUGF
(
	`öfof
(
d©a
, "RANGEÅhêœ° %" 
CURL_FORMAT_CURL_OFF_T
 " bytes\n",

163 -
‰om
));

167 
tŸÆsize
 = 
to
-
‰om
;

168 
d©a
->
ªq
.
maxdow∆ﬂd
 = 
tŸÆsize
+1;

169 
d©a
->
°©e
.
ªsume_‰om
 = 
‰om
;

170 
	`DEBUGF
(
	`öfof
(
d©a
, "RANGE from %" 
CURL_FORMAT_CURL_OFF_T


171 " gëtög %" 
CURL_FORMAT_CURL_OFF_T
 " bytes\n",

172 
‰om
, 
d©a
->
ªq
.
maxdow∆ﬂd
));

174 
	`DEBUGF
(
	`öfof
(
d©a
, "ønge-dow∆ﬂd from %" 
CURL_FORMAT_CURL_OFF_T


175 "Åÿ%" 
CURL_FORMAT_CURL_OFF_T
 ",Åotally %"

176 
CURL_FORMAT_CURL_OFF_T
 " bytes\n",

177 
‰om
, 
to
, 
d©a
->
ªq
.
maxdow∆ﬂd
));

180 
d©a
->
ªq
.
maxdow∆ﬂd
 = -1;

181  
CURLE_OK
;

182 
	}
}

189 
CURLcode
 
	$fûe_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

191 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

192 *
ªÆ_∑th
;

193 
FILEPROTO
 *
fûe
 = 
d©a
->
ªq
.
¥Ÿ›
;

194 
fd
;

195 #ifde‡
DOS_FILESYSTEM


196 
i
;

197 *
a˘uÆ_∑th
;

200 
ªÆ_∑th
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
, d©a->
°©e
.
∑th
, 0, 
NULL
);

201 if(!
ªÆ_∑th
)

202  
CURLE_OUT_OF_MEMORY
;

204 #ifde‡
DOS_FILESYSTEM


219 
a˘uÆ_∑th
 = 
ªÆ_∑th
;

220 if((
a˘uÆ_∑th
[0] == '/') &&

221 
a˘uÆ_∑th
[1] &&

222 (
a˘uÆ_∑th
[2] == ':' ||áctual_path[2] == '|')) {

223 
a˘uÆ_∑th
[2] = ':';

224 
a˘uÆ_∑th
++;

228 
i
=0; 
a˘uÆ_∑th
[i] != '\0'; ++i)

229 if(
a˘uÆ_∑th
[
i
] == '/')

230 
a˘uÆ_∑th
[
i
] = '\\';

232 
fd
 = 
	`›í_ªad⁄ly
(
a˘uÆ_∑th
, 
O_RDONLY
|
O_BINARY
);

233 
fûe
->
∑th
 = 
a˘uÆ_∑th
;

235 
fd
 = 
	`›í_ªad⁄ly
(
ªÆ_∑th
, 
O_RDONLY
);

236 
fûe
->
∑th
 = 
ªÆ_∑th
;

238 
fûe
->
‰ì∑th
 = 
ªÆ_∑th
;

240 
fûe
->
fd
 = fd;

241 if(!
d©a
->
£t
.
u∂ﬂd
 && (
fd
 == -1)) {

242 
	`Áûf
(
d©a
, "Couldn'à›í fûê%s", d©a->
°©e
.
∑th
);

243 
	`fûe_d⁄e
(
c⁄n
, 
CURLE_FILE_COULDNT_READ_FILE
, 
FALSE
);

244  
CURLE_FILE_COULDNT_READ_FILE
;

246 *
d⁄e
 = 
TRUE
;

248  
CURLE_OK
;

249 
	}
}

251 
CURLcode
 
	$fûe_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

252 
CURLcode
 
°©us
, 
boﬁ
 
¥em©uª
)

254 
FILEPROTO
 *
fûe
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

255 ()
°©us
;

256 ()
¥em©uª
;

258 if(
fûe
) {

259 
	`Cuæ_ß„‰ì
(
fûe
->
‰ì∑th
);

260 
fûe
->
∑th
 = 
NULL
;

261 if(
fûe
->
fd
 != -1)

262 
	`˛o£
(
fûe
->
fd
);

263 
fûe
->
fd
 = -1;

266  
CURLE_OK
;

267 
	}
}

269 
CURLcode
 
	$fûe_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

270 
boﬁ
 
dód_c⁄√˘i⁄
)

272 
FILEPROTO
 *
fûe
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

273 ()
dód_c⁄√˘i⁄
;

275 if(
fûe
) {

276 
	`Cuæ_ß„‰ì
(
fûe
->
‰ì∑th
);

277 
fûe
->
∑th
 = 
NULL
;

278 if(
fûe
->
fd
 != -1)

279 
	`˛o£
(
fûe
->
fd
);

280 
fûe
->
fd
 = -1;

283  
CURLE_OK
;

284 
	}
}

286 #ifde‡
DOS_FILESYSTEM


287 
	#DIRSEP
 '\\'

	)

289 
	#DIRSEP
 '/'

	)

292 
CURLcode
 
	$fûe_u∂ﬂd
(
c⁄√˘d©a
 *
c⁄n
)

294 
FILEPROTO
 *
fûe
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

295 c⁄° *
dú
 = 
	`°rchr
(
fûe
->
∑th
, 
DIRSEP
);

296 
fd
;

297 
mode
;

298 
CURLcode
 
ªs
=
CURLE_OK
;

299 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

300 *
buf
 = 
d©a
->
°©e
.
buf„r
;

301 
size_t
 
ƒód
;

302 
size_t
 
nwrôe
;

303 
cuæ_off_t
 
byãcou¡
 = 0;

304 
timevÆ
 
now
 = 
	`Cuæ_tvnow
();

305 
°ru˘_°©
 
fûe_°©
;

306 c⁄° * 
buf2
;

312 
c⁄n
->
‰ód_func
 = 
d©a
->
£t
.fread_func;

313 
c⁄n
->
‰ód_ö
 = 
d©a
->
£t
.
ö
;

314 
c⁄n
->
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 = 
buf
;

316 if(!
dú
)

317  
CURLE_FILE_COULDNT_READ_FILE
;

319 if(!
dú
[1])

320  
CURLE_FILE_COULDNT_READ_FILE
;

322 #ifde‡
O_BINARY


323 
	#MODE_DEFAULT
 
O_WRONLY
|
O_CREAT
|
O_BINARY


	)

325 
	#MODE_DEFAULT
 
O_WRONLY
|
O_CREAT


	)

328 if(
d©a
->
°©e
.
ªsume_‰om
)

329 
mode
 = 
MODE_DEFAULT
|
O_APPEND
;

331 
mode
 = 
MODE_DEFAULT
|
O_TRUNC
;

333 
fd
 = 
	`›í
(
fûe
->
∑th
, 
mode
, 
c⁄n
->
d©a
->
£t
.
√w_fûe_≥rms
);

334 if(
fd
 < 0) {

335 
	`Áûf
(
d©a
, "C™'à›í %†f‹ wrôög", 
fûe
->
∑th
);

336  
CURLE_WRITE_ERROR
;

339 if(-1 !
d©a
->
°©e
.
öfûesize
)

341 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, d©a->
°©e
.
öfûesize
);

344 if(
d©a
->
°©e
.
ªsume_‰om
 < 0) {

345 if(
	`f°©
(
fd
, &
fûe_°©
)) {

346 
	`˛o£
(
fd
);

347 
	`Áûf
(
d©a
, "C™'àgëÅhêsizêo‡%s", 
fûe
->
∑th
);

348  
CURLE_WRITE_ERROR
;

351 
d©a
->
°©e
.
ªsume_‰om
 = (
cuæ_off_t
)
fûe_°©
.
°_size
;

354 
ªs
 =
CURLE_OK
) {

355 
ªadcou¡
;

356 
ªs
 = 
	`Cuæ_fûÃódbuf„r
(
c⁄n
, 
BUFSIZE
, &
ªadcou¡
);

357 if(
ªs
)

360 if(
ªadcou¡
 <= 0)

363 
ƒód
 = (
size_t
)
ªadcou¡
;

366 if(
d©a
->
°©e
.
ªsume_‰om
) {

367 if((
cuæ_off_t
)
ƒód
 <
d©a
->
°©e
.
ªsume_‰om
 ) {

368 
d©a
->
°©e
.
ªsume_‰om
 -
ƒód
;

369 
ƒód
 = 0;

370 
buf2
 = 
buf
;

373 
buf2
 = 
buf
 + 
d©a
->
°©e
.
ªsume_‰om
;

374 
ƒód
 -(
size_t
)
d©a
->
°©e
.
ªsume_‰om
;

375 
d©a
->
°©e
.
ªsume_‰om
 = 0;

379 
buf2
 = 
buf
;

382 
nwrôe
 = 
	`wrôe
(
fd
, 
buf2
, 
ƒód
);

383 if(
nwrôe
 !
ƒód
) {

384 
ªs
 = 
CURLE_SEND_ERROR
;

388 
byãcou¡
 +
ƒód
;

390 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 
byãcou¡
);

392 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

393 
ªs
 = 
CURLE_ABORTED_BY_CALLBACK
;

395 
ªs
 = 
	`Cuæ_•ìdcheck
(
d©a
, 
now
);

397 if(!
ªs
 && 
	`Cuæ_pgrsUpd©e
(
c⁄n
))

398 
ªs
 = 
CURLE_ABORTED_BY_CALLBACK
;

400 
	`˛o£
(
fd
);

402  
ªs
;

403 
	}
}

413 
CURLcode
 
	$fûe_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

420 
CURLcode
 
ªs
 = 
CURLE_OK
;

421 
°ru˘_°©
 
°©buf
;

424 
cuæ_off_t
 
ex≥˘ed_size
=0;

425 
boﬁ
 
f°©ed
=
FALSE
;

426 
ssize_t
 
ƒód
;

427 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

428 *
buf
 = 
d©a
->
°©e
.
buf„r
;

429 
cuæ_off_t
 
byãcou¡
 = 0;

430 
fd
;

431 
timevÆ
 
now
 = 
	`Cuæ_tvnow
();

432 
FILEPROTO
 *
fûe
;

434 *
d⁄e
 = 
TRUE
;

436 
	`Cuæ_öôöfo
(
d©a
);

437 
	`Cuæ_pgrsSèπNow
(
d©a
);

439 if(
d©a
->
£t
.
u∂ﬂd
)

440  
	`fûe_u∂ﬂd
(
c⁄n
);

442 
fûe
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

445 
fd
 = 
fûe
->fd;

448 if(-1 !
	`f°©
(
fd
, &
°©buf
)) {

450 
ex≥˘ed_size
 = 
°©buf
.
°_size
;

452 
d©a
->
öfo
.
fûëime
 = ()
°©buf
.
°_mtime
;

453 
f°©ed
 = 
TRUE
;

456 if(
f°©ed
 && !
d©a
->
°©e
.
ønge
 && d©a->
£t
.
timec⁄dôi⁄
) {

457 if(!
	`Cuæ_mìts_timec⁄dôi⁄
(
d©a
, (
time_t
)d©a->
öfo
.
fûëime
)) {

458 *
d⁄e
 = 
TRUE
;

459  
CURLE_OK
;

466 if(
d©a
->
£t
.
›t_no_body
 && d©a->£t.
ö˛ude_hódî
 && 
f°©ed
) {

467 
CURLcode
 
ªsu…
;

468 
	`¢¥ötf
(
buf
, (
d©a
->
°©e
.
buf„r
),

469 "C⁄ã¡-Lígth: %" 
CURL_FORMAT_CURL_OFF_T
 "\r\n", 
ex≥˘ed_size
);

470 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BOTH
, 
buf
, 0);

471 if(
ªsu…
)

472  
ªsu…
;

474 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BOTH
,

476 if(
ªsu…
)

477  
ªsu…
;

479 if(
f°©ed
) {

480 
time_t
 
fûëime
 = (time_t)
°©buf
.
°_mtime
;

481 
tm
 
buf„r
;

482 c⁄° 
tm
 *tm = &
buf„r
;

483 
ªsu…
 = 
	`Cuæ_gmtime
(
fûëime
, &
buf„r
);

484 if(
ªsu…
)

485  
ªsu…
;

488 
	`¢¥ötf
(
buf
, 
BUFSIZE
-1,

490 
Cuæ_wkday
[
tm
->
tm_wday
?tm->tm_wday-1:6],

491 
tm
->
tm_mday
,

492 
Cuæ_m⁄th
[
tm
->
tm_m⁄
],

493 
tm
->
tm_yór
 + 1900,

494 
tm
->
tm_hour
,

495 
tm
->
tm_mö
,

496 
tm
->
tm_£c
);

497 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BOTH
, 
buf
, 0);

501 if(
f°©ed
)

502 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
ex≥˘ed_size
);

503  
ªsu…
;

507 
	`fûe_ønge
(
c⁄n
);

511 if(
d©a
->
°©e
.
ªsume_‰om
 < 0) {

512 if(!
f°©ed
) {

513 
	`Áûf
(
d©a
, "Can't getÅhe size of file.");

514  
CURLE_READ_ERROR
;

517 
d©a
->
°©e
.
ªsume_‰om
 +(
cuæ_off_t
)
°©buf
.
°_size
;

520 if(
d©a
->
°©e
.
ªsume_‰om
 <
ex≥˘ed_size
)

521 
ex≥˘ed_size
 -
d©a
->
°©e
.
ªsume_‰om
;

523 
	`Áûf
(
d©a
, "failedÅoÑesume file://Åransfer");

524  
CURLE_BAD_DOWNLOAD_RESUME
;

528 if(
d©a
->
ªq
.
maxdow∆ﬂd
 > 0)

529 
ex≥˘ed_size
 = 
d©a
->
ªq
.
maxdow∆ﬂd
;

531 if(
f°©ed
 && (
ex≥˘ed_size
 == 0))

532  
CURLE_OK
;

538 if(
f°©ed
)

539 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
ex≥˘ed_size
);

541 if(
d©a
->
°©e
.
ªsume_‰om
) {

542 if(
d©a
->
°©e
.
ªsume_‰om
 !=

543 
	`l£ek
(
fd
, 
d©a
->
°©e
.
ªsume_‰om
, 
SEEK_SET
))

544  
CURLE_BAD_DOWNLOAD_RESUME
;

547 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_STARTTRANSFER
);

549 
ªs
 =
CURLE_OK
) {

551 
size_t
 
byã°‹ód
 =

552 (
ex≥˘ed_size
 < 
	`CURL_OFF_T_C
(
BUFSIZE
) - CURL_OFF_T_C(1)) ?

553 
	`cuæx_sŸouz
(
ex≥˘ed_size
Ë: 
BUFSIZE
 - 1;

555 
ƒód
 = 
	`ªad
(
fd
, 
buf
, 
byã°‹ód
);

557 if(
ƒód
 > 0)

558 
buf
[
ƒód
] = 0;

560 if(
ƒód
 <0 || 
ex≥˘ed_size
 == 0)

563 
byãcou¡
 +
ƒód
;

564 
ex≥˘ed_size
 -
ƒód
;

566 
ªs
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
buf
, 
ƒód
);

567 if(
ªs
)

568  
ªs
;

570 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, 
byãcou¡
);

572 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

573 
ªs
 = 
CURLE_ABORTED_BY_CALLBACK
;

575 
ªs
 = 
	`Cuæ_•ìdcheck
(
d©a
, 
now
);

577 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

578 
ªs
 = 
CURLE_ABORTED_BY_CALLBACK
;

580  
ªs
;

581 
	}
}

	@lib/file.h

1 #i‚de‡
HEADER_CURL_FILE_H


2 
	#HEADER_CURL_FILE_H


	)

29 
	sFILEPROTO
 {

30 *
	m∑th
;

31 *
	m‰ì∑th
;

33 
	mfd
;

36 #i‚de‡
CURL_DISABLE_FILE


37 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_fûe
;

	@lib/fileinfo.c

23 
	~"cuæ_£tup.h
"

25 
	~"°rdup.h
"

26 
	~"fûeöfo.h
"

28 
	#_MPRINTF_REPLACE


	)

29 
	~<cuæ/m¥ötf.h
>

31 
	~"cuæ_mem‹y.h
"

33 
	~"memdebug.h
"

35 
cuæ_fûeöfo
 *
	$Cuæ_fûeöfo_Æloc
()

37 
cuæ_fûeöfo
 *
tmp
 = 
	`mÆloc
((curl_fileinfo));

38 if(!
tmp
)

39  
NULL
;

40 
	`mem£t
(
tmp
, 0, (
cuæ_fûeöfo
));

41  
tmp
;

42 
	}
}

44 
	$Cuæ_fûeöfo_dt‹
(*
u£r
, *
ñemít
)

46 
cuæ_fûeöfo
 *
föfo
 = 
ñemít
;

47 (Ë
u£r
;

48 if(!
föfo
)

51 
	`Cuæ_ß„‰ì
(
föfo
->
b_d©a
);

53 
	`‰ì
(
föfo
);

54 
	}
}

	@lib/fileinfo.h

1 #i‚de‡
HEADER_CURL_FILEINFO_H


2 
	#HEADER_CURL_FILEINFO_H


	)

25 
	~<cuæ/cuæ.h
>

27 
cuæ_fûeöfo
 *
Cuæ_fûeöfo_Æloc
();

29 
Cuæ_fûeöfo_dt‹
(*, *);

31 
cuæ_fûeöfo
 *
Cuæ_fûeöfo_dup
(c⁄° cuæ_fûeöfÿ*
§c
);

	@lib/formdata.c

23 
	~"cuæ_£tup.h
"

25 
	~<cuæ/cuæ.h
>

27 #i‡!
deföed
(
CURL_DISABLE_HTTP
Ë|| deföed(
USE_SSLEAY
)

29 #i‡
deföed
(
HAVE_LIBGEN_H
Ë&& deföed(
HAVE_BASENAME
)

30 
	~<libgí.h
>

33 
	~"uæd©a.h
"

34 
	~"f‹md©a.h
"

35 
	~"vés/vés.h
"

36 
	~"°ªquÆ.h
"

37 
	~"cuæ_mem‹y.h
"

38 
	~"£ndf.h
"

40 
	#_MPRINTF_REPLACE


	)

41 
	~<cuæ/m¥ötf.h
>

44 
	~"memdebug.h
"

48 #i‚de‡
CURL_DISABLE_HTTP


50 #i‚de‡
HAVE_BASENAME


51 *
Cuæ_ba£«me
(*
∑th
);

52 
	#ba£«me
(
x
Ë
	`Cuæ_ba£«me
((x))

	)

55 
size_t
 
ªad‰omfûe
(
F‹m
 *
f‹m
, *
buf„r
, size_à
size
);

56 *
f‹mbound¨y
(
Sessi⁄H™dÀ
 *
d©a
);

60 
	#HTTPPOST_CONTENTTYPE_DEFAULT
 "≠∂iˇti⁄/o˘ë-°ªam"

	)

62 
	#FORM_FILE_SEPARATOR
 ','

	)

63 
	#FORM_TYPE_SEPARATOR
 ';'

	)

75 
cuæ_hâµo°
 *

76 
	$AddHâpPo°
(*
«me
, 
size_t
 
«mñígth
,

77 *
vÆue
, 
size_t
 
c⁄ã¡¶ígth
,

78 *
buf„r
, 
size_t
 
buf„æígth
,

79 *
c⁄ã¡ty≥
,

80 
Êags
,

81 
cuæ_¶i°
* 
c⁄ã¡Hódî
,

82 *
showfûíame
, *
u£Ω
,

83 
cuæ_hâµo°
 *
∑ª¡_po°
,

84 
cuæ_hâµo°
 **
hâµo°
,

85 
cuæ_hâµo°
 **
œ°_po°
)

87 
cuæ_hâµo°
 *
po°
;

88 
po°
 = 
	`ˇŒoc
(1, (
cuæ_hâµo°
));

89 if(
po°
) {

90 
po°
->
«me
 =Çame;

91 
po°
->
«mñígth
 = ()(
«me
?“amñígth?«mñígth:
	`°æí
(name)):0);

92 
po°
->
c⁄ã¡s
 = 
vÆue
;

93 
po°
->
c⁄ã¡¶ígth
 = ()contentslength;

94 
po°
->
buf„r
 = buffer;

95 
po°
->
buf„æígth
 = ()bufferlength;

96 
po°
->
c⁄ã¡ty≥
 = contenttype;

97 
po°
->
c⁄ã¡hódî
 = 
c⁄ã¡Hódî
;

98 
po°
->
showfûíame
 = showfilename;

99 
po°
->
u£Ω
 = userp,

100 
po°
->
Êags
 = flags;

103  
NULL
;

105 if(
∑ª¡_po°
) {

107 
po°
->
m‹e
 = 
∑ª¡_po°
->more;

110 
∑ª¡_po°
->
m‹e
 = 
po°
;

114 if(*
œ°_po°
)

115 (*
œ°_po°
)->
√xt
 = 
po°
;

117 (*
hâµo°
Ë
po°
;

119 (*
œ°_po°
Ë
po°
;

121  
po°
;

122 
	}
}

134 
F‹mInfo
 * 
	$AddF‹mInfo
(*
vÆue
,

135 *
c⁄ã¡ty≥
,

136 
F‹mInfo
 *
∑ª¡_f‹m_öfo
)

138 
F‹mInfo
 *
f‹m_öfo
;

139 
f‹m_öfo
 = 
	`ˇŒoc
(1, (
F‹mInfo
));

140 if(
f‹m_öfo
) {

141 if(
vÆue
)

142 
f‹m_öfo
->
vÆue
 = value;

143 if(
c⁄ã¡ty≥
)

144 
f‹m_öfo
->
c⁄ã¡ty≥
 = contenttype;

145 
f‹m_öfo
->
Êags
 = 
HTTPPOST_FILENAME
;

148  
NULL
;

150 if(
∑ª¡_f‹m_öfo
) {

152 
f‹m_öfo
->
m‹e
 = 
∑ª¡_f‹m_öfo
->more;

155 
∑ª¡_f‹m_öfo
->
m‹e
 = 
f‹m_öfo
;

158  
f‹m_öfo
;

159 
	}
}

171 c⁄° *
	$C⁄ã¡Ty≥F‹Fûíame
(c⁄° *
fûíame
,

172 c⁄° *
¥evty≥
)

174 c⁄° *
c⁄ã¡ty≥
 = 
NULL
;

175 
i
;

180 
	sC⁄ã¡Ty≥
 {

181 c⁄° *
exãnsi⁄
;

182 c⁄° *
ty≥
;

184 c⁄° 
C⁄ã¡Ty≥
 
˘ts
[]={

193 if(
¥evty≥
)

195 
c⁄ã¡ty≥
 = 
¥evty≥
;

197 
c⁄ã¡ty≥
 = 
HTTPPOST_CONTENTTYPE_DEFAULT
;

199 if(
fûíame
) {

200 
i
=0; i<(
˘ts
)/(ctts[0]); i++) {

201 if(
	`°æí
(
fûíame
Ë>°æí(
˘ts
[
i
].
exãnsi⁄
)) {

202 if(
	`°ªquÆ
(
fûíame
 +

203 
	`°æí
(
fûíame
Ë- såÀn(
˘ts
[
i
].
exãnsi⁄
),

204 
˘ts
[
i
].
exãnsi⁄
)) {

205 
c⁄ã¡ty≥
 = 
˘ts
[
i
].
ty≥
;

212  
c⁄ã¡ty≥
;

213 
	}
}

226 *
	$memdup
(c⁄° *
§c
, 
size_t
 
buf„r_Àngth
)

228 
size_t
 
Àngth
;

229 
boﬁ
 
add
 = 
FALSE
;

230 *
buf„r
;

232 if(
buf„r_Àngth
)

233 
Àngth
 = 
buf„r_Àngth
;

234 if(
§c
) {

235 
Àngth
 = 
	`°æí
(
§c
);

236 
add
 = 
TRUE
;

240  
	`°rdup
("");

242 
buf„r
 = 
	`mÆloc
(
Àngth
+
add
);

243 if(!
buf„r
)

244  
NULL
;

246 
	`mem˝y
(
buf„r
, 
§c
, 
Àngth
);

249 if(
add
)

250 
buf„r
[
Àngth
] = '\0';

252  
buf„r
;

253 
	}
}

305 
CURLFORMcode
 
	$F‹mAdd
(
cuæ_hâµo°
 **
hâµo°
,

306 
cuæ_hâµo°
 **
œ°_po°
,

307 
va_li°
 
∑øms
)

309 
F‹mInfo
 *
fú°_f‹m
, *
cuºít_f‹m
, *
f‹m
 = 
NULL
;

310 
CURLFORMcode
 
ªtu∫_vÆue
 = 
CURL_FORMADD_OK
;

311 c⁄° *
¥evty≥
 = 
NULL
;

312 
cuæ_hâµo°
 *
po°
 = 
NULL
;

313 
CURLf‹m›ti⁄
 
›ti⁄
;

314 
cuæ_f‹ms
 *
f‹ms
 = 
NULL
;

315 *
¨øy_vÆue
=
NULL
;

320 
boﬁ
 
¨øy_°©e
 = 
FALSE
;

325 
fú°_f‹m
 = 
	`ˇŒoc
(1, (
F‹mInfo
));

326 if(!
fú°_f‹m
)

327  
CURL_FORMADD_MEMORY
;

329 
cuºít_f‹m
 = 
fú°_f‹m
;

334 
ªtu∫_vÆue
 =
CURL_FORMADD_OK
) {

337 if(
¨øy_°©e
 && 
f‹ms
) {

339 
›ti⁄
 = 
f‹ms
->option;

340 
¨øy_vÆue
 = (*)
f‹ms
->
vÆue
;

342 
f‹ms
++;

343 if(
CURLFORM_END
 =
›ti⁄
) {

345 
¨øy_°©e
 = 
FALSE
;

351 
›ti⁄
 = 
	`va_¨g
(
∑øms
, 
CURLf‹m›ti⁄
);

352 if(
CURLFORM_END
 =
›ti⁄
)

356 
›ti⁄
) {

357 
CURLFORM_ARRAY
:

358 if(
¨øy_°©e
)

360 
ªtu∫_vÆue
 = 
CURL_FORMADD_ILLEGAL_ARRAY
;

362 
f‹ms
 = 
	`va_¨g
(
∑øms
, 
cuæ_f‹ms
 *);

363 if(
f‹ms
)

364 
¨øy_°©e
 = 
TRUE
;

366 
ªtu∫_vÆue
 = 
CURL_FORMADD_NULL
;

373 
CURLFORM_PTRNAME
:

374 #ifde‡
CURL_DOES_CONVERSIONS


380 
cuºít_f‹m
->
Êags
 |
HTTPPOST_PTRNAME
;

382 
CURLFORM_COPYNAME
:

383 if(
cuºít_f‹m
->
«me
)

384 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

386 *
«me
 = 
¨øy_°©e
?

387 
¨øy_vÆue
:
	`va_¨g
(
∑øms
, *);

388 if(
«me
)

389 
cuºít_f‹m
->
«me
 =Çame;

391 
ªtu∫_vÆue
 = 
CURL_FORMADD_NULL
;

394 
CURLFORM_NAMELENGTH
:

395 if(
cuºít_f‹m
->
«mñígth
)

396 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

398 
cuºít_f‹m
->
«mñígth
 =

399 
¨øy_°©e
?(
size_t
)
¨øy_vÆue
:(size_t)
	`va_¨g
(
∑øms
, );

405 
CURLFORM_PTRCONTENTS
:

406 
cuºít_f‹m
->
Êags
 |
HTTPPOST_PTRCONTENTS
;

407 
CURLFORM_COPYCONTENTS
:

408 if(
cuºít_f‹m
->
vÆue
)

409 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

411 *
vÆue
 =

412 
¨øy_°©e
?
¨øy_vÆue
:
	`va_¨g
(
∑øms
, *);

413 if(
vÆue
)

414 
cuºít_f‹m
->
vÆue
 = value;

416 
ªtu∫_vÆue
 = 
CURL_FORMADD_NULL
;

419 
CURLFORM_CONTENTSLENGTH
:

420 if(
cuºít_f‹m
->
c⁄ã¡¶ígth
)

421 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

423 
cuºít_f‹m
->
c⁄ã¡¶ígth
 =

424 
¨øy_°©e
?(
size_t
)
¨øy_vÆue
:(size_t)
	`va_¨g
(
∑øms
, );

428 
CURLFORM_FILECONTENT
:

429 if(
cuºít_f‹m
->
Êags
 & (
HTTPPOST_PTRCONTENTS
|
HTTPPOST_READFILE
))

430 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

432 c⁄° *
fûíame
 = 
¨øy_°©e
?

433 
¨øy_vÆue
:
	`va_¨g
(
∑øms
, *);

434 if(
fûíame
) {

435 
cuºít_f‹m
->
vÆue
 = 
	`°rdup
(
fûíame
);

436 if(!
cuºít_f‹m
->
vÆue
)

437 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

439 
cuºít_f‹m
->
Êags
 |
HTTPPOST_READFILE
;

440 
cuºít_f‹m
->
vÆue_Æloc
 = 
TRUE
;

444 
ªtu∫_vÆue
 = 
CURL_FORMADD_NULL
;

449 
CURLFORM_FILE
:

451 c⁄° *
fûíame
 = 
¨øy_°©e
?
¨øy_vÆue
:

452 
	`va_¨g
(
∑øms
, *);

454 if(
cuºít_f‹m
->
vÆue
) {

455 if(
cuºít_f‹m
->
Êags
 & 
HTTPPOST_FILENAME
) {

456 if(
fûíame
) {

457 *
‚ame
 = 
	`°rdup
(
fûíame
);

458 if(!
‚ame
)

459 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

461 
f‹m
 = 
	`AddF‹mInfo
(
‚ame
, 
NULL
, 
cuºít_f‹m
);

462 if(!
f‹m
) {

463 
	`Cuæ_ß„‰ì
(
‚ame
);

464 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

467 
f‹m
->
vÆue_Æloc
 = 
TRUE
;

468 
cuºít_f‹m
 = 
f‹m
;

469 
f‹m
 = 
NULL
;

474 
ªtu∫_vÆue
 = 
CURL_FORMADD_NULL
;

477 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

480 if(
fûíame
) {

481 
cuºít_f‹m
->
vÆue
 = 
	`°rdup
(
fûíame
);

482 if(!
cuºít_f‹m
->
vÆue
)

483 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

485 
cuºít_f‹m
->
Êags
 |
HTTPPOST_FILENAME
;

486 
cuºít_f‹m
->
vÆue_Æloc
 = 
TRUE
;

490 
ªtu∫_vÆue
 = 
CURL_FORMADD_NULL
;

495 
CURLFORM_BUFFERPTR
:

496 
cuºít_f‹m
->
Êags
 |
HTTPPOST_PTRBUFFER
|
HTTPPOST_BUFFER
;

497 if(
cuºít_f‹m
->
buf„r
)

498 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

500 *
buf„r
 =

501 
¨øy_°©e
?
¨øy_vÆue
:
	`va_¨g
(
∑øms
, *);

502 if(
buf„r
) {

503 
cuºít_f‹m
->
buf„r
 = buffer;

504 
cuºít_f‹m
->
vÆue
 = 
buf„r
;

508 
ªtu∫_vÆue
 = 
CURL_FORMADD_NULL
;

512 
CURLFORM_BUFFERLENGTH
:

513 if(
cuºít_f‹m
->
buf„æígth
)

514 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

516 
cuºít_f‹m
->
buf„æígth
 =

517 
¨øy_°©e
?(
size_t
)
¨øy_vÆue
:(size_t)
	`va_¨g
(
∑øms
, );

520 
CURLFORM_STREAM
:

521 
cuºít_f‹m
->
Êags
 |
HTTPPOST_CALLBACK
;

522 if(
cuºít_f‹m
->
u£Ω
)

523 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

525 *
u£Ω
 =

526 
¨øy_°©e
?
¨øy_vÆue
:
	`va_¨g
(
∑øms
, *);

527 if(
u£Ω
) {

528 
cuºít_f‹m
->
u£Ω
 = userp;

529 
cuºít_f‹m
->
vÆue
 = 
u£Ω
;

535 
ªtu∫_vÆue
 = 
CURL_FORMADD_NULL
;

539 
CURLFORM_CONTENTTYPE
:

541 c⁄° *
c⁄ã¡ty≥
 =

542 
¨øy_°©e
?
¨øy_vÆue
:
	`va_¨g
(
∑øms
, *);

543 if(
cuºít_f‹m
->
c⁄ã¡ty≥
) {

544 if(
cuºít_f‹m
->
Êags
 & 
HTTPPOST_FILENAME
) {

545 if(
c⁄ã¡ty≥
) {

546 *
ty≥
 = 
	`°rdup
(
c⁄ã¡ty≥
);

547 if(!
ty≥
)

548 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

550 
f‹m
 = 
	`AddF‹mInfo
(
NULL
, 
ty≥
, 
cuºít_f‹m
);

551 if(!
f‹m
) {

552 
	`Cuæ_ß„‰ì
(
ty≥
);

553 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

556 
f‹m
->
c⁄ã¡ty≥_Æloc
 = 
TRUE
;

557 
cuºít_f‹m
 = 
f‹m
;

558 
f‹m
 = 
NULL
;

563 
ªtu∫_vÆue
 = 
CURL_FORMADD_NULL
;

566 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

569 if(
c⁄ã¡ty≥
) {

570 
cuºít_f‹m
->
c⁄ã¡ty≥
 = 
	`°rdup
(contenttype);

571 if(!
cuºít_f‹m
->
c⁄ã¡ty≥
)

572 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

574 
cuºít_f‹m
->
c⁄ã¡ty≥_Æloc
 = 
TRUE
;

577 
ªtu∫_vÆue
 = 
CURL_FORMADD_NULL
;

581 
CURLFORM_CONTENTHEADER
:

585 
cuæ_¶i°
* 
li°
 = 
¨øy_°©e
?

586 (
cuæ_¶i°
*)
¨øy_vÆue
:

587 
	`va_¨g
(
∑øms
, 
cuæ_¶i°
*);

589 if(
cuºít_f‹m
->
c⁄ã¡hódî
)

590 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

592 
cuºít_f‹m
->
c⁄ã¡hódî
 = 
li°
;

596 
CURLFORM_FILENAME
:

597 
CURLFORM_BUFFER
:

599 c⁄° *
fûíame
 = 
¨øy_°©e
?
¨øy_vÆue
:

600 
	`va_¨g
(
∑øms
, *);

601 if(
cuºít_f‹m
->
showfûíame
)

602 
ªtu∫_vÆue
 = 
CURL_FORMADD_OPTION_TWICE
;

604 
cuºít_f‹m
->
showfûíame
 = 
	`°rdup
(
fûíame
);

605 if(!
cuºít_f‹m
->
showfûíame
)

606 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

608 
cuºít_f‹m
->
showfûíame_Æloc
 = 
TRUE
;

613 
ªtu∫_vÆue
 = 
CURL_FORMADD_UNKNOWN_OPTION
;

618 if(
CURL_FORMADD_OK
 !
ªtu∫_vÆue
) {

621 
F‹mInfo
 *
±r
;

622 
±r
 = 
fú°_f‹m
;Öå !
NULL
;Öå =Öå->
m‹e
) {

623 if(
±r
->
«me_Æloc
) {

624 
	`Cuæ_ß„‰ì
(
±r
->
«me
);

625 
±r
->
«me_Æloc
 = 
FALSE
;

627 if(
±r
->
vÆue_Æloc
) {

628 
	`Cuæ_ß„‰ì
(
±r
->
vÆue
);

629 
±r
->
vÆue_Æloc
 = 
FALSE
;

631 if(
±r
->
c⁄ã¡ty≥_Æloc
) {

632 
	`Cuæ_ß„‰ì
(
±r
->
c⁄ã¡ty≥
);

633 
±r
->
c⁄ã¡ty≥_Æloc
 = 
FALSE
;

635 if(
±r
->
showfûíame_Æloc
) {

636 
	`Cuæ_ß„‰ì
(
±r
->
showfûíame
);

637 
±r
->
showfûíame_Æloc
 = 
FALSE
;

642 if(
CURL_FORMADD_OK
 =
ªtu∫_vÆue
) {

646 
po°
 = 
NULL
;

647 
f‹m
 = 
fú°_f‹m
;

648 
f‹m
 !
NULL
;

649 
f‹m
 = f‹m->
m‹e
) {

650 if(((!
f‹m
->
«me
 || !f‹m->
vÆue
Ë&& !
po°
) ||

651 –(
f‹m
->
c⁄ã¡¶ígth
) &&

652 (
f‹m
->
Êags
 & 
HTTPPOST_FILENAME
) ) ||

653 –(
f‹m
->
Êags
 & 
HTTPPOST_FILENAME
) &&

654 (
f‹m
->
Êags
 & 
HTTPPOST_PTRCONTENTS
) ) ||

656 –(!
f‹m
->
buf„r
) &&

657 (
f‹m
->
Êags
 & 
HTTPPOST_BUFFER
) &&

658 (
f‹m
->
Êags
 & 
HTTPPOST_PTRBUFFER
) ) ||

660 –(
f‹m
->
Êags
 & 
HTTPPOST_READFILE
) &&

661 (
f‹m
->
Êags
 & 
HTTPPOST_PTRCONTENTS
) )

663 
ªtu∫_vÆue
 = 
CURL_FORMADD_INCOMPLETE
;

667 if(((
f‹m
->
Êags
 & 
HTTPPOST_FILENAME
) ||

668 (
f‹m
->
Êags
 & 
HTTPPOST_BUFFER
)) &&

669 !
f‹m
->
c⁄ã¡ty≥
 ) {

670 *
f
 = 
f‹m
->
Êags
 & 
HTTPPOST_BUFFER
?

671 
f‹m
->
showfûíame
 : f‹m->
vÆue
;

674 
f‹m
->
c⁄ã¡ty≥
 = 
	`°rdup
(
	`C⁄ã¡Ty≥F‹Fûíame
(
f
, 
¥evty≥
));

675 if(!
f‹m
->
c⁄ã¡ty≥
) {

676 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

679 
f‹m
->
c⁄ã¡ty≥_Æloc
 = 
TRUE
;

681 if(!(
f‹m
->
Êags
 & 
HTTPPOST_PTRNAME
) &&

682 (
f‹m
 =
fú°_f‹m
) ) {

685 if(
f‹m
->
«me
)

687 
f‹m
->
«me
 = 
	`memdup
(f‹m->«me, f‹m->
«mñígth
);

688 if(!
f‹m
->
«me
) {

689 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

692 
f‹m
->
«me_Æloc
 = 
TRUE
;

694 if(!(
f‹m
->
Êags
 & (
HTTPPOST_FILENAME
 | 
HTTPPOST_READFILE
 |

695 
HTTPPOST_PTRCONTENTS
 | 
HTTPPOST_PTRBUFFER
 |

696 
HTTPPOST_CALLBACK
)) ) {

698 
f‹m
->
vÆue
 = 
	`memdup
(f‹m->vÆue, f‹m->
c⁄ã¡¶ígth
);

699 if(!
f‹m
->
vÆue
) {

700 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

703 
f‹m
->
vÆue_Æloc
 = 
TRUE
;

705 
po°
 = 
	`AddHâpPo°
(
f‹m
->
«me
, f‹m->
«mñígth
,

706 
f‹m
->
vÆue
, f‹m->
c⁄ã¡¶ígth
,

707 
f‹m
->
buf„r
, f‹m->
buf„æígth
,

708 
f‹m
->
c⁄ã¡ty≥
, f‹m->
Êags
,

709 
f‹m
->
c⁄ã¡hódî
, f‹m->
showfûíame
,

710 
f‹m
->
u£Ω
,

711 
po°
, 
hâµo°
,

712 
œ°_po°
);

714 if(!
po°
) {

715 
ªtu∫_vÆue
 = 
CURL_FORMADD_MEMORY
;

719 if(
f‹m
->
c⁄ã¡ty≥
)

720 
¥evty≥
 = 
f‹m
->
c⁄ã¡ty≥
;

723 if(
CURL_FORMADD_OK
 !
ªtu∫_vÆue
) {

727 
F‹mInfo
 *
±r
;

728 
±r
 = 
f‹m
;Öå !
NULL
;Öå =Öå->
m‹e
) {

729 if(
±r
->
«me_Æloc
) {

730 
	`Cuæ_ß„‰ì
(
±r
->
«me
);

731 
±r
->
«me_Æloc
 = 
FALSE
;

733 if(
±r
->
vÆue_Æloc
) {

734 
	`Cuæ_ß„‰ì
(
±r
->
vÆue
);

735 
±r
->
vÆue_Æloc
 = 
FALSE
;

737 if(
±r
->
c⁄ã¡ty≥_Æloc
) {

738 
	`Cuæ_ß„‰ì
(
±r
->
c⁄ã¡ty≥
);

739 
±r
->
c⁄ã¡ty≥_Æloc
 = 
FALSE
;

741 if(
±r
->
showfûíame_Æloc
) {

742 
	`Cuæ_ß„‰ì
(
±r
->
showfûíame
);

743 
±r
->
showfûíame_Æloc
 = 
FALSE
;

752 
fú°_f‹m
) {

753 
F‹mInfo
 *
±r
 = 
fú°_f‹m
->
m‹e
;

754 
	`Cuæ_ß„‰ì
(
fú°_f‹m
);

755 
fú°_f‹m
 = 
±r
;

758  
ªtu∫_vÆue
;

759 
	}
}

767 
CURLFORMcode
 
	$cuæ_f‹madd
(
cuæ_hâµo°
 **
hâµo°
,

768 
cuæ_hâµo°
 **
œ°_po°
,

771 
va_li°
 
¨g
;

772 
CURLFORMcode
 
ªsu…
;

773 
	`va_°¨t
(
¨g
, 
œ°_po°
);

774 
ªsu…
 = 
	`F‹mAdd
(
hâµo°
, 
œ°_po°
, 
¨g
);

775 
	`va_íd
(
¨g
);

776  
ªsu…
;

777 
	}
}

779 #ifde‡
__VMS


780 
	~<Ábdef.h
>

791 
cuæ_off_t
 
	$VmsRólFûeSize
(c⁄° * 
«me
,

792 c⁄° 
°ru˘_°©
 * 
°©_buf
)

794 
buf„r
[8192];

795 
cuæ_off_t
 
cou¡
;

796 
ªt_°©
;

797 
FILE
 * 
fûe
;

799 
fûe
 = 
	`f›í
(
«me
, "r");

800 if(
fûe
 =
NULL
)

803 
cou¡
 = 0;

804 
ªt_°©
 = 1;

805 
ªt_°©
 > 0) {

806 
ªt_°©
 = 
	`‰ód
(
buf„r
, 1, (buf„r), 
fûe
);

807 if(
ªt_°©
 != 0)

808 
cou¡
 +
ªt_°©
;

810 
	`f˛o£
(
fûe
);

812  
cou¡
;

813 
	}
}

821 
cuæ_off_t
 
	$VmsS≥cülSize
(c⁄° * 
«me
,

822 c⁄° 
°ru˘_°©
 * 
°©_buf
)

824 
°©_buf
->
°_Áb_rfm
) {

825 
FAB$C_VAR
:

826 
FAB$C_VFC
:

827  
	`VmsRólFûeSize
(
«me
, 
°©_buf
);

830  
°©_buf
->
°_size
;

832 
	}
}

836 #i‚de‡
__VMS


837 
	#fûesize
(
«me
, 
°©_d©a
Ë(°©_d©a.
°_size
)

	)

840 
	#fûesize
(
«me
, 
°©_d©a
Ë
	`VmsS≥cülSize
“ame, &°©_d©a)

	)

848 
CURLcode
 
	$AddF‹mD©a
(
F‹mD©a
 **
f‹mp
,

849 
f‹mty≥
 
ty≥
,

850 c⁄° *
löe
,

851 
size_t
 
Àngth
,

852 
cuæ_off_t
 *
size
)

854 
F‹mD©a
 *
√wf‹m
 = 
	`mÆloc
((FormData));

855 if(!
√wf‹m
)

856  
CURLE_OUT_OF_MEMORY
;

857 
√wf‹m
->
√xt
 = 
NULL
;

859 if(
ty≥
 <
FORM_CONTENT
) {

861 if(!
Àngth
)

862 
Àngth
 = 
	`°æí
((*)
löe
);

864 
√wf‹m
->
löe
 = 
	`mÆloc
(
Àngth
+1);

865 if(!
√wf‹m
->
löe
) {

866 
	`‰ì
(
√wf‹m
);

867  
CURLE_OUT_OF_MEMORY
;

869 
	`mem˝y
(
√wf‹m
->
löe
,Üöe, 
Àngth
);

870 
√wf‹m
->
Àngth
 =Üength;

871 
√wf‹m
->
löe
[
Àngth
]=0;

876 
√wf‹m
->
löe
 = (*)line;

878 
√wf‹m
->
ty≥
 =Åype;

880 if(*
f‹mp
) {

881 (*
f‹mp
)->
√xt
 = 
√wf‹m
;

882 *
f‹mp
 = 
√wf‹m
;

885 *
f‹mp
 = 
√wf‹m
;

887 if(
size
) {

888 if(
ty≥
 !
FORM_FILE
)

891 *
size
 +
Àngth
;

895 if(!
	`°ªquÆ
("-", 
√wf‹m
->
löe
)) {

896 
°ru˘_°©
 
fûe
;

897 if(!
	`°©
(
√wf‹m
->
löe
, &
fûe
Ë&& !
	`S_ISDIR
(fûe.
°_mode
))

898 *
size
 +
	`fûesize
(
√wf‹m
->
löe
, 
fûe
);

900  
CURLE_BAD_FUNCTION_ARGUMENT
;

904  
CURLE_OK
;

905 
	}
}

911 
CURLcode
 
	$AddF‹mD©af
(
F‹mD©a
 **
f‹mp
,

912 
cuæ_off_t
 *
size
,

913 c⁄° *
fmt
, ...)

915 
s
[4096];

916 
va_li°
 
≠
;

917 
	`va_°¨t
(
≠
, 
fmt
);

918 
	`v¢¥ötf
(
s
, (s), 
fmt
, 
≠
);

919 
	`va_íd
(
≠
);

921  
	`AddF‹mD©a
(
f‹mp
, 
FORM_DATA
, 
s
, 0, 
size
);

922 
	}
}

928 
	$Cuæ_f‹m˛ón
(
F‹mD©a
 **
f‹m_±r
)

930 
F‹mD©a
 *
√xt
, *
f‹m
;

932 
f‹m
 = *
f‹m_±r
;

933 if(!
f‹m
)

937 
√xt
=
f‹m
->next;

938 if(
f‹m
->
ty≥
 <
FORM_CONTENT
)

939 
	`‰ì
(
f‹m
->
löe
);

940 
	`‰ì
(
f‹m
);

942 } (
f‹m
 = 
√xt
Ë!
NULL
);

944 *
f‹m_±r
 = 
NULL
;

945 
	}
}

954 
	$cuæ_f‹mgë
(
cuæ_hâµo°
 *
f‹m
, *
¨g
,

955 
cuæ_f‹mgë_ˇŒback
 
≠≥nd
)

957 
CURLcode
 
rc
;

958 
cuæ_off_t
 
size
;

959 
F‹mD©a
 *
d©a
, *
±r
;

961 
rc
 = 
	`Cuæ_gëf‹md©a
(
NULL
, &
d©a
, 
f‹m
, NULL, &
size
);

962 if(
rc
 !
CURLE_OK
)

963  ()
rc
;

965 
±r
 = 
d©a
;Öå;Öå =Öå->
√xt
) {

966 if((
±r
->
ty≥
 =
FORM_FILE
Ë|| (±r->ty≥ =
FORM_CALLBACK
)) {

967 
buf„r
[8192];

968 
size_t
 
ƒód
;

969 
F‹m
 
ãmp
;

971 
	`Cuæ_F‹mInô
(&
ãmp
, 
±r
);

974 
ƒód
 = 
	`ªad‰omfûe
(&
ãmp
, 
buf„r
, (buffer));

975 if((
ƒód
 =(
size_t
) -1) ||

976 (
ƒód
 > (
buf„r
)) ||

977 (
ƒód
 !
	`≠≥nd
(
¨g
, 
buf„r
,Çread))) {

978 if(
ãmp
.
Â
)

979 
	`f˛o£
(
ãmp
.
Â
);

980 
	`Cuæ_f‹m˛ón
(&
d©a
);

983 } 
ƒód
);

986 if(
±r
->
Àngth
 !
	`≠≥nd
(
¨g
,Öå->
löe
,Ötr->length)) {

987 
	`Cuæ_f‹m˛ón
(&
d©a
);

992 
	`Cuæ_f‹m˛ón
(&
d©a
);

994 
	}
}

1000 
	$cuæ_f‹m‰ì
(
cuæ_hâµo°
 *
f‹m
)

1002 
cuæ_hâµo°
 *
√xt
;

1004 if(!
f‹m
)

1009 
√xt
=
f‹m
->next;

1012 if(
f‹m
->
m‹e
)

1013 
	`cuæ_f‹m‰ì
(
f‹m
->
m‹e
);

1015 if(!(
f‹m
->
Êags
 & 
HTTPPOST_PTRNAME
Ë&& f‹m->
«me
)

1016 
	`‰ì
(
f‹m
->
«me
);

1017 if(!(
f‹m
->
Êags
 &

1018 (
HTTPPOST_PTRCONTENTS
|
HTTPPOST_BUFFER
|
HTTPPOST_CALLBACK
)) &&

1019 
f‹m
->
c⁄ã¡s
)

1020 
	`‰ì
(
f‹m
->
c⁄ã¡s
);

1021 if(
f‹m
->
c⁄ã¡ty≥
)

1022 
	`‰ì
(
f‹m
->
c⁄ã¡ty≥
);

1023 if(
f‹m
->
showfûíame
)

1024 
	`‰ì
(
f‹m
->
showfûíame
);

1025 
	`‰ì
(
f‹m
);

1027 } (
f‹m
 = 
√xt
Ë!
NULL
);

1028 
	}
}

1030 #i‚de‡
HAVE_BASENAME


1055 *
	$Cuæ_ba£«me
(*
∑th
)

1059 *
s1
;

1060 *
s2
;

1062 
s1
=
	`°ºchr
(
∑th
, '/');

1063 
s2
=
	`°ºchr
(
∑th
, '\\');

1065 if(
s1
 && 
s2
) {

1066 
∑th
 = (
s1
 > 
s2
? s1 : s2)+1;

1068 if(
s1
)

1069 
∑th
 = 
s1
 + 1;

1070 if(
s2
)

1071 
∑th
 = 
s2
 + 1;

1073  
∑th
;

1074 
	}
}

1077 *
	$°rù∑th
(c⁄° *
fuŒfûe
)

1079 *
fûíame
;

1080 *
ba£
;

1081 
fûíame
 = 
	`°rdup
(
fuŒfûe
);

1083 if(!
fûíame
)

1084  
NULL
;

1085 
ba£
 = 
	`°rdup
(
	`ba£«me
(
fûíame
));

1087 
	`‰ì
(
fûíame
);

1089  
ba£
;

1090 
	}
}

1092 
CURLcode
 
	$f‹md©a_add_fûíame
(c⁄° 
cuæ_hâµo°
 *
fûe
,

1093 
F‹mD©a
 **
f‹m
,

1094 
cuæ_off_t
 *
size
)

1096 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1097 *
fûíame
 = 
fûe
->
showfûíame
;

1098 *
fûeba£«me
 = 
NULL
;

1099 *
fûíame_esˇ≥d
 = 
NULL
;

1101 if(!
fûíame
) {

1102 
fûeba£«me
 = 
	`°rù∑th
(
fûe
->
c⁄ã¡s
);

1103 if(!
fûeba£«me
)

1104  
CURLE_OUT_OF_MEMORY
;

1105 
fûíame
 = 
fûeba£«me
;

1108 if(
	`°rchr
(
fûíame
, '\\') || strchr(filename, '"')) {

1109 *
p0
, *
p1
;

1112 
fûíame_esˇ≥d
 = 
	`mÆloc
(
	`°æí
(
fûíame
)*2+1);

1113 if(!
fûíame_esˇ≥d
) {

1114 
	`Cuæ_ß„‰ì
(
fûeba£«me
);

1115  
CURLE_OUT_OF_MEMORY
;

1117 
p0
 = 
fûíame_esˇ≥d
;

1118 
p1
 = 
fûíame
;

1119 *
p1
) {

1120 if(*
p1
 == '\\' || *p1 == '"')

1121 *
p0
++ = '\\';

1122 *
p0
++ = *
p1
++;

1124 *
p0
 = '\0';

1125 
fûíame
 = 
fûíame_esˇ≥d
;

1127 
ªsu…
 = 
	`AddF‹mD©af
(
f‹m
, 
size
,

1129 
fûíame
);

1130 
	`Cuæ_ß„‰ì
(
fûíame_esˇ≥d
);

1131 
	`Cuæ_ß„‰ì
(
fûeba£«me
);

1132  
ªsu…
;

1133 
	}
}

1148 
CURLcode
 
	$Cuæ_gëf‹md©a
(
Sessi⁄H™dÀ
 *
d©a
,

1149 
F‹mD©a
 **
föÆf‹m
,

1150 
cuæ_hâµo°
 *
po°
,

1151 c⁄° *
cu°om_c⁄ã¡_ty≥
,

1152 
cuæ_off_t
 *
sizï
)

1154 
F‹mD©a
 *
f‹m
 = 
NULL
;

1155 
F‹mD©a
 *
fú°f‹m
;

1156 
cuæ_hâµo°
 *
fûe
;

1157 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1159 
cuæ_off_t
 
size
 = 0;

1160 *
bound¨y
;

1161 *
fûebound¨y
 = 
NULL
;

1162 
cuæ_¶i°
* 
curLi°
;

1164 *
föÆf‹m
 = 
NULL
;

1166 if(!
po°
)

1167  
ªsu…
;

1169 
bound¨y
 = 
	`f‹mbound¨y
(
d©a
);

1170 if(!
bound¨y
)

1171  
CURLE_OUT_OF_MEMORY
;

1174 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, 
NULL
,

1176 
cu°om_c⁄ã¡_ty≥
?custom_content_type:

1178 
bound¨y
);

1180 if(
ªsu…
) {

1181 
	`Cuæ_ß„‰ì
(
bound¨y
);

1182  
ªsu…
;

1187 
fú°f‹m
 = 
f‹m
;

1191 if(
size
) {

1192 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, &
size
, "\r\n");

1193 if(
ªsu…
)

1198 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, &
size
, "--%s\r\n", 
bound¨y
);

1199 if(
ªsu…
)

1206 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, &
size
,

1208 if(
ªsu…
)

1211 
ªsu…
 = 
	`AddF‹mD©a
(&
f‹m
, 
FORM_DATA
, 
po°
->
«me
,Öo°->
«mñígth
,

1212 &
size
);

1213 if(
ªsu…
)

1216 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, &
size
, "\"");

1217 if(
ªsu…
)

1220 if(
po°
->
m‹e
) {

1224 
	`Cuæ_ß„‰ì
(
fûebound¨y
);

1225 
fûebound¨y
 = 
	`f‹mbound¨y
(
d©a
);

1226 if(!
fûebound¨y
) {

1227 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1231 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, &
size
,

1234 
fûebound¨y
);

1235 if(
ªsu…
)

1239 
fûe
 = 
po°
;

1247 if(
po°
->
m‹e
) {

1249 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, &
size
,

1252 
fûebound¨y
);

1253 if(
ªsu…
)

1255 
ªsu…
 = 
	`f‹md©a_add_fûíame
(
fûe
, &
f‹m
, &
size
);

1256 if(
ªsu…
)

1259 if(
po°
->
Êags
 & (
HTTPPOST_FILENAME
|
HTTPPOST_BUFFER
|

1260 
HTTPPOST_CALLBACK
)) {

1264 if(
po°
->
showfûíame
 || (po°->
Êags
 & 
HTTPPOST_FILENAME
)) {

1265 
ªsu…
 = 
	`f‹md©a_add_fûíame
(
po°
, &
f‹m
, &
size
);

1268 if(
ªsu…
)

1272 if(
fûe
->
c⁄ã¡ty≥
) {

1274 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, &
size
,

1276 
fûe
->
c⁄ã¡ty≥
);

1277 if(
ªsu…
)

1281 
curLi°
 = 
fûe
->
c⁄ã¡hódî
;

1282 
curLi°
) {

1284 
ªsu…
 = 
	`AddF‹mD©af
–&
f‹m
, &
size
, "\r\n%s", 
curLi°
->
d©a
 );

1285 if(
ªsu…
)

1287 
curLi°
 = curLi°->
√xt
;

1289 if(
ªsu…
)

1292 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, &
size
, "\r\n\r\n");

1293 if(
ªsu…
)

1296 if((
po°
->
Êags
 & 
HTTPPOST_FILENAME
) ||

1297 (
po°
->
Êags
 & 
HTTPPOST_READFILE
)) {

1299 
FILE
 *
fûîód
;

1301 
fûîód
 = 
	`°ªquÆ
("-", 
fûe
->
c⁄ã¡s
)?

1302 
°dö
:
	`f›í
(
fûe
->
c⁄ã¡s
, "rb");

1310 if(
fûîód
) {

1311 if(
fûîód
 !
°dö
) {

1313 
	`f˛o£
(
fûîód
);

1315 
ªsu…
 = 
	`AddF‹mD©a
(&
f‹m
, 
FORM_FILE
, 
fûe
->
c⁄ã¡s
, 0, &
size
);

1323 
size_t
 
ƒód
;

1324 
buf„r
[512];

1325 (
ƒód
 = 
	`‰ód
(
buf„r
, 1, (buf„r), 
fûîód
)) != 0) {

1326 
ªsu…
 = 
	`AddF‹mD©a
(&
f‹m
, 
FORM_CONTENT
, 
buf„r
, 
ƒód
, &
size
);

1327 if(
ªsu…
)

1333 if(
d©a
)

1334 
	`Áûf
(
d©a
, "couldn'à›í fûê\"%s\"", 
fûe
->
c⁄ã¡s
);

1335 *
föÆf‹m
 = 
NULL
;

1336 
ªsu…
 = 
CURLE_READ_ERROR
;

1339 if(
po°
->
Êags
 & 
HTTPPOST_BUFFER
)

1341 
ªsu…
 = 
	`AddF‹mD©a
(&
f‹m
, 
FORM_CONTENT
, 
po°
->
buf„r
,

1342 
po°
->
buf„æígth
, &
size
);

1343 if(
po°
->
Êags
 & 
HTTPPOST_CALLBACK
)

1346 
ªsu…
 = 
	`AddF‹mD©a
(&
f‹m
, 
FORM_CALLBACK
, 
po°
->
u£Ω
,

1347 
po°
->
c⁄ã¡¶ígth
, &
size
);

1350 
ªsu…
 = 
	`AddF‹mD©a
(&
f‹m
, 
FORM_CONTENT
, 
po°
->
c⁄ã¡s
,

1351 
po°
->
c⁄ã¡¶ígth
, &
size
);

1353 
fûe
 = fûe->
m‹e
;

1354 } 
fûe
 && !
ªsu…
);

1356 if(
ªsu…
)

1359 if(
po°
->
m‹e
) {

1362 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, &
size
,

1364 
fûebound¨y
);

1365 if(
ªsu…
)

1369 } (
po°
 =Öo°->
√xt
Ë!
NULL
);

1372 if(
CURLE_OK
 =
ªsu…
)

1373 
ªsu…
 = 
	`AddF‹mD©af
(&
f‹m
, &
size
,

1375 
bound¨y
);

1377 if(
ªsu…
) {

1378 
	`Cuæ_f‹m˛ón
(&
fú°f‹m
);

1379 
	`Cuæ_ß„‰ì
(
fûebound¨y
);

1380 
	`Cuæ_ß„‰ì
(
bound¨y
);

1381  
ªsu…
;

1384 *
sizï
 = 
size
;

1386 
	`Cuæ_ß„‰ì
(
fûebound¨y
);

1387 
	`Cuæ_ß„‰ì
(
bound¨y
);

1389 *
föÆf‹m
 = 
fú°f‹m
;

1391  
ªsu…
;

1392 
	}
}

1398 
	$Cuæ_F‹mInô
(
F‹m
 *
f‹m
, 
F‹mD©a
 *
f‹md©a
 )

1400 if(!
f‹md©a
)

1403 
f‹m
->
d©a
 = 
f‹md©a
;

1404 
f‹m
->
£¡
 = 0;

1405 
f‹m
->
Â
 = 
NULL
;

1406 
f‹m
->
‰ód_func
 = 
ZERO_NULL
;

1409 
	}
}

1411 #i‚de‡
__VMS


1412 
	#f›í_ªad
 
f›í


	)

1422 
	#f›í_ªad
 
vmsf›íªad


	)

1423 
FILE
 * 
	$vmsf›íªad
(c⁄° *
fûe
, c⁄° *
mode
) {

1424 
°ru˘_°©
 
°©buf
;

1425 
ªsu…
;

1427 
ªsu…
 = 
	`°©
(
fûe
, &
°©buf
);

1429 
°©buf
.
°_Áb_rfm
) {

1430 
FAB$C_VAR
:

1431 
FAB$C_VFC
:

1432 
FAB$C_STMCR
:

1433  
	`f›í
(
fûe
, "r");

1436  
	`f›í
(
fûe
, "r", "rfm=stmlf", "ctx=stm");

1438 
	}
}

1448 
size_t
 
	$ªad‰omfûe
(
F‹m
 *
f‹m
, *
buf„r
,

1449 
size_t
 
size
)

1451 
size_t
 
ƒód
;

1452 
boﬁ
 
ˇŒback
 = (
f‹m
->
d©a
->
ty≥
 =
FORM_CALLBACK
)?
TRUE
:
FALSE
;

1454 if(
ˇŒback
) {

1455 if(
f‹m
->
‰ód_func
 =
ZERO_NULL
)

1458 
ƒód
 = 
f‹m
->
	`‰ód_func
(
buf„r
, 1, 
size
, f‹m->
d©a
->
löe
);

1461 if(!
f‹m
->
Â
) {

1463 
f‹m
->
Â
 = 
	`f›í_ªad
(f‹m->
d©a
->
löe
, "rb");

1464 if(!
f‹m
->
Â
)

1465  (
size_t
)-1;

1467 
ƒód
 = 
	`‰ód
(
buf„r
, 1, 
size
, 
f‹m
->
Â
);

1469 if(!
ƒód
) {

1471 if(
f‹m
->
Â
) {

1472 
	`f˛o£
(
f‹m
->
Â
);

1473 
f‹m
->
Â
 = 
NULL
;

1475 
f‹m
->
d©a
 = f‹m->d©a->
√xt
;

1478  
ƒód
;

1479 
	}
}

1485 
size_t
 
	$Cuæ_F‹mRódî
(*
buf„r
,

1486 
size_t
 
size
,

1487 
size_t
 
nôems
,

1488 
FILE
 *
myd©a
)

1490 
F‹m
 *
f‹m
;

1491 
size_t
 
w™ãdsize
;

1492 
size_t
 
gŸsize
 = 0;

1494 
f‹m
=(
F‹m
 *)
myd©a
;

1496 
w™ãdsize
 = 
size
 * 
nôems
;

1498 if(!
f‹m
->
d©a
)

1501 if((
f‹m
->
d©a
->
ty≥
 =
FORM_FILE
) ||

1502 (
f‹m
->
d©a
->
ty≥
 =
FORM_CALLBACK
)) {

1503 
gŸsize
 = 
	`ªad‰omfûe
(
f‹m
, 
buf„r
, 
w™ãdsize
);

1505 if(
gŸsize
)

1507  
gŸsize
;

1511 if((
f‹m
->
d©a
->
Àngth
 - f‹m->
£¡
 ) > 
w™ãdsize
 - 
gŸsize
) {

1513 
	`mem˝y
(
buf„r
 + 
gŸsize
 , 
f‹m
->
d©a
->
löe
 + f‹m->
£¡
,

1514 
w™ãdsize
 - 
gŸsize
);

1516 
f‹m
->
£¡
 +
w™ãdsize
-
gŸsize
;

1518  
w™ãdsize
;

1521 
	`mem˝y
(
buf„r
+
gŸsize
,

1522 
f‹m
->
d©a
->
löe
 + f‹m->
£¡
,

1523 (
f‹m
->
d©a
->
Àngth
 - f‹m->
£¡
) );

1524 
gŸsize
 +
f‹m
->
d©a
->
Àngth
 - f‹m->
£¡
;

1526 
f‹m
->
£¡
 = 0;

1528 
f‹m
->
d©a
 = f‹m->d©a->
√xt
;

1530 } 
f‹m
->
d©a
 && (f‹m->d©a->
ty≥
 < 
FORM_CALLBACK
));

1534  
gŸsize
;

1535 
	}
}

1542 *
	$Cuæ_f‹mpo°hódî
(*
f‹mp
, 
size_t
 *
Àn
)

1544 *
hódî
;

1545 
F‹m
 *
f‹m
=(F‹m *)
f‹mp
;

1547 if(!
f‹m
->
d©a
)

1550 
hódî
 = 
f‹m
->
d©a
->
löe
;

1551 *
Àn
 = 
f‹m
->
d©a
->
Àngth
;

1553 
f‹m
->
d©a
 = f‹m->d©a->
√xt
;

1555  
hódî
;

1556 
	}
}

1562 *
	$f‹mbound¨y
(
Sessi⁄H™dÀ
 *
d©a
)

1566  
	`≠rötf
("------------------------%08x%08x",

1567 
	`Cuæ_ønd
(
d©a
), Curl_rand(data));

1568 
	}
}

1571 
CURLFORMcode
 
	$cuæ_f‹madd
(
cuæ_hâµo°
 **
hâµo°
,

1572 
cuæ_hâµo°
 **
œ°_po°
,

1575 ()
hâµo°
;

1576 ()
œ°_po°
;

1577  
CURL_FORMADD_DISABLED
;

1578 
	}
}

1580 
	$cuæ_f‹mgë
(
cuæ_hâµo°
 *
f‹m
, *
¨g
,

1581 
cuæ_f‹mgë_ˇŒback
 
≠≥nd
)

1583 (Ë
f‹m
;

1584 (Ë
¨g
;

1585 (Ë
≠≥nd
;

1586  
CURL_FORMADD_DISABLED
;

1587 
	}
}

1589 
	$cuæ_f‹m‰ì
(
cuæ_hâµo°
 *
f‹m
)

1591 ()
f‹m
;

1593 
	}
}

	@lib/formdata.h

1 #i‚de‡
HEADER_CURL_FORMDATA_H


2 
	#HEADER_CURL_FORMDATA_H


	)

25 
	ef‹mty≥
 {

26 
	mFORM_DATA
,

27 
	mFORM_CONTENT
,

28 
	mFORM_CALLBACK
,

30 
	mFORM_FILE


35 
	sF‹mD©a
 {

36 
F‹mD©a
 *
	m√xt
;

37 
f‹mty≥
 
	mty≥
;

38 *
	mlöe
;

39 
size_t
 
	mÀngth
;

42 
	sF‹m
 {

43 
F‹mD©a
 *
	md©a
;

44 
size_t
 
	m£¡
;

46 
FILE
 *
	mÂ
;

47 
cuæ_ªad_ˇŒback
 
	m‰ód_func
;

51 
	sF‹mInfo
 {

52 *
	m«me
;

53 
boﬁ
 
	m«me_Æloc
;

54 
size_t
 
	m«mñígth
;

55 *
	mvÆue
;

56 
boﬁ
 
	mvÆue_Æloc
;

57 
size_t
 
	mc⁄ã¡¶ígth
;

58 *
	mc⁄ã¡ty≥
;

59 
boﬁ
 
	mc⁄ã¡ty≥_Æloc
;

60 
	mÊags
;

61 *
	mbuf„r
;

62 
size_t
 
	mbuf„æígth
;

63 *
	mshowfûíame
;

65 
boﬁ
 
	mshowfûíame_Æloc
;

66 *
	mu£Ω
;

67 
cuæ_¶i°
* 
	mc⁄ã¡hódî
;

68 
F‹mInfo
 *
	mm‹e
;

69 } 
	tF‹mInfo
;

71 
Cuæ_F‹mInô
(
F‹m
 *
f‹m
, 
F‹mD©a
 *
f‹md©a
 );

73 
CURLcode
 
Cuæ_gëf‹md©a
(
Sessi⁄H™dÀ
 *
d©a
,

74 
F‹mD©a
 **,

75 
cuæ_hâµo°
 *
po°
,

76 c⁄° *
cu°om_c⁄ã¡ty≥
,

77 
cuæ_off_t
 *
size
);

80 
size_t
 
Cuæ_F‹mRódî
(*
buf„r
,

81 
size_t
 
size
,

82 
size_t
 
nôems
,

83 
FILE
 *
myd©a
);

90 *
Cuæ_f‹mpo°hódî
(*
f‹mp
, 
size_t
 *
Àn
);

92 *
Cuæ_F‹mBound¨y
();

94 
Cuæ_f‹m˛ón
(
F‹mD©a
 **);

96 
CURLcode
 
Cuæ_f‹mc⁄vît
(
Sessi⁄H™dÀ
 *, 
F‹mD©a
 *);

	@lib/ftp.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_FTP


27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

30 #ifde‡
HAVE_ARPA_INET_H


31 
	~<¨∑/öë.h
>

33 #ifde‡
HAVE_UTSNAME_H


34 
	~<sys/ut¢ame.h
>

36 #ifde‡
HAVE_NETDB_H


37 
	~<√tdb.h
>

39 #ifde‡
__VMS


40 
	~<ö.h
>

41 
	~<öë.h
>

44 #i‡(
deföed
(
NETWARE
Ë&& deföed(
__NOVELL_LIBC__
))

45 #unde‡
ö_addr_t


46 
	#ö_addr_t
 

	)

49 
	~<cuæ/cuæ.h
>

50 
	~"uæd©a.h
"

51 
	~"£ndf.h
"

52 
	~"if2ù.h
"

53 
	~"ho°ù.h
"

54 
	~"¥ogªss.h
"

55 
	~"å™s„r.h
"

56 
	~"esˇ≥.h
"

57 
	~"hâp.h
"

58 
	~"socks.h
"

59 
	~"·p.h
"

60 
	~"fûeöfo.h
"

61 
	~"·∂i°∑r£r.h
"

62 
	~"cuæ_£c.h
"

63 
	~"°πoof·.h
"

64 
	~"°ªquÆ.h
"

65 
	~"vés/vés.h
"

66 
	~"c⁄√˘.h
"

67 
	~"°ªº‹.h
"

68 
	~"öë_¡›.h
"

69 
	~"öë_±⁄.h
"

70 
	~"£À˘.h
"

71 
	~"∑r£d©e.h
"

72 
	~"sockaddr.h
"

73 
	~"mu…iif.h
"

74 
	~"uæ.h
"

75 
	~"øw°r.h
"

76 
	~"•ìdcheck.h
"

77 
	~"w¨∆ess.h
"

78 
	~"hâp_¥oxy.h
"

79 
	~"n⁄-ascii.h
"

81 
	#_MPRINTF_REPLACE


	)

82 
	~<cuæ/m¥ötf.h
>

84 
	~"cuæ_mem‹y.h
"

86 
	~"memdebug.h
"

88 #i‚de‡
NI_MAXHOST


89 
	#NI_MAXHOST
 1025

	)

91 #i‚de‡
INET_ADDRSTRLEN


92 
	#INET_ADDRSTRLEN
 16

	)

95 #ifde‡
CURL_DISABLE_VERBOSE_STRINGS


96 
	#·p_∑sv_vîbo£
(
a
,
b
,
c
,
d
Ë
Cuæ_n›_°mt


	)

100 #i‚de‡
DEBUGBUILD


101 
_°©e
(
c⁄√˘d©a
 *
c⁄n
,

102 
·p°©e
 
√w°©e
);

103 
	#°©e
(
x
,
y
Ë
	`_°©e
(x,y)

	)

105 
_°©e
(
c⁄√˘d©a
 *
c⁄n
,

106 
·p°©e
 
√w°©e
,

107 
löío
);

108 
	#°©e
(
x
,
y
Ë
	`_°©e
(x,y,
__LINE__
)

	)

111 
CURLcode
 
·p_£ndquŸe
(
c⁄√˘d©a
 *
c⁄n
,

112 
cuæ_¶i°
 *
quŸe
);

113 
CURLcode
 
·p_quô
(
c⁄√˘d©a
 *
c⁄n
);

114 
CURLcode
 
·p_∑r£_uæ_∑th
(
c⁄√˘d©a
 *
c⁄n
);

115 
CURLcode
 
·p_ªguœr_å™s„r
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

116 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


117 
·p_∑sv_vîbo£
(
c⁄√˘d©a
 *
c⁄n
,

118 
Cuæ_addröfo
 *
ai
,

119 *
√who°
,

120 
p‹t
);

122 
CURLcode
 
·p_°©e_¥ï¨e_å™s„r
(
c⁄√˘d©a
 *
c⁄n
);

123 
CURLcode
 
·p_°©e_mdtm
(
c⁄√˘d©a
 *
c⁄n
);

124 
CURLcode
 
·p_°©e_quŸe
(
c⁄√˘d©a
 *
c⁄n
,

125 
boﬁ
 
öô
, 
·p°©e
 
ö°©e
);

126 
CURLcode
 
·p_nb_ty≥
(
c⁄√˘d©a
 *
c⁄n
,

127 
boﬁ
 
ascii
, 
·p°©e
 
√w°©e
);

128 
·p_√ed_ty≥
(
c⁄√˘d©a
 *
c⁄n
,

129 
boﬁ
 
ascii
);

130 
CURLcode
 
·p_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

131 
CURLcode
 
·p_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

132 
CURLcode
, 
boﬁ
 
¥em©uª
);

133 
CURLcode
 
·p_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

134 
CURLcode
 
·p_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
);

135 
CURLcode
 
·p_do_m‹e
(
c⁄√˘d©a
 *
c⁄n
, *
com∂ëed
);

136 
CURLcode
 
·p_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

137 
·p_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

138 
numsocks
);

139 
·p_dom‹e_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

140 
numsocks
);

141 
CURLcode
 
·p_doög
(
c⁄√˘d©a
 *
c⁄n
,

142 
boﬁ
 *
d›ha£_d⁄e
);

143 
CURLcode
 
·p_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 * 
c⁄n
);

145 
CURLcode
 
öô_wc_d©a
(
c⁄√˘d©a
 *
c⁄n
);

146 
CURLcode
 
wc_°©emach
(
c⁄√˘d©a
 *
c⁄n
);

148 
wc_d©a_dt‹
(*
±r
);

150 
CURLcode
 
·p_°©e_ªå
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_off_t
 
fûesize
);

152 
CURLcode
 
·p_ªadª•
(
cuæ_sockë_t
 
sockfd
,

153 
pögp⁄g
 *
µ
,

154 *
·pcode
,

155 
size_t
 *
size
);

156 
CURLcode
 
·p_d›ha£_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

157 
boﬁ
 
c⁄√˘ed
);

160 
	#PPSENDF
(
x
,
y
,
z
Ëif((
ªsu…
 = 
	`Cuæ_µ_£ndf
(x,y,z)Ë!
CURLE_OK
) \

161  
ªsu…


	)

168 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_·p
 = {

170 
·p_£tup_c⁄√˘i⁄
,

171 
·p_do
,

172 
·p_d⁄e
,

173 
·p_do_m‹e
,

174 
·p_c⁄√˘
,

175 
·p_mu…i_°©emach
,

176 
·p_doög
,

177 
·p_gësock
,

178 
·p_gësock
,

179 
·p_dom‹e_gësock
,

180 
ZERO_NULL
,

181 
·p_disc⁄√˘
,

182 
ZERO_NULL
,

183 
PORT_FTP
,

184 
CURLPROTO_FTP
,

185 
PROTOPT_DUAL
 | 
PROTOPT_CLOSEACTION
 | 
PROTOPT_NEEDSPWD


186 | 
PROTOPT_NOURLQUERY


190 #ifde‡
USE_SSL


195 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_·ps
 = {

197 
·p_£tup_c⁄√˘i⁄
,

198 
·p_do
,

199 
·p_d⁄e
,

200 
·p_do_m‹e
,

201 
·p_c⁄√˘
,

202 
·p_mu…i_°©emach
,

203 
·p_doög
,

204 
·p_gësock
,

205 
·p_gësock
,

206 
·p_dom‹e_gësock
,

207 
ZERO_NULL
,

208 
·p_disc⁄√˘
,

209 
ZERO_NULL
,

210 
PORT_FTPS
,

211 
CURLPROTO_FTPS
,

212 
PROTOPT_SSL
 | 
PROTOPT_DUAL
 | 
PROTOPT_CLOSEACTION
 |

213 
PROTOPT_NEEDSPWD
 | 
PROTOPT_NOURLQUERY


217 #i‚de‡
CURL_DISABLE_HTTP


222 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_·p_¥oxy
 = {

224 
Cuæ_hâp_£tup_c⁄n
,

225 
Cuæ_hâp
,

226 
Cuæ_hâp_d⁄e
,

227 
ZERO_NULL
,

228 
ZERO_NULL
,

229 
ZERO_NULL
,

230 
ZERO_NULL
,

231 
ZERO_NULL
,

232 
ZERO_NULL
,

233 
ZERO_NULL
,

234 
ZERO_NULL
,

235 
ZERO_NULL
,

236 
ZERO_NULL
,

237 
PORT_FTP
,

238 
CURLPROTO_HTTP
,

239 
PROTOPT_NONE


243 #ifde‡
USE_SSL


248 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_·ps_¥oxy
 = {

250 
Cuæ_hâp_£tup_c⁄n
,

251 
Cuæ_hâp
,

252 
Cuæ_hâp_d⁄e
,

253 
ZERO_NULL
,

254 
ZERO_NULL
,

255 
ZERO_NULL
,

256 
ZERO_NULL
,

257 
ZERO_NULL
,

258 
ZERO_NULL
,

259 
ZERO_NULL
,

260 
ZERO_NULL
,

261 
ZERO_NULL
,

262 
ZERO_NULL
,

263 
PORT_FTPS
,

264 
CURLPROTO_HTTP
,

265 
PROTOPT_NONE


281 
	#CURL_FTP_HTTPSTYLE_HEAD
 1

	)

283 
	$‰ìdús
(
·p_c⁄n
 *
·pc
)

285 
i
;

286 if(
·pc
->
dús
) {

287 
i
=0; i < 
·pc
->
dúdïth
; i++) {

288 if(
·pc
->
dús
[
i
]) {

289 
	`‰ì
(
·pc
->
dús
[
i
]);

290 
·pc
->
dús
[
i
]=
NULL
;

293 
	`‰ì
(
·pc
->
dús
);

294 
·pc
->
dús
 = 
NULL
;

295 
·pc
->
dúdïth
 = 0;

297 if(
·pc
->
fûe
) {

298 
	`‰ì
(
·pc
->
fûe
);

299 
·pc
->
fûe
 = 
NULL
;

301 
	}
}

309 
boﬁ
 
	$isBadFçSåög
(c⁄° *
°rög
)

311  ((
NULL
 !
	`°rchr
(
°rög
, '\r')) ||

312 (
NULL
 !
	`°rchr
(
°rög
, '\n'))Ë? 
TRUE
 : 
FALSE
;

313 
	}
}

323 
CURLcode
 
	$Ac˚±SîvîC⁄√˘
(
c⁄√˘d©a
 *
c⁄n
)

325 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

326 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
SECONDARYSOCKET
];

327 
cuæ_sockë_t
 
s
 = 
CURL_SOCKET_BAD
;

328 #ifde‡
ENABLE_IPV6


329 
Cuæ_sockaddr_°‹age
 
add
;

331 
sockaddr_ö
 
add
;

333 
cuæ_sockÀn_t
 
size
 = (cuæ_sockÀn_tË(
add
);

335 if(0 =
	`gësock«me
(
sock
, (
sockaddr
 *Ë&
add
, &
size
)) {

336 
size
 = (
add
);

338 
s
=
	`ac˚±
(
sock
, (
sockaddr
 *Ë&
add
, &
size
);

340 
	`Cuæ_˛o£sockë
(
c⁄n
, 
sock
);

342 if(
CURL_SOCKET_BAD
 =
s
) {

343 
	`Áûf
(
d©a
, "Erroráccept()ing server connect");

344  
CURLE_FTP_PORT_FAILED
;

346 
	`öfof
(
d©a
, "Connectionáccepted from server\n");

348 
c⁄n
->
sock
[
SECONDARYSOCKET
] = 
s
;

349 
	`cuæx_n⁄block
(
s
, 
TRUE
);

350 
c⁄n
->
sock_ac˚±ed
[
SECONDARYSOCKET
] = 
TRUE
;

352 if(
d©a
->
£t
.
fsock›t
) {

353 
îr‹
 = 0;

356 
îr‹
 = 
d©a
->
£t
.
	`fsock›t
(d©a->£t.
sock›t_˛õ¡
,

357 
s
,

358 
CURLSOCKTYPE_ACCEPT
);

360 if(
îr‹
) {

361 
	`Cuæ_˛o£sockë
(
c⁄n
, 
s
);

362 
c⁄n
->
sock
[
SECONDARYSOCKET
] = 
CURL_SOCKET_BAD
;

363  
CURLE_ABORTED_BY_CALLBACK
;

367  
CURLE_OK
;

369 
	}
}

380 
	$·p_timñe·_ac˚±
(
Sessi⁄H™dÀ
 *
d©a
)

382 
timeout_ms
 = 
DEFAULT_ACCEPT_TIMEOUT
;

383 
Ÿhî
;

384 
timevÆ
 
now
;

386 if(
d©a
->
£t
.
ac˚±timeout
 > 0)

387 
timeout_ms
 = 
d©a
->
£t
.
ac˚±timeout
;

389 
now
 = 
	`Cuæ_tvnow
();

392 
Ÿhî
 = 
	`Cuæ_timñe·
(
d©a
, &
now
, 
FALSE
);

393 if(
Ÿhî
 && (Ÿhî < 
timeout_ms
))

396 
timeout_ms
 = 
Ÿhî
;

399 
timeout_ms
 -
	`Cuæ_tvdiff
(
now
, 
d©a
->
¥ogªss
.
t_ac˚±d©a
);

400 if(!
timeout_ms
)

405  
timeout_ms
;

406 
	}
}

418 
CURLcode
 
	$Re˚ivedSîvîC⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
ª˚ived
)

420 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

421 
cuæ_sockë_t
 
˘æ_sock
 = 
c⁄n
->
sock
[
FIRSTSOCKET
];

422 
cuæ_sockë_t
 
d©a_sock
 = 
c⁄n
->
sock
[
SECONDARYSOCKET
];

423 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

424 
pögp⁄g
 *
µ
 = &
·pc
->pp;

425 
ªsu…
;

426 
timeout_ms
;

427 
ssize_t
 
ƒód
;

428 
·pcode
;

430 *
ª˚ived
 = 
FALSE
;

432 
timeout_ms
 = 
	`·p_timñe·_ac˚±
(
d©a
);

433 
	`öfof
(
d©a
, "Checking for server connect\n");

434 if(
timeout_ms
 < 0) {

436 
	`Áûf
(
d©a
, "AcceptÅimeout occurred while waiting server connect");

437  
CURLE_FTP_ACCEPT_TIMEOUT
;

441 if(
µ
->
ˇche_size
 &&Öp->
ˇche
 &&Öp->cache[0] > '3') {

443 
	`öfof
(
d©a
, "There isÇegativeÑesponse in cache while serv connect\n");

444 
	`Cuæ_GëFTPRe•⁄£
(&
ƒód
, 
c⁄n
, &
·pcode
);

445  
CURLE_FTP_ACCEPT_FAILED
;

448 
ªsu…
 = 
	`Cuæ_sockë_check
(
˘æ_sock
, 
d©a_sock
, 
CURL_SOCKET_BAD
, 0);

451 
ªsu…
) {

454 
	`Áûf
(
d©a
, "Error while waiting for server connect");

455  
CURLE_FTP_ACCEPT_FAILED
;

460 if(
ªsu…
 & 
CURL_CSELECT_IN2
) {

461 
	`öfof
(
d©a
, "ReadyÅoáccept data connection from server\n");

462 *
ª˚ived
 = 
TRUE
;

464 if(
ªsu…
 & 
CURL_CSELECT_IN
) {

465 
	`öfof
(
d©a
, "Ctrl conn has data while waiting for data conn\n");

466 
	`Cuæ_GëFTPRe•⁄£
(&
ƒód
, 
c⁄n
, &
·pcode
);

468 if(
·pcode
/100 > 3)

469  
CURLE_FTP_ACCEPT_FAILED
;

471  
CURLE_FTP_WEIRD_SERVER_REPLY
;

477  
CURLE_OK
;

478 
	}
}

489 
CURLcode
 
	$InôüãTøns„r
(
c⁄√˘d©a
 *
c⁄n
)

491 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

492 
FTP
 *
·p
 = 
d©a
->
ªq
.
¥Ÿ›
;

493 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

495 if(
c⁄n
->
s¶
[
SECONDARYSOCKET
].
u£
) {

498 
	`öfof
(
d©a
, "DoingÅhe SSL/TLS handshake onÅhe data stream\n");

499 
ªsu…
 = 
	`Cuæ_s¶_c⁄√˘
(
c⁄n
, 
SECONDARYSOCKET
);

500 if(
ªsu…
)

501  
ªsu…
;

504 if(
c⁄n
->
¥Ÿo
.
·pc
.
°©e_ßved
 =
FTP_STOR
) {

505 *(
·p
->
byãcou¡p
)=0;

510 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, d©a->
°©e
.
öfûesize
);

513 
	`Cuæ_¢dbuf£t
(
c⁄n
->
sock
[
SECONDARYSOCKET
]);

515 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
,

516 
SECONDARYSOCKET
, 
·p
->
byãcou¡p
);

520 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
SECONDARYSOCKET
,

521 
c⁄n
->
¥Ÿo
.
·pc
.
ªå_size_ßved
, 
FALSE
,

522 
·p
->
byãcou¡p
, -1, 
NULL
);

525 
c⁄n
->
¥Ÿo
.
·pc
.
µ
.
≥ndög_ª•
 = 
TRUE
;

526 
	`°©e
(
c⁄n
, 
FTP_STOP
);

528  
CURLE_OK
;

529 
	}
}

540 
CURLcode
 
	$AŒowSîvîC⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
c⁄√˘ed
)

542 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

543 
timeout_ms
;

544 
CURLcode
 
ªt
 = 
CURLE_OK
;

546 *
c⁄√˘ed
 = 
FALSE
;

547 
	`öfof
(
d©a
, "Preparing foráccepting server on dataÖort\n");

550 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_STARTACCEPT
);

552 
timeout_ms
 = 
	`·p_timñe·_ac˚±
(
d©a
);

553 if(
timeout_ms
 < 0) {

555 
	`Áûf
(
d©a
, "AcceptÅimeout occurred while waiting server connect");

556  
CURLE_FTP_ACCEPT_TIMEOUT
;

560 
ªt
 = 
	`Re˚ivedSîvîC⁄√˘
(
c⁄n
, 
c⁄√˘ed
);

561 if(
ªt
)

562  
ªt
;

564 if(*
c⁄√˘ed
) {

565 
ªt
 = 
	`Ac˚±SîvîC⁄√˘
(
c⁄n
);

566 if(
ªt
)

567  
ªt
;

569 
ªt
 = 
	`InôüãTøns„r
(
c⁄n
);

570 if(
ªt
)

571  
ªt
;

575 if(
ªt
 =
CURLE_OK
 && *
c⁄√˘ed
 =
FALSE
) {

576 if(
d©a
->
£t
.
ac˚±timeout
 > 0)

577 
	`Cuæ_expúe
(
d©a
, d©a->
£t
.
ac˚±timeout
);

579 
	`Cuæ_expúe
(
d©a
, 
DEFAULT_ACCEPT_TIMEOUT
);

583  
ªt
;

584 
	}
}

588 
	#STATUSCODE
(
löe
Ë(
	`ISDIGIT
(line[0]) && ISDIGIT(line[1]) && \

589 
	`ISDIGIT
(
löe
[2]))

	)

592 
	#LASTLINE
(
löe
Ë(
	`STATUSCODE
÷öeË&& (' ' =löe[3]))

	)

594 
boﬁ
 
	$·p_ído‰e•
(
c⁄√˘d©a
 *
c⁄n
, *
löe
, 
size_t
 
Àn
,

595 *
code
)

597 ()
c⁄n
;

599 if((
Àn
 > 3Ë&& 
	`LASTLINE
(
löe
)) {

600 *
code
 = 
	`cuæx_¶tosi
(
	`°πﬁ
(
löe
, 
NULL
, 10));

601  
TRUE
;

604  
FALSE
;

605 
	}
}

607 
CURLcode
 
	$·p_ªadª•
(
cuæ_sockë_t
 
sockfd
,

608 
pögp⁄g
 *
µ
,

609 *
·pcode
,

610 
size_t
 *
size
)

612 
c⁄√˘d©a
 *
c⁄n
 = 
µ
->conn;

613 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

614 #ifde‡
HAVE_GSSAPI


615 * c⁄° 
buf
 = 
d©a
->
°©e
.
buf„r
;

617 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

618 
code
;

620 
ªsu…
 = 
	`Cuæ_µ_ªadª•
(
sockfd
, 
µ
, &
code
, 
size
);

622 #i‡
	`deföed
(
HAVE_GSSAPI
)

625 
code
) {

627 
code
 = 
	`Cuæ_£c_ªad_msg
(
c⁄n
, 
buf
, 
PROT_SAFE
);

630 
code
 = 
	`Cuæ_£c_ªad_msg
(
c⁄n
, 
buf
, 
PROT_PRIVATE
);

633 
code
 = 
	`Cuæ_£c_ªad_msg
(
c⁄n
, 
buf
, 
PROT_CONFIDENTIAL
);

642 
d©a
->
öfo
.
hâpcode
=
code
;

644 if(
·pcode
)

645 *
·pcode
 = 
code
;

647 if(421 =
code
) {

655 
	`öfof
(
d©a
, "We gotá 421 -Åimeout!\n");

656 
	`°©e
(
c⁄n
, 
FTP_STOP
);

657  
CURLE_OPERATION_TIMEDOUT
;

660  
ªsu…
;

661 
	}
}

671 
CURLcode
 
	$Cuæ_GëFTPRe•⁄£
(
ssize_t
 *
ƒódp
,

672 
c⁄√˘d©a
 *
c⁄n
,

673 *
·pcode
)

682 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
FIRSTSOCKET
];

683 
timeout
;

684 
öãrvÆ_ms
;

685 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

686 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

687 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

688 
pögp⁄g
 *
µ
 = &
·pc
->pp;

689 
size_t
 
ƒód
;

690 
ˇche_skù
=0;

691 
vÆue_to_be_ign‹ed
=0;

693 if(
·pcode
)

694 *
·pcode
 = 0;

697 
·pcode
 = &
vÆue_to_be_ign‹ed
;

699 *
ƒódp
=0;

701 !*
·pcode
 && !
ªsu…
) {

703 
timeout
 = 
	`Cuæ_µ_°©e_timeout
(
µ
);

705 if(
timeout
 <=0 ) {

706 
	`Áûf
(
d©a
, "FTPÑesponseÅimeout");

707  
CURLE_OPERATION_TIMEDOUT
;

710 
öãrvÆ_ms
 = 1000;

711 if(
timeout
 < 
öãrvÆ_ms
)

712 
öãrvÆ_ms
 = 
timeout
;

728 if(
µ
->
ˇche
 && (
ˇche_skù
 < 2)) {

737 
	`Cuæ_sockë_ªady
(
sockfd
, 
CURL_SOCKET_BAD
, 
öãrvÆ_ms
)) {

739 
	`Áûf
(
d©a
, "FTPÑesponseáborted dueÅo select/pollÉrror: %d",

740 
SOCKERRNO
);

741  
CURLE_RECV_ERROR
;

744 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

745  
CURLE_ABORTED_BY_CALLBACK
;

752 
ªsu…
 = 
	`·p_ªadª•
(
sockfd
, 
µ
, 
·pcode
, &
ƒód
);

753 if(
ªsu…
)

756 if(!
ƒód
 && 
µ
->
ˇche
)

759 
ˇche_skù
++;

763 
ˇche_skù
=0;

765 *
ƒódp
 +
ƒód
;

769 
µ
->
≥ndög_ª•
 = 
FALSE
;

771  
ªsu…
;

772 
	}
}

774 #i‡
deföed
(
DEBUGBUILD
Ë&& !deföed(
CURL_DISABLE_VERBOSE_STRINGS
)

776 c⁄° * c⁄° 
	g·p_°©e_«mes
[]={

816 
_°©e
(
c⁄√˘d©a
 *
c⁄n
,

817 
·p°©e
 
√w°©e


818 #ifde‡
DEBUGBUILD


819 , 
löío


823 
·p_c⁄n
 *
	g·pc
 = &
c⁄n
->
¥Ÿo
.
·pc
;

824 #i‡
deföed
(
DEBUGBUILD
Ë&& !deföed(
CURL_DISABLE_VERBOSE_STRINGS
)

825 if(
	g·pc
->
	g°©e
 !
√w°©e
)

826 
öfof
(
c⁄n
->
d©a
, "FTP %p (line %d) state change from %sÅo %s\n",

827 (*)
·pc
, 
löío
, 
·p_°©e_«mes
[·pc->
°©e
],

828 
·p_°©e_«mes
[
√w°©e
]);

830 
	g·pc
->
	g°©e
 = 
√w°©e
;

833 
CURLcode
 
	$·p_°©e_u£r
(
c⁄√˘d©a
 *
c⁄n
)

835 
CURLcode
 
ªsu…
;

836 
FTP
 *
·p
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

838 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "USER %s", 
·p
->
u£r
?ftp->user:"");

840 
	`°©e
(
c⁄n
, 
FTP_USER
);

841 
c⁄n
->
d©a
->
°©e
.
·p_åyög_Æã∫©ive
 = 
FALSE
;

843  
CURLE_OK
;

844 
	}
}

846 
CURLcode
 
	$·p_°©e_pwd
(
c⁄√˘d©a
 *
c⁄n
)

848 
CURLcode
 
ªsu…
;

851 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "%s", "PWD");

852 
	`°©e
(
c⁄n
, 
FTP_PWD
);

854  
CURLE_OK
;

855 
	}
}

858 
	$·p_gësock
(
c⁄√˘d©a
 *
c⁄n
,

859 
cuæ_sockë_t
 *
socks
,

860 
numsocks
)

862  
	`Cuæ_µ_gësock
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, 
socks
, 
numsocks
);

863 
	}
}

866 
	$·p_dom‹e_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

867 
numsocks
)

869 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

871 if(!
numsocks
)

872  
GETSOCK_BLANK
;

879 if(
FTP_STOP
 =
·pc
->
°©e
) {

880 
bôs
 = 
	`GETSOCK_READSOCK
(0);

884 
socks
[0] = 
c⁄n
->
sock
[
FIRSTSOCKET
];

886 if(!
c⁄n
->
d©a
->
£t
.
·p_u£_p‹t
) {

887 
s
;

888 
i
;

891 
s
=1, 
i
=0; i<2; i++) {

892 if(
c⁄n
->
ãmpsock
[
i
] !
CURL_SOCKET_BAD
) {

893 
socks
[
s
] = 
c⁄n
->
ãmpsock
[
i
];

894 
bôs
 |
	`GETSOCK_WRITESOCK
(
s
++);

899 
socks
[1] = 
c⁄n
->
sock
[
SECONDARYSOCKET
];

900 
bôs
 |
	`GETSOCK_WRITESOCK
(1);

903  
bôs
;

906  
	`Cuæ_µ_gësock
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, 
socks
, 
numsocks
);

907 
	}
}

915 
CURLcode
 
	$·p_°©e_cwd
(
c⁄√˘d©a
 *
c⁄n
)

917 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

918 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

920 if(
·pc
->
cwdd⁄e
)

922 
ªsu…
 = 
	`·p_°©e_mdtm
(
c⁄n
);

924 
·pc
->
cou¡2
 = 0;

929 
·pc
->
cou¡3
 = (
c⁄n
->
d©a
->
£t
.
·p_¸óã_missög_dús
==2)?1:0;

931 if(
c⁄n
->
bôs
.
ªu£
 && 
·pc
->
íåy∑th
) {

935 
·pc
->
cou¡1
 = 0;

937 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "CWD %s", fçc->
íåy∑th
);

938 
	`°©e
(
c⁄n
, 
FTP_CWD
);

941 if(
·pc
->
dúdïth
) {

942 
·pc
->
cou¡1
 = 1;

945 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "CWD %s", fçc->
dús
[·pc->
cou¡1
 -1]);

946 
	`°©e
(
c⁄n
, 
FTP_CWD
);

950 
ªsu…
 = 
	`·p_°©e_mdtm
(
c⁄n
);

954  
ªsu…
;

955 
	}
}

958 
	mEPRT
,

959 
	mPORT
,

960 
	mDONE


961 } 
	t·µ‹t
;

963 
CURLcode
 
	$·p_°©e_u£_p‹t
(
c⁄√˘d©a
 *
c⁄n
,

964 
·µ‹t
 
fcmd
)

967 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

968 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

969 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

970 
cuæ_sockë_t
 
p‹tsock

CURL_SOCKET_BAD
;

971 
myho°
[256] = "";

973 
Cuæ_sockaddr_°‹age
 
ss
;

974 
Cuæ_addröfo
 *
ªs
, *
ai
;

975 
cuæ_sockÀn_t
 
s¶í
;

976 
hbuf
[
NI_MAXHOST
];

977 
sockaddr
 *
ß
=(sockadd∏*)&
ss
;

978 
sockaddr_ö
 * c⁄° 
ß4
 = (*)
ß
;

979 #ifde‡
ENABLE_IPV6


980 
sockaddr_ö6
 * c⁄° 
ß6
 = (*)
ß
;

982 
tmp
[1024];

983 c⁄° 
mode
[][5] = { "EPRT", "PORT" };

984 
rc
;

985 
îr‹
;

986 *
ho°
 = 
NULL
;

987 *
°rög_·µ‹t
 = 
d©a
->
£t
.
°r
[
STRING_FTPPORT
];

988 
Cuæ_dns_íåy
 *
h
=
NULL
;

989 
p‹t_mö
 = 0;

990 
p‹t_max
 = 0;

991 
p‹t
;

992 
boﬁ
 
possibly_n⁄_loˇl
 = 
TRUE
;

994 *
addr
 = 
NULL
;

1001 if(
d©a
->
£t
.
°r
[
STRING_FTPPORT
] &&

1002 (
	`°æí
(
d©a
->
£t
.
°r
[
STRING_FTPPORT
]) > 1)) {

1004 #ifde‡
ENABLE_IPV6


1005 
size_t
 
addæí
 = 
INET6_ADDRSTRLEN
 > 
	`°æí
(
°rög_·µ‹t
) ?

1006 
INET6_ADDRSTRLEN
 : 
	`°æí
(
°rög_·µ‹t
);

1008 
size_t
 
addæí
 = 
INET_ADDRSTRLEN
 > 
	`°æí
(
°rög_·µ‹t
) ?

1009 
INET_ADDRSTRLEN
 : 
	`°æí
(
°rög_·µ‹t
);

1011 *
ù_°¨t
 = 
°rög_·µ‹t
;

1012 *
ù_íd
 = 
NULL
;

1013 *
p‹t_°¨t
 = 
NULL
;

1014 *
p‹t_£p
 = 
NULL
;

1016 
addr
 = 
	`ˇŒoc
(
addæí
+1, 1);

1017 if(!
addr
)

1018  
CURLE_OUT_OF_MEMORY
;

1020 #ifde‡
ENABLE_IPV6


1021 if(*
°rög_·µ‹t
 == '[') {

1023 
ù_°¨t
 = 
°rög_·µ‹t
 + 1;

1024 if((
ù_íd
 = 
	`°rchr
(
°rög_·µ‹t
, ']')Ë!
NULL
 )

1025 
	`°∫˝y
(
addr
, 
ù_°¨t
, 
ù_íd
 - ip_start);

1029 if(*
°rög_·µ‹t
 == ':') {

1031 
ù_íd
 = 
°rög_·µ‹t
;

1033 if((
ù_íd
 = 
	`°rchr
(
°rög_·µ‹t
, ':')Ë!
NULL
) {

1035 #ifde‡
ENABLE_IPV6


1036 if(
	`Cuæ_öë_±⁄
(
AF_INET6
, 
°rög_·µ‹t
, 
ß6
) == 1) {

1038 
p‹t_mö
 = 
p‹t_max
 = 0;

1039 
	`°r˝y
(
addr
, 
°rög_·µ‹t
);

1040 
ù_íd
 = 
NULL
;

1045 
	`°∫˝y
(
addr
, 
°rög_·µ‹t
, 
ù_íd
 - 
ù_°¨t
 );

1049 
	`°r˝y
(
addr
, 
°rög_·µ‹t
);

1052 if(
ù_íd
 !
NULL
) {

1053 if((
p‹t_°¨t
 = 
	`°rchr
(
ù_íd
, ':')Ë!
NULL
) {

1054 
p‹t_mö
 = 
	`cuæx_u…ous
(
	`°πoul
(
p‹t_°¨t
+1, 
NULL
, 10));

1055 if((
p‹t_£p
 = 
	`°rchr
(
p‹t_°¨t
, '-')Ë!
NULL
) {

1056 
p‹t_max
 = 
	`cuæx_u…ous
(
	`°πoul
(
p‹t_£p
 + 1, 
NULL
, 10));

1059 
p‹t_max
 = 
p‹t_mö
;

1069 if(
p‹t_mö
 > 
p‹t_max
 )

1070 
p‹t_mö
 = 
p‹t_max
 = 0;

1073 if(*
addr
 != '\0') {

1075 
	`Cuæ_if2ù
(
c⁄n
->
ù_addr
->
ai_Ámûy
, c⁄n->
sc›e
, 
addr
,

1076 
hbuf
, (hbuf))) {

1077 
IF2IP_NOT_FOUND
:

1079 
ho°
 = 
addr
;

1081 
IF2IP_AF_NOT_SUPPORTED
:

1082  
CURLE_FTP_PORT_FAILED
;

1083 
IF2IP_FOUND
:

1084 
ho°
 = 
hbuf
;

1089 
ho°
 = 
NULL
;

1092 if(!
ho°
) {

1096 
s¶í
 = (
ss
);

1097 if(
	`gësock«me
(
c⁄n
->
sock
[
FIRSTSOCKET
], 
ß
, &
s¶í
)) {

1098 
	`Áûf
(
d©a
, "getsockname() failed: %s",

1099 
	`Cuæ_°ªº‹
(
c⁄n
, 
SOCKERRNO
) );

1100 
	`Cuæ_ß„‰ì
(
addr
);

1101  
CURLE_FTP_PORT_FAILED
;

1103 
ß
->
ß_Ámûy
) {

1104 #ifde‡
ENABLE_IPV6


1105 
AF_INET6
:

1106 
	`Cuæ_öë_¡›
(
ß
->
ß_Ámûy
, &
ß6
->
sö6_addr
, 
hbuf
, (hbuf));

1110 
	`Cuæ_öë_¡›
(
ß
->
ß_Ámûy
, &
ß4
->
sö_addr
, 
hbuf
, (hbuf));

1113 
ho°
 = 
hbuf
;

1114 
possibly_n⁄_loˇl
 = 
FALSE
;

1118 
rc
 = 
	`Cuæ_ªsﬁv
(
c⁄n
, 
ho°
, 0, &
h
);

1119 if(
rc
 =
CURLRESOLV_PENDING
)

1120 ()
	`Cuæ_ªsﬁvî_waô_ªsﬁv
(
c⁄n
, &
h
);

1121 if(
h
) {

1122 
ªs
 = 
h
->
addr
;

1125 
	`Cuæ_ªsﬁv_u∆ock
(
d©a
, 
h
);

1128 
ªs
 = 
NULL
;

1130 if(
ªs
 =
NULL
) {

1131 
	`Áûf
(
d©a
, "ÁûedÅÿªsﬁvêthêaddªs†¥ovidedÅÿPORT: %s", 
ho°
);

1132 
	`Cuæ_ß„‰ì
(
addr
);

1133  
CURLE_FTP_PORT_FAILED
;

1136 
	`Cuæ_ß„‰ì
(
addr
);

1137 
ho°
 = 
NULL
;

1141 
p‹tsock
 = 
CURL_SOCKET_BAD
;

1142 
îr‹
 = 0;

1143 
ai
 = 
ªs
;ái;áòai->
ai_√xt
) {

1144 
ªsu…
 = 
	`Cuæ_sockë
(
c⁄n
, 
ai
, 
NULL
, &
p‹tsock
);

1145 if(
ªsu…
) {

1146 
îr‹
 = 
SOCKERRNO
;

1151 if(!
ai
) {

1152 
	`Áûf
(
d©a
, "sockë faûuª: %s", 
	`Cuæ_°ªº‹
(
c⁄n
, 
îr‹
));

1153  
CURLE_FTP_PORT_FAILED
;

1158 
	`mem˝y
(
ß
, 
ai
->
ai_addr
,ái->
ai_addæí
);

1159 
s¶í
 = 
ai
->
ai_addæí
;

1161 
p‹t
 = 
p‹t_mö
;Ö‹à<
p‹t_max
;) {

1162 if(
ß
->
ß_Ámûy
 =
AF_INET
)

1163 
ß4
->
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

1164 #ifde‡
ENABLE_IPV6


1166 
ß6
->
sö6_p‹t
 = 
	`ht⁄s
(
p‹t
);

1169 if(
	`böd
(
p‹tsock
, 
ß
, 
s¶í
) ) {

1171 
îr‹
 = 
SOCKERRNO
;

1172 if(
possibly_n⁄_loˇl
 && (
îr‹
 =
EADDRNOTAVAIL
)) {

1177 
	`öfof
(
d©a
, "böd’‹t=%huË⁄Ç⁄-loˇ»addªs†Áûed: %s\n", 
p‹t
,

1178 
	`Cuæ_°ªº‹
(
c⁄n
, 
îr‹
) );

1180 
s¶í
 = (
ss
);

1181 if(
	`gësock«me
(
c⁄n
->
sock
[
FIRSTSOCKET
], 
ß
, &
s¶í
)) {

1182 
	`Áûf
(
d©a
, "getsockname() failed: %s",

1183 
	`Cuæ_°ªº‹
(
c⁄n
, 
SOCKERRNO
) );

1184 
	`Cuæ_˛o£sockë
(
c⁄n
, 
p‹tsock
);

1185  
CURLE_FTP_PORT_FAILED
;

1187 
p‹t
 = 
p‹t_mö
;

1188 
possibly_n⁄_loˇl
 = 
FALSE
;

1191 if(
îr‹
 !
EADDRINUSE
 &&Éº‹ !
EACCES
) {

1192 
	`Áûf
(
d©a
, "böd’‹t=%huËÁûed: %s", 
p‹t
,

1193 
	`Cuæ_°ªº‹
(
c⁄n
, 
îr‹
) );

1194 
	`Cuæ_˛o£sockë
(
c⁄n
, 
p‹tsock
);

1195  
CURLE_FTP_PORT_FAILED
;

1201 
p‹t
++;

1205 if(
p‹t
 > 
p‹t_max
) {

1206 
	`Áûf
(
d©a
, "bind() failed, weÑan out ofÖorts!");

1207 
	`Cuæ_˛o£sockë
(
c⁄n
, 
p‹tsock
);

1208  
CURLE_FTP_PORT_FAILED
;

1213 
s¶í
 = (
ss
);

1214 if(
	`gësock«me
(
p‹tsock
, (
sockaddr
 *)
ß
, &
s¶í
)) {

1215 
	`Áûf
(
d©a
, "getsockname() failed: %s",

1216 
	`Cuæ_°ªº‹
(
c⁄n
, 
SOCKERRNO
) );

1217 
	`Cuæ_˛o£sockë
(
c⁄n
, 
p‹tsock
);

1218  
CURLE_FTP_PORT_FAILED
;

1223 if(
	`li°í
(
p‹tsock
, 1)) {

1224 
	`Áûf
(
d©a
, "sockë faûuª: %s", 
	`Cuæ_°ªº‹
(
c⁄n
, 
SOCKERRNO
));

1225 
	`Cuæ_˛o£sockë
(
c⁄n
, 
p‹tsock
);

1226  
CURLE_FTP_PORT_FAILED
;

1233 
	`Cuæ_¥öèbÀ_addªss
(
ai
, 
myho°
, (myhost));

1235 #ifde‡
ENABLE_IPV6


1236 if(!
c⁄n
->
bôs
.
·p_u£_ïπ
 && c⁄n->bôs.
ùv6
)

1239 
c⁄n
->
bôs
.
·p_u£_ïπ
 = 
TRUE
;

1242 ; 
fcmd
 !
DONE
; fcmd++) {

1244 if(!
c⁄n
->
bôs
.
·p_u£_ïπ
 && (
EPRT
 =
fcmd
))

1248 if((
PORT
 =
fcmd
Ë&& 
ß
->
ß_Ámûy
 !
AF_INET
)

1252 
ß
->
ß_Ámûy
) {

1253 
AF_INET
:

1254 
p‹t
 = 
	`¡ohs
(
ß4
->
sö_p‹t
);

1256 #ifde‡
ENABLE_IPV6


1257 
AF_INET6
:

1258 
p‹t
 = 
	`¡ohs
(
ß6
->
sö6_p‹t
);

1265 if(
EPRT
 =
fcmd
) {

1274 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
·pc
->
µ
, "%†|%d|%s|%hu|", 
mode
[
fcmd
],

1275 
ß
->
ß_Ámûy
 =
AF_INET
?1:2,

1276 
myho°
, 
p‹t
);

1277 if(
ªsu…
) {

1278 
	`Áûf
(
d©a
, "Failure sending EPRT command: %s",

1279 
	`cuæ_ósy_°ªº‹
(
ªsu…
));

1280 
	`Cuæ_˛o£sockë
(
c⁄n
, 
p‹tsock
);

1282 
·pc
->
cou¡1
 = 
PORT
;

1284 
	`°©e
(
c⁄n
, 
FTP_STOP
);

1285  
ªsu…
;

1289 if(
PORT
 =
fcmd
) {

1290 *
sour˚
 = 
myho°
;

1291 *
de°
 = 
tmp
;

1294 
sour˚
 && *source) {

1295 if(*
sour˚
 == '.')

1296 *
de°
=',';

1298 *
de°
 = *
sour˚
;

1299 
de°
++;

1300 
sour˚
++;

1302 *
de°
 = 0;

1303 
	`¢¥ötf
(
de°
, 20, ",%d,%d", ()(
p‹t
>>8), ()(port&0xff));

1305 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
·pc
->
µ
, "%†%s", 
mode
[
fcmd
], 
tmp
);

1306 if(
ªsu…
) {

1307 
	`Áûf
(
d©a
, "Failure sending PORT command: %s",

1308 
	`cuæ_ósy_°ªº‹
(
ªsu…
));

1309 
	`Cuæ_˛o£sockë
(
c⁄n
, 
p‹tsock
);

1311 
	`°©e
(
c⁄n
, 
FTP_STOP
);

1312  
ªsu…
;

1319 
·pc
->
cou¡1
 = 
fcmd
;

1324 if(
CURL_SOCKET_BAD
 !
c⁄n
->
sock
[
SECONDARYSOCKET
])

1325 
	`Cuæ_˛o£sockë
(
c⁄n
, c⁄n->
sock
[
SECONDARYSOCKET
]);

1326 
c⁄n
->
sock
[
SECONDARYSOCKET
] = 
p‹tsock
;

1335 
c⁄n
->
bôs
.
t˝c⁄√˘
[
SECONDARYSOCKET
] = 
TRUE
;

1337 
	`°©e
(
c⁄n
, 
FTP_PORT
);

1338  
ªsu…
;

1339 
	}
}

1341 
CURLcode
 
	$·p_°©e_u£_∑sv
(
c⁄√˘d©a
 *
c⁄n
)

1343 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

1344 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1359 c⁄° 
mode
[][5] = { "EPSV", "PASV" };

1360 
modeoff
;

1362 #ifde‡
PF_INET6


1363 if(!
c⁄n
->
bôs
.
·p_u£_ïsv
 && c⁄n->bôs.
ùv6
)

1366 
c⁄n
->
bôs
.
·p_u£_ïsv
 = 
TRUE
;

1369 
modeoff
 = 
c⁄n
->
bôs
.
·p_u£_ïsv
?0:1;

1371 
	`PPSENDF
(&
·pc
->
µ
, "%s", 
mode
[
modeoff
]);

1373 
·pc
->
cou¡1
 = 
modeoff
;

1374 
	`°©e
(
c⁄n
, 
FTP_PASV
);

1375 
	`öfof
(
c⁄n
->
d©a
, "Connect data streamÖassively\n");

1377  
ªsu…
;

1378 
	}
}

1387 
CURLcode
 
	$·p_°©e_¥ï¨e_å™s„r
(
c⁄√˘d©a
 *
c⁄n
)

1389 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1390 
FTP
 *
·p
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

1391 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1393 if(
·p
->
å™s„r
 !
FTPTRANSFER_BODY
) {

1397 
	`°©e
(
c⁄n
, 
FTP_RETR_PREQUOTE
);

1398 
ªsu…
 = 
	`·p_°©e_quŸe
(
c⁄n
, 
TRUE
, 
FTP_RETR_PREQUOTE
);

1400 if(
d©a
->
£t
.
·p_u£_p‹t
) {

1402 
ªsu…
 = 
	`·p_°©e_u£_p‹t
(
c⁄n
, 
EPRT
);

1406 if(
d©a
->
£t
.
·p_u£_¥ë
) {

1409 if(!
c⁄n
->
¥Ÿo
.
·pc
.
fûe
) {

1410 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "PRET %s",

1411 
d©a
->
£t
.
°r
[
STRING_CUSTOMREQUEST
]?

1412 
d©a
->
£t
.
°r
[
STRING_CUSTOMREQUEST
]:

1413 (
d©a
->
£t
.
·p_li°_⁄ly
?"NLST":"LIST"));

1415 if(
d©a
->
£t
.
u∂ﬂd
) {

1416 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "PRET STOR %s", c⁄n->¥Ÿo.·pc.
fûe
);

1419 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "PRET RETR %s", c⁄n->¥Ÿo.·pc.
fûe
);

1421 
	`°©e
(
c⁄n
, 
FTP_PRET
);

1424 
ªsu…
 = 
	`·p_°©e_u£_∑sv
(
c⁄n
);

1427  
ªsu…
;

1428 
	}
}

1430 
CURLcode
 
	$·p_°©e_ª°
(
c⁄√˘d©a
 *
c⁄n
)

1432 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1433 
FTP
 *
·p
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

1434 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

1436 if((
·p
->
å™s„r
 !
FTPTRANSFER_BODY
Ë&& 
·pc
->
fûe
) {

1441 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "REST %d", 0);

1443 
	`°©e
(
c⁄n
, 
FTP_REST
);

1446 
ªsu…
 = 
	`·p_°©e_¥ï¨e_å™s„r
(
c⁄n
);

1448  
ªsu…
;

1449 
	}
}

1451 
CURLcode
 
	$·p_°©e_size
(
c⁄√˘d©a
 *
c⁄n
)

1453 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1454 
FTP
 *
·p
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

1455 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

1457 if((
·p
->
å™s„r
 =
FTPTRANSFER_INFO
Ë&& 
·pc
->
fûe
) {

1461 
	`PPSENDF
(&
·pc
->
µ
, "SIZE %s", fçc->
fûe
);

1463 
	`°©e
(
c⁄n
, 
FTP_SIZE
);

1466 
ªsu…
 = 
	`·p_°©e_ª°
(
c⁄n
);

1468  
ªsu…
;

1469 
	}
}

1471 
CURLcode
 
	$·p_°©e_li°
(
c⁄√˘d©a
 *
c⁄n
)

1473 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1474 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1490 *
cmd
,*
l°Arg
,*
¶ashPos
;

1492 
l°Arg
 = 
NULL
;

1493 if((
d©a
->
£t
.
·p_fûemëhod
 =
FTPFILE_NOCWD
) &&

1494 
d©a
->
°©e
.
∑th
 &&

1495 
d©a
->
°©e
.
∑th
[0] &&

1496 
	`°rchr
(
d©a
->
°©e
.
∑th
,'/')) {

1498 
l°Arg
 = 
	`°rdup
(
d©a
->
°©e
.
∑th
);

1499 if(!
l°Arg
)

1500  
CURLE_OUT_OF_MEMORY
;

1503 if(
l°Arg
[
	`°æí
(lstArg) - 1] != '/') {

1506 
¶ashPos
 = 
	`°ºchr
(
l°Arg
,'/');

1507 if(
¶ashPos
)

1508 *(
¶ashPos
+1) = '\0';

1512 
cmd
 = 
	`≠rötf
( "%s%s%s",

1513 
d©a
->
£t
.
°r
[
STRING_CUSTOMREQUEST
]?

1514 
d©a
->
£t
.
°r
[
STRING_CUSTOMREQUEST
]:

1515 (
d©a
->
£t
.
·p_li°_⁄ly
?"NLST":"LIST"),

1516 
l°Arg
? " ": "",

1517 
l°Arg
?ÜstArg: "" );

1519 if(!
cmd
) {

1520 if(
l°Arg
)

1521 
	`‰ì
(
l°Arg
);

1522  
CURLE_OUT_OF_MEMORY
;

1525 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "%s", 
cmd
);

1527 if(
l°Arg
)

1528 
	`‰ì
(
l°Arg
);

1530 
	`‰ì
(
cmd
);

1532 if(
ªsu…
 !
CURLE_OK
)

1533  
ªsu…
;

1535 
	`°©e
(
c⁄n
, 
FTP_LIST
);

1537  
ªsu…
;

1538 
	}
}

1540 
CURLcode
 
	$·p_°©e_ªå_¥equŸe
(
c⁄√˘d©a
 *
c⁄n
)

1542 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1546 
ªsu…
 = 
	`·p_°©e_quŸe
(
c⁄n
, 
TRUE
, 
FTP_RETR_PREQUOTE
);

1548  
ªsu…
;

1549 
	}
}

1551 
CURLcode
 
	$·p_°©e_°‹_¥equŸe
(
c⁄√˘d©a
 *
c⁄n
)

1553 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1557 
ªsu…
 = 
	`·p_°©e_quŸe
(
c⁄n
, 
TRUE
, 
FTP_STOR_PREQUOTE
);

1559  
ªsu…
;

1560 
	}
}

1562 
CURLcode
 
	$·p_°©e_ty≥
(
c⁄√˘d©a
 *
c⁄n
)

1564 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1565 
FTP
 *
·p
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

1566 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1567 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

1572 if(
d©a
->
£t
.
›t_no_body
 && 
·pc
->
fûe
 &&

1573 
	`·p_√ed_ty≥
(
c⁄n
, 
d©a
->
£t
.
¥e„r_ascii
)) {

1578 
·p
->
å™s„r
 = 
FTPTRANSFER_INFO
;

1583 
ªsu…
 = 
	`·p_nb_ty≥
(
c⁄n
, 
d©a
->
£t
.
¥e„r_ascii
, 
FTP_TYPE
);

1584 if(
ªsu…
)

1585  
ªsu…
;

1588 
ªsu…
 = 
	`·p_°©e_size
(
c⁄n
);

1590  
ªsu…
;

1591 
	}
}

1595 
CURLcode
 
	$·p_°©e_mdtm
(
c⁄√˘d©a
 *
c⁄n
)

1597 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1598 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1599 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

1602 if((
d©a
->
£t
.
gë_fûëime
 || d©a->£t.
timec⁄dôi⁄
Ë&& 
·pc
->
fûe
) {

1606 
	`PPSENDF
(&
·pc
->
µ
, "MDTM %s", fçc->
fûe
);

1608 
	`°©e
(
c⁄n
, 
FTP_MDTM
);

1611 
ªsu…
 = 
	`·p_°©e_ty≥
(
c⁄n
);

1613  
ªsu…
;

1614 
	}
}

1618 
CURLcode
 
	$·p_°©e_ul_£tup
(
c⁄√˘d©a
 *
c⁄n
,

1619 
boﬁ
 
sizechecked
)

1621 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1622 
FTP
 *
·p
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

1623 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1624 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

1625 
£ekîr
 = 
CURL_SEEKFUNC_OK
;

1627 if((
d©a
->
°©e
.
ªsume_‰om
 && !
sizechecked
) ||

1628 ((
d©a
->
°©e
.
ªsume_‰om
 > 0Ë&& 
sizechecked
)) {

1642 if(
d©a
->
°©e
.
ªsume_‰om
 < 0 ) {

1644 
	`PPSENDF
(&
·pc
->
µ
, "SIZE %s", fçc->
fûe
);

1645 
	`°©e
(
c⁄n
, 
FTP_STOR_SIZE
);

1646  
ªsu…
;

1650 
d©a
->
£t
.
·p_≠≥nd
 = 
TRUE
;

1653 if(
c⁄n
->
£ek_func
) {

1654 
£ekîr
 = 
c⁄n
->
	`£ek_func
(c⁄n->
£ek_˛õ¡
, 
d©a
->
°©e
.
ªsume_‰om
,

1655 
SEEK_SET
);

1658 if(
£ekîr
 !
CURL_SEEKFUNC_OK
) {

1659 if(
£ekîr
 !
CURL_SEEKFUNC_CANTSEEK
) {

1660 
	`Áûf
(
d©a
, "CouldÇot seek stream");

1661  
CURLE_FTP_COULDNT_USE_REST
;

1665 
cuæ_off_t
 
∑s£d
=0;

1667 
size_t
 
ªadthißmou¡now
 =

1668 (
d©a
->
°©e
.
ªsume_‰om
 - 
∑s£d
 > 
	`CURL_OFF_T_C
(
BUFSIZE
)) ?

1669 
BUFSIZE
 : 
	`cuæx_sŸouz
(
d©a
->
°©e
.
ªsume_‰om
 - 
∑s£d
);

1671 
size_t
 
a˘uÆlyªad
 =

1672 
c⁄n
->
	`‰ód_func
(
d©a
->
°©e
.
buf„r
, 1, 
ªadthißmou¡now
,

1673 
c⁄n
->
‰ód_ö
);

1675 
∑s£d
 +
a˘uÆlyªad
;

1676 if((
a˘uÆlyªad
 =0Ë|| (a˘uÆlyªad > 
ªadthißmou¡now
)) {

1679 
	`Áûf
(
d©a
, "FailedÅoÑead data");

1680  
CURLE_FTP_COULDNT_USE_REST
;

1682 } 
∑s£d
 < 
d©a
->
°©e
.
ªsume_‰om
);

1686 if(
d©a
->
°©e
.
öfûesize
>0) {

1687 
d©a
->
°©e
.
öfûesize
 -d©a->°©e.
ªsume_‰om
;

1689 if(
d©a
->
°©e
.
öfûesize
 <= 0) {

1690 
	`öfof
(
d©a
, "Fileálready completely uploaded\n");

1693 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

1697 
·p
->
å™s„r
 = 
FTPTRANSFER_NONE
;

1699 
	`°©e
(
c⁄n
, 
FTP_STOP
);

1700  
CURLE_OK
;

1706 
	`PPSENDF
(&
·pc
->
µ
, 
d©a
->
£t
.
·p_≠≥nd
?"APPE %s":"STOR %s",

1707 
·pc
->
fûe
);

1709 
	`°©e
(
c⁄n
, 
FTP_STOR
);

1711  
ªsu…
;

1712 
	}
}

1714 
CURLcode
 
	$·p_°©e_quŸe
(
c⁄√˘d©a
 *
c⁄n
,

1715 
boﬁ
 
öô
,

1716 
·p°©e
 
ö°©e
)

1718 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1719 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1720 
FTP
 *
·p
 = 
d©a
->
ªq
.
¥Ÿ›
;

1721 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

1722 
boﬁ
 
quŸe
=
FALSE
;

1723 
cuæ_¶i°
 *
ôem
;

1725 
ö°©e
) {

1726 
FTP_QUOTE
:

1728 
ôem
 = 
d©a
->
£t
.
quŸe
;

1730 
FTP_RETR_PREQUOTE
:

1731 
FTP_STOR_PREQUOTE
:

1732 
ôem
 = 
d©a
->
£t
.
¥equŸe
;

1734 
FTP_POSTQUOTE
:

1735 
ôem
 = 
d©a
->
£t
.
po°quŸe
;

1745 if(
öô
)

1746 
·pc
->
cou¡1
 = 0;

1748 
·pc
->
cou¡1
++;

1750 if(
ôem
) {

1751 
i
 = 0;

1754 (
i
< 
·pc
->
cou¡1
Ë&& 
ôem
) {

1755 
ôem
 = iãm->
√xt
;

1756 
i
++;

1758 if(
ôem
) {

1759 *
cmd
 = 
ôem
->
d©a
;

1760 if(
cmd
[0] == '*') {

1761 
cmd
++;

1762 
·pc
->
cou¡2
 = 1;

1765 
·pc
->
cou¡2
 = 0;

1767 
	`PPSENDF
(&
·pc
->
µ
, "%s", 
cmd
);

1768 
	`°©e
(
c⁄n
, 
ö°©e
);

1769 
quŸe
 = 
TRUE
;

1773 if(!
quŸe
) {

1775 
ö°©e
) {

1776 
FTP_QUOTE
:

1778 
ªsu…
 = 
	`·p_°©e_cwd
(
c⁄n
);

1780 
FTP_RETR_PREQUOTE
:

1781 if(
·p
->
å™s„r
 !
FTPTRANSFER_BODY
)

1782 
	`°©e
(
c⁄n
, 
FTP_STOP
);

1784 if(
·pc
->
known_fûesize
 != -1) {

1785 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
·pc
->
known_fûesize
);

1786 
ªsu…
 = 
	`·p_°©e_ªå
(
c⁄n
, 
·pc
->
known_fûesize
);

1789 
	`PPSENDF
(&
·pc
->
µ
, "SIZE %s", fçc->
fûe
);

1790 
	`°©e
(
c⁄n
, 
FTP_RETR_SIZE
);

1794 
FTP_STOR_PREQUOTE
:

1795 
ªsu…
 = 
	`·p_°©e_ul_£tup
(
c⁄n
, 
FALSE
);

1797 
FTP_POSTQUOTE
:

1802  
ªsu…
;

1803 
	}
}

1807 
CURLcode
 
	$·p_ïsv_dißbÀ
(
c⁄√˘d©a
 *
c⁄n
)

1809 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1810 
	`öfof
(
c⁄n
->
d©a
, "Failed EPSVáttempt. Disabling EPSV\n");

1812 
c⁄n
->
bôs
.
·p_u£_ïsv
 = 
FALSE
;

1813 
c⁄n
->
d©a
->
°©e
.
îr‹buf
 = 
FALSE
;

1815 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "%s", "PASV");

1816 
c⁄n
->
¥Ÿo
.
·pc
.
cou¡1
++;

1818 
	`°©e
(
c⁄n
, 
FTP_PASV
);

1819  
ªsu…
;

1820 
	}
}

1826 
CURLcode
 
	$¥oxy_magic
(
c⁄√˘d©a
 *
c⁄n
,

1827 *
√who°
, 
√wp‹t
,

1828 
boﬁ
 *
magicd⁄e
)

1830 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1831 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

1833 *
magicd⁄e
 = 
FALSE
;

1834 
c⁄n
->
¥oxyty≥
) {

1835 
CURLPROXY_SOCKS5
:

1836 
CURLPROXY_SOCKS5_HOSTNAME
:

1837 
ªsu…
 = 
	`Cuæ_SOCKS5
(
c⁄n
->
¥oxyu£r
, c⁄n->
¥oxy∑sswd
, 
√who°
,

1838 
√wp‹t
, 
SECONDARYSOCKET
, 
c⁄n
);

1839 *
magicd⁄e
 = 
TRUE
;

1841 
CURLPROXY_SOCKS4
:

1842 
ªsu…
 = 
	`Cuæ_SOCKS4
(
c⁄n
->
¥oxyu£r
, 
√who°
, 
√wp‹t
,

1843 
SECONDARYSOCKET
, 
c⁄n
, 
FALSE
);

1844 *
magicd⁄e
 = 
TRUE
;

1846 
CURLPROXY_SOCKS4A
:

1847 
ªsu…
 = 
	`Cuæ_SOCKS4
(
c⁄n
->
¥oxyu£r
, 
√who°
, 
√wp‹t
,

1848 
SECONDARYSOCKET
, 
c⁄n
, 
TRUE
);

1849 *
magicd⁄e
 = 
TRUE
;

1851 
CURLPROXY_HTTP
:

1852 
CURLPROXY_HTTP_1_0
:

1856 
	`Áûf
(
d©a
, "unknownÖroxytype option given");

1857 
ªsu…
 = 
CURLE_COULDNT_CONNECT
;

1861 if(
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 && c⁄n->bôs.
hâµroxy
) {

1871 
HTTP
 
hâp_¥oxy
;

1872 
FTP
 *
·p_ßve
 = 
d©a
->
ªq
.
¥Ÿ›
;

1873 
	`mem£t
(&
hâp_¥oxy
, 0, (http_proxy));

1874 
d©a
->
ªq
.
¥Ÿ›
 = &
hâp_¥oxy
;

1876 
ªsu…
 = 
	`Cuæ_¥oxyCONNECT
(
c⁄n
, 
SECONDARYSOCKET
, 
√who°
, 
√wp‹t
);

1878 
d©a
->
ªq
.
¥Ÿ›
 = 
·p_ßve
;

1880 if(
ªsu…
)

1881  
ªsu…
;

1883 if(
c⁄n
->
tu¬ñ_°©e
[
SECONDARYSOCKET
] !
TUNNEL_COMPLETE
) {

1885 
	`°©e
(
c⁄n
, 
FTP_STOP
);

1886  
ªsu…
;

1889 *
magicd⁄e
 = 
TRUE
;

1891  
ªsu…
;

1892 
	}
}

1894 
CURLcode
 
	$·p_°©e_∑sv_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1895 
·pcode
)

1897 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

1898 
CURLcode
 
ªsu…
;

1899 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

1900 
Cuæ_dns_íåy
 *
addr
=
NULL
;

1901 
rc
;

1902 
c⁄√˘p‹t
;

1903 *
°r
=&
d©a
->
°©e
.
buf„r
[4];

1905 if((
·pc
->
cou¡1
 == 0) &&

1906 (
·pcode
 == 229)) {

1908 *
±r
 = 
	`°rchr
(
°r
, '(');

1909 if(
±r
) {

1910 
num
;

1911 
£∑øt‹
[4];

1912 
±r
++;

1913 if(5 =
	`ssˇnf
(
±r
, "%c%c%c%u%c",

1914 &
£∑øt‹
[0],

1915 &
£∑øt‹
[1],

1916 &
£∑øt‹
[2],

1917 &
num
,

1918 &
£∑øt‹
[3])) {

1919 c⁄° 
£p1
 = 
£∑øt‹
[0];

1920 
i
;

1924 
i
=1; i<4; i++) {

1925 if(
£∑øt‹
[
i
] !
£p1
) {

1926 
±r
=
NULL
;

1930 if(
num
 > 0xffff) {

1931 
	`Áûf
(
d©a
, "IllegalÖortÇumber in EPSVÑeply");

1932  
CURLE_FTP_WEIRD_PASV_REPLY
;

1934 if(
±r
) {

1935 
·pc
->
√wp‹t
 = ()(
num
 & 0xffff);

1937 if(
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 ||

1938 
c⁄n
->
¥oxyty≥
 =
CURLPROXY_SOCKS5
 ||

1939 
c⁄n
->
¥oxyty≥
 =
CURLPROXY_SOCKS5_HOSTNAME
 ||

1940 
c⁄n
->
¥oxyty≥
 =
CURLPROXY_SOCKS4
 ||

1941 
c⁄n
->
¥oxyty≥
 =
CURLPROXY_SOCKS4A
)

1944 
	`¢¥ötf
(
·pc
->
√who°
, (ftpc->newhost), "%s",

1945 
c⁄n
->
ho°
.
«me
);

1948 
	`¢¥ötf
(
·pc
->
√who°
, 
NEWHOST_BUFSIZE
, "%s", 
c⁄n
->
ù_addr_°r
);

1952 
±r
=
NULL
;

1954 if(!
±r
) {

1955 
	`Áûf
(
d©a
, "Weirdly formatted EPSVÑeply");

1956  
CURLE_FTP_WEIRD_PASV_REPLY
;

1959 if((
·pc
->
cou¡1
 == 1) &&

1960 (
·pcode
 == 227)) {

1962 
ù
[4];

1963 
p‹t
[2];

1974 *
°r
) {

1975 if(6 =
	`ssˇnf
(
°r
, "%d,%d,%d,%d,%d,%d",

1976 &
ù
[0], &ip[1], &ip[2], &ip[3],

1977 &
p‹t
[0], &port[1]))

1979 
°r
++;

1982 if(!*
°r
) {

1983 
	`Áûf
(
d©a
, "Couldn't interpretÅhe 227-response");

1984  
CURLE_FTP_WEIRD_227_FORMAT
;

1988 if(
d©a
->
£t
.
·p_skù_ù
) {

1991 
	`öfof
(
d©a
, "Skips %d.%d.%d.%d for data connection, uses %s instead\n",

1992 
ù
[0], ip[1], ip[2], ip[3],

1993 
c⁄n
->
ù_addr_°r
);

1994 if(
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 ||

1995 
c⁄n
->
¥oxyty≥
 =
CURLPROXY_SOCKS5
 ||

1996 
c⁄n
->
¥oxyty≥
 =
CURLPROXY_SOCKS5_HOSTNAME
 ||

1997 
c⁄n
->
¥oxyty≥
 =
CURLPROXY_SOCKS4
 ||

1998 
c⁄n
->
¥oxyty≥
 =
CURLPROXY_SOCKS4A
)

2001 
	`¢¥ötf
(
·pc
->
√who°
, (·pc->√who°), "%s", 
c⁄n
->
ho°
.
«me
);

2003 
	`¢¥ötf
(
·pc
->
√who°
, (ftpc->newhost), "%s",

2004 
c⁄n
->
ù_addr_°r
);

2007 
	`¢¥ötf
(
·pc
->
√who°
, (ftpc->newhost),

2008 "%d.%d.%d.%d", 
ù
[0], ip[1], ip[2], ip[3]);

2009 
·pc
->
√wp‹t
 = ()(((
p‹t
[0]<<8) +Öort[1]) & 0xffff);

2011 if(
·pc
->
cou¡1
 == 0) {

2013  
	`·p_ïsv_dißbÀ
(
c⁄n
);

2016 
	`Áûf
(
d©a
, "Bad PASV/EPSVÑe•⁄£: %03d", 
·pcode
);

2017  
CURLE_FTP_WEIRD_PASV_REPLY
;

2020 if(
c⁄n
->
bôs
.
¥oxy
) {

2026 
rc
 = 
	`Cuæ_ªsﬁv
(
c⁄n
, c⁄n->
¥oxy
.
«me
, ()c⁄n->
p‹t
, &
addr
);

2027 if(
rc
 =
CURLRESOLV_PENDING
)

2030 ()
	`Cuæ_ªsﬁvî_waô_ªsﬁv
(
c⁄n
, &
addr
);

2032 
c⁄√˘p‹t
 =

2033 ()
c⁄n
->
p‹t
;

2035 if(!
addr
) {

2036 
	`Áûf
(
d©a
, "Can'tÑesolveÖroxy host %s:%hu",

2037 
c⁄n
->
¥oxy
.
«me
, 
c⁄√˘p‹t
);

2038  
CURLE_FTP_CANT_GET_HOST
;

2043 
rc
 = 
	`Cuæ_ªsﬁv
(
c⁄n
, 
·pc
->
√who°
, fçc->
√wp‹t
, &
addr
);

2044 if(
rc
 =
CURLRESOLV_PENDING
)

2046 ()
	`Cuæ_ªsﬁvî_waô_ªsﬁv
(
c⁄n
, &
addr
);

2048 
c⁄√˘p‹t
 = 
·pc
->
√wp‹t
;

2050 if(!
addr
) {

2051 
	`Áûf
(
d©a
, "C™'àªsﬁvê√w ho° %s:%hu", 
·pc
->
√who°
, 
c⁄√˘p‹t
);

2052  
CURLE_FTP_CANT_GET_HOST
;

2056 
c⁄n
->
bôs
.
t˝c⁄√˘
[
SECONDARYSOCKET
] = 
FALSE
;

2057 
ªsu…
 = 
	`Cuæ_c⁄√˘ho°
(
c⁄n
, 
addr
);

2059 
	`Cuæ_ªsﬁv_u∆ock
(
d©a
, 
addr
);

2061 if(
ªsu…
) {

2062 if(
·pc
->
cou¡1
 =0 && 
·pcode
 == 229)

2063  
	`·p_ïsv_dißbÀ
(
c⁄n
);

2065  
ªsu…
;

2075 if(
d©a
->
£t
.
vîbo£
)

2077 
	`·p_∑sv_vîbo£
(
c⁄n
, c⁄n->
ù_addr
, 
·pc
->
√who°
, 
c⁄√˘p‹t
);

2079 
c⁄n
->
bôs
.
do_m‹e
 = 
TRUE
;

2080 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2082  
ªsu…
;

2083 
	}
}

2085 
CURLcode
 
	$·p_°©e_p‹t_ª•
(
c⁄√˘d©a
 *
c⁄n
,

2086 
·pcode
)

2088 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2089 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

2090 
·µ‹t
 
fcmd
 = (·µ‹t)
·pc
->
cou¡1
;

2091 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2093 if(
·pcode
 != 200) {

2096 if(
EPRT
 =
fcmd
) {

2097 
	`öfof
(
d©a
, "disabling EPRT usage\n");

2098 
c⁄n
->
bôs
.
·p_u£_ïπ
 = 
FALSE
;

2100 
fcmd
++;

2102 if(
fcmd
 =
DONE
) {

2103 
	`Áûf
(
d©a
, "FailedÅo do PORT");

2104 
ªsu…
 = 
CURLE_FTP_PORT_FAILED
;

2108 
ªsu…
 = 
	`·p_°©e_u£_p‹t
(
c⁄n
, 
fcmd
);

2111 
	`öfof
(
d©a
, "Connect data streamáctively\n");

2112 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2113 
ªsu…
 = 
	`·p_d›ha£_d⁄e
(
c⁄n
, 
FALSE
);

2116  
ªsu…
;

2117 
	}
}

2119 
CURLcode
 
	$·p_°©e_mdtm_ª•
(
c⁄√˘d©a
 *
c⁄n
,

2120 
·pcode
)

2122 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2123 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

2124 
FTP
 *
·p
 = 
d©a
->
ªq
.
¥Ÿ›
;

2125 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

2127 
·pcode
) {

2132 
yór
, 
m⁄th
, 
day
, 
hour
, 
möuã
, 
£c⁄d
;

2133 *
buf
 = 
d©a
->
°©e
.
buf„r
;

2134 if(6 =
	`ssˇnf
(
buf
+4, "%04d%02d%02d%02d%02d%02d",

2135 &
yór
, &
m⁄th
, &
day
, &
hour
, &
möuã
, &
£c⁄d
)) {

2137 
time_t
 
£cs
=
	`time
(
NULL
);

2139 
	`¢¥ötf
(
buf
, (
c⁄n
->
d©a
->
°©e
.
buf„r
),

2141 
yór
, 
m⁄th
, 
day
, 
hour
, 
möuã
, 
£c⁄d
);

2143 
d©a
->
öfo
.
fûëime
 = ()
	`cuæ_gëd©e
(
buf
, &
£cs
);

2146 #ifde‡
CURL_FTP_HTTPSTYLE_HEAD


2150 if(
d©a
->
£t
.
›t_no_body
 &&

2151 
·pc
->
fûe
 &&

2152 
d©a
->
£t
.
gë_fûëime
 &&

2153 (
d©a
->
öfo
.
fûëime
>=0) ) {

2154 
time_t
 
fûëime
 = (time_t)
d©a
->
öfo
.filetime;

2155 
tm
 
buf„r
;

2156 c⁄° 
tm
 *tm = &
buf„r
;

2158 
ªsu…
 = 
	`Cuæ_gmtime
(
fûëime
, &
buf„r
);

2159 if(
ªsu…
)

2160  
ªsu…
;

2163 
	`¢¥ötf
(
buf
, 
BUFSIZE
-1,

2165 
Cuæ_wkday
[
tm
->
tm_wday
?tm->tm_wday-1:6],

2166 
tm
->
tm_mday
,

2167 
Cuæ_m⁄th
[
tm
->
tm_m⁄
],

2168 
tm
->
tm_yór
 + 1900,

2169 
tm
->
tm_hour
,

2170 
tm
->
tm_mö
,

2171 
tm
->
tm_£c
);

2172 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BOTH
, 
buf
, 0);

2173 if(
ªsu…
)

2174  
ªsu…
;

2180 
	`öfof
(
d©a
, "unsupported MDTMÑeply format\n");

2183 
	`Áûf
(
d©a
, "Given file doesÇotÉxist");

2184 
ªsu…
 = 
CURLE_FTP_COULDNT_RETR_FILE
;

2188 if(
d©a
->
£t
.
timec⁄dôi⁄
) {

2189 if((
d©a
->
öfo
.
fûëime
 > 0Ë&& (d©a->
£t
.
timevÆue
 > 0)) {

2190 
d©a
->
£t
.
timec⁄dôi⁄
) {

2191 
CURL_TIMECOND_IFMODSINCE
:

2193 if(
d©a
->
öfo
.
fûëime
 <d©a->
£t
.
timevÆue
) {

2194 
	`öfof
(
d©a
, "TheÑequested document isÇotÇewÉnough\n");

2195 
·p
->
å™s„r
 = 
FTPTRANSFER_NONE
;

2196 
d©a
->
öfo
.
timec⁄d
 = 
TRUE
;

2197 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2198  
CURLE_OK
;

2201 
CURL_TIMECOND_IFUNMODSINCE
:

2202 if(
d©a
->
öfo
.
fûëime
 > d©a->
£t
.
timevÆue
) {

2203 
	`öfof
(
d©a
, "TheÑequested document isÇot oldÉnough\n");

2204 
·p
->
å™s„r
 = 
FTPTRANSFER_NONE
;

2205 
d©a
->
öfo
.
timec⁄d
 = 
TRUE
;

2206 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2207  
CURLE_OK
;

2213 
	`öfof
(
d©a
, "SkippingÅime comparison\n");

2217 if(!
ªsu…
)

2218 
ªsu…
 = 
	`·p_°©e_ty≥
(
c⁄n
);

2220  
ªsu…
;

2221 
	}
}

2223 
CURLcode
 
	$·p_°©e_ty≥_ª•
(
c⁄√˘d©a
 *
c⁄n
,

2224 
·pcode
,

2225 
·p°©e
 
ö°©e
)

2227 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2228 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

2230 if(
·pcode
/100 != 2) {

2234 
	`Áûf
(
d©a
, "Couldn't set desired mode");

2235  
CURLE_FTP_COULDNT_SET_TYPE
;

2237 if(
·pcode
 != 200)

2238 
	`öfof
(
d©a
, "Gotá %03dÑesponse code instead ofÅheássumed 200\n",

2239 
·pcode
);

2241 if(
ö°©e
 =
FTP_TYPE
)

2242 
ªsu…
 = 
	`·p_°©e_size
(
c⁄n
);

2243 if(
ö°©e
 =
FTP_LIST_TYPE
)

2244 
ªsu…
 = 
	`·p_°©e_li°
(
c⁄n
);

2245 if(
ö°©e
 =
FTP_RETR_TYPE
)

2246 
ªsu…
 = 
	`·p_°©e_ªå_¥equŸe
(
c⁄n
);

2247 if(
ö°©e
 =
FTP_STOR_TYPE
)

2248 
ªsu…
 = 
	`·p_°©e_°‹_¥equŸe
(
c⁄n
);

2250  
ªsu…
;

2251 
	}
}

2253 
CURLcode
 
	$·p_°©e_ªå
(
c⁄√˘d©a
 *
c⁄n
,

2254 
cuæ_off_t
 
fûesize
)

2256 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2257 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

2258 
FTP
 *
·p
 = 
d©a
->
ªq
.
¥Ÿ›
;

2259 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

2261 if(
d©a
->
£t
.
max_fûesize
 && (
fûesize
 > data->set.max_filesize)) {

2262 
	`Áûf
(
d©a
, "Maximum file sizeÉxceeded");

2263  
CURLE_FILESIZE_EXCEEDED
;

2265 
·p
->
dow∆ﬂdsize
 = 
fûesize
;

2267 if(
d©a
->
°©e
.
ªsume_‰om
) {

2270 if(
fûesize
 == -1) {

2271 
	`öfof
(
d©a
, "ftp server doesn't support SIZE\n");

2280 if(
d©a
->
°©e
.
ªsume_‰om
< 0) {

2282 if(
fûesize
 < -
d©a
->
°©e
.
ªsume_‰om
) {

2283 
	`Áûf
(
d©a
, "Off£à(%" 
CURL_FORMAT_CURL_OFF_T


2284 "Ëwa†bey⁄d fûêsizê(%" 
CURL_FORMAT_CURL_OFF_T
 ")",

2285 
d©a
->
°©e
.
ªsume_‰om
, 
fûesize
);

2286  
CURLE_BAD_DOWNLOAD_RESUME
;

2289 
·p
->
dow∆ﬂdsize
 = -
d©a
->
°©e
.
ªsume_‰om
;

2291 
d©a
->
°©e
.
ªsume_‰om
 = 
fûesize
 - 
·p
->
dow∆ﬂdsize
;

2294 if(
fûesize
 < 
d©a
->
°©e
.
ªsume_‰om
) {

2295 
	`Áûf
(
d©a
, "Off£à(%" 
CURL_FORMAT_CURL_OFF_T


2296 "Ëwa†bey⁄d fûêsizê(%" 
CURL_FORMAT_CURL_OFF_T
 ")",

2297 
d©a
->
°©e
.
ªsume_‰om
, 
fûesize
);

2298  
CURLE_BAD_DOWNLOAD_RESUME
;

2301 
·p
->
dow∆ﬂdsize
 = 
fûesize
-
d©a
->
°©e
.
ªsume_‰om
;

2305 if(
·p
->
dow∆ﬂdsize
 == 0) {

2307 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

2308 
	`öfof
(
d©a
, "Fileálready completely downloaded\n");

2312 
·p
->
å™s„r
 = 
FTPTRANSFER_NONE
;

2313 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2314  
CURLE_OK
;

2318 
	`öfof
(
d©a
, "Instructs serverÅoÑesume from offset %"

2319 
CURL_FORMAT_CURL_OFF_T
 "\n", 
d©a
->
°©e
.
ªsume_‰om
);

2321 
	`PPSENDF
(&
·pc
->
µ
, "REST %" 
CURL_FORMAT_CURL_OFF_T
,

2322 
d©a
->
°©e
.
ªsume_‰om
);

2324 
	`°©e
(
c⁄n
, 
FTP_RETR_REST
);

2328 
	`PPSENDF
(&
·pc
->
µ
, "RETR %s", fçc->
fûe
);

2329 
	`°©e
(
c⁄n
, 
FTP_RETR
);

2332  
ªsu…
;

2333 
	}
}

2335 
CURLcode
 
	$·p_°©e_size_ª•
(
c⁄√˘d©a
 *
c⁄n
,

2336 
·pcode
,

2337 
·p°©e
 
ö°©e
)

2339 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2340 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

2341 
cuæ_off_t
 
fûesize
;

2342 *
buf
 = 
d©a
->
°©e
.
buf„r
;

2345 
fûesize
 = (
·pcode
 =213)?
	`cuæx_°πoof·
(
buf
+4, 
NULL
, 0):-1;

2347 if(
ö°©e
 =
FTP_SIZE
) {

2348 #ifde‡
CURL_FTP_HTTPSTYLE_HEAD


2349 if(-1 !
fûesize
) {

2350 
	`¢¥ötf
(
buf
, (
d©a
->
°©e
.
buf„r
),

2351 "C⁄ã¡-Lígth: %" 
CURL_FORMAT_CURL_OFF_T
 "\r\n", 
fûesize
);

2352 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BOTH
, 
buf
, 0);

2353 if(
ªsu…
)

2354  
ªsu…
;

2357 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
fûesize
);

2358 
ªsu…
 = 
	`·p_°©e_ª°
(
c⁄n
);

2360 if(
ö°©e
 =
FTP_RETR_SIZE
) {

2361 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
fûesize
);

2362 
ªsu…
 = 
	`·p_°©e_ªå
(
c⁄n
, 
fûesize
);

2364 if(
ö°©e
 =
FTP_STOR_SIZE
) {

2365 
d©a
->
°©e
.
ªsume_‰om
 = 
fûesize
;

2366 
ªsu…
 = 
	`·p_°©e_ul_£tup
(
c⁄n
, 
TRUE
);

2369  
ªsu…
;

2370 
	}
}

2372 
CURLcode
 
	$·p_°©e_ª°_ª•
(
c⁄√˘d©a
 *
c⁄n
,

2373 
·pcode
,

2374 
·p°©e
 
ö°©e
)

2376 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2377 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

2379 
ö°©e
) {

2380 
FTP_REST
:

2382 #ifde‡
CURL_FTP_HTTPSTYLE_HEAD


2383 if(
·pcode
 == 350) {

2384 
buf„r
[24]= { "Accept-ranges: bytes\r\n" };

2385 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BOTH
, 
buf„r
, 0);

2386 if(
ªsu…
)

2387  
ªsu…
;

2390 
ªsu…
 = 
	`·p_°©e_¥ï¨e_å™s„r
(
c⁄n
);

2393 
FTP_RETR_REST
:

2394 if(
·pcode
 != 350) {

2395 
	`Áûf
(
c⁄n
->
d©a
, "Couldn't use REST");

2396 
ªsu…
 = 
CURLE_FTP_COULDNT_USE_REST
;

2399 
	`PPSENDF
(&
·pc
->
µ
, "RETR %s", fçc->
fûe
);

2400 
	`°©e
(
c⁄n
, 
FTP_RETR
);

2405  
ªsu…
;

2406 
	}
}

2408 
CURLcode
 
	$·p_°©e_°‹_ª•
(
c⁄√˘d©a
 *
c⁄n
,

2409 
·pcode
, 
·p°©e
 
ö°©e
)

2411 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2412 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2414 if(
·pcode
>=400) {

2415 
	`Áûf
(
d©a
, "Faûed FTP u∂ﬂd: %0d", 
·pcode
);

2416 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2418  
CURLE_UPLOAD_FAILED
;

2421 
c⁄n
->
¥Ÿo
.
·pc
.
°©e_ßved
 = 
ö°©e
;

2424 if(
d©a
->
£t
.
·p_u£_p‹t
) {

2425 
boﬁ
 
c⁄√˘ed
;

2427 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2429 
ªsu…
 = 
	`AŒowSîvîC⁄√˘
(
c⁄n
, &
c⁄√˘ed
);

2430 if(
ªsu…
)

2431  
ªsu…
;

2433 if(!
c⁄√˘ed
) {

2434 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

2435 
	`öfof
(
d©a
, "Data conn wasÇotávailable immediately\n");

2436 
·pc
->
waô_d©a_c⁄n
 = 
TRUE
;

2439  
CURLE_OK
;

2442  
	`InôüãTøns„r
(
c⁄n
);

2443 
	}
}

2446 
CURLcode
 
	$·p_°©e_gë_ª•
(
c⁄√˘d©a
 *
c⁄n
,

2447 
·pcode
,

2448 
·p°©e
 
ö°©e
)

2450 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2451 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2452 
FTP
 *
·p
 = 
d©a
->
ªq
.
¥Ÿ›
;

2453 *
buf
 = 
d©a
->
°©e
.
buf„r
;

2455 if((
·pcode
 == 150) || (ftpcode == 125)) {

2474 
cuæ_off_t
 
size
=-1;

2486 if((
ö°©e
 !
FTP_LIST
) &&

2487 !
d©a
->
£t
.
¥e„r_ascii
 &&

2488 (
·p
->
dow∆ﬂdsize
 < 1)) {

2496 *
byãs
;

2497 
byãs
=
	`°r°r
(
buf
, " bytes");

2498 if(
byãs
--) {

2499 
ö
=()(
byãs
-
buf
);

2501 --
ö
) {

2503 if('(' =*
byãs
)

2506 if(!
	`ISDIGIT
(*
byãs
)) {

2507 
byãs
=
NULL
;

2511 
byãs
--;

2514 if(
byãs
++) {

2516 
size
 = 
	`cuæx_°πoof·
(
byãs
, 
NULL
, 0);

2520 if(
·p
->
dow∆ﬂdsize
 > -1)

2521 
size
 = 
·p
->
dow∆ﬂdsize
;

2523 if(
size
 > 
d©a
->
ªq
.
maxdow∆ﬂd
 && data->req.maxdownload > 0)

2524 
size
 = 
d©a
->
ªq
.sizêd©a->ªq.
maxdow∆ﬂd
;

2525 if((
ö°©e
 !
FTP_LIST
Ë&& (
d©a
->
£t
.
¥e„r_ascii
))

2526 
size
 = -1;

2528 
	`öfof
(
d©a
, "Maxdow∆ﬂd = %" 
CURL_FORMAT_CURL_OFF_T
 "\n",

2529 
d©a
->
ªq
.
maxdow∆ﬂd
);

2531 if(
ö°©e
 !
FTP_LIST
)

2532 
	`öfof
(
d©a
, "Gëtög fûêwôh size: %" 
CURL_FORMAT_CURL_OFF_T
 "\n",

2533 
size
);

2536 
c⁄n
->
¥Ÿo
.
·pc
.
°©e_ßved
 = 
ö°©e
;

2537 
c⁄n
->
¥Ÿo
.
·pc
.
ªå_size_ßved
 = 
size
;

2539 if(
d©a
->
£t
.
·p_u£_p‹t
) {

2540 
boﬁ
 
c⁄√˘ed
;

2542 
ªsu…
 = 
	`AŒowSîvîC⁄√˘
(
c⁄n
, &
c⁄√˘ed
);

2543 if(
ªsu…
)

2544  
ªsu…
;

2546 if(!
c⁄√˘ed
) {

2547 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

2548 
	`öfof
(
d©a
, "Data conn wasÇotávailable immediately\n");

2549 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2550 
·pc
->
waô_d©a_c⁄n
 = 
TRUE
;

2554  
	`InôüãTøns„r
(
c⁄n
);

2557 if((
ö°©e
 =
FTP_LIST
Ë&& (
·pcode
 == 450)) {

2559 
·p
->
å™s„r
 = 
FTPTRANSFER_NONE
;

2560 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2563 
	`Áûf
(
d©a
, "RETRÑe•⁄£: %03d", 
·pcode
);

2564  
ö°©e
 =
FTP_RETR
 && 
·pcode
 == 550?

2565 
CURLE_REMOTE_FILE_NOT_FOUND
:

2566 
CURLE_FTP_COULDNT_RETR_FILE
;

2570  
ªsu…
;

2571 
	}
}

2574 
CURLcode
 
	$·p_°©e_loggedö
(
c⁄√˘d©a
 *
c⁄n
)

2576 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2578 if(
c⁄n
->
s¶
[
FIRSTSOCKET
].
u£
) {

2593 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "PBSZ %d", 0);

2594 
	`°©e
(
c⁄n
, 
FTP_PBSZ
);

2597 
ªsu…
 = 
	`·p_°©e_pwd
(
c⁄n
);

2599  
ªsu…
;

2600 
	}
}

2603 
CURLcode
 
	$·p_°©e_u£r_ª•
(
c⁄√˘d©a
 *
c⁄n
,

2604 
·pcode
,

2605 
·p°©e
 
ö°©e
)

2607 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2608 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2609 
FTP
 *
·p
 = 
d©a
->
ªq
.
¥Ÿ›
;

2610 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

2611 ()
ö°©e
;

2614 if((
·pcode
 =331Ë&& (
·pc
->
°©e
 =
FTP_USER
)) {

2617 
	`PPSENDF
(&
·pc
->
µ
, "PASS %s", 
·p
->
∑sswd
?ftp->passwd:"");

2618 
	`°©e
(
c⁄n
, 
FTP_PASS
);

2620 if(
·pcode
/100 == 2) {

2623 
ªsu…
 = 
	`·p_°©e_loggedö
(
c⁄n
);

2625 if(
·pcode
 == 332) {

2626 if(
d©a
->
£t
.
°r
[
STRING_FTP_ACCOUNT
]) {

2627 
	`PPSENDF
(&
·pc
->
µ
, "ACCT %s", 
d©a
->
£t
.
°r
[
STRING_FTP_ACCOUNT
]);

2628 
	`°©e
(
c⁄n
, 
FTP_ACCT
);

2631 
	`Áûf
(
d©a
, "ACCTÑequested butÇoneávailable");

2632 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

2641 if(
c⁄n
->
d©a
->
£t
.
°r
[
STRING_FTP_ALTERNATIVE_TO_USER
] &&

2642 !
c⁄n
->
d©a
->
°©e
.
·p_åyög_Æã∫©ive
) {

2644 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "%s",

2645 
c⁄n
->
d©a
->
£t
.
°r
[
STRING_FTP_ALTERNATIVE_TO_USER
]);

2646 
c⁄n
->
d©a
->
°©e
.
·p_åyög_Æã∫©ive
 = 
TRUE
;

2647 
	`°©e
(
c⁄n
, 
FTP_USER
);

2648 
ªsu…
 = 
CURLE_OK
;

2651 
	`Áûf
(
d©a
, "Ac˚s†díõd: %03d", 
·pcode
);

2652 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

2655  
ªsu…
;

2656 
	}
}

2659 
CURLcode
 
	$·p_°©e_ac˘_ª•
(
c⁄√˘d©a
 *
c⁄n
,

2660 
·pcode
)

2662 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2663 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2664 if(
·pcode
 != 230) {

2665 
	`Áûf
(
d©a
, "ACCTÑeje˘ed by sîvî: %03d", 
·pcode
);

2666 
ªsu…
 = 
CURLE_FTP_WEIRD_PASS_REPLY
;

2669 
ªsu…
 = 
	`·p_°©e_loggedö
(
c⁄n
);

2671  
ªsu…
;

2672 
	}
}

2675 
CURLcode
 
	$·p_°©emach_a˘
(
c⁄√˘d©a
 *
c⁄n
)

2677 
CURLcode
 
ªsu…
;

2678 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
FIRSTSOCKET
];

2679 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

2680 
·pcode
;

2681 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

2682 
pögp⁄g
 *
µ
 = &
·pc
->pp;

2683 c⁄° 
·∑uth
[][4] = { "SSL", "TLS" };

2684 
size_t
 
ƒód
 = 0;

2686 if(
µ
->
£ndÀ·
)

2687  
	`Cuæ_µ_Êush£nd
(
µ
);

2689 
ªsu…
 = 
	`·p_ªadª•
(
sock
, 
µ
, &
·pcode
, &
ƒód
);

2690 if(
ªsu…
)

2691  
ªsu…
;

2693 if(
·pcode
) {

2695 
·pc
->
°©e
) {

2696 
FTP_WAIT220
:

2697 if(
·pcode
 == 230)

2699  
	`·p_°©e_u£r_ª•
(
c⁄n
, 
·pcode
, 
·pc
->
°©e
);

2700 if(
·pcode
 != 220) {

2701 
	`Áûf
(
d©a
, "Gotá %03d ftp-serverÑesponse when 220 wasÉxpected",

2702 
·pcode
);

2703  
CURLE_FTP_WEIRD_SERVER_REPLY
;

2707 #ifde‡
HAVE_GSSAPI


2708 if(
d©a
->
£t
.
krb
) {

2712 
	`Cuæ_£c_ªque°_¥Ÿ
(
c⁄n
, "private");

2715 
	`Cuæ_£c_ªque°_¥Ÿ
(
c⁄n
, 
d©a
->
£t
.
°r
[
STRING_KRB_LEVEL
]);

2717 if(
	`Cuæ_£c_logö
(
c⁄n
Ë!
CURLE_OK
)

2718 
	`öfof
(
d©a
, "Logging in withÖassword in cleartext!\n");

2720 
	`öfof
(
d©a
, "Authentication successful\n");

2724 if(
d©a
->
£t
.
u£_s¶
 && !
c⁄n
->
s¶
[
FIRSTSOCKET
].
u£
) {

2728 
·pc
->
cou¡3
=0;

2729 
d©a
->
£t
.
·ps¶auth
) {

2730 
CURLFTPAUTH_DEFAULT
:

2731 
CURLFTPAUTH_SSL
:

2732 
·pc
->
cou¡2
 = 1;

2733 
·pc
->
cou¡1
 = 0;

2735 
CURLFTPAUTH_TLS
:

2736 
·pc
->
cou¡2
 = -1;

2737 
·pc
->
cou¡1
 = 1;

2740 
	`Áûf
(
d©a
, "unsupportedÖarameterÅo CURLOPT_FTPSSLAUTH: %d",

2741 ()
d©a
->
£t
.
·ps¶auth
);

2742  
CURLE_UNKNOWN_OPTION
;

2744 
	`PPSENDF
(&
·pc
->
µ
, "AUTH %s", 
·∑uth
[·pc->
cou¡1
]);

2745 
	`°©e
(
c⁄n
, 
FTP_AUTH
);

2748 
ªsu…
 = 
	`·p_°©e_u£r
(
c⁄n
);

2749 if(
ªsu…
)

2750  
ªsu…
;

2755 
FTP_AUTH
:

2765 if((
·pcode
 == 234) || (ftpcode == 334)) {

2767 
ªsu…
 = 
	`Cuæ_s¶_c⁄√˘
(
c⁄n
, 
FIRSTSOCKET
);

2768 if(
CURLE_OK
 =
ªsu…
) {

2769 
c⁄n
->
s¶
[
SECONDARYSOCKET
].
u£
 = 
FALSE
;

2770 
ªsu…
 = 
	`·p_°©e_u£r
(
c⁄n
);

2773 if(
·pc
->
cou¡3
 < 1) {

2774 
·pc
->
cou¡3
++;

2775 
·pc
->
cou¡1
 +·pc->
cou¡2
;

2776 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
·pc
->
µ
, "AUTH %s", 
·∑uth
[·pc->
cou¡1
]);

2780 if(
d©a
->
£t
.
u£_s¶
 > 
CURLUSESSL_TRY
)

2782 
ªsu…
 = 
CURLE_USE_SSL_FAILED
;

2785 
ªsu…
 = 
	`·p_°©e_u£r
(
c⁄n
);

2788 if(
ªsu…
)

2789  
ªsu…
;

2792 
FTP_USER
:

2793 
FTP_PASS
:

2794 
ªsu…
 = 
	`·p_°©e_u£r_ª•
(
c⁄n
, 
·pcode
, 
·pc
->
°©e
);

2797 
FTP_ACCT
:

2798 
ªsu…
 = 
	`·p_°©e_ac˘_ª•
(
c⁄n
, 
·pcode
);

2801 
FTP_PBSZ
:

2802 
	`PPSENDF
(&
·pc
->
µ
, "PROT %c",

2803 
d©a
->
£t
.
u£_s¶
 =
CURLUSESSL_CONTROL
 ? 'C' : 'P');

2804 
	`°©e
(
c⁄n
, 
FTP_PROT
);

2808 
FTP_PROT
:

2809 if(
·pcode
/100 == 2)

2811 
c⁄n
->
s¶
[
SECONDARYSOCKET
].
u£
 =

2812 (
d©a
->
£t
.
u£_s¶
 !
CURLUSESSL_CONTROL
Ë? 
TRUE
 : 
FALSE
;

2815 if(
d©a
->
£t
.
u£_s¶
 > 
CURLUSESSL_CONTROL
)

2817  
CURLE_USE_SSL_FAILED
;

2819 if(
d©a
->
£t
.
·p_ccc
) {

2822 
	`PPSENDF
(&
·pc
->
µ
, "%s", "CCC");

2823 
	`°©e
(
c⁄n
, 
FTP_CCC
);

2826 
ªsu…
 = 
	`·p_°©e_pwd
(
c⁄n
);

2827 if(
ªsu…
)

2828  
ªsu…
;

2832 
FTP_CCC
:

2833 if(
·pcode
 < 500) {

2835 
ªsu…
 = 
	`Cuæ_s¶_shutdown
(
c⁄n
, 
FIRSTSOCKET
);

2837 if(
ªsu…
) {

2838 
	`Áûf
(
c⁄n
->
d©a
, "FailedÅo clearÅhe command channel (CCC)");

2839  
ªsu…
;

2844 
ªsu…
 = 
	`·p_°©e_pwd
(
c⁄n
);

2845 if(
ªsu…
)

2846  
ªsu…
;

2849 
FTP_PWD
:

2850 if(
·pcode
 == 257) {

2851 *
±r
=&
d©a
->
°©e
.
buf„r
[4];

2852 *
dú
;

2853 *
°‹e
;

2855 
dú
 = 
	`mÆloc
(
ƒód
 + 1);

2856 if(!
dú
)

2857  
CURLE_OUT_OF_MEMORY
;

2869 
±r
 < &
d©a
->
°©e
.
buf„r
[(data->state.buffer)]

2870 && *
±r
 != '\n' && *ptr != '\0' && *ptr != '"')

2871 
±r
++;

2873 if('\"' =*
±r
) {

2875 
±r
++;

2876 
°‹e
 = 
dú
; *
±r
;) {

2877 if('\"' =*
±r
) {

2878 if('\"' =
±r
[1]) {

2880 *
°‹e
 = 
±r
[1];

2881 
±r
++;

2885 *
°‹e
 = '\0';

2890 *
°‹e
 = *
±r
;

2891 
°‹e
++;

2892 
±r
++;

2907 if(!
·pc
->
£rvî_os
 && 
dú
[0] != '/') {

2909 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
·pc
->
µ
, "%s", "SYST");

2910 if(
ªsu…
 !
CURLE_OK
) {

2911 
	`‰ì
(
dú
);

2912  
ªsu…
;

2914 
	`Cuæ_ß„‰ì
(
·pc
->
íåy∑th
);

2915 
·pc
->
íåy∑th
 = 
dú
;

2916 
	`öfof
(
d©a
, "E¡ryÖ©h i†'%s'\n", 
·pc
->
íåy∑th
);

2918 
d©a
->
°©e
.
mo°_ª˚¡_·p_íåy∑th
 = 
·pc
->
íåy∑th
;

2919 
	`°©e
(
c⁄n
, 
FTP_SYST
);

2923 
	`Cuæ_ß„‰ì
(
·pc
->
íåy∑th
);

2924 
·pc
->
íåy∑th
 = 
dú
;

2925 
	`öfof
(
d©a
, "E¡ryÖ©h i†'%s'\n", 
·pc
->
íåy∑th
);

2927 
d©a
->
°©e
.
mo°_ª˚¡_·p_íåy∑th
 = 
·pc
->
íåy∑th
;

2931 
	`‰ì
(
dú
);

2932 
	`öfof
(
d©a
, "FailedÅo figure outÖath\n");

2935 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2936 
	`DEBUGF
(
	`öfof
(
d©a
, "protocol connectÖhase DONE\n"));

2939 
FTP_SYST
:

2940 if(
·pcode
 == 215) {

2941 *
±r
=&
d©a
->
°©e
.
buf„r
[4];

2942 *
os
;

2943 *
°‹e
;

2945 
os
 = 
	`mÆloc
(
ƒód
 + 1);

2946 if(!
os
)

2947  
CURLE_OUT_OF_MEMORY
;

2952 *
±r
 == ' ')

2953 
±r
++;

2954 
°‹e
 = 
os
; *
±r
 && *ptr != ' ';)

2955 *
°‹e
++ = *
±r
++;

2956 *
°‹e
 = '\0';

2960 if(
	`°ªquÆ
(
os
, "OS/400")) {

2962 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
·pc
->
µ
, "%s", "SITE NAMEFMT 1");

2963 if(
ªsu…
 !
CURLE_OK
) {

2964 
	`‰ì
(
os
);

2965  
ªsu…
;

2968 
	`Cuæ_ß„‰ì
(
·pc
->
£rvî_os
);

2969 
·pc
->
£rvî_os
 = 
os
;

2970 
	`°©e
(
c⁄n
, 
FTP_NAMEFMT
);

2976 
	`Cuæ_ß„‰ì
(
·pc
->
£rvî_os
);

2977 
·pc
->
£rvî_os
 = 
os
;

2984 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2985 
	`DEBUGF
(
	`öfof
(
d©a
, "protocol connectÖhase DONE\n"));

2988 
FTP_NAMEFMT
:

2989 if(
·pcode
 == 250) {

2991 
	`·p_°©e_pwd
(
c⁄n
);

2995 
	`°©e
(
c⁄n
, 
FTP_STOP
);

2996 
	`DEBUGF
(
	`öfof
(
d©a
, "protocol connectÖhase DONE\n"));

2999 
FTP_QUOTE
:

3000 
FTP_POSTQUOTE
:

3001 
FTP_RETR_PREQUOTE
:

3002 
FTP_STOR_PREQUOTE
:

3003 if((
·pcode
 >400Ë&& !
·pc
->
cou¡2
) {

3005 
	`Áûf
(
c⁄n
->
d©a
, "QUOT comm™d faûed wôh %03d", 
·pcode
);

3006  
CURLE_QUOTE_ERROR
;

3008 
ªsu…
 = 
	`·p_°©e_quŸe
(
c⁄n
, 
FALSE
, 
·pc
->
°©e
);

3009 if(
ªsu…
)

3010  
ªsu…
;

3014 
FTP_CWD
:

3015 if(
·pcode
/100 != 2) {

3017 if(
c⁄n
->
d©a
->
£t
.
·p_¸óã_missög_dús
 &&

3018 
·pc
->
cou¡1
 && !·pc->
cou¡2
) {

3020 
·pc
->
cou¡2
++;

3021 
	`PPSENDF
(&
·pc
->
µ
, "MKD %s", fçc->
dús
[·pc->
cou¡1
 - 1]);

3022 
	`°©e
(
c⁄n
, 
FTP_MKD
);

3026 
	`Áûf
(
d©a
, "Server denied youÅo changeÅoÅhe given directory");

3027 
·pc
->
cwdÁû
 = 
TRUE
;

3029  
CURLE_REMOTE_ACCESS_DENIED
;

3034 
·pc
->
cou¡2
=0;

3035 if(++
·pc
->
cou¡1
 <·pc->
dúdïth
) {

3037 
	`PPSENDF
(&
·pc
->
µ
, "CWD %s", fçc->
dús
[·pc->
cou¡1
 - 1]);

3040 
ªsu…
 = 
	`·p_°©e_mdtm
(
c⁄n
);

3041 if(
ªsu…
)

3042  
ªsu…
;

3047 
FTP_MKD
:

3048 if((
·pcode
/100 !2Ë&& !
·pc
->
cou¡3
--) {

3050 
	`Áûf
(
d©a
, "FaûedÅÿMKD dú: %03d", 
·pcode
);

3051  
CURLE_REMOTE_ACCESS_DENIED
;

3053 
	`°©e
(
c⁄n
, 
FTP_CWD
);

3055 
	`PPSENDF
(&
·pc
->
µ
, "CWD %s", fçc->
dús
[·pc->
cou¡1
 - 1]);

3058 
FTP_MDTM
:

3059 
ªsu…
 = 
	`·p_°©e_mdtm_ª•
(
c⁄n
, 
·pcode
);

3062 
FTP_TYPE
:

3063 
FTP_LIST_TYPE
:

3064 
FTP_RETR_TYPE
:

3065 
FTP_STOR_TYPE
:

3066 
ªsu…
 = 
	`·p_°©e_ty≥_ª•
(
c⁄n
, 
·pcode
, 
·pc
->
°©e
);

3069 
FTP_SIZE
:

3070 
FTP_RETR_SIZE
:

3071 
FTP_STOR_SIZE
:

3072 
ªsu…
 = 
	`·p_°©e_size_ª•
(
c⁄n
, 
·pcode
, 
·pc
->
°©e
);

3075 
FTP_REST
:

3076 
FTP_RETR_REST
:

3077 
ªsu…
 = 
	`·p_°©e_ª°_ª•
(
c⁄n
, 
·pcode
, 
·pc
->
°©e
);

3080 
FTP_PRET
:

3081 if(
·pcode
 != 200) {

3083 
	`Áûf
(
d©a
, "PRET comm™dÇŸác˚±ed: %03d", 
·pcode
);

3084  
CURLE_FTP_PRET_FAILED
;

3086 
ªsu…
 = 
	`·p_°©e_u£_∑sv
(
c⁄n
);

3089 
FTP_PASV
:

3090 
ªsu…
 = 
	`·p_°©e_∑sv_ª•
(
c⁄n
, 
·pcode
);

3093 
FTP_PORT
:

3094 
ªsu…
 = 
	`·p_°©e_p‹t_ª•
(
c⁄n
, 
·pcode
);

3097 
FTP_LIST
:

3098 
FTP_RETR
:

3099 
ªsu…
 = 
	`·p_°©e_gë_ª•
(
c⁄n
, 
·pcode
, 
·pc
->
°©e
);

3102 
FTP_STOR
:

3103 
ªsu…
 = 
	`·p_°©e_°‹_ª•
(
c⁄n
, 
·pcode
, 
·pc
->
°©e
);

3106 
FTP_QUIT
:

3110 
	`°©e
(
c⁄n
, 
FTP_STOP
);

3115  
ªsu…
;

3116 
	}
}

3120 
CURLcode
 
	$·p_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
,

3121 
boﬁ
 *
d⁄e
)

3123 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

3124 
CURLcode
 
ªsu…
 = 
	`Cuæ_µ_°©emach
(&
·pc
->
µ
, 
FALSE
);

3129 *
d⁄e
 = (
·pc
->
°©e
 =
FTP_STOP
Ë? 
TRUE
 : 
FALSE
;

3131  
ªsu…
;

3132 
	}
}

3134 
CURLcode
 
	$·p_block_°©emach
(
c⁄√˘d©a
 *
c⁄n
)

3136 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

3137 
pögp⁄g
 *
µ
 = &
·pc
->pp;

3138 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

3140 
·pc
->
°©e
 !
FTP_STOP
) {

3141 
ªsu…
 = 
	`Cuæ_µ_°©emach
(
µ
, 
TRUE
);

3142 if(
ªsu…
)

3146  
ªsu…
;

3147 
	}
}

3157 
CURLcode
 
	$·p_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

3158 
boﬁ
 *
d⁄e
)

3160 
CURLcode
 
ªsu…
;

3161 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

3162 
pögp⁄g
 *
µ
 = &
·pc
->pp;

3164 *
d⁄e
 = 
FALSE
;

3167 
	`c⁄nkìp
(
c⁄n
, "FTP default");

3169 
µ
->
ª•⁄£_time
 = 
RESP_TIMEOUT
;

3170 
µ
->
°©emach_a˘
 = 
·p_°©emach_a˘
;

3171 
µ
->
ído‰e•
 = 
·p_ído‰e•
;

3172 
µ
->
c⁄n
 = conn;

3174 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
) {

3176 
ªsu…
 = 
	`Cuæ_s¶_c⁄√˘
(
c⁄n
, 
FIRSTSOCKET
);

3177 if(
ªsu…
)

3178  
ªsu…
;

3181 
	`Cuæ_µ_öô
(
µ
);

3185 
	`°©e
(
c⁄n
, 
FTP_WAIT220
);

3187 
ªsu…
 = 
	`·p_mu…i_°©emach
(
c⁄n
, 
d⁄e
);

3189  
ªsu…
;

3190 
	}
}

3201 
CURLcode
 
	$·p_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
°©us
,

3202 
boﬁ
 
¥em©uª
)

3204 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

3205 
FTP
 *
·p
 = 
d©a
->
ªq
.
¥Ÿ›
;

3206 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

3207 
pögp⁄g
 *
µ
 = &
·pc
->pp;

3208 
ssize_t
 
ƒód
;

3209 
·pcode
;

3210 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

3211 
boﬁ
 
was_˘l_vÆid
 = 
·pc
->
˘l_vÆid
;

3212 *
∑th
;

3213 c⁄° *
∑th_to_u£
 = 
d©a
->
°©e
.
∑th
;

3215 if(!
·p
)

3221  
CURLE_OK
;

3223 
°©us
) {

3224 
CURLE_BAD_DOWNLOAD_RESUME
:

3225 
CURLE_FTP_WEIRD_PASV_REPLY
:

3226 
CURLE_FTP_PORT_FAILED
:

3227 
CURLE_FTP_ACCEPT_FAILED
:

3228 
CURLE_FTP_ACCEPT_TIMEOUT
:

3229 
CURLE_FTP_COULDNT_SET_TYPE
:

3230 
CURLE_FTP_COULDNT_RETR_FILE
:

3231 
CURLE_PARTIAL_FILE
:

3232 
CURLE_UPLOAD_FAILED
:

3233 
CURLE_REMOTE_ACCESS_DENIED
:

3234 
CURLE_FILESIZE_EXCEEDED
:

3235 
CURLE_REMOTE_FILE_NOT_FOUND
:

3236 
CURLE_WRITE_ERROR
:

3239 
CURLE_OK
:

3240 if(!
¥em©uª
) {

3241 
·pc
->
˘l_vÆid
 = 
was_˘l_vÆid
;

3248 
·pc
->
˘l_vÆid
 = 
FALSE
;

3249 
·pc
->
cwdÁû
 = 
TRUE
;

3251 
	`c⁄n˛o£
(
c⁄n
, "FTPÉnded with badÉrror code");

3252 
ªsu…
 = 
°©us
;

3257 if(
·pc
->
¥ev∑th
)

3258 
	`‰ì
(
·pc
->
¥ev∑th
);

3260 if(
d©a
->
£t
.
wûdˇrdm©ch
) {

3261 if(
d©a
->
£t
.
chunk_íd
 && 
·pc
->
fûe
) {

3262 
d©a
->
£t
.
	`chunk_íd
(d©a->
wûdˇrd
.
cu°om±r
);

3264 
·pc
->
known_fûesize
 = -1;

3268 
∑th
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
, 
∑th_to_u£
, 0, 
NULL
);

3269 if(!
∑th
) {

3272 if(!
ªsu…
)

3273 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

3274 
·pc
->
˘l_vÆid
 = 
FALSE
;

3275 
	`c⁄n˛o£
(
c⁄n
, "FTP: out of memory!");

3276 
·pc
->
¥ev∑th
 = 
NULL
;

3279 
size_t
 
Êí
 = 
·pc
->
fûe
?
	`°æí
(ftpc->file):0;

3280 
size_t
 
dÀn
 = 
	`°æí
(
∑th
)-
Êí
;

3281 if(!
·pc
->
cwdÁû
) {

3282 if(
dÀn
 && (
d©a
->
£t
.
·p_fûemëhod
 !
FTPFILE_NOCWD
)) {

3283 
·pc
->
¥ev∑th
 = 
∑th
;

3284 if(
Êí
)

3286 
·pc
->
¥ev∑th
[
dÀn
]=0;

3290 
·pc
->
¥ev∑th
=
	`°rdup
("");

3291 
	`‰ì
(
∑th
);

3293 if(
·pc
->
¥ev∑th
)

3294 
	`öfof
(
d©a
, "Remembîög wê¨êö dú \"%s\"\n", 
·pc
->
¥ev∑th
);

3297 
·pc
->
¥ev∑th
 = 
NULL
;

3298 
	`‰ì
(
∑th
);

3302 
	`‰ìdús
(
·pc
);

3306 #ifde‡
_WIN32_WCE


3307 
	`shutdown
(
c⁄n
->
sock
[
SECONDARYSOCKET
],2);

3310 if(
c⁄n
->
sock
[
SECONDARYSOCKET
] !
CURL_SOCKET_BAD
) {

3311 if(!
ªsu…
 && 
·pc
->
d⁄t_check
 && 
d©a
->
ªq
.
maxdow∆ﬂd
 > 0) {

3313 
ªsu…
 = 
	`Cuæ_µ_£ndf
(
µ
, "%s", "ABOR");

3314 if(
ªsu…
) {

3315 
	`Áûf
(
d©a
, "Failure sending ABOR command: %s",

3316 
	`cuæ_ósy_°ªº‹
(
ªsu…
));

3317 
·pc
->
˘l_vÆid
 = 
FALSE
;

3318 
	`c⁄n˛o£
(
c⁄n
, "ABOR command failed");

3322 if(
c⁄n
->
s¶
[
SECONDARYSOCKET
].
u£
) {

3325 
	`Cuæ_s¶_˛o£
(
c⁄n
, 
SECONDARYSOCKET
);

3330 if(
CURL_SOCKET_BAD
 !
c⁄n
->
sock
[
SECONDARYSOCKET
]) {

3331 
	`Cuæ_˛o£sockë
(
c⁄n
, c⁄n->
sock
[
SECONDARYSOCKET
]);

3332 
c⁄n
->
sock
[
SECONDARYSOCKET
] = 
CURL_SOCKET_BAD
;

3333 
c⁄n
->
bôs
.
t˝c⁄√˘
[
SECONDARYSOCKET
] = 
FALSE
;

3337 if(!
ªsu…
 && (
·p
->
å™s„r
 =
FTPTRANSFER_BODY
Ë&& 
·pc
->
˘l_vÆid
 &&

3338 
µ
->
≥ndög_ª•
 && !
¥em©uª
) {

3345 
ﬁd_time
 = 
µ
->
ª•⁄£_time
;

3347 
µ
->
ª•⁄£_time
 = 60*1000;

3348 
µ
->
ª•⁄£
 = 
	`Cuæ_tvnow
();

3350 
ªsu…
 = 
	`Cuæ_GëFTPRe•⁄£
(&
ƒód
, 
c⁄n
, &
·pcode
);

3352 
µ
->
ª•⁄£_time
 = 
ﬁd_time
;

3354 if(!
ƒód
 && (
CURLE_OPERATION_TIMEDOUT
 =
ªsu…
)) {

3355 
	`Áûf
(
d©a
, "control connectionÜooks dead");

3356 
·pc
->
˘l_vÆid
 = 
FALSE
;

3357 
	`c⁄n˛o£
(
c⁄n
, "Timeout or similar in FTP DONE operation");

3360 if(
ªsu…
)

3361  
ªsu…
;

3363 if(
·pc
->
d⁄t_check
 && 
d©a
->
ªq
.
maxdow∆ﬂd
 > 0) {

3366 
	`öfof
(
d©a
, "partial download completed, closing connection\n");

3367 
	`c⁄n˛o£
(
c⁄n
, "Partial download withÇoábilityÅo check");

3368  
ªsu…
;

3371 if(!
·pc
->
d⁄t_check
) {

3373 if((
·pcode
 != 226) && (ftpcode != 250)) {

3374 
	`Áûf
(
d©a
, "£rvî didÇŸÑï‹àOK, gŸ %d", 
·pcode
);

3375 
ªsu…
 = 
CURLE_PARTIAL_FILE
;

3380 if(
ªsu…
 || 
¥em©uª
)

3384 if(
d©a
->
£t
.
u∂ﬂd
) {

3385 if((-1 !
d©a
->
°©e
.
öfûesize
) &&

3386 (
d©a
->
°©e
.
öfûesize
 !*
·p
->
byãcou¡p
) &&

3387 !
d©a
->
£t
.
¸lf
 &&

3388 (
·p
->
å™s„r
 =
FTPTRANSFER_BODY
)) {

3389 
	`Áûf
(
d©a
, "U∂ﬂded u«lig√d fûêsizê(%" 
CURL_FORMAT_CURL_OFF_T


3390 " ouào‡%" 
CURL_FORMAT_CURL_OFF_T
 " bytes)",

3391 *
·p
->
byãcou¡p
, 
d©a
->
°©e
.
öfûesize
);

3392 
ªsu…
 = 
CURLE_PARTIAL_FILE
;

3396 if((-1 !
d©a
->
ªq
.
size
) &&

3397 (
d©a
->
ªq
.
size
 !*
·p
->
byãcou¡p
) &&

3398 #ifde‡
CURL_DO_LINEEND_CONV


3403 ((
d©a
->
ªq
.
size
 + d©a->
°©e
.
¸lf_c⁄vîsi⁄s
) !=

3404 *
·p
->
byãcou¡p
) &&

3406 (
d©a
->
ªq
.
maxdow∆ﬂd
 !*
·p
->
byãcou¡p
)) {

3407 
	`Áûf
(
d©a
, "Re˚ived o∆yÖ¨tü»fûe: %" 
CURL_FORMAT_CURL_OFF_T


3408 " byãs", *
·p
->
byãcou¡p
);

3409 
ªsu…
 = 
CURLE_PARTIAL_FILE
;

3411 if(!
·pc
->
d⁄t_check
 &&

3412 !*
·p
->
byãcou¡p
 &&

3413 (
d©a
->
ªq
.
size
>0)) {

3414 
	`Áûf
(
d©a
, "No data wasÑeceived!");

3415 
ªsu…
 = 
CURLE_FTP_COULDNT_RETR_FILE
;

3420 
·p
->
å™s„r
 = 
FTPTRANSFER_BODY
;

3421 
·pc
->
d⁄t_check
 = 
FALSE
;

3424 if(!
°©us
 && !
ªsu…
 && !
¥em©uª
 && 
d©a
->
£t
.
po°quŸe
)

3425 
ªsu…
 = 
	`·p_£ndquŸe
(
c⁄n
, 
d©a
->
£t
.
po°quŸe
);

3427  
ªsu…
;

3428 
	}
}

3441 
CURLcode
 
	$·p_£ndquŸe
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_¶i°
 *
quŸe
)

3443 
cuæ_¶i°
 *
ôem
;

3444 
ssize_t
 
ƒód
;

3445 
·pcode
;

3446 
CURLcode
 
ªsu…
;

3447 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

3448 
pögp⁄g
 *
µ
 = &
·pc
->pp;

3450 
ôem
 = 
quŸe
;

3451 
ôem
) {

3452 if(
ôem
->
d©a
) {

3453 *
cmd
 = 
ôem
->
d©a
;

3454 
boﬁ
 
ac˚±Áû
 = 
FALSE
;

3461 if(
cmd
[0] == '*') {

3462 
cmd
++;

3463 
ac˚±Áû
 = 
TRUE
;

3466 
	`PPSENDF
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "%s", 
cmd
);

3468 
µ
->
ª•⁄£
 = 
	`Cuæ_tvnow
();

3470 
ªsu…
 = 
	`Cuæ_GëFTPRe•⁄£
(&
ƒód
, 
c⁄n
, &
·pcode
);

3471 if(
ªsu…
)

3472  
ªsu…
;

3474 if(!
ac˚±Áû
 && (
·pcode
 >= 400)) {

3475 
	`Áûf
(
c⁄n
->
d©a
, "QUOT såögÇŸác˚±ed: %s", 
cmd
);

3476  
CURLE_QUOTE_ERROR
;

3480 
ôem
 = iãm->
√xt
;

3483  
CURLE_OK
;

3484 
	}
}

3492 
	$·p_√ed_ty≥
(
c⁄√˘d©a
 *
c⁄n
,

3493 
boﬁ
 
ascii_w™ãd
)

3495  
c⁄n
->
¥Ÿo
.
·pc
.
å™s„πy≥
 !(
ascii_w™ãd
?'A':'I');

3496 
	}
}

3506 
CURLcode
 
	$·p_nb_ty≥
(
c⁄√˘d©a
 *
c⁄n
,

3507 
boﬁ
 
ascii
, 
·p°©e
 
√w°©e
)

3509 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

3510 
CURLcode
 
ªsu…
;

3511 
w™t
 = ()(
ascii
?'A':'I');

3513 if(
·pc
->
å™s„πy≥
 =
w™t
) {

3514 
	`°©e
(
c⁄n
, 
√w°©e
);

3515  
	`·p_°©e_ty≥_ª•
(
c⁄n
, 200, 
√w°©e
);

3518 
	`PPSENDF
(&
·pc
->
µ
, "TYPE %c", 
w™t
);

3519 
	`°©e
(
c⁄n
, 
√w°©e
);

3522 
·pc
->
å™s„πy≥
 = 
w™t
;

3523  
CURLE_OK
;

3524 
	}
}

3535 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


3537 
	$·p_∑sv_vîbo£
(
c⁄√˘d©a
 *
c⁄n
,

3538 
Cuæ_addröfo
 *
ai
,

3539 *
√who°
,

3540 
p‹t
)

3542 
buf
[256];

3543 
	`Cuæ_¥öèbÀ_addªss
(
ai
, 
buf
, (buf));

3544 
	`öfof
(
c⁄n
->
d©a
, "C⁄√˘ögÅÿ%†(%sËp‹à%d\n", 
√who°
, 
buf
, 
p‹t
);

3545 
	}
}

3553 
CURLcode
 
	$·p_ønge
(
c⁄√˘d©a
 *
c⁄n
)

3555 
cuæ_off_t
 
‰om
, 
to
;

3556 *
±r
;

3557 *
±r2
;

3558 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

3559 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

3561 if(
d©a
->
°©e
.
u£_ønge
 && d©a->°©e.
ønge
) {

3562 
‰om
=
	`cuæx_°πoof·
(
d©a
->
°©e
.
ønge
, &
±r
, 0);

3563 *
±r
 && (
	`ISSPACE
(*ptr) || (*ptr=='-')))

3564 
±r
++;

3565 
to
=
	`cuæx_°πoof·
(
±r
, &
±r2
, 0);

3566 if(
±r
 =
±r2
) {

3568 
to
=-1;

3570 if((-1 =
to
Ë&& (
‰om
>=0)) {

3572 
d©a
->
°©e
.
ªsume_‰om
 = 
‰om
;

3573 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "FTP RANGE %" 
CURL_FORMAT_CURL_OFF_T


3574 "Åÿíd o‡fûe\n", 
‰om
));

3576 if(
‰om
 < 0) {

3578 
d©a
->
ªq
.
maxdow∆ﬂd
 = -
‰om
;

3579 
d©a
->
°©e
.
ªsume_‰om
 = 
‰om
;

3580 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "FTP RANGEÅhêœ° %" 
CURL_FORMAT_CURL_OFF_T


3581 " byãs\n", -
‰om
));

3585 
d©a
->
ªq
.
maxdow∆ﬂd
 = (
to
-
‰om
)+1;

3586 
d©a
->
°©e
.
ªsume_‰om
 = 
‰om
;

3587 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "FTP RANGE from %" 
CURL_FORMAT_CURL_OFF_T


3588 " gëtög %" 
CURL_FORMAT_CURL_OFF_T
 " bytes\n",

3589 
‰om
, 
d©a
->
ªq
.
maxdow∆ﬂd
));

3591 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "ønge-dow∆ﬂd from %" 
CURL_FORMAT_CURL_OFF_T


3592 "Åÿ%" 
CURL_FORMAT_CURL_OFF_T
 ",Åotally %"

3593 
CURL_FORMAT_CURL_OFF_T
 " bytes\n",

3594 
‰om
, 
to
, 
d©a
->
ªq
.
maxdow∆ﬂd
));

3595 
·pc
->
d⁄t_check
 = 
TRUE
;

3598 
d©a
->
ªq
.
maxdow∆ﬂd
 = -1;

3599  
CURLE_OK
;

3600 
	}
}

3614 
CURLcode
 
	$·p_do_m‹e
(
c⁄√˘d©a
 *
c⁄n
, *
com∂ëï
)

3616 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

3617 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

3618 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

3619 
boﬁ
 
c⁄√˘ed
 = 
FALSE
;

3620 
boﬁ
 
com∂ëe
 = 
FALSE
;

3623 
FTP
 *
·p
 = 
d©a
->
ªq
.
¥Ÿ›
;

3626 if(!
c⁄n
->
bôs
.
t˝c⁄√˘
[
SECONDARYSOCKET
]) {

3627 if(
c⁄n
->
tu¬ñ_°©e
[
SECONDARYSOCKET
] =
TUNNEL_CONNECT
) {

3630 
ªsu…
 = 
	`Cuæ_¥oxyCONNECT
(
c⁄n
, 
SECONDARYSOCKET
, 
NULL
, 0);

3632  
ªsu…
;

3635 
ªsu…
 = 
	`Cuæ_is_c⁄√˘ed
(
c⁄n
, 
SECONDARYSOCKET
, &
c⁄√˘ed
);

3638 if(
c⁄√˘ed
) {

3639 
	`DEBUGF
(
	`öfof
(
d©a
, "DO-MORE connectedÖhase starts\n"));

3640 if(
c⁄n
->
bôs
.
¥oxy
) {

3641 
	`öfof
(
d©a
, "ConnectionÅoÖroxy confirmed\n");

3642 
ªsu…
 = 
	`¥oxy_magic
(
c⁄n
, 
·pc
->
√who°
, fçc->
√wp‹t
, &
c⁄√˘ed
);

3646 if(
ªsu…
 && (
·pc
->
cou¡1
 == 0)) {

3647 *
com∂ëï
 = -1;

3649  
	`·p_ïsv_dißbÀ
(
c⁄n
);

3651  
ªsu…
;

3655 if(
·pc
->
°©e
) {

3658 
ªsu…
 = 
	`·p_mu…i_°©emach
(
c⁄n
, &
com∂ëe
);

3660 *
com∂ëï
 = ()
com∂ëe
;

3664 if(
ªsu…
 || (
·pc
->
waô_d©a_c⁄n
 !
TRUE
))

3665  
ªsu…
;

3667 if(
·pc
->
waô_d©a_c⁄n
)

3671 *
com∂ëï
 = 0;

3674 if(
·p
->
å™s„r
 <
FTPTRANSFER_INFO
) {

3678 if(
·pc
->
waô_d©a_c⁄n
 =
TRUE
) {

3679 
boﬁ
 
£rv_c⁄√d
;

3681 
ªsu…
 = 
	`Re˚ivedSîvîC⁄√˘
(
c⁄n
, &
£rv_c⁄√d
);

3682 if(
ªsu…
)

3683  
ªsu…
;

3685 if(
£rv_c⁄√d
) {

3687 
ªsu…
 = 
	`Ac˚±SîvîC⁄√˘
(
c⁄n
);

3688 
·pc
->
waô_d©a_c⁄n
 = 
FALSE
;

3689 if(!
ªsu…
)

3690 
ªsu…
 = 
	`InôüãTøns„r
(
c⁄n
);

3692 if(
ªsu…
)

3693  
ªsu…
;

3695 *
com∂ëï
 = 1;

3699 if(
d©a
->
£t
.
u∂ﬂd
) {

3700 
ªsu…
 = 
	`·p_nb_ty≥
(
c⁄n
, 
d©a
->
£t
.
¥e„r_ascii
, 
FTP_STOR_TYPE
);

3701 if(
ªsu…
)

3702  
ªsu…
;

3704 
ªsu…
 = 
	`·p_mu…i_°©emach
(
c⁄n
, &
com∂ëe
);

3705 *
com∂ëï
 = ()
com∂ëe
;

3709 
·p
->
dow∆ﬂdsize
 = -1;

3711 
ªsu…
 = 
	`·p_ønge
(
c⁄n
);

3712 if(
ªsu…
)

3714 if(
d©a
->
£t
.
·p_li°_⁄ly
 || !
·pc
->
fûe
) {

3720 if(
·p
->
å™s„r
 =
FTPTRANSFER_BODY
) {

3721 
ªsu…
 = 
	`·p_nb_ty≥
(
c⁄n
, 
TRUE
, 
FTP_LIST_TYPE
);

3722 if(
ªsu…
)

3723  
ªsu…
;

3728 
ªsu…
 = 
	`·p_nb_ty≥
(
c⁄n
, 
d©a
->
£t
.
¥e„r_ascii
, 
FTP_RETR_TYPE
);

3729 if(
ªsu…
)

3730  
ªsu…
;

3733 
ªsu…
 = 
	`·p_mu…i_°©emach
(
c⁄n
, &
com∂ëe
);

3734 *
com∂ëï
 = ()
com∂ëe
;

3736  
ªsu…
;

3739 if((
ªsu…
 =
CURLE_OK
Ë&& (
·p
->
å™s„r
 !
FTPTRANSFER_BODY
))

3742 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

3744 if(!
·pc
->
waô_d©a_c⁄n
) {

3746 *
com∂ëï
 = 1;

3747 
	`DEBUGF
(
	`öfof
(
d©a
, "DO-MOREÖha£Énd†wôh %d\n", ()
ªsu…
));

3750  
ªsu…
;

3751 
	}
}

3764 
CURLcode
 
	$·p_≥rf‹m
(
c⁄√˘d©a
 *
c⁄n
,

3765 
boﬁ
 *
c⁄√˘ed
,

3766 
boﬁ
 *
d›ha£_d⁄e
)

3769 
CURLcode
 
ªsu…
=
CURLE_OK
;

3771 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase starts\n"));

3773 if(
c⁄n
->
d©a
->
£t
.
›t_no_body
) {

3775 
FTP
 *
·p
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

3776 
·p
->
å™s„r
 = 
FTPTRANSFER_INFO
;

3779 *
d›ha£_d⁄e
 = 
FALSE
;

3782 
ªsu…
 = 
	`·p_°©e_quŸe
(
c⁄n
, 
TRUE
, 
FTP_QUOTE
);

3783 if(
ªsu…
)

3784  
ªsu…
;

3787 
ªsu…
 = 
	`·p_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

3789 *
c⁄√˘ed
 = 
c⁄n
->
bôs
.
t˝c⁄√˘
[
SECONDARYSOCKET
];

3791 
	`öfof
(
c⁄n
->
d©a
, "·p_≥rf‹mÉnd†wôh SECONDARY: %d\n", *
c⁄√˘ed
);

3793 if(*
d›ha£_d⁄e
)

3794 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete1\n"));

3796  
ªsu…
;

3797 
	}
}

3799 
	$wc_d©a_dt‹
(*
±r
)

3801 
·p_wc_tmpd©a
 *
tmp
 = 
±r
;

3802 if(
tmp
)

3803 
	`Cuæ_·p_∑r£li°_d©a_‰ì
(&
tmp
->
∑r£r
);

3804 
	`Cuæ_ß„‰ì
(
tmp
);

3805 
	}
}

3807 
CURLcode
 
	$öô_wc_d©a
(
c⁄√˘d©a
 *
c⁄n
)

3809 *
œ°_¶ash
;

3810 *
∑th
 = 
c⁄n
->
d©a
->
°©e
.path;

3811 
WûdˇrdD©a
 *
wûdˇrd
 = &(
c⁄n
->
d©a
->wildcard);

3812 
CURLcode
 
ªt
 = 
CURLE_OK
;

3813 
·p_wc_tmpd©a
 *
·p_tmp
;

3815 
œ°_¶ash
 = 
	`°ºchr
(
c⁄n
->
d©a
->
°©e
.
∑th
, '/');

3816 if(
œ°_¶ash
) {

3817 
œ°_¶ash
++;

3818 if(
œ°_¶ash
[0] == '\0') {

3819 
wûdˇrd
->
°©e
 = 
CURLWC_CLEAN
;

3820 
ªt
 = 
	`·p_∑r£_uæ_∑th
(
c⁄n
);

3821  
ªt
;

3824 
wûdˇrd
->
∑âîn
 = 
	`°rdup
(
œ°_¶ash
);

3825 if(!
wûdˇrd
->
∑âîn
)

3826  
CURLE_OUT_OF_MEMORY
;

3827 
œ°_¶ash
[0] = '\0';

3831 if(
∑th
[0]) {

3832 
wûdˇrd
->
∑âîn
 = 
	`°rdup
(
∑th
);

3833 if(!
wûdˇrd
->
∑âîn
)

3834  
CURLE_OUT_OF_MEMORY
;

3835 
∑th
[0] = '\0';

3838 
wûdˇrd
->
°©e
 = 
CURLWC_CLEAN
;

3839 
ªt
 = 
	`·p_∑r£_uæ_∑th
(
c⁄n
);

3840  
ªt
;

3848 
·p_tmp
 = 
	`ˇŒoc
(1, (
·p_wc_tmpd©a
));

3849 if(!
·p_tmp
) {

3850 
	`Cuæ_ß„‰ì
(
wûdˇrd
->
∑âîn
);

3851  
CURLE_OUT_OF_MEMORY
;

3855 
·p_tmp
->
∑r£r
 = 
	`Cuæ_·p_∑r£li°_d©a_Æloc
();

3856 if(!
·p_tmp
->
∑r£r
) {

3857 
	`Cuæ_ß„‰ì
(
wûdˇrd
->
∑âîn
);

3858 
	`Cuæ_ß„‰ì
(
·p_tmp
);

3859  
CURLE_OUT_OF_MEMORY
;

3862 
wûdˇrd
->
tmp
 = 
·p_tmp
;

3863 
wûdˇrd
->
tmp_dt‹
 = 
wc_d©a_dt‹
;

3866 if(
c⁄n
->
d©a
->
£t
.
·p_fûemëhod
 =
FTPFILE_NOCWD
)

3867 
c⁄n
->
d©a
->
£t
.
·p_fûemëhod
 = 
FTPFILE_MULTICWD
;

3870 
ªt
 = 
	`·p_∑r£_uæ_∑th
(
c⁄n
);

3871 if(
ªt
) {

3872 
	`Cuæ_ß„‰ì
(
wûdˇrd
->
∑âîn
);

3873 
wûdˇrd
->
	`tmp_dt‹
(wûdˇrd->
tmp
);

3874 
wûdˇrd
->
tmp_dt‹
 = 
ZERO_NULL
;

3875 
wûdˇrd
->
tmp
 = 
NULL
;

3876  
ªt
;

3879 
wûdˇrd
->
∑th
 = 
	`°rdup
(
c⁄n
->
d©a
->
°©e
.path);

3880 if(!
wûdˇrd
->
∑th
) {

3881 
	`Cuæ_ß„‰ì
(
wûdˇrd
->
∑âîn
);

3882 
wûdˇrd
->
	`tmp_dt‹
(wûdˇrd->
tmp
);

3883 
wûdˇrd
->
tmp_dt‹
 = 
ZERO_NULL
;

3884 
wûdˇrd
->
tmp
 = 
NULL
;

3885  
CURLE_OUT_OF_MEMORY
;

3889 
·p_tmp
->
backup
.
wrôe_fun˘i⁄
 = 
c⁄n
->
d©a
->
£t
.
fwrôe_func
;

3891 
c⁄n
->
d©a
->
£t
.
fwrôe_func
 = 
Cuæ_·p_∑r£li°
;

3893 
·p_tmp
->
backup
.
fûe_des¸ùt‹
 = 
c⁄n
->
d©a
->
£t
.
out
;

3895 
c⁄n
->
d©a
->
£t
.
out
 = conn;

3897 
	`öfof
(
c⁄n
->
d©a
, "Wildcard - Parsing started\n");

3898  
CURLE_OK
;

3899 
	}
}

3902 
CURLcode
 
	$wc_°©emach
(
c⁄√˘d©a
 *
c⁄n
)

3904 
WûdˇrdD©a
 * c⁄° 
wûdˇrd
 = &(
c⁄n
->
d©a
->wildcard);

3905 
CURLcode
 
ªt
 = 
CURLE_OK
;

3907 
wûdˇrd
->
°©e
) {

3908 
CURLWC_INIT
:

3909 
ªt
 = 
	`öô_wc_d©a
(
c⁄n
);

3910 if(
wûdˇrd
->
°©e
 =
CURLWC_CLEAN
)

3914 
wûdˇrd
->
°©e
 = 
ªt
 ? 
CURLWC_ERROR
 : 
CURLWC_MATCHING
;

3917 
CURLWC_MATCHING
: {

3920 
·p_wc_tmpd©a
 *
·p_tmp
 = 
wûdˇrd
->
tmp
;

3921 
c⁄n
->
d©a
->
£t
.
fwrôe_func
 = 
·p_tmp
->
backup
.
wrôe_fun˘i⁄
;

3922 
c⁄n
->
d©a
->
£t
.
out
 = 
·p_tmp
->
backup
.
fûe_des¸ùt‹
;

3923 
·p_tmp
->
backup
.
wrôe_fun˘i⁄
 = 
ZERO_NULL
;

3924 
·p_tmp
->
backup
.
fûe_des¸ùt‹
 = 
NULL
;

3925 
wûdˇrd
->
°©e
 = 
CURLWC_DOWNLOADING
;

3927 if(
	`Cuæ_·p_∑r£li°_gëîr‹
(
·p_tmp
->
∑r£r
)) {

3929 
wûdˇrd
->
°©e
 = 
CURLWC_CLEAN
;

3930  
	`wc_°©emach
(
c⁄n
);

3932 if(
wûdˇrd
->
fûñi°
->
size
 == 0) {

3934 
wûdˇrd
->
°©e
 = 
CURLWC_CLEAN
;

3935  
CURLE_REMOTE_FILE_NOT_FOUND
;

3937  
	`wc_°©emach
(
c⁄n
);

3940 
CURLWC_DOWNLOADING
: {

3942 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

3943 
cuæ_fûeöfo
 *
föfo
 = 
wûdˇrd
->
fûñi°
->
hód
->
±r
;

3945 *
tmp_∑th
 = 
	`≠rötf
("%s%s", 
wûdˇrd
->
∑th
, 
föfo
->
fûíame
);

3946 if(!
tmp_∑th
)

3947  
CURLE_OUT_OF_MEMORY
;

3951 
	`Cuæ_ß„‰ì
(
c⁄n
->
d©a
->
°©e
.
∑thbuf„r
);

3952 
c⁄n
->
d©a
->
°©e
.
∑thbuf„r
 = 
tmp_∑th
;

3953 
c⁄n
->
d©a
->
°©e
.
∑th
 = 
tmp_∑th
;

3955 
	`öfof
(
c⁄n
->
d©a
, "Wûdˇrd - START o‡\"%s\"\n", 
föfo
->
fûíame
);

3956 if(
c⁄n
->
d©a
->
£t
.
chunk_bgn
) {

3957 
u£ºe•⁄£
 = 
c⁄n
->
d©a
->
£t
.
	`chunk_bgn
(

3958 
föfo
, 
wûdˇrd
->
cu°om±r
, ()wûdˇrd->
fûñi°
->
size
);

3959 
u£ºe•⁄£
) {

3960 
CURL_CHUNK_BGN_FUNC_SKIP
:

3961 
	`öfof
(
c⁄n
->
d©a
, "Wildcard - \"%s\" skipped by user\n",

3962 
föfo
->
fûíame
);

3963 
wûdˇrd
->
°©e
 = 
CURLWC_SKIP
;

3964  
	`wc_°©emach
(
c⁄n
);

3965 
CURL_CHUNK_BGN_FUNC_FAIL
:

3966  
CURLE_CHUNK_FAILED
;

3970 if(
föfo
->
fûëy≥
 !
CURLFILETYPE_FILE
) {

3971 
wûdˇrd
->
°©e
 = 
CURLWC_SKIP
;

3972  
	`wc_°©emach
(
c⁄n
);

3975 if(
föfo
->
Êags
 & 
CURLFINFOFLAG_KNOWN_SIZE
)

3976 
·pc
->
known_fûesize
 = 
föfo
->
size
;

3978 
ªt
 = 
	`·p_∑r£_uæ_∑th
(
c⁄n
);

3979 if(
ªt
) {

3980  
ªt
;

3984 
	`Cuæ_Œi°_ªmove
(
wûdˇrd
->
fûñi°
, wûdˇrd->fûñi°->
hód
, 
NULL
);

3986 if(
wûdˇrd
->
fûñi°
->
size
 == 0) {

3987 
wûdˇrd
->
°©e
 = 
CURLWC_CLEAN
;

3990  
CURLE_OK
;

3994 
CURLWC_SKIP
: {

3995 if(
c⁄n
->
d©a
->
£t
.
chunk_íd
)

3996 
c⁄n
->
d©a
->
£t
.
	`chunk_íd
(c⁄n->d©a->
wûdˇrd
.
cu°om±r
);

3997 
	`Cuæ_Œi°_ªmove
(
wûdˇrd
->
fûñi°
, wûdˇrd->fûñi°->
hód
, 
NULL
);

3998 
wûdˇrd
->
°©e
 = (wûdˇrd->
fûñi°
->
size
 == 0) ?

3999 
CURLWC_CLEAN
 : 
CURLWC_DOWNLOADING
;

4000  
	`wc_°©emach
(
c⁄n
);

4003 
CURLWC_CLEAN
: {

4004 
·p_wc_tmpd©a
 *
·p_tmp
 = 
wûdˇrd
->
tmp
;

4005 
ªt
 = 
CURLE_OK
;

4006 if(
·p_tmp
) {

4007 
ªt
 = 
	`Cuæ_·p_∑r£li°_gëîr‹
(
·p_tmp
->
∑r£r
);

4009 
wûdˇrd
->
°©e
 = 
ªt
 ? 
CURLWC_ERROR
 : 
CURLWC_DONE
;

4012 
CURLWC_DONE
:

4013 
CURLWC_ERROR
:

4017  
ªt
;

4018 
	}
}

4029 
CURLcode
 
	$·p_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

4031 
CURLcode
 
ªtcode
 = 
CURLE_OK
;

4032 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

4034 *
d⁄e
 = 
FALSE
;

4035 
·pc
->
waô_d©a_c⁄n
 = 
FALSE
;

4037 if(
c⁄n
->
d©a
->
£t
.
wûdˇrdm©ch
) {

4038 
ªtcode
 = 
	`wc_°©emach
(
c⁄n
);

4039 if(
c⁄n
->
d©a
->
wûdˇrd
.
°©e
 =
CURLWC_SKIP
 ||

4040 
c⁄n
->
d©a
->
wûdˇrd
.
°©e
 =
CURLWC_DONE
) {

4042  
CURLE_OK
;

4044 if(
ªtcode
)

4045  
ªtcode
;

4048 
ªtcode
 = 
	`·p_∑r£_uæ_∑th
(
c⁄n
);

4049 if(
ªtcode
)

4050  
ªtcode
;

4053 
ªtcode
 = 
	`·p_ªguœr_å™s„r
(
c⁄n
, 
d⁄e
);

4055  
ªtcode
;

4056 
	}
}

4059 
CURLcode
 
	$Cuæ_·p£ndf
(
c⁄√˘d©a
 *
c⁄n
,

4060 c⁄° *
fmt
, ...)

4062 
ssize_t
 
byãs_wrôãn
;

4063 
	#SBUF_SIZE
 1024

	)

4064 
s
[
SBUF_SIZE
];

4065 
size_t
 
wrôe_Àn
;

4066 *
•å
=
s
;

4067 
CURLcode
 
ªs
 = 
CURLE_OK
;

4068 #ifde‡
HAVE_GSSAPI


4069 
¥Ÿe˘i⁄_Àvñ
 
d©a_£c
 = 
c⁄n
->
d©a_¥Ÿ
;

4072 
va_li°
 
≠
;

4073 
	`va_°¨t
(
≠
, 
fmt
);

4074 
wrôe_Àn
 = 
	`v¢¥ötf
(
s
, 
SBUF_SIZE
-3, 
fmt
, 
≠
);

4075 
	`va_íd
(
≠
);

4077 
	`°r˝y
(&
s
[
wrôe_Àn
], "\r\n");

4078 
wrôe_Àn
 +=2;

4080 
byãs_wrôãn
=0;

4082 
ªs
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
c⁄n
->
d©a
, 
s
, 
wrôe_Àn
);

4084 if(
ªs
)

4085 (
ªs
);

4088 #ifde‡
HAVE_GSSAPI


4089 
c⁄n
->
d©a_¥Ÿ
 = 
PROT_CMD
;

4091 
ªs
 = 
	`Cuæ_wrôe
(
c⁄n
, c⁄n->
sock
[
FIRSTSOCKET
], 
•å
, 
wrôe_Àn
,

4092 &
byãs_wrôãn
);

4093 #ifde‡
HAVE_GSSAPI


4094 
	`DEBUGASSERT
(
d©a_£c
 > 
PROT_NONE
 && d©a_£¯< 
PROT_LAST
);

4095 
c⁄n
->
d©a_¥Ÿ
 = 
d©a_£c
;

4098 if(
CURLE_OK
 !
ªs
)

4101 if(
c⁄n
->
d©a
->
£t
.
vîbo£
)

4102 
	`Cuæ_debug
(
c⁄n
->
d©a
, 
CURLINFO_HEADER_OUT
,

4103 
•å
, (
size_t
)
byãs_wrôãn
, 
c⁄n
);

4105 if(
byãs_wrôãn
 !(
ssize_t
)
wrôe_Àn
) {

4106 
wrôe_Àn
 -
byãs_wrôãn
;

4107 
•å
 +
byãs_wrôãn
;

4113  
ªs
;

4114 
	}
}

4126 
CURLcode
 
	$·p_quô
(
c⁄√˘d©a
 *
c⁄n
)

4128 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

4130 if(
c⁄n
->
¥Ÿo
.
·pc
.
˘l_vÆid
) {

4131 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
·pc
.
µ
, "%s", "QUIT");

4132 if(
ªsu…
) {

4133 
	`Áûf
(
c⁄n
->
d©a
, "Failure sending QUIT command: %s",

4134 
	`cuæ_ósy_°ªº‹
(
ªsu…
));

4135 
c⁄n
->
¥Ÿo
.
·pc
.
˘l_vÆid
 = 
FALSE
;

4136 
	`c⁄n˛o£
(
c⁄n
, "QUIT command failed");

4137 
	`°©e
(
c⁄n
, 
FTP_STOP
);

4138  
ªsu…
;

4141 
	`°©e
(
c⁄n
, 
FTP_QUIT
);

4143 
ªsu…
 = 
	`·p_block_°©emach
(
c⁄n
);

4146  
ªsu…
;

4147 
	}
}

4156 
CURLcode
 
	$·p_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
)

4158 
·p_c⁄n
 *
·pc
&
c⁄n
->
¥Ÿo
.ftpc;

4159 
pögp⁄g
 *
µ
 = &
·pc
->pp;

4168 if(
dód_c⁄√˘i⁄
)

4169 
·pc
->
˘l_vÆid
 = 
FALSE
;

4172 ()
	`·p_quô
(
c⁄n
);

4174 if(
·pc
->
íåy∑th
) {

4175 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

4176 if(
d©a
->
°©e
.
mo°_ª˚¡_·p_íåy∑th
 =
·pc
->
íåy∑th
) {

4177 
d©a
->
°©e
.
mo°_ª˚¡_·p_íåy∑th
 = 
NULL
;

4179 
	`‰ì
(
·pc
->
íåy∑th
);

4180 
·pc
->
íåy∑th
 = 
NULL
;

4183 
	`‰ìdús
(
·pc
);

4184 if(
·pc
->
¥ev∑th
) {

4185 
	`‰ì
(
·pc
->
¥ev∑th
);

4186 
·pc
->
¥ev∑th
 = 
NULL
;

4188 if(
·pc
->
£rvî_os
) {

4189 
	`‰ì
(
·pc
->
£rvî_os
);

4190 
·pc
->
£rvî_os
 = 
NULL
;

4193 
	`Cuæ_µ_disc⁄√˘
(
µ
);

4195 #ifde‡
HAVE_GSSAPI


4196 
	`Cuæ_£c_íd
(
c⁄n
);

4199  
CURLE_OK
;

4200 
	}
}

4210 
CURLcode
 
	$·p_∑r£_uæ_∑th
(
c⁄√˘d©a
 *
c⁄n
)

4212 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

4214 
FTP
 *
·p
 = 
d©a
->
ªq
.
¥Ÿ›
;

4215 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

4216 c⁄° *
¶ash_pos
;

4217 c⁄° *
∑th_to_u£
 = 
d©a
->
°©e
.
∑th
;

4218 c⁄° *
cur_pos
;

4219 c⁄° *
fûíame
 = 
NULL
;

4221 
cur_pos
 = 
∑th_to_u£
;

4224 
·pc
->
˘l_vÆid
 = 
FALSE
;

4225 
·pc
->
cwdÁû
 = 
FALSE
;

4227 
d©a
->
£t
.
·p_fûemëhod
) {

4228 
FTPFILE_NOCWD
:

4238 if(
d©a
->
°©e
.
∑th
 &&

4239 
d©a
->
°©e
.
∑th
[0] &&

4240 (
d©a
->
°©e
.
∑th
[
	`°æí
(data->state.path) - 1] != '/') )

4241 
fûíame
 = 
d©a
->
°©e
.
∑th
;

4250 
FTPFILE_SINGLECWD
:

4252 if(!
∑th_to_u£
[0]) {

4254 
·pc
->
dúdïth
 = 0;

4257 
¶ash_pos
=
	`°ºchr
(
cur_pos
, '/');

4258 if(
¶ash_pos
 || !*
cur_pos
) {

4259 
size_t
 
dúÀn
 = 
¶ash_pos
-
cur_pos
;

4261 
·pc
->
dús
 = 
	`ˇŒoc
(1, (ftpc->dirs[0]));

4262 if(!
·pc
->
dús
)

4263  
CURLE_OUT_OF_MEMORY
;

4265 if(!
dúÀn
)

4266 
dúÀn
++;

4268 
·pc
->
dús
[0] = 
	`cuæ_ósy_u√sˇ≥
(
c⁄n
->
d©a
, 
¶ash_pos
 ? 
cur_pos
 : "/",

4269 
¶ash_pos
 ? 
	`cuæx_uztosi
(
dúÀn
) : 1,

4270 
NULL
);

4271 if(!
·pc
->
dús
[0]) {

4272 
	`‰ìdús
(
·pc
);

4273  
CURLE_OUT_OF_MEMORY
;

4275 
·pc
->
dúdïth
 = 1;

4276 
fûíame
 = 
¶ash_pos
 ? sœsh_pos+1 : 
cur_pos
;

4279 
fûíame
 = 
cur_pos
;

4283 
FTPFILE_MULTICWD
:

4284 
·pc
->
dúdïth
 = 0;

4285 
·pc
->
dúÆloc
 = 5;

4286 
·pc
->
dús
 = 
	`ˇŒoc
(·pc->
dúÆloc
, (ftpc->dirs[0]));

4287 if(!
·pc
->
dús
)

4288  
CURLE_OUT_OF_MEMORY
;

4291 if(
	`°ªquÆ
(
∑th_to_u£
, "/")) {

4292 
cur_pos
++;

4293 
·pc
->
dús
[0] = 
	`°rdup
("/");

4294 
·pc
->
dúdïth
++;

4298 (
¶ash_pos
 = 
	`°rchr
(
cur_pos
, '/')Ë!
NULL
) {

4300 
ssize_t
 
absﬁuã_dú
 = ((
cur_pos
 - 
d©a
->
°©e
.
∑th
 > 0) &&

4301 (
·pc
->
dúdïth
 == 0))?1:0;

4304 if(
¶ash_pos
-
cur_pos
) {

4308 
Àn
 = 
	`cuæx_sztosi
(
¶ash_pos
 - 
cur_pos
 + 
absﬁuã_dú
);

4309 
·pc
->
dús
[·pc->
dúdïth
] =

4310 
	`cuæ_ósy_u√sˇ≥
(
c⁄n
->
d©a
, 
cur_pos
 - 
absﬁuã_dú
, 
Àn
, 
NULL
);

4311 if(!
·pc
->
dús
[·pc->
dúdïth
]) {

4312 
	`Áûf
(
d©a
, "no memory");

4313 
	`‰ìdús
(
·pc
);

4314  
CURLE_OUT_OF_MEMORY
;

4316 if(
	`isBadFçSåög
(
·pc
->
dús
[·pc->
dúdïth
])) {

4317 
	`‰ì
(
·pc
->
dús
[·pc->
dúdïth
]);

4318 
	`‰ìdús
(
·pc
);

4319  
CURLE_URL_MALFORMAT
;

4323 
cur_pos
 = 
¶ash_pos
 + 1;

4324 if(!
·pc
->
dúdïth
) {

4326 
·pc
->
dús
[·pc->
dúdïth
] = 
	`°rdup
("/");

4327 if(!
·pc
->
dús
[·pc->
dúdïth
++]) {

4328 
	`Áûf
(
d©a
, "no memory");

4329 
	`‰ìdús
(
·pc
);

4330  
CURLE_OUT_OF_MEMORY
;

4336 
cur_pos
 = 
¶ash_pos
 + 1;

4337 if(++
·pc
->
dúdïth
 >·pc->
dúÆloc
) {

4339 **
biggî
;

4340 
·pc
->
dúÆloc
 *= 2;

4341 
biggî
 = 
	`ªÆloc
(
·pc
->
dús
, fçc->
dúÆloc
 * (ftpc->dirs[0]));

4342 if(!
biggî
) {

4343 
	`‰ìdús
(
·pc
);

4344  
CURLE_OUT_OF_MEMORY
;

4346 
·pc
->
dús
 = 
biggî
;

4350 
fûíame
 = 
cur_pos
;

4354 if(
fûíame
 && *filename) {

4355 
·pc
->
fûe
 = 
	`cuæ_ósy_u√sˇ≥
(
c⁄n
->
d©a
, 
fûíame
, 0, 
NULL
);

4356 if(
NULL
 =
·pc
->
fûe
) {

4357 
	`‰ìdús
(
·pc
);

4358 
	`Áûf
(
d©a
, "no memory");

4359  
CURLE_OUT_OF_MEMORY
;

4361 if(
	`isBadFçSåög
(
·pc
->
fûe
)) {

4362 
	`‰ìdús
(
·pc
);

4363  
CURLE_URL_MALFORMAT
;

4367 
·pc
->
fûe
=
NULL
;

4370 if(
d©a
->
£t
.
u∂ﬂd
 && !
·pc
->
fûe
 && (
·p
->
å™s„r
 =
FTPTRANSFER_BODY
)) {

4372 
	`Áûf
(
d©a
, "UploadingÅoá URL withoutá fileÇame!");

4373  
CURLE_URL_MALFORMAT
;

4376 
·pc
->
cwdd⁄e
 = 
FALSE
;

4378 if(
·pc
->
¥ev∑th
) {

4381 
dÀn
;

4382 *
∑th
 = 
	`cuæ_ósy_u√sˇ≥
(
c⁄n
->
d©a
, d©a->
°©e
.∑th, 0, &
dÀn
);

4383 if(!
∑th
) {

4384 
	`‰ìdús
(
·pc
);

4385  
CURLE_OUT_OF_MEMORY
;

4388 
dÀn
 -
·pc
->
fûe
?
	`cuæx_uztosi
(
	`°æí
(ftpc->file)):0;

4389 if((
dÀn
 =
	`cuæx_uztosi
(
	`°æí
(
·pc
->
¥ev∑th
))) &&

4390 
	`°∫equÆ
(
∑th
, 
·pc
->
¥ev∑th
, 
dÀn
)) {

4391 
	`öfof
(
d©a
, "Request has sameÖathásÖreviousÅransfer\n");

4392 
·pc
->
cwdd⁄e
 = 
TRUE
;

4394 
	`‰ì
(
∑th
);

4397  
CURLE_OK
;

4398 
	}
}

4401 
CURLcode
 
	$·p_d›ha£_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

4402 
boﬁ
 
c⁄√˘ed
)

4404 
FTP
 *
·p
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

4405 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

4407 if(
c⁄√˘ed
) {

4408 
com∂ëed
;

4409 
CURLcode
 
ªsu…
 = 
	`·p_do_m‹e
(
c⁄n
, &
com∂ëed
);

4411 if(
ªsu…
) {

4412 if(
c⁄n
->
sock
[
SECONDARYSOCKET
] !
CURL_SOCKET_BAD
) {

4414 
	`Cuæ_˛o£sockë
(
c⁄n
, c⁄n->
sock
[
SECONDARYSOCKET
]);

4415 
c⁄n
->
sock
[
SECONDARYSOCKET
] = 
CURL_SOCKET_BAD
;

4417  
ªsu…
;

4421 if(
·p
->
å™s„r
 !
FTPTRANSFER_BODY
)

4423 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

4424 if(!
c⁄√˘ed
)

4426 
c⁄n
->
bôs
.
do_m‹e
 = 
TRUE
;

4428 
·pc
->
˘l_vÆid
 = 
TRUE
;

4430  
CURLE_OK
;

4431 
	}
}

4434 
CURLcode
 
	$·p_doög
(
c⁄√˘d©a
 *
c⁄n
,

4435 
boﬁ
 *
d›ha£_d⁄e
)

4437 
CURLcode
 
ªsu…
 = 
	`·p_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

4439 if(
ªsu…
)

4440 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase failed\n"));

4441 if(*
d›ha£_d⁄e
) {

4442 
ªsu…
 = 
	`·p_d›ha£_d⁄e
(
c⁄n
, 
FALSE
 );

4444 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete2\n"));

4446  
ªsu…
;

4447 
	}
}

4462 
CURLcode
 
	$·p_ªguœr_å™s„r
(
c⁄√˘d©a
 *
c⁄n
,

4463 
boﬁ
 *
d›ha£_d⁄e
)

4465 
CURLcode
 
ªsu…
=
CURLE_OK
;

4466 
boﬁ
 
c⁄√˘ed
=
FALSE
;

4467 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

4468 
·p_c⁄n
 *
·pc
 = &
c⁄n
->
¥Ÿo
.ftpc;

4469 
d©a
->
ªq
.
size
 = -1;

4471 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 0);

4472 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, 0);

4473 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 0);

4474 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 0);

4476 
·pc
->
˘l_vÆid
 = 
TRUE
;

4478 
ªsu…
 = 
	`·p_≥rf‹m
(
c⁄n
,

4479 &
c⁄√˘ed
,

4480 
d›ha£_d⁄e
);

4482 if(
CURLE_OK
 =
ªsu…
) {

4484 if(!*
d›ha£_d⁄e
)

4486  
CURLE_OK
;

4488 
ªsu…
 = 
	`·p_d›ha£_d⁄e
(
c⁄n
, 
c⁄√˘ed
);

4490 if(
ªsu…
)

4491  
ªsu…
;

4494 
	`‰ìdús
(
·pc
);

4496  
ªsu…
;

4497 
	}
}

4499 
CURLcode
 
	$·p_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
)

4501 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

4502 *
ty≥
;

4503 
comm™d
;

4504 
FTP
 *
·p
;

4506 if(
c⁄n
->
bôs
.
hâµroxy
 && !
d©a
->
£t
.
tu¬ñ_thru_hâµroxy
) {

4509 #i‚de‡
CURL_DISABLE_HTTP


4510 if(
c⁄n
->
h™dÀr
 =&
Cuæ_h™dÀr_·p
)

4511 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_·p_¥oxy
;

4513 #ifde‡
USE_SSL


4514 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_·ps_¥oxy
;

4516 
	`Áûf
(
d©a
, "FTPSÇot supported!");

4517  
CURLE_UNSUPPORTED_PROTOCOL
;

4521  
c⁄n
->
h™dÀr
->
	`£tup_c⁄√˘i⁄
(conn);

4523 
	`Áûf
(
d©a
, "FTP over httpÖroxyÑequires HTTP support built-in!");

4524  
CURLE_UNSUPPORTED_PROTOCOL
;

4528 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
 = 
·p
 = 
	`mÆloc
((
FTP
));

4529 if(
NULL
 =
·p
)

4530  
CURLE_OUT_OF_MEMORY
;

4532 
d©a
->
°©e
.
∑th
++;

4533 
d©a
->
°©e
.
¶ash_ªmoved
 = 
TRUE
;

4537 
ty≥
 = 
	`°r°r
(
d©a
->
°©e
.
∑th
, ";type=");

4539 if(!
ty≥
)

4540 
ty≥
 = 
	`°r°r
(
c⁄n
->
ho°
.
øwÆloc
, ";type=");

4542 if(
ty≥
) {

4543 *
ty≥
 = 0;

4544 
comm™d
 = 
	`Cuæ_øw_touµî
(
ty≥
[6]);

4545 
c⁄n
->
bôs
.
ty≥_£t
 = 
TRUE
;

4547 
comm™d
) {

4549 
d©a
->
£t
.
¥e„r_ascii
 = 
TRUE
;

4553 
d©a
->
£t
.
·p_li°_⁄ly
 = 
TRUE
;

4559 
d©a
->
£t
.
¥e„r_ascii
 = 
FALSE
;

4565 
·p
->
byãcou¡p
 = &
c⁄n
->
d©a
->
ªq
.
byãcou¡
;

4566 
·p
->
å™s„r
 = 
FTPTRANSFER_BODY
;

4567 
·p
->
dow∆ﬂdsize
 = 0;

4573 
·p
->
u£r
 = 
c⁄n
->user;

4574 
·p
->
∑sswd
 = 
c⁄n
->passwd;

4575 if(
	`isBadFçSåög
(
·p
->
u£r
))

4576  
CURLE_URL_MALFORMAT
;

4577 if(
	`isBadFçSåög
(
·p
->
∑sswd
))

4578  
CURLE_URL_MALFORMAT
;

4580 
c⁄n
->
¥Ÿo
.
·pc
.
known_fûesize
 = -1;

4582  
CURLE_OK
;

4583 
	}
}

	@lib/ftp.h

1 #i‚de‡
HEADER_CURL_FTP_H


2 
	#HEADER_CURL_FTP_H


	)

25 
	~"pögp⁄g.h
"

27 #i‚de‡
CURL_DISABLE_FTP


28 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_·p
;

30 #ifde‡
USE_SSL


31 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_·ps
;

34 
CURLcode
 
Cuæ_·p£ndf
(
c⁄√˘d©a
 *, c⁄° *
fmt
, ...);

35 
CURLcode
 
Cuæ_GëFTPRe•⁄£
(
ssize_t
 *
ƒód
, 
c⁄√˘d©a
 *
c⁄n
,

36 *
·pcode
);

43 
	mFTP_STOP
,

44 
	mFTP_WAIT220
,

46 
	mFTP_AUTH
,

47 
	mFTP_USER
,

48 
	mFTP_PASS
,

49 
	mFTP_ACCT
,

50 
	mFTP_PBSZ
,

51 
	mFTP_PROT
,

52 
	mFTP_CCC
,

53 
	mFTP_PWD
,

54 
	mFTP_SYST
,

55 
	mFTP_NAMEFMT
,

56 
	mFTP_QUOTE
,

57 
	mFTP_RETR_PREQUOTE
,

58 
	mFTP_STOR_PREQUOTE
,

59 
	mFTP_POSTQUOTE
,

60 
	mFTP_CWD
,

61 
	mFTP_MKD
,

62 
	mFTP_MDTM
,

63 
	mFTP_TYPE
,

64 
	mFTP_LIST_TYPE
,

65 
	mFTP_RETR_TYPE
,

66 
	mFTP_STOR_TYPE
,

67 
	mFTP_SIZE
,

68 
	mFTP_RETR_SIZE
,

69 
	mFTP_STOR_SIZE
,

70 
	mFTP_REST
,

71 
	mFTP_RETR_REST
,

72 
	mFTP_PORT
,

73 
	mFTP_PRET
,

74 
	mFTP_PASV
,

75 
	mFTP_LIST
,

76 
	mFTP_RETR
,

77 
	mFTP_STOR
,

78 
	mFTP_QUIT
,

79 
	mFTP_LAST


80 } 
	t·p°©e
;

82 
	g·p_∑r£li°_d©a
;

84 
	s·p_wc_tmpd©a
 {

85 
·p_∑r£li°_d©a
 *
	m∑r£r
;

88 
cuæ_wrôe_ˇŒback
 
	mwrôe_fun˘i⁄
;

89 
FILE
 *
	mfûe_des¸ùt‹
;

90 } 
	mbackup
;

94 
	mFTPFILE_MULTICWD
 = 1,

95 
	mFTPFILE_NOCWD
 = 2,

96 
	mFTPFILE_SINGLECWD
 = 3

98 } 
	tcuæ_·pfûe
;

104 
	sFTP
 {

105 
cuæ_off_t
 *
	mbyãcou¡p
;

106 *
	mu£r
;

107 *
	m∑sswd
;

111 
cuæ_µ_å™s„r
 
	må™s„r
;

112 
cuæ_off_t
 
	mdow∆ﬂdsize
;

118 
	s·p_c⁄n
 {

119 
pögp⁄g
 
	mµ
;

120 *
	míåy∑th
;

121 **
	mdús
;

122 
	mdúdïth
;

123 
	mdúÆloc
;

124 *
	mfûe
;

125 
boﬁ
 
	md⁄t_check
;

128 
boﬁ
 
	m˘l_vÆid
;

131 
boﬁ
 
	mcwdd⁄e
;

133 
boﬁ
 
	mcwdÁû
;

135 
boﬁ
 
	mwaô_d©a_c⁄n
;

136 *
	m¥ev∑th
;

137 
	må™s„πy≥
;

139 
	mcou¡1
;

140 
	mcou¡2
;

141 
	mcou¡3
;

142 
·p°©e
 
	m°©e
;

143 
·p°©e
 
	m°©e_ßved
;

145 
cuæ_off_t
 
	mªå_size_ßved
;

146 * 
	m£rvî_os
;

147 
cuæ_off_t
 
	mknown_fûesize
;

152 
	#NEWHOST_BUFSIZE
 48

	)

153 
	m√who°
[
NEWHOST_BUFSIZE
];

154 
	m√wp‹t
;

158 
	#DEFAULT_ACCEPT_TIMEOUT
 60000

	)

	@lib/ftplistparser.c

38 
	~"cuæ_£tup.h
"

40 #i‚de‡
CURL_DISABLE_FTP


42 
	~<cuæ/cuæ.h
>

44 
	~"uæd©a.h
"

45 
	~"fûeöfo.h
"

46 
	~"Œi°.h
"

47 
	~"°πoof·.h
"

48 
	~"øw°r.h
"

49 
	~"·p.h
"

50 
	~"·∂i°∑r£r.h
"

51 
	~"cuæ_‚m©ch.h
"

53 
	#_MPRINTF_REPLACE


	)

54 
	~<cuæ/m¥ötf.h
>

56 
	~"cuæ_mem‹y.h
"

58 
	~"memdebug.h
"

61 
	#FTP_BUFFER_ALLOCSIZE
 160

	)

64 
	mPL_UNIX_TOTALSIZE
 = 0,

65 
	mPL_UNIX_FILETYPE
,

66 
	mPL_UNIX_PERMISSION
,

67 
	mPL_UNIX_HLINKS
,

68 
	mPL_UNIX_USER
,

69 
	mPL_UNIX_GROUP
,

70 
	mPL_UNIX_SIZE
,

71 
	mPL_UNIX_TIME
,

72 
	mPL_UNIX_FILENAME
,

73 
	mPL_UNIX_SYMLINK


74 } 
	t∂_unix_maö°©e
;

78 
	mPL_UNIX_TOTALSIZE_INIT
 = 0,

79 
	mPL_UNIX_TOTALSIZE_READING


80 } 
	mtŸÆ_dúsize
;

83 
	mPL_UNIX_HLINKS_PRESPACE
 = 0,

84 
	mPL_UNIX_HLINKS_NUMBER


85 } 
	mhlöks
;

88 
	mPL_UNIX_USER_PRESPACE
 = 0,

89 
	mPL_UNIX_USER_PARSING


90 } 
	mu£r
;

93 
	mPL_UNIX_GROUP_PRESPACE
 = 0,

94 
	mPL_UNIX_GROUP_NAME


95 } 
	mgroup
;

98 
	mPL_UNIX_SIZE_PRESPACE
 = 0,

99 
	mPL_UNIX_SIZE_NUMBER


100 } 
	msize
;

103 
	mPL_UNIX_TIME_PREPART1
 = 0,

104 
	mPL_UNIX_TIME_PART1
,

105 
	mPL_UNIX_TIME_PREPART2
,

106 
	mPL_UNIX_TIME_PART2
,

107 
	mPL_UNIX_TIME_PREPART3
,

108 
	mPL_UNIX_TIME_PART3


109 } 
	mtime
;

112 
	mPL_UNIX_FILENAME_PRESPACE
 = 0,

113 
	mPL_UNIX_FILENAME_NAME
,

114 
	mPL_UNIX_FILENAME_WINDOWSEOL


115 } 
	mfûíame
;

118 
	mPL_UNIX_SYMLINK_PRESPACE
 = 0,

119 
	mPL_UNIX_SYMLINK_NAME
,

120 
	mPL_UNIX_SYMLINK_PRETARGET1
,

121 
	mPL_UNIX_SYMLINK_PRETARGET2
,

122 
	mPL_UNIX_SYMLINK_PRETARGET3
,

123 
	mPL_UNIX_SYMLINK_PRETARGET4
,

124 
	mPL_UNIX_SYMLINK_TARGET
,

125 
	mPL_UNIX_SYMLINK_WINDOWSEOL


126 } 
	msymlök
;

127 } 
	t∂_unix_sub°©e
;

130 
	mPL_WINNT_DATE
 = 0,

131 
	mPL_WINNT_TIME
,

132 
	mPL_WINNT_DIRORSIZE
,

133 
	mPL_WINNT_FILENAME


134 } 
	t∂_wöNT_maö°©e
;

138 
	mPL_WINNT_TIME_PRESPACE
 = 0,

139 
	mPL_WINNT_TIME_TIME


140 } 
	mtime
;

142 
	mPL_WINNT_DIRORSIZE_PRESPACE
 = 0,

143 
	mPL_WINNT_DIRORSIZE_CONTENT


144 } 
	mdú‹size
;

146 
	mPL_WINNT_FILENAME_PRESPACE
 = 0,

147 
	mPL_WINNT_FILENAME_CONTENT
,

148 
	mPL_WINNT_FILENAME_WINEOL


149 } 
	mfûíame
;

150 } 
	t∂_wöNT_sub°©e
;

153 
	s·p_∑r£li°_d©a
 {

155 
	mOS_TYPE_UNKNOWN
 = 0,

156 
	mOS_TYPE_UNIX
,

157 
	mOS_TYPE_WIN_NT


158 } 
	mos_ty≥
;

162 
∂_unix_maö°©e
 
	mmaö
;

163 
∂_unix_sub°©e
 
	msub
;

164 } 
	mUNIX
;

167 
∂_wöNT_maö°©e
 
	mmaö
;

168 
∂_wöNT_sub°©e
 
	msub
;

169 } 
	mNT
;

170 } 
	m°©e
;

172 
CURLcode
 
	mîr‹
;

173 
cuæ_fûeöfo
 *
	mfûe_d©a
;

174 
	môem_Àngth
;

175 
size_t
 
	môem_off£t
;

177 
size_t
 
	mfûíame
;

178 
size_t
 
	mu£r
;

179 
size_t
 
	mgroup
;

180 
size_t
 
	mtime
;

181 
size_t
 
	m≥rm
;

182 
size_t
 
	msymlök_èrgë
;

183 } 
	moff£ts
;

186 
·p_∑r£li°_d©a
 *
	$Cuæ_·p_∑r£li°_d©a_Æloc
()

188  
	`ˇŒoc
(1, (
·p_∑r£li°_d©a
));

189 
	}
}

192 
	$Cuæ_·p_∑r£li°_d©a_‰ì
(
·p_∑r£li°_d©a
 **
∂_d©a
)

194 if(*
∂_d©a
)

195 
	`‰ì
(*
∂_d©a
);

196 *
∂_d©a
 = 
NULL
;

197 
	}
}

200 
CURLcode
 
	$Cuæ_·p_∑r£li°_gëîr‹
(
·p_∑r£li°_d©a
 *
∂_d©a
)

202  
∂_d©a
->
îr‹
;

203 
	}
}

206 
	#FTP_LP_MALFORMATED_PERM
 0x01000000

	)

208 
	$·p_∂_gë_≥rmissi⁄
(c⁄° *
°r
)

210 
≥rmissi⁄s
 = 0;

212 if(
°r
[0] == 'r')

213 
≥rmissi⁄s
 |= 1 << 8;

214 if(
°r
[0] != '-')

215 
≥rmissi⁄s
 |
FTP_LP_MALFORMATED_PERM
;

216 if(
°r
[1] == 'w')

217 
≥rmissi⁄s
 |= 1 << 7;

218 if(
°r
[1] != '-')

219 
≥rmissi⁄s
 |
FTP_LP_MALFORMATED_PERM
;

221 if(
°r
[2] == 'x')

222 
≥rmissi⁄s
 |= 1 << 6;

223 if(
°r
[2] == 's') {

224 
≥rmissi⁄s
 |= 1 << 6;

225 
≥rmissi⁄s
 |= 1 << 11;

227 if(
°r
[2] == 'S')

228 
≥rmissi⁄s
 |= 1 << 11;

229 if(
°r
[2] != '-')

230 
≥rmissi⁄s
 |
FTP_LP_MALFORMATED_PERM
;

232 if(
°r
[3] == 'r')

233 
≥rmissi⁄s
 |= 1 << 5;

234 if(
°r
[3] != '-')

235 
≥rmissi⁄s
 |
FTP_LP_MALFORMATED_PERM
;

236 if(
°r
[4] == 'w')

237 
≥rmissi⁄s
 |= 1 << 4;

238 if(
°r
[4] != '-')

239 
≥rmissi⁄s
 |
FTP_LP_MALFORMATED_PERM
;

240 if(
°r
[5] == 'x')

241 
≥rmissi⁄s
 |= 1 << 3;

242 if(
°r
[5] == 's') {

243 
≥rmissi⁄s
 |= 1 << 3;

244 
≥rmissi⁄s
 |= 1 << 10;

246 if(
°r
[5] == 'S')

247 
≥rmissi⁄s
 |= 1 << 10;

248 if(
°r
[5] != '-')

249 
≥rmissi⁄s
 |
FTP_LP_MALFORMATED_PERM
;

251 if(
°r
[6] == 'r')

252 
≥rmissi⁄s
 |= 1 << 2;

253 if(
°r
[6] != '-')

254 
≥rmissi⁄s
 |
FTP_LP_MALFORMATED_PERM
;

255 if(
°r
[7] == 'w')

256 
≥rmissi⁄s
 |= 1 << 1;

257 if(
°r
[7] != '-')

258 
≥rmissi⁄s
 |
FTP_LP_MALFORMATED_PERM
;

259 if(
°r
[8] == 'x')

260 
≥rmissi⁄s
 |= 1;

261 if(
°r
[8] == 't') {

262 
≥rmissi⁄s
 |= 1;

263 
≥rmissi⁄s
 |= 1 << 9;

265 if(
°r
[8] == 'T')

266 
≥rmissi⁄s
 |= 1 << 9;

267 if(
°r
[8] != '-')

268 
≥rmissi⁄s
 |
FTP_LP_MALFORMATED_PERM
;

270  
≥rmissi⁄s
;

271 
	}
}

273 
	$PL_ERROR
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
îr
)

275 
·p_wc_tmpd©a
 *
tmpd©a
 = 
c⁄n
->
d©a
->
wûdˇrd
.
tmp
;

276 
·p_∑r£li°_d©a
 *
∑r£r
 = 
tmpd©a
->parser;

277 if(
∑r£r
->
fûe_d©a
)

278 
	`Cuæ_fûeöfo_dt‹
(
NULL
, 
∑r£r
->
fûe_d©a
);

279 
∑r£r
->
fûe_d©a
 = 
NULL
;

280 
∑r£r
->
îr‹
 = 
îr
;

281 
	}
}

283 
boﬁ
 
	$·p_∂_gëtime
(
·p_∑r£li°_d©a
 *
∑r£r
, *
°rög
)

285 ()
∑r£r
;

286 ()
°rög
;

300  
FALSE
;

301 
	}
}

303 
CURLcode
 
	$·p_∂_ö£π_föfo
(
c⁄√˘d©a
 *
c⁄n
,

304 
cuæ_fûeöfo
 *
föfo
)

306 
cuæ_‚m©ch_ˇŒback
 
com∑ª
;

307 
WûdˇrdD©a
 *
wc
 = &
c⁄n
->
d©a
->
wûdˇrd
;

308 
·p_wc_tmpd©a
 *
tmpd©a
 = 
wc
->
tmp
;

309 
cuæ_Œi°
 *
Œi°
 = 
wc
->
fûñi°
;

310 
·p_∑r£li°_d©a
 *
∑r£r
 = 
tmpd©a
->parser;

311 
boﬁ
 
add
 = 
TRUE
;

314 *
°r
 = 
föfo
->
b_d©a
;

315 
föfo
->
fûíame
 = 
°r
 + 
∑r£r
->
off£ts
.filename;

316 
föfo
->
°rögs
.
group
 = 
∑r£r
->
off£ts
.group ?

317 
°r
 + 
∑r£r
->
off£ts
.
group
 : 
NULL
;

318 
föfo
->
°rögs
.
≥rm
 = 
∑r£r
->
off£ts
.perm ?

319 
°r
 + 
∑r£r
->
off£ts
.
≥rm
 : 
NULL
;

320 
föfo
->
°rögs
.
èrgë
 = 
∑r£r
->
off£ts
.
symlök_èrgë
 ?

321 
°r
 + 
∑r£r
->
off£ts
.
symlök_èrgë
 : 
NULL
;

322 
föfo
->
°rögs
.
time
 = 
°r
 + 
∑r£r
->
off£ts
.time;

323 
föfo
->
°rögs
.
u£r
 = 
∑r£r
->
off£ts
.user ?

324 
°r
 + 
∑r£r
->
off£ts
.
u£r
 : 
NULL
;

327 
com∑ª
 = 
c⁄n
->
d©a
->
£t
.
‚m©ch
;

328 if(!
com∑ª
)

329 
com∑ª
 = 
Cuæ_‚m©ch
;

332 if(
	`com∑ª
(
c⁄n
->
d©a
->
£t
.
‚m©ch_d©a
, 
wc
->
∑âîn
,

333 
föfo
->
fûíame
) == 0) {

335 if((
föfo
->
fûëy≥
 =
CURLFILETYPE_SYMLINK
Ë&& föfo->
°rögs
.
èrgë
 &&

336 (
	`°r°r
(
föfo
->
°rögs
.
èrgë
, " -> "))) {

337 
add
 = 
FALSE
;

341 
add
 = 
FALSE
;

344 if(
add
) {

345 if(!
	`Cuæ_Œi°_ö£π_√xt
(
Œi°
,Üli°->
èû
, 
föfo
)) {

346 
	`Cuæ_fûeöfo_dt‹
(
NULL
, 
föfo
);

347 
tmpd©a
->
∑r£r
->
fûe_d©a
 = 
NULL
;

348  
CURLE_OUT_OF_MEMORY
;

352 
	`Cuæ_fûeöfo_dt‹
(
NULL
, 
föfo
);

355 
tmpd©a
->
∑r£r
->
fûe_d©a
 = 
NULL
;

356  
CURLE_OK
;

357 
	}
}

359 
size_t
 
	$Cuæ_·p_∑r£li°
(*
buf„r
, 
size_t
 
size
, size_à
nmemb
,

360 *
c⁄≈å
)

362 
size_t
 
bufÊí
 = 
size
*
nmemb
;

363 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
c⁄≈å
;

364 
·p_wc_tmpd©a
 *
tmpd©a
 = 
c⁄n
->
d©a
->
wûdˇrd
.
tmp
;

365 
·p_∑r£li°_d©a
 *
∑r£r
 = 
tmpd©a
->parser;

366 
cuæ_fûeöfo
 *
föfo
;

367 
i
 = 0;

368 
CURLcode
 
rc
;

370 if(
∑r£r
->
îr‹
) {

377  
bufÊí
;

380 if(
∑r£r
->
os_ty≥
 =
OS_TYPE_UNKNOWN
 && 
bufÊí
 > 0) {

382 
∑r£r
->
os_ty≥
 = (
buf„r
[0] >= '0' && buffer[0] <= '9') ?

383 
OS_TYPE_WIN_NT
 : 
OS_TYPE_UNIX
;

386 
i
 < 
bufÊí
) {

388 
c
 = 
buf„r
[
i
];

389 if(!
∑r£r
->
fûe_d©a
) {

390 
∑r£r
->
fûe_d©a
 = 
	`Cuæ_fûeöfo_Æloc
();

391 if(!
∑r£r
->
fûe_d©a
) {

392 
∑r£r
->
îr‹
 = 
CURLE_OUT_OF_MEMORY
;

393  
bufÊí
;

395 
∑r£r
->
fûe_d©a
->
b_d©a
 = 
	`mÆloc
(
FTP_BUFFER_ALLOCSIZE
);

396 if(!
∑r£r
->
fûe_d©a
->
b_d©a
) {

397 
	`PL_ERROR
(
c⁄n
, 
CURLE_OUT_OF_MEMORY
);

398  
bufÊí
;

400 
∑r£r
->
fûe_d©a
->
b_size
 = 
FTP_BUFFER_ALLOCSIZE
;

401 
∑r£r
->
ôem_off£t
 = 0;

402 
∑r£r
->
ôem_Àngth
 = 0;

405 
föfo
 = 
∑r£r
->
fûe_d©a
;

406 
föfo
->
b_d©a
[föfo->
b_u£d
++] = 
c
;

408 if(
föfo
->
b_u£d
 >föfo->
b_size
 - 1) {

410 *
tmp
 = 
	`ªÆloc
(
föfo
->
b_d©a
,

411 
föfo
->
b_size
 + 
FTP_BUFFER_ALLOCSIZE
);

412 if(
tmp
) {

413 
föfo
->
b_size
 +
FTP_BUFFER_ALLOCSIZE
;

414 
föfo
->
b_d©a
 = 
tmp
;

417 
	`Cuæ_fûeöfo_dt‹
(
NULL
, 
∑r£r
->
fûe_d©a
);

418 
∑r£r
->
fûe_d©a
 = 
NULL
;

419 
∑r£r
->
îr‹
 = 
CURLE_OUT_OF_MEMORY
;

420 
	`PL_ERROR
(
c⁄n
, 
CURLE_OUT_OF_MEMORY
);

421  
bufÊí
;

425 
∑r£r
->
os_ty≥
) {

426 
OS_TYPE_UNIX
:

427 
∑r£r
->
°©e
.
UNIX
.
maö
) {

428 
PL_UNIX_TOTALSIZE
:

429 
∑r£r
->
°©e
.
UNIX
.
sub
.
tŸÆ_dúsize
) {

430 
PL_UNIX_TOTALSIZE_INIT
:

431 if(
c
 == 't') {

432 
∑r£r
->
°©e
.
UNIX
.
sub
.
tŸÆ_dúsize
 = 
PL_UNIX_TOTALSIZE_READING
;

433 
∑r£r
->
ôem_Àngth
++;

436 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_FILETYPE
;

438 
föfo
->
b_u£d
 = 0;

439 
i
--;

442 
PL_UNIX_TOTALSIZE_READING
:

443 
∑r£r
->
ôem_Àngth
++;

444 if(
c
 == '\r') {

445 
∑r£r
->
ôem_Àngth
--;

446 
föfo
->
b_u£d
--;

448 if(
c
 == '\n') {

449 
föfo
->
b_d©a
[
∑r£r
->
ôem_Àngth
 - 1] = 0;

450 if(
	`°∫cmp
("tŸÆ ", 
föfo
->
b_d©a
, 6) == 0) {

451 *
íd±r
 = 
föfo
->
b_d©a
+6;

454 
	`ISSPACE
(*
íd±r
))

455 
íd±r
++;

456 
	`ISDIGIT
(*
íd±r
))

457 
íd±r
++;

458 if(*
íd±r
 != 0) {

459 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

460  
bufÊí
;

463 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_FILETYPE
;

464 
föfo
->
b_u£d
 = 0;

468 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

469  
bufÊí
;

475 
PL_UNIX_FILETYPE
:

476 
c
) {

478 
föfo
->
fûëy≥
 = 
CURLFILETYPE_FILE
;

481 
föfo
->
fûëy≥
 = 
CURLFILETYPE_DIRECTORY
;

484 
föfo
->
fûëy≥
 = 
CURLFILETYPE_SYMLINK
;

487 
föfo
->
fûëy≥
 = 
CURLFILETYPE_NAMEDPIPE
;

490 
föfo
->
fûëy≥
 = 
CURLFILETYPE_SOCKET
;

493 
föfo
->
fûëy≥
 = 
CURLFILETYPE_DEVICE_CHAR
;

496 
föfo
->
fûëy≥
 = 
CURLFILETYPE_DEVICE_BLOCK
;

499 
föfo
->
fûëy≥
 = 
CURLFILETYPE_DOOR
;

502 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

503  
bufÊí
;

505 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_PERMISSION
;

506 
∑r£r
->
ôem_Àngth
 = 0;

507 
∑r£r
->
ôem_off£t
 = 1;

509 
PL_UNIX_PERMISSION
:

510 
∑r£r
->
ôem_Àngth
++;

511 if(
∑r£r
->
ôem_Àngth
 <= 9) {

512 if(!
	`°rchr
("rwx-tTsS", 
c
)) {

513 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

514  
bufÊí
;

517 if(
∑r£r
->
ôem_Àngth
 == 10) {

518 
≥rm
;

519 if(
c
 != ' ') {

520 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

521  
bufÊí
;

523 
föfo
->
b_d©a
[10] = 0;

524 
≥rm
 = 
	`·p_∂_gë_≥rmissi⁄
(
föfo
->
b_d©a
 + 
∑r£r
->
ôem_off£t
);

525 if(
≥rm
 & 
FTP_LP_MALFORMATED_PERM
) {

526 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

527  
bufÊí
;

529 
∑r£r
->
fûe_d©a
->
Êags
 |
CURLFINFOFLAG_KNOWN_PERM
;

530 
∑r£r
->
fûe_d©a
->
≥rm
 =Öerm;

531 
∑r£r
->
off£ts
.
≥rm
 =Ö¨£r->
ôem_off£t
;

533 
∑r£r
->
ôem_Àngth
 = 0;

534 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_HLINKS
;

535 
∑r£r
->
°©e
.
UNIX
.
sub
.
hlöks
 = 
PL_UNIX_HLINKS_PRESPACE
;

538 
PL_UNIX_HLINKS
:

539 
∑r£r
->
°©e
.
UNIX
.
sub
.
hlöks
) {

540 
PL_UNIX_HLINKS_PRESPACE
:

541 if(
c
 != ' ') {

542 if(
c
 >= '0' && c <= '9') {

543 
∑r£r
->
ôem_off£t
 = 
föfo
->
b_u£d
 - 1;

544 
∑r£r
->
ôem_Àngth
 = 1;

545 
∑r£r
->
°©e
.
UNIX
.
sub
.
hlöks
 = 
PL_UNIX_HLINKS_NUMBER
;

548 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

549  
bufÊí
;

553 
PL_UNIX_HLINKS_NUMBER
:

554 
∑r£r
->
ôem_Àngth
 ++;

555 if(
c
 == ' ') {

556 *
p
;

557 
hlöks
;

558 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 - 1] = 0;

559 
hlöks
 = 
	`°πﬁ
(
föfo
->
b_d©a
 + 
∑r£r
->
ôem_off£t
, &
p
, 10);

560 if(
p
[0] ='\0' && 
hlöks
 !
LONG_MAX
 && hlök†!
LONG_MIN
) {

561 
∑r£r
->
fûe_d©a
->
Êags
 |
CURLFINFOFLAG_KNOWN_HLINKCOUNT
;

562 
∑r£r
->
fûe_d©a
->
h¨dlöks
 = 
hlöks
;

564 
∑r£r
->
ôem_Àngth
 = 0;

565 
∑r£r
->
ôem_off£t
 = 0;

566 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_USER
;

567 
∑r£r
->
°©e
.
UNIX
.
sub
.
u£r
 = 
PL_UNIX_USER_PRESPACE
;

569 if(
c
 < '0' || c > '9') {

570 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

571  
bufÊí
;

576 
PL_UNIX_USER
:

577 
∑r£r
->
°©e
.
UNIX
.
sub
.
u£r
) {

578 
PL_UNIX_USER_PRESPACE
:

579 if(
c
 != ' ') {

580 
∑r£r
->
ôem_off£t
 = 
föfo
->
b_u£d
 - 1;

581 
∑r£r
->
ôem_Àngth
 = 1;

582 
∑r£r
->
°©e
.
UNIX
.
sub
.
u£r
 = 
PL_UNIX_USER_PARSING
;

585 
PL_UNIX_USER_PARSING
:

586 
∑r£r
->
ôem_Àngth
++;

587 if(
c
 == ' ') {

588 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 - 1] = 0;

589 
∑r£r
->
off£ts
.
u£r
 =Ö¨£r->
ôem_off£t
;

590 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_GROUP
;

591 
∑r£r
->
°©e
.
UNIX
.
sub
.
group
 = 
PL_UNIX_GROUP_PRESPACE
;

592 
∑r£r
->
ôem_off£t
 = 0;

593 
∑r£r
->
ôem_Àngth
 = 0;

598 
PL_UNIX_GROUP
:

599 
∑r£r
->
°©e
.
UNIX
.
sub
.
group
) {

600 
PL_UNIX_GROUP_PRESPACE
:

601 if(
c
 != ' ') {

602 
∑r£r
->
ôem_off£t
 = 
föfo
->
b_u£d
 - 1;

603 
∑r£r
->
ôem_Àngth
 = 1;

604 
∑r£r
->
°©e
.
UNIX
.
sub
.
group
 = 
PL_UNIX_GROUP_NAME
;

607 
PL_UNIX_GROUP_NAME
:

608 
∑r£r
->
ôem_Àngth
++;

609 if(
c
 == ' ') {

610 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 - 1] = 0;

611 
∑r£r
->
off£ts
.
group
 =Ö¨£r->
ôem_off£t
;

612 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_SIZE
;

613 
∑r£r
->
°©e
.
UNIX
.
sub
.
size
 = 
PL_UNIX_SIZE_PRESPACE
;

614 
∑r£r
->
ôem_off£t
 = 0;

615 
∑r£r
->
ôem_Àngth
 = 0;

620 
PL_UNIX_SIZE
:

621 
∑r£r
->
°©e
.
UNIX
.
sub
.
size
) {

622 
PL_UNIX_SIZE_PRESPACE
:

623 if(
c
 != ' ') {

624 if(
c
 >= '0' && c <= '9') {

625 
∑r£r
->
ôem_off£t
 = 
föfo
->
b_u£d
 - 1;

626 
∑r£r
->
ôem_Àngth
 = 1;

627 
∑r£r
->
°©e
.
UNIX
.
sub
.
size
 = 
PL_UNIX_SIZE_NUMBER
;

630 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

631  
bufÊí
;

635 
PL_UNIX_SIZE_NUMBER
:

636 
∑r£r
->
ôem_Àngth
++;

637 if(
c
 == ' ') {

638 *
p
;

639 
cuæ_off_t
 
fsize
;

640 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 - 1] = 0;

641 
fsize
 = 
	`cuæx_°πoof·
(
föfo
->
b_d©a
+
∑r£r
->
ôem_off£t
, &
p
, 10);

642 if(
p
[0] ='\0' && 
fsize
 !
CURL_OFF_T_MAX
 &&

643 
fsize
 !
CURL_OFF_T_MIN
) {

644 
∑r£r
->
fûe_d©a
->
Êags
 |
CURLFINFOFLAG_KNOWN_SIZE
;

645 
∑r£r
->
fûe_d©a
->
size
 = 
fsize
;

647 
∑r£r
->
ôem_Àngth
 = 0;

648 
∑r£r
->
ôem_off£t
 = 0;

649 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_TIME
;

650 
∑r£r
->
°©e
.
UNIX
.
sub
.
time
 = 
PL_UNIX_TIME_PREPART1
;

652 if(!
	`ISDIGIT
(
c
)) {

653 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

654  
bufÊí
;

659 
PL_UNIX_TIME
:

660 
∑r£r
->
°©e
.
UNIX
.
sub
.
time
) {

661 
PL_UNIX_TIME_PREPART1
:

662 if(
c
 != ' ') {

663 if(
	`ISALNUM
(
c
)) {

664 
∑r£r
->
ôem_off£t
 = 
föfo
->
b_u£d
 -1;

665 
∑r£r
->
ôem_Àngth
 = 1;

666 
∑r£r
->
°©e
.
UNIX
.
sub
.
time
 = 
PL_UNIX_TIME_PART1
;

669 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

670  
bufÊí
;

674 
PL_UNIX_TIME_PART1
:

675 
∑r£r
->
ôem_Àngth
++;

676 if(
c
 == ' ') {

677 
∑r£r
->
°©e
.
UNIX
.
sub
.
time
 = 
PL_UNIX_TIME_PREPART2
;

679 if(!
	`ISALNUM
(
c
) && c != '.') {

680 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

681  
bufÊí
;

684 
PL_UNIX_TIME_PREPART2
:

685 
∑r£r
->
ôem_Àngth
++;

686 if(
c
 != ' ') {

687 if(
	`ISALNUM
(
c
)) {

688 
∑r£r
->
°©e
.
UNIX
.
sub
.
time
 = 
PL_UNIX_TIME_PART2
;

691 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

692  
bufÊí
;

696 
PL_UNIX_TIME_PART2
:

697 
∑r£r
->
ôem_Àngth
++;

698 if(
c
 == ' ') {

699 
∑r£r
->
°©e
.
UNIX
.
sub
.
time
 = 
PL_UNIX_TIME_PREPART3
;

701 if(!
	`ISALNUM
(
c
) && c != '.') {

702 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

703  
bufÊí
;

706 
PL_UNIX_TIME_PREPART3
:

707 
∑r£r
->
ôem_Àngth
++;

708 if(
c
 != ' ') {

709 if(
	`ISALNUM
(
c
)) {

710 
∑r£r
->
°©e
.
UNIX
.
sub
.
time
 = 
PL_UNIX_TIME_PART3
;

713 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

714  
bufÊí
;

718 
PL_UNIX_TIME_PART3
:

719 
∑r£r
->
ôem_Àngth
++;

720 if(
c
 == ' ') {

721 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 -1] = 0;

722 
∑r£r
->
off£ts
.
time
 =Ö¨£r->
ôem_off£t
;

723 if(
	`·p_∂_gëtime
(
∑r£r
, 
föfo
->
b_d©a
 +Ö¨£r->
ôem_off£t
)) {

724 
∑r£r
->
fûe_d©a
->
Êags
 |
CURLFINFOFLAG_KNOWN_TIME
;

726 if(
föfo
->
fûëy≥
 =
CURLFILETYPE_SYMLINK
) {

727 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_SYMLINK
;

728 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_PRESPACE
;

731 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_FILENAME
;

732 
∑r£r
->
°©e
.
UNIX
.
sub
.
fûíame
 = 
PL_UNIX_FILENAME_PRESPACE
;

735 if(!
	`ISALNUM
(
c
) && c != '.' && c != ':') {

736 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

737  
bufÊí
;

742 
PL_UNIX_FILENAME
:

743 
∑r£r
->
°©e
.
UNIX
.
sub
.
fûíame
) {

744 
PL_UNIX_FILENAME_PRESPACE
:

745 if(
c
 != ' ') {

746 
∑r£r
->
ôem_off£t
 = 
föfo
->
b_u£d
 - 1;

747 
∑r£r
->
ôem_Àngth
 = 1;

748 
∑r£r
->
°©e
.
UNIX
.
sub
.
fûíame
 = 
PL_UNIX_FILENAME_NAME
;

751 
PL_UNIX_FILENAME_NAME
:

752 
∑r£r
->
ôem_Àngth
++;

753 if(
c
 == '\r') {

754 
∑r£r
->
ôem_Àngth
--;

755 
∑r£r
->
°©e
.
UNIX
.
sub
.
fûíame
 = 
PL_UNIX_FILENAME_WINDOWSEOL
;

757 if(
c
 == '\n') {

758 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 - 1] = 0;

759 
∑r£r
->
off£ts
.
fûíame
 =Ö¨£r->
ôem_off£t
;

760 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_FILETYPE
;

761 
rc
 = 
	`·p_∂_ö£π_föfo
(
c⁄n
, 
föfo
);

762 if(
rc
) {

763 
	`PL_ERROR
(
c⁄n
, 
rc
);

764  
bufÊí
;

768 
PL_UNIX_FILENAME_WINDOWSEOL
:

769 if(
c
 == '\n') {

770 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
] = 0;

771 
∑r£r
->
off£ts
.
fûíame
 =Ö¨£r->
ôem_off£t
;

772 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_FILETYPE
;

773 
rc
 = 
	`·p_∂_ö£π_föfo
(
c⁄n
, 
föfo
);

774 if(
rc
) {

775 
	`PL_ERROR
(
c⁄n
, 
rc
);

776  
bufÊí
;

780 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

781  
bufÊí
;

786 
PL_UNIX_SYMLINK
:

787 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
) {

788 
PL_UNIX_SYMLINK_PRESPACE
:

789 if(
c
 != ' ') {

790 
∑r£r
->
ôem_off£t
 = 
föfo
->
b_u£d
 - 1;

791 
∑r£r
->
ôem_Àngth
 = 1;

792 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_NAME
;

795 
PL_UNIX_SYMLINK_NAME
:

796 
∑r£r
->
ôem_Àngth
++;

797 if(
c
 == ' ') {

798 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_PRETARGET1
;

800 if(
c
 == '\r' || c == '\n') {

801 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

802  
bufÊí
;

805 
PL_UNIX_SYMLINK_PRETARGET1
:

806 
∑r£r
->
ôem_Àngth
++;

807 if(
c
 == '-') {

808 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_PRETARGET2
;

810 if(
c
 == '\r' || c == '\n') {

811 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

812  
bufÊí
;

815 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_NAME
;

818 
PL_UNIX_SYMLINK_PRETARGET2
:

819 
∑r£r
->
ôem_Àngth
++;

820 if(
c
 == '>') {

821 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_PRETARGET3
;

823 if(
c
 == '\r' || c == '\n') {

824 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

825  
bufÊí
;

828 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_NAME
;

831 
PL_UNIX_SYMLINK_PRETARGET3
:

832 
∑r£r
->
ôem_Àngth
++;

833 if(
c
 == ' ') {

834 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_PRETARGET4
;

836 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 - 4] = 0;

837 
∑r£r
->
off£ts
.
fûíame
 =Ö¨£r->
ôem_off£t
;

838 
∑r£r
->
ôem_Àngth
 = 0;

839 
∑r£r
->
ôem_off£t
 = 0;

841 if(
c
 == '\r' || c == '\n') {

842 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

843  
bufÊí
;

846 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_NAME
;

849 
PL_UNIX_SYMLINK_PRETARGET4
:

850 if(
c
 != '\r' && c != '\n') {

851 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_TARGET
;

852 
∑r£r
->
ôem_off£t
 = 
föfo
->
b_u£d
 - 1;

853 
∑r£r
->
ôem_Àngth
 = 1;

856 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

857  
bufÊí
;

860 
PL_UNIX_SYMLINK_TARGET
:

861 
∑r£r
->
ôem_Àngth
 ++;

862 if(
c
 == '\r') {

863 
∑r£r
->
ôem_Àngth
 --;

864 
∑r£r
->
°©e
.
UNIX
.
sub
.
symlök
 = 
PL_UNIX_SYMLINK_WINDOWSEOL
;

866 if(
c
 == '\n') {

867 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 - 1] = 0;

868 
∑r£r
->
off£ts
.
symlök_èrgë
 =Ö¨£r->
ôem_off£t
;

869 
rc
 = 
	`·p_∂_ö£π_föfo
(
c⁄n
, 
föfo
);

870 if(
rc
) {

871 
	`PL_ERROR
(
c⁄n
, 
rc
);

872  
bufÊí
;

874 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_FILETYPE
;

877 
PL_UNIX_SYMLINK_WINDOWSEOL
:

878 if(
c
 == '\n') {

879 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 - 1] = 0;

880 
∑r£r
->
off£ts
.
symlök_èrgë
 =Ö¨£r->
ôem_off£t
;

881 
rc
 = 
	`·p_∂_ö£π_föfo
(
c⁄n
, 
föfo
);

882 if(
rc
) {

883 
	`PL_ERROR
(
c⁄n
, 
rc
);

884  
bufÊí
;

886 
∑r£r
->
°©e
.
UNIX
.
maö
 = 
PL_UNIX_FILETYPE
;

889 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

890  
bufÊí
;

897 
OS_TYPE_WIN_NT
:

898 
∑r£r
->
°©e
.
NT
.
maö
) {

899 
PL_WINNT_DATE
:

900 
∑r£r
->
ôem_Àngth
++;

901 if(
∑r£r
->
ôem_Àngth
 < 9) {

902 if(!
	`°rchr
("0123456789-", 
c
)) {

903 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

904  
bufÊí
;

907 if(
∑r£r
->
ôem_Àngth
 == 9) {

908 if(
c
 == ' ') {

909 
∑r£r
->
°©e
.
NT
.
maö
 = 
PL_WINNT_TIME
;

910 
∑r£r
->
°©e
.
NT
.
sub
.
time
 = 
PL_WINNT_TIME_PRESPACE
;

913 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

914  
bufÊí
;

918 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

919  
bufÊí
;

922 
PL_WINNT_TIME
:

923 
∑r£r
->
ôem_Àngth
++;

924 
∑r£r
->
°©e
.
NT
.
sub
.
time
) {

925 
PL_WINNT_TIME_PRESPACE
:

926 if(!
	`ISSPACE
(
c
)) {

927 
∑r£r
->
°©e
.
NT
.
sub
.
time
 = 
PL_WINNT_TIME_TIME
;

930 
PL_WINNT_TIME_TIME
:

931 if(
c
 == ' ') {

932 
∑r£r
->
off£ts
.
time
 =Ö¨£r->
ôem_off£t
;

933 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 -1] = 0;

934 
∑r£r
->
°©e
.
NT
.
maö
 = 
PL_WINNT_DIRORSIZE
;

935 
∑r£r
->
°©e
.
NT
.
sub
.
dú‹size
 = 
PL_WINNT_DIRORSIZE_PRESPACE
;

936 
∑r£r
->
ôem_Àngth
 = 0;

938 if(!
	`°rchr
("APM0123456789:", 
c
)) {

939 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

940  
bufÊí
;

945 
PL_WINNT_DIRORSIZE
:

946 
∑r£r
->
°©e
.
NT
.
sub
.
dú‹size
) {

947 
PL_WINNT_DIRORSIZE_PRESPACE
:

948 if(
c
 == ' ') {

952 
∑r£r
->
ôem_off£t
 = 
föfo
->
b_u£d
 - 1;

953 
∑r£r
->
ôem_Àngth
 = 1;

954 
∑r£r
->
°©e
.
NT
.
sub
.
dú‹size
 = 
PL_WINNT_DIRORSIZE_CONTENT
;

957 
PL_WINNT_DIRORSIZE_CONTENT
:

958 
∑r£r
->
ôem_Àngth
 ++;

959 if(
c
 == ' ') {

960 
föfo
->
b_d©a
[
∑r£r
->
ôem_off£t
 +Ö¨£r->
ôem_Àngth
 - 1] = 0;

961 if(
	`°rcmp
("<DIR>", 
föfo
->
b_d©a
 + 
∑r£r
->
ôem_off£t
) == 0) {

962 
föfo
->
fûëy≥
 = 
CURLFILETYPE_DIRECTORY
;

963 
föfo
->
size
 = 0;

966 *
íd±r
;

967 
föfo
->
size
 = 
	`cuæx_°πoof·
(föfo->
b_d©a
 +

968 
∑r£r
->
ôem_off£t
,

969 &
íd±r
, 10);

970 if(!*
íd±r
) {

971 if(
föfo
->
size
 =
CURL_OFF_T_MAX
 ||

972 
föfo
->
size
 =
CURL_OFF_T_MIN
) {

973 if(
î∫o
 =
ERANGE
) {

974 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

975  
bufÊí
;

980 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

981  
bufÊí
;

984 
∑r£r
->
fûe_d©a
->
fûëy≥
 = 
CURLFILETYPE_FILE
;

987 
∑r£r
->
fûe_d©a
->
Êags
 |
CURLFINFOFLAG_KNOWN_SIZE
;

988 
∑r£r
->
ôem_Àngth
 = 0;

989 
∑r£r
->
°©e
.
NT
.
maö
 = 
PL_WINNT_FILENAME
;

990 
∑r£r
->
°©e
.
NT
.
sub
.
fûíame
 = 
PL_WINNT_FILENAME_PRESPACE
;

995 
PL_WINNT_FILENAME
:

996 
∑r£r
->
°©e
.
NT
.
sub
.
fûíame
) {

997 
PL_WINNT_FILENAME_PRESPACE
:

998 if(
c
 != ' ') {

999 
∑r£r
->
ôem_off£t
 = 
föfo
->
b_u£d
 -1;

1000 
∑r£r
->
ôem_Àngth
 = 1;

1001 
∑r£r
->
°©e
.
NT
.
sub
.
fûíame
 = 
PL_WINNT_FILENAME_CONTENT
;

1004 
PL_WINNT_FILENAME_CONTENT
:

1005 
∑r£r
->
ôem_Àngth
++;

1006 if(
c
 == '\r') {

1007 
∑r£r
->
°©e
.
NT
.
sub
.
fûíame
 = 
PL_WINNT_FILENAME_WINEOL
;

1008 
föfo
->
b_d©a
[föfo->
b_u£d
 - 1] = 0;

1010 if(
c
 == '\n') {

1011 
∑r£r
->
off£ts
.
fûíame
 =Ö¨£r->
ôem_off£t
;

1012 
föfo
->
b_d©a
[föfo->
b_u£d
 - 1] = 0;

1013 
∑r£r
->
off£ts
.
fûíame
 =Ö¨£r->
ôem_off£t
;

1014 
rc
 = 
	`·p_∂_ö£π_föfo
(
c⁄n
, 
föfo
);

1015 if(
rc
) {

1016 
	`PL_ERROR
(
c⁄n
, 
rc
);

1017  
bufÊí
;

1019 
∑r£r
->
°©e
.
NT
.
maö
 = 
PL_WINNT_DATE
;

1020 
∑r£r
->
°©e
.
NT
.
sub
.
fûíame
 = 
PL_WINNT_FILENAME_PRESPACE
;

1023 
PL_WINNT_FILENAME_WINEOL
:

1024 if(
c
 == '\n') {

1025 
∑r£r
->
off£ts
.
fûíame
 =Ö¨£r->
ôem_off£t
;

1026 
rc
 = 
	`·p_∂_ö£π_föfo
(
c⁄n
, 
föfo
);

1027 if(
rc
) {

1028 
	`PL_ERROR
(
c⁄n
, 
rc
);

1029  
bufÊí
;

1031 
∑r£r
->
°©e
.
NT
.
maö
 = 
PL_WINNT_DATE
;

1032 
∑r£r
->
°©e
.
NT
.
sub
.
fûíame
 = 
PL_WINNT_FILENAME_PRESPACE
;

1035 
	`PL_ERROR
(
c⁄n
, 
CURLE_FTP_BAD_FILE_LIST
);

1036  
bufÊí
;

1044  
bufÊí
+1;

1047 
i
++;

1050  
bufÊí
;

1051 
	}
}

	@lib/ftplistparser.h

1 #i‚de‡
HEADER_CURL_FTPLISTPARSER_H


2 
	#HEADER_CURL_FTPLISTPARSER_H


	)

24 
	~"cuæ_£tup.h
"

26 #i‚de‡
CURL_DISABLE_FTP


29 
size_t
 
Cuæ_·p_∑r£li°
(*
buf„r
, size_à
size
, size_à
nmemb
,

30 *
c⁄≈å
);

32 
	g·p_∑r£li°_d©a
;

34 
CURLcode
 
Cuæ_·p_∑r£li°_gëîr‹
(
·p_∑r£li°_d©a
 *
∂_d©a
);

36 
·p_∑r£li°_d©a
 *
Cuæ_·p_∑r£li°_d©a_Æloc
();

38 
Cuæ_·p_∑r£li°_d©a_‰ì
(
·p_∑r£li°_d©a
 **
∂_d©a
);

	@lib/getenv.c

23 
	~"cuæ_£tup.h
"

25 
	~<cuæ/cuæ.h
>

26 
	~"cuæ_mem‹y.h
"

28 
	~"memdebug.h
"

31 *
	$GëEnv
(c⁄° *
v¨übÀ
)

33 #ifde‡
_WIN32_WCE


34  
NULL
;

36 #ifde‡
WIN32


37 
ív
[
MAX_PATH
];

38 *
ãmp
 = 
	`gëív
(
v¨übÀ
);

39 
ív
[0] = '\0';

40 if(
ãmp
 !
NULL
)

41 
	`Ex∑ndEnvú⁄mítSåögsA
(
ãmp
, 
ív
, (env));

42  (
ív
[0] !'\0')?
	`°rdup
”nv):
NULL
;

44 *
ív
 = 
	`gëív
(
v¨übÀ
);

45  (
ív
 &&Énv[0])?
	`°rdup
”nv):
NULL
;

48 
	}
}

50 *
	$cuæ_gëív
(c⁄° *
v
)

52  
	`GëEnv
(
v
);

53 
	}
}

	@lib/getinfo.c

23 
	~"cuæ_£tup.h
"

25 
	~<cuæ/cuæ.h
>

27 
	~"uæd©a.h
"

28 
	~"gëöfo.h
"

30 
	~"cuæ_mem‹y.h
"

31 
	~"vés/vés.h
"

32 
	~"c⁄√˘.h
"

33 
	~"¥ogªss.h
"

36 
	~"memdebug.h
"

42 
CURLcode
 
	$Cuæ_öôöfo
(
Sessi⁄H™dÀ
 *
d©a
)

44 
Progªss
 *
¥o
 = &
d©a
->
¥ogªss
;

45 
PuªInfo
 *
öfo
 =&
d©a
->info;

47 
¥o
->
t_n¶ookup
 = 0;

48 
¥o
->
t_c⁄√˘
 = 0;

49 
¥o
->
t_≠pc⁄√˘
 = 0;

50 
¥o
->
t_¥ëøns„r
 = 0;

51 
¥o
->
t_°¨âøns„r
 = 0;

52 
¥o
->
time•ít
 = 0;

53 
¥o
->
t_ªdúe˘
 = 0;

55 
öfo
->
hâpcode
 = 0;

56 
öfo
->
hâµroxycode
 = 0;

57 
öfo
->
hâpvîsi⁄
 = 0;

58 
öfo
->
fûëime
 = -1;

59 
öfo
->
timec⁄d
 = 
FALSE
;

61 if(
öfo
->
c⁄ã¡ty≥
)

62 
	`‰ì
(
öfo
->
c⁄ã¡ty≥
);

63 
öfo
->
c⁄ã¡ty≥
 = 
NULL
;

65 
öfo
->
hódî_size
 = 0;

66 
öfo
->
ªque°_size
 = 0;

67 
öfo
->
numc⁄√˘s
 = 0;

69 
öfo
->
c⁄n_¥im¨y_ù
[0] = '\0';

70 
öfo
->
c⁄n_loˇl_ù
[0] = '\0';

71 
öfo
->
c⁄n_¥im¨y_p‹t
 = 0;

72 
öfo
->
c⁄n_loˇl_p‹t
 = 0;

74  
CURLE_OK
;

75 
	}
}

77 
CURLcode
 
	$gëöfo_ch¨
(
Sessi⁄H™dÀ
 *
d©a
, 
CURLINFO
 
öfo
,

78 **
∑øm_ch¨p
)

80 
öfo
) {

81 
CURLINFO_EFFECTIVE_URL
:

82 *
∑øm_ch¨p
 = 
d©a
->
ch™ge
.
uæ
?data->change.url:(*)"";

84 
CURLINFO_CONTENT_TYPE
:

85 *
∑øm_ch¨p
 = 
d©a
->
öfo
.
c⁄ã¡ty≥
;

87 
CURLINFO_PRIVATE
:

88 *
∑øm_ch¨p
 = (*Ë
d©a
->
£t
.
¥iv©e_d©a
;

90 
CURLINFO_FTP_ENTRY_PATH
:

96 *
∑øm_ch¨p
 = 
d©a
->
°©e
.
mo°_ª˚¡_·p_íåy∑th
;

98 
CURLINFO_REDIRECT_URL
:

101 *
∑øm_ch¨p
 = 
d©a
->
öfo
.
wouldªdúe˘
;

103 
CURLINFO_PRIMARY_IP
:

105 *
∑øm_ch¨p
 = 
d©a
->
öfo
.
c⁄n_¥im¨y_ù
;

107 
CURLINFO_LOCAL_IP
:

110 *
∑øm_ch¨p
 = 
d©a
->
öfo
.
c⁄n_loˇl_ù
;

112 
CURLINFO_RTSP_SESSION_ID
:

113 *
∑øm_ch¨p
 = 
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
];

117  
CURLE_BAD_FUNCTION_ARGUMENT
;

119  
CURLE_OK
;

120 
	}
}

122 
CURLcode
 
	$gëöfo_l⁄g
(
Sessi⁄H™dÀ
 *
d©a
, 
CURLINFO
 
öfo
,

123 *
∑øm_l⁄gp
)

125 
cuæ_sockë_t
 
sockfd
;

128 *
to_ul⁄g
;

129 *
to_l⁄g
;

130 } 
Õå
;

132 
öfo
) {

133 
CURLINFO_RESPONSE_CODE
:

134 *
∑øm_l⁄gp
 = 
d©a
->
öfo
.
hâpcode
;

136 
CURLINFO_HTTP_CONNECTCODE
:

137 *
∑øm_l⁄gp
 = 
d©a
->
öfo
.
hâµroxycode
;

139 
CURLINFO_FILETIME
:

140 *
∑øm_l⁄gp
 = 
d©a
->
öfo
.
fûëime
;

142 
CURLINFO_HEADER_SIZE
:

143 *
∑øm_l⁄gp
 = 
d©a
->
öfo
.
hódî_size
;

145 
CURLINFO_REQUEST_SIZE
:

146 *
∑øm_l⁄gp
 = 
d©a
->
öfo
.
ªque°_size
;

148 
CURLINFO_SSL_VERIFYRESULT
:

149 *
∑øm_l⁄gp
 = 
d©a
->
£t
.
s¶
.
˚πvîifyªsu…
;

151 
CURLINFO_REDIRECT_COUNT
:

152 *
∑øm_l⁄gp
 = 
d©a
->
£t
.
fﬁlowloˇti⁄
;

154 
CURLINFO_HTTPAUTH_AVAIL
:

155 
Õå
.
to_l⁄g
 = 
∑øm_l⁄gp
;

156 *
Õå
.
to_ul⁄g
 = 
d©a
->
öfo
.
hâ∑uthavaû
;

158 
CURLINFO_PROXYAUTH_AVAIL
:

159 
Õå
.
to_l⁄g
 = 
∑øm_l⁄gp
;

160 *
Õå
.
to_ul⁄g
 = 
d©a
->
öfo
.
¥oxyauthavaû
;

162 
CURLINFO_OS_ERRNO
:

163 *
∑øm_l⁄gp
 = 
d©a
->
°©e
.
os_î∫o
;

165 
CURLINFO_NUM_CONNECTS
:

166 *
∑øm_l⁄gp
 = 
d©a
->
öfo
.
numc⁄√˘s
;

168 
CURLINFO_LASTSOCKET
:

169 
sockfd
 = 
	`Cuæ_gëc⁄√˘öfo
(
d©a
, 
NULL
);

173 if(
sockfd
 !
CURL_SOCKET_BAD
)

174 *
∑øm_l⁄gp
 = ()
sockfd
;

178 *
∑øm_l⁄gp
 = -1;

180 
CURLINFO_PRIMARY_PORT
:

182 *
∑øm_l⁄gp
 = 
d©a
->
öfo
.
c⁄n_¥im¨y_p‹t
;

184 
CURLINFO_LOCAL_PORT
:

186 *
∑øm_l⁄gp
 = 
d©a
->
öfo
.
c⁄n_loˇl_p‹t
;

188 
CURLINFO_CONDITION_UNMET
:

190 *
∑øm_l⁄gp
 = 
d©a
->
öfo
.
timec⁄d
 ? 1L : 0L;

192 
CURLINFO_RTSP_CLIENT_CSEQ
:

193 *
∑øm_l⁄gp
 = 
d©a
->
°©e
.
π•_√xt_˛õ¡_CSeq
;

195 
CURLINFO_RTSP_SERVER_CSEQ
:

196 *
∑øm_l⁄gp
 = 
d©a
->
°©e
.
π•_√xt_£rvî_CSeq
;

198 
CURLINFO_RTSP_CSEQ_RECV
:

199 *
∑øm_l⁄gp
 = 
d©a
->
°©e
.
π•_CSeq_ªcv
;

203  
CURLE_BAD_FUNCTION_ARGUMENT
;

205  
CURLE_OK
;

206 
	}
}

208 
CURLcode
 
	$gëöfo_doubÀ
(
Sessi⁄H™dÀ
 *
d©a
, 
CURLINFO
 
öfo
,

209 *
∑øm_doubÀp
)

211 
öfo
) {

212 
CURLINFO_TOTAL_TIME
:

213 *
∑øm_doubÀp
 = 
d©a
->
¥ogªss
.
time•ít
;

215 
CURLINFO_NAMELOOKUP_TIME
:

216 *
∑øm_doubÀp
 = 
d©a
->
¥ogªss
.
t_n¶ookup
;

218 
CURLINFO_CONNECT_TIME
:

219 *
∑øm_doubÀp
 = 
d©a
->
¥ogªss
.
t_c⁄√˘
;

221 
CURLINFO_APPCONNECT_TIME
:

222 *
∑øm_doubÀp
 = 
d©a
->
¥ogªss
.
t_≠pc⁄√˘
;

224 
CURLINFO_PRETRANSFER_TIME
:

225 *
∑øm_doubÀp
 = 
d©a
->
¥ogªss
.
t_¥ëøns„r
;

227 
CURLINFO_STARTTRANSFER_TIME
:

228 *
∑øm_doubÀp
 = 
d©a
->
¥ogªss
.
t_°¨âøns„r
;

230 
CURLINFO_SIZE_UPLOAD
:

231 *
∑øm_doubÀp
 = ()
d©a
->
¥ogªss
.
u∂ﬂded
;

233 
CURLINFO_SIZE_DOWNLOAD
:

234 *
∑øm_doubÀp
 = ()
d©a
->
¥ogªss
.
dow∆ﬂded
;

236 
CURLINFO_SPEED_DOWNLOAD
:

237 *
∑øm_doubÀp
 = ()
d©a
->
¥ogªss
.
dl•ìd
;

239 
CURLINFO_SPEED_UPLOAD
:

240 *
∑øm_doubÀp
 = ()
d©a
->
¥ogªss
.
ul•ìd
;

242 
CURLINFO_CONTENT_LENGTH_DOWNLOAD
:

243 *
∑øm_doubÀp
 = (
d©a
->
¥ogªss
.
Êags
 & 
PGRS_DL_SIZE_KNOWN
)?

244 ()
d©a
->
¥ogªss
.
size_dl
:-1;

246 
CURLINFO_CONTENT_LENGTH_UPLOAD
:

247 *
∑øm_doubÀp
 = (
d©a
->
¥ogªss
.
Êags
 & 
PGRS_UL_SIZE_KNOWN
)?

248 ()
d©a
->
¥ogªss
.
size_ul
:-1;

250 
CURLINFO_REDIRECT_TIME
:

251 *
∑øm_doubÀp
 = 
d©a
->
¥ogªss
.
t_ªdúe˘
;

255  
CURLE_BAD_FUNCTION_ARGUMENT
;

257  
CURLE_OK
;

258 
	}
}

260 
CURLcode
 
	$gëöfo_¶i°
(
Sessi⁄H™dÀ
 *
d©a
, 
CURLINFO
 
öfo
,

261 
cuæ_¶i°
 **
∑øm_¶i°p
)

264 
cuæ_˚πöfo
 * 
to_˚πöfo
;

265 
cuæ_¶i°
 * 
to_¶i°
;

266 } 
±r
;

268 
öfo
) {

269 
CURLINFO_SSL_ENGINES
:

270 *
∑øm_¶i°p
 = 
	`Cuæ_s¶_ígöes_li°
(
d©a
);

272 
CURLINFO_COOKIELIST
:

273 *
∑øm_¶i°p
 = 
	`Cuæ_cookõ_li°
(
d©a
);

275 
CURLINFO_CERTINFO
:

278 
±r
.
to_˚πöfo
 = &
d©a
->
öfo
.
˚πs
;

279 *
∑øm_¶i°p
 = 
±r
.
to_¶i°
;

281 
CURLINFO_TLS_SESSION
:

283 
cuæ_és£ssi⁄öfo
 **
tsù
 = (curl_tlssessioninfo **)

284 
∑øm_¶i°p
;

285 
cuæ_és£ssi⁄öfo
 *
tsi
 = &
d©a
->tsi;

286 
c⁄√˘d©a
 *
c⁄n
 = 
d©a
->
ósy_c⁄n
;

287 
socködex
 = 0;

289 *
tsù
 = 
tsi
;

290 
tsi
->
backíd
 = 
CURLSSLBACKEND_NONE
;

291 
tsi
->
öã∫Æs
 = 
NULL
;

293 if(!
c⁄n
)

297 (
socködex
 < (
c⁄n
->
s¶
) / (conn->ssl[0])) &&

298 (!
c⁄n
->
s¶
[
socködex
].
u£
))

299 
socködex
++;

301 if(
socködex
 =(
c⁄n
->
s¶
) / (conn->ssl[0]))

305 #ifde‡
USE_SSLEAY


306 
tsi
->
backíd
 = 
CURLSSLBACKEND_OPENSSL
;

307 
tsi
->
öã∫Æs
 = 
c⁄n
->
s¶
[
socködex
].
˘x
;

309 #ifde‡
USE_GNUTLS


310 
tsi
->
backíd
 = 
CURLSSLBACKEND_GNUTLS
;

311 
tsi
->
öã∫Æs
 = 
c⁄n
->
s¶
[
socködex
].
£ssi⁄
;

313 #ifde‡
USE_NSS


314 
tsi
->
backíd
 = 
CURLSSLBACKEND_NSS
;

315 
tsi
->
öã∫Æs
 = 
c⁄n
->
s¶
[
socködex
].
h™dÀ
;

317 #ifde‡
USE_QSOSSL


318 
tsi
->
backíd
 = 
CURLSSLBACKEND_QSOSSL
;

319 
tsi
->
öã∫Æs
 = 
c⁄n
->
s¶
[
socködex
].
h™dÀ
;

321 #ifde‡
USE_GSKIT


322 
tsi
->
backíd
 = 
CURLSSLBACKEND_GSKIT
;

323 
tsi
->
öã∫Æs
 = 
c⁄n
->
s¶
[
socködex
].
h™dÀ
;

332  
CURLE_BAD_FUNCTION_ARGUMENT
;

334  
CURLE_OK
;

335 
	}
}

337 
CURLcode
 
	$Cuæ_gëöfo
(
Sessi⁄H™dÀ
 *
d©a
, 
CURLINFO
 
öfo
, ...)

339 
va_li°
 
¨g
;

340 *
∑øm_l⁄gp
=
NULL
;

341 *
∑øm_doubÀp
=
NULL
;

342 **
∑øm_ch¨p
=
NULL
;

343 
cuæ_¶i°
 **
∑øm_¶i°p
=
NULL
;

344 
ty≥
;

346 
CURLcode
 
ªt
 = 
CURLE_BAD_FUNCTION_ARGUMENT
;

348 if(!
d©a
)

349  
ªt
;

351 
	`va_°¨t
(
¨g
, 
öfo
);

353 
ty≥
 = 
CURLINFO_TYPEMASK
 & ()
öfo
;

354 
ty≥
) {

355 
CURLINFO_STRING
:

356 
∑øm_ch¨p
 = 
	`va_¨g
(
¨g
, **);

357 if(
NULL
 !
∑øm_ch¨p
)

358 
ªt
 = 
	`gëöfo_ch¨
(
d©a
, 
öfo
, 
∑øm_ch¨p
);

360 
CURLINFO_LONG
:

361 
∑øm_l⁄gp
 = 
	`va_¨g
(
¨g
, *);

362 if(
NULL
 !
∑øm_l⁄gp
)

363 
ªt
 = 
	`gëöfo_l⁄g
(
d©a
, 
öfo
, 
∑øm_l⁄gp
);

365 
CURLINFO_DOUBLE
:

366 
∑øm_doubÀp
 = 
	`va_¨g
(
¨g
, *);

367 if(
NULL
 !
∑øm_doubÀp
)

368 
ªt
 = 
	`gëöfo_doubÀ
(
d©a
, 
öfo
, 
∑øm_doubÀp
);

370 
CURLINFO_SLIST
:

371 
∑øm_¶i°p
 = 
	`va_¨g
(
¨g
, 
cuæ_¶i°
 **);

372 if(
NULL
 !
∑øm_¶i°p
)

373 
ªt
 = 
	`gëöfo_¶i°
(
d©a
, 
öfo
, 
∑øm_¶i°p
);

379 
	`va_íd
(
¨g
);

380  
ªt
;

381 
	}
}

	@lib/getinfo.h

1 #i‚de‡
HEADER_CURL_GETINFO_H


2 
	#HEADER_CURL_GETINFO_H


	)

24 
CURLcode
 
Cuæ_gëöfo
(
Sessi⁄H™dÀ
 *
d©a
, 
CURLINFO
 
öfo
, ...);

25 
CURLcode
 
Cuæ_öôöfo
(
Sessi⁄H™dÀ
 *
d©a
);

	@lib/gopher.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_GOPHER


27 
	~"uæd©a.h
"

28 
	~<cuæ/cuæ.h
>

29 
	~"å™s„r.h
"

30 
	~"£ndf.h
"

32 
	~"¥ogªss.h
"

33 
	~"°ªquÆ.h
"

34 
	~"g›hî.h
"

35 
	~"øw°r.h
"

36 
	~"£À˘.h
"

37 
	~"uæ.h
"

38 
	~"w¨∆ess.h
"

40 
	#_MPRINTF_REPLACE


	)

41 
	~<cuæ/m¥ötf.h
>

43 
	~"cuæ_mem‹y.h
"

45 
	~"memdebug.h
"

51 
CURLcode
 
g›hî_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

59 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_g›hî
 = {

61 
ZERO_NULL
,

62 
g›hî_do
,

63 
ZERO_NULL
,

64 
ZERO_NULL
,

65 
ZERO_NULL
,

66 
ZERO_NULL
,

67 
ZERO_NULL
,

68 
ZERO_NULL
,

69 
ZERO_NULL
,

70 
ZERO_NULL
,

71 
ZERO_NULL
,

72 
ZERO_NULL
,

73 
ZERO_NULL
,

74 
PORT_GOPHER
,

75 
CURLPROTO_GOPHER
,

76 
PROTOPT_NONE


79 
CURLcode
 
	$g›hî_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

81 
CURLcode
 
ªsu…
=
CURLE_OK
;

82 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

83 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
FIRSTSOCKET
];

85 
cuæ_off_t
 *
byãcou¡
 = &
d©a
->
ªq
.bytecount;

86 *
∑th
 = 
d©a
->
°©e
.path;

87 *
£l
;

88 *
£l_‹g
 = 
NULL
;

89 
ssize_t
 
amou¡
, 
k
;

91 *
d⁄e
 = 
TRUE
;

94 if(
	`°æí
(
∑th
) <= 2)

95 
£l
 = (*)"";

97 *
√wp
;

98 
size_t
 
j
, 
i
;

99 
Àn
;

102 
√wp
 = 
∑th
;

103 
√wp
+=2;

106 
j
 = 
	`°æí
(
√wp
);

107 
i
=0; i<
j
; i++)

108 if(
√wp
[
i
] == '?')

109 
√wp
[
i
] = '\x09';

112 
£l
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
, 
√wp
, 0, &
Àn
);

113 if(!
£l
)

114  
CURLE_OUT_OF_MEMORY
;

115 
£l_‹g
 = 
£l
;

120 
k
 = 
	`cuæx_uztosz
(
	`°æí
(
£l
));

123 
ªsu…
 = 
	`Cuæ_wrôe
(
c⁄n
, 
sockfd
, 
£l
, 
k
, &
amou¡
);

124 if(
CURLE_OK
 =
ªsu…
) {

125 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_HEADER
, 
£l
, 
amou¡
);

126 if(
ªsu…
) {

127 
	`Cuæ_ß„‰ì
(
£l_‹g
);

128  
ªsu…
;

130 
k
 -
amou¡
;

131 
£l
 +
amou¡
;

132 if(
k
 < 1)

136 
	`Áûf
(
d©a
, "Failed sending GopherÑequest");

137 
	`Cuæ_ß„‰ì
(
£l_‹g
);

138  
ªsu…
;

149 
	`Cuæ_sockë_ªady
(
CURL_SOCKET_BAD
, 
sockfd
, 100);

152 
	`Cuæ_ß„‰ì
(
£l_‹g
);

156 
ªsu…
 = 
	`Cuæ_£ndf
(
sockfd
, 
c⁄n
, "\r\n");

157 if(
ªsu…
 !
CURLE_OK
) {

158 
	`Áûf
(
d©a
, "Failed sending GopherÑequest");

159  
ªsu…
;

161 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_HEADER
, (*)"\r\n", 2);

162 if(
ªsu…
)

163  
ªsu…
;

165 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
FALSE
, 
byãcou¡
,

166 -1, 
NULL
);

167  
CURLE_OK
;

168 
	}
}

	@lib/gopher.h

1 #i‚de‡
HEADER_CURL_GOPHER_H


2 
	#HEADER_CURL_GOPHER_H


	)

25 #i‚de‡
CURL_DISABLE_GOPHER


26 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_g›hî
;

	@lib/hash.c

23 
	~"cuæ_£tup.h
"

25 
	~"hash.h
"

26 
	~"Œi°.h
"

28 
	#_MPRINTF_REPLACE


	)

29 
	~<cuæ/m¥ötf.h
>

31 
	~"cuæ_mem‹y.h
"

33 
	~"memdebug.h
"

36 
	$hash_ñemít_dt‹
(*
u£r
, *
ñemít
)

38 
cuæ_hash
 *
h
 = (cuæ_hash *Ë
u£r
;

39 
cuæ_hash_ñemít
 *
e
 = (cuæ_hash_ñemíà*Ë
ñemít
;

41 
	`Cuæ_ß„‰ì
(
e
->
key
);

43 if(
e
->
±r
) {

44 
h
->
	`dt‹
(
e
->
±r
);

45 
e
->
±r
 = 
NULL
;

48 
e
->
key_Àn
 = 0;

50 
	`‰ì
(
e
);

51 
	}
}

55 
	$Cuæ_hash_öô
(
cuæ_hash
 *
h
,

56 
¶Ÿs
,

57 
hash_fun˘i⁄
 
hfunc
,

58 
comp_fun˘i⁄
 
com∑øt‹
,

59 
cuæ_hash_dt‹
 
dt‹
)

61 
i
;

63 if(!
¶Ÿs
 || !
hfunc
 || !
com∑øt‹
 ||!
dt‹
) {

67 
h
->
hash_func
 = 
hfunc
;

68 
h
->
comp_func
 = 
com∑øt‹
;

69 
h
->
dt‹
 = dtor;

70 
h
->
size
 = 0;

71 
h
->
¶Ÿs
 = slots;

73 
h
->
èbÀ
 = 
	`mÆloc
(
¶Ÿs
 * (
cuæ_Œi°
 *));

74 if(
h
->
èbÀ
) {

75 
i
 = 0; i < 
¶Ÿs
; ++i) {

76 
h
->
èbÀ
[
i
] = 
	`Cuæ_Œi°_Æloc
((
cuæ_Œi°_dt‹
Ë
hash_ñemít_dt‹
);

77 if(!
h
->
èbÀ
[
i
]) {

78 
i
--) {

79 
	`Cuæ_Œi°_de°roy
(
h
->
èbÀ
[
i
], 
NULL
);

80 
h
->
èbÀ
[
i
] = 
NULL
;

82 
	`‰ì
(
h
->
èbÀ
);

83 
h
->
èbÀ
 = 
NULL
;

84 
h
->
¶Ÿs
 = 0;

91 
h
->
¶Ÿs
 = 0;

94 
	}
}

96 
cuæ_hash
 *

97 
	$Cuæ_hash_Æloc
(
¶Ÿs
,

98 
hash_fun˘i⁄
 
hfunc
,

99 
comp_fun˘i⁄
 
com∑øt‹
,

100 
cuæ_hash_dt‹
 
dt‹
)

102 
cuæ_hash
 *
h
;

104 if(!
¶Ÿs
 || !
hfunc
 || !
com∑øt‹
 ||!
dt‹
) {

105  
NULL
;

108 
h
 = 
	`mÆloc
((
cuæ_hash
));

109 if(
h
) {

110 if(
	`Cuæ_hash_öô
(
h
, 
¶Ÿs
, 
hfunc
, 
com∑øt‹
, 
dt‹
)) {

112 
	`‰ì
(
h
);

113 
h
 = 
NULL
;

117  
h
;

118 
	}
}

122 
cuæ_hash_ñemít
 *

123 
	$mk_hash_ñemít
(c⁄° *
key
, 
size_t
 
key_Àn
, c⁄° *
p
)

125 
cuæ_hash_ñemít
 *
he
 = 
	`mÆloc
((curl_hash_element));

127 if(
he
) {

128 *
dupkey
 = 
	`mÆloc
(
key_Àn
);

129 if(
dupkey
) {

131 
	`mem˝y
(
dupkey
, 
key
, 
key_Àn
);

133 
he
->
key
 = 
dupkey
;

134 
he
->
key_Àn
 = key_len;

135 
he
->
±r
 = (*Ë
p
;

139 
	`‰ì
(
he
);

140 
he
 = 
NULL
;

143  
he
;

144 
	}
}

146 
	#FETCH_LIST
(
x
,
y
,
z
Ëx->
èbÀ
[x->
	`hash_func
(y, z, x->
¶Ÿs
)]

	)

154 
	$Cuæ_hash_add
(
cuæ_hash
 *
h
, *
key
, 
size_t
 
key_Àn
, *
p
)

156 
cuæ_hash_ñemít
 *
he
;

157 
cuæ_Œi°_ñemít
 *
À
;

158 
cuæ_Œi°
 *
l
 = 
	`FETCH_LIST
 (
h
, 
key
, 
key_Àn
);

160 
À
 = 
l
->
hód
;Üe;ÜêÀ->
√xt
) {

161 
he
 = (
cuæ_hash_ñemít
 *Ë
À
->
±r
;

162 if(
h
->
	`comp_func
(
he
->
key
, he->
key_Àn
, key, key_len)) {

163 
	`Cuæ_Œi°_ªmove
(
l
, 
À
, (*)
h
);

164 --
h
->
size
;

169 
he
 = 
	`mk_hash_ñemít
(
key
, 
key_Àn
, 
p
);

170 if(
he
) {

171 if(
	`Cuæ_Œi°_ö£π_√xt
(
l
,Ü->
èû
, 
he
)) {

172 ++
h
->
size
;

173  
p
;

181 
	`‰ì
(
he
->
key
);

182 
	`‰ì
(
he
);

185  
NULL
;

186 
	}
}

189 
	$Cuæ_hash_dñëe
(
cuæ_hash
 *
h
, *
key
, 
size_t
 
key_Àn
)

191 
cuæ_Œi°_ñemít
 *
À
;

192 
cuæ_hash_ñemít
 *
he
;

193 
cuæ_Œi°
 *
l
 = 
	`FETCH_LIST
(
h
, 
key
, 
key_Àn
);

195 
À
 = 
l
->
hód
;Üe;ÜêÀ->
√xt
) {

196 
he
 = 
À
->
±r
;

197 if(
h
->
	`comp_func
(
he
->
key
, he->
key_Àn
, key, key_len)) {

198 
	`Cuæ_Œi°_ªmove
(
l
, 
À
, (*Ë
h
);

199 --
h
->
size
;

204 
	}
}

207 
	$Cuæ_hash_pick
(
cuæ_hash
 *
h
, *
key
, 
size_t
 
key_Àn
)

209 
cuæ_Œi°_ñemít
 *
À
;

210 
cuæ_hash_ñemít
 *
he
;

211 
cuæ_Œi°
 *
l
;

213 if(
h
) {

214 
l
 = 
	`FETCH_LIST
(
h
, 
key
, 
key_Àn
);

215 
À
 = 
l
->
hód
;Üe;ÜêÀ->
√xt
) {

216 
he
 = 
À
->
±r
;

217 if(
h
->
	`comp_func
(
he
->
key
, he->
key_Àn
, key, key_len)) {

218  
he
->
±r
;

223  
NULL
;

224 
	}
}

226 #i‡
deföed
(
DEBUGBUILD
Ë&& deföed(
AGGRESIVE_TEST
)

228 
Cuæ_hash_≠∂y
(
cuæ_hash
 *
h
, *
u£r
,

229 (*
cb
)(*
u£r
, *
±r
))

231 
cuæ_Œi°_ñemít
 *
À
;

232 
i
;

234 
i
 = 0; i < 
h
->
¶Ÿs
; ++i) {

235 
À
 = (
h
->
èbÀ
[
i
])->
hód
;

236 
À
;

237 
À
 =Üe->
√xt
) {

238 
cuæ_hash_ñemít
 *
ñ
 = 
À
->
±r
;

239 
	`cb
(
u£r
, 
ñ
->
±r
);

242 
	}
}

246 
	$Cuæ_hash_˛ón
(
cuæ_hash
 *
h
)

248 
i
;

250 
i
 = 0; i < 
h
->
¶Ÿs
; ++i) {

251 
	`Cuæ_Œi°_de°roy
(
h
->
èbÀ
[
i
], (*) h);

252 
h
->
èbÀ
[
i
] = 
NULL
;

255 
	`Cuæ_ß„‰ì
(
h
->
èbÀ
);

256 
h
->
size
 = 0;

257 
h
->
¶Ÿs
 = 0;

258 
	}
}

261 
Cuæ_hash_˛ón_wôh_¸ôîium
(
cuæ_hash
 *
h
, *
u£r
,

262 (*
comp
)(*, *))

264 
cuæ_Œi°_ñemít
 *
À
;

265 
cuæ_Œi°_ñemít
 *
 ext
;

266 
cuæ_Œi°
 *
li°
;

267 
i
;

269 if(!
h
)

272 
i
 = 0; i < 
h
->
¶Ÿs
; ++i) {

273 
li°
 = 
h
->
èbÀ
[
i
];

274 
À
 = 
li°
->
hód
;

275 
À
) {

276 
cuæ_hash_ñemít
 *
he
 = 
À
->
±r
;

277 
 ext
 = 
À
->
√xt
;

279 if(
	`comp
(
u£r
, 
he
->
±r
)) {

280 
	`Cuæ_Œi°_ªmove
(
li°
, 
À
, (*Ë
h
);

281 --
h
->
size
;

283 
À
 = 
 ext
;

286 
	}
}

289 
	$Cuæ_hash_de°roy
(
cuæ_hash
 *
h
)

291 if(!
h
)

294 
	`Cuæ_hash_˛ón
(
h
);

296 
	`‰ì
(
h
);

297 
	}
}

299 
size_t
 
	$Cuæ_hash_°r
(* 
key
, 
size_t
 
key_Àngth
, size_à
¶Ÿs_num
)

301 c⁄° * 
key_°r
 = (c⁄° *Ë
key
;

302 c⁄° *
íd
 = 
key_°r
 + 
key_Àngth
;

303 
h
 = 5381;

305 
key_°r
 < 
íd
) {

306 
h
 += h << 5;

307 
h
 ^(Ë*
key_°r
++;

310  (
h
 % 
¶Ÿs_num
);

311 
	}
}

313 
size_t
 
	$Cuæ_°r_key_com∑ª
(*
k1
, 
size_t
 
key1_Àn
, *
k2
, size_à
key2_Àn
)

315 *
key1
 = (*)
k1
;

316 *
key2
 = (*)
k2
;

318 if(
key1_Àn
 =
key2_Àn
 &&

319 *
key1
 =*
key2
 &&

320 
	`memcmp
(
key1
, 
key2
, 
key1_Àn
) == 0) {

325 
	}
}

327 
	$Cuæ_hash_°¨t_ôî©e
(
cuæ_hash
 *
hash
,

328 
cuæ_hash_ôî©‹
 *
ôî
)

330 
ôî
->
hash
 = hash;

331 
ôî
->
¶Ÿ_ödex
 = 0;

332 
ôî
->
cuºít_ñemít
 = 
NULL
;

333 
	}
}

335 
cuæ_hash_ñemít
 *

336 
	$Cuæ_hash_√xt_ñemít
(
cuæ_hash_ôî©‹
 *
ôî
)

338 
i
;

339 
cuæ_hash
 *
h
 = 
ôî
->
hash
;

342 if(
ôî
->
cuºít_ñemít
)

343 
ôî
->
cuºít_ñemít
 = iãr->cuºít_ñemít->
√xt
;

346 if(!
ôî
->
cuºít_ñemít
) {

347 
i
 = 
ôî
->
¶Ÿ_ödex
;ò< 
h
->
¶Ÿs
;i++) {

348 if(
h
->
èbÀ
[
i
]->
hód
) {

349 
ôî
->
cuºít_ñemít
 = 
h
->
èbÀ
[
i
]->
hód
;

350 
ôî
->
¶Ÿ_ödex
 = 
i
+1;

356 if(
ôî
->
cuºít_ñemít
) {

357 
cuæ_hash_ñemít
 *
he
 = 
ôî
->
cuºít_ñemít
->
±r
;

358  
he
;

361 
ôî
->
cuºít_ñemít
 = 
NULL
;

362  
NULL
;

364 
	}
}

367 
Cuæ_hash_¥öt
(
cuæ_hash
 *
h
,

368 (*
func
)(*))

370 
cuæ_hash_ôî©‹
 
ôî
;

371 
cuæ_hash_ñemít
 *
he
;

372 
œ°_ödex
 = -1;

374 if(!
h
)

377 
	`Ârötf
(
°dîr
, "=Hash dump=\n");

379 
	`Cuæ_hash_°¨t_ôî©e
(
h
, &
ôî
);

381 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

382 
he
) {

383 if(
ôî
.
¶Ÿ_ödex
 !
œ°_ödex
) {

384 
	`Ârötf
(
°dîr
, "ödex %d:", 
ôî
.
¶Ÿ_ödex
);

385 if(
œ°_ödex
 >= 0) {

386 
	`Ârötf
(
°dîr
, "\n");

388 
œ°_ödex
 = 
ôî
.
¶Ÿ_ödex
;

391 if(
func
)

392 
	`func
(
he
->
±r
);

394 
	`Ârötf
(
°dîr
, " [%p]", (*)
he
->
±r
);

396 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

398 
	`Ârötf
(
°dîr
, "\n");

399 
	}
}

	@lib/hash.h

1 #i‚de‡
HEADER_CURL_HASH_H


2 
	#HEADER_CURL_HASH_H


	)

25 
	~"cuæ_£tup.h
"

27 
	~<°ddef.h
>

29 
	~"Œi°.h
"

32 
	$size_t
 (*
	thash_fun˘i⁄
Ë(* 
	tkey
,

33 
	tsize_t
 
	tkey_Àngth
,

34 
	tsize_t
 
	t¶Ÿs_num
);

39 
	$size_t
 (*
	tcomp_fun˘i⁄
Ë(* 
	tkey1
,

40 
	tsize_t
 
	tkey1_Àn
,

41 *
	tkey2
,

42 
	tsize_t
 
	tkey2_Àn
);

44 (*
	tcuæ_hash_dt‹
)(*);

46 
	scuæ_hash
 {

47 
cuæ_Œi°
 **
èbÀ
;

50 
hash_fun˘i⁄
 
hash_func
;

53 
comp_fun˘i⁄
 
comp_func
;

54 
cuæ_hash_dt‹
 
dt‹
;

55 
¶Ÿs
;

56 
size_t
 
size
;

59 
	scuæ_hash_ñemít
 {

60 *
±r
;

61 *
key
;

62 
size_t
 
key_Àn
;

65 
	scuæ_hash_ôî©‹
 {

66 
cuæ_hash
 *
hash
;

67 
¶Ÿ_ödex
;

68 
cuæ_Œi°_ñemít
 *
cuºít_ñemít
;

71 
	`Cuæ_hash_öô
(
cuæ_hash
 *
h
,

72 
¶Ÿs
,

73 
hash_fun˘i⁄
 
hfunc
,

74 
comp_fun˘i⁄
 
com∑øt‹
,

75 
cuæ_hash_dt‹
 
dt‹
);

77 
cuæ_hash
 *
	`Cuæ_hash_Æloc
(
¶Ÿs
,

78 
hash_fun˘i⁄
 
hfunc
,

79 
comp_fun˘i⁄
 
com∑øt‹
,

80 
cuæ_hash_dt‹
 
dt‹
);

82 *
	`Cuæ_hash_add
(
cuæ_hash
 *
h
, *
key
, 
size_t
 
key_Àn
, *
p
);

83 
	`Cuæ_hash_dñëe
(
cuæ_hash
 *
h
, *
key
, 
size_t
 
key_Àn
);

84 *
	`Cuæ_hash_pick
(
cuæ_hash
 *, * 
key
, 
size_t
 
key_Àn
);

85 
	`Cuæ_hash_≠∂y
(
cuæ_hash
 *
h
, *
u£r
,

86 (*
cb
)(*
u£r
, *
±r
));

87 
	`Cuæ_hash_cou¡
(
cuæ_hash
 *
h
);

88 
	`Cuæ_hash_˛ón
(
cuæ_hash
 *
h
);

89 
	`Cuæ_hash_˛ón_wôh_¸ôîium
(
cuæ_hash
 *
h
, *
u£r
,

90 (*
comp
)(*, *));

91 
	`Cuæ_hash_de°roy
(
cuæ_hash
 *
h
);

93 
size_t
 
	`Cuæ_hash_°r
(* 
key
, size_à
key_Àngth
, size_à
¶Ÿs_num
);

94 
size_t
 
	`Cuæ_°r_key_com∑ª
(*
k1
, size_à
key1_Àn
, *
k2
,

95 
size_t
 
key2_Àn
);

97 
	`Cuæ_hash_°¨t_ôî©e
(
cuæ_hash
 *
hash
,

98 
cuæ_hash_ôî©‹
 *
ôî
);

99 
cuæ_hash_ñemít
 *

100 
	`Cuæ_hash_√xt_ñemít
(
cuæ_hash_ôî©‹
 *
ôî
);

102 
	`Cuæ_hash_¥öt
(
cuæ_hash
 *
h
,

103 (*
func
)(*));

	@lib/hmac.c

25 
	~"cuæ_£tup.h
"

27 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


29 
	~"cuæ_hmac.h
"

31 
	#_MPRINTF_REPLACE


	)

32 
	~<cuæ/m¥ötf.h
>

34 
	~"cuæ_mem‹y.h
"

36 
	~"memdebug.h
"

46 c⁄° 
	ghmac_ùad
 = 0x36;

47 c⁄° 
	ghmac_›ad
 = 0x5C;

51 
HMAC_c⁄ãxt
 *

52 
	$Cuæ_HMAC_öô
(c⁄° 
HMAC_∑øms
 * 
hash∑øms
,

53 c⁄° * 
key
,

54 
keyÀn
)

56 
size_t
 
i
;

57 
HMAC_c⁄ãxt
 * 
˘xt
;

58 * 
hkey
;

59 
b
;

62 
i
 =  *
˘xt
 + 2 * 
hash∑øms
->
hmac_˘xtsize
 +

63 
hash∑øms
->
hmac_ªsu…Àn
;

64 
˘xt
 = 
	`mÆloc
(
i
);

66 if(!
˘xt
)

67  
˘xt
;

69 
˘xt
->
hmac_hash
 = 
hash∑øms
;

70 
˘xt
->
hmac_hash˘xt1
 = (*) (ctxt + 1);

71 
˘xt
->
hmac_hash˘xt2
 = (*Ë((*Ë˘xt->
hmac_hash˘xt1
 +

72 
hash∑øms
->
hmac_˘xtsize
);

75 if(
keyÀn
 > 
hash∑øms
->
hmac_maxkeyÀn
) {

76 (*
hash∑øms
->
hmac_höô
)(
˘xt
->
hmac_hash˘xt1
);

77 (*
hash∑øms
->
hmac_hupd©e
)(
˘xt
->
hmac_hash˘xt1
, 
key
, 
keyÀn
);

78 
hkey
 = (*Ë
˘xt
->
hmac_hash˘xt2
 + 
hash∑øms
->
hmac_˘xtsize
;

79 (*
hash∑øms
->
hmac_hföÆ
)(
hkey
, 
˘xt
->
hmac_hash˘xt1
);

80 
key
 = 
hkey
;

81 
keyÀn
 = 
hash∑øms
->
hmac_ªsu…Àn
;

85 (*
hash∑øms
->
hmac_höô
)(
˘xt
->
hmac_hash˘xt1
);

86 (*
hash∑øms
->
hmac_höô
)(
˘xt
->
hmac_hash˘xt2
);

88 
i
 = 0; i < 
keyÀn
; i++) {

89 
b
 = ()(*
key
 ^ 
hmac_ùad
);

90 (*
hash∑øms
->
hmac_hupd©e
)(
˘xt
->
hmac_hash˘xt1
, &
b
, 1);

91 
b
 = ()(*
key
++ ^ 
hmac_›ad
);

92 (*
hash∑øms
->
hmac_hupd©e
)(
˘xt
->
hmac_hash˘xt2
, &
b
, 1);

95 ; 
i
 < 
hash∑øms
->
hmac_maxkeyÀn
; i++) {

96 (*
hash∑øms
->
hmac_hupd©e
)(
˘xt
->
hmac_hash˘xt1
, &
hmac_ùad
, 1);

97 (*
hash∑øms
->
hmac_hupd©e
)(
˘xt
->
hmac_hash˘xt2
, &
hmac_›ad
, 1);

101  
˘xt
;

102 
	}
}

104 
	$Cuæ_HMAC_upd©e
(
HMAC_c⁄ãxt
 * 
˘xt
,

105 c⁄° * 
d©a
,

106 
Àn
)

109 (*
˘xt
->
hmac_hash
->
hmac_hupd©e
)(˘xt->
hmac_hash˘xt1
, 
d©a
, 
Àn
);

111 
	}
}

114 
	$Cuæ_HMAC_föÆ
(
HMAC_c⁄ãxt
 * 
˘xt
, * 
ªsu…
)

116 c⁄° 
HMAC_∑øms
 * 
hash∑øms
 = 
˘xt
->
hmac_hash
;

121 if(!
ªsu…
)

122 
ªsu…
 = (*Ë
˘xt
->
hmac_hash˘xt2
 +

123 
˘xt
->
hmac_hash
->
hmac_˘xtsize
;

125 (*
hash∑øms
->
hmac_hföÆ
)(
ªsu…
, 
˘xt
->
hmac_hash˘xt1
);

126 (*
hash∑øms
->
hmac_hupd©e
)(
˘xt
->
hmac_hash˘xt2
,

127 
ªsu…
, 
hash∑øms
->
hmac_ªsu…Àn
);

128 (*
hash∑øms
->
hmac_hföÆ
)(
ªsu…
, 
˘xt
->
hmac_hash˘xt2
);

129 
	`‰ì
((*Ë
˘xt
);

131 
	}
}

	@lib/hostasyn.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_NETINET_IN_H


26 
	~<√töë/ö.h
>

28 #ifde‡
HAVE_NETDB_H


29 
	~<√tdb.h
>

31 #ifde‡
HAVE_ARPA_INET_H


32 
	~<¨∑/öë.h
>

34 #ifde‡
__VMS


35 
	~<ö.h
>

36 
	~<öë.h
>

39 #ifde‡
HAVE_PROCESS_H


40 
	~<¥o˚ss.h
>

43 
	~"uæd©a.h
"

44 
	~"£ndf.h
"

45 
	~"ho°ù.h
"

46 
	~"hash.h
"

47 
	~"sh¨e.h
"

48 
	~"°ªº‹.h
"

49 
	~"uæ.h
"

51 
	#_MPRINTF_REPLACE


	)

52 
	~<cuæ/m¥ötf.h
>

54 
	~"cuæ_mem‹y.h
"

56 
	~"memdebug.h
"

61 #ifde‡
CURLRES_ASYNCH


73 
CURLcode
 
	$Cuæ_addröfo_ˇŒback
(
c⁄√˘d©a
 *
c⁄n
,

74 
°©us
,

75 
Cuæ_addröfo
 *
ai
)

77 
Cuæ_dns_íåy
 *
dns
 = 
NULL
;

78 
CURLcode
 
rc
 = 
CURLE_OK
;

80 
c⁄n
->
async
.
°©us
 = status;

82 if(
CURL_ASYNC_SUCCESS
 =
°©us
) {

83 if(
ai
) {

84 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

86 if(
d©a
->
sh¨e
)

87 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_DNS
, 
CURL_LOCK_ACCESS_SINGLE
);

89 
dns
 = 
	`Cuæ_ˇche_addr
(
d©a
, 
ai
,

90 
c⁄n
->
async
.
ho°«me
,

91 
c⁄n
->
async
.
p‹t
);

92 if(!
dns
) {

94 
	`Cuæ_‰ìaddröfo
(
ai
);

95 
rc
 = 
CURLE_OUT_OF_MEMORY
;

98 if(
d©a
->
sh¨e
)

99 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_DNS
);

102 
rc
 = 
CURLE_OUT_OF_MEMORY
;

106 
c⁄n
->
async
.
dns
 = dns;

111 
c⁄n
->
async
.
d⁄e
 = 
TRUE
;

115  
rc
;

116 
	}
}

123 
CURLcode
 
	$Cuæ_async_ªsﬁved
(
c⁄√˘d©a
 *
c⁄n
,

124 
boﬁ
 *
¥Ÿocﬁ_d⁄e
)

126 
CURLcode
 
code
;

128 if(
c⁄n
->
async
.
dns
) {

129 
c⁄n
->
dns_íåy
 = c⁄n->
async
.
dns
;

130 
c⁄n
->
async
.
dns
 = 
NULL
;

133 
code
 = 
	`Cuæ_£tup_c⁄n
(
c⁄n
, 
¥Ÿocﬁ_d⁄e
);

135 if(
code
)

138 
	`Cuæ_disc⁄√˘
(
c⁄n
, 
FALSE
);

140  
code
;

141 
	}
}

149 
Cuæ_addröfo
 *
	$Cuæ_gëaddröfo
(
c⁄√˘d©a
 *
c⁄n
,

150 c⁄° *
ho°«me
,

151 
p‹t
,

152 *
waôp
)

154  
	`Cuæ_ªsﬁvî_gëaddröfo
(
c⁄n
, 
ho°«me
, 
p‹t
, 
waôp
);

155 
	}
}

	@lib/hostcheck.c

23 
	~"cuæ_£tup.h
"

25 #i‡
deföed
(
USE_SSLEAY
Ë|| deföed(
USE_AXTLS
Ë|| deföed(
USE_QSOSSL
) || \

26 
	$deföed
(
USE_GSKIT
)

29 #ifde‡
HAVE_NETINET_IN_H


30 
	~<√töë/ö.h
>

33 
	~"ho°check.h
"

34 
	~"øw°r.h
"

35 
	~"öë_±⁄.h
"

37 
	~"cuæ_mem‹y.h
"

39 
	~"memdebug.h
"

61 
	$ho°m©ch
(*
ho°«me
, *
∑âîn
)

63 c⁄° *
∑âîn_œbñ_íd
, *
∑âîn_wûdˇrd
, *
ho°«me_œbñ_íd
;

64 
wûdˇrd_íabÀd
;

65 
size_t
 
¥efixÀn
, 
suffixÀn
;

66 
ö_addr
 
ign‹ed
;

67 #ifde‡
ENABLE_IPV6


68 
sockaddr_ö6
 
si6
;

72 
size_t
 
Àn
 = 
	`°æí
(
ho°«me
);

73 if(
ho°«me
[
Àn
-1]=='.')

74 
ho°«me
[
Àn
-1]=0;

75 
Àn
 = 
	`°æí
(
∑âîn
);

76 if(
∑âîn
[
Àn
-1]=='.')

77 
∑âîn
[
Àn
-1]=0;

79 
∑âîn_wûdˇrd
 = 
	`°rchr
(
∑âîn
, '*');

80 if(
∑âîn_wûdˇrd
 =
NULL
)

81  
	`Cuæ_øw_equÆ
(
∑âîn
, 
ho°«me
) ?

82 
CURL_HOST_MATCH
 : 
CURL_HOST_NOMATCH
;

85 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
ho°«me
, &
ign‹ed
) > 0)

86  
CURL_HOST_NOMATCH
;

87 #ifde‡
ENABLE_IPV6


88 if(
	`Cuæ_öë_±⁄
(
AF_INET6
, 
ho°«me
, &
si6
.
sö6_addr
) > 0)

89  
CURL_HOST_NOMATCH
;

94 
wûdˇrd_íabÀd
 = 1;

95 
∑âîn_œbñ_íd
 = 
	`°rchr
(
∑âîn
, '.');

96 if(
∑âîn_œbñ_íd
 =
NULL
 || 
	`°rchr
(pattern_label_end+1, '.') == NULL ||

97 
∑âîn_wûdˇrd
 > 
∑âîn_œbñ_íd
 ||

98 
	`Cuæ_øw_√quÆ
(
∑âîn
, "xn--", 4)) {

99 
wûdˇrd_íabÀd
 = 0;

101 if(!
wûdˇrd_íabÀd
)

102  
	`Cuæ_øw_equÆ
(
∑âîn
, 
ho°«me
) ?

103 
CURL_HOST_MATCH
 : 
CURL_HOST_NOMATCH
;

105 
ho°«me_œbñ_íd
 = 
	`°rchr
(
ho°«me
, '.');

106 if(
ho°«me_œbñ_íd
 =
NULL
 ||

107 !
	`Cuæ_øw_equÆ
(
∑âîn_œbñ_íd
, 
ho°«me_œbñ_íd
))

108  
CURL_HOST_NOMATCH
;

113 if(
ho°«me_œbñ_íd
 - 
ho°«me
 < 
∑âîn_œbñ_íd
 - 
∑âîn
)

114  
CURL_HOST_NOMATCH
;

116 
¥efixÀn
 = 
∑âîn_wûdˇrd
 - 
∑âîn
;

117 
suffixÀn
 = 
∑âîn_œbñ_íd
 - (
∑âîn_wûdˇrd
+1);

118  
	`Cuæ_øw_√quÆ
(
∑âîn
, 
ho°«me
, 
¥efixÀn
) &&

119 
	`Cuæ_øw_√quÆ
(
∑âîn_wûdˇrd
+1, 
ho°«me_œbñ_íd
 - 
suffixÀn
,

120 
suffixÀn
) ?

121 
CURL_HOST_MATCH
 : 
CURL_HOST_NOMATCH
;

122 
	}
}

124 
	$Cuæ_˚π_ho°check
(c⁄° *
m©ch_∑âîn
, c⁄° *
ho°«me
)

126 *
m©chp
;

127 *
ho°p
;

128 
ªs
 = 0;

129 if(!
m©ch_∑âîn
 || !*match_pattern ||

130 !
ho°«me
 || !*hostname)

133 
m©chp
 = 
	`°rdup
(
m©ch_∑âîn
);

134 if(
m©chp
) {

135 
ho°p
 = 
	`°rdup
(
ho°«me
);

136 if(
ho°p
) {

137 if(
	`ho°m©ch
(
ho°p
, 
m©chp
Ë=
CURL_HOST_MATCH
)

138 
ªs
= 1;

139 
	`‰ì
(
ho°p
);

141 
	`‰ì
(
m©chp
);

145  
ªs
;

146 
	}
}

	@lib/hostcheck.h

1 #i‚de‡
HEADER_CURL_HOSTCHECK_H


2 
	#HEADER_CURL_HOSTCHECK_H


	)

25 
	~<cuæ/cuæ.h
>

27 
	#CURL_HOST_NOMATCH
 0

	)

28 
	#CURL_HOST_MATCH
 1

	)

29 
Cuæ_˚π_ho°check
(c⁄° *
m©ch_∑âîn
, c⁄° *
ho°«me
);

	@lib/hostip.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_NETINET_IN_H


26 
	~<√töë/ö.h
>

28 #ifde‡
HAVE_NETDB_H


29 
	~<√tdb.h
>

31 #ifde‡
HAVE_ARPA_INET_H


32 
	~<¨∑/öë.h
>

34 #ifde‡
__VMS


35 
	~<ö.h
>

36 
	~<öë.h
>

39 #ifde‡
HAVE_SETJMP_H


40 
	~<£tjmp.h
>

42 #ifde‡
HAVE_SIGNAL_H


43 
	~<sig«l.h
>

46 #ifde‡
HAVE_PROCESS_H


47 
	~<¥o˚ss.h
>

50 
	~"uæd©a.h
"

51 
	~"£ndf.h
"

52 
	~"ho°ù.h
"

53 
	~"hash.h
"

54 
	~"sh¨e.h
"

55 
	~"°ªº‹.h
"

56 
	~"uæ.h
"

57 
	~"öë_¡›.h
"

58 
	~"w¨∆ess.h
"

60 
	#_MPRINTF_REPLACE


	)

61 
	~<cuæ/m¥ötf.h
>

63 
	~"cuæ_mem‹y.h
"

65 
	~"memdebug.h
"

67 #i‡
deföed
(
CURLRES_SYNCH
) && \

68 
deföed
(
HAVE_ALARM
Ë&& deföed(
SIGALRM
Ë&& 
	$deföed
(
HAVE_SIGSETJMP
)

70 
	#USE_ALARM_TIMEOUT


	)

113 
cuæ_hash
 
ho°«me_ˇche
;

114 
ho°_ˇche_öôülized
;

116 
	`‰ìdn£¡ry
(*
‰ìthis
);

125 
cuæ_hash
 *
	$Cuæ_globÆ_ho°_ˇche_öô
()

127 
rc
 = 0;

128 if(!
ho°_ˇche_öôülized
) {

129 
rc
 = 
	`Cuæ_hash_öô
(&
ho°«me_ˇche
, 7, 
Cuæ_hash_°r
,

130 
Cuæ_°r_key_com∑ª
, 
‰ìdn£¡ry
);

131 if(!
rc
)

132 
ho°_ˇche_öôülized
 = 1;

134  
rc
?
NULL
:&
ho°«me_ˇche
;

135 
	}
}

140 
	$Cuæ_globÆ_ho°_ˇche_dt‹
()

142 if(
ho°_ˇche_öôülized
) {

145 
	`Cuæ_ho°ˇche_˛ón
(
NULL
, &
ho°«me_ˇche
);

147 
	`Cuæ_hash_˛ón
(&
ho°«me_ˇche
);

148 
ho°_ˇche_öôülized
 = 0;

150 
	}
}

155 
	$Cuæ_num_addªs£s
(c⁄° 
Cuæ_addröfo
 *
addr
)

157 
i
 = 0;

158 
addr
) {

159 
addr
 =áddr->
ai_√xt
;

160 
i
++;

162  
i
;

163 
	}
}

173 
	$Cuæ_¥öèbÀ_addªss
(c⁄° 
Cuæ_addröfo
 *
ai
, *
buf
, 
size_t
 
bufsize
)

175 c⁄° 
sockaddr_ö
 *
ß4
;

176 c⁄° 
ö_addr
 *
ùaddr4
;

177 #ifde‡
ENABLE_IPV6


178 c⁄° 
sockaddr_ö6
 *
ß6
;

179 c⁄° 
ö6_addr
 *
ùaddr6
;

182 
ai
->
ai_Ámûy
) {

183 
AF_INET
:

184 
ß4
 = (c⁄° *)
ai
->
ai_addr
;

185 
ùaddr4
 = &
ß4
->
sö_addr
;

186  
	`Cuæ_öë_¡›
(
ai
->
ai_Ámûy
, (c⁄° *)
ùaddr4
, 
buf
,

187 
bufsize
);

188 #ifde‡
ENABLE_IPV6


189 
AF_INET6
:

190 
ß6
 = (c⁄° *)
ai
->
ai_addr
;

191 
ùaddr6
 = &
ß6
->
sö6_addr
;

192  
	`Cuæ_öë_¡›
(
ai
->
ai_Ámûy
, (c⁄° *)
ùaddr6
, 
buf
,

193 
bufsize
);

198  
NULL
;

199 
	}
}

206 
	$¸óã_ho°ˇche_id
(c⁄° *
«me
, 
p‹t
)

209 *
id
 = 
	`≠rötf
("%s:%d", 
«me
, 
p‹t
);

210 *
±r
 = 
id
;

211 if(
±r
) {

213 *
±r
 && (*ptr != ':')) {

214 *
±r
 = ()
	`TOLOWER
(*ptr);

215 
±r
++;

218  
id
;

219 
	}
}

221 
	sho°ˇche_¥u√_d©a
 {

222 
	mˇche_timeout
;

223 
time_t
 
	mnow
;

234 
	$ho°ˇche_time°amp_ªmove
(*
d©≠
, *
hc
)

236 
ho°ˇche_¥u√_d©a
 *
d©a
 =

237 (
ho°ˇche_¥u√_d©a
 *Ë
d©≠
;

238 
Cuæ_dns_íåy
 *
c
 = (Cuæ_dns_íåy *Ë
hc
;

240  !
c
->
öu£
 && (
d©a
->
now
 - c->
time°amp
 >d©a->
ˇche_timeout
);

241 
	}
}

247 
	$ho°ˇche_¥u√
(
cuæ_hash
 *
ho°ˇche
, 
ˇche_timeout
, 
time_t
 
now
)

249 
ho°ˇche_¥u√_d©a
 
u£r
;

251 
u£r
.
ˇche_timeout
 = cache_timeout;

252 
u£r
.
now
 =Çow;

254 
	`Cuæ_hash_˛ón_wôh_¸ôîium
(
ho°ˇche
,

255 (*Ë&
u£r
,

256 
ho°ˇche_time°amp_ªmove
);

257 
	}
}

263 
	$Cuæ_ho°ˇche_¥u√
(
Sessi⁄H™dÀ
 *
d©a
)

265 
time_t
 
now
;

267 if((
d©a
->
£t
.
dns_ˇche_timeout
 =-1Ë|| !d©a->
dns
.
ho°ˇche
)

272 if(
d©a
->
sh¨e
)

273 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_DNS
, 
CURL_LOCK_ACCESS_SINGLE
);

275 
	`time
(&
now
);

278 
	`ho°ˇche_¥u√
(
d©a
->
dns
.
ho°ˇche
,

279 
d©a
->
£t
.
dns_ˇche_timeout
,

280 
now
);

282 if(
d©a
->
sh¨e
)

283 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_DNS
);

284 
	}
}

290 
	$ªmove_íåy_if_°Æe
(
Sessi⁄H™dÀ
 *
d©a
, 
Cuæ_dns_íåy
 *
dns
)

292 
ho°ˇche_¥u√_d©a
 
u£r
;

294 if(!
dns
 || (
d©a
->
£t
.
dns_ˇche_timeout
 =-1Ë|| !d©a->dns.
ho°ˇche
 ||

295 
dns
->
öu£
)

300 
	`time
(&
u£r
.
now
);

301 
u£r
.
ˇche_timeout
 = 
d©a
->
£t
.
dns_ˇche_timeout
;

303 if(!
	`ho°ˇche_time°amp_ªmove
(&
u£r
,
dns
) )

306 
	`Cuæ_hash_˛ón_wôh_¸ôîium
(
d©a
->
dns
.
ho°ˇche
,

307 (*Ë&
u£r
,

308 
ho°ˇche_time°amp_ªmove
);

311 
	}
}

314 #ifde‡
HAVE_SIGSETJMP


318 
sigjmp_buf
 
	gcuæ_jm≥nv
;

331 
Cuæ_dns_íåy
 *

332 
	$Cuæ_ˇche_addr
(
Sessi⁄H™dÀ
 *
d©a
,

333 
Cuæ_addröfo
 *
addr
,

334 c⁄° *
ho°«me
,

335 
p‹t
)

337 *
íåy_id
;

338 
size_t
 
íåy_Àn
;

339 
Cuæ_dns_íåy
 *
dns
;

340 
Cuæ_dns_íåy
 *
dns2
;

343 
íåy_id
 = 
	`¸óã_ho°ˇche_id
(
ho°«me
, 
p‹t
);

345 if(!
íåy_id
)

346  
NULL
;

347 
íåy_Àn
 = 
	`°æí
(
íåy_id
);

350 
dns
 = 
	`ˇŒoc
(1, (
Cuæ_dns_íåy
));

351 if(!
dns
) {

352 
	`‰ì
(
íåy_id
);

353  
NULL
;

356 
dns
->
öu£
 = 0;

357 
dns
->
addr
 =áddr;

358 
	`time
(&
dns
->
time°amp
);

359 if(
dns
->
time°amp
 == 0)

360 
dns
->
time°amp
 = 1;

363 
dns2
 = 
	`Cuæ_hash_add
(
d©a
->
dns
.
ho°ˇche
, 
íåy_id
, 
íåy_Àn
+1,

364 (*)
dns
);

365 if(!
dns2
) {

366 
	`‰ì
(
dns
);

367 
	`‰ì
(
íåy_id
);

368  
NULL
;

371 
dns
 = 
dns2
;

372 
dns
->
öu£
++;

375 
	`‰ì
(
íåy_id
);

377  
dns
;

378 
	}
}

401 
	$Cuæ_ªsﬁv
(
c⁄√˘d©a
 *
c⁄n
,

402 c⁄° *
ho°«me
,

403 
p‹t
,

404 
Cuæ_dns_íåy
 **
íåy
)

406 *
íåy_id
 = 
NULL
;

407 
Cuæ_dns_íåy
 *
dns
 = 
NULL
;

408 
size_t
 
íåy_Àn
;

409 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

410 
CURLcode
 
ªsu…
;

411 
rc
 = 
CURLRESOLV_ERROR
;

413 *
íåy
 = 
NULL
;

416 
íåy_id
 = 
	`¸óã_ho°ˇche_id
(
ho°«me
, 
p‹t
);

418 if(!
íåy_id
)

419  
rc
;

421 
íåy_Àn
 = 
	`°æí
(
íåy_id
);

423 if(
d©a
->
sh¨e
)

424 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_DNS
, 
CURL_LOCK_ACCESS_SINGLE
);

427 
dns
 = 
	`Cuæ_hash_pick
(
d©a
->dns.
ho°ˇche
, 
íåy_id
, 
íåy_Àn
+1);

430 
	`‰ì
(
íåy_id
);

432 
	`öfof
(
d©a
, "Ho°«mêwa†%sfound i¿DNS cache\n", 
dns
?"":"NOT ");

435 if(
	`ªmove_íåy_if_°Æe
(
d©a
, 
dns
)) {

436 
	`öfof
(
d©a
, "Hostname in DNS cache was stale, zapped\n");

437 
dns
 = 
NULL
;

440 if(
dns
) {

441 
dns
->
öu£
++;

442 
rc
 = 
CURLRESOLV_RESOLVED
;

445 if(
d©a
->
sh¨e
)

446 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_DNS
);

448 if(!
dns
) {

451 
Cuæ_addröfo
 *
addr
;

452 
ª•waô
;

456 if(!
	`Cuæ_ùvÆid
(
c⁄n
))

457  
CURLRESOLV_ERROR
;

462 
addr
 = 
	`Cuæ_gëaddröfo
(
c⁄n
,

463 #ifde‡
DEBUGBUILD


464 (
d©a
->
£t
.
°r
[
STRING_DEVICE
]

465 && !
	`°rcmp
(
d©a
->
£t
.
°r
[
STRING_DEVICE
],

468 
ho°«me
, 
p‹t
, &
ª•waô
);

470 if(!
addr
) {

471 if(
ª•waô
) {

475 
ªsu…
 = 
	`Cuæ_ªsﬁvî_is_ªsﬁved
(
c⁄n
, &
dns
);

476 if(
ªsu…
)

477  
CURLRESOLV_ERROR
;

478 if(
dns
)

479 
rc
 = 
CURLRESOLV_RESOLVED
;

481 
rc
 = 
CURLRESOLV_PENDING
;

485 if(
d©a
->
sh¨e
)

486 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_DNS
, 
CURL_LOCK_ACCESS_SINGLE
);

489 
dns
 = 
	`Cuæ_ˇche_addr
(
d©a
, 
addr
, 
ho°«me
, 
p‹t
);

491 if(
d©a
->
sh¨e
)

492 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_DNS
);

494 if(!
dns
)

496 
	`Cuæ_‰ìaddröfo
(
addr
);

498 
rc
 = 
CURLRESOLV_RESOLVED
;

502 *
íåy
 = 
dns
;

504  
rc
;

505 
	}
}

507 #ifde‡
USE_ALARM_TIMEOUT


514 
RETSIGTYPE
 
	$Æ¨mfunc
(
sig
)

517 ()
sig
;

518 
	`sigl⁄gjmp
(
cuæ_jm≥nv
, 1);

520 
	}
}

545 
	$Cuæ_ªsﬁv_timeout
(
c⁄√˘d©a
 *
c⁄n
,

546 c⁄° *
ho°«me
,

547 
p‹t
,

548 
Cuæ_dns_íåy
 **
íåy
,

549 
timeoutms
)

551 #ifde‡
USE_ALARM_TIMEOUT


552 #ifde‡
HAVE_SIGACTION


553 
siga˘i⁄
 
kìp_siga˘
;

554 vﬁ©ûê
boﬁ
 
kìp_c›ysig
 = 
FALSE
;

555 
siga˘i⁄
 
siga˘
;

557 #ifde‡
HAVE_SIGNAL


558 (*
kìp_siga˘
)();

561 vﬁ©ûê
timeout
;

562 vﬁ©ûê
¥ev_Æ¨m
 = 0;

563 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

565 
rc
;

567 *
íåy
 = 
NULL
;

569 if(
timeoutms
 < 0)

571  
CURLRESOLV_TIMEDOUT
;

573 #ifde‡
USE_ALARM_TIMEOUT


574 if(
d©a
->
£t
.
no_sig«l
)

576 
timeout
 = 0;

578 
timeout
 = 
timeoutms
;

580 if(!
timeout
)

582  
	`Cuæ_ªsﬁv
(
c⁄n
, 
ho°«me
, 
p‹t
, 
íåy
);

584 if(
timeout
 < 1000)

587  
CURLRESOLV_TIMEDOUT
;

593 #ifde‡
HAVE_SIGACTION


594 
	`siga˘i⁄
(
SIGALRM
, 
NULL
, &
siga˘
);

595 
kìp_siga˘
 = 
siga˘
;

596 
kìp_c›ysig
 = 
TRUE
;

597 
siga˘
.
ß_h™dÀr
 = 
Æ¨mfunc
;

598 #ifde‡
SA_RESTART


600 
siga˘
.
ß_Êags
 &~
SA_RESTART
;

603 
	`siga˘i⁄
(
SIGALRM
, &
siga˘
, 
NULL
);

606 #ifde‡
HAVE_SIGNAL


607 
kìp_siga˘
 = 
	`sig«l
(
SIGALRM
, 
Æ¨mfunc
);

613 
¥ev_Æ¨m
 = 
	`Æ¨m
(
	`cuæx_¶toui
(
timeout
/1000L));

621 if(
	`sig£tjmp
(
cuæ_jm≥nv
, 1)) {

623 
	`Áûf
(
d©a
, "nameÜookupÅimed out");

624 
rc
 = 
CURLRESOLV_ERROR
;

625 
˛ón_up
;

629 #i‚de‡
CURLRES_ASYNCH


630 if(
timeoutms
)

631 
	`öfof
(
c⁄n
->
d©a
, "timeout onÇameÜookup isÇot supported\n");

633 ()
timeoutms
;

640 
rc
 = 
	`Cuæ_ªsﬁv
(
c⁄n
, 
ho°«me
, 
p‹t
, 
íåy
);

642 #ifde‡
USE_ALARM_TIMEOUT


643 
˛ón_up
:

645 if(!
¥ev_Æ¨m
)

647 
	`Æ¨m
(0);

649 #ifde‡
HAVE_SIGACTION


650 if(
kìp_c›ysig
) {

653 
	`siga˘i⁄
(
SIGALRM
, &
kìp_siga˘
, 
NULL
);

656 #ifde‡
HAVE_SIGNAL


658 
	`sig«l
(
SIGALRM
, 
kìp_siga˘
);

664 if(
¥ev_Æ¨m
) {

666 
ñ≠£d_ms
 = 
	`Cuæ_tvdiff
(
	`Cuæ_tvnow
(), 
c⁄n
->
¸óãd
);

669 
Æ¨m_£t
 = 
¥ev_Æ¨m
 - 
ñ≠£d_ms
/1000;

671 if(!
Æ¨m_£t
 ||

672 ((
Æ¨m_£t
 >0x80000000Ë&& (
¥ev_Æ¨m
 < 0x80000000)) ) {

677 
	`Æ¨m
(1);

678 
rc
 = 
CURLRESOLV_TIMEDOUT
;

679 
	`Áûf
(
d©a
, "Previousálarm fired off!");

682 
	`Æ¨m
(()
Æ¨m_£t
);

686  
rc
;

687 
	}
}

696 
	$Cuæ_ªsﬁv_u∆ock
(
Sessi⁄H™dÀ
 *
d©a
, 
Cuæ_dns_íåy
 *
dns
)

698 
	`DEBUGASSERT
(
dns
 && (dns->
öu£
>0));

700 if(
d©a
 && d©a->
sh¨e
)

701 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_DNS
, 
CURL_LOCK_ACCESS_SINGLE
);

703 
dns
->
öu£
--;

706 if(
dns
->
öu£
 =0 && dns->
time°amp
 == 0) {

707 
	`Cuæ_‰ìaddröfo
(
dns
->
addr
);

708 
	`‰ì
(
dns
);

711 if(
d©a
 && d©a->
sh¨e
)

712 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_DNS
);

713 
	}
}

718 
	$‰ìdn£¡ry
(*
‰ìthis
)

720 
Cuæ_dns_íåy
 *
p
 = (Cuæ_dns_íåy *Ë
‰ìthis
;

723 
p
->
time°amp
 = 0;

724 if(
p
->
öu£
 == 0) {

725 
	`Cuæ_‰ìaddröfo
(
p
->
addr
);

726 
	`‰ì
(
p
);

728 
	}
}

733 
cuæ_hash
 *
	$Cuæ_mk_dnsˇche
()

735  
	`Cuæ_hash_Æloc
(7, 
Cuæ_hash_°r
, 
Cuæ_°r_key_com∑ª
, 
‰ìdn£¡ry
);

736 
	}
}

738 
	$ho°ˇche_öu£
(*
d©a
, *
hc
)

740 
Cuæ_dns_íåy
 *
c
 = (Cuæ_dns_íåy *Ë
hc
;

742 if(
c
->
öu£
 == 1)

743 
	`Cuæ_ªsﬁv_u∆ock
(
d©a
, 
c
);

746 
	}
}

755 
	$Cuæ_ho°ˇche_˛ón
(
Sessi⁄H™dÀ
 *
d©a
,

756 
cuæ_hash
 *
hash
)

762 
	`Cuæ_hash_˛ón_wôh_¸ôîium
(
hash
, 
d©a
, 
ho°ˇche_öu£
);

763 
	}
}

766 
CURLcode
 
	$Cuæ_lﬂdho°∑ús
(
Sessi⁄H™dÀ
 *
d©a
)

768 
cuæ_¶i°
 *
ho°p
;

769 
ho°«me
[256];

770 
addªss
[256];

771 
p‹t
;

773 
ho°p
 = 
d©a
->
ch™ge
.
ªsﬁve
; ho°p; ho°∞ho°p->
√xt
 ) {

774 if(!
ho°p
->
d©a
)

776 if(
ho°p
->
d©a
[0] == '-') {

779 if(3 =
	`ssˇnf
(
ho°p
->
d©a
, "%255[^:]:%d:%255s", 
ho°«me
, &
p‹t
,

780 
addªss
)) {

781 
Cuæ_dns_íåy
 *
dns
;

782 
Cuæ_addröfo
 *
addr
;

783 *
íåy_id
;

784 
size_t
 
íåy_Àn
;

786 
addr
 = 
	`Cuæ_°r2addr
(
addªss
, 
p‹t
);

787 if(!
addr
) {

788 
	`öfof
(
d©a
, "Resﬁvê%†found iŒegÆ!\n", 
ho°p
->data);

793 
íåy_id
 = 
	`¸óã_ho°ˇche_id
(
ho°«me
, 
p‹t
);

795 if(!
íåy_id
) {

796 
	`Cuæ_‰ìaddröfo
(
addr
);

797  
CURLE_OUT_OF_MEMORY
;

800 
íåy_Àn
 = 
	`°æí
(
íåy_id
);

802 if(
d©a
->
sh¨e
)

803 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_DNS
, 
CURL_LOCK_ACCESS_SINGLE
);

806 
dns
 = 
	`Cuæ_hash_pick
(
d©a
->dns.
ho°ˇche
, 
íåy_id
, 
íåy_Àn
+1);

809 
	`‰ì
(
íåy_id
);

811 if(!
dns
)

813 
dns
 = 
	`Cuæ_ˇche_addr
(
d©a
, 
addr
, 
ho°«me
, 
p‹t
);

816 
	`Cuæ_‰ìaddröfo
(
addr
);

818 if(
d©a
->
sh¨e
)

819 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_DNS
);

821 if(!
dns
) {

822 
	`Cuæ_‰ìaddröfo
(
addr
);

823  
CURLE_OUT_OF_MEMORY
;

825 
	`öfof
(
d©a
, "Added %s:%d:%sÅo DNS cache\n",

826 
ho°«me
, 
p‹t
, 
addªss
);

829 
d©a
->
ch™ge
.
ªsﬁve
 = 
NULL
;

831  
CURLE_OK
;

832 
	}
}

	@lib/hostip.h

1 #i‚de‡
HEADER_CURL_HOSTIP_H


2 
	#HEADER_CURL_HOSTIP_H


	)

25 
	~"cuæ_£tup.h
"

26 
	~"hash.h
"

27 
	~"cuæ_addröfo.h
"

28 
	~"asyn.h
"

30 #ifde‡
HAVE_SETJMP_H


31 
	~<£tjmp.h
>

34 #ifde‡
NETWARE


35 #unde‡
ö_addr_t


36 
	#ö_addr_t
 

	)

44 
	#CURL_HOSTENT_SIZE
 9000

	)

46 
	#CURL_TIMEOUT_RESOLVE
 300

	)

49 
	#CURL_ASYNC_SUCCESS
 
CURLE_OK


	)

51 
	gaddröfo
;

52 
	gho°ít
;

53 
	gSessi⁄H™dÀ
;

54 
	gc⁄√˘d©a
;

63 
cuæ_hash
 *
Cuæ_globÆ_ho°_ˇche_öô
();

64 
Cuæ_globÆ_ho°_ˇche_dt‹
();

66 
	sCuæ_dns_íåy
 {

67 
Cuæ_addröfo
 *
	maddr
;

70 
time_t
 
	mtime°amp
;

71 
	möu£
;

83 
	#CURLRESOLV_TIMEDOUT
 -2

	)

84 
	#CURLRESOLV_ERROR
 -1

	)

85 
	#CURLRESOLV_RESOLVED
 0

	)

86 
	#CURLRESOLV_PENDING
 1

	)

87 
Cuæ_ªsﬁv
(
c⁄√˘d©a
 *
c⁄n
, c⁄° *
ho°«me
,

88 
p‹t
, 
Cuæ_dns_íåy
 **
dn£¡ry
);

89 
Cuæ_ªsﬁv_timeout
(
c⁄√˘d©a
 *
c⁄n
, c⁄° *
ho°«me
,

90 
p‹t
, 
Cuæ_dns_íåy
 **
dn£¡ry
,

91 
timeoutms
);

93 #ifde‡
CURLRES_IPV6


97 
boﬁ
 
Cuæ_ùv6w‹ks
();

99 
	#Cuæ_ùv6w‹ks
(Ë
FALSE


	)

106 
boﬁ
 
Cuæ_ùvÆid
(
c⁄√˘d©a
 *
c⁄n
);

115 
Cuæ_addröfo
 *
Cuæ_gëaddröfo
(
c⁄√˘d©a
 *
c⁄n
,

116 c⁄° *
ho°«me
,

117 
p‹t
,

118 *
waôp
);

122 
Cuæ_ªsﬁv_u∆ock
(
Sessi⁄H™dÀ
 *
d©a
,

123 
Cuæ_dns_íåy
 *
dns
);

126 
Cuæ_sˇn_ˇche_u£d
(*
u£r
, *
±r
);

129 
cuæ_hash
 *
Cuæ_mk_dnsˇche
();

132 
Cuæ_ho°ˇche_¥u√
(
Sessi⁄H™dÀ
 *
d©a
);

135 
Cuæ_num_addªs£s
 (c⁄° 
Cuæ_addröfo
 *
addr
);

137 #i‡
deföed
(
CURLDEBUG
Ë&& deföed(
HAVE_GETNAMEINFO
)

138 
cuæ_dogë«meöfo
(
GETNAMEINFO_QUAL_ARG1
 
GETNAMEINFO_TYPE_ARG1
 
ß
,

139 
GETNAMEINFO_TYPE_ARG2
 
ßÀn
,

140 *
ho°
, 
GETNAMEINFO_TYPE_ARG46
 
ho°Àn
,

141 *
£rv
, 
GETNAMEINFO_TYPE_ARG46
 
£rvÀn
,

142 
GETNAMEINFO_TYPE_ARG7
 
Êags
,

143 
löe
, c⁄° *
sour˚
);

147 
Cuæ_addröfo
 *
Cuæ_ùv4_ªsﬁve_r
(c⁄° * 
ho°«me
, 
p‹t
);

149 
CURLcode
 
Cuæ_async_ªsﬁved
(
c⁄√˘d©a
 *
c⁄n
,

150 
boﬁ
 *
¥Ÿocﬁ_c⁄√˘
);

152 #i‚de‡
CURLRES_ASYNCH


153 
	#Cuæ_async_ªsﬁved
(
x
,
y
Ë
CURLE_OK


	)

162 
CURLcode
 
Cuæ_addröfo_ˇŒback
(
c⁄√˘d©a
 *
c⁄n
,

163 
°©us
,

164 
Cuæ_addröfo
 *
ai
);

171 c⁄° *
Cuæ_¥öèbÀ_addªss
(c⁄° 
Cuæ_addröfo
 *
ù
,

172 *
buf
, 
size_t
 
bufsize
);

179 
Cuæ_dns_íåy
 *

180 
Cuæ_ˇche_addr
(
Sessi⁄H™dÀ
 *
d©a
, 
Cuæ_addröfo
 *
addr
,

181 c⁄° *
ho°«me
, 
p‹t
);

183 #i‚de‡
INADDR_NONE


184 
	#CURL_INADDR_NONE
 (
ö_addr_t
Ë~0

	)

186 
	#CURL_INADDR_NONE
 
INADDR_NONE


	)

189 #ifde‡
HAVE_SIGSETJMP


195 
sigjmp_buf
 
cuæ_jm≥nv
;

201 
CURLcode
 
Cuæ_£t_dns_£rvîs
(
Sessi⁄H™dÀ
 *
d©a
, *
£rvîs
);

207 
CURLcode
 
Cuæ_£t_dns_öãrÁ˚
(
Sessi⁄H™dÀ
 *
d©a
,

208 c⁄° *
öãrf
);

214 
CURLcode
 
Cuæ_£t_dns_loˇl_ù4
(
Sessi⁄H™dÀ
 *
d©a
,

215 c⁄° *
loˇl_ù4
);

221 
CURLcode
 
Cuæ_£t_dns_loˇl_ù6
(
Sessi⁄H™dÀ
 *
d©a
,

222 c⁄° *
loˇl_ù6
);

227 
Cuæ_ho°ˇche_˛ón
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_hash
 *
hash
);

232 
Cuæ_ho°ˇche_de°roy
(
Sessi⁄H™dÀ
 *
d©a
);

237 
CURLcode
 
Cuæ_lﬂdho°∑ús
(
Sessi⁄H™dÀ
 *
d©a
);

	@lib/hostip4.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_NETINET_IN_H


26 
	~<√töë/ö.h
>

28 #ifde‡
HAVE_NETDB_H


29 
	~<√tdb.h
>

31 #ifde‡
HAVE_ARPA_INET_H


32 
	~<¨∑/öë.h
>

34 #ifde‡
__VMS


35 
	~<ö.h
>

36 
	~<öë.h
>

39 #ifde‡
HAVE_PROCESS_H


40 
	~<¥o˚ss.h
>

43 
	~"uæd©a.h
"

44 
	~"£ndf.h
"

45 
	~"ho°ù.h
"

46 
	~"hash.h
"

47 
	~"sh¨e.h
"

48 
	~"°ªº‹.h
"

49 
	~"uæ.h
"

50 
	~"öë_±⁄.h
"

52 
	#_MPRINTF_REPLACE


	)

53 
	~<cuæ/m¥ötf.h
>

55 
	~"cuæ_mem‹y.h
"

57 
	~"memdebug.h
"

62 #ifde‡
CURLRES_IPV4


67 
boﬁ
 
	$Cuæ_ùvÆid
(
c⁄√˘d©a
 *
c⁄n
)

69 if(
c⁄n
->
ù_vîsi⁄
 =
CURL_IPRESOLVE_V6
)

71  
FALSE
;

73  
TRUE
;

74 
	}
}

76 #ifde‡
CURLRES_SYNCH


94 
Cuæ_addröfo
 *
	$Cuæ_gëaddröfo
(
c⁄√˘d©a
 *
c⁄n
,

95 c⁄° *
ho°«me
,

96 
p‹t
,

97 *
waôp
)

99 
Cuæ_addröfo
 *
ai
 = 
NULL
;

101 #ifde‡
CURL_DISABLE_VERBOSE_STRINGS


102 ()
c⁄n
;

105 *
waôp
 = 0;

107 
ai
 = 
	`Cuæ_ùv4_ªsﬁve_r
(
ho°«me
, 
p‹t
);

108 if(!
ai
)

109 
	`öfof
(
c⁄n
->
d©a
, "Cuæ_ùv4_ªsﬁve_∏Áûed f‹ %s\n", 
ho°«me
);

111  
ai
;

112 
	}
}

116 #i‡
deföed
(
CURLRES_IPV4
Ë&& !deföed(
CURLRES_ARES
)

125 
Cuæ_addröfo
 *
	$Cuæ_ùv4_ªsﬁve_r
(c⁄° *
ho°«me
,

126 
p‹t
)

128 #i‡!
	`deföed
(
HAVE_GETADDRINFO_THREADSAFE
Ë&& deföed(
HAVE_GETHOSTBYNAME_R_3
)

129 
ªs
;

131 
Cuæ_addröfo
 *
ai
 = 
NULL
;

132 
ho°ít
 *
h
 = 
NULL
;

133 
ö_addr
 
ö
;

134 
ho°ít
 *
buf
 = 
NULL
;

136 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
ho°«me
, &
ö
) > 0)

138  
	`Cuæ_ù2addr
(
AF_INET
, &
ö
, 
ho°«me
, 
p‹t
);

140 #i‡
	`deföed
(
HAVE_GETADDRINFO_THREADSAFE
)

142 
addröfo
 
höts
;

143 
sbuf
[12];

144 *
sbuÂå
 = 
NULL
;

146 
	`mem£t
(&
höts
, 0, (hints));

147 
höts
.
ai_Ámûy
 = 
PF_INET
;

148 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

149 if(
p‹t
) {

150 
	`¢¥ötf
(
sbuf
, (sbuf), "%d", 
p‹t
);

151 
sbuÂå
 = 
sbuf
;

154 ()
	`Cuæ_gëaddröfo_ex
(
ho°«me
, 
sbuÂå
, &
höts
, &
ai
);

156 #ñi‡
	`deföed
(
HAVE_GETHOSTBYNAME_R
)

163 
h_î∫›
;

165 
buf
 = 
	`ˇŒoc
(1, 
CURL_HOSTENT_SIZE
);

166 if(!
buf
)

167  
NULL
;

174 #i‡
	`deföed
(
HAVE_GETHOSTBYNAME_R_5
)

176 
h
 = 
	`gëho°by«me_r
(
ho°«me
,

177 (
ho°ít
 *)
buf
,

178 (*)
buf
 + (
ho°ít
),

179 
CURL_HOSTENT_SIZE
 - (
ho°ít
),

180 &
h_î∫›
);

188 if(
h
) {

192 #ñi‡
	`deföed
(
HAVE_GETHOSTBYNAME_R_6
)

195 ()
	`gëho°by«me_r
(
ho°«me
,

196 (
ho°ít
 *)
buf
,

197 (*)
buf
 + (
ho°ít
),

198 
CURL_HOSTENT_SIZE
 - (
ho°ít
),

199 &
h
,

200 &
h_î∫›
);

232 if(!
h
)

233 #ñi‡
	`deföed
(
HAVE_GETHOSTBYNAME_R_3
)

254 if(
CURL_HOSTENT_SIZE
 >=

255 ((
ho°ít
)+(
ho°ít_d©a
))) {

262 
ªs
 = 
	`gëho°by«me_r
(
ho°«me
,

263 (
ho°ít
 *)
buf
,

264 (
ho°ít_d©a
 *)((*)
buf
 +

265 (
ho°ít
)));

266 
h_î∫›
 = 
SOCKERRNO
;

269 
ªs
 = -1;

271 if(!
ªs
) {

273 
h
 = 
buf
;

287 
h
 = 
NULL
;

288 
	`‰ì
(
buf
);

297 
h
 = 
	`gëho°by«me
((*)
ho°«me
);

301 if(
h
) {

302 
ai
 = 
	`Cuæ_he2ai
(
h
, 
p‹t
);

304 if(
buf
)

305 
	`‰ì
(
buf
);

308  
ai
;

309 
	}
}

	@lib/hostip6.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_NETINET_IN_H


26 
	~<√töë/ö.h
>

28 #ifde‡
HAVE_NETDB_H


29 
	~<√tdb.h
>

31 #ifde‡
HAVE_ARPA_INET_H


32 
	~<¨∑/öë.h
>

34 #ifde‡
__VMS


35 
	~<ö.h
>

36 
	~<öë.h
>

39 #ifde‡
HAVE_PROCESS_H


40 
	~<¥o˚ss.h
>

43 
	~"uæd©a.h
"

44 
	~"£ndf.h
"

45 
	~"ho°ù.h
"

46 
	~"hash.h
"

47 
	~"sh¨e.h
"

48 
	~"°ªº‹.h
"

49 
	~"uæ.h
"

50 
	~"öë_±⁄.h
"

51 
	~"c⁄√˘.h
"

53 
	#_MPRINTF_REPLACE


	)

54 
	~<cuæ/m¥ötf.h
>

56 
	~"cuæ_mem‹y.h
"

58 
	~"memdebug.h
"

63 #ifde‡
CURLRES_IPV6


66 #i‡
deföed
(
CURLDEBUG
Ë&& deföed(
HAVE_GETNAMEINFO
)

77 
	$cuæ_dogë«meöfo
(
GETNAMEINFO_QUAL_ARG1
 
GETNAMEINFO_TYPE_ARG1
 
ß
,

78 
GETNAMEINFO_TYPE_ARG2
 
ßÀn
,

79 *
ho°
, 
GETNAMEINFO_TYPE_ARG46
 
ho°Àn
,

80 *
£rv
, 
GETNAMEINFO_TYPE_ARG46
 
£rvÀn
,

81 
GETNAMEINFO_TYPE_ARG7
 
Êags
,

82 
löe
, c⁄° *
sour˚
)

84 
ªs
 = (
gë«meöfo
)(
ß
, 
ßÀn
,

85 
ho°
, 
ho°Àn
,

86 
£rv
, 
£rvÀn
,

87 
Êags
);

88 if(0 =
ªs
)

90 
	`cuæ_memlog
("GETNAME %s:%d getnameinfo()\n",

91 
sour˚
, 
löe
);

93 
	`cuæ_memlog
("GETNAME %s:%d getnameinfo() failed = %d\n",

94 
sour˚
, 
löe
, 
ªs
);

95  
ªs
;

96 
	}
}

102 
boﬁ
 
	$Cuæ_ùv6w‹ks
()

107 
ùv6_w‹ks
 = -1;

108 if(-1 =
ùv6_w‹ks
) {

110 
cuæ_sockë_t
 
s
 = 
	`sockë
(
PF_INET6
, 
SOCK_DGRAM
, 0);

111 if(
s
 =
CURL_SOCKET_BAD
)

113 
ùv6_w‹ks
 = 0;

115 
ùv6_w‹ks
 = 1;

116 
	`Cuæ_˛o£sockë
(
NULL
, 
s
);

119  (
ùv6_w‹ks
>0)?
TRUE
:
FALSE
;

120 
	}
}

126 
boﬁ
 
	$Cuæ_ùvÆid
(
c⁄√˘d©a
 *
c⁄n
)

128 if(
c⁄n
->
ù_vîsi⁄
 =
CURL_IPRESOLVE_V6
)

129  
	`Cuæ_ùv6w‹ks
();

130  
TRUE
;

131 
	}
}

133 #i‡
deföed
(
CURLRES_SYNCH
)

135 #ifde‡
DEBUG_ADDRINFO


136 
	$dump_addröfo
(
c⁄√˘d©a
 *
c⁄n
, c⁄° 
Cuæ_addröfo
 *
ai
)

138 
	`¥ötf
("dump_addrinfo:\n");

139 ; 
ai
;áòai->
ai_√xt
) {

140 
buf
[
INET6_ADDRSTRLEN
];

142 
	`¥ötf
(" fam %2d, CNAME %s, ",

143 
ai
->
ai_Ámûy
,ái->
ai_ˇn⁄«me
 ?ái->ai_canonname : "<none>");

144 if(
	`Cuæ_¥öèbÀ_addªss
(
ai
, 
buf
, (buf)))

145 
	`¥ötf
("%s\n", 
buf
);

147 
	`¥ötf
("Áûed; %s\n", 
	`Cuæ_°ªº‹
(
c⁄n
, 
SOCKERRNO
));

149 
	}
}

151 
	#dump_addröfo
(
x
,
y
Ë
Cuæ_n›_°mt


	)

163 
Cuæ_addröfo
 *
	$Cuæ_gëaddröfo
(
c⁄√˘d©a
 *
c⁄n
,

164 c⁄° *
ho°«me
,

165 
p‹t
,

166 *
waôp
)

168 
addröfo
 
höts
;

169 
Cuæ_addröfo
 *
ªs
;

170 
îr‹
;

171 
sbuf
[12];

172 *
sbuÂå
 = 
NULL
;

173 
addrbuf
[128];

174 
pf
;

175 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

177 *
waôp
 = 0;

182 
c⁄n
->
ù_vîsi⁄
) {

183 
CURL_IPRESOLVE_V4
:

184 
pf
 = 
PF_INET
;

186 
CURL_IPRESOLVE_V6
:

187 
pf
 = 
PF_INET6
;

190 
pf
 = 
PF_UNSPEC
;

194 if((
pf
 !
PF_INET
Ë&& !
	`Cuæ_ùv6w‹ks
())

196 
pf
 = 
PF_INET
;

198 
	`mem£t
(&
höts
, 0, (hints));

199 
höts
.
ai_Ámûy
 = 
pf
;

200 
höts
.
ai_sockty≥
 = 
c⁄n
->
sockty≥
;

202 if((1 =
	`Cuæ_öë_±⁄
(
AF_INET
, 
ho°«me
, 
addrbuf
)) ||

203 (1 =
	`Cuæ_öë_±⁄
(
AF_INET6
, 
ho°«me
, 
addrbuf
))) {

205 
höts
.
ai_Êags
 = 
AI_NUMERICHOST
;

208 if(
p‹t
) {

209 
	`¢¥ötf
(
sbuf
, (sbuf), "%d", 
p‹t
);

210 
sbuÂå
=
sbuf
;

212 
îr‹
 = 
	`Cuæ_gëaddröfo_ex
(
ho°«me
, 
sbuÂå
, &
höts
, &
ªs
);

213 if(
îr‹
) {

214 
	`öfof
(
d©a
, "gëaddröfo(3ËÁûed f‹ %s:%d\n", 
ho°«me
, 
p‹t
);

215  
NULL
;

218 
	`dump_addröfo
(
c⁄n
, 
ªs
);

220  
ªs
;

221 
	}
}

	@lib/hostsyn.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_NETINET_IN_H


26 
	~<√töë/ö.h
>

28 #ifde‡
HAVE_NETDB_H


29 
	~<√tdb.h
>

31 #ifde‡
HAVE_ARPA_INET_H


32 
	~<¨∑/öë.h
>

34 #ifde‡
__VMS


35 
	~<ö.h
>

36 
	~<öë.h
>

39 #ifde‡
HAVE_PROCESS_H


40 
	~<¥o˚ss.h
>

43 
	~"uæd©a.h
"

44 
	~"£ndf.h
"

45 
	~"ho°ù.h
"

46 
	~"hash.h
"

47 
	~"sh¨e.h
"

48 
	~"°ªº‹.h
"

49 
	~"uæ.h
"

51 
	#_MPRINTF_REPLACE


	)

52 
	~<cuæ/m¥ötf.h
>

54 
	~"cuæ_mem‹y.h
"

56 
	~"memdebug.h
"

61 #ifde‡
CURLRES_SYNCH


66 
CURLcode
 
	$Cuæ_£t_dns_£rvîs
(
Sessi⁄H™dÀ
 *
d©a
,

67 *
£rvîs
)

69 ()
d©a
;

70 ()
£rvîs
;

71  
CURLE_NOT_BUILT_IN
;

73 
	}
}

79 
CURLcode
 
	$Cuæ_£t_dns_öãrÁ˚
(
Sessi⁄H™dÀ
 *
d©a
,

80 c⁄° *
öãrf
)

82 ()
d©a
;

83 ()
öãrf
;

84  
CURLE_NOT_BUILT_IN
;

85 
	}
}

91 
CURLcode
 
	$Cuæ_£t_dns_loˇl_ù4
(
Sessi⁄H™dÀ
 *
d©a
,

92 c⁄° *
loˇl_ù4
)

94 ()
d©a
;

95 ()
loˇl_ù4
;

96  
CURLE_NOT_BUILT_IN
;

97 
	}
}

103 
CURLcode
 
	$Cuæ_£t_dns_loˇl_ù6
(
Sessi⁄H™dÀ
 *
d©a
,

104 c⁄° *
loˇl_ù6
)

106 ()
d©a
;

107 ()
loˇl_ù6
;

108  
CURLE_NOT_BUILT_IN
;

109 
	}
}

	@lib/http.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_HTTP


27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

31 #ifde‡
HAVE_NETDB_H


32 
	~<√tdb.h
>

34 #ifde‡
HAVE_ARPA_INET_H


35 
	~<¨∑/öë.h
>

37 #ifde‡
HAVE_NET_IF_H


38 
	~<√t/if.h
>

40 #ifde‡
HAVE_SYS_IOCTL_H


41 
	~<sys/io˘l.h
>

44 #ifde‡
HAVE_SYS_PARAM_H


45 
	~<sys/∑øm.h
>

48 
	~"uæd©a.h
"

49 
	~<cuæ/cuæ.h
>

50 
	~"å™s„r.h
"

51 
	~"£ndf.h
"

52 
	~"f‹md©a.h
"

53 
	~"¥ogªss.h
"

54 
	~"cuæ_ba£64.h
"

55 
	~"cookõ.h
"

56 
	~"°ªquÆ.h
"

57 
	~"vés/vés.h
"

58 
	~"hâp_dige°.h
"

59 
	~"cuæ_¡lm.h
"

60 
	~"cuæ_¡lm_wb.h
"

61 
	~"hâp_√gŸüã.h
"

62 
	~"uæ.h
"

63 
	~"sh¨e.h
"

64 
	~"ho°ù.h
"

65 
	~"hâp.h
"

66 
	~"cuæ_mem‹y.h
"

67 
	~"£À˘.h
"

68 
	~"∑r£d©e.h
"

69 
	~"°πoof·.h
"

70 
	~"mu…iif.h
"

71 
	~"øw°r.h
"

72 
	~"c⁄ã¡_ícodög.h
"

73 
	~"hâp_¥oxy.h
"

74 
	~"w¨∆ess.h
"

75 
	~"n⁄-ascii.h
"

76 
	~"bundÀs.h
"

77 
	~"pùñöe.h
"

78 
	~"hâp2.h
"

79 
	~"c⁄√˘.h
"

81 
	#_MPRINTF_REPLACE


	)

82 
	~<cuæ/m¥ötf.h
>

85 
	~"memdebug.h
"

91 
hâp_gësock_do
(
c⁄√˘d©a
 *
c⁄n
,

92 
cuæ_sockë_t
 *
socks
,

93 
numsocks
);

94 
hâp_should_Áû
(
c⁄√˘d©a
 *
c⁄n
);

96 #ifde‡
USE_SSL


97 
CURLcode
 
hâps_c⁄√˘ög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

98 
hâps_gësock
(
c⁄√˘d©a
 *
c⁄n
,

99 
cuæ_sockë_t
 *
socks
,

100 
numsocks
);

102 
	#hâps_c⁄√˘ög
(
x
,
y
Ë
CURLE_COULDNT_CONNECT


	)

108 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_hâp
 = {

110 
Cuæ_hâp_£tup_c⁄n
,

111 
Cuæ_hâp
,

112 
Cuæ_hâp_d⁄e
,

113 
ZERO_NULL
,

114 
Cuæ_hâp_c⁄√˘
,

115 
ZERO_NULL
,

116 
ZERO_NULL
,

117 
ZERO_NULL
,

118 
hâp_gësock_do
,

119 
ZERO_NULL
,

120 
ZERO_NULL
,

121 
ZERO_NULL
,

122 
ZERO_NULL
,

123 
PORT_HTTP
,

124 
CURLPROTO_HTTP
,

125 
PROTOPT_CREDSPERREQUEST


128 #ifde‡
USE_SSL


132 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_hâps
 = {

134 
Cuæ_hâp_£tup_c⁄n
,

135 
Cuæ_hâp
,

136 
Cuæ_hâp_d⁄e
,

137 
ZERO_NULL
,

138 
Cuæ_hâp_c⁄√˘
,

139 
hâps_c⁄√˘ög
,

140 
ZERO_NULL
,

141 
hâps_gësock
,

142 
hâp_gësock_do
,

143 
ZERO_NULL
,

144 
ZERO_NULL
,

145 
ZERO_NULL
,

146 
ZERO_NULL
,

147 
PORT_HTTPS
,

148 
CURLPROTO_HTTPS
,

149 
PROTOPT_SSL
 | 
PROTOPT_CREDSPERREQUEST


154 
CURLcode
 
	$Cuæ_hâp_£tup_c⁄n
(
c⁄√˘d©a
 *
c⁄n
)

158 
	`DEBUGASSERT
(
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
 =
NULL
);

160 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
 = 
	`ˇŒoc
(1, (
HTTP
));

161 if(!
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
)

162  
CURLE_OUT_OF_MEMORY
;

164  
CURLE_OK
;

165 
	}
}

173 *
	$Cuæ_checkhódîs
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

174 c⁄° *
thishódî
)

176 
cuæ_¶i°
 *
hód
;

177 
size_t
 
thi¶í
 = 
	`°æí
(
thishódî
);

178 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

180 
hód
 = 
d©a
->
£t
.
hódîs
;hód; hód=hód->
√xt
) {

181 if(
	`Cuæ_øw_√quÆ
(
hód
->
d©a
, 
thishódî
, 
thi¶í
))

182  
hód
->
d©a
;

184  
NULL
;

185 
	}
}

197 *
	$Cuæ_checkProxyhódîs
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

198 c⁄° *
thishódî
)

200 
cuæ_¶i°
 *
hód
;

201 
size_t
 
thi¶í
 = 
	`°æí
(
thishódî
);

202 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

204 
hód
 = (
c⁄n
->
bôs
.
¥oxy
 && 
d©a
->
£t
.
£p_hódîs
)?

205 
d©a
->
£t
.
¥oxyhódîs
:d©a->£t.
hódîs
;

206 
hód
; hód=hód->
√xt
) {

207 if(
	`Cuæ_øw_√quÆ
(
hód
->
d©a
, 
thishódî
, 
thi¶í
))

208  
hód
->
d©a
;

210  
NULL
;

211 
	}
}

219 *
	$Cuæ_c›y_hódî_vÆue
(c⁄° *
hódî
)

221 c⁄° *
°¨t
;

222 c⁄° *
íd
;

223 *
vÆue
;

224 
size_t
 
Àn
;

226 
	`DEBUGASSERT
(
hódî
);

229 *
hódî
 && (*header != ':'))

230 ++
hódî
;

232 if(*
hódî
)

234 ++
hódî
;

237 
°¨t
 = 
hódî
;

238 *
°¨t
 && 
	`ISSPACE
(*start))

239 
°¨t
++;

243 
íd
 = 
	`°rchr
(
°¨t
, '\r');

244 if(!
íd
)

245 
íd
 = 
	`°rchr
(
°¨t
, '\n');

246 if(!
íd
)

247 
íd
 = 
	`°rchr
(
°¨t
, '\0');

248 if(!
íd
)

249  
NULL
;

252 (
íd
 > 
°¨t
Ë&& 
	`ISSPACE
(*end))

253 
íd
--;

256 
Àn
 = 
íd
 - 
°¨t
 + 1;

258 
vÆue
 = 
	`mÆloc
(
Àn
 + 1);

259 if(!
vÆue
)

260  
NULL
;

262 
	`mem˝y
(
vÆue
, 
°¨t
, 
Àn
);

263 
vÆue
[
Àn
] = 0;

265  
vÆue
;

266 
	}
}

274 
CURLcode
 
	$hâp_ouçut_basic
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
)

276 
size_t
 
size
 = 0;

277 *
auth‹iz©i⁄
 = 
NULL
;

278 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

279 **
u£Ω
;

280 c⁄° *
u£r
;

281 c⁄° *
pwd
;

282 
CURLcode
 
îr‹
;

284 if(
¥oxy
) {

285 
u£Ω
 = &
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
;

286 
u£r
 = 
c⁄n
->
¥oxyu£r
;

287 
pwd
 = 
c⁄n
->
¥oxy∑sswd
;

290 
u£Ω
 = &
c⁄n
->
Ælo˝å
.
u£Ωwd
;

291 
u£r
 = 
c⁄n
->user;

292 
pwd
 = 
c⁄n
->
∑sswd
;

295 
	`¢¥ötf
(
d©a
->
°©e
.
buf„r
, (d©a->°©e.buf„r), "%s:%s", 
u£r
, 
pwd
);

297 
îr‹
 = 
	`Cuæ_ba£64_ícode
(
d©a
,

298 
d©a
->
°©e
.
buf„r
, 
	`°æí
(data->state.buffer),

299 &
auth‹iz©i⁄
, &
size
);

300 if(
îr‹
)

301  
îr‹
;

303 if(!
auth‹iz©i⁄
)

304  
CURLE_REMOTE_ACCESS_DENIED
;

306 
	`Cuæ_ß„‰ì
(*
u£Ω
);

307 *
u£Ω
 = 
	`≠rötf
("%sAuthorization: Basic %s\r\n",

308 
¥oxy
?"Proxy-":"",

309 
auth‹iz©i⁄
);

310 
	`‰ì
(
auth‹iz©i⁄
);

311 if(!*
u£Ω
)

312  
CURLE_OUT_OF_MEMORY
;

314  
CURLE_OK
;

315 
	}
}

322 
boﬁ
 
	$pick⁄óuth
(
auth
 *
pick
)

324 
boﬁ
 
picked
;

326 
avaû
 = 
pick
->avaû &Öick->
w™t
;

327 
picked
 = 
TRUE
;

331 if(
avaû
 & 
CURLAUTH_GSSNEGOTIATE
)

332 
pick
->
picked
 = 
CURLAUTH_GSSNEGOTIATE
;

333 if(
avaû
 & 
CURLAUTH_DIGEST
)

334 
pick
->
picked
 = 
CURLAUTH_DIGEST
;

335 if(
avaû
 & 
CURLAUTH_NTLM
)

336 
pick
->
picked
 = 
CURLAUTH_NTLM
;

337 if(
avaû
 & 
CURLAUTH_NTLM_WB
)

338 
pick
->
picked
 = 
CURLAUTH_NTLM_WB
;

339 if(
avaû
 & 
CURLAUTH_BASIC
)

340 
pick
->
picked
 = 
CURLAUTH_BASIC
;

342 
pick
->
picked
 = 
CURLAUTH_PICKNONE
;

343 
picked
 = 
FALSE
;

345 
pick
->
avaû
 = 
CURLAUTH_NONE
;

347  
picked
;

348 
	}
}

373 
CURLcode
 
	$hâp_≥rh≠§ewöd
(
c⁄√˘d©a
 *
c⁄n
)

375 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

376 
HTTP
 *
hâp
 = 
d©a
->
ªq
.
¥Ÿ›
;

377 
cuæ_off_t
 
byãs£¡
;

378 
cuæ_off_t
 
ex≥˘£nd
 = -1;

380 if(!
hâp
)

383  
CURLE_OK
;

385 
d©a
->
£t
.
hâ¥eq
) {

386 
HTTPREQ_GET
:

387 
HTTPREQ_HEAD
:

388  
CURLE_OK
;

393 
byãs£¡
 = 
hâp
->
wrôebyãcou¡
;

395 if(
c⁄n
->
bôs
.
auth√g
)

398 
ex≥˘£nd
 = 0;

401 
d©a
->
£t
.
hâ¥eq
) {

402 
HTTPREQ_POST
:

403 if(
d©a
->
£t
.
po°fõldsize
 != -1)

404 
ex≥˘£nd
 = 
d©a
->
£t
.
po°fõldsize
;

405 if(
d©a
->
£t
.
po°fõlds
)

406 
ex≥˘£nd
 = (
cuæ_off_t
)
	`°æí
(
d©a
->
£t
.
po°fõlds
);

408 
HTTPREQ_PUT
:

409 if(
d©a
->
°©e
.
öfûesize
 != -1)

410 
ex≥˘£nd
 = 
d©a
->
°©e
.
öfûesize
;

412 
HTTPREQ_POST_FORM
:

413 
ex≥˘£nd
 = 
hâp
->
po°size
;

420 
c⁄n
->
bôs
.
ªwöda·î£nd
 = 
FALSE
;

422 if((
ex≥˘£nd
 =-1Ë|| (ex≥˘£nd > 
byãs£¡
)) {

424 if((
d©a
->
°©e
.
auth¥oxy
.
picked
 =
CURLAUTH_NTLM
) ||

425 (
d©a
->
°©e
.
authho°
.
picked
 =
CURLAUTH_NTLM
) ||

426 (
d©a
->
°©e
.
auth¥oxy
.
picked
 =
CURLAUTH_NTLM_WB
) ||

427 (
d©a
->
°©e
.
authho°
.
picked
 =
CURLAUTH_NTLM_WB
)) {

428 if(((
ex≥˘£nd
 - 
byãs£¡
) < 2000) ||

429 (
c⁄n
->
¡lm
.
°©e
 !
NTLMSTATE_NONE
) ||

430 (
c⁄n
->
¥oxy¡lm
.
°©e
 !
NTLMSTATE_NONE
)) {

435 if(!
c⁄n
->
bôs
.
auth√g
) {

436 
c⁄n
->
bôs
.
ªwöda·î£nd
 = 
TRUE
;

437 
	`öfof
(
d©a
, "Rewind streamáfter send\n");

440  
CURLE_OK
;

442 if(
c⁄n
->
bôs
.
˛o£
)

444  
CURLE_OK
;

446 
	`öfof
(
d©a
, "NTLM send, close instead of sending %"

447 
CURL_FORMAT_CURL_OFF_T
 " bytes\n",

448 (
cuæ_off_t
)(
ex≥˘£nd
 - 
byãs£¡
));

453 
	`c⁄n˛o£
(
c⁄n
, "Mid-auth HTTPánd much dataÜeftÅo send");

454 
d©a
->
ªq
.
size
 = 0;

460 if(
byãs£¡
)

462  
	`Cuæ_ªadªwöd
(
c⁄n
);

464  
CURLE_OK
;

465 
	}
}

474 
CURLcode
 
	$Cuæ_hâp_auth_a˘
(
c⁄√˘d©a
 *
c⁄n
)

476 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

477 
boﬁ
 
pickho°
 = 
FALSE
;

478 
boﬁ
 
pick¥oxy
 = 
FALSE
;

479 
CURLcode
 
code
 = 
CURLE_OK
;

481 if(100 <
d©a
->
ªq
.
hâpcode
 && 199 >= data->req.httpcode)

483  
CURLE_OK
;

485 if(
d©a
->
°©e
.
auth¥obÀm
)

486  
d©a
->
£t
.
hâp_Áû_⁄_îr‹
?
CURLE_HTTP_RETURNED_ERROR
:
CURLE_OK
;

488 if(
c⁄n
->
bôs
.
u£r_∑sswd
 &&

489 ((
d©a
->
ªq
.
hâpcode
 == 401) ||

490 (
c⁄n
->
bôs
.
auth√g
 && 
d©a
->
ªq
.
hâpcode
 < 300))) {

491 
pickho°
 = 
	`pick⁄óuth
(&
d©a
->
°©e
.
authho°
);

492 if(!
pickho°
)

493 
d©a
->
°©e
.
auth¥obÀm
 = 
TRUE
;

495 if(
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
 &&

496 ((
d©a
->
ªq
.
hâpcode
 == 407) ||

497 (
c⁄n
->
bôs
.
auth√g
 && 
d©a
->
ªq
.
hâpcode
 < 300))) {

498 
pick¥oxy
 = 
	`pick⁄óuth
(&
d©a
->
°©e
.
auth¥oxy
);

499 if(!
pick¥oxy
)

500 
d©a
->
°©e
.
auth¥obÀm
 = 
TRUE
;

503 if(
pickho°
 || 
pick¥oxy
) {

507 
	`Cuæ_ß„‰ì
(
d©a
->
ªq
.
√wuæ
);

508 
d©a
->
ªq
.
√wuæ
 = 
	`°rdup
(d©a->
ch™ge
.
uæ
);

509 if(!
d©a
->
ªq
.
√wuæ
)

510  
CURLE_OUT_OF_MEMORY
;

512 if((
d©a
->
£t
.
hâ¥eq
 !
HTTPREQ_GET
) &&

513 (
d©a
->
£t
.
hâ¥eq
 !
HTTPREQ_HEAD
) &&

514 !
c⁄n
->
bôs
.
ªwöda·î£nd
) {

515 
code
 = 
	`hâp_≥rh≠§ewöd
(
c⁄n
);

516 if(
code
)

517  
code
;

521 if((
d©a
->
ªq
.
hâpcode
 < 300) &&

522 (!
d©a
->
°©e
.
authho°
.
d⁄e
) &&

523 
c⁄n
->
bôs
.
auth√g
) {

528 if((
d©a
->
£t
.
hâ¥eq
 !
HTTPREQ_GET
) &&

529 (
d©a
->
£t
.
hâ¥eq
 !
HTTPREQ_HEAD
)) {

530 
d©a
->
ªq
.
√wuæ
 = 
	`°rdup
(d©a->
ch™ge
.
uæ
);

531 if(!
d©a
->
ªq
.
√wuæ
)

532  
CURLE_OUT_OF_MEMORY
;

533 
d©a
->
°©e
.
authho°
.
d⁄e
 = 
TRUE
;

536 if(
	`hâp_should_Áû
(
c⁄n
)) {

537 
	`Áûf
 (
d©a
, "TheÑequested URLÑeturnedÉrror: %d",

538 
d©a
->
ªq
.
hâpcode
);

539 
code
 = 
CURLE_HTTP_RETURNED_ERROR
;

542  
code
;

543 
	}
}

550 
CURLcode


551 
	$ouçut_auth_hódîs
(
c⁄√˘d©a
 *
c⁄n
,

552 
auth
 *
auth°©us
,

553 c⁄° *
ªque°
,

554 c⁄° *
∑th
,

555 
boﬁ
 
¥oxy
)

557 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

558 c⁄° *
auth
=
NULL
;

559 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

560 #ifde‡
USE_HTTP_NEGOTIATE


561 
√gŸüãd©a
 *
√gd©a
 = 
¥oxy
?

562 &
d©a
->
°©e
.
¥oxy√g
:&d©a->°©e.
√gŸüã
;

565 #ifde‡
CURL_DISABLE_CRYPTO_AUTH


566 ()
ªque°
;

567 ()
∑th
;

570 #ifde‡
USE_HTTP_NEGOTIATE


571 
√gd©a
->
°©e
 = 
GSS_AUTHNONE
;

572 if((
auth°©us
->
picked
 =
CURLAUTH_GSSNEGOTIATE
) &&

573 
√gd©a
->
c⁄ãxt
 && !
	`GSS_ERROR
“egd©a->
°©us
)) {

574 
auth
="GSS-Negotiate";

575 
ªsu…
 = 
	`Cuæ_ouçut_√gŸüã
(
c⁄n
, 
¥oxy
);

576 if(
ªsu…
)

577  
ªsu…
;

578 
auth°©us
->
d⁄e
 = 
TRUE
;

579 
√gd©a
->
°©e
 = 
GSS_AUTHSENT
;

583 #ifde‡
USE_NTLM


584 if(
auth°©us
->
picked
 =
CURLAUTH_NTLM
) {

585 
auth
="NTLM";

586 
ªsu…
 = 
	`Cuæ_ouçut_¡lm
(
c⁄n
, 
¥oxy
);

587 if(
ªsu…
)

588  
ªsu…
;

592 #i‡
	`deföed
(
USE_NTLM
Ë&& deföed(
NTLM_WB_ENABLED
)

593 if(
auth°©us
->
picked
 =
CURLAUTH_NTLM_WB
) {

594 
auth
="NTLM_WB";

595 
ªsu…
 = 
	`Cuæ_ouçut_¡lm_wb
(
c⁄n
, 
¥oxy
);

596 if(
ªsu…
)

597  
ªsu…
;

601 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


602 if(
auth°©us
->
picked
 =
CURLAUTH_DIGEST
) {

603 
auth
="Digest";

604 
ªsu…
 = 
	`Cuæ_ouçut_dige°
(
c⁄n
,

605 
¥oxy
,

606 (c⁄° *)
ªque°
,

607 (c⁄° *)
∑th
);

608 if(
ªsu…
)

609  
ªsu…
;

613 if(
auth°©us
->
picked
 =
CURLAUTH_BASIC
) {

615 if((
¥oxy
 && 
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
 &&

616 !
	`Cuæ_checkProxyhódîs
(
c⁄n
, "Proxy-authorization:")) ||

617 (!
¥oxy
 && 
c⁄n
->
bôs
.
u£r_∑sswd
 &&

618 !
	`Cuæ_checkhódîs
(
c⁄n
, "Authorization:"))) {

619 
auth
="Basic";

620 
ªsu…
 = 
	`hâp_ouçut_basic
(
c⁄n
, 
¥oxy
);

621 if(
ªsu…
)

622  
ªsu…
;

626 
auth°©us
->
d⁄e
 = 
TRUE
;

629 if(
auth
) {

630 
	`öfof
(
d©a
, "%sáuth using %s with user '%s'\n",

631 
¥oxy
?"Proxy":"Sîvî", 
auth
,

632 
¥oxy
?(
c⁄n
->
¥oxyu£r
?conn->proxyuser:""):

633 (
c⁄n
->
u£r
?conn->user:""));

634 
auth°©us
->
mu…i
 = (!auth°©us->
d⁄e
Ë? 
TRUE
 : 
FALSE
;

637 
auth°©us
->
mu…i
 = 
FALSE
;

639  
CURLE_OK
;

640 
	}
}

656 
CURLcode


657 
	$Cuæ_hâp_ouçut_auth
(
c⁄√˘d©a
 *
c⁄n
,

658 c⁄° *
ªque°
,

659 c⁄° *
∑th
,

660 
boﬁ
 
¥oxytu¬ñ
)

663 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

664 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

665 
auth
 *
authho°
;

666 
auth
 *
auth¥oxy
;

668 
	`DEBUGASSERT
(
d©a
);

670 
authho°
 = &
d©a
->
°©e
.authhost;

671 
auth¥oxy
 = &
d©a
->
°©e
.authproxy;

673 if((
c⁄n
->
bôs
.
hâµroxy
 && c⁄n->bôs.
¥oxy_u£r_∑sswd
) ||

674 
c⁄n
->
bôs
.
u£r_∑sswd
)

677 
authho°
->
d⁄e
 = 
TRUE
;

678 
auth¥oxy
->
d⁄e
 = 
TRUE
;

679  
CURLE_OK
;

682 if(
authho°
->
w™t
 && !authho°->
picked
)

686 
authho°
->
picked
 =áuthho°->
w™t
;

688 if(
auth¥oxy
->
w™t
 && !auth¥oxy->
picked
)

692 
auth¥oxy
->
picked
 =áuth¥oxy->
w™t
;

694 #i‚de‡
CURL_DISABLE_PROXY


696 if(
c⁄n
->
bôs
.
hâµroxy
 &&

697 (
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 =
¥oxytu¬ñ
)) {

698 
ªsu…
 = 
	`ouçut_auth_hódîs
(
c⁄n
, 
auth¥oxy
, 
ªque°
, 
∑th
, 
TRUE
);

699 if(
ªsu…
)

700  
ªsu…
;

704 ()
¥oxytu¬ñ
;

708 
auth¥oxy
->
d⁄e
 = 
TRUE
;

712 if(!
d©a
->
°©e
.
this_is_a_fﬁlow
 ||

713 
c⁄n
->
bôs
.
√åc
 ||

714 !
d©a
->
°©e
.
fú°_ho°
 ||

715 
d©a
->
£t
.
hâp_dißbÀ_ho°«me_check_bef‹e_authítiˇti⁄
 ||

716 
	`Cuæ_øw_equÆ
(
d©a
->
°©e
.
fú°_ho°
, 
c⁄n
->
ho°
.
«me
)) {

717 
ªsu…
 = 
	`ouçut_auth_hódîs
(
c⁄n
, 
authho°
, 
ªque°
, 
∑th
, 
FALSE
);

720 
authho°
->
d⁄e
 = 
TRUE
;

722  
ªsu…
;

723 
	}
}

732 
CURLcode
 
	$Cuæ_hâp_öput_auth
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
,

733 c⁄° *
auth
)

738 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

740 *
avaûp
;

741 
auth
 *
authp
;

743 if(
¥oxy
) {

744 
avaûp
 = &
d©a
->
öfo
.
¥oxyauthavaû
;

745 
authp
 = &
d©a
->
°©e
.
auth¥oxy
;

748 
avaûp
 = &
d©a
->
öfo
.
hâ∑uthavaû
;

749 
authp
 = &
d©a
->
°©e
.
authho°
;

769 *
auth
) {

770 #ifde‡
USE_HTTP_NEGOTIATE


771 if(
	`check¥efix
("GSS-NegŸüã", 
auth
) ||

772 
	`check¥efix
("NegŸüã", 
auth
)) {

773 
√g
;

774 *
avaûp
 |
CURLAUTH_GSSNEGOTIATE
;

775 
authp
->
avaû
 |
CURLAUTH_GSSNEGOTIATE
;

777 if(
authp
->
picked
 =
CURLAUTH_GSSNEGOTIATE
) {

778 if(
d©a
->
°©e
.
√gŸüã
.°©ê=
GSS_AUTHSENT
) {

781 
	`öfof
(
d©a
, "AuthenticationÖroblem. IgnoringÅhis.\n");

782 
d©a
->
°©e
.
auth¥obÀm
 = 
TRUE
;

784 if(
d©a
->
°©e
.
√gŸüã
.°©ê=
GSS_AUTHNONE
) {

785 
√g
 = 
	`Cuæ_öput_√gŸüã
(
c⁄n
, 
¥oxy
, 
auth
);

786 if(
√g
 == 0) {

787 
	`DEBUGASSERT
(!
d©a
->
ªq
.
√wuæ
);

788 
d©a
->
ªq
.
√wuæ
 = 
	`°rdup
(d©a->
ch™ge
.
uæ
);

789 if(!
d©a
->
ªq
.
√wuæ
)

790  
CURLE_OUT_OF_MEMORY
;

791 
d©a
->
°©e
.
auth¥obÀm
 = 
FALSE
;

793 
d©a
->
°©e
.
√gŸüã
.°©ê
GSS_AUTHRECV
;

796 
d©a
->
°©e
.
auth¥obÀm
 = 
TRUE
;

802 #ifde‡
USE_NTLM


804 if(
	`check¥efix
("NTLM", 
auth
)) {

805 *
avaûp
 |
CURLAUTH_NTLM
;

806 
authp
->
avaû
 |
CURLAUTH_NTLM
;

807 if(
authp
->
picked
 =
CURLAUTH_NTLM
 ||

808 
authp
->
picked
 =
CURLAUTH_NTLM_WB
) {

810 
CURLcode
 
¡lm
 =

811 
	`Cuæ_öput_¡lm
(
c⁄n
, 
¥oxy
, 
auth
);

812 if(
CURLE_OK
 =
¡lm
) {

813 
d©a
->
°©e
.
auth¥obÀm
 = 
FALSE
;

814 #ifde‡
NTLM_WB_ENABLED


815 if(
authp
->
picked
 =
CURLAUTH_NTLM_WB
) {

816 *
avaûp
 &~
CURLAUTH_NTLM
;

817 
authp
->
avaû
 &~
CURLAUTH_NTLM
;

818 *
avaûp
 |
CURLAUTH_NTLM_WB
;

819 
authp
->
avaû
 |
CURLAUTH_NTLM_WB
;

823 *
auth
 && 
	`ISSPACE
(*auth))

824 
auth
++;

825 if(
	`check¥efix
("NTLM", 
auth
)) {

826 
auth
 +
	`°æí
("NTLM");

827 *
auth
 && 
	`ISSPACE
(*auth))

828 
auth
++;

829 if(*
auth
)

830 if((
c⁄n
->
chÆÀnge_hódî
 = 
	`°rdup
(
auth
)Ë=
NULL
)

831  
CURLE_OUT_OF_MEMORY
;

837 
	`öfof
(
d©a
, "AuthenticationÖroblem. IgnoringÅhis.\n");

838 
d©a
->
°©e
.
auth¥obÀm
 = 
TRUE
;

844 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


845 if(
	`check¥efix
("Dige°", 
auth
)) {

846 if((
authp
->
avaû
 & 
CURLAUTH_DIGEST
) != 0) {

847 
	`öfof
(
d©a
, "Ignoring duplicate digestáuth header.\n");

850 
CURLdige°
 
dig
;

851 *
avaûp
 |
CURLAUTH_DIGEST
;

852 
authp
->
avaû
 |
CURLAUTH_DIGEST
;

858 
dig
 = 
	`Cuæ_öput_dige°
(
c⁄n
, 
¥oxy
, 
auth
);

860 if(
CURLDIGEST_FINE
 !
dig
) {

861 
	`öfof
(
d©a
, "AuthenticationÖroblem. IgnoringÅhis.\n");

862 
d©a
->
°©e
.
auth¥obÀm
 = 
TRUE
;

868 if(
	`check¥efix
("Basic", 
auth
)) {

869 *
avaûp
 |
CURLAUTH_BASIC
;

870 
authp
->
avaû
 |
CURLAUTH_BASIC
;

871 if(
authp
->
picked
 =
CURLAUTH_BASIC
) {

875 
authp
->
avaû
 = 
CURLAUTH_NONE
;

876 
	`öfof
(
d©a
, "AuthenticationÖroblem. IgnoringÅhis.\n");

877 
d©a
->
°©e
.
auth¥obÀm
 = 
TRUE
;

882 *
auth
 && *auth != ',')

883 
auth
++;

884 if(*
auth
 == ',')

885 
auth
++;

886 *
auth
 && 
	`ISSPACE
(*auth))

887 
auth
++;

889  
CURLE_OK
;

890 
	}
}

902 
	$hâp_should_Áû
(
c⁄√˘d©a
 *
c⁄n
)

904 
Sessi⁄H™dÀ
 *
d©a
;

905 
hâpcode
;

907 
	`DEBUGASSERT
(
c⁄n
);

908 
d©a
 = 
c⁄n
->data;

909 
	`DEBUGASSERT
(
d©a
);

911 
hâpcode
 = 
d©a
->
ªq
.httpcode;

917 if(!
d©a
->
£t
.
hâp_Áû_⁄_îr‹
)

923 if(
hâpcode
 < 400)

926 if(
d©a
->
°©e
.
ªsume_‰om
 &&

927 (
d©a
->
£t
.
hâ¥eq
==
HTTPREQ_GET
) &&

928 (
hâpcode
 == 416)) {

938 if((
hâpcode
 != 401) &&

939 (
hâpcode
 != 407))

945 
	`DEBUGASSERT
((
hâpcode
 == 401) || (httpcode == 407));

965 if((
hâpcode
 =401Ë&& !
c⁄n
->
bôs
.
u£r_∑sswd
)

966  
TRUE
;

967 if((
hâpcode
 =407Ë&& !
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
)

968  
TRUE
;

970  
d©a
->
°©e
.
auth¥obÀm
;

971 
	}
}

981 
size_t
 
	$ªadm‹ed©a
(*
buf„r
,

982 
size_t
 
size
,

983 
size_t
 
nôems
,

984 *
u£Ω
)

986 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

987 
HTTP
 *
hâp
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

988 
size_t
 
fuŒsize
 = 
size
 * 
nôems
;

990 if(0 =
hâp
->
po°size
)

995 
c⁄n
->
d©a
->
ªq
.
f‹bidchunk
 = (
hâp
->
£ndög
 =
HTTPSEND_REQUEST
)?
TRUE
:
FALSE
;

997 if(
hâp
->
po°size
 <(
cuæ_off_t
)
fuŒsize
) {

998 
	`mem˝y
(
buf„r
, 
hâp
->
po°d©a
, (
size_t
)hâp->
po°size
);

999 
fuŒsize
 = (
size_t
)
hâp
->
po°size
;

1001 if(
hâp
->
backup
.
po°size
) {

1003 
hâp
->
po°d©a
 = hâp->
backup
.postdata;

1004 
hâp
->
po°size
 = hâp->
backup
.postsize;

1005 
c⁄n
->
‰ód_func
 = 
hâp
->
backup
.fread_func;

1006 
c⁄n
->
‰ód_ö
 = 
hâp
->
backup
.fread_in;

1008 
hâp
->
£ndög
++;

1010 
hâp
->
backup
.
po°size
=0;

1013 
hâp
->
po°size
 = 0;

1015  
fuŒsize
;

1018 
	`mem˝y
(
buf„r
, 
hâp
->
po°d©a
, 
fuŒsize
);

1019 
hâp
->
po°d©a
 +
fuŒsize
;

1020 
hâp
->
po°size
 -
fuŒsize
;

1022  
fuŒsize
;

1023 
	}
}

1031 
Cuæ_£nd_buf„r
 *
	$Cuæ_add_buf„r_öô
()

1033  
	`ˇŒoc
(1, (
Cuæ_£nd_buf„r
));

1034 
	}
}

1042 
CURLcode
 
	$Cuæ_add_buf„r_£nd
(
Cuæ_£nd_buf„r
 *
ö
,

1043 
c⁄√˘d©a
 *
c⁄n
,

1047 *
byãs_wrôãn
,

1050 
size_t
 
ö˛uded_body_byãs
,

1051 
sockëödex
)

1054 
ssize_t
 
amou¡
;

1055 
CURLcode
 
ªs
;

1056 *
±r
;

1057 
size_t
 
size
;

1058 
HTTP
 *
hâp
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

1059 
size_t
 
£ndsize
;

1060 
cuæ_sockë_t
 
sockfd
;

1061 
size_t
 
hódîsize
;

1063 
	`DEBUGASSERT
(
sockëödex
 <
SECONDARYSOCKET
);

1065 
sockfd
 = 
c⁄n
->
sock
[
sockëödex
];

1070 
±r
 = 
ö
->
buf„r
;

1071 
size
 = 
ö
->
size_u£d
;

1073 
hódîsize
 = 
size
 - 
ö˛uded_body_byãs
;

1076 
	`DEBUGASSERT
(
size
 > 
ö˛uded_body_byãs
);

1078 
ªs
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
c⁄n
->
d©a
, 
±r
, 
hódîsize
);

1080 if(
ªs
) {

1082 if(
ö
->
buf„r
)

1083 
	`‰ì
(
ö
->
buf„r
);

1084 
	`‰ì
(
ö
);

1085  
ªs
;

1089 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
) {

1096 
£ndsize
(
size
 > 
CURL_MAX_WRITE_SIZE
)?CURL_MAX_WRITE_SIZE:size;

1104 
	`mem˝y
(
c⁄n
->
d©a
->
°©e
.
u∂ﬂdbuf„r
, 
±r
, 
£ndsize
);

1105 
±r
 = 
c⁄n
->
d©a
->
°©e
.
u∂ﬂdbuf„r
;

1108 
£ndsize
 = 
size
;

1110 
ªs
 = 
	`Cuæ_wrôe
(
c⁄n
, 
sockfd
, 
±r
, 
£ndsize
, &
amou¡
);

1112 if(
CURLE_OK
 =
ªs
) {

1119 
size_t
 
hódÀn
 = (size_t)
amou¡
>
hódîsize
?headersize:(size_t)amount;

1120 
size_t
 
bodyÀn
 = 
amou¡
 - 
hódÀn
;

1122 if(
c⁄n
->
d©a
->
£t
.
vîbo£
) {

1124 
	`Cuæ_debug
(
c⁄n
->
d©a
, 
CURLINFO_HEADER_OUT
, 
±r
, 
hódÀn
, conn);

1125 if(
bodyÀn
) {

1128 
	`Cuæ_debug
(
c⁄n
->
d©a
, 
CURLINFO_DATA_OUT
,

1129 
±r
+
hódÀn
, 
bodyÀn
, 
c⁄n
);

1132 if(
bodyÀn
)

1135 
hâp
->
wrôebyãcou¡
 +
bodyÀn
;

1140 *
byãs_wrôãn
 +()
amou¡
;

1142 if(
hâp
) {

1143 if((
size_t
)
amou¡
 !
size
) {

1148 
size
 -
amou¡
;

1150 
±r
 = 
ö
->
buf„r
 + 
amou¡
;

1153 
hâp
->
backup
.
‰ód_func
 = 
c⁄n
->fread_func;

1154 
hâp
->
backup
.
‰ód_ö
 = 
c⁄n
->fread_in;

1155 
hâp
->
backup
.
po°d©a
 = http->postdata;

1156 
hâp
->
backup
.
po°size
 = http->postsize;

1159 
c⁄n
->
‰ód_func
 = (
cuæ_ªad_ˇŒback
)
ªadm‹ed©a
;

1160 
c⁄n
->
‰ód_ö
 = (*)conn;

1161 
hâp
->
po°d©a
 = 
±r
;

1162 
hâp
->
po°size
 = (
cuæ_off_t
)
size
;

1164 
hâp
->
£nd_buf„r
 = 
ö
;

1165 
hâp
->
£ndög
 = 
HTTPSEND_REQUEST
;

1167  
CURLE_OK
;

1169 
hâp
->
£ndög
 = 
HTTPSEND_BODY
;

1173 if((
size_t
)
amou¡
 !
size
)

1181  
CURLE_SEND_ERROR
;

1183 
c⁄n
->
wrôech™√l_öu£
 = 
FALSE
;

1186 if(
ö
->
buf„r
)

1187 
	`‰ì
(
ö
->
buf„r
);

1188 
	`‰ì
(
ö
);

1190  
ªs
;

1191 
	}
}

1197 
CURLcode
 
	$Cuæ_add_buf„rf
(
Cuæ_£nd_buf„r
 *
ö
, c⁄° *
fmt
, ...)

1199 *
s
;

1200 
va_li°
 
≠
;

1201 
	`va_°¨t
(
≠
, 
fmt
);

1202 
s
 = 
	`v≠rötf
(
fmt
, 
≠
);

1203 
	`va_íd
(
≠
);

1205 if(
s
) {

1206 
CURLcode
 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ö
, 
s
, 
	`°æí
(s));

1207 
	`‰ì
(
s
);

1208  
ªsu…
;

1211 if(
ö
->
buf„r
)

1212 
	`‰ì
(
ö
->
buf„r
);

1213 
	`‰ì
(
ö
);

1214  
CURLE_OUT_OF_MEMORY
;

1215 
	}
}

1220 
CURLcode
 
	$Cuæ_add_buf„r
(
Cuæ_£nd_buf„r
 *
ö
, c⁄° *
ö±r
, 
size_t
 
size
)

1222 *
√w_rb
;

1223 
size_t
 
√w_size
;

1225 if(~
size
 < 
ö
->
size_u£d
) {

1229 
	`Cuæ_ß„‰ì
(
ö
->
buf„r
);

1230 
	`‰ì
(
ö
);

1231  
CURLE_OUT_OF_MEMORY
;

1234 if(!
ö
->
buf„r
 ||

1235 ((
ö
->
size_u£d
 + 
size
Ë> (ö->
size_max
 - 1))) {

1241 if((
size
 > (
size_t
)-1/2Ë|| (
ö
->
size_u£d
 > (size_t)-1/2) ||

1242 (~(
size
*2Ë< (
ö
->
size_u£d
*2)))

1243 
√w_size
 = (
size_t
)-1;

1245 
√w_size
 = (
ö
->
size_u£d
+
size
)*2;

1247 if(
ö
->
buf„r
)

1249 
√w_rb
 = 
	`ªÆloc
(
ö
->
buf„r
, 
√w_size
);

1252 
√w_rb
 = 
	`mÆloc
(
√w_size
);

1254 if(!
√w_rb
) {

1256 
	`Cuæ_ß„‰ì
(
ö
->
buf„r
);

1257 
	`‰ì
(
ö
);

1258  
CURLE_OUT_OF_MEMORY
;

1261 
ö
->
buf„r
 = 
√w_rb
;

1262 
ö
->
size_max
 = 
√w_size
;

1264 
	`mem˝y
(&
ö
->
buf„r
[ö->
size_u£d
], 
ö±r
, 
size
);

1266 
ö
->
size_u£d
 +
size
;

1268  
CURLE_OK
;

1269 
	}
}

1282 
boﬁ


1283 
	$Cuæ_com∑ªhódî
(c⁄° *
hódîlöe
,

1284 c⁄° *
hódî
,

1285 c⁄° *
c⁄ã¡
)

1292 
size_t
 
hÀn
 = 
	`°æí
(
hódî
);

1293 
size_t
 
˛í
;

1294 
size_t
 
Àn
;

1295 c⁄° *
°¨t
;

1296 c⁄° *
íd
;

1298 if(!
	`Cuæ_øw_√quÆ
(
hódîlöe
, 
hódî
, 
hÀn
))

1299  
FALSE
;

1302 
°¨t
 = &
hódîlöe
[
hÀn
];

1305 *
°¨t
 && 
	`ISSPACE
(*start))

1306 
°¨t
++;

1309 
íd
 = 
	`°rchr
(
°¨t
, '\r');

1310 if(!
íd
) {

1312 
íd
 = 
	`°rchr
(
°¨t
, '\n');

1314 if(!
íd
)

1316 
íd
 = 
	`°rchr
(
°¨t
, '\0');

1319 
Àn
 = 
íd
-
°¨t
;

1320 
˛í
 = 
	`°æí
(
c⁄ã¡
);

1323 ;
Àn
>=
˛í
;Àn--, 
°¨t
++) {

1324 if(
	`Cuæ_øw_√quÆ
(
°¨t
, 
c⁄ã¡
, 
˛í
))

1325  
TRUE
;

1328  
FALSE
;

1329 
	}
}

1335 
CURLcode
 
	$Cuæ_hâp_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1337 
CURLcode
 
ªsu…
;

1341 
	`c⁄nkìp
(
c⁄n
, "HTTP default");

1344 
ªsu…
 = 
	`Cuæ_¥oxy_c⁄√˘
(
c⁄n
);

1345 if(
ªsu…
)

1346  
ªsu…
;

1348 if(
c⁄n
->
tu¬ñ_°©e
[
FIRSTSOCKET
] =
TUNNEL_CONNECT
)

1350  
CURLE_OK
;

1352 if(
c⁄n
->
giví
->
Êags
 & 
PROTOPT_SSL
) {

1354 
ªsu…
 = 
	`hâps_c⁄√˘ög
(
c⁄n
, 
d⁄e
);

1355 if(
ªsu…
)

1356  
ªsu…
;

1359 *
d⁄e
 = 
TRUE
;

1361  
CURLE_OK
;

1362 
	}
}

1367 
	$hâp_gësock_do
(
c⁄√˘d©a
 *
c⁄n
,

1368 
cuæ_sockë_t
 *
socks
,

1369 
numsocks
)

1372 ()
numsocks
;

1373 
socks
[0] = 
c⁄n
->
sock
[
FIRSTSOCKET
];

1374  
	`GETSOCK_WRITESOCK
(0);

1375 
	}
}

1377 #ifde‡
USE_SSL


1378 
CURLcode
 
	$hâps_c⁄√˘ög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1380 
CURLcode
 
ªsu…
;

1381 
	`DEBUGASSERT
((
c⁄n
Ë&& (c⁄n->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
));

1384 
ªsu…
 = 
	`Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄n
, 
FIRSTSOCKET
, 
d⁄e
);

1385 if(
ªsu…
)

1386 
	`c⁄n˛o£
(
c⁄n
, "Failed HTTPS connection");

1388  
ªsu…
;

1389 
	}
}

1392 #i‡
deföed
(
USE_SSLEAY
Ë|| deföed(
USE_GNUTLS
Ë|| deföed(
USE_SCHANNEL
) || \

1393 
deföed
(
USE_DARWINSSL
Ë|| deföed(
USE_POLARSSL
Ë|| 
	$deföed
(
USE_NSS
)

1396 
	$hâps_gësock
(
c⁄√˘d©a
 *
c⁄n
,

1397 
cuæ_sockë_t
 *
socks
,

1398 
numsocks
)

1400 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
) {

1401 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
FIRSTSOCKET
];

1403 if(!
numsocks
)

1404  
GETSOCK_BLANK
;

1406 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_wrôög
) {

1408 
socks
[0] = 
c⁄n
->
sock
[
FIRSTSOCKET
];

1409  
	`GETSOCK_WRITESOCK
(0);

1411 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_ªadög
) {

1413 
socks
[0] = 
c⁄n
->
sock
[
FIRSTSOCKET
];

1414  
	`GETSOCK_READSOCK
(0);

1417  
CURLE_OK
;

1418 
	}
}

1420 #ifde‡
USE_SSL


1421 
	$hâps_gësock
(
c⁄√˘d©a
 *
c⁄n
,

1422 
cuæ_sockë_t
 *
socks
,

1423 
numsocks
)

1425 ()
c⁄n
;

1426 ()
socks
;

1427 ()
numsocks
;

1428  
GETSOCK_BLANK
;

1429 
	}
}

1438 
CURLcode
 
	$Cuæ_hâp_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

1439 
CURLcode
 
°©us
, 
boﬁ
 
¥em©uª
)

1441 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1442 
HTTP
 *
hâp
 =
d©a
->
ªq
.
¥Ÿ›
;

1444 
	`Cuæ_u√ncode_˛ónup
(
c⁄n
);

1447 
c⁄n
->
‰ód_func
 = 
d©a
->
£t
.fread_func;

1448 
c⁄n
->
‰ód_ö
 = 
d©a
->
£t
.
ö
;

1449 
c⁄n
->
£ek_func
 = 
d©a
->
£t
.seek_func;

1450 
c⁄n
->
£ek_˛õ¡
 = 
d©a
->
£t
.seek_client;

1452 if(
hâp
 =
NULL
)

1453  
CURLE_OK
;

1455 if(
hâp
->
£nd_buf„r
) {

1456 
Cuæ_£nd_buf„r
 *
buff
 = 
hâp
->
£nd_buf„r
;

1458 
	`‰ì
(
buff
->
buf„r
);

1459 
	`‰ì
(
buff
);

1460 
hâp
->
£nd_buf„r
 = 
NULL
;

1463 if(
HTTPREQ_POST_FORM
 =
d©a
->
£t
.
hâ¥eq
) {

1464 
d©a
->
ªq
.
byãcou¡
 = 
hâp
->
ªadbyãcou¡
 + hâp->
wrôebyãcou¡
;

1466 
	`Cuæ_f‹m˛ón
(&
hâp
->
£ndô
);

1467 if(
hâp
->
f‹m
.
Â
) {

1469 
	`f˛o£
(
hâp
->
f‹m
.
Â
);

1470 
hâp
->
f‹m
.
Â
 = 
NULL
;

1473 if(
HTTPREQ_PUT
 =
d©a
->
£t
.
hâ¥eq
)

1474 
d©a
->
ªq
.
byãcou¡
 = 
hâp
->
ªadbyãcou¡
 + hâp->
wrôebyãcou¡
;

1476 if(
°©us
 !
CURLE_OK
)

1477  (
°©us
);

1479 if(!
¥em©uª
 &&

1481 !
c⁄n
->
bôs
.
ªåy
 &&

1482 !
d©a
->
£t
.
c⁄√˘_⁄ly
 &&

1483 ((
hâp
->
ªadbyãcou¡
 +

1484 
d©a
->
ªq
.
hódîbyãcou¡
 -

1485 
d©a
->
ªq
.
dedu˘hódîcou¡
)) <= 0) {

1489 
	`Áûf
(
d©a
, "EmptyÑeply from server");

1490  
CURLE_GOT_NOTHING
;

1493  
CURLE_OK
;

1494 
	}
}

1506 
boﬁ
 
	$u£_hâp_1_1∂us
(c⁄° 
Sessi⁄H™dÀ
 *
d©a
,

1507 c⁄° 
c⁄√˘d©a
 *
c⁄n
)

1509  ((
d©a
->
£t
.
hâpvîsi⁄
 >
CURL_HTTP_VERSION_1_1
) ||

1510 ((
d©a
->
£t
.
hâpvîsi⁄
 !
CURL_HTTP_VERSION_1_0
) &&

1511 ((
c⁄n
->
hâpvîsi⁄
 == 11) ||

1512 ((
c⁄n
->
hâpvîsi⁄
 != 10) &&

1513 (
d©a
->
°©e
.
hâpvîsi⁄
 !10))))Ë? 
TRUE
 : 
FALSE
;

1514 
	}
}

1517 
CURLcode
 
	$ex≥˘100
(
Sessi⁄H™dÀ
 *
d©a
,

1518 
c⁄√˘d©a
 *
c⁄n
,

1519 
Cuæ_£nd_buf„r
 *
ªq_buf„r
)

1521 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1522 c⁄° *
±r
;

1523 
d©a
->
°©e
.
ex≥˘100hódî
 = 
FALSE
;

1525 if(
c⁄n
->
hâpvîsi⁄
 == 20) {

1527  
CURLE_OK
;

1529 if(
	`u£_hâp_1_1∂us
(
d©a
, 
c⁄n
)) {

1533 
±r
 = 
	`Cuæ_checkhódîs
(
c⁄n
, "Expect:");

1534 if(
±r
) {

1535 
d©a
->
°©e
.
ex≥˘100hódî
 =

1536 
	`Cuæ_com∑ªhódî
(
±r
, "Expect:", "100-continue");

1539 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

1541 if(
ªsu…
 =
CURLE_OK
)

1542 
d©a
->
°©e
.
ex≥˘100hódî
 = 
TRUE
;

1545  
ªsu…
;

1546 
	}
}

1548 
	e¥oxy_u£
 {

1549 
	mHEADER_SERVER
,

1550 
	mHEADER_PROXY
,

1551 
	mHEADER_CONNECT


1554 
CURLcode
 
	$Cuæ_add_cu°om_hódîs
(
c⁄√˘d©a
 *
c⁄n
,

1555 
boﬁ
 
is_c⁄√˘
,

1556 
Cuæ_£nd_buf„r
 *
ªq_buf„r
)

1558 *
±r
;

1559 
cuæ_¶i°
 *
h
[2];

1560 
cuæ_¶i°
 *
hódîs
;

1561 
numli°s
=1;

1562 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1563 
i
;

1565 
¥oxy_u£
 
¥oxy
;

1567 if(
is_c⁄√˘
)

1568 
¥oxy
 = 
HEADER_CONNECT
;

1570 
¥oxy
 = 
c⁄n
->
bôs
.
hâµroxy
 && !c⁄n->bôs.
tu¬ñ_¥oxy
?

1571 
HEADER_PROXY
:
HEADER_SERVER
;

1573 
¥oxy
) {

1574 
HEADER_SERVER
:

1575 
h
[0] = 
d©a
->
£t
.
hódîs
;

1577 
HEADER_PROXY
:

1578 
h
[0] = 
d©a
->
£t
.
hódîs
;

1579 if(
d©a
->
£t
.
£p_hódîs
) {

1580 
h
[1] = 
d©a
->
£t
.
¥oxyhódîs
;

1581 
numli°s
++;

1584 
HEADER_CONNECT
:

1585 if(
d©a
->
£t
.
£p_hódîs
)

1586 
h
[0] = 
d©a
->
£t
.
¥oxyhódîs
;

1588 
h
[0] = 
d©a
->
£t
.
hódîs
;

1593 
i
=0; i < 
numli°s
; i++) {

1594 
hódîs
 = 
h
[
i
];

1596 
hódîs
) {

1597 
±r
 = 
	`°rchr
(
hódîs
->
d©a
, ':');

1598 if(
±r
) {

1601 
±r
++;

1602 *
±r
 && 
	`ISSPACE
(*ptr))

1603 
±r
++;

1605 if(*
±r
) {

1608 if(
c⁄n
->
Ælo˝å
.
ho°
 &&

1611 
	`check¥efix
("Ho°:", 
hódîs
->
d©a
))

1613 if(
d©a
->
£t
.
hâ¥eq
 =
HTTPREQ_POST_FORM
 &&

1615 
	`check¥efix
("C⁄ã¡-Ty≥:", 
hódîs
->
d©a
))

1617 if(
c⁄n
->
bôs
.
auth√g
 &&

1620 
	`check¥efix
("C⁄ã¡-Lígth", 
hódîs
->
d©a
))

1622 if(
c⁄n
->
Ælo˝å
.
ã
 &&

1625 
	`check¥efix
("C⁄√˘i⁄", 
hódîs
->
d©a
))

1628 
CURLcode
 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "%s\r\n",

1629 
hódîs
->
d©a
);

1630 if(
ªsu…
)

1631  
ªsu…
;

1636 
±r
 = 
	`°rchr
(
hódîs
->
d©a
, ';');

1637 if(
±r
) {

1639 
±r
++;

1640 *
±r
 && 
	`ISSPACE
(*ptr))

1641 
±r
++;

1643 if(*
±r
) {

1647 if(*(--
±r
) == ';') {

1648 
CURLcode
 
ªsu…
;

1651 *
±r
 = ':';

1652 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "%s\r\n",

1653 
hódîs
->
d©a
);

1654 if(
ªsu…
)

1655  
ªsu…
;

1660 
hódîs
 = hódîs->
√xt
;

1663  
CURLE_OK
;

1664 
	}
}

1666 
CURLcode
 
	$Cuæ_add_timec⁄dôi⁄
(
Sessi⁄H™dÀ
 *
d©a
,

1667 
Cuæ_£nd_buf„r
 *
ªq_buf„r
)

1669 c⁄° 
tm
 *tm;

1670 *
buf
 = 
d©a
->
°©e
.
buf„r
;

1671 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1672 
tm
 
kì±ime
;

1674 
ªsu…
 = 
	`Cuæ_gmtime
(
d©a
->
£t
.
timevÆue
, &
kì±ime
);

1675 if(
ªsu…
) {

1676 
	`Áûf
(
d©a
, "Invalid TIMEVALUE");

1677  
ªsu…
;

1679 
tm
 = &
kì±ime
;

1689 
	`¢¥ötf
(
buf
, 
BUFSIZE
-1,

1691 
Cuæ_wkday
[
tm
->
tm_wday
?tm->tm_wday-1:6],

1692 
tm
->
tm_mday
,

1693 
Cuæ_m⁄th
[
tm
->
tm_m⁄
],

1694 
tm
->
tm_yór
 + 1900,

1695 
tm
->
tm_hour
,

1696 
tm
->
tm_mö
,

1697 
tm
->
tm_£c
);

1699 
d©a
->
£t
.
timec⁄dôi⁄
) {

1700 
CURL_TIMECOND_IFMODSINCE
:

1702 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

1703 "If-Modifõd-Sö˚: %s\r\n", 
buf
);

1705 
CURL_TIMECOND_IFUNMODSINCE
:

1706 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

1707 "If-Unmodifõd-Sö˚: %s\r\n", 
buf
);

1709 
CURL_TIMECOND_LASTMOD
:

1710 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

1711 "La°-Modifõd: %s\r\n", 
buf
);

1715  
ªsu…
;

1716 
	}
}

1723 
CURLcode
 
	$Cuæ_hâp
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1725 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

1726 
CURLcode
 
ªsu…
=
CURLE_OK
;

1727 
HTTP
 *
hâp
;

1728 c⁄° *
µ©h
 = 
d©a
->
°©e
.
∑th
;

1729 
boﬁ
 
∑°e_·p_u£Ωwd
 = 
FALSE
;

1730 
·p_ty≥code
[("/;type=?")] = "";

1731 c⁄° *
ho°
 = 
c⁄n
->ho°.
«me
;

1732 c⁄° *
ã
 = "";

1733 c⁄° *
±r
;

1734 c⁄° *
ªque°
;

1735 
Cuæ_HâpReq
 
hâ¥eq
 = 
d©a
->
£t
.httpreq;

1736 *
addcookõs
 = 
NULL
;

1737 
cuæ_off_t
 
ö˛uded_body
 = 0;

1738 c⁄° *
hâp°rög
;

1739 
Cuæ_£nd_buf„r
 *
ªq_buf„r
;

1740 
cuæ_off_t
 
po°size
 = 0;

1741 
£ekîr
 = 
CURL_SEEKFUNC_OK
;

1746 *
d⁄e
 = 
TRUE
;

1748 if(
c⁄n
->
hâpvîsi⁄
 < 20) {

1750 
c⁄n
->
√g≈n
) {

1751 
NPN_HTTP2
:

1752 
ªsu…
 = 
	`Cuæ_hâp2_öô
(
c⁄n
);

1753 if(
ªsu…
)

1754  
ªsu…
;

1756 
ªsu…
 = 
	`Cuæ_hâp2_£tup
(
c⁄n
);

1757 if(
ªsu…
)

1758  
ªsu…
;

1761 
	`Cuæ_hâp2_swôched
(
c⁄n
);

1763 
NPN_HTTP1_1
:

1773 
	`Cuæ_hâp2_£tup
(
c⁄n
);

1776 
hâp
 = 
d©a
->
ªq
.
¥Ÿ›
;

1778 if(!
d©a
->
°©e
.
this_is_a_fﬁlow
) {

1780 if(
d©a
->
°©e
.
fú°_ho°
)

1782 
	`‰ì
(
d©a
->
°©e
.
fú°_ho°
);

1784 
d©a
->
°©e
.
fú°_ho°
 = 
	`°rdup
(
c⁄n
->
ho°
.
«me
);

1785 if(!
d©a
->
°©e
.
fú°_ho°
)

1786  
CURLE_OUT_OF_MEMORY
;

1788 
hâp
->
wrôebyãcou¡
 = hâp->
ªadbyãcou¡
 = 0;

1790 if((
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&(
PROTO_FAMILY_HTTP
|
CURLPROTO_FTP
)) &&

1791 
d©a
->
£t
.
u∂ﬂd
) {

1792 
hâ¥eq
 = 
HTTPREQ_PUT
;

1796 if(
d©a
->
£t
.
°r
[
STRING_CUSTOMREQUEST
])

1797 
ªque°
 = 
d©a
->
£t
.
°r
[
STRING_CUSTOMREQUEST
];

1799 if(
d©a
->
£t
.
›t_no_body
)

1800 
ªque°
 = "HEAD";

1802 
	`DEBUGASSERT
((
hâ¥eq
 > 
HTTPREQ_NONE
Ë&& (hâ¥eq < 
HTTPREQ_LAST
));

1803 
hâ¥eq
) {

1804 
HTTPREQ_POST
:

1805 
HTTPREQ_POST_FORM
:

1806 
ªque°
 = "POST";

1808 
HTTPREQ_PUT
:

1809 
ªque°
 = "PUT";

1812 
HTTPREQ_GET
:

1813 
ªque°
 = "GET";

1815 
HTTPREQ_HEAD
:

1816 
ªque°
 = "HEAD";

1826 if(
	`Cuæ_checkhódîs
(
c⁄n
, "U£r-Agít:"Ë&& c⁄n->
Ælo˝å
.
uagít
) {

1827 
	`‰ì
(
c⁄n
->
Ælo˝å
.
uagít
);

1828 
c⁄n
->
Ælo˝å
.
uagít
=
NULL
;

1832 
ªsu…
 = 
	`Cuæ_hâp_ouçut_auth
(
c⁄n
, 
ªque°
, 
µ©h
, 
FALSE
);

1833 if(
ªsu…
)

1834  
ªsu…
;

1836 if((
d©a
->
°©e
.
authho°
.
mu…i
 || d©a->°©e.
auth¥oxy
.multi) &&

1837 (
hâ¥eq
 !
HTTPREQ_GET
) &&

1838 (
hâ¥eq
 !
HTTPREQ_HEAD
)) {

1841 
c⁄n
->
bôs
.
auth√g
 = 
TRUE
;

1844 
c⁄n
->
bôs
.
auth√g
 = 
FALSE
;

1846 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
ªf
);

1847 if(
d©a
->
ch™ge
.
ª„ªr
 && !
	`Cuæ_checkhódîs
(
c⁄n
, "Referer:")) {

1848 
c⁄n
->
Ælo˝å
.
ªf
 = 
	`≠rötf
("Re„ªr: %s\r\n", 
d©a
->
ch™ge
.
ª„ªr
);

1849 if(!
c⁄n
->
Ælo˝å
.
ªf
)

1850  
CURLE_OUT_OF_MEMORY
;

1853 
c⁄n
->
Ælo˝å
.
ªf
 = 
NULL
;

1855 if(
d©a
->
£t
.
°r
[
STRING_COOKIE
] && !
	`Cuæ_checkhódîs
(
c⁄n
, "Cookie:"))

1856 
addcookõs
 = 
d©a
->
£t
.
°r
[
STRING_COOKIE
];

1858 if(!
	`Cuæ_checkhódîs
(
c⁄n
, "Accept-Encoding:") &&

1859 
d©a
->
£t
.
°r
[
STRING_ENCODING
]) {

1860 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
ac˚±_ícodög
);

1861 
c⁄n
->
Ælo˝å
.
ac˚±_ícodög
 =

1862 
	`≠rötf
("Ac˚±-Encodög: %s\r\n", 
d©a
->
£t
.
°r
[
STRING_ENCODING
]);

1863 if(!
c⁄n
->
Ælo˝å
.
ac˚±_ícodög
)

1864  
CURLE_OUT_OF_MEMORY
;

1867 #ifde‡
HAVE_LIBZ


1870 if(!
	`Cuæ_checkhódîs
(
c⁄n
, "TE:") &&

1871 
d©a
->
£t
.
hâp_å™s„r_ícodög
) {

1877 *
˝å
 = 
	`Cuæ_checkhódîs
(
c⁄n
, "Connection:");

1878 
	#TE_HEADER
 "TE: gzù\r\n"

	)

1880 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
ã
);

1883 
c⁄n
->
Ælo˝å
.
ã
 = 
˝å
? 
	`≠rötf
("%s, TE\r\n" 
TE_HEADER
, cptr):

1884 
	`°rdup
("C⁄√˘i⁄: TE\r\n" 
TE_HEADER
);

1886 if(!
c⁄n
->
Ælo˝å
.
ã
)

1887  
CURLE_OUT_OF_MEMORY
;

1891 if(
c⁄n
->
hâpvîsi⁄
 == 20)

1893 
±r
 = 
NULL
;

1895 
±r
 = 
	`Cuæ_checkhódîs
(
c⁄n
, "Transfer-Encoding:");

1896 if(
±r
) {

1898 
d©a
->
ªq
.
u∂ﬂd_chunky
 =

1899 
	`Cuæ_com∑ªhódî
(
±r
, "Transfer-Encoding:", "chunked");

1902 if((
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&
PROTO_FAMILY_HTTP
) &&

1903 
d©a
->
£t
.
u∂ﬂd
 &&

1904 (
d©a
->
°©e
.
öfûesize
 == -1)) {

1905 if(
c⁄n
->
bôs
.
auth√g
)

1908 if(
	`u£_hâp_1_1∂us
(
d©a
, 
c⁄n
)) {

1910 
d©a
->
ªq
.
u∂ﬂd_chunky
 = 
TRUE
;

1913 
	`Áûf
(
d©a
, "Chunky upload isÇot supported by HTTP 1.0");

1914  
CURLE_UPLOAD_FAILED
;

1919 
d©a
->
ªq
.
u∂ﬂd_chunky
 = 
FALSE
;

1922 if(
d©a
->
ªq
.
u∂ﬂd_chunky
)

1923 
ã
 = "Transfer-Encoding: chunked\r\n";

1927 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
ho°
);

1929 
±r
 = 
	`Cuæ_checkhódîs
(
c⁄n
, "Host:");

1930 if(
±r
 && (!
d©a
->
°©e
.
this_is_a_fﬁlow
 ||

1931 
	`Cuæ_øw_equÆ
(
d©a
->
°©e
.
fú°_ho°
, 
c⁄n
->
ho°
.
«me
))) {

1932 #i‡!
	`deföed
(
CURL_DISABLE_COOKIES
)

1938 *
cookõho°
 = 
	`Cuæ_c›y_hódî_vÆue
(
±r
);

1939 if(!
cookõho°
)

1940  
CURLE_OUT_OF_MEMORY
;

1941 if(!*
cookõho°
)

1943 
	`‰ì
(
cookõho°
);

1947 
°¨t£¨ch
 = 0;

1948 if(*
cookõho°
 == '[') {

1949 *
˛osögbøckë
;

1952 
	`memmove
(
cookõho°
, cookõho° + 1, 
	`°æí
(cookiehost) - 1);

1953 
˛osögbøckë
 = 
	`°rchr
(
cookõho°
, ']');

1954 if(
˛osögbøckë
)

1955 *
˛osögbøckë
 = 0;

1958 *
cﬁ⁄
 = 
	`°rchr
(
cookõho°
 + 
°¨t£¨ch
, ':');

1959 if(
cﬁ⁄
)

1960 *
cﬁ⁄
 = 0;

1962 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
cookõho°
);

1963 
c⁄n
->
Ælo˝å
.
cookõho°
 = cookiehost;

1967 
c⁄n
->
Ælo˝å
.
ho°
 = 
NULL
;

1973 if(((
c⁄n
->
giví
->
¥Ÿocﬁ
&
CURLPROTO_HTTPS
) &&

1974 (
c⁄n
->
ªmŸe_p‹t
 =
PORT_HTTPS
)) ||

1975 ((
c⁄n
->
giví
->
¥Ÿocﬁ
&
CURLPROTO_HTTP
) &&

1976 (
c⁄n
->
ªmŸe_p‹t
 =
PORT_HTTP
)) )

1979 
c⁄n
->
Ælo˝å
.
ho°
 = 
	`≠rötf
("Host: %s%s%s\r\n",

1980 
c⁄n
->
bôs
.
ùv6_ù
?"[":"",

1981 
ho°
,

1982 
c⁄n
->
bôs
.
ùv6_ù
?"]":"");

1984 
c⁄n
->
Ælo˝å
.
ho°
 = 
	`≠rötf
("Host: %s%s%s:%hu\r\n",

1985 
c⁄n
->
bôs
.
ùv6_ù
?"[":"",

1986 
ho°
,

1987 
c⁄n
->
bôs
.
ùv6_ù
?"]":"",

1988 
c⁄n
->
ªmŸe_p‹t
);

1990 if(!
c⁄n
->
Ælo˝å
.
ho°
)

1992  
CURLE_OUT_OF_MEMORY
;

1995 #i‚de‡
CURL_DISABLE_PROXY


1996 if(
c⁄n
->
bôs
.
hâµroxy
 && !c⁄n->bôs.
tu¬ñ_¥oxy
) {

2002 if(
c⁄n
->
ho°
.
di•«me
 !c⁄n->ho°.
«me
) {

2003 *
uæ
 = 
d©a
->
ch™ge
.url;

2004 
±r
 = 
	`°r°r
(
uæ
, 
c⁄n
->
ho°
.
di•«me
);

2005 if(
±r
) {

2011 
size_t
 
cuºÀn
 = 
	`°æí
(
c⁄n
->
ho°
.
di•«me
);

2012 
size_t
 
√wÀn
 = 
	`°æí
(
c⁄n
->
ho°
.
«me
);

2013 
size_t
 
uæÀn
 = 
	`°æí
(
uæ
);

2015 *
√wuæ
;

2017 
√wuæ
 = 
	`mÆloc
(
uæÀn
 + 
√wÀn
 - 
cuºÀn
 + 1);

2018 if(
√wuæ
) {

2020 
	`mem˝y
(
√wuæ
, 
uæ
, 
±r
 - url);

2022 
	`mem˝y
(
√wuæ
 + (
±r
 - 
uæ
), 
c⁄n
->
ho°
.
«me
, 
√wÀn
);

2024 
	`mem˝y
(
√wuæ
 + 
√wÀn
 + (
±r
 - 
uæ
),

2025 
±r
 + 
cuºÀn
,

2026 
uæÀn
 - (
±r
-
uæ
Ë- 
cuºÀn
 + 1);

2027 if(
d©a
->
ch™ge
.
uæ_Æloc
) {

2028 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
uæ
);

2029 
d©a
->
ch™ge
.
uæ_Æloc
 = 
FALSE
;

2031 
d©a
->
ch™ge
.
uæ
 = 
√wuæ
;

2032 
d©a
->
ch™ge
.
uæ_Æloc
 = 
TRUE
;

2035  
CURLE_OUT_OF_MEMORY
;

2038 
µ©h
 = 
d©a
->
ch™ge
.
uæ
;

2039 if(
	`check¥efix
("·p://", 
µ©h
)) {

2040 if(
d©a
->
£t
.
¥oxy_å™s„r_mode
) {

2042 *
ty≥
 = 
	`°r°r
(
µ©h
, ";type=");

2043 if(
ty≥
 &&Åype[6] &&Åype[7] == 0) {

2044 
	`Cuæ_øw_touµî
(
ty≥
[6])) {

2050 
ty≥
 = 
NULL
;

2053 if(!
ty≥
) {

2054 *
p
 = 
·p_ty≥code
;

2057 if(!*
d©a
->
°©e
.
∑th
 && 
µ©h
[
	`°æí
(ppath) - 1] != '/') {

2058 *
p
++ = '/';

2060 
	`¢¥ötf
(
p
, (
·p_ty≥code
) - 1, ";type=%c",

2061 
d©a
->
£t
.
¥e„r_ascii
 ? 'a' : 'i');

2064 if(
c⁄n
->
bôs
.
u£r_∑sswd
 && !c⁄n->bôs.
u£Ωwd_ö_uæ
)

2065 
∑°e_·p_u£Ωwd
 = 
TRUE
;

2070 if(
HTTPREQ_POST_FORM
 =
hâ¥eq
) {

2073 
ªsu…
 = 
	`Cuæ_gëf‹md©a
(
d©a
, &
hâp
->
£ndô
, d©a->
£t
.
hâµo°
,

2074 
	`Cuæ_checkhódîs
(
c⁄n
, "Content-Type:"),

2075 &
hâp
->
po°size
);

2076 if(
ªsu…
)

2077  
ªsu…
;

2080 
hâp
->
p_ac˚±
 = 
	`Cuæ_checkhódîs
(
c⁄n
, "Ac˚±:")?
NULL
:"Accept: */*\r\n";

2082 if(–(
HTTPREQ_POST
 =
hâ¥eq
) ||

2083 (
HTTPREQ_POST_FORM
 =
hâ¥eq
) ||

2084 (
HTTPREQ_PUT
 =
hâ¥eq
) ) &&

2085 
d©a
->
°©e
.
ªsume_‰om
) {

2094 if(
d©a
->
°©e
.
ªsume_‰om
 < 0 ) {

2099 
d©a
->
°©e
.
ªsume_‰om
 = 0;

2102 if(
d©a
->
°©e
.
ªsume_‰om
 && !d©a->°©e.
this_is_a_fﬁlow
) {

2107 if(
c⁄n
->
£ek_func
) {

2108 
£ekîr
 = 
c⁄n
->
	`£ek_func
(c⁄n->
£ek_˛õ¡
, 
d©a
->
°©e
.
ªsume_‰om
,

2109 
SEEK_SET
);

2112 if(
£ekîr
 !
CURL_SEEKFUNC_OK
) {

2113 if(
£ekîr
 !
CURL_SEEKFUNC_CANTSEEK
) {

2114 
	`Áûf
(
d©a
, "CouldÇot seek stream");

2115  
CURLE_READ_ERROR
;

2119 
cuæ_off_t
 
∑s£d
=0;

2121 
size_t
 
ªadthißmou¡now
 =

2122 (
d©a
->
°©e
.
ªsume_‰om
 - 
∑s£d
 > 
	`CURL_OFF_T_C
(
BUFSIZE
)) ?

2123 
BUFSIZE
 : 
	`cuæx_sŸouz
(
d©a
->
°©e
.
ªsume_‰om
 - 
∑s£d
);

2125 
size_t
 
a˘uÆlyªad
 =

2126 
d©a
->
£t
.
	`‰ód_func
(d©a->
°©e
.
buf„r
, 1, 
ªadthißmou¡now
,

2127 
d©a
->
£t
.
ö
);

2129 
∑s£d
 +
a˘uÆlyªad
;

2130 if((
a˘uÆlyªad
 =0Ë|| (a˘uÆlyªad > 
ªadthißmou¡now
)) {

2133 
	`Áûf
(
d©a
, "Could o∆yÑód %" 
CURL_FORMAT_CURL_OFF_T


2134 " byã†‰omÅhêöput", 
∑s£d
);

2135  
CURLE_READ_ERROR
;

2137 } 
∑s£d
 < 
d©a
->
°©e
.
ªsume_‰om
);

2142 if(
d©a
->
°©e
.
öfûesize
>0) {

2143 
d©a
->
°©e
.
öfûesize
 -d©a->°©e.
ªsume_‰om
;

2145 if(
d©a
->
°©e
.
öfûesize
 <= 0) {

2146 
	`Áûf
(
d©a
, "Fileálready completely uploaded");

2147  
CURLE_PARTIAL_FILE
;

2153 if(
d©a
->
°©e
.
u£_ønge
) {

2159 if(((
hâ¥eq
 =
HTTPREQ_GET
Ë|| (hâ¥eq =
HTTPREQ_HEAD
)) &&

2160 !
	`Cuæ_checkhódîs
(
c⁄n
, "Range:")) {

2162 if(
c⁄n
->
Ælo˝å
.
øngñöe
)

2163 
	`‰ì
(
c⁄n
->
Ælo˝å
.
øngñöe
);

2164 
c⁄n
->
Ælo˝å
.
øngñöe
 = 
	`≠rötf
("Range: bytes=%s\r\n",

2165 
d©a
->
°©e
.
ønge
);

2167 if((
hâ¥eq
 !
HTTPREQ_GET
) &&

2168 !
	`Cuæ_checkhódîs
(
c⁄n
, "Content-Range:")) {

2171 if(
c⁄n
->
Ælo˝å
.
øngñöe
)

2172 
	`‰ì
(
c⁄n
->
Ælo˝å
.
øngñöe
);

2174 if(
d©a
->
£t
.
£t_ªsume_‰om
 < 0) {

2178 
c⁄n
->
Ælo˝å
.
øngñöe
 =

2179 
	`≠rötf
("C⁄ã¡-R™ge: byã†0-%" 
CURL_FORMAT_CURL_OFF_T


2180 "/%" 
CURL_FORMAT_CURL_OFF_T
 "\r\n",

2181 
d©a
->
°©e
.
öfûesize
 - 1, data->state.infilesize);

2184 if(
d©a
->
°©e
.
ªsume_‰om
) {

2186 
cuæ_off_t
 
tŸÆ_ex≥˘ed_size
=

2187 
d©a
->
°©e
.
ªsume_‰om
 + d©a->°©e.
öfûesize
;

2188 
c⁄n
->
Ælo˝å
.
øngñöe
 =

2189 
	`≠rötf
("C⁄ã¡-R™ge: byã†%s%" 
CURL_FORMAT_CURL_OFF_T


2190 "/%" 
CURL_FORMAT_CURL_OFF_T
 "\r\n",

2191 
d©a
->
°©e
.
ønge
, 
tŸÆ_ex≥˘ed_size
-1,

2192 
tŸÆ_ex≥˘ed_size
);

2197 
c⁄n
->
Ælo˝å
.
øngñöe
 =

2198 
	`≠rötf
("C⁄ã¡-R™ge: byã†%s/%" 
CURL_FORMAT_CURL_OFF_T
 "\r\n",

2199 
d©a
->
°©e
.
ønge
, d©a->°©e.
öfûesize
);

2201 if(!
c⁄n
->
Ælo˝å
.
øngñöe
)

2202  
CURLE_OUT_OF_MEMORY
;

2208 
hâp°rög

	`u£_hâp_1_1∂us
(
d©a
, 
c⁄n
)?"1.1":"1.0";

2211 
ªq_buf„r
 = 
	`Cuæ_add_buf„r_öô
();

2213 if(!
ªq_buf„r
)

2214  
CURLE_OUT_OF_MEMORY
;

2218 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "%†", 
ªque°
);

2219 if(
ªsu…
)

2220  
ªsu…
;

2223 if(
∑°e_·p_u£Ωwd
)

2224 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "ftp://%s:%s@%s",

2225 
c⁄n
->
u£r
, c⁄n->
∑sswd
,

2226 
µ©h
 + ("ftp://") - 1);

2228 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, 
µ©h
, 
	`°æí
(ppath));

2229 if(
ªsu…
)

2230  
ªsu…
;

2232 
ªsu…
 =

2233 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

2248 
·p_ty≥code
,

2249 
hâp°rög
,

2250 
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
?

2251 
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
:"",

2252 
c⁄n
->
Ælo˝å
.
u£Ωwd
?conn->allocptr.userpwd:"",

2253 (
d©a
->
°©e
.
u£_ønge
 && 
c⁄n
->
Ælo˝å
.
øngñöe
)?

2254 
c⁄n
->
Ælo˝å
.
øngñöe
:"",

2255 (
d©a
->
£t
.
°r
[
STRING_USERAGENT
] &&

2256 *
d©a
->
£t
.
°r
[
STRING_USERAGENT
] &&

2257 
c⁄n
->
Ælo˝å
.
uagít
)?

2258 
c⁄n
->
Ælo˝å
.
uagít
:"",

2259 (
c⁄n
->
Ælo˝å
.
ho°
?conn->allocptr.host:""),

2260 
hâp
->
p_ac˚±
?http->p_accept:"",

2261 
c⁄n
->
Ælo˝å
.
ã
?conn->allocptr.te:"",

2262 (
d©a
->
£t
.
°r
[
STRING_ENCODING
] &&

2263 *
d©a
->
£t
.
°r
[
STRING_ENCODING
] &&

2264 
c⁄n
->
Ælo˝å
.
ac˚±_ícodög
)?

2265 
c⁄n
->
Ælo˝å
.
ac˚±_ícodög
:"",

2266 (
d©a
->
ch™ge
.
ª„ªr
 && 
c⁄n
->
Ælo˝å
.
ªf
)?

2267 
c⁄n
->
Ælo˝å
.
ªf
:"" ,

2268 (
c⁄n
->
bôs
.
hâµroxy
 &&

2269 !
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 &&

2270 !
	`Cuæ_checkProxyhódîs
(
c⁄n
, "Proxy-Connection:"))?

2272 
ã


2280 
	`Cuæ_ß„‰ì
 (
c⁄n
->
Ælo˝å
.
u£Ωwd
);

2281 
c⁄n
->
Ælo˝å
.
u£Ωwd
 = 
NULL
;

2283 if(
ªsu…
)

2284  
ªsu…
;

2286 if(!(
c⁄n
->
h™dÀr
->
Êags
&
PROTOPT_SSL
) &&

2287 (
d©a
->
£t
.
hâpvîsi⁄
 =
CURL_HTTP_VERSION_2_0
)) {

2290 
ªsu…
 = 
	`Cuæ_hâp2_ªque°_upgøde
(
ªq_buf„r
, 
c⁄n
);

2291 if(
ªsu…
)

2292  
ªsu…
;

2295 #i‡!
	`deföed
(
CURL_DISABLE_COOKIES
)

2296 if(
d©a
->
cookõs
 || 
addcookõs
) {

2297 
Cookõ
 *
co
=
NULL
;

2298 
cou¡
=0;

2300 if(
d©a
->
cookõs
) {

2301 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
, 
CURL_LOCK_ACCESS_SINGLE
);

2302 
co
 = 
	`Cuæ_cookõ_gëli°
(
d©a
->
cookõs
,

2303 
c⁄n
->
Ælo˝å
.
cookõho°
?

2304 
c⁄n
->
Ælo˝å
.
cookõho°
:
ho°
,

2305 
d©a
->
°©e
.
∑th
,

2306 (
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&
CURLPROTO_HTTPS
)?

2307 
TRUE
:
FALSE
);

2308 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
);

2310 if(
co
) {

2311 
Cookõ
 *
°‹e
=
co
;

2313 
co
) {

2314 if(
co
->
vÆue
) {

2315 if(0 =
cou¡
) {

2316 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "Cookie: ");

2317 if(
ªsu…
)

2320 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

2321 "%s%s=%s", 
cou¡
?"; ":"",

2322 
co
->
«me
, co->
vÆue
);

2323 if(
ªsu…
)

2325 
cou¡
++;

2327 
co
 = co->
√xt
;

2329 
	`Cuæ_cookõ_‰ìli°
(
°‹e
, 
FALSE
);

2331 if(
addcookõs
 && (
CURLE_OK
 =
ªsu…
)) {

2332 if(!
cou¡
)

2333 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "Cookie: ");

2334 if(
CURLE_OK
 =
ªsu…
) {

2335 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "%s%s",

2336 
cou¡
?"; ":"",

2337 
addcookõs
);

2338 
cou¡
++;

2341 if(
cou¡
 && (
CURLE_OK
 =
ªsu…
))

2342 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, "\r\n", 2);

2344 if(
ªsu…
)

2345  
ªsu…
;

2349 if(
d©a
->
£t
.
timec⁄dôi⁄
) {

2350 
ªsu…
 = 
	`Cuæ_add_timec⁄dôi⁄
(
d©a
, 
ªq_buf„r
);

2351 if(
ªsu…
)

2352  
ªsu…
;

2355 
ªsu…
 = 
	`Cuæ_add_cu°om_hódîs
(
c⁄n
, 
FALSE
, 
ªq_buf„r
);

2356 if(
ªsu…
)

2357  
ªsu…
;

2359 
hâp
->
po°d©a
 = 
NULL
;

2360 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 0);

2366 
hâ¥eq
) {

2368 
HTTPREQ_POST_FORM
:

2369 if(!
hâp
->
£ndô
 || 
c⁄n
->
bôs
.
auth√g
) {

2371 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "Content-Length: 0\r\n\r\n");

2372 if(
ªsu…
)

2373  
ªsu…
;

2375 
ªsu…
 = 
	`Cuæ_add_buf„r_£nd
(
ªq_buf„r
, 
c⁄n
,

2376 &
d©a
->
öfo
.
ªque°_size
, 0, 
FIRSTSOCKET
);

2377 if(
ªsu…
)

2378 
	`Áûf
(
d©a
, "Failed sending POSTÑequest");

2381 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
TRUE
, &
hâp
->
ªadbyãcou¡
,

2382 -1, 
NULL
);

2386 if(
	`Cuæ_F‹mInô
(&
hâp
->
f‹m
, hâp->
£ndô
)) {

2387 
	`Áûf
(
d©a
, "Internal HTTP POSTÉrror!");

2388  
CURLE_HTTP_POST_ERROR
;

2396 
hâp
->
f‹m
.
‰ód_func
 = 
c⁄n
->fread_func;

2399 
c⁄n
->
‰ód_func
 = (
cuæ_ªad_ˇŒback
)
Cuæ_F‹mRódî
;

2400 
c⁄n
->
‰ód_ö
 = &
hâp
->
f‹m
;

2402 
hâp
->
£ndög
 = 
HTTPSEND_BODY
;

2404 if(!
d©a
->
ªq
.
u∂ﬂd_chunky
 &&

2405 !
	`Cuæ_checkhódîs
(
c⁄n
, "Content-Length:")) {

2407 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

2408 "C⁄ã¡-Lígth: %" 
CURL_FORMAT_CURL_OFF_T


2409 "\r\n", 
hâp
->
po°size
);

2410 if(
ªsu…
)

2411  
ªsu…
;

2414 
ªsu…
 = 
	`ex≥˘100
(
d©a
, 
c⁄n
, 
ªq_buf„r
);

2415 if(
ªsu…
)

2416  
ªsu…
;

2422 *
c⁄ã¡Ty≥
;

2423 
size_t
 
löñígth
=0;

2424 
c⁄ã¡Ty≥
 = 
	`Cuæ_f‹mpo°hódî
((*)&
hâp
->
f‹m
,

2425 &
löñígth
);

2426 if(!
c⁄ã¡Ty≥
) {

2427 
	`Áûf
(
d©a
, "CouldÇot get Content-Type headerÜine!");

2428  
CURLE_HTTP_POST_ERROR
;

2431 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, 
c⁄ã¡Ty≥
, 
löñígth
);

2432 if(
ªsu…
)

2433  
ªsu…
;

2437 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, "\r\n", 2);

2438 if(
ªsu…
)

2439  
ªsu…
;

2442 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 
hâp
->
po°size
);

2445 
ªsu…
 = 
	`Cuæ_add_buf„r_£nd
(
ªq_buf„r
, 
c⁄n
,

2446 &
d©a
->
öfo
.
ªque°_size
, 0, 
FIRSTSOCKET
);

2447 if(
ªsu…
)

2448 
	`Áûf
(
d©a
, "Failed sending POSTÑequest");

2451 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
TRUE
,

2452 &
hâp
->
ªadbyãcou¡
, 
FIRSTSOCKET
,

2453 &
hâp
->
wrôebyãcou¡
);

2455 if(
ªsu…
) {

2456 
	`Cuæ_f‹m˛ón
(&
hâp
->
£ndô
);

2457  
ªsu…
;

2461 
ªsu…
 = 
	`Cuæ_c⁄vît_f‹m
(
d©a
, 
hâp
->
£ndô
);

2462 if(
ªsu…
) {

2463 
	`Cuæ_f‹m˛ón
(&
hâp
->
£ndô
);

2464  
ªsu…
;

2469 
HTTPREQ_PUT
:

2471 if(
c⁄n
->
bôs
.
auth√g
)

2472 
po°size
 = 0;

2474 
po°size
 = 
d©a
->
°©e
.
öfûesize
;

2476 if((
po°size
 !-1Ë&& !
d©a
->
ªq
.
u∂ﬂd_chunky
 &&

2477 !
	`Cuæ_checkhódîs
(
c⁄n
, "Content-Length:")) {

2479 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

2480 "C⁄ã¡-Lígth: %" 
CURL_FORMAT_CURL_OFF_T


2481 "\r\n", 
po°size
);

2482 if(
ªsu…
)

2483  
ªsu…
;

2486 if(
po°size
 != 0) {

2487 
ªsu…
 = 
	`ex≥˘100
(
d©a
, 
c⁄n
, 
ªq_buf„r
);

2488 if(
ªsu…
)

2489  
ªsu…
;

2492 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, "\r\n", 2);

2493 if(
ªsu…
)

2494  
ªsu…
;

2497 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 
po°size
);

2500 
ªsu…
 = 
	`Cuæ_add_buf„r_£nd
(
ªq_buf„r
, 
c⁄n
,

2501 &
d©a
->
öfo
.
ªque°_size
, 0, 
FIRSTSOCKET
);

2502 if(
ªsu…
)

2503 
	`Áûf
(
d©a
, "Failed sending PUTÑequest");

2506 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
TRUE
,

2507 &
hâp
->
ªadbyãcou¡
, 
po°size
?
FIRSTSOCKET
:-1,

2508 
po°size
?&
hâp
->
wrôebyãcou¡
:
NULL
);

2509 if(
ªsu…
)

2510  
ªsu…
;

2513 
HTTPREQ_POST
:

2516 if(
c⁄n
->
bôs
.
auth√g
)

2517 
po°size
 = 0;

2520 
po°size
 = (
d©a
->
£t
.
po°fõldsize
 != -1)?

2521 
d©a
->
£t
.
po°fõldsize
:

2522 (
d©a
->
£t
.
po°fõlds
? (
cuæ_off_t
)
	`°æí
(data->set.postfields):-1);

2528 if((
po°size
 !-1Ë&& !
d©a
->
ªq
.
u∂ﬂd_chunky
 &&

2529 !
	`Cuæ_checkhódîs
(
c⁄n
, "Content-Length:")) {

2532 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

2533 "C⁄ã¡-Lígth: %" 
CURL_FORMAT_CURL_OFF_T


2534 "\r\n", 
po°size
);

2535 if(
ªsu…
)

2536  
ªsu…
;

2539 if(!
	`Cuæ_checkhódîs
(
c⁄n
, "Content-Type:")) {

2540 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

2543 if(
ªsu…
)

2544  
ªsu…
;

2551 
±r
 = 
	`Cuæ_checkhódîs
(
c⁄n
, "Expect:");

2552 if(
±r
) {

2553 
d©a
->
°©e
.
ex≥˘100hódî
 =

2554 
	`Cuæ_com∑ªhódî
(
±r
, "Expect:", "100-continue");

2556 if(
po°size
 > 
TINY_INITIAL_POST_SIZE
 ||Öostsize < 0) {

2557 
ªsu…
 = 
	`ex≥˘100
(
d©a
, 
c⁄n
, 
ªq_buf„r
);

2558 if(
ªsu…
)

2559  
ªsu…
;

2562 
d©a
->
°©e
.
ex≥˘100hódî
 = 
FALSE
;

2564 if(
d©a
->
£t
.
po°fõlds
) {

2568 if(
c⁄n
->
hâpvîsi⁄
 != 20 &&

2569 !
d©a
->
°©e
.
ex≥˘100hódî
 &&

2570 (
po°size
 < 
MAX_INITIAL_POST_SIZE
)) {

2578 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, "\r\n", 2);

2579 if(
ªsu…
)

2580  
ªsu…
;

2582 if(!
d©a
->
ªq
.
u∂ﬂd_chunky
) {

2585 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, 
d©a
->
£t
.
po°fõlds
,

2586 (
size_t
)
po°size
);

2587 
ö˛uded_body
 = 
po°size
;

2590 if(
po°size
) {

2592 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "%x\r\n", ()
po°size
);

2593 if(
CURLE_OK
 =
ªsu…
) {

2594 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, 
d©a
->
£t
.
po°fõlds
,

2595 (
size_t
)
po°size
);

2596 if(
CURLE_OK
 =
ªsu…
)

2597 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, "\r\n", 2);

2598 
ö˛uded_body
 = 
po°size
 + 2;

2601 if(
CURLE_OK
 =
ªsu…
)

2602 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
,

2605 
ö˛uded_body
 += 5;

2607 if(
ªsu…
)

2608  
ªsu…
;

2610 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 
po°size
);

2614 
hâp
->
po°size
 =Öostsize;

2615 
hâp
->
po°d©a
 = 
d©a
->
£t
.
po°fõlds
;

2617 
hâp
->
£ndög
 = 
HTTPSEND_BODY
;

2619 
c⁄n
->
‰ód_func
 = (
cuæ_ªad_ˇŒback
)
ªadm‹ed©a
;

2620 
c⁄n
->
‰ód_ö
 = (*)conn;

2623 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 
hâp
->
po°size
);

2625 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, "\r\n", 2);

2626 if(
ªsu…
)

2627  
ªsu…
;

2631 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, "\r\n", 2);

2632 if(
ªsu…
)

2633  
ªsu…
;

2635 if(
d©a
->
ªq
.
u∂ﬂd_chunky
 && 
c⁄n
->
bôs
.
auth√g
) {

2638 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
,

2641 if(
ªsu…
)

2642  
ªsu…
;

2645 if(
d©a
->
£t
.
po°fõldsize
) {

2647 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 
po°size
?postsize:-1);

2652 if(!
c⁄n
->
bôs
.
auth√g
) {

2653 
hâp
->
po°d©a
 = (*)&http->postdata;

2654 
hâp
->
po°size
 =Öostsize;

2659 
ªsu…
 = 
	`Cuæ_add_buf„r_£nd
(
ªq_buf„r
, 
c⁄n
, &
d©a
->
öfo
.
ªque°_size
,

2660 (
size_t
)
ö˛uded_body
, 
FIRSTSOCKET
);

2662 if(
ªsu…
)

2663 
	`Áûf
(
d©a
, "Failed sending HTTP POSTÑequest");

2665 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
TRUE
,

2666 &
hâp
->
ªadbyãcou¡
, hâp->
po°d©a
?
FIRSTSOCKET
:-1,

2667 
hâp
->
po°d©a
?&hâp->
wrôebyãcou¡
:
NULL
);

2671 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, "\r\n", 2);

2672 if(
ªsu…
)

2673  
ªsu…
;

2676 
ªsu…
 = 
	`Cuæ_add_buf„r_£nd
(
ªq_buf„r
, 
c⁄n
,

2677 &
d©a
->
öfo
.
ªque°_size
, 0, 
FIRSTSOCKET
);

2679 if(
ªsu…
)

2680 
	`Áûf
(
d©a
, "Failed sending HTTPÑequest");

2683 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
TRUE
, &
hâp
->
ªadbyãcou¡
,

2684 
hâp
->
po°d©a
?
FIRSTSOCKET
:-1,

2685 
hâp
->
po°d©a
?&hâp->
wrôebyãcou¡
:
NULL
);

2687 if(
ªsu…
)

2688  
ªsu…
;

2690 if(
hâp
->
wrôebyãcou¡
) {

2693 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 
hâp
->
wrôebyãcou¡
);

2694 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

2695 
ªsu…
 = 
CURLE_ABORTED_BY_CALLBACK
;

2697 if(
hâp
->
wrôebyãcou¡
 >
po°size
) {

2700 
	`öfof
(
d©a
, "u∂ﬂd com∂ëñy síàoff: %" 
CURL_FORMAT_CURL_OFF_T


2701 " ouào‡%" 
CURL_FORMAT_CURL_OFF_T
 " bytes\n",

2702 
hâp
->
wrôebyãcou¡
, 
po°size
);

2703 
d©a
->
ªq
.
u∂ﬂd_d⁄e
 = 
TRUE
;

2704 
d©a
->
ªq
.
kìp⁄
 &~
KEEP_SEND
;

2705 
d©a
->
ªq
.
exp100
 = 
EXP100_SEND_DATA
;

2709  
ªsu…
;

2710 
	}
}

2717 
boﬁ


2718 
	$checkhâµªfix
(
Sessi⁄H™dÀ
 *
d©a
,

2719 c⁄° *
s
)

2721 
cuæ_¶i°
 *
hód
 = 
d©a
->
£t
.
hâp200Æü£s
;

2722 
boﬁ
 
rc
 = 
FALSE
;

2723 #ifde‡
CURL_DOES_CONVERSIONS


2725 *
s¸©ch
 = 
	`°rdup
(
s
);

2726 if(
NULL
 =
s¸©ch
) {

2727 
	`Áûf
 (
d©a
, "FailedÅoállocate memory for conversion!");

2728  
FALSE
;

2730 if(
CURLE_OK
 !
	`Cuæ_c⁄vît_‰om_√tw‹k
(
d©a
, 
s¸©ch
, 
	`°æí
(
s
)+1)) {

2732 
	`‰ì
(
s¸©ch
);

2733  
FALSE
;

2735 
s
 = 
s¸©ch
;

2738 
hód
) {

2739 if(
	`check¥efix
(
hód
->
d©a
, 
s
)) {

2740 
rc
 = 
TRUE
;

2743 
hód
 = hód->
√xt
;

2746 if(!
rc
 && (
	`check¥efix
("HTTP/", 
s
)))

2747 
rc
 = 
TRUE
;

2749 #ifde‡
CURL_DOES_CONVERSIONS


2750 
	`‰ì
(
s¸©ch
);

2752  
rc
;

2753 
	}
}

2755 #i‚de‡
CURL_DISABLE_RTSP


2756 
boﬁ


2757 
	$checkπ•¥efix
(
Sessi⁄H™dÀ
 *
d©a
,

2758 c⁄° *
s
)

2761 #ifde‡
CURL_DOES_CONVERSIONS


2763 *
s¸©ch
 = 
	`°rdup
(
s
);

2764 if(
NULL
 =
s¸©ch
) {

2765 
	`Áûf
 (
d©a
, "FailedÅoállocate memory for conversion!");

2766  
FALSE
;

2768 if(
CURLE_OK
 !
	`Cuæ_c⁄vît_‰om_√tw‹k
(
d©a
, 
s¸©ch
, 
	`°æí
(
s
)+1)) {

2770 
	`‰ì
(
s¸©ch
);

2771  
FALSE
;

2773 
s
 = 
s¸©ch
;

2775 ()
d©a
;

2777 if(
	`check¥efix
("RTSP/", 
s
))

2778  
TRUE
;

2780  
FALSE
;

2781 
	}
}

2784 
boﬁ


2785 
	$check¥Ÿ›ªfix
(
Sessi⁄H™dÀ
 *
d©a
, 
c⁄√˘d©a
 *
c⁄n
,

2786 c⁄° *
s
)

2788 #i‚de‡
CURL_DISABLE_RTSP


2789 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
CURLPROTO_RTSP
)

2790  
	`checkπ•¥efix
(
d©a
, 
s
);

2792 ()
c⁄n
;

2795  
	`checkhâµªfix
(
d©a
, 
s
);

2796 
	}
}

2803 
CURLcode
 
	$hódî_≠≥nd
(
Sessi⁄H™dÀ
 *
d©a
,

2804 
SögÀReque°
 *
k
,

2805 
size_t
 
Àngth
)

2807 if(
k
->
hbuÊí
 + 
Àngth
 >
d©a
->
°©e
.
hódîsize
) {

2809 *
√wbuff
;

2810 
size_t
 
hbuÂ_ödex
;

2811 
size_t
 
√wsize
;

2813 if(
k
->
hbuÊí
 + 
Àngth
 > 
CURL_MAX_HTTP_HEADER
) {

2817 
	`Áûf
 (
d©a
, "Avoided giantÑealloc for header (max is %d)!",

2818 
CURL_MAX_HTTP_HEADER
);

2819  
CURLE_OUT_OF_MEMORY
;

2822 
√wsize
=
	`CURLMAX
((
k
->
hbuÊí
+ 
Àngth
)*3/2, 
d©a
->
°©e
.
hódîsize
*2);

2823 
hbuÂ_ödex
 = 
k
->
hbuÂ
 - 
d©a
->
°©e
.
hódîbuff
;

2824 
√wbuff
 = 
	`ªÆloc
(
d©a
->
°©e
.
hódîbuff
, 
√wsize
);

2825 if(!
√wbuff
) {

2826 
	`Áûf
 (
d©a
, "FailedÅoálloc memory for big header!");

2827  
CURLE_OUT_OF_MEMORY
;

2829 
d©a
->
°©e
.
hódîsize
=
√wsize
;

2830 
d©a
->
°©e
.
hódîbuff
 = 
√wbuff
;

2831 
k
->
hbuÂ
 = 
d©a
->
°©e
.
hódîbuff
 + 
hbuÂ_ödex
;

2833 
	`mem˝y
(
k
->
hbuÂ
, k->
°r_°¨t
, 
Àngth
);

2834 
k
->
hbuÂ
 +
Àngth
;

2835 
k
->
hbuÊí
 +
Àngth
;

2836 *
k
->
hbuÂ
 = 0;

2838  
CURLE_OK
;

2839 
	}
}

2841 
	$¥öt_hâp_îr‹
(
Sessi⁄H™dÀ
 *
d©a
)

2843 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

2844 *
beg
 = 
k
->
p
;

2847 if(!
	`°∫cmp
(
beg
, "HTTP", 4)) {

2850 
beg
 = 
	`°rchr
(beg, ' ');

2851 if(
beg
 && *++beg) {

2854 
íd_ch¨
 = '\r';

2855 *
íd
 = 
	`°rchr
(
beg
, 
íd_ch¨
);

2856 if(!
íd
) {

2858 
íd_ch¨
 = '\n';

2859 
íd
 = 
	`°rchr
(
beg
, 
íd_ch¨
);

2862 if(
íd
) {

2864 *
íd
 = '\0';

2865 
	`Áûf
(
d©a
, "Thêªque°ed URLÑëu∫edÉº‹: %s", 
beg
);

2868 *
íd
 = 
íd_ch¨
;

2875 
	`Áûf
(
d©a
, "Thêªque°ed URLÑëu∫edÉº‹: %d", 
k
->
hâpcode
);

2876 
	}
}

2881 
CURLcode
 
	$Cuæ_hâp_ªadwrôe_hódîs
(
Sessi⁄H™dÀ
 *
d©a
,

2882 
c⁄√˘d©a
 *
c⁄n
,

2883 
ssize_t
 *
ƒód
,

2884 
boﬁ
 *
°›_ªadög
)

2886 
CURLcode
 
ªsu…
;

2887 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

2891 
size_t
 
ª°_Àngth
;

2892 
size_t
 
fuŒ_Àngth
;

2893 
wrôëy≥
;

2896 
k
->
°r_°¨t
 = k->
°r
;

2899 
k
->
íd_±r
 = 
	`memchr
(k->
°r_°¨t
, 0x0a, *
ƒód
);

2901 if(!
k
->
íd_±r
) {

2904 
ªsu…
 = 
	`hódî_≠≥nd
(
d©a
, 
k
, *
ƒód
);

2905 if(
ªsu…
)

2906  
ªsu…
;

2908 if(!
k
->
hódîlöe
 && (k->
hbuÊí
>5)) {

2910 if(!
	`check¥Ÿ›ªfix
(
d©a
, 
c⁄n
, d©a->
°©e
.
hódîbuff
)) {

2912 
k
->
hódî
 = 
FALSE
;

2913 
k
->
badhódî
 = 
HEADER_ALLBAD
;

2922 
ª°_Àngth
 = (
k
->
íd_±r
 - k->
°r
)+1;

2923 *
ƒód
 -(
ssize_t
)
ª°_Àngth
;

2925 
k
->
°r
 = k->
íd_±r
 + 1;

2927 
fuŒ_Àngth
 = 
k
->
°r
 - k->
°r_°¨t
;

2929 
ªsu…
 = 
	`hódî_≠≥nd
(
d©a
, 
k
, 
fuŒ_Àngth
);

2930 if(
ªsu…
)

2931  
ªsu…
;

2933 
k
->
íd_±r
 = k->
hbuÂ
;

2934 
k
->
p
 = 
d©a
->
°©e
.
hódîbuff
;

2940 if(!
k
->
hódîlöe
) {

2942 if((
k
->
hbuÊí
>5) &&

2943 !
	`check¥Ÿ›ªfix
(
d©a
, 
c⁄n
, d©a->
°©e
.
hódîbuff
)) {

2945 
k
->
hódî
 = 
FALSE
;

2946 if(*
ƒód
)

2948 
k
->
badhódî
 = 
HEADER_PARTHEADER
;

2951 
k
->
badhódî
 = 
HEADER_ALLBAD
;

2952 *
ƒód
 = (
ssize_t
)
ª°_Àngth
;

2960 if((0x0®=*
k
->
p
) || (0x0d == *k->p)) {

2961 
size_t
 
hódîÀn
;

2964 #ifde‡
CURL_DOES_CONVERSIONS


2965 if(0x0d =*
k
->
p
) {

2966 *
k
->
p
 = '\r';

2967 
k
->
p
++;

2969 if(0x0®=*
k
->
p
) {

2970 *
k
->
p
 = '\n';

2971 
k
->
p
++;

2974 if('\r' =*
k
->
p
)

2975 
k
->
p
++;

2976 if('\n' =*
k
->
p
)

2977 
k
->
p
++;

2980 if(100 <
k
->
hâpcode
 && 199 >= k->httpcode) {

2988 
k
->
hódî
 = 
TRUE
;

2989 
k
->
hódîlöe
 = 0;

2992 
k
->
hâpcode
) {

2995 if(
k
->
exp100
) {

2996 
k
->
exp100
 = 
EXP100_SEND_DATA
;

2997 
k
->
kìp⁄
 |
KEEP_SEND
;

3002 if(
k
->
upgr101
 =
UPGR101_REQUESTED
) {

3003 
	`öfof
(
d©a
, "Received 101\n");

3004 
k
->
upgr101
 = 
UPGR101_RECEIVED
;

3008 
	`Cuæ_hâp2_swôched
(
c⁄n
);

3016 
k
->
hódî
 = 
FALSE
;

3018 if((
k
->
size
 =-1Ë&& !k->
chunk
 && !
c⁄n
->
bôs
.
˛o£
 &&

3019 (
c⁄n
->
hâpvîsi⁄
 == 11) &&

3020 !(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
CURLPROTO_RTSP
) &&

3021 
d©a
->
£t
.
hâ¥eq
 !
HTTPREQ_HEAD
) {

3027 
	`öfof
(
d©a
, "no chunk,Ço close,Ço size. Assume closeÅo "

3029 
	`c⁄n˛o£
(
c⁄n
, "HTTP: NoÉnd-of-message indicator");

3037 if(
	`hâp_should_Áû
(
c⁄n
)) {

3038 
	`Áûf
 (
d©a
, "TheÑequested URLÑeturnedÉrror: %d",

3039 
k
->
hâpcode
);

3040  
CURLE_HTTP_RETURNED_ERROR
;

3045 
wrôëy≥
 = 
CLIENTWRITE_HEADER
;

3046 if(
d©a
->
£t
.
ö˛ude_hódî
)

3047 
wrôëy≥
 |
CLIENTWRITE_BODY
;

3049 
hódîÀn
 = 
k
->
p
 - 
d©a
->
°©e
.
hódîbuff
;

3051 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
wrôëy≥
,

3052 
d©a
->
°©e
.
hódîbuff
,

3053 
hódîÀn
);

3054 if(
ªsu…
)

3055  
ªsu…
;

3057 
d©a
->
öfo
.
hódî_size
 +()
hódîÀn
;

3058 
d©a
->
ªq
.
hódîbyãcou¡
 +()
hódîÀn
;

3060 
d©a
->
ªq
.
dedu˘hódîcou¡
 =

3061 (100 <
k
->
hâpcode
 && 199 >k->hâpcode)?
d©a
->
ªq
.
hódîbyãcou¡
:0;

3063 if(!*
°›_ªadög
) {

3067 
ªsu…
 = 
	`Cuæ_hâp_auth_a˘
(
c⁄n
);

3069 if(
ªsu…
)

3070  
ªsu…
;

3072 if(
k
->
hâpcode
 >= 300) {

3073 if((!
c⁄n
->
bôs
.
auth√g
Ë&& !c⁄n->bôs.
˛o£
 &&

3074 !
c⁄n
->
bôs
.
ªwöda·î£nd
) {

3088 
d©a
->
£t
.
hâ¥eq
) {

3089 
HTTPREQ_PUT
:

3090 
HTTPREQ_POST
:

3091 
HTTPREQ_POST_FORM
:

3096 if(!
k
->
u∂ﬂd_d⁄e
) {

3097 
	`öfof
(
d©a
, "HTTPÉrror beforeÉnd of send, stop sending\n");

3098 
	`c⁄n˛o£
(
c⁄n
, "Stop sending data beforeÉverything sent");

3099 
k
->
u∂ﬂd_d⁄e
 = 
TRUE
;

3100 
k
->
kìp⁄
 &~
KEEP_SEND
;

3101 if(
d©a
->
°©e
.
ex≥˘100hódî
)

3102 
k
->
exp100
 = 
EXP100_FAILED
;

3112 if(
c⁄n
->
bôs
.
ªwöda·î£nd
) {

3115 
	`öfof
(
d©a
, "Keep sending dataÅo getÅossedáway!\n");

3116 
k
->
kìp⁄
 |
KEEP_SEND
;

3120 if(!
k
->
hódî
) {

3127 if(
d©a
->
£t
.
›t_no_body
)

3128 *
°›_ªadög
 = 
TRUE
;

3143 if(
k
->
chunk
)

3144 
k
->
maxdow∆ﬂd
 = k->
size
 = -1;

3146 if(-1 !
k
->
size
) {

3151 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
k
->
size
);

3152 
k
->
maxdow∆ﬂd
 = k->
size
;

3157 if(0 =
k
->
maxdow∆ﬂd
)

3158 *
°›_ªadög
 = 
TRUE
;

3160 if(*
°›_ªadög
) {

3162 
k
->
kìp⁄
 &~
KEEP_RECV
;

3165 if(
d©a
->
£t
.
vîbo£
)

3166 
	`Cuæ_debug
(
d©a
, 
CURLINFO_HEADER_IN
,

3167 
k
->
°r_°¨t
, 
hódîÀn
, 
c⁄n
);

3173 
k
->
hbuÂ
 = 
d©a
->
°©e
.
hódîbuff
;

3174 
k
->
hbuÊí
 = 0;

3182 if(!
k
->
hódîlöe
++) {

3185 
hâpvîsi⁄_maj‹
;

3186 
π•vîsi⁄_maj‹
;

3187 
nc
 = 0;

3188 #ifde‡
CURL_DOES_CONVERSIONS


3189 
	#HEADER1
 
s¸©ch


	)

3190 
	#SCRATCHSIZE
 21

	)

3191 
CURLcode
 
ªs
;

3192 
s¸©ch
[
SCRATCHSIZE
+1];

3198 
	`°∫˝y
(&
s¸©ch
[0], 
k
->
p
, 
SCRATCHSIZE
);

3199 
s¸©ch
[
SCRATCHSIZE
] = 0;

3200 
ªs
 = 
	`Cuæ_c⁄vît_‰om_√tw‹k
(
d©a
,

3201 &
s¸©ch
[0],

3202 
SCRATCHSIZE
);

3203 if(
ªs
)

3205  
ªs
;

3207 
	#HEADER1
 
k
->
p


	)

3210 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
PROTO_FAMILY_HTTP
) {

3211 
nc
 = 
	`ssˇnf
(
HEADER1
,

3213 &
hâpvîsi⁄_maj‹
,

3214 &
c⁄n
->
hâpvîsi⁄
,

3215 &
k
->
hâpcode
);

3216 if(
nc
==3) {

3217 
c⁄n
->
hâpvîsi⁄
 +10 * 
hâpvîsi⁄_maj‹
;

3223 
nc
=
	`ssˇnf
(
HEADER1
, " HTTP %3d", &
k
->
hâpcode
);

3224 
c⁄n
->
hâpvîsi⁄
 = 10;

3229 if(!
nc
) {

3230 if(
	`checkhâµªfix
(
d©a
, 
k
->
p
)) {

3231 
nc
 = 1;

3232 
k
->
hâpcode
 = 200;

3233 
c⁄n
->
hâpvîsi⁄
 = 10;

3238 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
CURLPROTO_RTSP
) {

3239 
nc
 = 
	`ssˇnf
(
HEADER1
,

3241 &
π•vîsi⁄_maj‹
,

3242 &
c⁄n
->
π•vîsi⁄
,

3243 &
k
->
hâpcode
);

3244 if(
nc
==3) {

3245 
c⁄n
->
π•vîsi⁄
 +10 * 
π•vîsi⁄_maj‹
;

3246 
c⁄n
->
hâpvîsi⁄
 = 11;

3250 
nc
 = 0;

3254 if(
nc
) {

3255 
d©a
->
öfo
.
hâpcode
 = 
k
->httpcode;

3257 
d©a
->
öfo
.
hâpvîsi⁄
 = 
c⁄n
->httpversion;

3258 if(!
d©a
->
°©e
.
hâpvîsi⁄
 ||

3259 
d©a
->
°©e
.
hâpvîsi⁄
 > 
c⁄n
->httpversion)

3261 
d©a
->
°©e
.
hâpvîsi⁄
 = 
c⁄n
->httpversion;

3271 if(
d©a
->
£t
.
hâp_Áû_⁄_îr‹
 && (
k
->
hâpcode
 >= 400) &&

3272 ((
k
->
hâpcode
 !401Ë|| !
c⁄n
->
bôs
.
u£r_∑sswd
) &&

3273 ((
k
->
hâpcode
 !407Ë|| !
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
) ) {

3275 if(
d©a
->
°©e
.
ªsume_‰om
 &&

3276 (
d©a
->
£t
.
hâ¥eq
==
HTTPREQ_GET
) &&

3277 (
k
->
hâpcode
 == 416)) {

3283 
	`¥öt_hâp_îr‹
(
d©a
);

3284  
CURLE_HTTP_RETURNED_ERROR
;

3288 if(
c⁄n
->
hâpvîsi⁄
 == 10) {

3292 
	`öfof
(
d©a
, "HTTP 1.0,ássume closeáfter body\n");

3293 
	`c⁄n˛o£
(
c⁄n
, "HTTP/1.0 closeáfter body");

3295 if(
c⁄n
->
hâpvîsi⁄
 >= 11 &&

3296 !
c⁄n
->
bôs
.
˛o£
) {

3297 
c⁄√˘bundÀ
 *
cb_±r
;

3301 
	`DEBUGF
(
	`öfof
(
d©a
,

3305 
cb_±r
 = 
c⁄n
->
bundÀ
;

3306 if(
cb_±r
) {

3307 if(!
	`Cuæ_pùñöe_sôe_bœckli°ed
(
d©a
, 
c⁄n
))

3308 
cb_±r
->
£rvî_suµ‹ts_pùñöög
 = 
TRUE
;

3312 
k
->
hâpcode
) {

3325 if(
d©a
->
£t
.
timec⁄dôi⁄
)

3326 
d©a
->
öfo
.
timec⁄d
 = 
TRUE
;

3327 
k
->
size
=0;

3328 
k
->
maxdow∆ﬂd
=0;

3329 
k
->
ign‹e˛
 = 
TRUE
;

3337 
k
->
hódî
 = 
FALSE
;

3342 
ªsu…
 = 
	`Cuæ_c⁄vît_‰om_√tw‹k
(
d©a
, 
k
->
p
, 
	`°æí
(k->p));

3344 if(
ªsu…
)

3345  
ªsu…
;

3348 if(!
k
->
ign‹e˛
 && !
d©a
->
£t
.ignorecl &&

3349 
	`check¥efix
("C⁄ã¡-Lígth:", 
k
->
p
)) {

3350 
cuæ_off_t
 
c⁄ã¡Àngth
 = 
	`cuæx_°πoof·
(
k
->
p
+15, 
NULL
, 10);

3351 if(
d©a
->
£t
.
max_fûesize
 &&

3352 
c⁄ã¡Àngth
 > 
d©a
->
£t
.
max_fûesize
) {

3353 
	`Áûf
(
d©a
, "Maximum file sizeÉxceeded");

3354  
CURLE_FILESIZE_EXCEEDED
;

3356 if(
c⁄ã¡Àngth
 >= 0) {

3357 
k
->
size
 = 
c⁄ã¡Àngth
;

3358 
k
->
maxdow∆ﬂd
 = k->
size
;

3362 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
k
->
size
);

3368 
	`c⁄n˛o£
(
c⁄n
, "negative content-length");

3369 
	`öfof
(
d©a
, "Neg©ivêc⁄ã¡-Àngth: %" 
CURL_FORMAT_CURL_OFF_T


3370 ", closögá·îÅøns„r\n", 
c⁄ã¡Àngth
);

3374 if(
	`check¥efix
("C⁄ã¡-Ty≥:", 
k
->
p
)) {

3375 *
c⁄ã¡ty≥
 = 
	`Cuæ_c›y_hódî_vÆue
(
k
->
p
);

3376 if(!
c⁄ã¡ty≥
)

3377  
CURLE_OUT_OF_MEMORY
;

3378 if(!*
c⁄ã¡ty≥
)

3380 
	`‰ì
(
c⁄ã¡ty≥
);

3382 
	`Cuæ_ß„‰ì
(
d©a
->
öfo
.
c⁄ã¡ty≥
);

3383 
d©a
->
öfo
.
c⁄ã¡ty≥
 = contenttype;

3386 if(
	`check¥efix
("Sîvî:", 
k
->
p
)) {

3387 *
£rvî_«me
 = 
	`Cuæ_c›y_hódî_vÆue
(
k
->
p
);

3390 if(
c⁄n
->
bundÀ
 && c⁄n->bundÀ->
£rvî_suµ‹ts_pùñöög
) {

3391 if(
	`Cuæ_pùñöe_£rvî_bœckli°ed
(
d©a
, 
£rvî_«me
))

3392 
c⁄n
->
bundÀ
->
£rvî_suµ‹ts_pùñöög
 = 
FALSE
;

3394 
	`Cuæ_ß„‰ì
(
£rvî_«me
);

3396 if((
c⁄n
->
hâpvîsi⁄
 == 10) &&

3397 
c⁄n
->
bôs
.
hâµroxy
 &&

3398 
	`Cuæ_com∑ªhódî
(
k
->
p
,

3406 
	`c⁄nkìp
(
c⁄n
, "Proxy-Connection keep-alive");

3407 
	`öfof
(
d©a
, "HTTP/1.0Öroxy connection setÅo keepálive!\n");

3409 if((
c⁄n
->
hâpvîsi⁄
 == 11) &&

3410 
c⁄n
->
bôs
.
hâµroxy
 &&

3411 
	`Cuæ_com∑ªhódî
(
k
->
p
,

3417 
	`c⁄n˛o£
(
c⁄n
, "Proxy-Connection:áskedÅo closeáfter done");

3418 
	`öfof
(
d©a
, "HTTP/1.1Öroxy connection set close!\n");

3420 if((
c⁄n
->
hâpvîsi⁄
 == 10) &&

3421 
	`Cuæ_com∑ªhódî
(
k
->
p
, "Connection:", "keep-alive")) {

3428 
	`c⁄nkìp
(
c⁄n
, "Connection keep-alive");

3429 
	`öfof
(
d©a
, "HTTP/1.0 connection setÅo keepálive!\n");

3431 if(
	`Cuæ_com∑ªhódî
(
k
->
p
, "Connection:", "close")) {

3438 
	`c⁄n˛o£
(
c⁄n
, "Connection: close used");

3440 if(
	`check¥efix
("Tøns„r-Encodög:", 
k
->
p
)) {

3452 *
°¨t
;

3455 
°¨t
 = 
k
->
p
 + 18;

3459 *
°¨t
 && (
	`ISSPACE
(*start) || (*start == ',')))

3460 
°¨t
++;

3462 if(
	`check¥efix
("chunked", 
°¨t
)) {

3463 
k
->
chunk
 = 
TRUE
;

3466 
	`Cuæ_hâpchunk_öô
(
c⁄n
);

3468 
°¨t
 += 7;

3471 if(
k
->
auto_decodög
)

3475 if(
	`check¥efix
("idítôy", 
°¨t
)) {

3476 
k
->
auto_decodög
 = 
IDENTITY
;

3477 
°¨t
 += 8;

3479 if(
	`check¥efix
("deÊ©e", 
°¨t
)) {

3480 
k
->
auto_decodög
 = 
DEFLATE
;

3481 
°¨t
 += 7;

3483 if(
	`check¥efix
("gzù", 
°¨t
)) {

3484 
k
->
auto_decodög
 = 
GZIP
;

3485 
°¨t
 += 4;

3487 if(
	`check¥efix
("x-gzù", 
°¨t
)) {

3488 
k
->
auto_decodög
 = 
GZIP
;

3489 
°¨t
 += 6;

3491 if(
	`check¥efix
("com¥ess", 
°¨t
)) {

3492 
k
->
auto_decodög
 = 
COMPRESS
;

3493 
°¨t
 += 8;

3495 if(
	`check¥efix
("x-com¥ess", 
°¨t
)) {

3496 
k
->
auto_decodög
 = 
COMPRESS
;

3497 
°¨t
 += 10;

3506 if(
	`check¥efix
("C⁄ã¡-Encodög:", 
k
->
p
) &&

3507 (
d©a
->
£t
.
°r
[
STRING_ENCODING
] ||

3508 
c⁄n
->
hâpvîsi⁄
 == 20)) {

3516 *
°¨t
;

3519 
°¨t
 = 
k
->
p
 + 17;

3520 *
°¨t
 && 
	`ISSPACE
(*start))

3521 
°¨t
++;

3524 if(
	`check¥efix
("idítôy", 
°¨t
))

3525 
k
->
auto_decodög
 = 
IDENTITY
;

3526 if(
	`check¥efix
("deÊ©e", 
°¨t
))

3527 
k
->
auto_decodög
 = 
DEFLATE
;

3528 if(
	`check¥efix
("gzù", 
°¨t
)

3529 || 
	`check¥efix
("x-gzù", 
°¨t
))

3530 
k
->
auto_decodög
 = 
GZIP
;

3531 if(
	`check¥efix
("com¥ess", 
°¨t
)

3532 || 
	`check¥efix
("x-com¥ess", 
°¨t
))

3533 
k
->
auto_decodög
 = 
COMPRESS
;

3535 if(
	`check¥efix
("C⁄ã¡-R™ge:", 
k
->
p
)) {

3545 *
±r
 = 
k
->
p
 + 14;

3548 *
±r
 && !
	`ISDIGIT
(*ptr))

3549 
±r
++;

3551 
k
->
off£t
 = 
	`cuæx_°πoof·
(
±r
, 
NULL
, 10);

3553 if(
d©a
->
°©e
.
ªsume_‰om
 =
k
->
off£t
)

3555 
k
->
c⁄ã¡_ønge
 = 
TRUE
;

3557 #i‡!
	`deföed
(
CURL_DISABLE_COOKIES
)

3558 if(
d©a
->
cookõs
 &&

3559 
	`check¥efix
("Së-Cookõ:", 
k
->
p
)) {

3560 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
,

3561 
CURL_LOCK_ACCESS_SINGLE
);

3562 
	`Cuæ_cookõ_add
(
d©a
,

3563 
d©a
->
cookõs
, 
TRUE
, 
k
->
p
+11,

3566 
c⁄n
->
Ælo˝å
.
cookõho°
?

3567 
c⁄n
->
Ælo˝å
.
cookõho°
:c⁄n->
ho°
.
«me
,

3568 
d©a
->
°©e
.
∑th
);

3569 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
);

3572 if(
	`check¥efix
("La°-Modifõd:", 
k
->
p
) &&

3573 (
d©a
->
£t
.
timec⁄dôi⁄
 || d©a->£t.
gë_fûëime
) ) {

3574 
time_t
 
£cs
=
	`time
(
NULL
);

3575 
k
->
timeofdoc
 = 
	`cuæ_gëd©e
(k->
p
+
	`°æí
("Last-Modified:"),

3576 &
£cs
);

3577 if(
d©a
->
£t
.
gë_fûëime
)

3578 
d©a
->
öfo
.
fûëime
 = ()
k
->
timeofdoc
;

3580 if((
	`check¥efix
("WWW-Authítiˇã:", 
k
->
p
) &&

3581 (401 =
k
->
hâpcode
)) ||

3582 (
	`check¥efix
("Proxy-authítiˇã:", 
k
->
p
) &&

3583 (407 =
k
->
hâpcode
))) {

3585 
boﬁ
 
¥oxy
 = (
k
->
hâpcode
 =407Ë? 
TRUE
 : 
FALSE
;

3586 *
auth
 = 
	`Cuæ_c›y_hódî_vÆue
(
k
->
p
);

3587 if(!
auth
)

3588  
CURLE_OUT_OF_MEMORY
;

3590 
ªsu…
 = 
	`Cuæ_hâp_öput_auth
(
c⁄n
, 
¥oxy
, 
auth
);

3592 
	`Cuæ_ß„‰ì
(
auth
);

3594 if(
ªsu…
)

3595  
ªsu…
;

3597 if((
k
->
hâpcode
 >= 300 && k->httpcode < 400) &&

3598 
	`check¥efix
("Loˇti⁄:", 
k
->
p
) &&

3599 !
d©a
->
ªq
.
loˇti⁄
) {

3601 *
loˇti⁄
 = 
	`Cuæ_c›y_hódî_vÆue
(
k
->
p
);

3602 if(!
loˇti⁄
)

3603  
CURLE_OUT_OF_MEMORY
;

3604 if(!*
loˇti⁄
)

3606 
	`‰ì
(
loˇti⁄
);

3608 
d©a
->
ªq
.
loˇti⁄
 =Üocation;

3610 if(
d©a
->
£t
.
hâp_fﬁlow_loˇti⁄
) {

3611 
	`DEBUGASSERT
(!
d©a
->
ªq
.
√wuæ
);

3612 
d©a
->
ªq
.
√wuæ
 = 
	`°rdup
(d©a->ªq.
loˇti⁄
);

3613 if(!
d©a
->
ªq
.
√wuæ
)

3614  
CURLE_OUT_OF_MEMORY
;

3618 
ªsu…
 = 
	`hâp_≥rh≠§ewöd
(
c⁄n
);

3619 if(
ªsu…
)

3620  
ªsu…
;

3624 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
CURLPROTO_RTSP
) {

3625 
ªsu…
 = 
	`Cuæ_π•_∑r£hódî
(
c⁄n
, 
k
->
p
);

3626 if(
ªsu…
)

3627  
ªsu…
;

3634 
wrôëy≥
 = 
CLIENTWRITE_HEADER
;

3635 if(
d©a
->
£t
.
ö˛ude_hódî
)

3636 
wrôëy≥
 |
CLIENTWRITE_BODY
;

3638 if(
d©a
->
£t
.
vîbo£
)

3639 
	`Cuæ_debug
(
d©a
, 
CURLINFO_HEADER_IN
,

3640 
k
->
p
, (
size_t
)k->
hbuÊí
, 
c⁄n
);

3642 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
wrôëy≥
, 
k
->
p
, k->
hbuÊí
);

3643 if(
ªsu…
)

3644  
ªsu…
;

3646 
d©a
->
öfo
.
hódî_size
 +()
k
->
hbuÊí
;

3647 
d©a
->
ªq
.
hódîbyãcou¡
 +()
k
->
hbuÊí
;

3650 
k
->
hbuÂ
 = 
d©a
->
°©e
.
hódîbuff
;

3651 
k
->
hbuÊí
 = 0;

3653 !*
°›_ªadög
 && *
k
->
°r
);

3659  
CURLE_OK
;

3660 
	}
}

	@lib/http.h

1 #i‚de‡
HEADER_CURL_HTTP_H


2 
	#HEADER_CURL_HTTP_H


	)

24 
	~"cuæ_£tup.h
"

26 #i‚de‡
CURL_DISABLE_HTTP


28 #ifde‡
USE_NGHTTP2


29 
	~<nghâp2/nghâp2.h
>

32 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_hâp
;

34 #ifde‡
USE_SSL


35 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_hâps
;

39 
boﬁ
 
Cuæ_com∑ªhódî
(c⁄° *
hódîlöe
,

40 c⁄° *
hódî
,

41 c⁄° *
c⁄ã¡
);

43 *
Cuæ_checkhódîs
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

44 c⁄° *
thishódî
);

45 *
Cuæ_c›y_hódî_vÆue
(c⁄° *
hódî
);

47 *
Cuæ_checkProxyhódîs
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

48 c⁄° *
thishódî
);

55 
	sCuæ_£nd_buf„r
 {

56 *
	mbuf„r
;

57 
size_t
 
	msize_max
;

58 
size_t
 
	msize_u£d
;

60 
Cuæ_£nd_buf„r
 
	tCuæ_£nd_buf„r
;

62 
Cuæ_£nd_buf„r
 *
Cuæ_add_buf„r_öô
();

63 
CURLcode
 
Cuæ_add_buf„rf
(
Cuæ_£nd_buf„r
 *
ö
, c⁄° *
fmt
, ...);

64 
CURLcode
 
Cuæ_add_buf„r
(
Cuæ_£nd_buf„r
 *
ö
, c⁄° *
ö±r
, 
size_t
 
size
);

65 
CURLcode
 
Cuæ_add_buf„r_£nd
(
Cuæ_£nd_buf„r
 *
ö
,

66 
c⁄√˘d©a
 *
c⁄n
,

67 *
byãs_wrôãn
,

68 
size_t
 
ö˛uded_body_byãs
,

69 
sockëödex
);

71 
CURLcode
 
Cuæ_add_timec⁄dôi⁄
(
Sessi⁄H™dÀ
 *
d©a
,

72 
Cuæ_£nd_buf„r
 *
buf
);

73 
CURLcode
 
Cuæ_add_cu°om_hódîs
(
c⁄√˘d©a
 *
c⁄n
,

74 
boﬁ
 
is_c⁄√˘
,

75 
Cuæ_£nd_buf„r
 *
ªq_buf„r
);

78 
CURLcode
 
Cuæ_hâp
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

79 
CURLcode
 
Cuæ_hâp_d⁄e
(
c⁄√˘d©a
 *, CURLcode, 
boﬁ
 
¥em©uª
);

80 
CURLcode
 
Cuæ_hâp_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

81 
CURLcode
 
Cuæ_hâp_£tup_c⁄n
(
c⁄√˘d©a
 *
c⁄n
);

84 
Cuæ_hâpchunk_öô
(
c⁄√˘d©a
 *
c⁄n
);

85 
CHUNKcode
 
Cuæ_hâpchunk_ªad
(
c⁄√˘d©a
 *
c⁄n
, *
d©≠
,

86 
ssize_t
 
Àngth
, ssize_à*
wrŸe
);

89 
Cuæ_hâp_auth_°age
(
Sessi⁄H™dÀ
 *
d©a
, 
°age
);

90 
CURLcode
 
Cuæ_hâp_öput_auth
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
,

91 c⁄° *
auth
);

92 
CURLcode
 
Cuæ_hâp_auth_a˘
(
c⁄√˘d©a
 *
c⁄n
);

93 
CURLcode
 
Cuæ_hâp_≥rh≠§ewöd
(
c⁄√˘d©a
 *
c⁄n
);

99 
	#CURLAUTH_PICKNONE
 (1<<30Ë

	)

113 #i‚de‡
MAX_INITIAL_POST_SIZE


114 
	#MAX_INITIAL_POST_SIZE
 (64*1024)

	)

117 #i‚de‡
TINY_INITIAL_POST_SIZE


118 
	#TINY_INITIAL_POST_SIZE
 1024

	)

126 
	sHTTP
 {

127 
F‹mD©a
 *
	m£ndô
;

128 
cuæ_off_t
 
	mpo°size
;

129 c⁄° *
	mpo°d©a
;

131 c⁄° *
	mp_¥agma
;

132 c⁄° *
	mp_ac˚±
;

133 
cuæ_off_t
 
	mªadbyãcou¡
;

134 
cuæ_off_t
 
	mwrôebyãcou¡
;

137 
F‹m
 
	mf‹m
;

139 
	sback
 {

140 
cuæ_ªad_ˇŒback
 
	m‰ód_func
;

141 *
	m‰ód_ö
;

142 c⁄° *
	mpo°d©a
;

143 
cuæ_off_t
 
	mpo°size
;

144 } 
	mbackup
;

147 
	mHTTPSEND_NADA
,

148 
	mHTTPSEND_REQUEST
,

149 
	mHTTPSEND_BODY
,

150 
	mHTTPSEND_LAST


151 } 
	m£ndög
;

153 *
	m£nd_buf„r
;

157 (*
	t£ndög
)();

158 (*
	tªcvög
)();

160 
	shâp_c⁄n
 {

161 #ifde‡
USE_NGHTTP2


162 
	#H2_BINSETTINGS_LEN
 80

	)

163 
nghâp2_£ssi⁄
 *
h2
;

164 
uöt8_t
 
bö£âögs
[
H2_BINSETTINGS_LEN
];

165 
size_t
 
böÀn
;

166 *
mem
;

167 
size_t
 
Àn
;

168 
boﬁ
 
body°¨ãd
;

169 
£ndög
 
£nd_undîlyög
;

170 
ªcvög
 
ªcv_undîlyög
;

171 
boﬁ
 
˛o£d
;

172 
Cuæ_£nd_buf„r
 *
hódî_ªcvbuf
;

173 
size_t
 
ƒód_hódî_ªcvbuf
;

175 
öt32_t
 
°ªam_id
;

176 c⁄° 
uöt8_t
 *
d©a
;

178 
size_t
 
d©Æí
;

179 *
öbuf
;

185 c⁄° 
uöt8_t
 *
u∂ﬂd_mem
;

186 
size_t
 
u∂ﬂd_Àn
;

187 
size_t
 
u∂ﬂd_À·
;

189 
unu£d
;

193 
CURLcode
 
	`Cuæ_hâp_ªadwrôe_hódîs
(
Sessi⁄H™dÀ
 *
d©a
,

194 
c⁄√˘d©a
 *
c⁄n
,

195 
ssize_t
 *
ƒód
,

196 
boﬁ
 *
°›_ªadög
);

212 
CURLcode


213 
	`Cuæ_hâp_ouçut_auth
(
c⁄√˘d©a
 *
c⁄n
,

214 c⁄° *
ªque°
,

215 c⁄° *
∑th
,

216 
boﬁ
 
¥oxytu¬ñ
);

	@lib/http2.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
USE_NGHTTP2


26 
	#_MPRINTF_REPLACE


	)

27 
	~<cuæ/m¥ötf.h
>

29 
	~<nghâp2/nghâp2.h
>

30 
	~"uæd©a.h
"

31 
	~"hâp2.h
"

32 
	~"hâp.h
"

33 
	~"£ndf.h
"

34 
	~"cuæ_ba£64.h
"

35 
	~"cuæ_mem‹y.h
"

36 
	~"øw°r.h
"

37 
	~"mu…iif.h
"

40 
	~"memdebug.h
"

42 #i‡(
NGHTTP2_VERSION_NUM
 < 0x000300)

43 #îr‹ 
too
 
ﬁd
 
nghâp2
 
vîsi⁄
, 
upgøde
!

46 
	$hâp2_≥rf‹m_gësock
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

47 
cuæ_sockë_t
 *
sock
,

51 
numsocks
)

53 c⁄° 
hâp_c⁄n
 *
hâpc
 = &
c⁄n
->
¥Ÿo
.httpc;

54 
bôm≠
 = 
GETSOCK_BLANK
;

55 ()
numsocks
;

59 
sock
[0] = 
c⁄n
->sock[
FIRSTSOCKET
];

61 if(
	`nghâp2_£ssi⁄_w™t_ªad
(
hâpc
->
h2
))

62 
bôm≠
 |
	`GETSOCK_READSOCK
(
FIRSTSOCKET
);

64 if(
	`nghâp2_£ssi⁄_w™t_wrôe
(
hâpc
->
h2
))

65 
bôm≠
 |
	`GETSOCK_WRITESOCK
(
FIRSTSOCKET
);

67  
bôm≠
;

68 
	}
}

70 
	$hâp2_gësock
(
c⁄√˘d©a
 *
c⁄n
,

71 
cuæ_sockë_t
 *
sock
,

73 
numsocks
)

75  
	`hâp2_≥rf‹m_gësock
(
c⁄n
, 
sock
, 
numsocks
);

76 
	}
}

78 
CURLcode
 
	$hâp2_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

79 
boﬁ
 
dód_c⁄√˘i⁄
)

81 
hâp_c⁄n
 *
hâpc
 = &
c⁄n
->
¥Ÿo
.httpc;

82 ()
dód_c⁄√˘i⁄
;

84 
	`öfof
(
c⁄n
->
d©a
, "HTTP/2 DISCONNECT startsÇow\n");

86 
	`nghâp2_£ssi⁄_dñ
(
hâpc
->
h2
);

88 
	`Cuæ_ß„‰ì
(
hâpc
->
hódî_ªcvbuf
->
buf„r
);

89 
	`Cuæ_ß„‰ì
(
hâpc
->
hódî_ªcvbuf
);

91 
	`Cuæ_ß„‰ì
(
hâpc
->
öbuf
);

93 
	`öfof
(
c⁄n
->
d©a
, "HTTP/2 DISCONNECT done\n");

95  
CURLE_OK
;

96 
	}
}

103 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_hâp2
 = {

105 
ZERO_NULL
,

106 
Cuæ_hâp
,

107 
ZERO_NULL
,

108 
ZERO_NULL
,

109 
ZERO_NULL
,

110 
ZERO_NULL
,

111 
ZERO_NULL
,

112 
hâp2_gësock
,

113 
hâp2_gësock
,

114 
ZERO_NULL
,

115 
hâp2_≥rf‹m_gësock
,

116 
hâp2_disc⁄√˘
,

117 
ZERO_NULL
,

118 
PORT_HTTP
,

119 
CURLPROTO_HTTP
,

120 
PROTOPT_NONE


123 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_hâp2_s¶
 = {

125 
ZERO_NULL
,

126 
Cuæ_hâp
,

127 
ZERO_NULL
,

128 
ZERO_NULL
,

129 
ZERO_NULL
,

130 
ZERO_NULL
,

131 
ZERO_NULL
,

132 
hâp2_gësock
,

133 
hâp2_gësock
,

134 
ZERO_NULL
,

135 
hâp2_≥rf‹m_gësock
,

136 
hâp2_disc⁄√˘
,

137 
ZERO_NULL
,

138 
PORT_HTTP
,

139 
CURLPROTO_HTTPS
,

140 
PROTOPT_SSL


147 
	$Cuæ_hâp2_vî
(*
p
, 
size_t
 
Àn
)

149 
nghâp2_öfo
 *
h2
 = 
	`nghâp2_vîsi⁄
(0);

150  
	`¢¥ötf
(
p
, 
Àn
, "Çghâp2/%s", 
h2
->
vîsi⁄_°r
);

151 
	}
}

158 
ssize_t
 
	$£nd_ˇŒback
(
nghâp2_£ssi⁄
 *
h2
,

159 c⁄° 
uöt8_t
 *
d©a
, 
size_t
 
Àngth
, 
Êags
,

160 *
u£Ω
)

162 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

163 
hâp_c⁄n
 *
hâpc
 = &
c⁄n
->
¥Ÿo
.httpc;

164 
ssize_t
 
wrôãn
;

165 
CURLcode
 
rc
;

166 ()
h2
;

167 ()
Êags
;

169 
rc
 = 0;

170 
wrôãn
 = ((
Cuæ_£nd
*)
hâpc
->
£nd_undîlyög
)(
c⁄n
, 
FIRSTSOCKET
,

171 
d©a
, 
Àngth
, &
rc
);

173 if(
rc
 =
CURLE_AGAIN
) {

174  
NGHTTP2_ERR_WOULDBLOCK
;

177 if(
wrôãn
 == -1) {

178 
	`Áûf
(
c⁄n
->
d©a
, "Failed sending HTTP2 data");

179  
NGHTTP2_ERR_CALLBACK_FAILURE
;

182 if(!
wrôãn
)

183  
NGHTTP2_ERR_WOULDBLOCK
;

185  
wrôãn
;

186 
	}
}

188 
	$⁄_‰ame_ªcv
(
nghâp2_£ssi⁄
 *
£ssi⁄
, c⁄° 
nghâp2_‰ame
 *
‰ame
,

189 *
u£Ω
)

191 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

192 
hâp_c⁄n
 *
c
 = &
c⁄n
->
¥Ÿo
.
hâpc
;

193 
rv
;

194 ()
£ssi⁄
;

195 ()
‰ame
;

196 
	`öfof
(
c⁄n
->
d©a
, "on_frame_recv() was called with header %x\n",

197 
‰ame
->
hd
.
ty≥
);

198 
‰ame
->
hd
.
ty≥
) {

199 
NGHTTP2_HEADERS
:

200 if(
‰ame
->
hódîs
.
ˇt
 !
NGHTTP2_HCAT_RESPONSE
)

202 
c
->
body°¨ãd
 = 
TRUE
;

203 
	`Cuæ_add_buf„r
(
c
->
hódî_ªcvbuf
, "\r\n", 2);

204 
c
->
ƒód_hódî_ªcvbuf
 = c->
Àn
 < c->
hódî_ªcvbuf
->
size_u£d
 ?

205 
c
->
Àn
 : c->
hódî_ªcvbuf
->
size_u£d
;

207 
	`mem˝y
(
c
->
mem
, c->
hódî_ªcvbuf
->
buf„r
, c->
ƒód_hódî_ªcvbuf
);

209 
c
->
mem
 +c->
ƒód_hódî_ªcvbuf
;

210 
c
->
Àn
 -c->
ƒód_hódî_ªcvbuf
;

212 
NGHTTP2_PUSH_PROMISE
:

213 
rv
 = 
	`nghâp2_submô_r°_°ªam
(
£ssi⁄
, 
NGHTTP2_FLAG_NONE
,

214 
‰ame
->
hd
.
°ªam_id
, 
NGHTTP2_CANCEL
);

215 if(
	`nghâp2_is_Áèl
(
rv
)) {

216  
rv
;

221 
	}
}

223 
	$⁄_övÆid_‰ame_ªcv
(
nghâp2_£ssi⁄
 *
£ssi⁄
,

224 c⁄° 
nghâp2_‰ame
 *
‰ame
,

225 
nghâp2_îr‹_code
 
îr‹_code
, *
u£Ω
)

227 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

228 ()
£ssi⁄
;

229 ()
‰ame
;

230 
	`öfof
(
c⁄n
->
d©a
, "on_invalid_frame_recv() was called,Érror_code = %d\n",

231 
îr‹_code
);

233 
	}
}

235 
	$⁄_d©a_chunk_ªcv
(
nghâp2_£ssi⁄
 *
£ssi⁄
, 
uöt8_t
 
Êags
,

236 
öt32_t
 
°ªam_id
,

237 c⁄° 
uöt8_t
 *
d©a
, 
size_t
 
Àn
, *
u£Ω
)

239 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

240 
hâp_c⁄n
 *
c
 = &
c⁄n
->
¥Ÿo
.
hâpc
;

241 
size_t
 
ƒód
;

242 ()
£ssi⁄
;

243 ()
Êags
;

244 ()
d©a
;

245 
	`öfof
(
c⁄n
->
d©a
, "on_data_chunk_recv() "

246 "À¿%u, såóm = %x\n", 
Àn
, 
°ªam_id
);

248 if(
°ªam_id
 !
c
->stream_id) {

252 
ƒód
 = 
c
->
Àn
 <Üen ? c->len :Üen;

253 
	`mem˝y
(
c
->
mem
, 
d©a
, 
ƒód
);

255 
c
->
mem
 +
ƒód
;

256 
c
->
Àn
 -
ƒód
;

258 
	`öfof
(
c⁄n
->
d©a
, "%zu d©®wrôãn\n", 
ƒód
);

260 if(
ƒód
 < 
Àn
) {

261 
c
->
d©a
 = d©®+ 
ƒód
;

262 
c
->
d©Æí
 = 
Àn
 - 
ƒód
;

263  
NGHTTP2_ERR_PAUSE
;

266 
	}
}

268 
	$bef‹e_‰ame_£nd
(
nghâp2_£ssi⁄
 *
£ssi⁄
,

269 c⁄° 
nghâp2_‰ame
 *
‰ame
,

270 *
u£Ω
)

272 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

273 ()
£ssi⁄
;

274 ()
‰ame
;

275 
	`öfof
(
c⁄n
->
d©a
, "before_frame_send() was called\n");

277 
	}
}

278 
	$⁄_‰ame_£nd
(
nghâp2_£ssi⁄
 *
£ssi⁄
,

279 c⁄° 
nghâp2_‰ame
 *
‰ame
,

280 *
u£Ω
)

282 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

283 ()
£ssi⁄
;

284 ()
‰ame
;

285 
	`öfof
(
c⁄n
->
d©a
, "on_frame_send() was called\n");

287 
	}
}

288 
	$⁄_‰ame_nŸ_£nd
(
nghâp2_£ssi⁄
 *
£ssi⁄
,

289 c⁄° 
nghâp2_‰ame
 *
‰ame
,

290 
lib_îr‹_code
, *
u£Ω
)

292 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

293 ()
£ssi⁄
;

294 ()
‰ame
;

295 
	`öfof
(
c⁄n
->
d©a
, "on_frame_not_send() was called,Üib_error_code = %d\n",

296 
lib_îr‹_code
);

298 
	}
}

299 
	$⁄_°ªam_˛o£
(
nghâp2_£ssi⁄
 *
£ssi⁄
, 
öt32_t
 
°ªam_id
,

300 
nghâp2_îr‹_code
 
îr‹_code
, *
u£Ω
)

302 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

303 
hâp_c⁄n
 *
c
 = &
c⁄n
->
¥Ÿo
.
hâpc
;

304 ()
£ssi⁄
;

305 ()
°ªam_id
;

306 
	`öfof
(
c⁄n
->
d©a
, "on_stream_close() was called,Érror_code = %d\n",

307 
îr‹_code
);

309 if(
°ªam_id
 !
c
->stream_id) {

313 
c
->
˛o£d
 = 
TRUE
;

316 
	}
}

318 
	$⁄_unknown_‰ame_ªcv
(
nghâp2_£ssi⁄
 *
£ssi⁄
,

319 c⁄° 
uöt8_t
 *
hód
, 
size_t
 
hódÀn
,

320 c⁄° 
uöt8_t
 *
∑ylﬂd
, 
size_t
 
∑ylﬂdÀn
,

321 *
u£Ω
)

323 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

324 ()
£ssi⁄
;

325 ()
hód
;

326 ()
hódÀn
;

327 ()
∑ylﬂd
;

328 ()
∑ylﬂdÀn
;

329 
	`öfof
(
c⁄n
->
d©a
, "on_unknown_frame_recv() was called\n");

331 
	}
}

332 
	$⁄_begö_hódîs
(
nghâp2_£ssi⁄
 *
£ssi⁄
,

333 c⁄° 
nghâp2_‰ame
 *
‰ame
, *
u£Ω
)

335 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

336 ()
£ssi⁄
;

337 ()
‰ame
;

338 
	`öfof
(
c⁄n
->
d©a
, "on_begin_headers() was called\n");

340 
	}
}

342 c⁄° 
	gSTATUS
[] = ":status";

345 
	$⁄_hódî
(
nghâp2_£ssi⁄
 *
£ssi⁄
, c⁄° 
nghâp2_‰ame
 *
‰ame
,

346 c⁄° 
uöt8_t
 *
«me
, 
size_t
 
«mñí
,

347 c⁄° 
uöt8_t
 *
vÆue
, 
size_t
 
vÆuñí
,

348 
uöt8_t
 
Êags
,

349 *
u£Ω
)

351 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

352 
hâp_c⁄n
 *
c
 = &
c⁄n
->
¥Ÿo
.
hâpc
;

353 ()
£ssi⁄
;

354 ()
‰ame
;

355 ()
Êags
;

357 if(
‰ame
->
hd
.
°ªam_id
 !
c
->stream_id) {

361 if(
«mñí
 == (":status") - 1 &&

362 
	`memcmp
(
STATUS
, 
«me
, 
«mñí
) == 0) {

363 
	`¢¥ötf
(
c
->
hódî_ªcvbuf
->
buf„r
, 13, "HTTP/2.0 %s", 
vÆue
);

364 
c
->
hódî_ªcvbuf
->
buf„r
[12] = '\r';

369 
	`öfof
(
c⁄n
->
d©a
, "got header\n");

370 
	`Cuæ_add_buf„r
(
c
->
hódî_ªcvbuf
, 
«me
, 
«mñí
);

371 
	`Cuæ_add_buf„r
(
c
->
hódî_ªcvbuf
, ":", 1);

372 
	`Cuæ_add_buf„r
(
c
->
hódî_ªcvbuf
, 
vÆue
, 
vÆuñí
);

373 
	`Cuæ_add_buf„r
(
c
->
hódî_ªcvbuf
, "\r\n", 2);

377 
	}
}

382 c⁄° 
nghâp2_£ssi⁄_ˇŒbacks
 
	gˇŒbacks
 = {

383 
£nd_ˇŒback
,

384 
NULL
,

385 
⁄_‰ame_ªcv
,

386 
⁄_övÆid_‰ame_ªcv
,

387 
⁄_d©a_chunk_ªcv
,

388 
bef‹e_‰ame_£nd
,

389 
⁄_‰ame_£nd
,

390 
⁄_‰ame_nŸ_£nd
,

391 
⁄_°ªam_˛o£
,

392 
⁄_unknown_‰ame_ªcv
,

393 
⁄_begö_hódîs
,

394 
⁄_hódî


395 #i‡
NGHTTP2_VERSION_NUM
 >= 0x000400

396 , 
NULL


400 
ssize_t
 
	$d©a_sour˚_ªad_ˇŒback
(
nghâp2_£ssi⁄
 *
£ssi⁄
,

401 
öt32_t
 
°ªam_id
,

402 
uöt8_t
 *
buf
, 
size_t
 
Àngth
,

403 
uöt32_t
 *
d©a_Êags
,

404 
nghâp2_d©a_sour˚
 *
sour˚
,

405 *
u£Ω
)

407 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
u£Ω
;

408 
hâp_c⁄n
 *
c
 = &
c⁄n
->
¥Ÿo
.
hâpc
;

409 
size_t
 
ƒód
;

410 ()
£ssi⁄
;

411 ()
°ªam_id
;

412 ()
sour˚
;

414 
ƒód
 = 
c
->
u∂ﬂd_Àn
 < 
Àngth
 ? c->upload_len :Üength;

415 if(
ƒód
 > 0) {

416 
	`mem˝y
(
buf
, 
c
->
u∂ﬂd_mem
, 
ƒód
);

417 
c
->
u∂ﬂd_mem
 +
ƒód
;

418 
c
->
u∂ﬂd_Àn
 -
ƒód
;

419 
c
->
u∂ﬂd_À·
 -
ƒód
;

422 if(
c
->
u∂ﬂd_À·
 == 0)

423 *
d©a_Êags
 = 1;

424 if(
ƒód
 == 0)

425  
NGHTTP2_ERR_DEFERRED
;

427  
ƒód
;

428 
	}
}

433 
nghâp2_£âögs_íåy
 
	g£âögs
[] = {

434 { 
NGHTTP2_SETTINGS_MAX_CONCURRENT_STREAMS
, 100 },

435 { 
NGHTTP2_SETTINGS_INITIAL_WINDOW_SIZE
, 
NGHTTP2_INITIAL_WINDOW_SIZE
 },

438 
	#H2_BUFSIZE
 4096

	)

443 
CURLcode
 
	$Cuæ_hâp2_öô
(
c⁄√˘d©a
 *
c⁄n
)

445 if(!
c⁄n
->
¥Ÿo
.
hâpc
.
h2
) {

446 
rc
;

447 
c⁄n
->
¥Ÿo
.
hâpc
.
öbuf
 = 
	`mÆloc
(
H2_BUFSIZE
);

448 if(
c⁄n
->
¥Ÿo
.
hâpc
.
öbuf
 =
NULL
)

449  
CURLE_OUT_OF_MEMORY
;

452 
rc
 = 
	`nghâp2_£ssi⁄_˛õ¡_√w
(&
c⁄n
->
¥Ÿo
.
hâpc
.
h2
,

453 &
ˇŒbacks
, 
c⁄n
);

454 if(
rc
) {

455 
	`Áûf
(
c⁄n
->
d©a
, "Couldn't initializeÇghttp2!");

456  
CURLE_OUT_OF_MEMORY
;

459  
CURLE_OK
;

460 
	}
}

465 
CURLcode
 
	$Cuæ_hâp2_£nd_ªque°
(
c⁄√˘d©a
 *
c⁄n
)

467 ()
c⁄n
;

468  
CURLE_OK
;

469 
	}
}

474 
CURLcode
 
	$Cuæ_hâp2_ªque°_upgøde
(
Cuæ_£nd_buf„r
 *
ªq
,

475 
c⁄√˘d©a
 *
c⁄n
)

477 
CURLcode
 
ªsu…
;

478 
ssize_t
 
böÀn
;

479 *
ba£64
;

480 
size_t
 
bÀn
;

481 
SögÀReque°
 *
k
 = &
c⁄n
->
d©a
->
ªq
;

482 
uöt8_t
 *
bö£âögs
 = 
c⁄n
->
¥Ÿo
.
hâpc
.binsettings;

484 
ªsu…
 = 
	`Cuæ_hâp2_öô
(
c⁄n
);

485 if(
ªsu…
)

486  
ªsu…
;

488 
ªsu…
 = 
	`Cuæ_hâp2_£tup
(
c⁄n
);

489 if(
ªsu…
)

490  
ªsu…
;

498 
böÀn
 = 
	`nghâp2_∑ck_£âögs_∑ylﬂd
(
bö£âögs
, 
H2_BINSETTINGS_LEN
,

499 
£âögs
,

500 (
£âögs
)/(settings[0]));

501 if(!
böÀn
) {

502 
	`Áûf
(
c⁄n
->
d©a
, "nghttp2 unexpectedly failed onÖack_settings_payload");

503  
CURLE_FAILED_INIT
;

505 
c⁄n
->
¥Ÿo
.
hâpc
.
böÀn
 = binlen;

507 
ªsu…
 = 
	`Cuæ_ba£64_ícode
(
c⁄n
->
d©a
, (c⁄° *)
bö£âögs
, 
böÀn
,

508 &
ba£64
, &
bÀn
);

509 if(
ªsu…
)

510  
ªsu…
;

512 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq
,

516 
NGHTTP2_CLEARTEXT_PROTO_VERSION_ID
, 
ba£64
);

517 
	`Cuæ_ß„‰ì
(
ba£64
);

519 
k
->
upgr101
 = 
UPGR101_REQUESTED
;

521  
ªsu…
;

522 
	}
}

528 
ssize_t
 
	$hâp2_ªcv
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

529 *
mem
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

531 
CURLcode
 
rc
;

532 
ssize_t
 
rv
;

533 
ssize_t
 
ƒód
;

534 
hâp_c⁄n
 *
hâpc
 = &
c⁄n
->
¥Ÿo
.httpc;

536 ()
socködex
;

538 if(
hâpc
->
˛o£d
) {

544 
hâpc
->
u∂ﬂd_mem
 = 
NULL
;

545 
hâpc
->
u∂ﬂd_Àn
 = 0;

547 if(
hâpc
->
body°¨ãd
 &&

548 
hâpc
->
ƒód_hódî_ªcvbuf
 < hâpc->
hódî_ªcvbuf
->
size_u£d
) {

549 
size_t
 
À·
 =

550 
hâpc
->
hódî_ªcvbuf
->
size_u£d
 - hâpc->
ƒód_hódî_ªcvbuf
;

551 
size_t
 
nc›y
 = 
Àn
 < 
À·
 ?Üen :Üeft;

552 
	`mem˝y
(
mem
, 
hâpc
->
hódî_ªcvbuf
->
buf„r
 + hâpc->
ƒód_hódî_ªcvbuf
,

553 
nc›y
);

554 
hâpc
->
ƒód_hódî_ªcvbuf
 +
nc›y
;

555  
nc›y
;

558 if(
hâpc
->
d©a
) {

559 
ƒód
 = 
Àn
 < 
hâpc
->
d©Æí
 ?Üen : httpc->datalen;

560 
	`mem˝y
(
mem
, 
hâpc
->
d©a
, 
ƒód
);

562 
hâpc
->
d©a
 +
ƒód
;

563 
hâpc
->
d©Æí
 -
ƒód
;

565 
	`öfof
(
c⁄n
->
d©a
, "%zu d©®wrôãn\n", 
ƒód
);

566 if(
hâpc
->
d©Æí
 == 0) {

567 
hâpc
->
d©a
 = 
NULL
;

568 
hâpc
->
d©Æí
 = 0;

570  
ƒód
;

573 
c⁄n
->
¥Ÿo
.
hâpc
.
mem
 = mem;

574 
c⁄n
->
¥Ÿo
.
hâpc
.
Àn
 =Üen;

576 
	`öfof
(
c⁄n
->
d©a
, "http2_recv: %d bytes buffer\n",

577 
c⁄n
->
¥Ÿo
.
hâpc
.
Àn
);

579 
rc
 = 0;

580 
ƒód
 = ((
Cuæ_ªcv
*)
hâpc
->
ªcv_undîlyög
)(
c⁄n
, 
FIRSTSOCKET
,

581 
hâpc
->
öbuf
, 
H2_BUFSIZE
, &
rc
);

583 if(
rc
 =
CURLE_AGAIN
) {

584 *
îr
 = 
rc
;

588 if(
ƒód
 == -1) {

589 
	`Áûf
(
c⁄n
->
d©a
, "FailedÑeceiving HTTP2 data");

590 *
îr
 = 
rc
;

594 
	`öfof
(
c⁄n
->
d©a
, "ƒód=%zd\n", 
ƒód
);

595 
rv
 = 
	`nghâp2_£ssi⁄_mem_ªcv
(
hâpc
->
h2
,

596 (c⁄° 
uöt8_t
 *)
hâpc
->
öbuf
, 
ƒód
);

598 if(
	`nghâp2_is_Áèl
(()
rv
)) {

599 
	`Áûf
(
c⁄n
->
d©a
, "nghttp2_session_mem_recv()Ñeturned %d:%s\n",

600 
rv
, 
	`nghâp2_°ªº‹
(()rv));

601 *
îr
 = 
CURLE_RECV_ERROR
;

604 
	`öfof
(
c⁄n
->
d©a
, "nghâp2_£ssi⁄_mem_ªcv(Ëªtu∫†%zd\n", 
rv
);

607 
rv
 = 
	`nghâp2_£ssi⁄_£nd
(
hâpc
->
h2
);

608 if(
rv
 != 0) {

609 *
îr
 = 
CURLE_SEND_ERROR
;

612 if(
Àn
 !
hâpc
->len) {

613  
Àn
 - 
c⁄n
->
¥Ÿo
.
hâpc
.len;

617 if(
hâpc
->
˛o£d
) {

620 *
îr
 = 
CURLE_AGAIN
;

622 
	}
}

625 
ssize_t
 
	$hâp2_£nd
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

626 c⁄° *
mem
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

633 
rv
;

634 
hâp_c⁄n
 *
hâpc
 = &
c⁄n
->
¥Ÿo
.httpc;

635 
nghâp2_nv
 *
nva
;

636 
size_t
 
nhódî
;

637 
size_t
 
i
;

638 *
hdbuf
 = (*)
mem
;

639 *
íd
;

640 
nghâp2_d©a_¥ovidî
 
d©a_¥d
;

641 
öt32_t
 
°ªam_id
;

643 ()
socködex
;

645 
	`öfof
(
c⁄n
->
d©a
, "hâp2_£ndÜí=%zu\n", 
Àn
);

647 if(
hâpc
->
°ªam_id
 != -1) {

650 
hâpc
->
u∂ﬂd_mem
 = 
mem
;

651 
hâpc
->
u∂ﬂd_Àn
 = 
Àn
;

652 
	`nghâp2_£ssi⁄_ªsume_d©a
(
hâpc
->
h2
, hâpc->
°ªam_id
);

653 
rv
 = 
	`nghâp2_£ssi⁄_£nd
(
hâpc
->
h2
);

654 if(
	`nghâp2_is_Áèl
(
rv
)) {

655 *
îr
 = 
CURLE_SEND_ERROR
;

658  
Àn
 - 
hâpc
->
u∂ﬂd_Àn
;

664 
nhódî
 = 0;

665 
i
 = 0; i < 
Àn
; ++i) {

666 if(
hdbuf
[
i
] == 0x0a) {

667 ++
nhódî
;

673 
nhódî
 += 1;

674 
nva
 = 
	`mÆloc
((
nghâp2_nv
Ë* 
nhódî
);

675 if(
nva
 =
NULL
) {

676 *
îr
 = 
CURLE_OUT_OF_MEMORY
;

680 
íd
 = 
	`°rchr
(
hdbuf
, ' ');

681 
nva
[0].
«me
 = (*)":method";

682 
nva
[0].
«mñí
 = (
uöt16_t
)
	`°æí
((*Íva[0].
«me
);

683 
nva
[0].
vÆue
 = (*)
hdbuf
;

684 
nva
[0].
vÆuñí
 = (
uöt16_t
)(
íd
 - 
hdbuf
);

685 
nva
[0].
Êags
 = 
NGHTTP2_NV_FLAG_NONE
;

687 
hdbuf
 = 
íd
 + 1;

689 
íd
 = 
	`°rchr
(
hdbuf
, ' ');

690 
nva
[1].
«me
 = (*)":path";

691 
nva
[1].
«mñí
 = (
uöt16_t
)
	`°æí
((*Íva[1].
«me
);

692 
nva
[1].
vÆue
 = (*)
hdbuf
;

693 
nva
[1].
vÆuñí
 = (
uöt16_t
)(
íd
 - 
hdbuf
);

694 
nva
[1].
Êags
 = 
NGHTTP2_NV_FLAG_NONE
;

696 
nva
[2].
«me
 = (*)":scheme";

697 
nva
[2].
«mñí
 = (
uöt16_t
)
	`°æí
((*Íva[2].
«me
);

698 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
)

699 
nva
[2].
vÆue
 = (*)"https";

701 
nva
[2].
vÆue
 = (*)"http";

702 
nva
[2].
vÆuñí
 = (
uöt16_t
)
	`°æí
((*Íva[2].
vÆue
);

703 
nva
[2].
Êags
 = 
NGHTTP2_NV_FLAG_NONE
;

705 
hdbuf
 = 
	`°rchr
(hdbuf, 0x0a);

706 ++
hdbuf
;

708 
i
 = 3; i < 
nhódî
; ++i) {

709 
íd
 = 
	`°rchr
(
hdbuf
, ':');

710 
	`as£π
(
íd
);

711 if(
íd
 - 
hdbuf
 =4 && 
	`Cuæ_øw_√quÆ
("host", hdbuf, 4)) {

712 
nva
[
i
].
«me
 = (*)":authority";

713 
nva
[
i
].
«mñí
 = (
uöt16_t
)
	`°æí
((*Íva[i].
«me
);

716 
nva
[
i
].
«me
 = (*)
hdbuf
;

717 
nva
[
i
].
«mñí
 = (
uöt16_t
)(
íd
 - 
hdbuf
);

719 
hdbuf
 = 
íd
 + 1;

720 ; *
hdbuf
 == ' '; ++hdbuf);

721 
íd
 = 
	`°rchr
(
hdbuf
, 0x0d);

722 
	`as£π
(
íd
);

723 
nva
[
i
].
vÆue
 = (*)
hdbuf
;

724 
nva
[
i
].
vÆuñí
 = (
uöt16_t
)(
íd
 - 
hdbuf
);

725 
nva
[
i
].
Êags
 = 
NGHTTP2_NV_FLAG_NONE
;

727 
hdbuf
 = 
íd
 + 2;

731 if(
nva
[
i
].
«mñí
 == 14 &&

732 
	`Cuæ_øw_√quÆ
("c⁄ã¡-Àngth", (*)
nva
[
i
].
«me
, 14)) {

733 
size_t
 
j
;

734 
j
 = 0; j < 
nva
[
i
].
vÆuñí
; ++j) {

735 
hâpc
->
u∂ﬂd_À·
 *= 10;

736 
hâpc
->
u∂ﬂd_À·
 +
nva
[
i
].
vÆue
[
j
] - '0';

738 
	`öfof
(
c⁄n
->
d©a
, "ªque° c⁄ã¡-Àngth=%zu\n", 
hâpc
->
u∂ﬂd_À·
);

742 
c⁄n
->
d©a
->
£t
.
hâ¥eq
) {

743 
HTTPREQ_POST
:

744 
HTTPREQ_POST_FORM
:

745 
HTTPREQ_PUT
:

746 
d©a_¥d
.
ªad_ˇŒback
 = 
d©a_sour˚_ªad_ˇŒback
;

747 
d©a_¥d
.
sour˚
.
±r
 = 
NULL
;

748 
°ªam_id
 = 
	`nghâp2_submô_ªque°
(
hâpc
->
h2
, 
NULL
, 
nva
, 
nhódî
,

749 &
d©a_¥d
, 
NULL
);

752 
°ªam_id
 = 
	`nghâp2_submô_ªque°
(
hâpc
->
h2
, 
NULL
, 
nva
, 
nhódî
,

753 
NULL
, NULL);

756 
	`Cuæ_ß„‰ì
(
nva
);

758 if(
°ªam_id
 < 0) {

759 *
îr
 = 
CURLE_SEND_ERROR
;

763 
hâpc
->
°ªam_id
 = stream_id;

765 
rv
 = 
	`nghâp2_£ssi⁄_£nd
(
hâpc
->
h2
);

767 if(
rv
 != 0) {

768 *
îr
 = 
CURLE_SEND_ERROR
;

772 if(
hâpc
->
°ªam_id
 != -1) {

781 
	`nghâp2_£ssi⁄_ªsume_d©a
(
hâpc
->
h2
, hâpc->
°ªam_id
);

784  
Àn
;

785 
	}
}

787 
CURLcode
 
	$Cuæ_hâp2_£tup
(
c⁄√˘d©a
 *
c⁄n
)

789 
hâp_c⁄n
 *
hâpc
 = &
c⁄n
->
¥Ÿo
.httpc;

790 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
)

791 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_hâp2_s¶
;

793 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_hâp2
;

795 
	`öfof
(
c⁄n
->
d©a
, "Using HTTP2\n");

796 
hâpc
->
body°¨ãd
 = 
FALSE
;

797 
hâpc
->
˛o£d
 = 
FALSE
;

798 
hâpc
->
hódî_ªcvbuf
 = 
	`Cuæ_add_buf„r_öô
();

799 
hâpc
->
ƒód_hódî_ªcvbuf
 = 0;

800 
hâpc
->
d©a
 = 
NULL
;

801 
hâpc
->
d©Æí
 = 0;

802 
hâpc
->
u∂ﬂd_À·
 = 0;

803 
hâpc
->
u∂ﬂd_mem
 = 
NULL
;

804 
hâpc
->
u∂ﬂd_Àn
 = 0;

805 
hâpc
->
°ªam_id
 = -1;

807 
c⁄n
->
hâpvîsi⁄
 = 20;

810  
	`Cuæ_add_buf„r
(
hâpc
->
hódî_ªcvbuf
, "HTTP/2.0 200\r\n", 14);

811 
	}
}

813 
	$Cuæ_hâp2_swôched
(
c⁄√˘d©a
 *
c⁄n
)

816 
CURLcode
 
rc
;

817 
hâp_c⁄n
 *
hâpc
 = &
c⁄n
->
¥Ÿo
.httpc;

818 
rv
;

820 
hâpc
->
ªcv_undîlyög
 = (
ªcvög
)
c⁄n
->
ªcv
[
FIRSTSOCKET
];

821 
hâpc
->
£nd_undîlyög
 = (
£ndög
)
c⁄n
->
£nd
[
FIRSTSOCKET
];

822 
c⁄n
->
ªcv
[
FIRSTSOCKET
] = 
hâp2_ªcv
;

823 
c⁄n
->
£nd
[
FIRSTSOCKET
] = 
hâp2_£nd
;

825 
rv
 = (Ë((
Cuæ_£nd
*)
hâpc
->
£nd_undîlyög
)

826 (
c⁄n
, 
FIRSTSOCKET
,

827 
NGHTTP2_CLIENT_CONNECTION_PREFACE
,

828 
NGHTTP2_CLIENT_CONNECTION_PREFACE_LEN
,

829 &
rc
);

830 
	`as£π
(
rv
 == 24);

831 if(
c⁄n
->
d©a
->
ªq
.
upgr101
 =
UPGR101_RECEIVED
) {

833 
hâpc
->
°ªam_id
 = 1;

835 
rv
 = 
	`nghâp2_£ssi⁄_upgøde
(
hâpc
->
h2
, hâpc->
bö£âögs
,

836 
hâpc
->
böÀn
, 
NULL
);

837 if(
rv
 != 0) {

838 
	`Áûf
(
c⁄n
->
d©a
, "nghttp2_session_upgrade() failed: %s(%d)",

839 
	`nghâp2_°ªº‹
(
rv
),Ñv);

845 
hâpc
->
°ªam_id
 = -1;

846 
rv
 = 
	`nghâp2_submô_£âögs
(
hâpc
->
h2
, 
NGHTTP2_FLAG_NONE
, 
NULL
, 0);

847 if(
rv
 != 0) {

848 
	`Áûf
(
c⁄n
->
d©a
, "nghttp2_submit_settings() failed: %s(%d)",

849 
	`nghâp2_°ªº‹
(
rv
),Ñv);

854 
	}
}

	@lib/http2.h

1 #i‚de‡
HEADER_CURL_HTTP2_H


2 
	#HEADER_CURL_HTTP2_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
USE_NGHTTP2


28 
	~"hâp.h
"

33 
Cuæ_hâp2_vî
(*
p
, 
size_t
 
Àn
);

35 
CURLcode
 
Cuæ_hâp2_öô
(
c⁄√˘d©a
 *
c⁄n
);

36 
CURLcode
 
Cuæ_hâp2_£nd_ªque°
(
c⁄√˘d©a
 *
c⁄n
);

37 
CURLcode
 
Cuæ_hâp2_ªque°_upgøde
(
Cuæ_£nd_buf„r
 *
ªq
,

38 
c⁄√˘d©a
 *
c⁄n
);

39 
CURLcode
 
Cuæ_hâp2_£tup
(
c⁄√˘d©a
 *
c⁄n
);

40 
Cuæ_hâp2_swôched
(
c⁄√˘d©a
 *
c⁄n
);

42 
	#Cuæ_hâp2_öô
(
x
Ë
CURLE_UNSUPPORTED_PROTOCOL


	)

43 
	#Cuæ_hâp2_£nd_ªque°
(
x
Ë
CURLE_UNSUPPORTED_PROTOCOL


	)

44 
	#Cuæ_hâp2_ªque°_upgøde
(
x
,
y
Ë
CURLE_UNSUPPORTED_PROTOCOL


	)

45 
	#Cuæ_hâp2_£tup
(
x
Ë
CURLE_UNSUPPORTED_PROTOCOL


	)

46 
	#Cuæ_hâp2_swôched
(
x
Ë(-1)

	)

	@lib/http_chunks.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_HTTP


27 
	~"uæd©a.h
"

28 
	~"£ndf.h
"

30 
	~"c⁄ã¡_ícodög.h
"

31 
	~"hâp.h
"

32 
	~"cuæ_mem‹y.h
"

33 
	~"n⁄-ascii.h
"

34 
	~"°πoof·.h
"

35 
	~"w¨∆ess.h
"

37 
	#_MPRINTF_REPLACE


	)

38 
	~<cuæ/m¥ötf.h
>

41 
	~"memdebug.h
"

82 
boﬁ
 
	$Cuæ_isxdigô
(
digô
)

84  ( (
digô
 >= 0x30 && digit <= 0x39)

85 || (
digô
 >= 0x41 && digit <= 0x46)

86 || (
digô
 >0x61 && digô <0x66Ë ) ? 
TRUE
 : 
FALSE
;

87 
	}
}

89 
	$Cuæ_hâpchunk_öô
(
c⁄√˘d©a
 *
c⁄n
)

91 
Cuæ_chunkî
 *
chunk
 = &
c⁄n
->chunk;

92 
chunk
->
hexödex
=0;

93 
chunk
->
d©Æe·
=0;

94 
chunk
->
°©e
 = 
CHUNK_HEX
;

95 
	}
}

108 
CHUNKcode
 
	$Cuæ_hâpchunk_ªad
(
c⁄√˘d©a
 *
c⁄n
,

109 *
d©≠
,

110 
ssize_t
 
d©Æí
,

111 
ssize_t
 *
wrŸï
)

113 
CURLcode
 
ªsu…
=
CURLE_OK
;

114 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

115 
Cuæ_chunkî
 *
ch
 = &
c⁄n
->
chunk
;

116 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

117 
size_t
 
põ˚
;

118 
cuæ_off_t
 
Àngth
 = (cuæ_off_t)
d©Æí
;

119 
size_t
 *
wrŸe
 = (size_à*)
wrŸï
;

121 *
wrŸe
 = 0;

125 if(
d©a
->
£t
.
hâp_ã_skù
 && !
k
->
ign‹ebody
) {

126 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
d©≠
, 
d©Æí
);

127 if(
ªsu…
)

128  
CHUNKE_WRITE_ERROR
;

131 
Àngth
) {

132 
ch
->
°©e
) {

133 
CHUNK_HEX
:

134 if(
	`Cuæ_isxdigô
(*
d©≠
)) {

135 if(
ch
->
hexödex
 < 
MAXNUM_SIZE
) {

136 
ch
->
hexbuf„r
[ch->
hexödex
] = *
d©≠
;

137 
d©≠
++;

138 
Àngth
--;

139 
ch
->
hexödex
++;

142  
CHUNKE_TOO_LONG_HEX
;

146 *
íd±r
;

147 if(0 =
ch
->
hexödex
)

150  
CHUNKE_ILLEGAL_HEX
;

153 
ch
->
hexbuf„r
[ch->
hexödex
]=0;

156 
ªsu…
 = 
	`Cuæ_c⁄vît_‰om_√tw‹k
(
c⁄n
->
d©a
, 
ch
->
hexbuf„r
,

157 
ch
->
hexödex
);

158 if(
ªsu…
) {

161  
CHUNKE_ILLEGAL_HEX
 ;

164 
ch
->
d©asize
=
	`cuæx_°πoof·
(ch->
hexbuf„r
, &
íd±r
, 16);

165 if((
ch
->
d©asize
 =
CURL_OFF_T_MAX
Ë&& (
î∫o
 =
ERANGE
))

167  
CHUNKE_ILLEGAL_HEX
;

168 
ch
->
°©e
 = 
CHUNK_LF
;

172 
CHUNK_LF
:

174 if(*
d©≠
 == 0x0a) {

176 if(0 =
ch
->
d©asize
) {

177 
ch
->
°©e
 = 
CHUNK_TRAILER
;

178 
c⁄n
->
ålPos
=0;

181 
ch
->
°©e
 = 
CHUNK_DATA
;

184 
d©≠
++;

185 
Àngth
--;

188 
CHUNK_DATA
:

192 
põ˚
 = 
	`cuæx_sŸouz
((
ch
->
d©asize
 >
Àngth
)?length:ch->datasize);

195 #ifde‡
HAVE_LIBZ


196 
c⁄n
->
d©a
->
£t
.
hâp_˚_skù
?

197 
IDENTITY
 : 
d©a
->
ªq
.
auto_decodög
) {

198 
IDENTITY
:

200 if(!
k
->
ign‹ebody
) {

201 if(!
d©a
->
£t
.
hâp_ã_skù
)

202 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
d©≠
,

203 
põ˚
);

205 
ªsu…
 = 
CURLE_OK
;

207 #ifde‡
HAVE_LIBZ


210 
DEFLATE
:

212 
d©a
->
ªq
.
°r
 = 
d©≠
;

213 
ªsu…
 = 
	`Cuæ_u√ncode_deÊ©e_wrôe
(
c⁄n
, &
d©a
->
ªq
,

214 (
ssize_t
)
põ˚
);

217 
GZIP
:

219 
d©a
->
ªq
.
°r
 = 
d©≠
;

220 
ªsu…
 = 
	`Cuæ_u√ncode_gzù_wrôe
(
c⁄n
, &
d©a
->
ªq
,

221 (
ssize_t
)
põ˚
);

224 
COMPRESS
:

226 
	`Áûf
 (
c⁄n
->
d©a
,

230  
CHUNKE_BAD_ENCODING
;

234 if(
ªsu…
)

235  
CHUNKE_WRITE_ERROR
;

237 *
wrŸe
 +
põ˚
;

239 
ch
->
d©asize
 -
põ˚
;

240 
d©≠
 +
põ˚
;

241 
Àngth
 -
põ˚
;

243 if(0 =
ch
->
d©asize
)

245 
ch
->
°©e
 = 
CHUNK_POSTLF
;

248 
CHUNK_POSTLF
:

249 if(*
d©≠
 == 0x0a) {

251 
	`Cuæ_hâpchunk_öô
(
c⁄n
);

253 if(*
d©≠
 != 0x0d)

254  
CHUNKE_BAD_CHUNK
;

255 
d©≠
++;

256 
Àngth
--;

259 
CHUNK_TRAILER
:

260 if((*
d©≠
 == 0x0d) || (*datap == 0x0a)) {

264 if(
c⁄n
->
ålPos
) {

266 
c⁄n
->
åaûî
[c⁄n->
ålPos
++]=0x0d;

267 
c⁄n
->
åaûî
[c⁄n->
ålPos
++]=0x0a;

268 
c⁄n
->
åaûî
[c⁄n->
ålPos
]=0;

271 
ªsu…
 = 
	`Cuæ_c⁄vît_‰om_√tw‹k
(
c⁄n
->
d©a
, c⁄n->
åaûî
,

272 
c⁄n
->
ålPos
);

273 if(
ªsu…
)

276  
CHUNKE_BAD_CHUNK
;

278 if(!
d©a
->
£t
.
hâp_ã_skù
) {

279 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_HEADER
,

280 
c⁄n
->
åaûî
, c⁄n->
ålPos
);

281 if(
ªsu…
)

282  
CHUNKE_WRITE_ERROR
;

284 
c⁄n
->
ålPos
=0;

285 
ch
->
°©e
 = 
CHUNK_TRAILER_CR
;

286 if(*
d©≠
 == 0x0a)

292 
ch
->
°©e
 = 
CHUNK_TRAILER_POSTCR
;

299 if(
c⁄n
->
ålPos
 >c⁄n->
ålMax
) {

302 *
±r
;

303 if(
c⁄n
->
ålMax
) {

304 
c⁄n
->
ålMax
 *= 2;

305 
±r
 = 
	`ªÆloc
(
c⁄n
->
åaûî
, c⁄n->
ålMax
 + 3);

308 
c⁄n
->
ålMax
=128;

309 
±r
 = 
	`mÆloc
(
c⁄n
->
ålMax
 + 3);

311 if(!
±r
)

312  
CHUNKE_OUT_OF_MEMORY
;

313 
c⁄n
->
åaûî
 = 
±r
;

315 
c⁄n
->
åaûî
[c⁄n->
ålPos
++]=*
d©≠
;

317 
d©≠
++;

318 
Àngth
--;

321 
CHUNK_TRAILER_CR
:

322 if(*
d©≠
 == 0x0a) {

323 
ch
->
°©e
 = 
CHUNK_TRAILER_POSTCR
;

324 
d©≠
++;

325 
Àngth
--;

328  
CHUNKE_BAD_CHUNK
;

331 
CHUNK_TRAILER_POSTCR
:

334 if((*
d©≠
 != 0x0d) && (*datap != 0x0a)) {

336 
ch
->
°©e
 = 
CHUNK_TRAILER
;

339 if(*
d©≠
 == 0x0d) {

341 
d©≠
++;

342 
Àngth
--;

345 
ch
->
°©e
 = 
CHUNK_STOP
;

348 
CHUNK_STOP
:

349 if(*
d©≠
 == 0x0a) {

350 
Àngth
--;

354 
ch
->
d©Æe·
 = 
	`cuæx_sŸouz
(
Àngth
);

356  
CHUNKE_STOP
;

359  
CHUNKE_BAD_CHUNK
;

362  
CHUNKE_OK
;

363 
	}
}

365 c⁄° *
	$Cuæ_chunked_°ªº‹
(
CHUNKcode
 
code
)

367 
code
) {

370 
CHUNKE_TOO_LONG_HEX
:

372 
CHUNKE_ILLEGAL_HEX
:

374 
CHUNKE_BAD_CHUNK
:

376 
CHUNKE_WRITE_ERROR
:

378 
CHUNKE_BAD_ENCODING
:

380 
CHUNKE_OUT_OF_MEMORY
:

383 
	}
}

	@lib/http_chunks.h

1 #i‚de‡
HEADER_CURL_HTTP_CHUNKS_H


2 
	#HEADER_CURL_HTTP_CHUNKS_H


	)

29 
	#MAXNUM_SIZE
 16

	)

34 
	mCHUNK_HEX
,

37 
	mCHUNK_LF
,

41 
	mCHUNK_DATA
,

46 
	mCHUNK_POSTLF
,

51 
	mCHUNK_STOP
,

55 
	mCHUNK_TRAILER
,

59 
	mCHUNK_TRAILER_CR
,

65 
	mCHUNK_TRAILER_POSTCR


66 } 
	tChunkySèã
;

69 
	mCHUNKE_STOP
 = -1,

70 
	mCHUNKE_OK
 = 0,

71 
	mCHUNKE_TOO_LONG_HEX
 = 1,

72 
	mCHUNKE_ILLEGAL_HEX
,

73 
	mCHUNKE_BAD_CHUNK
,

74 
	mCHUNKE_WRITE_ERROR
,

75 
	mCHUNKE_BAD_ENCODING
,

76 
	mCHUNKE_OUT_OF_MEMORY
,

77 
	mCHUNKE_LAST


78 } 
	tCHUNKcode
;

80 c⁄° *
Cuæ_chunked_°ªº‹
(
CHUNKcode
 
code
);

82 
	sCuæ_chunkî
 {

83 
	mhexbuf„r
[ 
MAXNUM_SIZE
 + 1];

84 
	mhexödex
;

85 
ChunkySèã
 
	m°©e
;

86 
cuæ_off_t
 
	md©asize
;

87 
size_t
 
	md©Æe·
;

	@lib/http_digest.c

23 
	~"cuæ_£tup.h
"

25 #i‡!
deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_CRYPTO_AUTH
)

27 
	~"uæd©a.h
"

28 
	~"øw°r.h
"

29 
	~"cuæ_ba£64.h
"

30 
	~"cuæ_md5.h
"

31 
	~"hâp_dige°.h
"

32 
	~"°πok.h
"

33 
	~"cuæ_mem‹y.h
"

34 
	~"vés/vés.h
"

35 
	~"n⁄-ascii.h
"

36 
	~"w¨∆ess.h
"

38 
	#_MPRINTF_REPLACE


	)

39 
	~<cuæ/m¥ötf.h
>

42 
	~"memdebug.h
"

44 
	#MAX_VALUE_LENGTH
 256

	)

45 
	#MAX_CONTENT_LENGTH
 1024

	)

47 
dige°_˛ónup_⁄e
(
dige°d©a
 *
dig
);

54 
	$gë_∑ú
(c⁄° *
°r
, *
vÆue
, *
c⁄ã¡
,

55 c⁄° **
íd±r
)

57 
c
;

58 
boﬁ
 
°¨ts_wôh_quŸe
 = 
FALSE
;

59 
boﬁ
 
esˇ≥
 = 
FALSE
;

61 
c
=
MAX_VALUE_LENGTH
-1; (*
°r
 && (*str != '=') && c--); )

62 *
vÆue
++ = *
°r
++;

63 *
vÆue
=0;

65 if('=' !*
°r
++)

69 if('\"' =*
°r
) {

71 
°r
++;

72 
°¨ts_wôh_quŸe
 = 
TRUE
;

75 
c
=
MAX_CONTENT_LENGTH
-1; *
°r
 && c--; str++) {

76 *
°r
) {

78 if(!
esˇ≥
) {

80 
esˇ≥
 = 
TRUE
;

81 *
c⁄ã¡
++ = '\\';

87 if(!
°¨ts_wôh_quŸe
) {

90 
c
=0;

97 
c
=0;

100 if(!
esˇ≥
 && 
°¨ts_wôh_quŸe
) {

102 
c
=0;

107 
esˇ≥
 = 
FALSE
;

108 *
c⁄ã¡
++ = *
°r
;

110 *
c⁄ã¡
=0;

112 *
íd±r
 = 
°r
;

115 
	}
}

124 
CURLdige°
 
	$Cuæ_öput_dige°
(
c⁄√˘d©a
 *
c⁄n
,

125 
boﬁ
 
¥oxy
,

126 c⁄° *
hódî
)

129 *
tokí
 = 
NULL
;

130 *
tmp
 = 
NULL
;

131 
boﬁ
 
foundAuth
 = 
FALSE
;

132 
boﬁ
 
foundAuthI¡
 = 
FALSE
;

133 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

134 
boﬁ
 
bef‹e
 = 
FALSE
;

135 
dige°d©a
 *
d
;

137 if(
¥oxy
) {

138 
d
 = &
d©a
->
°©e
.
¥oxydige°
;

141 
d
 = &
d©a
->
°©e
.
dige°
;

144 if(
	`check¥efix
("Dige°", 
hódî
)) {

145 
hódî
 +
	`°æí
("Digest");

148 if(
d
->
n⁄˚
)

149 
bef‹e
 = 
TRUE
;

152 
	`dige°_˛ónup_⁄e
(
d
);

155 
vÆue
[
MAX_VALUE_LENGTH
];

156 
c⁄ã¡
[
MAX_CONTENT_LENGTH
];

158 *
hódî
 && 
	`ISSPACE
(*header))

159 
hódî
++;

162 if(!
	`gë_∑ú
(
hódî
, 
vÆue
, 
c⁄ã¡
, &header)) {

163 if(
	`Cuæ_øw_equÆ
(
vÆue
, "nonce")) {

164 
d
->
n⁄˚
 = 
	`°rdup
(
c⁄ã¡
);

165 if(!
d
->
n⁄˚
)

166  
CURLDIGEST_NOMEM
;

168 if(
	`Cuæ_øw_equÆ
(
vÆue
, "stale")) {

169 if(
	`Cuæ_øw_equÆ
(
c⁄ã¡
, "true")) {

170 
d
->
°Æe
 = 
TRUE
;

171 
d
->
nc
 = 1;

174 if(
	`Cuæ_øw_equÆ
(
vÆue
, "realm")) {

175 
d
->
ªÆm
 = 
	`°rdup
(
c⁄ã¡
);

176 if(!
d
->
ªÆm
)

177  
CURLDIGEST_NOMEM
;

179 if(
	`Cuæ_øw_equÆ
(
vÆue
, "opaque")) {

180 
d
->
›aque
 = 
	`°rdup
(
c⁄ã¡
);

181 if(!
d
->
›aque
)

182  
CURLDIGEST_NOMEM
;

184 if(
	`Cuæ_øw_equÆ
(
vÆue
, "qop")) {

185 *
tok_buf
;

188 
tmp
 = 
	`°rdup
(
c⁄ã¡
);

189 if(!
tmp
)

190  
CURLDIGEST_NOMEM
;

191 
tokí
 = 
	`°πok_r
(
tmp
, ",", &
tok_buf
);

192 
tokí
 !
NULL
) {

193 if(
	`Cuæ_øw_equÆ
(
tokí
, "auth")) {

194 
foundAuth
 = 
TRUE
;

196 if(
	`Cuæ_øw_equÆ
(
tokí
, "auth-int")) {

197 
foundAuthI¡
 = 
TRUE
;

199 
tokí
 = 
	`°πok_r
(
NULL
, ",", &
tok_buf
);

201 
	`‰ì
(
tmp
);

203 if(
foundAuth
) {

204 
d
->
q›
 = 
	`°rdup
("auth");

205 if(!
d
->
q›
)

206  
CURLDIGEST_NOMEM
;

208 if(
foundAuthI¡
) {

209 
d
->
q›
 = 
	`°rdup
("auth-int");

210 if(!
d
->
q›
)

211  
CURLDIGEST_NOMEM
;

214 if(
	`Cuæ_øw_equÆ
(
vÆue
, "algorithm")) {

215 
d
->
Æg‹ôhm
 = 
	`°rdup
(
c⁄ã¡
);

216 if(!
d
->
Æg‹ôhm
)

217  
CURLDIGEST_NOMEM
;

218 if(
	`Cuæ_øw_equÆ
(
c⁄ã¡
, "MD5-sess"))

219 
d
->
Ægo
 = 
CURLDIGESTALGO_MD5SESS
;

220 if(
	`Cuæ_øw_equÆ
(
c⁄ã¡
, "MD5"))

221 
d
->
Ægo
 = 
CURLDIGESTALGO_MD5
;

223  
CURLDIGEST_BADALGO
;

233 *
hódî
 && 
	`ISSPACE
(*header))

234 
hódî
++;

235 if(',' =*
hódî
)

237 
hódî
++;

242 if(
bef‹e
 && !
d
->
°Æe
)

243  
CURLDIGEST_BAD
;

246 if(!
d
->
n⁄˚
)

247  
CURLDIGEST_BAD
;

251  
CURLDIGEST_NONE
;

253  
CURLDIGEST_FINE
;

254 
	}
}

257 
	$md5_to_ascii
(*
sour˚
,

258 *
de°
)

260 
i
;

261 
i
=0; i<16; i++)

262 
	`¢¥ötf
((*)&
de°
[
i
*2], 3, "%02x", 
sour˚
[i]);

263 
	}
}

266 *
	$°rög_quŸed
(c⁄° *
sour˚
)

268 *
de°
, *
d
;

269 c⁄° *
s
 = 
sour˚
;

270 
size_t
 
n
 = 1;

273 *
s
) {

274 ++
n
;

275 if(*
s
 == '"' || *s == '\\') {

276 ++
n
;

278 ++
s
;

281 
de°
 = 
	`mÆloc
(
n
);

282 if(
de°
) {

283 
s
 = 
sour˚
;

284 
d
 = 
de°
;

285 *
s
) {

286 if(*
s
 == '"' || *s == '\\') {

287 *
d
++ = '\\';

289 *
d
++ = *
s
++;

291 *
d
 = 0;

294  
de°
;

295 
	}
}

297 
CURLcode
 
	$Cuæ_ouçut_dige°
(
c⁄√˘d©a
 *
c⁄n
,

298 
boﬁ
 
¥oxy
,

299 c⁄° *
ªque°
,

300 c⁄° *
urù©h
)

305 
size_t
 
urûí
;

306 
md5buf
[16];

307 
ªque°_dige°
[33];

308 *
md5this
;

309 
ha1
[33];

310 
ha2
[33];

311 
˙⁄˚buf
[33];

312 *
˙⁄˚
 = 
NULL
;

313 
size_t
 
˙⁄˚_sz
 = 0;

314 *
tmp
 = 
NULL
;

315 **
Ælocu£Ωwd
;

316 
size_t
 
u£æí
;

317 c⁄° *
u£Ω
;

318 *
u£Ω_quŸed
;

319 c⁄° *
∑sswdp
;

320 
auth
 *
authp
;

322 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

323 
dige°d©a
 *
d
;

324 
CURLcode
 
rc
;

329 
	#CURL_OUTPUT_DIGEST_CONV
(
a
, 
b
) \

330 
rc
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
a
, (*)
b
, 
	`°æí
((const *)b)); \

331 if(
rc
 !
CURLE_OK
) { \

332 
	`‰ì
(
b
); \

333  
rc
; \

334 }

	)

336 if(
¥oxy
) {

337 
d
 = &
d©a
->
°©e
.
¥oxydige°
;

338 
Ælocu£Ωwd
 = &
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
;

339 
u£Ω
 = 
c⁄n
->
¥oxyu£r
;

340 
∑sswdp
 = 
c⁄n
->
¥oxy∑sswd
;

341 
authp
 = &
d©a
->
°©e
.
auth¥oxy
;

344 
d
 = &
d©a
->
°©e
.
dige°
;

345 
Ælocu£Ωwd
 = &
c⁄n
->
Ælo˝å
.
u£Ωwd
;

346 
u£Ω
 = 
c⁄n
->
u£r
;

347 
∑sswdp
 = 
c⁄n
->
∑sswd
;

348 
authp
 = &
d©a
->
°©e
.
authho°
;

351 
	`Cuæ_ß„‰ì
(*
Ælocu£Ωwd
);

354 if(!
u£Ω
)

355 
u£Ω
="";

357 if(!
∑sswdp
)

358 
∑sswdp
="";

360 if(!
d
->
n⁄˚
) {

361 
authp
->
d⁄e
 = 
FALSE
;

362  
CURLE_OK
;

364 
authp
->
d⁄e
 = 
TRUE
;

366 if(!
d
->
nc
)

367 
d
->
nc
 = 1;

369 if(!
d
->
˙⁄˚
) {

370 
	`¢¥ötf
(
˙⁄˚buf
, (cnoncebuf), "%08x%08x%08x%08x",

371 
	`Cuæ_ønd
(
d©a
), Curl_rand(data),

372 
	`Cuæ_ønd
(
d©a
), Curl_rand(data));

373 
rc
 = 
	`Cuæ_ba£64_ícode
(
d©a
, 
˙⁄˚buf
, 
	`°æí
(cnoncebuf),

374 &
˙⁄˚
, &
˙⁄˚_sz
);

375 if(
rc
)

376  
rc
;

377 
d
->
˙⁄˚
 = cnonce;

391 
md5this
 = (*)

392 
	`≠rötf
("%s:%s:%s", 
u£Ω
, 
d
->
ªÆm
, 
∑sswdp
);

393 if(!
md5this
)

394  
CURLE_OUT_OF_MEMORY
;

396 
	`CURL_OUTPUT_DIGEST_CONV
(
d©a
, 
md5this
);

397 
	`Cuæ_md5ô
(
md5buf
, 
md5this
);

398 
	`Cuæ_ß„‰ì
(
md5this
);

399 
	`md5_to_ascii
(
md5buf
, 
ha1
);

401 if(
d
->
Ægo
 =
CURLDIGESTALGO_MD5SESS
) {

403 
tmp
 = 
	`≠rötf
("%s:%s:%s", 
ha1
, 
d
->
n⁄˚
, d->
˙⁄˚
);

404 if(!
tmp
)

405  
CURLE_OUT_OF_MEMORY
;

406 
	`CURL_OUTPUT_DIGEST_CONV
(
d©a
, 
tmp
);

407 
	`Cuæ_md5ô
(
md5buf
, (*)
tmp
);

408 
	`Cuæ_ß„‰ì
(
tmp
);

409 
	`md5_to_ascii
(
md5buf
, 
ha1
);

438 if(
authp
->
õ°yÀ
 && ((
tmp
 = 
	`°rchr
((*)
urù©h
, '?')Ë!
NULL
))

439 
urûí
 = 
tmp
 - (*)
urù©h
;

441 
urûí
 = 
	`°æí
((*)
urù©h
);

443 
md5this
 = (*)
	`≠rötf
("%s:%.*s", 
ªque°
, 
urûí
, 
urù©h
);

445 if(
d
->
q›
 && 
	`Cuæ_øw_equÆ
(d->qop, "auth-int")) {

448 *
md5this2
 = (*)

449 
	`≠rötf
("%s:%s", 
md5this
, "d41d8cd98f00b204e9800998ecf8427e");

450 
	`Cuæ_ß„‰ì
(
md5this
);

451 
md5this
 = 
md5this2
;

454 if(!
md5this
)

455  
CURLE_OUT_OF_MEMORY
;

457 
	`CURL_OUTPUT_DIGEST_CONV
(
d©a
, 
md5this
);

458 
	`Cuæ_md5ô
(
md5buf
, 
md5this
);

459 
	`Cuæ_ß„‰ì
(
md5this
);

460 
	`md5_to_ascii
(
md5buf
, 
ha2
);

462 if(
d
->
q›
) {

463 
md5this
 = (*)
	`≠rötf
("%s:%s:%08x:%s:%s:%s",

464 
ha1
,

465 
d
->
n⁄˚
,

466 
d
->
nc
,

467 
d
->
˙⁄˚
,

468 
d
->
q›
,

469 
ha2
);

472 
md5this
 = (*)
	`≠rötf
("%s:%s:%s",

473 
ha1
,

474 
d
->
n⁄˚
,

475 
ha2
);

477 if(!
md5this
)

478  
CURLE_OUT_OF_MEMORY
;

480 
	`CURL_OUTPUT_DIGEST_CONV
(
d©a
, 
md5this
);

481 
	`Cuæ_md5ô
(
md5buf
, 
md5this
);

482 
	`Cuæ_ß„‰ì
(
md5this
);

483 
	`md5_to_ascii
(
md5buf
, 
ªque°_dige°
);

498 
u£Ω_quŸed
 = 
	`°rög_quŸed
(
u£Ω
);

499 if(!
u£Ω_quŸed
)

500  
CURLE_OUT_OF_MEMORY
;

502 if(
d
->
q›
) {

503 *
Ælocu£Ωwd
 =

504 
	`≠rötf
( "%sAuthorization: Digest "

513 
¥oxy
?"Proxy-":"",

514 
u£Ω_quŸed
,

515 
d
->
ªÆm
,

516 
d
->
n⁄˚
,

517 
urûí
, 
urù©h
,

518 
d
->
˙⁄˚
,

519 
d
->
nc
,

520 
d
->
q›
,

521 
ªque°_dige°
);

523 if(
	`Cuæ_øw_equÆ
(
d
->
q›
, "auth"))

524 
d
->
nc
++;

529 *
Ælocu£Ωwd
 =

530 
	`≠rötf
( "%sAuthorization: Digest "

536 
¥oxy
?"Proxy-":"",

537 
u£Ω_quŸed
,

538 
d
->
ªÆm
,

539 
d
->
n⁄˚
,

540 
urûí
, 
urù©h
,

541 
ªque°_dige°
);

543 
	`Cuæ_ß„‰ì
(
u£Ω_quŸed
);

544 if(!*
Ælocu£Ωwd
)

545  
CURLE_OUT_OF_MEMORY
;

548 if(
d
->
›aque
) {

550 
tmp
 = 
	`≠rötf
("%s, o∑que=\"%s\"", *
Ælocu£Ωwd
, 
d
->
›aque
);

551 if(!
tmp
)

552  
CURLE_OUT_OF_MEMORY
;

553 
	`‰ì
(*
Ælocu£Ωwd
);

554 *
Ælocu£Ωwd
 = 
tmp
;

557 if(
d
->
Æg‹ôhm
) {

559 
tmp
 = 
	`≠rötf
("%s,álg‹ôhm=\"%s\"", *
Ælocu£Ωwd
, 
d
->
Æg‹ôhm
);

560 if(!
tmp
)

561  
CURLE_OUT_OF_MEMORY
;

562 
	`‰ì
(*
Ælocu£Ωwd
);

563 *
Ælocu£Ωwd
 = 
tmp
;

567 
u£æí
 = 
	`°æí
(*
Ælocu£Ωwd
);

568 
tmp
 = 
	`ªÆloc
(*
Ælocu£Ωwd
, 
u£æí
 + 3);

569 if(!
tmp
)

570  
CURLE_OUT_OF_MEMORY
;

571 
	`°r˝y
(&
tmp
[
u£æí
], "\r\n");

572 *
Ælocu£Ωwd
 = 
tmp
;

574  
CURLE_OK
;

575 
	}
}

577 
	$dige°_˛ónup_⁄e
(
dige°d©a
 *
d
)

579 
	`Cuæ_ß„‰ì
(
d
->
n⁄˚
);

580 
	`Cuæ_ß„‰ì
(
d
->
˙⁄˚
);

581 
	`Cuæ_ß„‰ì
(
d
->
ªÆm
);

582 
	`Cuæ_ß„‰ì
(
d
->
›aque
);

583 
	`Cuæ_ß„‰ì
(
d
->
q›
);

584 
	`Cuæ_ß„‰ì
(
d
->
Æg‹ôhm
);

586 
d
->
nc
 = 0;

587 
d
->
Ægo
 = 
CURLDIGESTALGO_MD5
;

588 
d
->
°Æe
 = 
FALSE
;

589 
	}
}

592 
	$Cuæ_dige°_˛ónup
(
Sessi⁄H™dÀ
 *
d©a
)

594 
	`dige°_˛ónup_⁄e
(&
d©a
->
°©e
.
dige°
);

595 
	`dige°_˛ónup_⁄e
(&
d©a
->
°©e
.
¥oxydige°
);

596 
	}
}

	@lib/http_digest.h

1 #i‚de‡
HEADER_CURL_HTTP_DIGEST_H


2 
	#HEADER_CURL_HTTP_DIGEST_H


	)

24 
	~"cuæ_£tup.h
"

27 
	mCURLDIGEST_NONE
,

28 
	mCURLDIGEST_BAD
,

29 
	mCURLDIGEST_BADALGO
,

30 
	mCURLDIGEST_NOMEM
,

31 
	mCURLDIGEST_FINE
,

33 
	mCURLDIGEST_LAST


34 } 
	tCURLdige°
;

37 
	mCURLDIGESTALGO_MD5
,

38 
	mCURLDIGESTALGO_MD5SESS


42 
CURLdige°
 
Cuæ_öput_dige°
(
c⁄√˘d©a
 *
c⁄n
,

43 
boﬁ
 
¥oxy
, c⁄° *
hódî
);

46 
CURLcode
 
Cuæ_ouçut_dige°
(
c⁄√˘d©a
 *
c⁄n
,

47 
boﬁ
 
¥oxy
,

48 c⁄° *
ªque°
,

49 c⁄° *
urù©h
);

51 #i‡!
deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_CRYPTO_AUTH
)

52 
Cuæ_dige°_˛ónup
(
Sessi⁄H™dÀ
 *
d©a
);

54 
	#Cuæ_dige°_˛ónup
(
x
Ë
Cuæ_n›_°mt


	)

	@lib/http_negotiate.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_GSSAPI


26 #ifde‡
HAVE_OLD_GSSMIT


27 
	#GSS_C_NT_HOSTBASED_SERVICE
 
gss_¡_£rvi˚_«me


	)

28 
	#NCOMPAT
 1

	)

31 #i‚de‡
CURL_DISABLE_HTTP


33 
	~"uæd©a.h
"

34 
	~"£ndf.h
"

35 
	~"cuæ_gsßpi.h
"

36 
	~"øw°r.h
"

37 
	~"cuæ_ba£64.h
"

38 
	~"hâp_√gŸüã.h
"

39 
	~"cuæ_mem‹y.h
"

40 
	~"uæ.h
"

42 #ifde‡
HAVE_SPNEGO


43 
	~<•√gohñp.h
>

44 #ifde‡
USE_SSLEAY


45 #ifde‡
USE_OPENSSL


46 
	~<›ís¶/obje˘s.h
>

48 
	~<obje˘s.h
>

55 
	#_MPRINTF_REPLACE


	)

56 
	~<cuæ/m¥ötf.h
>

59 
	~"memdebug.h
"

62 
	$gë_gss_«me
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
, 
gss_«me_t
 *
£rvî
)

64 
√gŸüãd©a
 *
√g_˘x
 = 
¥oxy
?&
c⁄n
->
d©a
->
°©e
.
¥oxy√g
:

65 &
c⁄n
->
d©a
->
°©e
.
√gŸüã
;

66 
OM_uöt32
 
maj‹_°©us
, 
mö‹_°©us
;

67 
gss_buf„r_desc
 
tokí
 = 
GSS_C_EMPTY_BUFFER
;

68 
«me
[2048];

69 c⁄° * 
£rvi˚
;

78 if(
√g_˘x
->
gss
)

79 
£rvi˚
 = "KHTTP";

81 
£rvi˚
 = "HTTP";

83 
tokí
.
Àngth
 = 
	`°æí
(
£rvi˚
Ë+ 1 + såÀn(
¥oxy
 ? 
c⁄n
->¥oxy.
«me
 :

84 
c⁄n
->
ho°
.
«me
) + 1;

85 if(
tokí
.
Àngth
 + 1 > (
«me
))

86  
EMSGSIZE
;

88 
	`¢¥ötf
(
«me
, “ame), "%s@%s", 
£rvi˚
, 
¥oxy
 ? 
c⁄n
->proxy.name :

89 
c⁄n
->
ho°
.
«me
);

91 
tokí
.
vÆue
 = (*Ë
«me
;

92 
maj‹_°©us
 = 
	`gss_imp‹t_«me
(&
mö‹_°©us
,

93 &
tokí
,

94 
GSS_C_NT_HOSTBASED_SERVICE
,

95 
£rvî
);

97  
	`GSS_ERROR
(
maj‹_°©us
) ? -1 : 0;

98 
	}
}

101 
	$log_gss_îr‹
(
c⁄√˘d©a
 *
c⁄n
, 
OM_uöt32
 
îr‹_°©us
,

102 c⁄° *
¥efix
)

104 
OM_uöt32
 
maj_°©
, 
mö_°©
;

105 
OM_uöt32
 
msg_˘x
 = 0;

106 
gss_buf„r_desc
 
°©us_°rög
;

107 
buf
[1024];

108 
size_t
 
Àn
;

110 
	`¢¥ötf
(
buf
, (buf), "%s", 
¥efix
);

111 
Àn
 = 
	`°æí
(
buf
);

113 
maj_°©
 = 
	`gss_di•œy_°©us
(&
mö_°©
,

114 
îr‹_°©us
,

115 
GSS_C_MECH_CODE
,

116 
GSS_C_NO_OID
,

117 &
msg_˘x
,

118 &
°©us_°rög
);

119 if((
buf
Ë> 
Àn
 + 
°©us_°rög
.
Àngth
 + 1) {

120 
	`¢¥ötf
(
buf
 + 
Àn
, (buf) -Üen,

121 ": %s", (*Ë
°©us_°rög
.
vÆue
);

122 
Àn
 +
°©us_°rög
.
Àngth
;

124 
	`gss_ªÀa£_buf„r
(&
mö_°©
, &
°©us_°rög
);

125 } !
	`GSS_ERROR
(
maj_°©
Ë&& 
msg_˘x
 != 0);

127 
	`öfof
(
c⁄n
->
d©a
, "%s\n", 
buf
);

128 
	}
}

132 
	$Cuæ_öput_√gŸüã
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
,

133 c⁄° *
hódî
)

135 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

136 
√gŸüãd©a
 *
√g_˘x
 = 
¥oxy
?&
d©a
->
°©e
.
¥oxy√g
:

137 &
d©a
->
°©e
.
√gŸüã
;

138 
OM_uöt32
 
maj‹_°©us
, 
mö‹_°©us
, 
disˇrd_°
;

139 
gss_buf„r_desc
 
öput_tokí
 = 
GSS_C_EMPTY_BUFFER
;

140 
gss_buf„r_desc
 
ouçut_tokí
 = 
GSS_C_EMPTY_BUFFER
;

141 
ªt
;

142 
size_t
 
Àn
;

143 
size_t
 
øwÀn
 = 0;

144 
boﬁ
 
gss
;

145 c⁄° * 
¥Ÿocﬁ
;

146 
CURLcode
 
îr‹
;

148 if(
	`check¥efix
("GSS-NegŸüã", 
hódî
)) {

149 
¥Ÿocﬁ
 = "GSS-Negotiate";

150 
gss
 = 
TRUE
;

152 if(
	`check¥efix
("NegŸüã", 
hódî
)) {

153 
¥Ÿocﬁ
 = "Negotiate";

154 
gss
 = 
FALSE
;

159 if(
√g_˘x
->
c⁄ãxt
) {

160 if(
√g_˘x
->
gss
 != gss) {

165 
√g_˘x
->
¥Ÿocﬁ
 =Örotocol;

166 
√g_˘x
->
gss
 = gss;

169 if(
√g_˘x
->
c⁄ãxt
 &&Çeg_˘x->
°©us
 =
GSS_S_COMPLETE
) {

173 
	`Cuæ_˛ónup_√gŸüã
(
d©a
);

177 if(
√g_˘x
->
£rvî_«me
 =
NULL
 &&

178 (
ªt
 = 
	`gë_gss_«me
(
c⁄n
, 
¥oxy
, &
√g_˘x
->
£rvî_«me
)))

179  
ªt
;

181 
hódî
 +
	`°æí
(
√g_˘x
->
¥Ÿocﬁ
);

182 *
hódî
 && 
	`ISSPACE
(*header))

183 
hódî
++;

185 
Àn
 = 
	`°æí
(
hódî
);

186 if(
Àn
 > 0) {

187 
îr‹
 = 
	`Cuæ_ba£64_decode
(
hódî
,

188 (**)&
öput_tokí
.
vÆue
, &
øwÀn
);

189 if(
îr‹
 || 
øwÀn
 == 0)

191 
öput_tokí
.
Àngth
 = 
øwÀn
;

193 
	`DEBUGASSERT
(
öput_tokí
.
vÆue
 !
NULL
);

195 #ifde‡
HAVE_SPNEGO


196 if(
	`check¥efix
("NegŸüã", 
hódî
)) {

197 *
•√goTokí
 = 
NULL
;

198 
size_t
 
•√goTokíLígth
 = 0;

199 
gss_buf„r_desc
 
mechTokí
 = 
GSS_C_EMPTY_BUFFER
;

201 
•√goTokí
 = 
	`mÆloc
(
öput_tokí
.
Àngth
);

202 if(
•√goTokí
 =
NULL
) {

203 
	`Cuæ_ß„‰ì
(
öput_tokí
.
vÆue
);

204  
CURLE_OUT_OF_MEMORY
;

206 
	`mem˝y
(
•√goTokí
, 
öput_tokí
.
vÆue
, i≈ut_tokí.
Àngth
);

207 
•√goTokíLígth
 = 
öput_tokí
.
Àngth
;

209 if(!
	`∑r£S≤egoT¨gëTokí
(
•√goTokí
,

210 
•√goTokíLígth
,

211 
NULL
,

212 
NULL
,

213 (**)&
mechTokí
.
vÆue
,

214 &
mechTokí
.
Àngth
,

215 
NULL
,

216 
NULL
)) {

217 
	`Cuæ_ß„‰ì
(
•√goTokí
);

218 
	`öfof
(
d©a
, "Parse SPNEGO Target Token failed\n");

220 if(!
mechTokí
.
vÆue
 || !mechTokí.
Àngth
) {

221 
	`Cuæ_ß„‰ì
(
•√goTokí
);

222 if(
mechTokí
.
vÆue
)

223 
	`gss_ªÀa£_buf„r
(&
disˇrd_°
, &
mechTokí
);

224 
	`öfof
(
d©a
, "Parse SPNEGO Target Token succeeded (NULLÅoken)\n");

227 
	`Cuæ_ß„‰ì
(
•√goTokí
);

228 
	`Cuæ_ß„‰ì
(
öput_tokí
.
vÆue
);

229 
öput_tokí
.
vÆue
 = 
	`mÆloc
(
mechTokí
.
Àngth
);

230 if(
öput_tokí
.
vÆue
 =
NULL
) {

231 
	`gss_ªÀa£_buf„r
(&
disˇrd_°
, &
mechTokí
);

232  
CURLE_OUT_OF_MEMORY
;

234 
	`mem˝y
(
öput_tokí
.
vÆue
, 
mechTokí
.vÆue, mechTokí.
Àngth
);

235 
öput_tokí
.
Àngth
 = 
mechTokí
.length;

236 
	`gss_ªÀa£_buf„r
(&
disˇrd_°
, &
mechTokí
);

237 
	`öfof
(
d©a
, "Parse SPNEGO Target Token succeeded\n");

243 
maj‹_°©us
 = 
	`Cuæ_gss_öô_£c_c⁄ãxt
(
d©a
,

244 &
mö‹_°©us
,

245 &
√g_˘x
->
c⁄ãxt
,

246 
√g_˘x
->
£rvî_«me
,

247 
GSS_C_NO_CHANNEL_BINDINGS
,

248 &
öput_tokí
,

249 &
ouçut_tokí
,

250 
NULL
);

251 
	`Cuæ_ß„‰ì
(
öput_tokí
.
vÆue
);

253 
√g_˘x
->
°©us
 = 
maj‹_°©us
;

254 if(
	`GSS_ERROR
(
maj‹_°©us
)) {

255 if(
ouçut_tokí
.
vÆue
)

256 
	`gss_ªÀa£_buf„r
(&
disˇrd_°
, &
ouçut_tokí
);

257 
	`log_gss_îr‹
(
c⁄n
, 
mö‹_°©us
, "gss_init_sec_context() failed: ");

261 if(!
ouçut_tokí
.
vÆue
 || !ouçut_tokí.
Àngth
) {

262 if(
ouçut_tokí
.
vÆue
)

263 
	`gss_ªÀa£_buf„r
(&
disˇrd_°
, &
ouçut_tokí
);

267 
√g_˘x
->
ouçut_tokí
 = output_token;

269 
	}
}

272 
CURLcode
 
	$Cuæ_ouçut_√gŸüã
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
)

274 
√gŸüãd©a
 *
√g_˘x
 = 
¥oxy
?&
c⁄n
->
d©a
->
°©e
.
¥oxy√g
:

275 &
c⁄n
->
d©a
->
°©e
.
√gŸüã
;

276 *
ícoded
 = 
NULL
;

277 
size_t
 
Àn
 = 0;

278 *
u£Ω
;

279 
CURLcode
 
îr‹
;

280 
OM_uöt32
 
disˇrd_°
;

282 #ifde‡
HAVE_SPNEGO


283 if(
	`check¥efix
("NegŸüã", 
√g_˘x
->
¥Ÿocﬁ
)) {

284 
ASN1_OBJECT
 *
obje˘
 = 
NULL
;

285 *
ª•⁄£Tokí
 = 
NULL
;

286 
size_t
 
ª•⁄£TokíLígth
 = 0;

287 
gss_buf„r_desc
 
•√goTokí
 = 
GSS_C_EMPTY_BUFFER
;

289 
ª•⁄£Tokí
 = 
	`mÆloc
(
√g_˘x
->
ouçut_tokí
.
Àngth
);

290 if(
ª•⁄£Tokí
 =
NULL
)

291  
CURLE_OUT_OF_MEMORY
;

292 
	`mem˝y
(
ª•⁄£Tokí
, 
√g_˘x
->
ouçut_tokí
.
vÆue
,

293 
√g_˘x
->
ouçut_tokí
.
Àngth
);

294 
ª•⁄£TokíLígth
 = 
√g_˘x
->
ouçut_tokí
.
Àngth
;

296 
obje˘
 = 
	`OBJ_txt2obj
("1.2.840.113554.1.2.2", 1);

297 if(!
obje˘
) {

298 
	`Cuæ_ß„‰ì
(
ª•⁄£Tokí
);

299  
CURLE_OUT_OF_MEMORY
;

302 if(!
	`makeS≤egoInôülTokí
(
obje˘
,

303 
ª•⁄£Tokí
,

304 
ª•⁄£TokíLígth
,

305 (**)&
•√goTokí
.
vÆue
,

306 &
•√goTokí
.
Àngth
)) {

307 
	`Cuæ_ß„‰ì
(
ª•⁄£Tokí
);

308 
	`ASN1_OBJECT_‰ì
(
obje˘
);

309 
	`öfof
(
c⁄n
->
d©a
, "Make SPNEGO Initial Token failed\n");

311 if(!
•√goTokí
.
vÆue
 || !•√goTokí.
Àngth
) {

312 
	`Cuæ_ß„‰ì
(
ª•⁄£Tokí
);

313 
	`ASN1_OBJECT_‰ì
(
obje˘
);

314 if(
•√goTokí
.
vÆue
)

315 
	`gss_ªÀa£_buf„r
(&
disˇrd_°
, &
•√goTokí
);

316 
	`öfof
(
c⁄n
->
d©a
, "Make SPNEGO Initial Token succeeded (NULLÅoken)\n");

319 
	`Cuæ_ß„‰ì
(
ª•⁄£Tokí
);

320 
	`ASN1_OBJECT_‰ì
(
obje˘
);

321 
	`gss_ªÀa£_buf„r
(&
disˇrd_°
, &
√g_˘x
->
ouçut_tokí
);

322 
√g_˘x
->
ouçut_tokí
.
vÆue
 = 
•√goTokí
.value;

323 
√g_˘x
->
ouçut_tokí
.
Àngth
 = 
•√goTokí
.length;

324 
	`öfof
(
c⁄n
->
d©a
, "Make SPNEGO Initial Token succeeded\n");

328 
îr‹
 = 
	`Cuæ_ba£64_ícode
(
c⁄n
->
d©a
,

329 
√g_˘x
->
ouçut_tokí
.
vÆue
,

330 
√g_˘x
->
ouçut_tokí
.
Àngth
,

331 &
ícoded
, &
Àn
);

332 if(
îr‹
) {

333 
	`gss_ªÀa£_buf„r
(&
disˇrd_°
, &
√g_˘x
->
ouçut_tokí
);

334 
√g_˘x
->
ouçut_tokí
.
vÆue
 = 
NULL
;

335 
√g_˘x
->
ouçut_tokí
.
Àngth
 = 0;

336  
îr‹
;

339 if(!
ícoded
 || !
Àn
) {

340 
	`gss_ªÀa£_buf„r
(&
disˇrd_°
, &
√g_˘x
->
ouçut_tokí
);

341 
√g_˘x
->
ouçut_tokí
.
vÆue
 = 
NULL
;

342 
√g_˘x
->
ouçut_tokí
.
Àngth
 = 0;

343  
CURLE_REMOTE_ACCESS_DENIED
;

346 
u£Ω
 = 
	`≠rötf
("%sAuth‹iz©i⁄: %†%s\r\n", 
¥oxy
 ? "Proxy-" : "",

347 
√g_˘x
->
¥Ÿocﬁ
, 
ícoded
);

348 if(
¥oxy
) {

349 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
);

350 
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
 = 
u£Ω
;

353 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
u£Ωwd
);

354 
c⁄n
->
Ælo˝å
.
u£Ωwd
 = 
u£Ω
;

357 
	`Cuæ_ß„‰ì
(
ícoded
);

358 
	`Cuæ_˛ónup_√gŸüã
(
c⁄n
->
d©a
);

360  (
u£Ω
 =
NULL
Ë? 
CURLE_OUT_OF_MEMORY
 : 
CURLE_OK
;

361 
	}
}

363 
	$˛ónup
(
√gŸüãd©a
 *
√g_˘x
)

365 
OM_uöt32
 
mö‹_°©us
;

366 if(
√g_˘x
->
c⁄ãxt
 !
GSS_C_NO_CONTEXT
)

367 
	`gss_dñëe_£c_c⁄ãxt
(&
mö‹_°©us
, &
√g_˘x
->
c⁄ãxt
, 
GSS_C_NO_BUFFER
);

369 if(
√g_˘x
->
ouçut_tokí
.
vÆue
)

370 
	`gss_ªÀa£_buf„r
(&
mö‹_°©us
, &
√g_˘x
->
ouçut_tokí
);

372 if(
√g_˘x
->
£rvî_«me
 !
GSS_C_NO_NAME
)

373 
	`gss_ªÀa£_«me
(&
mö‹_°©us
, &
√g_˘x
->
£rvî_«me
);

375 
	`mem£t
(
√g_˘x
, 0, (*neg_ctx));

376 
	}
}

378 
	$Cuæ_˛ónup_√gŸüã
(
Sessi⁄H™dÀ
 *
d©a
)

380 
	`˛ónup
(&
d©a
->
°©e
.
√gŸüã
);

381 
	`˛ónup
(&
d©a
->
°©e
.
¥oxy√g
);

382 
	}
}

	@lib/http_negotiate.h

1 #i‚de‡
HEADER_CURL_HTTP_NEGOTIATE_H


2 
	#HEADER_CURL_HTTP_NEGOTIATE_H


	)

25 #ifde‡
USE_HTTP_NEGOTIATE


28 
Cuæ_öput_√gŸüã
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
,

29 c⁄° *
hódî
);

32 
CURLcode
 
Cuæ_ouçut_√gŸüã
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
);

34 
Cuæ_˛ónup_√gŸüã
(
Sessi⁄H™dÀ
 *
d©a
);

36 #ifde‡
USE_WINDOWS_SSPI


37 
	#GSS_ERROR
(
°©us
Ë(°©u†& 0x80000000)

	)

	@lib/http_negotiate_sspi.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
USE_WINDOWS_SSPI


27 #i‡!
deföed
(
CURL_DISABLE_HTTP
Ë&& deföed(
USE_HTTP_NEGOTIATE
)

29 
	~"uæd©a.h
"

30 
	~"£ndf.h
"

31 
	~"øw°r.h
"

32 
	~"w¨∆ess.h
"

33 
	~"cuæ_ba£64.h
"

34 
	~"hâp_√gŸüã.h
"

35 
	~"cuæ_mem‹y.h
"

36 
	~"cuæ_mu…ibyã.h
"

38 
	#_MPRINTF_REPLACE


	)

39 
	~<cuæ/m¥ötf.h
>

42 
	~"memdebug.h
"

45 
	$gë_gss_«me
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
,

46 
√gŸüãd©a
 *
√g_˘x
)

48 c⁄° * 
£rvi˚
;

49 
size_t
 
Àngth
;

51 if(
¥oxy
 && !
c⁄n
->¥oxy.
«me
)

64 if(
√g_˘x
->
gss
)

65 
£rvi˚
 = "KHTTP";

67 
£rvi˚
 = "HTTP";

69 
Àngth
 = 
	`°æí
(
£rvi˚
Ë+ 1 + såÀn(
¥oxy
 ? 
c⁄n
->¥oxy.
«me
 :

70 
c⁄n
->
ho°
.
«me
) + 1;

71 if(
Àngth
 + 1 > (
√g_˘x
->
£rvî_«me
))

72  
EMSGSIZE
;

74 
	`¢¥ötf
(
√g_˘x
->
£rvî_«me
, (neg_ctx->server_name), "%s/%s",

75 
£rvi˚
, 
¥oxy
 ? 
c⁄n
->¥oxy.
«me
 : c⁄n->
ho°
.name);

78 
	}
}

82 
	$Cuæ_öput_√gŸüã
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
,

83 c⁄° *
hódî
)

85 
√gŸüãd©a
 *
√g_˘x
 = 
¥oxy
?&
c⁄n
->
d©a
->
°©e
.
¥oxy√g
:

86 &
c⁄n
->
d©a
->
°©e
.
√gŸüã
;

87 
BYTE
 *
öput_tokí
 = 0;

88 
SecBuf„rDesc
 
out_buff_desc
;

89 
SecBuf„r
 
out_£c_buff
;

90 
SecBuf„rDesc
 
ö_buff_desc
;

91 
SecBuf„r
 
ö_£c_buff
;

92 
c⁄ãxt_©åibuãs
;

93 
TimeSèmp
 
li„time
;

94 
TCHAR
 *
¢ame
;

95 
ªt
;

96 
size_t
 
Àn
 = 0, 
öput_tokí_Àn
 = 0;

97 
boﬁ
 
gss
 = 
FALSE
;

98 c⁄° * 
¥Ÿocﬁ
;

99 
CURLcode
 
îr‹
;

101 if(
	`check¥efix
("GSS-NegŸüã", 
hódî
)) {

102 
¥Ÿocﬁ
 = "GSS-Negotiate";

103 
gss
 = 
TRUE
;

105 if(
	`check¥efix
("NegŸüã", 
hódî
)) {

106 
¥Ÿocﬁ
 = "Negotiate";

107 
gss
 = 
FALSE
;

112 if(
√g_˘x
->
c⁄ãxt
) {

113 if(
√g_˘x
->
gss
 != gss) {

118 
√g_˘x
->
¥Ÿocﬁ
 =Örotocol;

119 
√g_˘x
->
gss
 = gss;

122 if(
√g_˘x
->
c⁄ãxt
 &&Çeg_˘x->
°©us
 =
SEC_E_OK
) {

126 
	`Cuæ_˛ónup_√gŸüã
(
c⁄n
->
d©a
);

130 if(0 =
	`°æí
(
√g_˘x
->
£rvî_«me
)) {

131 
ªt
 = 
	`gë_gss_«me
(
c⁄n
, 
¥oxy
, 
√g_˘x
);

132 if(
ªt
)

133  
ªt
;

136 if(!
√g_˘x
->
ouçut_tokí
) {

137 
PSecPkgInfo
 
SecurôyPackage
;

138 
ªt
 = 
s_pSecFn
->
	`QuîySecurôyPackageInfo
((
TCHAR
 *Ë
	`TEXT
("Negotiate"),

139 &
SecurôyPackage
);

140 if(
ªt
 !
SEC_E_OK
)

145 
√g_˘x
->
max_tokí_Àngth
 = 
SecurôyPackage
->
cbMaxTokí
;

146 
√g_˘x
->
ouçut_tokí
 = 
	`mÆloc
“eg_˘x->
max_tokí_Àngth
);

147 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
SecurôyPackage
);

151 
hódî
 +
	`°æí
(
√g_˘x
->
¥Ÿocﬁ
);

152 *
hódî
 && 
	`ISSPACE
(*header))

153 
hódî
++;

155 
Àn
 = 
	`°æí
(
hódî
);

156 if(!
Àn
) {

160 
√g_˘x
->
¸edítüls
 = 
	`mÆloc
((
CªdH™dÀ
));

161 
√g_˘x
->
c⁄ãxt
 = 
	`mÆloc
((
CtxtH™dÀ
));

163 if(!
√g_˘x
->
¸edítüls
 || !√g_˘x->
c⁄ãxt
)

166 
√g_˘x
->
°©us
 =

167 
s_pSecFn
->
	`AcquúeCªdítülsH™dÀ
(
NULL
,

168 (
TCHAR
 *Ë
	`TEXT
("Negotiate"),

169 
SECPKG_CRED_OUTBOUND
, 
NULL
, NULL,

170 
NULL
, NULL, 
√g_˘x
->
¸edítüls
,

171 &
li„time
);

172 if(
√g_˘x
->
°©us
 !
SEC_E_OK
)

176 
öput_tokí
 = 
	`mÆloc
(
√g_˘x
->
max_tokí_Àngth
);

177 if(!
öput_tokí
)

180 
îr‹
 = 
	`Cuæ_ba£64_decode
(
hódî
,

181 (**)&
öput_tokí
,

182 &
öput_tokí_Àn
);

183 if(
îr‹
 || 
öput_tokí_Àn
 == 0)

188 
out_buff_desc
.
ulVîsi⁄
 = 0;

189 
out_buff_desc
.
cBuf„rs
 = 1;

190 
out_buff_desc
.
pBuf„rs
 = &
out_£c_buff
;

192 
out_£c_buff
.
cbBuf„r
 = 
	`cuæx_uztoul
(
√g_˘x
->
max_tokí_Àngth
);

193 
out_£c_buff
.
Buf„rTy≥
 = 
SECBUFFER_TOKEN
;

194 
out_£c_buff
.
pvBuf„r
 = 
√g_˘x
->
ouçut_tokí
;

197 if(
öput_tokí
) {

198 
ö_buff_desc
.
ulVîsi⁄
 = 0;

199 
ö_buff_desc
.
cBuf„rs
 = 1;

200 
ö_buff_desc
.
pBuf„rs
 = &
ö_£c_buff
;

202 
ö_£c_buff
.
cbBuf„r
 = 
	`cuæx_uztoul
(
öput_tokí_Àn
);

203 
ö_£c_buff
.
Buf„rTy≥
 = 
SECBUFFER_TOKEN
;

204 
ö_£c_buff
.
pvBuf„r
 = 
öput_tokí
;

207 
¢ame
 = 
	`Cuæ_c⁄vît_UTF8_to_tch¨
(
√g_˘x
->
£rvî_«me
);

208 if(!
¢ame
)

209  
CURLE_OUT_OF_MEMORY
;

211 
√g_˘x
->
°©us
 = 
s_pSecFn
->
	`InôülizeSecurôyC⁄ãxt
(

212 
√g_˘x
->
¸edítüls
,

213 
öput_tokí
 ? 
√g_˘x
->
c⁄ãxt
 : 0,

214 
¢ame
,

215 
ISC_REQ_CONFIDENTIALITY
,

217 
SECURITY_NATIVE_DREP
,

218 
öput_tokí
 ? &
ö_buff_desc
 : 0,

220 
√g_˘x
->
c⁄ãxt
,

221 &
out_buff_desc
,

222 &
c⁄ãxt_©åibuãs
,

223 &
li„time
);

225 
	`Cuæ_unicode‰ì
(
¢ame
);

227 if(
	`GSS_ERROR
(
√g_˘x
->
°©us
))

230 if(
√g_˘x
->
°©us
 =
SEC_I_COMPLETE_NEEDED
 ||

231 
√g_˘x
->
°©us
 =
SEC_I_COMPLETE_AND_CONTINUE
) {

232 
√g_˘x
->
°©us
 = 
s_pSecFn
->
	`Com∂ëeAuthTokí
“eg_˘x->
c⁄ãxt
,

233 &
out_buff_desc
);

234 if(
	`GSS_ERROR
(
√g_˘x
->
°©us
))

238 
√g_˘x
->
ouçut_tokí_Àngth
 = 
out_£c_buff
.
cbBuf„r
;

241 
	}
}

244 
CURLcode
 
	$Cuæ_ouçut_√gŸüã
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
¥oxy
)

246 
√gŸüãd©a
 *
√g_˘x
 = 
¥oxy
?&
c⁄n
->
d©a
->
°©e
.
¥oxy√g
:

247 &
c⁄n
->
d©a
->
°©e
.
√gŸüã
;

248 *
ícoded
 = 
NULL
;

249 
size_t
 
Àn
 = 0;

250 *
u£Ω
;

251 
CURLcode
 
îr‹
;

253 
îr‹
 = 
	`Cuæ_ba£64_ícode
(
c⁄n
->
d©a
,

254 (c⁄° *)
√g_˘x
->
ouçut_tokí
,

255 
√g_˘x
->
ouçut_tokí_Àngth
,

256 &
ícoded
, &
Àn
);

257 if(
îr‹
)

258  
îr‹
;

260 if(
Àn
 == 0)

261  
CURLE_REMOTE_ACCESS_DENIED
;

263 
u£Ω
 = 
	`≠rötf
("%sAuth‹iz©i⁄: %†%s\r\n", 
¥oxy
 ? "Proxy-" : "",

264 
√g_˘x
->
¥Ÿocﬁ
, 
ícoded
);

266 if(
¥oxy
)

267 
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
 = 
u£Ω
;

269 
c⁄n
->
Ælo˝å
.
u£Ωwd
 = 
u£Ω
;

270 
	`‰ì
(
ícoded
);

271 
	`Cuæ_˛ónup_√gŸüã
 (
c⁄n
->
d©a
);

272  (
u£Ω
 =
NULL
Ë? 
CURLE_OUT_OF_MEMORY
 : 
CURLE_OK
;

273 
	}
}

275 
	$˛ónup
(
√gŸüãd©a
 *
√g_˘x
)

277 if(
√g_˘x
->
c⁄ãxt
) {

278 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(
√g_˘x
->
c⁄ãxt
);

279 
	`‰ì
(
√g_˘x
->
c⁄ãxt
);

280 
√g_˘x
->
c⁄ãxt
 = 0;

283 if(
√g_˘x
->
¸edítüls
) {

284 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(
√g_˘x
->
¸edítüls
);

285 
	`‰ì
(
√g_˘x
->
¸edítüls
);

286 
√g_˘x
->
¸edítüls
 = 0;

289 if(
√g_˘x
->
ouçut_tokí
) {

290 
	`‰ì
(
√g_˘x
->
ouçut_tokí
);

291 
√g_˘x
->
ouçut_tokí
 = 0;

294 
√g_˘x
->
max_tokí_Àngth
 = 0;

295 
	}
}

297 
	$Cuæ_˛ónup_√gŸüã
(
Sessi⁄H™dÀ
 *
d©a
)

299 
	`˛ónup
(&
d©a
->
°©e
.
√gŸüã
);

300 
	`˛ónup
(&
d©a
->
°©e
.
¥oxy√g
);

301 
	}
}

	@lib/http_proxy.c

23 
	~"cuæ_£tup.h
"

25 #i‡!
deföed
(
CURL_DISABLE_PROXY
Ë&& !deföed(
CURL_DISABLE_HTTP
)

27 
	~"uæd©a.h
"

28 
	~<cuæ/cuæ.h
>

29 
	~"hâp_¥oxy.h
"

30 
	~"£ndf.h
"

31 
	~"hâp.h
"

32 
	~"uæ.h
"

33 
	~"£À˘.h
"

34 
	~"øw°r.h
"

35 
	~"¥ogªss.h
"

36 
	~"n⁄-ascii.h
"

37 
	~"c⁄√˘.h
"

39 
	#_MPRINTF_REPLACE


	)

40 
	~<cuæ/m¥ötf.h
>

42 
	~"cuæx.h
"

44 
	~"cuæ_mem‹y.h
"

46 
	~"memdebug.h
"

48 
CURLcode
 
	$Cuæ_¥oxy_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
)

50 if(
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 && c⁄n->bôs.
hâµroxy
) {

51 #i‚de‡
CURL_DISABLE_PROXY


53 
HTTP
 
hâp_¥oxy
;

54 *
¥Ÿ_ßve
;

55 
CURLcode
 
ªsu…
;

69 
¥Ÿ_ßve
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

70 
	`mem£t
(&
hâp_¥oxy
, 0, (http_proxy));

71 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
 = &
hâp_¥oxy
;

72 
	`c⁄nkìp
(
c⁄n
, "HTTPÖroxy CONNECT");

73 
ªsu…
 = 
	`Cuæ_¥oxyCONNECT
(
c⁄n
, 
FIRSTSOCKET
,

74 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

75 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
 = 
¥Ÿ_ßve
;

76 if(
CURLE_OK
 !
ªsu…
)

77  
ªsu…
;

79  
CURLE_NOT_BUILT_IN
;

83  
CURLE_OK
;

84 
	}
}

92 
CURLcode
 
	$Cuæ_¥oxyCONNECT
(
c⁄√˘d©a
 *
c⁄n
,

93 
socködex
,

94 c⁄° *
ho°«me
,

95 
ªmŸe_p‹t
)

97 
subvîsi⁄
=0;

98 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

99 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

100 
CURLcode
 
ªsu…
;

101 
timeout
 =

102 
d©a
->
£t
.
timeout
?d©a->£t.timeout:
PROXY_TIMEOUT
;

103 
cuæ_sockë_t
 
tu¬ñsockë
 = 
c⁄n
->
sock
[
socködex
];

104 
cuæ_off_t
 
˛
=0;

105 
boﬁ
 
˛o£C⁄√˘i⁄
 = 
FALSE
;

106 
boﬁ
 
chunked_ícodög
 = 
FALSE
;

107 
check
;

109 
	#SELECT_OK
 0

	)

110 
	#SELECT_ERROR
 1

	)

111 
	#SELECT_TIMEOUT
 2

	)

112 
îr‹
 = 
SELECT_OK
;

114 if(
c⁄n
->
tu¬ñ_°©e
[
socködex
] =
TUNNEL_COMPLETE
)

115  
CURLE_OK
;

117 
c⁄n
->
bôs
.
¥oxy_c⁄√˘_˛o£d
 = 
FALSE
;

120 if(
TUNNEL_INIT
 =
c⁄n
->
tu¬ñ_°©e
[
socködex
]) {

122 *
ho°_p‹t
;

123 
Cuæ_£nd_buf„r
 *
ªq_buf„r
;

125 
	`öfof
(
d©a
, "Establish HTTPÖroxyÅunnelÅo %s:%hu\n",

126 
ho°«me
, 
ªmŸe_p‹t
);

128 if(
d©a
->
ªq
.
√wuæ
) {

132 
	`‰ì
(
d©a
->
ªq
.
√wuæ
);

133 
d©a
->
ªq
.
√wuæ
 = 
NULL
;

137 
ªq_buf„r
 = 
	`Cuæ_add_buf„r_öô
();

139 if(!
ªq_buf„r
)

140  
CURLE_OUT_OF_MEMORY
;

142 
ho°_p‹t
 = 
	`≠rötf
("%s:%hu", 
ho°«me
, 
ªmŸe_p‹t
);

143 if(!
ho°_p‹t
) {

144 
	`‰ì
(
ªq_buf„r
);

145  
CURLE_OUT_OF_MEMORY
;

149 
ªsu…
 = 
	`Cuæ_hâp_ouçut_auth
(
c⁄n
, "CONNECT", 
ho°_p‹t
, 
TRUE
);

151 
	`‰ì
(
ho°_p‹t
);

153 if(
CURLE_OK
 =
ªsu…
) {

154 *
ho°
=(*)"";

155 c⁄° *
¥oxyc⁄n
="";

156 c⁄° *
u£øgít
="";

157 c⁄° *
hâp
 = (
c⁄n
->
¥oxyty≥
 =
CURLPROXY_HTTP_1_0
) ?

159 *
ho°hódî
=

160 
	`≠rötf
("%s%s%s:%hu", 
c⁄n
->
bôs
.
ùv6_ù
?"[":"",

161 
ho°«me
, 
c⁄n
->
bôs
.
ùv6_ù
?"]":"",

162 
ªmŸe_p‹t
);

163 if(!
ho°hódî
) {

164 
	`‰ì
(
ªq_buf„r
);

165  
CURLE_OUT_OF_MEMORY
;

168 if(!
	`Cuæ_checkProxyhódîs
(
c⁄n
, "Host:")) {

169 
ho°
 = 
	`≠rötf
("Ho°: %s\r\n", 
ho°hódî
);

170 if(!
ho°
) {

171 
	`‰ì
(
ho°hódî
);

172 
	`‰ì
(
ªq_buf„r
);

173  
CURLE_OUT_OF_MEMORY
;

176 if(!
	`Cuæ_checkProxyhódîs
(
c⁄n
, "Proxy-Connection:"))

177 
¥oxyc⁄n
 = "Proxy-Connection: Keep-Alive\r\n";

179 if(!
	`Cuæ_checkProxyhódîs
(
c⁄n
, "User-Agent:") &&

180 
d©a
->
£t
.
°r
[
STRING_USERAGENT
])

181 
u£øgít
 = 
c⁄n
->
Ælo˝å
.
uagít
;

183 
ªsu…
 =

184 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

190 
ho°hódî
,

191 
hâp
,

192 
ho°
,

193 
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
?

194 
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
:"",

195 
u£øgít
,

196 
¥oxyc⁄n
);

198 if(
ho°
 && *host)

199 
	`‰ì
(
ho°
);

200 
	`‰ì
(
ho°hódî
);

202 if(
CURLE_OK
 =
ªsu…
)

203 
ªsu…
 = 
	`Cuæ_add_cu°om_hódîs
(
c⁄n
, 
TRUE
, 
ªq_buf„r
);

205 if(
CURLE_OK
 =
ªsu…
)

207 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "\r\n");

209 if(
CURLE_OK
 =
ªsu…
) {

212 
ªsu…
 =

213 
	`Cuæ_add_buf„r_£nd
(
ªq_buf„r
, 
c⁄n
,

214 &
d©a
->
öfo
.
ªque°_size
, 0, 
socködex
);

216 
ªq_buf„r
 = 
NULL
;

217 if(
ªsu…
)

218 
	`Áûf
(
d©a
, "Failed sending CONNECTÅoÖroxy");

221 
	`Cuæ_ß„‰ì
(
ªq_buf„r
);

222 if(
ªsu…
)

223  
ªsu…
;

225 
c⁄n
->
tu¬ñ_°©e
[
socködex
] = 
TUNNEL_CONNECT
;

229  
CURLE_OK
;

234 
size_t
 
ƒód
;

235 
≥æöe
;

236 
kìp⁄
=
TRUE
;

237 
ssize_t
 
gŸbyãs
;

238 *
±r
;

239 *
löe_°¨t
;

241 
±r
=
d©a
->
°©e
.
buf„r
;

242 
löe_°¨t
 = 
±r
;

244 
ƒód
=0;

245 
≥æöe
=0;

246 
kìp⁄
=
TRUE
;

248 (
ƒód
<
BUFSIZE
Ë&& (
kìp⁄
 && !
îr‹
)) {

251 
check
 = 
timeout
 -

252 
	`Cuæ_tvdiff
(
	`Cuæ_tvnow
(), 
c⁄n
->
now
);

253 if(
check
 <= 0) {

254 
	`Áûf
(
d©a
, "Proxy CONNECTáborted dueÅoÅimeout");

255 
îr‹
 = 
SELECT_TIMEOUT
;

260 
	`Cuæ_sockë_ªady
(
tu¬ñsockë
, 
CURL_SOCKET_BAD
,

261 
check
<1000L?check:1000)) {

263 
îr‹
 = 
SELECT_ERROR
;

264 
	`Áûf
(
d©a
, "Proxy CONNECTáborted dueÅo select/pollÉrror");

269 
	`DEBUGASSERT
(
±r
+
BUFSIZE
-
ƒód
 <
d©a
->
°©e
.
buf„r
+BUFSIZE+1);

270 
ªsu…
 = 
	`Cuæ_ªad
(
c⁄n
, 
tu¬ñsockë
, 
±r
, 
BUFSIZE
-
ƒód
,

271 &
gŸbyãs
);

272 if(
ªsu…
==
CURLE_AGAIN
)

274 if(
ªsu…
)

275 
kìp⁄
 = 
FALSE
;

276 if(
gŸbyãs
 <= 0) {

277 
kìp⁄
 = 
FALSE
;

278 if(
d©a
->
£t
.
¥oxyauth
 && d©a->
°©e
.
auth¥oxy
.
avaû
) {

281 
c⁄n
->
bôs
.
¥oxy_c⁄√˘_˛o£d
 = 
TRUE
;

284 
îr‹
 = 
SELECT_ERROR
;

285 
	`Áûf
(
d©a
, "Proxy CONNECTáborted");

294 
i
;

296 
ƒód
 +
gŸbyãs
;

298 if(
kìp⁄
 > 
TRUE
) {

301 
ƒód
 = 0;

302 
±r
=
d©a
->
°©e
.
buf„r
;

303 if(
˛
) {

306 
˛
 -
gŸbyãs
;

307 if(
˛
<=0) {

308 
kìp⁄
 = 
FALSE
;

315 
CHUNKcode
 
r
;

316 
ssize_t
 
tookˇªof
=0;

320 
r
 = 
	`Cuæ_hâpchunk_ªad
(
c⁄n
, 
±r
, 
gŸbyãs
, &
tookˇªof
);

321 if(
r
 =
CHUNKE_STOP
) {

323 
	`öfof
(
d©a
, "chunkÑeading DONE\n");

324 
kìp⁄
 = 
FALSE
;

326 
c⁄n
->
tu¬ñ_°©e
[
socködex
] = 
TUNNEL_COMPLETE
;

329 
	`öfof
(
d©a
, "Read %zd bytes of chunk, continue\n",

330 
tookˇªof
);

334 
i
 = 0; i < 
gŸbyãs
; 
±r
++, i++) {

335 
≥æöe
++;

336 if(*
±r
 == 0x0a) {

337 
Àâî
;

338 
wrôëy≥
;

341 
ªsu…
 = 
	`Cuæ_c⁄vît_‰om_√tw‹k
(
d©a
, 
löe_°¨t
,

342 
≥æöe
);

344 if(
ªsu…
)

345  
ªsu…
;

348 if(
d©a
->
£t
.
vîbo£
)

349 
	`Cuæ_debug
(
d©a
, 
CURLINFO_HEADER_IN
,

350 
löe_°¨t
, (
size_t
)
≥æöe
, 
c⁄n
);

353 
wrôëy≥
 = 
CLIENTWRITE_HEADER
;

354 if(
d©a
->
£t
.
ö˛ude_hódî
)

355 
wrôëy≥
 |
CLIENTWRITE_BODY
;

357 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
wrôëy≥
, 
löe_°¨t
,

358 
≥æöe
);

360 
d©a
->
öfo
.
hódî_size
 +()
≥æöe
;

361 
d©a
->
ªq
.
hódîbyãcou¡
 +()
≥æöe
;

363 if(
ªsu…
)

364  
ªsu…
;

370 if(('\r' =
löe_°¨t
[0]) ||

371 ('\n' =
löe_°¨t
[0])) {

373 
ƒód
 = 0;

375 
±r
=
d©a
->
°©e
.
buf„r
;

376 if((407 =
k
->
hâpcode
Ë&& !
d©a
->
°©e
.
auth¥obÀm
) {

380 
kìp⁄
 = 2;

382 if(
˛
) {

383 
	`öfof
(
d©a
, "Ign‹ê%" 
CURL_FORMAT_CURL_OFF_T


384 " byã†o‡ª•⁄£-body\n", 
˛
);

388 
˛
 -(
gŸbyãs
 - 
i
);

390 if(
˛
<=0)

393 
kìp⁄
=
FALSE
;

395 if(
chunked_ícodög
) {

396 
CHUNKcode
 
r
;

401 
k
->
ign‹ebody
 = 
TRUE
;

402 
	`öfof
(
d©a
, "%zd byã†o‡chunkÜe·\n", 
gŸbyãs
-
i
);

404 if(
löe_°¨t
[1] == '\n') {

407 
löe_°¨t
++;

408 
i
++;

413 
r
 = 
	`Cuæ_hâpchunk_ªad
(
c⁄n
, 
löe_°¨t
+1,

414 
gŸbyãs
 -
i
, &gotbytes);

415 if(
r
 =
CHUNKE_STOP
) {

417 
	`öfof
(
d©a
, "chunkÑeading DONE\n");

418 
kìp⁄
 = 
FALSE
;

421 
c⁄n
->
tu¬ñ_°©e
[
socködex
] = 
TUNNEL_COMPLETE
;

424 
	`öfof
(
d©a
, "Read %zd bytes of chunk, continue\n",

425 
gŸbyãs
);

431 
kìp⁄
=
FALSE
;

435 
kìp⁄
 = 
FALSE
;

436 if(200 =
d©a
->
öfo
.
hâµroxycode
) {

437 if(
gŸbyãs
 - (
i
+1))

438 
	`Áûf
(
d©a
, "Proxy CONNECT followed by %zd bytes "

440 
gŸbyãs
 - (
i
+1));

444 
c⁄n
->
tu¬ñ_°©e
[
socködex
] = 
TUNNEL_COMPLETE
;

449 
Àâî
 = 
löe_°¨t
[
≥æöe
];

450 
löe_°¨t
[
≥æöe
]=0;

451 if((
	`check¥efix
("WWW-Authítiˇã:", 
löe_°¨t
) &&

452 (401 =
k
->
hâpcode
)) ||

453 (
	`check¥efix
("Proxy-authítiˇã:", 
löe_°¨t
) &&

454 (407 =
k
->
hâpcode
))) {

456 
boﬁ
 
¥oxy
 = (
k
->
hâpcode
 =407Ë? 
TRUE
 : 
FALSE
;

457 *
auth
 = 
	`Cuæ_c›y_hódî_vÆue
(
löe_°¨t
);

458 if(!
auth
)

459  
CURLE_OUT_OF_MEMORY
;

461 
ªsu…
 = 
	`Cuæ_hâp_öput_auth
(
c⁄n
, 
¥oxy
, 
auth
);

463 
	`Cuæ_ß„‰ì
(
auth
);

465 if(
ªsu…
)

466  
ªsu…
;

468 if(
	`check¥efix
("C⁄ã¡-Lígth:", 
löe_°¨t
)) {

469 
˛
 = 
	`cuæx_°πoof·
(
löe_°¨t
 +

470 
	`°æí
("C⁄ã¡-Lígth:"), 
NULL
, 10);

472 if(
	`Cuæ_com∑ªhódî
(
löe_°¨t
,

474 
˛o£C⁄√˘i⁄
 = 
TRUE
;

475 if(
	`Cuæ_com∑ªhódî
(
löe_°¨t
,

478 
	`öfof
(
d©a
, "CONNECTÑesponded chunked\n");

479 
chunked_ícodög
 = 
TRUE
;

481 
	`Cuæ_hâpchunk_öô
(
c⁄n
);

483 if(
	`Cuæ_com∑ªhódî
(
löe_°¨t
,

485 
˛o£C⁄√˘i⁄
 = 
TRUE
;

486 if(2 =
	`ssˇnf
(
löe_°¨t
, "HTTP/1.%d %d",

487 &
subvîsi⁄
,

488 &
k
->
hâpcode
)) {

490 
d©a
->
öfo
.
hâµroxycode
 = 
k
->
hâpcode
;

493 
löe_°¨t
[
≥æöe
]
Àâî
;

495 
≥æöe
=0;

496 
löe_°¨t
 = 
±r
+1;

502 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

503  
CURLE_ABORTED_BY_CALLBACK
;

506 if(
îr‹
)

507  
CURLE_RECV_ERROR
;

509 if(
d©a
->
öfo
.
hâµroxycode
 != 200) {

512 
ªsu…
 = 
	`Cuæ_hâp_auth_a˘
(
c⁄n
);

513 if(
ªsu…
)

514  
ªsu…
;

516 if(
c⁄n
->
bôs
.
˛o£
)

521 
˛o£C⁄√˘i⁄
 = 
TRUE
;

524 if(
˛o£C⁄√˘i⁄
 && 
d©a
->
ªq
.
√wuæ
) {

526 
	`Cuæ_˛o£sockë
(
c⁄n
, c⁄n->
sock
[
socködex
]);

527 
c⁄n
->
sock
[
socködex
] = 
CURL_SOCKET_BAD
;

535 if(
d©a
->
ªq
.
√wuæ
 &&

536 (
TUNNEL_COMPLETE
 =
c⁄n
->
tu¬ñ_°©e
[
socködex
])) {

537 
c⁄n
->
tu¬ñ_°©e
[
socködex
] = 
TUNNEL_INIT
;

538 
	`öfof
(
d©a
, "TUNNEL_STATE switchedÅo: %d\n",

539 
c⁄n
->
tu¬ñ_°©e
[
socködex
]);

542 } 
d©a
->
ªq
.
√wuæ
);

544 if(200 !
d©a
->
ªq
.
hâpcode
) {

545 
	`Áûf
(
d©a
, "Received HTTP code %d fromÖroxyáfter CONNECT",

546 
d©a
->
ªq
.
hâpcode
);

548 if(
˛o£C⁄√˘i⁄
 && 
d©a
->
ªq
.
√wuæ
)

549 
c⁄n
->
bôs
.
¥oxy_c⁄√˘_˛o£d
 = 
TRUE
;

551 if(
d©a
->
ªq
.
√wuæ
) {

553 
	`‰ì
(
d©a
->
ªq
.
√wuæ
);

554 
d©a
->
ªq
.
√wuæ
 = 
NULL
;

558 
c⁄n
->
tu¬ñ_°©e
[
socködex
] = 
TUNNEL_INIT
;

560  
CURLE_RECV_ERROR
;

563 
c⁄n
->
tu¬ñ_°©e
[
socködex
] = 
TUNNEL_COMPLETE
;

568 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
);

569 
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
 = 
NULL
;

571 
d©a
->
°©e
.
auth¥oxy
.
d⁄e
 = 
TRUE
;

573 
	`öfof
 (
d©a
, "ProxyÑeplied OKÅo CONNECTÑequest\n");

574 
d©a
->
ªq
.
ign‹ebody
 = 
FALSE
;

575 
c⁄n
->
bôs
.
ªwöda·î£nd
 = 
FALSE
;

577  
CURLE_OK
;

578 
	}
}

	@lib/http_proxy.h

1 #i‚de‡
HEADER_CURL_HTTP_PROXY_H


2 
	#HEADER_CURL_HTTP_PROXY_H


	)

25 #i‡!
deföed
(
CURL_DISABLE_PROXY
Ë&& !deföed(
CURL_DISABLE_HTTP
)

27 
CURLcode
 
Cuæ_¥oxyCONNECT
(
c⁄√˘d©a
 *
c⁄n
,

28 
tu¬ñsockë
,

29 c⁄° *
ho°«me
, 
ªmŸe_p‹t
);

32 
	#PROXY_TIMEOUT
 (3600*1000)

	)

34 
CURLcode
 
Cuæ_¥oxy_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
);

37 
	#Cuæ_¥oxyCONNECT
(
x
,
y
,
z
,
w
Ë
CURLE_NOT_BUILT_IN


	)

38 
	#Cuæ_¥oxy_c⁄√˘
(
x
Ë
CURLE_OK


	)

	@lib/idn_win32.c

27 
	~"cuæ_£tup.h
"

29 #ifde‡
USE_WIN32_IDN


31 
	~"cuæ_mu…ibyã.h
"

33 
	~"cuæ_mem‹y.h
"

35 
	~"memdebug.h
"

37 #ifde‡
WANT_IDN_PROTOTYPES


38 
WINBASEAPI
 
WINAPI
 
IdnToAscii
(
DWORD
, c⁄° 
WCHAR
 *, , WCHAR *, );

39 
WINBASEAPI
 
WINAPI
 
IdnToUnicode
(
DWORD
, c⁄° 
WCHAR
 *, , WCHAR *, );

42 
	#IDN_MAX_LENGTH
 255

	)

44 
cuæ_wö32_idn_to_ascii
(c⁄° *
ö
, **
out
);

45 
cuæ_wö32_ascii_to_idn
(c⁄° *
ö
, 
size_t
 
ö_Àn
, **
out_utf8
);

47 
	$cuæ_wö32_idn_to_ascii
(c⁄° *
ö
, **
out
)

49 
wch¨_t
 *
ö_w
 = 
	`Cuæ_c⁄vît_UTF8_to_wch¨
(
ö
);

50 if(
ö_w
) {

51 
wch¨_t
 
punycode
[
IDN_MAX_LENGTH
];

52 if(
	`IdnToAscii
(0, 
ö_w
, -1, 
punycode
, 
IDN_MAX_LENGTH
) == 0) {

53 
	`w¥ötf
(
L
"ERROR %d c⁄vîtögÅÿPunycode\n", 
	`GëLa°Eº‹
());

54 
	`‰ì
(
ö_w
);

57 
	`‰ì
(
ö_w
);

59 *
out
 = 
	`Cuæ_c⁄vît_wch¨_to_UTF8
(
punycode
);

60 if(!*
out
)

64 
	}
}

66 
	$cuæ_wö32_ascii_to_idn
(c⁄° *
ö
, 
size_t
 
ö_Àn
, **
out_utf8
)

68 ()
ö_Àn
;

69 if(
ö
) {

70 
WCHAR
 
unicode
[
IDN_MAX_LENGTH
];

72 if(
	`IdnToUnicode
(0, (
wch¨_t
 *)
ö
, -1, 
unicode
, 
IDN_MAX_LENGTH
) == 0) {

73 
	`w¥ötf
(
L
"ERROR %d c⁄vîtögÅÿPunycode\n", 
	`GëLa°Eº‹
());

77 *
out_utf8
 = 
	`Cuæ_c⁄vît_wch¨_to_UTF8
(
unicode
);

78 if(!*
out_utf8
)

83 
	}
}

	@lib/if2ip.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_NETINET_IN_H


26 
	~<√töë/ö.h
>

28 #ifde‡
HAVE_ARPA_INET_H


29 
	~<¨∑/öë.h
>

31 #ifde‡
HAVE_NET_IF_H


32 
	~<√t/if.h
>

34 #ifde‡
HAVE_SYS_IOCTL_H


35 
	~<sys/io˘l.h
>

37 #ifde‡
HAVE_NETDB_H


38 
	~<√tdb.h
>

40 #ifde‡
HAVE_SYS_SOCKIO_H


41 
	~<sys/sockio.h
>

43 #ifde‡
HAVE_IFADDRS_H


44 
	~<iÁddrs.h
>

46 #ifde‡
HAVE_STROPTS_H


47 
	~<°r›ts.h
>

49 #ifde‡
__VMS


50 
	~<öë.h
>

53 
	~"öë_¡›.h
"

54 
	~"°ªquÆ.h
"

55 
	~"if2ù.h
"

57 
	#_MPRINTF_REPLACE


	)

58 
	~<cuæ/m¥ötf.h
>

60 
	~"cuæ_mem‹y.h
"

62 
	~"memdebug.h
"

66 #i‡
deföed
(
HAVE_GETIFADDRS
)

68 
boﬁ
 
	$Cuæ_if_is_öãrÁ˚_«me
(c⁄° *
öãrf
)

70 
boﬁ
 
ªsu…
 = 
FALSE
;

72 
iÁddrs
 *
iÁ˚
, *
hód
;

74 if(
	`gëiÁddrs
(&
hód
) >= 0) {

75 
iÁ˚
=
hód
; iÁ˚ !
NULL
; iÁ˚=iÁ˚->
iÁ_√xt
) {

76 if(
	`cuæ_°ªquÆ
(
iÁ˚
->
iÁ_«me
, 
öãrf
)) {

77 
ªsu…
 = 
TRUE
;

81 
	`‰ìiÁddrs
(
hód
);

83  
ªsu…
;

84 
	}
}

86 
if2ù_ªsu…_t
 
	$Cuæ_if2ù
(
af
, 
ªmŸe_sc›e
,

87 c⁄° *
öãrf
, *
buf
, 
buf_size
)

89 
iÁddrs
 *
iÁ˚
, *
hód
;

90 
if2ù_ªsu…_t
 
ªs
 = 
IF2IP_NOT_FOUND
;

92 #i‚de‡
ENABLE_IPV6


93 (Ë
ªmŸe_sc›e
;

96 if(
	`gëiÁddrs
(&
hód
) >= 0) {

97 
iÁ˚
=
hód
; iÁ˚ !
NULL
; iÁ˚=iÁ˚->
iÁ_√xt
) {

98 if(
iÁ˚
->
iÁ_addr
 !
NULL
) {

99 if(
iÁ˚
->
iÁ_addr
->
ß_Ámûy
 =
af
) {

100 if(
	`cuæ_°ªquÆ
(
iÁ˚
->
iÁ_«me
, 
öãrf
)) {

101 *
addr
;

102 *
ù
;

103 
sc›e
[12]="";

104 
ù°r
[64];

105 #ifde‡
ENABLE_IPV6


106 if(
af
 =
AF_INET6
) {

107 
sc›eid
 = 0;

108 
addr
 = &((
sockaddr_ö6
 *)
iÁ˚
->
iÁ_addr
)->
sö6_addr
;

109 #ifde‡
HAVE_SOCKADDR_IN6_SIN6_SCOPE_ID


111 
sc›eid
 =

112 ((
sockaddr_ö6
 *)
iÁ˚
->
iÁ_addr
)->
sö6_sc›e_id
;

114 if(
sc›eid
 !
ªmŸe_sc›e
) {

119 if(
ªs
 =
IF2IP_NOT_FOUND
Ëª†
IF2IP_AF_NOT_SUPPORTED
;

122 if(
sc›eid
)

123 
	`¢¥ötf
(
sc›e
, (sc›e), "%%%u", 
sc›eid
);

127 
addr
 = &((
sockaddr_ö
 *)
iÁ˚
->
iÁ_addr
)->
sö_addr
;

128 
ªs
 = 
IF2IP_FOUND
;

129 
ù
 = (*Ë
	`Cuæ_öë_¡›
(
af
, 
addr
, 
ù°r
, (ipstr));

130 
	`¢¥ötf
(
buf
, 
buf_size
, "%s%s", 
ù
, 
sc›e
);

134 if((
ªs
 =
IF2IP_NOT_FOUND
) &&

135 
	`cuæ_°ªquÆ
(
iÁ˚
->
iÁ_«me
, 
öãrf
)) {

136 
ªs
 = 
IF2IP_AF_NOT_SUPPORTED
;

140 
	`‰ìiÁddrs
(
hód
);

142  
ªs
;

143 
	}
}

145 #ñi‡
deföed
(
HAVE_IOCTL_SIOCGIFADDR
)

147 
boﬁ
 
	$Cuæ_if_is_öãrÁ˚_«me
(c⁄° *
öãrf
)

150 
buf
[256];

152  (
	`Cuæ_if2ù
(
AF_INET
, 0, 
öãrf
, 
buf
, (buf)) ==

153 
IF2IP_NOT_FOUND
Ë? 
FALSE
 : 
TRUE
;

154 
	}
}

156 
if2ù_ªsu…_t
 
	$Cuæ_if2ù
(
af
, 
ªmŸe_sc›e
,

157 c⁄° *
öãrf
, *
buf
, 
buf_size
)

159 
i‰eq
 
ªq
;

160 
ö_addr
 
ö
;

161 
sockaddr_ö
 *
s
;

162 
cuæ_sockë_t
 
dummy
;

163 
size_t
 
Àn
;

165 ()
ªmŸe_sc›e
;

167 if(!
öãrf
 || (
af
 !
AF_INET
))

168  
IF2IP_NOT_FOUND
;

170 
Àn
 = 
	`°æí
(
öãrf
);

171 if(
Àn
 >(
ªq
.
i‰_«me
))

172  
IF2IP_NOT_FOUND
;

174 
dummy
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0);

175 if(
CURL_SOCKET_BAD
 =
dummy
)

176  
IF2IP_NOT_FOUND
;

178 
	`mem£t
(&
ªq
, 0, (req));

179 
	`mem˝y
(
ªq
.
i‰_«me
, 
öãrf
, 
Àn
+1);

180 
ªq
.
i‰_addr
.
ß_Ámûy
 = 
AF_INET
;

182 if(
	`io˘l
(
dummy
, 
SIOCGIFADDR
, &
ªq
) < 0) {

183 
	`s˛o£
(
dummy
);

187  
IF2IP_NOT_FOUND
;

190 
s
 = (
sockaddr_ö
 *)&
ªq
.
i‰_addr
;

191 
	`mem˝y
(&
ö
, &
s
->
sö_addr
, (in));

192 
	`Cuæ_öë_¡›
(
s
->
sö_Ámûy
, &
ö
, 
buf
, 
buf_size
);

194 
	`s˛o£
(
dummy
);

195  
IF2IP_FOUND
;

196 
	}
}

200 
boﬁ
 
	$Cuæ_if_is_öãrÁ˚_«me
(c⁄° *
öãrf
)

202 (Ë
öãrf
;

204  
FALSE
;

205 
	}
}

207 
if2ù_ªsu…_t
 
	$Cuæ_if2ù
(
af
, 
ªmŸe_sc›e
,

208 c⁄° *
öãrf
, *
buf
, 
buf_size
)

210 (Ë
af
;

211 (Ë
ªmŸe_sc›e
;

212 (Ë
öãrf
;

213 (Ë
buf
;

214 (Ë
buf_size
;

215  
IF2IP_NOT_FOUND
;

216 
	}
}

	@lib/if2ip.h

1 #i‚de‡
HEADER_CURL_IF2IP_H


2 
	#HEADER_CURL_IF2IP_H


	)

24 
	~"cuæ_£tup.h
"

26 
boﬁ
 
Cuæ_if_is_öãrÁ˚_«me
(c⁄° *
öãrf
);

29 
	mIF2IP_NOT_FOUND
 = 0,

30 
	mIF2IP_AF_NOT_SUPPORTED
 = 1,

31 
	mIF2IP_FOUND
 = 2

32 } 
	tif2ù_ªsu…_t
;

34 
if2ù_ªsu…_t
 
Cuæ_if2ù
(
af
, 
ªmŸe_sc›e
,

35 c⁄° *
öãrf
, *
buf
, 
buf_size
);

37 #ifde‡
__INTERIX


40 
	si‰eq
 {

41 
	#IFNAMSIZ
 16

	)

42 
	#IFHWADDRLEN
 6

	)

44 
	mi‰n_«me
[
IFNAMSIZ
];

45 } 
	mi‰_i‰n
;

48 
sockaddr
 
	mi‰u_addr
;

49 
sockaddr
 
	mi‰u_brﬂdaddr
;

50 
sockaddr
 
	mi‰u_√tmask
;

51 
sockaddr
 
	mi‰u_hwaddr
;

52 
	mi‰u_Êags
;

53 
	mi‰u_mëric
;

54 
	mi‰u_mtu
;

55 } 
	mi‰_i‰u
;

61 
	#i‰_«me
 
i‰_i‰n
.
i‰n_«me


	)

62 
	#i‰_addr
 
i‰_i‰u
.
i‰u_addr


	)

63 
	#i‰_brﬂdaddr
 
i‰_i‰u
.
i‰u_brﬂdaddr


	)

64 
	#i‰_√tmask
 
i‰_i‰u
.
i‰u_√tmask


	)

65 
	#i‰_Êags
 
i‰_i‰u
.
i‰u_Êags


	)

66 
	#i‰_hwaddr
 
i‰_i‰u
.
i‰u_hwaddr


	)

67 
	#i‰_mëric
 
i‰_i‰u
.
i‰u_mëric


	)

68 
	#i‰_mtu
 
i‰_i‰u
.
i‰u_mtu


	)

70 
	#SIOCGIFADDR
 
	`_IOW
('s', 102, 
i‰eq
Ë

	)

	@lib/imap.c

34 
	~"cuæ_£tup.h
"

36 #i‚de‡
CURL_DISABLE_IMAP


38 #ifde‡
HAVE_NETINET_IN_H


39 
	~<√töë/ö.h
>

41 #ifde‡
HAVE_ARPA_INET_H


42 
	~<¨∑/öë.h
>

44 #ifde‡
HAVE_UTSNAME_H


45 
	~<sys/ut¢ame.h
>

47 #ifde‡
HAVE_NETDB_H


48 
	~<√tdb.h
>

50 #ifde‡
__VMS


51 
	~<ö.h
>

52 
	~<öë.h
>

55 #i‡(
deföed
(
NETWARE
Ë&& deföed(
__NOVELL_LIBC__
))

56 #unde‡
ö_addr_t


57 
	#ö_addr_t
 

	)

60 
	~<cuæ/cuæ.h
>

61 
	~"uæd©a.h
"

62 
	~"£ndf.h
"

63 
	~"if2ù.h
"

64 
	~"ho°ù.h
"

65 
	~"¥ogªss.h
"

66 
	~"å™s„r.h
"

67 
	~"esˇ≥.h
"

68 
	~"hâp.h
"

69 
	~"socks.h
"

70 
	~"im≠.h
"

72 
	~"°πoof·.h
"

73 
	~"°ªquÆ.h
"

74 
	~"vés/vés.h
"

75 
	~"c⁄√˘.h
"

76 
	~"°ªº‹.h
"

77 
	~"£À˘.h
"

78 
	~"mu…iif.h
"

79 
	~"uæ.h
"

80 
	~"øw°r.h
"

81 
	~"cuæ_ß¶.h
"

82 
	~"w¨∆ess.h
"

84 
	#_MPRINTF_REPLACE


	)

85 
	~<cuæ/m¥ötf.h
>

87 
	~"cuæ_mem‹y.h
"

89 
	~"memdebug.h
"

92 
CURLcode
 
im≠_ªguœr_å™s„r
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

93 
CURLcode
 
im≠_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

94 
CURLcode
 
im≠_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, CURLcodê
°©us
,

95 
boﬁ
 
¥em©uª
);

96 
CURLcode
 
im≠_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

97 
CURLcode
 
im≠_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód
);

98 
CURLcode
 
im≠_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

99 
im≠_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

100 
numsocks
);

101 
CURLcode
 
im≠_doög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d›ha£_d⁄e
);

102 
CURLcode
 
im≠_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
);

103 *
im≠_©om
(c⁄° *
°r
);

104 
CURLcode
 
im≠_£ndf
(
c⁄√˘d©a
 *
c⁄n
, c⁄° *
fmt
, ...);

105 
CURLcode
 
im≠_∑r£_uæ_›ti⁄s
(
c⁄√˘d©a
 *
c⁄n
);

106 
CURLcode
 
im≠_∑r£_uæ_∑th
(
c⁄√˘d©a
 *
c⁄n
);

107 
CURLcode
 
im≠_∑r£_cu°om_ªque°
(
c⁄√˘d©a
 *
c⁄n
);

108 
CURLcode
 
im≠_ˇlc_ß¶_dëaûs
(
c⁄√˘d©a
 *
c⁄n
,

109 c⁄° **
mech
,

110 **
öôª•
, 
size_t
 *
Àn
,

111 
im≠°©e
 *
°©e1
, im≠°©ê*
°©e2
);

117 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_im≠
 = {

119 
im≠_£tup_c⁄√˘i⁄
,

120 
im≠_do
,

121 
im≠_d⁄e
,

122 
ZERO_NULL
,

123 
im≠_c⁄√˘
,

124 
im≠_mu…i_°©emach
,

125 
im≠_doög
,

126 
im≠_gësock
,

127 
im≠_gësock
,

128 
ZERO_NULL
,

129 
ZERO_NULL
,

130 
im≠_disc⁄√˘
,

131 
ZERO_NULL
,

132 
PORT_IMAP
,

133 
CURLPROTO_IMAP
,

134 
PROTOPT_CLOSEACTION
 | 
PROTOPT_NEEDSPWD


137 #ifde‡
USE_SSL


142 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_im≠s
 = {

144 
im≠_£tup_c⁄√˘i⁄
,

145 
im≠_do
,

146 
im≠_d⁄e
,

147 
ZERO_NULL
,

148 
im≠_c⁄√˘
,

149 
im≠_mu…i_°©emach
,

150 
im≠_doög
,

151 
im≠_gësock
,

152 
im≠_gësock
,

153 
ZERO_NULL
,

154 
ZERO_NULL
,

155 
im≠_disc⁄√˘
,

156 
ZERO_NULL
,

157 
PORT_IMAPS
,

158 
CURLPROTO_IMAPS
,

159 
PROTOPT_CLOSEACTION
 | 
PROTOPT_SSL
 |

160 
PROTOPT_NEEDSPWD


164 #i‚de‡
CURL_DISABLE_HTTP


169 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_im≠_¥oxy
 = {

171 
Cuæ_hâp_£tup_c⁄n
,

172 
Cuæ_hâp
,

173 
Cuæ_hâp_d⁄e
,

174 
ZERO_NULL
,

175 
ZERO_NULL
,

176 
ZERO_NULL
,

177 
ZERO_NULL
,

178 
ZERO_NULL
,

179 
ZERO_NULL
,

180 
ZERO_NULL
,

181 
ZERO_NULL
,

182 
ZERO_NULL
,

183 
ZERO_NULL
,

184 
PORT_IMAP
,

185 
CURLPROTO_HTTP
,

186 
PROTOPT_NONE


189 #ifde‡
USE_SSL


194 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_im≠s_¥oxy
 = {

196 
Cuæ_hâp_£tup_c⁄n
,

197 
Cuæ_hâp
,

198 
Cuæ_hâp_d⁄e
,

199 
ZERO_NULL
,

200 
ZERO_NULL
,

201 
ZERO_NULL
,

202 
ZERO_NULL
,

203 
ZERO_NULL
,

204 
ZERO_NULL
,

205 
ZERO_NULL
,

206 
ZERO_NULL
,

207 
ZERO_NULL
,

208 
ZERO_NULL
,

209 
PORT_IMAPS
,

210 
CURLPROTO_HTTP
,

211 
PROTOPT_NONE


216 #ifde‡
USE_SSL


217 
	$im≠_to_im≠s
(
c⁄√˘d©a
 *
c⁄n
)

219 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_im≠s
;

220 
	}
}

222 
	#im≠_to_im≠s
(
x
Ë
Cuæ_n›_°mt


	)

235 
boﬁ
 
	$im≠_m©chª•
(c⁄° *
löe
, 
size_t
 
Àn
, c⁄° *
cmd
)

237 c⁄° *
íd
 = 
löe
 + 
Àn
;

238 
size_t
 
cmd_Àn
 = 
	`°æí
(
cmd
);

241 
löe
 += 2;

244 if(
löe
 < 
íd
 && 
	`ISDIGIT
(*line)) {

247 
löe
++;

248 
löe
 < 
íd
 && 
	`ISDIGIT
(*line));

251 if(
löe
 =
íd
 || *line != ' ')

252  
FALSE
;

254 
löe
++;

259 if(
löe
 + 
cmd_Àn
 <
íd
 && 
	`Cuæ_øw_√quÆ
÷öe, 
cmd
, cmd_len) &&

260 (
löe
[
cmd_Àn
] =' ' ||Üöê+ cmd_À¿+ 2 =
íd
))

261  
TRUE
;

263  
FALSE
;

264 
	}
}

273 
boﬁ
 
	$im≠_ído‰e•
(
c⁄√˘d©a
 *
c⁄n
, *
löe
, 
size_t
 
Àn
,

274 *
ª•
)

276 
IMAP
 *
im≠
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

277 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

278 c⁄° *
id
 = 
im≠c
->
ª•èg
;

279 
size_t
 
id_Àn
 = 
	`°æí
(
id
);

282 if(
Àn
 >
id_Àn
 + 1 && !
	`memcmp
(
id
, 
löe
, id_len) &&Üine[id_len] == ' ') {

283 
löe
 +
id_Àn
 + 1;

284 
Àn
 -
id_Àn
 + 1;

286 if(
Àn
 >2 && !
	`memcmp
(
löe
, "OK", 2))

287 *
ª•
 = 'O';

288 if(
Àn
 >2 && !
	`memcmp
(
löe
, "NO", 2))

289 *
ª•
 = 'N';

290 if(
Àn
 >3 && !
	`memcmp
(
löe
, "BAD", 3))

291 *
ª•
 = 'B';

293 
	`Áûf
(
c⁄n
->
d©a
, "BadÅaggedÑesponse");

294 *
ª•
 = -1;

297  
TRUE
;

301 if(
Àn
 >2 && !
	`memcmp
("* ", 
löe
, 2)) {

302 
im≠c
->
°©e
) {

304 
IMAP_CAPABILITY
:

305 if(!
	`im≠_m©chª•
(
löe
, 
Àn
, "CAPABILITY"))

306  
FALSE
;

309 
IMAP_LIST
:

310 if((!
im≠
->
cu°om
 && !
	`im≠_m©chª•
(
löe
, 
Àn
, "LIST")) ||

311 (
im≠
->
cu°om
 && !
	`im≠_m©chª•
(
löe
, 
Àn
, imap->custom) &&

312 (
	`°rcmp
(
im≠
->
cu°om
, "STORE") ||

313 !
	`im≠_m©chª•
(
löe
, 
Àn
, "FETCH")) &&

314 
	`°rcmp
(
im≠
->
cu°om
, "SELECT") &&

315 
	`°rcmp
(
im≠
->
cu°om
, "EXAMINE") &&

316 
	`°rcmp
(
im≠
->
cu°om
, "SEARCH") &&

317 
	`°rcmp
(
im≠
->
cu°om
, "EXPUNGE") &&

318 
	`°rcmp
(
im≠
->
cu°om
, "LSUB") &&

319 
	`°rcmp
(
im≠
->
cu°om
, "UID") &&

320 
	`°rcmp
(
im≠
->
cu°om
, "NOOP")))

321  
FALSE
;

324 
IMAP_SELECT
:

329 
IMAP_FETCH
:

330 if(!
	`im≠_m©chª•
(
löe
, 
Àn
, "FETCH"))

331  
FALSE
;

334 
IMAP_SEARCH
:

335 if(!
	`im≠_m©chª•
(
löe
, 
Àn
, "SEARCH"))

336  
FALSE
;

341  
FALSE
;

344 *
ª•
 = '*';

345  
TRUE
;

352 if((
Àn
 =3 && !
	`memcmp
("+", 
löe
, 1)) ||

353 (
Àn
 >2 && !
	`memcmp
("+ ", 
löe
, 2))) {

354 
im≠c
->
°©e
) {

356 
IMAP_AUTHENTICATE_PLAIN
:

357 
IMAP_AUTHENTICATE_LOGIN
:

358 
IMAP_AUTHENTICATE_LOGIN_PASSWD
:

359 
IMAP_AUTHENTICATE_CRAMMD5
:

360 
IMAP_AUTHENTICATE_DIGESTMD5
:

361 
IMAP_AUTHENTICATE_DIGESTMD5_RESP
:

362 
IMAP_AUTHENTICATE_NTLM
:

363 
IMAP_AUTHENTICATE_NTLM_TYPE2MSG
:

364 
IMAP_AUTHENTICATE_XOAUTH2
:

365 
IMAP_AUTHENTICATE_FINAL
:

366 
IMAP_APPEND
:

367 *
ª•
 = '+';

371 
	`Áûf
(
c⁄n
->
d©a
, "Unexpected continuationÑesponse");

372 *
ª•
 = -1;

376  
TRUE
;

379  
FALSE
;

380 
	}
}

388 
	$im≠_gë_mesßge
(*
buf„r
, ** 
ouçå
)

390 
size_t
 
Àn
 = 0;

391 * 
mesßge
 = 
NULL
;

394 
mesßge
 = 
buf„r
 + 2; *message == ' ' || *message == '\t'; message++)

398 
Àn
 = 
	`°æí
(
mesßge
);Üen--;)

399 if(
mesßge
[
Àn
] != '\r' && message[len] != '\n' && message[len] != ' ' &&

400 
mesßge
[
Àn
] != '\t')

404 if(++
Àn
) {

405 
mesßge
[
Àn
] = '\0';

408 *
ouçå
 = 
mesßge
;

409 
	}
}

417 
	$°©e
(
c⁄√˘d©a
 *
c⁄n
, 
im≠°©e
 
√w°©e
)

419 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

420 #i‡
	`deföed
(
DEBUGBUILD
Ë&& !deföed(
CURL_DISABLE_VERBOSE_STRINGS
)

422 c⁄° * c⁄° 
«mes
[]={

451 if(
im≠c
->
°©e
 !
√w°©e
)

452 
	`öfof
(
c⁄n
->
d©a
, "IMAP %p state change from %sÅo %s\n",

453 (*)
im≠c
, 
«mes
[im≠c->
°©e
],Çames[
√w°©e
]);

456 
im≠c
->
°©e
 = 
√w°©e
;

457 
	}
}

466 
CURLcode
 
	$im≠_≥rf‹m_ˇ∑bûôy
(
c⁄√˘d©a
 *
c⁄n
)

468 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

469 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

471 
im≠c
->
authmechs
 = 0;

472 
im≠c
->
authu£d
 = 0;

473 
im≠c
->
és_suµ‹ãd
 = 
FALSE
;

476 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "CAPABILITY");

478 if(!
ªsu…
)

479 
	`°©e
(
c⁄n
, 
IMAP_CAPABILITY
);

481  
ªsu…
;

482 
	}
}

490 
CURLcode
 
	$im≠_≥rf‹m_°¨âls
(
c⁄√˘d©a
 *
c⁄n
)

492 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

495 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "STARTTLS");

497 if(!
ªsu…
)

498 
	`°©e
(
c⁄n
, 
IMAP_STARTTLS
);

500  
ªsu…
;

501 
	}
}

509 
CURLcode
 
	$im≠_≥rf‹m_upgøde_és
(
c⁄√˘d©a
 *
c⁄n
)

511 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

512 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

515 
ªsu…
 = 
	`Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄n
, 
FIRSTSOCKET
, &
im≠c
->
s¶d⁄e
);

517 if(!
ªsu…
) {

518 if(
im≠c
->
°©e
 !
IMAP_UPGRADETLS
)

519 
	`°©e
(
c⁄n
, 
IMAP_UPGRADETLS
);

521 if(
im≠c
->
s¶d⁄e
) {

522 
	`im≠_to_im≠s
(
c⁄n
);

523 
ªsu…
 = 
	`im≠_≥rf‹m_ˇ∑bûôy
(
c⁄n
);

527  
ªsu…
;

528 
	}
}

536 
CURLcode
 
	$im≠_≥rf‹m_logö
(
c⁄√˘d©a
 *
c⁄n
)

538 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

539 *
u£r
;

540 *
∑sswd
;

544 if(!
c⁄n
->
bôs
.
u£r_∑sswd
) {

545 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

547  
ªsu…
;

551 
u£r
 = 
	`im≠_©om
(
c⁄n
->user);

552 
∑sswd
 = 
	`im≠_©om
(
c⁄n
->passwd);

555 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "LOGIN %†%s", 
u£r
 ? user : "",

556 
∑sswd
 ?Öasswd : "");

558 
	`Cuæ_ß„‰ì
(
u£r
);

559 
	`Cuæ_ß„‰ì
(
∑sswd
);

561 if(!
ªsu…
)

562 
	`°©e
(
c⁄n
, 
IMAP_LOGIN
);

564  
ªsu…
;

565 
	}
}

574 
CURLcode
 
	$im≠_≥rf‹m_authítiˇã
(
c⁄√˘d©a
 *
c⁄n
,

575 c⁄° *
mech
,

576 c⁄° *
öôª•
,

577 
im≠°©e
 
°©e1
, im≠°©ê
°©e2
)

579 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

581 if(
öôª•
) {

583 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "AUTHENTICATE %†%s", 
mech
, 
öôª•
);

585 if(!
ªsu…
)

586 
	`°©e
(
c⁄n
, 
°©e2
);

590 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "AUTHENTICATE %s", 
mech
);

592 if(!
ªsu…
)

593 
	`°©e
(
c⁄n
, 
°©e1
);

596  
ªsu…
;

597 
	}
}

607 
CURLcode
 
	$im≠_≥rf‹m_authítiˇti⁄
(
c⁄√˘d©a
 *
c⁄n
)

609 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

610 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

611 c⁄° *
mech
 = 
NULL
;

612 *
öôª•
 = 
NULL
;

613 
size_t
 
Àn
 = 0;

614 
im≠°©e
 
°©e1
 = 
IMAP_STOP
;

615 
im≠°©e
 
°©e2
 = 
IMAP_STOP
;

619 if(!
c⁄n
->
bôs
.
u£r_∑sswd
) {

620 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

622  
ªsu…
;

626 
ªsu…
 = 
	`im≠_ˇlc_ß¶_dëaûs
(
c⁄n
, &
mech
, &
öôª•
, &
Àn
, &
°©e1
,

627 &
°©e2
);

629 if(!
ªsu…
) {

630 if(
mech
 && (
im≠c
->
¥e·y≥
 & 
IMAP_TYPE_SASL
)) {

632 
ªsu…
 = 
	`im≠_≥rf‹m_authítiˇã
(
c⁄n
, 
mech
, 
öôª•
, 
°©e1
, 
°©e2
);

634 
	`Cuæ_ß„‰ì
(
öôª•
);

636 if((!
im≠c
->
logö_dißbÀd
) &&

637 (
im≠c
->
¥e·y≥
 & 
IMAP_TYPE_CLEARTEXT
))

639 
ªsu…
 = 
	`im≠_≥rf‹m_logö
(
c⁄n
);

642 
	`öfof
(
c⁄n
->
d©a
, "No knownáuthentication mechanisms supported!\n");

643 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

647  
ªsu…
;

648 
	}
}

656 
CURLcode
 
	$im≠_≥rf‹m_li°
(
c⁄√˘d©a
 *
c⁄n
)

658 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

659 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

660 
IMAP
 *
im≠
 = 
d©a
->
ªq
.
¥Ÿ›
;

661 *
maûbox
;

663 if(
im≠
->
cu°om
)

665 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "%s%s", 
im≠
->
cu°om
,

666 
im≠
->
cu°om_∑øms
 ? imap->custom_params : "");

669 
maûbox
 = 
	`im≠_©om
(
im≠
->mailbox ? imap->mailbox : "");

670 if(!
maûbox
)

671  
CURLE_OUT_OF_MEMORY
;

674 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "LIST \"%s\" *", 
maûbox
);

676 
	`Cuæ_ß„‰ì
(
maûbox
);

679 if(!
ªsu…
)

680 
	`°©e
(
c⁄n
, 
IMAP_LIST
);

682  
ªsu…
;

683 
	}
}

691 
CURLcode
 
	$im≠_≥rf‹m_£À˘
(
c⁄√˘d©a
 *
c⁄n
)

693 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

694 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

695 
IMAP
 *
im≠
 = 
d©a
->
ªq
.
¥Ÿ›
;

696 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

697 *
maûbox
;

700 
	`Cuæ_ß„‰ì
(
im≠c
->
maûbox
);

701 
	`Cuæ_ß„‰ì
(
im≠c
->
maûbox_uidvÆidôy
);

704 if(!
im≠
->
maûbox
) {

705 
	`Áûf
(
c⁄n
->
d©a
, "Cannot SELECT withoutá mailbox.");

706  
CURLE_URL_MALFORMAT
;

710 
maûbox
 = 
	`im≠_©om
(
im≠
->mailbox);

711 if(!
maûbox
)

712  
CURLE_OUT_OF_MEMORY
;

715 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "SELECT %s", 
maûbox
);

717 
	`Cuæ_ß„‰ì
(
maûbox
);

719 if(!
ªsu…
)

720 
	`°©e
(
c⁄n
, 
IMAP_SELECT
);

722  
ªsu…
;

723 
	}
}

731 
CURLcode
 
	$im≠_≥rf‹m_„tch
(
c⁄√˘d©a
 *
c⁄n
)

733 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

734 
IMAP
 *
im≠
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

737 if(!
im≠
->
uid
) {

738 
	`Áûf
(
c⁄n
->
d©a
, "Cannot FETCH withoutá UID.");

739  
CURLE_URL_MALFORMAT
;

743 if(
im≠
->
∑πül
)

744 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "FETCH %s BODY[%s]<%s>",

745 
im≠
->
uid
,

746 
im≠
->
£˘i⁄
 ? imap->section : "",

747 
im≠
->
∑πül
);

749 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "FETCH %s BODY[%s]",

750 
im≠
->
uid
,

751 
im≠
->
£˘i⁄
 ? imap->section : "");

753 if(!
ªsu…
)

754 
	`°©e
(
c⁄n
, 
IMAP_FETCH
);

756  
ªsu…
;

757 
	}
}

765 
CURLcode
 
	$im≠_≥rf‹m_≠≥nd
(
c⁄√˘d©a
 *
c⁄n
)

767 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

768 
IMAP
 *
im≠
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

769 *
maûbox
;

772 if(!
im≠
->
maûbox
) {

773 
	`Áûf
(
c⁄n
->
d©a
, "Cannot APPEND withoutá mailbox.");

774  
CURLE_URL_MALFORMAT
;

778 if(
c⁄n
->
d©a
->
°©e
.
öfûesize
 < 0) {

779 
	`Áûf
(
c⁄n
->
d©a
, "Cannot APPEND with unknown input file size\n");

780  
CURLE_UPLOAD_FAILED
;

784 
maûbox
 = 
	`im≠_©om
(
im≠
->mailbox);

785 if(!
maûbox
)

786  
CURLE_OUT_OF_MEMORY
;

789 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "APPEND %†(\\SìnË{%" 
CURL_FORMAT_CURL_OFF_T
 "}",

790 
maûbox
, 
c⁄n
->
d©a
->
°©e
.
öfûesize
);

792 
	`Cuæ_ß„‰ì
(
maûbox
);

794 if(!
ªsu…
)

795 
	`°©e
(
c⁄n
, 
IMAP_APPEND
);

797  
ªsu…
;

798 
	}
}

806 
CURLcode
 
	$im≠_≥rf‹m_£¨ch
(
c⁄√˘d©a
 *
c⁄n
)

808 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

809 
IMAP
 *
im≠
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

812 if(!
im≠
->
quîy
) {

813 
	`Áûf
(
c⁄n
->
d©a
, "Cannot SEARCH withoutá query string.");

814  
CURLE_URL_MALFORMAT
;

818 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "SEARCH %s", 
im≠
->
quîy
);

820 if(!
ªsu…
)

821 
	`°©e
(
c⁄n
, 
IMAP_SEARCH
);

823  
ªsu…
;

824 
	}
}

832 
CURLcode
 
	$im≠_≥rf‹m_logout
(
c⁄√˘d©a
 *
c⁄n
)

834 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

837 
ªsu…
 = 
	`im≠_£ndf
(
c⁄n
, "LOGOUT");

839 if(!
ªsu…
)

840 
	`°©e
(
c⁄n
, 
IMAP_LOGOUT
);

842  
ªsu…
;

843 
	}
}

846 
CURLcode
 
	$im≠_°©e_£rvîgªë_ª•
(
c⁄√˘d©a
 *
c⁄n
,

847 
im≠code
,

848 
im≠°©e
 
ö°©e
)

850 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

851 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

853 ()
ö°©e
;

855 if(
im≠code
 != 'O') {

856 
	`Áûf
(
d©a
, "Got unexpected imap-serverÑesponse");

857 
ªsu…
 = 
CURLE_FTP_WEIRD_SERVER_REPLY
;

860 
ªsu…
 = 
	`im≠_≥rf‹m_ˇ∑bûôy
(
c⁄n
);

862  
ªsu…
;

863 
	}
}

866 
CURLcode
 
	$im≠_°©e_ˇ∑bûôy_ª•
(
c⁄√˘d©a
 *
c⁄n
,

867 
im≠code
,

868 
im≠°©e
 
ö°©e
)

870 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

871 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

872 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

873 c⁄° *
löe
 = 
d©a
->
°©e
.
buf„r
;

874 
size_t
 
w‹dÀn
;

876 ()
ö°©e
;

879 if(
im≠code
 == '*') {

880 
löe
 += 2;

884 *
löe
 &&

885 (*
löe
 == ' ' || *line == '\t' ||

886 *
löe
 == '\r' || *line == '\n')) {

888 
löe
++;

891 if(!*
löe
)

895 
w‹dÀn
 = 0; 
löe
[wordlen] &&Üine[wordlen] != ' ' &&

896 
löe
[
w‹dÀn
] != '\t' &&Üine[wordlen] != '\r' &&

897 
löe
[
w‹dÀn
] != '\n';)

898 
w‹dÀn
++;

901 if(
w‹dÀn
 =8 && !
	`memcmp
(
löe
, "STARTTLS", 8))

902 
im≠c
->
és_suµ‹ãd
 = 
TRUE
;

905 if(
w‹dÀn
 =13 && !
	`memcmp
(
löe
, "LOGINDISABLED", 13))

906 
im≠c
->
logö_dißbÀd
 = 
TRUE
;

909 if(
w‹dÀn
 =7 && !
	`memcmp
(
löe
, "SASL-IR", 7))

910 
im≠c
->
ú_suµ‹ãd
 = 
TRUE
;

913 if(
w‹dÀn
 > 5 && !
	`memcmp
(
löe
, "AUTH=", 5)) {

914 
löe
 += 5;

915 
w‹dÀn
 -= 5;

918 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_LOGIN
))

919 
im≠c
->
authmechs
 |
SASL_MECH_LOGIN
;

920 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_PLAIN
))

921 
im≠c
->
authmechs
 |
SASL_MECH_PLAIN
;

922 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_CRAM_MD5
))

923 
im≠c
->
authmechs
 |
SASL_MECH_CRAM_MD5
;

924 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_DIGEST_MD5
))

925 
im≠c
->
authmechs
 |
SASL_MECH_DIGEST_MD5
;

926 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_GSSAPI
))

927 
im≠c
->
authmechs
 |
SASL_MECH_GSSAPI
;

928 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_EXTERNAL
))

929 
im≠c
->
authmechs
 |
SASL_MECH_EXTERNAL
;

930 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_NTLM
))

931 
im≠c
->
authmechs
 |
SASL_MECH_NTLM
;

932 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_XOAUTH2
))

933 
im≠c
->
authmechs
 |
SASL_MECH_XOAUTH2
;

936 
löe
 +
w‹dÀn
;

939 if(
im≠code
 == 'O') {

940 if(
d©a
->
£t
.
u£_s¶
 && !
c⁄n
->
s¶
[
FIRSTSOCKET
].
u£
) {

942 if(
im≠c
->
és_suµ‹ãd
)

944 
ªsu…
 = 
	`im≠_≥rf‹m_°¨âls
(
c⁄n
);

945 if(
d©a
->
£t
.
u£_s¶
 =
CURLUSESSL_TRY
)

947 
ªsu…
 = 
	`im≠_≥rf‹m_authítiˇti⁄
(
c⁄n
);

949 
	`Áûf
(
d©a
, "STARTTLSÇot supported.");

950 
ªsu…
 = 
CURLE_USE_SSL_FAILED
;

954 
ªsu…
 = 
	`im≠_≥rf‹m_authítiˇti⁄
(
c⁄n
);

957 
ªsu…
 = 
	`im≠_≥rf‹m_authítiˇti⁄
(
c⁄n
);

959  
ªsu…
;

960 
	}
}

963 
CURLcode
 
	$im≠_°©e_°¨âls_ª•
(
c⁄√˘d©a
 *
c⁄n
,

964 
im≠code
,

965 
im≠°©e
 
ö°©e
)

967 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

968 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

970 ()
ö°©e
;

972 if(
im≠code
 != 'O') {

973 if(
d©a
->
£t
.
u£_s¶
 !
CURLUSESSL_TRY
) {

974 
	`Áûf
(
d©a
, "STARTTLS díõd. %c", 
im≠code
);

975 
ªsu…
 = 
CURLE_USE_SSL_FAILED
;

978 
ªsu…
 = 
	`im≠_≥rf‹m_authítiˇti⁄
(
c⁄n
);

981 
ªsu…
 = 
	`im≠_≥rf‹m_upgøde_és
(
c⁄n
);

983  
ªsu…
;

984 
	}
}

987 
CURLcode
 
	$im≠_°©e_auth_∂aö_ª•
(
c⁄√˘d©a
 *
c⁄n
,

988 
im≠code
,

989 
im≠°©e
 
ö°©e
)

991 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

992 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

993 
size_t
 
Àn
 = 0;

994 *
∂aöauth
 = 
NULL
;

996 ()
ö°©e
;

998 if(
im≠code
 != '+') {

999 
	`Áûf
(
d©a
, "Ac˚s†díõd. %c", 
im≠code
);

1000 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1004 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_∂aö_mesßge
(
d©a
, 
c⁄n
->
u£r
, c⁄n->
∑sswd
,

1005 &
∂aöauth
, &
Àn
);

1006 if(!
ªsu…
 && 
∂aöauth
) {

1008 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", 
∂aöauth
);

1010 if(!
ªsu…
)

1011 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_FINAL
);

1015 
	`Cuæ_ß„‰ì
(
∂aöauth
);

1017  
ªsu…
;

1018 
	}
}

1021 
CURLcode
 
	$im≠_°©e_auth_logö_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1022 
im≠code
,

1023 
im≠°©e
 
ö°©e
)

1025 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1026 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1027 
size_t
 
Àn
 = 0;

1028 *
authu£r
 = 
NULL
;

1030 ()
ö°©e
;

1032 if(
im≠code
 != '+') {

1033 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
im≠code
);

1034 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1038 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_logö_mesßge
(
d©a
, 
c⁄n
->
u£r
,

1039 &
authu£r
, &
Àn
);

1040 if(!
ªsu…
 && 
authu£r
) {

1042 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", 
authu£r
);

1044 if(!
ªsu…
)

1045 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_LOGIN_PASSWD
);

1049 
	`Cuæ_ß„‰ì
(
authu£r
);

1051  
ªsu…
;

1052 
	}
}

1055 
CURLcode
 
	$im≠_°©e_auth_logö_∑ssw‹d_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1056 
im≠code
,

1057 
im≠°©e
 
ö°©e
)

1059 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1060 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1061 
size_t
 
Àn
 = 0;

1062 *
auth∑sswd
 = 
NULL
;

1064 ()
ö°©e
;

1066 if(
im≠code
 != '+') {

1067 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
im≠code
);

1068 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1072 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_logö_mesßge
(
d©a
, 
c⁄n
->
∑sswd
,

1073 &
auth∑sswd
, &
Àn
);

1074 if(!
ªsu…
 && 
auth∑sswd
) {

1076 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", 
auth∑sswd
);

1078 if(!
ªsu…
)

1079 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_FINAL
);

1083 
	`Cuæ_ß„‰ì
(
auth∑sswd
);

1085  
ªsu…
;

1086 
	}
}

1088 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


1090 
CURLcode
 
	$im≠_°©e_auth_¸am_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1091 
im≠code
,

1092 
im≠°©e
 
ö°©e
)

1094 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1095 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1096 *
chlg
 = 
NULL
;

1097 *
chlg64
 = 
NULL
;

1098 *
Ωlyb64
 = 
NULL
;

1099 
size_t
 
Àn
 = 0;

1101 ()
ö°©e
;

1103 if(
im≠code
 != '+') {

1104 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
im≠code
);

1105  
CURLE_LOGIN_DENIED
;

1109 
	`im≠_gë_mesßge
(
d©a
->
°©e
.
buf„r
, &
chlg64
);

1112 
ªsu…
 = 
	`Cuæ_ß¶_decode_¸am_md5_mesßge
(
chlg64
, &
chlg
, &
Àn
);

1113 if(
ªsu…
) {

1115 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", "*");

1117 if(!
ªsu…
)

1118 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_CANCEL
);

1122 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¸am_md5_mesßge
(
d©a
, 
chlg
, 
c⁄n
->
u£r
,

1123 
c⁄n
->
∑sswd
, &
Ωlyb64
, &
Àn
);

1124 if(!
ªsu…
 && 
Ωlyb64
) {

1126 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", 
Ωlyb64
);

1128 if(!
ªsu…
)

1129 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_FINAL
);

1133 
	`Cuæ_ß„‰ì
(
chlg
);

1134 
	`Cuæ_ß„‰ì
(
Ωlyb64
);

1136  
ªsu…
;

1137 
	}
}

1140 
CURLcode
 
	$im≠_°©e_auth_dige°_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1141 
im≠code
,

1142 
im≠°©e
 
ö°©e
)

1144 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1145 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1146 *
chlg64
 = 
NULL
;

1147 *
Ωlyb64
 = 
NULL
;

1148 
size_t
 
Àn
 = 0;

1150 ()
ö°©e
;

1152 if(
im≠code
 != '+') {

1153 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
im≠code
);

1154  
CURLE_LOGIN_DENIED
;

1158 
	`im≠_gë_mesßge
(
d©a
->
°©e
.
buf„r
, &
chlg64
);

1161 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_dige°_md5_mesßge
(
d©a
, 
chlg64
,

1162 
c⁄n
->
u£r
, c⁄n->
∑sswd
,

1163 "im≠", &
Ωlyb64
, &
Àn
);

1164 if(
ªsu…
) {

1165 if(
ªsu…
 =
CURLE_BAD_CONTENT_ENCODING
) {

1167 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", "*");

1169 if(!
ªsu…
)

1170 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_CANCEL
);

1175 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", 
Ωlyb64
);

1177 if(!
ªsu…
)

1178 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_DIGESTMD5_RESP
);

1181 
	`Cuæ_ß„‰ì
(
Ωlyb64
);

1183  
ªsu…
;

1184 
	}
}

1187 
CURLcode
 
	$im≠_°©e_auth_dige°_ª•_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1188 
im≠code
,

1189 
im≠°©e
 
ö°©e
)

1191 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1192 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1194 ()
ö°©e
;

1196 if(
im≠code
 != '+') {

1197 
	`Áûf
(
d©a
, "Authítiˇti⁄ faûed: %d", 
im≠code
);

1198 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1202 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", "");

1204 if(!
ªsu…
)

1205 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_FINAL
);

1208  
ªsu…
;

1209 
	}
}

1212 #ifde‡
USE_NTLM


1214 
CURLcode
 
	$im≠_°©e_auth_¡lm_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1215 
im≠code
,

1216 
im≠°©e
 
ö°©e
)

1218 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1219 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1220 
size_t
 
Àn
 = 0;

1221 *
ty≥1msg
 = 
NULL
;

1223 ()
ö°©e
;

1225 if(
im≠code
 != '+') {

1226 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
im≠code
);

1227 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1231 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¡lm_ty≥1_mesßge
(
c⁄n
->
u£r
, c⁄n->
∑sswd
,

1232 &
c⁄n
->
¡lm
,

1233 &
ty≥1msg
, &
Àn
);

1234 if(!
ªsu…
 && 
ty≥1msg
) {

1236 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", 
ty≥1msg
);

1238 if(!
ªsu…
)

1239 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_NTLM_TYPE2MSG
);

1243 
	`Cuæ_ß„‰ì
(
ty≥1msg
);

1245  
ªsu…
;

1246 
	}
}

1249 
CURLcode
 
	$im≠_°©e_auth_¡lm_ty≥2msg_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1250 
im≠code
,

1251 
im≠°©e
 
ö°©e
)

1253 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1254 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1255 *
ty≥2msg
 = 
NULL
;

1256 *
ty≥3msg
 = 
NULL
;

1257 
size_t
 
Àn
 = 0;

1259 ()
ö°©e
;

1261 if(
im≠code
 != '+') {

1262 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
im≠code
);

1263 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1267 
	`im≠_gë_mesßge
(
d©a
->
°©e
.
buf„r
, &
ty≥2msg
);

1270 
ªsu…
 = 
	`Cuæ_ß¶_decode_¡lm_ty≥2_mesßge
(
d©a
, 
ty≥2msg
, &
c⁄n
->
¡lm
);

1271 if(
ªsu…
) {

1273 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", "*");

1275 if(!
ªsu…
)

1276 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_CANCEL
);

1280 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¡lm_ty≥3_mesßge
(
d©a
, 
c⁄n
->
u£r
,

1281 
c⁄n
->
∑sswd
, &c⁄n->
¡lm
,

1282 &
ty≥3msg
, &
Àn
);

1283 if(!
ªsu…
 && 
ty≥3msg
) {

1285 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", 
ty≥3msg
);

1287 if(!
ªsu…
)

1288 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_FINAL
);

1293 
	`Cuæ_ß„‰ì
(
ty≥3msg
);

1295  
ªsu…
;

1296 
	}
}

1300 
CURLcode
 
	$im≠_°©e_auth_xﬂuth2_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1301 
im≠code
,

1302 
im≠°©e
 
ö°©e
)

1304 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1305 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1306 
size_t
 
Àn
 = 0;

1307 *
xﬂuth
 = 
NULL
;

1309 ()
ö°©e
;

1311 if(
im≠code
 != '+') {

1312 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
im≠code
);

1313 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1317 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_xﬂuth2_mesßge
(
c⁄n
->
d©a
, c⁄n->
u£r
,

1318 
c⁄n
->
xﬂuth2_bóªr
,

1319 &
xﬂuth
, &
Àn
);

1320 if(!
ªsu…
 && 
xﬂuth
) {

1322 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", 
xﬂuth
);

1324 if(!
ªsu…
)

1325 
	`°©e
(
c⁄n
, 
IMAP_AUTHENTICATE_FINAL
);

1329 
	`Cuæ_ß„‰ì
(
xﬂuth
);

1331  
ªsu…
;

1332 
	}
}

1335 
CURLcode
 
	$im≠_°©e_auth_ˇn˚l_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1336 
im≠code
,

1337 
im≠°©e
 
ö°©e
)

1339 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1340 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1341 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

1342 c⁄° *
mech
 = 
NULL
;

1343 *
öôª•
 = 
NULL
;

1344 
size_t
 
Àn
 = 0;

1345 
im≠°©e
 
°©e1
 = 
IMAP_STOP
;

1346 
im≠°©e
 
°©e2
 = 
IMAP_STOP
;

1348 ()
im≠code
;

1349 ()
ö°©e
;

1352 
im≠c
->
authmechs
 ^im≠c->
authu£d
;

1355 
ªsu…
 = 
	`im≠_ˇlc_ß¶_dëaûs
(
c⁄n
, &
mech
, &
öôª•
, &
Àn
, &
°©e1
,

1356 &
°©e2
);

1358 if(!
ªsu…
) {

1360 if(
mech
) {

1362 
ªsu…
 = 
	`im≠_≥rf‹m_authítiˇã
(
c⁄n
, 
mech
, 
öôª•
, 
°©e1
, 
°©e2
);

1364 
	`Cuæ_ß„‰ì
(
öôª•
);

1366 if((!
im≠c
->
logö_dißbÀd
) &&

1367 (
im≠c
->
¥e·y≥
 & 
IMAP_TYPE_CLEARTEXT
))

1369 
ªsu…
 = 
	`im≠_≥rf‹m_logö
(
c⁄n
);

1371 
	`Áûf
(
d©a
, "Authentication cancelled");

1373 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1377  
ªsu…
;

1378 
	}
}

1381 
CURLcode
 
	$im≠_°©e_auth_föÆ_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1382 
im≠code
,

1383 
im≠°©e
 
ö°©e
)

1385 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1386 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1388 ()
ö°©e
;

1390 if(
im≠code
 != 'O') {

1391 
	`Áûf
(
d©a
, "Authítiˇti⁄ faûed: %d", 
im≠code
);

1392 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1396 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

1398  
ªsu…
;

1399 
	}
}

1402 
CURLcode
 
	$im≠_°©e_logö_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1403 
im≠code
,

1404 
im≠°©e
 
ö°©e
)

1406 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1407 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1409 ()
ö°©e
;

1411 if(
im≠code
 != 'O') {

1412 
	`Áûf
(
d©a
, "Ac˚s†díõd. %c", 
im≠code
);

1413 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1417 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

1419  
ªsu…
;

1420 
	}
}

1423 
CURLcode
 
	$im≠_°©e_li°_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
im≠code
,

1424 
im≠°©e
 
ö°©e
)

1426 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1427 *
löe
 = 
c⁄n
->
d©a
->
°©e
.
buf„r
;

1428 
size_t
 
Àn
 = 
	`°æí
(
löe
);

1430 ()
ö°©e
;

1432 if(
im≠code
 == '*') {

1434 
löe
[
Àn
] = '\n';

1435 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
löe
, 
Àn
 + 1);

1436 
löe
[
Àn
] = '\0';

1438 if(
im≠code
 != 'O')

1439 
ªsu…
 = 
CURLE_QUOTE_ERROR
;

1442 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

1444  
ªsu…
;

1445 
	}
}

1448 
CURLcode
 
	$im≠_°©e_£À˘_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
im≠code
,

1449 
im≠°©e
 
ö°©e
)

1451 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1452 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1453 
IMAP
 *
im≠
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

1454 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

1455 c⁄° *
löe
 = 
d©a
->
°©e
.
buf„r
;

1456 
tmp
[20];

1458 ()
ö°©e
;

1460 if(
im≠code
 == '*') {

1462 if(
	`ssˇnf
(
löe
 + 2, "OK [UIDVALIDITY %19[0123456789]]", 
tmp
) == 1) {

1463 
	`Cuæ_ß„‰ì
(
im≠c
->
maûbox_uidvÆidôy
);

1464 
im≠c
->
maûbox_uidvÆidôy
 = 
	`°rdup
(
tmp
);

1467 if(
im≠code
 == 'O') {

1469 if(
im≠
->
uidvÆidôy
 && 
im≠c
->
maûbox_uidvÆidôy
 &&

1470 
	`°rcmp
(
im≠
->
uidvÆidôy
, 
im≠c
->
maûbox_uidvÆidôy
)) {

1471 
	`Áûf
(
c⁄n
->
d©a
, "Mailbox UIDVALIDITY has changed");

1472 
ªsu…
 = 
CURLE_REMOTE_FILE_NOT_FOUND
;

1476 
im≠c
->
maûbox
 = 
	`°rdup
(
im≠
->mailbox);

1478 if(
im≠
->
cu°om
)

1479 
ªsu…
 = 
	`im≠_≥rf‹m_li°
(
c⁄n
);

1480 if(
im≠
->
quîy
)

1481 
ªsu…
 = 
	`im≠_≥rf‹m_£¨ch
(
c⁄n
);

1483 
ªsu…
 = 
	`im≠_≥rf‹m_„tch
(
c⁄n
);

1487 
	`Áûf
(
d©a
, "Select failed");

1488 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1491  
ªsu…
;

1492 
	}
}

1495 
CURLcode
 
	$im≠_°©e_„tch_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
im≠code
,

1496 
im≠°©e
 
ö°©e
)

1498 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1499 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1500 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

1501 
pögp⁄g
 *
µ
 = &
im≠c
->pp;

1502 c⁄° *
±r
 = 
d©a
->
°©e
.
buf„r
;

1503 
boﬁ
 
∑r£d
 = 
FALSE
;

1504 
cuæ_off_t
 
size
;

1506 ()
ö°©e
;

1508 if(
im≠code
 != '*') {

1509 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 0);

1510 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

1511  
CURLE_REMOTE_FILE_NOT_FOUND
;

1516 *
±r
 && (*ptr != '{'))

1517 
±r
++;

1519 if(*
±r
 == '{') {

1520 *
íd±r
;

1521 
size
 = 
	`cuæx_°πoof·
(
±r
 + 1, &
íd±r
, 10);

1522 if(
íd±r
 - 
±r
 > 1 &&Éndptr[0] == '}' &&

1523 
íd±r
[1] == '\r' &&Éndptr[2] == '\0')

1524 
∑r£d
 = 
TRUE
;

1527 if(
∑r£d
) {

1528 
	`öfof
(
d©a
, "Found %" 
CURL_FORMAT_CURL_OFF_TU
 " bytesÅo download\n",

1529 
size
);

1530 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
size
);

1532 if(
µ
->
ˇche
) {

1536 
size_t
 
chunk
 = 
µ
->
ˇche_size
;

1538 if(
chunk
 > (
size_t
)
size
)

1540 
chunk
 = (
size_t
)
size
;

1542 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
µ
->
ˇche
, 
chunk
);

1543 if(
ªsu…
)

1544  
ªsu…
;

1546 
d©a
->
ªq
.
byãcou¡
 +
chunk
;

1548 
	`öfof
(
d©a
, "Wrôã¿%" 
CURL_FORMAT_CURL_OFF_TU


1549 " byãs, %" 
CURL_FORMAT_CURL_OFF_TU


1550 " byã†¨êÀ· f‹Åøns„r\n", (
cuæ_off_t
)
chunk
,

1551 
size
 - 
chunk
);

1554 if(
µ
->
ˇche_size
 > 
chunk
) {

1556 
	`memmove
(
µ
->
ˇche
,Öp->ˇchê+ 
chunk
,Öp->
ˇche_size
 - chunk);

1557 
µ
->
ˇche_size
 -
chunk
;

1561 
	`Cuæ_ß„‰ì
(
µ
->
ˇche
);

1564 
µ
->
ˇche_size
 = 0;

1568 if(
d©a
->
ªq
.
byãcou¡
 =
size
)

1570 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

1573 
d©a
->
ªq
.
maxdow∆ﬂd
 = 
size
;

1574 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, 
size
, 
FALSE
, 
NULL
, -1, NULL);

1579 
	`Áûf
(
µ
->
c⁄n
->
d©a
, "FailedÅoÖarse FETCHÑesponse.");

1580 
ªsu…
 = 
CURLE_FTP_WEIRD_SERVER_REPLY
;

1584 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

1586  
ªsu…
;

1587 
	}
}

1590 
CURLcode
 
	$im≠_°©e_„tch_föÆ_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1591 
im≠code
,

1592 
im≠°©e
 
ö°©e
)

1594 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1596 ()
ö°©e
;

1598 if(
im≠code
 != 'O')

1599 
ªsu…
 = 
CURLE_FTP_WEIRD_SERVER_REPLY
;

1602 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

1604  
ªsu…
;

1605 
	}
}

1608 
CURLcode
 
	$im≠_°©e_≠≥nd_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
im≠code
,

1609 
im≠°©e
 
ö°©e
)

1611 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1612 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1614 ()
ö°©e
;

1616 if(
im≠code
 != '+') {

1617 
ªsu…
 = 
CURLE_UPLOAD_FAILED
;

1621 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, d©a->
°©e
.
öfûesize
);

1624 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, 
FIRSTSOCKET
, NULL);

1627 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

1630  
ªsu…
;

1631 
	}
}

1634 
CURLcode
 
	$im≠_°©e_≠≥nd_föÆ_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1635 
im≠code
,

1636 
im≠°©e
 
ö°©e
)

1638 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1640 ()
ö°©e
;

1642 if(
im≠code
 != 'O')

1643 
ªsu…
 = 
CURLE_UPLOAD_FAILED
;

1646 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

1648  
ªsu…
;

1649 
	}
}

1652 
CURLcode
 
	$im≠_°©e_£¨ch_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
im≠code
,

1653 
im≠°©e
 
ö°©e
)

1655 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1656 *
löe
 = 
c⁄n
->
d©a
->
°©e
.
buf„r
;

1657 
size_t
 
Àn
 = 
	`°æí
(
löe
);

1659 ()
ö°©e
;

1661 if(
im≠code
 == '*') {

1663 
löe
[
Àn
] = '\n';

1664 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
löe
, 
Àn
 + 1);

1665 
löe
[
Àn
] = '\0';

1667 if(
im≠code
 != 'O')

1668 
ªsu…
 = 
CURLE_QUOTE_ERROR
;

1671 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

1673  
ªsu…
;

1674 
	}
}

1676 
CURLcode
 
	$im≠_°©emach_a˘
(
c⁄√˘d©a
 *
c⁄n
)

1678 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1679 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
FIRSTSOCKET
];

1680 
im≠code
;

1681 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

1682 
pögp⁄g
 *
µ
 = &
im≠c
->pp;

1683 
size_t
 
ƒód
 = 0;

1686 if(
im≠c
->
°©e
 =
IMAP_UPGRADETLS
)

1687  
	`im≠_≥rf‹m_upgøde_és
(
c⁄n
);

1690 if(
µ
->
£ndÀ·
)

1691  
	`Cuæ_µ_Êush£nd
(
µ
);

1695 
ªsu…
 = 
	`Cuæ_µ_ªadª•
(
sock
, 
µ
, &
im≠code
, &
ƒód
);

1696 if(
ªsu…
)

1697  
ªsu…
;

1700 if(
im≠code
 == -1)

1701  
CURLE_FTP_WEIRD_SERVER_REPLY
;

1703 if(!
im≠code
)

1707 
im≠c
->
°©e
) {

1708 
IMAP_SERVERGREET
:

1709 
ªsu…
 = 
	`im≠_°©e_£rvîgªë_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1712 
IMAP_CAPABILITY
:

1713 
ªsu…
 = 
	`im≠_°©e_ˇ∑bûôy_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1716 
IMAP_STARTTLS
:

1717 
ªsu…
 = 
	`im≠_°©e_°¨âls_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1720 
IMAP_AUTHENTICATE_PLAIN
:

1721 
ªsu…
 = 
	`im≠_°©e_auth_∂aö_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1724 
IMAP_AUTHENTICATE_LOGIN
:

1725 
ªsu…
 = 
	`im≠_°©e_auth_logö_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1728 
IMAP_AUTHENTICATE_LOGIN_PASSWD
:

1729 
ªsu…
 = 
	`im≠_°©e_auth_logö_∑ssw‹d_ª•
(
c⁄n
, 
im≠code
,

1730 
im≠c
->
°©e
);

1733 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


1734 
IMAP_AUTHENTICATE_CRAMMD5
:

1735 
ªsu…
 = 
	`im≠_°©e_auth_¸am_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1738 
IMAP_AUTHENTICATE_DIGESTMD5
:

1739 
ªsu…
 = 
	`im≠_°©e_auth_dige°_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1742 
IMAP_AUTHENTICATE_DIGESTMD5_RESP
:

1743 
ªsu…
 = 
	`im≠_°©e_auth_dige°_ª•_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1747 #ifde‡
USE_NTLM


1748 
IMAP_AUTHENTICATE_NTLM
:

1749 
ªsu…
 = 
	`im≠_°©e_auth_¡lm_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1752 
IMAP_AUTHENTICATE_NTLM_TYPE2MSG
:

1753 
ªsu…
 = 
	`im≠_°©e_auth_¡lm_ty≥2msg_ª•
(
c⁄n
, 
im≠code
,

1754 
im≠c
->
°©e
);

1758 
IMAP_AUTHENTICATE_XOAUTH2
:

1759 
ªsu…
 = 
	`im≠_°©e_auth_xﬂuth2_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1762 
IMAP_AUTHENTICATE_CANCEL
:

1763 
ªsu…
 = 
	`im≠_°©e_auth_ˇn˚l_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1766 
IMAP_AUTHENTICATE_FINAL
:

1767 
ªsu…
 = 
	`im≠_°©e_auth_föÆ_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1770 
IMAP_LOGIN
:

1771 
ªsu…
 = 
	`im≠_°©e_logö_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1774 
IMAP_LIST
:

1775 
ªsu…
 = 
	`im≠_°©e_li°_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1778 
IMAP_SELECT
:

1779 
ªsu…
 = 
	`im≠_°©e_£À˘_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1782 
IMAP_FETCH
:

1783 
ªsu…
 = 
	`im≠_°©e_„tch_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1786 
IMAP_FETCH_FINAL
:

1787 
ªsu…
 = 
	`im≠_°©e_„tch_föÆ_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1790 
IMAP_APPEND
:

1791 
ªsu…
 = 
	`im≠_°©e_≠≥nd_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1794 
IMAP_APPEND_FINAL
:

1795 
ªsu…
 = 
	`im≠_°©e_≠≥nd_föÆ_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1798 
IMAP_SEARCH
:

1799 
ªsu…
 = 
	`im≠_°©e_£¨ch_ª•
(
c⁄n
, 
im≠code
, 
im≠c
->
°©e
);

1802 
IMAP_LOGOUT
:

1806 
	`°©e
(
c⁄n
, 
IMAP_STOP
);

1809 } !
ªsu…
 && 
im≠c
->
°©e
 !
IMAP_STOP
 && 
	`Cuæ_µ_m‹ed©a
(
µ
));

1811  
ªsu…
;

1812 
	}
}

1815 
CURLcode
 
	$im≠_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1817 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1818 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

1820 if((
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
Ë&& !
im≠c
->
s¶d⁄e
) {

1821 
ªsu…
 = 
	`Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄n
, 
FIRSTSOCKET
, &
im≠c
->
s¶d⁄e
);

1822 if(
ªsu…
 || !
im≠c
->
s¶d⁄e
)

1823  
ªsu…
;

1826 
ªsu…
 = 
	`Cuæ_µ_°©emach
(&
im≠c
->
µ
, 
FALSE
);

1827 *
d⁄e
 = (
im≠c
->
°©e
 =
IMAP_STOP
Ë? 
TRUE
 : 
FALSE
;

1829  
ªsu…
;

1830 
	}
}

1832 
CURLcode
 
	$im≠_block_°©emach
(
c⁄√˘d©a
 *
c⁄n
)

1834 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1835 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

1837 
im≠c
->
°©e
 !
IMAP_STOP
 && !
ªsu…
)

1838 
ªsu…
 = 
	`Cuæ_µ_°©emach
(&
im≠c
->
µ
, 
TRUE
);

1840  
ªsu…
;

1841 
	}
}

1845 
CURLcode
 
	$im≠_öô
(
c⁄√˘d©a
 *
c⁄n
)

1847 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1848 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1849 
IMAP
 *
im≠
;

1851 
im≠
 = 
d©a
->
ªq
.
¥Ÿ›
 = 
	`ˇŒoc
((
IMAP
), 1);

1852 if(!
im≠
)

1853 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1855  
ªsu…
;

1856 
	}
}

1859 
	$im≠_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

1860 
numsocks
)

1862  
	`Cuæ_µ_gësock
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, 
socks
, 
numsocks
);

1863 
	}
}

1875 
CURLcode
 
	$im≠_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1877 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1878 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

1879 
pögp⁄g
 *
µ
 = &
im≠c
->pp;

1881 *
d⁄e
 = 
FALSE
;

1884 
	`c⁄nkìp
(
c⁄n
, "IMAP default");

1887 
µ
->
ª•⁄£_time
 = 
RESP_TIMEOUT
;

1888 
µ
->
°©emach_a˘
 = 
im≠_°©emach_a˘
;

1889 
µ
->
ído‰e•
 = 
im≠_ído‰e•
;

1890 
µ
->
c⁄n
 = conn;

1893 
im≠c
->
¥e·y≥
 = 
IMAP_TYPE_ANY
;

1894 
im≠c
->
¥efmech
 = 
SASL_AUTH_ANY
;

1897 
	`Cuæ_µ_öô
(
µ
);

1900 
ªsu…
 = 
	`im≠_∑r£_uæ_›ti⁄s
(
c⁄n
);

1901 if(
ªsu…
)

1902  
ªsu…
;

1905 
	`°©e
(
c⁄n
, 
IMAP_SERVERGREET
);

1908 
	`°r˝y
(
im≠c
->
ª•èg
, "*");

1910 
ªsu…
 = 
	`im≠_mu…i_°©emach
(
c⁄n
, 
d⁄e
);

1912  
ªsu…
;

1913 
	}
}

1924 
CURLcode
 
	$im≠_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
°©us
,

1925 
boﬁ
 
¥em©uª
)

1927 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1928 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1929 
IMAP
 *
im≠
 = 
d©a
->
ªq
.
¥Ÿ›
;

1931 ()
¥em©uª
;

1933 if(!
im≠
)

1938  
CURLE_OK
;

1940 if(
°©us
) {

1941 
	`c⁄n˛o£
(
c⁄n
, "IMAP done with bad status");

1942 
ªsu…
 = 
°©us
;

1944 if(!
d©a
->
£t
.
c⁄√˘_⁄ly
 && !
im≠
->
cu°om
 &&

1945 (
im≠
->
uid
 || 
d©a
->
£t
.
u∂ﬂd
)) {

1947 if(!
d©a
->
£t
.
u∂ﬂd
)

1948 
	`°©e
(
c⁄n
, 
IMAP_FETCH_FINAL
);

1951 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
im≠c
.
µ
, "%s", "");

1952 if(!
ªsu…
)

1953 
	`°©e
(
c⁄n
, 
IMAP_APPEND_FINAL
);

1963 if(!
ªsu…
)

1964 
ªsu…
 = 
	`im≠_block_°©emach
(
c⁄n
);

1968 
	`Cuæ_ß„‰ì
(
im≠
->
maûbox
);

1969 
	`Cuæ_ß„‰ì
(
im≠
->
uidvÆidôy
);

1970 
	`Cuæ_ß„‰ì
(
im≠
->
uid
);

1971 
	`Cuæ_ß„‰ì
(
im≠
->
£˘i⁄
);

1972 
	`Cuæ_ß„‰ì
(
im≠
->
∑πül
);

1973 
	`Cuæ_ß„‰ì
(
im≠
->
quîy
);

1974 
	`Cuæ_ß„‰ì
(
im≠
->
cu°om
);

1975 
	`Cuæ_ß„‰ì
(
im≠
->
cu°om_∑øms
);

1978 
im≠
->
å™s„r
 = 
FTPTRANSFER_BODY
;

1980  
ªsu…
;

1981 
	}
}

1990 
CURLcode
 
	$im≠_≥rf‹m
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
c⁄√˘ed
,

1991 
boﬁ
 *
d›ha£_d⁄e
)

1994 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1995 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1996 
IMAP
 *
im≠
 = 
d©a
->
ªq
.
¥Ÿ›
;

1997 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

1998 
boﬁ
 
£À˘ed
 = 
FALSE
;

2000 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase starts\n"));

2002 if(
c⁄n
->
d©a
->
£t
.
›t_no_body
) {

2004 
im≠
->
å™s„r
 = 
FTPTRANSFER_INFO
;

2007 *
d›ha£_d⁄e
 = 
FALSE
;

2011 if(
im≠
->
maûbox
 && 
im≠c
->mailbox &&

2012 !
	`°rcmp
(
im≠
->
maûbox
, 
im≠c
->mailbox) &&

2013 (!
im≠
->
uidvÆidôy
 || !
im≠c
->
maûbox_uidvÆidôy
 ||

2014 !
	`°rcmp
(
im≠
->
uidvÆidôy
, 
im≠c
->
maûbox_uidvÆidôy
)))

2015 
£À˘ed
 = 
TRUE
;

2018 if(
c⁄n
->
d©a
->
£t
.
u∂ﬂd
)

2020 
ªsu…
 = 
	`im≠_≥rf‹m_≠≥nd
(
c⁄n
);

2021 if(
im≠
->
cu°om
 && (
£À˘ed
 || !im≠->
maûbox
))

2023 
ªsu…
 = 
	`im≠_≥rf‹m_li°
(
c⁄n
);

2024 if(!
im≠
->
cu°om
 && 
£À˘ed
 && im≠->
uid
)

2026 
ªsu…
 = 
	`im≠_≥rf‹m_„tch
(
c⁄n
);

2027 if(!
im≠
->
cu°om
 && 
£À˘ed
 && im≠->
quîy
)

2029 
ªsu…
 = 
	`im≠_≥rf‹m_£¨ch
(
c⁄n
);

2030 if(
im≠
->
maûbox
 && !
£À˘ed
 &&

2031 (
im≠
->
cu°om
 || im≠->
uid
 || im≠->
quîy
))

2033 
ªsu…
 = 
	`im≠_≥rf‹m_£À˘
(
c⁄n
);

2036 
ªsu…
 = 
	`im≠_≥rf‹m_li°
(
c⁄n
);

2038 if(
ªsu…
)

2039  
ªsu…
;

2042 
ªsu…
 = 
	`im≠_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

2044 *
c⁄√˘ed
 = 
c⁄n
->
bôs
.
t˝c⁄√˘
[
FIRSTSOCKET
];

2046 if(*
d›ha£_d⁄e
)

2047 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

2049  
ªsu…
;

2050 
	}
}

2061 
CURLcode
 
	$im≠_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

2063 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2065 *
d⁄e
 = 
FALSE
;

2068 
ªsu…
 = 
	`im≠_∑r£_uæ_∑th
(
c⁄n
);

2069 if(
ªsu…
)

2070  
ªsu…
;

2073 
ªsu…
 = 
	`im≠_∑r£_cu°om_ªque°
(
c⁄n
);

2074 if(
ªsu…
)

2075  
ªsu…
;

2077 
ªsu…
 = 
	`im≠_ªguœr_å™s„r
(
c⁄n
, 
d⁄e
);

2079  
ªsu…
;

2080 
	}
}

2089 
CURLcode
 
	$im≠_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
)

2091 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

2099 if(!
dód_c⁄√˘i⁄
 && 
im≠c
->
µ
.
c⁄n
 && im≠c->µ.c⁄n->
bôs
.
¥Ÿoc⁄n°¨t
)

2100 if(!
	`im≠_≥rf‹m_logout
(
c⁄n
))

2101 ()
	`im≠_block_°©emach
(
c⁄n
);

2104 
	`Cuæ_µ_disc⁄√˘
(&
im≠c
->
µ
);

2107 
	`Cuæ_ß¶_˛ónup
(
c⁄n
, 
im≠c
->
authu£d
);

2110 
	`Cuæ_ß„‰ì
(
im≠c
->
maûbox
);

2111 
	`Cuæ_ß„‰ì
(
im≠c
->
maûbox_uidvÆidôy
);

2113  
CURLE_OK
;

2114 
	}
}

2117 
CURLcode
 
	$im≠_d›ha£_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
c⁄√˘ed
)

2119 
IMAP
 *
im≠
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

2121 ()
c⁄√˘ed
;

2123 if(
im≠
->
å™s„r
 !
FTPTRANSFER_BODY
)

2125 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

2127  
CURLE_OK
;

2128 
	}
}

2131 
CURLcode
 
	$im≠_doög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d›ha£_d⁄e
)

2133 
CURLcode
 
ªsu…
 = 
	`im≠_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

2135 if(
ªsu…
)

2136 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase failed\n"));

2137 if(*
d›ha£_d⁄e
) {

2138 
ªsu…
 = 
	`im≠_d›ha£_d⁄e
(
c⁄n
, 
FALSE
 );

2140 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

2143  
ªsu…
;

2144 
	}
}

2155 
CURLcode
 
	$im≠_ªguœr_å™s„r
(
c⁄√˘d©a
 *
c⁄n
,

2156 
boﬁ
 *
d›ha£_d⁄e
)

2158 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2159 
boﬁ
 
c⁄√˘ed
 = 
FALSE
;

2160 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2163 
d©a
->
ªq
.
size
 = -1;

2166 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 0);

2167 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, 0);

2168 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 0);

2169 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 0);

2172 
ªsu…
 = 
	`im≠_≥rf‹m
(
c⁄n
, &
c⁄√˘ed
, 
d›ha£_d⁄e
);

2175 if(!
ªsu…
 && *
d›ha£_d⁄e
)

2176 
ªsu…
 = 
	`im≠_d›ha£_d⁄e
(
c⁄n
, 
c⁄√˘ed
);

2178  
ªsu…
;

2179 
	}
}

2181 
CURLcode
 
	$im≠_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
)

2183 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2186 
CURLcode
 
ªsu…
 = 
	`im≠_öô
(
c⁄n
);

2187 if(
ªsu…
)

2188  
ªsu…
;

2190 if(
c⁄n
->
bôs
.
hâµroxy
 && !
d©a
->
£t
.
tu¬ñ_thru_hâµroxy
) {

2193 #i‚de‡
CURL_DISABLE_HTTP


2194 if(
c⁄n
->
h™dÀr
 =&
Cuæ_h™dÀr_im≠
)

2195 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_im≠_¥oxy
;

2197 #ifde‡
USE_SSL


2198 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_im≠s_¥oxy
;

2200 
	`Áûf
(
d©a
, "IMAPSÇot supported!");

2201  
CURLE_UNSUPPORTED_PROTOCOL
;

2206  
c⁄n
->
h™dÀr
->
	`£tup_c⁄√˘i⁄
(conn);

2208 
	`Áûf
(
d©a
, "IMAP over httpÖroxyÑequires HTTP support built-in!");

2209  
CURLE_UNSUPPORTED_PROTOCOL
;

2213 
d©a
->
°©e
.
∑th
++;

2215  
CURLE_OK
;

2216 
	}
}

2226 
CURLcode
 
	$im≠_£ndf
(
c⁄√˘d©a
 *
c⁄n
, c⁄° *
fmt
, ...)

2228 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2229 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

2230 *
èggedfmt
;

2231 
va_li°
 
≠
;

2233 
	`DEBUGASSERT
(
fmt
);

2236 
im≠c
->
cmdid
 = (imapc->cmdid + 1) % 1000;

2239 
	`¢¥ötf
(
im≠c
->
ª•èg
, (imapc->resptag), "%c%03d",

2240 'A' + 
	`cuæx_¶tosi
(
c⁄n
->
c⁄√˘i⁄_id
 % 26), 
im≠c
->
cmdid
);

2243 
èggedfmt
 = 
	`≠rötf
("%†%s", 
im≠c
->
ª•èg
, 
fmt
);

2244 if(!
èggedfmt
)

2245  
CURLE_OUT_OF_MEMORY
;

2248 
	`va_°¨t
(
≠
, 
fmt
);

2249 
ªsu…
 = 
	`Cuæ_µ_v£ndf
(&
im≠c
->
µ
, 
èggedfmt
, 
≠
);

2250 
	`va_íd
(
≠
);

2252 
	`Cuæ_ß„‰ì
(
èggedfmt
);

2254  
ªsu…
;

2255 
	}
}

2267 *
	$im≠_©om
(c⁄° *
°r
)

2269 c⁄° *
p1
;

2270 *
p2
;

2271 
size_t
 
back•_cou¡
 = 0;

2272 
size_t
 
quŸe_cou¡
 = 0;

2273 
boﬁ
 
•a˚_exi°s
 = 
FALSE
;

2274 
size_t
 
√wÀn
 = 0;

2275 *
√w°r
 = 
NULL
;

2277 if(!
°r
)

2278  
NULL
;

2281 
p1
 = 
°r
;

2282 *
p1
) {

2283 if(*
p1
 == '\\')

2284 
back•_cou¡
++;

2285 if(*
p1
 == '"')

2286 
quŸe_cou¡
++;

2287 if(*
p1
 == ' ')

2288 
•a˚_exi°s
 = 
TRUE
;

2290 
p1
++;

2294 if(!
back•_cou¡
 && !
quŸe_cou¡
 && !
•a˚_exi°s
)

2295  
	`°rdup
(
°r
);

2298 
√wÀn
 = 
	`°æí
(
°r
Ë+ 
back•_cou¡
 + 
quŸe_cou¡
 + (
•a˚_exi°s
 ? 2 : 0);

2301 
√w°r
 = (*Ë
	`mÆloc
((
√wÀn
 + 1) * ());

2302 if(!
√w°r
)

2303  
NULL
;

2306 
p2
 = 
√w°r
;

2307 if(
•a˚_exi°s
) {

2308 
√w°r
[0] = '"';

2309 
√w°r
[
√wÀn
 - 1] = '"';

2310 
p2
++;

2314 
p1
 = 
°r
;

2315 *
p1
) {

2316 if(*
p1
 == '\\' || *p1 == '"') {

2317 *
p2
 = '\\';

2318 
p2
++;

2321 *
p2
 = *
p1
;

2323 
p1
++;

2324 
p2
++;

2328 
√w°r
[
√wÀn
] = '\0';

2330  
√w°r
;

2331 
	}
}

2340 
boﬁ
 
	$im≠_is_bch¨
(
ch
)

2342 
ch
) {

2364  
åue
;

2367  
Ál£
;

2369 
	}
}

2377 
CURLcode
 
	$im≠_∑r£_uæ_›ti⁄s
(
c⁄√˘d©a
 *
c⁄n
)

2379 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2380 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

2381 c⁄° *
›ti⁄s
 = 
c⁄n
->options;

2382 c⁄° *
±r
 = 
›ti⁄s
;

2383 
boﬁ
 
ª£t
 = 
TRUE
;

2385 
±r
 && *ptr) {

2386 c⁄° *
key
 = 
±r
;

2388 *
±r
 && *ptr != '=')

2389 
±r
++;

2391 if(
	`°∫equÆ
(
key
, "AUTH", 4)) {

2392 
size_t
 
Àn
 = 0;

2393 c⁄° *
vÆue
 = ++
±r
;

2395 if(
ª£t
) {

2396 
ª£t
 = 
FALSE
;

2397 
im≠c
->
¥e·y≥
 = 
IMAP_TYPE_NONE
;

2398 
im≠c
->
¥efmech
 = 
SASL_AUTH_NONE
;

2401 *
±r
 && *ptr != ';') {

2402 
±r
++;

2403 
Àn
++;

2406 if(
	`°∫equÆ
(
vÆue
, "*", 
Àn
)) {

2407 
im≠c
->
¥e·y≥
 = 
IMAP_TYPE_ANY
;

2408 
im≠c
->
¥efmech
 = 
SASL_AUTH_ANY
;

2410 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_LOGIN
, 
Àn
)) {

2411 
im≠c
->
¥e·y≥
 = 
IMAP_TYPE_SASL
;

2412 
im≠c
->
¥efmech
 |
SASL_MECH_LOGIN
;

2414 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_PLAIN
, 
Àn
)) {

2415 
im≠c
->
¥e·y≥
 = 
IMAP_TYPE_SASL
;

2416 
im≠c
->
¥efmech
 |
SASL_MECH_PLAIN
;

2418 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_CRAM_MD5
, 
Àn
)) {

2419 
im≠c
->
¥e·y≥
 = 
IMAP_TYPE_SASL
;

2420 
im≠c
->
¥efmech
 |
SASL_MECH_CRAM_MD5
;

2422 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_DIGEST_MD5
, 
Àn
)) {

2423 
im≠c
->
¥e·y≥
 = 
IMAP_TYPE_SASL
;

2424 
im≠c
->
¥efmech
 |
SASL_MECH_DIGEST_MD5
;

2426 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_GSSAPI
, 
Àn
)) {

2427 
im≠c
->
¥e·y≥
 = 
IMAP_TYPE_SASL
;

2428 
im≠c
->
¥efmech
 |
SASL_MECH_GSSAPI
;

2430 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_NTLM
, 
Àn
)) {

2431 
im≠c
->
¥e·y≥
 = 
IMAP_TYPE_SASL
;

2432 
im≠c
->
¥efmech
 |
SASL_MECH_NTLM
;

2434 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_XOAUTH2
, 
Àn
)) {

2435 
im≠c
->
¥e·y≥
 = 
IMAP_TYPE_SASL
;

2436 
im≠c
->
¥efmech
 |
SASL_MECH_XOAUTH2
;

2439 if(*
±r
 == ';')

2440 
±r
++;

2443 
ªsu…
 = 
CURLE_URL_MALFORMAT
;

2446  
ªsu…
;

2447 
	}
}

2456 
CURLcode
 
	$im≠_∑r£_uæ_∑th
(
c⁄√˘d©a
 *
c⁄n
)

2459 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2460 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2461 
IMAP
 *
im≠
 = 
d©a
->
ªq
.
¥Ÿ›
;

2462 c⁄° *
begö
 = 
d©a
->
°©e
.
∑th
;

2463 c⁄° *
±r
 = 
begö
;

2466 
	`im≠_is_bch¨
(*
±r
))

2467 
±r
++;

2469 if(
±r
 !
begö
) {

2471 c⁄° *
íd
 = 
±r
;

2472 if(
íd
 > 
begö
 &&Énd[-1] == '/')

2473 
íd
--;

2475 
ªsu…
 = 
	`Cuæ_uædecode
(
d©a
, 
begö
, 
íd
 - begö, &
im≠
->
maûbox
, 
NULL
,

2476 
TRUE
);

2477 if(
ªsu…
)

2478  
ªsu…
;

2481 
im≠
->
maûbox
 = 
NULL
;

2484 *
±r
 == ';') {

2485 *
«me
;

2486 *
vÆue
;

2487 
size_t
 
vÆuñí
;

2490 
begö
 = ++
±r
;

2491 *
±r
 && *ptr != '=')

2492 
±r
++;

2494 if(!*
±r
)

2495  
CURLE_URL_MALFORMAT
;

2498 
ªsu…
 = 
	`Cuæ_uædecode
(
d©a
, 
begö
, 
±r
 - begö, &
«me
, 
NULL
, 
TRUE
);

2499 if(
ªsu…
)

2500  
ªsu…
;

2503 
begö
 = ++
±r
;

2504 
	`im≠_is_bch¨
(*
±r
))

2505 
±r
++;

2508 
ªsu…
 = 
	`Cuæ_uædecode
(
d©a
, 
begö
, 
±r
 - begö, &
vÆue
, &
vÆuñí
, 
TRUE
);

2509 if(
ªsu…
) {

2510 
	`Cuæ_ß„‰ì
(
«me
);

2511  
ªsu…
;

2514 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "IMAP URLÖ¨amëî '%s' = '%s'\n", 
«me
, 
vÆue
));

2520 if(
	`Cuæ_øw_equÆ
(
«me
, "UIDVALIDITY"Ë&& !
im≠
->
uidvÆidôy
) {

2521 if(
vÆuñí
 > 0 && 
vÆue
[valuelen - 1] == '/')

2522 
vÆue
[
vÆuñí
 - 1] = '\0';

2524 
im≠
->
uidvÆidôy
 = 
vÆue
;

2525 
vÆue
 = 
NULL
;

2527 if(
	`Cuæ_øw_equÆ
(
«me
, "UID"Ë&& !
im≠
->
uid
) {

2528 if(
vÆuñí
 > 0 && 
vÆue
[valuelen - 1] == '/')

2529 
vÆue
[
vÆuñí
 - 1] = '\0';

2531 
im≠
->
uid
 = 
vÆue
;

2532 
vÆue
 = 
NULL
;

2534 if(
	`Cuæ_øw_equÆ
(
«me
, "SECTION"Ë&& !
im≠
->
£˘i⁄
) {

2535 if(
vÆuñí
 > 0 && 
vÆue
[valuelen - 1] == '/')

2536 
vÆue
[
vÆuñí
 - 1] = '\0';

2538 
im≠
->
£˘i⁄
 = 
vÆue
;

2539 
vÆue
 = 
NULL
;

2541 if(
	`Cuæ_øw_equÆ
(
«me
, "PARTIAL"Ë&& !
im≠
->
∑πül
) {

2542 if(
vÆuñí
 > 0 && 
vÆue
[valuelen - 1] == '/')

2543 
vÆue
[
vÆuñí
 - 1] = '\0';

2545 
im≠
->
∑πül
 = 
vÆue
;

2546 
vÆue
 = 
NULL
;

2549 
	`Cuæ_ß„‰ì
(
«me
);

2550 
	`Cuæ_ß„‰ì
(
vÆue
);

2552  
CURLE_URL_MALFORMAT
;

2555 
	`Cuæ_ß„‰ì
(
«me
);

2556 
	`Cuæ_ß„‰ì
(
vÆue
);

2561 if(
im≠
->
maûbox
 && !im≠->
uid
 && *
±r
 == '?') {

2563 
begö
 = ++
±r
;

2564 
	`im≠_is_bch¨
(*
±r
))

2565 
±r
++;

2568 
ªsu…
 = 
	`Cuæ_uædecode
(
d©a
, 
begö
, 
±r
 - begö, &
im≠
->
quîy
, 
NULL
,

2569 
TRUE
);

2570 if(
ªsu…
)

2571  
ªsu…
;

2575 if(*
±r
)

2576  
CURLE_URL_MALFORMAT
;

2578  
CURLE_OK
;

2579 
	}
}

2587 
CURLcode
 
	$im≠_∑r£_cu°om_ªque°
(
c⁄√˘d©a
 *
c⁄n
)

2589 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2590 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2591 
IMAP
 *
im≠
 = 
d©a
->
ªq
.
¥Ÿ›
;

2592 c⁄° *
cu°om
 = 
d©a
->
£t
.
°r
[
STRING_CUSTOMREQUEST
];

2594 if(
cu°om
) {

2596 
ªsu…
 = 
	`Cuæ_uædecode
(
d©a
, 
cu°om
, 0, &
im≠
->cu°om, 
NULL
, 
TRUE
);

2599 if(!
ªsu…
) {

2600 c⁄° *
∑øms
 = 
im≠
->
cu°om
;

2602 *
∑øms
 && *params != ' ')

2603 
∑øms
++;

2605 if(*
∑øms
) {

2606 
im≠
->
cu°om_∑øms
 = 
	`°rdup
(
∑øms
);

2607 
im≠
->
cu°om
[
∑øms
 - imap->custom] = '\0';

2609 if(!
im≠
->
cu°om_∑øms
)

2610 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

2615  
ªsu…
;

2616 
	}
}

2624 
CURLcode
 
	$im≠_ˇlc_ß¶_dëaûs
(
c⁄√˘d©a
 *
c⁄n
,

2625 c⁄° **
mech
,

2626 **
öôª•
, 
size_t
 *
Àn
,

2627 
im≠°©e
 *
°©e1
, im≠°©ê*
°©e2
)

2629 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2630 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2631 
im≠_c⁄n
 *
im≠c
 = &
c⁄n
->
¥Ÿo
.imapc;

2635 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


2636 if((
im≠c
->
authmechs
 & 
SASL_MECH_DIGEST_MD5
) &&

2637 (
im≠c
->
¥efmech
 & 
SASL_MECH_DIGEST_MD5
)) {

2638 *
mech
 = 
SASL_MECH_STRING_DIGEST_MD5
;

2639 *
°©e1
 = 
IMAP_AUTHENTICATE_DIGESTMD5
;

2640 
im≠c
->
authu£d
 = 
SASL_MECH_DIGEST_MD5
;

2642 if((
im≠c
->
authmechs
 & 
SASL_MECH_CRAM_MD5
) &&

2643 (
im≠c
->
¥efmech
 & 
SASL_MECH_CRAM_MD5
)) {

2644 *
mech
 = 
SASL_MECH_STRING_CRAM_MD5
;

2645 *
°©e1
 = 
IMAP_AUTHENTICATE_CRAMMD5
;

2646 
im≠c
->
authu£d
 = 
SASL_MECH_CRAM_MD5
;

2650 #ifde‡
USE_NTLM


2651 if((
im≠c
->
authmechs
 & 
SASL_MECH_NTLM
) &&

2652 (
im≠c
->
¥efmech
 & 
SASL_MECH_NTLM
)) {

2653 *
mech
 = 
SASL_MECH_STRING_NTLM
;

2654 *
°©e1
 = 
IMAP_AUTHENTICATE_NTLM
;

2655 *
°©e2
 = 
IMAP_AUTHENTICATE_NTLM_TYPE2MSG
;

2656 
im≠c
->
authu£d
 = 
SASL_MECH_NTLM
;

2658 if(
im≠c
->
ú_suµ‹ãd
 || 
d©a
->
£t
.
ß¶_ú
)

2659 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¡lm_ty≥1_mesßge
(
c⁄n
->
u£r
, c⁄n->
∑sswd
,

2660 &
c⁄n
->
¡lm
,

2661 
öôª•
, 
Àn
);

2665 if(((
im≠c
->
authmechs
 & 
SASL_MECH_XOAUTH2
) &&

2666 (
im≠c
->
¥efmech
 & 
SASL_MECH_XOAUTH2
) &&

2667 (
im≠c
->
¥efmech
 !
SASL_AUTH_ANY
)Ë|| 
c⁄n
->
xﬂuth2_bóªr
) {

2668 *
mech
 = 
SASL_MECH_STRING_XOAUTH2
;

2669 *
°©e1
 = 
IMAP_AUTHENTICATE_XOAUTH2
;

2670 *
°©e2
 = 
IMAP_AUTHENTICATE_FINAL
;

2671 
im≠c
->
authu£d
 = 
SASL_MECH_XOAUTH2
;

2673 if(
im≠c
->
ú_suµ‹ãd
 || 
d©a
->
£t
.
ß¶_ú
)

2674 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_xﬂuth2_mesßge
(
d©a
, 
c⁄n
->
u£r
,

2675 
c⁄n
->
xﬂuth2_bóªr
,

2676 
öôª•
, 
Àn
);

2678 if((
im≠c
->
authmechs
 & 
SASL_MECH_LOGIN
) &&

2679 (
im≠c
->
¥efmech
 & 
SASL_MECH_LOGIN
)) {

2680 *
mech
 = 
SASL_MECH_STRING_LOGIN
;

2681 *
°©e1
 = 
IMAP_AUTHENTICATE_LOGIN
;

2682 *
°©e2
 = 
IMAP_AUTHENTICATE_LOGIN_PASSWD
;

2683 
im≠c
->
authu£d
 = 
SASL_MECH_LOGIN
;

2685 if(
im≠c
->
ú_suµ‹ãd
 || 
d©a
->
£t
.
ß¶_ú
)

2686 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_logö_mesßge
(
d©a
, 
c⁄n
->
u£r
, 
öôª•
, 
Àn
);

2688 if((
im≠c
->
authmechs
 & 
SASL_MECH_PLAIN
) &&

2689 (
im≠c
->
¥efmech
 & 
SASL_MECH_PLAIN
)) {

2690 *
mech
 = 
SASL_MECH_STRING_PLAIN
;

2691 *
°©e1
 = 
IMAP_AUTHENTICATE_PLAIN
;

2692 *
°©e2
 = 
IMAP_AUTHENTICATE_FINAL
;

2693 
im≠c
->
authu£d
 = 
SASL_MECH_PLAIN
;

2695 if(
im≠c
->
ú_suµ‹ãd
 || 
d©a
->
£t
.
ß¶_ú
)

2696 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_∂aö_mesßge
(
d©a
, 
c⁄n
->
u£r
, c⁄n->
∑sswd
,

2697 
öôª•
, 
Àn
);

2700  
ªsu…
;

2701 
	}
}

	@lib/imap.h

1 #i‚de‡
HEADER_CURL_IMAP_H


2 
	#HEADER_CURL_IMAP_H


	)

25 
	~"pögp⁄g.h
"

31 
	mIMAP_STOP
,

32 
	mIMAP_SERVERGREET
,

34 
	mIMAP_CAPABILITY
,

35 
	mIMAP_STARTTLS
,

36 
	mIMAP_UPGRADETLS
,

38 
	mIMAP_AUTHENTICATE_PLAIN
,

39 
	mIMAP_AUTHENTICATE_LOGIN
,

40 
	mIMAP_AUTHENTICATE_LOGIN_PASSWD
,

41 
	mIMAP_AUTHENTICATE_CRAMMD5
,

42 
	mIMAP_AUTHENTICATE_DIGESTMD5
,

43 
	mIMAP_AUTHENTICATE_DIGESTMD5_RESP
,

44 
	mIMAP_AUTHENTICATE_NTLM
,

45 
	mIMAP_AUTHENTICATE_NTLM_TYPE2MSG
,

46 
	mIMAP_AUTHENTICATE_XOAUTH2
,

47 
	mIMAP_AUTHENTICATE_CANCEL
,

48 
	mIMAP_AUTHENTICATE_FINAL
,

49 
	mIMAP_LOGIN
,

50 
	mIMAP_LIST
,

51 
	mIMAP_SELECT
,

52 
	mIMAP_FETCH
,

53 
	mIMAP_FETCH_FINAL
,

54 
	mIMAP_APPEND
,

55 
	mIMAP_APPEND_FINAL
,

56 
	mIMAP_SEARCH
,

57 
	mIMAP_LOGOUT
,

58 
	mIMAP_LAST


59 } 
	tim≠°©e
;

65 
	sIMAP
 {

66 
cuæ_µ_å™s„r
 
	må™s„r
;

67 *
	mmaûbox
;

68 *
	muidvÆidôy
;

69 *
	muid
;

70 *
	m£˘i⁄
;

71 *
	m∑πül
;

72 *
	mquîy
;

73 *
	mcu°om
;

74 *
	mcu°om_∑øms
;

79 
	sim≠_c⁄n
 {

80 
pögp⁄g
 
	mµ
;

81 
im≠°©e
 
	m°©e
;

82 
boﬁ
 
	ms¶d⁄e
;

83 
	mauthmechs
;

84 
	m¥e·y≥
;

85 
	m¥efmech
;

86 
	mauthu£d
;

87 
	mcmdid
;

88 
	mª•èg
[5];

89 
boﬁ
 
	més_suµ‹ãd
;

90 
boﬁ
 
	mlogö_dißbÀd
;

91 
boﬁ
 
	mú_suµ‹ãd
;

92 *
	mmaûbox
;

93 *
	mmaûbox_uidvÆidôy
;

96 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_im≠
;

97 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_im≠s
;

100 
	#IMAP_TYPE_CLEARTEXT
 (1 << 0)

	)

101 
	#IMAP_TYPE_SASL
 (1 << 1)

	)

104 
	#IMAP_TYPE_NONE
 0

	)

105 
	#IMAP_TYPE_ANY
 ~0U

	)

	@lib/inet_ntop.c

21 
	~"cuæ_£tup.h
"

23 #i‚de‡
HAVE_INET_NTOP


25 #ifde‡
HAVE_SYS_PARAM_H


26 
	~<sys/∑øm.h
>

28 #ifde‡
HAVE_NETINET_IN_H


29 
	~<√töë/ö.h
>

31 #ifde‡
HAVE_ARPA_INET_H


32 
	~<¨∑/öë.h
>

35 
	#_MPRINTF_REPLACE


	)

36 
	~<cuæ/m¥ötf.h
>

38 
	~"öë_¡›.h
"

40 
	#IN6ADDRSZ
 16

	)

41 
	#INADDRSZ
 4

	)

42 
	#INT16SZ
 2

	)

52 *
	$öë_¡›4
 (c⁄° *
§c
, *
d°
, 
size_t
 
size
)

54 
tmp
[ "255.255.255.255"];

55 
size_t
 
Àn
;

57 
	`DEBUGASSERT
(
size
 >= 16);

59 
tmp
[0] = '\0';

60 ()
	`¢¥ötf
(
tmp
, (tmp), "%d.%d.%d.%d",

61 (()(()
§c
[0])) & 0xff,

62 (()(()
§c
[1])) & 0xff,

63 (()(()
§c
[2])) & 0xff,

64 (()(()
§c
[3])) & 0xff);

66 
Àn
 = 
	`°æí
(
tmp
);

67 if(
Àn
 =0 ||Üí >
size
) {

68 
	`SET_ERRNO
(
ENOSPC
);

69  (
NULL
);

71 
	`°r˝y
(
d°
, 
tmp
);

72  
d°
;

73 
	}
}

75 #ifde‡
ENABLE_IPV6


79 *
	$öë_¡›6
 (c⁄° *
§c
, *
d°
, 
size_t
 
size
)

88 
tmp
[("ffff:ffff:ffff:ffff:ffff:ffff:255.255.255.255")];

89 *
ç
;

91 
ba£
;

92 
Àn
;

93 } 
be°
, 
cur
;

94 
w‹ds
[
IN6ADDRSZ
 / 
INT16SZ
];

95 
i
;

101 
	`mem£t
(
w‹ds
, '\0', (words));

102 
i
 = 0; i < 
IN6ADDRSZ
; i++)

103 
w‹ds
[
i
/2] |(
§c
[i] << ((1 - (i % 2)) << 3));

105 
be°
.
ba£
 = -1;

106 
cur
.
ba£
 = -1;

107 
be°
.
Àn
 = 0;

108 
cur
.
Àn
 = 0;

110 
i
 = 0; i < (
IN6ADDRSZ
 / 
INT16SZ
); i++) {

111 if(
w‹ds
[
i
] == 0) {

112 if(
cur
.
ba£
 == -1)

113 
cur
.
ba£
 = 
i
, cur.
Àn
 = 1;

115 
cur
.
Àn
++;

117 if(
cur
.
ba£
 != -1) {

118 if(
be°
.
ba£
 =-1 || 
cur
.
Àn
 > best.len)

119 
be°
 = 
cur
;

120 
cur
.
ba£
 = -1;

123 if((
cur
.
ba£
 !-1Ë&& (
be°
.ba£ =-1 || cur.
Àn
 > best.len))

124 
be°
 = 
cur
;

125 if(
be°
.
ba£
 !-1 && be°.
Àn
 < 2)

126 
be°
.
ba£
 = -1;

128 
ç
 = 
tmp
;

129 
i
 = 0; i < (
IN6ADDRSZ
 / 
INT16SZ
); i++) {

131 if(
be°
.
ba£
 !-1 && 
i
 >be°.ba£ && i < (be°.ba£ + be°.
Àn
)) {

132 if(
i
 =
be°
.
ba£
)

133 *
ç
++ = ':';

139 if(
i
 != 0)

140 *
ç
++ = ':';

144 if(
i
 =6 && 
be°
.
ba£
 == 0 &&

145 (
be°
.
Àn
 =6 || (be°.À¿=5 && 
w‹ds
[5] == 0xffff))) {

146 if(!
	`öë_¡›4
(
§c
+12, 
ç
, (
tmp
) - (tp -Åmp))) {

147 
	`SET_ERRNO
(
ENOSPC
);

148  (
NULL
);

150 
ç
 +
	`°æí
(tp);

153 
ç
 +
	`¢¥ötf
—p, 5, "%lx", 
w‹ds
[
i
]);

158 if(
be°
.
ba£
 !-1 && (be°.ba£ + be°.
Àn
Ë=(
IN6ADDRSZ
 / 
INT16SZ
))

159 *
ç
++ = ':';

160 *
ç
++ = '\0';

164 if((
size_t
)(
ç
 - 
tmp
Ë> 
size
) {

165 
	`SET_ERRNO
(
ENOSPC
);

166  (
NULL
);

168 
	`°r˝y
(
d°
, 
tmp
);

169  
d°
;

170 
	}
}

185 *
	$Cuæ_öë_¡›
(
af
, c⁄° *
§c
, *
buf
, 
size_t
 
size
)

187 
af
) {

188 
AF_INET
:

189  
	`öë_¡›4
((c⁄° *)
§c
, 
buf
, 
size
);

190 #ifde‡
ENABLE_IPV6


191 
AF_INET6
:

192  
	`öë_¡›6
((c⁄° *)
§c
, 
buf
, 
size
);

195 
	`SET_ERRNO
(
EAFNOSUPPORT
);

196  
NULL
;

198 
	}
}

	@lib/inet_ntop.h

1 #i‚de‡
HEADER_CURL_INET_NTOP_H


2 
	#HEADER_CURL_INET_NTOP_H


	)

25 
	~"cuæ_£tup.h
"

27 *
Cuæ_öë_¡›
(
af
, c⁄° *
addr
, *
buf
, 
size_t
 
size
);

29 #ifde‡
HAVE_INET_NTOP


30 #ifde‡
HAVE_ARPA_INET_H


31 
	~<¨∑/öë.h
>

33 
	#Cuæ_öë_¡›
(
af
,
addr
,
buf
,
size
) \

34 
	`öë_¡›
(
af
,
addr
,
buf
,(
cuæ_sockÀn_t
)
size
)

	)

	@lib/inet_pton.c

19 
	~"cuæ_£tup.h
"

21 #i‚de‡
HAVE_INET_PTON


23 #ifde‡
HAVE_SYS_PARAM_H


24 
	~<sys/∑øm.h
>

26 #ifde‡
HAVE_NETINET_IN_H


27 
	~<√töë/ö.h
>

29 #ifde‡
HAVE_ARPA_INET_H


30 
	~<¨∑/öë.h
>

33 
	~"öë_±⁄.h
"

35 
	#IN6ADDRSZ
 16

	)

36 
	#INADDRSZ
 4

	)

37 
	#INT16SZ
 2

	)

44 
öë_±⁄4
(c⁄° *
§c
, *
d°
);

45 #ifde‡
ENABLE_IPV6


46 
öë_±⁄6
(c⁄° *
§c
, *
d°
);

66 
	$Cuæ_öë_±⁄
(
af
, c⁄° *
§c
, *
d°
)

68 
af
) {

69 
AF_INET
:

70  (
	`öë_±⁄4
(
§c
, (*)
d°
));

71 #ifde‡
ENABLE_IPV6


72 
AF_INET6
:

73  (
	`öë_±⁄6
(
§c
, (*)
d°
));

76 
	`SET_ERRNO
(
EAFNOSUPPORT
);

80 
	}
}

93 
	$öë_±⁄4
(c⁄° *
§c
, *
d°
)

95 c⁄° 
digôs
[] = "0123456789";

96 
ßw_digô
, 
o˘ës
, 
ch
;

97 
tmp
[
INADDRSZ
], *
ç
;

99 
ßw_digô
 = 0;

100 
o˘ës
 = 0;

101 
ç
 = 
tmp
;

102 *
ç
 = 0;

103 (
ch
 = *
§c
++) != '\0') {

104 c⁄° *
pch
;

106 if((
pch
 = 
	`°rchr
(
digôs
, 
ch
)Ë!
NULL
) {

107 
vÆ
 = *
ç
 * 10 + ()(
pch
 - 
digôs
);

109 if(
ßw_digô
 && *
ç
 == 0)

111 if(
vÆ
 > 255)

113 *
ç
 = ()
vÆ
;

114 if(! 
ßw_digô
) {

115 if(++
o˘ës
 > 4)

117 
ßw_digô
 = 1;

120 if(
ch
 ='.' && 
ßw_digô
) {

121 if(
o˘ës
 == 4)

123 *++
ç
 = 0;

124 
ßw_digô
 = 0;

129 if(
o˘ës
 < 4)

131 
	`mem˝y
(
d°
, 
tmp
, 
INADDRSZ
);

133 
	}
}

135 #ifde‡
ENABLE_IPV6


150 
	$öë_±⁄6
(c⁄° *
§c
, *
d°
)

152 c⁄° 
xdigôs_l
[] = "0123456789abcdef",

153 
xdigôs_u
[] = "0123456789ABCDEF";

154 
tmp
[
IN6ADDRSZ
], *
ç
, *
ídp
, *
cﬁ⁄p
;

155 c⁄° *
xdigôs
, *
cuπok
;

156 
ch
, 
ßw_xdigô
;

157 
size_t
 
vÆ
;

159 
	`mem£t
((
ç
 = 
tmp
), 0, 
IN6ADDRSZ
);

160 
ídp
 = 
ç
 + 
IN6ADDRSZ
;

161 
cﬁ⁄p
 = 
NULL
;

163 if(*
§c
 == ':')

164 if(*++
§c
 != ':')

166 
cuπok
 = 
§c
;

167 
ßw_xdigô
 = 0;

168 
vÆ
 = 0;

169 (
ch
 = *
§c
++) != '\0') {

170 c⁄° *
pch
;

172 if((
pch
 = 
	`°rchr
((
xdigôs
 = 
xdigôs_l
), 
ch
)Ë=
NULL
)

173 
pch
 = 
	`°rchr
((
xdigôs
 = 
xdigôs_u
), 
ch
);

174 if(
pch
 !
NULL
) {

175 
vÆ
 <<= 4;

176 
vÆ
 |(
pch
 - 
xdigôs
);

177 if(++
ßw_xdigô
 > 4)

181 if(
ch
 == ':') {

182 
cuπok
 = 
§c
;

183 if(!
ßw_xdigô
) {

184 if(
cﬁ⁄p
)

186 
cﬁ⁄p
 = 
ç
;

189 if(
ç
 + 
INT16SZ
 > 
ídp
)

191 *
ç
++ = (Ë(
vÆ
 >> 8) & 0xff;

192 *
ç
++ = (Ë
vÆ
 & 0xff;

193 
ßw_xdigô
 = 0;

194 
vÆ
 = 0;

197 if(
ch
 ='.' && ((
ç
 + 
INADDRSZ
Ë<
ídp
) &&

198 
	`öë_±⁄4
(
cuπok
, 
ç
) > 0) {

199 
ç
 +
INADDRSZ
;

200 
ßw_xdigô
 = 0;

205 if(
ßw_xdigô
) {

206 if(
ç
 + 
INT16SZ
 > 
ídp
)

208 *
ç
++ = (Ë(
vÆ
 >> 8) & 0xff;

209 *
ç
++ = (Ë
vÆ
 & 0xff;

211 if(
cﬁ⁄p
 !
NULL
) {

216 c⁄° 
ssize_t
 
n
 = 
ç
 - 
cﬁ⁄p
;

217 
ssize_t
 
i
;

219 if(
ç
 =
ídp
)

221 
i
 = 1; i <
n
; i++) {

222 *(
ídp
 - 
i
Ë*(
cﬁ⁄p
 + 
n
 - i);

223 *(
cﬁ⁄p
 + 
n
 - 
i
) = 0;

225 
ç
 = 
ídp
;

227 if(
ç
 !
ídp
)

229 
	`mem˝y
(
d°
, 
tmp
, 
IN6ADDRSZ
);

231 
	}
}

	@lib/inet_pton.h

1 #i‚de‡
HEADER_CURL_INET_PTON_H


2 
	#HEADER_CURL_INET_PTON_H


	)

25 
	~"cuæ_£tup.h
"

27 
Cuæ_öë_±⁄
(, const *, *);

29 #ifde‡
HAVE_INET_PTON


30 #ifde‡
HAVE_ARPA_INET_H


31 
	~<¨∑/öë.h
>

33 
	#Cuæ_öë_±⁄
(
x
,
y
,
z
Ë
	`öë_±⁄
(x,y,z)

	)

	@lib/krb5.c

35 
	~"cuæ_£tup.h
"

37 #i‚de‡
CURL_DISABLE_FTP


38 #ifde‡
HAVE_GSSAPI


40 #ifde‡
HAVE_OLD_GSSMIT


41 
	#GSS_C_NT_HOSTBASED_SERVICE
 
gss_¡_£rvi˚_«me


	)

42 
	#NCOMPAT
 1

	)

45 #ifde‡
HAVE_NETDB_H


46 
	~<√tdb.h
>

49 
	~"uæd©a.h
"

50 
	~"cuæ_ba£64.h
"

51 
	~"·p.h
"

52 
	~"cuæ_gsßpi.h
"

53 
	~"£ndf.h
"

54 
	~"cuæ_£c.h
"

55 
	~"cuæ_mem‹y.h
"

56 
	~"w¨∆ess.h
"

58 
	#_MPRINTF_REPLACE


	)

59 
	~<cuæ/m¥ötf.h
>

62 
	~"memdebug.h
"

64 
	#LOCAL_ADDR
 (&
c⁄n
->
loˇl_addr
)

	)

65 
	#REMOTE_ADDR
 
c⁄n
->
ù_addr
->
ai_addr


	)

68 
	$krb5_öô
(*
≠p_d©a
)

70 
gss_˘x_id_t
 *
c⁄ãxt
 = 
≠p_d©a
;

72 *
c⁄ãxt
 = 
GSS_C_NO_CONTEXT
;

74 
	}
}

77 
	$krb5_check_¥Ÿ
(*
≠p_d©a
, 
Àvñ
)

79 ()
≠p_d©a
;

80 if(
Àvñ
 =
PROT_CONFIDENTIAL
)

83 
	}
}

86 
	$krb5_decode
(*
≠p_d©a
, *
buf
, 
Àn
,

87 
Àvñ
 
UNUSED_PARAM
,

88 
c⁄√˘d©a
 *
c⁄n
 
UNUSED_PARAM
)

90 
gss_˘x_id_t
 *
c⁄ãxt
 = 
≠p_d©a
;

91 
OM_uöt32
 
maj
, 
mö
;

92 
gss_buf„r_desc
 
íc
, 
dec
;

94 ()
Àvñ
;

95 ()
c⁄n
;

97 
íc
.
vÆue
 = 
buf
;

98 
íc
.
Àngth
 = 
Àn
;

99 
maj
 = 
	`gss_un£Æ
(&
mö
, *
c⁄ãxt
, &
íc
, &
dec
, 
NULL
, NULL);

100 if(
maj
 !
GSS_S_COMPLETE
) {

101 if(
Àn
 >= 4)

102 
	`°r˝y
(
buf
, "599 ");

106 
	`mem˝y
(
buf
, 
dec
.
vÆue
, dec.
Àngth
);

107 
Àn
 = 
	`cuæx_uztosi
(
dec
.
Àngth
);

108 
	`gss_ªÀa£_buf„r
(&
mö
, &
dec
);

110  
Àn
;

111 
	}
}

114 
	$krb5_ovîhód
(*
≠p_d©a
, 
Àvñ
, 
Àn
)

117 ()
≠p_d©a
;

118 ()
Àvñ
;

119 ()
Àn
;

121 
	}
}

124 
	$krb5_ícode
(*
≠p_d©a
, c⁄° *
‰om
, 
Àngth
, 
Àvñ
, **
to
,

125 
c⁄√˘d©a
 *
c⁄n
 
UNUSED_PARAM
)

127 
gss_˘x_id_t
 *
c⁄ãxt
 = 
≠p_d©a
;

128 
gss_buf„r_desc
 
dec
, 
íc
;

129 
OM_uöt32
 
maj
, 
mö
;

130 
°©e
;

131 
Àn
;

134 
c⁄n
 = 
NULL
;

139 
dec
.
vÆue
 = (*)
‰om
;

140 
dec
.
Àngth
 =Üength;

141 
maj
 = 
	`gss_£Æ
(&
mö
, *
c⁄ãxt
,

142 
Àvñ
 =
PROT_PRIVATE
,

143 
GSS_C_QOP_DEFAULT
,

144 &
dec
, &
°©e
, &
íc
);

146 if(
maj
 !
GSS_S_COMPLETE
)

151 *
to
 = 
	`mÆloc
(
íc
.
Àngth
);

152 if(!*
to
)

154 
	`mem˝y
(*
to
, 
íc
.
vÆue
,Énc.
Àngth
);

155 
Àn
 = 
	`cuæx_uztosi
(
íc
.
Àngth
);

156 
	`gss_ªÀa£_buf„r
(&
mö
, &
íc
);

157  
Àn
;

158 
	}
}

161 
	$krb5_auth
(*
≠p_d©a
, 
c⁄√˘d©a
 *
c⁄n
)

163 
ªt
 = 
AUTH_OK
;

164 *
p
;

165 c⁄° *
ho°
 = 
c⁄n
->ho°.
«me
;

166 
ssize_t
 
ƒód
;

167 
cuæ_sockÀn_t
 
l
 = (
c⁄n
->
loˇl_addr
);

168 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

169 
CURLcode
 
ªsu…
;

170 c⁄° *
£rvi˚
 = "·p", *
§v_ho°
 = "host";

171 
gss_buf„r_desc
 
öput_buf„r
, 
ouçut_buf„r
, 
_gs§e•
, *
gs§e•
;

172 
OM_uöt32
 
maj
, 
mö
;

173 
gss_«me_t
 
gs¢ame
;

174 
gss_˘x_id_t
 *
c⁄ãxt
 = 
≠p_d©a
;

175 
gss_ch™√l_bödögs_°ru˘
 
ch™
;

176 
size_t
 
ba£64_sz
 = 0;

178 if(
	`gësock«me
(
c⁄n
->
sock
[
FIRSTSOCKET
],

179 (
sockaddr
 *)
LOCAL_ADDR
, &
l
) < 0)

180 
	`≥º‹
("getsockname()");

182 
ch™
.
öôüt‹_addπy≥
 = 
GSS_C_AF_INET
;

183 
ch™
.
öôüt‹_addªss
.
Àngth
 = 
l
 - 4;

184 
ch™
.
öôüt‹_addªss
.
vÆue
 =

185 &((
sockaddr_ö
 *)
LOCAL_ADDR
)->
sö_addr
.
s_addr
;

186 
ch™
.
ac˚±‹_addπy≥
 = 
GSS_C_AF_INET
;

187 
ch™
.
ac˚±‹_addªss
.
Àngth
 = 
l
 - 4;

188 
ch™
.
ac˚±‹_addªss
.
vÆue
 =

189 &((
sockaddr_ö
 *)
REMOTE_ADDR
)->
sö_addr
.
s_addr
;

190 
ch™
.
≠∂iˇti⁄_d©a
.
Àngth
 = 0;

191 
ch™
.
≠∂iˇti⁄_d©a
.
vÆue
 = 
NULL
;

196 if(
£rvi˚
 =
§v_ho°
) {

197 
ªsu…
 = 
	`Cuæ_·p£ndf
(
c⁄n
, "AUTH GSSAPI");

199 if(
ªsu…
)

201 if(
	`Cuæ_GëFTPRe•⁄£
(&
ƒód
, 
c⁄n
, 
NULL
))

204 if(
d©a
->
°©e
.
buf„r
[0] != '3')

208 
öput_buf„r
.
vÆue
 = 
d©a
->
°©e
.
buf„r
;

209 
öput_buf„r
.
Àngth
 = 
	`¢¥ötf
(öput_buf„r.
vÆue
, 
BUFSIZE
, "%s@%s",

210 
£rvi˚
, 
ho°
);

211 
maj
 = 
	`gss_imp‹t_«me
(&
mö
, &
öput_buf„r
, 
GSS_C_NT_HOSTBASED_SERVICE
,

212 &
gs¢ame
);

213 if(
maj
 !
GSS_S_COMPLETE
) {

214 
	`gss_ªÀa£_«me
(&
mö
, &
gs¢ame
);

215 if(
£rvi˚
 =
§v_ho°
) {

216 
	`Cuæ_Áûf
(
d©a
, "Error importing serviceÇame %s",

217 
öput_buf„r
.
vÆue
);

218  
AUTH_ERROR
;

220 
£rvi˚
 = 
§v_ho°
;

224 
	`gss_di•œy_«me
(&
mö
, 
gs¢ame
, &
ouçut_buf„r
, 
NULL
);

225 
	`Cuæ_öfof
(
d©a
, "Tryögágaö° %s\n", 
ouçut_buf„r
.
vÆue
);

226 
gs§e•
 = 
GSS_C_NO_BUFFER
;

227 *
c⁄ãxt
 = 
GSS_C_NO_CONTEXT
;

233 
	`gss_ªÀa£_buf„r
(&
mö
, &
ouçut_buf„r
);

234 
ªt
 = 
AUTH_OK
;

235 
maj
 = 
	`Cuæ_gss_öô_£c_c⁄ãxt
(
d©a
,

236 &
mö
,

237 
c⁄ãxt
,

238 
gs¢ame
,

239 &
ch™
,

240 
gs§e•
,

241 &
ouçut_buf„r
,

242 
NULL
);

244 if(
gs§e•
) {

245 
	`‰ì
(
_gs§e•
.
vÆue
);

246 
gs§e•
 = 
NULL
;

249 if(
	`GSS_ERROR
(
maj
)) {

250 
	`Cuæ_öfof
(
d©a
, "Error creating security context\n");

251 
ªt
 = 
AUTH_ERROR
;

255 if(
ouçut_buf„r
.
Àngth
 != 0) {

256 
ªsu…
 = 
	`Cuæ_ba£64_ícode
(
d©a
, (*)
ouçut_buf„r
.
vÆue
,

257 
ouçut_buf„r
.
Àngth
, &
p
, &
ba£64_sz
);

258 if(
ªsu…
) {

259 
	`Cuæ_öfof
(
d©a
,"ba£64-ícodög: %s\n", 
	`cuæ_ósy_°ªº‹
(
ªsu…
));

260 
ªt
 = 
AUTH_CONTINUE
;

264 
ªsu…
 = 
	`Cuæ_·p£ndf
(
c⁄n
, "ADAT %s", 
p
);

266 
	`‰ì
(
p
);

268 if(
ªsu…
) {

269 
ªt
 = -2;

273 if(
	`Cuæ_GëFTPRe•⁄£
(&
ƒód
, 
c⁄n
, 
NULL
)) {

274 
ªt
 = -1;

278 if(
d©a
->
°©e
.
buf„r
[0] != '2' && data->state.buffer[0] != '3') {

279 
	`Cuæ_öfof
(
d©a
, "Server didn'tácceptáuth data\n");

280 
ªt
 = 
AUTH_ERROR
;

284 
p
 = 
d©a
->
°©e
.
buf„r
 + 4;

285 
p
 = 
	`°r°r
(p, "ADAT=");

286 if(
p
) {

287 
ªsu…
 = 
	`Cuæ_ba£64_decode
(
p
 + 5,

288 (**)&
_gs§e•
.
vÆue
,

289 &
_gs§e•
.
Àngth
);

290 if(
ªsu…
) {

291 
	`Cuæ_Áûf
(
d©a
,"ba£64-decodög: %s", 
	`cuæ_ósy_°ªº‹
(
ªsu…
));

292 
ªt
 = 
AUTH_CONTINUE
;

297 
gs§e•
 = &
_gs§e•
;

299 } 
maj
 =
GSS_S_CONTINUE_NEEDED
);

301 
	`gss_ªÀa£_«me
(&
mö
, &
gs¢ame
);

302 
	`gss_ªÀa£_buf„r
(&
mö
, &
ouçut_buf„r
);

304 if(
gs§e•
)

305 
	`‰ì
(
_gs§e•
.
vÆue
);

307 if(
ªt
 =
AUTH_OK
 || 
£rvi˚
 =
§v_ho°
)

308  
ªt
;

310 
£rvi˚
 = 
§v_ho°
;

312  
ªt
;

313 
	}
}

315 
	$krb5_íd
(*
≠p_d©a
)

317 
OM_uöt32
 
mö
;

318 
gss_˘x_id_t
 *
c⁄ãxt
 = 
≠p_d©a
;

319 if(*
c⁄ãxt
 !
GSS_C_NO_CONTEXT
) {

320 #ifde‡
DEBUGBUILD


321 
OM_uöt32
 
maj
 =

323 
	`gss_dñëe_£c_c⁄ãxt
(&
mö
, 
c⁄ãxt
, 
GSS_C_NO_BUFFER
);

324 
	`DEBUGASSERT
(
maj
 =
GSS_S_COMPLETE
);

326 
	}
}

328 
Cuæ_£c_˛õ¡_mech
 
	gCuæ_krb5_˛õ¡_mech
 = {

330 (
gss_˘x_id_t
),

331 
krb5_öô
,

332 
krb5_auth
,

333 
krb5_íd
,

334 
krb5_check_¥Ÿ
,

335 
krb5_ovîhód
,

336 
krb5_ícode
,

337 
krb5_decode


	@lib/ldap.c

23 
	~"cuæ_£tup.h
"

25 #i‡!
deföed
(
CURL_DISABLE_LDAP
Ë&& !deföed(
USE_OPENLDAP
)

38 #ifde‡
CURL_LDAP_WIN


39 
	~<wöld≠.h
>

40 #i‚de‡
LDAP_VENDOR_NAME


41 #îr‹ 
Your
 
Pœtf‹m
 
SDK
 
is
 
NOT
 
sufficõ¡
 
LDAP
 
suµ‹t
! \

42 
Upd©e
 
your
 
Pœtf‹m
 
	gSDK
, 
‹
 
dißbÀ
 
LDAP
 
	gsuµ‹t
!

44 
	~<wöbî.h
>

47 
	#LDAP_DEPRECATED
 1

	)

48 #ifde‡
HAVE_LBER_H


49 
	~<lbî.h
>

51 
	~<ld≠.h
>

52 #i‡(
deföed
(
HAVE_LDAP_SSL
Ë&& deföed(
HAVE_LDAP_SSL_H
))

53 
	~<ld≠_s¶.h
>

57 
	~"uæd©a.h
"

58 
	~<cuæ/cuæ.h
>

59 
	~"£ndf.h
"

60 
	~"esˇ≥.h
"

61 
	~"¥ogªss.h
"

62 
	~"å™s„r.h
"

63 
	~"°ªquÆ.h
"

64 
	~"°πok.h
"

65 
	~"cuæ_ld≠.h
"

66 
	~"cuæ_mem‹y.h
"

67 
	~"cuæ_ba£64.h
"

68 
	~"øw°r.h
"

69 
	~"c⁄√˘.h
"

71 
	#_MPRINTF_REPLACE


	)

72 
	~<cuæ/m¥ötf.h
>

74 
	~"memdebug.h
"

76 #i‚de‡
HAVE_LDAP_URL_PARSE


81 *
	mlud_ho°
;

82 
	mlud_p‹t
;

83 *
	mlud_dn
;

84 **
	mlud_©ås
;

85 
	mlud_sc›e
;

86 *
	mlud_fûãr
;

87 **
	mlud_exts
;

88 
size_t
 
	mlud_©ås_dups
;

91 } 
	tCURL_LDAPURLDesc
;

93 #unde‡
LDAPURLDesc


94 
	#LDAPURLDesc
 
CURL_LDAPURLDesc


	)

96 
_ld≠_uæ_∑r£
 (c⁄° 
c⁄√˘d©a
 *
c⁄n
,

97 
LDAPURLDesc
 **
ludp
);

98 
_ld≠_‰ì_uædesc
 (
LDAPURLDesc
 *
ludp
);

100 #unde‡
ld≠_‰ì_uædesc


101 
	#ld≠_‰ì_uædesc
 
_ld≠_‰ì_uædesc


	)

104 #ifde‡
DEBUG_LDAP


105 
	#LDAP_TRACE
(
x
) do { \

106 
	`_ld≠_åa˚
 ("%u: ", 
__LINE__
); \

107 
_ld≠_åa˚
 
x
; \

108 } 
WHILE_FALSE


	)

110 
_ld≠_åa˚
 (c⁄° *
fmt
, ...);

112 
	#LDAP_TRACE
(
x
Ë
Cuæ_n›_°mt


	)

116 
CURLcode
 
Cuæ_ld≠
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

122 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_ld≠
 = {

124 
ZERO_NULL
,

125 
Cuæ_ld≠
,

126 
ZERO_NULL
,

127 
ZERO_NULL
,

128 
ZERO_NULL
,

129 
ZERO_NULL
,

130 
ZERO_NULL
,

131 
ZERO_NULL
,

132 
ZERO_NULL
,

133 
ZERO_NULL
,

134 
ZERO_NULL
,

135 
ZERO_NULL
,

136 
ZERO_NULL
,

137 
PORT_LDAP
,

138 
CURLPROTO_LDAP
,

139 
PROTOPT_NONE


142 #ifde‡
HAVE_LDAP_SSL


147 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_ld≠s
 = {

149 
ZERO_NULL
,

150 
Cuæ_ld≠
,

151 
ZERO_NULL
,

152 
ZERO_NULL
,

153 
ZERO_NULL
,

154 
ZERO_NULL
,

155 
ZERO_NULL
,

156 
ZERO_NULL
,

157 
ZERO_NULL
,

158 
ZERO_NULL
,

159 
ZERO_NULL
,

160 
ZERO_NULL
,

161 
ZERO_NULL
,

162 
PORT_LDAPS
,

163 
CURLPROTO_LDAPS
,

164 
PROTOPT_SSL


169 
CURLcode
 
	$Cuæ_ld≠
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

171 
CURLcode
 
°©us
 = 
CURLE_OK
;

172 
rc
 = 0;

173 
LDAP
 *
£rvî
 = 
NULL
;

174 
LDAPURLDesc
 *
ludp
 = 
NULL
;

175 
LDAPMesßge
 *
ªsu…
 = 
NULL
;

176 
LDAPMesßge
 *
íåyIãøt‹
;

177 
num
 = 0;

178 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

179 
ld≠_¥Ÿo
 = 
LDAP_VERSION3
;

180 
ld≠_s¶
 = 0;

181 *
vÆ_b64
 = 
NULL
;

182 
size_t
 
vÆ_b64_sz
 = 0;

183 
cuæ_off_t
 
dlsize
 = 0;

184 #ifde‡
LDAP_OPT_NETWORK_TIMEOUT


185 
timevÆ
 
ld≠_timeout
 = {10,0};

188 *
d⁄e
 = 
TRUE
;

189 
	`öfof
(
d©a
, "LDAPÜocal: LDAP Vendor = %s ; LDAP Version = %d\n",

190 
LDAP_VENDOR_NAME
, 
LDAP_VENDOR_VERSION
);

191 
	`öfof
(
d©a
, "LDAPÜoˇl: %s\n", d©a->
ch™ge
.
uæ
);

193 #ifde‡
HAVE_LDAP_URL_PARSE


194 
rc
 = 
	`ld≠_uæ_∑r£
(
d©a
->
ch™ge
.
uæ
, &
ludp
);

196 
rc
 = 
	`_ld≠_uæ_∑r£
(
c⁄n
, &
ludp
);

198 if(
rc
 != 0) {

199 
	`Áûf
(
d©a
, "LDAPÜoˇl: %s", 
	`ld≠_îr2°rög
(
rc
));

200 
°©us
 = 
CURLE_LDAP_INVALID_URL
;

201 
quô
;

205 if(
c⁄n
->
giví
->
Êags
 & 
PROTOPT_SSL
)

206 
ld≠_s¶
 = 1;

207 
	`öfof
(
d©a
, "LDAPÜocal:ÅryingÅoÉstablish %s connection\n",

208 
ld≠_s¶
 ? "encrypted" : "cleartext");

210 #ifde‡
LDAP_OPT_NETWORK_TIMEOUT


211 
	`ld≠_£t_›ti⁄
(
NULL
, 
LDAP_OPT_NETWORK_TIMEOUT
, &
ld≠_timeout
);

213 
	`ld≠_£t_›ti⁄
(
NULL
, 
LDAP_OPT_PROTOCOL_VERSION
, &
ld≠_¥Ÿo
);

215 if(
ld≠_s¶
) {

216 #ifde‡
HAVE_LDAP_SSL


217 #ifde‡
CURL_LDAP_WIN


219 
£rvî
 = 
	`ld≠_s¶öô
(
c⁄n
->
ho°
.
«me
, ()c⁄n->
p‹t
, 1);

220 
	`ld≠_£t_›ti⁄
(
£rvî
, 
LDAP_OPT_SSL
, 
LDAP_OPT_ON
);

222 
ld≠_›ti⁄
;

223 * 
ld≠_ˇ
 = 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
];

224 #i‡
	`deföed
(
CURL_HAS_NOVELL_LDAPSDK
)

225 
rc
 = 
	`ld≠s¶_˛õ¡_öô
(
NULL
, NULL);

226 if(
rc
 !
LDAP_SUCCESS
) {

227 
	`Áûf
(
d©a
, "LDAPÜoˇl:Üd≠s¶_˛õ¡_öô %s", 
	`ld≠_îr2°rög
(
rc
));

228 
°©us
 = 
CURLE_SSL_CERTPROBLEM
;

229 
quô
;

231 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

233 
˚π_ty≥
 = 
LDAPSSL_CERT_FILETYPE_B64
;

234 if((
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
]) &&

235 (
	`Cuæ_øw_equÆ
(
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
], "DER")))

236 
˚π_ty≥
 = 
LDAPSSL_CERT_FILETYPE_DER
;

237 if(!
ld≠_ˇ
) {

238 
	`Áûf
(
d©a
, "LDAPÜocal: ERROR %s CA certÇot set!",

239 (
˚π_ty≥
 =
LDAPSSL_CERT_FILETYPE_DER
 ? "DER" : "PEM"));

240 
°©us
 = 
CURLE_SSL_CERTPROBLEM
;

241 
quô
;

243 
	`öfof
(
d©a
, "LDAPÜocal: using %s CA cert '%s'\n",

244 (
˚π_ty≥
 =
LDAPSSL_CERT_FILETYPE_DER
 ? "DER" : "PEM"),

245 
ld≠_ˇ
);

246 
rc
 = 
	`ld≠s¶_add_åu°ed_˚π
(
ld≠_ˇ
, 
˚π_ty≥
);

247 if(
rc
 !
LDAP_SUCCESS
) {

248 
	`Áûf
(
d©a
, "LDAPÜocal: ERROR setting %s CA cert: %s",

249 (
˚π_ty≥
 =
LDAPSSL_CERT_FILETYPE_DER
 ? "DER" : "PEM"),

250 
	`ld≠_îr2°rög
(
rc
));

251 
°©us
 = 
CURLE_SSL_CERTPROBLEM
;

252 
quô
;

254 
ld≠_›ti⁄
 = 
LDAPSSL_VERIFY_SERVER
;

257 
ld≠_›ti⁄
 = 
LDAPSSL_VERIFY_NONE
;

258 
rc
 = 
	`ld≠s¶_£t_vîify_mode
(
ld≠_›ti⁄
);

259 if(
rc
 !
LDAP_SUCCESS
) {

260 
	`Áûf
(
d©a
, "LDAPÜocal: ERROR setting cert verify mode: %s",

261 
	`ld≠_îr2°rög
(
rc
));

262 
°©us
 = 
CURLE_SSL_CERTPROBLEM
;

263 
quô
;

265 
£rvî
 = 
	`ld≠s¶_öô
(
c⁄n
->
ho°
.
«me
, ()c⁄n->
p‹t
, 1);

266 if(
£rvî
 =
NULL
) {

267 
	`Áûf
(
d©a
, "LDAPÜocal: Cannot connectÅo %s:%ld",

268 
c⁄n
->
ho°
.
«me
, c⁄n->
p‹t
);

269 
°©us
 = 
CURLE_COULDNT_CONNECT
;

270 
quô
;

272 #ñi‡
	`deföed
(
LDAP_OPT_X_TLS
)

273 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

275 if((
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
]) &&

276 (!
	`Cuæ_øw_equÆ
(
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
], "PEM"))) {

277 
	`Áûf
(
d©a
, "LDAPÜocal: ERROR OpenLDAP only supports PEM cert-type!");

278 
°©us
 = 
CURLE_SSL_CERTPROBLEM
;

279 
quô
;

281 if(!
ld≠_ˇ
) {

282 
	`Áûf
(
d©a
, "LDAPÜocal: ERROR PEM CA certÇot set!");

283 
°©us
 = 
CURLE_SSL_CERTPROBLEM
;

284 
quô
;

286 
	`öfof
(
d©a
, "LDAPÜoˇl: usög PEM CA cît: %s\n", 
ld≠_ˇ
);

287 
rc
 = 
	`ld≠_£t_›ti⁄
(
NULL
, 
LDAP_OPT_X_TLS_CACERTFILE
, 
ld≠_ˇ
);

288 if(
rc
 !
LDAP_SUCCESS
) {

289 
	`Áûf
(
d©a
, "LDAPÜocal: ERROR setting PEM CA cert: %s",

290 
	`ld≠_îr2°rög
(
rc
));

291 
°©us
 = 
CURLE_SSL_CERTPROBLEM
;

292 
quô
;

294 
ld≠_›ti⁄
 = 
LDAP_OPT_X_TLS_DEMAND
;

297 
ld≠_›ti⁄
 = 
LDAP_OPT_X_TLS_NEVER
;

299 
rc
 = 
	`ld≠_£t_›ti⁄
(
NULL
, 
LDAP_OPT_X_TLS_REQUIRE_CERT
, &
ld≠_›ti⁄
);

300 if(
rc
 !
LDAP_SUCCESS
) {

301 
	`Áûf
(
d©a
, "LDAPÜocal: ERROR setting cert verify mode: %s",

302 
	`ld≠_îr2°rög
(
rc
));

303 
°©us
 = 
CURLE_SSL_CERTPROBLEM
;

304 
quô
;

306 
£rvî
 = 
	`ld≠_öô
(
c⁄n
->
ho°
.
«me
, ()c⁄n->
p‹t
);

307 if(
£rvî
 =
NULL
) {

308 
	`Áûf
(
d©a
, "LDAPÜocal: Cannot connectÅo %s:%ld",

309 
c⁄n
->
ho°
.
«me
, c⁄n->
p‹t
);

310 
°©us
 = 
CURLE_COULDNT_CONNECT
;

311 
quô
;

313 
ld≠_›ti⁄
 = 
LDAP_OPT_X_TLS_HARD
;

314 
rc
 = 
	`ld≠_£t_›ti⁄
(
£rvî
, 
LDAP_OPT_X_TLS
, &
ld≠_›ti⁄
);

315 if(
rc
 !
LDAP_SUCCESS
) {

316 
	`Áûf
(
d©a
, "LDAPÜocal: ERROR setting SSL/TLS mode: %s",

317 
	`ld≠_îr2°rög
(
rc
));

318 
°©us
 = 
CURLE_SSL_CERTPROBLEM
;

319 
quô
;

333 
	`Áûf
(
d©a
, "LDAPÜocal: SSL/TLSÇot supported withÅhis version "

335 
°©us
 = 
CURLE_SSL_CERTPROBLEM
;

336 
quô
;

342 
£rvî
 = 
	`ld≠_öô
(
c⁄n
->
ho°
.
«me
, ()c⁄n->
p‹t
);

343 if(
£rvî
 =
NULL
) {

344 
	`Áûf
(
d©a
, "LDAPÜocal: Cannot connectÅo %s:%ld",

345 
c⁄n
->
ho°
.
«me
, c⁄n->
p‹t
);

346 
°©us
 = 
CURLE_COULDNT_CONNECT
;

347 
quô
;

350 #ifde‡
CURL_LDAP_WIN


351 
	`ld≠_£t_›ti⁄
(
£rvî
, 
LDAP_OPT_PROTOCOL_VERSION
, &
ld≠_¥Ÿo
);

354 
rc
 = 
	`ld≠_sim∂e_böd_s
(
£rvî
,

355 
c⁄n
->
bôs
.
u£r_∑sswd
 ? c⁄n->
u£r
 : 
NULL
,

356 
c⁄n
->
bôs
.
u£r_∑sswd
 ? c⁄n->
∑sswd
 : 
NULL
);

357 if(!
ld≠_s¶
 && 
rc
 != 0) {

358 
ld≠_¥Ÿo
 = 
LDAP_VERSION2
;

359 
	`ld≠_£t_›ti⁄
(
£rvî
, 
LDAP_OPT_PROTOCOL_VERSION
, &
ld≠_¥Ÿo
);

360 
rc
 = 
	`ld≠_sim∂e_böd_s
(
£rvî
,

361 
c⁄n
->
bôs
.
u£r_∑sswd
 ? c⁄n->
u£r
 : 
NULL
,

362 
c⁄n
->
bôs
.
u£r_∑sswd
 ? c⁄n->
∑sswd
 : 
NULL
);

364 if(
rc
 != 0) {

365 
	`Áûf
(
d©a
, "LDAPÜoˇl:Üd≠_sim∂e_böd_†%s", 
	`ld≠_îr2°rög
(
rc
));

366 
°©us
 = 
CURLE_LDAP_CANNOT_BIND
;

367 
quô
;

370 
rc
 = 
	`ld≠_£¨ch_s
(
£rvî
, 
ludp
->
lud_dn
,Üudp->
lud_sc›e
,

371 
ludp
->
lud_fûãr
,Üudp->
lud_©ås
, 0, &
ªsu…
);

373 if(
rc
 !0 &&Ñ¯!
LDAP_SIZELIMIT_EXCEEDED
) {

374 
	`Áûf
(
d©a
, "LDAPÑemŸe: %s", 
	`ld≠_îr2°rög
(
rc
));

375 
°©us
 = 
CURLE_LDAP_SEARCH_FAILED
;

376 
quô
;

379 
num
 = 0, 
íåyIãøt‹
 = 
	`ld≠_fú°_íåy
(
£rvî
, 
ªsu…
);

380 
íåyIãøt‹
;

381 
íåyIãøt‹
 = 
	`ld≠_√xt_íåy
(
£rvî
,É¡ryIãøt‹), 
num
++) {

382 
BîEÀmít
 *
bî
 = 
NULL
;

383 *
©åibuã
;

384 *
dn
 = 
	`ld≠_gë_dn
(
£rvî
, 
íåyIãøt‹
);

385 
i
;

387 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"DN: ", 4);

388 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)
dn
, 0);

389 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"\n", 1);

391 
dlsize
 +
	`°æí
(
dn
)+5;

393 
©åibuã
 = 
	`ld≠_fú°_©åibuã
(
£rvî
, 
íåyIãøt‹
, &
bî
);

394 
©åibuã
;

395 
©åibuã
 = 
	`ld≠_√xt_©åibuã
(
£rvî
, 
íåyIãøt‹
, 
bî
)) {

396 
BîVÆue
 **
vÆs
 = 
	`ld≠_gë_vÆues_Àn
(
£rvî
, 
íåyIãøt‹
, 
©åibuã
);

398 if(
vÆs
 !
NULL
) {

399 
i
 = 0; (
vÆs
[i] !
NULL
); i++) {

400 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"\t", 1);

401 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*Ë
©åibuã
, 0);

402 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)": ", 2);

403 
dlsize
 +
	`°æí
(
©åibuã
)+3;

405 if((
	`°æí
(
©åibuã
) > 7) &&

406 (
	`°rcmp
(";binary",

407 (*)
©åibuã
 +

408 (
	`°æí
((*)
©åibuã
) - 7)) == 0)) {

410 
CURLcode
 
îr‹
 = 
	`Cuæ_ba£64_ícode
(
d©a
,

411 
vÆs
[
i
]->
bv_vÆ
,

412 
vÆs
[
i
]->
bv_Àn
,

413 &
vÆ_b64
,

414 &
vÆ_b64_sz
);

415 if(
îr‹
) {

416 
	`ld≠_vÆue_‰ì_Àn
(
vÆs
);

417 
	`ld≠_mem‰ì
(
©åibuã
);

418 
	`ld≠_mem‰ì
(
dn
);

419 if(
bî
)

420 
	`bî_‰ì
(
bî
, 0);

421 
°©us
 = 
îr‹
;

422 
quô
;

424 if(
vÆ_b64_sz
 > 0) {

425 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
vÆ_b64
, 
vÆ_b64_sz
);

426 
	`‰ì
(
vÆ_b64
);

427 
dlsize
 +
vÆ_b64_sz
;

431 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
vÆs
[
i
]->
bv_vÆ
,

432 
vÆs
[
i
]->
bv_Àn
);

433 
dlsize
 +
vÆs
[
i
]->
bv_Àn
;

435 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"\n", 0);

436 
dlsize
++;

440 
	`ld≠_vÆue_‰ì_Àn
(
vÆs
);

442 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"\n", 1);

443 
dlsize
++;

444 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, 
dlsize
);

445 
	`ld≠_mem‰ì
(
©åibuã
);

447 
	`ld≠_mem‰ì
(
dn
);

448 if(
bî
)

449 
	`bî_‰ì
(
bî
, 0);

452 
quô
:

453 if(
ªsu…
) {

454 
	`ld≠_msg‰ì
(
ªsu…
);

455 
	`LDAP_TRACE
 (("Re˚ived %dÉ¡rõs\n", 
num
));

457 if(
rc
 =
LDAP_SIZELIMIT_EXCEEDED
)

458 
	`öfof
(
d©a
, "Thîê¨êm‹êth™ %dÉ¡rõs\n", 
num
);

459 if(
ludp
)

460 
	`ld≠_‰ì_uædesc
(
ludp
);

461 if(
£rvî
)

462 
	`ld≠_unböd_s
(
£rvî
);

463 #i‡
	`deföed
(
HAVE_LDAP_SSL
Ë&& deföed(
CURL_HAS_NOVELL_LDAPSDK
)

464 if(
ld≠_s¶
)

465 
	`ld≠s¶_˛õ¡_deöô
();

469 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

470 
	`c⁄n˛o£
(
c⁄n
, "LDAP connectionálways disableÑe-use");

472  
°©us
;

473 
	}
}

475 #ifde‡
DEBUG_LDAP


476 
	$_ld≠_åa˚
 (c⁄° *
fmt
, ...)

478 
do_åa˚
 = -1;

479 
va_li°
 
¨gs
;

481 if(
do_åa˚
 == -1) {

482 c⁄° *
ív
 = 
	`gëív
("CURL_TRACE");

483 
do_åa˚
 = (
ív
 && 
	`°πﬁ
”nv, 
NULL
, 10) > 0);

485 if(!
do_åa˚
)

488 
	`va_°¨t
 (
¨gs
, 
fmt
);

489 
	`vÂrötf
 (
°dîr
, 
fmt
, 
¨gs
);

490 
	`va_íd
 (
¨gs
);

491 
	}
}

494 #i‚de‡
HAVE_LDAP_URL_PARSE


499 
	$°r2sc›e
 (c⁄° *
p
)

501 if(
	`°ªquÆ
(
p
, "one"))

502  
LDAP_SCOPE_ONELEVEL
;

503 if(
	`°ªquÆ
(
p
, "onetree"))

504  
LDAP_SCOPE_ONELEVEL
;

505 if(
	`°ªquÆ
(
p
, "base"))

506  
LDAP_SCOPE_BASE
;

507 if(
	`°ªquÆ
(
p
, "sub"))

508  
LDAP_SCOPE_SUBTREE
;

509 if(
	`°ªquÆ
–
p
, "subtree"))

510  
LDAP_SCOPE_SUBTREE
;

512 
	}
}

518 **
	$•lô_°r
 (*
°r
)

520 **
ªs
, *
œ°s
, *
s
;

521 
i
;

523 
i
 = 2, 
s
 = 
	`°rchr
(
°r
,','); s; i++)

524 
s
 = 
	`°rchr
(++s,',');

526 
ªs
 = 
	`ˇŒoc
(
i
, (*));

527 if(!
ªs
)

528  
NULL
;

530 
i
 = 0, 
s
 = 
	`°πok_r
(
°r
, ",", &
œ°s
); s;

531 
s
 = 
	`°πok_r
(
NULL
, ",", &
œ°s
), 
i
++)

532 
ªs
[
i
] = 
s
;

533  
ªs
;

534 
	}
}

539 
boﬁ
 
	$u√sˇ≥_ñemíts
 (*
d©a
, 
LDAPURLDesc
 *
ludp
)

541 
i
;

543 if(
ludp
->
lud_fûãr
) {

544 
ludp
->
lud_fûãr
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
,Üudp->lud_fûãr, 0, 
NULL
);

545 if(!
ludp
->
lud_fûãr
)

546  
FALSE
;

549 
i
 = 0; 
ludp
->
lud_©ås
 &&Üudp->lud_attrs[i]; i++) {

550 
ludp
->
lud_©ås
[
i
] = 
	`cuæ_ósy_u√sˇ≥
(
d©a
,Üudp->lud_attrs[i],

551 0, 
NULL
);

552 if(!
ludp
->
lud_©ås
[
i
])

553  
FALSE
;

554 
ludp
->
lud_©ås_dups
++;

557 if(
ludp
->
lud_dn
) {

558 *
dn
 = 
ludp
->
lud_dn
;

559 *
√w_dn
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
, 
dn
, 0, 
NULL
);

561 
	`‰ì
(
dn
);

562 
ludp
->
lud_dn
 = 
√w_dn
;

563 if(!
√w_dn
)

564  (
FALSE
);

566  (
TRUE
);

567 
	}
}

583 
	$_ld≠_uæ_∑r£2
 (c⁄° 
c⁄√˘d©a
 *
c⁄n
, 
LDAPURLDesc
 *
ludp
)

585 *
p
, *
q
;

586 
i
;

588 if(!
c⁄n
->
d©a
 ||

589 !
c⁄n
->
d©a
->
°©e
.
∑th
 ||

590 
c⁄n
->
d©a
->
°©e
.
∑th
[0] != '/' ||

591 !
	`check¥efix
("LDAP", 
c⁄n
->
d©a
->
ch™ge
.
uæ
))

592  
LDAP_INVALID_SYNTAX
;

594 
ludp
->
lud_sc›e
 = 
LDAP_SCOPE_BASE
;

595 
ludp
->
lud_p‹t
 = 
c⁄n
->
ªmŸe_p‹t
;

596 
ludp
->
lud_ho°
 = 
c⁄n
->
ho°
.
«me
;

600 
ludp
->
lud_dn
 = 
	`°rdup
(
c⁄n
->
d©a
->
°©e
.
∑th
+1);

601 if(!
ludp
->
lud_dn
)

602  
LDAP_NO_MEMORY
;

604 
p
 = 
	`°rchr
(
ludp
->
lud_dn
, '?');

605 
	`LDAP_TRACE
 (("DN '%.*s'\n", 
p
 ? (
size_t
)’-
ludp
->
lud_dn
) :

606 
	`°æí
(
ludp
->
lud_dn
),Üudp->lud_dn));

608 if(!
p
)

609 
suc˚ss
;

611 *
p
++ = '\0';

615 
q
 = 
	`°rchr
(
p
, '?');

616 if(
q
)

617 *
q
++ = '\0';

619 if(*
p
 && *p != '?') {

620 
ludp
->
lud_©ås
 = 
	`•lô_°r
(
p
);

621 if(!
ludp
->
lud_©ås
)

622  
LDAP_NO_MEMORY
;

624 
i
 = 0; 
ludp
->
lud_©ås
[i]; i++)

625 
	`LDAP_TRACE
 (("©å[%d] '%s'\n", 
i
, 
ludp
->
lud_©ås
[i]));

628 
p
 = 
q
;

629 if(!
p
)

630 
suc˚ss
;

634 
q
 = 
	`°rchr
(
p
, '?');

635 if(
q
)

636 *
q
++ = '\0';

638 if(*
p
 && *p != '?') {

639 
ludp
->
lud_sc›e
 = 
	`°r2sc›e
(
p
);

640 if(
ludp
->
lud_sc›e
 == -1) {

641  
LDAP_INVALID_SYNTAX
;

643 
	`LDAP_TRACE
 (("sc›ê%d\n", 
ludp
->
lud_sc›e
));

646 
p
 = 
q
;

647 if(!
p
)

648 
suc˚ss
;

652 
q
 = 
	`°rchr
(
p
, '?');

653 if(
q
)

654 *
q
++ = '\0';

655 if(!*
p
) {

656  
LDAP_INVALID_SYNTAX
;

659 
ludp
->
lud_fûãr
 = 
p
;

660 
	`LDAP_TRACE
 (("fûã∏'%s'\n", 
ludp
->
lud_fûãr
));

662 
suc˚ss
:

663 if(!
	`u√sˇ≥_ñemíts
(
c⁄n
->
d©a
, 
ludp
))

664  
LDAP_NO_MEMORY
;

665  
LDAP_SUCCESS
;

666 
	}
}

668 
	$_ld≠_uæ_∑r£
 (c⁄° 
c⁄√˘d©a
 *
c⁄n
,

669 
LDAPURLDesc
 **
ludµ
)

671 
LDAPURLDesc
 *
ludp
 = 
	`ˇŒoc
(1, (*ludp));

672 
rc
;

674 *
ludµ
 = 
NULL
;

675 if(!
ludp
)

676  
LDAP_NO_MEMORY
;

678 
rc
 = 
	`_ld≠_uæ_∑r£2
 (
c⁄n
, 
ludp
);

679 if(
rc
 !
LDAP_SUCCESS
) {

680 
	`_ld≠_‰ì_uædesc
(
ludp
);

681 
ludp
 = 
NULL
;

683 *
ludµ
 = 
ludp
;

684  (
rc
);

685 
	}
}

687 
	$_ld≠_‰ì_uædesc
 (
LDAPURLDesc
 *
ludp
)

689 
size_t
 
i
;

691 if(!
ludp
)

694 if(
ludp
->
lud_dn
)

695 
	`‰ì
(
ludp
->
lud_dn
);

697 if(
ludp
->
lud_fûãr
)

698 
	`‰ì
(
ludp
->
lud_fûãr
);

700 if(
ludp
->
lud_©ås
) {

701 
i
 = 0; i < 
ludp
->
lud_©ås_dups
; i++)

702 
	`‰ì
(
ludp
->
lud_©ås
[
i
]);

703 
	`‰ì
(
ludp
->
lud_©ås
);

706 
	`‰ì
 (
ludp
);

707 
	}
}

	@lib/llist.c

23 
	~"cuæ_£tup.h
"

25 
	~"Œi°.h
"

26 
	~"cuæ_mem‹y.h
"

29 
	~"memdebug.h
"

35 
	$Œi°_öô
(
cuæ_Œi°
 *
l
, 
cuæ_Œi°_dt‹
 
dt‹
)

37 
l
->
size
 = 0;

38 
l
->
dt‹
 = dtor;

39 
l
->
hód
 = 
NULL
;

40 
l
->
èû
 = 
NULL
;

41 
	}
}

43 
cuæ_Œi°
 *

44 
	$Cuæ_Œi°_Æloc
(
cuæ_Œi°_dt‹
 
dt‹
)

46 
cuæ_Œi°
 *
li°
;

48 
li°
 = 
	`mÆloc
((
cuæ_Œi°
));

49 if(!
li°
)

50  
NULL
;

52 
	`Œi°_öô
(
li°
, 
dt‹
);

54  
li°
;

55 
	}
}

69 
	$Cuæ_Œi°_ö£π_√xt
(
cuæ_Œi°
 *
li°
, 
cuæ_Œi°_ñemít
 *
e
,

70 c⁄° *
p
)

72 
cuæ_Œi°_ñemít
 *
√
 = 
	`mÆloc
((curl_llist_element));

73 if(!
√
)

76 
√
->
±r
 = (*Ë
p
;

77 if(
li°
->
size
 == 0) {

78 
li°
->
hód
 = 
√
;

79 
li°
->
hód
->
¥ev
 = 
NULL
;

80 
li°
->
hód
->
√xt
 = 
NULL
;

81 
li°
->
èû
 = 
√
;

85 
√
->
√xt
 = 
e
?e->√xt:
li°
->
hód
;

86 
√
->
¥ev
 = 
e
;

87 if(!
e
) {

88 
li°
->
hód
->
¥ev
 = 
√
;

89 
li°
->
hód
 = 
√
;

91 if(
e
->
√xt
) {

92 
e
->
√xt
->
¥ev
 = 
√
;

95 
li°
->
èû
 = 
√
;

97 if(
e
)

98 
e
->
√xt
 = 
√
;

101 ++
li°
->
size
;

104 
	}
}

110 
	$Cuæ_Œi°_ªmove
(
cuæ_Œi°
 *
li°
, 
cuæ_Œi°_ñemít
 *
e
,

111 *
u£r
)

113 if(
e
 =
NULL
 || 
li°
->
size
 == 0)

116 if(
e
 =
li°
->
hód
) {

117 
li°
->
hód
 = 
e
->
√xt
;

119 if(
li°
->
hód
 =
NULL
)

120 
li°
->
èû
 = 
NULL
;

122 
e
->
√xt
->
¥ev
 = 
NULL
;

125 
e
->
¥ev
->
√xt
 =É->next;

126 if(!
e
->
√xt
)

127 
li°
->
èû
 = 
e
->
¥ev
;

129 
e
->
√xt
->
¥ev
 =É->prev;

132 
li°
->
	`dt‹
(
u£r
, 
e
->
±r
);

134 
e
->
±r
 = 
NULL
;

135 
e
->
¥ev
 = 
NULL
;

136 
e
->
√xt
 = 
NULL
;

138 
	`‰ì
(
e
);

139 --
li°
->
size
;

142 
	}
}

145 
	$Cuæ_Œi°_de°roy
(
cuæ_Œi°
 *
li°
, *
u£r
)

147 if(
li°
) {

148 
li°
->
size
 > 0)

149 
	`Cuæ_Œi°_ªmove
(
li°
,Üi°->
èû
, 
u£r
);

151 
	`‰ì
(
li°
);

153 
	}
}

155 
size_t


156 
	$Cuæ_Œi°_cou¡
(
cuæ_Œi°
 *
li°
)

158  
li°
->
size
;

159 
	}
}

164 
	$Cuæ_Œi°_move
(
cuæ_Œi°
 *
li°
, 
cuæ_Œi°_ñemít
 *
e
,

165 
cuæ_Œi°
 *
to_li°
,

166 
cuæ_Œi°_ñemít
 *
to_e
)

169 if(
e
 =
NULL
 || 
li°
->
size
 == 0)

172 if(
e
 =
li°
->
hód
) {

173 
li°
->
hód
 = 
e
->
√xt
;

175 if(
li°
->
hód
 =
NULL
)

176 
li°
->
èû
 = 
NULL
;

178 
e
->
√xt
->
¥ev
 = 
NULL
;

181 
e
->
¥ev
->
√xt
 =É->next;

182 if(!
e
->
√xt
)

183 
li°
->
èû
 = 
e
->
¥ev
;

185 
e
->
√xt
->
¥ev
 =É->prev;

188 --
li°
->
size
;

191 if(
to_li°
->
size
 == 0) {

192 
to_li°
->
hód
 = 
e
;

193 
to_li°
->
hód
->
¥ev
 = 
NULL
;

194 
to_li°
->
hód
->
√xt
 = 
NULL
;

195 
to_li°
->
èû
 = 
e
;

198 
e
->
√xt
 = 
to_e
->next;

199 
e
->
¥ev
 = 
to_e
;

200 if(
to_e
->
√xt
) {

201 
to_e
->
√xt
->
¥ev
 = 
e
;

204 
to_li°
->
èû
 = 
e
;

206 
to_e
->
√xt
 = 
e
;

209 ++
to_li°
->
size
;

212 
	}
}

	@lib/llist.h

1 #i‚de‡
HEADER_CURL_LLIST_H


2 
	#HEADER_CURL_LLIST_H


	)

25 
	~"cuæ_£tup.h
"

26 
	~<°ddef.h
>

28 (*
	tcuæ_Œi°_dt‹
)(*, *);

30 
	scuæ_Œi°_ñemít
 {

31 *
±r
;

33 
cuæ_Œi°_ñemít
 *
¥ev
;

34 
cuæ_Œi°_ñemít
 *
√xt
;

37 
	scuæ_Œi°
 {

38 
cuæ_Œi°_ñemít
 *
hód
;

39 
cuæ_Œi°_ñemít
 *
èû
;

41 
cuæ_Œi°_dt‹
 
dt‹
;

43 
size_t
 
size
;

46 
cuæ_Œi°
 *
	`Cuæ_Œi°_Æloc
(
cuæ_Œi°_dt‹
);

47 
	`Cuæ_Œi°_ö£π_√xt
(
cuæ_Œi°
 *, 
cuæ_Œi°_ñemít
 *,

49 
	`Cuæ_Œi°_ªmove
(
cuæ_Œi°
 *, 
cuæ_Œi°_ñemít
 *,

51 
size_t
 
	`Cuæ_Œi°_cou¡
(
cuæ_Œi°
 *);

52 
	`Cuæ_Œi°_de°roy
(
cuæ_Œi°
 *, *);

53 
	`Cuæ_Œi°_move
(
cuæ_Œi°
 *, 
cuæ_Œi°_ñemít
 *,

54 
cuæ_Œi°
 *, 
cuæ_Œi°_ñemít
 *);

	@lib/md4.c

23 
	~"cuæ_£tup.h
"

27 #ifde‡
USE_NSS


29 
	~"cuæ_md4.h
"

30 
	~"w¨∆ess.h
"

32 
	tUINT4
;

34 
	sMD4C⁄ãxt
 {

35 
UINT4
 
	m°©e
[4];

36 
UINT4
 
	mcou¡
[2];

37 
	mbuf„r
[64];

38 } 
	tMD4_CTX
;

42 
	#S11
 3

	)

43 
	#S12
 7

	)

44 
	#S13
 11

	)

45 
	#S14
 19

	)

46 
	#S21
 3

	)

47 
	#S22
 5

	)

48 
	#S23
 9

	)

49 
	#S24
 13

	)

50 
	#S31
 3

	)

51 
	#S32
 9

	)

52 
	#S33
 11

	)

53 
	#S34
 15

	)

55 
MD4Tønsf‹m
(
UINT4
 [4], const [64]);

56 
Encode
(*, 
UINT4
 *, );

57 
Decode
(
UINT4
 *, const *, );

59 
	gPADDING
[64] = {

67 
	#F
(
x
, 
y
, 
z
Ë(((xË& (y)Ë| ((~xË& (z)))

	)

68 
	#G
(
x
, 
y
, 
z
Ë(((xË& (y)Ë| ((xË& (z)Ë| ((yË& (z)))

	)

69 
	#H
(
x
, 
y
, 
z
Ë((xË^ (yË^ (z))

	)

73 
	#ROTATE_LEFT
(
x
, 
n
Ë(((xË<< (n)Ë| ((xË>> (32-“))))

	)

77 
	#FF
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
) { \

78 (
a
Ë+
	`F
 ((
b
), (
c
), (
d
)Ë+ (
x
); \

79 (
a
Ë
	`ROTATE_LEFT
 (◊), (
s
)); \

80 }

	)

81 
	#GG
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
) { \

82 (
a
Ë+
	`G
 ((
b
), (
c
), (
d
)Ë+ (
x
Ë+ (
UINT4
)0x5a827999; \

83 (
a
Ë
	`ROTATE_LEFT
 (◊), (
s
)); \

84 }

	)

85 
	#HH
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
) { \

86 (
a
Ë+
	`H
 ((
b
), (
c
), (
d
)Ë+ (
x
Ë+ (
UINT4
)0x6ed9eba1; \

87 (
a
Ë
	`ROTATE_LEFT
 (◊), (
s
)); \

88 }

	)

92 
	$MD4Inô
(
MD4_CTX
 *
c⁄ãxt
)

94 
c⁄ãxt
->
cou¡
[0] = context->count[1] = 0;

98 
c⁄ãxt
->
°©e
[0] = 0x67452301;

99 
c⁄ãxt
->
°©e
[1] = 0xefcdab89;

100 
c⁄ãxt
->
°©e
[2] = 0x98badcfe;

101 
c⁄ãxt
->
°©e
[3] = 0x10325476;

102 
	}
}

108 
	$MD4Upd©e
(
MD4_CTX
 *
c⁄ãxt
, c⁄° *
öput
,

109 
öputLí
)

111 
i
, 
bufödex
, 
∑πLí
;

114 
bufödex
 = ()((
c⁄ãxt
->
cou¡
[0] >> 3) & 0x3F);

116 if((
c⁄ãxt
->
cou¡
[0] +((
UINT4
)
öputLí
 << 3))

117 < ((
UINT4
)
öputLí
 << 3))

118 
c⁄ãxt
->
cou¡
[1]++;

119 
c⁄ãxt
->
cou¡
[1] +((
UINT4
)
öputLí
 >> 29);

121 
∑πLí
 = 64 - 
bufödex
;

124 if(
öputLí
 >
∑πLí
) {

125 
	`mem˝y
(&
c⁄ãxt
->
buf„r
[
bufödex
], 
öput
, 
∑πLí
);

126 
	`MD4Tønsf‹m
 (
c⁄ãxt
->
°©e
, c⁄ãxt->
buf„r
);

128 
i
 = 
∑πLí
; i + 63 < 
öputLí
; i += 64)

129 
	`MD4Tønsf‹m
 (
c⁄ãxt
->
°©e
, &
öput
[
i
]);

131 
bufödex
 = 0;

134 
i
 = 0;

137 
	`mem˝y
(&
c⁄ãxt
->
buf„r
[
bufödex
], &
öput
[
i
], 
öputLí
-i);

138 
	}
}

141 
	$MD4Pad
(
MD4_CTX
 *
c⁄ãxt
)

143 
bôs
[8];

144 
bufödex
, 
∑dLí
;

147 
	`Encode
 (
bôs
, 
c⁄ãxt
->
cou¡
, 8);

151 
bufödex
 = ()((
c⁄ãxt
->
cou¡
[0] >> 3) & 0x3f);

152 
∑dLí
 = (
bufödex
 < 56) ? (56 - bufindex) : (120 - bufindex);

153 
	`MD4Upd©e
 (
c⁄ãxt
, 
PADDING
, 
∑dLí
);

156 
	`MD4Upd©e
 (
c⁄ãxt
, 
bôs
, 8);

157 
	}
}

162 
	$MD4FöÆ
 (
dige°
[16], 
MD4_CTX
 *
c⁄ãxt
)

165 
	`MD4Pad
 (
c⁄ãxt
);

168 
	`Encode
 (
dige°
, 
c⁄ãxt
->
°©e
, 16);

172 
	`mem£t
(
c⁄ãxt
, 0, (*context));

173 
	}
}

177 
	$MD4Tønsf‹m
 (
UINT4
 
°©e
[4], c⁄° 
block
[64])

179 
UINT4
 
a
 = 
°©e
[0], 
b
 = sèã[1], 
c
 = sèã[2], 
d
 = sèã[3], 
x
[16];

181 
	`Decode
 (
x
, 
block
, 64);

184 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 0], 
S11
);

185 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 1], 
S12
);

186 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[ 2], 
S13
);

187 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[ 3], 
S14
);

188 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 4], 
S11
);

189 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 5], 
S12
);

190 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[ 6], 
S13
);

191 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[ 7], 
S14
);

192 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 8], 
S11
);

193 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 9], 
S12
);

194 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[10], 
S13
);

195 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[11], 
S14
);

196 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[12], 
S11
);

197 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[13], 
S12
);

198 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[14], 
S13
);

199 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[15], 
S14
);

202 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 0], 
S21
);

203 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[ 4], 
S22
);

204 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[ 8], 
S23
);

205 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[12], 
S24
);

206 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 1], 
S21
);

207 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[ 5], 
S22
);

208 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[ 9], 
S23
);

209 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[13], 
S24
);

210 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 2], 
S21
);

211 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[ 6], 
S22
);

212 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[10], 
S23
);

213 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[14], 
S24
);

214 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 3], 
S21
);

215 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[ 7], 
S22
);

216 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[11], 
S23
);

217 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[15], 
S24
);

220 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 0], 
S31
);

221 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 8], 
S32
);

222 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[ 4], 
S33
);

223 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[12], 
S34
);

224 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 2], 
S31
);

225 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[10], 
S32
);

226 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[ 6], 
S33
);

227 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[14], 
S34
);

228 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 1], 
S31
);

229 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 9], 
S32
);

230 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[ 5], 
S33
);

231 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[13], 
S34
);

232 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 3], 
S31
);

233 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[11], 
S32
);

234 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[ 7], 
S33
);

235 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[15], 
S34
);

237 
°©e
[0] +
a
;

238 
°©e
[1] +
b
;

239 
°©e
[2] +
c
;

240 
°©e
[3] +
d
;

244 
	`mem£t
(
x
, 0, (x));

245 
	}
}

250 
	$Encode
(*
ouçut
, 
UINT4
 *
öput
, 
Àn
)

252 
i
, 
j
;

254 
i
 = 0, 
j
 = 0; j < 
Àn
; i++, j += 4) {

255 
ouçut
[
j
] = ()(
öput
[
i
] & 0xff);

256 
ouçut
[
j
+1] = ()((
öput
[
i
] >> 8) & 0xff);

257 
ouçut
[
j
+2] = ()((
öput
[
i
] >> 16) & 0xff);

258 
ouçut
[
j
+3] = ()((
öput
[
i
] >> 24) & 0xff);

260 
	}
}

265 
	$Decode
 (
UINT4
 *
ouçut
, c⁄° *
öput
,

266 
Àn
)

268 
i
, 
j
;

270 
i
 = 0, 
j
 = 0; j < 
Àn
; i++, j += 4)

271 
ouçut
[
i
] = ((
UINT4
)
öput
[
j
]) | (((UINT4)input[j+1]) << 8) |

272 (((
UINT4
)
öput
[
j
+2]) << 16) | (((UINT4)input[j+3]) << 24);

273 
	}
}

275 
	$Cuæ_md4ô
(*
ouçut
, c⁄° *
öput
, 
size_t
 
Àn
)

277 
MD4_CTX
 
˘x
;

278 
	`MD4Inô
(&
˘x
);

279 
	`MD4Upd©e
(&
˘x
, 
öput
, 
	`cuæx_uztoui
(
Àn
));

280 
	`MD4FöÆ
(
ouçut
, &
˘x
);

281 
	}
}

	@lib/md5.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


27 
	~"cuæ_md5.h
"

28 
	~"cuæ_hmac.h
"

29 
	~"w¨∆ess.h
"

31 
	~"cuæ_mem‹y.h
"

33 #i‡
deföed
(
USE_GNUTLS_NETTLE
)

35 
	~<√âÀ/md5.h
>

37 
	~"memdebug.h
"

39 
md5_˘x
 
	tMD5_CTX
;

41 
	$MD5_Inô
(
MD5_CTX
 * 
˘x
)

43 
	`md5_öô
(
˘x
);

44 
	}
}

46 
	$MD5_Upd©e
(
MD5_CTX
 * 
˘x
,

47 c⁄° * 
öput
,

48 
öputLí
)

50 
	`md5_upd©e
(
˘x
, 
öputLí
, 
öput
);

51 
	}
}

53 
	$MD5_FöÆ
(
dige°
[16], 
MD5_CTX
 * 
˘x
)

55 
	`md5_dige°
(
˘x
, 16, 
dige°
);

56 
	}
}

58 #ñi‡
deföed
(
USE_GNUTLS
)

60 
	~<g¸y±.h
>

62 
	~"memdebug.h
"

64 
g¸y_md_hd_t
 
	tMD5_CTX
;

66 
	$MD5_Inô
(
MD5_CTX
 * 
˘x
)

68 
	`g¸y_md_›í
(
˘x
, 
GCRY_MD_MD5
, 0);

69 
	}
}

71 
	$MD5_Upd©e
(
MD5_CTX
 * 
˘x
,

72 c⁄° * 
öput
,

73 
öputLí
)

75 
	`g¸y_md_wrôe
(*
˘x
, 
öput
, 
öputLí
);

76 
	}
}

78 
	$MD5_FöÆ
(
dige°
[16], 
MD5_CTX
 * 
˘x
)

80 
	`mem˝y
(
dige°
, 
	`g¸y_md_ªad
(*
˘x
, 0), 16);

81 
	`g¸y_md_˛o£
(*
˘x
);

82 
	}
}

84 #ñi‡
deföed
(
USE_SSLEAY
)

87 #ifde‡
USE_OPENSSL


88 
	~<›ís¶/md5.h
>

90 
	~<md5.h
>

93 #ñi‡(
deföed
(
__MAC_OS_X_VERSION_MAX_ALLOWED
) && \

94 (
	g__MAC_OS_X_VERSION_MAX_ALLOWED
 >= 1040)) || \

95 (
deföed
(
__IPHONE_OS_VERSION_MAX_ALLOWED
) && \

96 (
__IPHONE_OS_VERSION_MAX_ALLOWED
 >= 20000))

104 
	~<Comm⁄Cry±o/Comm⁄Dige°.h
>

105 
	#MD5_CTX
 
CC_MD5_CTX


	)

107 
	$MD5_Inô
(
MD5_CTX
 *
˘x
)

109 
	`CC_MD5_Inô
(
˘x
);

110 
	}
}

112 
	$MD5_Upd©e
(
MD5_CTX
 *
˘x
,

113 c⁄° *
öput
,

114 
öputLí
)

116 
	`CC_MD5_Upd©e
(
˘x
, 
öput
, 
öputLí
);

117 
	}
}

119 
	$MD5_FöÆ
(
dige°
[16], 
MD5_CTX
 *
˘x
)

121 
	`CC_MD5_FöÆ
(
dige°
, 
˘x
);

122 
	}
}

124 #ñi‡
deföed
(
_WIN32
)

126 
	~<wö¸y±.h
>

129 
HCRYPTPROV
 
	mhCry±Prov
;

130 
HCRYPTHASH
 
	mhHash
;

131 } 
	tMD5_CTX
;

133 
	$MD5_Inô
(
MD5_CTX
 *
˘x
)

135 if(
	`Cry±AcquúeC⁄ãxt
(&
˘x
->
hCry±Prov
, 
NULL
, NULL,

136 
PROV_RSA_FULL
, 
CRYPT_VERIFYCONTEXT
)) {

137 
	`Cry±Cª©eHash
(
˘x
->
hCry±Prov
, 
CALG_MD5
, 0, 0, &˘x->
hHash
);

139 
	}
}

141 
	$MD5_Upd©e
(
MD5_CTX
 *
˘x
,

142 c⁄° *
öput
,

143 
öputLí
)

145 
	`Cry±HashD©a
(
˘x
->
hHash
, (*)
öput
, 
öputLí
, 0);

146 
	}
}

148 
	$MD5_FöÆ
(
dige°
[16], 
MD5_CTX
 *
˘x
)

150 
Àngth
 = 0;

151 
	`Cry±GëHashP¨am
(
˘x
->
hHash
, 
HP_HASHVAL
, 
NULL
, &
Àngth
, 0);

152 if(
Àngth
 == 16)

153 
	`Cry±GëHashP¨am
(
˘x
->
hHash
, 
HP_HASHVAL
, 
dige°
, &
Àngth
, 0);

154 if(
˘x
->
hHash
)

155 
	`Cry±De°royHash
(
˘x
->
hHash
);

156 if(
˘x
->
hCry±Prov
)

157 
	`Cry±Rñó£C⁄ãxt
(
˘x
->
hCry±Prov
, 0);

158 
	}
}

186 
	tUINT4
;

189 
	smd5_˘x
 {

190 
UINT4
 
	m°©e
[4];

191 
UINT4
 
	mcou¡
[2];

192 
	mbuf„r
[64];

195 
md5_˘x
 
	tMD5_CTX
;

197 
MD5_Inô
(
md5_˘x
 *);

198 
MD5_Upd©e
(
md5_˘x
 *, const *, );

199 
MD5_FöÆ
([16], 
md5_˘x
 *);

204 
	#S11
 7

	)

205 
	#S12
 12

	)

206 
	#S13
 17

	)

207 
	#S14
 22

	)

208 
	#S21
 5

	)

209 
	#S22
 9

	)

210 
	#S23
 14

	)

211 
	#S24
 20

	)

212 
	#S31
 4

	)

213 
	#S32
 11

	)

214 
	#S33
 16

	)

215 
	#S34
 23

	)

216 
	#S41
 6

	)

217 
	#S42
 10

	)

218 
	#S43
 15

	)

219 
	#S44
 21

	)

221 
MD5Tønsf‹m
(
UINT4
 [4], const [64]);

222 
Encode
(*, 
UINT4
 *, );

223 
Decode
(
UINT4
 *, const *, );

225 c⁄° 
	gPADDING
[64] = {

233 
	#F
(
x
, 
y
, 
z
Ë(((xË& (y)Ë| ((~xË& (z)))

	)

234 
	#G
(
x
, 
y
, 
z
Ë(((xË& (z)Ë| ((yË& (~z)))

	)

235 
	#H
(
x
, 
y
, 
z
Ë((xË^ (yË^ (z))

	)

236 
	#I
(
x
, 
y
, 
z
Ë((yË^ ((xË| (~z)))

	)

240 
	#ROTATE_LEFT
(
x
, 
n
Ë(((xË<< (n)Ë| ((xË>> (32-“))))

	)

245 
	#FF
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
) { \

246 (
a
Ë+
	`F
 ((
b
), (
c
), (
d
)Ë+ (
x
Ë+ (
UINT4
)(
ac
); \

247 (
a
Ë
	`ROTATE_LEFT
 (◊), (
s
)); \

248 (
a
Ë+(
b
); \

249 }

	)

250 
	#GG
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
) { \

251 (
a
Ë+
	`G
 ((
b
), (
c
), (
d
)Ë+ (
x
Ë+ (
UINT4
)(
ac
); \

252 (
a
Ë
	`ROTATE_LEFT
 (◊), (
s
)); \

253 (
a
Ë+(
b
); \

254 }

	)

255 
	#HH
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
) { \

256 (
a
Ë+
	`H
 ((
b
), (
c
), (
d
)Ë+ (
x
Ë+ (
UINT4
)(
ac
); \

257 (
a
Ë
	`ROTATE_LEFT
 (◊), (
s
)); \

258 (
a
Ë+(
b
); \

259 }

	)

260 
	#II
(
a
, 
b
, 
c
, 
d
, 
x
, 
s
, 
ac
) { \

261 (
a
Ë+
	`I
 ((
b
), (
c
), (
d
)Ë+ (
x
Ë+ (
UINT4
)(
ac
); \

262 (
a
Ë
	`ROTATE_LEFT
 (◊), (
s
)); \

263 (
a
Ë+(
b
); \

264 }

	)

268 
	$MD5_Inô
(
md5_˘x
 *
c⁄ãxt
)

270 
c⁄ãxt
->
cou¡
[0] = context->count[1] = 0;

272 
c⁄ãxt
->
°©e
[0] = 0x67452301;

273 
c⁄ãxt
->
°©e
[1] = 0xefcdab89;

274 
c⁄ãxt
->
°©e
[2] = 0x98badcfe;

275 
c⁄ãxt
->
°©e
[3] = 0x10325476;

276 
	}
}

282 
	$MD5_Upd©e
 (
md5_˘x
 *
c⁄ãxt
,

283 c⁄° *
öput
,

284 
öputLí
)

286 
i
, 
bufödex
, 
∑πLí
;

289 
bufödex
 = ()((
c⁄ãxt
->
cou¡
[0] >> 3) & 0x3F);

292 if((
c⁄ãxt
->
cou¡
[0] +((
UINT4
)
öputLí
 << 3))

293 < ((
UINT4
)
öputLí
 << 3))

294 
c⁄ãxt
->
cou¡
[1]++;

295 
c⁄ãxt
->
cou¡
[1] +((
UINT4
)
öputLí
 >> 29);

297 
∑πLí
 = 64 - 
bufödex
;

300 if(
öputLí
 >
∑πLí
) {

301 
	`mem˝y
(&
c⁄ãxt
->
buf„r
[
bufödex
], 
öput
, 
∑πLí
);

302 
	`MD5Tønsf‹m
(
c⁄ãxt
->
°©e
, c⁄ãxt->
buf„r
);

304 
i
 = 
∑πLí
; i + 63 < 
öputLí
; i += 64)

305 
	`MD5Tønsf‹m
(
c⁄ãxt
->
°©e
, &
öput
[
i
]);

307 
bufödex
 = 0;

310 
i
 = 0;

313 
	`mem˝y
(&
c⁄ãxt
->
buf„r
[
bufödex
], &
öput
[
i
], 
öputLí
-i);

314 
	}
}

319 
	$MD5_FöÆ
(
dige°
[16],

320 
md5_˘x
 *
c⁄ãxt
)

322 
bôs
[8];

323 
cou¡
, 
∑dLí
;

326 
	`Encode
 (
bôs
, 
c⁄ãxt
->
cou¡
, 8);

329 
cou¡
 = ()((
c⁄ãxt
->count[0] >> 3) & 0x3f);

330 
∑dLí
 = (
cou¡
 < 56) ? (56 - count) : (120 - count);

331 
	`MD5_Upd©e
 (
c⁄ãxt
, 
PADDING
, 
∑dLí
);

334 
	`MD5_Upd©e
 (
c⁄ãxt
, 
bôs
, 8);

337 
	`Encode
 (
dige°
, 
c⁄ãxt
->
°©e
, 16);

340 
	`mem£t
 ((*)
c⁄ãxt
, 0,  (*context));

341 
	}
}

344 
	$MD5Tønsf‹m
(
UINT4
 
°©e
[4],

345 c⁄° 
block
[64])

347 
UINT4
 
a
 = 
°©e
[0], 
b
 = sèã[1], 
c
 = sèã[2], 
d
 = sèã[3], 
x
[16];

349 
	`Decode
 (
x
, 
block
, 64);

352 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 0], 
S11
, 0xd76aa478);

353 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 1], 
S12
, 0xe8c7b756);

354 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[ 2], 
S13
, 0x242070db);

355 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[ 3], 
S14
, 0xc1bdceee);

356 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 4], 
S11
, 0xf57c0faf);

357 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 5], 
S12
, 0x4787c62a);

358 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[ 6], 
S13
, 0xa8304613);

359 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[ 7], 
S14
, 0xfd469501);

360 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[ 8], 
S11
, 0x698098d8);

361 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[ 9], 
S12
, 0x8b44f7af);

362 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[10], 
S13
, 0xffff5bb1);

363 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[11], 
S14
, 0x895cd7be);

364 
	`FF
 (
a
, 
b
, 
c
, 
d
, 
x
[12], 
S11
, 0x6b901122);

365 
	`FF
 (
d
, 
a
, 
b
, 
c
, 
x
[13], 
S12
, 0xfd987193);

366 
	`FF
 (
c
, 
d
, 
a
, 
b
, 
x
[14], 
S13
, 0xa679438e);

367 
	`FF
 (
b
, 
c
, 
d
, 
a
, 
x
[15], 
S14
, 0x49b40821);

370 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 1], 
S21
, 0xf61e2562);

371 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[ 6], 
S22
, 0xc040b340);

372 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[11], 
S23
, 0x265e5a51);

373 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[ 0], 
S24
, 0xe9b6c7aa);

374 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 5], 
S21
, 0xd62f105d);

375 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[10], 
S22
, 0x2441453);

376 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[15], 
S23
, 0xd8a1e681);

377 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[ 4], 
S24
, 0xe7d3fbc8);

378 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[ 9], 
S21
, 0x21e1cde6);

379 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[14], 
S22
, 0xc33707d6);

380 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[ 3], 
S23
, 0xf4d50d87);

381 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[ 8], 
S24
, 0x455a14ed);

382 
	`GG
 (
a
, 
b
, 
c
, 
d
, 
x
[13], 
S21
, 0xa9e3e905);

383 
	`GG
 (
d
, 
a
, 
b
, 
c
, 
x
[ 2], 
S22
, 0xfcefa3f8);

384 
	`GG
 (
c
, 
d
, 
a
, 
b
, 
x
[ 7], 
S23
, 0x676f02d9);

385 
	`GG
 (
b
, 
c
, 
d
, 
a
, 
x
[12], 
S24
, 0x8d2a4c8a);

388 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 5], 
S31
, 0xfffa3942);

389 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 8], 
S32
, 0x8771f681);

390 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[11], 
S33
, 0x6d9d6122);

391 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[14], 
S34
, 0xfde5380c);

392 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 1], 
S31
, 0xa4beea44);

393 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 4], 
S32
, 0x4bdecfa9);

394 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[ 7], 
S33
, 0xf6bb4b60);

395 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[10], 
S34
, 0xbebfbc70);

396 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[13], 
S31
, 0x289b7ec6);

397 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[ 0], 
S32
, 0xeaa127fa);

398 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[ 3], 
S33
, 0xd4ef3085);

399 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[ 6], 
S34
, 0x4881d05);

400 
	`HH
 (
a
, 
b
, 
c
, 
d
, 
x
[ 9], 
S31
, 0xd9d4d039);

401 
	`HH
 (
d
, 
a
, 
b
, 
c
, 
x
[12], 
S32
, 0xe6db99e5);

402 
	`HH
 (
c
, 
d
, 
a
, 
b
, 
x
[15], 
S33
, 0x1fa27cf8);

403 
	`HH
 (
b
, 
c
, 
d
, 
a
, 
x
[ 2], 
S34
, 0xc4ac5665);

406 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[ 0], 
S41
, 0xf4292244);

407 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[ 7], 
S42
, 0x432aff97);

408 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[14], 
S43
, 0xab9423a7);

409 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[ 5], 
S44
, 0xfc93a039);

410 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[12], 
S41
, 0x655b59c3);

411 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[ 3], 
S42
, 0x8f0ccc92);

412 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[10], 
S43
, 0xffeff47d);

413 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[ 1], 
S44
, 0x85845dd1);

414 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[ 8], 
S41
, 0x6fa87e4f);

415 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[15], 
S42
, 0xfe2ce6e0);

416 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[ 6], 
S43
, 0xa3014314);

417 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[13], 
S44
, 0x4e0811a1);

418 
	`II
 (
a
, 
b
, 
c
, 
d
, 
x
[ 4], 
S41
, 0xf7537e82);

419 
	`II
 (
d
, 
a
, 
b
, 
c
, 
x
[11], 
S42
, 0xbd3af235);

420 
	`II
 (
c
, 
d
, 
a
, 
b
, 
x
[ 2], 
S43
, 0x2ad7d2bb);

421 
	`II
 (
b
, 
c
, 
d
, 
a
, 
x
[ 9], 
S44
, 0xeb86d391);

423 
°©e
[0] +
a
;

424 
°©e
[1] +
b
;

425 
°©e
[2] +
c
;

426 
°©e
[3] +
d
;

429 
	`mem£t
((*)
x
, 0,  (x));

430 
	}
}

435 
	$Encode
 (*
ouçut
,

436 
UINT4
 *
öput
,

437 
Àn
)

439 
i
, 
j
;

441 
i
 = 0, 
j
 = 0; j < 
Àn
; i++, j += 4) {

442 
ouçut
[
j
] = ()(
öput
[
i
] & 0xff);

443 
ouçut
[
j
+1] = ()((
öput
[
i
] >> 8) & 0xff);

444 
ouçut
[
j
+2] = ()((
öput
[
i
] >> 16) & 0xff);

445 
ouçut
[
j
+3] = ()((
öput
[
i
] >> 24) & 0xff);

447 
	}
}

452 
	$Decode
 (
UINT4
 *
ouçut
,

453 c⁄° *
öput
,

454 
Àn
)

456 
i
, 
j
;

458 
i
 = 0, 
j
 = 0; j < 
Àn
; i++, j += 4)

459 
ouçut
[
i
] = ((
UINT4
)
öput
[
j
]) | (((UINT4)input[j+1]) << 8) |

460 (((
UINT4
)
öput
[
j
+2]) << 16) | (((UINT4)input[j+3]) << 24);

461 
	}
}

466 
	~"memdebug.h
"

468 c⁄° 
HMAC_∑øms
 
	gCuæ_HMAC_MD5
[] = {

470 (
HMAC_höô_func
Ë
MD5_Inô
,

471 (
HMAC_hupd©e_func
Ë
MD5_Upd©e
,

472 (
HMAC_hföÆ_func
Ë
MD5_FöÆ
,

473 (
MD5_CTX
),

479 c⁄° 
MD5_∑øms
 
	gCuæ_DIGEST_MD5
[] = {

481 (
Cuæ_MD5_öô_func
Ë
MD5_Inô
,

482 (
Cuæ_MD5_upd©e_func
Ë
MD5_Upd©e
,

483 (
Cuæ_MD5_föÆ_func
Ë
MD5_FöÆ
,

484 (
MD5_CTX
),

489 
	$Cuæ_md5ô
(*
outbuf„r
,

490 c⁄° *
öput
)

492 
MD5_CTX
 
˘x
;

493 
	`MD5_Inô
(&
˘x
);

494 
	`MD5_Upd©e
(&
˘x
, 
öput
, 
	`cuæx_uztoui
(
	`°æí
((*)input)));

495 
	`MD5_FöÆ
(
outbuf„r
, &
˘x
);

496 
	}
}

498 
MD5_c⁄ãxt
 *
	$Cuæ_MD5_öô
(c⁄° 
MD5_∑øms
 *
md5∑øms
)

500 
MD5_c⁄ãxt
 *
˘xt
;

503 
˘xt
 = 
	`mÆloc
( *ctxt);

505 if(!
˘xt
)

506  
˘xt
;

508 
˘xt
->
md5_hash˘x
 = 
	`mÆloc
(
md5∑øms
->
md5_˘xtsize
);

510 if(!
˘xt
->
md5_hash˘x
) {

511 
	`‰ì
(
˘xt
);

512  
NULL
;

515 
˘xt
->
md5_hash
 = 
md5∑øms
;

517 (*
md5∑øms
->
md5_öô_func
)(
˘xt
->
md5_hash˘x
);

519  
˘xt
;

520 
	}
}

522 
	$Cuæ_MD5_upd©e
(
MD5_c⁄ãxt
 *
c⁄ãxt
,

523 c⁄° *
d©a
,

524 
Àn
)

526 (*
c⁄ãxt
->
md5_hash
->
md5_upd©e_func
)(c⁄ãxt->
md5_hash˘x
, 
d©a
, 
Àn
);

529 
	}
}

531 
	$Cuæ_MD5_föÆ
(
MD5_c⁄ãxt
 *
c⁄ãxt
, *
ªsu…
)

533 (*
c⁄ãxt
->
md5_hash
->
md5_föÆ_func
)(
ªsu…
, c⁄ãxt->
md5_hash˘x
);

535 
	`‰ì
(
c⁄ãxt
->
md5_hash˘x
);

536 
	`‰ì
(
c⁄ãxt
);

539 
	}
}

	@lib/memdebug.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
CURLDEBUG


27 
	~<cuæ/cuæ.h
>

29 
	#_MPRINTF_REPLACE


	)

30 
	~<cuæ/m¥ötf.h
>

31 
	~"uæd©a.h
"

33 
	#MEMDEBUG_NODEFINES


	)

34 
	~"cuæ_mem‹y.h
"

35 
	~"memdebug.h
"

37 #i‚de‡
HAVE_ASSERT_H


38 
	#as£π
(
x
Ë
Cuæ_n›_°mt


	)

57 #ifde‡
CURL_MT_MALLOC_FILL


58 #i‡(
CURL_MT_MALLOC_FILL
 < 0) || (CURL_MT_MALLOC_FILL > 0xff)

63 #ifde‡
CURL_MT_FREE_FILL


64 #i‡(
CURL_MT_FREE_FILL
 < 0) || (CURL_MT_FREE_FILL > 0xff)

69 #i‡
deföed
(
CURL_MT_MALLOC_FILL
Ë&& deföed(
CURL_MT_FREE_FILL
)

70 #i‡(
CURL_MT_MALLOC_FILL
 =
CURL_MT_FREE_FILL
)

75 #ifde‡
CURL_MT_MALLOC_FILL


76 
	#mt_mÆloc_fûl
(
buf
,
Àn
Ë
	`mem£t
((buf), 
CURL_MT_MALLOC_FILL
, (Àn))

	)

78 
	#mt_mÆloc_fûl
(
buf
,
Àn
Ë
Cuæ_n›_°mt


	)

81 #ifde‡
CURL_MT_FREE_FILL


82 
	#mt_‰ì_fûl
(
buf
,
Àn
Ë
	`mem£t
((buf), 
CURL_MT_FREE_FILL
, (Àn))

	)

84 
	#mt_‰ì_fûl
(
buf
,
Àn
Ë
Cuæ_n›_°mt


	)

87 
	smemdebug
 {

88 
size_t
 
	msize
;

90 
cuæ_off_t
 
	mo
;

91 
	md
;

92 * 
	mp
;

93 } 
	mmem
[1];

106 
	#logfûe
 
cuæ_debuglogfûe


	)

107 
FILE
 *
	gcuæ_debuglogfûe
 = 
NULL
;

108 
boﬁ
 
	gmemlimô
 = 
FALSE
;

109 
	gmemsize
 = 0;

112 
	$cuæ_memdebug
(c⁄° *
log«me
)

114 if(!
logfûe
) {

115 if(
log«me
 && *logname)

116 
logfûe
 = 
	`f›í
(
log«me
, "w");

118 
logfûe
 = 
°dîr
;

119 #ifde‡
MEMDEBUG_LOG_SYNC


121 
	`£tvbuf
(
logfûe
, (*)
NULL
, 
_IOLBF
, 0);

124 
	}
}

128 
	$cuæ_memlimô
(
limô
)

130 if(!
memlimô
) {

131 
memlimô
 = 
TRUE
;

132 
memsize
 = 
limô
;

134 
	}
}

137 
boﬁ
 
	$cou¡check
(c⁄° *
func
, 
löe
, c⁄° *
sour˚
)

141 if(
memlimô
 && 
sour˚
) {

142 if(!
memsize
) {

143 if(
sour˚
) {

145 
	`cuæ_memlog
("LIMIT %s:%d %sÑeached memlimit\n",

146 
sour˚
, 
löe
, 
func
);

148 
	`Ârötf
(
°dîr
, "LIMIT %s:%d %sÑeached memlimit\n",

149 
sour˚
, 
löe
, 
func
);

151 
	`SET_ERRNO
(
ENOMEM
);

152  
TRUE
;

155 
memsize
--;

158 if(
sour˚
)

159 
	`cuæ_memlog
("LIMIT %s:%d %ld ALLOCSÜeft\n",

160 
sour˚
, 
löe
, 
memsize
);

164  
FALSE
;

165 
	}
}

167 *
	$cuæ_domÆloc
(
size_t
 
w™ãdsize
, 
löe
, c⁄° *
sour˚
)

169 
memdebug
 *
mem
;

170 
size_t
 
size
;

172 
	`as£π
(
w™ãdsize
 != 0);

174 if(
	`cou¡check
("mÆloc", 
löe
, 
sour˚
))

175  
NULL
;

178 
size
 = (
memdebug
)+
w™ãdsize
;

180 
mem
 = (
Cuæ_cmÆloc
)(
size
);

181 if(
mem
) {

183 
	`mt_mÆloc_fûl
(
mem
->mem, 
w™ãdsize
);

184 
mem
->
size
 = 
w™ãdsize
;

187 if(
sour˚
)

188 
	`cuæ_memlog
("MEM %s:%d malloc(%zu) = %p\n",

189 
sour˚
, 
löe
, 
w™ãdsize
,

190 
mem
 ? (*)mem->mem : (*)0);

192  (
mem
 ? mem->mem : 
NULL
);

193 
	}
}

195 *
	$cuæ_doˇŒoc
(
size_t
 
w™ãd_ñemíts
, size_à
w™ãd_size
,

196 
löe
, c⁄° *
sour˚
)

198 
memdebug
 *
mem
;

199 
size_t
 
size
, 
u£r_size
;

201 
	`as£π
(
w™ãd_ñemíts
 != 0);

202 
	`as£π
(
w™ãd_size
 != 0);

204 if(
	`cou¡check
("ˇŒoc", 
löe
, 
sour˚
))

205  
NULL
;

208 
u£r_size
 = 
w™ãd_size
 * 
w™ãd_ñemíts
;

209 
size
 = (
memdebug
Ë+ 
u£r_size
;

211 
mem
 = (
Cuæ_cˇŒoc
)(1, 
size
);

212 if(
mem
)

213 
mem
->
size
 = 
u£r_size
;

215 if(
sour˚
)

216 
	`cuæ_memlog
("MEM %s:%d calloc(%zu,%zu) = %p\n",

217 
sour˚
, 
löe
, 
w™ãd_ñemíts
, 
w™ãd_size
,

218 
mem
 ? (*)mem->mem : (*)0);

220  (
mem
 ? mem->mem : 
NULL
);

221 
	}
}

223 *
	$cuæ_do°rdup
(c⁄° *
°r
, 
löe
, c⁄° *
sour˚
)

225 *
mem
;

226 
size_t
 
Àn
;

228 
	`as£π
(
°r
 !
NULL
);

230 if(
	`cou¡check
("°rdup", 
löe
, 
sour˚
))

231  
NULL
;

233 
Àn
=
	`°æí
(
°r
)+1;

235 
mem
=
	`cuæ_domÆloc
(
Àn
, 0, 
NULL
);

236 if(
mem
)

237 
	`mem˝y
(
mem
, 
°r
, 
Àn
);

239 if(
sour˚
)

240 
	`cuæ_memlog
("MEM %s:%d strdup(%p) (%zu) = %p\n",

241 
sour˚
, 
löe
, (*)
°r
, 
Àn
, (*)
mem
);

243  
mem
;

244 
	}
}

246 #i‡
deföed
(
WIN32
Ë&& deföed(
UNICODE
)

247 
wch¨_t
 *
	$cuæ_dowcsdup
(c⁄° 
wch¨_t
 *
°r
, 
löe
, c⁄° *
sour˚
)

249 
wch¨_t
 *
mem
;

250 
size_t
 
wsiz
, 
bsiz
;

252 
	`as£π
(
°r
 !
NULL
);

254 if(
	`cou¡check
("wcsdup", 
löe
, 
sour˚
))

255  
NULL
;

257 
wsiz
 = 
	`wc¶í
(
°r
) + 1;

258 
bsiz
 = 
wsiz
 * (
wch¨_t
);

260 
mem
 = 
	`cuæ_domÆloc
(
bsiz
, 0, 
NULL
);

261 if(
mem
)

262 
	`mem˝y
(
mem
, 
°r
, 
bsiz
);

264 if(
sour˚
)

265 
	`cuæ_memlog
("MEM %s:%d wcsdup(%p) (%zu) = %p\n",

266 
sour˚
, 
löe
, (*)
°r
, 
bsiz
, (*)
mem
);

268  
mem
;

269 
	}
}

274 *
	$cuæ_d‹óŒoc
(*
±r
, 
size_t
 
w™ãdsize
,

275 
löe
, c⁄° *
sour˚
)

277 
memdebug
 *
mem
=
NULL
;

279 
size_t
 
size
 = (
memdebug
)+
w™ãdsize
;

281 
	`as£π
(
w™ãdsize
 != 0);

283 if(
	`cou¡check
("ªÆloc", 
löe
, 
sour˚
))

284  
NULL
;

286 #ifde‡
__INTEL_COMPILER


287 #¥agm®
	`w¨nög
(
push
)

288 #¥agm®
	`w¨nög
(
dißbÀ
:1684)

292 if(
±r
)

293 
mem
 = (*)((*)
±r
 - 
	`off£tof
(
memdebug
, mem));

295 #ifde‡
__INTEL_COMPILER


296 #¥agm®
	`w¨nög
(
p›
)

299 
mem
 = (
Cuæ_¸óŒoc
)(mem, 
size
);

300 if(
sour˚
)

301 
	`cuæ_memlog
("MEM %s:%dÑealloc(%p, %zu) = %p\n",

302 
sour˚
, 
löe
, (*)
±r
, 
w™ãdsize
,

303 
mem
 ? (*)mem->mem : (*)0);

305 if(
mem
) {

306 
mem
->
size
 = 
w™ãdsize
;

307  
mem
->mem;

310  
NULL
;

311 
	}
}

313 
	$cuæ_do‰ì
(*
±r
, 
löe
, c⁄° *
sour˚
)

315 
memdebug
 *
mem
;

317 if(
±r
) {

319 #ifde‡
__INTEL_COMPILER


320 #¥agm®
	`w¨nög
(
push
)

321 #¥agm®
	`w¨nög
(
dißbÀ
:1684)

325 
mem
 = (*)((*)
±r
 - 
	`off£tof
(
memdebug
, mem));

327 #ifde‡
__INTEL_COMPILER


328 #¥agm®
	`w¨nög
(
p›
)

332 
	`mt_‰ì_fûl
(
mem
->mem, mem->
size
);

335 (
Cuæ_c‰ì
)(
mem
);

338 if(
sour˚
)

339 
	`cuæ_memlog
("MEM %s:%d fªe(%p)\n", 
sour˚
, 
löe
, (*)
±r
);

340 
	}
}

342 
cuæ_sockë_t
 
	$cuæ_sockë
(
domaö
, 
ty≥
, 
¥Ÿocﬁ
,

343 
löe
, c⁄° *
sour˚
)

345 c⁄° *
fmt
 = ((
cuæ_sockë_t
) == ()) ?

347 ((
cuæ_sockë_t
) == ()) ?

351 
cuæ_sockë_t
 
sockfd
 = 
	`sockë
(
domaö
, 
ty≥
, 
¥Ÿocﬁ
);

353 if(
sour˚
 && (
sockfd
 !
CURL_SOCKET_BAD
))

354 
	`cuæ_memlog
(
fmt
, 
sour˚
, 
löe
, 
sockfd
);

356  
sockfd
;

357 
	}
}

359 #ifde‡
HAVE_SOCKETPAIR


360 
	$cuæ_sockë∑ú
(
domaö
, 
ty≥
, 
¥Ÿocﬁ
,

361 
cuæ_sockë_t
 
sockë_ve˘‹
[2],

362 
löe
, c⁄° *
sour˚
)

364 c⁄° *
fmt
 = ((
cuæ_sockë_t
) == ()) ?

366 ((
cuæ_sockë_t
) == ()) ?

370 
ªs
 = 
	`sockë∑ú
(
domaö
, 
ty≥
, 
¥Ÿocﬁ
, 
sockë_ve˘‹
);

372 if(
sour˚
 && (0 =
ªs
))

373 
	`cuæ_memlog
(
fmt
, 
sour˚
, 
löe
, 
sockë_ve˘‹
[0], socket_vector[1]);

375  
ªs
;

376 
	}
}

379 
cuæ_sockë_t
 
	$cuæ_ac˚±
(
cuæ_sockë_t
 
s
, *
ßddr
, *
ßddæí
,

380 
löe
, c⁄° *
sour˚
)

382 c⁄° *
fmt
 = ((
cuæ_sockë_t
) == ()) ?

384 ((
cuæ_sockë_t
) == ()) ?

388 
sockaddr
 *
addr
 = (sockadd∏*)
ßddr
;

389 
cuæ_sockÀn_t
 *
addæí
 = (cuæ_sockÀn_à*)
ßddæí
;

391 
cuæ_sockë_t
 
sockfd
 = 
	`ac˚±
(
s
, 
addr
, 
addæí
);

393 if(
sour˚
 && (
sockfd
 !
CURL_SOCKET_BAD
))

394 
	`cuæ_memlog
(
fmt
, 
sour˚
, 
löe
, 
sockfd
);

396  
sockfd
;

397 
	}
}

400 
	$cuæ_m¨k_s˛o£
(
cuæ_sockë_t
 
sockfd
, 
löe
, c⁄° *
sour˚
)

402 c⁄° *
fmt
 = ((
cuæ_sockë_t
) == ()) ?

404 ((
cuæ_sockë_t
) == ()) ?

408 if(
sour˚
)

409 
	`cuæ_memlog
(
fmt
, 
sour˚
, 
löe
, 
sockfd
);

410 
	}
}

413 
	$cuæ_s˛o£
(
cuæ_sockë_t
 
sockfd
, 
löe
, c⁄° *
sour˚
)

415 
ªs
=
	`s˛o£
(
sockfd
);

416 
	`cuæ_m¨k_s˛o£
(
sockfd
, 
löe
, 
sour˚
);

417  
ªs
;

418 
	}
}

420 
FILE
 *
	$cuæ_f›í
(c⁄° *
fûe
, c⁄° *
mode
,

421 
löe
, c⁄° *
sour˚
)

423 
FILE
 *
ªs
=
	`f›í
(
fûe
, 
mode
);

425 if(
sour˚
)

426 
	`cuæ_memlog
("FILE %s:%d fopen(\"%s\",\"%s\") = %p\n",

427 
sour˚
, 
löe
, 
fûe
, 
mode
, (*)
ªs
);

429  
ªs
;

430 
	}
}

432 #ifde‡
HAVE_FDOPEN


433 
FILE
 *
	$cuæ_fd›í
(
fûedes
, c⁄° *
mode
,

434 
löe
, c⁄° *
sour˚
)

436 
FILE
 *
ªs
=
	`fd›í
(
fûedes
, 
mode
);

438 if(
sour˚
)

439 
	`cuæ_memlog
("FILE %s:%d fdopen(\"%d\",\"%s\") = %p\n",

440 
sour˚
, 
löe
, 
fûedes
, 
mode
, (*)
ªs
);

442  
ªs
;

443 
	}
}

446 
	$cuæ_f˛o£
(
FILE
 *
fûe
, 
löe
, c⁄° *
sour˚
)

448 
ªs
;

450 
	`as£π
(
fûe
 !
NULL
);

452 
ªs
=
	`f˛o£
(
fûe
);

454 if(
sour˚
)

455 
	`cuæ_memlog
("FILE %s:%d fclose(%p)\n",

456 
sour˚
, 
löe
, (*)
fûe
);

458  
ªs
;

459 
	}
}

461 
	#LOGLINE_BUFSIZE
 1024

	)

464 
	$cuæ_memlog
(c⁄° *
f‹m©
, ...)

466 *
buf
;

467 
nch¨s
;

468 
va_li°
 
≠
;

470 if(!
logfûe
)

473 
buf
 = (
Cuæ_cmÆloc
)(
LOGLINE_BUFSIZE
);

474 if(!
buf
)

477 
	`va_°¨t
(
≠
, 
f‹m©
);

478 
nch¨s
 = 
	`v¢¥ötf
(
buf
, 
LOGLINE_BUFSIZE
, 
f‹m©
, 
≠
);

479 
	`va_íd
(
≠
);

481 if(
nch¨s
 > 
LOGLINE_BUFSIZE
 - 1)

482 
nch¨s
 = 
LOGLINE_BUFSIZE
 - 1;

484 if(
nch¨s
 > 0)

485 
	`fwrôe
(
buf
, 1, 
nch¨s
, 
logfûe
);

487 (
Cuæ_c‰ì
)(
buf
);

488 
	}
}

	@lib/memdebug.h

1 #i‚de‡
HEADER_CURL_MEMDEBUG_H


2 
	#HEADER_CURL_MEMDEBUG_H


	)

3 #ifde‡
CURLDEBUG


31 
	~"cuæ_£tup.h
"

33 
	~<cuæ/cuæ.h
>

35 
	#CURL_MT_LOGFNAME_BUFSIZE
 512

	)

37 
	#logfûe
 
cuæ_debuglogfûe


	)

39 
FILE
 *
logfûe
;

42 
CURL_EXTERN
 *
cuæ_domÆloc
(
size_t
 
size
, 
löe
, c⁄° *
sour˚
);

43 
CURL_EXTERN
 *
cuæ_doˇŒoc
(
size_t
 
ñemíts
, size_à
size
, 
löe
,

44 c⁄° *
sour˚
);

45 
CURL_EXTERN
 *
cuæ_d‹óŒoc
(*
±r
, 
size_t
 
size
, 
löe
,

46 c⁄° *
sour˚
);

47 
CURL_EXTERN
 
cuæ_do‰ì
(*
±r
, 
löe
, c⁄° *
sour˚
);

48 
CURL_EXTERN
 *
cuæ_do°rdup
(c⁄° *
°r
, 
löe
, c⁄° *
sour˚
);

49 #i‡
deföed
(
WIN32
Ë&& deföed(
UNICODE
)

50 
CURL_EXTERN
 
wch¨_t
 *
cuæ_dowcsdup
(c⁄° wch¨_à*
°r
, 
löe
,

51 c⁄° *
sour˚
);

54 
CURL_EXTERN
 
cuæ_memdebug
(c⁄° *
log«me
);

55 
CURL_EXTERN
 
cuæ_memlimô
(
limô
);

56 
CURL_EXTERN
 
cuæ_memlog
(c⁄° *
f‹m©
, ...);

59 
CURL_EXTERN
 
cuæ_sockë_t
 
cuæ_sockë
(
domaö
, 
ty≥
, 
¥Ÿocﬁ
,

60 
löe
 , c⁄° *
sour˚
);

61 
CURL_EXTERN
 
cuæ_m¨k_s˛o£
(
cuæ_sockë_t
 
sockfd
,

62 
löe
 , c⁄° *
sour˚
);

63 
CURL_EXTERN
 
cuæ_s˛o£
(
cuæ_sockë_t
 
sockfd
,

64 
löe
 , c⁄° *
sour˚
);

65 
CURL_EXTERN
 
cuæ_sockë_t
 
cuæ_ac˚±
(cuæ_sockë_à
s
, *
a
, *
Æí
,

66 
löe
, c⁄° *
sour˚
);

67 #ifde‡
HAVE_SOCKETPAIR


68 
CURL_EXTERN
 
cuæ_sockë∑ú
(
domaö
, 
ty≥
, 
¥Ÿocﬁ
,

69 
cuæ_sockë_t
 
sockë_ve˘‹
[2],

70 
löe
 , c⁄° *
sour˚
);

74 
CURL_EXTERN
 
FILE
 *
cuæ_f›í
(c⁄° *
fûe
, c⁄° *
mode
, 
löe
,

75 c⁄° *
sour˚
);

76 #ifde‡
HAVE_FDOPEN


77 
CURL_EXTERN
 
FILE
 *
cuæ_fd›í
(
fûedes
, c⁄° *
mode
, 
löe
,

78 c⁄° *
sour˚
);

80 
CURL_EXTERN
 
cuæ_f˛o£
(
FILE
 *
fûe
, 
löe
, c⁄° *
sour˚
);

82 #i‚de‡
MEMDEBUG_NODEFINES


85 #unde‡
°rdup


86 
	#°rdup
(
±r
Ë
	`cuæ_do°rdup
’å, 
__LINE__
, 
__FILE__
)

	)

87 
	#mÆloc
(
size
Ë
	`cuæ_domÆloc
(size, 
__LINE__
, 
__FILE__
)

	)

88 
	#ˇŒoc
(
nbñem
,
size
Ë
	`cuæ_doˇŒoc
“bñem, size, 
__LINE__
, 
__FILE__
)

	)

89 
	#ªÆloc
(
±r
,
size
Ë
	`cuæ_d‹óŒoc
’å, size, 
__LINE__
, 
__FILE__
)

	)

90 
	#‰ì
(
±r
Ë
	`cuæ_do‰ì
’å, 
__LINE__
, 
__FILE__
)

	)

92 #ifde‡
WIN32


93 #ifde‡
UNICODE


94 #unde‡
wcsdup


95 
	#wcsdup
(
±r
Ë
	`cuæ_dowcsdup
’å, 
__LINE__
, 
__FILE__
)

	)

96 #unde‡
_wcsdup


97 
	#_wcsdup
(
±r
Ë
	`cuæ_dowcsdup
’å, 
__LINE__
, 
__FILE__
)

	)

98 #unde‡
_tcsdup


99 
	#_tcsdup
(
±r
Ë
	`cuæ_dowcsdup
’å, 
__LINE__
, 
__FILE__
)

	)

101 #unde‡
_tcsdup


102 
	#_tcsdup
(
±r
Ë
	`cuæ_do°rdup
’å, 
__LINE__
, 
__FILE__
)

	)

106 
	#sockë
(
domaö
,
ty≥
,
¥Ÿocﬁ
)\

107 
	`cuæ_sockë
(
domaö
,
ty≥
,
¥Ÿocﬁ
,
__LINE__
,
__FILE__
)

	)

108 #unde‡
ac˚±


109 
	#ac˚±
(
sock
,
addr
,
Àn
)\

110 
	`cuæ_ac˚±
(
sock
,
addr
,
Àn
,
__LINE__
,
__FILE__
)

	)

111 #ifde‡
HAVE_SOCKETPAIR


112 
	#sockë∑ú
(
domaö
,
ty≥
,
¥Ÿocﬁ
,
sockë_ve˘‹
)\

113 
	`cuæ_sockë∑ú
(
domaö
,
ty≥
,
¥Ÿocﬁ
,
sockë_ve˘‹
,
__LINE__
,
__FILE__
)

	)

116 #ifde‡
HAVE_GETADDRINFO


117 #i‡
deföed
(
gëaddröfo
Ë&& deföed(
__osf__
)

121 
	#ogëaddröfo
(
ho°
,
£rv
,
höt
,
ªs
) \

122 
	`cuæ_dogëaddröfo
(
ho°
,
£rv
,
höt
,
ªs
,
__LINE__
,
__FILE__
)

	)

124 #unde‡
gëaddröfo


125 
	#gëaddröfo
(
ho°
,
£rv
,
höt
,
ªs
) \

126 
	`cuæ_dogëaddröfo
(
ho°
,
£rv
,
höt
,
ªs
,
__LINE__
,
__FILE__
)

	)

130 #ifde‡
HAVE_GETNAMEINFO


131 #unde‡
gë«meöfo


132 
	#gë«meöfo
(
ß
,
ßÀn
,
ho°
,
ho°Àn
,
£rv
,
£rvÀn
,
Êags
) \

133 
	`cuæ_dogë«meöfo
(
ß
,
ßÀn
,
ho°
,
ho°Àn
,
£rv
,
£rvÀn
,
Êags
, 
__LINE__
, \

134 
__FILE__
)

	)

137 #ifde‡
HAVE_FREEADDRINFO


138 #unde‡
‰ìaddröfo


139 
	#‰ìaddröfo
(
d©a
) \

140 
	`cuæ_do‰ìaddröfo
(
d©a
,
__LINE__
,
__FILE__
)

	)

144 #unde‡
s˛o£


145 
	#s˛o£
(
sockfd
Ë
	`cuæ_s˛o£
(sockfd,
__LINE__
,
__FILE__
)

	)

147 
	#Áke_s˛o£
(
sockfd
Ë
	`cuæ_m¨k_s˛o£
(sockfd,
__LINE__
,
__FILE__
)

	)

149 #unde‡
f›í


150 
	#f›í
(
fûe
,
mode
Ë
	`cuæ_f›í
(fûe,mode,
__LINE__
,
__FILE__
)

	)

151 #unde‡
fd›í


152 
	#fd›í
(
fûe
,
mode
Ë
	`cuæ_fd›í
(fûe,mode,
__LINE__
,
__FILE__
)

	)

153 
	#f˛o£
(
fûe
Ë
	`cuæ_f˛o£
(fûe,
__LINE__
,
__FILE__
)

	)

163 #i‚de‡
Áke_s˛o£


164 
	#Áke_s˛o£
(
x
Ë
Cuæ_n›_°mt


	)

173 
	#Cuæ_ß„‰ì
(
±r
) \

174 dÿ{if((
±r
)Ë{
	`‰ì
(’å)); (±rË
NULL
;}} 
WHILE_FALSE


	)

	@lib/mprintf.c

38 
	~"cuæ_£tup.h
"

40 #i‡
deföed
(
DJGPP
Ë&& (
DJGPP_MINOR
 < 4)

41 #unde‡
_MPRINTF_REPLACE


44 
	~<cuæ/m¥ötf.h
>

46 
	~"cuæ_mem‹y.h
"

48 
	~"memdebug.h
"

50 #i‚de‡
SIZEOF_LONG_DOUBLE


51 
	#SIZEOF_LONG_DOUBLE
 0

	)

58 #i‚de‡
SIZEOF_SIZE_T


59 
	#SIZEOF_SIZE_T
 
CURL_SIZEOF_LONG


	)

62 #ifde‡
HAVE_LONGLONG


63 
	#LONG_LONG_TYPE
 

	)

64 
	#HAVE_LONG_LONG_TYPE


	)

66 #i‡
deföed
(
_MSC_VER
Ë&& (_MSC_VER >900Ë&& (
_INTEGRAL_MAX_BITS
 >= 64)

67 
	#LONG_LONG_TYPE
 
__öt64


	)

68 
	#HAVE_LONG_LONG_TYPE


	)

70 #unde‡
LONG_LONG_TYPE


71 #unde‡
HAVE_LONG_LONG_TYPE


79 #i‡(
deföed
(
__BORLANDC__
) && (__BORLANDC__ >= 0x520)) || \

80 (
deföed
(
__WATCOMC__
Ë&& deföed(
__386__
)) || \

81 (
deföed
(
__POCC__
Ë&& deföed(
_MSC_VER
)) || \

82 (
deföed
(
_WIN32_WCE
)) || \

83 (
deföed
(
__MINGW32__
)) || \

84 (
deföed
(
_MSC_VER
Ë&& (
	g_MSC_VER
 >900Ë&& (
_INTEGRAL_MAX_BITS
 >= 64))

85 
	#MP_HAVE_INT_EXTENSIONS


	)

92 #ifde‡
HAVE_LONG_LONG_TYPE


93 
	#mp_ötmax_t
 
LONG_LONG_TYPE


	)

94 
	#mp_uötmax_t
 
LONG_LONG_TYPE


	)

96 
	#mp_ötmax_t
 

	)

97 
	#mp_uötmax_t
 

	)

100 
	#BUFFSIZE
 256

	)

101 
	#MAX_PARAMETERS
 128

	)

103 #ifde‡
__AMIGA__


104 #unde‡
FORMAT_INT


108 c⁄° 
lowî_digôs
[] = "0123456789abcdefghijklmnopqrstuvwxyz";

111 c⁄° 
	guµî_digôs
[] = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";

113 
	#OUTCHAR
(
x
) \

115 if(
	`°ªam
(()(
x
), (
FILE
 *)
d©a
) != -1) \

116 
d⁄e
++; \

118  
d⁄e
; \

119 } 
WHILE_FALSE


	)

123 
	mFORMAT_UNKNOWN
 = 0,

124 
	mFORMAT_STRING
,

125 
	mFORMAT_PTR
,

126 
	mFORMAT_INT
,

127 
	mFORMAT_INTPTR
,

128 
	mFORMAT_LONG
,

129 
	mFORMAT_LONGLONG
,

130 
	mFORMAT_DOUBLE
,

131 
	mFORMAT_LONGDOUBLE
,

132 
	mFORMAT_WIDTH


133 } 
	tF‹m©Ty≥
;

137 
	mFLAGS_NEW
 = 0,

138 
	mFLAGS_SPACE
 = 1<<0,

139 
	mFLAGS_SHOWSIGN
 = 1<<1,

140 
	mFLAGS_LEFT
 = 1<<2,

141 
	mFLAGS_ALT
 = 1<<3,

142 
	mFLAGS_SHORT
 = 1<<4,

143 
	mFLAGS_LONG
 = 1<<5,

144 
	mFLAGS_LONGLONG
 = 1<<6,

145 
	mFLAGS_LONGDOUBLE
 = 1<<7,

146 
	mFLAGS_PAD_NIL
 = 1<<8,

147 
	mFLAGS_UNSIGNED
 = 1<<9,

148 
	mFLAGS_OCTAL
 = 1<<10,

149 
	mFLAGS_HEX
 = 1<<11,

150 
	mFLAGS_UPPER
 = 1<<12,

151 
	mFLAGS_WIDTH
 = 1<<13,

152 
	mFLAGS_WIDTHPARAM
 = 1<<14,

153 
	mFLAGS_PREC
 = 1<<15,

154 
	mFLAGS_PRECPARAM
 = 1<<16,

155 
	mFLAGS_CHAR
 = 1<<17,

156 
	mFLAGS_FLOATE
 = 1<<18,

157 
	mFLAGS_FLOATG
 = 1<<19

161 
F‹m©Ty≥
 
	mty≥
;

162 
	mÊags
;

163 
	mwidth
;

164 
	m¥ecisi⁄
;

166 *
	m°r
;

167 *
	m±r
;

169 
mp_ötmax_t
 
	mas_sig√d
;

170 
mp_uötmax_t
 
	mas_unsig√d
;

171 } 
	mnum
;

172 
	mdnum
;

173 } 
	md©a
;

174 } 
	tva_°ack_t
;

176 
	sn•rötf
 {

177 *
	mbuf„r
;

178 
size_t
 
	mÀngth
;

179 
size_t
 
	mmax
;

182 
	sa•rötf
 {

183 *
	mbuf„r
;

184 
size_t
 
	mÀn
;

185 
size_t
 
	mÆloc
;

186 
	mÁû
;

190 
	$d¥ötf_DﬁœrSåög
(*
öput
, **
íd
)

192 
numbî
=0;

193 
	`ISDIGIT
(*
öput
)) {

194 
numbî
 *= 10;

195 
numbî
 +*
öput
-'0';

196 
öput
++;

198 if(
numbî
 && ('$'==*
öput
++)) {

199 *
íd
 = 
öput
;

200  
numbî
;

203 
	}
}

205 
boﬁ
 
	$d¥ötf_IsQuÆifõrNoDﬁœr
(c⁄° *
fmt
)

207 #i‡
	`deföed
(
MP_HAVE_INT_EXTENSIONS
)

208 if(!
	`°∫cmp
(
fmt
, "I32", 3) || !strncmp(fmt, "I64", 3)) {

209  
TRUE
;

213 *
fmt
) {

219 #i‡
	`deföed
(
MP_HAVE_INT_EXTENSIONS
)

222  
TRUE
;

225  
FALSE
;

227 
	}
}

237 
	$d¥ötf_Pass1
(c⁄° *
f‹m©
, 
va_°ack_t
 *
vto
, **
ídpos
,

238 
va_li°
 
¨gli°
)

240 *
fmt
 = (*)
f‹m©
;

241 
∑øm_num
 = 0;

242 
this_∑øm
;

243 
width
;

244 
¥ecisi⁄
;

245 
Êags
;

246 
max_∑øm
=0;

247 
i
;

249 *
fmt
) {

250 if(*
fmt
++ == '%') {

251 if(*
fmt
 == '%') {

252 
fmt
++;

256 
Êags
 = 
FLAGS_NEW
;

260 
∑øm_num
++;

262 
this_∑øm
 = 
	`d¥ötf_DﬁœrSåög
(
fmt
, &fmt);

263 if(0 =
this_∑øm
)

265 
this_∑øm
 = 
∑øm_num
;

267 if(
this_∑øm
 > 
max_∑øm
)

268 
max_∑øm
 = 
this_∑øm
;

276 
width
 = 0;

277 
¥ecisi⁄
 = 0;

281 
	`d¥ötf_IsQuÆifõrNoDﬁœr
(
fmt
)) {

282 #i‡
	`deföed
(
MP_HAVE_INT_EXTENSIONS
)

283 if(!
	`°∫cmp
(
fmt
, "I32", 3)) {

284 
Êags
 |
FLAGS_LONG
;

285 
fmt
 += 3;

287 if(!
	`°∫cmp
(
fmt
, "I64", 3)) {

288 
Êags
 |
FLAGS_LONGLONG
;

289 
fmt
 += 3;

294 *
fmt
++) {

296 
Êags
 |
FLAGS_SPACE
;

299 
Êags
 |
FLAGS_SHOWSIGN
;

302 
Êags
 |
FLAGS_LEFT
;

303 
Êags
 &~
FLAGS_PAD_NIL
;

306 
Êags
 |
FLAGS_ALT
;

309 
Êags
 |
FLAGS_PREC
;

310 if('*' =*
fmt
) {

313 
Êags
 |
FLAGS_PRECPARAM
;

314 
fmt
++;

315 
∑øm_num
++;

317 
i
 = 
	`d¥ötf_DﬁœrSåög
(
fmt
, &fmt);

318 if(
i
)

319 
¥ecisi⁄
 = 
i
;

321 
¥ecisi⁄
 = 
∑øm_num
;

323 if(
¥ecisi⁄
 > 
max_∑øm
)

324 
max_∑øm
 = 
¥ecisi⁄
;

327 
Êags
 |
FLAGS_PREC
;

328 
¥ecisi⁄
 = 
	`°πﬁ
(
fmt
, &fmt, 10);

332 
Êags
 |
FLAGS_SHORT
;

334 #i‡
	`deföed
(
MP_HAVE_INT_EXTENSIONS
)

336 #i‡(
CURL_SIZEOF_CURL_OFF_T
 > 
CURL_SIZEOF_LONG
)

337 
Êags
 |
FLAGS_LONGLONG
;

339 
Êags
 |
FLAGS_LONG
;

344 if(
Êags
 & 
FLAGS_LONG
)

345 
Êags
 |
FLAGS_LONGLONG
;

347 
Êags
 |
FLAGS_LONG
;

350 
Êags
 |
FLAGS_LONGDOUBLE
;

353 
Êags
 |
FLAGS_LONGLONG
;

358 #i‡(
SIZEOF_SIZE_T
 > 
CURL_SIZEOF_LONG
)

359 
Êags
 |
FLAGS_LONGLONG
;

361 
Êags
 |
FLAGS_LONG
;

365 #i‡(
CURL_SIZEOF_CURL_OFF_T
 > 
CURL_SIZEOF_LONG
)

366 
Êags
 |
FLAGS_LONGLONG
;

368 
Êags
 |
FLAGS_LONG
;

372 if(!(
Êags
 & 
FLAGS_LEFT
))

373 
Êags
 |
FLAGS_PAD_NIL
;

377 
Êags
 |
FLAGS_WIDTH
;

378 
width
 = 
	`°πﬁ
(
fmt
-1, &fmt, 10);

381 
Êags
 |
FLAGS_WIDTHPARAM
;

382 
∑øm_num
++;

384 
i
 = 
	`d¥ötf_DﬁœrSåög
(
fmt
, &fmt);

385 if(
i
)

386 
width
 = 
i
;

388 
width
 = 
∑øm_num
;

389 if(
width
 > 
max_∑øm
)

390 
max_∑øm
=
width
;

399 
i
 = 
this_∑øm
 - 1;

401 *
fmt
) {

403 
Êags
 |
FLAGS_ALT
;

406 
vto
[
i
].
ty≥
 = 
FORMAT_STRING
;

409 
vto
[
i
].
ty≥
 = 
FORMAT_INTPTR
;

412 
vto
[
i
].
ty≥
 = 
FORMAT_PTR
;

415 
vto
[
i
].
ty≥
 = 
FORMAT_INT
;

418 
vto
[
i
].
ty≥
 = 
FORMAT_INT
;

419 
Êags
 |
FLAGS_UNSIGNED
;

422 
vto
[
i
].
ty≥
 = 
FORMAT_INT
;

423 
Êags
 |
FLAGS_OCTAL
;

426 
vto
[
i
].
ty≥
 = 
FORMAT_INT
;

427 
Êags
 |
FLAGS_HEX
|
FLAGS_UNSIGNED
;

430 
vto
[
i
].
ty≥
 = 
FORMAT_INT
;

431 
Êags
 |
FLAGS_HEX
|
FLAGS_UPPER
|
FLAGS_UNSIGNED
;

434 
vto
[
i
].
ty≥
 = 
FORMAT_INT
;

435 
Êags
 |
FLAGS_CHAR
;

438 
vto
[
i
].
ty≥
 = 
FORMAT_DOUBLE
;

441 
vto
[
i
].
ty≥
 = 
FORMAT_DOUBLE
;

442 
Êags
 |
FLAGS_FLOATE
;

445 
vto
[
i
].
ty≥
 = 
FORMAT_DOUBLE
;

446 
Êags
 |
FLAGS_FLOATE
|
FLAGS_UPPER
;

449 
vto
[
i
].
ty≥
 = 
FORMAT_DOUBLE
;

450 
Êags
 |
FLAGS_FLOATG
;

453 
vto
[
i
].
ty≥
 = 
FORMAT_DOUBLE
;

454 
Êags
 |
FLAGS_FLOATG
|
FLAGS_UPPER
;

457 
vto
[
i
].
ty≥
 = 
FORMAT_UNKNOWN
;

461 
vto
[
i
].
Êags
 = flags;

462 
vto
[
i
].
width
 = width;

463 
vto
[
i
].
¥ecisi⁄
 =Örecision;

465 if(
Êags
 & 
FLAGS_WIDTHPARAM
) {

468 
vto
[
i
].
width
 = width - 1;

469 
i
 = 
width
 - 1;

470 
vto
[
i
].
ty≥
 = 
FORMAT_WIDTH
;

471 
vto
[
i
].
Êags
 = 
FLAGS_NEW
;

472 
vto
[
i
].
¥ecisi⁄
 = vto[i].
width
 = 0;

475 if(
Êags
 & 
FLAGS_PRECPARAM
) {

478 
vto
[
i
].
¥ecisi⁄
 =Örecision - 1;

479 
i
 = 
¥ecisi⁄
 - 1;

480 
vto
[
i
].
ty≥
 = 
FORMAT_WIDTH
;

481 
vto
[
i
].
Êags
 = 
FLAGS_NEW
;

482 
vto
[
i
].
¥ecisi⁄
 = vto[i].
width
 = 0;

485 *
ídpos
++ = 
fmt
 + 1;

490 
i
=0; i<
max_∑øm
; i++) {

491 if((
i
 + 1 < 
max_∑øm
Ë&& (
vto
[ò+ 1].
ty≥
 =
FORMAT_WIDTH
)) {

495 
vto
[
i
 + 1].
d©a
.
num
.
as_sig√d
 = (
mp_ötmax_t
)
	`va_¨g
(
¨gli°
, );

498 
vto
[
i
].
ty≥
) {

499 
FORMAT_STRING
:

500 
vto
[
i
].
d©a
.
°r
 = 
	`va_¨g
(
¨gli°
, *);

503 
FORMAT_INTPTR
:

504 
FORMAT_UNKNOWN
:

505 
FORMAT_PTR
:

506 
vto
[
i
].
d©a
.
±r
 = 
	`va_¨g
(
¨gli°
, *);

509 
FORMAT_INT
:

510 #ifde‡
HAVE_LONG_LONG_TYPE


511 if((
vto
[
i
].
Êags
 & 
FLAGS_LONGLONG
Ë&& (vto[i].Êag†& 
FLAGS_UNSIGNED
))

512 
vto
[
i
].
d©a
.
num
.
as_unsig√d
 =

513 (
mp_uötmax_t
)
	`va_¨g
(
¨gli°
, mp_uintmax_t);

514 if(
vto
[
i
].
Êags
 & 
FLAGS_LONGLONG
)

515 
vto
[
i
].
d©a
.
num
.
as_sig√d
 =

516 (
mp_ötmax_t
)
	`va_¨g
(
¨gli°
, mp_intmax_t);

520 if((
vto
[
i
].
Êags
 & 
FLAGS_LONG
Ë&& (vto[i].Êag†& 
FLAGS_UNSIGNED
))

521 
vto
[
i
].
d©a
.
num
.
as_unsig√d
 =

522 (
mp_uötmax_t
)
	`va_¨g
(
¨gli°
, );

523 if(
vto
[
i
].
Êags
 & 
FLAGS_LONG
)

524 
vto
[
i
].
d©a
.
num
.
as_sig√d
 =

525 (
mp_ötmax_t
)
	`va_¨g
(
¨gli°
, );

526 if(
vto
[
i
].
Êags
 & 
FLAGS_UNSIGNED
)

527 
vto
[
i
].
d©a
.
num
.
as_unsig√d
 =

528 (
mp_uötmax_t
)
	`va_¨g
(
¨gli°
, );

530 
vto
[
i
].
d©a
.
num
.
as_sig√d
 =

531 (
mp_ötmax_t
)
	`va_¨g
(
¨gli°
, );

535 
FORMAT_DOUBLE
:

536 
vto
[
i
].
d©a
.
dnum
 = 
	`va_¨g
(
¨gli°
, );

539 
FORMAT_WIDTH
:

543 
vto
[
i
].
ty≥
 = 
FORMAT_INT
;

551  
max_∑øm
;

553 
	}
}

555 
d¥ötf_f‹m©f
(

556 *
d©a
,

559 (*
°ªam
)(, 
FILE
 *),

560 c⁄° *
f‹m©
,

561 
va_li°
 
≠_ßve
)

564 c⁄° *
digôs
 = 
lowî_digôs
;

567 *
f
;

570 
d⁄e
 = 0;

572 
∑øm
;

573 
∑øm_num
=0;

575 
va_°ack_t
 
vto
[
MAX_PARAMETERS
];

576 *
ídpos
[
MAX_PARAMETERS
];

577 **
íd
;

579 
w‹k
[
BUFFSIZE
];

581 
va_°ack_t
 *
p
;

584 
	`d¥ötf_Pass1
(
f‹m©
, 
vto
, 
ídpos
, 
≠_ßve
);

586 
íd
 = &
ídpos
[0];

589 
f
 = (*)
f‹m©
;

590 *
f
 != '\0') {

592 
is_Æt
;

595 
width
;

598 
¥ec
;

601 
is_√g
;

604 
ba£
;

607 
mp_uötmax_t
 
num
;

610 
mp_ötmax_t
 
sig√d_num
;

612 if(*
f
 != '%') {

616 
	`OUTCHAR
(*
f
);

617 } *++
f
 && ('%' != *f));

621 ++
f
;

627 if(*
f
 == '%') {

628 ++
f
;

629 
	`OUTCHAR
('%');

635 
∑øm
=
	`d¥ötf_DﬁœrSåög
(
f
, &f);

637 if(!
∑øm
)

638 
∑øm
 = 
∑øm_num
;

640 --
∑øm
;

642 
∑øm_num
++;

645 
p
 = &
vto
[
∑øm
];

648 if(
p
->
Êags
 & 
FLAGS_WIDTHPARAM
)

649 
width
 = ()
vto
[
p
->width].
d©a
.
num
.
as_sig√d
;

651 
width
 = 
p
->width;

654 if(
p
->
Êags
 & 
FLAGS_PRECPARAM
) {

655 
¥ec
 = ()
vto
[
p
->
¥ecisi⁄
].
d©a
.
num
.
as_sig√d
;

656 
∑øm_num
++;

659 if(
p
->
Êags
 & 
FLAGS_PREC
)

660 
¥ec
 = 
p
->
¥ecisi⁄
;

662 
¥ec
 = -1;

664 
is_Æt
 = (
p
->
Êags
 & 
FLAGS_ALT
) ? 1 : 0;

666 
p
->
ty≥
) {

667 
FORMAT_INT
:

668 
num
 = 
p
->
d©a
.num.
as_unsig√d
;

669 if(
p
->
Êags
 & 
FLAGS_CHAR
) {

671 if(!(
p
->
Êags
 & 
FLAGS_LEFT
))

672 --
width
 > 0)

673 
	`OUTCHAR
(' ');

674 
	`OUTCHAR
((Ë
num
);

675 if(
p
->
Êags
 & 
FLAGS_LEFT
)

676 --
width
 > 0)

677 
	`OUTCHAR
(' ');

680 if(
p
->
Êags
 & 
FLAGS_OCTAL
) {

682 
ba£
 = 8;

683 
unsig√d_numbî
;

685 if(
p
->
Êags
 & 
FLAGS_HEX
) {

688 
digôs
 = (
p
->
Êags
 & 
FLAGS_UPPER
)? 
uµî_digôs
 : 
lowî_digôs
;

689 
ba£
 = 16;

690 
unsig√d_numbî
;

692 if(
p
->
Êags
 & 
FLAGS_UNSIGNED
) {

694 
ba£
 = 10;

695 
unsig√d_numbî
;

699 
ba£
 = 10;

701 
is_√g
 = (
p
->
d©a
.
num
.
as_sig√d
 < (
mp_ötmax_t
)0) ? 1 : 0;

702 if(
is_√g
) {

704 
sig√d_num
 = 
p
->
d©a
.
num
.
as_sig√d
 + (
mp_ötmax_t
)1;

705 
sig√d_num
 = -signed_num;

706 
num
 = (
mp_uötmax_t
)
sig√d_num
;

707 
num
 +(
mp_uötmax_t
)1;

710 
numbî
;

712 
unsig√d_numbî
:

714 
is_√g
 = 0;

716 
numbî
:

719 *
w‹kíd
 = &
w‹k
[(work) - 1];

720 *
w
;

723 if(
¥ec
 == -1)

724 
¥ec
 = 1;

727 
w
 = 
w‹kíd
;

728 
num
 > 0) {

729 *
w
-- = 
digôs
[
num
 % 
ba£
];

730 
num
 /
ba£
;

732 
width
 -()(
w‹kíd
 - 
w
);

733 
¥ec
 -()(
w‹kíd
 - 
w
);

735 if(
is_Æt
 && 
ba£
 =8 && 
¥ec
 <= 0) {

736 *
w
-- = '0';

737 --
width
;

740 if(
¥ec
 > 0) {

741 
width
 -
¥ec
;

742 
¥ec
-- > 0)

743 *
w
-- = '0';

746 if(
is_Æt
 && 
ba£
 == 16)

747 
width
 -= 2;

749 if(
is_√g
 || (
p
->
Êags
 & 
FLAGS_SHOWSIGN
Ë|| (p->Êag†& 
FLAGS_SPACE
))

750 --
width
;

752 if(!(
p
->
Êags
 & 
FLAGS_LEFT
Ë&& !’->Êag†& 
FLAGS_PAD_NIL
))

753 
width
-- > 0)

754 
	`OUTCHAR
(' ');

756 if(
is_√g
)

757 
	`OUTCHAR
('-');

758 if(
p
->
Êags
 & 
FLAGS_SHOWSIGN
)

759 
	`OUTCHAR
('+');

760 if(
p
->
Êags
 & 
FLAGS_SPACE
)

761 
	`OUTCHAR
(' ');

763 if(
is_Æt
 && 
ba£
 == 16) {

764 
	`OUTCHAR
('0');

765 if(
p
->
Êags
 & 
FLAGS_UPPER
)

766 
	`OUTCHAR
('X');

768 
	`OUTCHAR
('x');

771 if(!(
p
->
Êags
 & 
FLAGS_LEFT
Ë&& (p->Êag†& 
FLAGS_PAD_NIL
))

772 
width
-- > 0)

773 
	`OUTCHAR
('0');

776 ++
w
 <
w‹kíd
) {

777 
	`OUTCHAR
(*
w
);

780 if(
p
->
Êags
 & 
FLAGS_LEFT
)

781 
width
-- > 0)

782 
	`OUTCHAR
(' ');

786 
FORMAT_STRING
:

789 c⁄° 
nuŒ
[] = "(nil)";

790 c⁄° *
°r
;

791 
size_t
 
Àn
;

793 
°r
 = (*Ë
p
->
d©a
.str;

794 if(
°r
 =
NULL
) {

796 if(
¥ec
 =-1 ||Öª¯>(Ë(
nuŒ
) - 1) {

797 
°r
 = 
nuŒ
;

798 
Àn
 = (
nuŒ
) - 1;

800 
p
->
Êags
 &(~
FLAGS_ALT
);

803 
°r
 = "";

804 
Àn
 = 0;

807 if(
¥ec
 != -1)

808 
Àn
 = (
size_t
)
¥ec
;

810 
Àn
 = 
	`°æí
(
°r
);

812 
width
 -()
Àn
;

814 if(
p
->
Êags
 & 
FLAGS_ALT
)

815 
	`OUTCHAR
('"');

817 if(!(
p
->
Êags
&
FLAGS_LEFT
))

818 
width
-- > 0)

819 
	`OUTCHAR
(' ');

821 (
Àn
-- > 0Ë&& *
°r
)

822 
	`OUTCHAR
(*
°r
++);

823 if(
p
->
Êags
&
FLAGS_LEFT
)

824 
width
-- > 0)

825 
	`OUTCHAR
(' ');

827 if(
p
->
Êags
 & 
FLAGS_ALT
)

828 
	`OUTCHAR
('"');

832 
FORMAT_PTR
:

835 *
±r
;

836 
±r
 = (*Ë
p
->
d©a
.ptr;

837 if(
±r
 !
NULL
) {

839 
ba£
 = 16;

840 
digôs
 = (
p
->
Êags
 & 
FLAGS_UPPER
)? 
uµî_digôs
 : 
lowî_digôs
;

841 
is_Æt
 = 1;

842 
num
 = (
size_t
Ë
±r
;

843 
is_√g
 = 0;

844 
numbî
;

848 c⁄° 
°∫û
[] = "(nil)";

849 c⁄° *
poöt
;

851 
width
 -()((
°∫û
) - 1);

852 if(
p
->
Êags
 & 
FLAGS_LEFT
)

853 
width
-- > 0)

854 
	`OUTCHAR
(' ');

855 
poöt
 = 
°∫û
; *point != '\0'; ++point)

856 
	`OUTCHAR
(*
poöt
);

857 if(! (
p
->
Êags
 & 
FLAGS_LEFT
))

858 
width
-- > 0)

859 
	`OUTCHAR
(' ');

864 
FORMAT_DOUBLE
:

866 
f‹m©buf
[32]="%";

867 *
Âå
 = &
f‹m©buf
[1];

868 
size_t
 
À·
 = (
f‹m©buf
)-
	`°æí
(formatbuf);

869 
Àn
;

871 
width
 = -1;

872 if(
p
->
Êags
 & 
FLAGS_WIDTH
)

873 
width
 = 
p
->width;

874 if(
p
->
Êags
 & 
FLAGS_WIDTHPARAM
)

875 
width
 = ()
vto
[
p
->width].
d©a
.
num
.
as_sig√d
;

877 
¥ec
 = -1;

878 if(
p
->
Êags
 & 
FLAGS_PREC
)

879 
¥ec
 = 
p
->
¥ecisi⁄
;

880 if(
p
->
Êags
 & 
FLAGS_PRECPARAM
)

881 
¥ec
 = ()
vto
[
p
->
¥ecisi⁄
].
d©a
.
num
.
as_sig√d
;

883 if(
p
->
Êags
 & 
FLAGS_LEFT
)

884 *
Âå
++ = '-';

885 if(
p
->
Êags
 & 
FLAGS_SHOWSIGN
)

886 *
Âå
++ = '+';

887 if(
p
->
Êags
 & 
FLAGS_SPACE
)

888 *
Âå
++ = ' ';

889 if(
p
->
Êags
 & 
FLAGS_ALT
)

890 *
Âå
++ = '#';

892 *
Âå
 = 0;

894 if(
width
 >= 0) {

896 
Àn
 = 
	`cuæ_m¢¥ötf
(
Âå
, 
À·
, "%ld", 
width
);

897 
Âå
 +
Àn
;

898 
À·
 -
Àn
;

900 if(
¥ec
 >= 0) {

902 
Àn
 = 
	`cuæ_m¢¥ötf
(
Âå
, 
À·
, ".%ld", 
¥ec
);

903 
Âå
 +
Àn
;

905 if(
p
->
Êags
 & 
FLAGS_LONG
)

906 *
Âå
++ = 'l';

908 if(
p
->
Êags
 & 
FLAGS_FLOATE
)

909 *
Âå
++ = ()((
p
->
Êags
 & 
FLAGS_UPPER
) ? 'E':'e');

910 if(
p
->
Êags
 & 
FLAGS_FLOATG
)

911 *
Âå
++ = ()((
p
->
Êags
 & 
FLAGS_UPPER
) ? 'G' : 'g');

913 *
Âå
++ = 'f';

915 *
Âå
 = 0;

919 (
•rötf
)(
w‹k
, 
f‹m©buf
, 
p
->
d©a
.
dnum
);

921 
Âå
=
w‹k
; *fptr; fptr++)

922 
	`OUTCHAR
(*
Âå
);

926 
FORMAT_INTPTR
:

928 #ifde‡
HAVE_LONG_LONG_TYPE


929 if(
p
->
Êags
 & 
FLAGS_LONGLONG
)

930 *(
LONG_LONG_TYPE
 *Ë
p
->
d©a
.
±r
 = (LONG_LONG_TYPE)
d⁄e
;

933 if(
p
->
Êags
 & 
FLAGS_LONG
)

934 *(*Ë
p
->
d©a
.
±r
 = ()
d⁄e
;

935 if(!(
p
->
Êags
 & 
FLAGS_SHORT
))

936 *(*Ë
p
->
d©a
.
±r
 = ()
d⁄e
;

938 *(*Ë
p
->
d©a
.
±r
 = ()
d⁄e
;

944 
f
 = *
íd
++;

947  
d⁄e
;

948 
	}
}

951 
	$addbyãr
(
ouçut
, 
FILE
 *
d©a
)

953 
n•rötf
 *
öf›
=(n•röt‡*)
d©a
;

954 
outc
 = ()
ouçut
;

956 if(
öf›
->
Àngth
 < inf›->
max
) {

958 
öf›
->
buf„r
[0] = 
outc
;

959 
öf›
->
buf„r
++;

960 
öf›
->
Àngth
++;

961  
outc
;

964 
	}
}

966 
	$cuæ_mv¢¥ötf
(*
buf„r
, 
size_t
 
maxÀngth
, c⁄° *
f‹m©
,

967 
va_li°
 
≠_ßve
)

969 
ªtcode
;

970 
n•rötf
 
öfo
;

972 
öfo
.
buf„r
 = buffer;

973 
öfo
.
Àngth
 = 0;

974 
öfo
.
max
 = 
maxÀngth
;

976 
ªtcode
 = 
	`d¥ötf_f‹m©f
(&
öfo
, 
addbyãr
, 
f‹m©
, 
≠_ßve
);

977 if(
öfo
.
max
) {

979 if(
öfo
.
max
 =öfo.
Àngth
)

981 
öfo
.
buf„r
[-1] = 0;

983 
öfo
.
buf„r
[0] = 0;

985  
ªtcode
;

986 
	}
}

988 
	$cuæ_m¢¥ötf
(*
buf„r
, 
size_t
 
maxÀngth
, c⁄° *
f‹m©
, ...)

990 
ªtcode
;

991 
va_li°
 
≠_ßve
;

992 
	`va_°¨t
(
≠_ßve
, 
f‹m©
);

993 
ªtcode
 = 
	`cuæ_mv¢¥ötf
(
buf„r
, 
maxÀngth
, 
f‹m©
, 
≠_ßve
);

994 
	`va_íd
(
≠_ßve
);

995  
ªtcode
;

996 
	}
}

999 
	$Æloc_addbyãr
(
ouçut
, 
FILE
 *
d©a
)

1001 
a•rötf
 *
öf›
=(a•röt‡*)
d©a
;

1002 
outc
 = ()
ouçut
;

1004 if(!
öf›
->
buf„r
) {

1005 
öf›
->
buf„r
 = 
	`mÆloc
(32);

1006 if(!
öf›
->
buf„r
) {

1007 
öf›
->
Áû
 = 1;

1010 
öf›
->
Æloc
 = 32;

1011 
öf›
->
Àn
 =0;

1013 if(
öf›
->
Àn
+1 >öf›->
Æloc
) {

1014 *
√w±r
;

1016 
√w±r
 = 
	`ªÆloc
(
öf›
->
buf„r
, inf›->
Æloc
*2);

1018 if(!
√w±r
) {

1019 
öf›
->
Áû
 = 1;

1022 
öf›
->
buf„r
 = 
√w±r
;

1023 
öf›
->
Æloc
 *= 2;

1026 
öf›
->
buf„r
[ inf›->
Àn
 ] = 
outc
;

1028 
öf›
->
Àn
++;

1030  
outc
;

1031 
	}
}

1033 *
	$cuæ_m≠rötf
(c⁄° *
f‹m©
, ...)

1035 
va_li°
 
≠_ßve
;

1036 
ªtcode
;

1037 
a•rötf
 
öfo
;

1039 
öfo
.
buf„r
 = 
NULL
;

1040 
öfo
.
Àn
 = 0;

1041 
öfo
.
Æloc
 = 0;

1042 
öfo
.
Áû
 = 0;

1044 
	`va_°¨t
(
≠_ßve
, 
f‹m©
);

1045 
ªtcode
 = 
	`d¥ötf_f‹m©f
(&
öfo
, 
Æloc_addbyãr
, 
f‹m©
, 
≠_ßve
);

1046 
	`va_íd
(
≠_ßve
);

1047 if((-1 =
ªtcode
Ë|| 
öfo
.
Áû
) {

1048 if(
öfo
.
Æloc
)

1049 
	`‰ì
(
öfo
.
buf„r
);

1050  
NULL
;

1052 if(
öfo
.
Æloc
) {

1053 
öfo
.
buf„r
[öfo.
Àn
] = 0;

1054  
öfo
.
buf„r
;

1057  
	`°rdup
("");

1058 
	}
}

1060 *
	$cuæ_mv≠rötf
(c⁄° *
f‹m©
, 
va_li°
 
≠_ßve
)

1062 
ªtcode
;

1063 
a•rötf
 
öfo
;

1065 
öfo
.
buf„r
 = 
NULL
;

1066 
öfo
.
Àn
 = 0;

1067 
öfo
.
Æloc
 = 0;

1068 
öfo
.
Áû
 = 0;

1070 
ªtcode
 = 
	`d¥ötf_f‹m©f
(&
öfo
, 
Æloc_addbyãr
, 
f‹m©
, 
≠_ßve
);

1071 if((-1 =
ªtcode
Ë|| 
öfo
.
Áû
) {

1072 if(
öfo
.
Æloc
)

1073 
	`‰ì
(
öfo
.
buf„r
);

1074  
NULL
;

1077 if(
öfo
.
Æloc
) {

1078 
öfo
.
buf„r
[öfo.
Àn
] = 0;

1079  
öfo
.
buf„r
;

1082  
	`°rdup
("");

1083 
	}
}

1085 
	$°‹ebuf„r
(
ouçut
, 
FILE
 *
d©a
)

1087 **
buf„r
 = (**)
d©a
;

1088 
outc
 = ()
ouçut
;

1089 **
buf„r
 = 
outc
;

1090 (*
buf„r
)++;

1091  
outc
;

1092 
	}
}

1094 
	$cuæ_m•rötf
(*
buf„r
, c⁄° *
f‹m©
, ...)

1096 
va_li°
 
≠_ßve
;

1097 
ªtcode
;

1098 
	`va_°¨t
(
≠_ßve
, 
f‹m©
);

1099 
ªtcode
 = 
	`d¥ötf_f‹m©f
(&
buf„r
, 
°‹ebuf„r
, 
f‹m©
, 
≠_ßve
);

1100 
	`va_íd
(
≠_ßve
);

1101 *
buf„r
=0;

1102  
ªtcode
;

1103 
	}
}

1105 
	$cuæ_m¥ötf
(c⁄° *
f‹m©
, ...)

1107 
ªtcode
;

1108 
va_li°
 
≠_ßve
;

1109 
	`va_°¨t
(
≠_ßve
, 
f‹m©
);

1111 
ªtcode
 = 
	`d¥ötf_f‹m©f
(
°dout
, 
Âutc
, 
f‹m©
, 
≠_ßve
);

1112 
	`va_íd
(
≠_ßve
);

1113  
ªtcode
;

1114 
	}
}

1116 
	$cuæ_mÂrötf
(
FILE
 *
whîëo
, c⁄° *
f‹m©
, ...)

1118 
ªtcode
;

1119 
va_li°
 
≠_ßve
;

1120 
	`va_°¨t
(
≠_ßve
, 
f‹m©
);

1121 
ªtcode
 = 
	`d¥ötf_f‹m©f
(
whîëo
, 
Âutc
, 
f‹m©
, 
≠_ßve
);

1122 
	`va_íd
(
≠_ßve
);

1123  
ªtcode
;

1124 
	}
}

1126 
	$cuæ_mv•rötf
(*
buf„r
, c⁄° *
f‹m©
, 
va_li°
 
≠_ßve
)

1128 
ªtcode
;

1129 
ªtcode
 = 
	`d¥ötf_f‹m©f
(&
buf„r
, 
°‹ebuf„r
, 
f‹m©
, 
≠_ßve
);

1130 *
buf„r
=0;

1131  
ªtcode
;

1132 
	}
}

1134 
	$cuæ_mv¥ötf
(c⁄° *
f‹m©
, 
va_li°
 
≠_ßve
)

1136  
	`d¥ötf_f‹m©f
(
°dout
, 
Âutc
, 
f‹m©
, 
≠_ßve
);

1137 
	}
}

1139 
	$cuæ_mvÂrötf
(
FILE
 *
whîëo
, c⁄° *
f‹m©
, 
va_li°
 
≠_ßve
)

1141  
	`d¥ötf_f‹m©f
(
whîëo
, 
Âutc
, 
f‹m©
, 
≠_ßve
);

1142 
	}
}

	@lib/multi.c

23 
	~"cuæ_£tup.h
"

25 
	~<cuæ/cuæ.h
>

27 
	~"uæd©a.h
"

28 
	~"å™s„r.h
"

29 
	~"uæ.h
"

30 
	~"c⁄√˘.h
"

31 
	~"¥ogªss.h
"

32 
	~"ósyif.h
"

33 
	~"mu…iif.h
"

34 
	~"£ndf.h
"

35 
	~"timevÆ.h
"

36 
	~"hâp.h
"

37 
	~"£À˘.h
"

38 
	~"w¨∆ess.h
"

39 
	~"•ìdcheck.h
"

40 
	~"c⁄nˇche.h
"

41 
	~"bundÀs.h
"

42 
	~"mu…ih™dÀ.h
"

43 
	~"pùñöe.h
"

44 
	~"sigpùe.h
"

46 
	#_MPRINTF_REPLACE


	)

47 
	~<cuæ/m¥ötf.h
>

49 
	~"cuæ_mem‹y.h
"

51 
	~"memdebug.h
"

58 #i‚de‡
CURL_SOCKET_HASH_TABLE_SIZE


59 
	#CURL_SOCKET_HASH_TABLE_SIZE
 911

	)

62 
	#CURL_CONNECTION_HASH_SIZE
 97

	)

64 
	#CURL_MULTI_HANDLE
 0x000bab1e

	)

66 
	#GOOD_MULTI_HANDLE
(
x
) \

67 ((
x
Ë&& (((
Cuæ_mu…i
 *)(x))->
ty≥
 =
CURL_MULTI_HANDLE
))

	)

68 
	#GOOD_EASY_HANDLE
(
x
) \

69 ((
x
Ë&& (((
Sessi⁄H™dÀ
 *)(x))->
magic
 =
CURLEASY_MAGIC_NUMBER
))

	)

71 
sögÀsockë
(
Cuæ_mu…i
 *
mu…i
,

72 
Sessi⁄H™dÀ
 *
d©a
);

73 
upd©e_timî
(
Cuæ_mu…i
 *
mu…i
);

75 
boﬁ
 
isH™dÀAtHód
(
Sessi⁄H™dÀ
 *
h™dÀ
,

76 
cuæ_Œi°
 *
pùñöe
);

77 
CURLMcode
 
add_√xt_timeout
(
timevÆ
 
now
,

78 
Cuæ_mu…i
 *
mu…i
,

79 
Sessi⁄H™dÀ
 *
d
);

80 
CURLMcode
 
mu…i_timeout
(
Cuæ_mu…i
 *
mu…i
,

81 *
timeout_ms
);

83 #ifde‡
DEBUGBUILD


84 c⁄° * c⁄° 
	g°©íame
[]={

106 
mu…i_‰ìtimeout
(*
a
, *
b
);

109 
m°©e
(
Sessi⁄H™dÀ
 *
d©a
, 
CURLM°©e
 
°©e


110 #ifde‡
DEBUGBUILD


111 , 
löío


115 #ifde‡
DEBUGBUILD


116 
	gc⁄√˘i⁄_id
 = -5000;

118 
CURLM°©e
 
	gﬁd°©e
 = 
d©a
->
m°©e
;

120 if(
	gﬁd°©e
 =
°©e
)

124 
	gd©a
->
	gm°©e
 = 
°©e
;

126 #ifde‡
DEBUGBUILD


127 if(
	gd©a
->
	gm°©e
 >
CURLM_STATE_CONNECT_PEND
 &&

128 
d©a
->
m°©e
 < 
CURLM_STATE_COMPLETED
) {

129 if(
d©a
->
ósy_c⁄n
)

130 
c⁄√˘i⁄_id
 = 
d©a
->
ósy_c⁄n
->connection_id;

132 
öfof
(
d©a
,

134 
°©íame
[
ﬁd°©e
], sèã«me[
d©a
->
m°©e
],

135 (*)
d©a
, 
löío
, 
c⁄√˘i⁄_id
);

138 if(
	g°©e
 =
CURLM_STATE_COMPLETED
)

140 
d©a
->
mu…i
->
num_Æive
--;

143 #i‚de‡
DEBUGBUILD


144 
	#mu…i°©e
(
x
,
y
Ë
	`m°©e
(x,y)

	)

146 
	#mu…i°©e
(
x
,
y
Ë
	`m°©e
(x,y, 
__LINE__
)

	)

153 
	sCuæ_sh_íåy
 {

154 
Sessi⁄H™dÀ
 *
	mósy
;

155 
time_t
 
	mtime°amp
;

156 
	ma˘i⁄
;

157 
cuæ_sockë_t
 
	msockë
;

158 *
	msockëp
;

162 
	#SH_READ
 1

	)

163 
	#SH_WRITE
 2

	)

166 
Cuæ_sh_íåy
 *
	$sh_addíåy
(
cuæ_hash
 *
sh
,

167 
cuæ_sockë_t
 
s
,

168 
Sessi⁄H™dÀ
 *
d©a
)

170 
Cuæ_sh_íåy
 *
thîe
 =

171 
	`Cuæ_hash_pick
(
sh
, (*)&
s
, (
cuæ_sockë_t
));

172 
Cuæ_sh_íåy
 *
check
;

174 if(
thîe
)

176  
thîe
;

179 
check
 = 
	`ˇŒoc
(1, (
Cuæ_sh_íåy
));

180 if(!
check
)

181  
NULL
;

182 
check
->
ósy
 = 
d©a
;

183 
check
->
sockë
 = 
s
;

186 if(
NULL
 =
	`Cuæ_hash_add
(
sh
, (*)&
s
, (
cuæ_sockë_t
), 
check
)) {

187 
	`‰ì
(
check
);

188  
NULL
;

191  
check
;

192 
	}
}

196 
	$sh_dñíåy
(
cuæ_hash
 *
sh
, 
cuæ_sockë_t
 
s
)

198 
Cuæ_sh_íåy
 *
thîe
 =

199 
	`Cuæ_hash_pick
(
sh
, (*)&
s
, (
cuæ_sockë_t
));

201 if(
thîe
) {

205 
	`Cuæ_hash_dñëe
(
sh
, (*)&
s
, (
cuæ_sockë_t
));

207 
	}
}

212 
	$sh_‰ìíåy
(*
‰ìthis
)

214 
Cuæ_sh_íåy
 *
p
 = (Cuæ_sh_íåy *Ë
‰ìthis
;

216 if(
p
)

217 
	`‰ì
(
p
);

218 
	}
}

220 
size_t
 
	$fd_key_com∑ª
(*
k1
, 
size_t
 
k1_Àn
, *
k2
, size_à
k2_Àn
)

222 (Ë
k1_Àn
; (Ë
k2_Àn
;

224  (*((*Ë
k1
)Ë=(*((*Ë
k2
));

225 
	}
}

227 
size_t
 
	$hash_fd
(*
key
, 
size_t
 
key_Àngth
, size_à
¶Ÿs_num
)

229 
fd
 = *((*Ë
key
);

230 (Ë
key_Àngth
;

232  (
fd
 % ()
¶Ÿs_num
);

233 
	}
}

253 
cuæ_hash
 *
	$sh_öô
(
hashsize
)

255  
	`Cuæ_hash_Æloc
(
hashsize
, 
hash_fd
, 
fd_key_com∑ª
,

256 
sh_‰ìíåy
);

257 
	}
}

265 
CURLMcode
 
	$mu…i_addmsg
(
Cuæ_mu…i
 *
mu…i
,

266 
Cuæ_mesßge
 *
msg
)

268 if(!
	`Cuæ_Œi°_ö£π_√xt
(
mu…i
->
msgli°
, mu…i->msgli°->
èû
, 
msg
))

269  
CURLM_OUT_OF_MEMORY
;

271  
CURLM_OK
;

272 
	}
}

279 
	$mu…i_‰ìamsg
(*
a
, *
b
)

281 ()
a
;

282 ()
b
;

283 
	}
}

285 
Cuæ_mu…i
 *
	$Cuæ_mu…i_h™dÀ
(
hashsize
,

286 
chashsize
)

288 
Cuæ_mu…i
 *
mu…i
 = 
	`ˇŒoc
(1, (Curl_multi));

290 if(!
mu…i
)

291  
NULL
;

293 
mu…i
->
ty≥
 = 
CURL_MULTI_HANDLE
;

295 
mu…i
->
ho°ˇche
 = 
	`Cuæ_mk_dnsˇche
();

296 if(!
mu…i
->
ho°ˇche
)

297 
îr‹
;

299 
mu…i
->
sockhash
 = 
	`sh_öô
(
hashsize
);

300 if(!
mu…i
->
sockhash
)

301 
îr‹
;

303 
mu…i
->
c⁄n_ˇche
 = 
	`Cuæ_c⁄nˇche_öô
(
chashsize
);

304 if(!
mu…i
->
c⁄n_ˇche
)

305 
îr‹
;

307 
mu…i
->
msgli°
 = 
	`Cuæ_Œi°_Æloc
(
mu…i_‰ìamsg
);

308 if(!
mu…i
->
msgli°
)

309 
îr‹
;

312 
mu…i
->
˛osuª_h™dÀ
 = 
	`cuæ_ósy_öô
();

313 if(!
mu…i
->
˛osuª_h™dÀ
)

314 
îr‹
;

316 
mu…i
->
˛osuª_h™dÀ
->multi = multi;

317 
mu…i
->
˛osuª_h™dÀ
->
°©e
.
c⁄n_ˇche
 = multi->conn_cache;

319 
mu…i
->
max_pùñöe_Àngth
 = 5;

322 
mu…i
->
maxc⁄√˘s
 = -1;

323  (
CURLM
 *Ë
mu…i
;

325 
îr‹
:

327 
	`Cuæ_hash_de°roy
(
mu…i
->
sockhash
);

328 
mu…i
->
sockhash
 = 
NULL
;

329 
	`Cuæ_hash_de°roy
(
mu…i
->
ho°ˇche
);

330 
mu…i
->
ho°ˇche
 = 
NULL
;

331 
	`Cuæ_c⁄nˇche_de°roy
(
mu…i
->
c⁄n_ˇche
);

332 
mu…i
->
c⁄n_ˇche
 = 
NULL
;

333 
	`Cuæ_˛o£
(
mu…i
->
˛osuª_h™dÀ
);

334 
mu…i
->
˛osuª_h™dÀ
 = 
NULL
;

335 
	`Cuæ_Œi°_de°roy
(
mu…i
->
msgli°
, 
NULL
);

337 
	`‰ì
(
mu…i
);

338  
NULL
;

339 
	}
}

341 
CURLM
 *
	$cuæ_mu…i_öô
()

343  
	`Cuæ_mu…i_h™dÀ
(
CURL_SOCKET_HASH_TABLE_SIZE
,

344 
CURL_CONNECTION_HASH_SIZE
);

345 
	}
}

347 
CURLMcode
 
	$cuæ_mu…i_add_h™dÀ
(
CURLM
 *
mu…i_h™dÀ
,

348 
CURL
 *
ósy_h™dÀ
)

350 
cuæ_Œi°
 *
timeouéi°
;

351 
Cuæ_mu…i
 *
mu…i
 = (Cuæ_mu…ò*)
mu…i_h™dÀ
;

352 
Sessi⁄H™dÀ
 *
d©a
 = (Sessi⁄H™dÀ *)
ósy_h™dÀ
;

355 if(!
	`GOOD_MULTI_HANDLE
(
mu…i
))

356  
CURLM_BAD_HANDLE
;

359 if(!
	`GOOD_EASY_HANDLE
(
ósy_h™dÀ
))

360  
CURLM_BAD_EASY_HANDLE
;

364 if(
d©a
->
mu…i
)

365  
CURLM_ADDED_ALREADY
;

368 
timeouéi°
 = 
	`Cuæ_Œi°_Æloc
(
mu…i_‰ìtimeout
);

369 if(!
timeouéi°
)

370  
CURLM_OUT_OF_MEMORY
;

380 
d©a
->
°©e
.
timeouéi°
 =Åimeoutlist;

381 
timeouéi°
 = 
NULL
;

384 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_INIT
);

386 if((
d©a
->
£t
.
globÆ_dns_ˇche
) &&

387 (
d©a
->
dns
.
ho°ˇchëy≥
 !
HCACHE_GLOBAL
)) {

389 
cuæ_hash
 *
globÆ
 = 
	`Cuæ_globÆ_ho°_ˇche_öô
();

390 if(
globÆ
) {

392 
d©a
->
dns
.
ho°ˇche
 = 
globÆ
;

393 
d©a
->
dns
.
ho°ˇchëy≥
 = 
HCACHE_GLOBAL
;

398 if(!
d©a
->
dns
.
ho°ˇche
 ||

399 (
d©a
->
dns
.
ho°ˇchëy≥
 =
HCACHE_NONE
)) {

400 
d©a
->
dns
.
ho°ˇche
 = 
mu…i
->hostcache;

401 
d©a
->
dns
.
ho°ˇchëy≥
 = 
HCACHE_MULTI
;

405 
d©a
->
°©e
.
c⁄n_ˇche
 = 
mu…i
->conn_cache;

407 
d©a
->
°©e
.
öfûesize
 = d©a->
£t
.
fûesize
;

415 
d©a
->
√xt
 = 
NULL
;

416 if(
mu…i
->
ósyp
) {

417 
Sessi⁄H™dÀ
 *
œ°
 = 
mu…i
->
ósyÕ
;

418 
œ°
->
√xt
 = 
d©a
;

419 
d©a
->
¥ev
 = 
œ°
;

420 
mu…i
->
ósyÕ
 = 
d©a
;

424 
d©a
->
√xt
 = 
NULL
;

425 
d©a
->
¥ev
 = 
NULL
;

426 
mu…i
->
ósyÕ
 = mu…i->
ósyp
 = 
d©a
;

430 
d©a
->
mu…i
 = 
mu…i_h™dÀ
;

438 
	`Cuæ_expúe
(
d©a
, 1);

441 
mu…i
->
num_ósy
++;

444 
mu…i
->
num_Æive
++;

456 
	`mem£t
(&
mu…i
->
timî_œ°ˇŒ
, 0, (multi->timer_lastcall));

458 
	`upd©e_timî
(
mu…i
);

459  
CURLM_OK
;

460 
	}
}

469 
	$debug_¥öt_sock_hash
(*
p
)

471 
Cuæ_sh_íåy
 *
sh
 = (Cuæ_sh_íåy *)
p
;

473 
	`Ârötf
(
°dîr
, " [easy %p/magic %x/socket %d]",

474 (*)
sh
->
d©a
, sh->d©a->
magic
, ()sh->
sockë
);

475 
	}
}

478 
CURLMcode
 
	$cuæ_mu…i_ªmove_h™dÀ
(
CURLM
 *
mu…i_h™dÀ
,

479 
CURL
 *
cuæ_h™dÀ
)

481 
Cuæ_mu…i
 *
mu…i
=(Cuæ_mu…ò*)
mu…i_h™dÀ
;

482 
Sessi⁄H™dÀ
 *
ósy
 = 
cuæ_h™dÀ
;

483 
Sessi⁄H™dÀ
 *
d©a
 = 
ósy
;

486 if(!
	`GOOD_MULTI_HANDLE
(
mu…i
))

487  
CURLM_BAD_HANDLE
;

490 if(!
	`GOOD_EASY_HANDLE
(
cuæ_h™dÀ
))

491  
CURLM_BAD_EASY_HANDLE
;

494 if(!
d©a
->
mu…i
)

495  
CURLM_OK
;

497 if(
ósy
) {

498 
boﬁ
 
¥em©uª
 = (
d©a
->
m°©e
 < 
CURLM_STATE_COMPLETED
Ë? 
TRUE
 : 
FALSE
;

499 
boﬁ
 
ósy_owns_c⁄n
 = (
d©a
->
ósy_c⁄n
 &&

500 (
d©a
->
ósy_c⁄n
->d©®=
ósy
)) ?

501 
TRUE
 : 
FALSE
;

505 if(
¥em©uª
)

508 
mu…i
->
num_Æive
--;

510 if(
d©a
->
ósy_c⁄n
 &&

511 (
d©a
->
ósy_c⁄n
->
£nd_pùe
->
size
 +

512 
d©a
->
ósy_c⁄n
->
ªcv_pùe
->
size
 > 1) &&

513 
d©a
->
m°©e
 > 
CURLM_STATE_WAITDO
 &&

514 
d©a
->
m°©e
 < 
CURLM_STATE_COMPLETED
) {

518 
	`c⁄n˛o£
(
d©a
->
ósy_c⁄n
, "Removed withÖartialÑesponse");

521 
d©a
->
ósy_c⁄n
->d©®
ósy
;

527 
	`Cuæ_expúe
(
d©a
, 0);

530 if(
d©a
->
°©e
.
timeouéi°
) {

531 
	`Cuæ_Œi°_de°roy
(
d©a
->
°©e
.
timeouéi°
, 
NULL
);

532 
d©a
->
°©e
.
timeouéi°
 = 
NULL
;

535 if(
d©a
->
dns
.
ho°ˇchëy≥
 =
HCACHE_MULTI
) {

537 
d©a
->
dns
.
ho°ˇche
 = 
NULL
;

538 
d©a
->
dns
.
ho°ˇchëy≥
 = 
HCACHE_NONE
;

541 if(
d©a
->
ósy_c⁄n
) {

545 if(
ósy_owns_c⁄n
) {

552 ()
	`Cuæ_d⁄e
(&
d©a
->
ósy_c⁄n
, d©a->
ªsu…
, 
¥em©uª
);

556 
	`Cuæ_gëoff_Æl_pùñöes
(
d©a
, d©a->
ósy_c⁄n
);

559 
	`Cuæ_wûdˇrd_dt‹
(&
d©a
->
wûdˇrd
);

563 
d©a
->
°©e
.
c⁄n_ˇche
 = 
NULL
;

567 
d©a
->
m°©e
 = 
CURLM_STATE_COMPLETED
;

568 
	`sögÀsockë
(
mu…i
, 
ósy
);

572 if(
d©a
->
ósy_c⁄n
) {

573 
d©a
->
ósy_c⁄n
->d©®
NULL
;

574 
d©a
->
ósy_c⁄n
 = 
NULL
;

577 
d©a
->
mu…i
 = 
NULL
;

582 
cuæ_Œi°_ñemít
 *
e
;

584 
e
 = 
mu…i
->
msgli°
->
hód
;É;É =É->
√xt
) {

585 
Cuæ_mesßge
 *
msg
 = 
e
->
±r
;

587 if(
msg
->
extmsg
.
ósy_h™dÀ
 =
ósy
) {

588 
	`Cuæ_Œi°_ªmove
(
mu…i
->
msgli°
, 
e
, 
NULL
);

596 if(
d©a
->
¥ev
)

597 
d©a
->
¥ev
->
√xt
 = data->next;

599 
mu…i
->
ósyp
 = 
d©a
->
√xt
;

602 if(
d©a
->
√xt
)

603 
d©a
->
√xt
->
¥ev
 = data->prev;

605 
mu…i
->
ósyÕ
 = 
d©a
->
¥ev
;

610 
mu…i
->
num_ósy
--;

612 
	`upd©e_timî
(
mu…i
);

613  
CURLM_OK
;

616  
CURLM_BAD_EASY_HANDLE
;

617 
	}
}

619 
boﬁ
 
	$Cuæ_mu…i_pùñöe_íabÀd
(c⁄° 
Cuæ_mu…i
 *
mu…i
)

621  (
mu…i
 && mu…i->
pùñöög_íabÀd
Ë? 
TRUE
 : 
FALSE
;

622 
	}
}

624 
	$Cuæ_mu…i_h™dÀPùeBªak
(
Sessi⁄H™dÀ
 *
d©a
)

626 
d©a
->
ósy_c⁄n
 = 
NULL
;

627 
	}
}

629 
	$waôc⁄√˘_gësock
(
c⁄√˘d©a
 *
c⁄n
,

630 
cuæ_sockë_t
 *
sock
,

631 
numsocks
)

633 
i
;

634 
s
=0;

635 
rc
=0;

637 if(!
numsocks
)

638  
GETSOCK_BLANK
;

640 
i
=0; i<2; i++) {

641 if(
c⁄n
->
ãmpsock
[
i
] !
CURL_SOCKET_BAD
) {

642 
sock
[
s
] = 
c⁄n
->
ãmpsock
[
i
];

643 
rc
 |
	`GETSOCK_WRITESOCK
(
s
++);

649 if(
c⁄n
->
tu¬ñ_°©e
[
FIRSTSOCKET
] =
TUNNEL_CONNECT
) {

650 
sock
[0] = 
c⁄n
->sock[
FIRSTSOCKET
];

651 
rc
 = 
	`GETSOCK_READSOCK
(0);

654  
rc
;

655 
	}
}

657 
	$dom‹e_gësock
(
c⁄√˘d©a
 *
c⁄n
,

658 
cuæ_sockë_t
 *
socks
,

659 
numsocks
)

661 if(
c⁄n
 && c⁄n->
h™dÀr
->
dom‹e_gësock
)

662  
c⁄n
->
h™dÀr
->
	`dom‹e_gësock
(c⁄n, 
socks
, 
numsocks
);

663  
GETSOCK_BLANK
;

664 
	}
}

667 
	$mu…i_gësock
(
Sessi⁄H™dÀ
 *
d©a
,

668 
cuæ_sockë_t
 *
socks
,

670 
numsocks
)

677 if(
d©a
->
°©e
.
pùe_broke
 || !d©a->
ósy_c⁄n
)

680 if(
d©a
->
m°©e
 > 
CURLM_STATE_CONNECT
 &&

681 
d©a
->
m°©e
 < 
CURLM_STATE_COMPLETED
) {

683 
d©a
->
ósy_c⁄n
->data = data;

686 
d©a
->
m°©e
) {

690 
CURLM_STATE_TOOFAST
:

691 
CURLM_STATE_COMPLETED
:

692 
CURLM_STATE_MSGSENT
:

693 
CURLM_STATE_INIT
:

694 
CURLM_STATE_CONNECT
:

695 
CURLM_STATE_WAITDO
:

696 
CURLM_STATE_DONE
:

697 
CURLM_STATE_LAST
:

703 
CURLM_STATE_WAITRESOLVE
:

704  
	`Cuæ_ªsﬁvî_gësock
(
d©a
->
ósy_c⁄n
, 
socks
, 
numsocks
);

706 
CURLM_STATE_PROTOCONNECT
:

707  
	`Cuæ_¥Ÿocﬁ_gësock
(
d©a
->
ósy_c⁄n
, 
socks
, 
numsocks
);

709 
CURLM_STATE_DO
:

710 
CURLM_STATE_DOING
:

711  
	`Cuæ_doög_gësock
(
d©a
->
ósy_c⁄n
, 
socks
, 
numsocks
);

713 
CURLM_STATE_WAITPROXYCONNECT
:

714 
CURLM_STATE_WAITCONNECT
:

715  
	`waôc⁄√˘_gësock
(
d©a
->
ósy_c⁄n
, 
socks
, 
numsocks
);

717 
CURLM_STATE_DO_MORE
:

718  
	`dom‹e_gësock
(
d©a
->
ósy_c⁄n
, 
socks
, 
numsocks
);

720 
CURLM_STATE_DO_DONE
:

723 
CURLM_STATE_PERFORM
:

724 
CURLM_STATE_WAITPERFORM
:

725  
	`Cuæ_sögÀ_gësock
(
d©a
->
ósy_c⁄n
, 
socks
, 
numsocks
);

728 
	}
}

730 
CURLMcode
 
	$cuæ_mu…i_fd£t
(
CURLM
 *
mu…i_h™dÀ
,

731 
fd_£t
 *
ªad_fd_£t
, fd_£à*
wrôe_fd_£t
,

732 
fd_£t
 *
exc_fd_£t
, *
max_fd
)

737 
Cuæ_mu…i
 *
mu…i
=(Cuæ_mu…ò*)
mu…i_h™dÀ
;

738 
Sessi⁄H™dÀ
 *
d©a
;

739 
this_max_fd
=-1;

740 
cuæ_sockë_t
 
sockbunch
[
MAX_SOCKSPEREASYHANDLE
];

741 
bôm≠
;

742 
i
;

743 ()
exc_fd_£t
;

745 if(!
	`GOOD_MULTI_HANDLE
(
mu…i
))

746  
CURLM_BAD_HANDLE
;

748 
d©a
=
mu…i
->
ósyp
;

749 
d©a
) {

750 
bôm≠
 = 
	`mu…i_gësock
(
d©a
, 
sockbunch
, 
MAX_SOCKSPEREASYHANDLE
);

752 
i
=0; i< 
MAX_SOCKSPEREASYHANDLE
; i++) {

753 
cuæ_sockë_t
 
s
 = 
CURL_SOCKET_BAD
;

755 if((
bôm≠
 & 
	`GETSOCK_READSOCK
(
i
)Ë&& 
	`VALID_SOCK
((
sockbunch
[i]))) {

756 
	`FD_SET
(
sockbunch
[
i
], 
ªad_fd_£t
);

757 
s
 = 
sockbunch
[
i
];

759 if((
bôm≠
 & 
	`GETSOCK_WRITESOCK
(
i
)Ë&& 
	`VALID_SOCK
((
sockbunch
[i]))) {

760 
	`FD_SET
(
sockbunch
[
i
], 
wrôe_fd_£t
);

761 
s
 = 
sockbunch
[
i
];

763 if(
s
 =
CURL_SOCKET_BAD
)

767 if(()
s
 > 
this_max_fd
)

768 
this_max_fd
 = ()
s
;

772 
d©a
 = d©a->
√xt
;

775 *
max_fd
 = 
this_max_fd
;

777  
CURLM_OK
;

778 
	}
}

780 
CURLMcode
 
	$cuæ_mu…i_waô
(
CURLM
 *
mu…i_h™dÀ
,

781 
cuæ_waôfd
 
exåa_fds
[],

782 
exåa_nfds
,

783 
timeout_ms
,

784 *
ªt
)

786 
Cuæ_mu…i
 *
mu…i
=(Cuæ_mu…ò*)
mu…i_h™dÀ
;

787 
Sessi⁄H™dÀ
 *
d©a
;

788 
cuæ_sockë_t
 
sockbunch
[
MAX_SOCKSPEREASYHANDLE
];

789 
bôm≠
;

790 
i
;

791 
nfds
 = 0;

792 
cuæfds
;

793 
pﬁlfd
 *
ufds
 = 
NULL
;

794 
timeout_öã∫Æ
;

796 if(!
	`GOOD_MULTI_HANDLE
(
mu…i
))

797  
CURLM_BAD_HANDLE
;

802 ()
	`mu…i_timeout
(
mu…i
, &
timeout_öã∫Æ
);

803 if((
timeout_öã∫Æ
 >0Ë&& (timeout_öã∫Æ < ()
timeout_ms
))

804 
timeout_ms
 = ()
timeout_öã∫Æ
;

807 
d©a
=
mu…i
->
ósyp
;

808 
d©a
) {

809 
bôm≠
 = 
	`mu…i_gësock
(
d©a
, 
sockbunch
, 
MAX_SOCKSPEREASYHANDLE
);

811 
i
=0; i< 
MAX_SOCKSPEREASYHANDLE
; i++) {

812 
cuæ_sockë_t
 
s
 = 
CURL_SOCKET_BAD
;

814 if(
bôm≠
 & 
	`GETSOCK_READSOCK
(
i
)) {

815 ++
nfds
;

816 
s
 = 
sockbunch
[
i
];

818 if(
bôm≠
 & 
	`GETSOCK_WRITESOCK
(
i
)) {

819 ++
nfds
;

820 
s
 = 
sockbunch
[
i
];

822 if(
s
 =
CURL_SOCKET_BAD
) {

827 
d©a
 = d©a->
√xt
;

830 
cuæfds
 = 
nfds
;

831 
nfds
 +
exåa_nfds
;

833 if(
nfds
 || 
exåa_nfds
) {

834 
ufds
 = 
	`mÆloc
(
nfds
 * (
pﬁlfd
));

835 if(!
ufds
)

836  
CURLM_OUT_OF_MEMORY
;

838 
nfds
 = 0;

843 if(
cuæfds
) {

845 
d©a
=
mu…i
->
ósyp
;

846 
d©a
) {

847 
bôm≠
 = 
	`mu…i_gësock
(
d©a
, 
sockbunch
, 
MAX_SOCKSPEREASYHANDLE
);

849 
i
=0; i< 
MAX_SOCKSPEREASYHANDLE
; i++) {

850 
cuæ_sockë_t
 
s
 = 
CURL_SOCKET_BAD
;

852 if(
bôm≠
 & 
	`GETSOCK_READSOCK
(
i
)) {

853 
ufds
[
nfds
].
fd
 = 
sockbunch
[
i
];

854 
ufds
[
nfds
].
evíts
 = 
POLLIN
;

855 ++
nfds
;

856 
s
 = 
sockbunch
[
i
];

858 if(
bôm≠
 & 
	`GETSOCK_WRITESOCK
(
i
)) {

859 
ufds
[
nfds
].
fd
 = 
sockbunch
[
i
];

860 
ufds
[
nfds
].
evíts
 = 
POLLOUT
;

861 ++
nfds
;

862 
s
 = 
sockbunch
[
i
];

864 if(
s
 =
CURL_SOCKET_BAD
) {

869 
d©a
 = d©a->
√xt
;

874 
i
 = 0; i < 
exåa_nfds
; i++) {

875 
ufds
[
nfds
].
fd
 = 
exåa_fds
[
i
].fd;

876 
ufds
[
nfds
].
evíts
 = 0;

877 if(
exåa_fds
[
i
].
evíts
 & 
CURL_WAIT_POLLIN
)

878 
ufds
[
nfds
].
evíts
 |
POLLIN
;

879 if(
exåa_fds
[
i
].
evíts
 & 
CURL_WAIT_POLLPRI
)

880 
ufds
[
nfds
].
evíts
 |
POLLPRI
;

881 if(
exåa_fds
[
i
].
evíts
 & 
CURL_WAIT_POLLOUT
)

882 
ufds
[
nfds
].
evíts
 |
POLLOUT
;

883 ++
nfds
;

886 if(
nfds
) {

888 
	`öfof
(
d©a
, "Cuæ_pﬁl(%d ds, %d ms)\n", 
nfds
, 
timeout_ms
);

889 
i
 = 
	`Cuæ_pﬁl
(
ufds
, 
nfds
, 
timeout_ms
);

891 if(
i
) {

892 
j
;

896 
j
 = 0; j < 
exåa_nfds
; j++) {

897 
mask
 = 0;

898 
r
 = 
ufds
[
cuæfds
 + 
j
].
ªvíts
;

900 if(
r
 & 
POLLIN
)

901 
mask
 |
CURL_WAIT_POLLIN
;

902 if(
r
 & 
POLLOUT
)

903 
mask
 |
CURL_WAIT_POLLOUT
;

904 if(
r
 & 
POLLPRI
)

905 
mask
 |
CURL_WAIT_POLLPRI
;

907 
exåa_fds
[
j
].
ªvíts
 = 
mask
;

912 
i
 = 0;

914 
	`Cuæ_ß„‰ì
(
ufds
);

915 if(
ªt
)

916 *
ªt
 = 
i
;

917  
CURLM_OK
;

918 
	}
}

920 
CURLMcode
 
	$mu…i_runsögÀ
(
Cuæ_mu…i
 *
mu…i
,

921 
timevÆ
 
now
,

922 
Sessi⁄H™dÀ
 *
d©a
)

924 
Cuæ_mesßge
 *
msg
 = 
NULL
;

925 
boﬁ
 
c⁄√˘ed
;

926 
boﬁ
 
async
;

927 
boﬁ
 
¥Ÿocﬁ_c⁄√˘
 = 
FALSE
;

928 
boﬁ
 
d›ha£_d⁄e
 = 
FALSE
;

929 
boﬁ
 
d⁄e
 = 
FALSE
;

930 
CURLMcode
 
ªsu…
 = 
CURLM_OK
;

931 
SögÀReque°
 *
k
;

932 
timeout_ms
;

933 
c⁄åﬁ
;

935 if(!
	`GOOD_EASY_HANDLE
(
d©a
))

936  
CURLM_BAD_EASY_HANDLE
;

941 
boﬁ
 
disc⁄√˘_c⁄n
 = 
FALSE
;

945 if(
d©a
->
°©e
.
pùe_broke
) {

946 
	`öfof
(
d©a
, "Pipe broke: handle 0x%p, url = %s\n",

947 (*)
d©a
, d©a->
°©e
.
∑th
);

949 if(
d©a
->
m°©e
 < 
CURLM_STATE_COMPLETED
) {

951 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_CONNECT
);

952 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

953 
d©a
->
ªsu…
 = 
CURLE_OK
;

956 
d©a
->
°©e
.
pùe_broke
 = 
FALSE
;

957 
d©a
->
ósy_c⁄n
 = 
NULL
;

961 if(!
d©a
->
ósy_c⁄n
 &&

962 
d©a
->
m°©e
 > 
CURLM_STATE_CONNECT
 &&

963 
d©a
->
m°©e
 < 
CURLM_STATE_DONE
) {

967 
	`Áûf
(
d©a
, "I¿°©ê%d wôhÇÿósy_c⁄n, baû out!\n", d©a->
m°©e
);

968  
CURLM_INTERNAL_ERROR
;

971 if(
d©a
->
ósy_c⁄n
 && d©a->
m°©e
 > 
CURLM_STATE_CONNECT
 &&

972 
d©a
->
m°©e
 < 
CURLM_STATE_COMPLETED
)

974 
d©a
->
ósy_c⁄n
->data = data;

976 if(
d©a
->
ósy_c⁄n
 &&

977 (
d©a
->
m°©e
 >
CURLM_STATE_CONNECT
) &&

978 (
d©a
->
m°©e
 < 
CURLM_STATE_COMPLETED
)) {

982 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, &
now
,

983 (
d©a
->
m°©e
 <
CURLM_STATE_WAITDO
)?

984 
TRUE
:
FALSE
);

986 if(
timeout_ms
 < 0) {

988 if(
d©a
->
m°©e
 =
CURLM_STATE_WAITRESOLVE
)

989 
	`Áûf
(
d©a
, "ResolvingÅimed outáfter %ld milliseconds",

990 
	`Cuæ_tvdiff
(
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
));

991 if(
d©a
->
m°©e
 =
CURLM_STATE_WAITCONNECT
)

992 
	`Áûf
(
d©a
, "ConnectionÅimed outáfter %ld milliseconds",

993 
	`Cuæ_tvdiff
(
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
));

995 
k
 = &
d©a
->
ªq
;

996 if(
k
->
size
 != -1) {

997 
	`Áûf
(
d©a
, "OperationÅimed outáfter %ld milliseconds with %"

998 
CURL_FORMAT_CURL_OFF_T
 " out of %"

999 
CURL_FORMAT_CURL_OFF_T
 " bytesÑeceived",

1000 
	`Cuæ_tvdiff
(
k
->
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
),

1001 
k
->
byãcou¡
, k->
size
);

1004 
	`Áûf
(
d©a
, "OperationÅimed outáfter %ld milliseconds with %"

1005 
CURL_FORMAT_CURL_OFF_T
 " bytesÑeceived",

1006 
	`Cuæ_tvdiff
(
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
),

1007 
k
->
byãcou¡
);

1014 
	`c⁄n˛o£
(
d©a
->
ósy_c⁄n
, "Disconnected withÖending data");

1015 
d©a
->
ªsu…
 = 
CURLE_OPERATION_TIMEDOUT
;

1016 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_COMPLETED
);

1021 
d©a
->
m°©e
) {

1022 
CURLM_STATE_INIT
:

1024 
d©a
->
ªsu…
=
	`Cuæ_¥ëøns„r
(data);

1026 if(
CURLE_OK
 =
d©a
->
ªsu…
) {

1028 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_CONNECT
);

1029 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_STARTOP
);

1030 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1034 
CURLM_STATE_CONNECT_PEND
:

1039 
CURLM_STATE_CONNECT
:

1041 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_STARTSINGLE
);

1042 
d©a
->
ªsu…
 = 
	`Cuæ_c⁄√˘
(d©a, &d©a->
ósy_c⁄n
,

1043 &
async
, &
¥Ÿocﬁ_c⁄√˘
);

1044 if(
CURLE_NO_CONNECTION_AVAILABLE
 =
d©a
->
ªsu…
) {

1047 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_CONNECT_PEND
);

1048 
d©a
->
ªsu…
 = 
CURLE_OK
;

1052 if(
CURLE_OK
 =
d©a
->
ªsu…
) {

1054 
d©a
->
ªsu…
 = 
	`Cuæ_add_h™dÀ_to_pùñöe
(d©a, d©a->
ósy_c⁄n
);

1055 if(
CURLE_OK
 !
d©a
->
ªsu…
)

1056 
disc⁄√˘_c⁄n
 = 
TRUE
;

1058 if(
async
)

1060 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_WAITRESOLVE
);

1065 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1067 if(
¥Ÿocﬁ_c⁄√˘
)

1068 
	`mu…i°©e
(
d©a
, 
mu…i
->
pùñöög_íabÀd
?

1069 
CURLM_STATE_WAITDO
:
CURLM_STATE_DO
);

1071 #i‚de‡
CURL_DISABLE_HTTP


1072 if(
d©a
->
ósy_c⁄n
->
tu¬ñ_°©e
[
FIRSTSOCKET
] =
TUNNEL_CONNECT
)

1073 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_WAITPROXYCONNECT
);

1076 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_WAITCONNECT
);

1083 
CURLM_STATE_WAITRESOLVE
:

1086 
Cuæ_dns_íåy
 *
dns
 = 
NULL
;

1089 
d©a
->
ªsu…
 = 
	`Cuæ_ªsﬁvî_is_ªsﬁved
(d©a->
ósy_c⁄n
, &
dns
);

1097 
	`sögÀsockë
(
mu…i
, 
d©a
);

1099 if(
dns
) {

1102 
d©a
->
ªsu…
 = 
	`Cuæ_async_ªsﬁved
(d©a->
ósy_c⁄n
,

1103 &
¥Ÿocﬁ_c⁄√˘
);

1105 if(
CURLE_OK
 !
d©a
->
ªsu…
)

1108 
d©a
->
ósy_c⁄n
 = 
NULL
;

1111 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1112 if(
¥Ÿocﬁ_c⁄√˘
)

1113 
	`mu…i°©e
(
d©a
, 
mu…i
->
pùñöög_íabÀd
?

1114 
CURLM_STATE_WAITDO
:
CURLM_STATE_DO
);

1116 #i‚de‡
CURL_DISABLE_HTTP


1117 if(
d©a
->
ósy_c⁄n
->
tu¬ñ_°©e
[
FIRSTSOCKET
] =
TUNNEL_CONNECT
)

1118 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_WAITPROXYCONNECT
);

1121 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_WAITCONNECT
);

1126 if(
CURLE_OK
 !
d©a
->
ªsu…
) {

1128 
disc⁄√˘_c⁄n
 = 
TRUE
;

1134 #i‚de‡
CURL_DISABLE_HTTP


1135 
CURLM_STATE_WAITPROXYCONNECT
:

1137 
d©a
->
ªsu…
 = 
	`Cuæ_hâp_c⁄√˘
(d©a->
ósy_c⁄n
, &
¥Ÿocﬁ_c⁄√˘
);

1139 if(
d©a
->
ósy_c⁄n
->
bôs
.
¥oxy_c⁄√˘_˛o£d
) {

1141 if(
d©a
->
£t
.
îr‹buf„r
)

1142 
d©a
->
£t
.
îr‹buf„r
[0] = '\0';

1143 
d©a
->
°©e
.
îr‹buf
 = 
FALSE
;

1145 
d©a
->
ªsu…
 = 
CURLE_OK
;

1146 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1147 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_CONNECT
);

1149 if(
CURLE_OK
 =
d©a
->
ªsu…
) {

1150 if(
d©a
->
ósy_c⁄n
->
tu¬ñ_°©e
[
FIRSTSOCKET
] =
TUNNEL_COMPLETE
)

1151 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_WAITCONNECT
);

1156 
CURLM_STATE_WAITCONNECT
:

1158 
d©a
->
ªsu…
 = 
	`Cuæ_is_c⁄√˘ed
(d©a->
ósy_c⁄n
,

1159 
FIRSTSOCKET
,

1160 &
c⁄√˘ed
);

1161 if(
c⁄√˘ed
) {

1163 if(!
d©a
->
ªsu…
)

1166 
d©a
->
ªsu…
 = 
	`Cuæ_¥Ÿocﬁ_c⁄√˘
(d©a->
ósy_c⁄n
,

1167 &
¥Ÿocﬁ_c⁄√˘
);

1170 if(
CURLE_OK
 !
d©a
->
ªsu…
) {

1173 
disc⁄√˘_c⁄n
 = 
TRUE
;

1177 if(
c⁄√˘ed
) {

1178 if(!
¥Ÿocﬁ_c⁄√˘
) {

1184 #i‚de‡
CURL_DISABLE_HTTP


1185 if(
d©a
->
ósy_c⁄n
->
tu¬ñ_°©e
[
FIRSTSOCKET
] =
TUNNEL_CONNECT
)

1186 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_WAITPROXYCONNECT
);

1189 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_PROTOCONNECT
);

1194 
	`mu…i°©e
(
d©a
, 
mu…i
->
pùñöög_íabÀd
?

1195 
CURLM_STATE_WAITDO
:
CURLM_STATE_DO
);

1197 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1201 
CURLM_STATE_PROTOCONNECT
:

1203 
d©a
->
ªsu…
 = 
	`Cuæ_¥Ÿocﬁ_c⁄√˘ög
(d©a->
ósy_c⁄n
,

1204 &
¥Ÿocﬁ_c⁄√˘
);

1205 if((
d©a
->
ªsu…
 =
CURLE_OK
Ë&& 
¥Ÿocﬁ_c⁄√˘
) {

1207 
	`mu…i°©e
(
d©a
, 
mu…i
->
pùñöög_íabÀd
?

1208 
CURLM_STATE_WAITDO
:
CURLM_STATE_DO
);

1209 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1211 if(
d©a
->
ªsu…
) {

1213 
	`Cuæ_po°å™s„r
(
d©a
);

1214 
	`Cuæ_d⁄e
(&
d©a
->
ósy_c⁄n
, d©a->
ªsu…
, 
TRUE
);

1215 
disc⁄√˘_c⁄n
 = 
TRUE
;

1219 
CURLM_STATE_WAITDO
:

1221 #ifde‡
DEBUGBUILD


1222 
	`öfof
(
d©a
, "WAITDO: Conn %ld sendÖipe %zu inuse %sáthead %s\n",

1223 
d©a
->
ósy_c⁄n
->
c⁄√˘i⁄_id
,

1224 
d©a
->
ósy_c⁄n
->
£nd_pùe
->
size
,

1225 
d©a
->
ósy_c⁄n
->
wrôech™√l_öu£
?"TRUE":"FALSE",

1226 
	`isH™dÀAtHód
(
d©a
,

1227 
d©a
->
ósy_c⁄n
->
£nd_pùe
)?"TRUE":"FALSE");

1229 if(!
d©a
->
ósy_c⁄n
->
wrôech™√l_öu£
 &&

1230 
	`isH™dÀAtHód
(
d©a
,

1231 
d©a
->
ósy_c⁄n
->
£nd_pùe
)) {

1233 
d©a
->
ósy_c⁄n
->
wrôech™√l_öu£
 = 
TRUE
;

1234 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_DO
);

1235 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1239 
CURLM_STATE_DO
:

1240 if(
d©a
->
£t
.
c⁄√˘_⁄ly
) {

1242 
	`c⁄nkìp
(
d©a
->
ósy_c⁄n
, "CONNECT_ONLY");

1243 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_DONE
);

1244 
d©a
->
ªsu…
 = 
CURLE_OK
;

1245 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1249 
d©a
->
ªsu…
 = 
	`Cuæ_do
(&d©a->
ósy_c⁄n
, &
d›ha£_d⁄e
);

1253 if(
CURLE_OK
 =
d©a
->
ªsu…
) {

1254 if(!
d›ha£_d⁄e
) {

1256 if(
d©a
->
£t
.
wûdˇrdm©ch
) {

1257 
WûdˇrdD©a
 *
wc
 = &
d©a
->
wûdˇrd
;

1258 if(
wc
->
°©e
 =
CURLWC_DONE
 || wc->°©ê=
CURLWC_SKIP
) {

1260 
	`Cuæ_d⁄e
(&
d©a
->
ósy_c⁄n
, 
CURLE_OK
, 
FALSE
);

1261 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_DONE
);

1262 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1268 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_DOING
);

1269 
ªsu…
 = 
CURLM_OK
;

1273 if(
d©a
->
ósy_c⁄n
->
bôs
.
do_m‹e
) {

1276 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_DO_MORE
);

1277 
ªsu…
 = 
CURLM_OK
;

1281 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_DO_DONE
);

1282 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1285 if((
CURLE_SEND_ERROR
 =
d©a
->
ªsu…
) &&

1286 
d©a
->
ósy_c⁄n
->
bôs
.
ªu£
) {

1292 *
√wuæ
 = 
NULL
;

1293 
fﬁlowty≥
 
fﬁlow
=
FOLLOW_NONE
;

1294 
CURLcode
 
drc
;

1295 
boﬁ
 
ªåy
 = 
FALSE
;

1297 
drc
 = 
	`Cuæ_ªåy_ªque°
(
d©a
->
ósy_c⁄n
, &
√wuæ
);

1298 if(
drc
) {

1300 
d©a
->
ªsu…
 = 
drc
;

1301 
disc⁄√˘_c⁄n
 = 
TRUE
;

1304 
ªåy
 = (
√wuæ
)?
TRUE
:
FALSE
;

1306 
	`Cuæ_po°å™s„r
(
d©a
);

1307 
drc
 = 
	`Cuæ_d⁄e
(&
d©a
->
ósy_c⁄n
, d©a->
ªsu…
, 
FALSE
);

1311 if(
ªåy
) {

1312 if((
drc
 =
CURLE_OK
Ë|| (dr¯=
CURLE_SEND_ERROR
)) {

1313 
fﬁlow
 = 
FOLLOW_RETRY
;

1314 
drc
 = 
	`Cuæ_fﬁlow
(
d©a
, 
√wuæ
, 
fﬁlow
);

1315 if(
drc
 =
CURLE_OK
) {

1316 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_CONNECT
);

1317 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1318 
d©a
->
ªsu…
 = 
CURLE_OK
;

1322 
d©a
->
ªsu…
 = 
drc
;

1323 
	`‰ì
(
√wuæ
);

1328 
d©a
->
ªsu…
 = 
drc
;

1329 
	`‰ì
(
√wuæ
);

1334 
disc⁄√˘_c⁄n
 = 
TRUE
;

1339 
	`Cuæ_po°å™s„r
(
d©a
);

1340 if(
d©a
->
ósy_c⁄n
)

1341 
	`Cuæ_d⁄e
(&
d©a
->
ósy_c⁄n
, d©a->
ªsu…
, 
FALSE
);

1342 
disc⁄√˘_c⁄n
 = 
TRUE
;

1347 
CURLM_STATE_DOING
:

1349 
d©a
->
ªsu…
 = 
	`Cuæ_¥Ÿocﬁ_doög
(d©a->
ósy_c⁄n
,

1350 &
d›ha£_d⁄e
);

1351 if(
CURLE_OK
 =
d©a
->
ªsu…
) {

1352 if(
d›ha£_d⁄e
) {

1354 
	`mu…i°©e
(
d©a
, d©a->
ósy_c⁄n
->
bôs
.
do_m‹e
?

1355 
CURLM_STATE_DO_MORE
:

1356 
CURLM_STATE_DO_DONE
);

1357 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1362 
	`Cuæ_po°å™s„r
(
d©a
);

1363 
	`Cuæ_d⁄e
(&
d©a
->
ósy_c⁄n
, d©a->
ªsu…
, 
FALSE
);

1364 
disc⁄√˘_c⁄n
 = 
TRUE
;

1368 
CURLM_STATE_DO_MORE
:

1372 
d©a
->
ªsu…
 = 
	`Cuæ_do_m‹e
(d©a->
ósy_c⁄n
, &
c⁄åﬁ
);

1376 if(
CURLE_OK
 =
d©a
->
ªsu…
) {

1377 if(
c⁄åﬁ
) {

1380 
	`mu…i°©e
(
d©a
, 
c⁄åﬁ
==1?

1381 
CURLM_STATE_DO_DONE
:

1382 
CURLM_STATE_DOING
);

1383 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1387 
ªsu…
 = 
CURLM_OK
;

1391 
	`Cuæ_po°å™s„r
(
d©a
);

1392 
	`Cuæ_d⁄e
(&
d©a
->
ósy_c⁄n
, d©a->
ªsu…
, 
FALSE
);

1393 
disc⁄√˘_c⁄n
 = 
TRUE
;

1397 
CURLM_STATE_DO_DONE
:

1399 
	`Cuæ_move_h™dÀ_‰om_£nd_to_ªcv_pùe
(
d©a
, d©a->
ósy_c⁄n
);

1401 
	`Cuæ_mu…i_¥o˚ss_≥ndög_h™dÀs
(
mu…i
);

1405 if((
d©a
->
ósy_c⁄n
->
sockfd
 !
CURL_SOCKET_BAD
) ||

1406 (
d©a
->
ósy_c⁄n
->
wrôesockfd
 !
CURL_SOCKET_BAD
))

1407 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_WAITPERFORM
);

1409 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_DONE
);

1410 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1413 
CURLM_STATE_WAITPERFORM
:

1415 if(!
d©a
->
ósy_c⁄n
->
ªadch™√l_öu£
 &&

1416 
	`isH™dÀAtHód
(
d©a
,

1417 
d©a
->
ósy_c⁄n
->
ªcv_pùe
)) {

1419 
d©a
->
ósy_c⁄n
->
ªadch™√l_öu£
 = 
TRUE
;

1420 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_PERFORM
);

1421 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1423 #ifde‡
DEBUGBUILD


1425 
	`öfof
(
d©a
, "WAITPERFORM: Conn %ldÑecvÖipe %zu inuse %sáthead %s\n",

1426 
d©a
->
ósy_c⁄n
->
c⁄√˘i⁄_id
,

1427 
d©a
->
ósy_c⁄n
->
ªcv_pùe
->
size
,

1428 
d©a
->
ósy_c⁄n
->
ªadch™√l_öu£
?"TRUE":"FALSE",

1429 
	`isH™dÀAtHód
(
d©a
,

1430 
d©a
->
ósy_c⁄n
->
ªcv_pùe
)?"TRUE":"FALSE");

1435 
CURLM_STATE_TOOFAST
:

1437 if(
	`Cuæ_pgrsUpd©e
(
d©a
->
ósy_c⁄n
))

1438 
d©a
->
ªsu…
 = 
CURLE_ABORTED_BY_CALLBACK
;

1440 
d©a
->
ªsu…
 = 
	`Cuæ_•ìdcheck
(d©a, 
now
);

1442 if(–(
d©a
->
£t
.
max_£nd_•ìd
 == 0) ||

1443 (
d©a
->
¥ogªss
.
ul•ìd
 < d©a->
£t
.
max_£nd_•ìd
 )) &&

1444 –(
d©a
->
£t
.
max_ªcv_•ìd
 == 0) ||

1445 (
d©a
->
¥ogªss
.
dl•ìd
 < d©a->
£t
.
max_ªcv_•ìd
)))

1446 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_PERFORM
);

1449 
CURLM_STATE_PERFORM
:

1451 *
√wuæ
 = 
NULL
;

1452 
boﬁ
 
ªåy
 = 
FALSE
;

1455 if((
d©a
->
£t
.
max_£nd_•ìd
 > 0) &&

1456 (
d©a
->
¥ogªss
.
ul•ìd
 > d©a->
£t
.
max_£nd_•ìd
)) {

1457 
buf„rsize
;

1459 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_TOOFAST
);

1462 
buf„rsize
 = ()(
d©a
->
£t
.
buf„r_size
 ?

1463 
d©a
->
£t
.
buf„r_size
 : 
BUFSIZE
);

1464 
timeout_ms
 = 
	`Cuæ_¶ìp_time
(
d©a
->
£t
.
max_£nd_•ìd
,

1465 
d©a
->
¥ogªss
.
ul•ìd
, 
buf„rsize
);

1466 
	`Cuæ_expúe
(
d©a
, 
timeout_ms
);

1471 if((
d©a
->
£t
.
max_ªcv_•ìd
 > 0) &&

1472 (
d©a
->
¥ogªss
.
dl•ìd
 > d©a->
£t
.
max_ªcv_•ìd
)) {

1473 
buf„rsize
;

1475 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_TOOFAST
);

1478 
buf„rsize
 = ()(
d©a
->
£t
.
buf„r_size
 ?

1479 
d©a
->
£t
.
buf„r_size
 : 
BUFSIZE
);

1480 
timeout_ms
 = 
	`Cuæ_¶ìp_time
(
d©a
->
£t
.
max_ªcv_•ìd
,

1481 
d©a
->
¥ogªss
.
dl•ìd
, 
buf„rsize
);

1482 
	`Cuæ_expúe
(
d©a
, 
timeout_ms
);

1487 
d©a
->
ªsu…
 = 
	`Cuæ_ªadwrôe
(d©a->
ósy_c⁄n
, &
d⁄e
);

1489 
k
 = &
d©a
->
ªq
;

1491 if(!(
k
->
kìp⁄
 & 
KEEP_RECV
)) {

1493 
d©a
->
ósy_c⁄n
->
ªadch™√l_öu£
 = 
FALSE
;

1496 if(!(
k
->
kìp⁄
 & 
KEEP_SEND
)) {

1498 
d©a
->
ósy_c⁄n
->
wrôech™√l_öu£
 = 
FALSE
;

1501 if(
d⁄e
 || (
d©a
->
ªsu…
 =
CURLE_RECV_ERROR
)) {

1506 
CURLcode
 
ªt
 = 
	`Cuæ_ªåy_ªque°
(
d©a
->
ósy_c⁄n
, &
√wuæ
);

1507 if(!
ªt
)

1508 
ªåy
 = (
√wuæ
)?
TRUE
:
FALSE
;

1510 if(
ªåy
) {

1513 
d©a
->
ªsu…
 = 
CURLE_OK
;

1514 
d⁄e
 = 
TRUE
;

1518 if(
d©a
->
ªsu…
) {

1527 if(!(
d©a
->
ósy_c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_DUAL
))

1528 
	`c⁄n˛o£
(
d©a
->
ósy_c⁄n
, "TransferÑeturnedÉrror");

1530 
	`Cuæ_po°å™s„r
(
d©a
);

1531 
	`Cuæ_d⁄e
(&
d©a
->
ósy_c⁄n
, d©a->
ªsu…
, 
FALSE
);

1533 if(
d⁄e
) {

1534 
fﬁlowty≥
 
fﬁlow
=
FOLLOW_NONE
;

1537 
	`Cuæ_po°å™s„r
(
d©a
);

1540 
	`Cuæ_ªmoveH™dÀFromPùñöe
(
d©a
, d©a->
ósy_c⁄n
->
ªcv_pùe
);

1543 if(
d©a
->
ósy_c⁄n
->
ªcv_pùe
->
hód
)

1544 
	`Cuæ_expúe
(
d©a
->
ósy_c⁄n
->
ªcv_pùe
->
hód
->
±r
, 1);

1547 
	`Cuæ_mu…i_¥o˚ss_≥ndög_h™dÀs
(
mu…i
);

1551 if(
d©a
->
ªq
.
√wuæ
 || 
ªåy
) {

1552 if(!
ªåy
) {

1555 
√wuæ
 = 
d©a
->
ªq
.newurl;

1556 
d©a
->
ªq
.
√wuæ
 = 
NULL
;

1557 
fﬁlow
 = 
FOLLOW_REDIR
;

1560 
fﬁlow
 = 
FOLLOW_RETRY
;

1561 
d©a
->
ªsu…
 = 
	`Cuæ_d⁄e
(&d©a->
ósy_c⁄n
, 
CURLE_OK
, 
FALSE
);

1562 if(
CURLE_OK
 =
d©a
->
ªsu…
) {

1563 
d©a
->
ªsu…
 = 
	`Cuæ_fﬁlow
(d©a, 
√wuæ
, 
fﬁlow
);

1564 if(
CURLE_OK
 =
d©a
->
ªsu…
) {

1565 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_CONNECT
);

1566 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1567 
√wuæ
 = 
NULL
;

1578 if(
d©a
->
ªq
.
loˇti⁄
) {

1579 if(
√wuæ
)

1580 
	`‰ì
(
√wuæ
);

1581 
√wuæ
 = 
d©a
->
ªq
.
loˇti⁄
;

1582 
d©a
->
ªq
.
loˇti⁄
 = 
NULL
;

1583 
d©a
->
ªsu…
 = 
	`Cuæ_fﬁlow
(d©a, 
√wuæ
, 
FOLLOW_FAKE
);

1584 if(
CURLE_OK
 =
d©a
->
ªsu…
)

1585 
√wuæ
 = 
NULL
;

1587 
disc⁄√˘_c⁄n
 = 
TRUE
;

1590 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_DONE
);

1591 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1595 if(
√wuæ
)

1596 
	`‰ì
(
√wuæ
);

1600 
CURLM_STATE_DONE
:

1602 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1604 if(
d©a
->
ósy_c⁄n
) {

1605 
CURLcode
 
ªs
;

1608 
	`Cuæ_ªmoveH™dÀFromPùñöe
(
d©a
, d©a->
ósy_c⁄n
->
ªcv_pùe
);

1610 
	`Cuæ_mu…i_¥o˚ss_≥ndög_h™dÀs
(
mu…i
);

1613 
ªs
 = 
	`Cuæ_d⁄e
(&
d©a
->
ósy_c⁄n
, d©a->
ªsu…
, 
FALSE
);

1616 if(!
d©a
->
ªsu…
)

1617 
d©a
->
ªsu…
 = 
ªs
;

1625 if(
d©a
->
ósy_c⁄n
)

1626 
d©a
->
ósy_c⁄n
 = 
NULL
;

1629 if(
d©a
->
£t
.
wûdˇrdm©ch
) {

1630 if(
d©a
->
wûdˇrd
.
°©e
 !
CURLWC_DONE
) {

1633 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_INIT
);

1640 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_COMPLETED
);

1643 
CURLM_STATE_COMPLETED
:

1651 
d©a
->
ósy_c⁄n
 = 
NULL
;

1653 
	`Cuæ_expúe
(
d©a
, 0);

1656 
CURLM_STATE_MSGSENT
:

1657  
CURLM_OK
;

1660  
CURLM_INTERNAL_ERROR
;

1663 if(
d©a
->
m°©e
 < 
CURLM_STATE_COMPLETED
) {

1664 if(
CURLE_OK
 !
d©a
->
ªsu…
) {

1673 
d©a
->
°©e
.
pùe_broke
 = 
FALSE
;

1675 if(
d©a
->
ósy_c⁄n
) {

1677 
d©a
->
ósy_c⁄n
->
wrôech™√l_öu£
 = 
FALSE
;

1678 
d©a
->
ósy_c⁄n
->
ªadch™√l_öu£
 = 
FALSE
;

1679 
	`Cuæ_ªmoveH™dÀFromPùñöe
(
d©a
,

1680 
d©a
->
ósy_c⁄n
->
£nd_pùe
);

1681 
	`Cuæ_ªmoveH™dÀFromPùñöe
(
d©a
,

1682 
d©a
->
ósy_c⁄n
->
ªcv_pùe
);

1684 
	`Cuæ_mu…i_¥o˚ss_≥ndög_h™dÀs
(
mu…i
);

1686 if(
disc⁄√˘_c⁄n
) {

1688 
	`Cuæ_disc⁄√˘
(
d©a
->
ósy_c⁄n
, 
FALSE
);

1693 
d©a
->
ósy_c⁄n
 = 
NULL
;

1696 if(
d©a
->
m°©e
 =
CURLM_STATE_CONNECT
) {

1698 ()
	`Cuæ_po°å™s„r
(
d©a
);

1701 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_COMPLETED
);

1704 if(
d©a
->
ósy_c⁄n
 && 
	`Cuæ_pgrsUpd©e
(data->easy_conn)) {

1707 
d©a
->
ªsu…
 = 
CURLE_ABORTED_BY_CALLBACK
;

1708 
	`c⁄n˛o£
(
d©a
->
ósy_c⁄n
, "Aborted by callback");

1711 
	`mu…i°©e
(
d©a
, (d©a->
m°©e
 < 
CURLM_STATE_DONE
)?

1712 
CURLM_STATE_DONE
: 
CURLM_STATE_COMPLETED
);

1713 
ªsu…
 = 
CURLM_CALL_MULTI_PERFORM
;

1716 } 
WHILE_FALSE
;

1718 if(
CURLM_STATE_COMPLETED
 =
d©a
->
m°©e
) {

1720 
msg
 = &
d©a
->msg;

1722 
msg
->
extmsg
.msg = 
CURLMSG_DONE
;

1723 
msg
->
extmsg
.
ósy_h™dÀ
 = 
d©a
;

1724 
msg
->
extmsg
.
d©a
.
ªsu…
 = data->result;

1726 
ªsu…
 = 
	`mu…i_addmsg
(
mu…i
, 
msg
);

1728 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_MSGSENT
);

1731  
ªsu…
;

1732 
	}
}

1735 
CURLMcode
 
	$cuæ_mu…i_≥rf‹m
(
CURLM
 *
mu…i_h™dÀ
, *
ru¬ög_h™dÀs
)

1737 
Cuæ_mu…i
 *
mu…i
=(Cuæ_mu…ò*)
mu…i_h™dÀ
;

1738 
Sessi⁄H™dÀ
 *
d©a
;

1739 
CURLMcode
 
ªtu∫code
=
CURLM_OK
;

1740 
Cuæ_åì
 *
t
;

1741 
timevÆ
 
now
 = 
	`Cuæ_tvnow
();

1743 if(!
	`GOOD_MULTI_HANDLE
(
mu…i
))

1744  
CURLM_BAD_HANDLE
;

1746 
d©a
=
mu…i
->
ósyp
;

1747 
d©a
) {

1748 
CURLMcode
 
ªsu…
;

1749 
WûdˇrdD©a
 *
wc
 = &
d©a
->
wûdˇrd
;

1750 
	`SIGPIPE_VARIABLE
(
pùe_°
);

1752 if(
d©a
->
£t
.
wûdˇrdm©ch
) {

1753 if(!
wc
->
fûñi°
) {

1754 
CURLcode
 
ªt
 = 
	`Cuæ_wûdˇrd_öô
(
wc
);

1755 if(
ªt
)

1756  
CURLM_OUT_OF_MEMORY
;

1760 
	`sigpùe_ign‹e
(
d©a
, &
pùe_°
);

1762 
ªsu…
 = 
	`mu…i_runsögÀ
(
mu…i
, 
now
, 
d©a
);

1763 
CURLM_CALL_MULTI_PERFORM
 =
ªsu…
);

1764 
	`sigpùe_ª°‹e
(&
pùe_°
);

1766 if(
d©a
->
£t
.
wûdˇrdm©ch
) {

1768 if(
wc
->
°©e
 =
CURLWC_DONE
 || 
ªsu…
)

1769 
	`Cuæ_wûdˇrd_dt‹
(
wc
);

1772 if(
ªsu…
)

1773 
ªtu∫code
 = 
ªsu…
;

1775 
d©a
 = d©a->
√xt
;

1789 
mu…i
->
timëªe
 = 
	`Cuæ_•œygëbe°
(
now
, mu…i->timëªe, &
t
);

1790 if(
t
)

1792 ()
	`add_√xt_timeout
(
now
, 
mu…i
, 
t
->
∑ylﬂd
);

1794 } 
t
);

1796 *
ru¬ög_h™dÀs
 = 
mu…i
->
num_Æive
;

1798 if(
CURLM_OK
 >
ªtu∫code
)

1799 
	`upd©e_timî
(
mu…i
);

1801  
ªtu∫code
;

1802 
	}
}

1804 
	$˛o£_Æl_c⁄√˘i⁄s
(
Cuæ_mu…i
 *
mu…i
)

1806 
c⁄√˘d©a
 *
c⁄n
;

1808 
c⁄n
 = 
	`Cuæ_c⁄nˇche_föd_fú°_c⁄√˘i⁄
(
mu…i
->
c⁄n_ˇche
);

1809 
c⁄n
) {

1810 
	`SIGPIPE_VARIABLE
(
pùe_°
);

1811 
c⁄n
->
d©a
 = 
mu…i
->
˛osuª_h™dÀ
;

1813 
	`sigpùe_ign‹e
(
c⁄n
->
d©a
, &
pùe_°
);

1815 ()
	`Cuæ_disc⁄√˘
(
c⁄n
, 
FALSE
);

1816 
	`sigpùe_ª°‹e
(&
pùe_°
);

1818 
c⁄n
 = 
	`Cuæ_c⁄nˇche_föd_fú°_c⁄√˘i⁄
(
mu…i
->
c⁄n_ˇche
);

1820 
	}
}

1822 
CURLMcode
 
	$cuæ_mu…i_˛ónup
(
CURLM
 *
mu…i_h™dÀ
)

1824 
Cuæ_mu…i
 *
mu…i
=(Cuæ_mu…ò*)
mu…i_h™dÀ
;

1825 
Sessi⁄H™dÀ
 *
d©a
;

1826 
Sessi⁄H™dÀ
 *
√xtd©a
;

1828 if(
	`GOOD_MULTI_HANDLE
(
mu…i
)) {

1829 
boﬁ
 
ª°‹e_pùe
 = 
FALSE
;

1830 
	`SIGPIPE_VARIABLE
(
pùe_°
);

1832 
mu…i
->
ty≥
 = 0;

1835 
	`˛o£_Æl_c⁄√˘i⁄s
(
mu…i
);

1837 if(
mu…i
->
˛osuª_h™dÀ
) {

1838 
	`sigpùe_ign‹e
(
mu…i
->
˛osuª_h™dÀ
, &
pùe_°
);

1839 
ª°‹e_pùe
 = 
TRUE
;

1841 
mu…i
->
˛osuª_h™dÀ
->
dns
.
ho°ˇche
 = multi->hostcache;

1842 
	`Cuæ_ho°ˇche_˛ón
(
mu…i
->
˛osuª_h™dÀ
,

1843 
mu…i
->
˛osuª_h™dÀ
->
dns
.
ho°ˇche
);

1845 
	`Cuæ_˛o£
(
mu…i
->
˛osuª_h™dÀ
);

1846 
mu…i
->
˛osuª_h™dÀ
 = 
NULL
;

1849 
	`Cuæ_hash_de°roy
(
mu…i
->
sockhash
);

1850 
mu…i
->
sockhash
 = 
NULL
;

1852 
	`Cuæ_c⁄nˇche_de°roy
(
mu…i
->
c⁄n_ˇche
);

1853 
mu…i
->
c⁄n_ˇche
 = 
NULL
;

1856 
	`Cuæ_Œi°_de°roy
(
mu…i
->
msgli°
, 
NULL
);

1857 
mu…i
->
msgli°
 = 
NULL
;

1860 
d©a
 = 
mu…i
->
ósyp
;

1861 
d©a
) {

1862 
√xtd©a
=
d©a
->
√xt
;

1863 if(
d©a
->
dns
.
ho°ˇchëy≥
 =
HCACHE_MULTI
) {

1865 
	`Cuæ_ho°ˇche_˛ón
(
d©a
, d©a->
dns
.
ho°ˇche
);

1866 
d©a
->
dns
.
ho°ˇche
 = 
NULL
;

1867 
d©a
->
dns
.
ho°ˇchëy≥
 = 
HCACHE_NONE
;

1871 
d©a
->
°©e
.
c⁄n_ˇche
 = 
NULL
;

1872 
d©a
->
mu…i
 = 
NULL
;

1874 
d©a
 = 
√xtd©a
;

1877 
	`Cuæ_hash_de°roy
(
mu…i
->
ho°ˇche
);

1878 
mu…i
->
ho°ˇche
 = 
NULL
;

1881 
	`Cuæ_pùñöe_£t_sôe_bœckli°
(
NULL
, &
mu…i
->
pùñöög_sôe_bl
);

1882 
	`Cuæ_pùñöe_£t_£rvî_bœckli°
(
NULL
, &
mu…i
->
pùñöög_£rvî_bl
);

1884 
	`‰ì
(
mu…i
);

1885 if(
ª°‹e_pùe
)

1886 
	`sigpùe_ª°‹e
(&
pùe_°
);

1888  
CURLM_OK
;

1891  
CURLM_BAD_HANDLE
;

1892 
	}
}

1904 
CURLMsg
 *
	$cuæ_mu…i_öfo_ªad
(
CURLM
 *
mu…i_h™dÀ
, *
msgs_ö_queue
)

1906 
Cuæ_mu…i
 *
mu…i
=(Cuæ_mu…ò*)
mu…i_h™dÀ
;

1907 
Cuæ_mesßge
 *
msg
;

1909 *
msgs_ö_queue
 = 0;

1911 if(
	`GOOD_MULTI_HANDLE
(
mu…i
Ë&& 
	`Cuæ_Œi°_cou¡
(mu…i->
msgli°
)) {

1913 
cuæ_Œi°_ñemít
 *
e
;

1916 
e
 = 
mu…i
->
msgli°
->
hód
;

1918 
msg
 = 
e
->
±r
;

1921 
	`Cuæ_Œi°_ªmove
(
mu…i
->
msgli°
, 
e
, 
NULL
);

1923 *
msgs_ö_queue
 = 
	`cuæx_uztosi
(
	`Cuæ_Œi°_cou¡
(
mu…i
->
msgli°
));

1925  &
msg
->
extmsg
;

1928  
NULL
;

1929 
	}
}

1936 
	$sögÀsockë
(
Cuæ_mu…i
 *
mu…i
,

1937 
Sessi⁄H™dÀ
 *
d©a
)

1939 
cuæ_sockë_t
 
socks
[
MAX_SOCKSPEREASYHANDLE
];

1940 
i
;

1941 
Cuæ_sh_íåy
 *
íåy
;

1942 
cuæ_sockë_t
 
s
;

1943 
num
;

1944 
cuºa˘i⁄
;

1945 
boﬁ
 
ªmove_sock_‰om_hash
;

1947 
i
=0; i< 
MAX_SOCKSPEREASYHANDLE
; i++)

1948 
socks
[
i
] = 
CURL_SOCKET_BAD
;

1952 
cuºa˘i⁄
 = 
	`mu…i_gësock
(
d©a
, 
socks
, 
MAX_SOCKSPEREASYHANDLE
);

1959 
i
=0; (i< 
MAX_SOCKSPEREASYHANDLE
) &&

1960 (
cuºa˘i⁄
 & (
	`GETSOCK_READSOCK
(
i
Ë| 
	`GETSOCK_WRITESOCK
(i)));

1961 
i
++) {

1962 
a˘i⁄
 = 
CURL_POLL_NONE
;

1964 
s
 = 
socks
[
i
];

1967 
íåy
 = 
	`Cuæ_hash_pick
(
mu…i
->
sockhash
, (*)&
s
, (s));

1969 if(
cuºa˘i⁄
 & 
	`GETSOCK_READSOCK
(
i
))

1970 
a˘i⁄
 |
CURL_POLL_IN
;

1971 if(
cuºa˘i⁄
 & 
	`GETSOCK_WRITESOCK
(
i
))

1972 
a˘i⁄
 |
CURL_POLL_OUT
;

1974 if(
íåy
) {

1976 if(
íåy
->
a˘i⁄
 ==áction)

1982 
íåy
 = 
	`sh_addíåy
(
mu…i
->
sockhash
, 
s
, 
d©a
);

1983 if(!
íåy
)

1989 if(
mu…i
->
sockë_cb
)

1990 
mu…i
->
	`sockë_cb
(
d©a
,

1991 
s
,

1992 
a˘i⁄
,

1993 
mu…i
->
sockë_u£Ω
,

1994 
íåy
->
sockëp
);

1996 
íåy
->
a˘i⁄
 =áction;

1999 
num
 = 
i
;

2003 
i
=0; i< 
d©a
->
numsocks
; i++) {

2004 
j
;

2005 
s
 = 
d©a
->
sockës
[
i
];

2006 
j
=0; j<
num
; j++) {

2007 if(
s
 =
socks
[
j
]) {

2009 
s
 = 
CURL_SOCKET_BAD
;

2013 if(
s
 !
CURL_SOCKET_BAD
) {

2016 
ªmove_sock_‰om_hash
 = 
TRUE
;

2018 
íåy
 = 
	`Cuæ_hash_pick
(
mu…i
->
sockhash
, (*)&
s
, (s));

2019 if(
íåy
) {

2023 
c⁄√˘d©a
 *
ósy_c⁄n
 = 
d©a
->easy_conn;

2024 if(
ósy_c⁄n
) {

2025 if(
ósy_c⁄n
->
ªcv_pùe
 &&Éasy_c⁄n->ªcv_pùe->
size
 > 1) {

2027 
ªmove_sock_‰om_hash
 = 
FALSE
;

2032 if(
íåy
->
ósy
 =
d©a
) {

2033 if(
	`isH™dÀAtHód
(
d©a
, 
ósy_c⁄n
->
ªcv_pùe
))

2034 
íåy
->
ósy
 = 
ósy_c⁄n
->
ªcv_pùe
->
hód
->
√xt
->
±r
;

2036 
íåy
->
ósy
 = 
ósy_c⁄n
->
ªcv_pùe
->
hód
->
±r
;

2039 if(
ósy_c⁄n
->
£nd_pùe
 &&Éasy_c⁄n->£nd_pùe->
size
 > 1) {

2041 
ªmove_sock_‰om_hash
 = 
FALSE
;

2046 if(
íåy
->
ósy
 =
d©a
) {

2047 if(
	`isH™dÀAtHód
(
d©a
, 
ósy_c⁄n
->
£nd_pùe
))

2048 
íåy
->
ósy
 = 
ósy_c⁄n
->
£nd_pùe
->
hód
->
√xt
->
±r
;

2050 
íåy
->
ósy
 = 
ósy_c⁄n
->
£nd_pùe
->
hód
->
±r
;

2063 
ªmove_sock_‰om_hash
 = 
FALSE
;

2065 if(
ªmove_sock_‰om_hash
) {

2067 if(
mu…i
->
sockë_cb
)

2068 
mu…i
->
	`sockë_cb
(
d©a
,

2069 
s
,

2070 
CURL_POLL_REMOVE
,

2071 
mu…i
->
sockë_u£Ω
,

2072 
íåy
->
sockëp
);

2073 
	`sh_dñíåy
(
mu…i
->
sockhash
, 
s
);

2079 
	`mem˝y
(
d©a
->
sockës
, 
socks
, 
num
*(
cuæ_sockë_t
));

2080 
d©a
->
numsocks
 = 
num
;

2081 
	}
}

2093 
	$Cuæ_mu…i_˛o£d
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 
s
)

2095 
Cuæ_mu…i
 *
mu…i
 = 
c⁄n
->
d©a
->multi;

2096 if(
mu…i
) {

2099 
Cuæ_sh_íåy
 *
íåy
 =

2100 
	`Cuæ_hash_pick
(
mu…i
->
sockhash
, (*)&
s
, (s));

2102 if(
íåy
) {

2103 if(
mu…i
->
sockë_cb
)

2104 
mu…i
->
	`sockë_cb
(
c⁄n
->
d©a
, 
s
, 
CURL_POLL_REMOVE
,

2105 
mu…i
->
sockë_u£Ω
,

2106 
íåy
->
sockëp
);

2109 
	`sh_dñíåy
(
mu…i
->
sockhash
, 
s
);

2112 
	}
}

2128 
CURLMcode
 
	$add_√xt_timeout
(
timevÆ
 
now
,

2129 
Cuæ_mu…i
 *
mu…i
,

2130 
Sessi⁄H™dÀ
 *
d
)

2132 
timevÆ
 *
tv
 = &
d
->
°©e
.
expúëime
;

2133 
cuæ_Œi°
 *
li°
 = 
d
->
°©e
.
timeouéi°
;

2134 
cuæ_Œi°_ñemít
 *
e
;

2139 
e
 = 
li°
->
hód
;É; ) {

2140 
cuæ_Œi°_ñemít
 *
n
 = 
e
->
√xt
;

2141 
diff
 = 
	`cuæx_tvdiff
(*(
timevÆ
 *)
e
->
±r
, 
now
);

2142 if(
diff
 <= 0)

2144 
	`Cuæ_Œi°_ªmove
(
li°
, 
e
, 
NULL
);

2148 
e
 = 
n
;

2150 
e
 = 
li°
->
hód
;

2151 if(!
e
) {

2154 
tv
->
tv_£c
 = 0;

2155 
tv
->
tv_u£c
 = 0;

2159 
	`mem˝y
(
tv
, 
e
->
±r
, (*tv));

2162 
	`Cuæ_Œi°_ªmove
(
li°
, 
e
, 
NULL
);

2165 
mu…i
->
timëªe
 = 
	`Cuæ_•œyö£π
(*
tv
, multi->timetree,

2166 &
d
->
°©e
.
timíode
);

2168  
CURLM_OK
;

2169 
	}
}

2171 
CURLMcode
 
	$mu…i_sockë
(
Cuæ_mu…i
 *
mu…i
,

2172 
boﬁ
 
checkÆl
,

2173 
cuæ_sockë_t
 
s
,

2174 
ev_bômask
,

2175 *
ru¬ög_h™dÀs
)

2177 
CURLMcode
 
ªsu…
 = 
CURLM_OK
;

2178 
Sessi⁄H™dÀ
 *
d©a
 = 
NULL
;

2179 
Cuæ_åì
 *
t
;

2180 
timevÆ
 
now
 = 
	`Cuæ_tvnow
();

2182 if(
checkÆl
) {

2184 
ªsu…
 = 
	`cuæ_mu…i_≥rf‹m
(
mu…i
, 
ru¬ög_h™dÀs
);

2188 if(
ªsu…
 !
CURLM_BAD_HANDLE
) {

2189 
d©a
=
mu…i
->
ósyp
;

2190 
d©a
) {

2191 
	`sögÀsockë
(
mu…i
, 
d©a
);

2192 
d©a
 = d©a->
√xt
;

2197  
ªsu…
;

2199 if(
s
 !
CURL_SOCKET_TIMEOUT
) {

2201 
Cuæ_sh_íåy
 *
íåy
 =

2202 
	`Cuæ_hash_pick
(
mu…i
->
sockhash
, (*)&
s
, (s));

2204 if(!
íåy
)

2212 
	`SIGPIPE_VARIABLE
(
pùe_°
);

2214 
d©a
 = 
íåy
->
ósy
;

2216 if(
d©a
->
magic
 !
CURLEASY_MAGIC_NUMBER
)

2218  
CURLM_INTERNAL_ERROR
;

2223 if(
d©a
->
ósy_c⁄n
) {

2224 if((
ev_bômask
 & 
CURL_POLL_OUT
) &&

2225 
d©a
->
ósy_c⁄n
->
£nd_pùe
 &&

2226 
d©a
->
ósy_c⁄n
->
£nd_pùe
->
hód
)

2227 
d©a
 = d©a->
ósy_c⁄n
->
£nd_pùe
->
hód
->
±r
;

2228 if((
ev_bômask
 & 
CURL_POLL_IN
) &&

2229 
d©a
->
ósy_c⁄n
->
ªcv_pùe
 &&

2230 
d©a
->
ósy_c⁄n
->
ªcv_pùe
->
hód
)

2231 
d©a
 = d©a->
ósy_c⁄n
->
ªcv_pùe
->
hód
->
±r
;

2234 if(
d©a
->
ósy_c⁄n
 &&

2235 !(
d©a
->
ósy_c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_DIRLOCK
))

2237 
d©a
->
ósy_c⁄n
->
c£À˘_bôs
 = 
ev_bômask
;

2239 
	`sigpùe_ign‹e
(
d©a
, &
pùe_°
);

2241 
ªsu…
 = 
	`mu…i_runsögÀ
(
mu…i
, 
now
, 
d©a
);

2242 
CURLM_CALL_MULTI_PERFORM
 =
ªsu…
);

2243 
	`sigpùe_ª°‹e
(&
pùe_°
);

2245 if(
d©a
->
ósy_c⁄n
 &&

2246 !(
d©a
->
ósy_c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_DIRLOCK
))

2248 
d©a
->
ósy_c⁄n
->
c£À˘_bôs
 = 0;

2250 if(
CURLM_OK
 >
ªsu…
)

2253 
	`sögÀsockë
(
mu…i
, 
d©a
);

2259 
d©a
 = 
NULL
;

2261 
now
 = 
	`Cuæ_tvnow
();

2270 
	`mem£t
(&
mu…i
->
timî_œ°ˇŒ
, 0, (multi->timer_lastcall));

2280 if(
d©a
) {

2281 
	`SIGPIPE_VARIABLE
(
pùe_°
);

2283 
	`sigpùe_ign‹e
(
d©a
, &
pùe_°
);

2285 
ªsu…
 = 
	`mu…i_runsögÀ
(
mu…i
, 
now
, 
d©a
);

2286 
CURLM_CALL_MULTI_PERFORM
 =
ªsu…
);

2287 
	`sigpùe_ª°‹e
(&
pùe_°
);

2289 if(
CURLM_OK
 >
ªsu…
)

2292 
	`sögÀsockë
(
mu…i
, 
d©a
);

2298 
mu…i
->
timëªe
 = 
	`Cuæ_•œygëbe°
(
now
, mu…i->timëªe, &
t
);

2299 if(
t
) {

2300 
d©a
 = 
t
->
∑ylﬂd
;

2301 ()
	`add_√xt_timeout
(
now
, 
mu…i
, 
t
->
∑ylﬂd
);

2304 } 
t
);

2306 *
ru¬ög_h™dÀs
 = 
mu…i
->
num_Æive
;

2307  
ªsu…
;

2308 
	}
}

2310 #unde‡
cuæ_mu…i_£t›t


2311 
CURLMcode
 
	$cuæ_mu…i_£t›t
(
CURLM
 *
mu…i_h™dÀ
,

2312 
CURLM›ti⁄
 
›ti⁄
, ...)

2314 
Cuæ_mu…i
 *
mu…i
=(Cuæ_mu…ò*)
mu…i_h™dÀ
;

2315 
CURLMcode
 
ªs
 = 
CURLM_OK
;

2316 
va_li°
 
∑øm
;

2318 if(!
	`GOOD_MULTI_HANDLE
(
mu…i
))

2319  
CURLM_BAD_HANDLE
;

2321 
	`va_°¨t
(
∑øm
, 
›ti⁄
);

2323 
›ti⁄
) {

2324 
CURLMOPT_SOCKETFUNCTION
:

2325 
mu…i
->
sockë_cb
 = 
	`va_¨g
(
∑øm
, 
cuæ_sockë_ˇŒback
);

2327 
CURLMOPT_SOCKETDATA
:

2328 
mu…i
->
sockë_u£Ω
 = 
	`va_¨g
(
∑øm
, *);

2330 
CURLMOPT_PIPELINING
:

2331 
mu…i
->
pùñöög_íabÀd
 = (0 !
	`va_¨g
(
∑øm
, )Ë? 
TRUE
 : 
FALSE
;

2333 
CURLMOPT_TIMERFUNCTION
:

2334 
mu…i
->
timî_cb
 = 
	`va_¨g
(
∑øm
, 
cuæ_mu…i_timî_ˇŒback
);

2336 
CURLMOPT_TIMERDATA
:

2337 
mu…i
->
timî_u£Ω
 = 
	`va_¨g
(
∑øm
, *);

2339 
CURLMOPT_MAXCONNECTS
:

2340 
mu…i
->
maxc⁄√˘s
 = 
	`va_¨g
(
∑øm
, );

2342 
CURLMOPT_MAX_HOST_CONNECTIONS
:

2343 
mu…i
->
max_ho°_c⁄√˘i⁄s
 = 
	`va_¨g
(
∑øm
, );

2345 
CURLMOPT_MAX_PIPELINE_LENGTH
:

2346 
mu…i
->
max_pùñöe_Àngth
 = 
	`va_¨g
(
∑øm
, );

2348 
CURLMOPT_CONTENT_LENGTH_PENALTY_SIZE
:

2349 
mu…i
->
c⁄ã¡_Àngth_≥«…y_size
 = 
	`va_¨g
(
∑øm
, );

2351 
CURLMOPT_CHUNK_LENGTH_PENALTY_SIZE
:

2352 
mu…i
->
chunk_Àngth_≥«…y_size
 = 
	`va_¨g
(
∑øm
, );

2354 
CURLMOPT_PIPELINING_SITE_BL
:

2355 
ªs
 = 
	`Cuæ_pùñöe_£t_sôe_bœckli°
(
	`va_¨g
(
∑øm
, **),

2356 &
mu…i
->
pùñöög_sôe_bl
);

2358 
CURLMOPT_PIPELINING_SERVER_BL
:

2359 
ªs
 = 
	`Cuæ_pùñöe_£t_£rvî_bœckli°
(
	`va_¨g
(
∑øm
, **),

2360 &
mu…i
->
pùñöög_£rvî_bl
);

2362 
CURLMOPT_MAX_TOTAL_CONNECTIONS
:

2363 
mu…i
->
max_tŸÆ_c⁄√˘i⁄s
 = 
	`va_¨g
(
∑øm
, );

2366 
ªs
 = 
CURLM_UNKNOWN_OPTION
;

2369 
	`va_íd
(
∑øm
);

2370  
ªs
;

2371 
	}
}

2374 #unde‡
cuæ_mu…i_sockë


2376 
CURLMcode
 
	$cuæ_mu…i_sockë
(
CURLM
 *
mu…i_h™dÀ
, 
cuæ_sockë_t
 
s
,

2377 *
ru¬ög_h™dÀs
)

2379 
CURLMcode
 
ªsu…
 = 
	`mu…i_sockë
((
Cuæ_mu…i
 *)
mu…i_h™dÀ
, 
FALSE
, 
s
,

2380 0, 
ru¬ög_h™dÀs
);

2381 if(
CURLM_OK
 >
ªsu…
)

2382 
	`upd©e_timî
((
Cuæ_mu…i
 *)
mu…i_h™dÀ
);

2383  
ªsu…
;

2384 
	}
}

2386 
CURLMcode
 
	$cuæ_mu…i_sockë_a˘i⁄
(
CURLM
 *
mu…i_h™dÀ
, 
cuæ_sockë_t
 
s
,

2387 
ev_bômask
, *
ru¬ög_h™dÀs
)

2389 
CURLMcode
 
ªsu…
 = 
	`mu…i_sockë
((
Cuæ_mu…i
 *)
mu…i_h™dÀ
, 
FALSE
, 
s
,

2390 
ev_bômask
, 
ru¬ög_h™dÀs
);

2391 if(
CURLM_OK
 >
ªsu…
)

2392 
	`upd©e_timî
((
Cuæ_mu…i
 *)
mu…i_h™dÀ
);

2393  
ªsu…
;

2394 
	}
}

2396 
CURLMcode
 
	$cuæ_mu…i_sockë_Æl
(
CURLM
 *
mu…i_h™dÀ
, *
ru¬ög_h™dÀs
)

2399 
CURLMcode
 
ªsu…
 = 
	`mu…i_sockë
((
Cuæ_mu…i
 *)
mu…i_h™dÀ
,

2400 
TRUE
, 
CURL_SOCKET_BAD
, 0, 
ru¬ög_h™dÀs
);

2401 if(
CURLM_OK
 >
ªsu…
)

2402 
	`upd©e_timî
((
Cuæ_mu…i
 *)
mu…i_h™dÀ
);

2403  
ªsu…
;

2404 
	}
}

2406 
CURLMcode
 
	$mu…i_timeout
(
Cuæ_mu…i
 *
mu…i
,

2407 *
timeout_ms
)

2409 
timevÆ
 
tv_zîo
 = {0,0};

2411 if(
mu…i
->
timëªe
) {

2413 
timevÆ
 
now
 = 
	`Cuæ_tvnow
();

2416 
mu…i
->
timëªe
 = 
	`Cuæ_•œy
(
tv_zîo
, multi->timetree);

2418 if(
	`Cuæ_•œycom∑ªkeys
(
mu…i
->
timëªe
->
key
, 
now
) > 0) {

2420 *
timeout_ms
 = 
	`cuæx_tvdiff
(
mu…i
->
timëªe
->
key
, 
now
);

2421 if(!*
timeout_ms
)

2429 *
timeout_ms
=1;

2433 *
timeout_ms
 = 0;

2436 *
timeout_ms
 = -1;

2438  
CURLM_OK
;

2439 
	}
}

2441 
CURLMcode
 
	$cuæ_mu…i_timeout
(
CURLM
 *
mu…i_h™dÀ
,

2442 *
timeout_ms
)

2444 
Cuæ_mu…i
 *
mu…i
=(Cuæ_mu…ò*)
mu…i_h™dÀ
;

2447 if(!
	`GOOD_MULTI_HANDLE
(
mu…i
))

2448  
CURLM_BAD_HANDLE
;

2450  
	`mu…i_timeout
(
mu…i
, 
timeout_ms
);

2451 
	}
}

2457 
	$upd©e_timî
(
Cuæ_mu…i
 *
mu…i
)

2459 
timeout_ms
;

2461 if(!
mu…i
->
timî_cb
)

2463 if(
	`mu…i_timeout
(
mu…i
, &
timeout_ms
)) {

2466 if(
timeout_ms
 < 0) {

2467 c⁄° 
timevÆ
 
n⁄e
={0,0};

2468 if(
	`Cuæ_•œycom∑ªkeys
(
n⁄e
, 
mu…i
->
timî_œ°ˇŒ
)) {

2469 
mu…i
->
timî_œ°ˇŒ
 = 
n⁄e
;

2472  
mu…i
->
	`timî_cb
((
CURLM
*)mu…i, -1, mu…i->
timî_u£Ω
);

2481 if(
	`Cuæ_•œycom∑ªkeys
(
mu…i
->
timëªe
->
key
, mu…i->
timî_œ°ˇŒ
) == 0)

2484 
mu…i
->
timî_œ°ˇŒ
 = mu…i->
timëªe
->
key
;

2486  
mu…i
->
	`timî_cb
((
CURLM
*)mu…i, 
timeout_ms
, mu…i->
timî_u£Ω
);

2487 
	}
}

2489 
	$Cuæ_mu…i_£t_ósy_c⁄√˘i⁄
(
Sessi⁄H™dÀ
 *
h™dÀ
,

2490 
c⁄√˘d©a
 *
c⁄n
)

2492 
h™dÀ
->
ósy_c⁄n
 = 
c⁄n
;

2493 
	}
}

2495 
boﬁ
 
	$isH™dÀAtHód
(
Sessi⁄H™dÀ
 *
h™dÀ
,

2496 
cuæ_Œi°
 *
pùñöe
)

2498 
cuæ_Œi°_ñemít
 *
cuº
 = 
pùñöe
->
hód
;

2499 if(
cuº
)

2500  (
cuº
->
±r
 =
h™dÀ
Ë? 
TRUE
 : 
FALSE
;

2502  
FALSE
;

2503 
	}
}

2511 
	$mu…i_‰ìtimeout
(*
u£r
, *
íåy±r
)

2513 ()
u£r
;

2516 
	`‰ì
(
íåy±r
);

2517 
	}
}

2526 
CURLMcode


2527 
	$mu…i_addtimeout
(
cuæ_Œi°
 *
timeouéi°
,

2528 
timevÆ
 *
°amp
)

2530 
cuæ_Œi°_ñemít
 *
e
;

2531 
timevÆ
 *
timedup
;

2532 
cuæ_Œi°_ñemít
 *
¥ev
 = 
NULL
;

2534 
timedup
 = 
	`mÆloc
((*timedup));

2535 if(!
timedup
)

2536  
CURLM_OUT_OF_MEMORY
;

2539 
	`mem˝y
(
timedup
, 
°amp
, (*timedup));

2541 if(
	`Cuæ_Œi°_cou¡
(
timeouéi°
)) {

2543 
e
 = 
timeouéi°
->
hód
;É;É =É->
√xt
) {

2544 
timevÆ
 *
checktime
 = 
e
->
±r
;

2545 
diff
 = 
	`cuæx_tvdiff
(*
checktime
, *
timedup
);

2546 if(
diff
 > 0)

2548 
¥ev
 = 
e
;

2555 if(!
	`Cuæ_Œi°_ö£π_√xt
(
timeouéi°
, 
¥ev
, 
timedup
)) {

2556 
	`‰ì
(
timedup
);

2557  
CURLM_OUT_OF_MEMORY
;

2560  
CURLM_OK
;

2561 
	}
}

2574 
	$Cuæ_expúe
(
Sessi⁄H™dÀ
 *
d©a
, 
mûli
)

2576 
Cuæ_mu…i
 *
mu…i
 = 
d©a
->multi;

2577 
timevÆ
 *
nowp
 = &
d©a
->
°©e
.
expúëime
;

2578 
rc
;

2582 if(!
mu…i
)

2585 if(!
mûli
) {

2587 if(
nowp
->
tv_£c
 ||Çowp->
tv_u£c
) {

2590 
cuæ_Œi°
 *
li°
 = 
d©a
->
°©e
.
timeouéi°
;

2592 
rc
 = 
	`Cuæ_•œyªmovebyaddr
(
mu…i
->
timëªe
,

2593 &
d©a
->
°©e
.
timíode
,

2594 &
mu…i
->
timëªe
);

2595 if(
rc
)

2596 
	`öfof
(
d©a
, "I¡î«»îr‹ cÀ¨ög s∂ayÇodê%d\n", 
rc
);

2599 
li°
->
size
 > 0)

2600 
	`Cuæ_Œi°_ªmove
(
li°
,Üi°->
èû
, 
NULL
);

2602 #ifde‡
DEBUGBUILD


2603 
	`öfof
(
d©a
, "Expire cleared\n");

2605 
nowp
->
tv_£c
 = 0;

2606 
nowp
->
tv_u£c
 = 0;

2610 
timevÆ
 
£t
;

2612 
£t
 = 
	`Cuæ_tvnow
();

2613 
£t
.
tv_£c
 +
mûli
/1000;

2614 
£t
.
tv_u£c
 +(
mûli
%1000)*1000;

2616 if(
£t
.
tv_u£c
 >= 1000000) {

2617 
£t
.
tv_£c
++;

2618 
£t
.
tv_u£c
 -= 1000000;

2621 if(
nowp
->
tv_£c
 ||Çowp->
tv_u£c
) {

2625 
diff
 = 
	`cuæx_tvdiff
(
£t
, *
nowp
);

2626 if(
diff
 > 0) {

2629 
	`mu…i_addtimeout
(
d©a
->
°©e
.
timeouéi°
, &
£t
);

2635 
	`mu…i_addtimeout
(
d©a
->
°©e
.
timeouéi°
, 
nowp
);

2639 
rc
 = 
	`Cuæ_•œyªmovebyaddr
(
mu…i
->
timëªe
,

2640 &
d©a
->
°©e
.
timíode
,

2641 &
mu…i
->
timëªe
);

2642 if(
rc
)

2643 
	`öfof
(
d©a
, "I¡î«»îr‹Ñemovög s∂ayÇodê%d\n", 
rc
);

2646 *
nowp
 = 
£t
;

2647 
d©a
->
°©e
.
timíode
.
∑ylﬂd
 = data;

2648 
mu…i
->
timëªe
 = 
	`Cuæ_•œyö£π
(*
nowp
,

2649 
mu…i
->
timëªe
,

2650 &
d©a
->
°©e
.
timíode
);

2653 
	`Cuæ_•œy¥öt
(
mu…i
->
timëªe
, 0, 
TRUE
);

2655 
	}
}

2657 
CURLMcode
 
	$cuæ_mu…i_assign
(
CURLM
 *
mu…i_h™dÀ
,

2658 
cuæ_sockë_t
 
s
, *
hashp
)

2660 
Cuæ_sh_íåy
 *
thîe
 = 
NULL
;

2661 
Cuæ_mu…i
 *
mu…i
 = (Cuæ_mu…ò*)
mu…i_h™dÀ
;

2663 if(
s
 !
CURL_SOCKET_BAD
)

2664 
thîe
 = 
	`Cuæ_hash_pick
(
mu…i
->
sockhash
, (*)&
s
, (
cuæ_sockë_t
));

2666 if(!
thîe
)

2667  
CURLM_BAD_SOCKET
;

2669 
thîe
->
sockëp
 = 
hashp
;

2671  
CURLM_OK
;

2672 
	}
}

2674 
size_t
 
	$Cuæ_mu…i_max_ho°_c⁄√˘i⁄s
(
Cuæ_mu…i
 *
mu…i
)

2676  
mu…i
 ? mu…i->
max_ho°_c⁄√˘i⁄s
 : 0;

2677 
	}
}

2679 
size_t
 
	$Cuæ_mu…i_max_tŸÆ_c⁄√˘i⁄s
(
Cuæ_mu…i
 *
mu…i
)

2681  
mu…i
 ? mu…i->
max_tŸÆ_c⁄√˘i⁄s
 : 0;

2682 
	}
}

2684 
size_t
 
	$Cuæ_mu…i_max_pùñöe_Àngth
(
Cuæ_mu…i
 *
mu…i
)

2686  
mu…i
 ? mu…i->
max_pùñöe_Àngth
 : 0;

2687 
	}
}

2689 
cuæ_off_t
 
	$Cuæ_mu…i_c⁄ã¡_Àngth_≥«…y_size
(
Cuæ_mu…i
 *
mu…i
)

2691  
mu…i
 ? mu…i->
c⁄ã¡_Àngth_≥«…y_size
 : 0;

2692 
	}
}

2694 
cuæ_off_t
 
	$Cuæ_mu…i_chunk_Àngth_≥«…y_size
(
Cuæ_mu…i
 *
mu…i
)

2696  
mu…i
 ? mu…i->
chunk_Àngth_≥«…y_size
 : 0;

2697 
	}
}

2699 
cuæ_Œi°
 *
	$Cuæ_mu…i_pùñöög_sôe_bl
(
Cuæ_mu…i
 *
mu…i
)

2701  
mu…i
->
pùñöög_sôe_bl
;

2702 
	}
}

2704 
cuæ_Œi°
 *
	$Cuæ_mu…i_pùñöög_£rvî_bl
(
Cuæ_mu…i
 *
mu…i
)

2706  
mu…i
->
pùñöög_£rvî_bl
;

2707 
	}
}

2709 
	$Cuæ_mu…i_¥o˚ss_≥ndög_h™dÀs
(
Cuæ_mu…i
 *
mu…i
)

2711 
Sessi⁄H™dÀ
 *
d©a
;

2713 
d©a
=
mu…i
->
ósyp
;

2714 
d©a
) {

2715 if(
d©a
->
m°©e
 =
CURLM_STATE_CONNECT_PEND
) {

2716 
	`mu…i°©e
(
d©a
, 
CURLM_STATE_CONNECT
);

2718 
	`Cuæ_expúe
(
d©a
, 1);

2720 
d©a
 = d©a->
√xt
;

2722 
	}
}

2724 #ifde‡
DEBUGBUILD


2725 
	$Cuæ_mu…i_dump
(c⁄° 
Cuæ_mu…i
 *
mu…i_h™dÀ
)

2727 
Cuæ_mu…i
 *
mu…i
=(Cuæ_mu…ò*)
mu…i_h™dÀ
;

2728 
Sessi⁄H™dÀ
 *
d©a
;

2729 
i
;

2730 
	`Ârötf
(
°dîr
, "* Multi status: %d handles, %dálive\n",

2731 
mu…i
->
num_ósy
, mu…i->
num_Æive
);

2732 
d©a
=
mu…i
->
ósyp
; d©a; d©®d©a->
√xt
) {

2733 if(
d©a
->
m°©e
 < 
CURLM_STATE_COMPLETED
) {

2735 
	`Ârötf
(
°dîr
, "handle %p, state %s, %d sockets\n",

2736 (*)
d©a
,

2737 
°©íame
[
d©a
->
m°©e
], d©a->
numsocks
);

2738 
i
=0; i < 
d©a
->
numsocks
; i++) {

2739 
cuæ_sockë_t
 
s
 = 
d©a
->
sockës
[
i
];

2740 
Cuæ_sh_íåy
 *
íåy
 =

2741 
	`Cuæ_hash_pick
(
mu…i
->
sockhash
, (*)&
s
, (s));

2743 
	`Ârötf
(
°dîr
, "%d ", ()
s
);

2744 if(!
íåy
) {

2745 
	`Ârötf
(
°dîr
, "INTERNAL CONFUSION\n");

2748 
	`Ârötf
(
°dîr
, "[%s %s] ",

2749 
íåy
->
a˘i⁄
&
CURL_POLL_IN
?"RECVING":"",

2750 
íåy
->
a˘i⁄
&
CURL_POLL_OUT
?"SENDING":"");

2752 if(
d©a
->
numsocks
)

2753 
	`Ârötf
(
°dîr
, "\n");

2756 
	}
}

	@lib/multihandle.h

1 #i‚de‡
HEADER_CURL_MULTIHANDLE_H


2 
	#HEADER_CURL_MULTIHANDLE_H


	)

25 
	sCuæ_mesßge
 {

27 
CURLMsg
 
	mextmsg
;

34 
	mCURLM_STATE_INIT
,

35 
	mCURLM_STATE_CONNECT_PEND
,

36 
	mCURLM_STATE_CONNECT
,

37 
	mCURLM_STATE_WAITRESOLVE
,

38 
	mCURLM_STATE_WAITCONNECT
,

39 
	mCURLM_STATE_WAITPROXYCONNECT
,

40 
	mCURLM_STATE_PROTOCONNECT
,

42 
	mCURLM_STATE_WAITDO
,

43 
	mCURLM_STATE_DO
,

44 
	mCURLM_STATE_DOING
,

45 
	mCURLM_STATE_DO_MORE
,

46 
	mCURLM_STATE_DO_DONE
,

47 
	mCURLM_STATE_WAITPERFORM
,

48 
	mCURLM_STATE_PERFORM
,

49 
	mCURLM_STATE_TOOFAST
,

50 
	mCURLM_STATE_DONE
,

51 
	mCURLM_STATE_COMPLETED
,

52 
	mCURLM_STATE_MSGSENT
,

53 
	mCURLM_STATE_LAST


54 } 
	tCURLM°©e
;

58 
	#MAX_SOCKSPEREASYHANDLE
 5

	)

59 
	#GETSOCK_READABLE
 (0x00ff)

	)

60 
	#GETSOCK_WRITABLE
 (0xff00)

	)

63 
	sCuæ_mu…i
 {

66 
	mty≥
;

69 
Sessi⁄H™dÀ
 *
	mósyp
;

70 
Sessi⁄H™dÀ
 *
	mósyÕ
;

72 
	mnum_ósy
;

73 
	mnum_Æive
;

76 
cuæ_Œi°
 *
	mmsgli°
;

79 
cuæ_sockë_ˇŒback
 
	msockë_cb
;

80 *
	msockë_u£Ω
;

83 
cuæ_hash
 *
	mho°ˇche
;

87 
Cuæ_åì
 *
	mtimëªe
;

92 
cuæ_hash
 *
	msockhash
;

95 
boﬁ
 
	mpùñöög_íabÀd
;

98 
c⁄nˇche
 *
	mc⁄n_ˇche
;

102 
Sessi⁄H™dÀ
 *
	m˛osuª_h™dÀ
;

104 
	mmaxc⁄√˘s
;

107 
	mmax_ho°_c⁄√˘i⁄s
;

110 
	mmax_tŸÆ_c⁄√˘i⁄s
;

113 
	mmax_pùñöe_Àngth
;

116 
	mc⁄ã¡_Àngth_≥«…y_size
;

121 
	mchunk_Àngth_≥«…y_size
;

125 
cuæ_Œi°
 *
	mpùñöög_sôe_bl
;

128 
cuæ_Œi°
 *
	mpùñöög_£rvî_bl
;

132 
cuæ_mu…i_timî_ˇŒback
 
	mtimî_cb
;

133 *
	mtimî_u£Ω
;

134 
timevÆ
 
	mtimî_œ°ˇŒ
;

	@lib/multiif.h

1 #i‚de‡
HEADER_CURL_MULTIIF_H


2 
	#HEADER_CURL_MULTIIF_H


	)

28 
Cuæ_expúe
(
Sessi⁄H™dÀ
 *
d©a
, 
mûli
);

30 
boﬁ
 
Cuæ_mu…i_pùñöe_íabÀd
(c⁄° 
Cuæ_mu…i
* 
mu…i
);

31 
Cuæ_mu…i_h™dÀPùeBªak
(
Sessi⁄H™dÀ
 *
d©a
);

35 
Cuæ_mu…i
 *
Cuæ_mu…i_h™dÀ
(
hashsize
, 
chashsize
);

38 
	#GETSOCK_WRITEBITSTART
 16

	)

40 
	#GETSOCK_BLANK
 0

	)

43 
	#GETSOCK_WRITESOCK
(
x
Ë(1 << (
GETSOCK_WRITEBITSTART
 + (x)))

	)

46 
	#GETSOCK_READSOCK
(
x
Ë(1 << (x))

	)

48 #ifde‡
DEBUGBUILD


54 
Cuæ_mu…i_dump
(c⁄° 
Cuæ_mu…i
 *
mu…i_h™dÀ
);

58 
Cuæ_mu…i_£t_ósy_c⁄√˘i⁄
(
Sessi⁄H™dÀ
 *
h™dÀ
,

59 
c⁄√˘d©a
 *
c⁄n
);

61 
Cuæ_mu…i_¥o˚ss_≥ndög_h™dÀs
(
Cuæ_mu…i
 *
mu…i
);

64 
size_t
 
Cuæ_mu…i_max_ho°_c⁄√˘i⁄s
(
Cuæ_mu…i
 *
mu…i
);

67 
size_t
 
Cuæ_mu…i_max_pùñöe_Àngth
(
Cuæ_mu…i
 *
mu…i
);

70 
cuæ_off_t
 
Cuæ_mu…i_c⁄ã¡_Àngth_≥«…y_size
(
Cuæ_mu…i
 *
mu…i
);

73 
cuæ_off_t
 
Cuæ_mu…i_chunk_Àngth_≥«…y_size
(
Cuæ_mu…i
 *
mu…i
);

76 
cuæ_Œi°
 *
Cuæ_mu…i_pùñöög_sôe_bl
(
Cuæ_mu…i
 *
mu…i
);

79 
cuæ_Œi°
 *
Cuæ_mu…i_pùñöög_£rvî_bl
(
Cuæ_mu…i
 *
mu…i
);

82 
size_t
 
Cuæ_mu…i_max_tŸÆ_c⁄√˘i⁄s
(
Cuæ_mu…i
 *
mu…i
);

94 
Cuæ_mu…i_˛o£d
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 
s
);

	@lib/netrc.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_PWD_H


26 
	~<pwd.h
>

29 
	~<cuæ/cuæ.h
>

30 
	~"√åc.h
"

32 
	~"°ªquÆ.h
"

33 
	~"°πok.h
"

34 
	~"cuæ_mem‹y.h
"

35 
	~"øw°r.h
"

37 
	#_MPRINTF_REPLACE


	)

38 
	~<cuæ/m¥ötf.h
>

41 
	~"memdebug.h
"

45 
	eho°_lookup_°©e
 {

46 
	mNOTHING
,

47 
	mHOSTFOUND
,

48 
	mHOSTVALID


57 
	$Cuæ_∑r£√åc
(c⁄° *
ho°
,

58 **
logöp
,

59 **
∑ssw‹dp
,

60 *
√åcfûe
)

62 
FILE
 *
fûe
;

63 
ªtcode
=1;

64 
•ecific_logö
 = (*
logöp
 && **loginp != 0);

65 
boﬁ
 
√åc_Æloc
 = 
FALSE
;

66 
ho°_lookup_°©e
 
°©e
=
NOTHING
;

68 
°©e_logö
=0;

69 
°©e_∑ssw‹d
=0;

70 
°©e_our_logö
=
FALSE
;

72 
	#NETRC
 
DOT_CHAR
 "√åc"

	)

74 if(!
√åcfûe
) {

75 
boﬁ
 
home_Æloc
 = 
FALSE
;

76 *
home
 = 
	`cuæ_gëív
("HOME");

77 if(
home
) {

78 
home_Æloc
 = 
TRUE
;

79 #i‡
	`deföed
(
HAVE_GETPWUID_R
Ë&& deföed(
HAVE_GETEUID
)

82 
∑sswd
 
pw
, *
pw_ªs
;

83 
pwbuf
[1024];

84 if(!
	`gëpwuid_r
(
	`gëeuid
(), &
pw
, 
pwbuf
, ’wbuf), &
pw_ªs
)

85 && 
pw_ªs
) {

86 
home
 = 
	`°rdup
(
pw
.
pw_dú
);

87 if(!
home
)

88  
CURLE_OUT_OF_MEMORY
;

89 
home_Æloc
 = 
TRUE
;

91 #ñi‡
	`deföed
(
HAVE_GETPWUID
Ë&& deföed(
HAVE_GETEUID
)

94 
∑sswd
 *
pw
;

95 
pw

	`gëpwuid
(
	`gëeuid
());

96 if(
pw
) {

97 
home
 = 
pw
->
pw_dú
;

102 if(!
home
)

103  
ªtcode
;

105 
√åcfûe
 = 
	`cuæ_m≠rötf
("%s%s%s", 
home
, 
DIR_CHAR
, 
NETRC
);

106 if(
home_Æloc
)

107 
	`Cuæ_ß„‰ì
(
home
);

108 if(!
√åcfûe
) {

111 
√åc_Æloc
 = 
TRUE
;

114 
fûe
 = 
	`f›í
(
√åcfûe
, "r");

115 if(
√åc_Æloc
)

116 
	`Cuæ_ß„‰ì
(
√åcfûe
);

117 if(
fûe
) {

118 *
tok
;

119 *
tok_buf
;

120 
boﬁ
 
d⁄e
=
FALSE
;

121 
√åcbuf„r
[256];

122 
√åcbuffsize
 = ()(
√åcbuf„r
);

124 !
d⁄e
 && 
	`fgës
(
√åcbuf„r
, 
√åcbuffsize
, 
fûe
)) {

125 
tok
=
	`°πok_r
(
√åcbuf„r
, " \t\n", &
tok_buf
);

126 !
d⁄e
 && 
tok
) {

128 if((*
logöp
 && **logöpË&& (*
∑ssw‹dp
 && **passwordp)) {

129 
d⁄e
=
TRUE
;

133 
°©e
) {

134 
NOTHING
:

135 if(
	`Cuæ_øw_equÆ
("machöe", 
tok
)) {

140 
°©e
=
HOSTFOUND
;

143 
HOSTFOUND
:

144 if(
	`Cuæ_øw_equÆ
(
ho°
, 
tok
)) {

146 
°©e
=
HOSTVALID
;

147 
ªtcode
=0;

151 
°©e
=
NOTHING
;

153 
HOSTVALID
:

155 if(
°©e_logö
) {

156 if(
•ecific_logö
) {

157 
°©e_our_logö
 = 
	`Cuæ_øw_equÆ
(*
logöp
, 
tok
);

160 
	`‰ì
(*
logöp
);

161 *
logöp
 = 
	`°rdup
(
tok
);

162 if(!*
logöp
) {

163 
ªtcode
 = -1;

164 
out
;

167 
°©e_logö
=0;

169 if(
°©e_∑ssw‹d
) {

170 if(
°©e_our_logö
 || !
•ecific_logö
) {

171 
	`‰ì
(*
∑ssw‹dp
);

172 *
∑ssw‹dp
 = 
	`°rdup
(
tok
);

173 if(!*
∑ssw‹dp
) {

174 
ªtcode
 = -1;

175 
out
;

178 
°©e_∑ssw‹d
=0;

180 if(
	`Cuæ_øw_equÆ
("logö", 
tok
))

181 
°©e_logö
=1;

182 if(
	`Cuæ_øw_equÆ
("∑ssw‹d", 
tok
))

183 
°©e_∑ssw‹d
=1;

184 if(
	`Cuæ_øw_equÆ
("machöe", 
tok
)) {

186 
°©e
 = 
HOSTFOUND
;

187 
°©e_our_logö
 = 
FALSE
;

192 
tok
 = 
	`°πok_r
(
NULL
, " \t\n", &
tok_buf
);

196 
out
:

197 
	`f˛o£
(
fûe
);

200  
ªtcode
;

201 
	}
}

	@lib/netrc.h

1 #i‚de‡
HEADER_CURL_NETRC_H


2 
	#HEADER_CURL_NETRC_H


	)

26 
Cuæ_∑r£√åc
(c⁄° *
ho°
,

27 **
logöp
,

28 **
∑ssw‹dp
,

29 *
fûíame
);

	@lib/non-ascii.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
CURL_DOES_CONVERSIONS


27 
	~<cuæ/cuæ.h
>

29 
	~"n⁄-ascii.h
"

30 
	~"f‹md©a.h
"

31 
	~"£ndf.h
"

32 
	~"uæd©a.h
"

34 
	~"cuæ_mem‹y.h
"

36 
	~"memdebug.h
"

38 #ifde‡
HAVE_ICONV


39 
	~<ic⁄v.h
>

41 #i‚de‡
CURL_ICONV_CODESET_OF_NETWORK


42 
	#CURL_ICONV_CODESET_OF_NETWORK
 "ISO8859-1"

	)

44 #i‚de‡
CURL_ICONV_CODESET_FOR_UTF8


45 
	#CURL_ICONV_CODESET_FOR_UTF8
 "UTF-8"

	)

47 
	#ICONV_ERROR
 (
size_t
)-1

	)

54 
CURLcode
 
	$Cuæ_c⁄vît_˛⁄e
(
Sessi⁄H™dÀ
 *
d©a
,

55 c⁄° *
öd©a
,

56 
size_t
 
ösize
,

57 **
outbuf
)

59 *
c⁄vbuf
;

60 
CURLcode
 
ªsu…
;

62 
c⁄vbuf
 = 
	`mÆloc
(
ösize
);

63 if(!
c⁄vbuf
)

64  
CURLE_OUT_OF_MEMORY
;

66 
	`mem˝y
(
c⁄vbuf
, 
öd©a
, 
ösize
);

67 
ªsu…
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
d©a
, 
c⁄vbuf
, 
ösize
);

68 if(
ªsu…
) {

69 
	`‰ì
(
c⁄vbuf
);

70  
ªsu…
;

73 *
outbuf
 = 
c⁄vbuf
;

75  
CURLE_OK
;

76 
	}
}

82 
CURLcode
 
	$Cuæ_c⁄vît_to_√tw‹k
(
Sessi⁄H™dÀ
 *
d©a
,

83 *
buf„r
, 
size_t
 
Àngth
)

85 
CURLcode
 
rc
;

87 if(
d©a
->
£t
.
c⁄vt⁄ëw‹k
) {

89 
rc
 = 
d©a
->
£t
.
	`c⁄vt⁄ëw‹k
(
buf„r
, 
Àngth
);

90 if(
rc
 !
CURLE_OK
) {

91 
	`Áûf
(
d©a
,

93 ()
rc
, 
	`cuæ_ósy_°ªº‹
(rc));

95  
rc
;

98 #ifde‡
HAVE_ICONV


100 *
öput_±r
, *
ouçut_±r
;

101 
size_t
 
ö_byãs
, 
out_byãs
, 
rc
;

102 
îr‹
;

105 if(
d©a
->
outbound_cd
 =(
ic⁄v_t
)-1) {

106 
d©a
->
outbound_cd
 = 
	`ic⁄v_›í
(
CURL_ICONV_CODESET_OF_NETWORK
,

107 
CURL_ICONV_CODESET_OF_HOST
);

108 if(
d©a
->
outbound_cd
 =(
ic⁄v_t
)-1) {

109 
îr‹
 = 
ERRNO
;

110 
	`Áûf
(
d©a
,

112 
CURL_ICONV_CODESET_OF_NETWORK
,

113 
CURL_ICONV_CODESET_OF_HOST
,

114 
îr‹
, 
	`°ªº‹
(error));

115  
CURLE_CONV_FAILED
;

119 
öput_±r
 = 
ouçut_±r
 = 
buf„r
;

120 
ö_byãs
 = 
out_byãs
 = 
Àngth
;

121 
rc
 = 
	`ic⁄v
(
d©a
->
outbound_cd
, (c⁄° **)&
öput_±r
, &
ö_byãs
,

122 &
ouçut_±r
, &
out_byãs
);

123 if((
rc
 =
ICONV_ERROR
Ë|| (
ö_byãs
 != 0)) {

124 
îr‹
 = 
ERRNO
;

125 
	`Áûf
(
d©a
,

127 
îr‹
, 
	`°ªº‹
(error));

128  
CURLE_CONV_FAILED
;

131 
	`Áûf
(
d©a
, "CURLOPT_CONV_TO_NETWORK_FUNCTION callbackÑequired");

132  
CURLE_CONV_REQD
;

136  
CURLE_OK
;

137 
	}
}

143 
CURLcode
 
	$Cuæ_c⁄vît_‰om_√tw‹k
(
Sessi⁄H™dÀ
 *
d©a
,

144 *
buf„r
, 
size_t
 
Àngth
)

146 
CURLcode
 
rc
;

148 if(
d©a
->
£t
.
c⁄v‰om√tw‹k
) {

150 
rc
 = 
d©a
->
£t
.
	`c⁄v‰om√tw‹k
(
buf„r
, 
Àngth
);

151 if(
rc
 !
CURLE_OK
) {

152 
	`Áûf
(
d©a
,

154 ()
rc
, 
	`cuæ_ósy_°ªº‹
(rc));

156  
rc
;

159 #ifde‡
HAVE_ICONV


161 *
öput_±r
, *
ouçut_±r
;

162 
size_t
 
ö_byãs
, 
out_byãs
, 
rc
;

163 
îr‹
;

166 if(
d©a
->
öbound_cd
 =(
ic⁄v_t
)-1) {

167 
d©a
->
öbound_cd
 = 
	`ic⁄v_›í
(
CURL_ICONV_CODESET_OF_HOST
,

168 
CURL_ICONV_CODESET_OF_NETWORK
);

169 if(
d©a
->
öbound_cd
 =(
ic⁄v_t
)-1) {

170 
îr‹
 = 
ERRNO
;

171 
	`Áûf
(
d©a
,

173 
CURL_ICONV_CODESET_OF_HOST
,

174 
CURL_ICONV_CODESET_OF_NETWORK
,

175 
îr‹
, 
	`°ªº‹
(error));

176  
CURLE_CONV_FAILED
;

180 
öput_±r
 = 
ouçut_±r
 = 
buf„r
;

181 
ö_byãs
 = 
out_byãs
 = 
Àngth
;

182 
rc
 = 
	`ic⁄v
(
d©a
->
öbound_cd
, (c⁄° **)&
öput_±r
, &
ö_byãs
,

183 &
ouçut_±r
, &
out_byãs
);

184 if((
rc
 =
ICONV_ERROR
Ë|| (
ö_byãs
 != 0)) {

185 
îr‹
 = 
ERRNO
;

186 
	`Áûf
(
d©a
,

188 
îr‹
, 
	`°ªº‹
(error));

189  
CURLE_CONV_FAILED
;

192 
	`Áûf
(
d©a
, "CURLOPT_CONV_FROM_NETWORK_FUNCTION callbackÑequired");

193  
CURLE_CONV_REQD
;

197  
CURLE_OK
;

198 
	}
}

204 
CURLcode
 
	$Cuæ_c⁄vît_‰om_utf8
(
Sessi⁄H™dÀ
 *
d©a
,

205 *
buf„r
, 
size_t
 
Àngth
)

207 
CURLcode
 
rc
;

209 if(
d©a
->
£t
.
c⁄v‰omutf8
) {

211 
rc
 = 
d©a
->
£t
.
	`c⁄v‰omutf8
(
buf„r
, 
Àngth
);

212 if(
rc
 !
CURLE_OK
) {

213 
	`Áûf
(
d©a
,

215 ()
rc
, 
	`cuæ_ósy_°ªº‹
(rc));

217  
rc
;

220 #ifde‡
HAVE_ICONV


222 c⁄° *
öput_±r
;

223 *
ouçut_±r
;

224 
size_t
 
ö_byãs
, 
out_byãs
, 
rc
;

225 
îr‹
;

228 if(
d©a
->
utf8_cd
 =(
ic⁄v_t
)-1) {

229 
d©a
->
utf8_cd
 = 
	`ic⁄v_›í
(
CURL_ICONV_CODESET_OF_HOST
,

230 
CURL_ICONV_CODESET_FOR_UTF8
);

231 if(
d©a
->
utf8_cd
 =(
ic⁄v_t
)-1) {

232 
îr‹
 = 
ERRNO
;

233 
	`Áûf
(
d©a
,

235 
CURL_ICONV_CODESET_OF_HOST
,

236 
CURL_ICONV_CODESET_FOR_UTF8
,

237 
îr‹
, 
	`°ªº‹
(error));

238  
CURLE_CONV_FAILED
;

242 
öput_±r
 = 
ouçut_±r
 = 
buf„r
;

243 
ö_byãs
 = 
out_byãs
 = 
Àngth
;

244 
rc
 = 
	`ic⁄v
(
d©a
->
utf8_cd
, &
öput_±r
, &
ö_byãs
,

245 &
ouçut_±r
, &
out_byãs
);

246 if((
rc
 =
ICONV_ERROR
Ë|| (
ö_byãs
 != 0)) {

247 
îr‹
 = 
ERRNO
;

248 
	`Áûf
(
d©a
,

250 
îr‹
, 
	`°ªº‹
(error));

251  
CURLE_CONV_FAILED
;

253 if(
ouçut_±r
 < 
öput_±r
) {

255 *
ouçut_±r
 = 0x00;

258 
	`Áûf
(
d©a
, "CURLOPT_CONV_FROM_UTF8_FUNCTION callbackÑequired");

259  
CURLE_CONV_REQD
;

263  
CURLE_OK
;

264 
	}
}

269 
	$Cuæ_c⁄vît_öô
(
Sessi⁄H™dÀ
 *
d©a
)

271 #i‡
	`deföed
(
CURL_DOES_CONVERSIONS
Ë&& deföed(
HAVE_ICONV
)

273 
d©a
->
outbound_cd
 = (
ic⁄v_t
)-1;

274 
d©a
->
öbound_cd
 = (
ic⁄v_t
)-1;

275 
d©a
->
utf8_cd
 = (
ic⁄v_t
)-1;

277 ()
d©a
;

279 
	}
}

284 
	$Cuæ_c⁄vît_£tup
(
Sessi⁄H™dÀ
 *
d©a
)

286 
d©a
->
öbound_cd
 = 
	`ic⁄v_›í
(
CURL_ICONV_CODESET_OF_HOST
,

287 
CURL_ICONV_CODESET_OF_NETWORK
);

288 
d©a
->
outbound_cd
 = 
	`ic⁄v_›í
(
CURL_ICONV_CODESET_OF_NETWORK
,

289 
CURL_ICONV_CODESET_OF_HOST
);

290 
d©a
->
utf8_cd
 = 
	`ic⁄v_›í
(
CURL_ICONV_CODESET_OF_HOST
,

291 
CURL_ICONV_CODESET_FOR_UTF8
);

292 
	}
}

298 
	$Cuæ_c⁄vît_˛o£
(
Sessi⁄H™dÀ
 *
d©a
)

300 #ifde‡
HAVE_ICONV


302 if(
d©a
->
öbound_cd
 !(
ic⁄v_t
)-1) {

303 
	`ic⁄v_˛o£
(
d©a
->
öbound_cd
);

305 if(
d©a
->
outbound_cd
 !(
ic⁄v_t
)-1) {

306 
	`ic⁄v_˛o£
(
d©a
->
outbound_cd
);

308 if(
d©a
->
utf8_cd
 !(
ic⁄v_t
)-1) {

309 
	`ic⁄v_˛o£
(
d©a
->
utf8_cd
);

312 ()
d©a
;

314 
	}
}

320 
CURLcode
 
	$Cuæ_c⁄vît_f‹m
(
Sessi⁄H™dÀ
 *
d©a
, 
F‹mD©a
 *
f‹m
)

322 
F‹mD©a
 *
√xt
;

323 
CURLcode
 
rc
;

325 if(!
f‹m
)

326  
CURLE_OK
;

328 if(!
d©a
)

329  
CURLE_BAD_FUNCTION_ARGUMENT
;

332 
√xt
=
f‹m
->next;

333 if(
f‹m
->
ty≥
 =
FORM_DATA
) {

334 
rc
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
d©a
, 
f‹m
->
löe
, f‹m->
Àngth
);

336 if(
rc
 !
CURLE_OK
)

337  
rc
;

339 } (
f‹m
 = 
√xt
Ë!
NULL
);

340  
CURLE_OK
;

341 
	}
}

	@lib/non-ascii.h

1 #i‚de‡
HEADER_CURL_NON_ASCII_H


2 
	#HEADER_CURL_NON_ASCII_H


	)

24 
	~"cuæ_£tup.h
"

26 #ifde‡
CURL_DOES_CONVERSIONS


28 
	~"uæd©a.h
"

36 
CURLcode
 
Cuæ_c⁄vît_˛⁄e
(
Sessi⁄H™dÀ
 *
d©a
,

37 c⁄° *
öd©a
,

38 
size_t
 
ösize
,

39 **
outbuf
);

41 
Cuæ_c⁄vît_öô
(
Sessi⁄H™dÀ
 *
d©a
);

42 
Cuæ_c⁄vît_£tup
(
Sessi⁄H™dÀ
 *
d©a
);

43 
Cuæ_c⁄vît_˛o£
(
Sessi⁄H™dÀ
 *
d©a
);

45 
CURLcode
 
Cuæ_c⁄vît_to_√tw‹k
(
Sessi⁄H™dÀ
 *
d©a
,

46 *
buf„r
, 
size_t
 
Àngth
);

47 
CURLcode
 
Cuæ_c⁄vît_‰om_√tw‹k
(
Sessi⁄H™dÀ
 *
d©a
,

48 *
buf„r
, 
size_t
 
Àngth
);

49 
CURLcode
 
Cuæ_c⁄vît_‰om_utf8
(
Sessi⁄H™dÀ
 *
d©a
,

50 *
buf„r
, 
size_t
 
Àngth
);

51 
CURLcode
 
Cuæ_c⁄vît_f‹m
(
Sessi⁄H™dÀ
 *
d©a
, 
F‹mD©a
 *
f‹m
);

53 
	#Cuæ_c⁄vît_˛⁄e
(
a
,
b
,
c
,
d
Ë((Ô, 
CURLE_OK
)

	)

54 
	#Cuæ_c⁄vît_öô
(
x
Ë
Cuæ_n›_°mt


	)

55 
	#Cuæ_c⁄vît_£tup
(
x
Ë
Cuæ_n›_°mt


	)

56 
	#Cuæ_c⁄vît_˛o£
(
x
Ë
Cuæ_n›_°mt


	)

57 
	#Cuæ_c⁄vît_to_√tw‹k
(
a
,
b
,
c
Ë((Ô, 
CURLE_OK
)

	)

58 
	#Cuæ_c⁄vît_‰om_√tw‹k
(
a
,
b
,
c
Ë((Ô, 
CURLE_OK
)

	)

59 
	#Cuæ_c⁄vît_‰om_utf8
(
a
,
b
,
c
Ë((Ô, 
CURLE_OK
)

	)

60 
	#Cuæ_c⁄vît_f‹m
(
a
,
b
Ë
CURLE_OK


	)

	@lib/nonblock.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_SYS_IOCTL_H


26 
	~<sys/io˘l.h
>

28 #ifde‡
HAVE_FCNTL_H


29 
	~<f˙é.h
>

32 #i‡(
deföed
(
HAVE_IOCTL_FIONBIO
Ë&& deföed(
NETWARE
))

33 
	~<sys/fûio.h
>

35 #ifde‡
__VMS


36 
	~<ö.h
>

37 
	~<öë.h
>

40 
	~"n⁄block.h
"

47 
	$cuæx_n⁄block
(
cuæ_sockë_t
 
sockfd
,

48 
n⁄block
 )

50 #i‡
	`deföed
(
USE_BLOCKING_SOCKETS
)

54 #ñi‡
	`deföed
(
HAVE_FCNTL_O_NONBLOCK
)

57 
Êags
;

58 
Êags
 = 
	`sf˙é
(
sockfd
, 
F_GETFL
, 0);

59 if(
n⁄block
)

60  
	`sf˙é
(
sockfd
, 
F_SETFL
, 
Êags
 | 
O_NONBLOCK
);

62  
	`sf˙é
(
sockfd
, 
F_SETFL
, 
Êags
 & (~
O_NONBLOCK
));

64 #ñi‡
	`deföed
(
HAVE_IOCTL_FIONBIO
)

67 
Êags
 = 
n⁄block
 ? 1 : 0;

68  
	`io˘l
(
sockfd
, 
FIONBIO
, &
Êags
);

70 #ñi‡
	`deföed
(
HAVE_IOCTLSOCKET_FIONBIO
)

73 
Êags
 = 
n⁄block
 ? 1UL : 0UL;

74  
	`io˘lsockë
(
sockfd
, 
FIONBIO
, &
Êags
);

76 #ñi‡
	`deföed
(
HAVE_IOCTLSOCKET_CAMEL_FIONBIO
)

79 
Êags
 = 
n⁄block
 ? 1L : 0L;

80  
	`Io˘lSockë
(
sockfd
, 
FIONBIO
, 
Êags
);

82 #ñi‡
	`deföed
(
HAVE_SETSOCKOPT_SO_NONBLOCK
)

85 
b
 = 
n⁄block
 ? 1L : 0L;

86  
	`£tsock›t
(
sockfd
, 
SOL_SOCKET
, 
SO_NONBLOCK
, &
b
, (b));

91 
	}
}

	@lib/nonblock.h

1 #i‚de‡
HEADER_CURL_NONBLOCK_H


2 
	#HEADER_CURL_NONBLOCK_H


	)

25 
	~<cuæ/cuæ.h
>

27 
cuæx_n⁄block
(
cuæ_sockë_t
 
sockfd
,

28 
n⁄block
 );

	@lib/nwlib.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
NETWARE


27 #ifde‡
__NOVELL_LIBC__


29 
	~<libøry.h
>

30 
	~<√tw¨e.h
>

31 
	~<s¸ìn.h
>

32 
	~<nks/thªad.h
>

33 
	~<nks/synch.h
>

35 
	~"cuæ_mem‹y.h
"

37 
	~"memdebug.h
"

41 
	m_î∫o
;

42 *
	mtwítybyãs
;

43 } 
	tlibthªadd©a_t
;

47 
	mx
;

48 
	my
;

49 
	mz
;

50 *
	mãnbyãs
;

51 
NXKey_t
 
	m≥πhªadkey
;

52 
NXMuãx_t
 *
	mlock
;

53 } 
	tlibd©a_t
;

55 
	ggLibId
 = -1;

56 *
	ggLibH™dÀ
 = (*Ë
NULL
;

57 
πag_t
 
	ggAŒocTag
 = (πag_tË
NULL
;

58 
NXMuãx_t
 *
	ggLibLock
 = (NXMuãx_à*Ë
NULL
;

61 
Di•o£LibøryD©a
( * );

62 
Di•o£ThªadD©a
( * );

63 
GëOrSëUpD©a
–
id
, 
libd©a_t
 **
d©a
, 
libthªadd©a_t
 **
thªadd©a
 );

66 
_N⁄AµSèπ
–*
NLMH™dÀ
,

67 *
îr‹S¸ìn
,

68 c⁄° *
cmdLöe
,

69 c⁄° *
lﬂdDúP©h
,

70 
size_t
 
unöôülizedD©aLígth
,

71 *
NLMFûeH™dÀ
,

72 (*
ªadRoutöeP
)–
c⁄n
,

73 *
fûeH™dÀ
, 
size_t
 
off£t
,

74 
size_t
 
nbyãs
,

75 
size_t
 *
byãsRód
,

76 *
buf„r
 ),

77 
size_t
 
cu°omD©aOff£t
,

78 
size_t
 
cu°omD©aSize
,

79 
mesßgeCou¡
,

80 c⁄° **
mesßges
 )

82 
	`NX_LOCK_INFO_ALLOC
(
liblock
, "Per-Application Data Lock", 0);

84 #i‚de‡
__GNUC__


85 #¥agm®
	`unu£d
(
cmdLöe
)

86 #¥agm®
	`unu£d
(
lﬂdDúP©h
)

87 #¥agm®
	`unu£d
(
unöôülizedD©aLígth
)

88 #¥agm®
	`unu£d
(
NLMFûeH™dÀ
)

89 #¥agm®
	`unu£d
(
ªadRoutöeP
)

90 #¥agm®
	`unu£d
(
cu°omD©aOff£t
)

91 #¥agm®
	`unu£d
(
cu°omD©aSize
)

92 #¥agm®
	`unu£d
(
mesßgeCou¡
)

93 #¥agm®
	`unu£d
(
mesßges
)

102 
gAŒocTag
 = 
	`AŒoˇãResour˚Tag
(
NLMH™dÀ
,

104 
AŒocSig«tuª
);

106 if(!
gAŒocTag
) {

107 
	`OuçutToS¸ìn
(
îr‹S¸ìn
, "UnableÅoállocateÑesourceÅag for "

112 
gLibId
 = 
	`ªgi°î_libøry
(
Di•o£LibøryD©a
);

114 if(
gLibId
 < -1) {

115 
	`OuçutToS¸ìn
(
îr‹S¸ìn
, "UnableÅoÑegisterÜibrary with kernel.\n");

119 
gLibH™dÀ
 = 
NLMH™dÀ
;

121 
gLibLock
 = 
	`NXMuãxAŒoc
(0, 0, &
liblock
);

123 if(!
gLibLock
) {

124 
	`OuçutToS¸ìn
(
îr‹S¸ìn
, "UnableÅoállocateÜibrary dataÜock.\n");

129 
	}
}

135 
	$_N⁄AµSt›
( )

137 (Ë
	`uƒegi°î_libøry
(
gLibId
);

138 
	`NXMuãxFªe
(
gLibLock
);

139 
	}
}

152 
	$_N⁄AµCheckU∆ﬂd
( )

155 
	}
}

157 
	$GëOrSëUpD©a
(
id
, 
libd©a_t
 **
≠pD©a
,

158 
libthªadd©a_t
 **
thªadD©a
 )

160 
îr
;

161 
libd©a_t
 *
≠p_d©a
;

162 
libthªadd©a_t
 *
thªad_d©a
;

163 
NXKey_t
 
key
;

164 
	`NX_LOCK_INFO_ALLOC
(
liblock
, "Application Data Lock", 0);

166 
îr
 = 0;

167 
thªad_d©a
 = (
libthªadd©a_t
 *Ë
NULL
;

174 
≠p_d©a
 = (
libd©a_t
 *Ë
	`gë_≠p_d©a
(
id
);

176 if(!
≠p_d©a
) {

185 
	`NXLock
(
gLibLock
);

187 if(!(
≠p_d©a
 = (
libd©a_t
 *Ë
	`gë_≠p_d©a
(
id
))) {

188 
≠p_d©a
 = 
	`mÆloc
((
libd©a_t
));

190 if(
≠p_d©a
) {

191 
	`mem£t
(
≠p_d©a
, 0, (
libd©a_t
));

193 
≠p_d©a
->
ãnbyãs
 = 
	`mÆloc
(10);

194 
≠p_d©a
->
lock
 = 
	`NXMuãxAŒoc
(0, 0, &
liblock
);

196 if(!
≠p_d©a
->
ãnbyãs
 || !≠p_d©a->
lock
) {

197 if(
≠p_d©a
->
lock
)

198 
	`NXMuãxFªe
(
≠p_d©a
->
lock
);

200 
	`‰ì
(
≠p_d©a
);

201 
≠p_d©a
 = (
libd©a_t
 *Ë
NULL
;

202 
îr
 = 
ENOMEM
;

205 if(
≠p_d©a
) {

214 
îr
 = 
	`£t_≠p_d©a
(
gLibId
, 
≠p_d©a
);

216 if(
îr
) {

217 
	`‰ì
(
≠p_d©a
);

218 
≠p_d©a
 = (
libd©a_t
 *Ë
NULL
;

219 
îr
 = 
ENOMEM
;

223 
îr
 = 
	`NXKeyCª©e
(
Di•o£ThªadD©a
, (*Ë
NULL
, &
key
);

225 if(
îr
)

226 
key
 = -1;

228 
≠p_d©a
->
≥πhªadkey
 = 
key
;

234 
	`NXU∆ock
(
gLibLock
);

237 if(
≠p_d©a
) {

238 
key
 = 
≠p_d©a
->
≥πhªadkey
;

240 if(
key
 != -1

241 && !(
îr
 = 
	`NXKeyGëVÆue
(
key
, (**Ë&
thªad_d©a
))

242 && !
thªad_d©a
) {

250 
thªad_d©a
 = 
	`mÆloc
((
libthªadd©a_t
));

252 if(
thªad_d©a
) {

253 
thªad_d©a
->
_î∫o
 = 0;

254 
thªad_d©a
->
twítybyãs
 = 
	`mÆloc
(20);

256 if(!
thªad_d©a
->
twítybyãs
) {

257 
	`‰ì
(
thªad_d©a
);

258 
thªad_d©a
 = (
libthªadd©a_t
 *Ë
NULL
;

259 
îr
 = 
ENOMEM
;

262 if((
îr
 = 
	`NXKeySëVÆue
(
key
, 
thªad_d©a
))) {

263 
	`‰ì
(
thªad_d©a
->
twítybyãs
);

264 
	`‰ì
(
thªad_d©a
);

265 
thªad_d©a
 = (
libthªadd©a_t
 *Ë
NULL
;

271 if(
≠pD©a
)

272 *
≠pD©a
 = 
≠p_d©a
;

274 if(
thªadD©a
)

275 *
thªadD©a
 = 
thªad_d©a
;

277  
îr
;

278 
	}
}

280 
	$Di•o£LibøryD©a
–*
d©a
 )

282 if(
d©a
) {

283 *
ãnbyãs
 = ((
libd©a_t
 *Ë
d©a
)->tenbytes;

285 if(
ãnbyãs
)

286 
	`‰ì
(
ãnbyãs
);

288 
	`‰ì
(
d©a
);

292 
	}
}

294 
	$Di•o£ThªadD©a
–*
d©a
 )

296 if(
d©a
) {

297 *
twítybyãs
 = ((
libthªadd©a_t
 *Ë
d©a
)->twentybytes;

299 if(
twítybyãs
)

300 
	`‰ì
(
twítybyãs
);

302 
	`‰ì
(
d©a
);

304 
	}
}

308 
	~<nwthªad.h
>

310 
	$maö
 ( )

317 
	`ExôThªad
 (
TSR_THREAD
, 0);

319 
	}
}

325 #ifde‡
__POCC__


326 #¥agm®
w¨n
(
dißbÀ
:2024)

	@lib/nwos.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
NETWARE


27 #ifde‡
__NOVELL_LIBC__


29 
	$√tw¨e_öô
 ( )

32 
	}
}

37 
	~<nwn•a˚.h
>

38 
	~<nwthªad.h
>

39 
	~<nwadv.h
>

41 
	~<√tdb.h
>

42 
	gNETDB_DEFINE_CONTEXT


44 
	~<√töë/ö.h
>

45 
	~<¨∑/öë.h
>

46 
NETINET_DEFINE_CONTEXT


48 
	$√tw¨e_öô
 ( )

50 
rc
 = 0;

51 
myH™dÀ
 = 
	`GëNLMH™dÀ
();

53 (*
pUnAugmítA°îisk
)() = ((*)())

54 
	`Imp‹tSymbﬁ
(
myH™dÀ
, "UnAugmentAsterisk");

56 (*
pU£AccuøãCa£F‹P©hs
)() = ((*)())

57 
	`Imp‹tSymbﬁ
(
myH™dÀ
, "UseAccurateCaseForPaths");

58 if(
pUnAugmítA°îisk
)

59 
	`pUnAugmítA°îisk
(1);

60 if(
pU£AccuøãCa£F‹P©hs
)

61 
	`pU£AccuøãCa£F‹P©hs
(1);

62 
	`Unimp‹tSymbﬁ
(
myH™dÀ
, "UnAugmentAsterisk");

63 
	`Unimp‹tSymbﬁ
(
myH™dÀ
, "UseAccurateCaseForPaths");

65 if((
	`SëCuºítNameS∑˚
(4) == 255)) {

66 
rc
 = 1;

68 if((
	`SëT¨gëNameS∑˚
(4) == 255)) {

69 
rc
 =Ñc + 2;

71  
rc
;

72 
	}
}

75 
	$__öô_ívú⁄mít
 ( )

78 
	}
}

81 
	$__deöô_ívú⁄mít
 ( )

84 
	}
}

	@lib/openldap.c

24 
	~"cuæ_£tup.h
"

26 #i‡!
deföed
(
CURL_DISABLE_LDAP
Ë&& deföed(
USE_OPENLDAP
)

39 
	~<ld≠.h
>

41 
	~"uæd©a.h
"

42 
	~<cuæ/cuæ.h
>

43 
	~"£ndf.h
"

44 
	~"vés/vés.h
"

45 
	~"å™s„r.h
"

46 
	~"cuæ_ld≠.h
"

47 
	~"cuæ_mem‹y.h
"

48 
	~"cuæ_ba£64.h
"

49 
	~"c⁄√˘.h
"

51 
	#_MPRINTF_REPLACE


	)

52 
	~<cuæ/m¥ötf.h
>

54 
	~"memdebug.h
"

56 #i‚de‡
_LDAP_PVT_H


57 
ld≠_pvt_uæ_scheme2¥Ÿo
(const *);

58 
ld≠_öô_fd
(
bî_sockë_t
 
fd
, 
¥Ÿo
, c⁄° *
uæ
,

59 
LDAP
 **
ld
);

62 
CURLcode
 
ld≠_£tup
(
c⁄√˘d©a
 *
c⁄n
);

63 
CURLcode
 
ld≠_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

64 
CURLcode
 
ld≠_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, CURLcode, 
boﬁ
);

65 
CURLcode
 
ld≠_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

66 
CURLcode
 
ld≠_c⁄√˘ög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

67 
CURLcode
 
ld≠_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód
);

69 
Cuæ_ªcv
 
	gld≠_ªcv
;

75 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_ld≠
 = {

77 
ld≠_£tup
,

78 
ld≠_do
,

79 
ld≠_d⁄e
,

80 
ZERO_NULL
,

81 
ld≠_c⁄√˘
,

82 
ld≠_c⁄√˘ög
,

83 
ZERO_NULL
,

84 
ZERO_NULL
,

85 
ZERO_NULL
,

86 
ZERO_NULL
,

87 
ZERO_NULL
,

88 
ld≠_disc⁄√˘
,

89 
ZERO_NULL
,

90 
PORT_LDAP
,

91 
CURLPROTO_LDAP
,

92 
PROTOPT_NONE


95 #ifde‡
USE_SSL


100 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_ld≠s
 = {

102 
ld≠_£tup
,

103 
ld≠_do
,

104 
ld≠_d⁄e
,

105 
ZERO_NULL
,

106 
ld≠_c⁄√˘
,

107 
ld≠_c⁄√˘ög
,

108 
ZERO_NULL
,

109 
ZERO_NULL
,

110 
ZERO_NULL
,

111 
ZERO_NULL
,

112 
ZERO_NULL
,

113 
ld≠_disc⁄√˘
,

114 
ZERO_NULL
,

115 
PORT_LDAPS
,

116 
CURLPROTO_LDAP
,

117 
PROTOPT_SSL


121 c⁄° *
	guæ_îrs
[] = {

135 
	sld≠c⁄nöfo
 {

136 
LDAP
 *
	mld
;

137 
Cuæ_ªcv
 *
	mªcv
;

138 
Cuæ_£nd
 *
	m£nd
;

139 
	m¥Ÿo
;

140 
	mmsgid
;

141 
boﬁ
 
	ms¶d⁄e
;

142 
boﬁ
 
	ms¶ö°
;

143 
boﬁ
 
	mdidböd
;

144 } 
	tld≠c⁄nöfo
;

146 
	sld≠ªqöfo
 {

147 
	mmsgid
;

148 
	mnumít
;

149 } 
	tld≠ªqöfo
;

151 
CURLcode
 
	$ld≠_£tup
(
c⁄√˘d©a
 *
c⁄n
)

153 
ld≠c⁄nöfo
 *
li
;

154 
LDAPURLDesc
 *
lud
;

155 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

156 
rc
, 
¥Ÿo
;

157 
CURLcode
 
°©us
;

159 
rc
 = 
	`ld≠_uæ_∑r£
(
d©a
->
ch™ge
.
uæ
, &
lud
);

160 if(
rc
 !
LDAP_URL_SUCCESS
) {

161 c⁄° *
msg
 = "urlÖarsingÖroblem";

162 
°©us
 = 
CURLE_URL_MALFORMAT
;

163 if(
rc
 > 
LDAP_URL_SUCCESS
 &&Ñ¯<
LDAP_URL_ERR_BADEXTS
) {

164 if(
rc
 =
LDAP_URL_ERR_MEM
)

165 
°©us
 = 
CURLE_OUT_OF_MEMORY
;

166 
msg
 = 
uæ_îrs
[
rc
];

168 
	`Áûf
(
c⁄n
->
d©a
, "LDAPÜoˇl: %s", 
msg
);

169  
°©us
;

171 
¥Ÿo
 = 
	`ld≠_pvt_uæ_scheme2¥Ÿo
(
lud
->
lud_scheme
);

172 
	`ld≠_‰ì_uædesc
(
lud
);

174 
li
 = 
	`ˇŒoc
(1, (
ld≠c⁄nöfo
));

175 if(!
li
)

176  
CURLE_OUT_OF_MEMORY
;

177 
li
->
¥Ÿo
 =Öroto;

178 
c⁄n
->
¥Ÿo
.
gíîic
 = 
li
;

179 
	`c⁄nkìp
(
c⁄n
, "OpenLDAP default");

183  
CURLE_OK
;

184 
	}
}

186 #ifde‡
USE_SSL


187 
Sockbuf_IO
 
	gld≠sb_és
;

190 
CURLcode
 
	$ld≠_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

192 
ld≠c⁄nöfo
 *
li
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

193 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

194 
rc
, 
¥Ÿo
 = 
LDAP_VERSION3
;

195 
ho°uæ
[1024], *
±r
;

196 ()
d⁄e
;

198 
	`°r˝y
(
ho°uæ
, "ldap");

199 
±r
 = 
ho°uæ
+4;

200 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
)

201 *
±r
++ = 's';

202 
	`¢¥ötf
(
±r
, (
ho°uæ
)-(ptr-hosturl), "://%s:%d",

203 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

205 
rc
 = 
	`ld≠_öô_fd
(
c⁄n
->
sock
[
FIRSTSOCKET
], 
li
->
¥Ÿo
, 
ho°uæ
, &li->
ld
);

206 if(
rc
) {

207 
	`Áûf
(
d©a
, "LDAPÜocal: Cannot connectÅo %s, %s",

208 
ho°uæ
, 
	`ld≠_îr2°rög
(
rc
));

209  
CURLE_COULDNT_CONNECT
;

212 
	`ld≠_£t_›ti⁄
(
li
->
ld
, 
LDAP_OPT_PROTOCOL_VERSION
, &
¥Ÿo
);

214 #ifde‡
USE_SSL


215 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
) {

216 
CURLcode
 
ªs
;

217 
ªs
 = 
	`Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄n
, 
FIRSTSOCKET
, &
li
->
s¶d⁄e
);

218 if(
ªs
)

219  
ªs
;

223  
CURLE_OK
;

224 
	}
}

226 
CURLcode
 
	$ld≠_c⁄√˘ög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

228 
ld≠c⁄nöfo
 *
li
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

229 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

230 
LDAPMesßge
 *
ªsu…
 = 
NULL
;

231 
timevÆ
 
tv
 = {0,1}, *
tvp
;

232 
rc
, 
îr
;

233 *
öfo
 = 
NULL
;

235 #ifde‡
USE_SSL


236 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
) {

238 if(!
li
->
s¶d⁄e
) {

239 
CURLcode
 
ªs
 = 
	`Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄n
, 
FIRSTSOCKET
,

240 &
li
->
s¶d⁄e
);

241 if(
ªs
 || !
li
->
s¶d⁄e
)

242  
ªs
;

245 if(!
li
->
s¶ö°
) {

246 
Sockbuf
 *
sb
;

247 
	`ld≠_gë_›ti⁄
(
li
->
ld
, 
LDAP_OPT_SOCKBUF
, &
sb
);

248 
	`bî_sockbuf_add_io
(
sb
, &
ld≠sb_és
, 
LBER_SBIOD_LEVEL_TRANSPORT
, 
c⁄n
);

249 
li
->
s¶ö°
 = 
TRUE
;

250 
li
->
ªcv
 = 
c⁄n
->ªcv[
FIRSTSOCKET
];

251 
li
->
£nd
 = 
c⁄n
->£nd[
FIRSTSOCKET
];

256 
tvp
 = &
tv
;

258 
ªåy
:

259 if(!
li
->
didböd
) {

260 *
böddn
;

261 
bîvÆ
 
∑sswd
;

263 if(
c⁄n
->
bôs
.
u£r_∑sswd
) {

264 
böddn
 = 
c⁄n
->
u£r
;

265 
∑sswd
.
bv_vÆ
 = 
c⁄n
->passwd;

266 
∑sswd
.
bv_Àn
 = 
	`°æí
’asswd.
bv_vÆ
);

269 
böddn
 = 
NULL
;

270 
∑sswd
.
bv_vÆ
 = 
NULL
;

271 
∑sswd
.
bv_Àn
 = 0;

273 
rc
 = 
	`ld≠_ß¶_böd
(
li
->
ld
, 
böddn
, 
LDAP_SASL_SIMPLE
, &
∑sswd
,

274 
NULL
, NULL, &
li
->
msgid
);

275 if(
rc
)

276  
CURLE_LDAP_CANNOT_BIND
;

277 
li
->
didböd
 = 
TRUE
;

278 if(
tvp
)

279  
CURLE_OK
;

282 
rc
 = 
	`ld≠_ªsu…
(
li
->
ld
,Üi->
msgid
, 
LDAP_MSG_ONE
, 
tvp
, &
ªsu…
);

283 if(
rc
 < 0) {

284 
	`Áûf
(
d©a
, "LDAPÜoˇl: bödÜd≠_ªsu… %s", 
	`ld≠_îr2°rög
(
rc
));

285  
CURLE_LDAP_CANNOT_BIND
;

287 if(
rc
 == 0) {

289  
CURLE_OK
;

291 
rc
 = 
	`ld≠_∑r£_ªsu…
(
li
->
ld
, 
ªsu…
, &
îr
, 
NULL
, &
öfo
, NULL, NULL, 1);

292 if(
rc
) {

293 
	`Áûf
(
d©a
, "LDAPÜoˇl: bödÜd≠_∑r£_ªsu… %s", 
	`ld≠_îr2°rög
(
rc
));

294  
CURLE_LDAP_CANNOT_BIND
;

297 if(
îr
 =
LDAP_PROTOCOL_ERROR
) {

298 
¥Ÿo
;

299 
	`ld≠_gë_›ti⁄
(
li
->
ld
, 
LDAP_OPT_PROTOCOL_VERSION
, &
¥Ÿo
);

300 if(
¥Ÿo
 =
LDAP_VERSION3
) {

301 if(
öfo
) {

302 
	`ld≠_mem‰ì
(
öfo
);

303 
öfo
 = 
NULL
;

305 
¥Ÿo
 = 
LDAP_VERSION2
;

306 
	`ld≠_£t_›ti⁄
(
li
->
ld
, 
LDAP_OPT_PROTOCOL_VERSION
, &
¥Ÿo
);

307 
li
->
didböd
 = 
FALSE
;

308 
ªåy
;

312 if(
îr
) {

313 
	`Áûf
(
d©a
, "LDAPÑemŸe: böd faûed %†%s", 
	`ld≠_îr2°rög
(
rc
),

314 
öfo
 ? info : "");

315 if(
öfo
)

316 
	`ld≠_mem‰ì
(
öfo
);

317  
CURLE_LOGIN_DENIED
;

320 if(
öfo
)

321 
	`ld≠_mem‰ì
(
öfo
);

322 
c⁄n
->
ªcv
[
FIRSTSOCKET
] = 
ld≠_ªcv
;

323 *
d⁄e
 = 
TRUE
;

324  
CURLE_OK
;

325 
	}
}

327 
CURLcode
 
	$ld≠_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
)

329 
ld≠c⁄nöfo
 *
li
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

330 (Ë
dód_c⁄√˘i⁄
;

332 if(
li
) {

333 if(
li
->
ld
) {

334 
	`ld≠_unböd_ext
(
li
->
ld
, 
NULL
, NULL);

335 
li
->
ld
 = 
NULL
;

337 
c⁄n
->
¥Ÿo
.
gíîic
 = 
NULL
;

338 
	`‰ì
(
li
);

340  
CURLE_OK
;

341 
	}
}

343 
CURLcode
 
	$ld≠_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

345 
ld≠c⁄nöfo
 *
li
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

346 
ld≠ªqöfo
 *
Ã
;

347 
CURLcode
 
°©us
 = 
CURLE_OK
;

348 
rc
 = 0;

349 
LDAPURLDesc
 *
ludp
 = 
NULL
;

350 
msgid
;

351 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

353 
	`c⁄nkìp
(
c⁄n
, "OpenLDAP do");

355 
	`öfof
(
d©a
, "LDAPÜoˇl: %s\n", d©a->
ch™ge
.
uæ
);

357 
rc
 = 
	`ld≠_uæ_∑r£
(
d©a
->
ch™ge
.
uæ
, &
ludp
);

358 if(
rc
 !
LDAP_URL_SUCCESS
) {

359 c⁄° *
msg
 = "urlÖarsingÖroblem";

360 
°©us
 = 
CURLE_URL_MALFORMAT
;

361 if(
rc
 > 
LDAP_URL_SUCCESS
 &&Ñ¯<
LDAP_URL_ERR_BADEXTS
) {

362 if(
rc
 =
LDAP_URL_ERR_MEM
)

363 
°©us
 = 
CURLE_OUT_OF_MEMORY
;

364 
msg
 = 
uæ_îrs
[
rc
];

366 
	`Áûf
(
c⁄n
->
d©a
, "LDAPÜoˇl: %s", 
msg
);

367  
°©us
;

370 
rc
 = 
	`ld≠_£¨ch_ext
(
li
->
ld
, 
ludp
->
lud_dn
,Üudp->
lud_sc›e
,

371 
ludp
->
lud_fûãr
,Üudp->
lud_©ås
, 0,

372 
NULL
, NULL, NULL, 0, &
msgid
);

373 
	`ld≠_‰ì_uædesc
(
ludp
);

374 if(
rc
 !
LDAP_SUCCESS
) {

375 
	`Áûf
(
d©a
, "LDAPÜoˇl:Üd≠_£¨ch_exà%s", 
	`ld≠_îr2°rög
(
rc
));

376  
CURLE_LDAP_SEARCH_FAILED
;

378 
Ã
 = 
	`ˇŒoc
(1,(
ld≠ªqöfo
));

379 if(!
Ã
)

380  
CURLE_OUT_OF_MEMORY
;

381 
Ã
->
msgid
 = msgid;

382 
d©a
->
ªq
.
¥Ÿ›
 = 
Ã
;

383 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
FALSE
, 
NULL
, -1, NULL);

384 *
d⁄e
 = 
TRUE
;

385  
CURLE_OK
;

386 
	}
}

388 
CURLcode
 
	$ld≠_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
ªs
,

389 
boﬁ
 
¥em©uª
)

391 
ld≠ªqöfo
 *
Ã
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

392 ()
ªs
;

393 ()
¥em©uª
;

395 if(
Ã
) {

397 if(
Ã
->
msgid
) {

398 
ld≠c⁄nöfo
 *
li
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

399 
	`ld≠_ab™d⁄_ext
(
li
->
ld
, 
Ã
->
msgid
, 
NULL
, NULL);

400 
Ã
->
msgid
 = 0;

402 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
 = 
NULL
;

403 
	`‰ì
(
Ã
);

405  
CURLE_OK
;

406 
	}
}

408 
ssize_t
 
	$ld≠_ªcv
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
, *
buf
,

409 
size_t
 
Àn
, 
CURLcode
 *
îr
)

411 
ld≠c⁄nöfo
 *
li
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

412 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

413 
ld≠ªqöfo
 *
Ã
 = 
d©a
->
ªq
.
¥Ÿ›
;

414 
rc
, 
ªt
;

415 
LDAPMesßge
 *
ªsu…
 = 
NULL
;

416 
LDAPMesßge
 *
ít
;

417 
BîEÀmít
 *
bî
 = 
NULL
;

418 
timevÆ
 
tv
 = {0,1};

419 ()
Àn
;

420 ()
buf
;

421 ()
socködex
;

423 
rc
 = 
	`ld≠_ªsu…
(
li
->
ld
, 
Ã
->
msgid
, 
LDAP_MSG_RECEIVED
, &
tv
, &
ªsu…
);

424 if(
rc
 < 0) {

425 
	`Áûf
(
d©a
, "LDAPÜoˇl: sórchÜd≠_ªsu… %s", 
	`ld≠_îr2°rög
(
rc
));

426 *
îr
 = 
CURLE_RECV_ERROR
;

430 *
îr
 = 
CURLE_AGAIN
;

431 
ªt
 = -1;

434 if(
ªsu…
 =
NULL
)

435  
ªt
;

437 
ít
 = 
	`ld≠_fú°_mesßge
(
li
->
ld
, 
ªsu…
);Ént;

438 
ít
 = 
	`ld≠_√xt_mesßge
(
li
->
ld
,Ént)) {

439 
bîvÆ
 
bv
, *
bvÆs
, **
bvp
 = &bvals;

440 
bö¨y
 = 0, 
msgty≥
;

442 
msgty≥
 = 
	`ld≠_msgty≥
(
ít
);

443 if(
msgty≥
 =
LDAP_RES_SEARCH_RESULT
) {

444 
code
;

445 *
öfo
 = 
NULL
;

446 
rc
 = 
	`ld≠_∑r£_ªsu…
(
li
->
ld
, 
ít
, &
code
, 
NULL
, &
öfo
, NULL, NULL, 0);

447 if(
rc
) {

448 
	`Áûf
(
d©a
, "LDAPÜocal: searchÜdap_parse_result %s",

449 
	`ld≠_îr2°rög
(
rc
));

450 *
îr
 = 
CURLE_LDAP_SEARCH_FAILED
;

452 if(
code
 && codê!
LDAP_SIZELIMIT_EXCEEDED
) {

453 
	`Áûf
(
d©a
, "LDAPÑemŸe: sórch faûed %†%s", 
	`ld≠_îr2°rög
(
rc
),

454 
öfo
 ? info : "");

455 *
îr
 = 
CURLE_LDAP_SEARCH_FAILED
;

459 if(
code
 =
LDAP_SIZELIMIT_EXCEEDED
)

460 
	`öfof
(
d©a
, "Thîê¨êm‹êth™ %dÉ¡rõs\n", 
Ã
->
numít
);

461 
d©a
->
ªq
.
size
 = d©a->ªq.
byãcou¡
;

462 *
îr
 = 
CURLE_OK
;

463 
ªt
 = 0;

465 
Ã
->
msgid
 = 0;

466 
	`ld≠_mem‰ì
(
öfo
);

469 if(
msgty≥
 !
LDAP_RES_SEARCH_ENTRY
)

472 
Ã
->
numít
++;

473 
rc
 = 
	`ld≠_gë_dn_bî
(
li
->
ld
, 
ít
, &
bî
, &
bv
);

474 if(
rc
 < 0) {

477 *
îr
 = 
CURLE_RECV_ERROR
;

480 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"DN: ", 4);

481 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)
bv
.
bv_vÆ
, bv.
bv_Àn
);

482 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"\n", 1);

483 
d©a
->
ªq
.
byãcou¡
 +
bv
.
bv_Àn
 + 5;

485 
rc
 = 
	`ld≠_gë_©åibuã_bî
(
li
->
ld
, 
ít
, 
bî
, &
bv
, 
bvp
);

486 
rc
 =
LDAP_SUCCESS
;

487 
rc
 = 
	`ld≠_gë_©åibuã_bî
(
li
->
ld
, 
ít
, 
bî
, &
bv
, 
bvp
)) {

488 
i
;

490 if(
bv
.
bv_vÆ
 =
NULL
) ;

492 if(
bv
.
bv_Àn
 > 7 && !
	`°∫cmp
(bv.
bv_vÆ
 + bv.bv_len - 7, ";binary", 7))

493 
bö¨y
 = 1;

495 
bö¨y
 = 0;

497 
i
=0; 
bvÆs
[i].
bv_vÆ
 !
NULL
; i++) {

498 
bövÆ
 = 0;

499 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"\t", 1);

500 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)
bv
.
bv_vÆ
,

501 
bv
.
bv_Àn
);

502 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)":", 1);

503 
d©a
->
ªq
.
byãcou¡
 +
bv
.
bv_Àn
 + 2;

505 if(!
bö¨y
) {

507 if(
	`ISSPACE
(
bvÆs
[
i
].
bv_vÆ
[0]) ||

508 
	`ISSPACE
(
bvÆs
[
i
].
bv_vÆ
[bvÆs[i].
bv_Àn
-1]))

509 
bövÆ
 = 1;

512 
j
;

513 
j
=0; j<
bvÆs
[
i
].
bv_Àn
; j++)

514 if(!
	`ISPRINT
(
bvÆs
[
i
].
bv_vÆ
[
j
])) {

515 
bövÆ
 = 1;

520 if(
bö¨y
 || 
bövÆ
) {

521 *
vÆ_b64
 = 
NULL
;

522 
size_t
 
vÆ_b64_sz
 = 0;

524 
CURLcode
 
îr‹
 = 
	`Cuæ_ba£64_ícode
(
d©a
,

525 
bvÆs
[
i
].
bv_vÆ
,

526 
bvÆs
[
i
].
bv_Àn
,

527 &
vÆ_b64
,

528 &
vÆ_b64_sz
);

529 if(
îr‹
) {

530 
	`bî_mem‰ì
(
bvÆs
);

531 
	`bî_‰ì
(
bî
, 0);

532 
	`ld≠_msg‰ì
(
ªsu…
);

533 *
îr
 = 
îr‹
;

536 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)": ", 2);

537 
d©a
->
ªq
.
byãcou¡
 += 2;

538 if(
vÆ_b64_sz
 > 0) {

539 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
vÆ_b64
, 
vÆ_b64_sz
);

540 
	`‰ì
(
vÆ_b64
);

541 
d©a
->
ªq
.
byãcou¡
 +
vÆ_b64_sz
;

545 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)" ", 1);

546 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
bvÆs
[
i
].
bv_vÆ
,

547 
bvÆs
[
i
].
bv_Àn
);

548 
d©a
->
ªq
.
byãcou¡
 +
bvÆs
[
i
].
bv_Àn
 + 1;

550 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"\n", 0);

551 
d©a
->
ªq
.
byãcou¡
++;

553 
	`bî_mem‰ì
(
bvÆs
);

554 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"\n", 0);

555 
d©a
->
ªq
.
byãcou¡
++;

557 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)"\n", 0);

558 
d©a
->
ªq
.
byãcou¡
++;

559 
	`bî_‰ì
(
bî
, 0);

561 
	`ld≠_msg‰ì
(
ªsu…
);

562  
ªt
;

563 
	}
}

565 #ifde‡
USE_SSL


567 
	$ld≠sb_és_£tup
(
Sockbuf_IO_Desc
 *
sbiod
, *
¨g
)

569 
sbiod
->
sbiod_pvt
 = 
¨g
;

571 
	}
}

574 
	$ld≠sb_és_ªmove
(
Sockbuf_IO_Desc
 *
sbiod
)

576 
sbiod
->
sbiod_pvt
 = 
NULL
;

578 
	}
}

582 
	$ld≠sb_és_˛o£
(
Sockbuf_IO_Desc
 *
sbiod
)

584 ()
sbiod
;

586 
	}
}

589 
	$ld≠sb_és_˘æ
(
Sockbuf_IO_Desc
 *
sbiod
, 
›t
, *
¨g
)

591 ()
¨g
;

592 if(
›t
 =
LBER_SB_OPT_DATA_READY
) {

593 
c⁄√˘d©a
 *
c⁄n
 = 
sbiod
->
sbiod_pvt
;

594  
	`Cuæ_s¶_d©a_≥ndög
(
c⁄n
, 
FIRSTSOCKET
);

597 
	}
}

599 
bî_¶í_t


600 
	$ld≠sb_és_ªad
(
Sockbuf_IO_Desc
 *
sbiod
, *
buf
, 
bî_Àn_t
 
Àn
)

602 
c⁄√˘d©a
 *
c⁄n
 = 
sbiod
->
sbiod_pvt
;

603 
ld≠c⁄nöfo
 *
li
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

604 
bî_¶í_t
 
ªt
;

605 
CURLcode
 
îr
 = 
CURLE_RECV_ERROR
;

607 
ªt
 = 
li
->
	`ªcv
(
c⁄n
, 
FIRSTSOCKET
, 
buf
, 
Àn
, &
îr
);

608 if(
ªt
 < 0 && 
îr
 =
CURLE_AGAIN
) {

609 
	`SET_SOCKERRNO
(
EWOULDBLOCK
);

611  
ªt
;

612 
	}
}

614 
bî_¶í_t


615 
	$ld≠sb_és_wrôe
(
Sockbuf_IO_Desc
 *
sbiod
, *
buf
, 
bî_Àn_t
 
Àn
)

617 
c⁄√˘d©a
 *
c⁄n
 = 
sbiod
->
sbiod_pvt
;

618 
ld≠c⁄nöfo
 *
li
 = 
c⁄n
->
¥Ÿo
.
gíîic
;

619 
bî_¶í_t
 
ªt
;

620 
CURLcode
 
îr
 = 
CURLE_SEND_ERROR
;

622 
ªt
 = 
li
->
	`£nd
(
c⁄n
, 
FIRSTSOCKET
, 
buf
, 
Àn
, &
îr
);

623 if(
ªt
 < 0 && 
îr
 =
CURLE_AGAIN
) {

624 
	`SET_SOCKERRNO
(
EWOULDBLOCK
);

626  
ªt
;

627 
	}
}

629 
Sockbuf_IO
 
	gld≠sb_és
 =

631 
ld≠sb_és_£tup
,

632 
ld≠sb_és_ªmove
,

633 
ld≠sb_és_˘æ
,

634 
ld≠sb_és_ªad
,

635 
ld≠sb_és_wrôe
,

636 
ld≠sb_és_˛o£


	@lib/parsedate.c

76 
	~"cuæ_£tup.h
"

78 #ifde‡
HAVE_LIMITS_H


79 
	~<limôs.h
>

82 
	~<cuæ/cuæ.h
>

83 
	~"øw°r.h
"

84 
	~"w¨∆ess.h
"

85 
	~"∑r£d©e.h
"

87 c⁄° * c⁄° 
	gCuæ_wkday
[] =

89 c⁄° * c⁄° 
	gwìkday
[] =

92 c⁄° * c⁄° 
	gCuæ_m⁄th
[]=

96 
	stzöfo
 {

97 
	m«me
[5];

98 
	moff£t
;

112 
∑r£d©e
(c⁄° *
d©e
, 
time_t
 *
ouçut
);

114 
	#PARSEDATE_OK
 0

	)

115 
	#PARSEDATE_FAIL
 -1

	)

116 
	#PARSEDATE_LATER
 1

	)

117 
	#PARSEDATE_SOONER
 2

	)

121 
	#tDAYZONE
 -60

	)

122 c⁄° 
tzöfo
 
	gtz
[]= {

126 {"BST", 0 
tDAYZONE
},

129 {"ADT", 240 
tDAYZONE
},

131 {"EDT", 300 
tDAYZONE
},

133 {"CDT", 360 
tDAYZONE
},

135 {"MDT", 420 
tDAYZONE
},

137 {"PDT", 480 
tDAYZONE
},

139 {"YDT", 540 
tDAYZONE
},

141 {"HDT", 600 
tDAYZONE
},

149 {"MEST", -60 
tDAYZONE
},

150 {"CEST", -60 
tDAYZONE
},

151 {"MESZ", -60 
tDAYZONE
},

153 {"FST", -60 
tDAYZONE
},

156 {"WADT", -420 
tDAYZONE
},

160 {"EADT", -600 
tDAYZONE
},

164 {"NZDT", -720 
tDAYZONE
},

204 
	$checkday
(c⁄° *
check
, 
size_t
 
Àn
)

206 
i
;

207 c⁄° * c⁄° *
wh©
;

208 
boﬁ
 
found

FALSE
;

209 if(
Àn
 > 3)

210 
wh©
 = &
wìkday
[0];

212 
wh©
 = &
Cuæ_wkday
[0];

213 
i
=0; i<7; i++) {

214 if(
	`Cuæ_øw_equÆ
(
check
, 
wh©
[0])) {

215 
found
=
TRUE
;

218 
wh©
++;

220  
found
?
i
:-1;

221 
	}
}

223 
	$checkm⁄th
(c⁄° *
check
)

225 
i
;

226 c⁄° * c⁄° *
wh©
;

227 
boﬁ
 
found

FALSE
;

229 
wh©
 = &
Cuæ_m⁄th
[0];

230 
i
=0; i<12; i++) {

231 if(
	`Cuæ_øw_equÆ
(
check
, 
wh©
[0])) {

232 
found
=
TRUE
;

235 
wh©
++;

237  
found
?
i
:-1;

238 
	}
}

243 
	$checktz
(c⁄° *
check
)

245 
i
;

246 c⁄° 
tzöfo
 *
wh©
;

247 
boﬁ
 
found

FALSE
;

249 
wh©
 = 
tz
;

250 
i
=0; i< (
tz
)/(tz[0]); i++) {

251 if(
	`Cuæ_øw_equÆ
(
check
, 
wh©
->
«me
)) {

252 
found
=
TRUE
;

255 
wh©
++;

257  
found
?
wh©
->
off£t
*60:-1;

258 
	}
}

260 
	$skù
(c⁄° **
d©e
)

263 **
d©e
 && !
	`ISALNUM
(**date))

264 (*
d©e
)++;

265 
	}
}

267 
	eassume
 {

268 
	mDATE_MDAY
,

269 
	mDATE_YEAR
,

270 
	mDATE_TIME


275 
	smy_tm
 {

276 
	mtm_£c
;

277 
	mtm_mö
;

278 
	mtm_hour
;

279 
	mtm_mday
;

280 
	mtm_m⁄
;

281 
	mtm_yór
;

289 
time_t
 
	$my_timegm
(
my_tm
 *
tm
)

291 c⁄° 
m⁄th_days_cumuœtive
 [12] =

293 
m⁄th
, 
yór
, 
À≠_days
;

295 if(
tm
->
tm_yór
 < 70)

300 
yór
 = 
tm
->
tm_yór
 + 1900;

301 
m⁄th
 = 
tm
->
tm_m⁄
;

302 if(
m⁄th
 < 0) {

303 
yór
 +(11 - 
m⁄th
) / 12;

304 
m⁄th
 = 11 - (11 - month) % 12;

306 if(
m⁄th
 >= 12) {

307 
yór
 -
m⁄th
 / 12;

308 
m⁄th
 = month % 12;

311 
À≠_days
 = 
yór
 - (
tm
->
tm_m⁄
 <= 1);

312 
À≠_days
 = ((leap_days / 4) - (leap_days / 100) + (leap_days / 400)

315  ((((
time_t
Ë(
yór
 - 1970) * 365

316 + 
À≠_days
 + 
m⁄th_days_cumuœtive
 [
m⁄th
] + 
tm
->
tm_mday
 - 1) * 24

317 + 
tm
->
tm_hour
Ë* 60 +Åm->
tm_mö
Ë* 60 +Åm->
tm_£c
;

318 
	}
}

331 
	$∑r£d©e
(c⁄° *
d©e
, 
time_t
 *
ouçut
)

333 
time_t
 
t
 = 0;

334 
wdaynum
=-1;

335 
m⁄num
=-1;

336 
mdaynum
=-1;

337 
hou∫um
=-1;

338 
mönum
=-1;

339 
£˙um
=-1;

340 
yó∫um
=-1;

341 
tzoff
=-1;

342 
my_tm
 
tm
;

343 
assume
 
dig√xt
 = 
DATE_MDAY
;

344 c⁄° *
öd©e
 = 
d©e
;

345 
∑π
 = 0;

347 *
d©e
 && (
∑π
 < 6)) {

348 
boﬁ
 
found
=
FALSE
;

350 
	`skù
(&
d©e
);

352 if(
	`ISALPHA
(*
d©e
)) {

354 
buf
[32]="";

355 
size_t
 
Àn
;

356 if(
	`ssˇnf
(
d©e
, "%31[ABCDEFGHIJKLMNOPQRSTUVWXYZ"

357 "abcdefghijklmn›qr°uvwxyz]", 
buf
))

358 
Àn
 = 
	`°æí
(
buf
);

360 
Àn
 = 0;

362 if(
wdaynum
 == -1) {

363 
wdaynum
 = 
	`checkday
(
buf
, 
Àn
);

364 if(
wdaynum
 != -1)

365 
found
 = 
TRUE
;

367 if(!
found
 && (
m⁄num
 == -1)) {

368 
m⁄num
 = 
	`checkm⁄th
(
buf
);

369 if(
m⁄num
 != -1)

370 
found
 = 
TRUE
;

373 if(!
found
 && (
tzoff
 == -1)) {

375 
tzoff
 = 
	`checktz
(
buf
);

376 if(
tzoff
 != -1)

377 
found
 = 
TRUE
;

380 if(!
found
)

381  
PARSEDATE_FAIL
;

383 
d©e
 +
Àn
;

385 if(
	`ISDIGIT
(*
d©e
)) {

387 
vÆ
;

388 *
íd
;

389 if((
£˙um
 == -1) &&

390 (3 =
	`ssˇnf
(
d©e
, "%02d:%02d:%02d", &
hou∫um
, &
mönum
, &
£˙um
))) {

392 
d©e
 += 8;

394 if((
£˙um
 == -1) &&

395 (2 =
	`ssˇnf
(
d©e
, "%02d:%02d", &
hou∫um
, &
mönum
))) {

397 
d©e
 += 5;

398 
£˙um
 = 0;

401 
lvÆ
;

402 
îr‹
;

403 
ﬁd_î∫o
;

405 
ﬁd_î∫o
 = 
ERRNO
;

406 
	`SET_ERRNO
(0);

407 
lvÆ
 = 
	`°πﬁ
(
d©e
, &
íd
, 10);

408 
îr‹
 = 
ERRNO
;

409 if(
îr‹
 !
ﬁd_î∫o
)

410 
	`SET_ERRNO
(
ﬁd_î∫o
);

412 if(
îr‹
)

413  
PARSEDATE_FAIL
;

415 #i‡
LONG_MAX
 !
INT_MAX


416 if((
lvÆ
 > ()
INT_MAX
Ë|| (lvÆ < ()
INT_MIN
))

417  
PARSEDATE_FAIL
;

420 
vÆ
 = 
	`cuæx_¶tosi
(
lvÆ
);

422 if((
tzoff
 == -1) &&

423 ((
íd
 - 
d©e
) == 4) &&

424 (
vÆ
 <= 1400) &&

425 (
öd©e
< 
d©e
) &&

426 ((
d©e
[-1] == '+' || date[-1] == '-'))) {

435 
found
 = 
TRUE
;

436 
tzoff
 = (
vÆ
/100 * 60 + val%100)*60;

440 
tzoff
 = 
d©e
[-1]=='+'?-tzoff:tzoff;

443 if(((
íd
 - 
d©e
) == 8) &&

444 (
yó∫um
 == -1) &&

445 (
m⁄num
 == -1) &&

446 (
mdaynum
 == -1)) {

448 
found
 = 
TRUE
;

449 
yó∫um
 = 
vÆ
/10000;

450 
m⁄num
 = (
vÆ
%10000)/100-1;

451 
mdaynum
 = 
vÆ
%100;

454 if(!
found
 && (
dig√xt
 =
DATE_MDAY
Ë&& (
mdaynum
 == -1)) {

455 if((
vÆ
 > 0) && (val<32)) {

456 
mdaynum
 = 
vÆ
;

457 
found
 = 
TRUE
;

459 
dig√xt
 = 
DATE_YEAR
;

462 if(!
found
 && (
dig√xt
 =
DATE_YEAR
Ë&& (
yó∫um
 == -1)) {

463 
yó∫um
 = 
vÆ
;

464 
found
 = 
TRUE
;

465 if(
yó∫um
 < 1900) {

466 if(
yó∫um
 > 70)

467 
yó∫um
 += 1900;

469 
yó∫um
 += 2000;

471 if(
mdaynum
 == -1)

472 
dig√xt
 = 
DATE_MDAY
;

475 if(!
found
)

476  
PARSEDATE_FAIL
;

478 
d©e
 = 
íd
;

482 
∑π
++;

485 if(-1 =
£˙um
)

486 
£˙um
 = 
mönum
 = 
hou∫um
 = 0;

488 if((-1 =
mdaynum
) ||

489 (-1 =
m⁄num
) ||

490 (-1 =
yó∫um
))

492  
PARSEDATE_FAIL
;

494 #i‡
SIZEOF_TIME_T
 < 5

496 if(
yó∫um
 > 2037) {

497 *
ouçut
 = 0x7fffffff;

498  
PARSEDATE_LATER
;

502 if(
yó∫um
 < 1970) {

503 *
ouçut
 = 0;

504  
PARSEDATE_SOONER
;

507 if((
mdaynum
 > 31Ë|| (
m⁄num
 > 11) ||

508 (
hou∫um
 > 23Ë|| (
mönum
 > 59Ë|| (
£˙um
 > 60))

509  
PARSEDATE_FAIL
;

511 
tm
.
tm_£c
 = 
£˙um
;

512 
tm
.
tm_mö
 = 
mönum
;

513 
tm
.
tm_hour
 = 
hou∫um
;

514 
tm
.
tm_mday
 = 
mdaynum
;

515 
tm
.
tm_m⁄
 = 
m⁄num
;

516 
tm
.
tm_yór
 = 
yó∫um
 - 1900;

525 
t
 = 
	`my_timegm
(&
tm
);

528 if(-1 !()
t
) {

531 
dñè
 = ()(
tzoff
!=-1?tzoff:0);

533 if((
dñè
>0Ë&& (
t
 > 
LONG_MAX
 - delta))

536 
t
 +
dñè
;

539 *
ouçut
 = 
t
;

541  
PARSEDATE_OK
;

542 
	}
}

544 
time_t
 
	$cuæ_gëd©e
(c⁄° *
p
, c⁄° 
time_t
 *
now
)

546 
time_t
 
∑r£d
;

547 
rc
 = 
	`∑r£d©e
(
p
, &
∑r£d
);

548 ()
now
;

550 
rc
) {

551 
PARSEDATE_OK
:

552 
PARSEDATE_LATER
:

553 
PARSEDATE_SOONER
:

554  
∑r£d
;

558 
	}
}

569 
CURLcode
 
	$Cuæ_gmtime
(
time_t
 
ötime
, 
tm
 *
°‹e
)

571 c⁄° 
tm
 *tm;

572 #ifde‡
HAVE_GMTIME_R


574 
tm
 = (tm *)
	`gmtime_r
(&
ötime
, 
°‹e
);

576 
tm
 = 
	`gmtime
(&
ötime
);

577 if(
tm
)

578 *
°‹e
 = *
tm
;

581 if(!
tm
)

582  
CURLE_BAD_FUNCTION_ARGUMENT
;

583  
CURLE_OK
;

584 
	}
}

	@lib/parsedate.h

1 #i‚de‡
HEADER_CURL_PARSEDATE_H


2 
	#HEADER_CURL_PARSEDATE_H


	)

25 c⁄° * c⁄° 
Cuæ_wkday
[7];

26 c⁄° * c⁄° 
Cuæ_m⁄th
[12];

28 
CURLcode
 
Cuæ_gmtime
(
time_t
 
ötime
, 
tm
 *
°‹e
);

	@lib/pingpong.c

26 
	~"cuæ_£tup.h
"

28 
	~"uæd©a.h
"

29 
	~"£ndf.h
"

30 
	~"£À˘.h
"

31 
	~"¥ogªss.h
"

32 
	~"•ìdcheck.h
"

33 
	~"pögp⁄g.h
"

34 
	~"mu…iif.h
"

35 
	~"n⁄-ascii.h
"

36 
	~"vés/vés.h
"

38 
	#_MPRINTF_REPLACE


	)

39 
	~<cuæ/m¥ötf.h
>

41 
	~"cuæ_mem‹y.h
"

43 
	~"memdebug.h
"

45 #ifde‡
USE_PINGPONG


49 
	$Cuæ_µ_°©e_timeout
(
pögp⁄g
 *
µ
)

51 
c⁄√˘d©a
 *
c⁄n
 = 
µ
->conn;

52 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

53 
timeout_ms
;

54 
timeout2_ms
;

55 
ª•⁄£_time
(
d©a
->
£t
.
£rvî_ª•⁄£_timeout
)?

56 
d©a
->
£t
.
£rvî_ª•⁄£_timeout
: 
µ
->
ª•⁄£_time
;

65 
timeout_ms
 = 
ª•⁄£_time
 -

66 
	`Cuæ_tvdiff
(
	`Cuæ_tvnow
(), 
µ
->
ª•⁄£
);

68 if(
d©a
->
£t
.
timeout
) {

70 
timeout2_ms
 = 
d©a
->
£t
.
timeout
 -

71 
	`Cuæ_tvdiff
(
	`Cuæ_tvnow
(), 
c⁄n
->
now
);

74 
timeout_ms
 = 
	`CURLMIN
—imeout_ms, 
timeout2_ms
);

77  
timeout_ms
;

78 
	}
}

83 
CURLcode
 
	$Cuæ_µ_°©emach
(
pögp⁄g
 *
µ
, 
boﬁ
 
block
)

85 
c⁄√˘d©a
 *
c⁄n
 = 
µ
->conn;

86 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
FIRSTSOCKET
];

87 
rc
;

88 
öãrvÆ_ms
;

89 
timeout_ms
 = 
	`Cuæ_µ_°©e_timeout
(
µ
);

90 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

91 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

93 if(
timeout_ms
 <=0 ) {

94 
	`Áûf
(
d©a
, "serverÑesponseÅimeout");

95  
CURLE_OPERATION_TIMEDOUT
;

98 if(
block
) {

99 
öãrvÆ_ms
 = 1000;

100 if(
timeout_ms
 < 
öãrvÆ_ms
)

101 
öãrvÆ_ms
 = 
timeout_ms
;

104 
öãrvÆ_ms
 = 0;

106 if(
	`Cuæ_µ_m‹ed©a
(
µ
))

108 
rc
 = 1;

109 if(!
µ
->
£ndÀ·
 && 
	`Cuæ_s¶_d©a_≥ndög
(
c⁄n
, 
FIRSTSOCKET
))

111 
rc
 = 1;

113 
rc
 = 
	`Cuæ_sockë_ªady
(
µ
->
£ndÀ·
?
CURL_SOCKET_BAD
:
sock
,

114 
µ
->
£ndÀ·
?
sock
:
CURL_SOCKET_BAD
,

115 
öãrvÆ_ms
);

117 if(
block
) {

119 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

120 
ªsu…
 = 
CURLE_ABORTED_BY_CALLBACK
;

122 
ªsu…
 = 
	`Cuæ_•ìdcheck
(
d©a
, 
	`Cuæ_tvnow
());

124 if(
ªsu…
)

125  
ªsu…
;

128 if(
rc
 == -1) {

129 
	`Áûf
(
d©a
, "select/pollÉrror");

130 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

132 if(
rc
)

133 
ªsu…
 = 
µ
->
	`°©emach_a˘
(
c⁄n
);

135  
ªsu…
;

136 
	}
}

139 
	$Cuæ_µ_öô
(
pögp⁄g
 *
µ
)

141 
c⁄√˘d©a
 *
c⁄n
 = 
µ
->conn;

142 
µ
->
ƒód_ª•
 = 0;

143 
µ
->
löe°¨t_ª•
 = 
c⁄n
->
d©a
->
°©e
.
buf„r
;

144 
µ
->
≥ndög_ª•
 = 
TRUE
;

145 
µ
->
ª•⁄£
 = 
	`Cuæ_tvnow
();

146 
	}
}

160 
CURLcode
 
	$Cuæ_µ_v£ndf
(
pögp⁄g
 *
µ
,

161 c⁄° *
fmt
,

162 
va_li°
 
¨gs
)

164 
ssize_t
 
byãs_wrôãn
;

165 
size_t
 
wrôe_Àn
;

166 *
fmt_¸lf
;

167 *
s
;

168 
CURLcode
 
îr‹
;

169 
c⁄√˘d©a
 *
c⁄n
 = 
µ
->conn;

170 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

172 #ifde‡
HAVE_GSSAPI


173 
¥Ÿe˘i⁄_Àvñ
 
d©a_£c
 = 
c⁄n
->
d©a_¥Ÿ
;

176 
	`DEBUGASSERT
(
µ
->
£ndÀ·
 == 0);

177 
	`DEBUGASSERT
(
µ
->
£ndsize
 == 0);

178 
	`DEBUGASSERT
(
µ
->
£ndthis
 =
NULL
);

180 
fmt_¸lf
 = 
	`≠rötf
("%s\r\n", 
fmt
);

181 if(!
fmt_¸lf
)

182  
CURLE_OUT_OF_MEMORY
;

184 
s
 = 
	`v≠rötf
(
fmt_¸lf
, 
¨gs
);

185 
	`‰ì
(
fmt_¸lf
);

186 if(!
s
)

187  
CURLE_OUT_OF_MEMORY
;

189 
byãs_wrôãn
 = 0;

190 
wrôe_Àn
 = 
	`°æí
(
s
);

192 
	`Cuæ_µ_öô
(
µ
);

194 
îr‹
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
d©a
, 
s
, 
wrôe_Àn
);

196 if(
îr‹
) {

197 
	`‰ì
(
s
);

198  
îr‹
;

201 #ifde‡
HAVE_GSSAPI


202 
c⁄n
->
d©a_¥Ÿ
 = 
PROT_CMD
;

204 
îr‹
 = 
	`Cuæ_wrôe
(
c⁄n
, c⁄n->
sock
[
FIRSTSOCKET
], 
s
, 
wrôe_Àn
,

205 &
byãs_wrôãn
);

206 #ifde‡
HAVE_GSSAPI


207 
	`DEBUGASSERT
(
d©a_£c
 > 
PROT_NONE
 && d©a_£¯< 
PROT_LAST
);

208 
c⁄n
->
d©a_¥Ÿ
 = 
d©a_£c
;

211 if(
îr‹
) {

212 
	`‰ì
(
s
);

213  
îr‹
;

216 if(
c⁄n
->
d©a
->
£t
.
vîbo£
)

217 
	`Cuæ_debug
(
c⁄n
->
d©a
, 
CURLINFO_HEADER_OUT
,

218 
s
, (
size_t
)
byãs_wrôãn
, 
c⁄n
);

220 if(
byãs_wrôãn
 !(
ssize_t
)
wrôe_Àn
) {

222 
µ
->
£ndthis
 = 
s
;

223 
µ
->
£ndsize
 = 
wrôe_Àn
;

224 
µ
->
£ndÀ·
 = 
wrôe_Àn
 - 
byãs_wrôãn
;

227 
	`‰ì
(
s
);

228 
µ
->
£ndthis
 = 
NULL
;

229 
µ
->
£ndÀ·
 =Öp->
£ndsize
 = 0;

230 
µ
->
ª•⁄£
 = 
	`Cuæ_tvnow
();

233  
CURLE_OK
;

234 
	}
}

247 
CURLcode
 
	$Cuæ_µ_£ndf
(
pögp⁄g
 *
µ
,

248 c⁄° *
fmt
, ...)

250 
CURLcode
 
ªs
;

251 
va_li°
 
≠
;

252 
	`va_°¨t
(
≠
, 
fmt
);

254 
ªs
 = 
	`Cuæ_µ_v£ndf
(
µ
, 
fmt
, 
≠
);

256 
	`va_íd
(
≠
);

258  
ªs
;

259 
	}
}

266 
CURLcode
 
	$Cuæ_µ_ªadª•
(
cuæ_sockë_t
 
sockfd
,

267 
pögp⁄g
 *
µ
,

268 *
code
,

269 
size_t
 *
size
)

271 
ssize_t
 
≥æöe
;

272 
boﬁ
 
kìp⁄
=
TRUE
;

273 
ssize_t
 
gŸbyãs
;

274 *
±r
;

275 
c⁄√˘d©a
 *
c⁄n
 = 
µ
->conn;

276 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

277 * c⁄° 
buf
 = 
d©a
->
°©e
.
buf„r
;

278 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

280 *
code
 = 0;

281 *
size
 = 0;

283 
±r
=
buf
 + 
µ
->
ƒód_ª•
;

286 
≥æöe
 = (
ssize_t
)(
±r
-
µ
->
löe°¨t_ª•
);

288 
kìp⁄
=
TRUE
;

290 (
µ
->
ƒód_ª•
<
BUFSIZE
Ë&& (
kìp⁄
 && !
ªsu…
)) {

292 if(
µ
->
ˇche
) {

300 
	`DEBUGASSERT
((
±r
+
µ
->
ˇche_size
Ë<(
buf
+
BUFSIZE
+1));

301 
	`mem˝y
(
±r
, 
µ
->
ˇche
,Öp->
ˇche_size
);

302 
gŸbyãs
 = (
ssize_t
)
µ
->
ˇche_size
;

303 
	`‰ì
(
µ
->
ˇche
);

304 
µ
->
ˇche
 = 
NULL
;

305 
µ
->
ˇche_size
 = 0;

308 
ªs
;

309 #ifde‡
HAVE_GSSAPI


310 
¥Ÿe˘i⁄_Àvñ
 
¥Ÿ
 = 
c⁄n
->
d©a_¥Ÿ
;

311 
c⁄n
->
d©a_¥Ÿ
 = 
PROT_CLEAR
;

313 
	`DEBUGASSERT
((
±r
+
BUFSIZE
-
µ
->
ƒód_ª•
Ë<(
buf
+BUFSIZE+1));

314 
ªs
 = 
	`Cuæ_ªad
(
c⁄n
, 
sockfd
, 
±r
, 
BUFSIZE
-
µ
->
ƒód_ª•
,

315 &
gŸbyãs
);

316 #ifde‡
HAVE_GSSAPI


317 
	`DEBUGASSERT
(
¥Ÿ
 > 
PROT_NONE
 &&ÖrŸ < 
PROT_LAST
);

318 
c⁄n
->
d©a_¥Ÿ
 = 
¥Ÿ
;

320 if(
ªs
 =
CURLE_AGAIN
)

321  
CURLE_OK
;

323 if((
ªs
 =
CURLE_OK
Ë&& (
gŸbyãs
 > 0))

325 
ªs
 = 
	`Cuæ_c⁄vît_‰om_√tw‹k
(
d©a
, 
±r
, 
gŸbyãs
);

328 if(
CURLE_OK
 !
ªs
) {

329 
ªsu…
 = (
CURLcode
)
ªs
;

330 
kìp⁄
 = 
FALSE
;

334 if(!
kìp⁄
)

336 if(
gŸbyãs
 <= 0) {

337 
kìp⁄
 = 
FALSE
;

338 
ªsu…
 = 
CURLE_RECV_ERROR
;

339 
	`Áûf
(
d©a
, "responseÑeading failed");

345 
ssize_t
 
i
;

346 
ssize_t
 
˛ùamou¡
 = 0;

347 
boﬁ
 
ª°¨t
 = 
FALSE
;

349 
d©a
->
ªq
.
hódîbyãcou¡
 +()
gŸbyãs
;

351 
µ
->
ƒód_ª•
 +
gŸbyãs
;

352 
i
 = 0; i < 
gŸbyãs
; 
±r
++, i++) {

353 
≥æöe
++;

354 if(*
±r
=='\n') {

359 #ifde‡
HAVE_GSSAPI


360 if(!
c⁄n
->
£c_com∂ëe
)

362 if(
d©a
->
£t
.
vîbo£
)

363 
	`Cuæ_debug
(
d©a
, 
CURLINFO_HEADER_IN
,

364 
µ
->
löe°¨t_ª•
, (
size_t
)
≥æöe
, 
c⁄n
);

371 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_HEADER
,

372 
µ
->
löe°¨t_ª•
, 
≥æöe
);

373 if(
ªsu…
)

374  
ªsu…
;

376 if(
µ
->
	`ído‰e•
(
c⁄n
,Öp->
löe°¨t_ª•
, 
≥æöe
, 
code
)) {

379 
size_t
 
n
 = 
±r
 - 
µ
->
löe°¨t_ª•
;

380 
	`memmove
(
buf
, 
µ
->
löe°¨t_ª•
, 
n
);

381 
buf
[
n
]=0;

382 
kìp⁄
=
FALSE
;

383 
µ
->
löe°¨t_ª•
 = 
±r
+1;

384 
i
++;

386 *
size
 = 
µ
->
ƒód_ª•
;

387 
µ
->
ƒód_ª•
 = 0;

390 
≥æöe
=0;

391 
µ
->
löe°¨t_ª•
 = 
±r
+1;

395 if(!
kìp⁄
 && (
i
 !
gŸbyãs
)) {

400 
˛ùamou¡
 = 
gŸbyãs
 - 
i
;

401 
ª°¨t
 = 
TRUE
;

402 
	`DEBUGF
(
	`öfof
(
d©a
, "Curl_pp_readresp_ %d bytes ofÅrailing "

404 ()
˛ùamou¡
));

406 if(
kìp⁄
) {

408 if((
≥æöe
 =
gŸbyãs
Ë&& (gŸbyã†> 
BUFSIZE
/2)) {

412 
	`öfof
(
d©a
, "Excessive serverÑesponseÜineÜengthÑeceived, "

413 "%zd byãs. Såùpög\n", 
gŸbyãs
);

414 
ª°¨t
 = 
TRUE
;

418 
˛ùamou¡
 = 40;

420 if(
µ
->
ƒód_ª•
 > 
BUFSIZE
/2) {

424 
˛ùamou¡
 = 
≥æöe
;

425 
ª°¨t
 = 
TRUE
;

428 if(
i
 =
gŸbyãs
)

429 
ª°¨t
 = 
TRUE
;

431 if(
˛ùamou¡
) {

432 
µ
->
ˇche_size
 = 
˛ùamou¡
;

433 
µ
->
ˇche
 = 
	`mÆloc
’p->
ˇche_size
);

434 if(
µ
->
ˇche
)

435 
	`mem˝y
(
µ
->
ˇche
,Öp->
löe°¨t_ª•
,Öp->
ˇche_size
);

437  
CURLE_OUT_OF_MEMORY
;

439 if(
ª°¨t
) {

442 
µ
->
ƒód_ª•
 = 0;

443 
±r
 = 
µ
->
löe°¨t_ª•
 = 
buf
;

444 
≥æöe
 = 0;

451 
µ
->
≥ndög_ª•
 = 
FALSE
;

453  
ªsu…
;

454 
	}
}

456 
	$Cuæ_µ_gësock
(
pögp⁄g
 *
µ
,

457 
cuæ_sockë_t
 *
socks
,

458 
numsocks
)

460 
c⁄√˘d©a
 *
c⁄n
 = 
µ
->conn;

462 if(!
numsocks
)

463  
GETSOCK_BLANK
;

465 
socks
[0] = 
c⁄n
->
sock
[
FIRSTSOCKET
];

467 if(
µ
->
£ndÀ·
) {

469  
	`GETSOCK_WRITESOCK
(0);

473  
	`GETSOCK_READSOCK
(0);

474 
	}
}

476 
CURLcode
 
	$Cuæ_µ_Êush£nd
(
pögp⁄g
 *
µ
)

479 
c⁄√˘d©a
 *
c⁄n
 = 
µ
->conn;

480 
ssize_t
 
wrôãn
;

481 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

482 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
FIRSTSOCKET
];

484 
ªsu…
 = 
	`Cuæ_wrôe
(
c⁄n
, 
sock
, 
µ
->
£ndthis
 +Öp->
£ndsize
 -

485 
µ
->
£ndÀ·
,Öp->£ndÀ·, &
wrôãn
);

486 if(
ªsu…
)

487  
ªsu…
;

489 if(
wrôãn
 !(
ssize_t
)
µ
->
£ndÀ·
) {

491 
µ
->
£ndÀ·
 -
wrôãn
;

494 
	`‰ì
(
µ
->
£ndthis
);

495 
µ
->
£ndthis
=
NULL
;

496 
µ
->
£ndÀ·
 =Öp->
£ndsize
 = 0;

497 
µ
->
ª•⁄£
 = 
	`Cuæ_tvnow
();

499  
CURLE_OK
;

500 
	}
}

502 
CURLcode
 
	$Cuæ_µ_disc⁄√˘
(
pögp⁄g
 *
µ
)

504 if(
µ
->
ˇche
) {

505 
	`‰ì
(
µ
->
ˇche
);

506 
µ
->
ˇche
 = 
NULL
;

508  
CURLE_OK
;

509 
	}
}

511 
boﬁ
 
	$Cuæ_µ_m‹ed©a
(
pögp⁄g
 *
µ
)

513  (!
µ
->
£ndÀ·
 &&Öp->
ˇche
 &&Öp->
ƒód_ª•
 <Öp->
ˇche_size
) ?

514 
TRUE
 : 
FALSE
;

515 
	}
}

	@lib/pingpong.h

1 #i‚de‡
HEADER_CURL_PINGPONG_H


2 
	#HEADER_CURL_PINGPONG_H


	)

25 
	~"cuæ_£tup.h
"

27 #i‡!
deföed
(
CURL_DISABLE_IMAP
Ë|| !deföed(
CURL_DISABLE_FTP
) || \

28 !
deföed
(
CURL_DISABLE_POP3
Ë|| !
	$deföed
(
CURL_DISABLE_SMTP
)

29 
	#USE_PINGPONG


	)

33 
c⁄√˘d©a
;

36 
FTPTRANSFER_BODY
,

37 
FTPTRANSFER_INFO
,

38 
FTPTRANSFER_NONE
,

39 
FTPTRANSFER_LAST


40 } 
	tcuæ_µ_å™s„r
;

48 
	spögp⁄g
 {

49 *
ˇche
;

50 
size_t
 
ˇche_size
;

51 
size_t
 
ƒód_ª•
;

52 *
löe°¨t_ª•
;

54 
boﬁ
 
≥ndög_ª•
;

57 *
£ndthis
;

59 
size_t
 
£ndÀ·
;

60 
size_t
 
£ndsize
;

61 
timevÆ
 
ª•⁄£
;

63 
ª•⁄£_time
;

66 
c⁄√˘d©a
 *
c⁄n
;

72 
	`CURLcode
 (*
°©emach_a˘
)(
c⁄√˘d©a
 *
c⁄n
);

74 
	`boﬁ
 (*
ído‰e•
)(
c⁄√˘d©a
 *
c⁄n
, *
±r
, 
size_t
 
Àn
,

75 *
code
);

84 
CURLcode
 
	`Cuæ_µ_°©emach
(
pögp⁄g
 *
µ
, 
boﬁ
 
block
);

87 
	`Cuæ_µ_öô
(
pögp⁄g
 *
µ
);

91 
	`Cuæ_µ_°©e_timeout
(
pögp⁄g
 *
µ
);

104 
CURLcode
 
	`Cuæ_µ_£ndf
(
pögp⁄g
 *
µ
,

105 c⁄° *
fmt
, ...);

117 
CURLcode
 
	`Cuæ_µ_v£ndf
(
pögp⁄g
 *
µ
,

118 c⁄° *
fmt
,

119 
va_li°
 
¨gs
);

126 
CURLcode
 
	`Cuæ_µ_ªadª•
(
cuæ_sockë_t
 
sockfd
,

127 
pögp⁄g
 *
µ
,

128 *
code
,

129 
size_t
 *
size
);

132 
CURLcode
 
	`Cuæ_µ_Êush£nd
(
pögp⁄g
 *
µ
);

135 
CURLcode
 
	`Cuæ_µ_disc⁄√˘
(
pögp⁄g
 *
µ
);

137 
	`Cuæ_µ_gësock
(
pögp⁄g
 *
µ
, 
cuæ_sockë_t
 *
socks
,

138 
numsocks
);

148 
boﬁ
 
	`Cuæ_µ_m‹ed©a
(
pögp⁄g
 *
µ
);

	@lib/pipeline.c

24 
	~"cuæ_£tup.h
"

26 
	~<cuæ/cuæ.h
>

28 
	~"uæd©a.h
"

29 
	~"uæ.h
"

30 
	~"¥ogªss.h
"

31 
	~"mu…iif.h
"

32 
	~"pùñöe.h
"

33 
	~"£ndf.h
"

34 
	~"øw°r.h
"

35 
	~"bundÀs.h
"

37 
	~"cuæ_mem‹y.h
"

39 
	~"memdebug.h
"

41 
	ssôe_bœckli°_íåy
 {

42 *
	mho°«me
;

43 
	mp‹t
;

46 
	$sôe_bœckli°_Œi°_dt‹
(*
u£r
, *
ñemít
)

48 
sôe_bœckli°_íåy
 *
íåy
 = 
ñemít
;

49 ()
u£r
;

51 
	`Cuæ_ß„‰ì
(
íåy
->
ho°«me
);

52 
	`Cuæ_ß„‰ì
(
íåy
);

53 
	}
}

55 
	$£rvî_bœckli°_Œi°_dt‹
(*
u£r
, *
ñemít
)

57 *
£rvî_«me
 = 
ñemít
;

58 ()
u£r
;

60 
	`Cuæ_ß„‰ì
(
£rvî_«me
);

61 
	}
}

63 
boﬁ
 
	$Cuæ_pùñöe_≥«lized
(
Sessi⁄H™dÀ
 *
d©a
,

64 
c⁄√˘d©a
 *
c⁄n
)

66 if(
d©a
) {

67 
boﬁ
 
≥«lized
 = 
FALSE
;

68 
cuæ_off_t
 
≥«…y_size
 =

69 
	`Cuæ_mu…i_c⁄ã¡_Àngth_≥«…y_size
(
d©a
->
mu…i
);

70 
cuæ_off_t
 
chunk_≥«…y_size
 =

71 
	`Cuæ_mu…i_chunk_Àngth_≥«…y_size
(
d©a
->
mu…i
);

72 
cuæ_off_t
 
ªcv_size
 = -2;

75 if(
c⁄n
->
ªcv_pùe
 && c⁄n->ªcv_pùe->
hód
) {

76 
Sessi⁄H™dÀ
 *
ªcv_h™dÀ
 = 
c⁄n
->
ªcv_pùe
->
hód
->
±r
;

78 
ªcv_size
 = 
ªcv_h™dÀ
->
ªq
.
size
;

80 if(
≥«…y_size
 > 0 && 
ªcv_size
 >Öenalty_size)

81 
≥«lized
 = 
TRUE
;

84 if(
chunk_≥«…y_size
 > 0 &&

85 (
cuæ_off_t
)
c⁄n
->
chunk
.
d©asize
 > 
chunk_≥«…y_size
)

86 
≥«lized
 = 
TRUE
;

88 
	`öfof
(
d©a
, "Conn: %ld (%p) ReceiveÖipe weight: (%"

89 
CURL_FORMAT_CURL_OFF_T
 "/%zu),Öenalized: %s\n",

90 
c⁄n
->
c⁄√˘i⁄_id
, (*)c⁄n, 
ªcv_size
,

91 
c⁄n
->
chunk
.
d©asize
, 
≥«lized
?"TRUE":"FALSE");

92  
≥«lized
;

94  
FALSE
;

95 
	}
}

97 
CURLcode
 
	$Cuæ_add_h™dÀ_to_pùñöe
(
Sessi⁄H™dÀ
 *
h™dÀ
,

98 
c⁄√˘d©a
 *
c⁄n
)

100 
cuæ_Œi°_ñemít
 *
£ndhód
 = 
c⁄n
->
£nd_pùe
->
hód
;

101 
cuæ_Œi°
 *
pùñöe
;

102 
CURLcode
 
rc
;

104 
pùñöe
 = 
c⁄n
->
£nd_pùe
;

106 
rc
 = 
	`Cuæ_addH™dÀToPùñöe
(
h™dÀ
, 
pùñöe
);

108 if(
pùñöe
 =
c⁄n
->
£nd_pùe
 && 
£ndhód
 !c⁄n->£nd_pùe->
hód
) {

110 
c⁄n
->
wrôech™√l_öu£
 = 
FALSE
;

111 
	`Cuæ_expúe
(
c⁄n
->
£nd_pùe
->
hód
->
±r
, 1);

115 
	`¥öt_pùñöe
(
c⁄n
);

118  
rc
;

119 
	}
}

127 
	$Cuæ_move_h™dÀ_‰om_£nd_to_ªcv_pùe
(
Sessi⁄H™dÀ
 *
h™dÀ
,

128 
c⁄√˘d©a
 *
c⁄n
)

130 
cuæ_Œi°_ñemít
 *
cuº
;

132 
cuº
 = 
c⁄n
->
£nd_pùe
->
hód
;

133 
cuº
) {

134 if(
cuº
->
±r
 =
h™dÀ
) {

135 
	`Cuæ_Œi°_move
(
c⁄n
->
£nd_pùe
, 
cuº
,

136 
c⁄n
->
ªcv_pùe
, c⁄n->ªcv_pùe->
èû
);

138 if(
c⁄n
->
£nd_pùe
->
hód
) {

141 
c⁄n
->
wrôech™√l_öu£
 = 
FALSE
;

142 #ifde‡
DEBUGBUILD


143 
	`öfof
(
c⁄n
->
d©a
, "%p isát sendÖipe head B!\n",

144 (*)
c⁄n
->
£nd_pùe
->
hód
->
±r
);

146 
	`Cuæ_expúe
(
c⁄n
->
£nd_pùe
->
hód
->
±r
, 1);

155 
cuº
 = cuº->
√xt
;

157 
	}
}

159 
boﬁ
 
	$Cuæ_pùñöe_sôe_bœckli°ed
(
Sessi⁄H™dÀ
 *
h™dÀ
,

160 
c⁄√˘d©a
 *
c⁄n
)

162 if(
h™dÀ
->
mu…i
) {

163 
cuæ_Œi°
 *
bœckli°
 =

164 
	`Cuæ_mu…i_pùñöög_sôe_bl
(
h™dÀ
->
mu…i
);

166 if(
bœckli°
) {

167 
cuæ_Œi°_ñemít
 *
cuº
;

169 
cuº
 = 
bœckli°
->
hód
;

170 
cuº
) {

171 
sôe_bœckli°_íåy
 *
sôe
;

173 
sôe
 = 
cuº
->
±r
;

174 if(
	`Cuæ_øw_equÆ
(
sôe
->
ho°«me
, 
c⁄n
->
ho°
.
«me
) &&

175 
sôe
->
p‹t
 =
c⁄n
->
ªmŸe_p‹t
) {

176 
	`öfof
(
h™dÀ
, "Site %s:%d isÖipeline blacklisted\n",

177 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

178  
TRUE
;

180 
cuº
 = cuº->
√xt
;

184  
FALSE
;

185 
	}
}

187 
CURLMcode
 
	$Cuæ_pùñöe_£t_sôe_bœckli°
(**
sôes
,

188 
cuæ_Œi°
 **
li°_±r
)

190 
cuæ_Œi°
 *
ﬁd_li°
 = *
li°_±r
;

191 
cuæ_Œi°
 *
√w_li°
 = 
NULL
;

193 if(
sôes
) {

194 
√w_li°
 = 
	`Cuæ_Œi°_Æloc
((
cuæ_Œi°_dt‹
Ë
sôe_bœckli°_Œi°_dt‹
);

195 if(!
√w_li°
)

196  
CURLM_OUT_OF_MEMORY
;

199 *
sôes
) {

200 *
ho°«me
;

201 *
p‹t
;

202 
sôe_bœckli°_íåy
 *
íåy
;

204 
ho°«me
 = 
	`°rdup
(*
sôes
);

205 if(!
ho°«me
) {

206 
	`Cuæ_Œi°_de°roy
(
√w_li°
, 
NULL
);

207  
CURLM_OUT_OF_MEMORY
;

210 
íåy
 = 
	`mÆloc
((
sôe_bœckli°_íåy
));

211 if(!
íåy
) {

212 
	`‰ì
(
ho°«me
);

213 
	`Cuæ_Œi°_de°roy
(
√w_li°
, 
NULL
);

214  
CURLM_OUT_OF_MEMORY
;

217 
p‹t
 = 
	`°rchr
(
ho°«me
, ':');

218 if(
p‹t
) {

219 *
p‹t
 = '\0';

220 
p‹t
++;

221 
íåy
->
p‹t
 = ()
	`°πﬁ
’‹t, 
NULL
, 10);

225 
íåy
->
p‹t
 = 80;

228 
íåy
->
ho°«me
 = hostname;

230 if(!
	`Cuæ_Œi°_ö£π_√xt
(
√w_li°
,Çew_li°->
èû
, 
íåy
)) {

231 
	`sôe_bœckli°_Œi°_dt‹
(
NULL
, 
íåy
);

232 
	`Cuæ_Œi°_de°roy
(
√w_li°
, 
NULL
);

233  
CURLM_OUT_OF_MEMORY
;

236 
sôes
++;

241 if(
ﬁd_li°
) {

242 
	`Cuæ_Œi°_de°roy
(
ﬁd_li°
, 
NULL
);

246 *
li°_±r
 = 
√w_li°
;

248  
CURLM_OK
;

249 
	}
}

251 
boﬁ
 
	$Cuæ_pùñöe_£rvî_bœckli°ed
(
Sessi⁄H™dÀ
 *
h™dÀ
,

252 *
£rvî_«me
)

254 if(
h™dÀ
->
mu…i
) {

255 
cuæ_Œi°
 *
bœckli°
 =

256 
	`Cuæ_mu…i_pùñöög_£rvî_bl
(
h™dÀ
->
mu…i
);

258 if(
bœckli°
) {

259 
cuæ_Œi°_ñemít
 *
cuº
;

261 
cuº
 = 
bœckli°
->
hód
;

262 
cuº
) {

263 *
bl_£rvî_«me
;

265 
bl_£rvî_«me
 = 
cuº
->
±r
;

266 if(
	`Cuæ_øw_√quÆ
(
bl_£rvî_«me
, 
£rvî_«me
,

267 
	`°æí
(
bl_£rvî_«me
))) {

268 
	`öfof
(
h™dÀ
, "Sîvî %†i†bœckli°ed\n", 
£rvî_«me
);

269  
TRUE
;

271 
cuº
 = cuº->
√xt
;

275 
	`öfof
(
h™dÀ
, "Sîvî %†i†nŸ bœckli°ed\n", 
£rvî_«me
);

277  
FALSE
;

278 
	}
}

280 
CURLMcode
 
	$Cuæ_pùñöe_£t_£rvî_bœckli°
(**
£rvîs
,

281 
cuæ_Œi°
 **
li°_±r
)

283 
cuæ_Œi°
 *
ﬁd_li°
 = *
li°_±r
;

284 
cuæ_Œi°
 *
√w_li°
 = 
NULL
;

286 if(
£rvîs
) {

287 
√w_li°
 = 
	`Cuæ_Œi°_Æloc
((
cuæ_Œi°_dt‹
Ë
£rvî_bœckli°_Œi°_dt‹
);

288 if(!
√w_li°
)

289  
CURLM_OUT_OF_MEMORY
;

292 *
£rvîs
) {

293 *
£rvî_«me
;

295 
£rvî_«me
 = 
	`°rdup
(*
£rvîs
);

296 if(!
£rvî_«me
)

297  
CURLM_OUT_OF_MEMORY
;

299 if(!
	`Cuæ_Œi°_ö£π_√xt
(
√w_li°
,Çew_li°->
èû
, 
£rvî_«me
))

300  
CURLM_OUT_OF_MEMORY
;

302 
£rvîs
++;

307 if(
ﬁd_li°
) {

308 
	`Cuæ_Œi°_de°roy
(
ﬁd_li°
, 
NULL
);

312 *
li°_±r
 = 
√w_li°
;

314  
CURLM_OK
;

315 
	}
}

318 
	$¥öt_pùñöe
(
c⁄√˘d©a
 *
c⁄n
)

320 
cuæ_Œi°_ñemít
 *
cuº
;

321 
c⁄√˘bundÀ
 *
cb_±r
;

322 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

324 
cb_±r
 = 
c⁄n
->
bundÀ
;

326 if(
cb_±r
) {

327 
cuº
 = 
cb_±r
->
c⁄n_li°
->
hód
;

328 
cuº
) {

329 
c⁄n
 = 
cuº
->
±r
;

330 
	`öfof
(
d©a
, "- Conn %ld (%p) send_pipe: %zu,Ñecv_pipe: %zu\n",

331 
c⁄n
->
c⁄√˘i⁄_id
,

332 (*)
c⁄n
,

333 
c⁄n
->
£nd_pùe
->
size
,

334 
c⁄n
->
ªcv_pùe
->
size
);

335 
cuº
 = cuº->
√xt
;

338 
	}
}

	@lib/pipeline.h

1 #i‚de‡
HEADER_CURL_PIPELINE_H


2 
	#HEADER_CURL_PIPELINE_H


	)

25 
CURLcode
 
Cuæ_add_h™dÀ_to_pùñöe
(
Sessi⁄H™dÀ
 *
h™dÀ
,

26 
c⁄√˘d©a
 *
c⁄n
);

27 
Cuæ_move_h™dÀ_‰om_£nd_to_ªcv_pùe
(
Sessi⁄H™dÀ
 *
h™dÀ
,

28 
c⁄√˘d©a
 *
c⁄n
);

29 
boﬁ
 
Cuæ_pùñöe_≥«lized
(
Sessi⁄H™dÀ
 *
d©a
,

30 
c⁄√˘d©a
 *
c⁄n
);

32 
boﬁ
 
Cuæ_pùñöe_sôe_bœckli°ed
(
Sessi⁄H™dÀ
 *
h™dÀ
,

33 
c⁄√˘d©a
 *
c⁄n
);

35 
CURLMcode
 
Cuæ_pùñöe_£t_sôe_bœckli°
(**
sôes
,

36 
cuæ_Œi°
 **
li°_±r
);

38 
boﬁ
 
Cuæ_pùñöe_£rvî_bœckli°ed
(
Sessi⁄H™dÀ
 *
h™dÀ
,

39 *
£rvî_«me
);

41 
CURLMcode
 
Cuæ_pùñöe_£t_£rvî_bœckli°
(**
£rvîs
,

42 
cuæ_Œi°
 **
li°_±r
);

	@lib/pop3.c

36 
	~"cuæ_£tup.h
"

38 #i‚de‡
CURL_DISABLE_POP3


40 #ifde‡
HAVE_NETINET_IN_H


41 
	~<√töë/ö.h
>

43 #ifde‡
HAVE_ARPA_INET_H


44 
	~<¨∑/öë.h
>

46 #ifde‡
HAVE_UTSNAME_H


47 
	~<sys/ut¢ame.h
>

49 #ifde‡
HAVE_NETDB_H


50 
	~<√tdb.h
>

52 #ifde‡
__VMS


53 
	~<ö.h
>

54 
	~<öë.h
>

57 #i‡(
deföed
(
NETWARE
Ë&& deföed(
__NOVELL_LIBC__
))

58 #unde‡
ö_addr_t


59 
	#ö_addr_t
 

	)

62 
	~<cuæ/cuæ.h
>

63 
	~"uæd©a.h
"

64 
	~"£ndf.h
"

65 
	~"if2ù.h
"

66 
	~"ho°ù.h
"

67 
	~"¥ogªss.h
"

68 
	~"å™s„r.h
"

69 
	~"esˇ≥.h
"

70 
	~"hâp.h
"

71 
	~"socks.h
"

72 
	~"p›3.h
"

74 
	~"°πoof·.h
"

75 
	~"°ªquÆ.h
"

76 
	~"vés/vés.h
"

77 
	~"c⁄√˘.h
"

78 
	~"°ªº‹.h
"

79 
	~"£À˘.h
"

80 
	~"mu…iif.h
"

81 
	~"uæ.h
"

82 
	~"øw°r.h
"

83 
	~"cuæ_ß¶.h
"

84 
	~"cuæ_md5.h
"

85 
	~"w¨∆ess.h
"

87 
	#_MPRINTF_REPLACE


	)

88 
	~<cuæ/m¥ötf.h
>

90 
	~"cuæ_mem‹y.h
"

92 
	~"memdebug.h
"

95 
CURLcode
 
p›3_ªguœr_å™s„r
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

96 
CURLcode
 
p›3_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

97 
CURLcode
 
p›3_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, CURLcodê
°©us
,

98 
boﬁ
 
¥em©uª
);

99 
CURLcode
 
p›3_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

100 
CURLcode
 
p›3_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód
);

101 
CURLcode
 
p›3_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

102 
p›3_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

103 
numsocks
);

104 
CURLcode
 
p›3_doög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d›ha£_d⁄e
);

105 
CURLcode
 
p›3_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
);

106 
CURLcode
 
p›3_∑r£_uæ_›ti⁄s
(
c⁄√˘d©a
 *
c⁄n
);

107 
CURLcode
 
p›3_∑r£_uæ_∑th
(
c⁄√˘d©a
 *
c⁄n
);

108 
CURLcode
 
p›3_∑r£_cu°om_ªque°
(
c⁄√˘d©a
 *
c⁄n
);

109 
CURLcode
 
p›3_ˇlc_ß¶_dëaûs
(
c⁄√˘d©a
 *
c⁄n
,

110 c⁄° **
mech
,

111 **
öôª•
, 
size_t
 *
Àn
,

112 
p›3°©e
 *
°©e1
,Ö›3°©ê*
°©e2
);

118 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_p›3
 = {

120 
p›3_£tup_c⁄√˘i⁄
,

121 
p›3_do
,

122 
p›3_d⁄e
,

123 
ZERO_NULL
,

124 
p›3_c⁄√˘
,

125 
p›3_mu…i_°©emach
,

126 
p›3_doög
,

127 
p›3_gësock
,

128 
p›3_gësock
,

129 
ZERO_NULL
,

130 
ZERO_NULL
,

131 
p›3_disc⁄√˘
,

132 
ZERO_NULL
,

133 
PORT_POP3
,

134 
CURLPROTO_POP3
,

135 
PROTOPT_CLOSEACTION
 | 
PROTOPT_NOURLQUERY


138 #ifde‡
USE_SSL


143 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_p›3s
 = {

145 
p›3_£tup_c⁄√˘i⁄
,

146 
p›3_do
,

147 
p›3_d⁄e
,

148 
ZERO_NULL
,

149 
p›3_c⁄√˘
,

150 
p›3_mu…i_°©emach
,

151 
p›3_doög
,

152 
p›3_gësock
,

153 
p›3_gësock
,

154 
ZERO_NULL
,

155 
ZERO_NULL
,

156 
p›3_disc⁄√˘
,

157 
ZERO_NULL
,

158 
PORT_POP3S
,

159 
CURLPROTO_POP3S
,

160 
PROTOPT_CLOSEACTION
 | 
PROTOPT_SSL


161 | 
PROTOPT_NOURLQUERY


165 #i‚de‡
CURL_DISABLE_HTTP


170 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_p›3_¥oxy
 = {

172 
Cuæ_hâp_£tup_c⁄n
,

173 
Cuæ_hâp
,

174 
Cuæ_hâp_d⁄e
,

175 
ZERO_NULL
,

176 
ZERO_NULL
,

177 
ZERO_NULL
,

178 
ZERO_NULL
,

179 
ZERO_NULL
,

180 
ZERO_NULL
,

181 
ZERO_NULL
,

182 
ZERO_NULL
,

183 
ZERO_NULL
,

184 
ZERO_NULL
,

185 
PORT_POP3
,

186 
CURLPROTO_HTTP
,

187 
PROTOPT_NONE


190 #ifde‡
USE_SSL


195 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_p›3s_¥oxy
 = {

197 
Cuæ_hâp_£tup_c⁄n
,

198 
Cuæ_hâp
,

199 
Cuæ_hâp_d⁄e
,

200 
ZERO_NULL
,

201 
ZERO_NULL
,

202 
ZERO_NULL
,

203 
ZERO_NULL
,

204 
ZERO_NULL
,

205 
ZERO_NULL
,

206 
ZERO_NULL
,

207 
ZERO_NULL
,

208 
ZERO_NULL
,

209 
ZERO_NULL
,

210 
PORT_POP3S
,

211 
CURLPROTO_HTTP
,

212 
PROTOPT_NONE


217 #ifde‡
USE_SSL


218 
	$p›3_to_p›3s
(
c⁄√˘d©a
 *
c⁄n
)

220 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_p›3s
;

221 
	}
}

223 
	#p›3_to_p›3s
(
x
Ë
Cuæ_n›_°mt


	)

235 
boﬁ
 
	$p›3_ído‰e•
(
c⁄√˘d©a
 *
c⁄n
, *
löe
, 
size_t
 
Àn
,

236 *
ª•
)

238 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

241 if(
Àn
 >4 && !
	`memcmp
("-ERR", 
löe
, 4)) {

242 *
ª•
 = '-';

244  
TRUE
;

248 if(
p›3c
->
°©e
 =
POP3_CAPA
) {

250 if(
Àn
 >1 && !
	`memcmp
(
löe
, ".", 1))

251 *
ª•
 = '+';

253 *
ª•
 = '*';

255  
TRUE
;

259 if((
Àn
 >3 && !
	`memcmp
("+OK", 
löe
, 3)) ||

260 (
Àn
 >1 && !
	`memcmp
("+", 
löe
, 1))) {

261 *
ª•
 = '+';

263  
TRUE
;

266  
FALSE
;

267 
	}
}

275 
	$p›3_gë_mesßge
(*
buf„r
, ** 
ouçå
)

277 
size_t
 
Àn
 = 0;

278 * 
mesßge
 = 
NULL
;

281 
mesßge
 = 
buf„r
 + 2; *message == ' ' || *message == '\t'; message++)

285 
Àn
 = 
	`°æí
(
mesßge
);Üen--;)

286 if(
mesßge
[
Àn
] != '\r' && message[len] != '\n' && message[len] != ' ' &&

287 
mesßge
[
Àn
] != '\t')

291 if(++
Àn
) {

292 
mesßge
[
Àn
] = '\0';

295 *
ouçå
 = 
mesßge
;

296 
	}
}

304 
	$°©e
(
c⁄√˘d©a
 *
c⁄n
, 
p›3°©e
 
√w°©e
)

306 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

307 #i‡
	`deföed
(
DEBUGBUILD
Ë&& !deföed(
CURL_DISABLE_VERBOSE_STRINGS
)

309 c⁄° * c⁄° 
«mes
[] = {

334 if(
p›3c
->
°©e
 !
√w°©e
)

335 
	`öfof
(
c⁄n
->
d©a
, "POP3 %p state change from %sÅo %s\n",

336 (*)
p›3c
, 
«mes
[p›3c->
°©e
],Çames[
√w°©e
]);

339 
p›3c
->
°©e
 = 
√w°©e
;

340 
	}
}

349 
CURLcode
 
	$p›3_≥rf‹m_ˇ∑
(
c⁄√˘d©a
 *
c⁄n
)

351 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

352 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

354 
p›3c
->
authmechs
 = 0;

355 
p›3c
->
authu£d
 = 0;

356 
p›3c
->
és_suµ‹ãd
 = 
FALSE
;

359 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
p›3c
->
µ
, "%s", "CAPA");

361 if(!
ªsu…
)

362 
	`°©e
(
c⁄n
, 
POP3_CAPA
);

364  
ªsu…
;

365 
	}
}

373 
CURLcode
 
	$p›3_≥rf‹m_°¨âls
(
c⁄√˘d©a
 *
c⁄n
)

375 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

378 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", "STLS");

380 if(!
ªsu…
)

381 
	`°©e
(
c⁄n
, 
POP3_STARTTLS
);

383  
ªsu…
;

384 
	}
}

392 
CURLcode
 
	$p›3_≥rf‹m_upgøde_és
(
c⁄√˘d©a
 *
c⁄n
)

394 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

395 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

398 
ªsu…
 = 
	`Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄n
, 
FIRSTSOCKET
, &
p›3c
->
s¶d⁄e
);

400 if(!
ªsu…
) {

401 if(
p›3c
->
°©e
 !
POP3_UPGRADETLS
)

402 
	`°©e
(
c⁄n
, 
POP3_UPGRADETLS
);

404 if(
p›3c
->
s¶d⁄e
) {

405 
	`p›3_to_p›3s
(
c⁄n
);

406 
ªsu…
 = 
	`p›3_≥rf‹m_ˇ∑
(
c⁄n
);

410  
ªsu…
;

411 
	}
}

419 
CURLcode
 
	$p›3_≥rf‹m_u£r
(
c⁄√˘d©a
 *
c⁄n
)

421 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

425 if(!
c⁄n
->
bôs
.
u£r_∑sswd
) {

426 
	`°©e
(
c⁄n
, 
POP3_STOP
);

428  
ªsu…
;

432 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "USER %s",

433 
c⁄n
->
u£r
 ? conn->user : "");

434 if(!
ªsu…
)

435 
	`°©e
(
c⁄n
, 
POP3_USER
);

437  
ªsu…
;

438 
	}
}

440 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


447 
CURLcode
 
	$p›3_≥rf‹m_≠›
(
c⁄√˘d©a
 *
c⁄n
)

449 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

450 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

451 
size_t
 
i
;

452 
MD5_c⁄ãxt
 *
˘xt
;

453 
dige°
[
MD5_DIGEST_LEN
];

454 
£¸ë
[2 * 
MD5_DIGEST_LEN
 + 1];

458 if(!
c⁄n
->
bôs
.
u£r_∑sswd
) {

459 
	`°©e
(
c⁄n
, 
POP3_STOP
);

461  
ªsu…
;

465 
˘xt
 = 
	`Cuæ_MD5_öô
(
Cuæ_DIGEST_MD5
);

466 if(!
˘xt
)

467  
CURLE_OUT_OF_MEMORY
;

469 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
p›3c
->
≠›time°amp
,

470 
	`cuæx_uztoui
(
	`°æí
(
p›3c
->
≠›time°amp
)));

472 
	`Cuæ_MD5_upd©e
(
˘xt
, (c⁄° *Ë
c⁄n
->
∑sswd
,

473 
	`cuæx_uztoui
(
	`°æí
(
c⁄n
->
∑sswd
)));

476 
	`Cuæ_MD5_föÆ
(
˘xt
, 
dige°
);

479 
i
 = 0; i < 
MD5_DIGEST_LEN
; i++)

480 
	`¢¥ötf
(&
£¸ë
[2 * 
i
], 3, "%02x", 
dige°
[i]);

482 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
p›3c
->
µ
, "APOP %†%s", 
c⁄n
->
u£r
, 
£¸ë
);

484 if(!
ªsu…
)

485 
	`°©e
(
c⁄n
, 
POP3_APOP
);

487  
ªsu…
;

488 
	}
}

498 
CURLcode
 
	$p›3_≥rf‹m_auth
(
c⁄√˘d©a
 *
c⁄n
,

499 c⁄° *
mech
,

500 c⁄° *
öôª•
, 
size_t
 
Àn
,

501 
p›3°©e
 
°©e1
,Ö›3°©ê
°©e2
)

503 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

504 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

506 if(
öôª•
 && 8 + 
	`°æí
(
mech
Ë+ 
Àn
 <= 255) {

508 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
p›3c
->
µ
, "AUTH %†%s", 
mech
, 
öôª•
);

510 if(!
ªsu…
)

511 
	`°©e
(
c⁄n
, 
°©e2
);

515 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
p›3c
->
µ
, "AUTH %s", 
mech
);

517 if(!
ªsu…
)

518 
	`°©e
(
c⁄n
, 
°©e1
);

521  
ªsu…
;

522 
	}
}

532 
CURLcode
 
	$p›3_≥rf‹m_authítiˇti⁄
(
c⁄√˘d©a
 *
c⁄n
)

534 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

535 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

536 c⁄° *
mech
 = 
NULL
;

537 *
öôª•
 = 
NULL
;

538 
size_t
 
Àn
 = 0;

539 
p›3°©e
 
°©e1
 = 
POP3_STOP
;

540 
p›3°©e
 
°©e2
 = 
POP3_STOP
;

544 if(!
c⁄n
->
bôs
.
u£r_∑sswd
) {

545 
	`°©e
(
c⁄n
, 
POP3_STOP
);

547  
ªsu…
;

551 if(
p›3c
->
authty≥s
 & 
POP3_TYPE_SASL
)

552 
ªsu…
 = 
	`p›3_ˇlc_ß¶_dëaûs
(
c⁄n
, &
mech
, &
öôª•
, &
Àn
, &
°©e1
,

553 &
°©e2
);

555 if(!
ªsu…
) {

556 if(
mech
 && (
p›3c
->
¥e·y≥
 & 
POP3_TYPE_SASL
)) {

558 
ªsu…
 = 
	`p›3_≥rf‹m_auth
(
c⁄n
, 
mech
, 
öôª•
, 
Àn
, 
°©e1
, 
°©e2
);

560 
	`Cuæ_ß„‰ì
(
öôª•
);

562 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


563 if((
p›3c
->
authty≥s
 & 
POP3_TYPE_APOP
) &&

564 (
p›3c
->
¥e·y≥
 & 
POP3_TYPE_APOP
))

566 
ªsu…
 = 
	`p›3_≥rf‹m_≠›
(
c⁄n
);

568 if((
p›3c
->
authty≥s
 & 
POP3_TYPE_CLEARTEXT
) &&

569 (
p›3c
->
¥e·y≥
 & 
POP3_TYPE_CLEARTEXT
))

571 
ªsu…
 = 
	`p›3_≥rf‹m_u£r
(
c⁄n
);

574 
	`öfof
(
c⁄n
->
d©a
, "No knownáuthentication mechanisms supported!\n");

575 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

579  
ªsu…
;

580 
	}
}

588 
CURLcode
 
	$p›3_≥rf‹m_comm™d
(
c⁄√˘d©a
 *
c⁄n
)

590 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

591 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

592 
POP3
 *
p›3
 = 
d©a
->
ªq
.
¥Ÿ›
;

593 c⁄° *
comm™d
 = 
NULL
;

596 if(
p›3
->
id
[0] ='\0' || 
c⁄n
->
d©a
->
£t
.
·p_li°_⁄ly
) {

597 
comm™d
 = "LIST";

599 if(
p›3
->
id
[0] != '\0')

601 
p›3
->
å™s„r
 = 
FTPTRANSFER_INFO
;

604 
comm™d
 = "RETR";

607 if(
p›3
->
id
[0] != '\0')

608 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s %s",

609 (
p›3
->
cu°om
 &&Öop3->custom[0] != '\0' ?

610 
p›3
->
cu°om
 : 
comm™d
),Ö›3->
id
);

612 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s",

613 (
p›3
->
cu°om
 &&Öop3->custom[0] != '\0' ?

614 
p›3
->
cu°om
 : 
comm™d
));

616 if(!
ªsu…
)

617 
	`°©e
(
c⁄n
, 
POP3_COMMAND
);

619  
ªsu…
;

620 
	}
}

628 
CURLcode
 
	$p›3_≥rf‹m_quô
(
c⁄√˘d©a
 *
c⁄n
)

630 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

633 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", "QUIT");

635 if(!
ªsu…
)

636 
	`°©e
(
c⁄n
, 
POP3_QUIT
);

638  
ªsu…
;

639 
	}
}

642 
CURLcode
 
	$p›3_°©e_£rvîgªë_ª•
(
c⁄√˘d©a
 *
c⁄n
,

643 
p›3code
,

644 
p›3°©e
 
ö°©e
)

646 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

647 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

648 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

649 c⁄° *
löe
 = 
d©a
->
°©e
.
buf„r
;

650 
size_t
 
Àn
 = 
	`°æí
(
löe
);

651 
size_t
 
i
;

653 ()
ö°©e
;

655 if(
p›3code
 != '+') {

656 
	`Áûf
(
d©a
, "Got unexpectedÖop3-serverÑesponse");

657 
ªsu…
 = 
CURLE_FTP_WEIRD_SERVER_REPLY
;

661 if(
Àn
 >4 && 
löe
[len - 2] == '>') {

663 
i
 = 3; i < 
Àn
 - 2; ++i) {

664 if(
löe
[
i
] == '<') {

666 
size_t
 
time°am∂í
 = 
Àn
 - 1 - 
i
;

667 if(!
time°am∂í
)

671 
p›3c
->
≠›time°amp
 = (*)
	`ˇŒoc
(1, 
time°am∂í
 + 1);

673 if(!
p›3c
->
≠›time°amp
)

677 
	`mem˝y
(
p›3c
->
≠›time°amp
, 
löe
 + 
i
, 
time°am∂í
);

678 
p›3c
->
≠›time°amp
[
time°am∂í
] = '\0';

681 
p›3c
->
authty≥s
 |
POP3_TYPE_APOP
;

687 
ªsu…
 = 
	`p›3_≥rf‹m_ˇ∑
(
c⁄n
);

690  
ªsu…
;

691 
	}
}

694 
CURLcode
 
	$p›3_°©e_ˇ∑_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
p›3code
,

695 
p›3°©e
 
ö°©e
)

697 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

698 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

699 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

700 c⁄° *
löe
 = 
d©a
->
°©e
.
buf„r
;

701 
size_t
 
Àn
 = 
	`°æí
(
löe
);

702 
size_t
 
w‹dÀn
;

704 ()
ö°©e
;

707 if(
p›3code
 == '*') {

709 if(
Àn
 >4 && !
	`memcmp
(
löe
, "STLS", 4))

710 
p›3c
->
és_suµ‹ãd
 = 
TRUE
;

713 if(
Àn
 >4 && !
	`memcmp
(
löe
, "USER", 4))

714 
p›3c
->
authty≥s
 |
POP3_TYPE_CLEARTEXT
;

717 if(
Àn
 >5 && !
	`memcmp
(
löe
, "SASL ", 5)) {

718 
p›3c
->
authty≥s
 |
POP3_TYPE_SASL
;

721 
löe
 += 5;

722 
Àn
 -= 5;

726 
Àn
 &&

727 (*
löe
 == ' ' || *line == '\t' ||

728 *
löe
 == '\r' || *line == '\n')) {

730 
löe
++;

731 
Àn
--;

734 if(!
Àn
)

738 
w‹dÀn
 = 0; w‹dÀ¿< 
Àn
 && 
löe
[wordlen] != ' ' &&

739 
löe
[
w‹dÀn
] != '\t' &&Üine[wordlen] != '\r' &&

740 
löe
[
w‹dÀn
] != '\n';)

741 
w‹dÀn
++;

744 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_LOGIN
))

745 
p›3c
->
authmechs
 |
SASL_MECH_LOGIN
;

746 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_PLAIN
))

747 
p›3c
->
authmechs
 |
SASL_MECH_PLAIN
;

748 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_CRAM_MD5
))

749 
p›3c
->
authmechs
 |
SASL_MECH_CRAM_MD5
;

750 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_DIGEST_MD5
))

751 
p›3c
->
authmechs
 |
SASL_MECH_DIGEST_MD5
;

752 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_GSSAPI
))

753 
p›3c
->
authmechs
 |
SASL_MECH_GSSAPI
;

754 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_EXTERNAL
))

755 
p›3c
->
authmechs
 |
SASL_MECH_EXTERNAL
;

756 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_NTLM
))

757 
p›3c
->
authmechs
 |
SASL_MECH_NTLM
;

758 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_XOAUTH2
))

759 
p›3c
->
authmechs
 |
SASL_MECH_XOAUTH2
;

761 
löe
 +
w‹dÀn
;

762 
Àn
 -
w‹dÀn
;

766 if(
p›3code
 == '+') {

767 if(
d©a
->
£t
.
u£_s¶
 && !
c⁄n
->
s¶
[
FIRSTSOCKET
].
u£
) {

769 if(
p›3c
->
és_suµ‹ãd
)

771 
ªsu…
 = 
	`p›3_≥rf‹m_°¨âls
(
c⁄n
);

772 if(
d©a
->
£t
.
u£_s¶
 =
CURLUSESSL_TRY
)

774 
ªsu…
 = 
	`p›3_≥rf‹m_authítiˇti⁄
(
c⁄n
);

776 
	`Áûf
(
d©a
, "STLSÇot supported.");

777 
ªsu…
 = 
CURLE_USE_SSL_FAILED
;

781 
ªsu…
 = 
	`p›3_≥rf‹m_authítiˇti⁄
(
c⁄n
);

785 
p›3c
->
authty≥s
 |
POP3_TYPE_CLEARTEXT
;

787 
ªsu…
 = 
	`p›3_≥rf‹m_authítiˇti⁄
(
c⁄n
);

790  
ªsu…
;

791 
	}
}

794 
CURLcode
 
	$p›3_°©e_°¨âls_ª•
(
c⁄√˘d©a
 *
c⁄n
,

795 
p›3code
,

796 
p›3°©e
 
ö°©e
)

798 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

799 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

801 ()
ö°©e
;

803 if(
p›3code
 != '+') {

804 if(
d©a
->
£t
.
u£_s¶
 !
CURLUSESSL_TRY
) {

805 
	`Áûf
(
d©a
, "STARTTLS díõd. %c", 
p›3code
);

806 
ªsu…
 = 
CURLE_USE_SSL_FAILED
;

809 
ªsu…
 = 
	`p›3_≥rf‹m_authítiˇti⁄
(
c⁄n
);

812 
ªsu…
 = 
	`p›3_≥rf‹m_upgøde_és
(
c⁄n
);

814  
ªsu…
;

815 
	}
}

818 
CURLcode
 
	$p›3_°©e_auth_∂aö_ª•
(
c⁄√˘d©a
 *
c⁄n
,

819 
p›3code
,

820 
p›3°©e
 
ö°©e
)

822 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

823 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

824 
size_t
 
Àn
 = 0;

825 *
∂aöauth
 = 
NULL
;

827 ()
ö°©e
;

829 if(
p›3code
 != '+') {

830 
	`Áûf
(
d©a
, "Ac˚s†díõd. %c", 
p›3code
);

831 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

835 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_∂aö_mesßge
(
d©a
, 
c⁄n
->
u£r
, c⁄n->
∑sswd
,

836 &
∂aöauth
, &
Àn
);

837 if(!
ªsu…
 && 
∂aöauth
) {

839 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", 
∂aöauth
);

841 if(!
ªsu…
)

842 
	`°©e
(
c⁄n
, 
POP3_AUTH_FINAL
);

846 
	`Cuæ_ß„‰ì
(
∂aöauth
);

848  
ªsu…
;

849 
	}
}

852 
CURLcode
 
	$p›3_°©e_auth_logö_ª•
(
c⁄√˘d©a
 *
c⁄n
,

853 
p›3code
,

854 
p›3°©e
 
ö°©e
)

856 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

857 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

858 
size_t
 
Àn
 = 0;

859 *
authu£r
 = 
NULL
;

861 ()
ö°©e
;

863 if(
p›3code
 != '+') {

864 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
p›3code
);

865 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

869 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_logö_mesßge
(
d©a
, 
c⁄n
->
u£r
,

870 &
authu£r
, &
Àn
);

871 if(!
ªsu…
 && 
authu£r
) {

873 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", 
authu£r
);

875 if(!
ªsu…
)

876 
	`°©e
(
c⁄n
, 
POP3_AUTH_LOGIN_PASSWD
);

880 
	`Cuæ_ß„‰ì
(
authu£r
);

882  
ªsu…
;

883 
	}
}

886 
CURLcode
 
	$p›3_°©e_auth_logö_∑ssw‹d_ª•
(
c⁄√˘d©a
 *
c⁄n
,

887 
p›3code
,

888 
p›3°©e
 
ö°©e
)

890 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

891 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

892 
size_t
 
Àn
 = 0;

893 *
auth∑sswd
 = 
NULL
;

895 ()
ö°©e
;

897 if(
p›3code
 != '+') {

898 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
p›3code
);

899 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

903 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_logö_mesßge
(
d©a
, 
c⁄n
->
∑sswd
,

904 &
auth∑sswd
, &
Àn
);

905 if(!
ªsu…
 && 
auth∑sswd
) {

907 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", 
auth∑sswd
);

909 if(!
ªsu…
)

910 
	`°©e
(
c⁄n
, 
POP3_AUTH_FINAL
);

914 
	`Cuæ_ß„‰ì
(
auth∑sswd
);

916  
ªsu…
;

917 
	}
}

919 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


921 
CURLcode
 
	$p›3_°©e_auth_¸am_ª•
(
c⁄√˘d©a
 *
c⁄n
,

922 
p›3code
,

923 
p›3°©e
 
ö°©e
)

925 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

926 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

927 *
chlg
 = 
NULL
;

928 *
chlg64
 = 
NULL
;

929 *
Ωlyb64
 = 
NULL
;

930 
size_t
 
Àn
 = 0;

932 ()
ö°©e
;

934 if(
p›3code
 != '+') {

935 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
p›3code
);

936  
CURLE_LOGIN_DENIED
;

940 
	`p›3_gë_mesßge
(
d©a
->
°©e
.
buf„r
, &
chlg64
);

943 
ªsu…
 = 
	`Cuæ_ß¶_decode_¸am_md5_mesßge
(
chlg64
, &
chlg
, &
Àn
);

944 if(
ªsu…
) {

946 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", "*");

948 if(!
ªsu…
)

949 
	`°©e
(
c⁄n
, 
POP3_AUTH_CANCEL
);

953 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¸am_md5_mesßge
(
d©a
, 
chlg
, 
c⁄n
->
u£r
,

954 
c⁄n
->
∑sswd
, &
Ωlyb64
, &
Àn
);

955 if(!
ªsu…
 && 
Ωlyb64
) {

957 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", 
Ωlyb64
);

959 if(!
ªsu…
)

960 
	`°©e
(
c⁄n
, 
POP3_AUTH_FINAL
);

964 
	`Cuæ_ß„‰ì
(
chlg
);

965 
	`Cuæ_ß„‰ì
(
Ωlyb64
);

967  
ªsu…
;

968 
	}
}

971 
CURLcode
 
	$p›3_°©e_auth_dige°_ª•
(
c⁄√˘d©a
 *
c⁄n
,

972 
p›3code
,

973 
p›3°©e
 
ö°©e
)

975 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

976 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

977 *
chlg64
 = 
NULL
;

978 *
Ωlyb64
 = 
NULL
;

979 
size_t
 
Àn
 = 0;

981 ()
ö°©e
;

983 if(
p›3code
 != '+') {

984 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
p›3code
);

985  
CURLE_LOGIN_DENIED
;

989 
	`p›3_gë_mesßge
(
d©a
->
°©e
.
buf„r
, &
chlg64
);

992 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_dige°_md5_mesßge
(
d©a
, 
chlg64
,

993 
c⁄n
->
u£r
, c⁄n->
∑sswd
,

994 "p›", &
Ωlyb64
, &
Àn
);

995 if(
ªsu…
) {

996 if(
ªsu…
 =
CURLE_BAD_CONTENT_ENCODING
) {

998 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", "*");

1000 if(!
ªsu…
)

1001 
	`°©e
(
c⁄n
, 
POP3_AUTH_CANCEL
);

1006 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", 
Ωlyb64
);

1008 if(!
ªsu…
)

1009 
	`°©e
(
c⁄n
, 
POP3_AUTH_DIGESTMD5_RESP
);

1012 
	`Cuæ_ß„‰ì
(
Ωlyb64
);

1014  
ªsu…
;

1015 
	}
}

1018 
CURLcode
 
	$p›3_°©e_auth_dige°_ª•_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1019 
p›3code
,

1020 
p›3°©e
 
ö°©e
)

1022 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1023 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1025 ()
ö°©e
;

1027 if(
p›3code
 != '+') {

1028 
	`Áûf
(
d©a
, "Authítiˇti⁄ faûed: %d", 
p›3code
);

1029 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1033 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", "");

1035 if(!
ªsu…
)

1036 
	`°©e
(
c⁄n
, 
POP3_AUTH_FINAL
);

1039  
ªsu…
;

1040 
	}
}

1043 #ifde‡
USE_NTLM


1045 
CURLcode
 
	$p›3_°©e_auth_¡lm_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1046 
p›3code
,

1047 
p›3°©e
 
ö°©e
)

1049 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1050 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1051 
size_t
 
Àn
 = 0;

1052 *
ty≥1msg
 = 
NULL
;

1054 ()
ö°©e
;

1056 if(
p›3code
 != '+') {

1057 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
p›3code
);

1058 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1062 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¡lm_ty≥1_mesßge
(
c⁄n
->
u£r
, c⁄n->
∑sswd
,

1063 &
c⁄n
->
¡lm
,

1064 &
ty≥1msg
, &
Àn
);

1065 if(!
ªsu…
 && 
ty≥1msg
) {

1067 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", 
ty≥1msg
);

1069 if(!
ªsu…
)

1070 
	`°©e
(
c⁄n
, 
POP3_AUTH_NTLM_TYPE2MSG
);

1074 
	`Cuæ_ß„‰ì
(
ty≥1msg
);

1076  
ªsu…
;

1077 
	}
}

1080 
CURLcode
 
	$p›3_°©e_auth_¡lm_ty≥2msg_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1081 
p›3code
,

1082 
p›3°©e
 
ö°©e
)

1084 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1085 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1086 *
ty≥2msg
 = 
NULL
;

1087 *
ty≥3msg
 = 
NULL
;

1088 
size_t
 
Àn
 = 0;

1090 ()
ö°©e
;

1092 if(
p›3code
 != '+') {

1093 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
p›3code
);

1094 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1098 
	`p›3_gë_mesßge
(
d©a
->
°©e
.
buf„r
, &
ty≥2msg
);

1101 
ªsu…
 = 
	`Cuæ_ß¶_decode_¡lm_ty≥2_mesßge
(
d©a
, 
ty≥2msg
, &
c⁄n
->
¡lm
);

1102 if(
ªsu…
) {

1104 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", "*");

1106 if(!
ªsu…
)

1107 
	`°©e
(
c⁄n
, 
POP3_AUTH_CANCEL
);

1111 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¡lm_ty≥3_mesßge
(
d©a
, 
c⁄n
->
u£r
,

1112 
c⁄n
->
∑sswd
, &c⁄n->
¡lm
,

1113 &
ty≥3msg
, &
Àn
);

1114 if(!
ªsu…
 && 
ty≥3msg
) {

1116 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", 
ty≥3msg
);

1118 if(!
ªsu…
)

1119 
	`°©e
(
c⁄n
, 
POP3_AUTH_FINAL
);

1124 
	`Cuæ_ß„‰ì
(
ty≥3msg
);

1126  
ªsu…
;

1127 
	}
}

1131 
CURLcode
 
	$p›3_°©e_auth_xﬂuth2_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1132 
p›3code
, 
p›3°©e
 
ö°©e
)

1134 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1135 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1136 
size_t
 
Àn
 = 0;

1137 *
xﬂuth
 = 
NULL
;

1139 ()
ö°©e
;

1141 if(
p›3code
 != '+') {

1142 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
p›3code
);

1143 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1147 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_xﬂuth2_mesßge
(
c⁄n
->
d©a
, c⁄n->
u£r
,

1148 
c⁄n
->
xﬂuth2_bóªr
,

1149 &
xﬂuth
, &
Àn
);

1150 if(!
ªsu…
 && 
xﬂuth
) {

1152 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "%s", 
xﬂuth
);

1154 if(!
ªsu…
)

1155 
	`°©e
(
c⁄n
, 
POP3_AUTH_FINAL
);

1159 
	`Cuæ_ß„‰ì
(
xﬂuth
);

1161  
ªsu…
;

1162 
	}
}

1165 
CURLcode
 
	$p›3_°©e_auth_ˇn˚l_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1166 
p›3code
,

1167 
p›3°©e
 
ö°©e
)

1169 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1170 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1171 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

1172 c⁄° *
mech
 = 
NULL
;

1173 *
öôª•
 = 
NULL
;

1174 
size_t
 
Àn
 = 0;

1175 
p›3°©e
 
°©e1
 = 
POP3_STOP
;

1176 
p›3°©e
 
°©e2
 = 
POP3_STOP
;

1178 ()
p›3code
;

1179 ()
ö°©e
;

1182 
p›3c
->
authmechs
 ^p›3c->
authu£d
;

1185 
ªsu…
 = 
	`p›3_ˇlc_ß¶_dëaûs
(
c⁄n
, &
mech
, &
öôª•
, &
Àn
, &
°©e1
,

1186 &
°©e2
);

1188 if(!
ªsu…
) {

1191 if(
mech
) {

1193 
ªsu…
 = 
	`p›3_≥rf‹m_auth
(
c⁄n
, 
mech
, 
öôª•
, 
Àn
, 
°©e1
, 
°©e2
);

1195 
	`Cuæ_ß„‰ì
(
öôª•
);

1197 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


1198 if((
p›3c
->
authty≥s
 & 
POP3_TYPE_APOP
) &&

1199 (
p›3c
->
¥e·y≥
 & 
POP3_TYPE_APOP
))

1201 
ªsu…
 = 
	`p›3_≥rf‹m_≠›
(
c⁄n
);

1203 if((
p›3c
->
authty≥s
 & 
POP3_TYPE_CLEARTEXT
) &&

1204 (
p›3c
->
¥e·y≥
 & 
POP3_TYPE_CLEARTEXT
))

1206 
ªsu…
 = 
	`p›3_≥rf‹m_u£r
(
c⁄n
);

1208 
	`Áûf
(
d©a
, "Authentication cancelled");

1210 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1214  
ªsu…
;

1215 
	}
}

1218 
CURLcode
 
	$p›3_°©e_auth_föÆ_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1219 
p›3code
,

1220 
p›3°©e
 
ö°©e
)

1222 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1223 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1225 ()
ö°©e
;

1227 if(
p›3code
 != '+') {

1228 
	`Áûf
(
d©a
, "Authítiˇti⁄ faûed: %d", 
p›3code
);

1229 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1233 
	`°©e
(
c⁄n
, 
POP3_STOP
);

1235  
ªsu…
;

1236 
	}
}

1238 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


1240 
CURLcode
 
	$p›3_°©e_≠›_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
p›3code
,

1241 
p›3°©e
 
ö°©e
)

1243 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1244 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1246 ()
ö°©e
;

1248 if(
p›3code
 != '+') {

1249 
	`Áûf
(
d©a
, "Authítiˇti⁄ faûed: %d", 
p›3code
);

1250 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1254 
	`°©e
(
c⁄n
, 
POP3_STOP
);

1256  
ªsu…
;

1257 
	}
}

1261 
CURLcode
 
	$p›3_°©e_u£r_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
p›3code
,

1262 
p›3°©e
 
ö°©e
)

1264 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1265 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1267 ()
ö°©e
;

1269 if(
p›3code
 != '+') {

1270 
	`Áûf
(
d©a
, "Ac˚s†díõd. %c", 
p›3code
);

1271 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1275 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, "PASS %s",

1276 
c⁄n
->
∑sswd
 ? conn->passwd : "");

1277 if(!
ªsu…
)

1278 
	`°©e
(
c⁄n
, 
POP3_PASS
);

1280  
ªsu…
;

1281 
	}
}

1284 
CURLcode
 
	$p›3_°©e_∑ss_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
p›3code
,

1285 
p›3°©e
 
ö°©e
)

1287 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1288 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1290 ()
ö°©e
;

1292 if(
p›3code
 != '+') {

1293 
	`Áûf
(
d©a
, "Ac˚s†díõd. %c", 
p›3code
);

1294 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1298 
	`°©e
(
c⁄n
, 
POP3_STOP
);

1300  
ªsu…
;

1301 
	}
}

1304 
CURLcode
 
	$p›3_°©e_comm™d_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1305 
p›3code
,

1306 
p›3°©e
 
ö°©e
)

1308 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1309 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1310 
POP3
 *
p›3
 = 
d©a
->
ªq
.
¥Ÿ›
;

1311 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

1312 
pögp⁄g
 *
µ
 = &
p›3c
->pp;

1314 ()
ö°©e
;

1316 if(
p›3code
 != '+') {

1317 
	`°©e
(
c⁄n
, 
POP3_STOP
);

1318  
CURLE_RECV_ERROR
;

1325 
p›3c
->
eob
 = 2;

1329 
p›3c
->
°rù
 = 2;

1331 if(
p›3
->
å™s„r
 =
FTPTRANSFER_BODY
) {

1333 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
FALSE
, 
NULL
, -1, NULL);

1335 if(
µ
->
ˇche
) {

1340 if(!
d©a
->
£t
.
›t_no_body
) {

1341 
ªsu…
 = 
	`Cuæ_p›3_wrôe
(
c⁄n
, 
µ
->
ˇche
,Öp->
ˇche_size
);

1342 if(
ªsu…
)

1343  
ªsu…
;

1347 
	`Cuæ_ß„‰ì
(
µ
->
ˇche
);

1350 
µ
->
ˇche_size
 = 0;

1355 
	`°©e
(
c⁄n
, 
POP3_STOP
);

1357  
ªsu…
;

1358 
	}
}

1360 
CURLcode
 
	$p›3_°©emach_a˘
(
c⁄√˘d©a
 *
c⁄n
)

1362 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1363 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
FIRSTSOCKET
];

1364 
p›3code
;

1365 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

1366 
pögp⁄g
 *
µ
 = &
p›3c
->pp;

1367 
size_t
 
ƒód
 = 0;

1370 if(
p›3c
->
°©e
 =
POP3_UPGRADETLS
)

1371  
	`p›3_≥rf‹m_upgøde_és
(
c⁄n
);

1374 if(
µ
->
£ndÀ·
)

1375  
	`Cuæ_µ_Êush£nd
(
µ
);

1379 
ªsu…
 = 
	`Cuæ_µ_ªadª•
(
sock
, 
µ
, &
p›3code
, &
ƒód
);

1380 if(
ªsu…
)

1381  
ªsu…
;

1383 if(!
p›3code
)

1387 
p›3c
->
°©e
) {

1388 
POP3_SERVERGREET
:

1389 
ªsu…
 = 
	`p›3_°©e_£rvîgªë_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1392 
POP3_CAPA
:

1393 
ªsu…
 = 
	`p›3_°©e_ˇ∑_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1396 
POP3_STARTTLS
:

1397 
ªsu…
 = 
	`p›3_°©e_°¨âls_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1400 
POP3_AUTH_PLAIN
:

1401 
ªsu…
 = 
	`p›3_°©e_auth_∂aö_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1404 
POP3_AUTH_LOGIN
:

1405 
ªsu…
 = 
	`p›3_°©e_auth_logö_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1408 
POP3_AUTH_LOGIN_PASSWD
:

1409 
ªsu…
 = 
	`p›3_°©e_auth_logö_∑ssw‹d_ª•
(
c⁄n
, 
p›3code
,

1410 
p›3c
->
°©e
);

1413 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


1414 
POP3_AUTH_CRAMMD5
:

1415 
ªsu…
 = 
	`p›3_°©e_auth_¸am_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1418 
POP3_AUTH_DIGESTMD5
:

1419 
ªsu…
 = 
	`p›3_°©e_auth_dige°_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1422 
POP3_AUTH_DIGESTMD5_RESP
:

1423 
ªsu…
 = 
	`p›3_°©e_auth_dige°_ª•_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1427 #ifde‡
USE_NTLM


1428 
POP3_AUTH_NTLM
:

1429 
ªsu…
 = 
	`p›3_°©e_auth_¡lm_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1432 
POP3_AUTH_NTLM_TYPE2MSG
:

1433 
ªsu…
 = 
	`p›3_°©e_auth_¡lm_ty≥2msg_ª•
(
c⁄n
, 
p›3code
,

1434 
p›3c
->
°©e
);

1438 
POP3_AUTH_XOAUTH2
:

1439 
ªsu…
 = 
	`p›3_°©e_auth_xﬂuth2_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1442 
POP3_AUTH_CANCEL
:

1443 
ªsu…
 = 
	`p›3_°©e_auth_ˇn˚l_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1446 
POP3_AUTH_FINAL
:

1447 
ªsu…
 = 
	`p›3_°©e_auth_föÆ_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1450 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


1451 
POP3_APOP
:

1452 
ªsu…
 = 
	`p›3_°©e_≠›_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1456 
POP3_USER
:

1457 
ªsu…
 = 
	`p›3_°©e_u£r_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1460 
POP3_PASS
:

1461 
ªsu…
 = 
	`p›3_°©e_∑ss_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1464 
POP3_COMMAND
:

1465 
ªsu…
 = 
	`p›3_°©e_comm™d_ª•
(
c⁄n
, 
p›3code
, 
p›3c
->
°©e
);

1468 
POP3_QUIT
:

1472 
	`°©e
(
c⁄n
, 
POP3_STOP
);

1475 } !
ªsu…
 && 
p›3c
->
°©e
 !
POP3_STOP
 && 
	`Cuæ_µ_m‹ed©a
(
µ
));

1477  
ªsu…
;

1478 
	}
}

1481 
CURLcode
 
	$p›3_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1483 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1484 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

1486 if((
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
Ë&& !
p›3c
->
s¶d⁄e
) {

1487 
ªsu…
 = 
	`Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄n
, 
FIRSTSOCKET
, &
p›3c
->
s¶d⁄e
);

1488 if(
ªsu…
 || !
p›3c
->
s¶d⁄e
)

1489  
ªsu…
;

1492 
ªsu…
 = 
	`Cuæ_µ_°©emach
(&
p›3c
->
µ
, 
FALSE
);

1493 *
d⁄e
 = (
p›3c
->
°©e
 =
POP3_STOP
Ë? 
TRUE
 : 
FALSE
;

1495  
ªsu…
;

1496 
	}
}

1498 
CURLcode
 
	$p›3_block_°©emach
(
c⁄√˘d©a
 *
c⁄n
)

1500 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1501 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

1503 
p›3c
->
°©e
 !
POP3_STOP
 && !
ªsu…
)

1504 
ªsu…
 = 
	`Cuæ_µ_°©emach
(&
p›3c
->
µ
, 
TRUE
);

1506  
ªsu…
;

1507 
	}
}

1511 
CURLcode
 
	$p›3_öô
(
c⁄√˘d©a
 *
c⁄n
)

1513 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1514 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1515 
POP3
 *
p›3
;

1517 
p›3
 = 
d©a
->
ªq
.
¥Ÿ›
 = 
	`ˇŒoc
((
POP3
), 1);

1518 if(!
p›3
)

1519 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1521  
ªsu…
;

1522 
	}
}

1525 
	$p›3_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

1526 
numsocks
)

1528  
	`Cuæ_µ_gësock
(&
c⁄n
->
¥Ÿo
.
p›3c
.
µ
, 
socks
, 
numsocks
);

1529 
	}
}

1541 
CURLcode
 
	$p›3_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1543 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1544 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

1545 
pögp⁄g
 *
µ
 = &
p›3c
->pp;

1547 *
d⁄e
 = 
FALSE
;

1550 
	`c⁄nkìp
(
c⁄n
, "POP3 default");

1553 
µ
->
ª•⁄£_time
 = 
RESP_TIMEOUT
;

1554 
µ
->
°©emach_a˘
 = 
p›3_°©emach_a˘
;

1555 
µ
->
ído‰e•
 = 
p›3_ído‰e•
;

1556 
µ
->
c⁄n
 = conn;

1559 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_ANY
;

1560 
p›3c
->
¥efmech
 = 
SASL_AUTH_ANY
;

1563 
	`Cuæ_µ_öô
(
µ
);

1566 
ªsu…
 = 
	`p›3_∑r£_uæ_›ti⁄s
(
c⁄n
);

1567 if(
ªsu…
)

1568  
ªsu…
;

1571 
	`°©e
(
c⁄n
, 
POP3_SERVERGREET
);

1573 
ªsu…
 = 
	`p›3_mu…i_°©emach
(
c⁄n
, 
d⁄e
);

1575  
ªsu…
;

1576 
	}
}

1587 
CURLcode
 
	$p›3_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
°©us
,

1588 
boﬁ
 
¥em©uª
)

1590 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1591 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1592 
POP3
 *
p›3
 = 
d©a
->
ªq
.
¥Ÿ›
;

1594 ()
¥em©uª
;

1596 if(!
p›3
)

1601  
CURLE_OK
;

1603 if(
°©us
) {

1604 
	`c⁄n˛o£
(
c⁄n
, "POP3 done with bad status");

1605 
ªsu…
 = 
°©us
;

1609 
	`Cuæ_ß„‰ì
(
p›3
->
id
);

1610 
	`Cuæ_ß„‰ì
(
p›3
->
cu°om
);

1613 
p›3
->
å™s„r
 = 
FTPTRANSFER_BODY
;

1615  
ªsu…
;

1616 
	}
}

1625 
CURLcode
 
	$p›3_≥rf‹m
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
c⁄√˘ed
,

1626 
boﬁ
 *
d›ha£_d⁄e
)

1629 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1630 
POP3
 *
p›3
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

1632 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase starts\n"));

1634 if(
c⁄n
->
d©a
->
£t
.
›t_no_body
) {

1636 
p›3
->
å™s„r
 = 
FTPTRANSFER_INFO
;

1639 *
d›ha£_d⁄e
 = 
FALSE
;

1642 
ªsu…
 = 
	`p›3_≥rf‹m_comm™d
(
c⁄n
);

1643 if(
ªsu…
)

1644  
ªsu…
;

1647 
ªsu…
 = 
	`p›3_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

1649 *
c⁄√˘ed
 = 
c⁄n
->
bôs
.
t˝c⁄√˘
[
FIRSTSOCKET
];

1651 if(*
d›ha£_d⁄e
)

1652 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

1654  
ªsu…
;

1655 
	}
}

1666 
CURLcode
 
	$p›3_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1668 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1670 *
d⁄e
 = 
FALSE
;

1673 
ªsu…
 = 
	`p›3_∑r£_uæ_∑th
(
c⁄n
);

1674 if(
ªsu…
)

1675  
ªsu…
;

1678 
ªsu…
 = 
	`p›3_∑r£_cu°om_ªque°
(
c⁄n
);

1679 if(
ªsu…
)

1680  
ªsu…
;

1682 
ªsu…
 = 
	`p›3_ªguœr_å™s„r
(
c⁄n
, 
d⁄e
);

1684  
ªsu…
;

1685 
	}
}

1694 
CURLcode
 
	$p›3_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
)

1696 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

1704 if(!
dód_c⁄√˘i⁄
 && 
p›3c
->
µ
.
c⁄n
 &&Ö›3c->µ.c⁄n->
bôs
.
¥Ÿoc⁄n°¨t
)

1705 if(!
	`p›3_≥rf‹m_quô
(
c⁄n
))

1706 ()
	`p›3_block_°©emach
(
c⁄n
);

1709 
	`Cuæ_µ_disc⁄√˘
(&
p›3c
->
µ
);

1712 
	`Cuæ_ß¶_˛ónup
(
c⁄n
, 
p›3c
->
authu£d
);

1715 
	`Cuæ_ß„‰ì
(
p›3c
->
≠›time°amp
);

1717  
CURLE_OK
;

1718 
	}
}

1721 
CURLcode
 
	$p›3_d›ha£_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
c⁄√˘ed
)

1723 ()
c⁄n
;

1724 ()
c⁄√˘ed
;

1726  
CURLE_OK
;

1727 
	}
}

1730 
CURLcode
 
	$p›3_doög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d›ha£_d⁄e
)

1732 
CURLcode
 
ªsu…
 = 
	`p›3_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

1734 if(
ªsu…
)

1735 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase failed\n"));

1736 if(*
d›ha£_d⁄e
) {

1737 
ªsu…
 = 
	`p›3_d›ha£_d⁄e
(
c⁄n
, 
FALSE
 );

1739 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

1742  
ªsu…
;

1743 
	}
}

1754 
CURLcode
 
	$p›3_ªguœr_å™s„r
(
c⁄√˘d©a
 *
c⁄n
,

1755 
boﬁ
 *
d›ha£_d⁄e
)

1757 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1758 
boﬁ
 
c⁄√˘ed
 = 
FALSE
;

1759 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1762 
d©a
->
ªq
.
size
 = -1;

1765 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 0);

1766 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, 0);

1767 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 0);

1768 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 0);

1771 
ªsu…
 = 
	`p›3_≥rf‹m
(
c⁄n
, &
c⁄√˘ed
, 
d›ha£_d⁄e
);

1774 if(!
ªsu…
 && *
d›ha£_d⁄e
)

1775 
ªsu…
 = 
	`p›3_d›ha£_d⁄e
(
c⁄n
, 
c⁄√˘ed
);

1777  
ªsu…
;

1778 
	}
}

1780 
CURLcode
 
	$p›3_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
)

1782 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1785 
CURLcode
 
ªsu…
 = 
	`p›3_öô
(
c⁄n
);

1786 if(
ªsu…
)

1787  
ªsu…
;

1789 if(
c⁄n
->
bôs
.
hâµroxy
 && !
d©a
->
£t
.
tu¬ñ_thru_hâµroxy
) {

1792 #i‚de‡
CURL_DISABLE_HTTP


1793 if(
c⁄n
->
h™dÀr
 =&
Cuæ_h™dÀr_p›3
)

1794 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_p›3_¥oxy
;

1796 #ifde‡
USE_SSL


1797 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_p›3s_¥oxy
;

1799 
	`Áûf
(
d©a
, "POP3SÇot supported!");

1800  
CURLE_UNSUPPORTED_PROTOCOL
;

1805  
c⁄n
->
h™dÀr
->
	`£tup_c⁄√˘i⁄
(conn);

1807 
	`Áûf
(
d©a
, "POP3 over httpÖroxyÑequires HTTP support built-in!");

1808  
CURLE_UNSUPPORTED_PROTOCOL
;

1812 
d©a
->
°©e
.
∑th
++;

1814  
CURLE_OK
;

1815 
	}
}

1823 
CURLcode
 
	$p›3_∑r£_uæ_›ti⁄s
(
c⁄√˘d©a
 *
c⁄n
)

1825 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1826 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

1827 c⁄° *
›ti⁄s
 = 
c⁄n
->options;

1828 c⁄° *
±r
 = 
›ti⁄s
;

1829 
boﬁ
 
ª£t
 = 
TRUE
;

1831 
±r
 && *ptr) {

1832 c⁄° *
key
 = 
±r
;

1834 *
±r
 && *ptr != '=')

1835 
±r
++;

1837 if(
	`°∫equÆ
(
key
, "AUTH", 4)) {

1838 
size_t
 
Àn
 = 0;

1839 c⁄° *
vÆue
 = ++
±r
;

1841 if(
ª£t
) {

1842 
ª£t
 = 
FALSE
;

1843 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_NONE
;

1844 
p›3c
->
¥efmech
 = 
SASL_AUTH_NONE
;

1847 *
±r
 && *ptr != ';') {

1848 
±r
++;

1849 
Àn
++;

1852 if(
	`°∫equÆ
(
vÆue
, "*", 
Àn
)) {

1853 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_ANY
;

1854 
p›3c
->
¥efmech
 = 
SASL_AUTH_ANY
;

1856 if(
	`°∫equÆ
(
vÆue
, "+APOP", 
Àn
)) {

1857 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_APOP
;

1858 
p›3c
->
¥efmech
 = 
SASL_AUTH_NONE
;

1860 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_LOGIN
, 
Àn
)) {

1861 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_SASL
;

1862 
p›3c
->
¥efmech
 |
SASL_MECH_LOGIN
;

1864 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_PLAIN
, 
Àn
)) {

1865 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_SASL
;

1866 
p›3c
->
¥efmech
 |
SASL_MECH_PLAIN
;

1868 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_CRAM_MD5
, 
Àn
)) {

1869 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_SASL
;

1870 
p›3c
->
¥efmech
 |
SASL_MECH_CRAM_MD5
;

1872 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_DIGEST_MD5
, 
Àn
)) {

1873 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_SASL
;

1874 
p›3c
->
¥efmech
 |
SASL_MECH_DIGEST_MD5
;

1876 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_GSSAPI
, 
Àn
)) {

1877 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_SASL
;

1878 
p›3c
->
¥efmech
 |
SASL_MECH_GSSAPI
;

1880 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_NTLM
, 
Àn
)) {

1881 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_SASL
;

1882 
p›3c
->
¥efmech
 |
SASL_MECH_NTLM
;

1884 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_XOAUTH2
, 
Àn
)) {

1885 
p›3c
->
¥e·y≥
 = 
POP3_TYPE_SASL
;

1886 
p›3c
->
¥efmech
 |
SASL_MECH_XOAUTH2
;

1889 if(*
±r
 == ';')

1890 
±r
++;

1893 
ªsu…
 = 
CURLE_URL_MALFORMAT
;

1896  
ªsu…
;

1897 
	}
}

1905 
CURLcode
 
	$p›3_∑r£_uæ_∑th
(
c⁄√˘d©a
 *
c⁄n
)

1908 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1909 
POP3
 *
p›3
 = 
d©a
->
ªq
.
¥Ÿ›
;

1910 c⁄° *
∑th
 = 
d©a
->
°©e
.path;

1913  
	`Cuæ_uædecode
(
d©a
, 
∑th
, 0, &
p›3
->
id
, 
NULL
, 
TRUE
);

1914 
	}
}

1922 
CURLcode
 
	$p›3_∑r£_cu°om_ªque°
(
c⁄√˘d©a
 *
c⁄n
)

1924 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1925 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1926 
POP3
 *
p›3
 = 
d©a
->
ªq
.
¥Ÿ›
;

1927 c⁄° *
cu°om
 = 
d©a
->
£t
.
°r
[
STRING_CUSTOMREQUEST
];

1930 if(
cu°om
)

1931 
ªsu…
 = 
	`Cuæ_uædecode
(
d©a
, 
cu°om
, 0, &
p›3
->cu°om, 
NULL
, 
TRUE
);

1933  
ªsu…
;

1934 
	}
}

1942 
CURLcode
 
	$p›3_ˇlc_ß¶_dëaûs
(
c⁄√˘d©a
 *
c⁄n
,

1943 c⁄° **
mech
,

1944 **
öôª•
, 
size_t
 *
Àn
,

1945 
p›3°©e
 *
°©e1
,Ö›3°©ê*
°©e2
)

1947 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1948 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1949 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

1953 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


1954 if((
p›3c
->
authmechs
 & 
SASL_MECH_DIGEST_MD5
) &&

1955 (
p›3c
->
¥efmech
 & 
SASL_MECH_DIGEST_MD5
)) {

1956 *
mech
 = 
SASL_MECH_STRING_DIGEST_MD5
;

1957 *
°©e1
 = 
POP3_AUTH_DIGESTMD5
;

1958 
p›3c
->
authu£d
 = 
SASL_MECH_DIGEST_MD5
;

1960 if((
p›3c
->
authmechs
 & 
SASL_MECH_CRAM_MD5
) &&

1961 (
p›3c
->
¥efmech
 & 
SASL_MECH_CRAM_MD5
)) {

1962 *
mech
 = 
SASL_MECH_STRING_CRAM_MD5
;

1963 *
°©e1
 = 
POP3_AUTH_CRAMMD5
;

1964 
p›3c
->
authu£d
 = 
SASL_MECH_CRAM_MD5
;

1968 #ifde‡
USE_NTLM


1969 if((
p›3c
->
authmechs
 & 
SASL_MECH_NTLM
) &&

1970 (
p›3c
->
¥efmech
 & 
SASL_MECH_NTLM
)) {

1971 *
mech
 = 
SASL_MECH_STRING_NTLM
;

1972 *
°©e1
 = 
POP3_AUTH_NTLM
;

1973 *
°©e2
 = 
POP3_AUTH_NTLM_TYPE2MSG
;

1974 
p›3c
->
authu£d
 = 
SASL_MECH_NTLM
;

1976 if(
d©a
->
£t
.
ß¶_ú
)

1977 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¡lm_ty≥1_mesßge
(
c⁄n
->
u£r
, c⁄n->
∑sswd
,

1978 &
c⁄n
->
¡lm
,

1979 
öôª•
, 
Àn
);

1983 if(((
p›3c
->
authmechs
 & 
SASL_MECH_XOAUTH2
) &&

1984 (
p›3c
->
¥efmech
 & 
SASL_MECH_XOAUTH2
) &&

1985 (
p›3c
->
¥efmech
 !
SASL_AUTH_ANY
)Ë|| 
c⁄n
->
xﬂuth2_bóªr
) {

1986 *
mech
 = 
SASL_MECH_STRING_XOAUTH2
;

1987 *
°©e1
 = 
POP3_AUTH_XOAUTH2
;

1988 *
°©e2
 = 
POP3_AUTH_FINAL
;

1989 
p›3c
->
authu£d
 = 
SASL_MECH_XOAUTH2
;

1991 if(
d©a
->
£t
.
ß¶_ú
)

1992 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_xﬂuth2_mesßge
(
d©a
, 
c⁄n
->
u£r
,

1993 
c⁄n
->
xﬂuth2_bóªr
,

1994 
öôª•
, 
Àn
);

1996 if((
p›3c
->
authmechs
 & 
SASL_MECH_LOGIN
) &&

1997 (
p›3c
->
¥efmech
 & 
SASL_MECH_LOGIN
)) {

1998 *
mech
 = 
SASL_MECH_STRING_LOGIN
;

1999 *
°©e1
 = 
POP3_AUTH_LOGIN
;

2000 *
°©e2
 = 
POP3_AUTH_LOGIN_PASSWD
;

2001 
p›3c
->
authu£d
 = 
SASL_MECH_LOGIN
;

2003 if(
d©a
->
£t
.
ß¶_ú
)

2004 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_logö_mesßge
(
d©a
, 
c⁄n
->
u£r
, 
öôª•
, 
Àn
);

2006 if((
p›3c
->
authmechs
 & 
SASL_MECH_PLAIN
) &&

2007 (
p›3c
->
¥efmech
 & 
SASL_MECH_PLAIN
)) {

2008 *
mech
 = 
SASL_MECH_STRING_PLAIN
;

2009 *
°©e1
 = 
POP3_AUTH_PLAIN
;

2010 *
°©e2
 = 
POP3_AUTH_FINAL
;

2011 
p›3c
->
authu£d
 = 
SASL_MECH_PLAIN
;

2013 if(
d©a
->
£t
.
ß¶_ú
)

2014 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_∂aö_mesßge
(
d©a
, 
c⁄n
->
u£r
, c⁄n->
∑sswd
,

2015 
öôª•
, 
Àn
);

2018  
ªsu…
;

2019 
	}
}

2028 
CURLcode
 
	$Cuæ_p›3_wrôe
(
c⁄√˘d©a
 *
c⁄n
, *
°r
, 
size_t
 
ƒód
)

2031 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2032 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2033 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

2035 
p›3_c⁄n
 *
p›3c
 = &
c⁄n
->
¥Ÿo
.pop3c;

2036 
boﬁ
 
°rù_dŸ
 = 
FALSE
;

2037 
size_t
 
œ°
 = 0;

2038 
size_t
 
i
;

2045 
i
 = 0; i < 
ƒód
; i++) {

2046 
size_t
 
¥ev
 = 
p›3c
->
eob
;

2048 
°r
[
i
]) {

2050 if(
p›3c
->
eob
 == 0) {

2051 
p›3c
->
eob
++;

2053 if(
i
) {

2055 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, &
°r
[
œ°
],

2056 
i
 - 
œ°
);

2058 if(
ªsu…
)

2059  
ªsu…
;

2061 
œ°
 = 
i
;

2064 if(
p›3c
->
eob
 == 3)

2065 
p›3c
->
eob
++;

2069 
p›3c
->
eob
 = 1;

2073 if(
p›3c
->
eob
 == 1 ||Öop3c->eob == 4)

2074 
p›3c
->
eob
++;

2078 
p›3c
->
eob
 = 0;

2082 if(
p›3c
->
eob
 == 2)

2083 
p›3c
->
eob
++;

2084 if(
p›3c
->
eob
 == 3) {

2086 
°rù_dŸ
 = 
TRUE
;

2087 
p›3c
->
eob
 = 0;

2092 
p›3c
->
eob
 = 0;

2096 
p›3c
->
eob
 = 0;

2101 if(
¥ev
 &&Öªv >
p›3c
->
eob
) {

2105 
¥ev
 && 
p›3c
->
°rù
) {

2106 
¥ev
--;

2107 
p›3c
->
°rù
--;

2110 if(
¥ev
) {

2113 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)
POP3_EOB
,

2114 
°rù_dŸ
 ? 
¥ev
 - 1 :Örev);

2116 if(
ªsu…
)

2117  
ªsu…
;

2119 
œ°
 = 
i
;

2120 
°rù_dŸ
 = 
FALSE
;

2125 if(
p›3c
->
eob
 =
POP3_EOB_LEN
) {

2129 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, (*)
POP3_EOB
, 2);

2131 
k
->
kìp⁄
 &~
KEEP_RECV
;

2132 
p›3c
->
eob
 = 0;

2134  
ªsu…
;

2137 if(
p›3c
->
eob
)

2139  
CURLE_OK
;

2141 if(
ƒód
 - 
œ°
) {

2142 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, &
°r
[
œ°
],

2143 
ƒód
 - 
œ°
);

2146  
ªsu…
;

2147 
	}
}

	@lib/pop3.h

1 #i‚de‡
HEADER_CURL_POP3_H


2 
	#HEADER_CURL_POP3_H


	)

25 
	~"pögp⁄g.h
"

31 
	mPOP3_STOP
,

32 
	mPOP3_SERVERGREET
,

34 
	mPOP3_CAPA
,

35 
	mPOP3_STARTTLS
,

36 
	mPOP3_UPGRADETLS
,

38 
	mPOP3_AUTH_PLAIN
,

39 
	mPOP3_AUTH_LOGIN
,

40 
	mPOP3_AUTH_LOGIN_PASSWD
,

41 
	mPOP3_AUTH_CRAMMD5
,

42 
	mPOP3_AUTH_DIGESTMD5
,

43 
	mPOP3_AUTH_DIGESTMD5_RESP
,

44 
	mPOP3_AUTH_NTLM
,

45 
	mPOP3_AUTH_NTLM_TYPE2MSG
,

46 
	mPOP3_AUTH_XOAUTH2
,

47 
	mPOP3_AUTH_CANCEL
,

48 
	mPOP3_AUTH_FINAL
,

49 
	mPOP3_APOP
,

50 
	mPOP3_USER
,

51 
	mPOP3_PASS
,

52 
	mPOP3_COMMAND
,

53 
	mPOP3_QUIT
,

54 
	mPOP3_LAST


55 } 
	tp›3°©e
;

61 
	sPOP3
 {

62 
cuæ_µ_å™s„r
 
	må™s„r
;

63 *
	mid
;

64 *
	mcu°om
;

69 
	sp›3_c⁄n
 {

70 
pögp⁄g
 
	mµ
;

71 
p›3°©e
 
	m°©e
;

72 
boﬁ
 
	ms¶d⁄e
;

73 
size_t
 
	meob
;

75 
size_t
 
	m°rù
;

77 
	mauthty≥s
;

78 
	mauthmechs
;

79 
	m¥e·y≥
;

80 
	m¥efmech
;

81 
	mauthu£d
;

82 *
	m≠›time°amp
;

83 
boﬁ
 
	més_suµ‹ãd
;

86 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_p›3
;

87 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_p›3s
;

90 
	#POP3_TYPE_CLEARTEXT
 (1 << 0)

	)

91 
	#POP3_TYPE_APOP
 (1 << 1)

	)

92 
	#POP3_TYPE_SASL
 (1 << 2)

	)

95 
	#POP3_TYPE_NONE
 0

	)

96 
	#POP3_TYPE_ANY
 ~0U

	)

99 
	#POP3_EOB
 "\x0d\x0a\x2e\x0d\x0a"

	)

100 
	#POP3_EOB_LEN
 5

	)

104 
CURLcode
 
Cuæ_p›3_wrôe
(
c⁄√˘d©a
 *
c⁄n
, *
°r
, 
size_t
 
ƒód
);

	@lib/progress.c

23 
	~"cuæ_£tup.h
"

25 
	~"uæd©a.h
"

26 
	~"£ndf.h
"

27 
	~"¥ogªss.h
"

29 
	#_MPRINTF_REPLACE


	)

30 
	~<cuæ/m¥ötf.h
>

34 
	$time2°r
(*
r
, 
cuæ_off_t
 
£c⁄ds
)

36 
cuæ_off_t
 
d
, 
h
, 
m
, 
s
;

37 if(
£c⁄ds
 <= 0) {

38 
	`°r˝y
(
r
, "--:--:--");

41 
h
 = 
£c⁄ds
 / 
	`CURL_OFF_T_C
(3600);

42 if(
h
 <
	`CURL_OFF_T_C
(99)) {

43 
m
 = (
£c⁄ds
 - (
h
*
	`CURL_OFF_T_C
(3600))) / CURL_OFF_T_C(60);

44 
s
 = (
£c⁄ds
 - (
h
*
	`CURL_OFF_T_C
(3600))Ë- (
m
*CURL_OFF_T_C(60));

45 
	`¢¥ötf
(
r
, 9, "%2" 
CURL_FORMAT_CURL_OFF_T
 ":%02" CURL_FORMAT_CURL_OFF_T

46 ":%02" 
CURL_FORMAT_CURL_OFF_T
, 
h
, 
m
, 
s
);

51 
d
 = 
£c⁄ds
 / 
	`CURL_OFF_T_C
(86400);

52 
h
 = (
£c⁄ds
 - (
d
*
	`CURL_OFF_T_C
(86400))) / CURL_OFF_T_C(3600);

53 if(
d
 <
	`CURL_OFF_T_C
(999))

54 
	`¢¥ötf
(
r
, 9, "%3" 
CURL_FORMAT_CURL_OFF_T


55 "d %02" 
CURL_FORMAT_CURL_OFF_T
 "h", 
d
, 
h
);

57 
	`¢¥ötf
(
r
, 9, "%7" 
CURL_FORMAT_CURL_OFF_T
 "d", 
d
);

59 
	}
}

64 *
	$max5d©a
(
cuæ_off_t
 
byãs
, *
max5
)

66 
	#ONE_KILOBYTE
 
	`CURL_OFF_T_C
(1024)

	)

67 
	#ONE_MEGABYTE
 (
	`CURL_OFF_T_C
(1024Ë* 
ONE_KILOBYTE
)

	)

68 
	#ONE_GIGABYTE
 (
	`CURL_OFF_T_C
(1024Ë* 
ONE_MEGABYTE
)

	)

69 
	#ONE_TERABYTE
 (
	`CURL_OFF_T_C
(1024Ë* 
ONE_GIGABYTE
)

	)

70 
	#ONE_PETABYTE
 (
	`CURL_OFF_T_C
(1024Ë* 
ONE_TERABYTE
)

	)

72 if(
byãs
 < 
	`CURL_OFF_T_C
(100000))

73 
	`¢¥ötf
(
max5
, 6, "%5" 
CURL_FORMAT_CURL_OFF_T
, 
byãs
);

75 if(
byãs
 < 
	`CURL_OFF_T_C
(10000Ë* 
ONE_KILOBYTE
)

76 
	`¢¥ötf
(
max5
, 6, "%4" 
CURL_FORMAT_CURL_OFF_T
 "k", 
byãs
/
ONE_KILOBYTE
);

78 if(
byãs
 < 
	`CURL_OFF_T_C
(100Ë* 
ONE_MEGABYTE
)

80 
	`¢¥ötf
(
max5
, 6, "%2" 
CURL_FORMAT_CURL_OFF_T
 ".%0"

81 
CURL_FORMAT_CURL_OFF_T
 "M", 
byãs
/
ONE_MEGABYTE
,

82 (
byãs
%
ONE_MEGABYTE
Ë/ (ONE_MEGABYTE/
	`CURL_OFF_T_C
(10)) );

84 #i‡(
CURL_SIZEOF_CURL_OFF_T
 > 4)

86 if(
byãs
 < 
	`CURL_OFF_T_C
(10000Ë* 
ONE_MEGABYTE
)

88 
	`¢¥ötf
(
max5
, 6, "%4" 
CURL_FORMAT_CURL_OFF_T
 "M", 
byãs
/
ONE_MEGABYTE
);

90 if(
byãs
 < 
	`CURL_OFF_T_C
(100Ë* 
ONE_GIGABYTE
)

92 
	`¢¥ötf
(
max5
, 6, "%2" 
CURL_FORMAT_CURL_OFF_T
 ".%0"

93 
CURL_FORMAT_CURL_OFF_T
 "G", 
byãs
/
ONE_GIGABYTE
,

94 (
byãs
%
ONE_GIGABYTE
Ë/ (ONE_GIGABYTE/
	`CURL_OFF_T_C
(10)) );

96 if(
byãs
 < 
	`CURL_OFF_T_C
(10000Ë* 
ONE_GIGABYTE
)

98 
	`¢¥ötf
(
max5
, 6, "%4" 
CURL_FORMAT_CURL_OFF_T
 "G", 
byãs
/
ONE_GIGABYTE
);

100 if(
byãs
 < 
	`CURL_OFF_T_C
(10000Ë* 
ONE_TERABYTE
)

102 
	`¢¥ötf
(
max5
, 6, "%4" 
CURL_FORMAT_CURL_OFF_T
 "T", 
byãs
/
ONE_TERABYTE
);

106 
	`¢¥ötf
(
max5
, 6, "%4" 
CURL_FORMAT_CURL_OFF_T
 "P", 
byãs
/
ONE_PETABYTE
);

114 
	`¢¥ötf
(
max5
, 6, "%4" 
CURL_FORMAT_CURL_OFF_T
 "M", 
byãs
/
ONE_MEGABYTE
);

118  
max5
;

119 
	}
}

135 
	$Cuæ_pgrsD⁄e
(
c⁄√˘d©a
 *
c⁄n
)

137 
rc
;

138 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

139 
d©a
->
¥ogªss
.
œ°show
=0;

140 
rc
 = 
	`Cuæ_pgrsUpd©e
(
c⁄n
);

141 if(
rc
)

142  
rc
;

144 if(!(
d©a
->
¥ogªss
.
Êags
 & 
PGRS_HIDE
) &&

145 !
d©a
->
¥ogªss
.
ˇŒback
)

148 
	`Ârötf
(
d©a
->
£t
.
îr
, "\n");

150 
d©a
->
¥ogªss
.
•ìdî_c
 = 0;

152 
	}
}

155 
	$Cuæ_pgrsRe£tTimesSizes
(
Sessi⁄H™dÀ
 *
d©a
)

157 
d©a
->
¥ogªss
.
t_n¶ookup
 = 0.0;

158 
d©a
->
¥ogªss
.
t_c⁄√˘
 = 0.0;

159 
d©a
->
¥ogªss
.
t_¥ëøns„r
 = 0.0;

160 
d©a
->
¥ogªss
.
t_°¨âøns„r
 = 0.0;

162 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 0);

163 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 0);

164 
	}
}

166 
	$Cuæ_pgrsTime
(
Sessi⁄H™dÀ
 *
d©a
, 
timîid
 
timî
)

168 
timevÆ
 
now
 = 
	`Cuæ_tvnow
();

170 
timî
) {

172 
TIMER_NONE
:

175 
TIMER_STARTOP
:

177 
d©a
->
¥ogªss
.
t_°¨t›
 = 
now
;

179 
TIMER_STARTSINGLE
:

181 
d©a
->
¥ogªss
.
t_°¨tsögÀ
 = 
now
;

184 
TIMER_STARTACCEPT
:

185 
d©a
->
¥ogªss
.
t_ac˚±d©a
 = 
	`Cuæ_tvnow
();

188 
TIMER_NAMELOOKUP
:

189 
d©a
->
¥ogªss
.
t_n¶ookup
 =

190 
	`Cuæ_tvdiff_£cs
(
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
);

192 
TIMER_CONNECT
:

193 
d©a
->
¥ogªss
.
t_c⁄√˘
 =

194 
	`Cuæ_tvdiff_£cs
(
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
);

196 
TIMER_APPCONNECT
:

197 
d©a
->
¥ogªss
.
t_≠pc⁄√˘
 =

198 
	`Cuæ_tvdiff_£cs
(
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
);

200 
TIMER_PRETRANSFER
:

201 
d©a
->
¥ogªss
.
t_¥ëøns„r
 =

202 
	`Cuæ_tvdiff_£cs
(
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
);

204 
TIMER_STARTTRANSFER
:

205 
d©a
->
¥ogªss
.
t_°¨âøns„r
 =

206 
	`Cuæ_tvdiff_£cs
(
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
);

208 
TIMER_POSTRANSFER
:

211 
TIMER_REDIRECT
:

212 
d©a
->
¥ogªss
.
t_ªdúe˘
 = 
	`Cuæ_tvdiff_£cs
(
now
, d©a->¥ogªss.
°¨t
);

215 
	}
}

217 
	$Cuæ_pgrsSèπNow
(
Sessi⁄H™dÀ
 *
d©a
)

219 
d©a
->
¥ogªss
.
•ìdî_c
 = 0;

220 
d©a
->
¥ogªss
.
°¨t
 = 
	`Cuæ_tvnow
();

222 
d©a
->
¥ogªss
.
Êags
 &
PGRS_HIDE
|
PGRS_HEADERS_OUT
;

223 
	}
}

225 
	$Cuæ_pgrsSëDow∆ﬂdCou¡î
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_off_t
 
size
)

227 
d©a
->
¥ogªss
.
dow∆ﬂded
 = 
size
;

228 
	}
}

230 
	$Cuæ_pgrsSëU∂ﬂdCou¡î
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_off_t
 
size
)

232 
d©a
->
¥ogªss
.
u∂ﬂded
 = 
size
;

233 
	}
}

235 
	$Cuæ_pgrsSëDow∆ﬂdSize
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_off_t
 
size
)

237 
d©a
->
¥ogªss
.
size_dl
 = 
size
;

238 if(
size
 >= 0)

239 
d©a
->
¥ogªss
.
Êags
 |
PGRS_DL_SIZE_KNOWN
;

241 
d©a
->
¥ogªss
.
Êags
 &~
PGRS_DL_SIZE_KNOWN
;

242 
	}
}

244 
	$Cuæ_pgrsSëU∂ﬂdSize
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_off_t
 
size
)

246 
d©a
->
¥ogªss
.
size_ul
 = 
size
;

247 if(
size
 >= 0)

248 
d©a
->
¥ogªss
.
Êags
 |
PGRS_UL_SIZE_KNOWN
;

250 
d©a
->
¥ogªss
.
Êags
 &~
PGRS_UL_SIZE_KNOWN
;

251 
	}
}

257 
	$Cuæ_pgrsUpd©e
(
c⁄√˘d©a
 *
c⁄n
)

259 
timevÆ
 
now
;

260 
ªsu…
;

261 
max5
[6][10];

262 
cuæ_off_t
 
dÕî˚n
=0;

263 
cuæ_off_t
 
uÕî˚n
=0;

264 
cuæ_off_t
 
tŸÆ_≥r˚n
=0;

265 
cuæ_off_t
 
tŸÆ_å™s„r
;

266 
cuæ_off_t
 
tŸÆ_ex≥˘ed_å™s„r
;

267 
cuæ_off_t
 
time•ít
;

268 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

269 
nowödex
 = 
d©a
->
¥ogªss
.
•ìdî_c
% 
CURR_TIME
;

270 
checködex
;

271 
cou¡ödex
;

272 
time_À·
[10];

273 
time_tŸÆ
[10];

274 
time_•ít
[10];

275 
cuæ_off_t
 
uÀ°im©e
=0;

276 
cuæ_off_t
 
dÀ°im©e
=0;

277 
cuæ_off_t
 
tŸÆ_e°im©e
;

278 
boﬁ
 
shownow
=
FALSE
;

280 
now
 = 
	`Cuæ_tvnow
();

283 
d©a
->
¥ogªss
.
time•ít
 =

284 ()(
now
.
tv_£c
 - 
d©a
->
¥ogªss
.
°¨t
.tv_sec) +

285 ()(
now
.
tv_u£c
 - 
d©a
->
¥ogªss
.
°¨t
.tv_usec)/1000000.0;

286 
time•ít
 = (
cuæ_off_t
)
d©a
->
¥ogªss
.timespent;

289 
d©a
->
¥ogªss
.
dl•ìd
 = (
cuæ_off_t
)

290 (()
d©a
->
¥ogªss
.
dow∆ﬂded
/

291 (
d©a
->
¥ogªss
.
time•ít
>0?data->progress.timespent:1));

294 
d©a
->
¥ogªss
.
ul•ìd
 = (
cuæ_off_t
)

295 (()
d©a
->
¥ogªss
.
u∂ﬂded
/

296 (
d©a
->
¥ogªss
.
time•ít
>0?data->progress.timespent:1));

299 if(
d©a
->
¥ogªss
.
œ°show
 !()
now
.
tv_£c
) {

300 
shownow
 = 
TRUE
;

302 
d©a
->
¥ogªss
.
œ°show
 = 
now
.
tv_£c
;

306 
d©a
->
¥ogªss
.
•ìdî
[ 
nowödex
 ] =

307 
d©a
->
¥ogªss
.
dow∆ﬂded
>d©a->¥ogªss.
u∂ﬂded
?

308 
d©a
->
¥ogªss
.
dow∆ﬂded
:d©a->¥ogªss.
u∂ﬂded
;

311 
d©a
->
¥ogªss
.
•ìdî_time
 [ 
nowödex
 ] = 
now
;

315 
d©a
->
¥ogªss
.
•ìdî_c
++;

321 
cou¡ödex
 = ((
d©a
->
¥ogªss
.
•ìdî_c
>=
CURR_TIME
)?

322 
CURR_TIME
:
d©a
->
¥ogªss
.
•ìdî_c
) - 1;

325 if(
cou¡ödex
) {

326 
•™_ms
;

331 
checködex
 = (
d©a
->
¥ogªss
.
•ìdî_c
>=
CURR_TIME
)?

332 
d©a
->
¥ogªss
.
•ìdî_c
%
CURR_TIME
:0;

335 
•™_ms
 = 
	`Cuæ_tvdiff
(
now
,

336 
d©a
->
¥ogªss
.
•ìdî_time
[
checködex
]);

337 if(0 =
•™_ms
)

338 
•™_ms
=1;

342 
cuæ_off_t
 
amou¡
 = 
d©a
->
¥ogªss
.
•ìdî
[
nowödex
]-

343 
d©a
->
¥ogªss
.
•ìdî
[
checködex
];

345 if(
amou¡
 > 
	`CURL_OFF_T_C
(4294967) )

348 
d©a
->
¥ogªss
.
cuºít_•ìd
 = (
cuæ_off_t
)

349 (()
amou¡
/(()
•™_ms
/1000.0));

353 
d©a
->
¥ogªss
.
cuºít_•ìd
 = 
amou¡
*
	`CURL_OFF_T_C
(1000)/
•™_ms
;

358 
d©a
->
¥ogªss
.
cuºít_•ìd
 =

359 (
d©a
->
¥ogªss
.
ul•ìd
>d©a->¥ogªss.
dl•ìd
)?

360 
d©a
->
¥ogªss
.
ul•ìd
:d©a->¥ogªss.
dl•ìd
;

364 if(!(
d©a
->
¥ogªss
.
Êags
 & 
PGRS_HIDE
)) {

367 if(
d©a
->
£t
.
fx„röfo
) {

369 
ªsu…

d©a
->
£t
.
	`fx„röfo
(d©a->£t.
¥ogªss_˛õ¡
,

370 
d©a
->
¥ogªss
.
size_dl
,

371 
d©a
->
¥ogªss
.
dow∆ﬂded
,

372 
d©a
->
¥ogªss
.
size_ul
,

373 
d©a
->
¥ogªss
.
u∂ﬂded
);

374 if(
ªsu…
)

375 
	`Áûf
(
d©a
, "Callbackáborted");

376  
ªsu…
;

378 if(
d©a
->
£t
.
Ârogªss
) {

380 
ªsu…

d©a
->
£t
.
	`Ârogªss
(d©a->£t.
¥ogªss_˛õ¡
,

381 ()
d©a
->
¥ogªss
.
size_dl
,

382 ()
d©a
->
¥ogªss
.
dow∆ﬂded
,

383 ()
d©a
->
¥ogªss
.
size_ul
,

384 ()
d©a
->
¥ogªss
.
u∂ﬂded
);

385 if(
ªsu…
)

386 
	`Áûf
(
d©a
, "Callbackáborted");

387  
ªsu…
;

390 if(!
shownow
)

397 if(!(
d©a
->
¥ogªss
.
Êags
 & 
PGRS_HEADERS_OUT
)) {

398 if(
d©a
->
°©e
.
ªsume_‰om
) {

399 
	`Ârötf
(
d©a
->
£t
.
îr
,

401 
CURL_FORMAT_CURL_OFF_T
 "\n", 
d©a
->
°©e
.
ªsume_‰om
);

403 
	`Ârötf
(
d©a
->
£t
.
îr
,

408 
d©a
->
¥ogªss
.
Êags
 |
PGRS_HEADERS_OUT
;

412 if((
d©a
->
¥ogªss
.
Êags
 & 
PGRS_UL_SIZE_KNOWN
) &&

413 (
d©a
->
¥ogªss
.
ul•ìd
 > 
	`CURL_OFF_T_C
(0))) {

414 
uÀ°im©e
 = 
d©a
->
¥ogªss
.
size_ul
 / d©a->¥ogªss.
ul•ìd
;

416 if(
d©a
->
¥ogªss
.
size_ul
 > 
	`CURL_OFF_T_C
(10000))

417 
uÕî˚n
 = 
d©a
->
¥ogªss
.
u∂ﬂded
 /

418 (
d©a
->
¥ogªss
.
size_ul
/
	`CURL_OFF_T_C
(100));

419 if(
d©a
->
¥ogªss
.
size_ul
 > 
	`CURL_OFF_T_C
(0))

420 
uÕî˚n
 = (
d©a
->
¥ogªss
.
u∂ﬂded
*100) /

421 
d©a
->
¥ogªss
.
size_ul
;

425 if((
d©a
->
¥ogªss
.
Êags
 & 
PGRS_DL_SIZE_KNOWN
) &&

426 (
d©a
->
¥ogªss
.
dl•ìd
 > 
	`CURL_OFF_T_C
(0))) {

427 
dÀ°im©e
 = 
d©a
->
¥ogªss
.
size_dl
 / d©a->¥ogªss.
dl•ìd
;

429 if(
d©a
->
¥ogªss
.
size_dl
 > 
	`CURL_OFF_T_C
(10000))

430 
dÕî˚n
 = 
d©a
->
¥ogªss
.
dow∆ﬂded
 /

431 (
d©a
->
¥ogªss
.
size_dl
/
	`CURL_OFF_T_C
(100));

432 if(
d©a
->
¥ogªss
.
size_dl
 > 
	`CURL_OFF_T_C
(0))

433 
dÕî˚n
 = (
d©a
->
¥ogªss
.
dow∆ﬂded
*100) /

434 
d©a
->
¥ogªss
.
size_dl
;

439 
tŸÆ_e°im©e
 = 
uÀ°im©e
>
dÀ°im©e
?ulestimate:dlestimate;

442 
	`time2°r
(
time_À·
, 
tŸÆ_e°im©e
 > 0?—ŸÆ_e°im©ê- 
time•ít
):0);

443 
	`time2°r
(
time_tŸÆ
, 
tŸÆ_e°im©e
);

444 
	`time2°r
(
time_•ít
, 
time•ít
);

447 
tŸÆ_ex≥˘ed_å™s„r
 =

448 (
d©a
->
¥ogªss
.
Êags
 & 
PGRS_UL_SIZE_KNOWN
?

449 
d©a
->
¥ogªss
.
size_ul
:d©a->¥ogªss.
u∂ﬂded
)+

450 (
d©a
->
¥ogªss
.
Êags
 & 
PGRS_DL_SIZE_KNOWN
?

451 
d©a
->
¥ogªss
.
size_dl
:d©a->¥ogªss.
dow∆ﬂded
);

454 
tŸÆ_å™s„r
 = 
d©a
->
¥ogªss
.
dow∆ﬂded
 + d©a->¥ogªss.
u∂ﬂded
;

457 if(
tŸÆ_ex≥˘ed_å™s„r
 > 
	`CURL_OFF_T_C
(10000))

458 
tŸÆ_≥r˚n
 = 
tŸÆ_å™s„r
 /

459 (
tŸÆ_ex≥˘ed_å™s„r
/
	`CURL_OFF_T_C
(100));

460 if(
tŸÆ_ex≥˘ed_å™s„r
 > 
	`CURL_OFF_T_C
(0))

461 
tŸÆ_≥r˚n
 = (
tŸÆ_å™s„r
*100Ë/ 
tŸÆ_ex≥˘ed_å™s„r
;

463 
	`Ârötf
(
d©a
->
£t
.
îr
,

465 "%3" 
CURL_FORMAT_CURL_OFF_T
 " %s "

466 "%3" 
CURL_FORMAT_CURL_OFF_T
 " %s "

467 "%3" 
CURL_FORMAT_CURL_OFF_T
 " %s %s %s %s %s %s %s",

468 
tŸÆ_≥r˚n
,

469 
	`max5d©a
(
tŸÆ_ex≥˘ed_å™s„r
, 
max5
[2]),

470 
dÕî˚n
,

471 
	`max5d©a
(
d©a
->
¥ogªss
.
dow∆ﬂded
, 
max5
[0]),

472 
uÕî˚n
,

473 
	`max5d©a
(
d©a
->
¥ogªss
.
u∂ﬂded
, 
max5
[1]),

474 
	`max5d©a
(
d©a
->
¥ogªss
.
dl•ìd
, 
max5
[3]),

475 
	`max5d©a
(
d©a
->
¥ogªss
.
ul•ìd
, 
max5
[4]),

476 
time_tŸÆ
,

477 
time_•ít
,

478 
time_À·
,

479 
	`max5d©a
(
d©a
->
¥ogªss
.
cuºít_•ìd
, 
max5
[5])

483 
	`fÊush
(
d©a
->
£t
.
îr
);

488 
	}
}

	@lib/progress.h

1 #i‚de‡
HEADER_CURL_PROGRESS_H


2 
	#HEADER_CURL_PROGRESS_H


	)

25 
	~"timevÆ.h
"

29 
	mTIMER_NONE
,

30 
	mTIMER_STARTOP
,

31 
	mTIMER_STARTSINGLE
,

32 
	mTIMER_NAMELOOKUP
,

33 
	mTIMER_CONNECT
,

34 
	mTIMER_APPCONNECT
,

35 
	mTIMER_PRETRANSFER
,

36 
	mTIMER_STARTTRANSFER
,

37 
	mTIMER_POSTRANSFER
,

38 
	mTIMER_STARTACCEPT
,

39 
	mTIMER_REDIRECT
,

40 
	mTIMER_LAST


41 } 
	ttimîid
;

43 
Cuæ_pgrsD⁄e
(
c⁄√˘d©a
 *);

44 
Cuæ_pgrsSèπNow
(
Sessi⁄H™dÀ
 *
d©a
);

45 
Cuæ_pgrsSëDow∆ﬂdSize
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_off_t
 
size
);

46 
Cuæ_pgrsSëU∂ﬂdSize
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_off_t
 
size
);

47 
Cuæ_pgrsSëDow∆ﬂdCou¡î
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_off_t
 
size
);

48 
Cuæ_pgrsSëU∂ﬂdCou¡î
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_off_t
 
size
);

49 
Cuæ_pgrsUpd©e
(
c⁄√˘d©a
 *);

50 
Cuæ_pgrsRe£tTimesSizes
(
Sessi⁄H™dÀ
 *
d©a
);

51 
Cuæ_pgrsTime
(
Sessi⁄H™dÀ
 *
d©a
, 
timîid
 
timî
);

55 
	#LEAST_SIZE_PROGRESS
 
BUFSIZE


	)

57 
	#PROGRESS_DOWNLOAD
 (1<<0)

	)

58 
	#PROGRESS_UPLOAD
 (1<<1)

	)

59 
	#PROGRESS_DOWN_AND_UP
 (
PROGRESS_UPLOAD
 | 
PROGRESS_DOWNLOAD
)

	)

61 
	#PGRS_SHOW_DL
 (1<<0)

	)

62 
	#PGRS_SHOW_UL
 (1<<1)

	)

63 
	#PGRS_DONE_DL
 (1<<2)

	)

64 
	#PGRS_DONE_UL
 (1<<3)

	)

65 
	#PGRS_HIDE
 (1<<4)

	)

66 
	#PGRS_UL_SIZE_KNOWN
 (1<<5)

	)

67 
	#PGRS_DL_SIZE_KNOWN
 (1<<6)

	)

69 
	#PGRS_HEADERS_OUT
 (1<<7Ë

	)

	@lib/rawstr.c

23 
	~"cuæ_£tup.h
"

25 
	~"øw°r.h
"

29 
	$Cuæ_øw_touµî
(
ö
)

31 
ö
) {

85  
ö
;

86 
	}
}

98 
	$Cuæ_øw_equÆ
(c⁄° *
fú°
, c⁄° *
£c⁄d
)

100 *
fú°
 && *
£c⁄d
) {

101 if(
	`Cuæ_øw_touµî
(*
fú°
Ë!Cuæ_øw_touµî(*
£c⁄d
))

104 
fú°
++;

105 
£c⁄d
++;

110  (
	`Cuæ_øw_touµî
(*
fú°
Ë=Cuæ_øw_touµî(*
£c⁄d
));

111 
	}
}

113 
	$Cuæ_øw_√quÆ
(c⁄° *
fú°
, c⁄° *
£c⁄d
, 
size_t
 
max
)

115 *
fú°
 && *
£c⁄d
 && 
max
) {

116 if(
	`Cuæ_øw_touµî
(*
fú°
Ë!Cuæ_øw_touµî(*
£c⁄d
)) {

119 
max
--;

120 
fú°
++;

121 
£c⁄d
++;

123 if(0 =
max
)

126  
	`Cuæ_øw_touµî
(*
fú°
Ë=Cuæ_øw_touµî(*
£c⁄d
);

127 
	}
}

134 
	$Cuæ_°∫touµî
(*
de°
, c⁄° *
§c
, 
size_t
 
n
)

136 if(
n
 < 1)

140 *
de°
++ = 
	`Cuæ_øw_touµî
(*
§c
);

141 } *
§c
++ && --
n
);

142 
	}
}

	@lib/rawstr.h

1 #i‚de‡
HEADER_CURL_RAWSTR_H


2 
	#HEADER_CURL_RAWSTR_H


	)

25 
	~<cuæ/cuæ.h
>

35 
Cuæ_øw_equÆ
(c⁄° *
fú°
, c⁄° *
£c⁄d
);

36 
Cuæ_øw_√quÆ
(c⁄° *
fú°
, c⁄° *
£c⁄d
, 
size_t
 
max
);

38 
Cuæ_øw_touµî
(
ö
);

42 
	#check¥efix
(
a
,
b
Ë
	`Cuæ_øw_√quÆ
◊,b,
	`°æí
◊))

	)

44 
Cuæ_°∫touµî
(*
de°
, c⁄° *
§c
, 
size_t
 
n
);

	@lib/rtsp.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_RTSP


27 
	~"uæd©a.h
"

28 
	~<cuæ/cuæ.h
>

29 
	~"å™s„r.h
"

30 
	~"£ndf.h
"

31 
	~"mu…iif.h
"

32 
	~"hâp.h
"

33 
	~"uæ.h
"

34 
	~"¥ogªss.h
"

35 
	~"π•.h
"

36 
	~"øw°r.h
"

37 
	~"cuæ_mem‹y.h
"

38 
	~"£À˘.h
"

39 
	~"c⁄√˘.h
"

41 
	#_MPRINTF_REPLACE


	)

42 
	~<cuæ/m¥ötf.h
>

45 
	~"memdebug.h
"

57 
	#RTP_PKT_CHANNEL
(
p
Ë(()(()(’)[1])))

	)

59 
	#RTP_PKT_LENGTH
(
p
) (((()(()((p)[2]))) << 8) | \

60 (()(()((
p
)[3]))))

	)

63 
CURLcode
 
π•_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

64 
CURLcode
 
π•_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, CURLcode, 
boﬁ
 
¥em©uª
);

65 
CURLcode
 
π•_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

66 
CURLcode
 
π•_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód
);

68 
π•_gësock_do
(
c⁄√˘d©a
 *
c⁄n
,

69 
cuæ_sockë_t
 *
socks
,

70 
numsocks
);

79 
CURLcode
 
π•_πp_ªadwrôe
(
Sessi⁄H™dÀ
 *
d©a
,

80 
c⁄√˘d©a
 *
c⁄n
,

81 
ssize_t
 *
ƒód
,

82 
boﬁ
 *
ªadm‹e
);

84 
CURLcode
 
π•_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
);

90 
	$π•_gësock_do
(
c⁄√˘d©a
 *
c⁄n
,

91 
cuæ_sockë_t
 *
socks
,

92 
numsocks
)

95 ()
numsocks
;

96 
socks
[0] = 
c⁄n
->
sock
[
FIRSTSOCKET
];

97  
	`GETSOCK_WRITESOCK
(0);

98 
	}
}

101 
CURLcode
 
πp_˛õ¡_wrôe
(
c⁄√˘d©a
 *
c⁄n
, *
±r
, 
size_t
 
Àn
);

107 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_π•
 = {

109 
π•_£tup_c⁄√˘i⁄
,

110 
π•_do
,

111 
π•_d⁄e
,

112 
ZERO_NULL
,

113 
π•_c⁄√˘
,

114 
ZERO_NULL
,

115 
ZERO_NULL
,

116 
ZERO_NULL
,

117 
π•_gësock_do
,

118 
ZERO_NULL
,

119 
ZERO_NULL
,

120 
π•_disc⁄√˘
,

121 
π•_πp_ªadwrôe
,

122 
PORT_RTSP
,

123 
CURLPROTO_RTSP
,

124 
PROTOPT_NONE


128 
CURLcode
 
	$π•_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
)

130 
RTSP
 *
π•
;

132 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
 = 
π•
 = 
	`ˇŒoc
(1, (
RTSP
));

133 if(!
π•
)

134  
CURLE_OUT_OF_MEMORY
;

136  
CURLE_OK
;

137 
	}
}

148 
boﬁ
 
	$Cuæ_π•_c⁄nisdód
(
c⁄√˘d©a
 *
check
)

150 
svÆ
;

151 
boﬁ
 
ªt_vÆ
 = 
TRUE
;

153 
svÆ
 = 
	`Cuæ_sockë_ªady
(
check
->
sock
[
FIRSTSOCKET
], 
CURL_SOCKET_BAD
, 0);

154 if(
svÆ
 == 0) {

156 
ªt_vÆ
 = 
FALSE
;

158 if(
svÆ
 & 
CURL_CSELECT_ERR
) {

160 
ªt_vÆ
 = 
TRUE
;

162 if((
svÆ
 & 
CURL_CSELECT_IN
Ë&& 
check
->
d©a
) {

165 
cuæ_sockë_t
 
c⁄√˘öfo
 = 
	`Cuæ_gëc⁄√˘öfo
(
check
->
d©a
, &check);

166 if(
c⁄√˘öfo
 !
CURL_SOCKET_BAD
)

167 
ªt_vÆ
 = 
FALSE
;

170  
ªt_vÆ
;

171 
	}
}

173 
CURLcode
 
	$π•_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

175 
CURLcode
 
hâpSètus
;

176 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

178 
hâpSètus
 = 
	`Cuæ_hâp_c⁄√˘
(
c⁄n
, 
d⁄e
);

181 if(
d©a
->
°©e
.
π•_√xt_˛õ¡_CSeq
 == 0)

182 
d©a
->
°©e
.
π•_√xt_˛õ¡_CSeq
 = 1;

183 if(
d©a
->
°©e
.
π•_√xt_£rvî_CSeq
 == 0)

184 
d©a
->
°©e
.
π•_√xt_£rvî_CSeq
 = 1;

186 
c⁄n
->
¥Ÿo
.
π•c
.
πp_ch™√l
 = -1;

188  
hâpSètus
;

189 
	}
}

191 
CURLcode
 
	$π•_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód
)

193 (Ë
dód
;

194 
	`Cuæ_ß„‰ì
(
c⁄n
->
¥Ÿo
.
π•c
.
πp_buf
);

195  
CURLE_OK
;

196 
	}
}

199 
CURLcode
 
	$π•_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

200 
CURLcode
 
°©us
, 
boﬁ
 
¥em©uª
)

202 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

203 
RTSP
 *
π•
 = 
d©a
->
ªq
.
¥Ÿ›
;

204 
CURLcode
 
hâpSètus
;

205 
CSeq_£¡
;

206 
CSeq_ªcv
;

209 if(
d©a
->
£t
.
π•ªq
 =
RTSPREQ_RECEIVE
)

210 
¥em©uª
 = 
TRUE
;

212 
hâpSètus
 = 
	`Cuæ_hâp_d⁄e
(
c⁄n
, 
°©us
, 
¥em©uª
);

214 if(
π•
) {

216 
CSeq_£¡
 = 
π•
->CSeq_sent;

217 
CSeq_ªcv
 = 
π•
->CSeq_recv;

218 if((
d©a
->
£t
.
π•ªq
 !
RTSPREQ_RECEIVE
Ë&& (
CSeq_£¡
 !
CSeq_ªcv
)) {

219 
	`Áûf
(
d©a
,

221 
CSeq_£¡
, 
CSeq_ªcv
);

222  
CURLE_RTSP_CSEQ_ERROR
;

224 if(
d©a
->
£t
.
π•ªq
 =
RTSPREQ_RECEIVE
 &&

225 (
c⁄n
->
¥Ÿo
.
π•c
.
πp_ch™√l
 == -1)) {

226 
	`öfof
(
d©a
, "GŸá¿RTP Re˚ivêwôhá CSeq o‡%ld\n", 
CSeq_ªcv
);

231  
hâpSètus
;

232 
	}
}

234 
CURLcode
 
	$π•_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

236 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

237 
CURLcode
 
ªsu…
=
CURLE_OK
;

238 
Cuæ_Rt•Req
 
π•ªq
 = 
d©a
->
£t
.rtspreq;

239 
RTSP
 *
π•
 = 
d©a
->
ªq
.
¥Ÿ›
;

240 
HTTP
 *
hâp
;

241 
Cuæ_£nd_buf„r
 *
ªq_buf„r
;

242 
cuæ_off_t
 
po°size
 = 0;

243 
cuæ_off_t
 
putsize
 = 0;

245 c⁄° *
p_ªque°
 = 
NULL
;

246 c⁄° *
p_£ssi⁄_id
 = 
NULL
;

247 c⁄° *
p_ac˚±
 = 
NULL
;

248 c⁄° *
p_ac˚±_ícodög
 = 
NULL
;

249 c⁄° *
p_ønge
 = 
NULL
;

250 c⁄° *
p_ª„ºî
 = 
NULL
;

251 c⁄° *
p_°ªam_uri
 = 
NULL
;

252 c⁄° *
p_å™•‹t
 = 
NULL
;

253 c⁄° *
p_uagít
 = 
NULL
;

255 *
d⁄e
 = 
TRUE
;

257 
hâp
 = &(
π•
->
hâp_wøµî
);

259 
	`DEBUGASSERT
((*)
hâp
 =(*)
π•
);

261 
π•
->
CSeq_£¡
 = 
d©a
->
°©e
.
π•_√xt_˛õ¡_CSeq
;

262 
π•
->
CSeq_ªcv
 = 0;

268 
	`DEBUGASSERT
((
π•ªq
 > 
RTSPREQ_NONE
 &&Ñt•ªq < 
RTSPREQ_LAST
));

269 
d©a
->
£t
.
›t_no_body
 = 
TRUE
;

270 
π•ªq
) {

271 
RTSPREQ_NONE
:

272 
	`Áûf
(
d©a
, "Got invalid RTSPÑequest: RTSPREQ_NONE");

273  
CURLE_BAD_FUNCTION_ARGUMENT
;

274 
RTSPREQ_OPTIONS
:

275 
p_ªque°
 = "OPTIONS";

277 
RTSPREQ_DESCRIBE
:

278 
p_ªque°
 = "DESCRIBE";

279 
d©a
->
£t
.
›t_no_body
 = 
FALSE
;

281 
RTSPREQ_ANNOUNCE
:

282 
p_ªque°
 = "ANNOUNCE";

284 
RTSPREQ_SETUP
:

285 
p_ªque°
 = "SETUP";

287 
RTSPREQ_PLAY
:

288 
p_ªque°
 = "PLAY";

290 
RTSPREQ_PAUSE
:

291 
p_ªque°
 = "PAUSE";

293 
RTSPREQ_TEARDOWN
:

294 
p_ªque°
 = "TEARDOWN";

296 
RTSPREQ_GET_PARAMETER
:

298 
p_ªque°
 = "GET_PARAMETER";

299 
d©a
->
£t
.
›t_no_body
 = 
FALSE
;

301 
RTSPREQ_SET_PARAMETER
:

302 
p_ªque°
 = "SET_PARAMETER";

304 
RTSPREQ_RECORD
:

305 
p_ªque°
 = "RECORD";

307 
RTSPREQ_RECEIVE
:

308 
p_ªque°
 = "";

310 
d©a
->
£t
.
›t_no_body
 = 
FALSE
;

312 
RTSPREQ_LAST
:

313 
	`Áûf
(
d©a
, "Got invalid RTSPÑequest: RTSPREQ_LAST");

314  
CURLE_BAD_FUNCTION_ARGUMENT
;

317 if(
π•ªq
 =
RTSPREQ_RECEIVE
) {

318 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
TRUE
,

319 &
hâp
->
ªadbyãcou¡
, -1, 
NULL
);

321  
ªsu…
;

324 
p_£ssi⁄_id
 = 
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
];

325 if(!
p_£ssi⁄_id
 &&

326 (
π•ªq
 & ~(
RTSPREQ_OPTIONS
 | 
RTSPREQ_DESCRIBE
 | 
RTSPREQ_SETUP
))) {

327 
	`Áûf
(
d©a
, "RefusingÅo issueán RTSPÑequest [%s] withoutá session ID.",

328 
p_ªque°
 ?Ö_request : "");

329  
CURLE_BAD_FUNCTION_ARGUMENT
;

336 if(
d©a
->
£t
.
°r
[
STRING_RTSP_STREAM_URI
]) {

337 
p_°ªam_uri
 = 
d©a
->
£t
.
°r
[
STRING_RTSP_STREAM_URI
];

340 
p_°ªam_uri
 = "*";

344 
p_å™•‹t
 = 
	`Cuæ_checkhódîs
(
c⁄n
, "Transport:");

345 if(
π•ªq
 =
RTSPREQ_SETUP
 && !
p_å™•‹t
) {

347 if(
d©a
->
£t
.
°r
[
STRING_RTSP_TRANSPORT
]) {

348 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
π•_å™•‹t
);

350 
c⁄n
->
Ælo˝å
.
π•_å™•‹t
 =

351 
	`≠rötf
("Transport: %s\r\n",

352 
d©a
->
£t
.
°r
[
STRING_RTSP_TRANSPORT
]);

353 if(!
c⁄n
->
Ælo˝å
.
π•_å™•‹t
)

354  
CURLE_OUT_OF_MEMORY
;

357 
	`Áûf
(
d©a
,

359  
CURLE_BAD_FUNCTION_ARGUMENT
;

362 
p_å™•‹t
 = 
c⁄n
->
Ælo˝å
.
π•_å™•‹t
;

366 if(
π•ªq
 =
RTSPREQ_DESCRIBE
) {

368 
p_ac˚±
 = 
	`Cuæ_checkhódîs
(
c⁄n
, "Accept:")?

369 
NULL
:"Accept:ápplication/sdp\r\n";

372 if(!
	`Cuæ_checkhódîs
(
c⁄n
, "Accept-Encoding:") &&

373 
d©a
->
£t
.
°r
[
STRING_ENCODING
]) {

374 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
ac˚±_ícodög
);

375 
c⁄n
->
Ælo˝å
.
ac˚±_ícodög
 =

376 
	`≠rötf
("Ac˚±-Encodög: %s\r\n", 
d©a
->
£t
.
°r
[
STRING_ENCODING
]);

378 if(!
c⁄n
->
Ælo˝å
.
ac˚±_ícodög
)

379  
CURLE_OUT_OF_MEMORY
;

381 
p_ac˚±_ícodög
 = 
c⁄n
->
Ælo˝å
.
ac˚±_ícodög
;

389 if(
	`Cuæ_checkhódîs
(
c⁄n
, "U£r-Agít:"Ë&& c⁄n->
Ælo˝å
.
uagít
) {

390 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
uagít
);

391 
c⁄n
->
Ælo˝å
.
uagít
 = 
NULL
;

393 if(!
	`Cuæ_checkhódîs
(
c⁄n
, "User-Agent:") &&

394 
d©a
->
£t
.
°r
[
STRING_USERAGENT
]) {

395 
p_uagít
 = 
c⁄n
->
Ælo˝å
.
uagít
;

399 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
ªf
);

400 if(
d©a
->
ch™ge
.
ª„ªr
 && !
	`Cuæ_checkhódîs
(
c⁄n
, "Referer:"))

401 
c⁄n
->
Ælo˝å
.
ªf
 = 
	`≠rötf
("Re„ªr: %s\r\n", 
d©a
->
ch™ge
.
ª„ªr
);

403 
c⁄n
->
Ælo˝å
.
ªf
 = 
NULL
;

405 
p_ª„ºî
 = 
c⁄n
->
Ælo˝å
.
ªf
;

413 if(
d©a
->
°©e
.
u£_ønge
 &&

414 (
π•ªq
 & (
RTSPREQ_PLAY
 | 
RTSPREQ_PAUSE
 | 
RTSPREQ_RECORD
))) {

417 if(!
	`Cuæ_checkhódîs
(
c⁄n
, "R™ge:"Ë&& 
d©a
->
°©e
.
ønge
) {

418 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
øngñöe
);

419 
c⁄n
->
Ælo˝å
.
øngñöe
 = 
	`≠rötf
("R™ge: %s\r\n", 
d©a
->
°©e
.
ønge
);

420 
p_ønge
 = 
c⁄n
->
Ælo˝å
.
øngñöe
;

427 if(
	`Cuæ_checkhódîs
(
c⁄n
, "CSeq:")) {

428 
	`Áûf
(
d©a
, "CSeq cannot be setásá custom header.");

429  
CURLE_RTSP_CSEQ_ERROR
;

431 if(
	`Cuæ_checkhódîs
(
c⁄n
, "Session:")) {

432 
	`Áûf
(
d©a
, "Session ID cannot be setásá custom header.");

433  
CURLE_BAD_FUNCTION_ARGUMENT
;

437 
ªq_buf„r
 = 
	`Cuæ_add_buf„r_öô
();

439 if(!
ªq_buf„r
)

440  
CURLE_OUT_OF_MEMORY
;

442 
ªsu…
 =

443 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

446 (
p_ªque°
 ?Ö_ªque° : ""), 
p_°ªam_uri
,

447 
π•
->
CSeq_£¡
);

448 if(
ªsu…
)

449  
ªsu…
;

455 if(
p_£ssi⁄_id
) {

456 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
, "Sessi⁄: %s\r\n", 
p_£ssi⁄_id
);

457 if(
ªsu…
)

458  
ªsu…
;

464 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

472 
p_å™•‹t
 ?Ö_transport : "",

473 
p_ac˚±
 ?Ö_accept : "",

474 
p_ac˚±_ícodög
 ?Ö_accept_encoding : "",

475 
p_ønge
 ?Ö_range : "",

476 
p_ª„ºî
 ?Ö_referrer : "",

477 
p_uagít
 ?Ö_uagent : "");

478 if(
ªsu…
)

479  
ªsu…
;

481 if((
π•ªq
 =
RTSPREQ_SETUP
Ë|| (π•ªq =
RTSPREQ_DESCRIBE
)) {

482 
ªsu…
 = 
	`Cuæ_add_timec⁄dôi⁄
(
d©a
, 
ªq_buf„r
);

483 if(
ªsu…
)

484  
ªsu…
;

487 
ªsu…
 = 
	`Cuæ_add_cu°om_hódîs
(
c⁄n
, 
FALSE
, 
ªq_buf„r
);

488 if(
ªsu…
)

489  
ªsu…
;

491 if(
π•ªq
 =
RTSPREQ_ANNOUNCE
 ||

492 
π•ªq
 =
RTSPREQ_SET_PARAMETER
 ||

493 
π•ªq
 =
RTSPREQ_GET_PARAMETER
) {

495 if(
d©a
->
£t
.
u∂ﬂd
) {

496 
putsize
 = 
d©a
->
°©e
.
öfûesize
;

497 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_PUT
;

501 
po°size
 = (
d©a
->
£t
.
po°fõldsize
 != -1)?

502 
d©a
->
£t
.
po°fõldsize
:

503 (
d©a
->
£t
.
po°fõlds
? (
cuæ_off_t
)
	`°æí
(data->set.postfields):0);

504 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_POST
;

507 if(
putsize
 > 0 || 
po°size
 > 0) {

510 if(!
	`Cuæ_checkhódîs
(
c⁄n
, "Content-Length:")) {

511 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

512 "C⁄ã¡-Lígth: %" 
CURL_FORMAT_CURL_OFF_T
"\r\n",

513 (
d©a
->
£t
.
u∂ﬂd
 ? 
putsize
 : 
po°size
));

514 if(
ªsu…
)

515  
ªsu…
;

518 if(
π•ªq
 =
RTSPREQ_SET_PARAMETER
 ||

519 
π•ªq
 =
RTSPREQ_GET_PARAMETER
) {

520 if(!
	`Cuæ_checkhódîs
(
c⁄n
, "Content-Type:")) {

521 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

523 if(
ªsu…
)

524  
ªsu…
;

528 if(
π•ªq
 =
RTSPREQ_ANNOUNCE
) {

529 if(!
	`Cuæ_checkhódîs
(
c⁄n
, "Content-Type:")) {

530 
ªsu…
 = 
	`Cuæ_add_buf„rf
(
ªq_buf„r
,

532 if(
ªsu…
)

533  
ªsu…
;

537 
d©a
->
°©e
.
ex≥˘100hódî
 = 
FALSE
;

539 if(
π•ªq
 =
RTSPREQ_GET_PARAMETER
) {

541 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_HEAD
;

542 
d©a
->
£t
.
›t_no_body
 = 
TRUE
;

547 
d©a
->
ªq
.
f‹bidchunk
 = 
TRUE
;

549 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, "\r\n", 2);

550 if(
ªsu…
)

551  
ªsu…
;

553 if(
po°size
 > 0) {

554 
ªsu…
 = 
	`Cuæ_add_buf„r
(
ªq_buf„r
, 
d©a
->
£t
.
po°fõlds
,

555 (
size_t
)
po°size
);

556 if(
ªsu…
)

557  
ªsu…
;

561 
ªsu…
 = 
	`Cuæ_add_buf„r_£nd
(
ªq_buf„r
, 
c⁄n
,

562 &
d©a
->
öfo
.
ªque°_size
, 0, 
FIRSTSOCKET
);

563 if(
ªsu…
) {

564 
	`Áûf
(
d©a
, "Failed sending RTSPÑequest");

565  
ªsu…
;

568 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, -1, 
TRUE
, &
hâp
->
ªadbyãcou¡
,

569 
putsize
?
FIRSTSOCKET
:-1,

570 
putsize
?&
hâp
->
wrôebyãcou¡
:
NULL
);

573 
d©a
->
°©e
.
π•_√xt_˛õ¡_CSeq
++;

575 if(
hâp
->
wrôebyãcou¡
) {

578 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 
hâp
->
wrôebyãcou¡
);

579 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

580 
ªsu…
 = 
CURLE_ABORTED_BY_CALLBACK
;

583  
ªsu…
;

584 
	}
}

587 
CURLcode
 
	$π•_πp_ªadwrôe
(
Sessi⁄H™dÀ
 *
d©a
,

588 
c⁄√˘d©a
 *
c⁄n
,

589 
ssize_t
 *
ƒód
,

590 
boﬁ
 *
ªadm‹e
) {

591 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

592 
π•_c⁄n
 *
π•c
 = &(
c⁄n
->
¥Ÿo
.rtspc);

594 *
πp
;

595 
ssize_t
 
πp_d©Æe·
;

596 *
s¸©ch
;

597 
CURLcode
 
ªsu…
;

599 if(
π•c
->
πp_buf
) {

601 *
√w±r
 = 
	`ªÆloc
(
π•c
->
πp_buf
,Ñt•c->
πp_bufsize
 + *
ƒód
);

602 if(!
√w±r
) {

603 
	`Cuæ_ß„‰ì
(
π•c
->
πp_buf
);

604 
π•c
->
πp_buf
 = 
NULL
;

605 
π•c
->
πp_bufsize
 = 0;

606  
CURLE_OUT_OF_MEMORY
;

608 
π•c
->
πp_buf
 = 
√w±r
;

609 
	`mem˝y
(
π•c
->
πp_buf
 +Ñt•c->
πp_bufsize
, 
k
->
°r
, *
ƒód
);

610 
π•c
->
πp_bufsize
 +*
ƒód
;

611 
πp
 = 
π•c
->
πp_buf
;

612 
πp_d©Æe·
 = 
π•c
->
πp_bufsize
;

616 
πp
 = 
k
->
°r
;

617 
πp_d©Æe·
 = *
ƒód
;

620 (
πp_d©Æe·
 > 0) &&

621 (
πp
[0] == '$')) {

622 if(
πp_d©Æe·
 > 4) {

623 
πp_Àngth
;

627 
π•c
->
πp_ch™√l
 = 
	`RTP_PKT_CHANNEL
(
πp
);

630 
πp_Àngth
 = 
	`RTP_PKT_LENGTH
(
πp
);

632 if(
πp_d©Æe·
 < 
πp_Àngth
 + 4) {

634 *
ªadm‹e
 = 
TRUE
;

640 
	`DEBUGF
(
	`öfof
(
d©a
, "RTP write channel %dÑtp_length %d\n",

641 
π•c
->
πp_ch™√l
, 
πp_Àngth
));

642 
ªsu…
 = 
	`πp_˛õ¡_wrôe
(
c⁄n
, &
πp
[0], 
πp_Àngth
 + 4);

643 if(
ªsu…
) {

644 
	`Áûf
(
d©a
, "GotánÉrror writingán RTPÖacket");

645 *
ªadm‹e
 = 
FALSE
;

646 
	`Cuæ_ß„‰ì
(
π•c
->
πp_buf
);

647 
π•c
->
πp_buf
 = 
NULL
;

648 
π•c
->
πp_bufsize
 = 0;

649  
ªsu…
;

653 
πp_d©Æe·
 -
πp_Àngth
 + 4;

654 
πp
 +
πp_Àngth
 + 4;

656 if(
d©a
->
£t
.
π•ªq
 =
RTSPREQ_RECEIVE
) {

660 
k
->
kìp⁄
 &~
KEEP_RECV
;

666 *
ªadm‹e
 = 
TRUE
;

671 if(
πp_d©Æe·
 !0 && 
πp
[0] == '$') {

672 
	`DEBUGF
(
	`öfof
(
d©a
, "RTP Rewödög %zd %s\n", 
πp_d©Æe·
,

673 *
ªadm‹e
 ? "(READMORE)" : ""));

676 
s¸©ch
 = 
	`mÆloc
(
πp_d©Æe·
);

677 if(!
s¸©ch
) {

678 
	`Cuæ_ß„‰ì
(
π•c
->
πp_buf
);

679 
π•c
->
πp_buf
 = 
NULL
;

680 
π•c
->
πp_bufsize
 = 0;

681  
CURLE_OUT_OF_MEMORY
;

683 
	`mem˝y
(
s¸©ch
, 
πp
, 
πp_d©Æe·
);

684 
	`Cuæ_ß„‰ì
(
π•c
->
πp_buf
);

685 
π•c
->
πp_buf
 = 
s¸©ch
;

686 
π•c
->
πp_bufsize
 = 
πp_d©Æe·
;

689 *
ƒód
 = 0;

690  
CURLE_OK
;

694 
k
->
°r
 +*
ƒód
 - 
πp_d©Æe·
;

699 if(
πp_d©Æe·
 > 0)

700 
	`DEBUGASSERT
(
k
->
°r
[0] =
πp
[0]);

702 
	`DEBUGASSERT
(
πp_d©Æe·
 <*
ƒód
);

704 *
ƒód
 = 
πp_d©Æe·
;

708 
	`Cuæ_ß„‰ì
(
π•c
->
πp_buf
);

709 
π•c
->
πp_buf
 = 
NULL
;

710 
π•c
->
πp_bufsize
 = 0;

712  
CURLE_OK
;

713 
	}
}

716 
CURLcode
 
	$πp_˛õ¡_wrôe
(
c⁄√˘d©a
 *
c⁄n
, *
±r
, 
size_t
 
Àn
)

718 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

719 
size_t
 
wrŸe
;

720 
cuæ_wrôe_ˇŒback
 
wrôeô
;

722 if(
Àn
 == 0) {

723 
	`Áûf
 (
d©a
, "Cannot writeá 0 size RTPÖacket.");

724  
CURLE_WRITE_ERROR
;

727 
wrôeô
 = 
d©a
->
£t
.
fwrôe_πp
?d©a->£t.fwrôe_πp:d©a->£t.
fwrôe_func
;

728 
wrŸe
 = 
	`wrôeô
(
±r
, 1, 
Àn
, 
d©a
->
£t
.
πp_out
);

730 if(
CURL_WRITEFUNC_PAUSE
 =
wrŸe
) {

731 
	`Áûf
 (
d©a
, "CannotÖause RTP");

732  
CURLE_WRITE_ERROR
;

735 if(
wrŸe
 !
Àn
) {

736 
	`Áûf
 (
d©a
, "Failed writing RTP data");

737  
CURLE_WRITE_ERROR
;

740  
CURLE_OK
;

741 
	}
}

743 
CURLcode
 
	$Cuæ_π•_∑r£hódî
(
c⁄√˘d©a
 *
c⁄n
,

744 *
hódî
)

746 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

747 
CSeq
 = 0;

749 if(
	`check¥efix
("CSeq:", 
hódî
)) {

751 
nc
 = 
	`ssˇnf
(&
hódî
[4], ": %ld", &
CSeq
);

752 if(
nc
 == 1) {

753 
RTSP
 *
π•
 = 
d©a
->
ªq
.
¥Ÿ›
;

754 
π•
->
CSeq_ªcv
 = 
CSeq
;

755 
d©a
->
°©e
.
π•_CSeq_ªcv
 = 
CSeq
;

758 
	`Áûf
(
d©a
, "U«bÀÅÿªadÅhêCSeq hódî: [%s]", 
hódî
);

759  
CURLE_RTSP_CSEQ_ERROR
;

762 if(
	`check¥efix
("Sessi⁄:", 
hódî
)) {

763 *
°¨t
;

766 
°¨t
 = 
hódî
 + 8;

767 *
°¨t
 && 
	`ISSPACE
(*start))

768 
°¨t
++;

770 if(!*
°¨t
) {

771 
	`Áûf
(
d©a
, "Gotá blank Session ID");

773 if(
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
]) {

775 if(
	`°∫cmp
(
°¨t
, 
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
],

776 
	`°æí
(
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
])) != 0) {

777 
	`Áûf
(
d©a
, "Got RTSP Session ID Line [%s], but wanted ID [%s]",

778 
°¨t
, 
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
]);

779  
CURLE_RTSP_SESSION_ERROR
;

791 *
íd
 = 
°¨t
;

792 *
íd
 &&

793 (
	`ISALNUM
(*
íd
) || *end == '-' || *end == '_' || *end == '.' ||

794 *
íd
 == '+' ||

795 (*
íd
 == '\\' && *(end + 1) && *(end + 1) == '$' && (++end, 1))))

796 
íd
++;

799 
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
] = 
	`mÆloc
(
íd
 - 
°¨t
 + 1);

800 if(
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
] =
NULL
)

801  
CURLE_OUT_OF_MEMORY
;

802 
	`mem˝y
(
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
], 
°¨t
, 
íd
 - start);

803 (
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
])[
íd
 - 
°¨t
] = '\0';

806  
CURLE_OK
;

807 
	}
}

	@lib/rtsp.h

1 #i‚de‡
HEADER_CURL_RTSP_H


2 
	#HEADER_CURL_RTSP_H


	)

24 #i‚de‡
CURL_DISABLE_RTSP


26 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_π•
;

28 
boﬁ
 
Cuæ_π•_c⁄nisdód
(
c⁄√˘d©a
 *
check
);

29 
CURLcode
 
Cuæ_π•_∑r£hódî
(
c⁄√˘d©a
 *
c⁄n
, *
hódî
);

33 
	#Cuæ_π•_∑r£hódî
(
x
,
y
Ë
CURLE_NOT_BUILT_IN


	)

34 
	#Cuæ_π•_c⁄nisdód
(
x
Ë
TRUE


	)

43 
	sπ•_c⁄n
 {

44 *
	mπp_buf
;

45 
ssize_t
 
	mπp_bufsize
;

46 
	mπp_ch™√l
;

52 
	sRTSP
 {

61 
HTTP
 
	mhâp_wøµî
;

63 
	mCSeq_£¡
;

64 
	mCSeq_ªcv
;

	@lib/security.c

44 
	~"cuæ_£tup.h
"

46 #i‚de‡
CURL_DISABLE_FTP


47 #ifde‡
HAVE_GSSAPI


49 #ifde‡
HAVE_NETDB_H


50 
	~<√tdb.h
>

53 #ifde‡
HAVE_LIMITS_H


54 
	~<limôs.h
>

57 
	~"uæd©a.h
"

58 
	~"cuæ_ba£64.h
"

59 
	~"cuæ_mem‹y.h
"

60 
	~"cuæ_£c.h
"

61 
	~"·p.h
"

62 
	~"£ndf.h
"

63 
	~"øw°r.h
"

64 
	~"w¨∆ess.h
"

67 
	~"memdebug.h
"

70 
¥Ÿe˘i⁄_Àvñ
 
	mÀvñ
;

71 c⁄° *
	m«me
;

72 } 
	gÀvñ_«mes
[] = {

73 { 
PROT_CLEAR
, "clear" },

74 { 
PROT_SAFE
, "safe" },

75 { 
PROT_CONFIDENTIAL
, "confidential" },

76 { 
PROT_PRIVATE
, "private" }

79 
¥Ÿe˘i⁄_Àvñ


80 
	$«me_to_Àvñ
(c⁄° *
«me
)

82 
i
;

83 
i
 = 0; i < ()(
Àvñ_«mes
)/()(level_names[0]); i++)

84 if(
	`check¥efix
(
«me
, 
Àvñ_«mes
[
i
].name))

85  
Àvñ_«mes
[
i
].
Àvñ
;

86  
PROT_NONE
;

87 
	}
}

91 
	$Àvñ_to_ch¨
(
Àvñ
) {

92 
Àvñ
) {

93 
PROT_CLEAR
:

95 
PROT_SAFE
:

97 
PROT_CONFIDENTIAL
:

99 
PROT_PRIVATE
:

101 
PROT_CMD
:

107 
	`DEBUGASSERT
(0);

110 
	}
}

112 c⁄° 
Cuæ_£c_˛õ¡_mech
 * c⁄° 
	gmechs
[] = {

113 #ifde‡
HAVE_GSSAPI


114 &
Cuæ_krb5_˛õ¡_mech
,

116 
NULL


121 
	$·p_£nd_comm™d
(
c⁄√˘d©a
 *
c⁄n
, c⁄° *
mesßge
, ...)

123 
·p_code
;

124 
ssize_t
 
ƒód
;

125 
va_li°
 
¨gs
;

126 
¥öt_buf„r
[50];

128 
	`va_°¨t
(
¨gs
, 
mesßge
);

129 
	`v¢¥ötf
(
¥öt_buf„r
, ’röt_buf„r), 
mesßge
, 
¨gs
);

130 
	`va_íd
(
¨gs
);

132 if(
	`Cuæ_·p£ndf
(
c⁄n
, 
¥öt_buf„r
Ë!
CURLE_OK
) {

133 
·p_code
 = -1;

136 if(
	`Cuæ_GëFTPRe•⁄£
(&
ƒód
, 
c⁄n
, &
·p_code
Ë!
CURLE_OK
)

137 
·p_code
 = -1;

140 ()
ƒód
;

141  
·p_code
;

142 
	}
}

146 
CURLcode


147 
	$sockë_ªad
(
cuæ_sockë_t
 
fd
, *
to
, 
size_t
 
Àn
)

149 *
to_p
 = 
to
;

150 
CURLcode
 
code
;

151 
ssize_t
 
ƒód
;

153 
Àn
 > 0) {

154 
code
 = 
	`Cuæ_ªad_∂aö
(
fd
, 
to_p
, 
Àn
, &
ƒód
);

155 if(
code
 =
CURLE_OK
) {

156 
Àn
 -
ƒód
;

157 
to_p
 +
ƒód
;

161 if(
code
 =
CURLE_AGAIN
)

163  
code
;

166  
CURLE_OK
;

167 
	}
}

173 
CURLcode


174 
	$sockë_wrôe
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 
fd
, c⁄° *
to
,

175 
size_t
 
Àn
)

177 c⁄° *
to_p
 = 
to
;

178 
CURLcode
 
code
;

179 
ssize_t
 
wrôãn
;

181 
Àn
 > 0) {

182 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
fd
, 
to_p
, 
Àn
, &
wrôãn
);

183 if(
code
 =
CURLE_OK
) {

184 
Àn
 -
wrôãn
;

185 
to_p
 +
wrôãn
;

189 if(
code
 =
CURLE_AGAIN
)

191  
code
;

194  
CURLE_OK
;

195 
	}
}

197 
CURLcode
 
	$ªad_d©a
(
c⁄√˘d©a
 *
c⁄n
,

198 
cuæ_sockë_t
 
fd
,

199 
krb5buf„r
 *
buf
)

201 
Àn
;

202 * 
tmp
;

203 
CURLcode
 
ªt
;

205 
ªt
 = 
	`sockë_ªad
(
fd
, &
Àn
, (len));

206 if(
ªt
 !
CURLE_OK
)

207  
ªt
;

209 
Àn
 = 
	`¡ohl
(len);

210 
tmp
 = 
	`ªÆloc
(
buf
->
d©a
, 
Àn
);

211 if(
tmp
 =
NULL
)

212  
CURLE_OUT_OF_MEMORY
;

214 
buf
->
d©a
 = 
tmp
;

215 
ªt
 = 
	`sockë_ªad
(
fd
, 
buf
->
d©a
, 
Àn
);

216 if(
ªt
 !
CURLE_OK
)

217  
ªt
;

218 
buf
->
size
 = 
c⁄n
->
mech
->
	`decode
(c⁄n->
≠p_d©a
, buf->
d©a
, 
Àn
,

219 
c⁄n
->
d©a_¥Ÿ
, conn);

220 
buf
->
ödex
 = 0;

221  
CURLE_OK
;

222 
	}
}

224 
size_t


225 
	$buf„r_ªad
(
krb5buf„r
 *
buf
, *
d©a
, 
size_t
 
Àn
)

227 if(
buf
->
size
 - buf->
ödex
 < 
Àn
)

228 
Àn
 = 
buf
->
size
 - buf->
ödex
;

229 
	`mem˝y
(
d©a
, (*)
buf
->d©®+ buf->
ödex
, 
Àn
);

230 
buf
->
ödex
 +
Àn
;

231  
Àn
;

232 
	}
}

235 
ssize_t
 
	$£c_ªcv
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

236 *
buf„r
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

238 
size_t
 
byãs_ªad
;

239 
size_t
 
tŸÆ_ªad
 = 0;

240 
cuæ_sockë_t
 
fd
 = 
c⁄n
->
sock
[
socködex
];

242 *
îr
 = 
CURLE_OK
;

245 if(
c⁄n
->
£c_com∂ëe
 =0 || c⁄n->
d©a_¥Ÿ
 =
PROT_CLEAR
)

246  
	`ªad
(
fd
, 
buf„r
, 
Àn
);

248 if(
c⁄n
->
ö_buf„r
.
eof_Êag
) {

249 
c⁄n
->
ö_buf„r
.
eof_Êag
 = 0;

253 
byãs_ªad
 = 
	`buf„r_ªad
(&
c⁄n
->
ö_buf„r
, 
buf„r
, 
Àn
);

254 
Àn
 -
byãs_ªad
;

255 
tŸÆ_ªad
 +
byãs_ªad
;

256 
buf„r
 +
byãs_ªad
;

258 
Àn
 > 0) {

259 if(
	`ªad_d©a
(
c⁄n
, 
fd
, &c⁄n->
ö_buf„r
Ë!
CURLE_OK
)

261 if(
c⁄n
->
ö_buf„r
.
size
 == 0) {

262 if(
byãs_ªad
 > 0)

263 
c⁄n
->
ö_buf„r
.
eof_Êag
 = 1;

264  
byãs_ªad
;

266 
byãs_ªad
 = 
	`buf„r_ªad
(&
c⁄n
->
ö_buf„r
, 
buf„r
, 
Àn
);

267 
Àn
 -
byãs_ªad
;

268 
tŸÆ_ªad
 +
byãs_ªad
;

269 
buf„r
 +
byãs_ªad
;

272  
tŸÆ_ªad
;

273 
	}
}

278 
	$do_£c_£nd
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 
fd
,

279 c⁄° *
‰om
, 
Àngth
)

281 
byãs
, 
ht⁄l_byãs
;

282 *
buf„r
 = 
NULL
;

283 *
cmd_buf„r
;

284 
size_t
 
cmd_size
 = 0;

285 
CURLcode
 
îr‹
;

286 
¥Ÿe˘i⁄_Àvñ
 
¥Ÿ_Àvñ
 = 
c⁄n
->
d©a_¥Ÿ
;

287 
boﬁ
 
iscmd
 = (
¥Ÿ_Àvñ
 =
PROT_CMD
)?
TRUE
:
FALSE
;

289 
	`DEBUGASSERT
(
¥Ÿ_Àvñ
 > 
PROT_NONE
 &&ÖrŸ_Àvñ < 
PROT_LAST
);

291 if(
iscmd
) {

292 if(!
	`°∫cmp
(
‰om
, "PASS ", 5) || !strncmp(from, "ACCT ", 5))

293 
¥Ÿ_Àvñ
 = 
PROT_PRIVATE
;

295 
¥Ÿ_Àvñ
 = 
c⁄n
->
comm™d_¥Ÿ
;

297 
byãs
 = 
c⁄n
->
mech
->
	`ícode
(c⁄n->
≠p_d©a
, 
‰om
, 
Àngth
, 
¥Ÿ_Àvñ
,

298 (**)&
buf„r
, 
c⁄n
);

299 if(!
buf„r
 || 
byãs
 <= 0)

302 if(
iscmd
) {

303 
îr‹
 = 
	`Cuæ_ba£64_ícode
(
c⁄n
->
d©a
, 
buf„r
, 
	`cuæx_sôouz
(
byãs
),

304 &
cmd_buf„r
, &
cmd_size
);

305 if(
îr‹
) {

306 
	`‰ì
(
buf„r
);

309 if(
cmd_size
 > 0) {

310 c⁄° *
íc
 = "ENC ";

311 c⁄° *
mic
 = "MIC ";

312 if(
¥Ÿ_Àvñ
 =
PROT_PRIVATE
)

313 
	`sockë_wrôe
(
c⁄n
, 
fd
, 
íc
, 4);

315 
	`sockë_wrôe
(
c⁄n
, 
fd
, 
mic
, 4);

317 
	`sockë_wrôe
(
c⁄n
, 
fd
, 
cmd_buf„r
, 
cmd_size
);

318 
	`sockë_wrôe
(
c⁄n
, 
fd
, "\r\n", 2);

319 
	`öfof
(
c⁄n
->
d©a
, "Síd: %s%s\n", 
¥Ÿ_Àvñ
 =
PROT_PRIVATE
?
íc
:
mic
,

320 
cmd_buf„r
);

321 
	`‰ì
(
cmd_buf„r
);

325 
ht⁄l_byãs
 = 
	`ht⁄l
(
byãs
);

326 
	`sockë_wrôe
(
c⁄n
, 
fd
, &
ht⁄l_byãs
, (htonl_bytes));

327 
	`sockë_wrôe
(
c⁄n
, 
fd
, 
buf„r
, 
	`cuæx_sôouz
(
byãs
));

329 
	`‰ì
(
buf„r
);

330 
	}
}

332 
ssize_t
 
	$£c_wrôe
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 
fd
,

333 c⁄° *
buf„r
, 
size_t
 
Àngth
)

336 
ssize_t
 
tx
 = 0, 
Àn
 = 
c⁄n
->
buf„r_size
;

338 
Àn
 -
c⁄n
->
mech
->
	`ovîhód
(c⁄n->
≠p_d©a
, c⁄n->
d©a_¥Ÿ
,

339 
	`cuæx_sztosi
(
Àn
));

340 if(
Àn
 <= 0)

341 
Àn
 = 
Àngth
;

342 
Àngth
) {

343 if(
Àn
 >0 || 
Àngth
 < (
size_t
)len) {

345 
Àn
 = 
Àngth
;

347 
	`do_£c_£nd
(
c⁄n
, 
fd
, 
buf„r
, 
	`cuæx_sztosi
(
Àn
));

348 
Àngth
 -
Àn
;

349 
buf„r
 +
Àn
;

350 
tx
 +
Àn
;

352  
tx
;

353 
	}
}

356 
ssize_t
 
	$£c_£nd
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

357 c⁄° *
buf„r
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

359 
cuæ_sockë_t
 
fd
 = 
c⁄n
->
sock
[
socködex
];

360 *
îr
 = 
CURLE_OK
;

361  
	`£c_wrôe
(
c⁄n
, 
fd
, 
buf„r
, 
Àn
);

362 
	}
}

364 
	$Cuæ_£c_ªad_msg
(
c⁄√˘d©a
 *
c⁄n
, *
buf„r
,

365 
¥Ÿe˘i⁄_Àvñ
 
Àvñ
)

369 
decoded_Àn
;

370 *
buf
;

371 
ªt_code
;

372 
size_t
 
decoded_sz
 = 0;

373 
CURLcode
 
îr‹
;

375 
	`DEBUGASSERT
(
Àvñ
 > 
PROT_NONE
 &&Üevñ < 
PROT_LAST
);

377 
îr‹
 = 
	`Cuæ_ba£64_decode
(
buf„r
 + 4, (**)&
buf
, &
decoded_sz
);

378 if(
îr‹
 || 
decoded_sz
 == 0)

381 if(
decoded_sz
 > (
size_t
)
INT_MAX
) {

382 
	`‰ì
(
buf
);

385 
decoded_Àn
 = 
	`cuæx_uztosi
(
decoded_sz
);

387 
decoded_Àn
 = 
c⁄n
->
mech
->
	`decode
(c⁄n->
≠p_d©a
, 
buf
, decoded_len,

388 
Àvñ
, 
c⁄n
);

389 if(
decoded_Àn
 <= 0) {

390 
	`‰ì
(
buf
);

394 if(
c⁄n
->
d©a
->
£t
.
vîbo£
) {

395 
buf
[
decoded_Àn
] = '\n';

396 
	`Cuæ_debug
(
c⁄n
->
d©a
, 
CURLINFO_HEADER_IN
, 
buf
, 
decoded_Àn
 + 1, conn);

399 
buf
[
decoded_Àn
] = '\0';

400 
	`DEBUGASSERT
(
decoded_Àn
 > 3);

401 if(
buf
[3] == '-')

402 
ªt_code
 = 0;

405 
	`ssˇnf
(
buf
, "%d", &
ªt_code
);

408 if(
buf
[
decoded_Àn
 - 1] == '\n')

409 
buf
[
decoded_Àn
 - 1] = '\0';

411 
	`°r˝y
(
buf„r
, 
buf
);

412 
	`‰ì
(
buf
);

413  
ªt_code
;

414 
	}
}

417 
	$£c_£t_¥Ÿe˘i⁄_Àvñ
(
c⁄√˘d©a
 *
c⁄n
)

419 
code
;

420 * 
pbsz
;

421 
buf„r_size
 = 1 << 20;

422 
¥Ÿe˘i⁄_Àvñ
 
Àvñ
 = 
c⁄n
->
ªque°_d©a_¥Ÿ
;

424 
	`DEBUGASSERT
(
Àvñ
 > 
PROT_NONE
 &&Üevñ < 
PROT_LAST
);

426 if(!
c⁄n
->
£c_com∂ëe
) {

427 
	`öfof
(
c⁄n
->
d©a
, "TryingÅo changeÅheÖrotectionÜeveláfterÅhe"

433 if(
c⁄n
->
d©a_¥Ÿ
 =
Àvñ
)

436 if(
Àvñ
) {

437 
code
 = 
	`·p_£nd_comm™d
(
c⁄n
, "PBSZ %u", 
buf„r_size
);

438 if(
code
 < 0)

441 if(
code
/100 != 2) {

442 
	`Áûf
(
c⁄n
->
d©a
, "FailedÅo setÅheÖrotection's buffer size.");

445 
c⁄n
->
buf„r_size
 = buffer_size;

447 
pbsz
 = 
	`°r°r
(
c⁄n
->
d©a
->
°©e
.
buf„r
, "PBSZ=");

448 if(
pbsz
) {

450 
	`ssˇnf
(
pbsz
, "PBSZ=%u", &
buf„r_size
);

451 if(
buf„r_size
 < 
c⁄n
->buffer_size)

452 
c⁄n
->
buf„r_size
 = buffer_size;

457 
code
 = 
	`·p_£nd_comm™d
(
c⁄n
, "PROT %c", 
	`Àvñ_to_ch¨
(
Àvñ
));

459 if(
code
 < 0)

462 if(
code
/100 != 2) {

463 
	`Áûf
(
c⁄n
->
d©a
, "FailedÅo setÅheÖrotectionÜevel.");

467 
c⁄n
->
d©a_¥Ÿ
 = 
Àvñ
;

468 if(
Àvñ
 =
PROT_PRIVATE
)

469 
c⁄n
->
comm™d_¥Ÿ
 = 
Àvñ
;

472 
	}
}

475 
	$Cuæ_£c_ªque°_¥Ÿ
(
c⁄√˘d©a
 *
c⁄n
, c⁄° *
Àvñ
)

477 
¥Ÿe˘i⁄_Àvñ
 
l
 = 
	`«me_to_Àvñ
(
Àvñ
);

478 if(
l
 =
PROT_NONE
)

480 
	`DEBUGASSERT
(
l
 > 
PROT_NONE
 &&Ü < 
PROT_LAST
);

481 
c⁄n
->
ªque°_d©a_¥Ÿ
 = 
l
;

483 
	}
}

485 
CURLcode
 
	$choo£_mech
(
c⁄√˘d©a
 *
c⁄n
)

487 
ªt
;

488 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

489 c⁄° 
Cuæ_£c_˛õ¡_mech
 * c⁄° *
mech
;

490 *
tmp_Æloˇti⁄
;

491 c⁄° *
mech_«me
;

493 
mech
 = 
mechs
; (*mech); ++mech) {

494 
mech_«me
 = (*
mech
)->
«me
;

496 
	`DEBUGASSERT
(
mech_«me
 !
NULL
);

497 if(
mech_«me
 =
NULL
) {

498 
	`öfof
(
d©a
, "Skùpög mech™ism wôhÉm±yÇamê(%p)\n", (*)
mech
);

501 
tmp_Æloˇti⁄
 = 
	`ªÆloc
(
c⁄n
->
≠p_d©a
, (*
mech
)->
size
);

502 if(
tmp_Æloˇti⁄
 =
NULL
) {

503 
	`Áûf
(
d©a
, "FaûedÑóŒo¯o‡sizê%u", (*
mech
)->
size
);

504 
mech
 = 
NULL
;

505  
CURLE_OUT_OF_MEMORY
;

507 
c⁄n
->
≠p_d©a
 = 
tmp_Æloˇti⁄
;

509 if((*
mech
)->
öô
) {

510 
ªt
 = (*
mech
)->
	`öô
(
c⁄n
->
≠p_d©a
);

511 if(
ªt
 != 0) {

512 
	`öfof
(
d©a
, "Faûed inôüliz©i⁄ f‹ %s. Skùpög it.\n", 
mech_«me
);

517 
	`öfof
(
d©a
, "Tryög mech™ism %s...\n", 
mech_«me
);

518 
ªt
 = 
	`·p_£nd_comm™d
(
c⁄n
, "AUTH %s", 
mech_«me
);

519 if(
ªt
 < 0)

521  
CURLE_COULDNT_CONNECT
;

523 if(
ªt
/100 != 3) {

524 
ªt
) {

526 
	`öfof
(
d©a
, "Mechanism %s isÇot supported byÅhe server (server "

527 "ªtu∫ed fç code: 504).\n", 
mech_«me
);

530 
	`öfof
(
d©a
, "Mechanism %s wasÑejected byÅhe server (serverÑeturned "

531 "·∞code: 534).\n", 
mech_«me
);

534 if(
ªt
/100 == 5) {

535 
	`öfof
(
d©a
, "server doesÇot supportÅhe securityÉxtensions\n");

536  
CURLE_USE_SSL_FAILED
;

544 
ªt
 = (*
mech
)->
	`auth
(
c⁄n
->
≠p_d©a
, conn);

546 if(
ªt
 =
AUTH_CONTINUE
)

548 if(
ªt
 !
AUTH_OK
) {

552 
	`DEBUGASSERT
(
ªt
 =
AUTH_OK
);

554 
c⁄n
->
mech
 = *mech;

555 
c⁄n
->
£c_com∂ëe
 = 1;

556 
c⁄n
->
ªcv
[
FIRSTSOCKET
] = 
£c_ªcv
;

557 
c⁄n
->
£nd
[
FIRSTSOCKET
] = 
£c_£nd
;

558 
c⁄n
->
ªcv
[
SECONDARYSOCKET
] = 
£c_ªcv
;

559 
c⁄n
->
£nd
[
SECONDARYSOCKET
] = 
£c_£nd
;

560 
c⁄n
->
comm™d_¥Ÿ
 = 
PROT_SAFE
;

563 ()
	`£c_£t_¥Ÿe˘i⁄_Àvñ
(
c⁄n
);

567  
mech
 !
NULL
 ? 
CURLE_OK
 : 
CURLE_FAILED_INIT
;

568 
	}
}

570 
CURLcode


571 
	$Cuæ_£c_logö
(
c⁄√˘d©a
 *
c⁄n
)

573  
	`choo£_mech
(
c⁄n
);

574 
	}
}

578 
	$Cuæ_£c_íd
(
c⁄√˘d©a
 *
c⁄n
)

580 if(
c⁄n
->
mech
 !
NULL
 && c⁄n->mech->
íd
)

581 
c⁄n
->
mech
->
	`íd
(c⁄n->
≠p_d©a
);

582 if(
c⁄n
->
≠p_d©a
) {

583 
	`‰ì
(
c⁄n
->
≠p_d©a
);

584 
c⁄n
->
≠p_d©a
 = 
NULL
;

586 if(
c⁄n
->
ö_buf„r
.
d©a
) {

587 
	`‰ì
(
c⁄n
->
ö_buf„r
.
d©a
);

588 
c⁄n
->
ö_buf„r
.
d©a
 = 
NULL
;

589 
c⁄n
->
ö_buf„r
.
size
 = 0;

590 
c⁄n
->
ö_buf„r
.
ödex
 = 0;

592 
c⁄n
->
ö_buf„r
.
eof_Êag
 = 0;

594 
c⁄n
->
£c_com∂ëe
 = 0;

595 
c⁄n
->
d©a_¥Ÿ
 = 
PROT_CLEAR
;

596 
c⁄n
->
mech
 = 
NULL
;

597 
	}
}

	@lib/select.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_SYS_SELECT_H


26 
	~<sys/£À˘.h
>

29 #i‡!
deföed
(
HAVE_SELECT
Ë&& !deföed(
HAVE_POLL_FINE
)

33 #i‡
deföed
(
__BEOS__
Ë&& !deföed(
__HAIKU__
)

35 
	~<sockë.h
>

38 #ifde‡
MSDOS


39 
	~<dos.h
>

42 
	~<cuæ/cuæ.h
>

44 
	~"uæd©a.h
"

45 
	~"c⁄√˘.h
"

46 
	~"£À˘.h
"

47 
	~"w¨∆ess.h
"

51 
	#ñ≠£d_ms
 ()
	`cuæx_tvdiff
(
	`cuæx_tvnow
(), 
öôül_tv
)

	)

53 
	gCuæ_ack_eöå
 = 0;

54 
	#îr‹_nŸ_EINTR
 (
Cuæ_ack_eöå
 || 
îr‹
 !
EINTR
)

	)

72 
	$Cuæ_waô_ms
(
timeout_ms
)

74 #i‡!
	`deföed
(
MSDOS
Ë&& !deföed(
USE_WINSOCK
)

75 #i‚de‡
HAVE_POLL_FINE


76 
timevÆ
 
≥ndög_tv
;

78 
timevÆ
 
öôül_tv
;

79 
≥ndög_ms
;

80 
îr‹
;

82 
r
 = 0;

84 if(!
timeout_ms
)

86 if(
timeout_ms
 < 0) {

87 
	`SET_SOCKERRNO
(
EINVAL
);

90 #i‡
	`deföed
(
MSDOS
)

91 
	`dñay
(
timeout_ms
);

92 #ñi‡
	`deföed
(
USE_WINSOCK
)

93 
	`SÀï
(
timeout_ms
);

95 
≥ndög_ms
 = 
timeout_ms
;

96 
öôül_tv
 = 
	`cuæx_tvnow
();

98 #i‡
	`deföed
(
HAVE_POLL_FINE
)

99 
r
 = 
	`pﬁl
(
NULL
, 0, 
≥ndög_ms
);

101 
≥ndög_tv
.
tv_£c
 = 
≥ndög_ms
 / 1000;

102 
≥ndög_tv
.
tv_u£c
 = (
≥ndög_ms
 % 1000) * 1000;

103 
r
 = 
	`£À˘
(0, 
NULL
, NULL, NULL, &
≥ndög_tv
);

105 if(
r
 != -1)

107 
îr‹
 = 
SOCKERRNO
;

108 if(
îr‹
 && 
îr‹_nŸ_EINTR
)

110 
≥ndög_ms
 = 
timeout_ms
 - 
ñ≠£d_ms
;

111 if(
≥ndög_ms
 <= 0)

113 } 
r
 == -1);

115 if(
r
)

116 
r
 = -1;

117  
r
;

118 
	}
}

140 
	$Cuæ_sockë_check
(
cuæ_sockë_t
 
ªadfd0
,

141 
cuæ_sockë_t
 
ªadfd1
,

142 
cuæ_sockë_t
 
wrôefd
,

143 
timeout_ms
)

145 #ifde‡
HAVE_POLL_FINE


146 
pﬁlfd
 
pfd
[3];

147 
num
;

149 
timevÆ
 
≥ndög_tv
;

150 
timevÆ
 *
±imeout
;

151 
fd_£t
 
fds_ªad
;

152 
fd_£t
 
fds_wrôe
;

153 
fd_£t
 
fds_îr
;

154 
cuæ_sockë_t
 
maxfd
;

156 
timevÆ
 
öôül_tv
 = {0,0};

157 
≥ndög_ms
 = 0;

158 
îr‹
;

159 
r
;

160 
ªt
;

162 if((
ªadfd0
 =
CURL_SOCKET_BAD
Ë&& (
ªadfd1
 == CURL_SOCKET_BAD) &&

163 (
wrôefd
 =
CURL_SOCKET_BAD
)) {

165 
r
 = 
	`Cuæ_waô_ms
(()
timeout_ms
);

166  
r
;

174 if(
timeout_ms
 > 0) {

175 
≥ndög_ms
 = ()
timeout_ms
;

176 
öôül_tv
 = 
	`cuæx_tvnow
();

179 #ifde‡
HAVE_POLL_FINE


181 
num
 = 0;

182 if(
ªadfd0
 !
CURL_SOCKET_BAD
) {

183 
pfd
[
num
].
fd
 = 
ªadfd0
;

184 
pfd
[
num
].
evíts
 = 
POLLRDNORM
|
POLLIN
|
POLLRDBAND
|
POLLPRI
;

185 
pfd
[
num
].
ªvíts
 = 0;

186 
num
++;

188 if(
ªadfd1
 !
CURL_SOCKET_BAD
) {

189 
pfd
[
num
].
fd
 = 
ªadfd1
;

190 
pfd
[
num
].
evíts
 = 
POLLRDNORM
|
POLLIN
|
POLLRDBAND
|
POLLPRI
;

191 
pfd
[
num
].
ªvíts
 = 0;

192 
num
++;

194 if(
wrôefd
 !
CURL_SOCKET_BAD
) {

195 
pfd
[
num
].
fd
 = 
wrôefd
;

196 
pfd
[
num
].
evíts
 = 
POLLWRNORM
|
POLLOUT
;

197 
pfd
[
num
].
ªvíts
 = 0;

198 
num
++;

202 if(
timeout_ms
 < 0)

203 
≥ndög_ms
 = -1;

204 if(!
timeout_ms
)

205 
≥ndög_ms
 = 0;

206 
r
 = 
	`pﬁl
(
pfd
, 
num
, 
≥ndög_ms
);

207 if(
r
 != -1)

209 
îr‹
 = 
SOCKERRNO
;

210 if(
îr‹
 && 
îr‹_nŸ_EINTR
)

212 if(
timeout_ms
 > 0) {

213 
≥ndög_ms
 = ()(
timeout_ms
 - 
ñ≠£d_ms
);

214 if(
≥ndög_ms
 <= 0) {

215 
r
 = 0;

219 } 
r
 == -1);

221 if(
r
 < 0)

223 if(
r
 == 0)

226 
ªt
 = 0;

227 
num
 = 0;

228 if(
ªadfd0
 !
CURL_SOCKET_BAD
) {

229 if(
pfd
[
num
].
ªvíts
 & (
POLLRDNORM
|
POLLIN
|
POLLERR
|
POLLHUP
))

230 
ªt
 |
CURL_CSELECT_IN
;

231 if(
pfd
[
num
].
ªvíts
 & (
POLLRDBAND
|
POLLPRI
|
POLLNVAL
))

232 
ªt
 |
CURL_CSELECT_ERR
;

233 
num
++;

235 if(
ªadfd1
 !
CURL_SOCKET_BAD
) {

236 if(
pfd
[
num
].
ªvíts
 & (
POLLRDNORM
|
POLLIN
|
POLLERR
|
POLLHUP
))

237 
ªt
 |
CURL_CSELECT_IN2
;

238 if(
pfd
[
num
].
ªvíts
 & (
POLLRDBAND
|
POLLPRI
|
POLLNVAL
))

239 
ªt
 |
CURL_CSELECT_ERR
;

240 
num
++;

242 if(
wrôefd
 !
CURL_SOCKET_BAD
) {

243 if(
pfd
[
num
].
ªvíts
 & (
POLLWRNORM
|
POLLOUT
))

244 
ªt
 |
CURL_CSELECT_OUT
;

245 if(
pfd
[
num
].
ªvíts
 & (
POLLERR
|
POLLHUP
|
POLLNVAL
))

246 
ªt
 |
CURL_CSELECT_ERR
;

249  
ªt
;

253 
	`FD_ZERO
(&
fds_îr
);

254 
maxfd
 = (
cuæ_sockë_t
)-1;

256 
	`FD_ZERO
(&
fds_ªad
);

257 if(
ªadfd0
 !
CURL_SOCKET_BAD
) {

258 
	`VERIFY_SOCK
(
ªadfd0
);

259 
	`FD_SET
(
ªadfd0
, &
fds_ªad
);

260 
	`FD_SET
(
ªadfd0
, &
fds_îr
);

261 
maxfd
 = 
ªadfd0
;

263 if(
ªadfd1
 !
CURL_SOCKET_BAD
) {

264 
	`VERIFY_SOCK
(
ªadfd1
);

265 
	`FD_SET
(
ªadfd1
, &
fds_ªad
);

266 
	`FD_SET
(
ªadfd1
, &
fds_îr
);

267 if(
ªadfd1
 > 
maxfd
)

268 
maxfd
 = 
ªadfd1
;

271 
	`FD_ZERO
(&
fds_wrôe
);

272 if(
wrôefd
 !
CURL_SOCKET_BAD
) {

273 
	`VERIFY_SOCK
(
wrôefd
);

274 
	`FD_SET
(
wrôefd
, &
fds_wrôe
);

275 
	`FD_SET
(
wrôefd
, &
fds_îr
);

276 if(
wrôefd
 > 
maxfd
)

277 
maxfd
 = 
wrôefd
;

280 
±imeout
 = (
timeout_ms
 < 0Ë? 
NULL
 : &
≥ndög_tv
;

283 if(
timeout_ms
 > 0) {

284 
≥ndög_tv
.
tv_£c
 = 
≥ndög_ms
 / 1000;

285 
≥ndög_tv
.
tv_u£c
 = (
≥ndög_ms
 % 1000) * 1000;

287 if(!
timeout_ms
) {

288 
≥ndög_tv
.
tv_£c
 = 0;

289 
≥ndög_tv
.
tv_u£c
 = 0;

313 
r
 = 
	`£À˘
(()
maxfd
 + 1,

314 #i‚de‡
USE_WINSOCK


315 &
fds_ªad
,

316 &
fds_wrôe
,

318 
fds_ªad
.
fd_cou¡
 ? &fds_ªad : 
NULL
,

319 
fds_wrôe
.
fd_cou¡
 ? &fds_wrôê: 
NULL
,

321 &
fds_îr
, 
±imeout
);

322 if(
r
 != -1)

324 
îr‹
 = 
SOCKERRNO
;

325 if(
îr‹
 && 
îr‹_nŸ_EINTR
)

327 if(
timeout_ms
 > 0) {

328 
≥ndög_ms
 = 
timeout_ms
 - 
ñ≠£d_ms
;

329 if(
≥ndög_ms
 <= 0) {

330 
r
 = 0;

334 } 
r
 == -1);

336 if(
r
 < 0)

338 if(
r
 == 0)

341 
ªt
 = 0;

342 if(
ªadfd0
 !
CURL_SOCKET_BAD
) {

343 if(
	`FD_ISSET
(
ªadfd0
, &
fds_ªad
))

344 
ªt
 |
CURL_CSELECT_IN
;

345 if(
	`FD_ISSET
(
ªadfd0
, &
fds_îr
))

346 
ªt
 |
CURL_CSELECT_ERR
;

348 if(
ªadfd1
 !
CURL_SOCKET_BAD
) {

349 if(
	`FD_ISSET
(
ªadfd1
, &
fds_ªad
))

350 
ªt
 |
CURL_CSELECT_IN2
;

351 if(
	`FD_ISSET
(
ªadfd1
, &
fds_îr
))

352 
ªt
 |
CURL_CSELECT_ERR
;

354 if(
wrôefd
 !
CURL_SOCKET_BAD
) {

355 if(
	`FD_ISSET
(
wrôefd
, &
fds_wrôe
))

356 
ªt
 |
CURL_CSELECT_OUT
;

357 if(
	`FD_ISSET
(
wrôefd
, &
fds_îr
))

358 
ªt
 |
CURL_CSELECT_ERR
;

361  
ªt
;

365 
	}
}

380 
	$Cuæ_pﬁl
(
pﬁlfd
 
ufds
[], 
nfds
, 
timeout_ms
)

382 #i‚de‡
HAVE_POLL_FINE


383 
timevÆ
 
≥ndög_tv
;

384 
timevÆ
 *
±imeout
;

385 
fd_£t
 
fds_ªad
;

386 
fd_£t
 
fds_wrôe
;

387 
fd_£t
 
fds_îr
;

388 
cuæ_sockë_t
 
maxfd
;

390 
timevÆ
 
öôül_tv
 = {0,0};

391 
boﬁ
 
fds_n⁄e
 = 
TRUE
;

392 
i
;

393 
≥ndög_ms
 = 0;

394 
îr‹
;

395 
r
;

397 if(
ufds
) {

398 
i
 = 0; i < 
nfds
; i++) {

399 if(
ufds
[
i
].
fd
 !
CURL_SOCKET_BAD
) {

400 
fds_n⁄e
 = 
FALSE
;

405 if(
fds_n⁄e
) {

406 
r
 = 
	`Cuæ_waô_ms
(
timeout_ms
);

407  
r
;

415 if(
timeout_ms
 > 0) {

416 
≥ndög_ms
 = 
timeout_ms
;

417 
öôül_tv
 = 
	`cuæx_tvnow
();

420 #ifde‡
HAVE_POLL_FINE


423 if(
timeout_ms
 < 0)

424 
≥ndög_ms
 = -1;

425 if(!
timeout_ms
)

426 
≥ndög_ms
 = 0;

427 
r
 = 
	`pﬁl
(
ufds
, 
nfds
, 
≥ndög_ms
);

428 if(
r
 != -1)

430 
îr‹
 = 
SOCKERRNO
;

431 if(
îr‹
 && 
îr‹_nŸ_EINTR
)

433 if(
timeout_ms
 > 0) {

434 
≥ndög_ms
 = 
timeout_ms
 - 
ñ≠£d_ms
;

435 if(
≥ndög_ms
 <= 0)

438 } 
r
 == -1);

440 if(
r
 < 0)

442 if(
r
 == 0)

445 
i
 = 0; i < 
nfds
; i++) {

446 if(
ufds
[
i
].
fd
 =
CURL_SOCKET_BAD
)

448 if(
ufds
[
i
].
ªvíts
 & 
POLLHUP
)

449 
ufds
[
i
].
ªvíts
 |
POLLIN
;

450 if(
ufds
[
i
].
ªvíts
 & 
POLLERR
)

451 
ufds
[
i
].
ªvíts
 |(
POLLIN
|
POLLOUT
);

456 
	`FD_ZERO
(&
fds_ªad
);

457 
	`FD_ZERO
(&
fds_wrôe
);

458 
	`FD_ZERO
(&
fds_îr
);

459 
maxfd
 = (
cuæ_sockë_t
)-1;

461 
i
 = 0; i < 
nfds
; i++) {

462 
ufds
[
i
].
ªvíts
 = 0;

463 if(
ufds
[
i
].
fd
 =
CURL_SOCKET_BAD
)

465 
	`VERIFY_SOCK
(
ufds
[
i
].
fd
);

466 if(
ufds
[
i
].
evíts
 & (
POLLIN
|
POLLOUT
|
POLLPRI
|

467 
POLLRDNORM
|
POLLWRNORM
|
POLLRDBAND
)) {

468 if(
ufds
[
i
].
fd
 > 
maxfd
)

469 
maxfd
 = 
ufds
[
i
].
fd
;

470 if(
ufds
[
i
].
evíts
 & (
POLLRDNORM
|
POLLIN
))

471 
	`FD_SET
(
ufds
[
i
].
fd
, &
fds_ªad
);

472 if(
ufds
[
i
].
evíts
 & (
POLLWRNORM
|
POLLOUT
))

473 
	`FD_SET
(
ufds
[
i
].
fd
, &
fds_wrôe
);

474 if(
ufds
[
i
].
evíts
 & (
POLLRDBAND
|
POLLPRI
))

475 
	`FD_SET
(
ufds
[
i
].
fd
, &
fds_îr
);

479 #ifde‡
USE_WINSOCK


482 if(
fds_ªad
.
fd_cou¡
 =0 && 
fds_wrôe
.fd_count == 0

483 && 
fds_îr
.
fd_cou¡
 == 0) {

484 
r
 = 
	`Cuæ_waô_ms
(
timeout_ms
);

485  
r
;

489 
±imeout
 = (
timeout_ms
 < 0Ë? 
NULL
 : &
≥ndög_tv
;

492 if(
timeout_ms
 > 0) {

493 
≥ndög_tv
.
tv_£c
 = 
≥ndög_ms
 / 1000;

494 
≥ndög_tv
.
tv_u£c
 = (
≥ndög_ms
 % 1000) * 1000;

496 if(!
timeout_ms
) {

497 
≥ndög_tv
.
tv_£c
 = 0;

498 
≥ndög_tv
.
tv_u£c
 = 0;

500 
r
 = 
	`£À˘
(()
maxfd
 + 1,

501 #i‚de‡
USE_WINSOCK


502 &
fds_ªad
, &
fds_wrôe
, &
fds_îr
,

508 
fds_ªad
.
fd_cou¡
 ? &fds_ªad : 
NULL
,

509 
fds_wrôe
.
fd_cou¡
 ? &fds_wrôê: 
NULL
,

510 
fds_îr
.
fd_cou¡
 ? &fds_î∏: 
NULL
,

512 
±imeout
);

513 if(
r
 != -1)

515 
îr‹
 = 
SOCKERRNO
;

516 if(
îr‹
 && 
îr‹_nŸ_EINTR
)

518 if(
timeout_ms
 > 0) {

519 
≥ndög_ms
 = 
timeout_ms
 - 
ñ≠£d_ms
;

520 if(
≥ndög_ms
 <= 0)

523 } 
r
 == -1);

525 if(
r
 < 0)

527 if(
r
 == 0)

530 
r
 = 0;

531 
i
 = 0; i < 
nfds
; i++) {

532 
ufds
[
i
].
ªvíts
 = 0;

533 if(
ufds
[
i
].
fd
 =
CURL_SOCKET_BAD
)

535 if(
	`FD_ISSET
(
ufds
[
i
].
fd
, &
fds_ªad
))

536 
ufds
[
i
].
ªvíts
 |
POLLIN
;

537 if(
	`FD_ISSET
(
ufds
[
i
].
fd
, &
fds_wrôe
))

538 
ufds
[
i
].
ªvíts
 |
POLLOUT
;

539 if(
	`FD_ISSET
(
ufds
[
i
].
fd
, &
fds_îr
))

540 
ufds
[
i
].
ªvíts
 |
POLLPRI
;

541 if(
ufds
[
i
].
ªvíts
 != 0)

542 
r
++;

547  
r
;

548 
	}
}

550 #ifde‡
TPF


559 
	$çf_£À˘_libcuæ
(
maxfds
, 
fd_£t
* 
ªads
, fd_£t* 
wrôes
,

560 
fd_£t
* 
ex˚±s
, 
timevÆ
* 
tv
)

562 
rc
;

564 
rc
 = 
	`çf_£À˘_bsd
(
maxfds
, 
ªads
, 
wrôes
, 
ex˚±s
, 
tv
);

565 
	`çf_¥o˚ss_sig«ls
();

566 (
rc
);

567 
	}
}

	@lib/select.h

1 #i‚de‡
HEADER_CURL_SELECT_H


2 
	#HEADER_CURL_SELECT_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
HAVE_SYS_POLL_H


28 
	~<sys/pﬁl.h
>

29 #ñi‡
deföed
(
HAVE_POLL_H
)

30 
	~<pﬁl.h
>

37 #i‡!
deföed
(
HAVE_STRUCT_POLLFD
) && \

38 !
deföed
(
HAVE_SYS_POLL_H
) && \

39 !
	$deföed
(
HAVE_POLL_H
)

41 
	#POLLIN
 0x01

	)

42 
	#POLLPRI
 0x02

	)

43 
	#POLLOUT
 0x04

	)

44 
	#POLLERR
 0x08

	)

45 
	#POLLHUP
 0x10

	)

46 
	#POLLNVAL
 0x20

	)

48 
	spﬁlfd


50 
cuæ_sockë_t
 
fd
;

51 
evíts
;

52 
ªvíts
;

57 #i‚de‡
POLLRDNORM


58 
	#POLLRDNORM
 
POLLIN


	)

61 #i‚de‡
POLLWRNORM


62 
	#POLLWRNORM
 
POLLOUT


	)

65 #i‚de‡
POLLRDBAND


66 
	#POLLRDBAND
 
POLLPRI


	)

72 
	#CURL_CSELECT_IN2
 (
CURL_CSELECT_ERR
 << 1)

	)

74 
	`Cuæ_sockë_check
(
cuæ_sockë_t
 
ªadfd
, cuæ_sockë_à
ªadfd2
,

75 
cuæ_sockë_t
 
wrôefd
,

76 
timeout_ms
);

79 
	#Cuæ_sockë_ªady
(
x
,
y
,
z
) \

80 
	`Cuæ_sockë_check
(
x
, 
CURL_SOCKET_BAD
, 
y
, 
z
)

	)

82 
	`Cuæ_pﬁl
(
pﬁlfd
 
ufds
[], 
nfds
, 
timeout_ms
);

88 
Cuæ_ack_eöå
;

90 
	`Cuæ_waô_ms
(
timeout_ms
);

92 #ifde‡
TPF


93 
	`çf_£À˘_libcuæ
(
maxfds
, 
fd_£t
* 
ªads
, fd_£t* 
wrôes
,

94 
fd_£t
* 
ex˚±s
, 
timevÆ
* 
tv
);

100 #i‡
	`deföed
(
USE_WINSOCK
Ë|| deföed(
TPF
)

101 
	#VALID_SOCK
(
x
Ë1

	)

102 
	#VERIFY_SOCK
(
x
Ë
Cuæ_n›_°mt


	)

104 
	#VALID_SOCK
(
s
Ë(((sË>0Ë&& ((sË< 
FD_SETSIZE
))

	)

105 
	#VERIFY_SOCK
(
x
) do { \

106 if(!
	`VALID_SOCK
(
x
)) { \

107 
	`SET_SOCKERRNO
(
EINVAL
); \

110 
	}
} 
WHILE_FALSE


	)

	@lib/sendf.c

23 
	~"cuæ_£tup.h
"

25 
	~<cuæ/cuæ.h
>

27 
	~"uæd©a.h
"

28 
	~"£ndf.h
"

29 
	~"c⁄√˘.h
"

30 
	~"vés/vés.h
"

31 
	~"ssh.h
"

32 
	~"mu…iif.h
"

33 
	~"n⁄-ascii.h
"

35 
	#_MPRINTF_REPLACE


	)

36 
	~<cuæ/m¥ötf.h
>

38 
	~"cuæ_mem‹y.h
"

39 
	~"°ªº‹.h
"

42 
	~"memdebug.h
"

44 #ifde‡
CURL_DO_LINEEND_CONV


51 
size_t
 
	$c⁄vît_löìnds
(
Sessi⁄H™dÀ
 *
d©a
,

52 *
°¨tPå
, 
size_t
 
size
)

54 *
öPå
, *
outPå
;

57 if((
°¨tPå
 =
NULL
Ë|| (
size
 < 1)) {

58 (
size
);

61 if(
d©a
->
°©e
.
¥ev_block_had_åaûög_¸
) {

64 if(*
°¨tPå
 == '\n') {

67 
	`memmove
(
°¨tPå
, sèπPå+1, 
size
-1);

68 
size
--;

70 
d©a
->
°©e
.
¸lf_c⁄vîsi⁄s
++;

72 
d©a
->
°©e
.
¥ev_block_had_åaûög_¸
 = 
FALSE
;

76 
öPå
 = 
outPå
 = 
	`memchr
(
°¨tPå
, '\r', 
size
);

77 if(
öPå
) {

79 
öPå
 < (
°¨tPå
+
size
-1)) {

81 if(
	`memcmp
(
öPå
, "\r\n", 2) == 0) {

83 
öPå
++;

84 *
outPå
 = *
öPå
;

86 
d©a
->
°©e
.
¸lf_c⁄vîsi⁄s
++;

89 if(*
öPå
 == '\r') {

91 *
outPå
 = '\n';

95 *
outPå
 = *
öPå
;

98 
outPå
++;

99 
öPå
++;

102 if(
öPå
 < 
°¨tPå
+
size
) {

104 if(*
öPå
 == '\r') {

106 *
outPå
 = '\n';

108 
d©a
->
°©e
.
¥ev_block_had_åaûög_¸
 = 
TRUE
;

112 *
outPå
 = *
öPå
;

114 
outPå
++;

116 if(
outPå
 < 
°¨tPå
+
size
)

118 *
outPå
 = '\0';

120 (
outPå
 - 
°¨tPå
);

122 (
size
);

123 
	}
}

128 
	$Cuæ_öfof
(
Sessi⁄H™dÀ
 *
d©a
, c⁄° *
fmt
, ...)

130 if(
d©a
 && d©a->
£t
.
vîbo£
) {

131 
va_li°
 
≠
;

132 
size_t
 
Àn
;

133 
¥öt_buf„r
[2048 + 1];

134 
	`va_°¨t
(
≠
, 
fmt
);

135 
	`v¢¥ötf
(
¥öt_buf„r
, ’röt_buf„r), 
fmt
, 
≠
);

136 
	`va_íd
(
≠
);

137 
Àn
 = 
	`°æí
(
¥öt_buf„r
);

138 
	`Cuæ_debug
(
d©a
, 
CURLINFO_TEXT
, 
¥öt_buf„r
, 
Àn
, 
NULL
);

140 
	}
}

146 
	$Cuæ_Áûf
(
Sessi⁄H™dÀ
 *
d©a
, c⁄° *
fmt
, ...)

148 
va_li°
 
≠
;

149 
size_t
 
Àn
;

150 
	`va_°¨t
(
≠
, 
fmt
);

152 
	`v¢¥ötf
(
d©a
->
°©e
.
buf„r
, 
BUFSIZE
, 
fmt
, 
≠
);

154 if(
d©a
->
£t
.
îr‹buf„r
 && !d©a->
°©e
.
îr‹buf
) {

155 
	`¢¥ötf
(
d©a
->
£t
.
îr‹buf„r
, 
CURL_ERROR_SIZE
, "%s", d©a->
°©e
.
buf„r
);

156 
d©a
->
°©e
.
îr‹buf
 = 
TRUE
;

158 if(
d©a
->
£t
.
vîbo£
) {

159 
Àn
 = 
	`°æí
(
d©a
->
°©e
.
buf„r
);

160 if(
Àn
 < 
BUFSIZE
 - 1) {

161 
d©a
->
°©e
.
buf„r
[
Àn
] = '\n';

162 
d©a
->
°©e
.
buf„r
[++
Àn
] = '\0';

164 
	`Cuæ_debug
(
d©a
, 
CURLINFO_TEXT
, d©a->
°©e
.
buf„r
, 
Àn
, 
NULL
);

167 
	`va_íd
(
≠
);

168 
	}
}

171 
CURLcode
 
	$Cuæ_£ndf
(
cuæ_sockë_t
 
sockfd
, 
c⁄√˘d©a
 *
c⁄n
,

172 c⁄° *
fmt
, ...)

174 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

175 
ssize_t
 
byãs_wrôãn
;

176 
size_t
 
wrôe_Àn
;

177 
CURLcode
 
ªs
 = 
CURLE_OK
;

178 *
s
;

179 *
•å
;

180 
va_li°
 
≠
;

181 
	`va_°¨t
(
≠
, 
fmt
);

182 
s
 = 
	`v≠rötf
(
fmt
, 
≠
);

183 
	`va_íd
(
≠
);

184 if(!
s
)

185  
CURLE_OUT_OF_MEMORY
;

187 
byãs_wrôãn
=0;

188 
wrôe_Àn
 = 
	`°æí
(
s
);

189 
•å
 = 
s
;

193 
ªs
 = 
	`Cuæ_wrôe
(
c⁄n
, 
sockfd
, 
•å
, 
wrôe_Àn
, &
byãs_wrôãn
);

195 if(
CURLE_OK
 !
ªs
)

198 if(
d©a
->
£t
.
vîbo£
)

199 
	`Cuæ_debug
(
d©a
, 
CURLINFO_DATA_OUT
, 
•å
, (
size_t
)
byãs_wrôãn
, 
c⁄n
);

201 if((
size_t
)
byãs_wrôãn
 !
wrôe_Àn
) {

204 
wrôe_Àn
 -
byãs_wrôãn
;

205 
•å
 +
byãs_wrôãn
;

211 
	`‰ì
(
s
);

213  
ªs
;

214 
	}
}

223 
CURLcode
 
	$Cuæ_wrôe
(
c⁄√˘d©a
 *
c⁄n
,

224 
cuæ_sockë_t
 
sockfd
,

225 c⁄° *
mem
,

226 
size_t
 
Àn
,

227 
ssize_t
 *
wrôãn
)

229 
ssize_t
 
byãs_wrôãn
;

230 
CURLcode
 
cuæcode
 = 
CURLE_OK
;

231 
num
 = (
sockfd
 =
c⁄n
->
sock
[
SECONDARYSOCKET
]);

233 
byãs_wrôãn
 = 
c⁄n
->
£nd
[
num
](c⁄n,Çum, 
mem
, 
Àn
, &
cuæcode
);

235 *
wrôãn
 = 
byãs_wrôãn
;

236 if(
byãs_wrôãn
 >= 0)

238  
CURLE_OK
;

241 
cuæcode
) {

242 
CURLE_AGAIN
:

243 *
wrôãn
 = 0;

244  
CURLE_OK
;

246 
CURLE_OK
:

248  
CURLE_SEND_ERROR
;

252  
cuæcode
;

254 
	}
}

256 
ssize_t
 
	$Cuæ_£nd_∂aö
(
c⁄√˘d©a
 *
c⁄n
, 
num
,

257 c⁄° *
mem
, 
size_t
 
Àn
, 
CURLcode
 *
code
)

259 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
num
];

260 
ssize_t
 
byãs_wrôãn
 = 
	`swrôe
(
sockfd
, 
mem
, 
Àn
);

262 *
code
 = 
CURLE_OK
;

263 if(-1 =
byãs_wrôãn
) {

264 
îr
 = 
SOCKERRNO
;

267 #ifde‡
WSAEWOULDBLOCK


269 (
WSAEWOULDBLOCK
 =
îr
)

274 (
EWOULDBLOCK
 =
îr
Ë|| (
EAGAIN
 =îrË|| (
EINTR
 ==Érr)

278 
byãs_wrôãn
=0;

279 *
code
 = 
CURLE_AGAIN
;

282 
	`Áûf
(
c⁄n
->
d©a
, "Send failure: %s",

283 
	`Cuæ_°ªº‹
(
c⁄n
, 
îr
));

284 
c⁄n
->
d©a
->
°©e
.
os_î∫o
 = 
îr
;

285 *
code
 = 
CURLE_SEND_ERROR
;

288  
byãs_wrôãn
;

289 
	}
}

296 
CURLcode
 
	$Cuæ_wrôe_∂aö
(
c⁄√˘d©a
 *
c⁄n
,

297 
cuæ_sockë_t
 
sockfd
,

298 c⁄° *
mem
,

299 
size_t
 
Àn
,

300 
ssize_t
 *
wrôãn
)

302 
ssize_t
 
byãs_wrôãn
;

303 
CURLcode
 
ªtcode
;

304 
num
 = (
sockfd
 =
c⁄n
->
sock
[
SECONDARYSOCKET
]);

306 
byãs_wrôãn
 = 
	`Cuæ_£nd_∂aö
(
c⁄n
, 
num
, 
mem
, 
Àn
, &
ªtcode
);

308 *
wrôãn
 = 
byãs_wrôãn
;

310  
ªtcode
;

311 
	}
}

313 
ssize_t
 
	$Cuæ_ªcv_∂aö
(
c⁄√˘d©a
 *
c⁄n
, 
num
, *
buf
,

314 
size_t
 
Àn
, 
CURLcode
 *
code
)

316 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
num
];

317 
ssize_t
 
ƒód
 = 
	`§ód
(
sockfd
, 
buf
, 
Àn
);

319 *
code
 = 
CURLE_OK
;

320 if(-1 =
ƒód
) {

321 
îr
 = 
SOCKERRNO
;

324 #ifde‡
WSAEWOULDBLOCK


326 (
WSAEWOULDBLOCK
 =
îr
)

331 (
EWOULDBLOCK
 =
îr
Ë|| (
EAGAIN
 =îrË|| (
EINTR
 ==Érr)

335 *
code
 = 
CURLE_AGAIN
;

338 
	`Áûf
(
c⁄n
->
d©a
, "Recv failure: %s",

339 
	`Cuæ_°ªº‹
(
c⁄n
, 
îr
));

340 
c⁄n
->
d©a
->
°©e
.
os_î∫o
 = 
îr
;

341 *
code
 = 
CURLE_RECV_ERROR
;

344  
ƒód
;

345 
	}
}

347 
CURLcode
 
	$∑u£wrôe
(
Sessi⁄H™dÀ
 *
d©a
,

348 
ty≥
,

349 c⁄° *
±r
,

350 
size_t
 
Àn
)

355 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

356 *
du∂
 = 
	`mÆloc
(
Àn
);

357 if(!
du∂
)

358  
CURLE_OUT_OF_MEMORY
;

360 
	`mem˝y
(
du∂
, 
±r
, 
Àn
);

363 
d©a
->
°©e
.
ãmpwrôe
 = 
du∂
;

364 
d©a
->
°©e
.
ãmpwrôesize
 = 
Àn
;

365 
d©a
->
°©e
.
ãmpwrôëy≥
 = 
ty≥
;

368 
k
->
kìp⁄
 |
KEEP_RECV_PAUSE
;

370 
	`DEBUGF
(
	`öfof
(
d©a
, "Pausing with %zu bytes in buffer forÅype %02x\n",

371 
Àn
, 
ty≥
));

373  
CURLE_OK
;

374 
	}
}

386 
CURLcode
 
	$Cuæ_˛õ¡_wrôe
(
c⁄√˘d©a
 *
c⁄n
,

387 
ty≥
,

388 *
±r
,

389 
size_t
 
Àn
)

391 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

392 
size_t
 
wrŸe
;

394 if(0 =
Àn
)

395 
Àn
 = 
	`°æí
(
±r
);

400 if(
d©a
->
ªq
.
kìp⁄
 & 
KEEP_RECV_PAUSE
) {

401 
size_t
 
√wÀn
;

402 *
√w±r
;

403 if(
ty≥
 !
d©a
->
°©e
.
ãmpwrôëy≥
)

405  
CURLE_RECV_ERROR
;

407 
	`DEBUGASSERT
(
d©a
->
°©e
.
ãmpwrôe
);

410 
√wÀn
 = 
Àn
 + 
d©a
->
°©e
.
ãmpwrôesize
;

412 
√w±r
 = 
	`ªÆloc
(
d©a
->
°©e
.
ãmpwrôe
, 
√wÀn
);

413 if(!
√w±r
)

414  
CURLE_OUT_OF_MEMORY
;

416 
	`mem˝y
(
√w±r
 + 
d©a
->
°©e
.
ãmpwrôesize
, 
±r
, 
Àn
);

418 
d©a
->
°©e
.
ãmpwrôe
 = 
√w±r
;

419 
d©a
->
°©e
.
ãmpwrôesize
 = 
√wÀn
;

421  
CURLE_OK
;

424 if(
ty≥
 & 
CLIENTWRITE_BODY
) {

425 if((
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&
PROTO_FAMILY_FTP
) &&

426 
c⁄n
->
¥Ÿo
.
·pc
.
å™s„πy≥
 == 'A') {

428 
CURLcode
 
rc
 = 
	`Cuæ_c⁄vît_‰om_√tw‹k
(
d©a
, 
±r
, 
Àn
);

430 if(
rc
)

431  
rc
;

433 #ifde‡
CURL_DO_LINEEND_CONV


435 
Àn
 = 
	`c⁄vît_löìnds
(
d©a
, 
±r
,Üen);

440 if(
Àn
) {

441 
wrŸe
 = 
d©a
->
£t
.
	`fwrôe_func
(
±r
, 1, 
Àn
, d©a->£t.
out
);

444 
wrŸe
 = 
Àn
;

447 if(
CURL_WRITEFUNC_PAUSE
 =
wrŸe
) {

448 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_NONETWORK
) {

452 
	`Áûf
(
d©a
, "Write callbackásked for PAUSE whenÇot supported!");

453  
CURLE_WRITE_ERROR
;

456  
	`∑u£wrôe
(
d©a
, 
ty≥
, 
±r
, 
Àn
);

458 if(
wrŸe
 !
Àn
) {

459 
	`Áûf
(
d©a
, "Faûed wrôög body (%zu !%zu)", 
wrŸe
, 
Àn
);

460  
CURLE_WRITE_ERROR
;

464 if((
ty≥
 & 
CLIENTWRITE_HEADER
) &&

465 (
d©a
->
£t
.
fwrôe_hódî
 || d©a->£t.
wrôehódî
) ) {

470 
cuæ_wrôe_ˇŒback
 
wrôeô
=

471 
d©a
->
£t
.
fwrôe_hódî
?d©a->£t.fwrôe_hódî:d©a->£t.
fwrôe_func
;

476 
wrŸe
 = 
	`wrôeô
(
±r
, 1, 
Àn
, 
d©a
->
£t
.
wrôehódî
);

477 if(
CURL_WRITEFUNC_PAUSE
 =
wrŸe
)

481  
	`∑u£wrôe
(
d©a
, 
CLIENTWRITE_HEADER
, 
±r
, 
Àn
);

483 if(
wrŸe
 !
Àn
) {

484 
	`Áûf
 (
d©a
, "Failed writing header");

485  
CURLE_WRITE_ERROR
;

489  
CURLE_OK
;

490 
	}
}

492 
CURLcode
 
	$Cuæ_ªad_∂aö
(
cuæ_sockë_t
 
sockfd
,

493 *
buf
,

494 
size_t
 
byãs‰omsockë
,

495 
ssize_t
 *
n
)

497 
ssize_t
 
ƒód
 = 
	`§ód
(
sockfd
, 
buf
, 
byãs‰omsockë
);

499 if(-1 =
ƒód
) {

500 
îr
 = 
SOCKERRNO
;

501 #ifde‡
USE_WINSOCK


502 if(
WSAEWOULDBLOCK
 =
îr
)

504 if((
EWOULDBLOCK
 =
îr
Ë|| (
EAGAIN
 =îrË|| (
EINTR
 ==Érr))

506  
CURLE_AGAIN
;

508  
CURLE_RECV_ERROR
;

512 *
n
 = 
ƒód
;

513  
CURLE_OK
;

514 
	}
}

522 
CURLcode
 
	$Cuæ_ªad
(
c⁄√˘d©a
 *
c⁄n
,

523 
cuæ_sockë_t
 
sockfd
,

524 *
buf
,

525 
size_t
 
sizîeque°ed
,

526 
ssize_t
 *
n
)

528 
CURLcode
 
cuæcode
 = 
CURLE_RECV_ERROR
;

529 
ssize_t
 
ƒód
 = 0;

530 
size_t
 
byãs‰omsockë
 = 0;

531 *
buf„πofûl
 = 
NULL
;

532 
boﬁ
 
pùñöög
 = 
	`Cuæ_mu…i_pùñöe_íabÀd
(
c⁄n
->
d©a
->
mu…i
);

537 
num
 = (
sockfd
 =
c⁄n
->
sock
[
SECONDARYSOCKET
]);

539 *
n
=0;

542 if(
pùñöög
) {

543 
size_t
 
byã°oc›y
 = 
	`CURLMIN
(
c⁄n
->
buf_Àn
 - c⁄n->
ªad_pos
,

544 
sizîeque°ed
);

547 if(
byã°oc›y
 > 0) {

548 
	`mem˝y
(
buf
, 
c⁄n
->
ma°î_buf„r
 + c⁄n->
ªad_pos
, 
byã°oc›y
);

549 
c⁄n
->
ªad_pos
 +
byã°oc›y
;

550 
c⁄n
->
bôs
.
°ªam_was_ªwound
 = 
FALSE
;

552 *
n
 = (
ssize_t
)
byã°oc›y
;

553  
CURLE_OK
;

557 
byãs‰omsockë
 = 
	`CURLMIN
(
sizîeque°ed
, 
BUFSIZE
 *  ());

558 
buf„πofûl
 = 
c⁄n
->
ma°î_buf„r
;

561 
byãs‰omsockë
 = 
	`CURLMIN
(()
sizîeque°ed
,

562 
c⁄n
->
d©a
->
£t
.
buf„r_size
 ?

563 
c⁄n
->
d©a
->
£t
.
buf„r_size
 : 
BUFSIZE
);

564 
buf„πofûl
 = 
buf
;

567 
ƒód
 = 
c⁄n
->
ªcv
[
num
](c⁄n,Çum, 
buf„πofûl
, 
byãs‰omsockë
, &
cuæcode
);

568 if(
ƒód
 < 0)

569  
cuæcode
;

571 if(
pùñöög
) {

572 
	`mem˝y
(
buf
, 
c⁄n
->
ma°î_buf„r
, 
ƒód
);

573 
c⁄n
->
buf_Àn
 = 
ƒód
;

574 
c⁄n
->
ªad_pos
 = 
ƒód
;

577 *
n
 +
ƒód
;

579  
CURLE_OK
;

580 
	}
}

583 
	$showô
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_öfŸy≥
 
ty≥
,

584 *
±r
, 
size_t
 
size
)

586 c⁄° 
s_öfŸy≥
[
CURLINFO_END
][3] = {

589 #ifde‡
CURL_DOES_CONVERSIONS


590 
buf
[
BUFSIZE
+1];

591 
size_t
 
c⁄v_size
 = 0;

593 
ty≥
) {

594 
CURLINFO_HEADER_OUT
:

597 if(
size
 > 
BUFSIZE
) {

598 
size
 = 
BUFSIZE
;

599 
buf
[
BUFSIZE
] = '\0';

601 
c⁄v_size
 = 
size
;

602 
	`mem˝y
(
buf
, 
±r
, 
size
);

607 if(
size
 > 4) {

608 
size_t
 
i
;

609 
i
 = 0; i < 
size
-4; i++) {

610 if(
	`memcmp
(&
buf
[
i
], "\x0d\x0a\x0d\x0a", 4) == 0) {

612 
c⁄v_size
 = 
i
 + 4;

618 
	`Cuæ_c⁄vît_‰om_√tw‹k
(
d©a
, 
buf
, 
c⁄v_size
);

621 
±r
 = 
buf
;

629 if(
d©a
->
£t
.
fdebug
)

630  (*
d©a
->
£t
.
fdebug
)(d©a, 
ty≥
, 
±r
, 
size
,

631 
d©a
->
£t
.
debugd©a
);

633 
ty≥
) {

634 
CURLINFO_TEXT
:

635 
CURLINFO_HEADER_OUT
:

636 
CURLINFO_HEADER_IN
:

637 
	`fwrôe
(
s_öfŸy≥
[
ty≥
], 2, 1, 
d©a
->
£t
.
îr
);

638 
	`fwrôe
(
±r
, 
size
, 1, 
d©a
->
£t
.
îr
);

639 #ifde‡
CURL_DOES_CONVERSIONS


640 if(
size
 !
c⁄v_size
) {

642 
	`fwrôe
("\n", 1, 1, 
d©a
->
£t
.
îr
);

650 
	}
}

652 
	$Cuæ_debug
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_öfŸy≥
 
ty≥
,

653 *
±r
, 
size_t
 
size
,

654 
c⁄√˘d©a
 *
c⁄n
)

656 
rc
;

657 if(
d©a
->
£t
.
¥ötho°
 && 
c⁄n
 && c⁄n->
ho°
.
di•«me
) {

658 
buf„r
[160];

659 c⁄° *
t
=
NULL
;

660 c⁄° *
w
="Data";

661 
ty≥
) {

662 
CURLINFO_HEADER_IN
:

663 
w
 = "Header";

664 
CURLINFO_DATA_IN
:

665 
t
 = "from";

667 
CURLINFO_HEADER_OUT
:

668 
w
 = "Header";

669 
CURLINFO_DATA_OUT
:

670 
t
 = "to";

676 if(
t
) {

677 
	`¢¥ötf
(
buf„r
, (buf„r), "[%†%†%s]", 
w
, 
t
,

678 
c⁄n
->
ho°
.
di•«me
);

679 
rc
 = 
	`showô
(
d©a
, 
CURLINFO_TEXT
, 
buf„r
, 
	`°æí
(buffer));

680 if(
rc
)

681  
rc
;

684 
rc
 = 
	`showô
(
d©a
, 
ty≥
, 
±r
, 
size
);

685  
rc
;

686 
	}
}

	@lib/sendf.h

1 #i‚de‡
HEADER_CURL_SENDF_H


2 
	#HEADER_CURL_SENDF_H


	)

25 
	~"cuæ_£tup.h
"

27 
CURLcode
 
Cuæ_£ndf
(
cuæ_sockë_t
 
sockfd
, 
c⁄√˘d©a
 *,

28 c⁄° *
fmt
, ...);

29 
Cuæ_öfof
(
Sessi⁄H™dÀ
 *, c⁄° *
fmt
, ...);

30 
Cuæ_Áûf
(
Sessi⁄H™dÀ
 *, c⁄° *
fmt
, ...);

32 #i‡
deföed
(
CURL_DISABLE_VERBOSE_STRINGS
)

34 #i‡
deföed
(
HAVE_VARIADIC_MACROS_C99
)

35 
	#öfof
(...Ë
Cuæ_n›_°mt


	)

36 #ñi‡
deföed
(
HAVE_VARIADIC_MACROS_GCC
)

37 
	#öfof
(
x
...Ë
Cuæ_n›_°mt


	)

39 
	#öfof
 ()

	)

44 
	#öfof
 
Cuæ_öfof


	)

48 
	#Áûf
 
Cuæ_Áûf


	)

50 
	#CLIENTWRITE_BODY
 (1<<0)

	)

51 
	#CLIENTWRITE_HEADER
 (1<<1)

	)

52 
	#CLIENTWRITE_BOTH
 (
CLIENTWRITE_BODY
|
CLIENTWRITE_HEADER
)

	)

54 
CURLcode
 
Cuæ_˛õ¡_wrôe
(
c⁄√˘d©a
 *
c⁄n
, 
ty≥
, *
±r
,

55 
size_t
 
Àn
);

58 
CURLcode
 
Cuæ_ªad_∂aö
(
cuæ_sockë_t
 
sockfd
,

59 *
buf
,

60 
size_t
 
byãs‰omsockë
,

61 
ssize_t
 *
n
);

63 
ssize_t
 
Cuæ_ªcv_∂aö
(
c⁄√˘d©a
 *
c⁄n
, 
num
, *
buf
,

64 
size_t
 
Àn
, 
CURLcode
 *
code
);

65 
ssize_t
 
Cuæ_£nd_∂aö
(
c⁄√˘d©a
 *
c⁄n
, 
num
,

66 c⁄° *
mem
, 
size_t
 
Àn
, 
CURLcode
 *
code
);

69 
CURLcode
 
Cuæ_ªad
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 
sockfd
,

70 *
buf
, 
size_t
 
buf„rsize
,

71 
ssize_t
 *
n
);

73 
CURLcode
 
Cuæ_wrôe
(
c⁄√˘d©a
 *
c⁄n
,

74 
cuæ_sockë_t
 
sockfd
,

75 c⁄° *
mem
, 
size_t
 
Àn
,

76 
ssize_t
 *
wrôãn
);

79 
CURLcode
 
Cuæ_wrôe_∂aö
(
c⁄√˘d©a
 *
c⁄n
,

80 
cuæ_sockë_t
 
sockfd
,

81 c⁄° *
mem
, 
size_t
 
Àn
,

82 
ssize_t
 *
wrôãn
);

85 
Cuæ_debug
(
Sessi⁄H™dÀ
 *
h™dÀ
, 
cuæ_öfŸy≥
 
ty≥
,

86 *
d©a
, 
size_t
 
size
,

87 
c⁄√˘d©a
 *
c⁄n
);

	@lib/setup-os400.h

1 #i‚de‡
HEADER_CURL_SETUP_OS400_H


2 
	#HEADER_CURL_SETUP_OS400_H


	)

27 
	#NI_MAXHOST
 1025

	)

30 
	#NI_MAXSERV
 32

	)

33 
	tu_öt32_t
;

38 
	~<sys/sockë.h
>

39 
	~<√tdb.h
>

40 
	~<qsos¶.h
>

41 
	~<gsks¶.h
>

42 
	~<qsﬂsync.h
>

43 
	~<gsßpi.h
>

45 
Cuæ_gëaddröfo_a
(c⁄° * 
nodíame
,

46 c⁄° * 
£rv«me
,

47 c⁄° 
addröfo
 * 
höts
,

48 
addröfo
 * * 
ªs
);

49 
	#gëaddröfo
 
Cuæ_gëaddröfo_a


	)

52 
Cuæ_gë«meöfo_a
(c⁄° 
sockaddr
 * 
ß
,

53 
cuæ_sockÀn_t
 
ßÀn
,

54 * 
nodíame
, 
cuæ_sockÀn_t
 
nodíamñí
,

55 * 
£rv«me
, 
cuæ_sockÀn_t
 
£rv«mñí
,

56 
Êags
);

57 
	#gë«meöfo
 
Cuæ_gë«meöfo_a


	)

62 
Cuæ_SSL_Inô_Aµliˇti⁄_a
(
SSLInôAµ
 * 
öô_≠p
);

63 
	#SSL_Inô_Aµliˇti⁄
 
Cuæ_SSL_Inô_Aµliˇti⁄_a


	)

66 
Cuæ_SSL_Inô_a
(
SSLInô
 * 
öô
);

67 
	#SSL_Inô
 
Cuæ_SSL_Inô_a


	)

70 * 
Cuæ_SSL_Såîr‹_a
(
s¶ªtu∫vÆue
,

71 
SSLEº‹Msg
 * 
£ºmsgp
);

72 
	#SSL_Såîr‹
 
Cuæ_SSL_Såîr‹_a


	)

77 
Cuæ_gsk_ívú⁄mít_›í
(
gsk_h™dÀ
 * 
my_ív_h™dÀ
);

78 
	#gsk_ívú⁄mít_›í
 
Cuæ_gsk_ívú⁄mít_›í


	)

80 
Cuæ_gsk_£cuª_soc_›í
(
gsk_h™dÀ
 
my_ív_h™dÀ
,

81 
gsk_h™dÀ
 * 
my_£ssi⁄_h™dÀ
);

82 
	#gsk_£cuª_soc_›í
 
Cuæ_gsk_£cuª_soc_›í


	)

84 
Cuæ_gsk_ívú⁄mít_˛o£
(
gsk_h™dÀ
 * 
my_ív_h™dÀ
);

85 
	#gsk_ívú⁄mít_˛o£
 
Cuæ_gsk_ívú⁄mít_˛o£


	)

87 
Cuæ_gsk_£cuª_soc_˛o£
(
gsk_h™dÀ
 * 
my_£ssi⁄_h™dÀ
);

88 
	#gsk_£cuª_soc_˛o£
 
Cuæ_gsk_£cuª_soc_˛o£


	)

90 
Cuæ_gsk_ívú⁄mít_öô
(
gsk_h™dÀ
 
my_ív_h™dÀ
);

91 
	#gsk_ívú⁄mít_öô
 
Cuæ_gsk_ívú⁄mít_öô


	)

93 
Cuæ_gsk_£cuª_soc_öô
(
gsk_h™dÀ
 
my_£ssi⁄_h™dÀ
);

94 
	#gsk_£cuª_soc_öô
 
Cuæ_gsk_£cuª_soc_öô


	)

96 
Cuæ_gsk_©åibuã_£t_buf„r_a
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

97 
GSK_BUF_ID
 
bufID
,

98 c⁄° * 
buf„r
,

99 
bufSize
);

100 
	#gsk_©åibuã_£t_buf„r
 
Cuæ_gsk_©åibuã_£t_buf„r_a


	)

102 
Cuæ_gsk_©åibuã_£t_íum
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

103 
GSK_ENUM_ID
 
íumID
,

104 
GSK_ENUM_VALUE
 
íumVÆue
);

105 
	#gsk_©åibuã_£t_íum
 
Cuæ_gsk_©åibuã_£t_íum


	)

107 
Cuæ_gsk_©åibuã_£t_numîic_vÆue
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

108 
GSK_NUM_ID
 
numID
,

109 
numVÆue
);

110 
	#gsk_©åibuã_£t_numîic_vÆue
 
Cuæ_gsk_©åibuã_£t_numîic_vÆue


	)

112 
Cuæ_gsk_©åibuã_£t_ˇŒback
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

113 
GSK_CALLBACK_ID
 
ˇŒBackID
,

114 * 
ˇŒBackAªaPå
);

115 
	#gsk_©åibuã_£t_ˇŒback
 
Cuæ_gsk_©åibuã_£t_ˇŒback


	)

117 
Cuæ_gsk_©åibuã_gë_buf„r_a
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

118 
GSK_BUF_ID
 
bufID
,

119 c⁄° * * 
buf„r
,

120 * 
bufSize
);

121 
	#gsk_©åibuã_gë_buf„r
 
Cuæ_gsk_©åibuã_gë_buf„r_a


	)

123 
Cuæ_gsk_©åibuã_gë_íum
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

124 
GSK_ENUM_ID
 
íumID
,

125 
GSK_ENUM_VALUE
 * 
íumVÆue
);

126 
	#gsk_©åibuã_gë_íum
 
Cuæ_gsk_©åibuã_gë_íum


	)

128 
Cuæ_gsk_©åibuã_gë_numîic_vÆue
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

129 
GSK_NUM_ID
 
numID
,

130 * 
numVÆue
);

131 
	#gsk_©åibuã_gë_numîic_vÆue
 
Cuæ_gsk_©åibuã_gë_numîic_vÆue


	)

133 
Cuæ_gsk_©åibuã_gë_˚π_öfo
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

134 
GSK_CERT_ID
 
˚πID
,

135 c⁄° 
gsk_˚π_d©a_ñem
 * * 
˚πD©aEÀm
,

136 * 
˚πD©aEÀmítCou¡
);

137 
	#gsk_©åibuã_gë_˚π_öfo
 
Cuæ_gsk_©åibuã_gë_˚π_öfo


	)

139 
Cuæ_gsk_£cuª_soc_misc
(
gsk_h™dÀ
 
my_£ssi⁄_h™dÀ
,

140 
GSK_MISC_ID
 
miscID
);

141 
	#gsk_£cuª_soc_misc
 
Cuæ_gsk_£cuª_soc_misc


	)

143 
Cuæ_gsk_£cuª_soc_ªad
(
gsk_h™dÀ
 
my_£ssi⁄_h™dÀ
,

144 * 
ªadBuf„r
,

145 
ªadBufSize
, * 
amtRód
);

146 
	#gsk_£cuª_soc_ªad
 
Cuæ_gsk_£cuª_soc_ªad


	)

148 
Cuæ_gsk_£cuª_soc_wrôe
(
gsk_h™dÀ
 
my_£ssi⁄_h™dÀ
,

149 * 
wrôeBuf„r
,

150 
wrôeBufSize
, * 
amtWrôãn
);

151 
	#gsk_£cuª_soc_wrôe
 
Cuæ_gsk_£cuª_soc_wrôe


	)

153 c⁄° * 
Cuæ_gsk_°ªº‹_a
(
gsk_ªtu∫_vÆue
);

154 
	#gsk_°ªº‹
 
Cuæ_gsk_°ªº‹_a


	)

156 
Cuæ_gsk_£cuª_soc_°¨tInô
(
gsk_h™dÀ
 
my_£ssi⁄_h™dÀ
,

157 
IOCom∂ëi⁄P‹t
,

158 
Qso_OvîœµedIO_t
 * 
communiˇti⁄sAªa
);

159 
	#gsk_£cuª_soc_°¨tInô
 
Cuæ_gsk_£cuª_soc_°¨tInô


	)

164 
OM_uöt32
 
Cuæ_gss_imp‹t_«me_a
(OM_uöt32 * 
mö‹_°©us
,

165 
gss_buf„r_t
 
ö_«me
,

166 
gss_OID
 
ö_«me_ty≥
,

167 
gss_«me_t
 * 
out_«me
);

168 
	#gss_imp‹t_«me
 
Cuæ_gss_imp‹t_«me_a


	)

171 
OM_uöt32
 
Cuæ_gss_di•œy_°©us_a
(OM_uöt32 * 
mö‹_°©us
,

172 
OM_uöt32
 
°©us_vÆue
,

173 
°©us_ty≥
, 
gss_OID
 
mech_ty≥
,

174 
gss_msg_˘x_t
 * 
mesßge_c⁄ãxt
,

175 
gss_buf„r_t
 
°©us_°rög
);

176 
	#gss_di•œy_°©us
 
Cuæ_gss_di•œy_°©us_a


	)

179 
OM_uöt32
 
Cuæ_gss_öô_£c_c⁄ãxt_a
(OM_uöt32 * 
mö‹_°©us
,

180 
gss_¸ed_id_t
 
¸ed_h™dÀ
,

181 
gss_˘x_id_t
 * 
c⁄ãxt_h™dÀ
,

182 
gss_«me_t
 
èrgë_«me
,

183 
gss_OID
 
mech_ty≥
,

184 
gss_Êags_t
 
ªq_Êags
,

185 
OM_uöt32
 
time_ªq
,

186 
gss_ch™√l_bödögs_t


187 
öput_ch™_bödögs
,

188 
gss_buf„r_t
 
öput_tokí
,

189 
gss_OID
 * 
a˘uÆ_mech_ty≥
,

190 
gss_buf„r_t
 
ouçut_tokí
,

191 
gss_Êags_t
 * 
ªt_Êags
,

192 
OM_uöt32
 * 
time_ªc
);

193 
	#gss_öô_£c_c⁄ãxt
 
Cuæ_gss_öô_£c_c⁄ãxt_a


	)

196 
OM_uöt32
 
Cuæ_gss_dñëe_£c_c⁄ãxt_a
(OM_uöt32 * 
mö‹_°©us
,

197 
gss_˘x_id_t
 * 
c⁄ãxt_h™dÀ
,

198 
gss_buf„r_t
 
ouçut_tokí
);

199 
	#gss_dñëe_£c_c⁄ãxt
 
Cuæ_gss_dñëe_£c_c⁄ãxt_a


	)

204 
	#BîVÆue
 
bîvÆ


	)

206 
	#ld≠_uæ_∑r£
 
ld≠_uæ_∑r£_utf8


	)

207 
	#ld≠_öô
 
Cuæ_ld≠_öô_a


	)

208 
	#ld≠_sim∂e_böd_s
 
Cuæ_ld≠_sim∂e_böd_s_a


	)

209 
	#ld≠_£¨ch_s
 
Cuæ_ld≠_£¨ch_s_a


	)

210 
	#ld≠_gë_vÆues_Àn
 
Cuæ_ld≠_gë_vÆues_Àn_a


	)

211 
	#ld≠_îr2°rög
 
Cuæ_ld≠_îr2°rög_a


	)

212 
	#ld≠_gë_dn
 
Cuæ_ld≠_gë_dn_a


	)

213 
	#ld≠_fú°_©åibuã
 
Cuæ_ld≠_fú°_©åibuã_a


	)

214 
	#ld≠_√xt_©åibuã
 
Cuæ_ld≠_√xt_©åibuã_a


	)

219 
Cuæ_os400_c⁄√˘
(
sd
, 
sockaddr
 * 
de°addr
, 
addæí
);

220 
Cuæ_os400_böd
(
sd
, 
sockaddr
 * 
loˇœddr
, 
addæí
);

221 
Cuæ_os400_£ndto
(
sd
, * 
buf„r
, 
buÊí
, 
Êags
,

222 
sockaddr
 * 
d°addr
, 
addæí
);

223 
Cuæ_os400_ªcv‰om
(
sd
, * 
buf„r
, 
buÊí
, 
Êags
,

224 
sockaddr
 * 
‰omaddr
, * 
addæí
);

226 
	#c⁄√˘
 
Cuæ_os400_c⁄√˘


	)

227 
	#böd
 
Cuæ_os400_böd


	)

228 
	#£ndto
 
Cuæ_os400_£ndto


	)

229 
	#ªcv‰om
 
Cuæ_os400_ªcv‰om


	)

231 #ifde‡
HAVE_LIBZ


232 
	#zlibVîsi⁄
 
Cuæ_os400_zlibVîsi⁄


	)

233 
	#öÊ©eInô_
 
Cuæ_os400_öÊ©eInô_


	)

234 
	#öÊ©eInô2_
 
Cuæ_os400_öÊ©eInô2_


	)

235 
	#öÊ©e
 
Cuæ_os400_öÊ©e


	)

236 
	#öÊ©eEnd
 
Cuæ_os400_öÊ©eEnd


	)

	@lib/setup-vms.h

1 #i‚de‡
HEADER_CURL_SETUP_VMS_H


2 
	#HEADER_CURL_SETUP_VMS_H


	)

31 #ifde‡
__DECC


32 #¥agm®
mesßge
 
ßve


33 #¥agm®
mesßge
 
dißbÀ
 
dﬁœrid


37 
	#gëív
 
decc_gëív


	)

38 #ifde‡
__DECC


39 #i‡
__INITIAL_POINTER_SIZE
 != 64

40 
	#gëpwuid
 
decc_gëpwuid


	)

43 
	~<°dlib.h
>

44 * 
decc$gëív
(c⁄° * 
__«me
);

45 
	~<pwd.h
>

47 
	~<°rög.h
>

48 
	~<unixlib.h
>

50 #unde‡
gëív


51 #unde‡
gëpwuid


52 
	#gëív
 
vms_gëív


	)

53 
	#gëpwuid
 
vms_gëpwuid


	)

56 
	#sys$assign
 
SYS$ASSIGN


	)

57 
	#sys$dassgn
 
SYS$DASSGN


	)

58 
	#sys$qiow
 
SYS$QIOW


	)

60 #ifde‡
__DECC


61 #i‡
__INITIAL_POINTER_SIZE


62 #¥agm®
__poöãr_size
 
__ßve


66 #i‡
__USE_LONG_GID_T


67 
	#decc_gëpwuid
 
DECC$__LONG_GID_GETPWUID


	)

69 #i‡
__INITIAL_POINTER_SIZE


70 
	#decc_gëpwuid
 
decc$__32_gëpwuid


	)

72 
	#decc_gëpwuid
 
decc$gëpwuid


	)

76 
∑sswd
 * 
decc_gëpwuid
(
uid_t
 
uid
);

78 #ifde‡
__DECC


79 #i‡
__INITIAL_POINTER_SIZE
 == 32

82 * 
	$vms_å™¶©e_∑th
(c⁄° * 
∑th
) {

83 * 
unix_∑th
;

84 * 
ã°_°r
;

88 
ã°_°r
 = 
	`°Ωbrk
(
∑th
, ":[<^");

89 if(
ã°_°r
 =
NULL
) {

90  (*)
∑th
;

93 
unix_∑th
 = 
	`decc$å™¶©e_vms
(
∑th
);

95 if(()
unix_∑th
 <= 0) {

97  (*)
∑th
;

99 
	}
}

104 
	#vms_å™¶©e_∑th
(
__∑th
Ë
	)
__path

108 #ifde‡
__DECC


109 #i‡
__INITIAL_POINTER_SIZE


110 #¥agm®
__poöãr_size
 
__ª°‹e


114 * 
	$vms_gëív
(c⁄° * 
ívv¨
) {

116 * 
ªsu…
;

117 * 
vms_∑th
;

120 
ªsu…
 = 
	`decc$gëív
(
ívv¨
);

121 if(
ªsu…
 =
NULL
) {

122  
ªsu…
;

125 
vms_∑th
 = 
ªsu…
;

126 
ªsu…
 = 
	`vms_å™¶©e_∑th
(
vms_∑th
);

134  
ªsu…
;

135 
	}
}

138 
∑sswd
 
	gvms_∑sswd_ˇche
;

140 
∑sswd
 * 
	$vms_gëpwuid
(
uid_t
 
uid
) {

142 
∑sswd
 * 
my_∑sswd
;

145 #ifde‡
__DECC


146 #i‡
__INITIAL_POINTER_SIZE


147 
__ch¨_±r32
 
unix_∑th
;

149 * 
unix_∑th
;

152 * 
unix_∑th
;

155 
my_∑sswd
 = 
	`decc_gëpwuid
(
uid
);

156 if(
my_∑sswd
 =
NULL
) {

157  
my_∑sswd
;

160 
unix_∑th
 = 
	`vms_å™¶©e_∑th
(
my_∑sswd
->
pw_dú
);

162 if(()
unix_∑th
 <= 0) {

164  
my_∑sswd
;

168 if(
unix_∑th
 =
my_∑sswd
->
pw_dú
) {

169  
my_∑sswd
;

175 
vms_∑sswd_ˇche
.
pw_«me
 = 
my_∑sswd
->pw_name;

176 
vms_∑sswd_ˇche
.
pw_uid
 = 
my_∑sswd
->pw_uid;

177 
vms_∑sswd_ˇche
.
pw_gid
 = 
my_∑sswd
->
pw_uid
;

178 
vms_∑sswd_ˇche
.
pw_dú
 = 
unix_∑th
;

179 
vms_∑sswd_ˇche
.
pw_shñl
 = 
my_∑sswd
->pw_shell;

181  &
vms_∑sswd_ˇche
;

182 
	}
}

184 #ifde‡
__DECC


185 #¥agm®
mesßge
 
ª°‹e


191 
	#ASN1_INTEGER_gë
 
ASN1_INTEGER_GET


	)

192 
	#ASN1_STRING_d©a
 
ASN1_STRING_DATA


	)

193 
	#ASN1_STRING_Àngth
 
ASN1_STRING_LENGTH


	)

194 
	#ASN1_STRING_¥öt
 
ASN1_STRING_PRINT


	)

195 
	#ASN1_STRING_to_UTF8
 
ASN1_STRING_TO_UTF8


	)

196 
	#ASN1_STRING_ty≥
 
ASN1_STRING_TYPE


	)

197 
	#BIO_˘æ
 
BIO_CTRL


	)

198 
	#BIO_‰ì
 
BIO_FREE


	)

199 
	#BIO_√w
 
BIO_NEW


	)

200 
	#BIO_s_mem
 
BIO_S_MEM


	)

201 
	#BN_bn2bö
 
BN_BN2BIN


	)

202 
	#BN_num_bôs
 
BN_NUM_BITS


	)

203 
	#CRYPTO_˛ónup_Æl_ex_d©a
 
CRYPTO_CLEANUP_ALL_EX_DATA


	)

204 
	#CRYPTO_‰ì
 
CRYPTO_FREE


	)

205 
	#CRYPTO_mÆloc
 
CRYPTO_MALLOC


	)

206 
	#DES_ecb_í¸y±
 
DES_ECB_ENCRYPT


	)

207 
	#DES_£t_key
 
DES_SET_KEY


	)

208 
	#DES_£t_odd_∑rôy
 
DES_SET_ODD_PARITY


	)

209 
	#ENGINE_˘æ
 
ENGINE_CTRL


	)

210 
	#ENGINE_˘æ_cmd
 
ENGINE_CTRL_CMD


	)

211 
	#ENGINE_föish
 
ENGINE_FINISH


	)

212 
	#ENGINE_‰ì
 
ENGINE_FREE


	)

213 
	#ENGINE_gë_fú°
 
ENGINE_GET_FIRST


	)

214 
	#ENGINE_gë_id
 
ENGINE_GET_ID


	)

215 
	#ENGINE_gë_√xt
 
ENGINE_GET_NEXT


	)

216 
	#ENGINE_öô
 
ENGINE_INIT


	)

217 
	#ENGINE_lﬂd_buûtö_ígöes
 
ENGINE_LOAD_BUILTIN_ENGINES


	)

218 
	#ENGINE_lﬂd_¥iv©e_key
 
ENGINE_LOAD_PRIVATE_KEY


	)

219 
	#ENGINE_£t_deÁu…
 
ENGINE_SET_DEFAULT


	)

220 
	#ERR_˛ór_îr‹
 
ERR_CLEAR_ERROR


	)

221 
	#ERR_îr‹_°rög
 
ERR_ERROR_STRING


	)

222 
	#ERR_îr‹_°rög_n
 
ERR_ERROR_STRING_N


	)

223 
	#ERR_‰ì_°rögs
 
ERR_FREE_STRINGS


	)

224 
	#ERR_gë_îr‹
 
ERR_GET_ERROR


	)

225 
	#ERR_≥ek_îr‹
 
ERR_PEEK_ERROR


	)

226 
	#ERR_ªmove_°©e
 
ERR_REMOVE_STATE


	)

227 
	#EVP_PKEY_c›y_∑ømëîs
 
EVP_PKEY_COPY_PARAMETERS


	)

228 
	#EVP_PKEY_‰ì
 
EVP_PKEY_FREE


	)

229 
	#EVP_˛ónup
 
EVP_CLEANUP


	)

230 
	#GENERAL_NAMES_‰ì
 
GENERAL_NAMES_FREE


	)

231 
	#MD4_FöÆ
 
MD4_FINAL


	)

232 
	#MD4_Inô
 
MD4_INIT


	)

233 
	#MD4_Upd©e
 
MD4_UPDATE


	)

234 
	#MD5_FöÆ
 
MD5_FINAL


	)

235 
	#MD5_Inô
 
MD5_INIT


	)

236 
	#MD5_Upd©e
 
MD5_UPDATE


	)

237 
	#OPENSSL_add_Æl_Ægo_noc⁄f
 
OPENSSL_ADD_ALL_ALGO_NOCONF


	)

238 
	#PEM_ªad_X509
 
PEM_READ_X509


	)

239 
	#PEM_wrôe_bio_X509
 
PEM_WRITE_BIO_X509


	)

240 
	#PKCS12_PBE_add
 
PKCS12_PBE_ADD


	)

241 
	#PKCS12_‰ì
 
PKCS12_FREE


	)

242 
	#PKCS12_∑r£
 
PKCS12_PARSE


	)

243 
	#RAND_add
 
RAND_ADD


	)

244 
	#RAND_byãs
 
RAND_BYTES


	)

245 
	#RAND_egd
 
RAND_EGD


	)

246 
	#RAND_fûe_«me
 
RAND_FILE_NAME


	)

247 
	#RAND_lﬂd_fûe
 
RAND_LOAD_FILE


	)

248 
	#RAND_°©us
 
RAND_STATUS


	)

249 
	#SSL_CIPHER_gë_«me
 
SSL_CIPHER_GET_NAME


	)

250 
	#SSL_CTX_add_˛õ¡_CA
 
SSL_CTX_ADD_CLIENT_CA


	)

251 
	#SSL_CTX_ˇŒback_˘æ
 
SSL_CTX_CALLBACK_CTRL


	)

252 
	#SSL_CTX_check_¥iv©e_key
 
SSL_CTX_CHECK_PRIVATE_KEY


	)

253 
	#SSL_CTX_˘æ
 
SSL_CTX_CTRL


	)

254 
	#SSL_CTX_‰ì
 
SSL_CTX_FREE


	)

255 
	#SSL_CTX_gë_˚π_°‹e
 
SSL_CTX_GET_CERT_STORE


	)

256 
	#SSL_CTX_lﬂd_vîify_loˇti⁄s
 
SSL_CTX_LOAD_VERIFY_LOCATIONS


	)

257 
	#SSL_CTX_√w
 
SSL_CTX_NEW


	)

258 
	#SSL_CTX_£t_cùhî_li°
 
SSL_CTX_SET_CIPHER_LIST


	)

259 
	#SSL_CTX_£t_def_∑sswd_cb_ud
 
SSL_CTX_SET_DEF_PASSWD_CB_UD


	)

260 
	#SSL_CTX_£t_deÁu…_∑sswd_cb
 
SSL_CTX_SET_DEFAULT_PASSWD_CB


	)

261 
	#SSL_CTX_£t_vîify
 
SSL_CTX_SET_VERIFY


	)

262 
	#SSL_CTX_u£_Priv©eKey
 
SSL_CTX_USE_PRIVATEKEY


	)

263 
	#SSL_CTX_u£_Priv©eKey_fûe
 
SSL_CTX_USE_PRIVATEKEY_FILE


	)

264 
	#SSL_CTX_u£_˚π_chaö_fûe
 
SSL_CTX_USE_CERT_CHAIN_FILE


	)

265 
	#SSL_CTX_u£_˚πifiˇã
 
SSL_CTX_USE_CERTIFICATE


	)

266 
	#SSL_CTX_u£_˚πifiˇã_fûe
 
SSL_CTX_USE_CERTIFICATE_FILE


	)

267 
	#SSL_SESSION_‰ì
 
SSL_SESSION_FREE


	)

268 
	#SSL_c⁄√˘
 
SSL_CONNECT


	)

269 
	#SSL_‰ì
 
SSL_FREE


	)

270 
	#SSL_gë1_£ssi⁄
 
SSL_GET1_SESSION


	)

271 
	#SSL_gë_˚πifiˇã
 
SSL_GET_CERTIFICATE


	)

272 
	#SSL_gë_cuºít_cùhî
 
SSL_GET_CURRENT_CIPHER


	)

273 
	#SSL_gë_îr‹
 
SSL_GET_ERROR


	)

274 
	#SSL_gë_≥î_˚π_chaö
 
SSL_GET_PEER_CERT_CHAIN


	)

275 
	#SSL_gë_≥î_˚πifiˇã
 
SSL_GET_PEER_CERTIFICATE


	)

276 
	#SSL_gë_¥iv©ekey
 
SSL_GET_PRIVATEKEY


	)

277 
	#SSL_gë_shutdown
 
SSL_GET_SHUTDOWN


	)

278 
	#SSL_gë_vîify_ªsu…
 
SSL_GET_VERIFY_RESULT


	)

279 
	#SSL_libøry_öô
 
SSL_LIBRARY_INIT


	)

280 
	#SSL_lﬂd_îr‹_°rögs
 
SSL_LOAD_ERROR_STRINGS


	)

281 
	#SSL_√w
 
SSL_NEW


	)

282 
	#SSL_≥ek
 
SSL_PEEK


	)

283 
	#SSL_≥ndög
 
SSL_PENDING


	)

284 
	#SSL_ªad
 
SSL_READ


	)

285 
	#SSL_£t_c⁄√˘_°©e
 
SSL_SET_CONNECT_STATE


	)

286 
	#SSL_£t_fd
 
SSL_SET_FD


	)

287 
	#SSL_£t_£ssi⁄
 
SSL_SET_SESSION


	)

288 
	#SSL_shutdown
 
SSL_SHUTDOWN


	)

289 
	#SSL_wrôe
 
SSL_WRITE


	)

290 
	#SSLóy
 
SSLEAY


	)

291 
	#SSLv23_˛õ¡_mëhod
 
SSLV23_CLIENT_METHOD


	)

292 
	#SSLv3_˛õ¡_mëhod
 
SSLV3_CLIENT_METHOD


	)

293 
	#TLSv1_˛õ¡_mëhod
 
TLSV1_CLIENT_METHOD


	)

294 
	#UI_O≥nSSL
 
UI_OPENSSL


	)

295 
	#X509V3_EXT_¥öt
 
X509V3_EXT_PRINT


	)

296 
	#X509_EXTENSION_gë_¸ôiˇl
 
X509_EXTENSION_GET_CRITICAL


	)

297 
	#X509_EXTENSION_gë_obje˘
 
X509_EXTENSION_GET_OBJECT


	)

298 
	#X509_LOOKUP_fûe
 
X509_LOOKUP_FILE


	)

299 
	#X509_NAME_ENTRY_gë_d©a
 
X509_NAME_ENTRY_GET_DATA


	)

300 
	#X509_NAME_gë_íåy
 
X509_NAME_GET_ENTRY


	)

301 
	#X509_NAME_gë_ödex_by_NID
 
X509_NAME_GET_INDEX_BY_NID


	)

302 
	#X509_NAME_¥öt_ex
 
X509_NAME_PRINT_EX


	)

303 
	#X509_STORE_CTX_gë_cuºít_˚π
 
X509_STORE_CTX_GET_CURRENT_CERT


	)

304 
	#X509_STORE_add_lookup
 
X509_STORE_ADD_LOOKUP


	)

305 
	#X509_STORE_£t_Êags
 
X509_STORE_SET_FLAGS


	)

306 
	#X509_check_issued
 
X509_CHECK_ISSUED


	)

307 
	#X509_‰ì
 
X509_FREE


	)

308 
	#X509_gë_ext_d2i
 
X509_GET_EXT_D2I


	)

309 
	#X509_gë_issuî_«me
 
X509_GET_ISSUER_NAME


	)

310 
	#X509_gë_pubkey
 
X509_GET_PUBKEY


	)

311 
	#X509_gë_£rülNumbî
 
X509_GET_SERIALNUMBER


	)

312 
	#X509_gë_subje˘_«me
 
X509_GET_SUBJECT_NAME


	)

313 
	#X509_lﬂd_¸l_fûe
 
X509_LOAD_CRL_FILE


	)

314 
	#X509_vîify_˚π_îr‹_°rög
 
X509_VERIFY_CERT_ERROR_STRING


	)

315 
	#d2i_PKCS12_Â
 
D2I_PKCS12_FP


	)

316 
	#i2t_ASN1_OBJECT
 
I2T_ASN1_OBJECT


	)

317 
	#sk_num
 
SK_NUM


	)

318 
	#sk_p›
 
SK_POP


	)

319 
	#sk_p›_‰ì
 
SK_POP_FREE


	)

320 
	#sk_vÆue
 
SK_VALUE


	)

322 
	#USE_UPPERCASE_GSSAPI
 1

	)

323 
	#gss_£Æ
 
GSS_SEAL


	)

324 
	#gss_un£Æ
 
GSS_UNSEAL


	)

326 
	#USE_UPPERCASE_KRBAPI
 1

	)

329 #ifde‡
HAVE_NETDB_H


330 
	~<√tdb.h
>

331 #i‚de‡
AI_NUMERICHOST


332 #ifde‡
ENABLE_IPV6


333 #unde‡
ENABLE_IPV6


339 #ifde‡
__VAX


340 
	#öÊ©e
 
INFLATE


	)

341 
	#öÊ©eEnd
 
INFLATEEND


	)

342 
	#öÊ©eInô2_
 
INFLATEINIT2_


	)

343 
	#öÊ©eInô_
 
INFLATEINIT_


	)

344 
	#zlibVîsi⁄
 
ZLIBVERSION


	)

350 #ifde‡
__VAX


352 #i‡(
OPENSSL_VERSION_NUMBER
 < 0x00907001L)

353 
	#des_£t_odd_∑rôy
 
DES_SET_ODD_PARITY


	)

354 
	#des_£t_key
 
DES_SET_KEY


	)

355 
	#des_ecb_í¸y±
 
DES_ECB_ENCRYPT


	)

358 
	~<›ís¶/evp.h
>

359 #i‚de‡
O≥nSSL_add_Æl_Æg‹ôhms


360 
	#O≥nSSL_add_Æl_Æg‹ôhms
 
OPENSSL_ADD_ALL_ALGORITHMS


	)

361 
OPENSSL_ADD_ALL_ALGORITHMS
();

366 #i‡(
OPENSSL_VERSION_NUMBER
 < 0x00907001L)

368 #unde‡
des_£t_odd_∑rôy


369 #unde‡
DES_£t_odd_∑rôy


370 #unde‡
des_£t_key


371 #unde‡
DES_£t_key


372 #unde‡
des_ecb_í¸y±


373 #unde‡
DES_ecb_í¸y±


375 
	$des_£t_odd_∑rôy
(
des_cblock
 *
key
) {

376 
	`DES_SET_ODD_PARITY
(
key
);

377 
	}
}

379 
	$des_£t_key
(
c⁄°_des_cblock
 *
key
,

380 
des_key_scheduÀ
 
scheduÀ
) {

381  
	`DES_SET_KEY
(
key
, 
scheduÀ
);

382 
	}
}

384 
	$des_ecb_í¸y±
(
c⁄°_des_cblock
 *
öput
,

385 
des_cblock
 *
ouçut
,

386 
des_key_scheduÀ
 
ks
,
íc
) {

387 
	`DES_ECB_ENCRYPT
(
öput
, 
ouçut
, 
ks
, 
íc
);

388 
	}
}

391 #i‡
OPENSSL_VERSION_NUMBER
 < 0x00907000L

392 #ifde‡
X509_STORE_£t_Êags


393 #unde‡
X509_STORE_£t_Êags


394 
	#X509_STORE_£t_Êags
(
x
,
y
Ë
Cuæ_n›_°mt


	)

	@lib/share.c

23 
	~"cuæ_£tup.h
"

25 
	~<cuæ/cuæ.h
>

26 
	~"uæd©a.h
"

27 
	~"sh¨e.h
"

28 
	~"vés/vés.h
"

29 
	~"cuæ_mem‹y.h
"

32 
	~"memdebug.h
"

34 
CURLSH
 *

35 
	$cuæ_sh¨e_öô
()

37 
Cuæ_sh¨e
 *
sh¨e
 = 
	`ˇŒoc
(1, (Curl_share));

38 if(
sh¨e
)

39 
sh¨e
->
•ecifõr
 |(1<<
CURL_LOCK_DATA_SHARE
);

41  
sh¨e
;

42 
	}
}

44 #unde‡
cuæ_sh¨e_£t›t


45 
CURLSHcode


46 
	$cuæ_sh¨e_£t›t
(
CURLSH
 *
sh
, 
CURLSH›ti⁄
 
›ti⁄
, ...)

48 
Cuæ_sh¨e
 *
sh¨e
 = (Cuæ_sh¨ê*)
sh
;

49 
va_li°
 
∑øm
;

50 
ty≥
;

51 
cuæ_lock_fun˘i⁄
 
lockfunc
;

52 
cuæ_u∆ock_fun˘i⁄
 
u∆ockfunc
;

53 *
±r
;

54 
CURLSHcode
 
ªs
 = 
CURLSHE_OK
;

56 if(
sh¨e
->
dúty
)

59  
CURLSHE_IN_USE
;

61 
	`va_°¨t
(
∑øm
, 
›ti⁄
);

63 
›ti⁄
) {

64 
CURLSHOPT_SHARE
:

66 
ty≥
 = 
	`va_¨g
(
∑øm
, );

67 
sh¨e
->
•ecifõr
 |(1<<
ty≥
);

68  
ty≥
 ) {

69 
CURL_LOCK_DATA_DNS
:

70 if(!
sh¨e
->
ho°ˇche
) {

71 
sh¨e
->
ho°ˇche
 = 
	`Cuæ_mk_dnsˇche
();

72 if(!
sh¨e
->
ho°ˇche
)

73 
ªs
 = 
CURLSHE_NOMEM
;

77 
CURL_LOCK_DATA_COOKIE
:

78 #i‡!
	`deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_COOKIES
)

79 if(!
sh¨e
->
cookõs
) {

80 
sh¨e
->
cookõs
 = 
	`Cuæ_cookõ_öô
(
NULL
, NULL, NULL, 
TRUE
 );

81 if(!
sh¨e
->
cookõs
)

82 
ªs
 = 
CURLSHE_NOMEM
;

85 
ªs
 = 
CURLSHE_NOT_BUILT_IN
;

89 
CURL_LOCK_DATA_SSL_SESSION
:

90 #ifde‡
USE_SSL


91 if(!
sh¨e
->
s¶£ssi⁄
) {

92 
sh¨e
->
max_s¶_£ssi⁄s
 = 8;

93 
sh¨e
->
s¶£ssi⁄
 = 
	`ˇŒoc
(sh¨e->
max_s¶_£ssi⁄s
,

94 (
cuæ_s¶_£ssi⁄
));

95 
sh¨e
->
£ssi⁄age
 = 0;

96 if(!
sh¨e
->
s¶£ssi⁄
)

97 
ªs
 = 
CURLSHE_NOMEM
;

100 
ªs
 = 
CURLSHE_NOT_BUILT_IN
;

104 
CURL_LOCK_DATA_CONNECT
:

108 
ªs
 = 
CURLSHE_BAD_OPTION
;

112 
CURLSHOPT_UNSHARE
:

114 
ty≥
 = 
	`va_¨g
(
∑øm
, );

115 
sh¨e
->
•ecifõr
 &~(1<<
ty≥
);

116  
ty≥
 ) {

117 
CURL_LOCK_DATA_DNS
:

118 if(
sh¨e
->
ho°ˇche
) {

119 
	`Cuæ_hash_de°roy
(
sh¨e
->
ho°ˇche
);

120 
sh¨e
->
ho°ˇche
 = 
NULL
;

124 
CURL_LOCK_DATA_COOKIE
:

125 #i‡!
	`deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_COOKIES
)

126 if(
sh¨e
->
cookõs
) {

127 
	`Cuæ_cookõ_˛ónup
(
sh¨e
->
cookõs
);

128 
sh¨e
->
cookõs
 = 
NULL
;

131 
ªs
 = 
CURLSHE_NOT_BUILT_IN
;

135 
CURL_LOCK_DATA_SSL_SESSION
:

136 #ifde‡
USE_SSL


137 
	`Cuæ_ß„‰ì
(
sh¨e
->
s¶£ssi⁄
);

139 
ªs
 = 
CURLSHE_NOT_BUILT_IN
;

143 
CURL_LOCK_DATA_CONNECT
:

147 
ªs
 = 
CURLSHE_BAD_OPTION
;

152 
CURLSHOPT_LOCKFUNC
:

153 
lockfunc
 = 
	`va_¨g
(
∑øm
, 
cuæ_lock_fun˘i⁄
);

154 
sh¨e
->
lockfunc
 =Üockfunc;

157 
CURLSHOPT_UNLOCKFUNC
:

158 
u∆ockfunc
 = 
	`va_¨g
(
∑øm
, 
cuæ_u∆ock_fun˘i⁄
);

159 
sh¨e
->
u∆ockfunc
 = unlockfunc;

162 
CURLSHOPT_USERDATA
:

163 
±r
 = 
	`va_¨g
(
∑øm
, *);

164 
sh¨e
->
˛õ¡d©a
 = 
±r
;

168 
ªs
 = 
CURLSHE_BAD_OPTION
;

172 
	`va_íd
(
∑øm
);

174  
ªs
;

175 
	}
}

177 
CURLSHcode


178 
	$cuæ_sh¨e_˛ónup
(
CURLSH
 *
sh
)

180 
Cuæ_sh¨e
 *
sh¨e
 = (Cuæ_sh¨ê*)
sh
;

182 if(
sh¨e
 =
NULL
)

183  
CURLSHE_INVALID
;

185 if(
sh¨e
->
lockfunc
)

186 
sh¨e
->
	`lockfunc
(
NULL
, 
CURL_LOCK_DATA_SHARE
, 
CURL_LOCK_ACCESS_SINGLE
,

187 
sh¨e
->
˛õ¡d©a
);

189 if(
sh¨e
->
dúty
) {

190 if(
sh¨e
->
u∆ockfunc
)

191 
sh¨e
->
	`u∆ockfunc
(
NULL
, 
CURL_LOCK_DATA_SHARE
, sh¨e->
˛õ¡d©a
);

192  
CURLSHE_IN_USE
;

195 if(
sh¨e
->
ho°ˇche
) {

196 
	`Cuæ_hash_de°roy
(
sh¨e
->
ho°ˇche
);

197 
sh¨e
->
ho°ˇche
 = 
NULL
;

200 #i‡!
	`deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_COOKIES
)

201 if(
sh¨e
->
cookõs
)

202 
	`Cuæ_cookõ_˛ónup
(
sh¨e
->
cookõs
);

205 #ifde‡
USE_SSL


206 if(
sh¨e
->
s¶£ssi⁄
) {

207 
size_t
 
i
;

208 
i
 = 0; i < 
sh¨e
->
max_s¶_£ssi⁄s
; i++)

209 
	`Cuæ_s¶_kûl_£ssi⁄
(&(
sh¨e
->
s¶£ssi⁄
[
i
]));

210 
	`‰ì
(
sh¨e
->
s¶£ssi⁄
);

214 if(
sh¨e
->
u∆ockfunc
)

215 
sh¨e
->
	`u∆ockfunc
(
NULL
, 
CURL_LOCK_DATA_SHARE
, sh¨e->
˛õ¡d©a
);

216 
	`‰ì
(
sh¨e
);

218  
CURLSHE_OK
;

219 
	}
}

222 
CURLSHcode


223 
	$Cuæ_sh¨e_lock
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_lock_d©a
 
ty≥
,

224 
cuæ_lock_ac˚ss
 
ac˚s°y≥
)

226 
Cuæ_sh¨e
 *
sh¨e
 = 
d©a
->share;

228 if(
sh¨e
 =
NULL
)

229  
CURLSHE_INVALID
;

231 if(
sh¨e
->
•ecifõr
 & (1<<
ty≥
)) {

232 if(
sh¨e
->
lockfunc
)

233 
sh¨e
->
	`lockfunc
(
d©a
, 
ty≥
, 
ac˚s°y≥
, sh¨e->
˛õ¡d©a
);

237  
CURLSHE_OK
;

238 
	}
}

240 
CURLSHcode


241 
	$Cuæ_sh¨e_u∆ock
(
Sessi⁄H™dÀ
 *
d©a
, 
cuæ_lock_d©a
 
ty≥
)

243 
Cuæ_sh¨e
 *
sh¨e
 = 
d©a
->share;

245 if(
sh¨e
 =
NULL
)

246  
CURLSHE_INVALID
;

248 if(
sh¨e
->
•ecifõr
 & (1<<
ty≥
)) {

249 if(
sh¨e
->
u∆ockfunc
)

250 
sh¨e
->
	`u∆ockfunc
 (
d©a
, 
ty≥
, sh¨e->
˛õ¡d©a
);

253  
CURLSHE_OK
;

254 
	}
}

	@lib/share.h

1 #i‚de‡
HEADER_CURL_SHARE_H


2 
	#HEADER_CURL_SHARE_H


	)

25 
	~"cuæ_£tup.h
"

26 
	~<cuæ/cuæ.h
>

27 
	~"cookõ.h
"

28 
	~"uæd©a.h
"

32 #ifde‡
__SALFORDC__


33 
	#CURL_VOLATILE


	)

35 
	#CURL_VOLATILE
 vﬁ©ûe

	)

39 
	sCuæ_sh¨e
 {

40 
	m•ecifõr
;

41 
CURL_VOLATILE
 
	mdúty
;

43 
cuæ_lock_fun˘i⁄
 
	mlockfunc
;

44 
cuæ_u∆ock_fun˘i⁄
 
	mu∆ockfunc
;

45 *
	m˛õ¡d©a
;

47 
cuæ_hash
 *
	mho°ˇche
;

48 #i‡!
deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_COOKIES
)

49 
CookõInfo
 *
	mcookõs
;

52 
cuæ_s¶_£ssi⁄
 *
	ms¶£ssi⁄
;

53 
size_t
 
	mmax_s¶_£ssi⁄s
;

54 
	m£ssi⁄age
;

57 
CURLSHcode
 
Cuæ_sh¨e_lock
 (
Sessi⁄H™dÀ
 *, 
cuæ_lock_d©a
,

58 
cuæ_lock_ac˚ss
);

59 
CURLSHcode
 
Cuæ_sh¨e_u∆ock
 (
Sessi⁄H™dÀ
 *, 
cuæ_lock_d©a
);

	@lib/sigpipe.h

1 #i‚de‡
HEADER_CURL_SIGPIPE_H


2 
	#HEADER_CURL_SIGPIPE_H


	)

24 
	~"cuæ_£tup.h
"

26 #i‡
deföed
(
HAVE_SIGNAL_H
Ë&& deföed(
HAVE_SIGACTION
Ë&& deföed(
USE_OPENSSL
)

27 
	~<sig«l.h
>

29 
	ssigpùe_ign‹e
 {

30 
siga˘i⁄
 
	mﬁd_pùe_a˘
;

31 
boﬁ
 
	mno_sig«l
;

34 
	#SIGPIPE_VARIABLE
(
x
Ë
sigpùe_ign‹e
 
	)
x

41 
	$sigpùe_ign‹e
(
Sessi⁄H™dÀ
 *
d©a
,

42 
sigpùe_ign‹e
 *
ig
)

46 
ig
->
no_sig«l
 = 
d©a
->
£t
.no_signal;

47 if(!
d©a
->
£t
.
no_sig«l
) {

48 
siga˘i⁄
 
a˘i⁄
;

50 
	`mem£t
(&
ig
->
ﬁd_pùe_a˘
, 0, (
siga˘i⁄
));

51 
	`siga˘i⁄
(
SIGPIPE
, 
NULL
, &
ig
->
ﬁd_pùe_a˘
);

52 
a˘i⁄
 = 
ig
->
ﬁd_pùe_a˘
;

54 
a˘i⁄
.
ß_h™dÀr
 = 
SIG_IGN
;

55 
	`siga˘i⁄
(
SIGPIPE
, &
a˘i⁄
, 
NULL
);

57 
	}
}

64 
	$sigpùe_ª°‹e
(
sigpùe_ign‹e
 *
ig
)

66 if(!
ig
->
no_sig«l
)

68 
	`siga˘i⁄
(
SIGPIPE
, &
ig
->
ﬁd_pùe_a˘
, 
NULL
);

69 
	}
}

73 
	#sigpùe_ign‹e
(
x
,
y
Ë
Cuæ_n›_°mt


	)

74 
	#sigpùe_ª°‹e
(
x
Ë
Cuæ_n›_°mt


	)

75 
	#SIGPIPE_VARIABLE
(
x
)

	)

	@lib/slist.c

23 
	~"cuæ_£tup.h
"

25 
	~"cuæ_mem‹y.h
"

26 
	~"¶i°.h
"

29 
	~"memdebug.h
"

32 
cuæ_¶i°
 *
	$¶i°_gë_œ°
(
cuæ_¶i°
 *
li°
)

34 
cuæ_¶i°
 *
ôem
;

37 if(!
li°
)

38  
NULL
;

41 
ôem
 = 
li°
;

42 
ôem
->
√xt
) {

43 
ôem
 = iãm->
√xt
;

45  
ôem
;

46 
	}
}

57 
cuæ_¶i°
 *
	$Cuæ_¶i°_≠≥nd_nodup
(
cuæ_¶i°
 *
li°
, *
d©a
)

59 
cuæ_¶i°
 *
œ°
;

60 
cuæ_¶i°
 *
√w_ôem
;

62 
	`DEBUGASSERT
(
d©a
);

64 
√w_ôem
 = 
	`mÆloc
((
cuæ_¶i°
));

65 if(!
√w_ôem
)

66  
NULL
;

68 
√w_ôem
->
√xt
 = 
NULL
;

69 
√w_ôem
->
d©a
 = data;

72 if(!
li°
)

73  
√w_ôem
;

75 
œ°
 = 
	`¶i°_gë_œ°
(
li°
);

76 
œ°
->
√xt
 = 
√w_ôem
;

77  
li°
;

78 
	}
}

87 
cuæ_¶i°
 *
	$cuæ_¶i°_≠≥nd
(
cuæ_¶i°
 *
li°
,

88 c⁄° *
d©a
)

90 *
dupd©a
 = 
	`°rdup
(
d©a
);

92 if(!
dupd©a
)

93  
NULL
;

95 
li°
 = 
	`Cuæ_¶i°_≠≥nd_nodup
÷i°, 
dupd©a
);

96 if(!
li°
)

97 
	`‰ì
(
dupd©a
);

99  
li°
;

100 
	}
}

107 
cuæ_¶i°
 *
	$Cuæ_¶i°_du∂iˇã
(
cuæ_¶i°
 *
öli°
)

109 
cuæ_¶i°
 *
ouéi°
 = 
NULL
;

110 
cuæ_¶i°
 *
tmp
;

112 
öli°
) {

113 
tmp
 = 
	`cuæ_¶i°_≠≥nd
(
ouéi°
, 
öli°
->
d©a
);

115 if(!
tmp
) {

116 
	`cuæ_¶i°_‰ì_Æl
(
ouéi°
);

117  
NULL
;

120 
ouéi°
 = 
tmp
;

121 
öli°
 = i∆i°->
√xt
;

123  
ouéi°
;

124 
	}
}

127 
	$cuæ_¶i°_‰ì_Æl
(
cuæ_¶i°
 *
li°
)

129 
cuæ_¶i°
 *
√xt
;

130 
cuæ_¶i°
 *
ôem
;

132 if(!
li°
)

135 
ôem
 = 
li°
;

137 
√xt
 = 
ôem
->next;

138 
	`Cuæ_ß„‰ì
(
ôem
->
d©a
);

139 
	`‰ì
(
ôem
);

140 
ôem
 = 
√xt
;

141 } 
√xt
);

142 
	}
}

	@lib/slist.h

1 #i‚de‡
HEADER_CURL_SLIST_H


2 
	#HEADER_CURL_SLIST_H


	)

30 
cuæ_¶i°
 *
Cuæ_¶i°_du∂iˇã
(cuæ_¶i° *
öli°
);

36 
cuæ_¶i°
 *
Cuæ_¶i°_≠≥nd_nodup
(cuæ_¶i° *
li°
,

37 *
d©a
);

	@lib/smtp.c

35 
	~"cuæ_£tup.h
"

37 #i‚de‡
CURL_DISABLE_SMTP


39 #ifde‡
HAVE_NETINET_IN_H


40 
	~<√töë/ö.h
>

42 #ifde‡
HAVE_ARPA_INET_H


43 
	~<¨∑/öë.h
>

45 #ifde‡
HAVE_UTSNAME_H


46 
	~<sys/ut¢ame.h
>

48 #ifde‡
HAVE_NETDB_H


49 
	~<√tdb.h
>

51 #ifde‡
__VMS


52 
	~<ö.h
>

53 
	~<öë.h
>

56 #i‡(
deföed
(
NETWARE
Ë&& deföed(
__NOVELL_LIBC__
))

57 #unde‡
ö_addr_t


58 
	#ö_addr_t
 

	)

61 
	~<cuæ/cuæ.h
>

62 
	~"uæd©a.h
"

63 
	~"£ndf.h
"

64 
	~"if2ù.h
"

65 
	~"ho°ù.h
"

66 
	~"¥ogªss.h
"

67 
	~"å™s„r.h
"

68 
	~"esˇ≥.h
"

69 
	~"hâp.h
"

70 
	~"socks.h
"

71 
	~"smç.h
"

73 
	~"°πoof·.h
"

74 
	~"°ªquÆ.h
"

75 
	~"vés/vés.h
"

76 
	~"c⁄√˘.h
"

77 
	~"°ªº‹.h
"

78 
	~"£À˘.h
"

79 
	~"mu…iif.h
"

80 
	~"uæ.h
"

81 
	~"øw°r.h
"

82 
	~"cuæ_gëho°«me.h
"

83 
	~"cuæ_ß¶.h
"

84 
	~"w¨∆ess.h
"

86 
	#_MPRINTF_REPLACE


	)

87 
	~<cuæ/m¥ötf.h
>

89 
	~"cuæ_mem‹y.h
"

91 
	~"memdebug.h
"

94 
CURLcode
 
smç_ªguœr_å™s„r
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

95 
CURLcode
 
smç_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

96 
CURLcode
 
smç_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, CURLcodê
°©us
,

97 
boﬁ
 
¥em©uª
);

98 
CURLcode
 
smç_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

99 
CURLcode
 
smç_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód
);

100 
CURLcode
 
smç_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

101 
smç_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

102 
numsocks
);

103 
CURLcode
 
smç_doög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d›ha£_d⁄e
);

104 
CURLcode
 
smç_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
);

105 
CURLcode
 
smç_∑r£_uæ_›ti⁄s
(
c⁄√˘d©a
 *
c⁄n
);

106 
CURLcode
 
smç_∑r£_uæ_∑th
(
c⁄√˘d©a
 *
c⁄n
);

107 
CURLcode
 
smç_∑r£_cu°om_ªque°
(
c⁄√˘d©a
 *
c⁄n
);

108 
CURLcode
 
smç_ˇlc_ß¶_dëaûs
(
c⁄√˘d©a
 *
c⁄n
,

109 c⁄° **
mech
,

110 **
öôª•
, 
size_t
 *
Àn
,

111 
smç°©e
 *
°©e1
, smç°©ê*
°©e2
);

117 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_smç
 = {

119 
smç_£tup_c⁄√˘i⁄
,

120 
smç_do
,

121 
smç_d⁄e
,

122 
ZERO_NULL
,

123 
smç_c⁄√˘
,

124 
smç_mu…i_°©emach
,

125 
smç_doög
,

126 
smç_gësock
,

127 
smç_gësock
,

128 
ZERO_NULL
,

129 
ZERO_NULL
,

130 
smç_disc⁄√˘
,

131 
ZERO_NULL
,

132 
PORT_SMTP
,

133 
CURLPROTO_SMTP
,

134 
PROTOPT_CLOSEACTION
 | 
PROTOPT_NOURLQUERY


137 #ifde‡
USE_SSL


142 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_smçs
 = {

144 
smç_£tup_c⁄√˘i⁄
,

145 
smç_do
,

146 
smç_d⁄e
,

147 
ZERO_NULL
,

148 
smç_c⁄√˘
,

149 
smç_mu…i_°©emach
,

150 
smç_doög
,

151 
smç_gësock
,

152 
smç_gësock
,

153 
ZERO_NULL
,

154 
ZERO_NULL
,

155 
smç_disc⁄√˘
,

156 
ZERO_NULL
,

157 
PORT_SMTPS
,

158 
CURLPROTO_SMTPS
,

159 
PROTOPT_CLOSEACTION
 | 
PROTOPT_SSL


160 | 
PROTOPT_NOURLQUERY


164 #i‚de‡
CURL_DISABLE_HTTP


169 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_smç_¥oxy
 = {

171 
Cuæ_hâp_£tup_c⁄n
,

172 
Cuæ_hâp
,

173 
Cuæ_hâp_d⁄e
,

174 
ZERO_NULL
,

175 
ZERO_NULL
,

176 
ZERO_NULL
,

177 
ZERO_NULL
,

178 
ZERO_NULL
,

179 
ZERO_NULL
,

180 
ZERO_NULL
,

181 
ZERO_NULL
,

182 
ZERO_NULL
,

183 
ZERO_NULL
,

184 
PORT_SMTP
,

185 
CURLPROTO_HTTP
,

186 
PROTOPT_NONE


189 #ifde‡
USE_SSL


194 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_smçs_¥oxy
 = {

196 
Cuæ_hâp_£tup_c⁄n
,

197 
Cuæ_hâp
,

198 
Cuæ_hâp_d⁄e
,

199 
ZERO_NULL
,

200 
ZERO_NULL
,

201 
ZERO_NULL
,

202 
ZERO_NULL
,

203 
ZERO_NULL
,

204 
ZERO_NULL
,

205 
ZERO_NULL
,

206 
ZERO_NULL
,

207 
ZERO_NULL
,

208 
ZERO_NULL
,

209 
PORT_SMTPS
,

210 
CURLPROTO_HTTP
,

211 
PROTOPT_NONE


216 #ifde‡
USE_SSL


217 
	$smç_to_smçs
(
c⁄√˘d©a
 *
c⁄n
)

219 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_smçs
;

220 
	}
}

222 
	#smç_to_smçs
(
x
Ë
Cuæ_n›_°mt


	)

233 
boﬁ
 
	$smç_ído‰e•
(
c⁄√˘d©a
 *
c⁄n
, *
löe
, 
size_t
 
Àn
,

234 *
ª•
)

236 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

237 
boﬁ
 
ªsu…
 = 
FALSE
;

240 if(
Àn
 < 4 || !
	`ISDIGIT
(
löe
[0]) || !ISDIGIT(line[1]) || !ISDIGIT(line[2]))

241  
FALSE
;

247 if(
löe
[3] =' ' || 
Àn
 == 5) {

248 
ªsu…
 = 
TRUE
;

249 *
ª•
 = 
	`cuæx_¶tosi
(
	`°πﬁ
(
löe
, 
NULL
, 10));

252 if(*
ª•
 == 1)

253 *
ª•
 = 0;

256 if(
löe
[3] == '-' &&

257 (
smçc
->
°©e
 =
SMTP_EHLO
 || smçc->°©ê=
SMTP_COMMAND
)) {

258 
ªsu…
 = 
TRUE
;

259 *
ª•
 = 1;

262  
ªsu…
;

263 
	}
}

271 
	$smç_gë_mesßge
(*
buf„r
, ** 
ouçå
)

273 
size_t
 
Àn
 = 0;

274 * 
mesßge
 = 
NULL
;

277 
mesßge
 = 
buf„r
 + 4; *message == ' ' || *message == '\t'; message++)

281 
Àn
 = 
	`°æí
(
mesßge
);Üen--;)

282 if(
mesßge
[
Àn
] != '\r' && message[len] != '\n' && message[len] != ' ' &&

283 
mesßge
[
Àn
] != '\t')

287 if(++
Àn
) {

288 
mesßge
[
Àn
] = '\0';

291 *
ouçå
 = 
mesßge
;

292 
	}
}

300 
	$°©e
(
c⁄√˘d©a
 *
c⁄n
, 
smç°©e
 
√w°©e
)

302 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

303 #i‡
	`deföed
(
DEBUGBUILD
Ë&& !deföed(
CURL_DISABLE_VERBOSE_STRINGS
)

305 c⁄° * c⁄° 
«mes
[] = {

332 if(
smçc
->
°©e
 !
√w°©e
)

333 
	`öfof
(
c⁄n
->
d©a
, "SMTP %p state change from %sÅo %s\n",

334 (*)
smçc
, 
«mes
[smçc->
°©e
],Çames[
√w°©e
]);

337 
smçc
->
°©e
 = 
√w°©e
;

338 
	}
}

347 
CURLcode
 
	$smç_≥rf‹m_ehlo
(
c⁄√˘d©a
 *
c⁄n
)

349 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

350 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

352 
smçc
->
authmechs
 = 0;

353 
smçc
->
authu£d
 = 0;

355 
smçc
->
és_suµ‹ãd
 = 
FALSE
;

356 
smçc
->
auth_suµ‹ãd
 = 
FALSE
;

359 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
smçc
->
µ
, "EHLO %s", smçc->
domaö
);

361 if(!
ªsu…
)

362 
	`°©e
(
c⁄n
, 
SMTP_EHLO
);

364  
ªsu…
;

365 
	}
}

373 
CURLcode
 
	$smç_≥rf‹m_hño
(
c⁄√˘d©a
 *
c⁄n
)

375 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

376 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

378 
smçc
->
authu£d
 = 0;

382 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
smçc
->
µ
, "HELO %s", smçc->
domaö
);

384 if(!
ªsu…
)

385 
	`°©e
(
c⁄n
, 
SMTP_HELO
);

387  
ªsu…
;

388 
	}
}

396 
CURLcode
 
	$smç_≥rf‹m_°¨âls
(
c⁄√˘d©a
 *
c⁄n
)

398 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

401 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", "STARTTLS");

403 if(!
ªsu…
)

404 
	`°©e
(
c⁄n
, 
SMTP_STARTTLS
);

406  
ªsu…
;

407 
	}
}

415 
CURLcode
 
	$smç_≥rf‹m_upgøde_és
(
c⁄√˘d©a
 *
c⁄n
)

417 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

418 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

421 
ªsu…
 = 
	`Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄n
, 
FIRSTSOCKET
, &
smçc
->
s¶d⁄e
);

423 if(!
ªsu…
) {

424 if(
smçc
->
°©e
 !
SMTP_UPGRADETLS
)

425 
	`°©e
(
c⁄n
, 
SMTP_UPGRADETLS
);

427 if(
smçc
->
s¶d⁄e
) {

428 
	`smç_to_smçs
(
c⁄n
);

429 
ªsu…
 = 
	`smç_≥rf‹m_ehlo
(
c⁄n
);

433  
ªsu…
;

434 
	}
}

443 
CURLcode
 
	$smç_≥rf‹m_auth
(
c⁄√˘d©a
 *
c⁄n
,

444 c⁄° *
mech
,

445 c⁄° *
öôª•
, 
size_t
 
Àn
,

446 
smç°©e
 
°©e1
, smç°©ê
°©e2
)

448 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

449 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

451 if(
öôª•
 && 8 + 
	`°æí
(
mech
Ë+ 
Àn
 <= 512) {

453 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
smçc
->
µ
, "AUTH %†%s", 
mech
, 
öôª•
);

455 if(!
ªsu…
)

456 
	`°©e
(
c⁄n
, 
°©e2
);

460 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
smçc
->
µ
, "AUTH %s", 
mech
);

462 if(!
ªsu…
)

463 
	`°©e
(
c⁄n
, 
°©e1
);

466  
ªsu…
;

467 
	}
}

476 
CURLcode
 
	$smç_≥rf‹m_authítiˇti⁄
(
c⁄√˘d©a
 *
c⁄n
)

478 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

479 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

480 c⁄° *
mech
 = 
NULL
;

481 *
öôª•
 = 
NULL
;

482 
size_t
 
Àn
 = 0;

483 
smç°©e
 
°©e1
 = 
SMTP_STOP
;

484 
smç°©e
 
°©e2
 = 
SMTP_STOP
;

488 if(!
c⁄n
->
bôs
.
u£r_∑sswd
 || !
smçc
->
auth_suµ‹ãd
) {

489 
	`°©e
(
c⁄n
, 
SMTP_STOP
);

491  
ªsu…
;

495 
ªsu…
 = 
	`smç_ˇlc_ß¶_dëaûs
(
c⁄n
, &
mech
, &
öôª•
, &
Àn
, &
°©e1
,

496 &
°©e2
);

498 if(!
ªsu…
) {

499 if(
mech
) {

501 
ªsu…
 = 
	`smç_≥rf‹m_auth
(
c⁄n
, 
mech
, 
öôª•
, 
Àn
, 
°©e1
, 
°©e2
);

503 
	`Cuæ_ß„‰ì
(
öôª•
);

507 
	`öfof
(
c⁄n
->
d©a
, "No knownáuthentication mechanisms supported!\n");

508 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

512  
ªsu…
;

513 
	}
}

521 
CURLcode
 
	$smç_≥rf‹m_comm™d
(
c⁄√˘d©a
 *
c⁄n
)

523 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

524 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

525 
SMTP
 *
smç
 = 
d©a
->
ªq
.
¥Ÿ›
;

528 if(
smç
->
r˝t
)

529 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s %s",

530 
smç
->
cu°om
 && smtp->custom[0] != '\0' ?

531 
smç
->
cu°om
 : "VRFY",

532 
smç
->
r˝t
->
d©a
);

534 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s",

535 
smç
->
cu°om
 && smtp->custom[0] != '\0' ?

536 
smç
->
cu°om
 : "HELP");

538 if(!
ªsu…
)

539 
	`°©e
(
c⁄n
, 
SMTP_COMMAND
);

541  
ªsu…
;

542 
	}
}

550 
CURLcode
 
	$smç_≥rf‹m_maû
(
c⁄√˘d©a
 *
c⁄n
)

552 *
‰om
 = 
NULL
;

553 *
auth
 = 
NULL
;

554 *
size
 = 
NULL
;

555 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

556 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

559 if(!
d©a
->
£t
.
°r
[
STRING_MAIL_FROM
])

561 
‰om
 = 
	`°rdup
("<>");

562 if(
d©a
->
£t
.
°r
[
STRING_MAIL_FROM
][0] == '<')

563 
‰om
 = 
	`≠rötf
("%s", 
d©a
->
£t
.
°r
[
STRING_MAIL_FROM
]);

565 
‰om
 = 
	`≠rötf
("<%s>", 
d©a
->
£t
.
°r
[
STRING_MAIL_FROM
]);

567 if(!
‰om
)

568  
CURLE_OUT_OF_MEMORY
;

571 if(
d©a
->
£t
.
°r
[
STRING_MAIL_AUTH
] && 
c⁄n
->
¥Ÿo
.
smçc
.
authu£d
) {

572 if(
d©a
->
£t
.
°r
[
STRING_MAIL_AUTH
][0] != '\0')

573 
auth
 = 
	`≠rötf
("%s", 
d©a
->
£t
.
°r
[
STRING_MAIL_AUTH
]);

576 
auth
 = 
	`°rdup
("<>");

578 if(!
auth
) {

579 
	`Cuæ_ß„‰ì
(
‰om
);

581  
CURLE_OUT_OF_MEMORY
;

586 if(
c⁄n
->
¥Ÿo
.
smçc
.
size_suµ‹ãd
 && c⁄n->
d©a
->
°©e
.
öfûesize
 > 0) {

587 
size
 = 
	`≠rötf
("%" 
CURL_FORMAT_CURL_OFF_T
, 
d©a
->
°©e
.
öfûesize
);

589 if(!
size
) {

590 
	`Cuæ_ß„‰ì
(
‰om
);

591 
	`Cuæ_ß„‰ì
(
auth
);

593  
CURLE_OUT_OF_MEMORY
;

598 if(!
auth
 && !
size
)

599 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
,

600 "MAIL FROM:%s", 
‰om
);

601 if(
auth
 && !
size
)

602 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
,

603 "MAIL FROM:%†AUTH=%s", 
‰om
, 
auth
);

604 if(
auth
 && 
size
)

605 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
,

606 "MAIL FROM:%†AUTH=%†SIZE=%s", 
‰om
, 
auth
, 
size
);

608 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
,

609 "MAIL FROM:%†SIZE=%s", 
‰om
, 
size
);

611 
	`Cuæ_ß„‰ì
(
‰om
);

612 
	`Cuæ_ß„‰ì
(
auth
);

613 
	`Cuæ_ß„‰ì
(
size
);

615 if(!
ªsu…
)

616 
	`°©e
(
c⁄n
, 
SMTP_MAIL
);

618  
ªsu…
;

619 
	}
}

628 
CURLcode
 
	$smç_≥rf‹m_r˝t_to
(
c⁄√˘d©a
 *
c⁄n
)

630 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

631 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

632 
SMTP
 *
smç
 = 
d©a
->
ªq
.
¥Ÿ›
;

635 if(
smç
->
r˝t
->
d©a
[0] == '<')

636 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "RCPT TO:%s",

637 
smç
->
r˝t
->
d©a
);

639 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "RCPT TO:<%s>",

640 
smç
->
r˝t
->
d©a
);

641 if(!
ªsu…
)

642 
	`°©e
(
c⁄n
, 
SMTP_RCPT
);

644  
ªsu…
;

645 
	}
}

653 
CURLcode
 
	$smç_≥rf‹m_quô
(
c⁄√˘d©a
 *
c⁄n
)

655 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

658 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", "QUIT");

660 if(!
ªsu…
)

661 
	`°©e
(
c⁄n
, 
SMTP_QUIT
);

663  
ªsu…
;

664 
	}
}

667 
CURLcode
 
	$smç_°©e_£rvîgªë_ª•
(
c⁄√˘d©a
 *
c⁄n
,

668 
smçcode
,

669 
smç°©e
 
ö°©e
)

671 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

672 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

674 ()
ö°©e
;

676 if(
smçcode
/100 != 2) {

677 
	`Áûf
(
d©a
, "GŸ u√x≥˘ed smç-£rvîÑe•⁄£: %d", 
smçcode
);

678 
ªsu…
 = 
CURLE_FTP_WEIRD_SERVER_REPLY
;

681 
ªsu…
 = 
	`smç_≥rf‹m_ehlo
(
c⁄n
);

683  
ªsu…
;

684 
	}
}

687 
CURLcode
 
	$smç_°©e_°¨âls_ª•
(
c⁄√˘d©a
 *
c⁄n
,

688 
smçcode
,

689 
smç°©e
 
ö°©e
)

691 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

692 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

694 ()
ö°©e
;

696 if(
smçcode
 != 220) {

697 if(
d©a
->
£t
.
u£_s¶
 !
CURLUSESSL_TRY
) {

698 
	`Áûf
(
d©a
, "STARTTLS díõd. %c", 
smçcode
);

699 
ªsu…
 = 
CURLE_USE_SSL_FAILED
;

702 
ªsu…
 = 
	`smç_≥rf‹m_authítiˇti⁄
(
c⁄n
);

705 
ªsu…
 = 
	`smç_≥rf‹m_upgøde_és
(
c⁄n
);

707  
ªsu…
;

708 
	}
}

711 
CURLcode
 
	$smç_°©e_ehlo_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
smçcode
,

712 
smç°©e
 
ö°©e
)

714 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

715 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

716 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

717 c⁄° *
löe
 = 
d©a
->
°©e
.
buf„r
;

718 
size_t
 
Àn
 = 
	`°æí
(
löe
);

719 
size_t
 
w‹dÀn
;

721 ()
ö°©e
;

723 if(
smçcode
/100 != 2 && smtpcode != 1) {

724 if(
d©a
->
£t
.
u£_s¶
 <
CURLUSESSL_TRY
 || 
c⁄n
->
s¶
[
FIRSTSOCKET
].
u£
)

725 
ªsu…
 = 
	`smç_≥rf‹m_hño
(
c⁄n
);

727 
	`Áûf
(
d©a
, "RemŸêac˚s†díõd: %d", 
smçcode
);

728 
ªsu…
 = 
CURLE_REMOTE_ACCESS_DENIED
;

732 
löe
 += 4;

733 
Àn
 -= 4;

736 if(
Àn
 >8 && !
	`memcmp
(
löe
, "STARTTLS", 8))

737 
smçc
->
és_suµ‹ãd
 = 
TRUE
;

740 if(
Àn
 >4 && !
	`memcmp
(
löe
, "SIZE", 4))

741 
smçc
->
size_suµ‹ãd
 = 
TRUE
;

744 if(
Àn
 >5 && !
	`memcmp
(
löe
, "AUTH ", 5)) {

745 
smçc
->
auth_suµ‹ãd
 = 
TRUE
;

748 
löe
 += 5;

749 
Àn
 -= 5;

753 
Àn
 &&

754 (*
löe
 == ' ' || *line == '\t' ||

755 *
löe
 == '\r' || *line == '\n')) {

757 
löe
++;

758 
Àn
--;

761 if(!
Àn
)

765 
w‹dÀn
 = 0; w‹dÀ¿< 
Àn
 && 
löe
[wordlen] != ' ' &&

766 
löe
[
w‹dÀn
] != '\t' &&Üine[wordlen] != '\r' &&

767 
löe
[
w‹dÀn
] != '\n';)

768 
w‹dÀn
++;

771 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_LOGIN
))

772 
smçc
->
authmechs
 |
SASL_MECH_LOGIN
;

773 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_PLAIN
))

774 
smçc
->
authmechs
 |
SASL_MECH_PLAIN
;

775 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_CRAM_MD5
))

776 
smçc
->
authmechs
 |
SASL_MECH_CRAM_MD5
;

777 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_DIGEST_MD5
))

778 
smçc
->
authmechs
 |
SASL_MECH_DIGEST_MD5
;

779 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_GSSAPI
))

780 
smçc
->
authmechs
 |
SASL_MECH_GSSAPI
;

781 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_EXTERNAL
))

782 
smçc
->
authmechs
 |
SASL_MECH_EXTERNAL
;

783 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_NTLM
))

784 
smçc
->
authmechs
 |
SASL_MECH_NTLM
;

785 if(
	`ß¶_mech_equÆ
(
löe
, 
w‹dÀn
, 
SASL_MECH_STRING_XOAUTH2
))

786 
smçc
->
authmechs
 |
SASL_MECH_XOAUTH2
;

788 
löe
 +
w‹dÀn
;

789 
Àn
 -
w‹dÀn
;

793 if(
smçcode
 != 1) {

794 if(
d©a
->
£t
.
u£_s¶
 && !
c⁄n
->
s¶
[
FIRSTSOCKET
].
u£
) {

796 if(
smçc
->
és_suµ‹ãd
)

798 
ªsu…
 = 
	`smç_≥rf‹m_°¨âls
(
c⁄n
);

799 if(
d©a
->
£t
.
u£_s¶
 =
CURLUSESSL_TRY
)

801 
ªsu…
 = 
	`smç_≥rf‹m_authítiˇti⁄
(
c⁄n
);

803 
	`Áûf
(
d©a
, "STARTTLSÇot supported.");

804 
ªsu…
 = 
CURLE_USE_SSL_FAILED
;

808 
ªsu…
 = 
	`smç_≥rf‹m_authítiˇti⁄
(
c⁄n
);

812  
ªsu…
;

813 
	}
}

816 
CURLcode
 
	$smç_°©e_hño_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
smçcode
,

817 
smç°©e
 
ö°©e
)

819 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

820 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

822 ()
ö°©e
;

824 if(
smçcode
/100 != 2) {

825 
	`Áûf
(
d©a
, "RemŸêac˚s†díõd: %d", 
smçcode
);

826 
ªsu…
 = 
CURLE_REMOTE_ACCESS_DENIED
;

830 
	`°©e
(
c⁄n
, 
SMTP_STOP
);

832  
ªsu…
;

833 
	}
}

836 
CURLcode
 
	$smç_°©e_auth_∂aö_ª•
(
c⁄√˘d©a
 *
c⁄n
,

837 
smçcode
,

838 
smç°©e
 
ö°©e
)

840 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

841 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

842 
size_t
 
Àn
 = 0;

843 *
∂aöauth
 = 
NULL
;

845 ()
ö°©e
;

847 if(
smçcode
 != 334) {

848 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
smçcode
);

849 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

853 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_∂aö_mesßge
(
c⁄n
->
d©a
, c⁄n->
u£r
,

854 
c⁄n
->
∑sswd
, &
∂aöauth
, &
Àn
);

855 if(!
ªsu…
 && 
∂aöauth
) {

857 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", 
∂aöauth
);

859 if(!
ªsu…
)

860 
	`°©e
(
c⁄n
, 
SMTP_AUTH_FINAL
);

864 
	`Cuæ_ß„‰ì
(
∂aöauth
);

866  
ªsu…
;

867 
	}
}

870 
CURLcode
 
	$smç_°©e_auth_logö_ª•
(
c⁄√˘d©a
 *
c⁄n
,

871 
smçcode
,

872 
smç°©e
 
ö°©e
)

874 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

875 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

876 
size_t
 
Àn
 = 0;

877 *
authu£r
 = 
NULL
;

879 ()
ö°©e
;

881 if(
smçcode
 != 334) {

882 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
smçcode
);

883 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

887 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_logö_mesßge
(
c⁄n
->
d©a
, c⁄n->
u£r
,

888 &
authu£r
, &
Àn
);

889 if(!
ªsu…
 && 
authu£r
) {

891 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", 
authu£r
);

893 if(!
ªsu…
)

894 
	`°©e
(
c⁄n
, 
SMTP_AUTH_LOGIN_PASSWD
);

898 
	`Cuæ_ß„‰ì
(
authu£r
);

900  
ªsu…
;

901 
	}
}

904 
CURLcode
 
	$smç_°©e_auth_logö_∑ssw‹d_ª•
(
c⁄√˘d©a
 *
c⁄n
,

905 
smçcode
,

906 
smç°©e
 
ö°©e
)

908 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

909 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

910 
size_t
 
Àn
 = 0;

911 *
auth∑sswd
 = 
NULL
;

913 ()
ö°©e
;

915 if(
smçcode
 != 334) {

916 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
smçcode
);

917 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

921 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_logö_mesßge
(
c⁄n
->
d©a
, c⁄n->
∑sswd
,

922 &
auth∑sswd
, &
Àn
);

923 if(!
ªsu…
 && 
auth∑sswd
) {

925 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", 
auth∑sswd
);

927 if(!
ªsu…
)

928 
	`°©e
(
c⁄n
, 
SMTP_AUTH_FINAL
);

932 
	`Cuæ_ß„‰ì
(
auth∑sswd
);

934  
ªsu…
;

935 
	}
}

937 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


939 
CURLcode
 
	$smç_°©e_auth_¸am_ª•
(
c⁄√˘d©a
 *
c⁄n
,

940 
smçcode
,

941 
smç°©e
 
ö°©e
)

943 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

944 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

945 *
chlg
 = 
NULL
;

946 *
chlg64
 = 
NULL
;

947 *
Ωlyb64
 = 
NULL
;

948 
size_t
 
Àn
 = 0;

950 ()
ö°©e
;

952 if(
smçcode
 != 334) {

953 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
smçcode
);

954  
CURLE_LOGIN_DENIED
;

958 
	`smç_gë_mesßge
(
d©a
->
°©e
.
buf„r
, &
chlg64
);

961 
ªsu…
 = 
	`Cuæ_ß¶_decode_¸am_md5_mesßge
(
chlg64
, &
chlg
, &
Àn
);

962 if(
ªsu…
) {

964 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", "*");

966 if(!
ªsu…
)

967 
	`°©e
(
c⁄n
, 
SMTP_AUTH_CANCEL
);

971 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¸am_md5_mesßge
(
d©a
, 
chlg
, 
c⁄n
->
u£r
,

972 
c⁄n
->
∑sswd
, &
Ωlyb64
, &
Àn
);

973 if(!
ªsu…
 && 
Ωlyb64
) {

975 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", 
Ωlyb64
);

977 if(!
ªsu…
)

978 
	`°©e
(
c⁄n
, 
SMTP_AUTH_FINAL
);

982 
	`Cuæ_ß„‰ì
(
chlg
);

983 
	`Cuæ_ß„‰ì
(
Ωlyb64
);

985  
ªsu…
;

986 
	}
}

989 
CURLcode
 
	$smç_°©e_auth_dige°_ª•
(
c⁄√˘d©a
 *
c⁄n
,

990 
smçcode
,

991 
smç°©e
 
ö°©e
)

993 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

994 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

995 *
chlg64
 = 
NULL
;

996 *
Ωlyb64
 = 
NULL
;

997 
size_t
 
Àn
 = 0;

999 ()
ö°©e
;

1001 if(
smçcode
 != 334) {

1002 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
smçcode
);

1003  
CURLE_LOGIN_DENIED
;

1007 
	`smç_gë_mesßge
(
d©a
->
°©e
.
buf„r
, &
chlg64
);

1010 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_dige°_md5_mesßge
(
d©a
, 
chlg64
,

1011 
c⁄n
->
u£r
, c⁄n->
∑sswd
,

1012 "smç", &
Ωlyb64
, &
Àn
);

1013 if(
ªsu…
) {

1014 if(
ªsu…
 =
CURLE_BAD_CONTENT_ENCODING
) {

1016 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", "*");

1018 if(!
ªsu…
)

1019 
	`°©e
(
c⁄n
, 
SMTP_AUTH_CANCEL
);

1024 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", 
Ωlyb64
);

1026 if(!
ªsu…
)

1027 
	`°©e
(
c⁄n
, 
SMTP_AUTH_DIGESTMD5_RESP
);

1030 
	`Cuæ_ß„‰ì
(
Ωlyb64
);

1032  
ªsu…
;

1033 
	}
}

1036 
CURLcode
 
	$smç_°©e_auth_dige°_ª•_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1037 
smçcode
,

1038 
smç°©e
 
ö°©e
)

1040 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1041 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1043 ()
ö°©e
;

1045 if(
smçcode
 != 334) {

1046 
	`Áûf
(
d©a
, "Authítiˇti⁄ faûed: %d", 
smçcode
);

1047 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1051 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", "");

1053 if(!
ªsu…
)

1054 
	`°©e
(
c⁄n
, 
SMTP_AUTH_FINAL
);

1057  
ªsu…
;

1058 
	}
}

1062 #ifde‡
USE_NTLM


1064 
CURLcode
 
	$smç_°©e_auth_¡lm_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1065 
smçcode
,

1066 
smç°©e
 
ö°©e
)

1068 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1069 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1070 *
ty≥1msg
 = 
NULL
;

1071 
size_t
 
Àn
 = 0;

1073 ()
ö°©e
;

1075 if(
smçcode
 != 334) {

1076 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
smçcode
);

1077 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1081 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¡lm_ty≥1_mesßge
(
c⁄n
->
u£r
, c⁄n->
∑sswd
,

1082 &
c⁄n
->
¡lm
,

1083 &
ty≥1msg
, &
Àn
);

1084 if(!
ªsu…
 && 
ty≥1msg
) {

1086 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", 
ty≥1msg
);

1088 if(!
ªsu…
)

1089 
	`°©e
(
c⁄n
, 
SMTP_AUTH_NTLM_TYPE2MSG
);

1093 
	`Cuæ_ß„‰ì
(
ty≥1msg
);

1095  
ªsu…
;

1096 
	}
}

1099 
CURLcode
 
	$smç_°©e_auth_¡lm_ty≥2msg_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1100 
smçcode
,

1101 
smç°©e
 
ö°©e
)

1103 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1104 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1105 *
ty≥2msg
 = 
NULL
;

1106 *
ty≥3msg
 = 
NULL
;

1107 
size_t
 
Àn
 = 0;

1109 ()
ö°©e
;

1111 if(
smçcode
 != 334) {

1112 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
smçcode
);

1113 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1117 
	`smç_gë_mesßge
(
d©a
->
°©e
.
buf„r
, &
ty≥2msg
);

1120 
ªsu…
 = 
	`Cuæ_ß¶_decode_¡lm_ty≥2_mesßge
(
d©a
, 
ty≥2msg
, &
c⁄n
->
¡lm
);

1121 if(
ªsu…
) {

1123 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", "*");

1125 if(!
ªsu…
)

1126 
	`°©e
(
c⁄n
, 
SMTP_AUTH_CANCEL
);

1130 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¡lm_ty≥3_mesßge
(
d©a
, 
c⁄n
->
u£r
,

1131 
c⁄n
->
∑sswd
, &c⁄n->
¡lm
,

1132 &
ty≥3msg
, &
Àn
);

1133 if(!
ªsu…
 && 
ty≥3msg
) {

1135 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", 
ty≥3msg
);

1137 if(!
ªsu…
)

1138 
	`°©e
(
c⁄n
, 
SMTP_AUTH_FINAL
);

1143 
	`Cuæ_ß„‰ì
(
ty≥3msg
);

1145  
ªsu…
;

1146 
	}
}

1150 
CURLcode
 
	$smç_°©e_auth_xﬂuth2_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1151 
smçcode
, 
smç°©e
 
ö°©e
)

1153 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1154 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1155 
size_t
 
Àn
 = 0;

1156 *
xﬂuth
 = 
NULL
;

1158 ()
ö°©e
;

1160 if(
smçcode
 != 334) {

1161 
	`Áûf
(
d©a
, "Ac˚s†díõd: %d", 
smçcode
);

1162 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1166 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_xﬂuth2_mesßge
(
c⁄n
->
d©a
, c⁄n->
u£r
,

1167 
c⁄n
->
xﬂuth2_bóªr
,

1168 &
xﬂuth
, &
Àn
);

1169 if(!
ªsu…
 && 
xﬂuth
) {

1171 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", 
xﬂuth
);

1173 if(!
ªsu…
)

1174 
	`°©e
(
c⁄n
, 
SMTP_AUTH_FINAL
);

1178 
	`Cuæ_ß„‰ì
(
xﬂuth
);

1180  
ªsu…
;

1181 
	}
}

1184 
CURLcode
 
	$smç_°©e_auth_ˇn˚l_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1185 
smçcode
,

1186 
smç°©e
 
ö°©e
)

1188 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1189 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1190 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

1191 c⁄° *
mech
 = 
NULL
;

1192 *
öôª•
 = 
NULL
;

1193 
size_t
 
Àn
 = 0;

1194 
smç°©e
 
°©e1
 = 
SMTP_STOP
;

1195 
smç°©e
 
°©e2
 = 
SMTP_STOP
;

1197 ()
smçcode
;

1198 ()
ö°©e
;

1201 
smçc
->
authmechs
 ^smçc->
authu£d
;

1204 
ªsu…
 = 
	`smç_ˇlc_ß¶_dëaûs
(
c⁄n
, &
mech
, &
öôª•
, &
Àn
, &
°©e1
,

1205 &
°©e2
);

1207 if(!
ªsu…
) {

1209 if(
mech
) {

1211 
ªsu…
 = 
	`smç_≥rf‹m_auth
(
c⁄n
, 
mech
, 
öôª•
, 
Àn
, 
°©e1
, 
°©e2
);

1213 
	`Cuæ_ß„‰ì
(
öôª•
);

1216 
	`Áûf
(
d©a
, "Authentication cancelled");

1218 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1222  
ªsu…
;

1223 
	}
}

1226 
CURLcode
 
	$smç_°©e_auth_föÆ_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1227 
smçcode
,

1228 
smç°©e
 
ö°©e
)

1230 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1231 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1233 ()
ö°©e
;

1235 if(
smçcode
 != 235) {

1236 
	`Áûf
(
d©a
, "Authítiˇti⁄ faûed: %d", 
smçcode
);

1237 
ªsu…
 = 
CURLE_LOGIN_DENIED
;

1241 
	`°©e
(
c⁄n
, 
SMTP_STOP
);

1243  
ªsu…
;

1244 
	}
}

1247 
CURLcode
 
	$smç_°©e_comm™d_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
smçcode
,

1248 
smç°©e
 
ö°©e
)

1250 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1251 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1252 
SMTP
 *
smç
 = 
d©a
->
ªq
.
¥Ÿ›
;

1253 *
löe
 = 
d©a
->
°©e
.
buf„r
;

1254 
size_t
 
Àn
 = 
	`°æí
(
löe
);

1256 ()
ö°©e
;

1258 if((
smç
->
r˝t
 && 
smçcode
/100 != 2 && smtpcode != 553 && smtpcode != 1) ||

1259 (!
smç
->
r˝t
 && 
smçcode
/100 != 2 && smtpcode != 1)) {

1260 
	`Áûf
(
d©a
, "Comm™d faûed: %d", 
smçcode
);

1261 
ªsu…
 = 
CURLE_RECV_ERROR
;

1265 if(!
d©a
->
£t
.
›t_no_body
) {

1266 
löe
[
Àn
] = '\n';

1267 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
löe
, 
Àn
 + 1);

1268 
löe
[
Àn
] = '\0';

1271 if(
smçcode
 != 1) {

1272 if(
smç
->
r˝t
) {

1273 
smç
->
r˝t
 = smç->r˝t->
√xt
;

1275 if(
smç
->
r˝t
) {

1277 
ªsu…
 = 
	`smç_≥rf‹m_comm™d
(
c⁄n
);

1281 
	`°©e
(
c⁄n
, 
SMTP_STOP
);

1285 
	`°©e
(
c⁄n
, 
SMTP_STOP
);

1289  
ªsu…
;

1290 
	}
}

1293 
CURLcode
 
	$smç_°©e_maû_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
smçcode
,

1294 
smç°©e
 
ö°©e
)

1296 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1297 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1299 ()
ö°©e
;

1301 if(
smçcode
/100 != 2) {

1302 
	`Áûf
(
d©a
, "MAIL faûed: %d", 
smçcode
);

1303 
ªsu…
 = 
CURLE_SEND_ERROR
;

1307 
ªsu…
 = 
	`smç_≥rf‹m_r˝t_to
(
c⁄n
);

1309  
ªsu…
;

1310 
	}
}

1313 
CURLcode
 
	$smç_°©e_r˝t_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
smçcode
,

1314 
smç°©e
 
ö°©e
)

1316 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1317 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1318 
SMTP
 *
smç
 = 
d©a
->
ªq
.
¥Ÿ›
;

1320 ()
ö°©e
;

1322 if(
smçcode
/100 != 2) {

1323 
	`Áûf
(
d©a
, "RCPT faûed: %d", 
smçcode
);

1324 
ªsu…
 = 
CURLE_SEND_ERROR
;

1327 
smç
->
r˝t
 = smç->r˝t->
√xt
;

1329 if(
smç
->
r˝t
)

1331 
ªsu…
 = 
	`smç_≥rf‹m_r˝t_to
(
c⁄n
);

1334 
ªsu…
 = 
	`Cuæ_µ_£ndf
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, "%s", "DATA");

1336 if(!
ªsu…
)

1337 
	`°©e
(
c⁄n
, 
SMTP_DATA
);

1341  
ªsu…
;

1342 
	}
}

1345 
CURLcode
 
	$smç_°©e_d©a_ª•
(
c⁄√˘d©a
 *
c⁄n
, 
smçcode
,

1346 
smç°©e
 
ö°©e
)

1348 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1349 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1351 ()
ö°©e
;

1353 if(
smçcode
 != 354) {

1354 
	`Áûf
(
d©a
, "DATA faûed: %d", 
smçcode
);

1355 
ªsu…
 = 
CURLE_SEND_ERROR
;

1359 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, d©a->
°©e
.
öfûesize
);

1362 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, 
FIRSTSOCKET
, NULL);

1365 
	`°©e
(
c⁄n
, 
SMTP_STOP
);

1368  
ªsu…
;

1369 
	}
}

1373 
CURLcode
 
	$smç_°©e_po°d©a_ª•
(
c⁄√˘d©a
 *
c⁄n
,

1374 
smçcode
,

1375 
smç°©e
 
ö°©e
)

1377 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1379 ()
ö°©e
;

1381 if(
smçcode
 != 250)

1382 
ªsu…
 = 
CURLE_RECV_ERROR
;

1385 
	`°©e
(
c⁄n
, 
SMTP_STOP
);

1387  
ªsu…
;

1388 
	}
}

1390 
CURLcode
 
	$smç_°©emach_a˘
(
c⁄√˘d©a
 *
c⁄n
)

1392 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1393 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
FIRSTSOCKET
];

1394 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1395 
smçcode
;

1396 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

1397 
pögp⁄g
 *
µ
 = &
smçc
->pp;

1398 
size_t
 
ƒód
 = 0;

1401 if(
smçc
->
°©e
 =
SMTP_UPGRADETLS
)

1402  
	`smç_≥rf‹m_upgøde_és
(
c⁄n
);

1405 if(
µ
->
£ndÀ·
)

1406  
	`Cuæ_µ_Êush£nd
(
µ
);

1410 
ªsu…
 = 
	`Cuæ_µ_ªadª•
(
sock
, 
µ
, &
smçcode
, &
ƒód
);

1411 if(
ªsu…
)

1412  
ªsu…
;

1415 if(
smçc
->
°©e
 !
SMTP_QUIT
 && 
smçcode
 != 1)

1416 
d©a
->
öfo
.
hâpcode
 = 
smçcode
;

1418 if(!
smçcode
)

1422 
smçc
->
°©e
) {

1423 
SMTP_SERVERGREET
:

1424 
ªsu…
 = 
	`smç_°©e_£rvîgªë_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1427 
SMTP_EHLO
:

1428 
ªsu…
 = 
	`smç_°©e_ehlo_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1431 
SMTP_HELO
:

1432 
ªsu…
 = 
	`smç_°©e_hño_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1435 
SMTP_STARTTLS
:

1436 
ªsu…
 = 
	`smç_°©e_°¨âls_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1439 
SMTP_AUTH_PLAIN
:

1440 
ªsu…
 = 
	`smç_°©e_auth_∂aö_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1443 
SMTP_AUTH_LOGIN
:

1444 
ªsu…
 = 
	`smç_°©e_auth_logö_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1447 
SMTP_AUTH_LOGIN_PASSWD
:

1448 
ªsu…
 = 
	`smç_°©e_auth_logö_∑ssw‹d_ª•
(
c⁄n
, 
smçcode
,

1449 
smçc
->
°©e
);

1452 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


1453 
SMTP_AUTH_CRAMMD5
:

1454 
ªsu…
 = 
	`smç_°©e_auth_¸am_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1457 
SMTP_AUTH_DIGESTMD5
:

1458 
ªsu…
 = 
	`smç_°©e_auth_dige°_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1461 
SMTP_AUTH_DIGESTMD5_RESP
:

1462 
ªsu…
 = 
	`smç_°©e_auth_dige°_ª•_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1466 #ifde‡
USE_NTLM


1467 
SMTP_AUTH_NTLM
:

1468 
ªsu…
 = 
	`smç_°©e_auth_¡lm_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1471 
SMTP_AUTH_NTLM_TYPE2MSG
:

1472 
ªsu…
 = 
	`smç_°©e_auth_¡lm_ty≥2msg_ª•
(
c⁄n
, 
smçcode
,

1473 
smçc
->
°©e
);

1477 
SMTP_AUTH_XOAUTH2
:

1478 
ªsu…
 = 
	`smç_°©e_auth_xﬂuth2_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1481 
SMTP_AUTH_CANCEL
:

1482 
ªsu…
 = 
	`smç_°©e_auth_ˇn˚l_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1485 
SMTP_AUTH_FINAL
:

1486 
ªsu…
 = 
	`smç_°©e_auth_föÆ_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1489 
SMTP_COMMAND
:

1490 
ªsu…
 = 
	`smç_°©e_comm™d_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1493 
SMTP_MAIL
:

1494 
ªsu…
 = 
	`smç_°©e_maû_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1497 
SMTP_RCPT
:

1498 
ªsu…
 = 
	`smç_°©e_r˝t_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1501 
SMTP_DATA
:

1502 
ªsu…
 = 
	`smç_°©e_d©a_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1505 
SMTP_POSTDATA
:

1506 
ªsu…
 = 
	`smç_°©e_po°d©a_ª•
(
c⁄n
, 
smçcode
, 
smçc
->
°©e
);

1509 
SMTP_QUIT
:

1513 
	`°©e
(
c⁄n
, 
SMTP_STOP
);

1516 } !
ªsu…
 && 
smçc
->
°©e
 !
SMTP_STOP
 && 
	`Cuæ_µ_m‹ed©a
(
µ
));

1518  
ªsu…
;

1519 
	}
}

1522 
CURLcode
 
	$smç_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1524 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1525 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

1527 if((
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
Ë&& !
smçc
->
s¶d⁄e
) {

1528 
ªsu…
 = 
	`Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄n
, 
FIRSTSOCKET
, &
smçc
->
s¶d⁄e
);

1529 if(
ªsu…
 || !
smçc
->
s¶d⁄e
)

1530  
ªsu…
;

1533 
ªsu…
 = 
	`Cuæ_µ_°©emach
(&
smçc
->
µ
, 
FALSE
);

1534 *
d⁄e
 = (
smçc
->
°©e
 =
SMTP_STOP
Ë? 
TRUE
 : 
FALSE
;

1536  
ªsu…
;

1537 
	}
}

1539 
CURLcode
 
	$smç_block_°©emach
(
c⁄√˘d©a
 *
c⁄n
)

1541 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1542 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

1544 
smçc
->
°©e
 !
SMTP_STOP
 && !
ªsu…
)

1545 
ªsu…
 = 
	`Cuæ_µ_°©emach
(&
smçc
->
µ
, 
TRUE
);

1547  
ªsu…
;

1548 
	}
}

1552 
CURLcode
 
	$smç_öô
(
c⁄√˘d©a
 *
c⁄n
)

1554 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1555 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1556 
SMTP
 *
smç
;

1558 
smç
 = 
d©a
->
ªq
.
¥Ÿ›
 = 
	`ˇŒoc
((
SMTP
), 1);

1559 if(!
smç
)

1560 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1562  
ªsu…
;

1563 
	}
}

1566 
	$smç_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

1567 
numsocks
)

1569  
	`Cuæ_µ_gësock
(&
c⁄n
->
¥Ÿo
.
smçc
.
µ
, 
socks
, 
numsocks
);

1570 
	}
}

1582 
CURLcode
 
	$smç_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1584 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1585 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

1586 
pögp⁄g
 *
µ
 = &
smçc
->pp;

1588 *
d⁄e
 = 
FALSE
;

1591 
	`c⁄nkìp
(
c⁄n
, "SMTP default");

1594 
µ
->
ª•⁄£_time
 = 
RESP_TIMEOUT
;

1595 
µ
->
°©emach_a˘
 = 
smç_°©emach_a˘
;

1596 
µ
->
ído‰e•
 = 
smç_ído‰e•
;

1597 
µ
->
c⁄n
 = conn;

1600 
smçc
->
¥efmech
 = 
SASL_AUTH_ANY
;

1603 
	`Cuæ_µ_öô
(
µ
);

1606 
ªsu…
 = 
	`smç_∑r£_uæ_›ti⁄s
(
c⁄n
);

1607 if(
ªsu…
)

1608  
ªsu…
;

1611 
ªsu…
 = 
	`smç_∑r£_uæ_∑th
(
c⁄n
);

1612 if(
ªsu…
)

1613  
ªsu…
;

1616 
	`°©e
(
c⁄n
, 
SMTP_SERVERGREET
);

1618 
ªsu…
 = 
	`smç_mu…i_°©emach
(
c⁄n
, 
d⁄e
);

1620  
ªsu…
;

1621 
	}
}

1632 
CURLcode
 
	$smç_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
°©us
,

1633 
boﬁ
 
¥em©uª
)

1635 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1636 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1637 
SMTP
 *
smç
 = 
d©a
->
ªq
.
¥Ÿ›
;

1638 
pögp⁄g
 *
µ
 = &
c⁄n
->
¥Ÿo
.
smçc
.pp;

1639 c⁄° *
eob
;

1640 
ssize_t
 
Àn
;

1641 
ssize_t
 
byãs_wrôãn
;

1643 ()
¥em©uª
;

1645 if(!
smç
)

1650  
CURLE_OK
;

1652 if(
°©us
) {

1653 
	`c⁄n˛o£
(
c⁄n
, "SMTP done with bad status");

1654 
ªsu…
 = 
°©us
;

1656 if(!
d©a
->
£t
.
c⁄√˘_⁄ly
 && d©a->£t.
u∂ﬂd
 && d©a->£t.
maû_r˝t
) {

1660 
eob
 = 
SMTP_EOB
;

1661 
Àn
 = 
SMTP_EOB_LEN
;

1662 if(
smç
->
åaûög_¸lf
 || !
c⁄n
->
d©a
->
°©e
.
öfûesize
) {

1663 
eob
 += 2;

1664 
Àn
 -= 2;

1668 
ªsu…
 = 
	`Cuæ_wrôe
(
c⁄n
, c⁄n->
wrôesockfd
, 
eob
, 
Àn
, &
byãs_wrôãn
);

1669 if(
ªsu…
)

1670  
ªsu…
;

1672 if(
byãs_wrôãn
 !
Àn
) {

1675 
µ
->
£ndthis
 = 
	`°rdup
(
eob
);

1676 
µ
->
£ndsize
 = 
Àn
;

1677 
µ
->
£ndÀ·
 = 
Àn
 - 
byãs_wrôãn
;

1681 
µ
->
ª•⁄£
 = 
	`Cuæ_tvnow
();

1683 
	`°©e
(
c⁄n
, 
SMTP_POSTDATA
);

1692 
ªsu…
 = 
	`smç_block_°©emach
(
c⁄n
);

1696 
	`Cuæ_ß„‰ì
(
smç
->
cu°om
);

1699 
smç
->
å™s„r
 = 
FTPTRANSFER_BODY
;

1701  
ªsu…
;

1702 
	}
}

1711 
CURLcode
 
	$smç_≥rf‹m
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
c⁄√˘ed
,

1712 
boﬁ
 *
d›ha£_d⁄e
)

1715 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1716 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1717 
SMTP
 *
smç
 = 
d©a
->
ªq
.
¥Ÿ›
;

1719 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase starts\n"));

1721 if(
d©a
->
£t
.
›t_no_body
) {

1723 
smç
->
å™s„r
 = 
FTPTRANSFER_INFO
;

1726 *
d›ha£_d⁄e
 = 
FALSE
;

1729 
smç
->
r˝t
 = 
d©a
->
£t
.
maû_r˝t
;

1732 if(
d©a
->
£t
.
u∂ﬂd
 && d©a->£t.
maû_r˝t
)

1734 
ªsu…
 = 
	`smç_≥rf‹m_maû
(
c⁄n
);

1737 
ªsu…
 = 
	`smç_≥rf‹m_comm™d
(
c⁄n
);

1739 if(
ªsu…
)

1740  
ªsu…
;

1743 
ªsu…
 = 
	`smç_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

1745 *
c⁄√˘ed
 = 
c⁄n
->
bôs
.
t˝c⁄√˘
[
FIRSTSOCKET
];

1747 if(*
d›ha£_d⁄e
)

1748 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

1750  
ªsu…
;

1751 
	}
}

1762 
CURLcode
 
	$smç_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1764 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1766 *
d⁄e
 = 
FALSE
;

1769 
ªsu…
 = 
	`smç_∑r£_cu°om_ªque°
(
c⁄n
);

1770 if(
ªsu…
)

1771  
ªsu…
;

1773 
ªsu…
 = 
	`smç_ªguœr_å™s„r
(
c⁄n
, 
d⁄e
);

1775  
ªsu…
;

1776 
	}
}

1785 
CURLcode
 
	$smç_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
)

1787 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

1795 if(!
dód_c⁄√˘i⁄
 && 
smçc
->
µ
.
c⁄n
 && smçc->µ.c⁄n->
bôs
.
¥Ÿoc⁄n°¨t
)

1796 if(!
	`smç_≥rf‹m_quô
(
c⁄n
))

1797 ()
	`smç_block_°©emach
(
c⁄n
);

1800 
	`Cuæ_µ_disc⁄√˘
(&
smçc
->
µ
);

1803 
	`Cuæ_ß¶_˛ónup
(
c⁄n
, 
smçc
->
authu£d
);

1806 
	`Cuæ_ß„‰ì
(
smçc
->
domaö
);

1808  
CURLE_OK
;

1809 
	}
}

1812 
CURLcode
 
	$smç_d›ha£_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
c⁄√˘ed
)

1814 
SMTP
 *
smç
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

1816 ()
c⁄√˘ed
;

1818 if(
smç
->
å™s„r
 !
FTPTRANSFER_BODY
)

1820 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

1822  
CURLE_OK
;

1823 
	}
}

1826 
CURLcode
 
	$smç_doög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d›ha£_d⁄e
)

1828 
CURLcode
 
ªsu…
 = 
	`smç_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

1830 if(
ªsu…
)

1831 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase failed\n"));

1832 if(*
d›ha£_d⁄e
) {

1833 
ªsu…
 = 
	`smç_d›ha£_d⁄e
(
c⁄n
, 
FALSE
 );

1835 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

1838  
ªsu…
;

1839 
	}
}

1850 
CURLcode
 
	$smç_ªguœr_å™s„r
(
c⁄√˘d©a
 *
c⁄n
,

1851 
boﬁ
 *
d›ha£_d⁄e
)

1853 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1854 
boﬁ
 
c⁄√˘ed
 = 
FALSE
;

1855 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1858 
d©a
->
ªq
.
size
 = -1;

1861 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 0);

1862 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, 0);

1863 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 0);

1864 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 0);

1867 
ªsu…
 = 
	`smç_≥rf‹m
(
c⁄n
, &
c⁄√˘ed
, 
d›ha£_d⁄e
);

1870 if(!
ªsu…
 && *
d›ha£_d⁄e
)

1871 
ªsu…
 = 
	`smç_d›ha£_d⁄e
(
c⁄n
, 
c⁄√˘ed
);

1873  
ªsu…
;

1874 
	}
}

1876 
CURLcode
 
	$smç_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
)

1878 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1879 
CURLcode
 
ªsu…
;

1881 if(
c⁄n
->
bôs
.
hâµroxy
 && !
d©a
->
£t
.
tu¬ñ_thru_hâµroxy
) {

1884 #i‚de‡
CURL_DISABLE_HTTP


1885 if(
c⁄n
->
h™dÀr
 =&
Cuæ_h™dÀr_smç
)

1886 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_smç_¥oxy
;

1888 #ifde‡
USE_SSL


1889 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_smçs_¥oxy
;

1891 
	`Áûf
(
d©a
, "SMTPSÇot supported!");

1892  
CURLE_UNSUPPORTED_PROTOCOL
;

1896  
c⁄n
->
h™dÀr
->
	`£tup_c⁄√˘i⁄
(conn);

1899 
	`Áûf
(
d©a
, "SMTP over httpÖroxyÑequires HTTP support built-in!");

1900  
CURLE_UNSUPPORTED_PROTOCOL
;

1905 
ªsu…
 = 
	`smç_öô
(
c⁄n
);

1906 if(
ªsu…
)

1907  
ªsu…
;

1909 
d©a
->
°©e
.
∑th
++;

1911  
CURLE_OK
;

1912 
	}
}

1920 
CURLcode
 
	$smç_∑r£_uæ_›ti⁄s
(
c⁄√˘d©a
 *
c⁄n
)

1922 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1923 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

1924 c⁄° *
›ti⁄s
 = 
c⁄n
->options;

1925 c⁄° *
±r
 = 
›ti⁄s
;

1926 
boﬁ
 
ª£t
 = 
TRUE
;

1928 
±r
 && *ptr) {

1929 c⁄° *
key
 = 
±r
;

1931 *
±r
 && *ptr != '=')

1932 
±r
++;

1934 if(
	`°∫equÆ
(
key
, "AUTH", 4)) {

1935 
size_t
 
Àn
 = 0;

1936 c⁄° *
vÆue
 = ++
±r
;

1938 if(
ª£t
) {

1939 
ª£t
 = 
FALSE
;

1940 
smçc
->
¥efmech
 = 
SASL_AUTH_NONE
;

1943 *
±r
 && *ptr != ';') {

1944 
±r
++;

1945 
Àn
++;

1948 if(
	`°∫equÆ
(
vÆue
, "*", 
Àn
))

1949 
smçc
->
¥efmech
 = 
SASL_AUTH_ANY
;

1950 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_LOGIN
, 
Àn
))

1951 
smçc
->
¥efmech
 |
SASL_MECH_LOGIN
;

1952 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_PLAIN
, 
Àn
))

1953 
smçc
->
¥efmech
 |
SASL_MECH_PLAIN
;

1954 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_CRAM_MD5
, 
Àn
))

1955 
smçc
->
¥efmech
 |
SASL_MECH_CRAM_MD5
;

1956 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_DIGEST_MD5
, 
Àn
))

1957 
smçc
->
¥efmech
 |
SASL_MECH_DIGEST_MD5
;

1958 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_GSSAPI
, 
Àn
))

1959 
smçc
->
¥efmech
 |
SASL_MECH_GSSAPI
;

1960 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_NTLM
, 
Àn
))

1961 
smçc
->
¥efmech
 |
SASL_MECH_NTLM
;

1962 if(
	`°∫equÆ
(
vÆue
, 
SASL_MECH_STRING_XOAUTH2
, 
Àn
))

1963 
smçc
->
¥efmech
 |
SASL_MECH_XOAUTH2
;

1965 if(*
±r
 == ';')

1966 
±r
++;

1969 
ªsu…
 = 
CURLE_URL_MALFORMAT
;

1972  
ªsu…
;

1973 
	}
}

1981 
CURLcode
 
	$smç_∑r£_uæ_∑th
(
c⁄√˘d©a
 *
c⁄n
)

1984 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1985 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

1986 c⁄° *
∑th
 = 
d©a
->
°©e
.path;

1987 
loˇlho°
[
HOSTNAME_MAX
 + 1];

1990 if(!*
∑th
) {

1991 if(!
	`Cuæ_gëho°«me
(
loˇlho°
, (localhost)))

1992 
∑th
 = 
loˇlho°
;

1994 
∑th
 = "localhost";

1998  
	`Cuæ_uædecode
(
c⁄n
->
d©a
, 
∑th
, 0, &
smçc
->
domaö
, 
NULL
, 
TRUE
);

1999 
	}
}

2007 
CURLcode
 
	$smç_∑r£_cu°om_ªque°
(
c⁄√˘d©a
 *
c⁄n
)

2009 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2010 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2011 
SMTP
 *
smç
 = 
d©a
->
ªq
.
¥Ÿ›
;

2012 c⁄° *
cu°om
 = 
d©a
->
£t
.
°r
[
STRING_CUSTOMREQUEST
];

2015 if(
cu°om
)

2016 
ªsu…
 = 
	`Cuæ_uædecode
(
d©a
, 
cu°om
, 0, &
smç
->cu°om, 
NULL
, 
TRUE
);

2018  
ªsu…
;

2019 
	}
}

2027 
CURLcode
 
	$smç_ˇlc_ß¶_dëaûs
(
c⁄√˘d©a
 *
c⁄n
,

2028 c⁄° **
mech
,

2029 **
öôª•
, 
size_t
 *
Àn
,

2030 
smç°©e
 *
°©e1
, smç°©ê*
°©e2
)

2032 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2033 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2034 
smç_c⁄n
 *
smçc
 = &
c⁄n
->
¥Ÿo
.smtpc;

2038 #i‚de‡
CURL_DISABLE_CRYPTO_AUTH


2039 if((
smçc
->
authmechs
 & 
SASL_MECH_DIGEST_MD5
) &&

2040 (
smçc
->
¥efmech
 & 
SASL_MECH_DIGEST_MD5
)) {

2041 *
mech
 = 
SASL_MECH_STRING_DIGEST_MD5
;

2042 *
°©e1
 = 
SMTP_AUTH_DIGESTMD5
;

2043 
smçc
->
authu£d
 = 
SASL_MECH_DIGEST_MD5
;

2045 if((
smçc
->
authmechs
 & 
SASL_MECH_CRAM_MD5
) &&

2046 (
smçc
->
¥efmech
 & 
SASL_MECH_CRAM_MD5
)) {

2047 *
mech
 = 
SASL_MECH_STRING_CRAM_MD5
;

2048 *
°©e1
 = 
SMTP_AUTH_CRAMMD5
;

2049 
smçc
->
authu£d
 = 
SASL_MECH_CRAM_MD5
;

2053 #ifde‡
USE_NTLM


2054 if((
smçc
->
authmechs
 & 
SASL_MECH_NTLM
) &&

2055 (
smçc
->
¥efmech
 & 
SASL_MECH_NTLM
)) {

2056 *
mech
 = 
SASL_MECH_STRING_NTLM
;

2057 *
°©e1
 = 
SMTP_AUTH_NTLM
;

2058 *
°©e2
 = 
SMTP_AUTH_NTLM_TYPE2MSG
;

2059 
smçc
->
authu£d
 = 
SASL_MECH_NTLM
;

2061 if(
d©a
->
£t
.
ß¶_ú
)

2062 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_¡lm_ty≥1_mesßge
(
c⁄n
->
u£r
, c⁄n->
∑sswd
,

2063 &
c⁄n
->
¡lm
,

2064 
öôª•
, 
Àn
);

2068 if(((
smçc
->
authmechs
 & 
SASL_MECH_XOAUTH2
) &&

2069 (
smçc
->
¥efmech
 & 
SASL_MECH_XOAUTH2
) &&

2070 (
smçc
->
¥efmech
 !
SASL_AUTH_ANY
)Ë|| 
c⁄n
->
xﬂuth2_bóªr
) {

2071 *
mech
 = 
SASL_MECH_STRING_XOAUTH2
;

2072 *
°©e1
 = 
SMTP_AUTH_XOAUTH2
;

2073 *
°©e2
 = 
SMTP_AUTH_FINAL
;

2074 
smçc
->
authu£d
 = 
SASL_MECH_XOAUTH2
;

2076 if(
d©a
->
£t
.
ß¶_ú
)

2077 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_xﬂuth2_mesßge
(
d©a
, 
c⁄n
->
u£r
,

2078 
c⁄n
->
xﬂuth2_bóªr
,

2079 
öôª•
, 
Àn
);

2081 if((
smçc
->
authmechs
 & 
SASL_MECH_LOGIN
) &&

2082 (
smçc
->
¥efmech
 & 
SASL_MECH_LOGIN
)) {

2083 *
mech
 = 
SASL_MECH_STRING_LOGIN
;

2084 *
°©e1
 = 
SMTP_AUTH_LOGIN
;

2085 *
°©e2
 = 
SMTP_AUTH_LOGIN_PASSWD
;

2086 
smçc
->
authu£d
 = 
SASL_MECH_LOGIN
;

2088 if(
d©a
->
£t
.
ß¶_ú
)

2089 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_logö_mesßge
(
d©a
, 
c⁄n
->
u£r
, 
öôª•
, 
Àn
);

2091 if((
smçc
->
authmechs
 & 
SASL_MECH_PLAIN
) &&

2092 (
smçc
->
¥efmech
 & 
SASL_MECH_PLAIN
)) {

2093 *
mech
 = 
SASL_MECH_STRING_PLAIN
;

2094 *
°©e1
 = 
SMTP_AUTH_PLAIN
;

2095 *
°©e2
 = 
SMTP_AUTH_FINAL
;

2096 
smçc
->
authu£d
 = 
SASL_MECH_PLAIN
;

2098 if(
d©a
->
£t
.
ß¶_ú
)

2099 
ªsu…
 = 
	`Cuæ_ß¶_¸óã_∂aö_mesßge
(
d©a
, 
c⁄n
->
u£r
, c⁄n->
∑sswd
,

2100 
öôª•
, 
Àn
);

2103  
ªsu…
;

2104 
	}
}

2106 
CURLcode
 
	$Cuæ_smç_esˇ≥_eob
(
c⁄√˘d©a
 *
c⁄n
, 
ssize_t
 
ƒód
)

2114 
ssize_t
 
i
;

2115 
ssize_t
 
si
;

2116 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2117 
SMTP
 *
smç
 = 
d©a
->
ªq
.
¥Ÿ›
;

2120 if(!
d©a
->
°©e
.
s¸©ch
) {

2121 
d©a
->
°©e
.
s¸©ch
 = 
	`mÆloc
(2 * 
BUFSIZE
);

2123 if(!
d©a
->
°©e
.
s¸©ch
) {

2124 
	`Áûf
 (
d©a
, "FailedÅoálloc scratch buffer!");

2125  
CURLE_OUT_OF_MEMORY
;

2131 
i
 = 0, 
si
 = 0; i < 
ƒód
; i++) {

2132 if(
SMTP_EOB
[
smç
->
eob
] =
d©a
->
ªq
.
u∂ﬂd_‰omhîe
[
i
]) {

2133 
smç
->
eob
++;

2136 if(2 =
smç
->
eob
 || 
SMTP_EOB_LEN
 == smtp->eob)

2137 
smç
->
åaûög_¸lf
 = 
TRUE
;

2139 
smç
->
åaûög_¸lf
 = 
FALSE
;

2141 if(
smç
->
eob
) {

2143 
	`mem˝y
(&
d©a
->
°©e
.
s¸©ch
[
si
], 
SMTP_EOB
, 
smç
->
eob
);

2144 
si
 +
smç
->
eob
;

2147 if(
SMTP_EOB
[0] =
d©a
->
ªq
.
u∂ﬂd_‰omhîe
[
i
])

2148 
smç
->
eob
 = 1;

2150 
smç
->
eob
 = 0;

2153 
smç
->
åaûög_¸lf
 = 
FALSE
;

2157 if(
SMTP_EOB_FIND_LEN
 =
smç
->
eob
) {

2159 
	`mem˝y
(&
d©a
->
°©e
.
s¸©ch
[
si
], 
SMTP_EOB_REPL
, 
SMTP_EOB_REPL_LEN
);

2160 
si
 +
SMTP_EOB_REPL_LEN
;

2161 
smç
->
eob
 = 0;

2163 if(!
smç
->
eob
)

2164 
d©a
->
°©e
.
s¸©ch
[
si
++] = d©a->
ªq
.
u∂ﬂd_‰omhîe
[
i
];

2167 if(
smç
->
eob
) {

2169 
	`mem˝y
(&
d©a
->
°©e
.
s¸©ch
[
si
], 
SMTP_EOB
, 
smç
->
eob
);

2170 
si
 +
smç
->
eob
;

2171 
smç
->
eob
 = 0;

2174 if(
si
 !
ƒód
) {

2176 
ƒód
 = 
si
;

2179 
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 = d©a->
°©e
.
s¸©ch
;

2182 
d©a
->
ªq
.
u∂ﬂd_¥e£¡
 = 
ƒód
;

2185  
CURLE_OK
;

2186 
	}
}

	@lib/smtp.h

1 #i‚de‡
HEADER_CURL_SMTP_H


2 
	#HEADER_CURL_SMTP_H


	)

25 
	~"pögp⁄g.h
"

31 
	mSMTP_STOP
,

32 
	mSMTP_SERVERGREET
,

34 
	mSMTP_EHLO
,

35 
	mSMTP_HELO
,

36 
	mSMTP_STARTTLS
,

37 
	mSMTP_UPGRADETLS
,

39 
	mSMTP_AUTH_PLAIN
,

40 
	mSMTP_AUTH_LOGIN
,

41 
	mSMTP_AUTH_LOGIN_PASSWD
,

42 
	mSMTP_AUTH_CRAMMD5
,

43 
	mSMTP_AUTH_DIGESTMD5
,

44 
	mSMTP_AUTH_DIGESTMD5_RESP
,

45 
	mSMTP_AUTH_NTLM
,

46 
	mSMTP_AUTH_NTLM_TYPE2MSG
,

47 
	mSMTP_AUTH_XOAUTH2
,

48 
	mSMTP_AUTH_CANCEL
,

49 
	mSMTP_AUTH_FINAL
,

50 
	mSMTP_COMMAND
,

51 
	mSMTP_MAIL
,

52 
	mSMTP_RCPT
,

53 
	mSMTP_DATA
,

54 
	mSMTP_POSTDATA
,

55 
	mSMTP_QUIT
,

56 
	mSMTP_LAST


57 } 
	tsmç°©e
;

63 
	sSMTP
 {

64 
cuæ_µ_å™s„r
 
	må™s„r
;

65 *
	mcu°om
;

66 
cuæ_¶i°
 *
	mr˝t
;

67 
size_t
 
	meob
;

69 
boﬁ
 
	måaûög_¸lf
;

74 
	ssmç_c⁄n
 {

75 
pögp⁄g
 
	mµ
;

76 
smç°©e
 
	m°©e
;

77 
boﬁ
 
	ms¶d⁄e
;

78 *
	mdomaö
;

79 
	mauthmechs
;

80 
	m¥efmech
;

81 
	mauthu£d
;

82 
boﬁ
 
	més_suµ‹ãd
;

83 
boﬁ
 
	msize_suµ‹ãd
;

85 
boﬁ
 
	mauth_suµ‹ãd
;

88 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_smç
;

89 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_smçs
;

92 
	#SMTP_EOB
 "\x0d\x0a\x2e\x0d\x0a"

	)

93 
	#SMTP_EOB_LEN
 5

	)

94 
	#SMTP_EOB_FIND_LEN
 3

	)

97 
	#SMTP_EOB_REPL
 "\x0d\x0a\x2e\x2e"

	)

98 
	#SMTP_EOB_REPL_LEN
 4

	)

100 
CURLcode
 
Cuæ_smç_esˇ≥_eob
(
c⁄√˘d©a
 *
c⁄n
, 
ssize_t
 
ƒód
);

	@lib/sockaddr.h

1 #i‚de‡
HEADER_CURL_SOCKADDR_H


2 
	#HEADER_CURL_SOCKADDR_H


	)

25 
	~"cuæ_£tup.h
"

27 
	sCuæ_sockaddr_°‹age
 {

29 
sockaddr
 
	mß
;

30 
sockaddr_ö
 
	mß_ö
;

31 #ifde‡
ENABLE_IPV6


32 
sockaddr_ö6
 
	mß_ö6
;

34 #ifde‡
HAVE_STRUCT_SOCKADDR_STORAGE


35 
sockaddr_°‹age
 
	mß_°‹
;

37 
	mcbuf
[256];

39 } 
	mbuf„r
;

	@lib/socks.c

23 
	~"cuæ_£tup.h
"

25 #i‡!
deföed
(
CURL_DISABLE_PROXY
)

27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

30 #ifde‡
HAVE_ARPA_INET_H


31 
	~<¨∑/öë.h
>

34 
	~"uæd©a.h
"

35 
	~"£ndf.h
"

36 
	~"°ªquÆ.h
"

37 
	~"£À˘.h
"

38 
	~"c⁄√˘.h
"

39 
	~"timevÆ.h
"

40 
	~"socks.h
"

43 
	~"memdebug.h
"

52 
	$Cuæ_blockªad_Æl
(
c⁄√˘d©a
 *
c⁄n
,

53 
cuæ_sockë_t
 
sockfd
,

54 *
buf
,

55 
ssize_t
 
buf„rsize
,

56 
ssize_t
 *
n
)

58 
ssize_t
 
ƒód
;

59 
ssize_t
 
ÆÃód
 = 0;

60 
ªsu…
;

61 
timñe·
;

62 *
n
 = 0;

64 
timñe·
 = 
	`Cuæ_timñe·
(
c⁄n
->
d©a
, 
NULL
, 
TRUE
);

65 if(
timñe·
 < 0) {

67 
ªsu…
 = 
CURLE_OPERATION_TIMEDOUT
;

70 if(
	`Cuæ_sockë_ªady
(
sockfd
, 
CURL_SOCKET_BAD
, 
timñe·
) <= 0) {

71 
ªsu…
 = ~
CURLE_OK
;

74 
ªsu…
 = 
	`Cuæ_ªad_∂aö
(
sockfd
, 
buf
, 
buf„rsize
, &
ƒód
);

75 if(
CURLE_AGAIN
 =
ªsu…
)

77 if(
ªsu…
)

80 if(
buf„rsize
 =
ƒód
) {

81 
ÆÃód
 +
ƒód
;

82 *
n
 = 
ÆÃód
;

83 
ªsu…
 = 
CURLE_OK
;

86 if(!
ƒód
) {

87 
ªsu…
 = ~
CURLE_OK
;

91 
buf„rsize
 -
ƒód
;

92 
buf
 +
ƒód
;

93 
ÆÃód
 +
ƒód
;

95  
ªsu…
;

96 
	}
}

109 
CURLcode
 
	$Cuæ_SOCKS4
(c⁄° *
¥oxy_«me
,

110 c⁄° *
ho°«me
,

111 
ªmŸe_p‹t
,

112 
socködex
,

113 
c⁄√˘d©a
 *
c⁄n
,

114 
boﬁ
 
¥Ÿocﬁ4a
)

116 
	#SOCKS4REQLEN
 262

	)

117 
sock§eq
[
SOCKS4REQLEN
];

119 
ªsu…
;

120 
CURLcode
 
code
;

121 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
socködex
];

122 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

124 if(
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
) < 0) {

126 
	`Áûf
(
d©a
, "ConnectionÅime-out");

127  
CURLE_OPERATION_TIMEDOUT
;

130 
	`cuæx_n⁄block
(
sock
, 
FALSE
);

132 
	`öfof
(
d©a
, "SOCKS4 communiˇti⁄Åÿ%s:%d\n", 
ho°«me
, 
ªmŸe_p‹t
);

145 
sock§eq
[0] = 4;

146 
sock§eq
[1] = 1;

147 
sock§eq
[2] = ()((
ªmŸe_p‹t
 >> 8) & 0xff);

148 
sock§eq
[3] = ()(
ªmŸe_p‹t
 & 0xff);

151 if(!
¥Ÿocﬁ4a
) {

152 
Cuæ_dns_íåy
 *
dns
;

153 
Cuæ_addröfo
 *
hp
=
NULL
;

154 
rc
;

156 
rc
 = 
	`Cuæ_ªsﬁv
(
c⁄n
, 
ho°«me
, 
ªmŸe_p‹t
, &
dns
);

158 if(
rc
 =
CURLRESOLV_ERROR
)

159  
CURLE_COULDNT_RESOLVE_PROXY
;

161 if(
rc
 =
CURLRESOLV_PENDING
)

163 ()
	`Cuæ_ªsﬁvî_waô_ªsﬁv
(
c⁄n
, &
dns
);

169 if(
dns
)

170 
hp
=
dns
->
addr
;

171 if(
hp
) {

172 
buf
[64];

173 
ù
[4];

174 
	`Cuæ_¥öèbÀ_addªss
(
hp
, 
buf
, (buf));

176 if(4 =
	`ssˇnf
–
buf
, "%hu.%hu.%hu.%hu",

177 &
ù
[0], &ip[1], &ip[2], &ip[3])) {

179 
sock§eq
[4] = ()
ù
[0];

180 
sock§eq
[5] = ()
ù
[1];

181 
sock§eq
[6] = ()
ù
[2];

182 
sock§eq
[7] = ()
ù
[3];

185 
hp
 = 
NULL
;

187 
	`öfof
(
d©a
, "SOCKS4 c⁄√˘Åÿ%†÷oˇŒyÑesﬁved)\n", 
buf
);

189 
	`Cuæ_ªsﬁv_u∆ock
(
d©a
, 
dns
);

192 if(!
hp
) {

193 
	`Áûf
(
d©a
, "FailedÅoÑesolve \"%s\" for SOCKS4 connect.",

194 
ho°«me
);

195  
CURLE_COULDNT_RESOLVE_HOST
;

202 
sock§eq
[8] = 0;

203 if(
¥oxy_«me
) {

204 
size_t
 
∂í
 = 
	`°æí
(
¥oxy_«me
);

205 if(
∂í
 >(
sock§eq
) - 8) {

206 
	`Áûf
(
d©a
, "TooÜong SOCKSÖroxyÇame, can't use!\n");

207  
CURLE_COULDNT_CONNECT
;

210 
	`mem˝y
(
sock§eq
 + 8, 
¥oxy_«me
, 
∂í
+1);

217 
ssize_t
 
a˘uÆªad
;

218 
ssize_t
 
wrôãn
;

219 
ssize_t
 
ho°«mñí
 = 0;

220 
∑ckësize
 = 9 +

221 ()
	`°æí
((*)
sock§eq
 + 8);

224 if(
¥Ÿocﬁ4a
) {

225 
sock§eq
[4] = 0;

226 
sock§eq
[5] = 0;

227 
sock§eq
[6] = 0;

228 
sock§eq
[7] = 1;

230 
ho°«mñí
 = (
ssize_t
)
	`°æí
(
ho°«me
) + 1;

231 if(
∑ckësize
 + 
ho°«mñí
 <
SOCKS4REQLEN
)

232 
	`°r˝y
((*)
sock§eq
 + 
∑ckësize
, 
ho°«me
);

234 
ho°«mñí
 = 0;

238 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
sock§eq
,

239 
∑ckësize
 + 
ho°«mñí
,

240 &
wrôãn
);

241 if((
code
 !
CURLE_OK
Ë|| (
wrôãn
 !
∑ckësize
 + 
ho°«mñí
)) {

242 
	`Áûf
(
d©a
, "FailedÅo send SOCKS4 connectÑequest.");

243  
CURLE_COULDNT_CONNECT
;

245 if(
¥Ÿocﬁ4a
 && 
ho°«mñí
 == 0) {

247 
ho°«mñí
 = (
ssize_t
)
	`°æí
(
ho°«me
) + 1;

248 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
ho°«me
, 
ho°«mñí
,

249 &
wrôãn
);

250 if((
code
 !
CURLE_OK
Ë|| (
wrôãn
 !
ho°«mñí
)) {

251 
	`Áûf
(
d©a
, "FailedÅo send SOCKS4 connectÑequest.");

252  
CURLE_COULDNT_CONNECT
;

256 
∑ckësize
 = 8;

259 
ªsu…
 = 
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
sock§eq
, 
∑ckësize
,

260 &
a˘uÆªad
);

261 if((
ªsu…
 !
CURLE_OK
Ë|| (
a˘uÆªad
 !
∑ckësize
)) {

262 
	`Áûf
(
d©a
, "FailedÅoÑeceive SOCKS4 connectÑequestáck.");

263  
CURLE_COULDNT_CONNECT
;

286 if(
sock§eq
[0] != 0) {

287 
	`Áûf
(
d©a
,

289  
CURLE_COULDNT_CONNECT
;

293 
sock§eq
[1]) {

295 
	`öfof
(
d©a
, "SOCKS4%†ªque° gø¡ed.\n", 
¥Ÿocﬁ4a
?"a":"");

298 
	`Áûf
(
d©a
,

301 ()
sock§eq
[4], ()socksreq[5],

302 ()
sock§eq
[6], ()socksreq[7],

303 ((
sock§eq
[8] << 8) | socksreq[9]),

304 
sock§eq
[1]);

305  
CURLE_COULDNT_CONNECT
;

307 
	`Áûf
(
d©a
,

311 ()
sock§eq
[4], ()socksreq[5],

312 ()
sock§eq
[6], ()socksreq[7],

313 ((
sock§eq
[8] << 8) | socksreq[9]),

314 
sock§eq
[1]);

315  
CURLE_COULDNT_CONNECT
;

317 
	`Áûf
(
d©a
,

321 ()
sock§eq
[4], ()socksreq[5],

322 ()
sock§eq
[6], ()socksreq[7],

323 ((
sock§eq
[8] << 8) | socksreq[9]),

324 
sock§eq
[1]);

325  
CURLE_COULDNT_CONNECT
;

327 
	`Áûf
(
d©a
,

330 ()
sock§eq
[4], ()socksreq[5],

331 ()
sock§eq
[6], ()socksreq[7],

332 ((
sock§eq
[8] << 8) | socksreq[9]),

333 
sock§eq
[1]);

334  
CURLE_COULDNT_CONNECT
;

338 
	`cuæx_n⁄block
(
sock
, 
TRUE
);

340  
CURLE_OK
;

341 
	}
}

347 
CURLcode
 
	$Cuæ_SOCKS5
(c⁄° *
¥oxy_«me
,

348 c⁄° *
¥oxy_∑ssw‹d
,

349 c⁄° *
ho°«me
,

350 
ªmŸe_p‹t
,

351 
socködex
,

352 
c⁄√˘d©a
 *
c⁄n
)

371 
sock§eq
[600];

372 
ssize_t
 
a˘uÆªad
;

373 
ssize_t
 
wrôãn
;

374 
ªsu…
;

375 
CURLcode
 
code
;

376 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
socködex
];

377 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

378 
timeout
;

379 
boﬁ
 
socks5_ªsﬁve_loˇl
 = (
c⁄n
->
¥oxyty≥
 =
CURLPROXY_SOCKS5
)?
TRUE
:
FALSE
;

380 c⁄° 
size_t
 
ho°«me_Àn
 = 
	`°æí
(
ho°«me
);

381 
ssize_t
 
Àn
 = 0;

384 if(!
socks5_ªsﬁve_loˇl
 && 
ho°«me_Àn
 > 255) {

385 
	`öfof
(
c⁄n
->
d©a
,"SOCKS5: serverÑesolving disabled for hostnames of "

386 "Àngth > 255 [a˘uÆÜí=%zu]\n", 
ho°«me_Àn
);

387 
socks5_ªsﬁve_loˇl
 = 
TRUE
;

391 
timeout
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

393 if(
timeout
 < 0) {

395 
	`Áûf
(
d©a
, "ConnectionÅime-out");

396  
CURLE_OPERATION_TIMEDOUT
;

399 
	`cuæx_n⁄block
(
sock
, 
TRUE
);

402 
ªsu…
 = 
	`Cuæ_sockë_ªady
(
CURL_SOCKET_BAD
, 
sock
, 
timeout
);

404 if(-1 =
ªsu…
) {

405 
	`Áûf
(
c⁄n
->
d©a
, "SOCKS5:Ço connection here");

406  
CURLE_COULDNT_CONNECT
;

408 if(0 =
ªsu…
) {

409 
	`Áûf
(
c⁄n
->
d©a
, "SOCKS5: connectionÅimeout");

410  
CURLE_OPERATION_TIMEDOUT
;

413 if(
ªsu…
 & 
CURL_CSELECT_ERR
) {

414 
	`Áûf
(
c⁄n
->
d©a
, "SOCKS5:Érror occurred during connection");

415  
CURLE_COULDNT_CONNECT
;

418 
sock§eq
[0] = 5;

419 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

420 
sock§eq
[1] = ()(
¥oxy_«me
 ? 3 : 2);

421 
sock§eq
[2] = 0;

422 
sock§eq
[3] = 1;

423 
sock§eq
[4] = 2;

425 
sock§eq
[1] = ()(
¥oxy_«me
 ? 2 : 1);

426 
sock§eq
[2] = 0;

427 
sock§eq
[3] = 2;

430 
	`cuæx_n⁄block
(
sock
, 
FALSE
);

432 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
sock§eq
, (2 + ()socksreq[1]),

433 &
wrôãn
);

434 if((
code
 !
CURLE_OK
Ë|| (
wrôãn
 !(2 + ()
sock§eq
[1]))) {

435 
	`Áûf
(
d©a
, "UnableÅo send initial SOCKS5Ñequest.");

436  
CURLE_COULDNT_CONNECT
;

439 
	`cuæx_n⁄block
(
sock
, 
TRUE
);

441 
ªsu…
 = 
	`Cuæ_sockë_ªady
(
sock
, 
CURL_SOCKET_BAD
, 
timeout
);

443 if(-1 =
ªsu…
) {

444 
	`Áûf
(
c⁄n
->
d©a
, "SOCKS5ÇothingÅoÑead");

445  
CURLE_COULDNT_CONNECT
;

447 if(0 =
ªsu…
) {

448 
	`Áûf
(
c⁄n
->
d©a
, "SOCKS5ÑeadÅimeout");

449  
CURLE_OPERATION_TIMEDOUT
;

452 if(
ªsu…
 & 
CURL_CSELECT_ERR
) {

453 
	`Áûf
(
c⁄n
->
d©a
, "SOCKS5ÑeadÉrror occurred");

454  
CURLE_RECV_ERROR
;

457 
	`cuæx_n⁄block
(
sock
, 
FALSE
);

459 
ªsu…
=
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
sock§eq
, 2, &
a˘uÆªad
);

460 if((
ªsu…
 !
CURLE_OK
Ë|| (
a˘uÆªad
 != 2)) {

461 
	`Áûf
(
d©a
, "UnableÅoÑeceive initial SOCKS5Ñesponse.");

462  
CURLE_COULDNT_CONNECT
;

465 if(
sock§eq
[0] != 5) {

466 
	`Áûf
(
d©a
, "Received invalid version in initial SOCKS5Ñesponse.");

467  
CURLE_COULDNT_CONNECT
;

469 if(
sock§eq
[1] == 0) {

473 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

474 if(
sock§eq
[1] == 1) {

475 
code
 = 
	`Cuæ_SOCKS5_gsßpi_√gŸüã
(
socködex
, 
c⁄n
);

476 if(
code
 !
CURLE_OK
) {

477 
	`Áûf
(
d©a
, "UnableÅoÇegotiate SOCKS5 gssapi context.");

478  
CURLE_COULDNT_CONNECT
;

482 if(
sock§eq
[1] == 2) {

484 
size_t
 
¥oxy_«me_Àn
, 
¥oxy_∑ssw‹d_Àn
;

485 if(
¥oxy_«me
 && 
¥oxy_∑ssw‹d
) {

486 
¥oxy_«me_Àn
 = 
	`°æí
(
¥oxy_«me
);

487 
¥oxy_∑ssw‹d_Àn
 = 
	`°æí
(
¥oxy_∑ssw‹d
);

490 
¥oxy_«me_Àn
 = 0;

491 
¥oxy_∑ssw‹d_Àn
 = 0;

501 
Àn
 = 0;

502 
sock§eq
[
Àn
++] = 1;

503 
sock§eq
[
Àn
++] = (Ë
¥oxy_«me_Àn
;

504 if(
¥oxy_«me
 && 
¥oxy_«me_Àn
)

505 
	`mem˝y
(
sock§eq
 + 
Àn
, 
¥oxy_«me
, 
¥oxy_«me_Àn
);

506 
Àn
 +
¥oxy_«me_Àn
;

507 
sock§eq
[
Àn
++] = (Ë
¥oxy_∑ssw‹d_Àn
;

508 if(
¥oxy_∑ssw‹d
 && 
¥oxy_∑ssw‹d_Àn
)

509 
	`mem˝y
(
sock§eq
 + 
Àn
, 
¥oxy_∑ssw‹d
, 
¥oxy_∑ssw‹d_Àn
);

510 
Àn
 +
¥oxy_∑ssw‹d_Àn
;

512 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
sock§eq
, 
Àn
, &
wrôãn
);

513 if((
code
 !
CURLE_OK
Ë|| (
Àn
 !
wrôãn
)) {

514 
	`Áûf
(
d©a
, "FailedÅo send SOCKS5 sub-negotiationÑequest.");

515  
CURLE_COULDNT_CONNECT
;

518 
ªsu…
=
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
sock§eq
, 2, &
a˘uÆªad
);

519 if((
ªsu…
 !
CURLE_OK
Ë|| (
a˘uÆªad
 != 2)) {

520 
	`Áûf
(
d©a
, "UnableÅoÑeceive SOCKS5 sub-negotiationÑesponse.");

521  
CURLE_COULDNT_CONNECT
;

525 if(
sock§eq
[1] != 0) {

526 
	`Áûf
(
d©a
, "User wasÑejected byÅhe SOCKS5 server (%d %d).",

527 
sock§eq
[0], socksreq[1]);

528  
CURLE_COULDNT_CONNECT
;

535 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

536 if(
sock§eq
[1] == 255) {

538 if(
sock§eq
[1] == 1) {

539 
	`Áûf
(
d©a
,

541  
CURLE_COULDNT_CONNECT
;

543 if(
sock§eq
[1] == 255) {

545 if(!
¥oxy_«me
 || !*proxy_name) {

546 
	`Áûf
(
d©a
,

552 
	`Áûf
(
d©a
, "Noáuthentication method wasácceptable.");

554  
CURLE_COULDNT_CONNECT
;

557 
	`Áûf
(
d©a
,

559  
CURLE_COULDNT_CONNECT
;

564 
Àn
 = 0;

565 
sock§eq
[
Àn
++] = 5;

566 
sock§eq
[
Àn
++] = 1;

567 
sock§eq
[
Àn
++] = 0;

569 if(!
socks5_ªsﬁve_loˇl
) {

570 
sock§eq
[
Àn
++] = 3;

571 
sock§eq
[
Àn
++] = (Ë
ho°«me_Àn
;

572 
	`mem˝y
(&
sock§eq
[
Àn
], 
ho°«me
, 
ho°«me_Àn
);

573 
Àn
 +
ho°«me_Àn
;

576 
Cuæ_dns_íåy
 *
dns
;

577 
Cuæ_addröfo
 *
hp
 = 
NULL
;

578 
rc
 = 
	`Cuæ_ªsﬁv
(
c⁄n
, 
ho°«me
, 
ªmŸe_p‹t
, &
dns
);

580 if(
rc
 =
CURLRESOLV_ERROR
)

581  
CURLE_COULDNT_RESOLVE_HOST
;

583 if(
rc
 =
CURLRESOLV_PENDING
) {

585 
code
 = 
	`Cuæ_ªsﬁvî_waô_ªsﬁv
(
c⁄n
, &
dns
);

586 if(
code
 !
CURLE_OK
)

587  
code
;

594 if(
dns
)

595 
hp
=
dns
->
addr
;

596 if(
hp
) {

597 
sockaddr_ö
 *
ßddr_ö
;

598 #ifde‡
ENABLE_IPV6


599 
sockaddr_ö6
 *
ßddr_ö6
;

601 
i
;

603 if(
hp
->
ai_Ámûy
 =
AF_INET
) {

604 
sock§eq
[
Àn
++] = 1;

606 
ßddr_ö
 = (
sockaddr_ö
*)
hp
->
ai_addr
;

607 
i
 = 0; i < 4; i++) {

608 
sock§eq
[
Àn
++] = ((*)&
ßddr_ö
->
sö_addr
.
s_addr
)[
i
];

609 
	`öfof
(
d©a
, "%d\n", 
sock§eq
[
Àn
-1]);

612 #ifde‡
ENABLE_IPV6


613 if(
hp
->
ai_Ámûy
 =
AF_INET6
) {

614 
sock§eq
[
Àn
++] = 4;

616 
ßddr_ö6
 = (
sockaddr_ö6
*)
hp
->
ai_addr
;

617 
i
 = 0; i < 16; i++) {

618 
sock§eq
[
Àn
++] = ((*)&
ßddr_ö6
->
sö6_addr
.
s6_addr
)[
i
];

623 
hp
 = 
NULL
;

625 
	`Cuæ_ªsﬁv_u∆ock
(
d©a
, 
dns
);

627 if(!
hp
) {

628 
	`Áûf
(
d©a
, "FailedÅoÑesolve \"%s\" for SOCKS5 connect.",

629 
ho°«me
);

630  
CURLE_COULDNT_RESOLVE_HOST
;

634 
sock§eq
[
Àn
++] = ()((
ªmŸe_p‹t
 >> 8) & 0xff);

635 
sock§eq
[
Àn
++] = ()(
ªmŸe_p‹t
 & 0xff);

637 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

638 if(
c⁄n
->
socks5_gsßpi_í˘y≥
) {

639 
	`Áûf
(
d©a
, "SOCKS5 gssapiÖrotectionÇot yet implemented.");

643 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
sock§eq
, 
Àn
, &
wrôãn
);

645 if((
code
 !
CURLE_OK
Ë|| (
Àn
 !
wrôãn
)) {

646 
	`Áûf
(
d©a
, "FailedÅo send SOCKS5 connectÑequest.");

647  
CURLE_COULDNT_CONNECT
;

650 
Àn
 = 10;

652 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

653 if(
c⁄n
->
socks5_gsßpi_í˘y≥
) {

654 
	`Áûf
(
d©a
, "SOCKS5 gssapiÖrotectionÇot yet implemented.");

658 
ªsu…
 = 
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
sock§eq
,

659 
Àn
, &
a˘uÆªad
);

661 if((
ªsu…
 !
CURLE_OK
Ë|| (
Àn
 !
a˘uÆªad
)) {

662 
	`Áûf
(
d©a
, "FailedÅoÑeceive SOCKS5 connectÑequestáck.");

663  
CURLE_COULDNT_CONNECT
;

666 if(
sock§eq
[0] != 5) {

667 
	`Áûf
(
d©a
,

669  
CURLE_COULDNT_CONNECT
;

671 if(
sock§eq
[1] != 0) {

672 if(
sock§eq
[3] == 1) {

673 
	`Áûf
(
d©a
,

675 ()
sock§eq
[4], ()socksreq[5],

676 ()
sock§eq
[6], ()socksreq[7],

677 ((
sock§eq
[8] << 8) | socksreq[9]),

678 
sock§eq
[1]);

680 if(
sock§eq
[3] == 3) {

681 
	`Áûf
(
d©a
,

683 
ho°«me
,

684 ((
sock§eq
[8] << 8) | socksreq[9]),

685 
sock§eq
[1]);

687 if(
sock§eq
[3] == 4) {

688 
	`Áûf
(
d©a
,

691 ()
sock§eq
[4], ()socksreq[5],

692 ()
sock§eq
[6], ()socksreq[7],

693 ()
sock§eq
[8], ()socksreq[9],

694 ()
sock§eq
[10], ()socksreq[11],

695 ()
sock§eq
[12], ()socksreq[13],

696 ()
sock§eq
[14], ()socksreq[15],

697 ()
sock§eq
[16], ()socksreq[17],

698 ()
sock§eq
[18], ()socksreq[19],

699 ((
sock§eq
[8] << 8) | socksreq[9]),

700 
sock§eq
[1]);

702  
CURLE_COULDNT_CONNECT
;

722 if(
sock§eq
[3] == 3) {

724 
addæí
 = (Ë
sock§eq
[4];

725 
Àn
 = 5 + 
addæí
 + 2;

727 if(
sock§eq
[3] == 4) {

729 
Àn
 = 4 + 16 + 2;

733 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

734 if(!
c⁄n
->
socks5_gsßpi_í˘y≥
) {

737 if(
Àn
 > 10) {

738 
Àn
 -= 10;

739 
ªsu…
 = 
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)&
sock§eq
[10],

740 
Àn
, &
a˘uÆªad
);

741 if((
ªsu…
 !
CURLE_OK
Ë|| (
Àn
 !
a˘uÆªad
)) {

742 
	`Áûf
(
d©a
, "FailedÅoÑeceive SOCKS5 connectÑequestáck.");

743  
CURLE_COULDNT_CONNECT
;

746 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

750 
	`cuæx_n⁄block
(
sock
, 
TRUE
);

751  
CURLE_OK
;

752 
	}
}

	@lib/socks.h

1 #i‚de‡
HEADER_CURL_SOCKS_H


2 
	#HEADER_CURL_SOCKS_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
CURL_DISABLE_PROXY


28 
	#Cuæ_SOCKS4
(
a
,
b
,
c
,
d
,
e
,
f
Ë
CURLE_NOT_BUILT_IN


	)

29 
	#Cuæ_SOCKS5
(
a
,
b
,
c
,
d
,
e
,
f
Ë
CURLE_NOT_BUILT_IN


	)

38 
Cuæ_blockªad_Æl
(
c⁄√˘d©a
 *
c⁄n
,

39 
cuæ_sockë_t
 
sockfd
,

40 *
buf
,

41 
ssize_t
 
buf„rsize
,

42 
ssize_t
 *
n
);

48 
CURLcode
 
Cuæ_SOCKS4
(c⁄° *
¥oxy_«me
,

49 c⁄° *
ho°«me
,

50 
ªmŸe_p‹t
,

51 
socködex
,

52 
c⁄√˘d©a
 *
c⁄n
,

53 
boﬁ
 
¥Ÿocﬁ4a
);

59 
CURLcode
 
Cuæ_SOCKS5
(c⁄° *
¥oxy_«me
,

60 c⁄° *
¥oxy_∑ssw‹d
,

61 c⁄° *
ho°«me
,

62 
ªmŸe_p‹t
,

63 
socködex
,

64 
c⁄√˘d©a
 *
c⁄n
);

66 #i‡
deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

70 
CURLcode
 
Cuæ_SOCKS5_gsßpi_√gŸüã
(
socködex
,

71 
c⁄√˘d©a
 *
c⁄n
);

	@lib/socks_gssapi.c

24 
	~"cuæ_£tup.h
"

26 #i‚de‡
CURL_DISABLE_PROXY


28 #ifde‡
HAVE_GSSAPI


29 #ifde‡
HAVE_OLD_GSSMIT


30 
	#GSS_C_NT_HOSTBASED_SERVICE
 
gss_¡_£rvi˚_«me


	)

31 
	#NCOMPAT
 1

	)

33 #i‚de‡
gss_¡_£rvi˚_«me


34 
	#gss_¡_£rvi˚_«me
 
GSS_C_NT_HOSTBASED_SERVICE


	)

37 
	~"cuæ_gsßpi.h
"

38 
	~"uæd©a.h
"

39 
	~"£ndf.h
"

40 
	~"c⁄√˘.h
"

41 
	~"timevÆ.h
"

42 
	~"socks.h
"

43 
	~"w¨∆ess.h
"

45 
	#_MPRINTF_REPLACE


	)

46 
	~<cuæ/m¥ötf.h
>

48 
	~"cuæ_mem‹y.h
"

50 
	~"memdebug.h
"

52 
gss_˘x_id_t
 
	ggss_c⁄ãxt
 = 
GSS_C_NO_CONTEXT
;

57 
	$check_gss_îr
(
Sessi⁄H™dÀ
 *
d©a
,

58 
OM_uöt32
 
maj‹_°©us
,

59 
OM_uöt32
 
mö‹_°©us
,

60 c⁄° * 
fun˘i⁄
)

62 if(
	`GSS_ERROR
(
maj‹_°©us
)) {

63 
OM_uöt32
 
maj_°©
,
mö_°©
;

64 
OM_uöt32
 
msg_˘x
 = 0;

65 
gss_buf„r_desc
 
°©us_°rög
;

66 
buf
[1024];

67 
size_t
 
Àn
;

69 
Àn
 = 0;

70 
msg_˘x
 = 0;

71 !
msg_˘x
) {

73 
maj_°©
 = 
	`gss_di•œy_°©us
(&
mö_°©
, 
maj‹_°©us
,

74 
GSS_C_GSS_CODE
,

75 
GSS_C_NULL_OID
,

76 &
msg_˘x
, &
°©us_°rög
);

77 if(
maj_°©
 =
GSS_S_COMPLETE
) {

78 if((
buf
Ë> 
Àn
 + 
°©us_°rög
.
Àngth
 + 1) {

79 
	`°r˝y
(
buf
+
Àn
, (*Ë
°©us_°rög
.
vÆue
);

80 
Àn
 +
°©us_°rög
.
Àngth
;

82 
	`gss_ªÀa£_buf„r
(&
mö_°©
, &
°©us_°rög
);

85 
	`gss_ªÀa£_buf„r
(&
mö_°©
, &
°©us_°rög
);

87 if((
buf
Ë> 
Àn
 + 3) {

88 
	`°r˝y
(
buf
+
Àn
, ".\n");

89 
Àn
 += 2;

91 
msg_˘x
 = 0;

92 !
msg_˘x
) {

94 
maj_°©
 = 
	`gss_di•œy_°©us
(&
mö_°©
, 
mö‹_°©us
,

95 
GSS_C_MECH_CODE
,

96 
GSS_C_NULL_OID
,

97 &
msg_˘x
, &
°©us_°rög
);

98 if(
maj_°©
 =
GSS_S_COMPLETE
) {

99 if((
buf
Ë> 
Àn
 + 
°©us_°rög
.
Àngth
)

100 
	`°r˝y
(
buf
+
Àn
, (*Ë
°©us_°rög
.
vÆue
);

101 
	`gss_ªÀa£_buf„r
(&
mö_°©
, &
°©us_°rög
);

104 
	`gss_ªÀa£_buf„r
(&
mö_°©
, &
°©us_°rög
);

106 
	`Áûf
(
d©a
, "GSSAPIÉº‹: %†Áûed:\n%s", 
fun˘i⁄
, 
buf
);

111 
	}
}

113 
CURLcode
 
	$Cuæ_SOCKS5_gsßpi_√gŸüã
(
socködex
,

114 
c⁄√˘d©a
 *
c⁄n
)

116 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

117 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
socködex
];

118 
CURLcode
 
code
;

119 
ssize_t
 
a˘uÆªad
;

120 
ssize_t
 
wrôãn
;

121 
ªsu…
;

122 
OM_uöt32
 
gss_maj‹_°©us
, 
gss_mö‹_°©us
, 
gss_°©us
;

123 
OM_uöt32
 
gss_ªt_Êags
;

124 
gss_c⁄f_°©e
, 
gss_íc
;

125 
gss_buf„r_desc
 
£rvi˚
 = 
GSS_C_EMPTY_BUFFER
;

126 
gss_buf„r_desc
 
gss_£nd_tokí
 = 
GSS_C_EMPTY_BUFFER
;

127 
gss_buf„r_desc
 
gss_ªcv_tokí
 = 
GSS_C_EMPTY_BUFFER
;

128 
gss_buf„r_desc
 
gss_w_tokí
 = 
GSS_C_EMPTY_BUFFER
;

129 
gss_buf„r_desc
* 
gss_tokí
 = 
GSS_C_NO_BUFFER
;

130 
gss_«me_t
 
£rvî
 = 
GSS_C_NO_NAME
;

131 
gss_«me_t
 
gss_˛õ¡_«me
 = 
GSS_C_NO_NAME
;

132 
us_Àngth
;

133 *
u£r
=
NULL
;

134 
sock§eq
[4];

135 *
£rvi˚±r
 = 
d©a
->
£t
.
°r
[
STRING_SOCKS5_GSSAPI_SERVICE
];

146 if(
	`°rchr
(
£rvi˚±r
,'/')) {

147 
£rvi˚
.
vÆue
 = 
	`mÆloc
(
	`°æí
(
£rvi˚±r
));

148 if(!
£rvi˚
.
vÆue
)

149  
CURLE_OUT_OF_MEMORY
;

150 
£rvi˚
.
Àngth
 = 
	`°æí
(
£rvi˚±r
);

151 
	`mem˝y
(
£rvi˚
.
vÆue
, 
£rvi˚±r
, sîvi˚.
Àngth
);

153 
gss_maj‹_°©us
 = 
	`gss_imp‹t_«me
(&
gss_mö‹_°©us
, &
£rvi˚
,

154 (
gss_OID
Ë
GSS_C_NULL_OID
, &
£rvî
);

157 
£rvi˚
.
vÆue
 = 
	`mÆloc
(
	`°æí
(
£rvi˚±r
Ë+°æí(
c⁄n
->
¥oxy
.
«me
)+2);

158 if(!
£rvi˚
.
vÆue
)

159  
CURLE_OUT_OF_MEMORY
;

160 
£rvi˚
.
Àngth
 = 
	`°æí
(
£rvi˚±r
Ë+°æí(
c⁄n
->
¥oxy
.
«me
)+1;

161 
	`¢¥ötf
(
£rvi˚
.
vÆue
, sîvi˚.
Àngth
+1, "%s@%s",

162 
£rvi˚±r
, 
c⁄n
->
¥oxy
.
«me
);

164 
gss_maj‹_°©us
 = 
	`gss_imp‹t_«me
(&
gss_mö‹_°©us
, &
£rvi˚
,

165 
gss_¡_£rvi˚_«me
, &
£rvî
);

168 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
£rvi˚
);

170 if(
	`check_gss_îr
(
d©a
,
gss_maj‹_°©us
,

171 
gss_mö‹_°©us
,"gss_import_name()")) {

172 
	`Áûf
(
d©a
, "FailedÅo create serviceÇame.");

173 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
£rvî
);

174  
CURLE_COULDNT_CONNECT
;

180 
gss_maj‹_°©us
 = 
	`Cuæ_gss_öô_£c_c⁄ãxt
(
d©a
,

181 &
gss_mö‹_°©us
,

182 &
gss_c⁄ãxt
,

183 
£rvî
,

184 
NULL
,

185 
gss_tokí
,

186 &
gss_£nd_tokí
,

187 &
gss_ªt_Êags
);

189 if(
gss_tokí
 !
GSS_C_NO_BUFFER
)

190 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

191 if(
	`check_gss_îr
(
d©a
,
gss_maj‹_°©us
,

192 
gss_mö‹_°©us
,"gss_init_sec_context")) {

193 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
£rvî
);

194 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

195 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_£nd_tokí
);

196 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

197 
	`Áûf
(
d©a
, "FailedÅo initial GSSAPIÅoken.");

198  
CURLE_COULDNT_CONNECT
;

201 if(
gss_£nd_tokí
.
Àngth
 != 0) {

202 
sock§eq
[0] = 1;

203 
sock§eq
[1] = 1;

204 
us_Àngth
 = 
	`ht⁄s
(()
gss_£nd_tokí
.
Àngth
);

205 
	`mem˝y
(
sock§eq
+2,&
us_Àngth
,());

207 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
sock§eq
, 4, &
wrôãn
);

208 if((
code
 !
CURLE_OK
Ë|| (4 !
wrôãn
)) {

209 
	`Áûf
(
d©a
, "FailedÅo send GSSAPIáuthenticationÑequest.");

210 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
£rvî
);

211 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

212 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_£nd_tokí
);

213 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

214  
CURLE_COULDNT_CONNECT
;

217 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
gss_£nd_tokí
.
vÆue
,

218 
gss_£nd_tokí
.
Àngth
, &
wrôãn
);

220 if((
code
 !
CURLE_OK
Ë|| ((
ssize_t
)
gss_£nd_tokí
.
Àngth
 !
wrôãn
)) {

221 
	`Áûf
(
d©a
, "FailedÅo send GSSAPIáuthenticationÅoken.");

222 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
£rvî
);

223 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

224 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_£nd_tokí
);

225 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

226  
CURLE_COULDNT_CONNECT
;

231 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_£nd_tokí
);

232 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

233 if(
gss_maj‹_°©us
 !
GSS_S_CONTINUE_NEEDED
) ;

245 
ªsu…
=
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
sock§eq
, 4, &
a˘uÆªad
);

246 if(
ªsu…
 !
CURLE_OK
 || 
a˘uÆªad
 != 4) {

247 
	`Áûf
(
d©a
, "FailedÅoÑeceive GSSAPIáuthenticationÑesponse.");

248 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
£rvî
);

249 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

250  
CURLE_COULDNT_CONNECT
;

254 if(
sock§eq
[1] == 255) {

255 
	`Áûf
(
d©a
, "User wasÑejected byÅhe SOCKS5 server (%d %d).",

256 
sock§eq
[0], socksreq[1]);

257 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
£rvî
);

258 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

259  
CURLE_COULDNT_CONNECT
;

262 if(
sock§eq
[1] != 1) {

263 
	`Áûf
(
d©a
, "Invalid GSSAPIáuthenticationÑesponseÅype (%d %d).",

264 
sock§eq
[0], socksreq[1]);

265 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
£rvî
);

266 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

267  
CURLE_COULDNT_CONNECT
;

270 
	`mem˝y
(&
us_Àngth
, 
sock§eq
+2, ());

271 
us_Àngth
 = 
	`¡ohs
(us_length);

273 
gss_ªcv_tokí
.
Àngth
=
us_Àngth
;

274 
gss_ªcv_tokí
.
vÆue
=
	`mÆloc
(
us_Àngth
);

275 if(!
gss_ªcv_tokí
.
vÆue
) {

276 
	`Áûf
(
d©a
,

279 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
£rvî
);

280 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

281  
CURLE_OUT_OF_MEMORY
;

284 
ªsu…
=
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
gss_ªcv_tokí
.
vÆue
,

285 
gss_ªcv_tokí
.
Àngth
, &
a˘uÆªad
);

287 if(
ªsu…
 !
CURLE_OK
 || 
a˘uÆªad
 !
us_Àngth
) {

288 
	`Áûf
(
d©a
, "FailedÅoÑeceive GSSAPIáuthenticationÅoken.");

289 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
£rvî
);

290 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

291 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

292  
CURLE_COULDNT_CONNECT
;

295 
gss_tokí
 = &
gss_ªcv_tokí
;

298 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
£rvî
);

301 
gss_maj‹_°©us
 = 
	`gss_öquúe_c⁄ãxt
 (&
gss_mö‹_°©us
, 
gss_c⁄ãxt
,

302 &
gss_˛õ¡_«me
, 
NULL
, NULL, NULL,

303 
NULL
, NULL, NULL);

304 if(
	`check_gss_îr
(
d©a
,
gss_maj‹_°©us
,

305 
gss_mö‹_°©us
,"gss_inquire_context")) {

306 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

307 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
gss_˛õ¡_«me
);

308 
	`Áûf
(
d©a
, "FailedÅo determine userÇame.");

309  
CURLE_COULDNT_CONNECT
;

311 
gss_maj‹_°©us
 = 
	`gss_di•œy_«me
(&
gss_mö‹_°©us
, 
gss_˛õ¡_«me
,

312 &
gss_£nd_tokí
, 
NULL
);

313 if(
	`check_gss_îr
(
d©a
,
gss_maj‹_°©us
,

314 
gss_mö‹_°©us
,"gss_display_name")) {

315 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

316 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
gss_˛õ¡_«me
);

317 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_£nd_tokí
);

318 
	`Áûf
(
d©a
, "FailedÅo determine userÇame.");

319  
CURLE_COULDNT_CONNECT
;

321 
u£r
=
	`mÆloc
(
gss_£nd_tokí
.
Àngth
+1);

322 if(!
u£r
) {

323 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

324 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
gss_˛õ¡_«me
);

325 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_£nd_tokí
);

326  
CURLE_OUT_OF_MEMORY
;

329 
	`mem˝y
(
u£r
, 
gss_£nd_tokí
.
vÆue
, gss_£nd_tokí.
Àngth
);

330 
u£r
[
gss_£nd_tokí
.
Àngth
] = '\0';

331 
	`gss_ªÀa£_«me
(&
gss_°©us
, &
gss_˛õ¡_«me
);

332 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_£nd_tokí
);

333 
	`öfof
(
d©a
, "SOCKS5 sîvîáuthí˘iˇãd u£∏%†wôh gsßpi.\n",
u£r
);

334 
	`‰ì
(
u£r
);

335 
u£r
=
NULL
;

338 
sock§eq
[0] = 1;

339 
sock§eq
[1] = 2;

341 
gss_íc
 = 0;

343 if(
gss_ªt_Êags
 & 
GSS_C_CONF_FLAG
)

344 
gss_íc
 = 2;

346 if(
gss_ªt_Êags
 & 
GSS_C_INTEG_FLAG
)

347 
gss_íc
 = 1;

349 
	`öfof
(
d©a
, "SOCKS5 server supports gssapi %s dataÖrotection.\n",

350 (
gss_íc
==0)?"no":((gss_enc==1)?"integrity":"confidentiality"));

352 
gss_íc
 = 0;

383 if(
d©a
->
£t
.
socks5_gsßpi_√c
) {

384 
us_Àngth
 = 
	`ht⁄s
(()1);

385 
	`mem˝y
(
sock§eq
+2,&
us_Àngth
,());

388 
gss_£nd_tokí
.
Àngth
 = 1;

389 
gss_£nd_tokí
.
vÆue
 = 
	`mÆloc
(1);

390 if(!
gss_£nd_tokí
.
vÆue
) {

391 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

392  
CURLE_OUT_OF_MEMORY
;

394 
	`mem˝y
(
gss_£nd_tokí
.
vÆue
, &
gss_íc
, 1);

396 
gss_maj‹_°©us
 = 
	`gss_wøp
(&
gss_mö‹_°©us
, 
gss_c⁄ãxt
, 0,

397 
GSS_C_QOP_DEFAULT
, &
gss_£nd_tokí
,

398 &
gss_c⁄f_°©e
, &
gss_w_tokí
);

400 if(
	`check_gss_îr
(
d©a
,
gss_maj‹_°©us
,
gss_mö‹_°©us
,"gss_wrap")) {

401 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_£nd_tokí
);

402 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_w_tokí
);

403 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

404 
	`Áûf
(
d©a
, "FailedÅo wrap GSSAPIÉncryption value intoÅoken.");

405  
CURLE_COULDNT_CONNECT
;

407 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_£nd_tokí
);

409 
us_Àngth
 = 
	`ht⁄s
(()
gss_w_tokí
.
Àngth
);

410 
	`mem˝y
(
sock§eq
+2,&
us_Àngth
,());

413 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
sock§eq
, 4, &
wrôãn
);

414 if((
code
 !
CURLE_OK
Ë|| (4 !
wrôãn
)) {

415 
	`Áûf
(
d©a
, "FailedÅo send GSSAPIÉncryptionÑequest.");

416 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_w_tokí
);

417 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

418  
CURLE_COULDNT_CONNECT
;

421 if(
d©a
->
£t
.
socks5_gsßpi_√c
) {

422 
	`mem˝y
(
sock§eq
, &
gss_íc
, 1);

423 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, 
sock§eq
, 1, &
wrôãn
);

424 if((
code
 !
CURLE_OK
Ë|| ( 1 !
wrôãn
)) {

425 
	`Áûf
(
d©a
, "FailedÅo send GSSAPIÉncryptionÅype.");

426 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

427  
CURLE_COULDNT_CONNECT
;

431 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
gss_w_tokí
.
vÆue
,

432 
gss_w_tokí
.
Àngth
, &
wrôãn
);

433 if((
code
 !
CURLE_OK
Ë|| ((
ssize_t
)
gss_w_tokí
.
Àngth
 !
wrôãn
)) {

434 
	`Áûf
(
d©a
, "FailedÅo send GSSAPIÉncryptionÅype.");

435 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_w_tokí
);

436 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

437  
CURLE_COULDNT_CONNECT
;

439 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_w_tokí
);

442 
ªsu…
=
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
sock§eq
, 4, &
a˘uÆªad
);

443 if(
ªsu…
 !
CURLE_OK
 || 
a˘uÆªad
 != 4) {

444 
	`Áûf
(
d©a
, "FailedÅoÑeceive GSSAPIÉncryptionÑesponse.");

445 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

446  
CURLE_COULDNT_CONNECT
;

450 if(
sock§eq
[1] == 255) {

451 
	`Áûf
(
d©a
, "User wasÑejected byÅhe SOCKS5 server (%d %d).",

452 
sock§eq
[0], socksreq[1]);

453 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

454  
CURLE_COULDNT_CONNECT
;

457 if(
sock§eq
[1] != 2) {

458 
	`Áûf
(
d©a
, "Invalid GSSAPIÉncryptionÑesponseÅype (%d %d).",

459 
sock§eq
[0], socksreq[1]);

460 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

461  
CURLE_COULDNT_CONNECT
;

464 
	`mem˝y
(&
us_Àngth
, 
sock§eq
+2, ());

465 
us_Àngth
 = 
	`¡ohs
(us_length);

467 
gss_ªcv_tokí
.
Àngth

us_Àngth
;

468 
gss_ªcv_tokí
.
vÆue
=
	`mÆloc
(gss_ªcv_tokí.
Àngth
);

469 if(!
gss_ªcv_tokí
.
vÆue
) {

470 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

471  
CURLE_OUT_OF_MEMORY
;

473 
ªsu…
=
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
gss_ªcv_tokí
.
vÆue
,

474 
gss_ªcv_tokí
.
Àngth
, &
a˘uÆªad
);

476 if(
ªsu…
 !
CURLE_OK
 || 
a˘uÆªad
 !
us_Àngth
) {

477 
	`Áûf
(
d©a
, "FailedÅoÑeceive GSSAPIÉncryptrionÅype.");

478 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

479 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

480  
CURLE_COULDNT_CONNECT
;

483 if(!
d©a
->
£t
.
socks5_gsßpi_√c
) {

484 
gss_maj‹_°©us
 = 
	`gss_unwøp
(&
gss_mö‹_°©us
, 
gss_c⁄ãxt
,

485 &
gss_ªcv_tokí
, &
gss_w_tokí
,

486 0, 
GSS_C_QOP_DEFAULT
);

488 if(
	`check_gss_îr
(
d©a
,
gss_maj‹_°©us
,
gss_mö‹_°©us
,"gss_unwrap")) {

489 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

490 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_w_tokí
);

491 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

492 
	`Áûf
(
d©a
, "FailedÅo unwrap GSSAPIÉncryption value intoÅoken.");

493  
CURLE_COULDNT_CONNECT
;

495 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

497 if(
gss_w_tokí
.
Àngth
 != 1) {

498 
	`Áûf
(
d©a
, "Invalid GSSAPIÉncryptionÑesponseÜength (%d).",

499 
gss_w_tokí
.
Àngth
);

500 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_w_tokí
);

501 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

502  
CURLE_COULDNT_CONNECT
;

505 
	`mem˝y
(
sock§eq
,
gss_w_tokí
.
vÆue
,gss_w_tokí.
Àngth
);

506 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_w_tokí
);

509 if(
gss_ªcv_tokí
.
Àngth
 != 1) {

510 
	`Áûf
(
d©a
, "Invalid GSSAPIÉncryptionÑesponseÜength (%d).",

511 
gss_ªcv_tokí
.
Àngth
);

512 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

513 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

514  
CURLE_COULDNT_CONNECT
;

517 
	`mem˝y
(
sock§eq
,
gss_ªcv_tokí
.
vÆue
,gss_ªcv_tokí.
Àngth
);

518 
	`gss_ªÀa£_buf„r
(&
gss_°©us
, &
gss_ªcv_tokí
);

521 
	`öfof
(
d©a
, "SOCKS5áccess with%sÖrotection granted.\n",

522 (
sock§eq
[0]==0)?"out gssapi data":

523 ((
sock§eq
[0]==1)?" gssapi integrity":" gssapi confidentiality"));

525 
c⁄n
->
socks5_gsßpi_í˘y≥
 = 
sock§eq
[0];

526 if(
sock§eq
[0] == 0)

527 
	`gss_dñëe_£c_c⁄ãxt
(&
gss_°©us
, &
gss_c⁄ãxt
, 
NULL
);

529  
CURLE_OK
;

530 
	}
}

	@lib/socks_sspi.c

24 
	~"cuæ_£tup.h
"

26 #i‡
deföed
(
USE_WINDOWS_SSPI
Ë&& !deföed(
CURL_DISABLE_PROXY
)

28 
	~"uæd©a.h
"

29 
	~"£ndf.h
"

30 
	~"c⁄√˘.h
"

31 
	~"°ªº‹.h
"

32 
	~"timevÆ.h
"

33 
	~"socks.h
"

34 
	~"cuæ_s•i.h
"

35 
	~"cuæ_mu…ibyã.h
"

36 
	~"w¨∆ess.h
"

38 
	#_MPRINTF_REPLACE


	)

39 
	~<cuæ/m¥ötf.h
>

41 
	~"cuæ_mem‹y.h
"

43 
	~"memdebug.h
"

49 
	#KERB_WRAP_NO_ENCRYPT
 0x80000001

	)

54 
	$check_s•i_îr
(
c⁄√˘d©a
 *
c⁄n
,

55 
SECURITY_STATUS
 
°©us
,

56 c⁄° * 
fun˘i⁄
)

58 if(
°©us
 !
SEC_E_OK
 &&

59 
°©us
 !
SEC_I_COMPLETE_AND_CONTINUE
 &&

60 
°©us
 !
SEC_I_COMPLETE_NEEDED
 &&

61 
°©us
 !
SEC_I_CONTINUE_NEEDED
) {

62 
	`Áûf
(
c⁄n
->
d©a
, "SSPIÉº‹: %†Áûed: %s", 
fun˘i⁄
,

63 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
°©us
));

67 
	}
}

70 
CURLcode
 
	$Cuæ_SOCKS5_gsßpi_√gŸüã
(
socködex
,

71 
c⁄√˘d©a
 *
c⁄n
)

73 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

74 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
socködex
];

75 
CURLcode
 
code
;

76 
ssize_t
 
a˘uÆªad
;

77 
ssize_t
 
wrôãn
;

78 
ªsu…
;

80 
SECURITY_STATUS
 
°©us
;

81 
s•i_ªt_Êags
 = 0;

82 
gss_íc
;

83 
SecBuf„r
 
s•i_£nd_tokí
, 
s•i_ªcv_tokí
, 
s•i_w_tokí
[3];

84 
SecBuf„rDesc
 
öput_desc
, 
ouçut_desc
, 
wøp_desc
;

85 
SecPkgC⁄ãxt_Sizes
 
s•i_sizes
;

86 
CªdH™dÀ
 
¸ed_h™dÀ
;

87 
CtxtH™dÀ
 
s•i_c⁄ãxt
;

88 
PCtxtH™dÀ
 
c⁄ãxt_h™dÀ
 = 
NULL
;

89 
SecPkgCªdítüls_Names
 
«mes
;

90 
TimeSèmp
 
expúy
;

91 *
£rvi˚_«me
 = 
NULL
;

92 
us_Àngth
;

93 
q›
;

94 
sock§eq
[4];

95 *
£rvi˚
 = 
d©a
->
£t
.
°r
[
STRING_SOCKS5_GSSAPI_SERVICE
];

106 if(
	`°rchr
(
£rvi˚
, '/')) {

107 
£rvi˚_«me
 = 
	`mÆloc
(
	`°æí
(
£rvi˚
));

108 if(!
£rvi˚_«me
)

109  
CURLE_OUT_OF_MEMORY
;

110 
	`mem˝y
(
£rvi˚_«me
, 
£rvi˚
, 
	`°æí
(service));

113 
£rvi˚_«me
 = 
	`mÆloc
(
	`°æí
(
£rvi˚
Ë+ såÀn(
c⁄n
->
¥oxy
.
«me
) + 2);

114 if(!
£rvi˚_«me
)

115  
CURLE_OUT_OF_MEMORY
;

116 
	`¢¥ötf
(
£rvi˚_«me
,
	`°æí
(
£rvi˚
Ë+°æí(
c⁄n
->
¥oxy
.
«me
)+2,"%s/%s",

117 
£rvi˚
,
c⁄n
->
¥oxy
.
«me
);

120 
öput_desc
.
cBuf„rs
 = 1;

121 
öput_desc
.
pBuf„rs
 = &
s•i_ªcv_tokí
;

122 
öput_desc
.
ulVîsi⁄
 = 
SECBUFFER_VERSION
;

124 
s•i_ªcv_tokí
.
Buf„rTy≥
 = 
SECBUFFER_TOKEN
;

125 
s•i_ªcv_tokí
.
cbBuf„r
 = 0;

126 
s•i_ªcv_tokí
.
pvBuf„r
 = 
NULL
;

128 
ouçut_desc
.
cBuf„rs
 = 1;

129 
ouçut_desc
.
pBuf„rs
 = &
s•i_£nd_tokí
;

130 
ouçut_desc
.
ulVîsi⁄
 = 
SECBUFFER_VERSION
;

132 
s•i_£nd_tokí
.
Buf„rTy≥
 = 
SECBUFFER_TOKEN
;

133 
s•i_£nd_tokí
.
cbBuf„r
 = 0;

134 
s•i_£nd_tokí
.
pvBuf„r
 = 
NULL
;

136 
wøp_desc
.
cBuf„rs
 = 3;

137 
wøp_desc
.
pBuf„rs
 = 
s•i_w_tokí
;

138 
wøp_desc
.
ulVîsi⁄
 = 
SECBUFFER_VERSION
;

140 
¸ed_h™dÀ
.
dwLowî
 = 0;

141 
¸ed_h™dÀ
.
dwUµî
 = 0;

143 
°©us
 = 
s_pSecFn
->
	`AcquúeCªdítülsH™dÀ
(
NULL
,

144 (
TCHAR
 *Ë
	`TEXT
("Kerberos"),

145 
SECPKG_CRED_OUTBOUND
,

146 
NULL
,

147 
NULL
,

148 
NULL
,

149 
NULL
,

150 &
¸ed_h™dÀ
,

151 &
expúy
);

153 if(
	`check_s•i_îr
(
c⁄n
, 
°©us
, "AcquireCredentialsHandle")) {

154 
	`Áûf
(
d©a
, "FailedÅoácquire credentials.");

155 
	`Cuæ_ß„‰ì
(
£rvi˚_«me
);

156 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed_h™dÀ
);

157  
CURLE_COULDNT_CONNECT
;

163 
TCHAR
 *
¢ame
;

165 
¢ame
 = 
	`Cuæ_c⁄vît_UTF8_to_tch¨
(
£rvi˚_«me
);

166 if(!
¢ame
)

167  
CURLE_OUT_OF_MEMORY
;

169 
°©us
 = 
s_pSecFn
->
	`InôülizeSecurôyC⁄ãxt
(&
¸ed_h™dÀ
,

170 
c⁄ãxt_h™dÀ
,

171 
¢ame
,

172 
ISC_REQ_MUTUAL_AUTH
 |

173 
ISC_REQ_ALLOCATE_MEMORY
 |

174 
ISC_REQ_CONFIDENTIALITY
 |

175 
ISC_REQ_REPLAY_DETECT
,

177 
SECURITY_NATIVE_DREP
,

178 &
öput_desc
,

180 &
s•i_c⁄ãxt
,

181 &
ouçut_desc
,

182 &
s•i_ªt_Êags
,

183 &
expúy
);

185 
	`Cuæ_unicode‰ì
(
¢ame
);

187 if(
s•i_ªcv_tokí
.
pvBuf„r
) {

188 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_ªcv_tokí
.
pvBuf„r
);

189 
s•i_ªcv_tokí
.
pvBuf„r
 = 
NULL
;

190 
s•i_ªcv_tokí
.
cbBuf„r
 = 0;

193 if(
	`check_s•i_îr
(
c⁄n
, 
°©us
, "InitializeSecurityContext")) {

194 
	`Cuæ_ß„‰ì
(
£rvi˚_«me
);

195 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed_h™dÀ
);

196 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

197 if(
s•i_ªcv_tokí
.
pvBuf„r
)

198 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_ªcv_tokí
.
pvBuf„r
);

199 
	`Áûf
(
d©a
, "FailedÅo initialise security context.");

200  
CURLE_COULDNT_CONNECT
;

203 if(
s•i_£nd_tokí
.
cbBuf„r
 != 0) {

204 
sock§eq
[0] = 1;

205 
sock§eq
[1] = 1;

206 
us_Àngth
 = 
	`ht⁄s
(()
s•i_£nd_tokí
.
cbBuf„r
);

207 
	`mem˝y
(
sock§eq
+2, &
us_Àngth
, ());

209 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
sock§eq
, 4, &
wrôãn
);

210 if((
code
 !
CURLE_OK
Ë|| (4 !
wrôãn
)) {

211 
	`Áûf
(
d©a
, "FailedÅo send SSPIáuthenticationÑequest.");

212 
	`Cuæ_ß„‰ì
(
£rvi˚_«me
);

213 if(
s•i_£nd_tokí
.
pvBuf„r
)

214 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_£nd_tokí
.
pvBuf„r
);

215 if(
s•i_ªcv_tokí
.
pvBuf„r
)

216 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_ªcv_tokí
.
pvBuf„r
);

217 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed_h™dÀ
);

218 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

219  
CURLE_COULDNT_CONNECT
;

222 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
s•i_£nd_tokí
.
pvBuf„r
,

223 
s•i_£nd_tokí
.
cbBuf„r
, &
wrôãn
);

224 if((
code
 !
CURLE_OK
Ë|| (
s•i_£nd_tokí
.
cbBuf„r
 !(
size_t
)
wrôãn
)) {

225 
	`Áûf
(
d©a
, "FailedÅo send SSPIáuthenticationÅoken.");

226 
	`Cuæ_ß„‰ì
(
£rvi˚_«me
);

227 if(
s•i_£nd_tokí
.
pvBuf„r
)

228 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_£nd_tokí
.
pvBuf„r
);

229 if(
s•i_ªcv_tokí
.
pvBuf„r
)

230 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_ªcv_tokí
.
pvBuf„r
);

231 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed_h™dÀ
);

232 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

233  
CURLE_COULDNT_CONNECT
;

238 if(
s•i_£nd_tokí
.
pvBuf„r
) {

239 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_£nd_tokí
.
pvBuf„r
);

240 
s•i_£nd_tokí
.
pvBuf„r
 = 
NULL
;

242 
s•i_£nd_tokí
.
cbBuf„r
 = 0;

244 if(
s•i_ªcv_tokí
.
pvBuf„r
) {

245 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_ªcv_tokí
.
pvBuf„r
);

246 
s•i_ªcv_tokí
.
pvBuf„r
 = 
NULL
;

248 
s•i_ªcv_tokí
.
cbBuf„r
 = 0;

250 if(
°©us
 !
SEC_I_CONTINUE_NEEDED
)

263 
ªsu…
 = 
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
sock§eq
, 4, &
a˘uÆªad
);

264 if(
ªsu…
 !
CURLE_OK
 || 
a˘uÆªad
 != 4) {

265 
	`Áûf
(
d©a
, "FailedÅoÑeceive SSPIáuthenticationÑesponse.");

266 
	`Cuæ_ß„‰ì
(
£rvi˚_«me
);

267 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed_h™dÀ
);

268 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

269  
CURLE_COULDNT_CONNECT
;

273 if(
sock§eq
[1] == 255) {

274 
	`Áûf
(
d©a
, "User wasÑejected byÅhe SOCKS5 server (%u %u).",

275 ()
sock§eq
[0], ()socksreq[1]);

276 
	`Cuæ_ß„‰ì
(
£rvi˚_«me
);

277 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed_h™dÀ
);

278 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

279  
CURLE_COULDNT_CONNECT
;

282 if(
sock§eq
[1] != 1) {

283 
	`Áûf
(
d©a
, "Invalid SSPIáuthenticationÑesponseÅype (%u %u).",

284 ()
sock§eq
[0], ()socksreq[1]);

285 
	`Cuæ_ß„‰ì
(
£rvi˚_«me
);

286 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed_h™dÀ
);

287 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

288  
CURLE_COULDNT_CONNECT
;

291 
	`mem˝y
(&
us_Àngth
, 
sock§eq
+2, ());

292 
us_Àngth
 = 
	`¡ohs
(us_length);

294 
s•i_ªcv_tokí
.
cbBuf„r
 = 
us_Àngth
;

295 
s•i_ªcv_tokí
.
pvBuf„r
 = 
	`mÆloc
(
us_Àngth
);

297 if(!
s•i_ªcv_tokí
.
pvBuf„r
) {

298 
	`Cuæ_ß„‰ì
(
£rvi˚_«me
);

299 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed_h™dÀ
);

300 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

301  
CURLE_OUT_OF_MEMORY
;

303 
ªsu…
 = 
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
s•i_ªcv_tokí
.
pvBuf„r
,

304 
s•i_ªcv_tokí
.
cbBuf„r
, &
a˘uÆªad
);

306 if(
ªsu…
 !
CURLE_OK
 || 
a˘uÆªad
 !
us_Àngth
) {

307 
	`Áûf
(
d©a
, "FailedÅoÑeceive SSPIáuthenticationÅoken.");

308 
	`Cuæ_ß„‰ì
(
£rvi˚_«me
);

309 if(
s•i_ªcv_tokí
.
pvBuf„r
)

310 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_ªcv_tokí
.
pvBuf„r
);

311 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed_h™dÀ
);

312 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

313  
CURLE_COULDNT_CONNECT
;

316 
c⁄ãxt_h™dÀ
 = &
s•i_c⁄ãxt
;

319 
	`Cuæ_ß„‰ì
(
£rvi˚_«me
);

322 
°©us
 = 
s_pSecFn
->
	`QuîyCªdítülsAâribuãs
(&
¸ed_h™dÀ
,

323 
SECPKG_CRED_ATTR_NAMES
,

324 &
«mes
);

325 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed_h™dÀ
);

326 if(
	`check_s•i_îr
(
c⁄n
, 
°©us
, "QueryCredentialAttributes")) {

327 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

328 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
«mes
.
sU£rName
);

329 
	`Áûf
(
d©a
, "FailedÅo determine userÇame.");

330  
CURLE_COULDNT_CONNECT
;

332 
	`öfof
(
d©a
, "SOCKS5 serveráuthencticated user %s with gssapi.\n",

333 
«mes
.
sU£rName
);

334 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
«mes
.
sU£rName
);

337 
sock§eq
[0] = 1;

338 
sock§eq
[1] = 2;

340 
gss_íc
 = 0;

342 if(
s•i_ªt_Êags
 & 
ISC_REQ_CONFIDENTIALITY
)

343 
gss_íc
 = 2;

345 if(
s•i_ªt_Êags
 & 
ISC_REQ_INTEGRITY
)

346 
gss_íc
 = 1;

348 
	`öfof
(
d©a
, "SOCKS5 server supports gssapi %s dataÖrotection.\n",

349 (
gss_íc
==0)?"no":((gss_enc==1)?"integrity":"confidentiality") );

351 
gss_íc
 = 0;

383 if(
d©a
->
£t
.
socks5_gsßpi_√c
) {

384 
us_Àngth
 = 
	`ht⁄s
(()1);

385 
	`mem˝y
(
sock§eq
+2, &
us_Àngth
, ());

388 
°©us
 = 
s_pSecFn
->
	`QuîyC⁄ãxtAâribuãs
(&
s•i_c⁄ãxt
,

389 
SECPKG_ATTR_SIZES
,

390 &
s•i_sizes
);

391 if(
	`check_s•i_îr
(
c⁄n
, 
°©us
, "QueryContextAttributes")) {

392 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

393 
	`Áûf
(
d©a
, "FailedÅo query security contextáttributes.");

394  
CURLE_COULDNT_CONNECT
;

397 
s•i_w_tokí
[0].
cbBuf„r
 = 
s•i_sizes
.
cbSecurôyTøûî
;

398 
s•i_w_tokí
[0].
Buf„rTy≥
 = 
SECBUFFER_TOKEN
;

399 
s•i_w_tokí
[0].
pvBuf„r
 = 
	`mÆloc
(
s•i_sizes
.
cbSecurôyTøûî
);

401 if(!
s•i_w_tokí
[0].
pvBuf„r
) {

402 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

403  
CURLE_OUT_OF_MEMORY
;

406 
s•i_w_tokí
[1].
cbBuf„r
 = 1;

407 
s•i_w_tokí
[1].
pvBuf„r
 = 
	`mÆloc
(1);

408 if(!
s•i_w_tokí
[1].
pvBuf„r
) {

409 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

410 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

411  
CURLE_OUT_OF_MEMORY
;

414 
	`mem˝y
(
s•i_w_tokí
[1].
pvBuf„r
,&
gss_íc
,1);

415 
s•i_w_tokí
[2].
Buf„rTy≥
 = 
SECBUFFER_PADDING
;

416 
s•i_w_tokí
[2].
cbBuf„r
 = 
s•i_sizes
.
cbBlockSize
;

417 
s•i_w_tokí
[2].
pvBuf„r
 = 
	`mÆloc
(
s•i_sizes
.
cbBlockSize
);

418 if(!
s•i_w_tokí
[2].
pvBuf„r
) {

419 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

420 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[1].
pvBuf„r
);

421 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

422  
CURLE_OUT_OF_MEMORY
;

424 
°©us
 = 
s_pSecFn
->
	`En¸y±Mesßge
(&
s•i_c⁄ãxt
,

425 
KERB_WRAP_NO_ENCRYPT
,

426 &
wøp_desc
,

428 if(
	`check_s•i_îr
(
c⁄n
, 
°©us
, "EncryptMessage")) {

429 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

430 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[1].
pvBuf„r
);

431 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[2].
pvBuf„r
);

432 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

433 
	`Áûf
(
d©a
, "FailedÅo query security contextáttributes.");

434  
CURLE_COULDNT_CONNECT
;

436 
s•i_£nd_tokí
.
cbBuf„r
 = 
s•i_w_tokí
[0].cbBuffer

437 + 
s•i_w_tokí
[1].
cbBuf„r


438 + 
s•i_w_tokí
[2].
cbBuf„r
;

439 
s•i_£nd_tokí
.
pvBuf„r
 = 
	`mÆloc
(s•i_£nd_tokí.
cbBuf„r
);

440 if(!
s•i_£nd_tokí
.
pvBuf„r
) {

441 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

442 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[1].
pvBuf„r
);

443 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[2].
pvBuf„r
);

444 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

445  
CURLE_OUT_OF_MEMORY
;

448 
	`mem˝y
(
s•i_£nd_tokí
.
pvBuf„r
, 
s•i_w_tokí
[0].pvBuffer,

449 
s•i_w_tokí
[0].
cbBuf„r
);

450 
	`mem˝y
((
PUCHAR
Ë
s•i_£nd_tokí
.
pvBuf„r
 +()
s•i_w_tokí
[0].
cbBuf„r
,

451 
s•i_w_tokí
[1].
pvBuf„r
, s•i_w_tokí[1].
cbBuf„r
);

452 
	`mem˝y
((
PUCHAR
Ë
s•i_£nd_tokí
.
pvBuf„r


453 +
s•i_w_tokí
[0].
cbBuf„r


454 +
s•i_w_tokí
[1].
cbBuf„r
,

455 
s•i_w_tokí
[2].
pvBuf„r
, s•i_w_tokí[2].
cbBuf„r
);

457 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

458 
s•i_w_tokí
[0].
pvBuf„r
 = 
NULL
;

459 
s•i_w_tokí
[0].
cbBuf„r
 = 0;

460 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[1].
pvBuf„r
);

461 
s•i_w_tokí
[1].
pvBuf„r
 = 
NULL
;

462 
s•i_w_tokí
[1].
cbBuf„r
 = 0;

463 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[2].
pvBuf„r
);

464 
s•i_w_tokí
[2].
pvBuf„r
 = 
NULL
;

465 
s•i_w_tokí
[2].
cbBuf„r
 = 0;

467 
us_Àngth
 = 
	`ht⁄s
(()
s•i_£nd_tokí
.
cbBuf„r
);

468 
	`mem˝y
(
sock§eq
+2,&
us_Àngth
,());

471 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
sock§eq
, 4, &
wrôãn
);

472 if((
code
 !
CURLE_OK
Ë|| (4 !
wrôãn
)) {

473 
	`Áûf
(
d©a
, "FailedÅo send SSPIÉncryptionÑequest.");

474 if(
s•i_£nd_tokí
.
pvBuf„r
)

475 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_£nd_tokí
.
pvBuf„r
);

476 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

477  
CURLE_COULDNT_CONNECT
;

480 if(
d©a
->
£t
.
socks5_gsßpi_√c
) {

481 
	`mem˝y
(
sock§eq
,&
gss_íc
,1);

482 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
sock§eq
, 1, &
wrôãn
);

483 if((
code
 !
CURLE_OK
Ë|| (1 !
wrôãn
)) {

484 
	`Áûf
(
d©a
, "FailedÅo send SSPIÉncryptionÅype.");

485 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

486  
CURLE_COULDNT_CONNECT
;

490 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, 
sock
, (*)
s•i_£nd_tokí
.
pvBuf„r
,

491 
s•i_£nd_tokí
.
cbBuf„r
, &
wrôãn
);

492 if((
code
 !
CURLE_OK
Ë|| (
s•i_£nd_tokí
.
cbBuf„r
 !(
size_t
)
wrôãn
)) {

493 
	`Áûf
(
d©a
, "FailedÅo send SSPIÉncryptionÅype.");

494 if(
s•i_£nd_tokí
.
pvBuf„r
)

495 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_£nd_tokí
.
pvBuf„r
);

496 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

497  
CURLE_COULDNT_CONNECT
;

499 if(
s•i_£nd_tokí
.
pvBuf„r
)

500 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_£nd_tokí
.
pvBuf„r
);

503 
ªsu…
 = 
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
sock§eq
, 4, &
a˘uÆªad
);

504 if(
ªsu…
 !
CURLE_OK
 || 
a˘uÆªad
 != 4) {

505 
	`Áûf
(
d©a
, "FailedÅoÑeceive SSPIÉncryptionÑesponse.");

506 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

507  
CURLE_COULDNT_CONNECT
;

511 if(
sock§eq
[1] == 255) {

512 
	`Áûf
(
d©a
, "User wasÑejected byÅhe SOCKS5 server (%u %u).",

513 ()
sock§eq
[0], ()socksreq[1]);

514 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

515  
CURLE_COULDNT_CONNECT
;

518 if(
sock§eq
[1] != 2) {

519 
	`Áûf
(
d©a
, "Invalid SSPIÉncryptionÑesponseÅype (%u %u).",

520 ()
sock§eq
[0], ()socksreq[1]);

521 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

522  
CURLE_COULDNT_CONNECT
;

525 
	`mem˝y
(&
us_Àngth
, 
sock§eq
+2, ());

526 
us_Àngth
 = 
	`¡ohs
(us_length);

528 
s•i_w_tokí
[0].
cbBuf„r
 = 
us_Àngth
;

529 
s•i_w_tokí
[0].
pvBuf„r
 = 
	`mÆloc
(
us_Àngth
);

530 if(!
s•i_w_tokí
[0].
pvBuf„r
) {

531 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

532  
CURLE_OUT_OF_MEMORY
;

535 
ªsu…
 = 
	`Cuæ_blockªad_Æl
(
c⁄n
, 
sock
, (*)
s•i_w_tokí
[0].
pvBuf„r
,

536 
s•i_w_tokí
[0].
cbBuf„r
, &
a˘uÆªad
);

538 if(
ªsu…
 !
CURLE_OK
 || 
a˘uÆªad
 !
us_Àngth
) {

539 
	`Áûf
(
d©a
, "FailedÅoÑeceive SSPIÉncryptionÅype.");

540 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

541 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

542  
CURLE_COULDNT_CONNECT
;

546 if(!
d©a
->
£t
.
socks5_gsßpi_√c
) {

547 
wøp_desc
.
cBuf„rs
 = 2;

548 
s•i_w_tokí
[0].
Buf„rTy≥
 = 
SECBUFFER_STREAM
;

549 
s•i_w_tokí
[1].
Buf„rTy≥
 = 
SECBUFFER_DATA
;

550 
s•i_w_tokí
[1].
cbBuf„r
 = 0;

551 
s•i_w_tokí
[1].
pvBuf„r
 = 
NULL
;

553 
°©us
 = 
s_pSecFn
->
	`De¸y±Mesßge
(&
s•i_c⁄ãxt
,

554 &
wøp_desc
,

556 &
q›
);

558 if(
	`check_s•i_îr
(
c⁄n
, 
°©us
, "DecryptMessage")) {

559 if(
s•i_w_tokí
[0].
pvBuf„r
)

560 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

561 if(
s•i_w_tokí
[1].
pvBuf„r
)

562 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[1].
pvBuf„r
);

563 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

564 
	`Áûf
(
d©a
, "FailedÅo query security contextáttributes.");

565  
CURLE_COULDNT_CONNECT
;

568 if(
s•i_w_tokí
[1].
cbBuf„r
 != 1) {

569 
	`Áûf
(
d©a
, "Invalid SSPIÉncryptionÑesponseÜength (%lu).",

570 ()
s•i_w_tokí
[1].
cbBuf„r
);

571 if(
s•i_w_tokí
[0].
pvBuf„r
)

572 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

573 if(
s•i_w_tokí
[1].
pvBuf„r
)

574 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[1].
pvBuf„r
);

575 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

576  
CURLE_COULDNT_CONNECT
;

579 
	`mem˝y
(
sock§eq
,
s•i_w_tokí
[1].
pvBuf„r
,s•i_w_tokí[1].
cbBuf„r
);

580 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

581 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[1].
pvBuf„r
);

584 if(
s•i_w_tokí
[0].
cbBuf„r
 != 1) {

585 
	`Áûf
(
d©a
, "Invalid SSPIÉncryptionÑesponseÜength (%lu).",

586 ()
s•i_w_tokí
[0].
cbBuf„r
);

587 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

588 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
s•i_c⁄ãxt
);

589  
CURLE_COULDNT_CONNECT
;

591 
	`mem˝y
(
sock§eq
,
s•i_w_tokí
[0].
pvBuf„r
,s•i_w_tokí[0].
cbBuf„r
);

592 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
s•i_w_tokí
[0].
pvBuf„r
);

595 
	`öfof
(
d©a
, "SOCKS5áccess with%sÖrotection granted.\n",

596 (
sock§eq
[0]==0)?"out gssapi data":

597 ((
sock§eq
[0]==1)?" gssapi integrity":" gssapi confidentiality"));

608  
CURLE_OK
;

609 
	}
}

	@lib/speedcheck.c

23 
	~"cuæ_£tup.h
"

25 
	~<cuæ/cuæ.h
>

26 
	~"uæd©a.h
"

27 
	~"£ndf.h
"

28 
	~"mu…iif.h
"

29 
	~"•ìdcheck.h
"

31 
	$Cuæ_•ìdöô
(
Sessi⁄H™dÀ
 *
d©a
)

33 
	`mem£t
(&
d©a
->
°©e
.
kìps_•ìd
, 0, (
timevÆ
));

34 
	}
}

36 
CURLcode
 
	$Cuæ_•ìdcheck
(
Sessi⁄H™dÀ
 *
d©a
,

37 
timevÆ
 
now
)

39 if((
d©a
->
¥ogªss
.
cuºít_•ìd
 >= 0) &&

40 
d©a
->
£t
.
low_•ìd_time
 &&

41 (
	`Cuæ_tvl⁄g
(
d©a
->
°©e
.
kìps_•ìd
) != 0) &&

42 (
d©a
->
¥ogªss
.
cuºít_•ìd
 < d©a->
£t
.
low_•ìd_limô
)) {

43 
howl⁄g
 = 
	`Cuæ_tvdiff
(
now
, 
d©a
->
°©e
.
kìps_•ìd
);

44 
√xtcheck
 = (
d©a
->
£t
.
low_•ìd_time
 * 1000Ë- 
howl⁄g
;

49 if(
√xtcheck
 <= 0) {

51 
	`Áûf
(
d©a
,

54 
d©a
->
£t
.
low_•ìd_limô
,

55 
d©a
->
£t
.
low_•ìd_time
);

56  
CURLE_OPERATION_TIMEDOUT
;

60 
	`Cuæ_expúe
(
d©a
, 
√xtcheck
);

65 
d©a
->
°©e
.
kìps_•ìd
 = 
now
;

67 if(
d©a
->
£t
.
low_•ìd_limô
)

71 
	`Cuæ_expúe
(
d©a
, d©a->
£t
.
low_•ìd_time
*1000);

73  
CURLE_OK
;

74 
	}
}

	@lib/speedcheck.h

1 #i‚de‡
HEADER_CURL_SPEEDCHECK_H


2 
	#HEADER_CURL_SPEEDCHECK_H


	)

25 
	~"cuæ_£tup.h
"

27 
	~"timevÆ.h
"

29 
Cuæ_•ìdöô
(
Sessi⁄H™dÀ
 *
d©a
);

30 
CURLcode
 
Cuæ_•ìdcheck
(
Sessi⁄H™dÀ
 *
d©a
,

31 
timevÆ
 
now
);

	@lib/splay.c

23 
	~"cuæ_£tup.h
"

25 
	~"•œy.h
"

34 
	#com∑ª
(
i
,
j
Ë
	`Cuæ_•œycom∑ªkeys
((i),(j))

	)

40 
Cuæ_åì
 *
	$Cuæ_•œy
(
timevÆ
 
i
,

41 
Cuæ_åì
 *
t
)

43 
Cuæ_åì
 
N
, *
l
, *
r
, *
y
;

44 
comp
;

46 if(
t
 =
NULL
)

47  
t
;

48 
N
.
smÆÀr
 = N.
œrgî
 = 
NULL
;

49 
l
 = 
r
 = &
N
;

52 
comp
 = 
	`com∑ª
(
i
, 
t
->
key
);

53 if(
comp
 < 0) {

54 if(
t
->
smÆÀr
 =
NULL
)

56 if(
	`com∑ª
(
i
, 
t
->
smÆÀr
->
key
) < 0) {

57 
y
 = 
t
->
smÆÀr
;

58 
t
->
smÆÀr
 = 
y
->
œrgî
;

59 
y
->
œrgî
 = 
t
;

60 
t
 = 
y
;

61 if(
t
->
smÆÀr
 =
NULL
)

64 
r
->
smÆÀr
 = 
t
;

65 
r
 = 
t
;

66 
t
 =Å->
smÆÀr
;

68 if(
comp
 > 0) {

69 if(
t
->
œrgî
 =
NULL
)

71 if(
	`com∑ª
(
i
, 
t
->
œrgî
->
key
) > 0) {

72 
y
 = 
t
->
œrgî
;

73 
t
->
œrgî
 = 
y
->
smÆÀr
;

74 
y
->
smÆÀr
 = 
t
;

75 
t
 = 
y
;

76 if(
t
->
œrgî
 =
NULL
)

79 
l
->
œrgî
 = 
t
;

80 
l
 = 
t
;

81 
t
 =Å->
œrgî
;

87 
l
->
œrgî
 = 
t
->
smÆÀr
;

88 
r
->
smÆÀr
 = 
t
->
œrgî
;

89 
t
->
smÆÀr
 = 
N
.
œrgî
;

90 
t
->
œrgî
 = 
N
.
smÆÀr
;

92  
t
;

93 
	}
}

100 
Cuæ_åì
 *
	$Cuæ_•œyö£π
(
timevÆ
 
i
,

101 
Cuæ_åì
 *
t
,

102 
Cuæ_åì
 *
node
)

104 c⁄° 
timevÆ
 
KEY_NOTUSED
 = {-1,-1};

106 if(
node
 =
NULL
)

107  
t
;

109 if(
t
 !
NULL
) {

110 
t
 = 
	`Cuæ_•œy
(
i
,t);

111 if(
	`com∑ª
(
i
, 
t
->
key
)==0) {

116 
node
->
ßme
 = 
t
;

117 
node
->
key
 = 
i
;

118 
node
->
smÆÀr
 = 
t
->smaller;

119 
node
->
œrgî
 = 
t
->larger;

121 
t
->
smÆÀr
 = 
node
;

125 
t
->
key
 = 
KEY_NOTUSED
;

128  
node
;

132 if(
t
 =
NULL
) {

133 
node
->
smÆÀr
 =Çode->
œrgî
 = 
NULL
;

135 if(
	`com∑ª
(
i
, 
t
->
key
) < 0) {

136 
node
->
smÆÀr
 = 
t
->smaller;

137 
node
->
œrgî
 = 
t
;

138 
t
->
smÆÀr
 = 
NULL
;

142 
node
->
œrgî
 = 
t
->larger;

143 
node
->
smÆÀr
 = 
t
;

144 
t
->
œrgî
 = 
NULL
;

146 
node
->
key
 = 
i
;

148 
node
->
ßme
 = 
NULL
;

149  
node
;

150 
	}
}

154 
Cuæ_åì
 *
	$Cuæ_•œygëbe°
(
timevÆ
 
i
,

155 
Cuæ_åì
 *
t
,

156 
Cuæ_åì
 **
ªmoved
)

158 
Cuæ_åì
 *
x
;

160 if(!
t
) {

161 *
ªmoved
 = 
NULL
;

162  
NULL
;

165 
t
 = 
	`Cuæ_•œy
(
i
,t);

166 if(
	`com∑ª
(
i
, 
t
->
key
) < 0) {

168 if(
t
->
smÆÀr
)

169 
t
=
	`Cuæ_•œy
—->
smÆÀr
->
key
,Å);

172 *
ªmoved
 = 
NULL
;

173  
t
;

177 if(
	`com∑ª
(
i
, 
t
->
key
) >= 0) {

179 
x
 = 
t
->
ßme
;

180 if(
x
) {

185 
x
->
key
 = 
t
->key;

186 
x
->
œrgî
 = 
t
->larger;

187 
x
->
smÆÀr
 = 
t
->smaller;

189 *
ªmoved
 = 
t
;

190  
x
;

193 if(
t
->
smÆÀr
 =
NULL
) {

194 
x
 = 
t
->
œrgî
;

197 
x
 = 
	`Cuæ_•œy
(
i
, 
t
->
smÆÀr
);

198 
x
->
œrgî
 = 
t
->larger;

200 *
ªmoved
 = 
t
;

202  
x
;

205 *
ªmoved
 = 
NULL
;

206  
t
;

208 
	}
}

222 
	$Cuæ_•œyªmovebyaddr
(
Cuæ_åì
 *
t
,

223 
Cuæ_åì
 *
ªmovíode
,

224 
Cuæ_åì
 **
√wroŸ
)

226 c⁄° 
timevÆ
 
KEY_NOTUSED
 = {-1,-1};

227 
Cuæ_åì
 *
x
;

229 if(!
t
 || !
ªmovíode
)

232 if(
	`com∑ª
(
KEY_NOTUSED
, 
ªmovíode
->
key
) == 0) {

236 if(
ªmovíode
->
smÆÀr
 =
NULL
)

239 
ªmovíode
->
smÆÀr
->
ßme
 =Ñemovenode->same;

240 if(
ªmovíode
->
ßme
)

241 
ªmovíode
->
ßme
->
smÆÀr
 =Ñemovenode->smaller;

244 
ªmovíode
->
smÆÀr
 = 
NULL
;

247 *
√wroŸ
 = 
t
;

251 
t
 = 
	`Cuæ_•œy
(
ªmovíode
->
key
,Å);

260 if(
t
 !
ªmovíode
)

265 
x
 = 
t
->
ßme
;

266 if(
x
) {

270 
x
->
key
 = 
t
->key;

271 
x
->
œrgî
 = 
t
->larger;

272 
x
->
smÆÀr
 = 
t
->smaller;

276 if(
t
->
smÆÀr
 =
NULL
)

277 
x
 = 
t
->
œrgî
;

279 
x
 = 
	`Cuæ_•œy
(
ªmovíode
->
key
, 
t
->
smÆÀr
);

280 
x
->
œrgî
 = 
t
->larger;

284 *
√wroŸ
 = 
x
;

287 
	}
}

	@lib/splay.h

1 #i‚de‡
HEADER_CURL_SPLAY_H


2 
	#HEADER_CURL_SPLAY_H


	)

24 
	~"cuæ_£tup.h
"

26 
	sCuæ_åì
 {

27 
Cuæ_åì
 *
	msmÆÀr
;

28 
Cuæ_åì
 *
	mœrgî
;

29 
Cuæ_åì
 *
	mßme
;

30 
timevÆ
 
	mkey
;

31 *
	m∑ylﬂd
;

34 
Cuæ_åì
 *
Cuæ_•œy
(
timevÆ
 
i
,

35 
Cuæ_åì
 *
t
);

37 
Cuæ_åì
 *
Cuæ_•œyö£π
(
timevÆ
 
key
,

38 
Cuæ_åì
 *
t
,

39 
Cuæ_åì
 *
√wnode
);

42 
Cuæ_åì
 *
Cuæ_•œyªmove
(
timevÆ
 
key
,

43 
Cuæ_åì
 *
t
,

44 
Cuæ_åì
 **
ªmoved
);

47 
Cuæ_åì
 *
Cuæ_•œygëbe°
(
timevÆ
 
key
,

48 
Cuæ_åì
 *
t
,

49 
Cuæ_åì
 **
ªmoved
);

51 
Cuæ_•œyªmovebyaddr
(
Cuæ_åì
 *
t
,

52 
Cuæ_åì
 *
ªmovíode
,

53 
Cuæ_åì
 **
√wroŸ
);

55 
	#Cuæ_•œycom∑ªkeys
(
i
,
j
Ë–((i.
tv_£c
) < (j.tv_sec)) ? -1 : \

56 –((
i
.
tv_£c
Ë> (
j
.tv_sec)) ? 1 : \

57 –((
i
.
tv_u£c
Ë< (
j
.tv_usec)) ? -1 : \

58 –((
i
.
tv_u£c
Ë> (
j
.tv_u£c)Ë? 1 : 0 ))))

	)

60 #ifde‡
DEBUGBUILD


61 
Cuæ_•œy¥öt
(
Cuæ_åì
 * 
t
, 
d
, 
ouçut
);

63 
	#Cuæ_•œy¥öt
(
x
,
y
,
z
Ë
Cuæ_n›_°mt


	)

	@lib/ssh.c

25 
	~"cuæ_£tup.h
"

27 #ifde‡
USE_LIBSSH2


29 #ifde‡
HAVE_LIMITS_H


30 
	~<limôs.h
>

33 
	~<libssh2.h
>

34 
	~<libssh2_s·p.h
>

36 #ifde‡
HAVE_FCNTL_H


37 
	~<f˙é.h
>

40 #ifde‡
HAVE_NETINET_IN_H


41 
	~<√töë/ö.h
>

43 #ifde‡
HAVE_ARPA_INET_H


44 
	~<¨∑/öë.h
>

46 #ifde‡
HAVE_UTSNAME_H


47 
	~<sys/ut¢ame.h
>

49 #ifde‡
HAVE_NETDB_H


50 
	~<√tdb.h
>

52 #ifde‡
__VMS


53 
	~<ö.h
>

54 
	~<öë.h
>

57 #i‡(
deföed
(
NETWARE
Ë&& deföed(
__NOVELL_LIBC__
))

58 #unde‡
ö_addr_t


59 
	#ö_addr_t
 

	)

62 
	~<cuæ/cuæ.h
>

63 
	~"uæd©a.h
"

64 
	~"£ndf.h
"

65 
	~"ho°ù.h
"

66 
	~"¥ogªss.h
"

67 
	~"å™s„r.h
"

68 
	~"esˇ≥.h
"

69 
	~"hâp.h
"

70 
	~"ssh.h
"

71 
	~"uæ.h
"

72 
	~"•ìdcheck.h
"

73 
	~"gëöfo.h
"

75 
	~"°ªquÆ.h
"

76 
	~"vés/vés.h
"

77 
	~"c⁄√˘.h
"

78 
	~"°ªº‹.h
"

79 
	~"öë_¡›.h
"

80 
	~"∑r£d©e.h
"

81 
	~"sockaddr.h
"

82 
	~"°πoof·.h
"

83 
	~"mu…iif.h
"

84 
	~"£À˘.h
"

85 
	~"w¨∆ess.h
"

87 
	#_MPRINTF_REPLACE


	)

88 
	~<cuæ/m¥ötf.h
>

90 
	~"cuæ_mem‹y.h
"

92 
	~"memdebug.h
"

94 #ifde‡
WIN32


95 #unde‡
PATH_MAX


96 
	#PATH_MAX
 
MAX_PATH


	)

99 #i‚de‡
PATH_MAX


100 
	#PATH_MAX
 1024

	)

104 
	#s·p_libssh2_œ°_îr‹
(
s
Ë
	`cuæx_u…osi
(
	`libssh2_s·p_œ°_îr‹
(s))

	)

106 
	#s·p_libssh2_ªÆ∑th
(
s
,
p
,
t
,
m
) \

107 
	`libssh2_s·p_symlök_ex
((
s
), (
p
), 
	`cuæx_uztoui
(
	`°æí
(p)), \

108 (
t
), (
m
), 
LIBSSH2_SFTP_REALPATH
)

	)

111 c⁄° *
s·p_libssh2_°ªº‹
(
îr
);

112 
LIBSSH2_ALLOC_FUNC
(
my_libssh2_mÆloc
);

113 
LIBSSH2_REALLOC_FUNC
(
my_libssh2_ªÆloc
);

114 
LIBSSH2_FREE_FUNC
(
my_libssh2_‰ì
);

116 
CURLcode
 
gë_∑th«me
(c⁄° **
˝p
, **
∑th
);

118 
CURLcode
 
ssh_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

119 
CURLcode
 
ssh_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

120 
CURLcode
 
ssh_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

122 
CURLcode
 
ssh_gëw‹kög∑th
(
c⁄√˘d©a
 *
c⁄n
,

123 *
homedú
,

124 **
∑th
);

126 
CURLcode
 
s˝_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

127 
CURLcode
, 
boﬁ
 
¥em©uª
);

128 
CURLcode
 
s˝_doög
(
c⁄√˘d©a
 *
c⁄n
,

129 
boﬁ
 *
d›ha£_d⁄e
);

130 
CURLcode
 
s˝_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
);

132 
CURLcode
 
s·p_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

133 
CURLcode
, 
boﬁ
 
¥em©uª
);

134 
CURLcode
 
s·p_doög
(
c⁄√˘d©a
 *
c⁄n
,

135 
boﬁ
 *
d›ha£_d⁄e
);

136 
CURLcode
 
s·p_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód
);

138 
CURLcode
 
s·p_≥rf‹m
(
c⁄√˘d©a
 *
c⁄n
,

139 
boﬁ
 *
c⁄√˘ed
,

140 
boﬁ
 *
d›ha£_d⁄e
);

142 
ssh_gësock
(
c⁄√˘d©a
 *
c⁄n
,

143 
cuæ_sockë_t
 *
sock
,

145 
numsocks
);

147 
ssh_≥rf‹m_gësock
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

148 
cuæ_sockë_t
 *
sock
,

150 
numsocks
);

152 
CURLcode
 
ssh_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
);

158 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_s˝
 = {

160 
ssh_£tup_c⁄√˘i⁄
,

161 
ssh_do
,

162 
s˝_d⁄e
,

163 
ZERO_NULL
,

164 
ssh_c⁄√˘
,

165 
ssh_mu…i_°©emach
,

166 
s˝_doög
,

167 
ssh_gësock
,

168 
ssh_gësock
,

169 
ZERO_NULL
,

170 
ssh_≥rf‹m_gësock
,

171 
s˝_disc⁄√˘
,

172 
ZERO_NULL
,

173 
PORT_SSH
,

174 
CURLPROTO_SCP
,

175 
PROTOPT_DIRLOCK
 | 
PROTOPT_CLOSEACTION


176 | 
PROTOPT_NOURLQUERY


184 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_s·p
 = {

186 
ssh_£tup_c⁄√˘i⁄
,

187 
ssh_do
,

188 
s·p_d⁄e
,

189 
ZERO_NULL
,

190 
ssh_c⁄√˘
,

191 
ssh_mu…i_°©emach
,

192 
s·p_doög
,

193 
ssh_gësock
,

194 
ssh_gësock
,

195 
ZERO_NULL
,

196 
ssh_≥rf‹m_gësock
,

197 
s·p_disc⁄√˘
,

198 
ZERO_NULL
,

199 
PORT_SSH
,

200 
CURLPROTO_SFTP
,

201 
PROTOPT_DIRLOCK
 | 
PROTOPT_CLOSEACTION


202 | 
PROTOPT_NOURLQUERY


206 
	$kbd_ˇŒback
(c⁄° *
«me
, 
«me_Àn
, c⁄° *
ö°ru˘i⁄
,

207 
ö°ru˘i⁄_Àn
, 
num_¥om±s
,

208 c⁄° 
LIBSSH2_USERAUTH_KBDINT_PROMPT
 *
¥om±s
,

209 
LIBSSH2_USERAUTH_KBDINT_RESPONSE
 *
ª•⁄£s
,

210 **
ab°ø˘
)

212 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)*
ab°ø˘
;

214 #ifde‡
CURL_LIBSSH2_DEBUG


215 
	`Ârötf
(
°dîr
, "«me=%s\n", 
«me
);

216 
	`Ârötf
(
°dîr
, "«me_Àn=%d\n", 
«me_Àn
);

217 
	`Ârötf
(
°dîr
, "ö°ru˘i⁄=%s\n", 
ö°ru˘i⁄
);

218 
	`Ârötf
(
°dîr
, "ö°ru˘i⁄_Àn=%d\n", 
ö°ru˘i⁄_Àn
);

219 
	`Ârötf
(
°dîr
, "num_¥om±s=%d\n", 
num_¥om±s
);

221 ()
«me
;

222 ()
«me_Àn
;

223 ()
ö°ru˘i⁄
;

224 ()
ö°ru˘i⁄_Àn
;

226 if(
num_¥om±s
 == 1) {

227 
ª•⁄£s
[0].
ãxt
 = 
	`°rdup
(
c⁄n
->
∑sswd
);

228 
ª•⁄£s
[0].
Àngth
 = 
	`cuæx_uztoui
(
	`°æí
(
c⁄n
->
∑sswd
));

230 ()
¥om±s
;

231 ()
ab°ø˘
;

232 
	}
}

234 
CURLcode
 
	$s·p_libssh2_îr‹_to_CURLE
(
îr
)

236 
îr
) {

237 
LIBSSH2_FX_OK
:

238  
CURLE_OK
;

240 
LIBSSH2_FX_NO_SUCH_FILE
:

241 
LIBSSH2_FX_NO_SUCH_PATH
:

242  
CURLE_REMOTE_FILE_NOT_FOUND
;

244 
LIBSSH2_FX_PERMISSION_DENIED
:

245 
LIBSSH2_FX_WRITE_PROTECT
:

246 
LIBSSH2_FX_LOCK_CONFlICT
:

247  
CURLE_REMOTE_ACCESS_DENIED
;

249 
LIBSSH2_FX_NO_SPACE_ON_FILESYSTEM
:

250 
LIBSSH2_FX_QUOTA_EXCEEDED
:

251  
CURLE_REMOTE_DISK_FULL
;

253 
LIBSSH2_FX_FILE_ALREADY_EXISTS
:

254  
CURLE_REMOTE_FILE_EXISTS
;

256 
LIBSSH2_FX_DIR_NOT_EMPTY
:

257  
CURLE_QUOTE_ERROR
;

263  
CURLE_SSH
;

264 
	}
}

266 
CURLcode
 
	$libssh2_£ssi⁄_îr‹_to_CURLE
(
îr
)

268 
îr
) {

270 
LIBSSH2_ERROR_NONE
:

271  
CURLE_OK
;

273 
LIBSSH2_ERROR_SOCKET_NONE
:

274  
CURLE_COULDNT_CONNECT
;

276 
LIBSSH2_ERROR_ALLOC
:

277  
CURLE_OUT_OF_MEMORY
;

279 
LIBSSH2_ERROR_SOCKET_SEND
:

280  
CURLE_SEND_ERROR
;

282 
LIBSSH2_ERROR_HOSTKEY_INIT
:

283 
LIBSSH2_ERROR_HOSTKEY_SIGN
:

284 
LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED
:

285 
LIBSSH2_ERROR_PUBLICKEY_UNVERIFIED
:

286  
CURLE_PEER_FAILED_VERIFICATION
;

288 
LIBSSH2_ERROR_PASSWORD_EXPIRED
:

289  
CURLE_LOGIN_DENIED
;

291 
LIBSSH2_ERROR_SOCKET_TIMEOUT
:

292 
LIBSSH2_ERROR_TIMEOUT
:

293  
CURLE_OPERATION_TIMEDOUT
;

295 
LIBSSH2_ERROR_EAGAIN
:

296  
CURLE_AGAIN
;

303  
CURLE_SSH
;

304 
	}
}

306 
	$LIBSSH2_ALLOC_FUNC
(
my_libssh2_mÆloc
)

308 ()
ab°ø˘
;

309  
	`mÆloc
(
cou¡
);

310 
	}
}

312 
	$LIBSSH2_REALLOC_FUNC
(
my_libssh2_ªÆloc
)

314 ()
ab°ø˘
;

315  
	`ªÆloc
(
±r
, 
cou¡
);

316 
	}
}

318 
	$LIBSSH2_FREE_FUNC
(
my_libssh2_‰ì
)

320 ()
ab°ø˘
;

321 if(
±r
)

322 
	`‰ì
(
±r
);

323 
	}
}

329 
	$°©e
(
c⁄√˘d©a
 *
c⁄n
, 
ssh°©e
 
now°©e
)

331 
ssh_c⁄n
 *
sshc
 = &
c⁄n
->
¥Ÿo
.sshc;

332 #i‡
	`deföed
(
DEBUGBUILD
Ë&& !deföed(
CURL_DISABLE_VERBOSE_STRINGS
)

334 c⁄° * c⁄° 
«mes
[] = {

392 if(
sshc
->
°©e
 !
now°©e
) {

393 
	`öfof
(
c⁄n
->
d©a
, "SFTP %p state change from %sÅo %s\n",

394 (*)
sshc
, 
«mes
[sshc->
°©e
],Çames[
now°©e
]);

398 
sshc
->
°©e
 = 
now°©e
;

399 
	}
}

402 
CURLcode
 
	$ssh_gëw‹kög∑th
(
c⁄√˘d©a
 *
c⁄n
,

403 *
homedú
,

404 **
∑th
)

407 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

408 *
ªÆ_∑th
 = 
NULL
;

409 *
w‹kög_∑th
;

410 
w‹kög_∑th_Àn
;

412 
w‹kög_∑th
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
, d©a->
°©e
.
∑th
, 0,

413 &
w‹kög_∑th_Àn
);

414 if(!
w‹kög_∑th
)

415  
CURLE_OUT_OF_MEMORY
;

418 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
CURLPROTO_SCP
) {

419 
ªÆ_∑th
 = 
	`mÆloc
(
w‹kög_∑th_Àn
+1);

420 if(
ªÆ_∑th
 =
NULL
) {

421 
	`‰ì
(
w‹kög_∑th
);

422  
CURLE_OUT_OF_MEMORY
;

424 if((
w‹kög_∑th_Àn
 > 3Ë&& (!
	`memcmp
(
w‹kög_∑th
, "/~/", 3)))

426 
	`mem˝y
(
ªÆ_∑th
, 
w‹kög_∑th
+3, 4 + 
w‹kög_∑th_Àn
-3);

428 
	`mem˝y
(
ªÆ_∑th
, 
w‹kög_∑th
, 1 + 
w‹kög_∑th_Àn
);

430 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
CURLPROTO_SFTP
) {

431 if((
w‹kög_∑th_Àn
 > 1Ë&& (
w‹kög_∑th
[1] == '~')) {

432 
size_t
 
homñí
 = 
	`°æí
(
homedú
);

433 
ªÆ_∑th
 = 
	`mÆloc
(
homñí
 + 
w‹kög_∑th_Àn
 + 1);

434 if(
ªÆ_∑th
 =
NULL
) {

435 
	`‰ì
(
w‹kög_∑th
);

436  
CURLE_OUT_OF_MEMORY
;

440 
	`mem˝y
(
ªÆ_∑th
, 
homedú
, 
homñí
);

441 
ªÆ_∑th
[
homñí
] = '/';

442 
ªÆ_∑th
[
homñí
+1] = '\0';

443 if(
w‹kög_∑th_Àn
 > 3) {

444 
	`mem˝y
(
ªÆ_∑th
+
homñí
+1, 
w‹kög_∑th
 + 3,

445 1 + 
w‹kög_∑th_Àn
 -3);

449 
ªÆ_∑th
 = 
	`mÆloc
(
w‹kög_∑th_Àn
+1);

450 if(
ªÆ_∑th
 =
NULL
) {

451 
	`‰ì
(
w‹kög_∑th
);

452  
CURLE_OUT_OF_MEMORY
;

454 
	`mem˝y
(
ªÆ_∑th
, 
w‹kög_∑th
, 1+
w‹kög_∑th_Àn
);

458 
	`‰ì
(
w‹kög_∑th
);

461 *
∑th
 = 
ªÆ_∑th
;

463  
CURLE_OK
;

464 
	}
}

466 #ifde‡
HAVE_LIBSSH2_KNOWNHOST_API


467 
	$sshkeyˇŒback
(
CURL
 *
ósy
,

468 c⁄° 
cuæ_khkey
 *
knownkey
,

469 c⁄° 
cuæ_khkey
 *
foundkey
,

470 
cuæ_khm©ch
 
m©ch
,

471 *
˛õ¡p
)

473 ()
ósy
;

474 ()
knownkey
;

475 ()
foundkey
;

476 ()
˛õ¡p
;

479  (
m©ch
 !
CURLKHMATCH_OK
)?
CURLKHSTAT_REJECT
:
CURLKHSTAT_FINE
;

480 
	}
}

487 #ifde‡
HAVE_LIBSSH2_SFTP_SEEK64


488 
	#SFTP_SEEK
(
x
,
y
Ë
	`libssh2_s·p_£ek64
(x, (
libssh2_uöt64_t
)y)

	)

490 
	#SFTP_SEEK
(
x
,
y
Ë
	`libssh2_s·p_£ek
(x, (
size_t
)y)

	)

497 #i‚de‡
HAVE_LIBSSH2_SCP_SEND64


498 
	#SCP_SEND
(
a
,
b
,
c
,
d
Ë
	`libssh2_s˝_£nd_ex
◊, b, ()(c), (
size_t
)d, 0, 0)

	)

500 
	#SCP_SEND
(
a
,
b
,
c
,
d
Ë
	`libssh2_s˝_£nd64
(a, b, ()(c), \

501 (
libssh2_uöt64_t
)
d
, 0, 0)

	)

507 #ifde‡
HAVE_LIBSSH2_SESSION_HANDSHAKE


508 
	#libssh2_£ssi⁄_°¨tup
(
x
,
y
Ë
	`libssh2_£ssi⁄_h™dshake
(x,y)

	)

511 
CURLcode
 
	$ssh_knownho°
(
c⁄√˘d©a
 *
c⁄n
)

513 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

515 #ifde‡
HAVE_LIBSSH2_KNOWNHOST_API


516 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

518 if(
d©a
->
£t
.
°r
[
STRING_SSH_KNOWNHOSTS
]) {

520 
ssh_c⁄n
 *
sshc
 = &
c⁄n
->
¥Ÿo
.sshc;

521 
rc
;

522 
keyty≥
;

523 
size_t
 
keyÀn
;

524 c⁄° *
ªmŸekey
 = 
	`libssh2_£ssi⁄_ho°key
(
sshc
->
ssh_£ssi⁄
,

525 &
keyÀn
, &
keyty≥
);

526 
keycheck
 = 
LIBSSH2_KNOWNHOST_CHECK_FAILURE
;

527 
keybô
 = 0;

529 if(
ªmŸekey
) {

535 
libssh2_knownho°
 *
ho°
;

536 
cuæ_khm©ch
 
keym©ch
;

537 
cuæ_sshkeyˇŒback
 
func
 =

538 
d©a
->
£t
.
ssh_keyfunc
?d©a->£t.ssh_keyfunc:
sshkeyˇŒback
;

539 
cuæ_khkey
 
knownkey
;

540 
cuæ_khkey
 *
knownkeyp
 = 
NULL
;

541 
cuæ_khkey
 
foundkey
;

543 
keybô
 = (
keyty≥
 =
LIBSSH2_HOSTKEY_TYPE_RSA
)?

544 
LIBSSH2_KNOWNHOST_KEY_SSHRSA
:
LIBSSH2_KNOWNHOST_KEY_SSHDSS
;

546 
keycheck
 = 
	`libssh2_knownho°_check
(
sshc
->
kh
,

547 
c⁄n
->
ho°
.
«me
,

548 
ªmŸekey
, 
keyÀn
,

549 
LIBSSH2_KNOWNHOST_TYPE_PLAIN
|

550 
LIBSSH2_KNOWNHOST_KEYENC_RAW
|

551 
keybô
,

552 &
ho°
);

554 
	`öfof
(
d©a
, "SSH ho° check: %d, key: %s\n", 
keycheck
,

555 (
keycheck
 <
LIBSSH2_KNOWNHOST_CHECK_MISMATCH
)?

556 
ho°
->
key
:"<none>");

559 if(
keycheck
 <
LIBSSH2_KNOWNHOST_CHECK_MISMATCH
) {

560 
knownkey
.
key
 = 
ho°
->key;

561 
knownkey
.
Àn
 = 0;

562 
knownkey
.
keyty≥
 = (keyty≥ =
LIBSSH2_HOSTKEY_TYPE_RSA
)?

563 
CURLKHTYPE_RSA
 : 
CURLKHTYPE_DSS
;

564 
knownkeyp
 = &
knownkey
;

568 
foundkey
.
key
 = 
ªmŸekey
;

569 
foundkey
.
Àn
 = 
keyÀn
;

570 
foundkey
.
keyty≥
 = (keyty≥ =
LIBSSH2_HOSTKEY_TYPE_RSA
)?

571 
CURLKHTYPE_RSA
 : 
CURLKHTYPE_DSS
;

578 
keym©ch
 = (
cuæ_khm©ch
)
keycheck
;

581 
rc
 = 
	`func
(
d©a
, 
knownkeyp
,

582 &
foundkey
,

583 
keym©ch
, 
d©a
->
£t
.
ssh_keyfunc_u£Ω
);

587 
rc
 = 
CURLKHSTAT_REJECT
;

589 
rc
) {

591 
CURLKHSTAT_REJECT
:

592 
	`°©e
(
c⁄n
, 
SSH_SESSION_FREE
);

593 
CURLKHSTAT_DEFER
:

595 
ªsu…
 = 
sshc
->
a˘uÆcode
 = 
CURLE_PEER_FAILED_VERIFICATION
;

597 
CURLKHSTAT_FINE
:

598 
CURLKHSTAT_FINE_ADD_TO_FILE
:

600 if(
keycheck
 !
LIBSSH2_KNOWNHOST_CHECK_MATCH
) {

603 
addrc
 = 
	`libssh2_knownho°_add
(
sshc
->
kh
,

604 
c⁄n
->
ho°
.
«me
, 
NULL
,

605 
ªmŸekey
, 
keyÀn
,

606 
LIBSSH2_KNOWNHOST_TYPE_PLAIN
|

607 
LIBSSH2_KNOWNHOST_KEYENC_RAW
|

608 
keybô
, 
NULL
);

609 if(
addrc
)

610 
	`öfof
(
d©a
, "WarningáddingÅhe known host %s failed!\n",

611 
c⁄n
->
ho°
.
«me
);

612 if(
rc
 =
CURLKHSTAT_FINE_ADD_TO_FILE
) {

615 
wrc
 =

616 
	`libssh2_knownho°_wrôefûe
(
sshc
->
kh
,

617 
d©a
->
£t
.
°r
[
STRING_SSH_KNOWNHOSTS
],

618 
LIBSSH2_KNOWNHOST_FILE_OPENSSH
);

619 if(
wrc
) {

620 
	`öfof
(
d©a
, "Warning, writing %s failed!\n",

621 
d©a
->
£t
.
°r
[
STRING_SSH_KNOWNHOSTS
]);

629 ()
c⁄n
;

631  
ªsu…
;

632 
	}
}

634 
CURLcode
 
	$ssh_check_fögî¥öt
(
c⁄√˘d©a
 *
c⁄n
)

636 
ssh_c⁄n
 *
sshc
 = &
c⁄n
->
¥Ÿo
.sshc;

637 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

638 c⁄° *
pubkey_md5
 = 
d©a
->
£t
.
°r
[
STRING_SSH_HOST_PUBLIC_KEY_MD5
];

639 
md5buf„r
[33];

640 
i
;

642 c⁄° *
fögî¥öt
 = 
	`libssh2_ho°key_hash
(
sshc
->
ssh_£ssi⁄
,

643 
LIBSSH2_HOSTKEY_HASH_MD5
);

645 if(
fögî¥öt
) {

647 
i
 = 0; i < 16; i++)

648 
	`¢¥ötf
(&
md5buf„r
[
i
*2], 3, "%02x", (Ë
fögî¥öt
[i]);

649 
	`öfof
(
d©a
, "SSH MD5 fögî¥öt: %s\n", 
md5buf„r
);

655 if(
pubkey_md5
 && 
	`°æí
(pubkey_md5) == 32) {

656 if(!
fögî¥öt
 || !
	`°ªquÆ
(
md5buf„r
, 
pubkey_md5
)) {

657 if(
fögî¥öt
)

658 
	`Áûf
(
d©a
,

660 "RemŸê%†i†nŸÉquÆÅÿ%s", 
md5buf„r
, 
pubkey_md5
);

662 
	`Áûf
(
d©a
,

664 
	`°©e
(
c⁄n
, 
SSH_SESSION_FREE
);

665 
sshc
->
a˘uÆcode
 = 
CURLE_PEER_FAILED_VERIFICATION
;

666  
sshc
->
a˘uÆcode
;

669 
	`öfof
(
d©a
, "MD5 checksum match!\n");

671  
CURLE_OK
;

675  
	`ssh_knownho°
(
c⁄n
);

676 
	}
}

685 
CURLcode
 
	$ssh_°©emach_a˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
block
)

687 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

688 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

689 
SSHPROTO
 *
s·p_s˝
 = 
d©a
->
ªq
.
¥Ÿ›
;

690 
ssh_c⁄n
 *
sshc
 = &
c⁄n
->
¥Ÿo
.sshc;

691 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
FIRSTSOCKET
];

692 *
√w_ªaddú_löe
;

693 
rc
 = 
LIBSSH2_ERROR_NONE
;

694 
îr
;

695 
£ekîr
 = 
CURL_SEEKFUNC_OK
;

696 *
block
 = 0;

700 
sshc
->
°©e
) {

701 
SSH_INIT
:

702 
sshc
->
£c⁄dCª©eDús
 = 0;

703 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

704 
sshc
->
a˘uÆcode
 = 
CURLE_OK
;

708 
	`libssh2_£ssi⁄_£t_blockög
(
sshc
->
ssh_£ssi⁄
, 0);

710 
	`°©e
(
c⁄n
, 
SSH_S_STARTUP
);

713 
SSH_S_STARTUP
:

714 
rc
 = 
	`libssh2_£ssi⁄_°¨tup
(
sshc
->
ssh_£ssi⁄
, ()
sock
);

715 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

718 if(
rc
) {

719 
	`Áûf
(
d©a
, "FailureÉstablishing ssh session");

720 
	`°©e
(
c⁄n
, 
SSH_SESSION_FREE
);

721 
sshc
->
a˘uÆcode
 = 
CURLE_FAILED_INIT
;

725 
	`°©e
(
c⁄n
, 
SSH_HOSTKEY
);

728 
SSH_HOSTKEY
:

734 
ªsu…
 = 
	`ssh_check_fögî¥öt
(
c⁄n
);

735 if(
ªsu…
 =
CURLE_OK
)

736 
	`°©e
(
c⁄n
, 
SSH_AUTHLIST
);

740 
SSH_AUTHLIST
:

751 
sshc
->
authli°
 = 
	`libssh2_u£øuth_li°
(sshc->
ssh_£ssi⁄
,

752 
c⁄n
->
u£r
,

753 
	`cuæx_uztoui
(
	`°æí
(
c⁄n
->
u£r
)));

755 if(!
sshc
->
authli°
) {

756 if(
	`libssh2_u£øuth_authítiˇãd
(
sshc
->
ssh_£ssi⁄
)) {

757 
sshc
->
authed
 = 
TRUE
;

758 
	`öfof
(
d©a
, "SSH useráccepted withÇoáuthentication\n");

759 
	`°©e
(
c⁄n
, 
SSH_AUTH_DONE
);

762 if((
îr
 = 
	`libssh2_£ssi⁄_œ°_î∫o
(
sshc
->
ssh_£ssi⁄
)) ==

763 
LIBSSH2_ERROR_EAGAIN
) {

764 
rc
 = 
LIBSSH2_ERROR_EAGAIN
;

768 
	`°©e
(
c⁄n
, 
SSH_SESSION_FREE
);

769 
sshc
->
a˘uÆcode
 = 
	`libssh2_£ssi⁄_îr‹_to_CURLE
(
îr
);

773 
	`öfof
(
d©a
, "SSHáuthentication methodsávailable: %s\n",

774 
sshc
->
authli°
);

776 
	`°©e
(
c⁄n
, 
SSH_AUTH_PKEY_INIT
);

779 
SSH_AUTH_PKEY_INIT
:

784 
sshc
->
authed
 = 
FALSE
;

786 if((
d©a
->
£t
.
ssh_auth_ty≥s
 & 
CURLSSH_AUTH_PUBLICKEY
) &&

787 (
	`°r°r
(
sshc
->
authli°
, "publickey"Ë!
NULL
)) {

788 *
home
 = 
NULL
;

789 
boﬁ
 
rß_pub_em±y_but_ok
 = 
FALSE
;

791 
sshc
->
rß_pub
 = sshc->
rß
 = 
NULL
;

795 
home
 = 
	`cuæ_gëív
("HOME");

797 if(
d©a
->
£t
.
°r
[
STRING_SSH_PUBLIC_KEY
] &&

798 !*
d©a
->
£t
.
°r
[
STRING_SSH_PUBLIC_KEY
])

799 
rß_pub_em±y_but_ok
 = 
åue
;

800 if(
d©a
->
£t
.
°r
[
STRING_SSH_PUBLIC_KEY
])

801 
sshc
->
rß_pub
 = 
	`≠rötf
("%s", 
d©a
->
£t
.
°r
[
STRING_SSH_PUBLIC_KEY
]);

802 if(
home
)

803 
sshc
->
rß_pub
 = 
	`≠rötf
("%s/.ssh/id_dß.pub", 
home
);

806 
sshc
->
rß_pub
 = 
	`°rdup
("id_dsa.pub");

808 if(!
rß_pub_em±y_but_ok
 && (
sshc
->
rß_pub
 =
NULL
)) {

809 
	`Cuæ_ß„‰ì
(
home
);

810 
	`°©e
(
c⁄n
, 
SSH_SESSION_FREE
);

811 
sshc
->
a˘uÆcode
 = 
CURLE_OUT_OF_MEMORY
;

815 if(
d©a
->
£t
.
°r
[
STRING_SSH_PRIVATE_KEY
])

816 
sshc
->
rß
 = 
	`≠rötf
("%s", 
d©a
->
£t
.
°r
[
STRING_SSH_PRIVATE_KEY
]);

817 if(
home
)

818 
sshc
->
rß
 = 
	`≠rötf
("%s/.ssh/id_dß", 
home
);

821 
sshc
->
rß
 = 
	`°rdup
("id_dsa");

823 if(
sshc
->
rß
 =
NULL
) {

824 
	`Cuæ_ß„‰ì
(
home
);

825 
	`Cuæ_ß„‰ì
(
sshc
->
rß_pub
);

826 
	`°©e
(
c⁄n
, 
SSH_SESSION_FREE
);

827 
sshc
->
a˘uÆcode
 = 
CURLE_OUT_OF_MEMORY
;

831 
sshc
->
∑s•hø£
 = 
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
];

832 if(!
sshc
->
∑s•hø£
)

833 
sshc
->
∑s•hø£
 = "";

835 
	`Cuæ_ß„‰ì
(
home
);

837 
	`öfof
(
d©a
, "Usög sshÖubli¯key fûê%s\n", 
sshc
->
rß_pub
);

838 
	`öfof
(
d©a
, "Usög sshÖriv©êkey fûê%s\n", 
sshc
->
rß
);

840 
	`°©e
(
c⁄n
, 
SSH_AUTH_PKEY
);

843 
	`°©e
(
c⁄n
, 
SSH_AUTH_PASS_INIT
);

847 
SSH_AUTH_PKEY
:

850 
rc
 = 
	`libssh2_u£øuth_publickey_‰omfûe_ex
(
sshc
->
ssh_£ssi⁄
,

851 
c⁄n
->
u£r
,

852 
	`cuæx_uztoui
(

853 
	`°æí
(
c⁄n
->
u£r
)),

854 
sshc
->
rß_pub
,

855 
sshc
->
rß
, sshc->
∑s•hø£
);

856 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

860 
	`Cuæ_ß„‰ì
(
sshc
->
rß_pub
);

861 
	`Cuæ_ß„‰ì
(
sshc
->
rß
);

863 if(
rc
 == 0) {

864 
sshc
->
authed
 = 
TRUE
;

865 
	`öfof
(
d©a
, "Initialized SSHÖublic keyáuthentication\n");

866 
	`°©e
(
c⁄n
, 
SSH_AUTH_DONE
);

869 *
îr_msg
;

870 ()
	`libssh2_£ssi⁄_œ°_îr‹
(
sshc
->
ssh_£ssi⁄
,

871 &
îr_msg
, 
NULL
, 0);

872 
	`öfof
(
d©a
, "SSHÖubli¯keyáuthítiˇti⁄ faûed: %s\n", 
îr_msg
);

873 
	`°©e
(
c⁄n
, 
SSH_AUTH_PASS_INIT
);

877 
SSH_AUTH_PASS_INIT
:

878 if((
d©a
->
£t
.
ssh_auth_ty≥s
 & 
CURLSSH_AUTH_PASSWORD
) &&

879 (
	`°r°r
(
sshc
->
authli°
, "∑ssw‹d"Ë!
NULL
)) {

880 
	`°©e
(
c⁄n
, 
SSH_AUTH_PASS
);

883 
	`°©e
(
c⁄n
, 
SSH_AUTH_HOST_INIT
);

887 
SSH_AUTH_PASS
:

888 
rc
 = 
	`libssh2_u£øuth_∑ssw‹d_ex
(
sshc
->
ssh_£ssi⁄
, 
c⁄n
->
u£r
,

889 
	`cuæx_uztoui
(
	`°æí
(
c⁄n
->
u£r
)),

890 
c⁄n
->
∑sswd
,

891 
	`cuæx_uztoui
(
	`°æí
(
c⁄n
->
∑sswd
)),

892 
NULL
);

893 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

896 if(
rc
 == 0) {

897 
sshc
->
authed
 = 
TRUE
;

898 
	`öfof
(
d©a
, "InitializedÖasswordáuthentication\n");

899 
	`°©e
(
c⁄n
, 
SSH_AUTH_DONE
);

902 
	`°©e
(
c⁄n
, 
SSH_AUTH_HOST_INIT
);

906 
SSH_AUTH_HOST_INIT
:

907 if((
d©a
->
£t
.
ssh_auth_ty≥s
 & 
CURLSSH_AUTH_HOST
) &&

908 (
	`°r°r
(
sshc
->
authli°
, "ho°ba£d"Ë!
NULL
)) {

909 
	`°©e
(
c⁄n
, 
SSH_AUTH_HOST
);

912 
	`°©e
(
c⁄n
, 
SSH_AUTH_AGENT_INIT
);

916 
SSH_AUTH_HOST
:

917 
	`°©e
(
c⁄n
, 
SSH_AUTH_AGENT_INIT
);

920 
SSH_AUTH_AGENT_INIT
:

921 #ifde‡
HAVE_LIBSSH2_AGENT_API


922 if((
d©a
->
£t
.
ssh_auth_ty≥s
 & 
CURLSSH_AUTH_AGENT
)

923 && (
	`°r°r
(
sshc
->
authli°
, "publickey"Ë!
NULL
)) {

928 if(!
sshc
->
ssh_agít
) {

929 
sshc
->
ssh_agít
 = 
	`libssh2_agít_öô
(sshc->
ssh_£ssi⁄
);

930 if(!
sshc
->
ssh_agít
) {

931 
	`öfof
(
d©a
, "CouldÇot createágent object\n");

933 
	`°©e
(
c⁄n
, 
SSH_AUTH_KEY_INIT
);

938 
rc
 = 
	`libssh2_agít_c⁄√˘
(
sshc
->
ssh_agít
);

939 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
)

941 if(
rc
 < 0) {

942 
	`öfof
(
d©a
, "Failure connectingÅoágent\n");

943 
	`°©e
(
c⁄n
, 
SSH_AUTH_KEY_INIT
);

946 
	`°©e
(
c⁄n
, 
SSH_AUTH_AGENT_LIST
);

951 
	`°©e
(
c⁄n
, 
SSH_AUTH_KEY_INIT
);

954 
SSH_AUTH_AGENT_LIST
:

955 #ifde‡
HAVE_LIBSSH2_AGENT_API


956 
rc
 = 
	`libssh2_agít_li°_idítôõs
(
sshc
->
ssh_agít
);

958 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
)

960 if(
rc
 < 0) {

961 
	`öfof
(
d©a
, "FailureÑequesting identitiesÅoágent\n");

962 
	`°©e
(
c⁄n
, 
SSH_AUTH_KEY_INIT
);

965 
	`°©e
(
c⁄n
, 
SSH_AUTH_AGENT
);

966 
sshc
->
sshagít_¥ev_idítôy
 = 
NULL
;

971 
SSH_AUTH_AGENT
:

972 #ifde‡
HAVE_LIBSSH2_AGENT_API


976 
rc
 = 
	`libssh2_agít_gë_idítôy
(
sshc
->
ssh_agít
,

977 &
sshc
->
sshagít_idítôy
,

978 
sshc
->
sshagít_¥ev_idítôy
);

979 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
)

982 if(
rc
 == 0) {

983 
rc
 = 
	`libssh2_agít_u£øuth
(
sshc
->
ssh_agít
, 
c⁄n
->
u£r
,

984 
sshc
->
sshagít_idítôy
);

986 if(
rc
 < 0) {

987 if(
rc
 !
LIBSSH2_ERROR_EAGAIN
) {

989 
sshc
->
sshagít_¥ev_idítôy
 = sshc->
sshagít_idítôy
;

995 if(
rc
 < 0)

996 
	`öfof
(
d©a
, "FailureÑequesting identitiesÅoágent\n");

997 if(
rc
 == 1)

998 
	`öfof
(
d©a
, "No identity would match\n");

1000 if(
rc
 =
LIBSSH2_ERROR_NONE
) {

1001 
sshc
->
authed
 = 
TRUE
;

1002 
	`öfof
(
d©a
, "Agent basedáuthentication successful\n");

1003 
	`°©e
(
c⁄n
, 
SSH_AUTH_DONE
);

1006 
	`°©e
(
c⁄n
, 
SSH_AUTH_KEY_INIT
);

1010 
SSH_AUTH_KEY_INIT
:

1011 if((
d©a
->
£t
.
ssh_auth_ty≥s
 & 
CURLSSH_AUTH_KEYBOARD
)

1012 && (
	`°r°r
(
sshc
->
authli°
, "keybﬂrd-öãø˘ive"Ë!
NULL
)) {

1013 
	`°©e
(
c⁄n
, 
SSH_AUTH_KEY
);

1016 
	`°©e
(
c⁄n
, 
SSH_AUTH_DONE
);

1020 
SSH_AUTH_KEY
:

1022 
rc
 = 
	`libssh2_u£øuth_keybﬂrd_öãø˘ive_ex
(
sshc
->
ssh_£ssi⁄
,

1023 
c⁄n
->
u£r
,

1024 
	`cuæx_uztoui
(

1025 
	`°æí
(
c⁄n
->
u£r
)),

1026 &
kbd_ˇŒback
);

1027 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1030 if(
rc
 == 0) {

1031 
sshc
->
authed
 = 
TRUE
;

1032 
	`öfof
(
d©a
, "Initialized keyboard interactiveáuthentication\n");

1034 
	`°©e
(
c⁄n
, 
SSH_AUTH_DONE
);

1037 
SSH_AUTH_DONE
:

1038 if(!
sshc
->
authed
) {

1039 
	`Áûf
(
d©a
, "Authentication failure");

1040 
	`°©e
(
c⁄n
, 
SSH_SESSION_FREE
);

1041 
sshc
->
a˘uÆcode
 = 
CURLE_LOGIN_DENIED
;

1048 
	`öfof
(
d©a
, "Authentication complete\n");

1050 
	`Cuæ_pgrsTime
(
c⁄n
->
d©a
, 
TIMER_APPCONNECT
);

1052 
c⁄n
->
sockfd
 = 
sock
;

1053 
c⁄n
->
wrôesockfd
 = 
CURL_SOCKET_BAD
;

1055 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 =
CURLPROTO_SFTP
) {

1056 
	`°©e
(
c⁄n
, 
SSH_SFTP_INIT
);

1059 
	`öfof
(
d©a
, "SSH CONNECTÖhase done\n");

1060 
	`°©e
(
c⁄n
, 
SSH_STOP
);

1063 
SSH_SFTP_INIT
:

1067 
sshc
->
s·p_£ssi⁄
 = 
	`libssh2_s·p_öô
(sshc->
ssh_£ssi⁄
);

1068 if(!
sshc
->
s·p_£ssi⁄
) {

1069 if(
	`libssh2_£ssi⁄_œ°_î∫o
(
sshc
->
ssh_£ssi⁄
) ==

1070 
LIBSSH2_ERROR_EAGAIN
) {

1071 
rc
 = 
LIBSSH2_ERROR_EAGAIN
;

1075 *
îr_msg
;

1077 ()
	`libssh2_£ssi⁄_œ°_îr‹
(
sshc
->
ssh_£ssi⁄
,

1078 &
îr_msg
, 
NULL
, 0);

1079 
	`Áûf
(
d©a
, "Faûuª inôülizög s·∞£ssi⁄: %s", 
îr_msg
);

1080 
	`°©e
(
c⁄n
, 
SSH_SESSION_FREE
);

1081 
sshc
->
a˘uÆcode
 = 
CURLE_FAILED_INIT
;

1085 
	`°©e
(
c⁄n
, 
SSH_SFTP_REALPATH
);

1088 
SSH_SFTP_REALPATH
:

1090 
ãmpHome
[
PATH_MAX
];

1095 
rc
 = 
	`s·p_libssh2_ªÆ∑th
(
sshc
->
s·p_£ssi⁄
, ".",

1096 
ãmpHome
, 
PATH_MAX
-1);

1097 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1100 if(
rc
 > 0) {

1102 
ãmpHome
[
rc
] = '\0';

1103 
sshc
->
homedú
 = 
	`°rdup
(
ãmpHome
);

1104 if(!
sshc
->
homedú
) {

1105 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1106 
sshc
->
a˘uÆcode
 = 
CURLE_OUT_OF_MEMORY
;

1109 
c⁄n
->
d©a
->
°©e
.
mo°_ª˚¡_·p_íåy∑th
 = 
sshc
->
homedú
;

1113 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1114 
ªsu…
 = 
	`s·p_libssh2_îr‹_to_CURLE
(
îr
);

1115 
sshc
->
a˘uÆcode
 = 
ªsu…
?ªsu…:
CURLE_SSH
;

1116 
	`DEBUGF
(
	`öfof
(
d©a
, "error = %d makesÜibcurl = %d\n",

1117 
îr
, ()
ªsu…
));

1118 
	`°©e
(
c⁄n
, 
SSH_STOP
);

1126 
	`DEBUGF
(
	`öfof
(
d©a
, "SSH CONNECTÖhase done\n"));

1127 
	`°©e
(
c⁄n
, 
SSH_STOP
);

1130 
SSH_SFTP_QUOTE_INIT
:

1132 
ªsu…
 = 
	`ssh_gëw‹kög∑th
(
c⁄n
, 
sshc
->
homedú
, &
s·p_s˝
->
∑th
);

1133 if(
ªsu…
) {

1134 
sshc
->
a˘uÆcode
 = 
ªsu…
;

1135 
	`°©e
(
c⁄n
, 
SSH_STOP
);

1139 if(
d©a
->
£t
.
quŸe
) {

1140 
	`öfof
(
d©a
, "Sending quote commands\n");

1141 
sshc
->
quŸe_ôem
 = 
d©a
->
£t
.
quŸe
;

1142 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE
);

1145 
	`°©e
(
c⁄n
, 
SSH_SFTP_TRANS_INIT
);

1149 
SSH_SFTP_POSTQUOTE_INIT
:

1150 if(
d©a
->
£t
.
po°quŸe
) {

1151 
	`öfof
(
d©a
, "Sending quote commands\n");

1152 
sshc
->
quŸe_ôem
 = 
d©a
->
£t
.
po°quŸe
;

1153 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE
);

1156 
	`°©e
(
c⁄n
, 
SSH_STOP
);

1160 
SSH_SFTP_QUOTE
:

1163 c⁄° *
˝
;

1168 *
cmd
 = 
sshc
->
quŸe_ôem
->
d©a
;

1169 
sshc
->
ac˚±Áû
 = 
FALSE
;

1176 if(
cmd
[0] == '*') {

1177 
cmd
++;

1178 
sshc
->
ac˚±Áû
 = 
TRUE
;

1181 if(
	`cuæ_°ªquÆ
("pwd", 
cmd
)) {

1183 *
tmp
 = 
	`≠rötf
("257 \"%s\" is current directory.\n",

1184 
s·p_s˝
->
∑th
);

1185 if(!
tmp
) {

1186 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1187 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1188 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1191 if(
d©a
->
£t
.
vîbo£
) {

1192 
	`Cuæ_debug
(
d©a
, 
CURLINFO_HEADER_OUT
, (*)"PWD\n", 4, 
c⁄n
);

1193 
	`Cuæ_debug
(
d©a
, 
CURLINFO_HEADER_IN
, 
tmp
, 
	`°æí
—mp), 
c⁄n
);

1198 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_HEADER
, 
tmp
, 
	`°æí
(tmp));

1199 
	`‰ì
(
tmp
);

1200 if(
ªsu…
) {

1201 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1202 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1203 
sshc
->
a˘uÆcode
 = 
ªsu…
;

1206 
	`°©e
(
c⁄n
, 
SSH_SFTP_NEXT_QUOTE
);

1209 if(
cmd
) {

1214 
˝
 = 
	`°rchr
(
cmd
, ' ');

1215 if(
˝
 =
NULL
) {

1216 
	`Áûf
(
d©a
, "SyntaxÉrror in SFTP command. SupplyÖarameter(s)!");

1217 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1218 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1219 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1227 
ªsu…
 = 
	`gë_∑th«me
(&
˝
, &
sshc
->
quŸe_∑th1
);

1228 if(
ªsu…
) {

1229 if(
ªsu…
 =
CURLE_OUT_OF_MEMORY
)

1230 
	`Áûf
(
d©a
, "Out of memory");

1232 
	`Áûf
(
d©a
, "SyntaxÉrror: Bad firstÖarameter");

1233 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1234 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1235 
sshc
->
a˘uÆcode
 = 
ªsu…
;

1245 if(
	`cuæ_°∫equÆ
(
cmd
, "chgrp ", 6) ||

1246 
	`cuæ_°∫equÆ
(
cmd
, "chmod ", 6) ||

1247 
	`cuæ_°∫equÆ
(
cmd
, "chown ", 6) ) {

1252 
ªsu…
 = 
	`gë_∑th«me
(&
˝
, &
sshc
->
quŸe_∑th2
);

1253 if(
ªsu…
) {

1254 if(
ªsu…
 =
CURLE_OUT_OF_MEMORY
)

1255 
	`Áûf
(
d©a
, "Out of memory");

1257 
	`Áûf
(
d©a
, "SyntaxÉrror in chgrp/chmod/chown: "

1259 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1260 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1261 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1262 
sshc
->
a˘uÆcode
 = 
ªsu…
;

1265 
	`mem£t
(&
sshc
->
quŸe_©ås
, 0, (
LIBSSH2_SFTP_ATTRIBUTES
));

1266 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE_STAT
);

1269 if(
	`cuæ_°∫equÆ
(
cmd
, "ln ", 3) ||

1270 
	`cuæ_°∫equÆ
(
cmd
, "symlink ", 8)) {

1274 
ªsu…
 = 
	`gë_∑th«me
(&
˝
, &
sshc
->
quŸe_∑th2
);

1275 if(
ªsu…
) {

1276 if(
ªsu…
 =
CURLE_OUT_OF_MEMORY
)

1277 
	`Áûf
(
d©a
, "Out of memory");

1279 
	`Áûf
(
d©a
,

1281 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1282 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1283 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1284 
sshc
->
a˘uÆcode
 = 
ªsu…
;

1287 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE_SYMLINK
);

1290 if(
	`cuæ_°∫equÆ
(
cmd
, "mkdir ", 6)) {

1292 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE_MKDIR
);

1295 if(
	`cuæ_°∫equÆ
(
cmd
, "rename ", 7)) {

1299 
ªsu…
 = 
	`gë_∑th«me
(&
˝
, &
sshc
->
quŸe_∑th2
);

1300 if(
ªsu…
) {

1301 if(
ªsu…
 =
CURLE_OUT_OF_MEMORY
)

1302 
	`Áûf
(
d©a
, "Out of memory");

1304 
	`Áûf
(
d©a
, "SyntaxÉrror inÑename: Bad secondÖarameter");

1305 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1306 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1307 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1308 
sshc
->
a˘uÆcode
 = 
ªsu…
;

1311 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE_RENAME
);

1314 if(
	`cuæ_°∫equÆ
(
cmd
, "rmdir ", 6)) {

1316 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE_RMDIR
);

1319 if(
	`cuæ_°∫equÆ
(
cmd
, "rm ", 3)) {

1320 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE_UNLINK
);

1324 
	`Áûf
(
d©a
, "Unknown SFTP command");

1325 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1326 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th2
);

1327 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1328 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1329 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1333 if(!
sshc
->
quŸe_ôem
) {

1334 
	`°©e
(
c⁄n
, 
SSH_SFTP_TRANS_INIT
);

1338 
SSH_SFTP_NEXT_QUOTE
:

1339 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1340 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th2
);

1342 
sshc
->
quŸe_ôem
 = sshc->quŸe_ôem->
√xt
;

1344 if(
sshc
->
quŸe_ôem
) {

1345 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE
);

1348 if(
sshc
->
√xt°©e
 !
SSH_NO_STATE
) {

1349 
	`°©e
(
c⁄n
, 
sshc
->
√xt°©e
);

1350 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1353 
	`°©e
(
c⁄n
, 
SSH_SFTP_TRANS_INIT
);

1358 
SSH_SFTP_QUOTE_STAT
:

1360 *
cmd
 = 
sshc
->
quŸe_ôem
->
d©a
;

1361 
sshc
->
ac˚±Áû
 = 
FALSE
;

1368 if(
cmd
[0] == '*') {

1369 
cmd
++;

1370 
sshc
->
ac˚±Áû
 = 
TRUE
;

1373 if(!
	`cuæ_°∫equÆ
(
cmd
, "chmod", 5)) {

1378 
rc
 = 
	`libssh2_s·p_°©_ex
(
sshc
->
s·p_£ssi⁄
, sshc->
quŸe_∑th2
,

1379 
	`cuæx_uztoui
(
	`°æí
(
sshc
->
quŸe_∑th2
)),

1380 
LIBSSH2_SFTP_STAT
,

1381 &
sshc
->
quŸe_©ås
);

1382 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1385 if(
rc
 !0 && !
sshc
->
ac˚±Áû
) {

1386 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1387 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1388 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th2
);

1389 
	`Áûf
(
d©a
, "AttemptÅo get SFTP stats failed: %s",

1390 
	`s·p_libssh2_°ªº‹
(
îr
));

1391 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1392 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1393 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1399 if(
	`cuæ_°∫equÆ
(
cmd
, "chgrp", 5)) {

1400 
sshc
->
quŸe_©ås
.
gid
 = 
	`°πoul
(sshc->
quŸe_∑th1
, 
NULL
, 10);

1401 
sshc
->
quŸe_©ås
.
Êags
 = 
LIBSSH2_SFTP_ATTR_UIDGID
;

1402 if(
sshc
->
quŸe_©ås
.
gid
 =0 && !
	`ISDIGIT
(sshc->
quŸe_∑th1
[0]) &&

1403 !
sshc
->
ac˚±Áû
) {

1404 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1405 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th2
);

1406 
	`Áûf
(
d©a
, "SyntaxÉrror: chgrp gidÇotáÇumber");

1407 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1408 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1409 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1413 if(
	`cuæ_°∫equÆ
(
cmd
, "chmod", 5)) {

1414 
sshc
->
quŸe_©ås
.
≥rmissi⁄s
 = 
	`°πoul
(sshc->
quŸe_∑th1
, 
NULL
, 8);

1415 
sshc
->
quŸe_©ås
.
Êags
 = 
LIBSSH2_SFTP_ATTR_PERMISSIONS
;

1417 if(
sshc
->
quŸe_©ås
.
≥rmissi⁄s
 == 0 &&

1418 !
	`ISDIGIT
(
sshc
->
quŸe_∑th1
[0])) {

1419 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1420 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th2
);

1421 
	`Áûf
(
d©a
, "SyntaxÉrror: chmodÖermissionsÇotáÇumber");

1422 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1423 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1424 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1428 if(
	`cuæ_°∫equÆ
(
cmd
, "chown", 5)) {

1429 
sshc
->
quŸe_©ås
.
uid
 = 
	`°πoul
(sshc->
quŸe_∑th1
, 
NULL
, 10);

1430 
sshc
->
quŸe_©ås
.
Êags
 = 
LIBSSH2_SFTP_ATTR_UIDGID
;

1431 if(
sshc
->
quŸe_©ås
.
uid
 =0 && !
	`ISDIGIT
(sshc->
quŸe_∑th1
[0]) &&

1432 !
sshc
->
ac˚±Áû
) {

1433 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1434 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th2
);

1435 
	`Áûf
(
d©a
, "SyntaxÉrror: chown uidÇotáÇumber");

1436 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1437 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1438 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1444 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE_SETSTAT
);

1448 
SSH_SFTP_QUOTE_SETSTAT
:

1449 
rc
 = 
	`libssh2_s·p_°©_ex
(
sshc
->
s·p_£ssi⁄
, sshc->
quŸe_∑th2
,

1450 
	`cuæx_uztoui
(
	`°æí
(
sshc
->
quŸe_∑th2
)),

1451 
LIBSSH2_SFTP_SETSTAT
,

1452 &
sshc
->
quŸe_©ås
);

1453 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1456 if(
rc
 !0 && !
sshc
->
ac˚±Áû
) {

1457 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1458 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1459 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th2
);

1460 
	`Áûf
(
d©a
, "AttemptÅo set SFTP stats failed: %s",

1461 
	`s·p_libssh2_°ªº‹
(
îr
));

1462 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1463 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1464 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1467 
	`°©e
(
c⁄n
, 
SSH_SFTP_NEXT_QUOTE
);

1470 
SSH_SFTP_QUOTE_SYMLINK
:

1471 
rc
 = 
	`libssh2_s·p_symlök_ex
(
sshc
->
s·p_£ssi⁄
, sshc->
quŸe_∑th1
,

1472 
	`cuæx_uztoui
(
	`°æí
(
sshc
->
quŸe_∑th1
)),

1473 
sshc
->
quŸe_∑th2
,

1474 
	`cuæx_uztoui
(
	`°æí
(
sshc
->
quŸe_∑th2
)),

1475 
LIBSSH2_SFTP_SYMLINK
);

1476 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1479 if(
rc
 !0 && !
sshc
->
ac˚±Áû
) {

1480 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1481 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1482 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th2
);

1483 
	`Áûf
(
d©a
, "symlink command failed: %s",

1484 
	`s·p_libssh2_°ªº‹
(
îr
));

1485 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1486 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1487 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1490 
	`°©e
(
c⁄n
, 
SSH_SFTP_NEXT_QUOTE
);

1493 
SSH_SFTP_QUOTE_MKDIR
:

1494 
rc
 = 
	`libssh2_s·p_mkdú_ex
(
sshc
->
s·p_£ssi⁄
, sshc->
quŸe_∑th1
,

1495 
	`cuæx_uztoui
(
	`°æí
(
sshc
->
quŸe_∑th1
)),

1496 
d©a
->
£t
.
√w_dúe˘‹y_≥rms
);

1497 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1500 if(
rc
 !0 && !
sshc
->
ac˚±Áû
) {

1501 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1502 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1503 
	`Áûf
(
d©a
, "mkdú comm™d faûed: %s", 
	`s·p_libssh2_°ªº‹
(
îr
));

1504 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1505 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1506 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1509 
	`°©e
(
c⁄n
, 
SSH_SFTP_NEXT_QUOTE
);

1512 
SSH_SFTP_QUOTE_RENAME
:

1513 
rc
 = 
	`libssh2_s·p_ª«me_ex
(
sshc
->
s·p_£ssi⁄
, sshc->
quŸe_∑th1
,

1514 
	`cuæx_uztoui
(
	`°æí
(
sshc
->
quŸe_∑th1
)),

1515 
sshc
->
quŸe_∑th2
,

1516 
	`cuæx_uztoui
(
	`°æí
(
sshc
->
quŸe_∑th2
)),

1517 
LIBSSH2_SFTP_RENAME_OVERWRITE
 |

1518 
LIBSSH2_SFTP_RENAME_ATOMIC
 |

1519 
LIBSSH2_SFTP_RENAME_NATIVE
);

1521 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1524 if(
rc
 !0 && !
sshc
->
ac˚±Áû
) {

1525 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1526 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1527 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th2
);

1528 
	`Áûf
(
d©a
, "ª«mêcomm™d faûed: %s", 
	`s·p_libssh2_°ªº‹
(
îr
));

1529 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1530 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1531 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1534 
	`°©e
(
c⁄n
, 
SSH_SFTP_NEXT_QUOTE
);

1537 
SSH_SFTP_QUOTE_RMDIR
:

1538 
rc
 = 
	`libssh2_s·p_rmdú_ex
(
sshc
->
s·p_£ssi⁄
, sshc->
quŸe_∑th1
,

1539 
	`cuæx_uztoui
(
	`°æí
(
sshc
->
quŸe_∑th1
)));

1540 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1543 if(
rc
 !0 && !
sshc
->
ac˚±Áû
) {

1544 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1545 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1546 
	`Áûf
(
d©a
, "rmdú comm™d faûed: %s", 
	`s·p_libssh2_°ªº‹
(
îr
));

1547 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1548 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1549 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1552 
	`°©e
(
c⁄n
, 
SSH_SFTP_NEXT_QUOTE
);

1555 
SSH_SFTP_QUOTE_UNLINK
:

1556 
rc
 = 
	`libssh2_s·p_u∆ök_ex
(
sshc
->
s·p_£ssi⁄
, sshc->
quŸe_∑th1
,

1557 
	`cuæx_uztoui
(
	`°æí
(
sshc
->
quŸe_∑th1
)));

1558 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1561 if(
rc
 !0 && !
sshc
->
ac˚±Áû
) {

1562 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1563 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

1564 
	`Áûf
(
d©a
, "rm comm™d faûed: %s", 
	`s·p_libssh2_°ªº‹
(
îr
));

1565 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1566 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

1567 
sshc
->
a˘uÆcode
 = 
CURLE_QUOTE_ERROR
;

1570 
	`°©e
(
c⁄n
, 
SSH_SFTP_NEXT_QUOTE
);

1573 
SSH_SFTP_TRANS_INIT
:

1574 if(
d©a
->
£t
.
u∂ﬂd
)

1575 
	`°©e
(
c⁄n
, 
SSH_SFTP_UPLOAD_INIT
);

1577 if(
s·p_s˝
->
∑th
[
	`°æí
(sftp_scp->path)-1] == '/')

1578 
	`°©e
(
c⁄n
, 
SSH_SFTP_READDIR_INIT
);

1580 
	`°©e
(
c⁄n
, 
SSH_SFTP_DOWNLOAD_INIT
);

1584 
SSH_SFTP_UPLOAD_INIT
:

1586 
Êags
;

1594 if(
d©a
->
°©e
.
ªsume_‰om
 != 0) {

1595 
LIBSSH2_SFTP_ATTRIBUTES
 
©ås
;

1596 if(
d©a
->
°©e
.
ªsume_‰om
 < 0) {

1597 
rc
 = 
	`libssh2_s·p_°©_ex
(
sshc
->
s·p_£ssi⁄
, 
s·p_s˝
->
∑th
,

1598 
	`cuæx_uztoui
(
	`°æí
(
s·p_s˝
->
∑th
)),

1599 
LIBSSH2_SFTP_STAT
, &
©ås
);

1600 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1603 if(
rc
) {

1604 
d©a
->
°©e
.
ªsume_‰om
 = 0;

1607 
cuæ_off_t
 
size
 = 
©ås
.
fûesize
;

1608 if(
size
 < 0) {

1609 
	`Áûf
(
d©a
, "Bad fûêsizê(%" 
CURL_FORMAT_CURL_OFF_T
 ")", 
size
);

1610  
CURLE_BAD_DOWNLOAD_RESUME
;

1612 
d©a
->
°©e
.
ªsume_‰om
 = 
©ås
.
fûesize
;

1617 if(
d©a
->
£t
.
·p_≠≥nd
)

1619 
Êags
 = 
LIBSSH2_FXF_WRITE
|
LIBSSH2_FXF_CREAT
|
LIBSSH2_FXF_APPEND
;

1620 if(
d©a
->
°©e
.
ªsume_‰om
 > 0)

1622 
Êags
 = 
LIBSSH2_FXF_WRITE
|
LIBSSH2_FXF_APPEND
;

1625 
Êags
 = 
LIBSSH2_FXF_WRITE
|
LIBSSH2_FXF_CREAT
|
LIBSSH2_FXF_TRUNC
;

1627 
sshc
->
s·p_h™dÀ
 =

1628 
	`libssh2_s·p_›í_ex
(
sshc
->
s·p_£ssi⁄
, 
s·p_s˝
->
∑th
,

1629 
	`cuæx_uztoui
(
	`°æí
(
s·p_s˝
->
∑th
)),

1630 
Êags
, 
d©a
->
£t
.
√w_fûe_≥rms
,

1631 
LIBSSH2_SFTP_OPENFILE
);

1633 if(!
sshc
->
s·p_h™dÀ
) {

1634 
rc
 = 
	`libssh2_£ssi⁄_œ°_î∫o
(
sshc
->
ssh_£ssi⁄
);

1636 if(
LIBSSH2_ERROR_EAGAIN
 =
rc
)

1639 if(
LIBSSH2_ERROR_SFTP_PROTOCOL
 =
rc
)

1642 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1644 
îr
 = -1;

1646 if(
sshc
->
£c⁄dCª©eDús
) {

1647 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1648 
sshc
->
a˘uÆcode
 = 
îr
>
LIBSSH2_FX_OK
?

1649 
	`s·p_libssh2_îr‹_to_CURLE
(
îr
):
CURLE_SSH
;

1650 
	`Áûf
(
d©a
, "CreatingÅhe dir/file failed: %s",

1651 
	`s·p_libssh2_°ªº‹
(
îr
));

1654 if(((
îr
 =
LIBSSH2_FX_NO_SUCH_FILE
) ||

1655 (
îr
 =
LIBSSH2_FX_FAILURE
) ||

1656 (
îr
 =
LIBSSH2_FX_NO_SUCH_PATH
)) &&

1657 (
d©a
->
£t
.
·p_¸óã_missög_dús
 &&

1658 (
	`°æí
(
s·p_s˝
->
∑th
) > 1))) {

1660 
sshc
->
£c⁄dCª©eDús
 = 1;

1661 
	`°©e
(
c⁄n
, 
SSH_SFTP_CREATE_DIRS_INIT
);

1664 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1665 
sshc
->
a˘uÆcode
 = 
îr
>
LIBSSH2_FX_OK
?

1666 
	`s·p_libssh2_îr‹_to_CURLE
(
îr
):
CURLE_SSH
;

1667 if(!
sshc
->
a˘uÆcode
) {

1671 
sshc
->
a˘uÆcode
 = 
CURLE_SSH
;

1672 
îr
=-1;

1674 
	`Áûf
(
d©a
, "Upload failed: %s (%d/%d)",

1675 
îr
>
LIBSSH2_FX_OK
?
	`s·p_libssh2_°ªº‹
(err):"sshÉrror",

1676 
îr
, 
rc
);

1683 if(
d©a
->
°©e
.
ªsume_‰om
 > 0) {

1685 if(
c⁄n
->
£ek_func
) {

1686 
£ekîr
 = 
c⁄n
->
	`£ek_func
(c⁄n->
£ek_˛õ¡
, 
d©a
->
°©e
.
ªsume_‰om
,

1687 
SEEK_SET
);

1690 if(
£ekîr
 !
CURL_SEEKFUNC_OK
) {

1692 if(
£ekîr
 !
CURL_SEEKFUNC_CANTSEEK
) {

1693 
	`Áûf
(
d©a
, "CouldÇot seek stream");

1694  
CURLE_FTP_COULDNT_USE_REST
;

1698 
cuæ_off_t
 
∑s£d
=0;

1700 
size_t
 
ªadthißmou¡now
 =

1701 (
d©a
->
°©e
.
ªsume_‰om
 - 
∑s£d
 > 
	`CURL_OFF_T_C
(
BUFSIZE
)) ?

1702 
BUFSIZE
 : 
	`cuæx_sŸouz
(
d©a
->
°©e
.
ªsume_‰om
 - 
∑s£d
);

1704 
size_t
 
a˘uÆlyªad
 =

1705 
c⁄n
->
	`‰ód_func
(
d©a
->
°©e
.
buf„r
, 1, 
ªadthißmou¡now
,

1706 
c⁄n
->
‰ód_ö
);

1708 
∑s£d
 +
a˘uÆlyªad
;

1709 if((
a˘uÆlyªad
 =0Ë|| (a˘uÆlyªad > 
ªadthißmou¡now
)) {

1712 
	`Áûf
(
d©a
, "FailedÅoÑead data");

1713  
CURLE_FTP_COULDNT_USE_REST
;

1715 } 
∑s£d
 < 
d©a
->
°©e
.
ªsume_‰om
);

1720 if(
d©a
->
°©e
.
öfûesize
 > 0) {

1721 
d©a
->
°©e
.
öfûesize
 -d©a->°©e.
ªsume_‰om
;

1722 
d©a
->
ªq
.
size
 = d©a->
°©e
.
öfûesize
;

1723 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, d©a->
°©e
.
öfûesize
);

1726 
	`SFTP_SEEK
(
sshc
->
s·p_h™dÀ
, 
d©a
->
°©e
.
ªsume_‰om
);

1728 if(
d©a
->
°©e
.
öfûesize
 > 0) {

1729 
d©a
->
ªq
.
size
 = d©a->
°©e
.
öfûesize
;

1730 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, d©a->
°©e
.
öfûesize
);

1733 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, 
FIRSTSOCKET
, NULL);

1736 
c⁄n
->
sockfd
 = c⁄n->
wrôesockfd
;

1738 if(
ªsu…
) {

1739 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1740 
sshc
->
a˘uÆcode
 = 
ªsu…
;

1745 
sshc
->
‹ig_waôf‹
 = 
d©a
->
ªq
.
kìp⁄
;

1750 
c⁄n
->
c£À˘_bôs
 = 
CURL_CSELECT_OUT
;

1755 
	`Cuæ_expúe
(
d©a
, 1);

1757 
	`°©e
(
c⁄n
, 
SSH_STOP
);

1762 
SSH_SFTP_CREATE_DIRS_INIT
:

1763 if(
	`°æí
(
s·p_s˝
->
∑th
) > 1) {

1764 
sshc
->
¶ash_pos
 = 
s·p_s˝
->
∑th
 + 1;

1765 
	`°©e
(
c⁄n
, 
SSH_SFTP_CREATE_DIRS
);

1768 
	`°©e
(
c⁄n
, 
SSH_SFTP_UPLOAD_INIT
);

1772 
SSH_SFTP_CREATE_DIRS
:

1773 if((
sshc
->
¶ash_pos
 = 
	`°rchr
(sshc->¶ash_pos, '/')Ë!
NULL
) {

1774 *
sshc
->
¶ash_pos
 = 0;

1776 
	`öfof
(
d©a
, "Cª©ög dúe˘‹y '%s'\n", 
s·p_s˝
->
∑th
);

1777 
	`°©e
(
c⁄n
, 
SSH_SFTP_CREATE_DIRS_MKDIR
);

1781 
	`°©e
(
c⁄n
, 
SSH_SFTP_UPLOAD_INIT
);

1785 
SSH_SFTP_CREATE_DIRS_MKDIR
:

1787 
rc
 = 
	`libssh2_s·p_mkdú_ex
(
sshc
->
s·p_£ssi⁄
, 
s·p_s˝
->
∑th
,

1788 
	`cuæx_uztoui
(
	`°æí
(
s·p_s˝
->
∑th
)),

1789 
d©a
->
£t
.
√w_dúe˘‹y_≥rms
);

1790 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

1793 *
sshc
->
¶ash_pos
 = '/';

1794 ++
sshc
->
¶ash_pos
;

1795 if(
rc
 == -1) {

1801 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1802 if((
îr
 !
LIBSSH2_FX_FILE_ALREADY_EXISTS
) &&

1803 (
îr
 !
LIBSSH2_FX_FAILURE
) &&

1804 (
îr
 !
LIBSSH2_FX_PERMISSION_DENIED
)) {

1805 
ªsu…
 = 
	`s·p_libssh2_îr‹_to_CURLE
(
îr
);

1806 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1807 
sshc
->
a˘uÆcode
 = 
ªsu…
?ªsu…:
CURLE_SSH
;

1811 
	`°©e
(
c⁄n
, 
SSH_SFTP_CREATE_DIRS
);

1814 
SSH_SFTP_READDIR_INIT
:

1815 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, -1);

1816 if(
d©a
->
£t
.
›t_no_body
) {

1817 
	`°©e
(
c⁄n
, 
SSH_STOP
);

1825 
sshc
->
s·p_h™dÀ
 = 
	`libssh2_s·p_›í_ex
(sshc->
s·p_£ssi⁄
,

1826 
s·p_s˝
->
∑th
,

1827 
	`cuæx_uztoui
(

1828 
	`°æí
(
s·p_s˝
->
∑th
)),

1829 0, 0, 
LIBSSH2_SFTP_OPENDIR
);

1830 if(!
sshc
->
s·p_h™dÀ
) {

1831 if(
	`libssh2_£ssi⁄_œ°_î∫o
(
sshc
->
ssh_£ssi⁄
) ==

1832 
LIBSSH2_ERROR_EAGAIN
) {

1833 
rc
 = 
LIBSSH2_ERROR_EAGAIN
;

1837 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1838 
	`Áûf
(
d©a
, "CouldÇot open directory forÑeading: %s",

1839 
	`s·p_libssh2_°ªº‹
(
îr
));

1840 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1841 
ªsu…
 = 
	`s·p_libssh2_îr‹_to_CURLE
(
îr
);

1842 
sshc
->
a˘uÆcode
 = 
ªsu…
?ªsu…:
CURLE_SSH
;

1846 if((
sshc
->
ªaddú_fûíame
 = 
	`mÆloc
(
PATH_MAX
+1)Ë=
NULL
) {

1847 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1848 
sshc
->
a˘uÆcode
 = 
CURLE_OUT_OF_MEMORY
;

1851 if((
sshc
->
ªaddú_l⁄gíåy
 = 
	`mÆloc
(
PATH_MAX
+1)Ë=
NULL
) {

1852 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_fûíame
);

1853 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1854 
sshc
->
a˘uÆcode
 = 
CURLE_OUT_OF_MEMORY
;

1857 
	`°©e
(
c⁄n
, 
SSH_SFTP_READDIR
);

1860 
SSH_SFTP_READDIR
:

1861 
sshc
->
ªaddú_Àn
 = 
	`libssh2_s·p_ªaddú_ex
(sshc->
s·p_h™dÀ
,

1862 
sshc
->
ªaddú_fûíame
,

1863 
PATH_MAX
,

1864 
sshc
->
ªaddú_l⁄gíåy
,

1865 
PATH_MAX
,

1866 &
sshc
->
ªaddú_©ås
);

1867 if(
sshc
->
ªaddú_Àn
 =
LIBSSH2_ERROR_EAGAIN
) {

1868 
rc
 = 
LIBSSH2_ERROR_EAGAIN
;

1871 if(
sshc
->
ªaddú_Àn
 > 0) {

1872 
sshc
->
ªaddú_fûíame
[sshc->
ªaddú_Àn
] = '\0';

1874 if(
d©a
->
£t
.
·p_li°_⁄ly
) {

1875 *
tmpLöe
;

1877 
tmpLöe
 = 
	`≠rötf
("%s\n", 
sshc
->
ªaddú_fûíame
);

1878 if(
tmpLöe
 =
NULL
) {

1879 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1880 
sshc
->
a˘uÆcode
 = 
CURLE_OUT_OF_MEMORY
;

1883 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
,

1884 
tmpLöe
, 
sshc
->
ªaddú_Àn
+1);

1885 
	`Cuæ_ß„‰ì
(
tmpLöe
);

1887 if(
ªsu…
) {

1888 
	`°©e
(
c⁄n
, 
SSH_STOP
);

1893 
d©a
->
ªq
.
byãcou¡
 +
sshc
->
ªaddú_Àn
+1;

1896 if(
d©a
->
£t
.
vîbo£
) {

1897 
	`Cuæ_debug
(
d©a
, 
CURLINFO_DATA_OUT
, 
sshc
->
ªaddú_fûíame
,

1898 
sshc
->
ªaddú_Àn
, 
c⁄n
);

1902 
sshc
->
ªaddú_cuºLí
 = ()
	`°æí
(sshc->
ªaddú_l⁄gíåy
);

1903 
sshc
->
ªaddú_tŸÆLí
 = 80 + sshc->
ªaddú_cuºLí
;

1904 
sshc
->
ªaddú_löe
 = 
	`ˇŒoc
(sshc->
ªaddú_tŸÆLí
, 1);

1905 if(!
sshc
->
ªaddú_löe
) {

1906 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_fûíame
);

1907 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_l⁄gíåy
);

1908 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1909 
sshc
->
a˘uÆcode
 = 
CURLE_OUT_OF_MEMORY
;

1913 
	`mem˝y
(
sshc
->
ªaddú_löe
, sshc->
ªaddú_l⁄gíåy
,

1914 
sshc
->
ªaddú_cuºLí
);

1915 if((
sshc
->
ªaddú_©ås
.
Êags
 & 
LIBSSH2_SFTP_ATTR_PERMISSIONS
) &&

1916 ((
sshc
->
ªaddú_©ås
.
≥rmissi⁄s
 & 
LIBSSH2_SFTP_S_IFMT
) ==

1917 
LIBSSH2_SFTP_S_IFLNK
)) {

1918 
sshc
->
ªaddú_lökP©h
 = 
	`mÆloc
(
PATH_MAX
 + 1);

1919 if(
sshc
->
ªaddú_lökP©h
 =
NULL
) {

1920 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_fûíame
);

1921 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_l⁄gíåy
);

1922 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1923 
sshc
->
a˘uÆcode
 = 
CURLE_OUT_OF_MEMORY
;

1927 
	`¢¥ötf
(
sshc
->
ªaddú_lökP©h
, 
PATH_MAX
, "%s%s", 
s·p_s˝
->
∑th
,

1928 
sshc
->
ªaddú_fûíame
);

1929 
	`°©e
(
c⁄n
, 
SSH_SFTP_READDIR_LINK
);

1932 
	`°©e
(
c⁄n
, 
SSH_SFTP_READDIR_BOTTOM
);

1936 if(
sshc
->
ªaddú_Àn
 == 0) {

1937 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_fûíame
);

1938 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_l⁄gíåy
);

1939 
	`°©e
(
c⁄n
, 
SSH_SFTP_READDIR_DONE
);

1942 if(
sshc
->
ªaddú_Àn
 <= 0) {

1943 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

1944 
ªsu…
 = 
	`s·p_libssh2_îr‹_to_CURLE
(
îr
);

1945 
sshc
->
a˘uÆcode
 = 
ªsu…
?ªsu…:
CURLE_SSH
;

1946 
	`Áûf
(
d©a
, "CouldÇot openÑemote file forÑeading: %s :: %d",

1947 
	`s·p_libssh2_°ªº‹
(
îr
),

1948 
	`libssh2_£ssi⁄_œ°_î∫o
(
sshc
->
ssh_£ssi⁄
));

1949 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_fûíame
);

1950 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_l⁄gíåy
);

1951 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1956 
SSH_SFTP_READDIR_LINK
:

1957 
sshc
->
ªaddú_Àn
 =

1958 
	`libssh2_s·p_symlök_ex
(
sshc
->
s·p_£ssi⁄
,

1959 
sshc
->
ªaddú_lökP©h
,

1960 
	`cuæx_uztoui
(
	`°æí
(
sshc
->
ªaddú_lökP©h
)),

1961 
sshc
->
ªaddú_fûíame
,

1962 
PATH_MAX
, 
LIBSSH2_SFTP_READLINK
);

1963 if(
sshc
->
ªaddú_Àn
 =
LIBSSH2_ERROR_EAGAIN
) {

1964 
rc
 = 
LIBSSH2_ERROR_EAGAIN
;

1967 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_lökP©h
);

1970 
sshc
->
ªaddú_tŸÆLí
 +4 + sshc->
ªaddú_Àn
;

1971 
√w_ªaddú_löe
 = 
	`ªÆloc
(
sshc
->
ªaddú_löe
, sshc->
ªaddú_tŸÆLí
);

1972 if(!
√w_ªaddú_löe
) {

1973 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_löe
);

1974 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_fûíame
);

1975 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_l⁄gíåy
);

1976 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

1977 
sshc
->
a˘uÆcode
 = 
CURLE_OUT_OF_MEMORY
;

1980 
sshc
->
ªaddú_löe
 = 
√w_ªaddú_löe
;

1982 
sshc
->
ªaddú_cuºLí
 +
	`¢¥ötf
(sshc->
ªaddú_löe
 +

1983 
sshc
->
ªaddú_cuºLí
,

1984 
sshc
->
ªaddú_tŸÆLí
 -

1985 
sshc
->
ªaddú_cuºLí
,

1987 
sshc
->
ªaddú_fûíame
);

1989 
	`°©e
(
c⁄n
, 
SSH_SFTP_READDIR_BOTTOM
);

1992 
SSH_SFTP_READDIR_BOTTOM
:

1993 
sshc
->
ªaddú_cuºLí
 +
	`¢¥ötf
(sshc->
ªaddú_löe
 +

1994 
sshc
->
ªaddú_cuºLí
,

1995 
sshc
->
ªaddú_tŸÆLí
 -

1996 
sshc
->
ªaddú_cuºLí
, "\n");

1997 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
,

1998 
sshc
->
ªaddú_löe
,

1999 
sshc
->
ªaddú_cuºLí
);

2001 if(
ªsu…
 =
CURLE_OK
) {

2004 if(
d©a
->
£t
.
vîbo£
) {

2005 
	`Cuæ_debug
(
d©a
, 
CURLINFO_DATA_OUT
, 
sshc
->
ªaddú_löe
,

2006 
sshc
->
ªaddú_cuºLí
, 
c⁄n
);

2008 
d©a
->
ªq
.
byãcou¡
 +
sshc
->
ªaddú_cuºLí
;

2010 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_löe
);

2011 if(
ªsu…
) {

2012 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2015 
	`°©e
(
c⁄n
, 
SSH_SFTP_READDIR
);

2018 
SSH_SFTP_READDIR_DONE
:

2019 if(
	`libssh2_s·p_˛o£dú
(
sshc
->
s·p_h™dÀ
) ==

2020 
LIBSSH2_ERROR_EAGAIN
) {

2021 
rc
 = 
LIBSSH2_ERROR_EAGAIN
;

2024 
sshc
->
s·p_h™dÀ
 = 
NULL
;

2025 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_fûíame
);

2026 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_l⁄gíåy
);

2029 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

2030 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2033 
SSH_SFTP_DOWNLOAD_INIT
:

2037 
sshc
->
s·p_h™dÀ
 =

2038 
	`libssh2_s·p_›í_ex
(
sshc
->
s·p_£ssi⁄
, 
s·p_s˝
->
∑th
,

2039 
	`cuæx_uztoui
(
	`°æí
(
s·p_s˝
->
∑th
)),

2040 
LIBSSH2_FXF_READ
, 
d©a
->
£t
.
√w_fûe_≥rms
,

2041 
LIBSSH2_SFTP_OPENFILE
);

2042 if(!
sshc
->
s·p_h™dÀ
) {

2043 if(
	`libssh2_£ssi⁄_œ°_î∫o
(
sshc
->
ssh_£ssi⁄
) ==

2044 
LIBSSH2_ERROR_EAGAIN
) {

2045 
rc
 = 
LIBSSH2_ERROR_EAGAIN
;

2049 
îr
 = 
	`s·p_libssh2_œ°_îr‹
(
sshc
->
s·p_£ssi⁄
);

2050 
	`Áûf
(
d©a
, "CouldÇot openÑemote file forÑeading: %s",

2051 
	`s·p_libssh2_°ªº‹
(
îr
));

2052 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

2053 
ªsu…
 = 
	`s·p_libssh2_îr‹_to_CURLE
(
îr
);

2054 
sshc
->
a˘uÆcode
 = 
ªsu…
?ªsu…:
CURLE_SSH
;

2058 
	`°©e
(
c⁄n
, 
SSH_SFTP_DOWNLOAD_STAT
);

2061 
SSH_SFTP_DOWNLOAD_STAT
:

2063 
LIBSSH2_SFTP_ATTRIBUTES
 
©ås
;

2065 
rc
 = 
	`libssh2_s·p_°©_ex
(
sshc
->
s·p_£ssi⁄
, 
s·p_s˝
->
∑th
,

2066 
	`cuæx_uztoui
(
	`°æí
(
s·p_s˝
->
∑th
)),

2067 
LIBSSH2_SFTP_STAT
, &
©ås
);

2068 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2071 if(
rc
) {

2076 
d©a
->
ªq
.
size
 = -1;

2077 
d©a
->
ªq
.
maxdow∆ﬂd
 = -1;

2078 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, -1);

2081 
cuæ_off_t
 
size
 = 
©ås
.
fûesize
;

2083 if(
size
 < 0) {

2084 
	`Áûf
(
d©a
, "Bad fûêsizê(%" 
CURL_FORMAT_CURL_OFF_T
 ")", 
size
);

2085  
CURLE_BAD_DOWNLOAD_RESUME
;

2087 if(
c⁄n
->
d©a
->
°©e
.
u£_ønge
) {

2088 
cuæ_off_t
 
‰om
, 
to
;

2089 *
±r
;

2090 *
±r2
;

2092 
‰om
=
	`cuæx_°πoof·
(
c⁄n
->
d©a
->
°©e
.
ønge
, &
±r
, 0);

2093 *
±r
 && (
	`ISSPACE
(*ptr) || (*ptr=='-')))

2094 
±r
++;

2095 
to
=
	`cuæx_°πoof·
(
±r
, &
±r2
, 0);

2096 if((
±r
 =
±r2
)

2097 || (
to
 >
size
)) {

2098 
to
 = 
size
 - 1;

2100 if(
‰om
 < 0) {

2102 
‰om
 +
size
;

2104 if(
‰om
 >
size
) {

2105 
	`Áûf
(
d©a
, "Offset (%"

2106 
CURL_FORMAT_CURL_OFF_T
 ") was beyond file size (%"

2107 
CURL_FORMAT_CURL_OFF_T
 ")", 
‰om
, 
©ås
.
fûesize
);

2108  
CURLE_BAD_DOWNLOAD_RESUME
;

2110 if(
‰om
 > 
to
) {

2111 
‰om
 = 
to
;

2112 
size
 = 0;

2115 
size
 = 
to
 - 
‰om
 + 1;

2118 
	`SFTP_SEEK
(
c⁄n
->
¥Ÿo
.
sshc
.
s·p_h™dÀ
, 
‰om
);

2120 
d©a
->
ªq
.
size
 = size;

2121 
d©a
->
ªq
.
maxdow∆ﬂd
 = 
size
;

2122 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
size
);

2126 if(
d©a
->
°©e
.
ªsume_‰om
) {

2127 if(
d©a
->
°©e
.
ªsume_‰om
 < 0) {

2129 if((
cuæ_off_t
)
©ås
.
fûesize
 < -
d©a
->
°©e
.
ªsume_‰om
) {

2130 
	`Áûf
(
d©a
, "Offset (%"

2131 
CURL_FORMAT_CURL_OFF_T
 ") was beyond file size (%"

2132 
CURL_FORMAT_CURL_OFF_T
 ")",

2133 
d©a
->
°©e
.
ªsume_‰om
, 
©ås
.
fûesize
);

2134  
CURLE_BAD_DOWNLOAD_RESUME
;

2137 
d©a
->
°©e
.
ªsume_‰om
 +
©ås
.
fûesize
;

2140 if((
cuæ_off_t
)
©ås
.
fûesize
 < 
d©a
->
°©e
.
ªsume_‰om
) {

2141 
	`Áûf
(
d©a
, "Off£à(%" 
CURL_FORMAT_CURL_OFF_T


2142 "Ëwa†bey⁄d fûêsizê(%" 
CURL_FORMAT_CURL_OFF_T
 ")",

2143 
d©a
->
°©e
.
ªsume_‰om
, 
©ås
.
fûesize
);

2144  
CURLE_BAD_DOWNLOAD_RESUME
;

2149 
d©a
->
ªq
.
size
 = 
©ås
.
fûesize
 - d©a->
°©e
.
ªsume_‰om
;

2150 
d©a
->
ªq
.
maxdow∆ﬂd
 = 
©ås
.
fûesize
 - d©a->
°©e
.
ªsume_‰om
;

2151 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
,

2152 
©ås
.
fûesize
 - 
d©a
->
°©e
.
ªsume_‰om
);

2153 
	`SFTP_SEEK
(
sshc
->
s·p_h™dÀ
, 
d©a
->
°©e
.
ªsume_‰om
);

2158 if(
d©a
->
ªq
.
size
 == 0) {

2160 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

2161 
	`öfof
(
d©a
, "Fileálready completely downloaded\n");

2162 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2166 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, 
d©a
->
ªq
.
size
,

2167 
FALSE
, 
NULL
, -1, NULL);

2170 
c⁄n
->
wrôesockfd
 = c⁄n->
sockfd
;

2175 
c⁄n
->
c£À˘_bôs
 = 
CURL_CSELECT_IN
;

2177 if(
ªsu…
) {

2180 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

2181 
sshc
->
a˘uÆcode
 = 
ªsu…
;

2184 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2188 
SSH_SFTP_CLOSE
:

2189 if(
sshc
->
s·p_h™dÀ
) {

2190 
rc
 = 
	`libssh2_s·p_˛o£
(
sshc
->
s·p_h™dÀ
);

2191 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2194 if(
rc
 < 0) {

2195 
	`öfof
(
d©a
, "FailedÅo closeÜibssh2 file\n");

2197 
sshc
->
s·p_h™dÀ
 = 
NULL
;

2199 if(
s·p_s˝
)

2200 
	`Cuæ_ß„‰ì
(
s·p_s˝
->
∑th
);

2202 
	`DEBUGF
(
	`öfof
(
d©a
, "SFTP DONE done\n"));

2207 if(
sshc
->
√xt°©e
 !
SSH_NO_STATE
 &&

2208 
sshc
->
√xt°©e
 !
SSH_SFTP_CLOSE
) {

2209 
	`°©e
(
c⁄n
, 
sshc
->
√xt°©e
);

2210 
sshc
->
√xt°©e
 = 
SSH_SFTP_CLOSE
;

2213 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2214 
ªsu…
 = 
sshc
->
a˘uÆcode
;

2218 
SSH_SFTP_SHUTDOWN
:

2223 if(
sshc
->
s·p_h™dÀ
) {

2224 
rc
 = 
	`libssh2_s·p_˛o£
(
sshc
->
s·p_h™dÀ
);

2225 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2228 if(
rc
 < 0) {

2229 
	`öfof
(
d©a
, "FailedÅo closeÜibssh2 file\n");

2231 
sshc
->
s·p_h™dÀ
 = 
NULL
;

2233 if(
sshc
->
s·p_£ssi⁄
) {

2234 
rc
 = 
	`libssh2_s·p_shutdown
(
sshc
->
s·p_£ssi⁄
);

2235 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2238 if(
rc
 < 0) {

2239 
	`öfof
(
d©a
, "FailedÅo stopÜibssh2 sftp subsystem\n");

2241 
sshc
->
s·p_£ssi⁄
 = 
NULL
;

2244 
	`Cuæ_ß„‰ì
(
sshc
->
homedú
);

2245 
c⁄n
->
d©a
->
°©e
.
mo°_ª˚¡_·p_íåy∑th
 = 
NULL
;

2247 
	`°©e
(
c⁄n
, 
SSH_SESSION_DISCONNECT
);

2250 
SSH_SCP_TRANS_INIT
:

2251 
ªsu…
 = 
	`ssh_gëw‹kög∑th
(
c⁄n
, 
sshc
->
homedú
, &
s·p_s˝
->
∑th
);

2252 if(
ªsu…
) {

2253 
sshc
->
a˘uÆcode
 = 
ªsu…
;

2254 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2258 if(
d©a
->
£t
.
u∂ﬂd
) {

2259 if(
d©a
->
°©e
.
öfûesize
 < 0) {

2260 
	`Áûf
(
d©a
, "SCPÑequiresá known file size for upload");

2261 
sshc
->
a˘uÆcode
 = 
CURLE_UPLOAD_FAILED
;

2262 
	`°©e
(
c⁄n
, 
SSH_SCP_CHANNEL_FREE
);

2265 
	`°©e
(
c⁄n
, 
SSH_SCP_UPLOAD_INIT
);

2268 
	`°©e
(
c⁄n
, 
SSH_SCP_DOWNLOAD_INIT
);

2272 
SSH_SCP_UPLOAD_INIT
:

2279 
sshc
->
ssh_ch™√l
 =

2280 
	`SCP_SEND
(
sshc
->
ssh_£ssi⁄
, 
s·p_s˝
->
∑th
, 
d©a
->
£t
.
√w_fûe_≥rms
,

2281 
d©a
->
°©e
.
öfûesize
);

2282 if(!
sshc
->
ssh_ch™√l
) {

2283 if(
	`libssh2_£ssi⁄_œ°_î∫o
(
sshc
->
ssh_£ssi⁄
) ==

2284 
LIBSSH2_ERROR_EAGAIN
) {

2285 
rc
 = 
LIBSSH2_ERROR_EAGAIN
;

2289 
ssh_îr
;

2290 *
îr_msg
;

2292 
ssh_îr
 = ()(
	`libssh2_£ssi⁄_œ°_îr‹
(
sshc
->
ssh_£ssi⁄
,

2293 &
îr_msg
, 
NULL
, 0));

2294 
	`Áûf
(
c⁄n
->
d©a
, "%s", 
îr_msg
);

2295 
	`°©e
(
c⁄n
, 
SSH_SCP_CHANNEL_FREE
);

2296 
sshc
->
a˘uÆcode
 = 
	`libssh2_£ssi⁄_îr‹_to_CURLE
(
ssh_îr
);

2302 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, 
d©a
->
ªq
.
size
, 
FALSE
, 
NULL
,

2303 
FIRSTSOCKET
, 
NULL
);

2306 
c⁄n
->
sockfd
 = c⁄n->
wrôesockfd
;

2308 if(
ªsu…
) {

2309 
	`°©e
(
c⁄n
, 
SSH_SCP_CHANNEL_FREE
);

2310 
sshc
->
a˘uÆcode
 = 
ªsu…
;

2315 
sshc
->
‹ig_waôf‹
 = 
d©a
->
ªq
.
kìp⁄
;

2320 
c⁄n
->
c£À˘_bôs
 = 
CURL_CSELECT_OUT
;

2322 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2326 
SSH_SCP_DOWNLOAD_INIT
:

2332 
°©
 
sb
;

2333 
cuæ_off_t
 
byãcou¡
;

2336 
	`mem£t
(&
sb
, 0, (
°©
));

2339 
sshc
->
ssh_ch™√l
 = 
	`libssh2_s˝_ªcv
(sshc->
ssh_£ssi⁄
,

2340 
s·p_s˝
->
∑th
, &
sb
);

2341 if(!
sshc
->
ssh_ch™√l
) {

2342 if(
	`libssh2_£ssi⁄_œ°_î∫o
(
sshc
->
ssh_£ssi⁄
) ==

2343 
LIBSSH2_ERROR_EAGAIN
) {

2344 
rc
 = 
LIBSSH2_ERROR_EAGAIN
;

2348 
ssh_îr
;

2349 *
îr_msg
;

2351 
ssh_îr
 = ()(
	`libssh2_£ssi⁄_œ°_îr‹
(
sshc
->
ssh_£ssi⁄
,

2352 &
îr_msg
, 
NULL
, 0));

2353 
	`Áûf
(
c⁄n
->
d©a
, "%s", 
îr_msg
);

2354 
	`°©e
(
c⁄n
, 
SSH_SCP_CHANNEL_FREE
);

2355 
sshc
->
a˘uÆcode
 = 
	`libssh2_£ssi⁄_îr‹_to_CURLE
(
ssh_îr
);

2361 
byãcou¡
 = (
cuæ_off_t
)
sb
.
°_size
;

2362 
d©a
->
ªq
.
maxdow∆ﬂd
 = (
cuæ_off_t
)
sb
.
°_size
;

2363 
	`Cuæ_£tup_å™s„r
(
c⁄n
, 
FIRSTSOCKET
, 
byãcou¡
, 
FALSE
, 
NULL
, -1, NULL);

2366 
c⁄n
->
wrôesockfd
 = c⁄n->
sockfd
;

2371 
c⁄n
->
c£À˘_bôs
 = 
CURL_CSELECT_IN
;

2373 if(
ªsu…
) {

2374 
	`°©e
(
c⁄n
, 
SSH_SCP_CHANNEL_FREE
);

2375 
sshc
->
a˘uÆcode
 = 
ªsu…
;

2378 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2382 
SSH_SCP_DONE
:

2383 if(
d©a
->
£t
.
u∂ﬂd
)

2384 
	`°©e
(
c⁄n
, 
SSH_SCP_SEND_EOF
);

2386 
	`°©e
(
c⁄n
, 
SSH_SCP_CHANNEL_FREE
);

2389 
SSH_SCP_SEND_EOF
:

2390 if(
sshc
->
ssh_ch™√l
) {

2391 
rc
 = 
	`libssh2_ch™√l_£nd_eof
(
sshc
->
ssh_ch™√l
);

2392 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2395 if(
rc
) {

2396 
	`öfof
(
d©a
, "FailedÅo sendÜibssh2 channel EOF\n");

2399 
	`°©e
(
c⁄n
, 
SSH_SCP_WAIT_EOF
);

2402 
SSH_SCP_WAIT_EOF
:

2403 if(
sshc
->
ssh_ch™√l
) {

2404 
rc
 = 
	`libssh2_ch™√l_waô_eof
(
sshc
->
ssh_ch™√l
);

2405 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2408 if(
rc
) {

2409 
	`öfof
(
d©a
, "FaûedÅÿgë ch™√»EOF: %d\n", 
rc
);

2412 
	`°©e
(
c⁄n
, 
SSH_SCP_WAIT_CLOSE
);

2415 
SSH_SCP_WAIT_CLOSE
:

2416 if(
sshc
->
ssh_ch™√l
) {

2417 
rc
 = 
	`libssh2_ch™√l_waô_˛o£d
(
sshc
->
ssh_ch™√l
);

2418 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2421 if(
rc
) {

2422 
	`öfof
(
d©a
, "Ch™√»ÁûedÅÿ˛o£: %d\n", 
rc
);

2425 
	`°©e
(
c⁄n
, 
SSH_SCP_CHANNEL_FREE
);

2428 
SSH_SCP_CHANNEL_FREE
:

2429 if(
sshc
->
ssh_ch™√l
) {

2430 
rc
 = 
	`libssh2_ch™√l_‰ì
(
sshc
->
ssh_ch™√l
);

2431 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2434 if(
rc
 < 0) {

2435 
	`öfof
(
d©a
, "FailedÅo freeÜibssh2 scp subsystem\n");

2437 
sshc
->
ssh_ch™√l
 = 
NULL
;

2439 
	`DEBUGF
(
	`öfof
(
d©a
, "SCP DONEÖhase complete\n"));

2441 
	`°©e
(
c⁄n
, 
SSH_SESSION_DISCONNECT
);

2443 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2444 
ªsu…
 = 
sshc
->
a˘uÆcode
;

2447 
SSH_SESSION_DISCONNECT
:

2451 if(
sshc
->
ssh_ch™√l
) {

2452 
rc
 = 
	`libssh2_ch™√l_‰ì
(
sshc
->
ssh_ch™√l
);

2453 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2456 if(
rc
 < 0) {

2457 
	`öfof
(
d©a
, "FailedÅo freeÜibssh2 scp subsystem\n");

2459 
sshc
->
ssh_ch™√l
 = 
NULL
;

2462 if(
sshc
->
ssh_£ssi⁄
) {

2463 
rc
 = 
	`libssh2_£ssi⁄_disc⁄√˘
(
sshc
->
ssh_£ssi⁄
, "Shutdown");

2464 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2467 if(
rc
 < 0) {

2468 
	`öfof
(
d©a
, "FailedÅo disconnectÜibssh2 session\n");

2472 
	`Cuæ_ß„‰ì
(
sshc
->
homedú
);

2473 
c⁄n
->
d©a
->
°©e
.
mo°_ª˚¡_·p_íåy∑th
 = 
NULL
;

2475 
	`°©e
(
c⁄n
, 
SSH_SESSION_FREE
);

2478 
SSH_SESSION_FREE
:

2479 #ifde‡
HAVE_LIBSSH2_KNOWNHOST_API


2480 if(
sshc
->
kh
) {

2481 
	`libssh2_knownho°_‰ì
(
sshc
->
kh
);

2482 
sshc
->
kh
 = 
NULL
;

2486 #ifde‡
HAVE_LIBSSH2_AGENT_API


2487 if(
sshc
->
ssh_agít
) {

2488 
rc
 = 
	`libssh2_agít_disc⁄√˘
(
sshc
->
ssh_agít
);

2489 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2492 if(
rc
 < 0) {

2493 
	`öfof
(
d©a
, "FailedÅo disconnect fromÜibssh2ágent\n");

2495 
	`libssh2_agít_‰ì
 (
sshc
->
ssh_agít
);

2496 
sshc
->
ssh_agít
 = 
NULL
;

2500 
sshc
->
sshagít_idítôy
 = 
NULL
;

2501 
sshc
->
sshagít_¥ev_idítôy
 = 
NULL
;

2505 if(
sshc
->
ssh_£ssi⁄
) {

2506 
rc
 = 
	`libssh2_£ssi⁄_‰ì
(
sshc
->
ssh_£ssi⁄
);

2507 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2510 if(
rc
 < 0) {

2511 
	`öfof
(
d©a
, "FailedÅo freeÜibssh2 session\n");

2513 
sshc
->
ssh_£ssi⁄
 = 
NULL
;

2518 
	`DEBUGASSERT
(
sshc
->
ssh_£ssi⁄
 =
NULL
);

2519 
	`DEBUGASSERT
(
sshc
->
ssh_ch™√l
 =
NULL
);

2520 
	`DEBUGASSERT
(
sshc
->
s·p_£ssi⁄
 =
NULL
);

2521 
	`DEBUGASSERT
(
sshc
->
s·p_h™dÀ
 =
NULL
);

2522 #ifde‡
HAVE_LIBSSH2_KNOWNHOST_API


2523 
	`DEBUGASSERT
(
sshc
->
kh
 =
NULL
);

2525 #ifde‡
HAVE_LIBSSH2_AGENT_API


2526 
	`DEBUGASSERT
(
sshc
->
ssh_agít
 =
NULL
);

2529 
	`Cuæ_ß„‰ì
(
sshc
->
rß_pub
);

2530 
	`Cuæ_ß„‰ì
(
sshc
->
rß
);

2532 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th1
);

2533 
	`Cuæ_ß„‰ì
(
sshc
->
quŸe_∑th2
);

2535 
	`Cuæ_ß„‰ì
(
sshc
->
homedú
);

2537 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_fûíame
);

2538 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_l⁄gíåy
);

2539 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_löe
);

2540 
	`Cuæ_ß„‰ì
(
sshc
->
ªaddú_lökP©h
);

2543 
ªsu…
 = 
sshc
->
a˘uÆcode
;

2545 
	`mem£t
(
sshc
, 0, (
ssh_c⁄n
));

2547 
	`c⁄n˛o£
(
c⁄n
, "SSH session free");

2548 
sshc
->
°©e
 = 
SSH_SESSION_FREE
;

2549 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

2550 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2553 
SSH_QUIT
:

2557 
sshc
->
√xt°©e
 = 
SSH_NO_STATE
;

2558 
	`°©e
(
c⁄n
, 
SSH_STOP
);

2562 } !
rc
 && (
sshc
->
°©e
 !
SSH_STOP
));

2564 if(
rc
 =
LIBSSH2_ERROR_EAGAIN
) {

2567 *
block
 = 
TRUE
;

2570  
ªsu…
;

2571 
	}
}

2575 
	$ssh_≥rf‹m_gësock
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

2576 
cuæ_sockë_t
 *
sock
,

2578 
numsocks
)

2580 #ifde‡
HAVE_LIBSSH2_SESSION_BLOCK_DIRECTION


2581 
bôm≠
 = 
GETSOCK_BLANK
;

2582 ()
numsocks
;

2584 
sock
[0] = 
c⁄n
->sock[
FIRSTSOCKET
];

2586 if(
c⁄n
->
waôf‹
 & 
KEEP_RECV
)

2587 
bôm≠
 |
	`GETSOCK_READSOCK
(
FIRSTSOCKET
);

2589 if(
c⁄n
->
waôf‹
 & 
KEEP_SEND
)

2590 
bôm≠
 |
	`GETSOCK_WRITESOCK
(
FIRSTSOCKET
);

2592  
bôm≠
;

2596  
	`Cuæ_sögÀ_gësock
(
c⁄n
, 
sock
, 
numsocks
);

2598 
	}
}

2602 
	$ssh_gësock
(
c⁄√˘d©a
 *
c⁄n
,

2603 
cuæ_sockë_t
 *
sock
,

2605 
numsocks
)

2607 #i‚de‡
HAVE_LIBSSH2_SESSION_BLOCK_DIRECTION


2608 ()
c⁄n
;

2609 ()
sock
;

2610 ()
numsocks
;

2613  
GETSOCK_BLANK
;

2617  
	`ssh_≥rf‹m_gësock
(
c⁄n
, 
sock
, 
numsocks
);

2619 
	}
}

2621 #ifde‡
HAVE_LIBSSH2_SESSION_BLOCK_DIRECTION


2629 
	$ssh_block2waôf‹
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
block
)

2631 
ssh_c⁄n
 *
sshc
 = &
c⁄n
->
¥Ÿo
.sshc;

2632 
dú
;

2633 if(
block
 && (
dú
 = 
	`libssh2_£ssi⁄_block_dúe˘i⁄s
(
sshc
->
ssh_£ssi⁄
))) {

2635 
c⁄n
->
waôf‹
 = ((
dú
&
LIBSSH2_SESSION_BLOCK_INBOUND
)?
KEEP_RECV
:0) |

2636 ((
dú
&
LIBSSH2_SESSION_BLOCK_OUTBOUND
)?
KEEP_SEND
:0);

2641 
c⁄n
->
waôf‹
 = 
sshc
->
‹ig_waôf‹
;

2642 
	}
}

2645 
	#ssh_block2waôf‹
(
x
,
y
Ë
Cuæ_n›_°mt


	)

2649 
CURLcode
 
	$ssh_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

2651 
ssh_c⁄n
 *
sshc
 = &
c⁄n
->
¥Ÿo
.sshc;

2652 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2653 
boﬁ
 
block
;

2656 
ªsu…
 = 
	`ssh_°©emach_a˘
(
c⁄n
, &
block
);

2657 *
d⁄e
 = (
sshc
->
°©e
 =
SSH_STOP
Ë? 
TRUE
 : 
FALSE
;

2658 
	`ssh_block2waôf‹
(
c⁄n
, 
block
);

2660  
ªsu…
;

2661 
	}
}

2663 
CURLcode
 
	$ssh_block_°©emach
(
c⁄√˘d©a
 *
c⁄n
,

2664 
boﬁ
 
durögc⁄√˘
)

2666 
ssh_c⁄n
 *
sshc
 = &
c⁄n
->
¥Ÿo
.sshc;

2667 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2668 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2670 (
sshc
->
°©e
 !
SSH_STOP
Ë&& !
ªsu…
) {

2671 
boﬁ
 
block
;

2672 
À·
;

2674 
ªsu…
 = 
	`ssh_°©emach_a˘
(
c⁄n
, &
block
);

2675 if(
ªsu…
)

2678 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

2679  
CURLE_ABORTED_BY_CALLBACK
;

2681 
timevÆ
 
now
 = 
	`Cuæ_tvnow
();

2682 
ªsu…
 = 
	`Cuæ_•ìdcheck
(
d©a
, 
now
);

2683 if(
ªsu…
)

2687 
À·
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
durögc⁄√˘
);

2688 if(
À·
 < 0) {

2689 
	`Áûf
(
d©a
, "OperationÅimed out");

2690  
CURLE_OPERATION_TIMEDOUT
;

2693 #ifde‡
HAVE_LIBSSH2_SESSION_BLOCK_DIRECTION


2694 if((
CURLE_OK
 =
ªsu…
Ë&& 
block
) {

2695 
dú
 = 
	`libssh2_£ssi⁄_block_dúe˘i⁄s
(
sshc
->
ssh_£ssi⁄
);

2696 
cuæ_sockë_t
 
sock
 = 
c⁄n
->sock[
FIRSTSOCKET
];

2697 
cuæ_sockë_t
 
fd_ªad
 = 
CURL_SOCKET_BAD
;

2698 
cuæ_sockë_t
 
fd_wrôe
 = 
CURL_SOCKET_BAD
;

2699 if(
LIBSSH2_SESSION_BLOCK_INBOUND
 & 
dú
)

2700 
fd_ªad
 = 
sock
;

2701 if(
LIBSSH2_SESSION_BLOCK_OUTBOUND
 & 
dú
)

2702 
fd_wrôe
 = 
sock
;

2704 
	`Cuæ_sockë_ªady
(
fd_ªad
, 
fd_wrôe
,

2705 
À·
>1000?1000:left);

2711  
ªsu…
;

2712 
	}
}

2717 
CURLcode
 
	$ssh_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 *
c⁄n
)

2719 
SSHPROTO
 *
ssh
;

2721 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
 = 
ssh
 = 
	`ˇŒoc
(1, (
SSHPROTO
));

2722 if(!
ssh
)

2723  
CURLE_OUT_OF_MEMORY
;

2725  
CURLE_OK
;

2726 
	}
}

2728 
Cuæ_ªcv
 
	gs˝_ªcv
, 
	gs·p_ªcv
;

2729 
Cuæ_£nd
 
	gs˝_£nd
, 
	gs·p_£nd
;

2735 
CURLcode
 
	$ssh_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

2737 #ifde‡
CURL_LIBSSH2_DEBUG


2738 
cuæ_sockë_t
 
sock
;

2740 
ssh_c⁄n
 *
ssh
;

2741 
CURLcode
 
ªsu…
;

2742 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2745 if(!
d©a
->
ªq
.
¥Ÿ›
)

2746 
	`ssh_£tup_c⁄√˘i⁄
(
c⁄n
);

2750 
	`c⁄nkìp
(
c⁄n
, "SSH default");

2752 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
CURLPROTO_SCP
) {

2753 
c⁄n
->
ªcv
[
FIRSTSOCKET
] = 
s˝_ªcv
;

2754 
c⁄n
->
£nd
[
FIRSTSOCKET
] = 
s˝_£nd
;

2757 
c⁄n
->
ªcv
[
FIRSTSOCKET
] = 
s·p_ªcv
;

2758 
c⁄n
->
£nd
[
FIRSTSOCKET
] = 
s·p_£nd
;

2760 
ssh
 = &
c⁄n
->
¥Ÿo
.
sshc
;

2762 #ifde‡
CURL_LIBSSH2_DEBUG


2763 if(
c⁄n
->
u£r
) {

2764 
	`öfof
(
d©a
, "U£r: %s\n", 
c⁄n
->
u£r
);

2766 if(
c⁄n
->
∑sswd
) {

2767 
	`öfof
(
d©a
, "Passw‹d: %s\n", 
c⁄n
->
∑sswd
);

2769 
sock
 = 
c⁄n
->sock[
FIRSTSOCKET
];

2772 
ssh
->
ssh_£ssi⁄
 = 
	`libssh2_£ssi⁄_öô_ex
(
my_libssh2_mÆloc
,

2773 
my_libssh2_‰ì
,

2774 
my_libssh2_ªÆloc
, 
c⁄n
);

2775 if(
ssh
->
ssh_£ssi⁄
 =
NULL
) {

2776 
	`Áûf
(
d©a
, "Failure initialising ssh session");

2777  
CURLE_FAILED_INIT
;

2780 #ifde‡
HAVE_LIBSSH2_KNOWNHOST_API


2781 if(
d©a
->
£t
.
°r
[
STRING_SSH_KNOWNHOSTS
]) {

2782 
rc
;

2783 
ssh
->
kh
 = 
	`libssh2_knownho°_öô
(ssh->
ssh_£ssi⁄
);

2784 if(!
ssh
->
kh
) {

2786  
CURLE_FAILED_INIT
;

2790 
rc
 = 
	`libssh2_knownho°_ªadfûe
(
ssh
->
kh
,

2791 
d©a
->
£t
.
°r
[
STRING_SSH_KNOWNHOSTS
],

2792 
LIBSSH2_KNOWNHOST_FILE_OPENSSH
);

2793 if(
rc
 < 0)

2794 
	`öfof
(
d©a
, "FailedÅoÑead known hosts from %s\n",

2795 
d©a
->
£t
.
°r
[
STRING_SSH_KNOWNHOSTS
]);

2799 #ifde‡
CURL_LIBSSH2_DEBUG


2800 
	`libssh2_åa˚
(
ssh
->
ssh_£ssi⁄
, ~0);

2801 
	`öfof
(
d©a
, "SSH sockë: %d\n", ()
sock
);

2804 
	`°©e
(
c⁄n
, 
SSH_INIT
);

2806 
ªsu…
 = 
	`ssh_mu…i_°©emach
(
c⁄n
, 
d⁄e
);

2808  
ªsu…
;

2809 
	}
}

2821 
CURLcode
 
	$s˝_≥rf‹m
(
c⁄√˘d©a
 *
c⁄n
,

2822 
boﬁ
 *
c⁄√˘ed
,

2823 
boﬁ
 *
d›ha£_d⁄e
)

2825 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2827 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase starts\n"));

2829 *
d›ha£_d⁄e
 = 
FALSE
;

2832 
	`°©e
(
c⁄n
, 
SSH_SCP_TRANS_INIT
);

2835 
ªsu…
 = 
	`ssh_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

2837 *
c⁄√˘ed
 = 
c⁄n
->
bôs
.
t˝c⁄√˘
[
FIRSTSOCKET
];

2839 if(*
d›ha£_d⁄e
) {

2840 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

2843  
ªsu…
;

2844 
	}
}

2847 
CURLcode
 
	$s˝_doög
(
c⁄√˘d©a
 *
c⁄n
,

2848 
boﬁ
 *
d›ha£_d⁄e
)

2850 
CURLcode
 
ªsu…
;

2851 
ªsu…
 = 
	`ssh_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

2853 if(*
d›ha£_d⁄e
) {

2854 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

2856  
ªsu…
;

2857 
	}
}

2864 
CURLcode
 
	$ssh_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

2866 
CURLcode
 
ªs
;

2867 
boﬁ
 
c⁄√˘ed
 = 0;

2868 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2869 
ssh_c⁄n
 *
sshc
 = &
c⁄n
->
¥Ÿo
.sshc;

2871 *
d⁄e
 = 
FALSE
;

2873 
d©a
->
ªq
.
size
 = -1;

2875 
sshc
->
a˘uÆcode
 = 
CURLE_OK
;

2876 
sshc
->
£c⁄dCª©eDús
 =0;

2879 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 0);

2880 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, 0);

2881 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, 0);

2882 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 0);

2884 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
CURLPROTO_SCP
)

2885 
ªs
 = 
	`s˝_≥rf‹m
(
c⁄n
, &
c⁄√˘ed
, 
d⁄e
);

2887 
ªs
 = 
	`s·p_≥rf‹m
(
c⁄n
, &
c⁄√˘ed
, 
d⁄e
);

2889  
ªs
;

2890 
	}
}

2895 
CURLcode
 
	$s˝_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
)

2897 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2898 
ssh_c⁄n
 *
ssh
 = &
c⁄n
->
¥Ÿo
.
sshc
;

2899 (Ë
dód_c⁄√˘i⁄
;

2901 
	`Cuæ_ß„‰ì
(
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
);

2903 if(
ssh
->
ssh_£ssi⁄
) {

2906 
	`°©e
(
c⁄n
, 
SSH_SESSION_DISCONNECT
);

2908 
ªsu…
 = 
	`ssh_block_°©emach
(
c⁄n
, 
FALSE
);

2911  
ªsu…
;

2912 
	}
}

2916 
CURLcode
 
	$ssh_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
°©us
)

2918 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

2919 
SSHPROTO
 *
s·p_s˝
 = 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

2921 if(
°©us
 =
CURLE_OK
) {

2929 
ªsu…
 = 
	`ssh_block_°©emach
(
c⁄n
, 
FALSE
);

2932 
ªsu…
 = 
°©us
;

2934 if(
s·p_s˝
)

2935 
	`Cuæ_ß„‰ì
(
s·p_s˝
->
∑th
);

2936 if(
	`Cuæ_pgrsD⁄e
(
c⁄n
))

2937  
CURLE_ABORTED_BY_CALLBACK
;

2939 
c⁄n
->
d©a
->
ªq
.
kìp⁄
 = 0;

2940  
ªsu…
;

2941 
	}
}

2944 
CURLcode
 
	$s˝_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
°©us
,

2945 
boﬁ
 
¥em©uª
)

2947 ()
¥em©uª
;

2949 if(
°©us
 =
CURLE_OK
)

2950 
	`°©e
(
c⁄n
, 
SSH_SCP_DONE
);

2952  
	`ssh_d⁄e
(
c⁄n
, 
°©us
);

2954 
	}
}

2957 
ssize_t
 
	$s˝_£nd
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

2958 c⁄° *
mem
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

2960 
ssize_t
 
nwrôe
;

2961 ()
socködex
;

2964 
nwrôe
 = (
ssize_t
)

2965 
	`libssh2_ch™√l_wrôe
(
c⁄n
->
¥Ÿo
.
sshc
.
ssh_ch™√l
, 
mem
, 
Àn
);

2967 
	`ssh_block2waôf‹
(
c⁄n
, (
nwrôe
 =
LIBSSH2_ERROR_EAGAIN
)?
TRUE
:
FALSE
);

2969 if(
nwrôe
 =
LIBSSH2_ERROR_EAGAIN
) {

2970 *
îr
 = 
CURLE_AGAIN
;

2971 
nwrôe
 = 0;

2973 if(
nwrôe
 < 
LIBSSH2_ERROR_NONE
) {

2974 *
îr
 = 
	`libssh2_£ssi⁄_îr‹_to_CURLE
(()
nwrôe
);

2975 
nwrôe
 = -1;

2978  
nwrôe
;

2979 
	}
}

2985 
ssize_t
 
	$s˝_ªcv
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

2986 *
mem
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

2988 
ssize_t
 
ƒód
;

2989 ()
socködex
;

2992 
ƒód
 = (
ssize_t
)

2993 
	`libssh2_ch™√l_ªad
(
c⁄n
->
¥Ÿo
.
sshc
.
ssh_ch™√l
, 
mem
, 
Àn
);

2995 
	`ssh_block2waôf‹
(
c⁄n
, (
ƒód
 =
LIBSSH2_ERROR_EAGAIN
)?
TRUE
:
FALSE
);

2996 if(
ƒód
 =
LIBSSH2_ERROR_EAGAIN
) {

2997 *
îr
 = 
CURLE_AGAIN
;

2998 
ƒód
 = -1;

3001  
ƒód
;

3002 
	}
}

3018 
CURLcode
 
	$s·p_≥rf‹m
(
c⁄√˘d©a
 *
c⁄n
,

3019 
boﬁ
 *
c⁄√˘ed
,

3020 
boﬁ
 *
d›ha£_d⁄e
)

3022 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

3024 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase starts\n"));

3026 *
d›ha£_d⁄e
 = 
FALSE
;

3029 
	`°©e
(
c⁄n
, 
SSH_SFTP_QUOTE_INIT
);

3032 
ªsu…
 = 
	`ssh_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

3034 *
c⁄√˘ed
 = 
c⁄n
->
bôs
.
t˝c⁄√˘
[
FIRSTSOCKET
];

3036 if(*
d›ha£_d⁄e
) {

3037 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

3040  
ªsu…
;

3041 
	}
}

3044 
CURLcode
 
	$s·p_doög
(
c⁄√˘d©a
 *
c⁄n
,

3045 
boﬁ
 *
d›ha£_d⁄e
)

3047 
CURLcode
 
ªsu…
;

3048 
ªsu…
 = 
	`ssh_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

3050 if(*
d›ha£_d⁄e
) {

3051 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

3053  
ªsu…
;

3054 
	}
}

3059 
CURLcode
 
	$s·p_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
)

3061 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

3062 (Ë
dód_c⁄√˘i⁄
;

3064 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "SSH DISCONNECT startsÇow\n"));

3066 
	`Cuæ_ß„‰ì
(
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
);

3068 if(
c⁄n
->
¥Ÿo
.
sshc
.
ssh_£ssi⁄
) {

3070 
	`°©e
(
c⁄n
, 
SSH_SFTP_SHUTDOWN
);

3071 
ªsu…
 = 
	`ssh_block_°©emach
(
c⁄n
, 
FALSE
);

3074 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "SSH DISCONNECT is done\n"));

3076  
ªsu…
;

3078 
	}
}

3080 
CURLcode
 
	$s·p_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
°©us
,

3081 
boﬁ
 
¥em©uª
)

3083 
ssh_c⁄n
 *
sshc
 = &
c⁄n
->
¥Ÿo
.sshc;

3085 if(
°©us
 =
CURLE_OK
) {

3089 if(!
°©us
 && !
¥em©uª
 && 
c⁄n
->
d©a
->
£t
.
po°quŸe
) {

3090 
sshc
->
√xt°©e
 = 
SSH_SFTP_POSTQUOTE_INIT
;

3091 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

3094 
	`°©e
(
c⁄n
, 
SSH_SFTP_CLOSE
);

3096  
	`ssh_d⁄e
(
c⁄n
, 
°©us
);

3097 
	}
}

3100 
ssize_t
 
	$s·p_£nd
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

3101 c⁄° *
mem
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

3103 
ssize_t
 
nwrôe
;

3106 ()
socködex
;

3108 
nwrôe
 = 
	`libssh2_s·p_wrôe
(
c⁄n
->
¥Ÿo
.
sshc
.
s·p_h™dÀ
, 
mem
, 
Àn
);

3110 
	`ssh_block2waôf‹
(
c⁄n
, (
nwrôe
 =
LIBSSH2_ERROR_EAGAIN
)?
TRUE
:
FALSE
);

3112 if(
nwrôe
 =
LIBSSH2_ERROR_EAGAIN
) {

3113 *
îr
 = 
CURLE_AGAIN
;

3114 
nwrôe
 = 0;

3116 if(
nwrôe
 < 
LIBSSH2_ERROR_NONE
) {

3117 *
îr
 = 
	`libssh2_£ssi⁄_îr‹_to_CURLE
(()
nwrôe
);

3118 
nwrôe
 = -1;

3121  
nwrôe
;

3122 
	}
}

3128 
ssize_t
 
	$s·p_ªcv
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

3129 *
mem
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

3131 
ssize_t
 
ƒód
;

3132 ()
socködex
;

3134 
ƒód
 = 
	`libssh2_s·p_ªad
(
c⁄n
->
¥Ÿo
.
sshc
.
s·p_h™dÀ
, 
mem
, 
Àn
);

3136 
	`ssh_block2waôf‹
(
c⁄n
, (
ƒód
 =
LIBSSH2_ERROR_EAGAIN
)?
TRUE
:
FALSE
);

3138 if(
ƒód
 =
LIBSSH2_ERROR_EAGAIN
) {

3139 *
îr
 = 
CURLE_AGAIN
;

3140 
ƒód
 = -1;

3143 if(
ƒód
 < 0) {

3144 *
îr
 = 
	`libssh2_£ssi⁄_îr‹_to_CURLE
(()
ƒód
);

3146  
ƒód
;

3147 
	}
}

3166 
CURLcode


3167 
	$gë_∑th«me
(c⁄° **
˝p
, **
∑th
)

3169 c⁄° *
˝
 = *
˝p
, *
íd
;

3170 
quŸ
;

3171 
i
, 
j
;

3172 c⁄° 
WHITESPACE
[] = " \t\r\n";

3174 
˝
 +
	`°r•n
(˝, 
WHITESPACE
);

3175 if(!*
˝
) {

3176 *
˝p
 = 
˝
;

3177 *
∑th
 = 
NULL
;

3178  
CURLE_QUOTE_ERROR
;

3181 *
∑th
 = 
	`mÆloc
(
	`°æí
(
˝
) + 1);

3182 if(*
∑th
 =
NULL
)

3183  
CURLE_OUT_OF_MEMORY
;

3186 if(*
˝
 == '\"' || *cp == '\'') {

3187 
quŸ
 = *
˝
++;

3190 
i
 = 
j
 = 0; i <
	`°æí
(
˝
); i++) {

3191 if(
˝
[
i
] =
quŸ
) {

3192 
i
++;

3193 (*
∑th
)[
j
] = '\0';

3196 if(
˝
[
i
] == '\0') {

3198 
Áû
;

3200 if(
˝
[
i
] == '\\') {

3201 
i
++;

3202 if(
˝
[
i
] != '\'' && cp[i] != '\"' &&

3203 
˝
[
i
] != '\\') {

3206 
Áû
;

3209 (*
∑th
)[
j
++] = 
˝
[
i
];

3212 if(
j
 == 0) {

3214 
Áû
;

3216 *
˝p
 = 
˝
 + 
i
 + 
	`°r•n
(˝ + i, 
WHITESPACE
);

3220 
íd
 = 
	`°Ωbrk
(
˝
, 
WHITESPACE
);

3221 if(
íd
 =
NULL
)

3222 
íd
 = 
	`°rchr
(
˝
, '\0');

3223 *
˝p
 = 
íd
 + 
	`°r•n
”nd, 
WHITESPACE
);

3225 
	`mem˝y
(*
∑th
, 
˝
, 
íd
 - cp);

3226 (*
∑th
)[
íd
 - 
˝
] = '\0';

3228  
CURLE_OK
;

3230 
Áû
:

3231 
	`Cuæ_ß„‰ì
(*
∑th
);

3232  
CURLE_QUOTE_ERROR
;

3233 
	}
}

3236 c⁄° *
	$s·p_libssh2_°ªº‹
(
îr
)

3238 
îr
) {

3239 
LIBSSH2_FX_NO_SUCH_FILE
:

3242 
LIBSSH2_FX_PERMISSION_DENIED
:

3245 
LIBSSH2_FX_FAILURE
:

3248 
LIBSSH2_FX_BAD_MESSAGE
:

3251 
LIBSSH2_FX_NO_CONNECTION
:

3254 
LIBSSH2_FX_CONNECTION_LOST
:

3257 
LIBSSH2_FX_OP_UNSUPPORTED
:

3260 
LIBSSH2_FX_INVALID_HANDLE
:

3263 
LIBSSH2_FX_NO_SUCH_PATH
:

3266 
LIBSSH2_FX_FILE_ALREADY_EXISTS
:

3269 
LIBSSH2_FX_WRITE_PROTECT
:

3272 
LIBSSH2_FX_NO_MEDIA
:

3275 
LIBSSH2_FX_NO_SPACE_ON_FILESYSTEM
:

3278 
LIBSSH2_FX_QUOTA_EXCEEDED
:

3281 
LIBSSH2_FX_UNKNOWN_PRINCIPLE
:

3284 
LIBSSH2_FX_LOCK_CONFlICT
:

3287 
LIBSSH2_FX_DIR_NOT_EMPTY
:

3290 
LIBSSH2_FX_NOT_A_DIRECTORY
:

3293 
LIBSSH2_FX_INVALID_FILENAME
:

3296 
LIBSSH2_FX_LINK_LOOP
:

3300 
	}
}

	@lib/ssh.h

1 #i‚de‡
HEADER_CURL_SSH_H


2 
	#HEADER_CURL_SSH_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
HAVE_LIBSSH2_H


28 
	~<libssh2.h
>

29 
	~<libssh2_s·p.h
>

36 
	mSSH_NO_STATE
 = -1,

37 
	mSSH_STOP
 = 0,

39 
	mSSH_INIT
,

40 
	mSSH_S_STARTUP
,

41 
	mSSH_HOSTKEY
,

42 
	mSSH_AUTHLIST
,

43 
	mSSH_AUTH_PKEY_INIT
,

44 
	mSSH_AUTH_PKEY
,

45 
	mSSH_AUTH_PASS_INIT
,

46 
	mSSH_AUTH_PASS
,

47 
	mSSH_AUTH_AGENT_INIT
,

48 
	mSSH_AUTH_AGENT_LIST
,

49 
	mSSH_AUTH_AGENT
,

50 
	mSSH_AUTH_HOST_INIT
,

51 
	mSSH_AUTH_HOST
,

52 
	mSSH_AUTH_KEY_INIT
,

53 
	mSSH_AUTH_KEY
,

54 
	mSSH_AUTH_DONE
,

55 
	mSSH_SFTP_INIT
,

56 
	mSSH_SFTP_REALPATH
,

58 
	mSSH_SFTP_QUOTE_INIT
,

59 
	mSSH_SFTP_POSTQUOTE_INIT
,

60 
	mSSH_SFTP_QUOTE
,

61 
	mSSH_SFTP_NEXT_QUOTE
,

62 
	mSSH_SFTP_QUOTE_STAT
,

63 
	mSSH_SFTP_QUOTE_SETSTAT
,

64 
	mSSH_SFTP_QUOTE_SYMLINK
,

65 
	mSSH_SFTP_QUOTE_MKDIR
,

66 
	mSSH_SFTP_QUOTE_RENAME
,

67 
	mSSH_SFTP_QUOTE_RMDIR
,

68 
	mSSH_SFTP_QUOTE_UNLINK
,

69 
	mSSH_SFTP_TRANS_INIT
,

70 
	mSSH_SFTP_UPLOAD_INIT
,

71 
	mSSH_SFTP_CREATE_DIRS_INIT
,

72 
	mSSH_SFTP_CREATE_DIRS
,

73 
	mSSH_SFTP_CREATE_DIRS_MKDIR
,

74 
	mSSH_SFTP_READDIR_INIT
,

75 
	mSSH_SFTP_READDIR
,

76 
	mSSH_SFTP_READDIR_LINK
,

77 
	mSSH_SFTP_READDIR_BOTTOM
,

78 
	mSSH_SFTP_READDIR_DONE
,

79 
	mSSH_SFTP_DOWNLOAD_INIT
,

80 
	mSSH_SFTP_DOWNLOAD_STAT
,

81 
	mSSH_SFTP_CLOSE
,

82 
	mSSH_SFTP_SHUTDOWN
,

83 
	mSSH_SCP_TRANS_INIT
,

84 
	mSSH_SCP_UPLOAD_INIT
,

85 
	mSSH_SCP_DOWNLOAD_INIT
,

86 
	mSSH_SCP_DONE
,

87 
	mSSH_SCP_SEND_EOF
,

88 
	mSSH_SCP_WAIT_EOF
,

89 
	mSSH_SCP_WAIT_CLOSE
,

90 
	mSSH_SCP_CHANNEL_FREE
,

91 
	mSSH_SESSION_DISCONNECT
,

92 
	mSSH_SESSION_FREE
,

93 
	mSSH_QUIT
,

94 
	mSSH_LAST


95 } 
	tssh°©e
;

101 
	sSSHPROTO
 {

102 *
	m∑th
;

107 
	sssh_c⁄n
 {

108 c⁄° *
	mauthli°
;

109 #ifde‡
USE_LIBSSH2


110 c⁄° *
	m∑s•hø£
;

111 *
	mrß_pub
;

112 *
	mrß
;

113 
boﬁ
 
	mauthed
;

114 
ssh°©e
 
	m°©e
;

115 
ssh°©e
 
	m√xt°©e
;

116 
CURLcode
 
	ma˘uÆcode
;

117 
cuæ_¶i°
 *
	mquŸe_ôem
;

118 *
	mquŸe_∑th1
;

119 *
	mquŸe_∑th2
;

120 
LIBSSH2_SFTP_ATTRIBUTES
 
	mquŸe_©ås
;

121 
boﬁ
 
	mac˚±Áû
;

123 *
	mhomedú
;

127 
LIBSSH2_SFTP_ATTRIBUTES
 
	mªaddú_©ås
;

128 *
	mªaddú_fûíame
;

129 *
	mªaddú_l⁄gíåy
;

130 
	mªaddú_Àn
, 
	mªaddú_tŸÆLí
, 
	mªaddú_cuºLí
;

131 *
	mªaddú_löe
;

132 *
	mªaddú_lökP©h
;

135 
	m£c⁄dCª©eDús
;

138 *
	m¶ash_pos
;

139 
LIBSSH2_SESSION
 *
	mssh_£ssi⁄
;

140 
LIBSSH2_CHANNEL
 *
	mssh_ch™√l
;

141 
LIBSSH2_SFTP
 *
	ms·p_£ssi⁄
;

142 
LIBSSH2_SFTP_HANDLE
 *
	ms·p_h™dÀ
;

143 
	m‹ig_waôf‹
;

145 #ifde‡
HAVE_LIBSSH2_AGENT_API


146 
LIBSSH2_AGENT
 *
	mssh_agít
;

147 
libssh2_agít_publickey
 *
	msshagít_idítôy
,

148 *
	msshagít_¥ev_idítôy
;

153 #ifde‡
HAVE_LIBSSH2_KNOWNHOST_API


154 
LIBSSH2_KNOWNHOSTS
 *
	mkh
;

159 #ifde‡
USE_LIBSSH2


161 #i‡!
deföed
(
LIBSSH2_VERSION_NUM
) || (LIBSSH2_VERSION_NUM < 0x001000)

165 #i‡
deföed
(
LIBSSH2_VERSION_NUM
) && (LIBSSH2_VERSION_NUM >= 0x010000)

166 
	#HAVE_LIBSSH2_SFTP_SEEK64
 1

	)

168 #unde‡
HAVE_LIBSSH2_SFTP_SEEK64


171 #i‡
deföed
(
LIBSSH2_VERSION_NUM
) && (LIBSSH2_VERSION_NUM >= 0x010206)

172 
	#HAVE_LIBSSH2_SCP_SEND64
 1

	)

174 #unde‡
HAVE_LIBSSH2_SCP_SEND64


178 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_s˝
;

179 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_s·p
;

	@lib/strdup.c

25 
	~"cuæ_£tup.h
"

27 
	~"°rdup.h
"

29 #i‚de‡
HAVE_STRDUP


30 *
	$cuæx_°rdup
(c⁄° *
°r
)

32 
size_t
 
Àn
;

33 *
√w°r
;

35 if(!
°r
)

36  (*)
NULL
;

38 
Àn
 = 
	`°æí
(
°r
);

40 if(
Àn
 >((
size_t
)-1) / ())

41  (*)
NULL
;

43 
√w°r
 = 
	`mÆloc
((
Àn
+1)*());

44 if(!
√w°r
)

45  (*)
NULL
;

47 
	`mem˝y
(
√w°r
,
°r
,(
Àn
+1)*());

49  
√w°r
;

51 
	}
}

	@lib/strdup.h

1 #i‚de‡
HEADER_CURL_STRDUP_H


2 
	#HEADER_CURL_STRDUP_H


	)

24 
	~"cuæ_£tup.h
"

26 #i‚de‡
HAVE_STRDUP


27 *
cuæx_°rdup
(c⁄° *
°r
);

	@lib/strequal.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_STRINGS_H


26 
	~<°rögs.h
>

29 
	~"°ªquÆ.h
"

34 
	$cuæ_°ªquÆ
(c⁄° *
fú°
, c⁄° *
£c⁄d
)

36 #i‡
	`deföed
(
HAVE_STRCASECMP
)

37  !(
°rˇ£cmp
)(
fú°
, 
£c⁄d
);

38 #ñi‡
	`deföed
(
HAVE_STRCMPI
)

39  !(
°rcmpi
)(
fú°
, 
£c⁄d
);

40 #ñi‡
	`deföed
(
HAVE_STRICMP
)

41  !(
°ricmp
)(
fú°
, 
£c⁄d
);

43 *
fú°
 && *
£c⁄d
) {

44 if(
	`touµî
(*
fú°
Ë!touµî(*
£c⁄d
)) {

47 
fú°
++;

48 
£c⁄d
++;

50  
	`touµî
(*
fú°
Ë=touµî(*
£c⁄d
);

52 
	}
}

57 
	$cuæ_°∫equÆ
(c⁄° *
fú°
, c⁄° *
£c⁄d
, 
size_t
 
max
)

59 #i‡
	`deföed
(
HAVE_STRNCASECMP
)

60  !
	`°∫ˇ£cmp
(
fú°
, 
£c⁄d
, 
max
);

61 #ñi‡
	`deföed
(
HAVE_STRNCMPI
)

62  !
	`°∫cmpi
(
fú°
, 
£c⁄d
, 
max
);

63 #ñi‡
	`deföed
(
HAVE_STRNICMP
)

64  !
	`°∫icmp
(
fú°
, 
£c⁄d
, 
max
);

66 *
fú°
 && *
£c⁄d
 && 
max
) {

67 if(
	`touµî
(*
fú°
Ë!touµî(*
£c⁄d
)) {

70 
max
--;

71 
fú°
++;

72 
£c⁄d
++;

74 if(0 =
max
)

77  
	`touµî
(*
fú°
Ë=touµî(*
£c⁄d
);

79 
	}
}

	@lib/strequal.h

1 #i‚de‡
HEADER_CURL_STREQUAL_H


2 
	#HEADER_CURL_STREQUAL_H


	)

25 
	~<cuæ/cuæ.h
>

27 
	#°ªquÆ
(
a
,
b
Ë
	`cuæ_°ªquÆ
◊,b)

	)

28 
	#°∫equÆ
(
a
,
b
,
c
Ë
	`cuæ_°∫equÆ
◊,b,c)

	)

	@lib/strerror.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_STRERROR_R


26 #i‡(!
deföed
(
HAVE_POSIX_STRERROR_R
) && \

27 !
deföed
(
HAVE_GLIBC_STRERROR_R
) && \

28 !
deföed
(
HAVE_VXWORKS_STRERROR_R
)) || \

29 (
deföed
(
HAVE_POSIX_STRERROR_R
Ë&& deföed(
HAVE_VXWORKS_STRERROR_R
)) || \

30 (
deföed
(
HAVE_GLIBC_STRERROR_R
Ë&& deföed(
HAVE_VXWORKS_STRERROR_R
)) || \

31 (
deföed
(
HAVE_POSIX_STRERROR_R
Ë&& 
	$deföed
(
HAVE_GLIBC_STRERROR_R
))

36 
	~<cuæ/cuæ.h
>

38 #ifde‡
USE_LIBIDN


39 
	~<id«.h
>

42 
	~"°ªº‹.h
"

44 
	#_MPRINTF_REPLACE


	)

45 
	~<cuæ/m¥ötf.h
>

47 
	~"cuæ_mem‹y.h
"

49 
	~"memdebug.h
"

52 
	$cuæ_ósy_°ªº‹
(
CURLcode
 
îr‹
)

54 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


55 
îr‹
) {

56 
CURLE_OK
:

59 
CURLE_UNSUPPORTED_PROTOCOL
:

62 
CURLE_FAILED_INIT
:

65 
CURLE_URL_MALFORMAT
:

68 
CURLE_NOT_BUILT_IN
:

72 
CURLE_COULDNT_RESOLVE_PROXY
:

75 
CURLE_COULDNT_RESOLVE_HOST
:

78 
CURLE_COULDNT_CONNECT
:

81 
CURLE_FTP_WEIRD_SERVER_REPLY
:

84 
CURLE_REMOTE_ACCESS_DENIED
:

87 
CURLE_FTP_ACCEPT_FAILED
:

90 
CURLE_FTP_ACCEPT_TIMEOUT
:

93 
CURLE_FTP_PRET_FAILED
:

96 
CURLE_FTP_WEIRD_PASS_REPLY
:

99 
CURLE_FTP_WEIRD_PASV_REPLY
:

102 
CURLE_FTP_WEIRD_227_FORMAT
:

105 
CURLE_FTP_CANT_GET_HOST
:

108 
CURLE_FTP_COULDNT_SET_TYPE
:

111 
CURLE_PARTIAL_FILE
:

114 
CURLE_FTP_COULDNT_RETR_FILE
:

117 
CURLE_QUOTE_ERROR
:

120 
CURLE_HTTP_RETURNED_ERROR
:

123 
CURLE_WRITE_ERROR
:

126 
CURLE_UPLOAD_FAILED
:

129 
CURLE_READ_ERROR
:

132 
CURLE_OUT_OF_MEMORY
:

135 
CURLE_OPERATION_TIMEDOUT
:

138 
CURLE_FTP_PORT_FAILED
:

141 
CURLE_FTP_COULDNT_USE_REST
:

144 
CURLE_RANGE_ERROR
:

147 
CURLE_HTTP_POST_ERROR
:

150 
CURLE_SSL_CONNECT_ERROR
:

153 
CURLE_BAD_DOWNLOAD_RESUME
:

156 
CURLE_FILE_COULDNT_READ_FILE
:

159 
CURLE_LDAP_CANNOT_BIND
:

162 
CURLE_LDAP_SEARCH_FAILED
:

165 
CURLE_FUNCTION_NOT_FOUND
:

168 
CURLE_ABORTED_BY_CALLBACK
:

171 
CURLE_BAD_FUNCTION_ARGUMENT
:

174 
CURLE_INTERFACE_FAILED
:

177 
CURLE_TOO_MANY_REDIRECTS
 :

180 
CURLE_UNKNOWN_OPTION
:

183 
CURLE_TELNET_OPTION_SYNTAX
 :

186 
CURLE_PEER_FAILED_VERIFICATION
:

189 
CURLE_GOT_NOTHING
:

192 
CURLE_SSL_ENGINE_NOTFOUND
:

195 
CURLE_SSL_ENGINE_SETFAILED
:

198 
CURLE_SSL_ENGINE_INITFAILED
:

201 
CURLE_SEND_ERROR
:

204 
CURLE_RECV_ERROR
:

207 
CURLE_SSL_CERTPROBLEM
:

210 
CURLE_SSL_CIPHER
:

213 
CURLE_SSL_CACERT
:

217 
CURLE_SSL_CACERT_BADFILE
:

220 
CURLE_BAD_CONTENT_ENCODING
:

223 
CURLE_LDAP_INVALID_URL
:

226 
CURLE_FILESIZE_EXCEEDED
:

229 
CURLE_USE_SSL_FAILED
:

232 
CURLE_SSL_SHUTDOWN_FAILED
:

235 
CURLE_SSL_CRL_BADFILE
:

238 
CURLE_SSL_ISSUER_ERROR
:

241 
CURLE_SEND_FAIL_REWIND
:

244 
CURLE_LOGIN_DENIED
:

247 
CURLE_TFTP_NOTFOUND
:

250 
CURLE_TFTP_PERM
:

253 
CURLE_REMOTE_DISK_FULL
:

256 
CURLE_TFTP_ILLEGAL
:

259 
CURLE_TFTP_UNKNOWNID
:

262 
CURLE_REMOTE_FILE_EXISTS
:

265 
CURLE_TFTP_NOSUCHUSER
:

268 
CURLE_CONV_FAILED
:

271 
CURLE_CONV_REQD
:

274 
CURLE_REMOTE_FILE_NOT_FOUND
:

277 
CURLE_SSH
:

280 
CURLE_AGAIN
:

283 
CURLE_RTSP_CSEQ_ERROR
:

286 
CURLE_RTSP_SESSION_ERROR
:

289 
CURLE_FTP_BAD_FILE_LIST
:

292 
CURLE_CHUNK_FAILED
:

295 
CURLE_NO_CONNECTION_AVAILABLE
:

299 
CURLE_OBSOLETE16
:

300 
CURLE_OBSOLETE20
:

301 
CURLE_OBSOLETE24
:

302 
CURLE_OBSOLETE29
:

303 
CURLE_OBSOLETE32
:

304 
CURLE_OBSOLETE40
:

305 
CURLE_OBSOLETE44
:

306 
CURLE_OBSOLETE46
:

307 
CURLE_OBSOLETE50
:

308 
CURLE_OBSOLETE57
:

309 
CURL_LAST
:

328 if(
îr‹
 =
CURLE_OK
)

333 
	}
}

336 
	$cuæ_mu…i_°ªº‹
(
CURLMcode
 
îr‹
)

338 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


339 
îr‹
) {

340 
CURLM_CALL_MULTI_PERFORM
:

343 
CURLM_OK
:

346 
CURLM_BAD_HANDLE
:

349 
CURLM_BAD_EASY_HANDLE
:

352 
CURLM_OUT_OF_MEMORY
:

355 
CURLM_INTERNAL_ERROR
:

358 
CURLM_BAD_SOCKET
:

361 
CURLM_UNKNOWN_OPTION
:

364 
CURLM_ADDED_ALREADY
:

367 
CURLM_LAST
:

373 if(
îr‹
 =
CURLM_OK
)

378 
	}
}

381 
	$cuæ_sh¨e_°ªº‹
(
CURLSHcode
 
îr‹
)

383 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


384 
îr‹
) {

385 
CURLSHE_OK
:

388 
CURLSHE_BAD_OPTION
:

391 
CURLSHE_IN_USE
:

394 
CURLSHE_INVALID
:

397 
CURLSHE_NOMEM
:

400 
CURLSHE_NOT_BUILT_IN
:

403 
CURLSHE_LAST
:

409 if(
îr‹
 =
CURLSHE_OK
)

414 
	}
}

416 #ifde‡
USE_WINSOCK


421 
	$gë_wösock_îr‹
 (
îr
, *
buf
, 
size_t
 
Àn
)

423 c⁄° *
p
;

425 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


426 
îr
) {

427 
WSAEINTR
:

428 
p
 = "Call interrupted";

430 
WSAEBADF
:

431 
p
 = "Bad file";

433 
WSAEACCES
:

434 
p
 = "Badáccess";

436 
WSAEFAULT
:

437 
p
 = "Badárgument";

439 
WSAEINVAL
:

440 
p
 = "Invalidárguments";

442 
WSAEMFILE
:

443 
p
 = "Out of file descriptors";

445 
WSAEWOULDBLOCK
:

446 
p
 = "Call would block";

448 
WSAEINPROGRESS
:

449 
WSAEALREADY
:

450 
p
 = "Blocking call inÖrogress";

452 
WSAENOTSOCK
:

453 
p
 = "Descriptor isÇotá socket";

455 
WSAEDESTADDRREQ
:

456 
p
 = "Need destinationáddress";

458 
WSAEMSGSIZE
:

459 
p
 = "Bad message size";

461 
WSAEPROTOTYPE
:

462 
p
 = "BadÖrotocol";

464 
WSAENOPROTOOPT
:

465 
p
 = "Protocol option is unsupported";

467 
WSAEPROTONOSUPPORT
:

468 
p
 = "Protocol is unsupported";

470 
WSAESOCKTNOSUPPORT
:

471 
p
 = "Socket is unsupported";

473 
WSAEOPNOTSUPP
:

474 
p
 = "OperationÇot supported";

476 
WSAEAFNOSUPPORT
:

477 
p
 = "Address familyÇot supported";

479 
WSAEPFNOSUPPORT
:

480 
p
 = "Protocol familyÇot supported";

482 
WSAEADDRINUSE
:

483 
p
 = "Addressálready in use";

485 
WSAEADDRNOTAVAIL
:

486 
p
 = "AddressÇotávailable";

488 
WSAENETDOWN
:

489 
p
 = "Network down";

491 
WSAENETUNREACH
:

492 
p
 = "Network unreachable";

494 
WSAENETRESET
:

495 
p
 = "Network has beenÑeset";

497 
WSAECONNABORTED
:

498 
p
 = "Connection wasáborted";

500 
WSAECONNRESET
:

501 
p
 = "Connection wasÑeset";

503 
WSAENOBUFS
:

504 
p
 = "No buffer space";

506 
WSAEISCONN
:

507 
p
 = "Socket isálready connected";

509 
WSAENOTCONN
:

510 
p
 = "Socket isÇot connected";

512 
WSAESHUTDOWN
:

513 
p
 = "Socket has been shut down";

515 
WSAETOOMANYREFS
:

516 
p
 = "Too manyÑeferences";

518 
WSAETIMEDOUT
:

519 
p
 = "Timed out";

521 
WSAECONNREFUSED
:

522 
p
 = "ConnectionÑefused";

524 
WSAELOOP
:

525 
p
 = "Loop??";

527 
WSAENAMETOOLONG
:

528 
p
 = "NameÅooÜong";

530 
WSAEHOSTDOWN
:

531 
p
 = "Host down";

533 
WSAEHOSTUNREACH
:

534 
p
 = "Host unreachable";

536 
WSAENOTEMPTY
:

537 
p
 = "NotÉmpty";

539 
WSAEPROCLIM
:

540 
p
 = "ProcessÜimitÑeached";

542 
WSAEUSERS
:

543 
p
 = "Too many users";

545 
WSAEDQUOT
:

546 
p
 = "Bad quota";

548 
WSAESTALE
:

549 
p
 = "Something is stale";

551 
WSAEREMOTE
:

552 
p
 = "RemoteÉrror";

554 #ifde‡
WSAEDISCON


555 
WSAEDISCON
:

556 
p
 = "Disconnected";

560 
WSASYSNOTREADY
:

561 
p
 = "WinsockÜibrary isÇotÑeady";

563 
WSANOTINITIALISED
:

564 
p
 = "WinsockÜibraryÇot initialised";

566 
WSAVERNOTSUPPORTED
:

567 
p
 = "Winsock versionÇot supported";

572 
WSAHOST_NOT_FOUND
:

573 
p
 = "HostÇot found";

577 
WSATRY_AGAIN
:

578 
p
 = "HostÇot found,Åryágain";

582 
WSANO_RECOVERY
:

583 
p
 = "UnrecoverableÉrror in callÅoÇameserver";

587 
WSANO_DATA
:

588 
p
 = "No dataÑecord ofÑequestedÅype";

592  
NULL
;

595 if(
îr
 =
CURLE_OK
)

596  
NULL
;

598 
p
 = "error";

600 
	`°∫˝y
 (
buf
, 
p
, 
Àn
);

601 
buf
 [
Àn
-1] = '\0';

602  
buf
;

603 
	}
}

617 c⁄° *
	$Cuæ_°ªº‹
(
c⁄√˘d©a
 *
c⁄n
, 
îr
)

619 *
buf
, *
p
;

620 
size_t
 
max
;

621 
ﬁd_î∫o
 = 
ERRNO
;

623 
	`DEBUGASSERT
(
c⁄n
);

624 
	`DEBUGASSERT
(
îr
 >= 0);

626 
buf
 = 
c⁄n
->
sy£º_buf
;

627 
max
 = (
c⁄n
->
sy£º_buf
)-1;

628 *
buf
 = '\0';

630 #ifde‡
USE_WINSOCK


632 #ifde‡
_WIN32_WCE


634 
wch¨_t
 
wbuf
[256];

635 
wbuf
[0] = 
L
'\0';

637 
	`F‹m©Mesßge
(
FORMAT_MESSAGE_FROM_SYSTEM
, 
NULL
, 
îr
,

638 
LANG_NEUTRAL
, 
wbuf
, (wbuf)/(
wch¨_t
), 
NULL
);

639 
	`wc°ombs
(
buf
,
wbuf
,
max
);

643 if(
îr
 >0 &&Éº < 
sys_√º
)

644 
	`°∫˝y
(
buf
, 
	`°ªº‹
(
îr
), 
max
);

646 if(!
	`gë_wösock_îr‹
(
îr
, 
buf
, 
max
) &&

647 !
	`F‹m©MesßgeA
(
FORMAT_MESSAGE_FROM_SYSTEM
, 
NULL
, 
îr
,

648 
LANG_NEUTRAL
, 
buf
, (
DWORD
)
max
, 
NULL
))

649 
	`¢¥ötf
(
buf
, 
max
, "Unknow¿îr‹ %d (%#x)", 
îr
,Érr);

655 #i‡
	`deföed
(
HAVE_STRERROR_R
Ë&& deföed(
HAVE_POSIX_STRERROR_R
)

661 if(0 !
	`°ªº‹_r
(
îr
, 
buf
, 
max
)) {

662 if('\0' =
buf
[0])

663 
	`¢¥ötf
(
buf
, 
max
, "Unknow¿îr‹ %d", 
îr
);

665 #ñi‡
	`deföed
(
HAVE_STRERROR_R
Ë&& deföed(
HAVE_GLIBC_STRERROR_R
)

672 
buf„r
[256];

673 *
msg
 = 
	`°ªº‹_r
(
îr
, 
buf„r
, (buffer));

674 if(
msg
)

675 
	`°∫˝y
(
buf
, 
msg
, 
max
);

677 
	`¢¥ötf
(
buf
, 
max
, "Unknow¿îr‹ %d", 
îr
);

679 #ñi‡
	`deföed
(
HAVE_STRERROR_R
Ë&& deföed(
HAVE_VXWORKS_STRERROR_R
)

685 
buf„r
[256];

686 if(
OK
 =
	`°ªº‹_r
(
îr
, 
buf„r
))

687 
	`°∫˝y
(
buf
, 
buf„r
, 
max
);

689 
	`¢¥ötf
(
buf
, 
max
, "Unknow¿îr‹ %d", 
îr
);

693 *
msg
 = 
	`°ªº‹
(
îr
);

694 if(
msg
)

695 
	`°∫˝y
(
buf
, 
msg
, 
max
);

697 
	`¢¥ötf
(
buf
, 
max
, "Unknow¿îr‹ %d", 
îr
);

703 
buf
[
max
] = '\0';

706 if((
p
 = 
	`°ºchr
(
buf
,'\n')Ë!
NULL
 && (p - buf) >= 2)

707 *
p
 = '\0';

708 if((
p
 = 
	`°ºchr
(
buf
,'\r')Ë!
NULL
 && (p - buf) >= 1)

709 *
p
 = '\0';

711 if(
ﬁd_î∫o
 !
ERRNO
)

712 
	`SET_ERRNO
(
ﬁd_î∫o
);

714  
buf
;

715 
	}
}

717 #ifde‡
USE_LIBIDN


721 c⁄° *
	$Cuæ_idn_°ªº‹
 (
c⁄√˘d©a
 *
c⁄n
, 
îr
)

723 #ifde‡
HAVE_IDNA_STRERROR


724 ()
c⁄n
;

725  
	`id«_°ªº‹
((
Id«_rc
Ë
îr
);

727 c⁄° *
°r
;

728 *
buf
;

729 
size_t
 
max
;

731 
	`DEBUGASSERT
(
c⁄n
);

733 
buf
 = 
c⁄n
->
sy£º_buf
;

734 
max
 = (
c⁄n
->
sy£º_buf
)-1;

735 *
buf
 = '\0';

737 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


738 (
Id«_rc
)
îr
) {

739 
IDNA_SUCCESS
:

740 
°r
 = "NoÉrror";

742 
IDNA_STRINGPREP_ERROR
:

743 
°r
 = "Error in stringÖreparation";

745 
IDNA_PUNYCODE_ERROR
:

746 
°r
 = "Error in Punycode operation";

748 
IDNA_CONTAINS_NON_LDH
:

749 
°r
 = "Illegal ASCII characters";

751 
IDNA_CONTAINS_MINUS
:

752 
°r
 = "Contains minus";

754 
IDNA_INVALID_LENGTH
:

755 
°r
 = "Invalid outputÜength";

757 
IDNA_NO_ACE_PREFIX
:

758 
°r
 = "No ACEÖrefix (\"xn--\")";

760 
IDNA_ROUNDTRIP_VERIFY_ERROR
:

761 
°r
 = "RoundÅrip verifyÉrror";

763 
IDNA_CONTAINS_ACE_PREFIX
:

764 
°r
 = "Already have ACEÖrefix (\"xn--\")";

766 
IDNA_ICONV_ERROR
:

767 
°r
 = "Locale conversion failed";

769 
IDNA_MALLOC_ERROR
:

770 
°r
 = "Allocation failed";

772 
IDNA_DLOPEN_ERROR
:

773 
°r
 = "dlopen()Érror";

776 
	`¢¥ötf
(
buf
, 
max
, "îr‹ %d", 
îr
);

777 
°r
 = 
NULL
;

781 if((
Id«_rc
)
îr
 =
IDNA_SUCCESS
)

782 
°r
 = "NoÉrror";

784 
°r
 = "Error";

786 if(
°r
)

787 
	`°∫˝y
(
buf
, 
°r
, 
max
);

788 
buf
[
max
] = '\0';

789  (
buf
);

791 
	}
}

794 #ifde‡
USE_WINDOWS_SSPI


795 c⁄° *
	$Cuæ_s•i_°ªº‹
 (
c⁄√˘d©a
 *
c⁄n
, 
îr
)

797 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


798 
txtbuf
[80];

799 
msgbuf
[(
c⁄n
->
sy£º_buf
)];

800 *
p
, *
°r
, *
msg
 = 
NULL
;

801 
boﬁ
 
msg_f‹m©ãd
 = 
FALSE
;

802 
ﬁd_î∫o
;

804 c⁄° *
txt
;

805 *
outbuf
;

806 
size_t
 
outmax
;

808 
	`DEBUGASSERT
(
c⁄n
);

810 
outbuf
 = 
c⁄n
->
sy£º_buf
;

811 
outmax
 = (
c⁄n
->
sy£º_buf
)-1;

812 *
outbuf
 = '\0';

814 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


816 
ﬁd_î∫o
 = 
ERRNO
;

818 
îr
) {

819 
SEC_E_OK
:

820 
txt
 = "NoÉrror";

822 
SEC_E_ALGORITHM_MISMATCH
:

823 
txt
 = "SEC_E_ALGORITHM_MISMATCH";

825 
SEC_E_BAD_BINDINGS
:

826 
txt
 = "SEC_E_BAD_BINDINGS";

828 
SEC_E_BAD_PKGID
:

829 
txt
 = "SEC_E_BAD_PKGID";

831 
SEC_E_BUFFER_TOO_SMALL
:

832 
txt
 = "SEC_E_BUFFER_TOO_SMALL";

834 
SEC_E_CANNOT_INSTALL
:

835 
txt
 = "SEC_E_CANNOT_INSTALL";

837 
SEC_E_CANNOT_PACK
:

838 
txt
 = "SEC_E_CANNOT_PACK";

840 
SEC_E_CERT_EXPIRED
:

841 
txt
 = "SEC_E_CERT_EXPIRED";

843 
SEC_E_CERT_UNKNOWN
:

844 
txt
 = "SEC_E_CERT_UNKNOWN";

846 
SEC_E_CERT_WRONG_USAGE
:

847 
txt
 = "SEC_E_CERT_WRONG_USAGE";

849 
SEC_E_CONTEXT_EXPIRED
:

850 
txt
 = "SEC_E_CONTEXT_EXPIRED";

852 
SEC_E_CROSSREALM_DELEGATION_FAILURE
:

853 
txt
 = "SEC_E_CROSSREALM_DELEGATION_FAILURE";

855 
SEC_E_CRYPTO_SYSTEM_INVALID
:

856 
txt
 = "SEC_E_CRYPTO_SYSTEM_INVALID";

858 
SEC_E_DECRYPT_FAILURE
:

859 
txt
 = "SEC_E_DECRYPT_FAILURE";

861 
SEC_E_DELEGATION_POLICY
:

862 
txt
 = "SEC_E_DELEGATION_POLICY";

864 
SEC_E_DELEGATION_REQUIRED
:

865 
txt
 = "SEC_E_DELEGATION_REQUIRED";

867 
SEC_E_DOWNGRADE_DETECTED
:

868 
txt
 = "SEC_E_DOWNGRADE_DETECTED";

870 
SEC_E_ENCRYPT_FAILURE
:

871 
txt
 = "SEC_E_ENCRYPT_FAILURE";

873 
SEC_E_ILLEGAL_MESSAGE
:

874 
txt
 = "SEC_E_ILLEGAL_MESSAGE";

876 
SEC_E_INCOMPLETE_CREDENTIALS
:

877 
txt
 = "SEC_E_INCOMPLETE_CREDENTIALS";

879 
SEC_E_INCOMPLETE_MESSAGE
:

880 
txt
 = "SEC_E_INCOMPLETE_MESSAGE";

882 
SEC_E_INSUFFICIENT_MEMORY
:

883 
txt
 = "SEC_E_INSUFFICIENT_MEMORY";

885 
SEC_E_INTERNAL_ERROR
:

886 
txt
 = "SEC_E_INTERNAL_ERROR";

888 
SEC_E_INVALID_HANDLE
:

889 
txt
 = "SEC_E_INVALID_HANDLE";

891 
SEC_E_INVALID_PARAMETER
:

892 
txt
 = "SEC_E_INVALID_PARAMETER";

894 
SEC_E_INVALID_TOKEN
:

895 
txt
 = "SEC_E_INVALID_TOKEN";

897 
SEC_E_ISSUING_CA_UNTRUSTED
:

898 
txt
 = "SEC_E_ISSUING_CA_UNTRUSTED";

900 
SEC_E_ISSUING_CA_UNTRUSTED_KDC
:

901 
txt
 = "SEC_E_ISSUING_CA_UNTRUSTED_KDC";

903 
SEC_E_KDC_CERT_EXPIRED
:

904 
txt
 = "SEC_E_KDC_CERT_EXPIRED";

906 
SEC_E_KDC_CERT_REVOKED
:

907 
txt
 = "SEC_E_KDC_CERT_REVOKED";

909 
SEC_E_KDC_INVALID_REQUEST
:

910 
txt
 = "SEC_E_KDC_INVALID_REQUEST";

912 
SEC_E_KDC_UNABLE_TO_REFER
:

913 
txt
 = "SEC_E_KDC_UNABLE_TO_REFER";

915 
SEC_E_KDC_UNKNOWN_ETYPE
:

916 
txt
 = "SEC_E_KDC_UNKNOWN_ETYPE";

918 
SEC_E_LOGON_DENIED
:

919 
txt
 = "SEC_E_LOGON_DENIED";

921 
SEC_E_MAX_REFERRALS_EXCEEDED
:

922 
txt
 = "SEC_E_MAX_REFERRALS_EXCEEDED";

924 
SEC_E_MESSAGE_ALTERED
:

925 
txt
 = "SEC_E_MESSAGE_ALTERED";

927 
SEC_E_MULTIPLE_ACCOUNTS
:

928 
txt
 = "SEC_E_MULTIPLE_ACCOUNTS";

930 
SEC_E_MUST_BE_KDC
:

931 
txt
 = "SEC_E_MUST_BE_KDC";

933 
SEC_E_NOT_OWNER
:

934 
txt
 = "SEC_E_NOT_OWNER";

936 
SEC_E_NO_AUTHENTICATING_AUTHORITY
:

937 
txt
 = "SEC_E_NO_AUTHENTICATING_AUTHORITY";

939 
SEC_E_NO_CREDENTIALS
:

940 
txt
 = "SEC_E_NO_CREDENTIALS";

942 
SEC_E_NO_IMPERSONATION
:

943 
txt
 = "SEC_E_NO_IMPERSONATION";

945 
SEC_E_NO_IP_ADDRESSES
:

946 
txt
 = "SEC_E_NO_IP_ADDRESSES";

948 
SEC_E_NO_KERB_KEY
:

949 
txt
 = "SEC_E_NO_KERB_KEY";

951 
SEC_E_NO_PA_DATA
:

952 
txt
 = "SEC_E_NO_PA_DATA";

954 
SEC_E_NO_S4U_PROT_SUPPORT
:

955 
txt
 = "SEC_E_NO_S4U_PROT_SUPPORT";

957 
SEC_E_NO_TGT_REPLY
:

958 
txt
 = "SEC_E_NO_TGT_REPLY";

960 
SEC_E_OUT_OF_SEQUENCE
:

961 
txt
 = "SEC_E_OUT_OF_SEQUENCE";

963 
SEC_E_PKINIT_CLIENT_FAILURE
:

964 
txt
 = "SEC_E_PKINIT_CLIENT_FAILURE";

966 
SEC_E_PKINIT_NAME_MISMATCH
:

967 
txt
 = "SEC_E_PKINIT_NAME_MISMATCH";

969 
SEC_E_POLICY_NLTM_ONLY
:

970 
txt
 = "SEC_E_POLICY_NLTM_ONLY";

972 
SEC_E_QOP_NOT_SUPPORTED
:

973 
txt
 = "SEC_E_QOP_NOT_SUPPORTED";

975 
SEC_E_REVOCATION_OFFLINE_C
:

976 
txt
 = "SEC_E_REVOCATION_OFFLINE_C";

978 
SEC_E_REVOCATION_OFFLINE_KDC
:

979 
txt
 = "SEC_E_REVOCATION_OFFLINE_KDC";

981 
SEC_E_SECPKG_NOT_FOUND
:

982 
txt
 = "SEC_E_SECPKG_NOT_FOUND";

984 
SEC_E_SECURITY_QOS_FAILED
:

985 
txt
 = "SEC_E_SECURITY_QOS_FAILED";

987 
SEC_E_SHUTDOWN_IN_PROGRESS
:

988 
txt
 = "SEC_E_SHUTDOWN_IN_PROGRESS";

990 
SEC_E_SMARTCARD_CERT_EXPIRED
:

991 
txt
 = "SEC_E_SMARTCARD_CERT_EXPIRED";

993 
SEC_E_SMARTCARD_CERT_REVOKED
:

994 
txt
 = "SEC_E_SMARTCARD_CERT_REVOKED";

996 
SEC_E_SMARTCARD_LOGON_REQUIRED
:

997 
txt
 = "SEC_E_SMARTCARD_LOGON_REQUIRED";

999 
SEC_E_STRONG_CRYPTO_NOT_SUPPORTED
:

1000 
txt
 = "SEC_E_STRONG_CRYPTO_NOT_SUPPORTED";

1002 
SEC_E_TARGET_UNKNOWN
:

1003 
txt
 = "SEC_E_TARGET_UNKNOWN";

1005 
SEC_E_TIME_SKEW
:

1006 
txt
 = "SEC_E_TIME_SKEW";

1008 
SEC_E_TOO_MANY_PRINCIPALS
:

1009 
txt
 = "SEC_E_TOO_MANY_PRINCIPALS";

1011 
SEC_E_UNFINISHED_CONTEXT_DELETED
:

1012 
txt
 = "SEC_E_UNFINISHED_CONTEXT_DELETED";

1014 
SEC_E_UNKNOWN_CREDENTIALS
:

1015 
txt
 = "SEC_E_UNKNOWN_CREDENTIALS";

1017 
SEC_E_UNSUPPORTED_FUNCTION
:

1018 
txt
 = "SEC_E_UNSUPPORTED_FUNCTION";

1020 
SEC_E_UNSUPPORTED_PREAUTH
:

1021 
txt
 = "SEC_E_UNSUPPORTED_PREAUTH";

1023 
SEC_E_UNTRUSTED_ROOT
:

1024 
txt
 = "SEC_E_UNTRUSTED_ROOT";

1026 
SEC_E_WRONG_CREDENTIAL_HANDLE
:

1027 
txt
 = "SEC_E_WRONG_CREDENTIAL_HANDLE";

1029 
SEC_E_WRONG_PRINCIPAL
:

1030 
txt
 = "SEC_E_WRONG_PRINCIPAL";

1032 
SEC_I_COMPLETE_AND_CONTINUE
:

1033 
txt
 = "SEC_I_COMPLETE_AND_CONTINUE";

1035 
SEC_I_COMPLETE_NEEDED
:

1036 
txt
 = "SEC_I_COMPLETE_NEEDED";

1038 
SEC_I_CONTEXT_EXPIRED
:

1039 
txt
 = "SEC_I_CONTEXT_EXPIRED";

1041 
SEC_I_CONTINUE_NEEDED
:

1042 
txt
 = "SEC_I_CONTINUE_NEEDED";

1044 
SEC_I_INCOMPLETE_CREDENTIALS
:

1045 
txt
 = "SEC_I_INCOMPLETE_CREDENTIALS";

1047 
SEC_I_LOCAL_LOGON
:

1048 
txt
 = "SEC_I_LOCAL_LOGON";

1050 
SEC_I_NO_LSA_CONTEXT
:

1051 
txt
 = "SEC_I_NO_LSA_CONTEXT";

1053 
SEC_I_RENEGOTIATE
:

1054 
txt
 = "SEC_I_RENEGOTIATE";

1056 
SEC_I_SIGNATURE_NEEDED
:

1057 
txt
 = "SEC_I_SIGNATURE_NEEDED";

1060 
txt
 = "UnknownÉrror";

1063 if(
îr
 =
SEC_E_OK
)

1064 
	`°∫˝y
(
outbuf
, 
txt
, 
outmax
);

1066 
°r
 = 
txtbuf
;

1067 
	`¢¥ötf
(
txtbuf
, (txtbuf), "%s (0x%04X%04X)",

1068 
txt
, (
îr
 >> 16) & 0xffff,Érr & 0xffff);

1069 
txtbuf
[(txtbuf)-1] = '\0';

1071 #ifde‡
_WIN32_WCE


1073 
wch¨_t
 
wbuf
[256];

1074 
wbuf
[0] = 
L
'\0';

1076 if(
	`F‹m©Mesßge
(
FORMAT_MESSAGE_FROM_SYSTEM
 |

1077 
FORMAT_MESSAGE_IGNORE_INSERTS
,

1078 
NULL
, 
îr
, 
LANG_NEUTRAL
,

1079 
wbuf
, (wbuf)/(
wch¨_t
), 
NULL
)) {

1080 
	`wc°ombs
(
msgbuf
,
wbuf
,(msgbuf)-1);

1081 
msg_f‹m©ãd
 = 
TRUE
;

1085 if(
	`F‹m©MesßgeA
(
FORMAT_MESSAGE_FROM_SYSTEM
 |

1086 
FORMAT_MESSAGE_IGNORE_INSERTS
,

1087 
NULL
, 
îr
, 
LANG_NEUTRAL
,

1088 
msgbuf
, (msgbuf)-1, 
NULL
)) {

1089 
msg_f‹m©ãd
 = 
TRUE
;

1092 if(
msg_f‹m©ãd
) {

1093 
msgbuf
[(msgbuf)-1] = '\0';

1095 if((
p
 = 
	`°ºchr
(
msgbuf
,'\n')Ë!
NULL
 && (p - msgbuf) >= 2)

1096 *
p
 = '\0';

1097 if((
p
 = 
	`°ºchr
(
msgbuf
,'\r')Ë!
NULL
 && (p - msgbuf) >= 1)

1098 *
p
 = '\0';

1099 
msg
 = 
msgbuf
;

1101 if(
msg
)

1102 
	`¢¥ötf
(
outbuf
, 
outmax
, "%†- %s", 
°r
, 
msg
);

1104 
	`°∫˝y
(
outbuf
, 
°r
, 
outmax
);

1107 if(
ﬁd_î∫o
 !
ERRNO
)

1108 
	`SET_ERRNO
(
ﬁd_î∫o
);

1112 if(
îr
 =
SEC_E_OK
)

1113 
txt
 = "NoÉrror";

1115 
txt
 = "Error";

1117 
	`°∫˝y
(
outbuf
, 
txt
, 
outmax
);

1121 
outbuf
[
outmax
] = '\0';

1123  
outbuf
;

1124 
	}
}

	@lib/strerror.h

1 #i‚de‡
HEADER_CURL_STRERROR_H


2 
	#HEADER_CURL_STRERROR_H


	)

25 
	~"uæd©a.h
"

27 c⁄° *
Cuæ_°ªº‹
 (
c⁄√˘d©a
 *
c⁄n
, 
îr
);

29 #ifde‡
USE_LIBIDN


30 c⁄° *
Cuæ_idn_°ªº‹
 (
c⁄√˘d©a
 *
c⁄n
, 
îr
);

33 #ifde‡
USE_WINDOWS_SSPI


34 c⁄° *
Cuæ_s•i_°ªº‹
 (
c⁄√˘d©a
 *
c⁄n
, 
îr
);

	@lib/strtok.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
HAVE_STRTOK_R


26 
	~<°ddef.h
>

28 
	~"°πok.h
"

31 
	$Cuæ_°πok_r
(*
±r
, c⁄° *
£p
, **
íd
)

33 if(!
±r
)

35 
±r
 = *
íd
;

38 *
±r
 && 
	`°rchr
(
£p
, *ptr))

39 ++
±r
;

41 if(*
±r
) {

43 *
°¨t
 = 
±r
;

46 *
íd
 = 
°¨t
 + 1;

50 **
íd
 && !
	`°rchr
(
£p
, **end))

51 ++*
íd
;

53 if(**
íd
) {

55 **
íd
 = '\0';

56 ++*
íd
;

59  
°¨t
;

63  
NULL
;

64 
	}
}

	@lib/strtok.h

1 #i‚de‡
HEADER_CURL_STRTOK_H


2 
	#HEADER_CURL_STRTOK_H


	)

24 
	~"cuæ_£tup.h
"

25 
	~<°ddef.h
>

27 #i‚de‡
HAVE_STRTOK_R


28 *
Cuæ_°πok_r
(*
s
, c⁄° *
dñim
, **
œ°
);

29 
	#°πok_r
 
Cuæ_°πok_r


	)

31 
	~<°rög.h
>

	@lib/strtoofft.c

23 
	~"cuæ_£tup.h
"

25 
	~"°πoof·.h
"

35 #ifde‡
NEED_CURL_STRTOLL


42 
	#NO_RANGE_TEST


	)

44 c⁄° 
	gvÆch¨s
[] =

48 
gë_ch¨
(
c
, 
ba£
);

54 
cuæ_off_t


55 
	$cuæx_°πﬁl
(c⁄° *
≈å
, **
íd±r
, 
ba£
)

57 *
íd
;

58 
is_√g©ive
 = 0;

59 
ovîÊow
;

60 
i
;

61 
cuæ_off_t
 
vÆue
 = 0;

62 
cuæ_off_t
 
√wvÆ
;

65 
íd
 = (*)
≈å
;

66 
	`ISSPACE
(
íd
[0])) {

67 
íd
++;

71 if(
íd
[0] == '-') {

72 
is_√g©ive
 = 1;

73 
íd
++;

75 if(
íd
[0] == '+') {

76 
íd
++;

78 if(
íd
[0] == '\0') {

80 if(
íd±r
) {

81 *
íd±r
 = 
íd
;

87 if(
íd
[0] == '0' &&Énd[1] == 'x') {

88 if(
ba£
 == 16 || base == 0) {

89 
íd
 += 2;

90 
ba£
 = 16;

93 if(
íd
[0] == '0') {

94 if(
ba£
 == 8 || base == 0) {

95 
íd
++;

96 
ba£
 = 8;

103 if(
ba£
 == 0) {

104 
ba£
 = 10;

108 
vÆue
 = 0;

109 
ovîÊow
 = 0;

110 
i
 = 
	`gë_ch¨
(
íd
[0], 
ba£
);

111 
i
 != -1;

112 
íd
++, 
i
 = 
	`gë_ch¨
”nd[0], 
ba£
)) {

113 
√wvÆ
 = 
ba£
 * 
vÆue
 + 
i
;

114 if(
√wvÆ
 < 
vÆue
) {

116 
ovîÊow
 = 1;

120 
vÆue
 = 
√wvÆ
;

123 if(!
ovîÊow
) {

124 if(
is_√g©ive
) {

126 
vÆue
 *= -1;

130 if(
is_√g©ive
)

131 
vÆue
 = 
CURL_OFF_T_MIN
;

133 
vÆue
 = 
CURL_OFF_T_MAX
;

135 
	`SET_ERRNO
(
ERANGE
);

138 if(
íd±r
)

139 *
íd±r
 = 
íd
;

141  
vÆue
;

142 
	}
}

154 
	$gë_ch¨
(
c
, 
ba£
)

156 #i‚de‡
NO_RANGE_TEST


157 
vÆue
 = -1;

158 if(
c
 <= '9' && c >= '0') {

159 
vÆue
 = 
c
 - '0';

161 if(
c
 <= 'Z' && c >= 'A') {

162 
vÆue
 = 
c
 - 'A' + 10;

164 if(
c
 <= 'z' && c >= 'a') {

165 
vÆue
 = 
c
 - 'a' + 10;

168 c⁄° * 
˝
;

169 
vÆue
;

171 
˝
 = 
	`memchr
(
vÆch¨s
, 
c
, 10 + 26 + 26);

173 if(!
˝
)

176 
vÆue
 = 
˝
 - 
vÆch¨s
;

178 if(
vÆue
 >= 10 + 26)

179 
vÆue
 -= 26;

182 if(
vÆue
 >
ba£
) {

183 
vÆue
 = -1;

186  
vÆue
;

187 
	}
}

	@lib/strtoofft.h

1 #i‚de‡
HEADER_CURL_STRTOOFFT_H


2 
	#HEADER_CURL_STRTOOFFT_H


	)

25 
	~"cuæ_£tup.h
"

43 #i‡(
CURL_SIZEOF_CURL_OFF_T
 > 
CURL_SIZEOF_LONG
)

44 #ifde‡
HAVE_STRTOLL


45 
	#cuæx_°πoof·
 
°πﬁl


	)

47 #i‡
deföed
(
_MSC_VER
Ë&& (_MSC_VER >1300Ë&& (
_INTEGRAL_MAX_BITS
 >= 64)

48 
_CRTIMP
 
__öt64
 
__cde˛
 
_°πoi64
(const *, **, );

49 
	#cuæx_°πoof·
 
_°πoi64


	)

51 
cuæ_off_t
 
cuæx_°πﬁl
(c⁄° *
≈å
, **
íd±r
, 
ba£
);

52 
	#cuæx_°πoof·
 
cuæx_°πﬁl


	)

53 
	#NEED_CURL_STRTOLL
 1

	)

57 
	#cuæx_°πoof·
 
°πﬁ


	)

60 #i‡(
CURL_SIZEOF_CURL_OFF_T
 == 4)

61 
	#CURL_OFF_T_MAX
 
	`CURL_OFF_T_C
(0x7FFFFFFF)

	)

64 
	#CURL_OFF_T_MAX
 
	`CURL_OFF_T_C
(0x7FFFFFFFFFFFFFFF)

	)

66 
	#CURL_OFF_T_MIN
 (-
CURL_OFF_T_MAX
 - 
	`CURL_OFF_T_C
(1))

	)

	@lib/telnet.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_TELNET


27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

30 #ifde‡
HAVE_NETDB_H


31 
	~<√tdb.h
>

33 #ifde‡
HAVE_ARPA_INET_H


34 
	~<¨∑/öë.h
>

36 #ifde‡
HAVE_NET_IF_H


37 
	~<√t/if.h
>

39 #ifde‡
HAVE_SYS_IOCTL_H


40 
	~<sys/io˘l.h
>

43 #ifde‡
HAVE_SYS_PARAM_H


44 
	~<sys/∑øm.h
>

47 
	~"uæd©a.h
"

48 
	~<cuæ/cuæ.h
>

49 
	~"å™s„r.h
"

50 
	~"£ndf.h
"

51 
	~"ã ë.h
"

52 
	~"c⁄√˘.h
"

53 
	~"¥ogªss.h
"

55 
	#_MPRINTF_REPLACE


	)

56 
	~<cuæ/m¥ötf.h
>

58 
	#TELOPTS


	)

59 
	#TELCMDS


	)

61 
	~"¨∑_ã ë.h
"

62 
	~"cuæ_mem‹y.h
"

63 
	~"£À˘.h
"

64 
	~"°ªquÆ.h
"

65 
	~"øw°r.h
"

66 
	~"w¨∆ess.h
"

69 
	~"memdebug.h
"

71 
	#SUBBUFSIZE
 512

	)

73 
	#CURL_SB_CLEAR
(
x
Ëx->
subpoöãr
 = x->
subbuf„r


	)

74 
	#CURL_SB_TERM
(
x
) \

76 
x
->
subíd
 = x->
subpoöãr
; \

77 
	`CURL_SB_CLEAR
(
x
); \

78 } 
WHILE_FALSE


	)

79 
	#CURL_SB_ACCUM
(
x
,
c
) \

81 if(
x
->
subpoöãr
 < (x->
subbuf„r
+ x->subbuffer)) \

82 *
x
->
subpoöãr
++ = (
c
); \

83 } 
WHILE_FALSE


	)

85 
	#CURL_SB_GET
(
x
Ë((*x->
subpoöãr
++)&0xff)

	)

86 
	#CURL_SB_PEEK
(
x
Ë((*x->
subpoöãr
)&0xff)

	)

87 
	#CURL_SB_EOF
(
x
Ë(x->
subpoöãr
 >x->
subíd
)

	)

88 
	#CURL_SB_LEN
(
x
Ë(x->
subíd
 - x->
subpoöãr
)

	)

90 #ifde‡
CURL_DISABLE_VERBOSE_STRINGS


91 
	#¥öt›ti⁄
(
a
,
b
,
c
,
d
Ë
Cuæ_n›_°mt


	)

94 #ifde‡
USE_WINSOCK


95 
FARPROC
 
	tWSOCK2_FUNC
;

96 
CURLcode
 
check_wsock2
 ( 
Sessi⁄H™dÀ
 *
d©a
 );

100 
CURLcode
 
ãÃcv
(
c⁄√˘d©a
 *,

101 c⁄° *
öbuf
,

102 
ssize_t
 
cou¡
);

104 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


105 
¥öt›ti⁄
(
Sessi⁄H™dÀ
 *
d©a
,

106 c⁄° *
dúe˘i⁄
,

107 
cmd
, 
›ti⁄
);

110 
√gŸüã
(
c⁄√˘d©a
 *);

111 
£nd_√gŸüti⁄
(
c⁄√˘d©a
 *, 
cmd
, 
›ti⁄
);

112 
£t_loˇl_›ti⁄
(
c⁄√˘d©a
 *, 
cmd
, 
›ti⁄
);

113 
£t_ªmŸe_›ti⁄
(
c⁄√˘d©a
 *, 
cmd
, 
›ti⁄
);

115 
¥ötsub
(
Sessi⁄H™dÀ
 *
d©a
,

116 
dúe˘i⁄
, *
poöãr
,

117 
size_t
 
Àngth
);

118 
sub›ti⁄
(
c⁄√˘d©a
 *);

119 
£ndsub›ti⁄
(
c⁄√˘d©a
 *
c⁄n
, 
›ti⁄
);

121 
CURLcode
 
ã ë_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

122 
CURLcode
 
ã ë_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

123 
CURLcode
, 
boﬁ
 
¥em©uª
);

124 
CURLcode
 
£nd_ã ë_d©a
(
c⁄√˘d©a
 *
c⁄n
,

125 *
buf„r
, 
ssize_t
 
ƒód
);

128 
	#CURL_NO
 0

	)

129 
	#CURL_YES
 1

	)

130 
	#CURL_WANTYES
 2

	)

131 
	#CURL_WANTNO
 3

	)

133 
	#CURL_EMPTY
 0

	)

134 
	#CURL_OPPOSITE
 1

	)

141 
	mCURL_TS_DATA
 = 0,

142 
	mCURL_TS_IAC
,

143 
	mCURL_TS_WILL
,

144 
	mCURL_TS_WONT
,

145 
	mCURL_TS_DO
,

146 
	mCURL_TS_DONT
,

147 
	mCURL_TS_CR
,

148 
	mCURL_TS_SB
,

149 
	mCURL_TS_SE


150 } 
	tTñ√tRe˚ive
;

152 
	sTELNET
 {

153 
	m∂ó£_√gŸüã
;

154 
	mÆªady_√gŸüãd
;

155 
	mus
[256];

156 
	musq
[256];

157 
	mus_¥e„ºed
[256];

158 
	mhim
[256];

159 
	mhimq
[256];

160 
	mhim_¥e„ºed
[256];

161 
	msub√gŸüti⁄
[256];

162 
	msub›t_ây≥
[32];

163 
	msub›t_xdi•loc
[128];

164 
	msub›t_wsx
;

165 
	msub›t_wsy
;

166 
cuæ_¶i°
 *
	mã ë_v¨s
;

169 
	msubbuf„r
[
SUBBUFSIZE
];

170 *
	msubpoöãr
, *
	msubíd
;

172 
Tñ√tRe˚ive
 
	mãÃcv_°©e
;

180 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_ã ë
 = {

182 
ZERO_NULL
,

183 
ã ë_do
,

184 
ã ë_d⁄e
,

185 
ZERO_NULL
,

186 
ZERO_NULL
,

187 
ZERO_NULL
,

188 
ZERO_NULL
,

189 
ZERO_NULL
,

190 
ZERO_NULL
,

191 
ZERO_NULL
,

192 
ZERO_NULL
,

193 
ZERO_NULL
,

194 
ZERO_NULL
,

195 
PORT_TELNET
,

196 
CURLPROTO_TELNET
,

197 
PROTOPT_NONE
 | 
PROTOPT_NOURLQUERY


201 #ifde‡
USE_WINSOCK


202 
CURLcode


203 
	$check_wsock2
 ( 
Sessi⁄H™dÀ
 *
d©a
 )

205 
îr
;

206 
WORD
 
wVîsi⁄Reque°ed
;

207 
WSADATA
 
wßD©a
;

209 
	`DEBUGASSERT
(
d©a
);

212 
wVîsi⁄Reque°ed
 = 
	`MAKEWORD
(2, 0);

214 
îr
 = 
	`WSASèπup
(
wVîsi⁄Reque°ed
, &
wßD©a
);

218 if(
îr
 != 0) {

219 
	`Áûf
(
d©a
,"WSASèπu∞Áûed (%d)",
îr
);

220  
CURLE_FAILED_INIT
;

225 
	`WSACÀ™up
();

228 if(
	`LOBYTE
(
wßD©a
.
wVîsi⁄
Ë!LOBYTE(
wVîsi⁄Reque°ed
) ||

229 
	`HIBYTE
(
wßD©a
.
wVîsi⁄
Ë!HIBYTE(
wVîsi⁄Reque°ed
)) {

231 
	`Áûf
(
d©a
,"insufficient winsock versionÅo support "

233  
CURLE_FAILED_INIT
;

237  
CURLE_OK
;

238 
	}
}

242 
CURLcode
 
	$öô_ã ë
(
c⁄√˘d©a
 *
c⁄n
)

244 
TELNET
 *
ä
;

246 
ä
 = 
	`ˇŒoc
(1, (
TELNET
));

247 if(!
ä
)

248  
CURLE_OUT_OF_MEMORY
;

250 
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
 = 
ä
;

252 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DATA
;

255 
	`CURL_SB_CLEAR
(
ä
);

258 
ä
->
us_¥e„ºed
[
CURL_TELOPT_SGA
] = 
CURL_YES
;

259 
ä
->
him_¥e„ºed
[
CURL_TELOPT_SGA
] = 
CURL_YES
;

266 
ä
->
us_¥e„ºed
[
CURL_TELOPT_BINARY
] = 
CURL_YES
;

267 
ä
->
him_¥e„ºed
[
CURL_TELOPT_BINARY
] = 
CURL_YES
;

275 
ä
->
him_¥e„ºed
[
CURL_TELOPT_ECHO
] = 
CURL_YES
;

288 
ä
->
sub√gŸüti⁄
[
CURL_TELOPT_NAWS
] = 
CURL_YES
;

289  
CURLE_OK
;

290 
	}
}

292 
	$√gŸüã
(
c⁄√˘d©a
 *
c⁄n
)

294 
i
;

295 
TELNET
 *
ä
 = (TELNET *Ë
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

297 
i
 = 0;ò< 
CURL_NTELOPTS
;i++) {

298 if(
i
==
CURL_TELOPT_ECHO
)

301 if(
ä
->
us_¥e„ºed
[
i
] =
CURL_YES
)

302 
	`£t_loˇl_›ti⁄
(
c⁄n
, 
i
, 
CURL_YES
);

304 if(
ä
->
him_¥e„ºed
[
i
] =
CURL_YES
)

305 
	`£t_ªmŸe_›ti⁄
(
c⁄n
, 
i
, 
CURL_YES
);

307 
	}
}

309 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


310 
	$¥öt›ti⁄
(
Sessi⁄H™dÀ
 *
d©a
,

311 c⁄° *
dúe˘i⁄
, 
cmd
, 
›ti⁄
)

313 c⁄° *
fmt
;

314 c⁄° *
›t
;

316 if(
d©a
->
£t
.
vîbo£
) {

317 if(
cmd
 =
CURL_IAC
) {

318 if(
	`CURL_TELCMD_OK
(
›ti⁄
))

319 
	`öfof
(
d©a
, "%†IAC %s\n", 
dúe˘i⁄
, 
	`CURL_TELCMD
(
›ti⁄
));

321 
	`öfof
(
d©a
, "%†IAC %d\n", 
dúe˘i⁄
, 
›ti⁄
);

324 
fmt
 = (
cmd
 =
CURL_WILL
Ë? "WILL" : (cmd =
CURL_WONT
) ? "WONT" :

325 (
cmd
 =
CURL_DO
Ë? "DO" : (cmd =
CURL_DONT
) ? "DONT" : 0;

326 if(
fmt
) {

327 if(
	`CURL_TELOPT_OK
(
›ti⁄
))

328 
›t
 = 
	`CURL_TELOPT
(
›ti⁄
);

329 if(
›ti⁄
 =
CURL_TELOPT_EXOPL
)

330 
›t
 = "EXOPL";

332 
›t
 = 
NULL
;

334 if(
›t
)

335 
	`öfof
(
d©a
, "%†%†%s\n", 
dúe˘i⁄
, 
fmt
, 
›t
);

337 
	`öfof
(
d©a
, "%†%†%d\n", 
dúe˘i⁄
, 
fmt
, 
›ti⁄
);

340 
	`öfof
(
d©a
, "%†%d %d\n", 
dúe˘i⁄
, 
cmd
, 
›ti⁄
);

343 
	}
}

346 
	$£nd_√gŸüti⁄
(
c⁄√˘d©a
 *
c⁄n
, 
cmd
, 
›ti⁄
)

348 
buf
[3];

349 
ssize_t
 
byãs_wrôãn
;

350 
îr
;

351 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

353 
buf
[0] = 
CURL_IAC
;

354 
buf
[1] = ()
cmd
;

355 
buf
[2] = ()
›ti⁄
;

357 
byãs_wrôãn
 = 
	`swrôe
(
c⁄n
->
sock
[
FIRSTSOCKET
], 
buf
, 3);

358 if(
byãs_wrôãn
 < 0) {

359 
îr
 = 
SOCKERRNO
;

360 
	`Áûf
(
d©a
,"Sídög d©®Áûed (%d)",
îr
);

363 
	`¥öt›ti⁄
(
c⁄n
->
d©a
, "SENT", 
cmd
, 
›ti⁄
);

364 
	}
}

367 
	$£t_ªmŸe_›ti⁄
(
c⁄√˘d©a
 *
c⁄n
, 
›ti⁄
, 
√w°©e
)

369 
TELNET
 *
ä
 = (TELNET *)
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

370 if(
√w°©e
 =
CURL_YES
) {

371 
ä
->
him
[
›ti⁄
]) {

372 
CURL_NO
:

373 
ä
->
him
[
›ti⁄
] = 
CURL_WANTYES
;

374 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_DO
, 
›ti⁄
);

377 
CURL_YES
:

381 
CURL_WANTNO
:

382 
ä
->
himq
[
›ti⁄
]) {

383 
CURL_EMPTY
:

385 
ä
->
himq
[
›ti⁄
] = 
CURL_OPPOSITE
;

387 
CURL_OPPOSITE
:

393 
CURL_WANTYES
:

394 
ä
->
himq
[
›ti⁄
]) {

395 
CURL_EMPTY
:

398 
CURL_OPPOSITE
:

399 
ä
->
himq
[
›ti⁄
] = 
CURL_EMPTY
;

406 
ä
->
him
[
›ti⁄
]) {

407 
CURL_NO
:

411 
CURL_YES
:

412 
ä
->
him
[
›ti⁄
] = 
CURL_WANTNO
;

413 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_DONT
, 
›ti⁄
);

416 
CURL_WANTNO
:

417 
ä
->
himq
[
›ti⁄
]) {

418 
CURL_EMPTY
:

421 
CURL_OPPOSITE
:

422 
ä
->
himq
[
›ti⁄
] = 
CURL_EMPTY
;

427 
CURL_WANTYES
:

428 
ä
->
himq
[
›ti⁄
]) {

429 
CURL_EMPTY
:

430 
ä
->
himq
[
›ti⁄
] = 
CURL_OPPOSITE
;

432 
CURL_OPPOSITE
:

438 
	}
}

441 
	$ªc_wûl
(
c⁄√˘d©a
 *
c⁄n
, 
›ti⁄
)

443 
TELNET
 *
ä
 = (TELNET *)
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

444 
ä
->
him
[
›ti⁄
]) {

445 
CURL_NO
:

446 if(
ä
->
him_¥e„ºed
[
›ti⁄
] =
CURL_YES
) {

447 
ä
->
him
[
›ti⁄
] = 
CURL_YES
;

448 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_DO
, 
›ti⁄
);

451 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_DONT
, 
›ti⁄
);

455 
CURL_YES
:

459 
CURL_WANTNO
:

460 
ä
->
himq
[
›ti⁄
]) {

461 
CURL_EMPTY
:

463 
ä
->
him
[
›ti⁄
] = 
CURL_NO
;

465 
CURL_OPPOSITE
:

467 
ä
->
him
[
›ti⁄
] = 
CURL_YES
;

468 
ä
->
himq
[
›ti⁄
] = 
CURL_EMPTY
;

473 
CURL_WANTYES
:

474 
ä
->
himq
[
›ti⁄
]) {

475 
CURL_EMPTY
:

476 
ä
->
him
[
›ti⁄
] = 
CURL_YES
;

478 
CURL_OPPOSITE
:

479 
ä
->
him
[
›ti⁄
] = 
CURL_WANTNO
;

480 
ä
->
himq
[
›ti⁄
] = 
CURL_EMPTY
;

481 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_DONT
, 
›ti⁄
);

486 
	}
}

489 
	$ªc_w⁄t
(
c⁄√˘d©a
 *
c⁄n
, 
›ti⁄
)

491 
TELNET
 *
ä
 = (TELNET *)
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

492 
ä
->
him
[
›ti⁄
]) {

493 
CURL_NO
:

497 
CURL_YES
:

498 
ä
->
him
[
›ti⁄
] = 
CURL_NO
;

499 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_DONT
, 
›ti⁄
);

502 
CURL_WANTNO
:

503 
ä
->
himq
[
›ti⁄
]) {

504 
CURL_EMPTY
:

505 
ä
->
him
[
›ti⁄
] = 
CURL_NO
;

508 
CURL_OPPOSITE
:

509 
ä
->
him
[
›ti⁄
] = 
CURL_WANTYES
;

510 
ä
->
himq
[
›ti⁄
] = 
CURL_EMPTY
;

511 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_DO
, 
›ti⁄
);

516 
CURL_WANTYES
:

517 
ä
->
himq
[
›ti⁄
]) {

518 
CURL_EMPTY
:

519 
ä
->
him
[
›ti⁄
] = 
CURL_NO
;

521 
CURL_OPPOSITE
:

522 
ä
->
him
[
›ti⁄
] = 
CURL_NO
;

523 
ä
->
himq
[
›ti⁄
] = 
CURL_EMPTY
;

528 
	}
}

531 
	$£t_loˇl_›ti⁄
(
c⁄√˘d©a
 *
c⁄n
, 
›ti⁄
, 
√w°©e
)

533 
TELNET
 *
ä
 = (TELNET *)
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

534 if(
√w°©e
 =
CURL_YES
) {

535 
ä
->
us
[
›ti⁄
]) {

536 
CURL_NO
:

537 
ä
->
us
[
›ti⁄
] = 
CURL_WANTYES
;

538 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_WILL
, 
›ti⁄
);

541 
CURL_YES
:

545 
CURL_WANTNO
:

546 
ä
->
usq
[
›ti⁄
]) {

547 
CURL_EMPTY
:

549 
ä
->
usq
[
›ti⁄
] = 
CURL_OPPOSITE
;

551 
CURL_OPPOSITE
:

557 
CURL_WANTYES
:

558 
ä
->
usq
[
›ti⁄
]) {

559 
CURL_EMPTY
:

562 
CURL_OPPOSITE
:

563 
ä
->
usq
[
›ti⁄
] = 
CURL_EMPTY
;

570 
ä
->
us
[
›ti⁄
]) {

571 
CURL_NO
:

575 
CURL_YES
:

576 
ä
->
us
[
›ti⁄
] = 
CURL_WANTNO
;

577 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_WONT
, 
›ti⁄
);

580 
CURL_WANTNO
:

581 
ä
->
usq
[
›ti⁄
]) {

582 
CURL_EMPTY
:

585 
CURL_OPPOSITE
:

586 
ä
->
usq
[
›ti⁄
] = 
CURL_EMPTY
;

591 
CURL_WANTYES
:

592 
ä
->
usq
[
›ti⁄
]) {

593 
CURL_EMPTY
:

594 
ä
->
usq
[
›ti⁄
] = 
CURL_OPPOSITE
;

596 
CURL_OPPOSITE
:

602 
	}
}

605 
	$ªc_do
(
c⁄√˘d©a
 *
c⁄n
, 
›ti⁄
)

607 
TELNET
 *
ä
 = (TELNET *)
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

608 
ä
->
us
[
›ti⁄
]) {

609 
CURL_NO
:

610 if(
ä
->
us_¥e„ºed
[
›ti⁄
] =
CURL_YES
) {

611 
ä
->
us
[
›ti⁄
] = 
CURL_YES
;

612 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_WILL
, 
›ti⁄
);

613 if(
ä
->
sub√gŸüti⁄
[
›ti⁄
] =
CURL_YES
)

615 
	`£ndsub›ti⁄
(
c⁄n
, 
›ti⁄
);

617 if(
ä
->
sub√gŸüti⁄
[
›ti⁄
] =
CURL_YES
) {

619 
ä
->
us
[
›ti⁄
] = 
CURL_YES
;

620 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_WILL
, 
›ti⁄
);

621 
	`£ndsub›ti⁄
(
c⁄n
, 
›ti⁄
);

624 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_WONT
, 
›ti⁄
);

627 
CURL_YES
:

631 
CURL_WANTNO
:

632 
ä
->
usq
[
›ti⁄
]) {

633 
CURL_EMPTY
:

635 
ä
->
us
[
›ti⁄
] = 
CURL_NO
;

637 
CURL_OPPOSITE
:

639 
ä
->
us
[
›ti⁄
] = 
CURL_YES
;

640 
ä
->
usq
[
›ti⁄
] = 
CURL_EMPTY
;

645 
CURL_WANTYES
:

646 
ä
->
usq
[
›ti⁄
]) {

647 
CURL_EMPTY
:

648 
ä
->
us
[
›ti⁄
] = 
CURL_YES
;

649 if(
ä
->
sub√gŸüti⁄
[
›ti⁄
] =
CURL_YES
) {

651 
	`£ndsub›ti⁄
(
c⁄n
, 
›ti⁄
);

654 
CURL_OPPOSITE
:

655 
ä
->
us
[
›ti⁄
] = 
CURL_WANTNO
;

656 
ä
->
himq
[
›ti⁄
] = 
CURL_EMPTY
;

657 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_WONT
, 
›ti⁄
);

662 
	}
}

665 
	$ªc_d⁄t
(
c⁄√˘d©a
 *
c⁄n
, 
›ti⁄
)

667 
TELNET
 *
ä
 = (TELNET *)
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

668 
ä
->
us
[
›ti⁄
]) {

669 
CURL_NO
:

673 
CURL_YES
:

674 
ä
->
us
[
›ti⁄
] = 
CURL_NO
;

675 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_WONT
, 
›ti⁄
);

678 
CURL_WANTNO
:

679 
ä
->
usq
[
›ti⁄
]) {

680 
CURL_EMPTY
:

681 
ä
->
us
[
›ti⁄
] = 
CURL_NO
;

684 
CURL_OPPOSITE
:

685 
ä
->
us
[
›ti⁄
] = 
CURL_WANTYES
;

686 
ä
->
usq
[
›ti⁄
] = 
CURL_EMPTY
;

687 
	`£nd_√gŸüti⁄
(
c⁄n
, 
CURL_WILL
, 
›ti⁄
);

692 
CURL_WANTYES
:

693 
ä
->
usq
[
›ti⁄
]) {

694 
CURL_EMPTY
:

695 
ä
->
us
[
›ti⁄
] = 
CURL_NO
;

697 
CURL_OPPOSITE
:

698 
ä
->
us
[
›ti⁄
] = 
CURL_NO
;

699 
ä
->
usq
[
›ti⁄
] = 
CURL_EMPTY
;

704 
	}
}

707 
	$¥ötsub
(
Sessi⁄H™dÀ
 *
d©a
,

708 
dúe˘i⁄
,

709 *
poöãr
,

710 
size_t
 
Àngth
)

712 
i
 = 0;

713 *
pvÆ
;

715 if(
d©a
->
£t
.
vîbo£
) {

716 if(
dúe˘i⁄
) {

717 
	`öfof
(
d©a
, "%†IAC SB ", (
dúe˘i⁄
 == '<')? "RCVD":"SENT");

718 if(
Àngth
 >= 3) {

719 
j
;

721 
i
 = 
poöãr
[
Àngth
-2];

722 
j
 = 
poöãr
[
Àngth
-1];

724 if(
i
 !
CURL_IAC
 || 
j
 !
CURL_SE
) {

725 
	`öfof
(
d©a
, "(terminated by ");

726 if(
	`CURL_TELOPT_OK
(
i
))

727 
	`öfof
(
d©a
, "%†", 
	`CURL_TELOPT
(
i
));

728 if(
	`CURL_TELCMD_OK
(
i
))

729 
	`öfof
(
d©a
, "%†", 
	`CURL_TELCMD
(
i
));

731 
	`öfof
(
d©a
, "%u ", 
i
);

732 if(
	`CURL_TELOPT_OK
(
j
))

733 
	`öfof
(
d©a
, "%s", 
	`CURL_TELOPT
(
j
));

734 if(
	`CURL_TELCMD_OK
(
j
))

735 
	`öfof
(
d©a
, "%s", 
	`CURL_TELCMD
(
j
));

737 
	`öfof
(
d©a
, "%d", 
j
);

738 
	`öfof
(
d©a
, ",Çot IAC SE!) ");

741 
Àngth
 -= 2;

743 if(
Àngth
 < 1) {

744 
	`öfof
(
d©a
, "(Empty suboption?)");

748 if(
	`CURL_TELOPT_OK
(
poöãr
[0])) {

749 
poöãr
[0]) {

750 
CURL_TELOPT_TTYPE
:

751 
CURL_TELOPT_XDISPLOC
:

752 
CURL_TELOPT_NEW_ENVIRON
:

753 
CURL_TELOPT_NAWS
:

754 
	`öfof
(
d©a
, "%s", 
	`CURL_TELOPT
(
poöãr
[0]));

757 
	`öfof
(
d©a
, "%†(unsuµ‹ãd)", 
	`CURL_TELOPT
(
poöãr
[0]));

762 
	`öfof
(
d©a
, "%d (unknown)", 
poöãr
[
i
]);

764 
poöãr
[0]) {

765 
CURL_TELOPT_NAWS
:

766 
pvÆ
 = (*)(
poöãr
+1);

767 
	`öfof
(
d©a
, "Width: %hu ; Height: %hu",

768 
	`¡ohs
(
pvÆ
[0]),Çtohs(pval[1]));

771 
poöãr
[1]) {

772 
CURL_TELQUAL_IS
:

773 
	`öfof
(
d©a
, " IS");

775 
CURL_TELQUAL_SEND
:

776 
	`öfof
(
d©a
, " SEND");

778 
CURL_TELQUAL_INFO
:

779 
	`öfof
(
d©a
, " INFO/REPLY");

781 
CURL_TELQUAL_NAME
:

782 
	`öfof
(
d©a
, " NAME");

786 
poöãr
[0]) {

787 
CURL_TELOPT_TTYPE
:

788 
CURL_TELOPT_XDISPLOC
:

789 
poöãr
[
Àngth
] = 0;

790 
	`öfof
(
d©a
, " \"%s\"", &
poöãr
[2]);

792 
CURL_TELOPT_NEW_ENVIRON
:

793 if(
poöãr
[1] =
CURL_TELQUAL_IS
) {

794 
	`öfof
(
d©a
, " ");

795 
i
 = 3;ò< 
Àngth
;i++) {

796 
poöãr
[
i
]) {

797 
CURL_NEW_ENV_VAR
:

798 
	`öfof
(
d©a
, ", ");

800 
CURL_NEW_ENV_VALUE
:

801 
	`öfof
(
d©a
, " = ");

804 
	`öfof
(
d©a
, "%c", 
poöãr
[
i
]);

811 
i
 = 2; i < 
Àngth
; i++)

812 
	`öfof
(
d©a
, " %.2x", 
poöãr
[
i
]);

816 if(
dúe˘i⁄
)

817 
	`öfof
(
d©a
, "\n");

819 
	}
}

821 
CURLcode
 
	$check_ã ë_›ti⁄s
(
c⁄√˘d©a
 *
c⁄n
)

823 
cuæ_¶i°
 *
hód
;

824 
cuæ_¶i°
 *
beg
;

825 
›ti⁄_keyw‹d
[128] = "";

826 
›ti⁄_¨g
[256] = "";

827 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

828 
TELNET
 *
ä
 = (TELNET *)
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

829 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

830 
bö¨y_›ti⁄
;

834 if(
c⁄n
->
bôs
.
u£r_∑sswd
) {

835 
	`¢¥ötf
(
›ti⁄_¨g
, (›ti⁄_¨g), "USER,%s", 
c⁄n
->
u£r
);

836 
beg
 = 
	`cuæ_¶i°_≠≥nd
(
ä
->
ã ë_v¨s
, 
›ti⁄_¨g
);

837 if(!
beg
) {

838 
	`cuæ_¶i°_‰ì_Æl
(
ä
->
ã ë_v¨s
);

839 
ä
->
ã ë_v¨s
 = 
NULL
;

840  
CURLE_OUT_OF_MEMORY
;

842 
ä
->
ã ë_v¨s
 = 
beg
;

843 
ä
->
us_¥e„ºed
[
CURL_TELOPT_NEW_ENVIRON
] = 
CURL_YES
;

846 
hód
 = 
d©a
->
£t
.
ã ë_›ti⁄s
; hód; hód=hód->
√xt
) {

847 if(
	`ssˇnf
(
hód
->
d©a
, "%127[^= ]%*[ =]%255s",

848 
›ti⁄_keyw‹d
, 
›ti⁄_¨g
) == 2) {

851 if(
	`Cuæ_øw_equÆ
(
›ti⁄_keyw‹d
, "TTYPE")) {

852 
	`°∫˝y
(
ä
->
sub›t_ây≥
, 
›ti⁄_¨g
, 31);

853 
ä
->
sub›t_ây≥
[31] = 0;

854 
ä
->
us_¥e„ºed
[
CURL_TELOPT_TTYPE
] = 
CURL_YES
;

859 if(
	`Cuæ_øw_equÆ
(
›ti⁄_keyw‹d
, "XDISPLOC")) {

860 
	`°∫˝y
(
ä
->
sub›t_xdi•loc
, 
›ti⁄_¨g
, 127);

861 
ä
->
sub›t_xdi•loc
[127] = 0;

862 
ä
->
us_¥e„ºed
[
CURL_TELOPT_XDISPLOC
] = 
CURL_YES
;

867 if(
	`Cuæ_øw_equÆ
(
›ti⁄_keyw‹d
, "NEW_ENV")) {

868 
beg
 = 
	`cuæ_¶i°_≠≥nd
(
ä
->
ã ë_v¨s
, 
›ti⁄_¨g
);

869 if(!
beg
) {

870 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

873 
ä
->
ã ë_v¨s
 = 
beg
;

874 
ä
->
us_¥e„ºed
[
CURL_TELOPT_NEW_ENVIRON
] = 
CURL_YES
;

879 if(
	`Cuæ_øw_equÆ
(
›ti⁄_keyw‹d
, "WS")) {

880 if(
	`ssˇnf
(
›ti⁄_¨g
, "%hu%*[xX]%hu",

881 &
ä
->
sub›t_wsx
, &ä->
sub›t_wsy
) == 2)

882 
ä
->
us_¥e„ºed
[
CURL_TELOPT_NAWS
] = 
CURL_YES
;

884 
	`Áûf
(
d©a
, "Sy¡axÉº‹ i¿ã ë o±i⁄: %s", 
hód
->data);

885 
ªsu…
 = 
CURLE_TELNET_OPTION_SYNTAX
;

892 if(
	`Cuæ_øw_equÆ
(
›ti⁄_keyw‹d
, "BINARY")) {

893 
bö¨y_›ti⁄
=
	`©oi
(
›ti⁄_¨g
);

894 if(
bö¨y_›ti⁄
!=1) {

895 
ä
->
us_¥e„ºed
[
CURL_TELOPT_BINARY
] = 
CURL_NO
;

896 
ä
->
him_¥e„ºed
[
CURL_TELOPT_BINARY
] = 
CURL_NO
;

901 
	`Áûf
(
d©a
, "Unknow¿ã ë o±i⁄ %s", 
hód
->data);

902 
ªsu…
 = 
CURLE_UNKNOWN_TELNET_OPTION
;

906 
	`Áûf
(
d©a
, "Sy¡axÉº‹ i¿ã ë o±i⁄: %s", 
hód
->data);

907 
ªsu…
 = 
CURLE_TELNET_OPTION_SYNTAX
;

912 if(
ªsu…
) {

913 
	`cuæ_¶i°_‰ì_Æl
(
ä
->
ã ë_v¨s
);

914 
ä
->
ã ë_v¨s
 = 
NULL
;

917  
ªsu…
;

918 
	}
}

927 
	$sub›ti⁄
(
c⁄√˘d©a
 *
c⁄n
)

929 
cuæ_¶i°
 *
v
;

930 
ãmp
[2048];

931 
ssize_t
 
byãs_wrôãn
;

932 
size_t
 
Àn
;

933 
size_t
 
tm∂í
;

934 
îr
;

935 
v¨«me
[128] = "";

936 
v¨vÆ
[128] = "";

937 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

938 
TELNET
 *
ä
 = (TELNET *)
d©a
->
ªq
.
¥Ÿ›
;

940 
	`¥ötsub
(
d©a
, '<', (*)
ä
->
subbuf„r
, 
	`CURL_SB_LEN
(tn)+2);

941 
	`CURL_SB_GET
(
ä
)) {

942 
CURL_TELOPT_TTYPE
:

943 
Àn
 = 
	`°æí
(
ä
->
sub›t_ây≥
) + 4 + 2;

944 
	`¢¥ötf
((*)
ãmp
, (temp),

945 "%c%c%c%c%s%c%c", 
CURL_IAC
, 
CURL_SB
, 
CURL_TELOPT_TTYPE
,

946 
CURL_TELQUAL_IS
, 
ä
->
sub›t_ây≥
, 
CURL_IAC
, 
CURL_SE
);

947 
byãs_wrôãn
 = 
	`swrôe
(
c⁄n
->
sock
[
FIRSTSOCKET
], 
ãmp
, 
Àn
);

948 if(
byãs_wrôãn
 < 0) {

949 
îr
 = 
SOCKERRNO
;

950 
	`Áûf
(
d©a
,"Sídög d©®Áûed (%d)",
îr
);

952 
	`¥ötsub
(
d©a
, '>', &
ãmp
[2], 
Àn
-2);

954 
CURL_TELOPT_XDISPLOC
:

955 
Àn
 = 
	`°æí
(
ä
->
sub›t_xdi•loc
) + 4 + 2;

956 
	`¢¥ötf
((*)
ãmp
, (temp),

957 "%c%c%c%c%s%c%c", 
CURL_IAC
, 
CURL_SB
, 
CURL_TELOPT_XDISPLOC
,

958 
CURL_TELQUAL_IS
, 
ä
->
sub›t_xdi•loc
, 
CURL_IAC
, 
CURL_SE
);

959 
byãs_wrôãn
 = 
	`swrôe
(
c⁄n
->
sock
[
FIRSTSOCKET
], 
ãmp
, 
Àn
);

960 if(
byãs_wrôãn
 < 0) {

961 
îr
 = 
SOCKERRNO
;

962 
	`Áûf
(
d©a
,"Sídög d©®Áûed (%d)",
îr
);

964 
	`¥ötsub
(
d©a
, '>', &
ãmp
[2], 
Àn
-2);

966 
CURL_TELOPT_NEW_ENVIRON
:

967 
	`¢¥ötf
((*)
ãmp
, (temp),

968 "%c%c%c%c", 
CURL_IAC
, 
CURL_SB
, 
CURL_TELOPT_NEW_ENVIRON
,

969 
CURL_TELQUAL_IS
);

970 
Àn
 = 4;

972 
v
 = 
ä
->
ã ë_v¨s
;v;v = v->
√xt
) {

973 
tm∂í
 = (
	`°æí
(
v
->
d©a
) + 1);

975 if(
Àn
 + 
tm∂í
 < ()(
ãmp
)-6) {

976 if(
	`ssˇnf
(
v
->
d©a
, "%127[^,],%127s", 
v¨«me
, 
v¨vÆ
)) {

977 
	`¢¥ötf
((*)&
ãmp
[
Àn
], (temp) -Üen,

978 "%c%s%c%s", 
CURL_NEW_ENV_VAR
, 
v¨«me
,

979 
CURL_NEW_ENV_VALUE
, 
v¨vÆ
);

980 
Àn
 +
tm∂í
;

984 
	`¢¥ötf
((*)&
ãmp
[
Àn
], (temp) -Üen,

985 "%c%c", 
CURL_IAC
, 
CURL_SE
);

986 
Àn
 += 2;

987 
byãs_wrôãn
 = 
	`swrôe
(
c⁄n
->
sock
[
FIRSTSOCKET
], 
ãmp
, 
Àn
);

988 if(
byãs_wrôãn
 < 0) {

989 
îr
 = 
SOCKERRNO
;

990 
	`Áûf
(
d©a
,"Sídög d©®Áûed (%d)",
îr
);

992 
	`¥ötsub
(
d©a
, '>', &
ãmp
[2], 
Àn
-2);

996 
	}
}

1005 
	$£ndsub›ti⁄
(
c⁄√˘d©a
 *
c⁄n
, 
›ti⁄
)

1007 
ssize_t
 
byãs_wrôãn
;

1008 
îr
;

1009 
x
, 
y
;

1010 *
uc1
, *
uc2
;

1012 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1013 
TELNET
 *
ä
 = (TELNET *)
d©a
->
ªq
.
¥Ÿ›
;

1015 
›ti⁄
) {

1016 
CURL_TELOPT_NAWS
:

1018 
	`CURL_SB_CLEAR
(
ä
);

1019 
	`CURL_SB_ACCUM
(
ä
, 
CURL_IAC
);

1020 
	`CURL_SB_ACCUM
(
ä
, 
CURL_SB
);

1021 
	`CURL_SB_ACCUM
(
ä
, 
CURL_TELOPT_NAWS
);

1024 
x
=
	`ht⁄s
(
ä
->
sub›t_wsx
);

1025 
y
=
	`ht⁄s
(
ä
->
sub›t_wsy
);

1026 
uc1
 = (*)&
x
;

1027 
uc2
 = (*)&
y
;

1028 
	`CURL_SB_ACCUM
(
ä
, 
uc1
[0]);

1029 
	`CURL_SB_ACCUM
(
ä
, 
uc1
[1]);

1030 
	`CURL_SB_ACCUM
(
ä
, 
uc2
[0]);

1031 
	`CURL_SB_ACCUM
(
ä
, 
uc2
[1]);

1033 
	`CURL_SB_ACCUM
(
ä
, 
CURL_IAC
);

1034 
	`CURL_SB_ACCUM
(
ä
, 
CURL_SE
);

1035 
	`CURL_SB_TERM
(
ä
);

1038 
	`¥ötsub
(
d©a
, '>', (*)
ä
->
subbuf„r
+2,

1039 
	`CURL_SB_LEN
(
ä
)-2);

1042 
byãs_wrôãn
 = 
	`swrôe
(
c⁄n
->
sock
[
FIRSTSOCKET
], 
ä
->
subbuf„r
, 3);

1043 if(
byãs_wrôãn
 < 0) {

1044 
îr
 = 
SOCKERRNO
;

1045 
	`Áûf
(
d©a
, "Sídög d©®Áûed (%d)", 
îr
);

1049 
	`£nd_ã ë_d©a
(
c⁄n
, (*)
ä
->
subbuf„r
+3, 4);

1051 
byãs_wrôãn
 = 
	`swrôe
(
c⁄n
->
sock
[
FIRSTSOCKET
], 
ä
->
subbuf„r
+7, 2);

1052 if(
byãs_wrôãn
 < 0) {

1053 
îr
 = 
SOCKERRNO
;

1054 
	`Áûf
(
d©a
, "Sídög d©®Áûed (%d)", 
îr
);

1058 
	}
}

1062 
CURLcode
 
	$ãÃcv
(
c⁄√˘d©a
 *
c⁄n
,

1063 c⁄° *
öbuf
,

1064 
ssize_t
 
cou¡
)

1066 
c
;

1067 
CURLcode
 
ªsu…
;

1068 
ö
 = 0;

1069 
°¨twrôe
=-1;

1070 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1071 
TELNET
 *
ä
 = (TELNET *)
d©a
->
ªq
.
¥Ÿ›
;

1073 
	#°¨tskùpög
() \

1074 if(
°¨twrôe
 >= 0) { \

1075 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, \

1076 
CLIENTWRITE_BODY
, \

1077 (*)&
öbuf
[
°¨twrôe
], \

1078 
ö
-
°¨twrôe
); \

1079 if(
ªsu…
 !
CURLE_OK
) \

1080  
ªsu…
; \

1082 
°¨twrôe
 = -1

	)

1084 
	#wrôebyã
() \

1085 if(
°¨twrôe
 < 0) \

1086 
°¨twrôe
 = 
ö


	)

1088 
	#buf„rÊush
(Ë
	`°¨tskùpög
()

	)

1090 
cou¡
--) {

1091 
c
 = 
öbuf
[
ö
];

1093 
ä
->
ãÃcv_°©e
) {

1094 
CURL_TS_CR
:

1095 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DATA
;

1096 if(
c
 == '\0') {

1097 
	`°¨tskùpög
();

1100 
	`wrôebyã
();

1103 
CURL_TS_DATA
:

1104 if(
c
 =
CURL_IAC
) {

1105 
ä
->
ãÃcv_°©e
 = 
CURL_TS_IAC
;

1106 
	`°¨tskùpög
();

1109 if(
c
 == '\r')

1110 
ä
->
ãÃcv_°©e
 = 
CURL_TS_CR
;

1111 
	`wrôebyã
();

1114 
CURL_TS_IAC
:

1115 
¥o˚ss_üc
:

1116 
	`DEBUGASSERT
(
°¨twrôe
 < 0);

1117 
c
) {

1118 
CURL_WILL
:

1119 
ä
->
ãÃcv_°©e
 = 
CURL_TS_WILL
;

1121 
CURL_WONT
:

1122 
ä
->
ãÃcv_°©e
 = 
CURL_TS_WONT
;

1124 
CURL_DO
:

1125 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DO
;

1127 
CURL_DONT
:

1128 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DONT
;

1130 
CURL_SB
:

1131 
	`CURL_SB_CLEAR
(
ä
);

1132 
ä
->
ãÃcv_°©e
 = 
CURL_TS_SB
;

1134 
CURL_IAC
:

1135 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DATA
;

1136 
	`wrôebyã
();

1138 
CURL_DM
:

1139 
CURL_NOP
:

1140 
CURL_GA
:

1142 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DATA
;

1143 
	`¥öt›ti⁄
(
d©a
, "RCVD", 
CURL_IAC
, 
c
);

1148 
CURL_TS_WILL
:

1149 
	`¥öt›ti⁄
(
d©a
, "RCVD", 
CURL_WILL
, 
c
);

1150 
ä
->
∂ó£_√gŸüã
 = 1;

1151 
	`ªc_wûl
(
c⁄n
, 
c
);

1152 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DATA
;

1155 
CURL_TS_WONT
:

1156 
	`¥öt›ti⁄
(
d©a
, "RCVD", 
CURL_WONT
, 
c
);

1157 
ä
->
∂ó£_√gŸüã
 = 1;

1158 
	`ªc_w⁄t
(
c⁄n
, 
c
);

1159 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DATA
;

1162 
CURL_TS_DO
:

1163 
	`¥öt›ti⁄
(
d©a
, "RCVD", 
CURL_DO
, 
c
);

1164 
ä
->
∂ó£_√gŸüã
 = 1;

1165 
	`ªc_do
(
c⁄n
, 
c
);

1166 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DATA
;

1169 
CURL_TS_DONT
:

1170 
	`¥öt›ti⁄
(
d©a
, "RCVD", 
CURL_DONT
, 
c
);

1171 
ä
->
∂ó£_√gŸüã
 = 1;

1172 
	`ªc_d⁄t
(
c⁄n
, 
c
);

1173 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DATA
;

1176 
CURL_TS_SB
:

1177 if(
c
 =
CURL_IAC
)

1178 
ä
->
ãÃcv_°©e
 = 
CURL_TS_SE
;

1180 
	`CURL_SB_ACCUM
(
ä
,
c
);

1183 
CURL_TS_SE
:

1184 if(
c
 !
CURL_SE
) {

1185 if(
c
 !
CURL_IAC
) {

1195 
	`CURL_SB_ACCUM
(
ä
, 
CURL_IAC
);

1196 
	`CURL_SB_ACCUM
(
ä
, 
c
);

1197 
ä
->
subpoöãr
 -= 2;

1198 
	`CURL_SB_TERM
(
ä
);

1200 
	`¥öt›ti⁄
(
d©a
, "I¿SUBOPTIONÖro˚ssög, RCVD", 
CURL_IAC
, 
c
);

1201 
	`sub›ti⁄
(
c⁄n
);

1202 
ä
->
ãÃcv_°©e
 = 
CURL_TS_IAC
;

1203 
¥o˚ss_üc
;

1205 
	`CURL_SB_ACCUM
(
ä
,
c
);

1206 
ä
->
ãÃcv_°©e
 = 
CURL_TS_SB
;

1210 
	`CURL_SB_ACCUM
(
ä
, 
CURL_IAC
);

1211 
	`CURL_SB_ACCUM
(
ä
, 
CURL_SE
);

1212 
ä
->
subpoöãr
 -= 2;

1213 
	`CURL_SB_TERM
(
ä
);

1214 
	`sub›ti⁄
(
c⁄n
);

1215 
ä
->
ãÃcv_°©e
 = 
CURL_TS_DATA
;

1219 ++
ö
;

1221 
	`buf„rÊush
();

1222  
CURLE_OK
;

1223 
	}
}

1227 
CURLcode
 
	$£nd_ã ë_d©a
(
c⁄√˘d©a
 *
c⁄n
,

1228 *
buf„r
, 
ssize_t
 
ƒód
)

1230 
outbuf
[2];

1231 
ssize_t
 
byãs_wrôãn
, 
tŸÆ_wrôãn
;

1232 
out_cou¡
;

1233 
CURLcode
 
rc
 = 
CURLE_OK
;

1235 
rc
 =
CURLE_OK
 && 
ƒód
--) {

1236 
outbuf
[0] = *
buf„r
++;

1237 
out_cou¡
 = 1;

1238 if(
outbuf
[0] =
CURL_IAC
)

1239 
outbuf
[
out_cou¡
++] = 
CURL_IAC
;

1241 
tŸÆ_wrôãn
 = 0;

1244 
pﬁlfd
 
pfd
[1];

1245 
pfd
[0].
fd
 = 
c⁄n
->
sock
[
FIRSTSOCKET
];

1246 
pfd
[0].
evíts
 = 
POLLOUT
;

1247 
	`Cuæ_pﬁl
(
pfd
, 1, -1)) {

1250 
rc
 = 
CURLE_SEND_ERROR
;

1253 
byãs_wrôãn
 = 0;

1254 
rc
 = 
	`Cuæ_wrôe
(
c⁄n
, c⁄n->
sock
[
FIRSTSOCKET
], 
outbuf
+
tŸÆ_wrôãn
,

1255 
out_cou¡
-
tŸÆ_wrôãn
, &
byãs_wrôãn
);

1256 
tŸÆ_wrôãn
 +
byãs_wrôãn
;

1260 } 
rc
 =
CURLE_OK
 && 
tŸÆ_wrôãn
 < 
out_cou¡
);

1262  
rc
;

1263 
	}
}

1265 
CURLcode
 
	$ã ë_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

1266 
CURLcode
 
°©us
, 
boﬁ
 
¥em©uª
)

1268 
TELNET
 *
ä
 = (TELNET *)
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
;

1269 ()
°©us
;

1270 ()
¥em©uª
;

1272 if(!
ä
)

1273  
CURLE_OK
;

1275 
	`cuæ_¶i°_‰ì_Æl
(
ä
->
ã ë_v¨s
);

1276 
ä
->
ã ë_v¨s
 = 
NULL
;

1278 
	`Cuæ_ß„‰ì
(
c⁄n
->
d©a
->
ªq
.
¥Ÿ›
);

1280  
CURLE_OK
;

1281 
	}
}

1283 
CURLcode
 
	$ã ë_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1285 
CURLcode
 
code
;

1286 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1287 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
FIRSTSOCKET
];

1288 #ifde‡
USE_WINSOCK


1289 
HMODULE
 
wsock2
;

1290 
WSOCK2_FUNC
 
˛o£_evít_func
;

1291 
WSOCK2_FUNC
 
¸óã_evít_func
;

1292 
WSOCK2_FUNC
 
evít_£À˘_func
;

1293 
WSOCK2_FUNC
 
íum_√ãvíts_func
;

1294 
WSAEVENT
 
evít_h™dÀ
;

1295 
WSANETWORKEVENTS
 
evíts
;

1296 
HANDLE
 
°dö_h™dÀ
;

1297 
HANDLE
 
objs
[2];

1298 
DWORD
 
obj_cou¡
;

1299 
DWORD
 
waô_timeout
;

1300 
DWORD
 
waôªt
;

1301 
DWORD
 
ªadfûe_ªad
;

1302 
îr
;

1304 
öãrvÆ_ms
;

1305 
pﬁlfd
 
pfd
[2];

1306 
pﬁl_˙t
;

1307 
cuæ_off_t
 
tŸÆ_dl
 = 0;

1308 
cuæ_off_t
 
tŸÆ_ul
 = 0;

1310 
ssize_t
 
ƒód
;

1311 
timevÆ
 
now
;

1312 
boﬁ
 
kìp⁄
 = 
TRUE
;

1313 *
buf
 = 
d©a
->
°©e
.
buf„r
;

1314 
TELNET
 *
ä
;

1316 *
d⁄e
 = 
TRUE
;

1318 
code
 = 
	`öô_ã ë
(
c⁄n
);

1319 if(
code
)

1320  
code
;

1322 
ä
 = (
TELNET
 *)
d©a
->
ªq
.
¥Ÿ›
;

1324 
code
 = 
	`check_ã ë_›ti⁄s
(
c⁄n
);

1325 if(
code
)

1326  
code
;

1328 #ifde‡
USE_WINSOCK


1333 
code
 = 
	`check_wsock2
(
d©a
);

1334 if(
code
)

1335  
code
;

1339 
wsock2
 = 
	`LﬂdLibøry
(
	`TEXT
("WS2_32.DLL"));

1340 if(
wsock2
 =
NULL
) {

1341 
	`Áûf
(
d©a
,"ÁûedÅÿlﬂd WS2_32.DLL (%d)", 
ERRNO
);

1342  
CURLE_FAILED_INIT
;

1346 
¸óã_evít_func
 = 
	`GëProcAddªss
(
wsock2
,"WSACreateEvent");

1347 if(
¸óã_evít_func
 =
NULL
) {

1348 
	`Áûf
(
d©a
,"failedÅo find WSACreateEvent function (%d)",

1349 
ERRNO
);

1350 
	`FªeLibøry
(
wsock2
);

1351  
CURLE_FAILED_INIT
;

1355 
˛o£_evít_func
 = 
	`GëProcAddªss
(
wsock2
,"WSACloseEvent");

1356 if(
˛o£_evít_func
 =
NULL
) {

1357 
	`Áûf
(
d©a
,"failedÅo find WSACloseEvent function (%d)",

1358 
ERRNO
);

1359 
	`FªeLibøry
(
wsock2
);

1360  
CURLE_FAILED_INIT
;

1364 
evít_£À˘_func
 = 
	`GëProcAddªss
(
wsock2
,"WSAEventSelect");

1365 if(
evít_£À˘_func
 =
NULL
) {

1366 
	`Áûf
(
d©a
,"failedÅo find WSAEventSelect function (%d)",

1367 
ERRNO
);

1368 
	`FªeLibøry
(
wsock2
);

1369  
CURLE_FAILED_INIT
;

1373 
íum_√ãvíts_func
 = 
	`GëProcAddªss
(
wsock2
,"WSAEnumNetworkEvents");

1374 if(
íum_√ãvíts_func
 =
NULL
) {

1375 
	`Áûf
(
d©a
,"failedÅo find WSAEnumNetworkEvents function (%d)",

1376 
ERRNO
);

1377 
	`FªeLibøry
(
wsock2
);

1378  
CURLE_FAILED_INIT
;

1387 
evít_h™dÀ
 = (
WSAEVENT
)
	`¸óã_evít_func
();

1388 if(
evít_h™dÀ
 =
WSA_INVALID_EVENT
) {

1389 
	`Áûf
(
d©a
,"WSACª©eEvíàÁûed (%d)", 
SOCKERRNO
);

1390 
	`FªeLibøry
(
wsock2
);

1391  
CURLE_FAILED_INIT
;

1395 if(
	`evít_£À˘_func
(
sockfd
, 
evít_h™dÀ
, 
FD_READ
|
FD_CLOSE
) ==

1396 
SOCKET_ERROR
) {

1397 
	`˛o£_evít_func
(
evít_h™dÀ
);

1398 
	`FªeLibøry
(
wsock2
);

1399  
CURLE_OK
;

1403 
°dö_h™dÀ
 = 
	`GëStdH™dÀ
(
STD_INPUT_HANDLE
);

1406 
objs
[0] = 
evít_h™dÀ
;

1407 
objs
[1] = 
°dö_h™dÀ
;

1411 if(
	`GëFûeTy≥
(
°dö_h™dÀ
Ë=
FILE_TYPE_PIPE
 ||

1412 
d©a
->
£t
.
is_‰ód_£t
) {

1414 
obj_cou¡
 = 1;

1416 
waô_timeout
 = 100;

1419 
obj_cou¡
 = 2;

1420 
waô_timeout
 = 1000;

1424 
kìp⁄
) {

1425 
waôªt
 = 
	`WaôF‹Mu…ùÀObje˘s
(
obj_cou¡
, 
objs
, 
FALSE
, 
waô_timeout
);

1426 
waôªt
) {

1427 
WAIT_TIMEOUT
:

1430 if(
obj_cou¡
 == 1) {

1432 
code
 = ()
c⁄n
->
	`‰ód_func
(
buf
, 1, 
BUFSIZE
 - 1, c⁄n->
‰ód_ö
);

1433 if(
code
 =
CURL_READFUNC_ABORT
) {

1434 
kìp⁄
 = 
FALSE
;

1435 
code
 = 
CURLE_READ_ERROR
;

1439 if(
code
 =
CURL_READFUNC_PAUSE
)

1442 if(
code
 == 0)

1445 
ªadfûe_ªad
 = 
code
;

1449 if(!
	`PìkNamedPùe
(
°dö_h™dÀ
, 
NULL
, 0, NULL,

1450 &
ªadfûe_ªad
, 
NULL
)) {

1451 
kìp⁄
 = 
FALSE
;

1452 
code
 = 
CURLE_READ_ERROR
;

1456 if(!
ªadfûe_ªad
)

1459 if(!
	`RódFûe
(
°dö_h™dÀ
, 
buf
, (
d©a
->
°©e
.
buf„r
),

1460 &
ªadfûe_ªad
, 
NULL
)) {

1461 
kìp⁄
 = 
FALSE
;

1462 
code
 = 
CURLE_READ_ERROR
;

1467 
code
 = 
	`£nd_ã ë_d©a
(
c⁄n
, 
buf
, 
ªadfûe_ªad
);

1468 if(
code
) {

1469 
kìp⁄
 = 
FALSE
;

1476 
WAIT_OBJECT_0
 + 1:

1478 if(!
	`RódFûe
(
°dö_h™dÀ
, 
buf
, (
d©a
->
°©e
.
buf„r
),

1479 &
ªadfûe_ªad
, 
NULL
)) {

1480 
kìp⁄
 = 
FALSE
;

1481 
code
 = 
CURLE_READ_ERROR
;

1485 
code
 = 
	`£nd_ã ë_d©a
(
c⁄n
, 
buf
, 
ªadfûe_ªad
);

1486 if(
code
) {

1487 
kìp⁄
 = 
FALSE
;

1493 
WAIT_OBJECT_0
:

1495 
evíts
.
lNëw‹kEvíts
 = 0;

1496 if(
SOCKET_ERROR
 =
	`íum_√ãvíts_func
(
sockfd
, 
evít_h™dÀ
, &
evíts
)) {

1497 if((
îr
 = 
SOCKERRNO
Ë!
EINPROGRESS
) {

1498 
	`öfof
(
d©a
,"WSAEnumNëw‹kEvít†Áûed (%d)", 
îr
);

1499 
kìp⁄
 = 
FALSE
;

1500 
code
 = 
CURLE_READ_ERROR
;

1504 if(
evíts
.
lNëw‹kEvíts
 & 
FD_READ
) {

1506 
code
 = 
	`Cuæ_ªad
(
c⁄n
, 
sockfd
, 
buf
, 
BUFSIZE
 - 1, &
ƒód
);

1508 if(
code
 =
CURLE_AGAIN
)

1511 if(
code
) {

1512 
kìp⁄
 = 
FALSE
;

1517 if(
ƒód
 <= 0) {

1518 
kìp⁄
 = 
FALSE
;

1522 
code
 = 
	`ãÃcv
(
c⁄n
, (*)
buf
, 
ƒód
);

1523 if(
code
) {

1524 
kìp⁄
 = 
FALSE
;

1531 if(
ä
->
∂ó£_√gŸüã
 && !ä->
Æªady_√gŸüãd
) {

1532 
	`√gŸüã
(
c⁄n
);

1533 
ä
->
Æªady_√gŸüãd
 = 1;

1536 if(
evíts
.
lNëw‹kEvíts
 & 
FD_CLOSE
) {

1537 
kìp⁄
 = 
FALSE
;

1543 if(
d©a
->
£t
.
timeout
) {

1544 
now
 = 
	`Cuæ_tvnow
();

1545 if(
	`Cuæ_tvdiff
(
now
, 
c⁄n
->
¸óãd
Ë>
d©a
->
£t
.
timeout
) {

1546 
	`Áûf
(
d©a
, "Time-out");

1547 
code
 = 
CURLE_OPERATION_TIMEDOUT
;

1548 
kìp⁄
 = 
FALSE
;

1554 if(!
	`˛o£_evít_func
(
evít_h™dÀ
)) {

1555 
	`öfof
(
d©a
,"WSAClo£EvíàÁûed (%d)", 
SOCKERRNO
);

1559 
¸óã_evít_func
 = 
NULL
;

1560 
˛o£_evít_func
 = 
NULL
;

1561 
evít_£À˘_func
 = 
NULL
;

1562 
íum_√ãvíts_func
 = 
NULL
;

1565 if(!
	`FªeLibøry
(
wsock2
))

1566 
	`öfof
(
d©a
,"FªeLibøry(wsock2ËÁûed (%d)", 
ERRNO
);

1568 
pfd
[0].
fd
 = 
sockfd
;

1569 
pfd
[0].
evíts
 = 
POLLIN
;

1571 if(
c⁄n
->
‰ód_func
 !(
cuæ_ªad_ˇŒback
)
‰ód
) {

1572 
pﬁl_˙t
 = 1;

1573 
öãrvÆ_ms
 = 100;

1577 
pfd
[1].
fd
 = 
	`fûío
((
FILE
 *)
c⁄n
->
‰ód_ö
);

1578 
pfd
[1].
evíts
 = 
POLLIN
;

1579 
pﬁl_˙t
 = 2;

1580 
öãrvÆ_ms
 = 1 * 1000;

1583 
kìp⁄
) {

1584 
	`Cuæ_pﬁl
(
pfd
, 
pﬁl_˙t
, 
öãrvÆ_ms
)) {

1586 
kìp⁄
 = 
FALSE
;

1589 
pfd
[0].
ªvíts
 = 0;

1590 
pfd
[1].
ªvíts
 = 0;

1593 if(
pfd
[0].
ªvíts
 & 
POLLIN
) {

1595 
code
 = 
	`Cuæ_ªad
(
c⁄n
, 
sockfd
, 
buf
, 
BUFSIZE
 - 1, &
ƒód
);

1597 if(
code
 =
CURLE_AGAIN
)

1600 if(
code
) {

1601 
kìp⁄
 = 
FALSE
;

1606 if(
ƒód
 <= 0) {

1607 
kìp⁄
 = 
FALSE
;

1611 
tŸÆ_dl
 +
ƒód
;

1612 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, 
tŸÆ_dl
);

1613 
code
 = 
	`ãÃcv
(
c⁄n
, (*)
buf
, 
ƒód
);

1614 if(
code
) {

1615 
kìp⁄
 = 
FALSE
;

1622 if(
ä
->
∂ó£_√gŸüã
 && !ä->
Æªady_√gŸüãd
) {

1623 
	`√gŸüã
(
c⁄n
);

1624 
ä
->
Æªady_√gŸüãd
 = 1;

1628 
ƒód
 = 0;

1629 if(
pﬁl_˙t
 == 2) {

1630 if(
pfd
[1].
ªvíts
 & 
POLLIN
) {

1631 
ƒód
 = 
	`ªad
(
pfd
[1].
fd
, 
buf
, 
BUFSIZE
 - 1);

1636 
ƒód
 = ()
c⁄n
->
	`‰ód_func
(
buf
, 1, 
BUFSIZE
 - 1, c⁄n->
‰ód_ö
);

1637 if(
ƒód
 =
CURL_READFUNC_ABORT
) {

1638 
kìp⁄
 = 
FALSE
;

1641 if(
ƒód
 =
CURL_READFUNC_PAUSE
)

1645 if(
ƒód
 > 0) {

1646 
code
 = 
	`£nd_ã ë_d©a
(
c⁄n
, 
buf
, 
ƒód
);

1647 if(
code
) {

1648 
kìp⁄
 = 
FALSE
;

1651 
tŸÆ_ul
 +
ƒód
;

1652 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 
tŸÆ_ul
);

1654 if(
ƒód
 < 0)

1655 
kìp⁄
 = 
FALSE
;

1660 if(
d©a
->
£t
.
timeout
) {

1661 
now
 = 
	`Cuæ_tvnow
();

1662 if(
	`Cuæ_tvdiff
(
now
, 
c⁄n
->
¸óãd
Ë>
d©a
->
£t
.
timeout
) {

1663 
	`Áûf
(
d©a
, "Time-out");

1664 
code
 = 
CURLE_OPERATION_TIMEDOUT
;

1665 
kìp⁄
 = 
FALSE
;

1669 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
)) {

1670 
code
 = 
CURLE_ABORTED_BY_CALLBACK
;

1676 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

1678  
code
;

1679 
	}
}

	@lib/telnet.h

1 #i‚de‡
HEADER_CURL_TELNET_H


2 
	#HEADER_CURL_TELNET_H


	)

24 #i‚de‡
CURL_DISABLE_TELNET


25 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_ã ë
;

	@lib/tftp.c

23 
	~"cuæ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_TFTP


27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

30 #ifde‡
HAVE_NETDB_H


31 
	~<√tdb.h
>

33 #ifde‡
HAVE_ARPA_INET_H


34 
	~<¨∑/öë.h
>

36 #ifde‡
HAVE_NET_IF_H


37 
	~<√t/if.h
>

39 #ifde‡
HAVE_SYS_IOCTL_H


40 
	~<sys/io˘l.h
>

43 #ifde‡
HAVE_SYS_PARAM_H


44 
	~<sys/∑øm.h
>

47 
	~"uæd©a.h
"

48 
	~<cuæ/cuæ.h
>

49 
	~"å™s„r.h
"

50 
	~"£ndf.h
"

51 
	~"t·p.h
"

52 
	~"¥ogªss.h
"

53 
	~"c⁄√˘.h
"

54 
	~"°ªº‹.h
"

55 
	~"sockaddr.h
"

56 
	~"mu…iif.h
"

57 
	~"uæ.h
"

58 
	~"øw°r.h
"

59 
	~"•ìdcheck.h
"

61 
	#_MPRINTF_REPLACE


	)

62 
	~<cuæ/m¥ötf.h
>

64 
	~"cuæ_mem‹y.h
"

65 
	~"£À˘.h
"

68 
	~"memdebug.h
"

71 
	#TFTP_BLKSIZE_DEFAULT
 512

	)

72 
	#TFTP_BLKSIZE_MIN
 8

	)

73 
	#TFTP_BLKSIZE_MAX
 65464

	)

74 
	#TFTP_OPTION_BLKSIZE
 "blksize"

	)

77 
	#TFTP_OPTION_TSIZE
 "tsize"

	)

78 
	#TFTP_OPTION_INTERVAL
 "timeout"

	)

81 
	mTFTP_MODE_NETASCII
=0,

82 
	mTFTP_MODE_OCTET


83 } 
	tt·p_mode_t
;

86 
	mTFTP_STATE_START
=0,

87 
	mTFTP_STATE_RX
,

88 
	mTFTP_STATE_TX
,

89 
	mTFTP_STATE_FIN


90 } 
	tt·p_°©e_t
;

93 
	mTFTP_EVENT_NONE
 = -1,

94 
	mTFTP_EVENT_INIT
 = 0,

95 
	mTFTP_EVENT_RRQ
 = 1,

96 
	mTFTP_EVENT_WRQ
 = 2,

97 
	mTFTP_EVENT_DATA
 = 3,

98 
	mTFTP_EVENT_ACK
 = 4,

99 
	mTFTP_EVENT_ERROR
 = 5,

100 
	mTFTP_EVENT_OACK
 = 6,

101 
	mTFTP_EVENT_TIMEOUT


102 } 
	tt·p_evít_t
;

105 
	mTFTP_ERR_UNDEF
=0,

106 
	mTFTP_ERR_NOTFOUND
,

107 
	mTFTP_ERR_PERM
,

108 
	mTFTP_ERR_DISKFULL
,

109 
	mTFTP_ERR_ILLEGAL
,

110 
	mTFTP_ERR_UNKNOWNID
,

111 
	mTFTP_ERR_EXISTS
,

112 
	mTFTP_ERR_NOSUCHUSER
,

115 
	mTFTP_ERR_NONE
 = -100,

116 
	mTFTP_ERR_TIMEOUT
,

117 
	mTFTP_ERR_NORESPONSE


118 } 
	tt·p_îr‹_t
;

120 
	st·p_∑ckë
 {

121 *
	md©a
;

122 } 
	tt·p_∑ckë_t
;

124 
	st·p_°©e_d©a
 {

125 
t·p_°©e_t
 
	m°©e
;

126 
t·p_mode_t
 
	mmode
;

127 
t·p_îr‹_t
 
	mîr‹
;

128 
t·p_evít_t
 
	mevít
;

129 
c⁄√˘d©a
 *
	mc⁄n
;

130 
cuæ_sockë_t
 
	msockfd
;

131 
	mªåõs
;

132 
	mªåy_time
;

133 
	mªåy_max
;

134 
time_t
 
	m°¨t_time
;

135 
time_t
 
	mmax_time
;

136 
time_t
 
	mrx_time
;

137 
	mblock
;

138 
Cuæ_sockaddr_°‹age
 
	mloˇl_addr
;

139 
Cuæ_sockaddr_°‹age
 
	mªmŸe_addr
;

140 
cuæ_sockÀn_t
 
	mªmŸe_addæí
;

141 
	mrbyãs
;

142 
	msbyãs
;

143 
	mblksize
;

144 
	mªque°ed_blksize
;

145 
t·p_∑ckë_t
 
	mΩackë
;

146 
t·p_∑ckë_t
 
	m•ackë
;

147 } 
	tt·p_°©e_d©a_t
;

151 
CURLcode
 
t·p_rx
(
t·p_°©e_d©a_t
 *
°©e
, 
t·p_evít_t
 
evít
) ;

152 
CURLcode
 
t·p_tx
(
t·p_°©e_d©a_t
 *
°©e
, 
t·p_evít_t
 
evít
) ;

153 
CURLcode
 
t·p_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

154 
CURLcode
 
t·p_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

155 
boﬁ
 
dód_c⁄√˘i⁄
);

156 
CURLcode
 
t·p_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

157 
CURLcode
 
t·p_d⁄e
(
c⁄√˘d©a
 *
c⁄n
,

158 
CURLcode
, 
boﬁ
 
¥em©uª
);

159 
CURLcode
 
t·p_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 * 
c⁄n
);

160 
CURLcode
 
t·p_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

161 
CURLcode
 
t·p_doög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d›ha£_d⁄e
);

162 
t·p_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

163 
numsocks
);

164 
CURLcode
 
t·p_å™¶©e_code
(
t·p_îr‹_t
 
îr‹
);

171 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_t·p
 = {

173 
t·p_£tup_c⁄√˘i⁄
,

174 
t·p_do
,

175 
t·p_d⁄e
,

176 
ZERO_NULL
,

177 
t·p_c⁄√˘
,

178 
t·p_mu…i_°©emach
,

179 
t·p_doög
,

180 
t·p_gësock
,

181 
t·p_gësock
,

182 
ZERO_NULL
,

183 
ZERO_NULL
,

184 
t·p_disc⁄√˘
,

185 
ZERO_NULL
,

186 
PORT_TFTP
,

187 
CURLPROTO_TFTP
,

188 
PROTOPT_NONE
 | 
PROTOPT_NOURLQUERY


201 
CURLcode
 
	$t·p_£t_timeouts
(
t·p_°©e_d©a_t
 *
°©e
)

203 
time_t
 
maxtime
, 
timeout
;

204 
timeout_ms
;

205 
boﬁ
 
°¨t
 = (
°©e
->°©ê=
TFTP_STATE_START
Ë? 
TRUE
 : 
FALSE
;

207 
	`time
(&
°©e
->
°¨t_time
);

210 
timeout_ms
 = 
	`Cuæ_timñe·
(
°©e
->
c⁄n
->
d©a
, 
NULL
, 
°¨t
);

212 if(
timeout_ms
 < 0) {

214 
	`Áûf
(
°©e
->
c⁄n
->
d©a
, "ConnectionÅime-out");

215  
CURLE_OPERATION_TIMEDOUT
;

218 if(
°¨t
) {

220 
maxtime
 = (
time_t
)(
timeout_ms
 + 500) / 1000;

221 
°©e
->
max_time
 = sèã->
°¨t_time
+
maxtime
;

224 
timeout
 = 
maxtime
 ;

227 
°©e
->
ªåy_max
 = ()
timeout
/5;

229 if(
°©e
->
ªåy_max
 < 1)

231 
°©e
->
ªåy_max
 = 1;

234 
°©e
->
ªåy_time
 = ()
timeout
/°©e->
ªåy_max
;

235 if(
°©e
->
ªåy_time
<1)

236 
°©e
->
ªåy_time
=1;

240 if(
timeout_ms
 > 0)

241 
maxtime
 = (
time_t
)(
timeout_ms
 + 500) / 1000;

243 
maxtime
 = 3600;

245 
°©e
->
max_time
 = sèã->
°¨t_time
+
maxtime
;

248 
timeout
 = 
maxtime
;

251 
°©e
->
ªåy_max
 = ()
timeout
/5;

254 if(
°©e
->
ªåy_max
<3)

255 
°©e
->
ªåy_max
=3;

257 if(
°©e
->
ªåy_max
>50)

258 
°©e
->
ªåy_max
=50;

261 
°©e
->
ªåy_time
 = ()(
timeout
/°©e->
ªåy_max
);

262 if(
°©e
->
ªåy_time
<1)

263 
°©e
->
ªåy_time
=1;

265 
	`öfof
(
°©e
->
c⁄n
->
d©a
,

267 ()
°©e
->°©e, ()(°©e->
max_time
-°©e->
°¨t_time
),

268 
°©e
->
ªåy_time
, sèã->
ªåy_max
);

271 
	`time
(&
°©e
->
rx_time
);

273  
CURLE_OK
;

274 
	}
}

284 
	$£çackëevít
(
t·p_∑ckë_t
 *
∑ckë
, 
num
)

286 
∑ckë
->
d©a
[0] = ()(
num
 >> 8);

287 
∑ckë
->
d©a
[1] = ()(
num
 & 0xff);

288 
	}
}

291 
	$£çackëblock
(
t·p_∑ckë_t
 *
∑ckë
, 
num
)

293 
∑ckë
->
d©a
[2] = ()(
num
 >> 8);

294 
∑ckë
->
d©a
[3] = ()(
num
 & 0xff);

295 
	}
}

297 
	$gëΩackëevít
(c⁄° 
t·p_∑ckë_t
 *
∑ckë
)

299  ()((
∑ckë
->
d©a
[0] << 8) |Öacket->data[1]);

300 
	}
}

302 
	$gëΩackëblock
(c⁄° 
t·p_∑ckë_t
 *
∑ckë
)

304  ()((
∑ckë
->
d©a
[2] << 8) |Öacket->data[3]);

305 
	}
}

307 
size_t
 
	$Cuæ_°∫Àn
(c⁄° *
°rög
, 
size_t
 
maxÀn
)

309 c⁄° *
íd
 = 
	`memchr
 (
°rög
, '\0', 
maxÀn
);

310  
íd
 ? (
size_t
Ë”nd - 
°rög
Ë: 
maxÀn
;

311 
	}
}

313 c⁄° *
	$t·p_›ti⁄_gë
(c⁄° *
buf
, 
size_t
 
Àn
,

314 c⁄° **
›ti⁄
, c⁄° **
vÆue
)

316 
size_t
 
loc
;

318 
loc
 = 
	`Cuæ_°∫Àn
–
buf
, 
Àn
 );

319 
loc
++;

321 if(
loc
 >
Àn
)

322  
NULL
;

323 *
›ti⁄
 = 
buf
;

325 
loc
 +
	`Cuæ_°∫Àn
–
buf
+loc, 
Àn
-loc );

326 
loc
++;

328 if(
loc
 > 
Àn
)

329  
NULL
;

330 *
vÆue
 = &
buf
[
	`°æí
(*
›ti⁄
) + 1];

332  &
buf
[
loc
];

333 
	}
}

335 
CURLcode
 
	$t·p_∑r£_›ti⁄_ack
(
t·p_°©e_d©a_t
 *
°©e
,

336 c⁄° *
±r
, 
Àn
)

338 c⁄° *
tmp
 = 
±r
;

339 
Sessi⁄H™dÀ
 *
d©a
 = 
°©e
->
c⁄n
->data;

342 
°©e
->
blksize
 = 
TFTP_BLKSIZE_DEFAULT
;

344 
tmp
 < 
±r
 + 
Àn
) {

345 c⁄° *
›ti⁄
, *
vÆue
;

347 
tmp
 = 
	`t·p_›ti⁄_gë
—mp, 
±r
 + 
Àn
 -Åmp, &
›ti⁄
, &
vÆue
);

348 if(
tmp
 =
NULL
) {

349 
	`Áûf
(
d©a
, "Malformed ACKÖacket,Ñejecting");

350  
CURLE_TFTP_ILLEGAL
;

353 
	`öfof
(
d©a
, "gŸ o±i⁄=(%sËvÆue=(%s)\n", 
›ti⁄
, 
vÆue
);

355 if(
	`check¥efix
(
›ti⁄
, 
TFTP_OPTION_BLKSIZE
)) {

356 
blksize
;

358 
blksize
 = 
	`°πﬁ
–
vÆue
, 
NULL
, 10 );

360 if(!
blksize
) {

361 
	`Áûf
(
d©a
, "invalid blocksize value in OACKÖacket");

362  
CURLE_TFTP_ILLEGAL
;

364 if(
blksize
 > 
TFTP_BLKSIZE_MAX
) {

365 
	`Áûf
(
d©a
, "%s (%d)", "blksize isÜargerÅhan max supported",

366 
TFTP_BLKSIZE_MAX
);

367  
CURLE_TFTP_ILLEGAL
;

369 if(
blksize
 < 
TFTP_BLKSIZE_MIN
) {

370 
	`Áûf
(
d©a
, "%s (%d)", "blksize is smallerÅhan min supported",

371 
TFTP_BLKSIZE_MIN
);

372  
CURLE_TFTP_ILLEGAL
;

374 if(
blksize
 > 
°©e
->
ªque°ed_blksize
) {

378 
	`Áûf
(
d©a
, "%s (%ld)",

379 "£rvîÑeque°ed blksizêœrgîÅh™áŒoˇãd", 
blksize
);

380  
CURLE_TFTP_ILLEGAL
;

383 
°©e
->
blksize
 = ()blksize;

384 
	`öfof
(
d©a
, "%s (%d) %s (%d)\n", "blksizeÖarsed from OACK",

385 
°©e
->
blksize
, "ªque°ed", sèã->
ªque°ed_blksize
);

387 if(
	`check¥efix
(
›ti⁄
, 
TFTP_OPTION_TSIZE
)) {

388 
tsize
 = 0;

390 
tsize
 = 
	`°πﬁ
–
vÆue
, 
NULL
, 10 );

391 
	`öfof
(
d©a
, "%†(%ld)\n", "tsizê∑r£d from OACK", 
tsize
);

395 if(!
d©a
->
£t
.
u∂ﬂd
) {

396 if(!
tsize
) {

397 
	`Áûf
(
d©a
, "övÆidÅsizê-:%s:- vÆuêö OACKÖackë", 
vÆue
);

398  
CURLE_TFTP_ILLEGAL
;

400 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
tsize
);

405  
CURLE_OK
;

406 
	}
}

408 
size_t
 
	$t·p_›ti⁄_add
(
t·p_°©e_d©a_t
 *
°©e
, 
size_t
 
csize
,

409 *
buf
, c⁄° *
›ti⁄
)

411 if(–
	`°æí
(
›ti⁄
Ë+ 
csize
 + 1 ) > (
size_t
)
°©e
->
blksize
)

413 
	`°r˝y
(
buf
, 
›ti⁄
);

414 –
	`°æí
(
›ti⁄
) + 1 );

415 
	}
}

417 
CURLcode
 
	$t·p_c⁄√˘_f‹_tx
(
t·p_°©e_d©a_t
 *
°©e
,

418 
t·p_evít_t
 
evít
)

420 
CURLcode
 
ªs
;

421 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


422 
Sessi⁄H™dÀ
 *
d©a
 = 
°©e
->
c⁄n
->data;

424 
	`öfof
(
d©a
, "%s\n", "Connected forÅransmit");

426 
°©e
->°©ê
TFTP_STATE_TX
;

427 
ªs
 = 
	`t·p_£t_timeouts
(
°©e
);

428 if(
ªs
 !
CURLE_OK
)

429 (
ªs
);

430  
	`t·p_tx
(
°©e
, 
evít
);

431 
	}
}

433 
CURLcode
 
	$t·p_c⁄√˘_f‹_rx
(
t·p_°©e_d©a_t
 *
°©e
,

434 
t·p_evít_t
 
evít
)

436 
CURLcode
 
ªs
;

437 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


438 
Sessi⁄H™dÀ
 *
d©a
 = 
°©e
->
c⁄n
->data;

440 
	`öfof
(
d©a
, "%s\n", "Connected forÑeceive");

442 
°©e
->°©ê
TFTP_STATE_RX
;

443 
ªs
 = 
	`t·p_£t_timeouts
(
°©e
);

444 if(
ªs
 !
CURLE_OK
)

445 (
ªs
);

446  
	`t·p_rx
(
°©e
, 
evít
);

447 
	}
}

449 
CURLcode
 
	$t·p_£nd_fú°
(
t·p_°©e_d©a_t
 *
°©e
, 
t·p_evít_t
 
evít
)

451 
size_t
 
sbyãs
;

452 
ssize_t
 
£ndd©a
;

453 c⁄° *
mode
 = "octet";

454 *
fûíame
;

455 
buf
[64];

456 
Sessi⁄H™dÀ
 *
d©a
 = 
°©e
->
c⁄n
->data;

457 
CURLcode
 
ªs
 = 
CURLE_OK
;

460 if(
d©a
->
£t
.
¥e„r_ascii
)

461 
mode
 = "netascii";

463 
evít
) {

465 
TFTP_EVENT_INIT
:

466 
TFTP_EVENT_TIMEOUT
:

468 
°©e
->
ªåõs
++;

469 if(
°©e
->
ªåõs
>°©e->
ªåy_max
) {

470 
°©e
->
îr‹
 = 
TFTP_ERR_NORESPONSE
;

471 
°©e
->°©ê
TFTP_STATE_FIN
;

472  
ªs
;

475 if(
d©a
->
£t
.
u∂ﬂd
) {

477 
	`£çackëevít
(&
°©e
->
•ackë
, 
TFTP_EVENT_WRQ
);

478 
°©e
->
c⁄n
->
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 =

479 (*)
°©e
->
•ackë
.
d©a
+4;

480 if(
d©a
->
°©e
.
öfûesize
 != -1)

481 
	`Cuæ_pgrsSëU∂ﬂdSize
(
d©a
, d©a->
°©e
.
öfûesize
);

485 
	`£çackëevít
(&
°©e
->
•ackë
, 
TFTP_EVENT_RRQ
);

490 
fûíame
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
, &
°©e
->
c⁄n
->d©a->°©e.
∑th
[1], 0,

491 
NULL
);

492 if(!
fûíame
)

493  
CURLE_OUT_OF_MEMORY
;

495 
	`¢¥ötf
((*)
°©e
->
•ackë
.
d©a
+2,

496 
°©e
->
blksize
,

497 "%s%c%s%c", 
fûíame
, '\0', 
mode
, '\0');

498 
sbyãs
 = 4 + 
	`°æí
(
fûíame
Ë+ såÀn(
mode
);

501 if(
d©a
->
£t
.
u∂ﬂd
 && (d©a->
°©e
.
öfûesize
 != -1))

502 
	`¢¥ötf
(
buf
, (buf), "%" 
CURL_FORMAT_CURL_OFF_T
,

503 
d©a
->
°©e
.
öfûesize
);

505 
	`°r˝y
(
buf
, "0");

507 
sbyãs
 +
	`t·p_›ti⁄_add
(
°©e
, sbytes,

508 (*)
°©e
->
•ackë
.
d©a
+
sbyãs
,

509 
TFTP_OPTION_TSIZE
);

510 
sbyãs
 +
	`t·p_›ti⁄_add
(
°©e
, sbytes,

511 (*)
°©e
->
•ackë
.
d©a
+
sbyãs
, 
buf
);

513 
	`¢¥ötf
–
buf
, (buf), "%d", 
°©e
->
ªque°ed_blksize
 );

514 
sbyãs
 +
	`t·p_›ti⁄_add
(
°©e
, sbytes,

515 (*)
°©e
->
•ackë
.
d©a
+
sbyãs
,

516 
TFTP_OPTION_BLKSIZE
);

517 
sbyãs
 +
	`t·p_›ti⁄_add
(
°©e
, sbytes,

518 (*)
°©e
->
•ackë
.
d©a
+
sbyãs
, 
buf
 );

521 
	`¢¥ötf
–
buf
, (buf), "%d", 
°©e
->
ªåy_time
);

522 
sbyãs
 +
	`t·p_›ti⁄_add
(
°©e
, sbytes,

523 (*)
°©e
->
•ackë
.
d©a
+
sbyãs
,

524 
TFTP_OPTION_INTERVAL
);

525 
sbyãs
 +
	`t·p_›ti⁄_add
(
°©e
, sbytes,

526 (*)
°©e
->
•ackë
.
d©a
+
sbyãs
, 
buf
 );

530 
£ndd©a
 = 
	`£ndto
(
°©e
->
sockfd
, (*)°©e->
•ackë
.
d©a
,

531 (
SEND_TYPE_ARG3
)
sbyãs
, 0,

532 
°©e
->
c⁄n
->
ù_addr
->
ai_addr
,

533 
°©e
->
c⁄n
->
ù_addr
->
ai_addæí
);

534 if(
£ndd©a
 !(
ssize_t
)
sbyãs
) {

535 
	`Áûf
(
d©a
, "%s", 
	`Cuæ_°ªº‹
(
°©e
->
c⁄n
, 
SOCKERRNO
));

537 
	`Cuæ_ß„‰ì
(
fûíame
);

540 
TFTP_EVENT_OACK
:

541 if(
d©a
->
£t
.
u∂ﬂd
) {

542 
ªs
 = 
	`t·p_c⁄√˘_f‹_tx
(
°©e
, 
evít
);

545 
ªs
 = 
	`t·p_c⁄√˘_f‹_rx
(
°©e
, 
evít
);

549 
TFTP_EVENT_ACK
:

550 
ªs
 = 
	`t·p_c⁄√˘_f‹_tx
(
°©e
, 
evít
);

553 
TFTP_EVENT_DATA
:

554 
ªs
 = 
	`t·p_c⁄√˘_f‹_rx
(
°©e
, 
evít
);

557 
TFTP_EVENT_ERROR
:

558 
°©e
->°©ê
TFTP_STATE_FIN
;

562 
	`Áûf
(
°©e
->
c⁄n
->
d©a
, "tftp_send_first: internalÉrror");

565  
ªs
;

566 
	}
}

570 
	#NEXT_BLOCKNUM
(
x
Ë(((x)+1)&0xffff)

	)

579 
CURLcode
 
	$t·p_rx
(
t·p_°©e_d©a_t
 *
°©e
, 
t·p_evít_t
 
evít
)

581 
ssize_t
 
sbyãs
;

582 
rblock
;

583 
Sessi⁄H™dÀ
 *
d©a
 = 
°©e
->
c⁄n
->data;

585 
evít
) {

587 
TFTP_EVENT_DATA
:

589 
rblock
 = 
	`gëΩackëblock
(&
°©e
->
Ωackë
);

590 if(
	`NEXT_BLOCKNUM
(
°©e
->
block
Ë=
rblock
) {

592 
°©e
->
ªåõs
 = 0;

594 if(
°©e
->
block
 =
rblock
) {

597 
	`öfof
(
d©a
, "Re˚ivedÜa° DATAÖackë block %dágaö.\n", 
rblock
);

601 
	`öfof
(
d©a
,

603 
rblock
, 
	`NEXT_BLOCKNUM
(
°©e
->
block
));

608 
°©e
->
block
 = ()
rblock
;

609 
	`£çackëevít
(&
°©e
->
•ackë
, 
TFTP_EVENT_ACK
);

610 
	`£çackëblock
(&
°©e
->
•ackë
, sèã->
block
);

611 
sbyãs
 = 
	`£ndto
(
°©e
->
sockfd
, (*)°©e->
•ackë
.
d©a
,

612 4, 
SEND_4TH_ARG
,

613 (
sockaddr
 *)&
°©e
->
ªmŸe_addr
,

614 
°©e
->
ªmŸe_addæí
);

615 if(
sbyãs
 < 0) {

616 
	`Áûf
(
d©a
, "%s", 
	`Cuæ_°ªº‹
(
°©e
->
c⁄n
, 
SOCKERRNO
));

617  
CURLE_SEND_ERROR
;

621 if(
°©e
->
rbyãs
 < (
ssize_t
)°©e->
blksize
+4) {

622 
°©e
->°©ê
TFTP_STATE_FIN
;

625 
°©e
->°©ê
TFTP_STATE_RX
;

627 
	`time
(&
°©e
->
rx_time
);

630 
TFTP_EVENT_OACK
:

632 
°©e
->
block
 = 0;

633 
°©e
->
ªåõs
 = 0;

634 
	`£çackëevít
(&
°©e
->
•ackë
, 
TFTP_EVENT_ACK
);

635 
	`£çackëblock
(&
°©e
->
•ackë
, sèã->
block
);

636 
sbyãs
 = 
	`£ndto
(
°©e
->
sockfd
, (*)°©e->
•ackë
.
d©a
,

637 4, 
SEND_4TH_ARG
,

638 (
sockaddr
 *)&
°©e
->
ªmŸe_addr
,

639 
°©e
->
ªmŸe_addæí
);

640 if(
sbyãs
 < 0) {

641 
	`Áûf
(
d©a
, "%s", 
	`Cuæ_°ªº‹
(
°©e
->
c⁄n
, 
SOCKERRNO
));

642  
CURLE_SEND_ERROR
;

646 
°©e
->°©ê
TFTP_STATE_RX
;

647 
	`time
(&
°©e
->
rx_time
);

650 
TFTP_EVENT_TIMEOUT
:

652 
°©e
->
ªåõs
++;

653 
	`öfof
(
d©a
,

655 
	`NEXT_BLOCKNUM
(
°©e
->
block
), sèã->
ªåõs
);

656 if(
°©e
->
ªåõs
 > sèã->
ªåy_max
) {

657 
°©e
->
îr‹
 = 
TFTP_ERR_TIMEOUT
;

658 
°©e
->°©ê
TFTP_STATE_FIN
;

662 
sbyãs
 = 
	`£ndto
(
°©e
->
sockfd
, (*)°©e->
•ackë
.
d©a
,

663 4, 
SEND_4TH_ARG
,

664 (
sockaddr
 *)&
°©e
->
ªmŸe_addr
,

665 
°©e
->
ªmŸe_addæí
);

666 if(
sbyãs
<0) {

667 
	`Áûf
(
d©a
, "%s", 
	`Cuæ_°ªº‹
(
°©e
->
c⁄n
, 
SOCKERRNO
));

668  
CURLE_SEND_ERROR
;

673 
TFTP_EVENT_ERROR
:

674 
	`£çackëevít
(&
°©e
->
•ackë
, 
TFTP_EVENT_ERROR
);

675 
	`£çackëblock
(&
°©e
->
•ackë
, sèã->
block
);

676 ()
	`£ndto
(
°©e
->
sockfd
, (*)°©e->
•ackë
.
d©a
,

677 4, 
SEND_4TH_ARG
,

678 (
sockaddr
 *)&
°©e
->
ªmŸe_addr
,

679 
°©e
->
ªmŸe_addæí
);

682 
°©e
->°©ê
TFTP_STATE_FIN
;

686 
	`Áûf
(
d©a
, "%s", "tftp_rx: internalÉrror");

687  
CURLE_TFTP_ILLEGAL
;

690  
CURLE_OK
;

691 
	}
}

700 
CURLcode
 
	$t·p_tx
(
t·p_°©e_d©a_t
 *
°©e
, 
t·p_evít_t
 
evít
)

702 
Sessi⁄H™dÀ
 *
d©a
 = 
°©e
->
c⁄n
->data;

703 
ssize_t
 
sbyãs
;

704 
rblock
;

705 
CURLcode
 
ªs
 = 
CURLE_OK
;

706 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

708 
evít
) {

710 
TFTP_EVENT_ACK
:

711 
TFTP_EVENT_OACK
:

712 if(
evít
 =
TFTP_EVENT_ACK
) {

714 
rblock
 = 
	`gëΩackëblock
(&
°©e
->
Ωackë
);

716 if(
rblock
 !
°©e
->
block
 &&

722 !(
°©e
->
block
 =0 && 
rblock
 == 65535)) {

724 
	`öfof
(
d©a
, "Received ACK for block %d,Éxpecting %d\n",

725 
rblock
, 
°©e
->
block
);

726 
°©e
->
ªåõs
++;

728 if(
°©e
->
ªåõs
>°©e->
ªåy_max
) {

729 
	`Áûf
(
d©a
, "tftp_tx: giving up waiting for block %dáck",

730 
°©e
->
block
);

731 
ªs
 = 
CURLE_SEND_ERROR
;

735 
sbyãs
 = 
	`£ndto
(
°©e
->
sockfd
, (*)°©e->
•ackë
.
d©a
,

736 4+
°©e
->
sbyãs
, 
SEND_4TH_ARG
,

737 (
sockaddr
 *)&
°©e
->
ªmŸe_addr
,

738 
°©e
->
ªmŸe_addæí
);

740 if(
sbyãs
<0) {

741 
	`Áûf
(
d©a
, "%s", 
	`Cuæ_°ªº‹
(
°©e
->
c⁄n
, 
SOCKERRNO
));

742 
ªs
 = 
CURLE_SEND_ERROR
;

745  
ªs
;

749 
	`time
(&
°©e
->
rx_time
);

750 
°©e
->
block
++;

753 
°©e
->
block
 = 1;

755 
°©e
->
ªåõs
 = 0;

756 
	`£çackëevít
(&
°©e
->
•ackë
, 
TFTP_EVENT_DATA
);

757 
	`£çackëblock
(&
°©e
->
•ackë
, sèã->
block
);

758 if(
°©e
->
block
 > 1 && sèã->
sbyãs
 < ()°©e->
blksize
) {

759 
°©e
->°©ê
TFTP_STATE_FIN
;

760  
CURLE_OK
;

762 
ªs
 = 
	`Cuæ_fûÃódbuf„r
(
°©e
->
c⁄n
, sèã->
blksize
, &°©e->
sbyãs
);

763 if(
ªs
)

764  
ªs
;

765 
sbyãs
 = 
	`£ndto
(
°©e
->
sockfd
, (*)°©e->
•ackë
.
d©a
,

766 4+
°©e
->
sbyãs
, 
SEND_4TH_ARG
,

767 (
sockaddr
 *)&
°©e
->
ªmŸe_addr
,

768 
°©e
->
ªmŸe_addæí
);

770 if(
sbyãs
<0) {

771 
	`Áûf
(
d©a
, "%s", 
	`Cuæ_°ªº‹
(
°©e
->
c⁄n
, 
SOCKERRNO
));

772  
CURLE_SEND_ERROR
;

775 
k
->
wrôebyãcou¡
 +
°©e
->
sbyãs
;

776 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 
k
->
wrôebyãcou¡
);

779 
TFTP_EVENT_TIMEOUT
:

781 
°©e
->
ªåõs
++;

782 
	`öfof
(
d©a
, "Timeout waiting for block %d ACK. "

783 " Rërõ†%d\n", 
	`NEXT_BLOCKNUM
(
°©e
->
block
), sèã->
ªåõs
);

785 if(
°©e
->
ªåõs
 > sèã->
ªåy_max
) {

786 
°©e
->
îr‹
 = 
TFTP_ERR_TIMEOUT
;

787 
°©e
->°©ê
TFTP_STATE_FIN
;

791 
sbyãs
 = 
	`£ndto
(
°©e
->
sockfd
, (*)°©e->
•ackë
.
d©a
,

792 4+
°©e
->
sbyãs
, 
SEND_4TH_ARG
,

793 (
sockaddr
 *)&
°©e
->
ªmŸe_addr
,

794 
°©e
->
ªmŸe_addæí
);

796 if(
sbyãs
<0) {

797 
	`Áûf
(
d©a
, "%s", 
	`Cuæ_°ªº‹
(
°©e
->
c⁄n
, 
SOCKERRNO
));

798  
CURLE_SEND_ERROR
;

801 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 
k
->
wrôebyãcou¡
);

805 
TFTP_EVENT_ERROR
:

806 
°©e
->°©ê
TFTP_STATE_FIN
;

807 
	`£çackëevít
(&
°©e
->
•ackë
, 
TFTP_EVENT_ERROR
);

808 
	`£çackëblock
(&
°©e
->
•ackë
, sèã->
block
);

809 ()
	`£ndto
(
°©e
->
sockfd
, (*)°©e->
•ackë
.
d©a
, 4, 
SEND_4TH_ARG
,

810 (
sockaddr
 *)&
°©e
->
ªmŸe_addr
,

811 
°©e
->
ªmŸe_addæí
);

814 
°©e
->°©ê
TFTP_STATE_FIN
;

818 
	`Áûf
(
d©a
, "t·p_tx: i¡î«»îr‹,Évít: %i", ()(
evít
));

822  
ªs
;

823 
	}
}

832 
CURLcode
 
	$t·p_å™¶©e_code
(
t·p_îr‹_t
 
îr‹
)

834 
CURLcode
 
code
 = 
CURLE_OK
;

836 if(
îr‹
 !
TFTP_ERR_NONE
) {

837 
îr‹
) {

838 
TFTP_ERR_NOTFOUND
:

839 
code
 = 
CURLE_TFTP_NOTFOUND
;

841 
TFTP_ERR_PERM
:

842 
code
 = 
CURLE_TFTP_PERM
;

844 
TFTP_ERR_DISKFULL
:

845 
code
 = 
CURLE_REMOTE_DISK_FULL
;

847 
TFTP_ERR_UNDEF
:

848 
TFTP_ERR_ILLEGAL
:

849 
code
 = 
CURLE_TFTP_ILLEGAL
;

851 
TFTP_ERR_UNKNOWNID
:

852 
code
 = 
CURLE_TFTP_UNKNOWNID
;

854 
TFTP_ERR_EXISTS
:

855 
code
 = 
CURLE_REMOTE_FILE_EXISTS
;

857 
TFTP_ERR_NOSUCHUSER
:

858 
code
 = 
CURLE_TFTP_NOSUCHUSER
;

860 
TFTP_ERR_TIMEOUT
:

861 
code
 = 
CURLE_OPERATION_TIMEDOUT
;

863 
TFTP_ERR_NORESPONSE
:

864 
code
 = 
CURLE_COULDNT_CONNECT
;

867 
code

CURLE_ABORTED_BY_CALLBACK
;

872 
code
 = 
CURLE_OK
;

875 (
code
);

876 
	}
}

885 
CURLcode
 
	$t·p_°©e_machöe
(
t·p_°©e_d©a_t
 *
°©e
,

886 
t·p_evít_t
 
evít
)

888 
CURLcode
 
ªs
 = 
CURLE_OK
;

889 
Sessi⁄H™dÀ
 *
d©a
 = 
°©e
->
c⁄n
->data;

890 
°©e
->state) {

891 
TFTP_STATE_START
:

892 
	`DEBUGF
(
	`öfof
(
d©a
, "TFTP_STATE_START\n"));

893 
ªs
 = 
	`t·p_£nd_fú°
(
°©e
, 
evít
);

895 
TFTP_STATE_RX
:

896 
	`DEBUGF
(
	`öfof
(
d©a
, "TFTP_STATE_RX\n"));

897 
ªs
 = 
	`t·p_rx
(
°©e
, 
evít
);

899 
TFTP_STATE_TX
:

900 
	`DEBUGF
(
	`öfof
(
d©a
, "TFTP_STATE_TX\n"));

901 
ªs
 = 
	`t·p_tx
(
°©e
, 
evít
);

903 
TFTP_STATE_FIN
:

904 
	`öfof
(
d©a
, "%s\n", "TFTP finished");

907 
	`DEBUGF
(
	`öfof
(
d©a
, "STATE: %d\n", 
°©e
->state));

908 
	`Áûf
(
d©a
, "%s", "Internal state machineÉrror");

909 
ªs
 = 
CURLE_TFTP_ILLEGAL
;

912  
ªs
;

913 
	}
}

922 
CURLcode
 
	$t·p_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
)

924 
t·p_°©e_d©a_t
 *
°©e
 = 
c⁄n
->
¥Ÿo
.
t·pc
;

925 (Ë
dód_c⁄√˘i⁄
;

928 if(
°©e
) {

929 
	`Cuæ_ß„‰ì
(
°©e
->
Ωackë
.
d©a
);

930 
	`Cuæ_ß„‰ì
(
°©e
->
•ackë
.
d©a
);

931 
	`‰ì
(
°©e
);

934  
CURLE_OK
;

935 
	}
}

944 
CURLcode
 
	$t·p_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

946 
CURLcode
 
code
;

947 
t·p_°©e_d©a_t
 *
°©e
;

948 
blksize
, 
rc
;

950 
blksize
 = 
TFTP_BLKSIZE_DEFAULT
;

952 
°©e
 = 
c⁄n
->
¥Ÿo
.
t·pc
 = 
	`ˇŒoc
(1, (
t·p_°©e_d©a_t
));

953 if(!
°©e
)

954  
CURLE_OUT_OF_MEMORY
;

957 if(
c⁄n
->
d©a
->
£t
.
t·p_blksize
) {

958 
blksize
 = ()
c⁄n
->
d©a
->
£t
.
t·p_blksize
;

959 if(
blksize
 > 
TFTP_BLKSIZE_MAX
 || blksizê< 
TFTP_BLKSIZE_MIN
 )

960  
CURLE_TFTP_ILLEGAL
;

963 if(!
°©e
->
Ωackë
.
d©a
) {

964 
°©e
->
Ωackë
.
d©a
 = 
	`ˇŒoc
(1, 
blksize
 + 2 + 2);

966 if(!
°©e
->
Ωackë
.
d©a
)

967  
CURLE_OUT_OF_MEMORY
;

970 if(!
°©e
->
•ackë
.
d©a
) {

971 
°©e
->
•ackë
.
d©a
 = 
	`ˇŒoc
(1, 
blksize
 + 2 + 2);

973 if(!
°©e
->
•ackë
.
d©a
)

974  
CURLE_OUT_OF_MEMORY
;

979 
	`c⁄n˛o£
(
c⁄n
, "TFTP");

981 
°©e
->
c⁄n
 = conn;

982 
°©e
->
sockfd
 = sèã->
c⁄n
->
sock
[
FIRSTSOCKET
];

983 
°©e
->°©ê
TFTP_STATE_START
;

984 
°©e
->
îr‹
 = 
TFTP_ERR_NONE
;

985 
°©e
->
blksize
 = 
TFTP_BLKSIZE_DEFAULT
;

986 
°©e
->
ªque°ed_blksize
 = 
blksize
;

988 ((
sockaddr
 *)&
°©e
->
loˇl_addr
)->
ß_Ámûy
 =

989 ()(
c⁄n
->
ù_addr
->
ai_Ámûy
);

991 
	`t·p_£t_timeouts
(
°©e
);

993 if(!
c⁄n
->
bôs
.
bound
) {

1007 
rc
 = 
	`böd
(
°©e
->
sockfd
, (
sockaddr
 *)&°©e->
loˇl_addr
,

1008 
c⁄n
->
ù_addr
->
ai_addæí
);

1009 if(
rc
) {

1010 
	`Áûf
(
c⁄n
->
d©a
, "bind() failed; %s",

1011 
	`Cuæ_°ªº‹
(
c⁄n
, 
SOCKERRNO
));

1012  
CURLE_COULDNT_CONNECT
;

1014 
c⁄n
->
bôs
.
bound
 = 
TRUE
;

1017 
	`Cuæ_pgrsSèπNow
(
c⁄n
->
d©a
);

1019 *
d⁄e
 = 
TRUE
;

1020 
code
 = 
CURLE_OK
;

1021 (
code
);

1022 
	}
}

1031 
CURLcode
 
	$t·p_d⁄e
(
c⁄√˘d©a
 *
c⁄n
, 
CURLcode
 
°©us
,

1032 
boﬁ
 
¥em©uª
)

1034 
CURLcode
 
code
 = 
CURLE_OK
;

1035 
t·p_°©e_d©a_t
 *
°©e
 = (t·p_°©e_d©a_à*)
c⁄n
->
¥Ÿo
.
t·pc
;

1037 ()
°©us
;

1038 ()
¥em©uª
;

1040 if(
	`Cuæ_pgrsD⁄e
(
c⁄n
))

1041  
CURLE_ABORTED_BY_CALLBACK
;

1044 if(
°©e
)

1045 
code
 = 
	`t·p_å™¶©e_code
(
°©e
->
îr‹
);

1047  
code
;

1048 
	}
}

1057 
	$t·p_gësock
(
c⁄√˘d©a
 *
c⁄n
, 
cuæ_sockë_t
 *
socks
,

1058 
numsocks
)

1060 if(!
numsocks
)

1061  
GETSOCK_BLANK
;

1063 
socks
[0] = 
c⁄n
->
sock
[
FIRSTSOCKET
];

1065  
	`GETSOCK_READSOCK
(0);

1066 
	}
}

1075 
CURLcode
 
	$t·p_ª˚ive_∑ckë
(
c⁄√˘d©a
 *
c⁄n
)

1077 
Cuæ_sockaddr_°‹age
 
‰omaddr
;

1078 
cuæ_sockÀn_t
 
‰omÀn
;

1079 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1080 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1081 
t·p_°©e_d©a_t
 *
°©e
 = (t·p_°©e_d©a_à*)
c⁄n
->
¥Ÿo
.
t·pc
;

1082 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

1085 
‰omÀn
 = (
‰omaddr
);

1086 
°©e
->
rbyãs
 = ()
	`ªcv‰om
(°©e->
sockfd
,

1087 (*)
°©e
->
Ωackë
.
d©a
,

1088 
°©e
->
blksize
+4,

1090 (
sockaddr
 *)&
‰omaddr
,

1091 &
‰omÀn
);

1092 if(
°©e
->
ªmŸe_addæí
==0) {

1093 
	`mem˝y
(&
°©e
->
ªmŸe_addr
, &
‰omaddr
, 
‰omÀn
);

1094 
°©e
->
ªmŸe_addæí
 = 
‰omÀn
;

1098 if(
°©e
->
rbyãs
 < 4) {

1099 
	`Áûf
(
d©a
, "ReceivedÅoo shortÖacket");

1101 
°©e
->
evít
 = 
TFTP_EVENT_TIMEOUT
;

1105 
°©e
->
evít
 = (
t·p_evít_t
)
	`gëΩackëevít
(&°©e->
Ωackë
);

1107 
°©e
->
evít
) {

1108 
TFTP_EVENT_DATA
:

1110 if(
°©e
->
rbyãs
 > 4 &&

1111 (
	`NEXT_BLOCKNUM
(
°©e
->
block
Ë=
	`gëΩackëblock
(&°©e->
Ωackë
))) {

1112 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
,

1113 (*)
°©e
->
Ωackë
.
d©a
+4,

1114 
°©e
->
rbyãs
-4);

1115 if(
ªsu…
) {

1116 
	`t·p_°©e_machöe
(
°©e
, 
TFTP_EVENT_ERROR
);

1117  
ªsu…
;

1119 
k
->
byãcou¡
 +
°©e
->
rbyãs
-4;

1120 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, (
cuæ_off_t
Ë
k
->
byãcou¡
);

1123 
TFTP_EVENT_ERROR
:

1124 
°©e
->
îr‹
 = (
t·p_îr‹_t
)
	`gëΩackëblock
(&°©e->
Ωackë
);

1125 
	`öfof
(
d©a
, "%s\n", (c⁄° *)
°©e
->
Ωackë
.data+4);

1127 
TFTP_EVENT_ACK
:

1129 
TFTP_EVENT_OACK
:

1130 
ªsu…
 = 
	`t·p_∑r£_›ti⁄_ack
(
°©e
,

1131 (c⁄° *)
°©e
->
Ωackë
.
d©a
+2,

1132 
°©e
->
rbyãs
-2);

1133 if(
ªsu…
)

1134  
ªsu…
;

1136 
TFTP_EVENT_RRQ
:

1137 
TFTP_EVENT_WRQ
:

1139 
	`Áûf
(
d©a
, "%s", "InternalÉrror: UnexpectedÖacket");

1144 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
)) {

1145 
	`t·p_°©e_machöe
(
°©e
, 
TFTP_EVENT_ERROR
);

1146  
CURLE_ABORTED_BY_CALLBACK
;

1149  
ªsu…
;

1150 
	}
}

1159 
	$t·p_°©e_timeout
(
c⁄√˘d©a
 *
c⁄n
, 
t·p_evít_t
 *
evít
)

1161 
time_t
 
cuºít
;

1162 
t·p_°©e_d©a_t
 *
°©e
 = (t·p_°©e_d©a_à*)
c⁄n
->
¥Ÿo
.
t·pc
;

1164 if(
evít
)

1165 *
evít
 = 
TFTP_EVENT_NONE
;

1167 
	`time
(&
cuºít
);

1168 if(
cuºít
 > 
°©e
->
max_time
) {

1169 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "timeout: %ld > %ld\n",

1170 ()
cuºít
, ()
°©e
->
max_time
));

1171 
°©e
->
îr‹
 = 
TFTP_ERR_TIMEOUT
;

1172 
°©e
->°©ê
TFTP_STATE_FIN
;

1175 if(
cuºít
 > 
°©e
->
rx_time
+°©e->
ªåy_time
) {

1176 if(
evít
)

1177 *
evít
 = 
TFTP_EVENT_TIMEOUT
;

1178 
	`time
(&
°©e
->
rx_time
);

1184  ()(
°©e
->
max_time
 - 
cuºít
);

1185 
	}
}

1194 
CURLcode
 
	$t·p_mu…i_°©emach
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1196 
rc
;

1197 
t·p_evít_t
 
evít
;

1198 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1199 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1200 
t·p_°©e_d©a_t
 *
°©e
 = (t·p_°©e_d©a_à*)
c⁄n
->
¥Ÿo
.
t·pc
;

1201 
timeout_ms
 = 
	`t·p_°©e_timeout
(
c⁄n
, &
evít
);

1203 *
d⁄e
 = 
FALSE
;

1205 if(
timeout_ms
 <= 0) {

1206 
	`Áûf
(
d©a
, "TFTPÑesponseÅimeout");

1207  
CURLE_OPERATION_TIMEDOUT
;

1209 if(
evít
 !
TFTP_EVENT_NONE
) {

1210 
ªsu…
 = 
	`t·p_°©e_machöe
(
°©e
, 
evít
);

1211 if(
ªsu…
 !
CURLE_OK
)

1212 (
ªsu…
);

1213 *
d⁄e
 = (
°©e
->°©ê=
TFTP_STATE_FIN
Ë? 
TRUE
 : 
FALSE
;

1214 if(*
d⁄e
)

1216 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

1220 
rc
 = 
	`Cuæ_sockë_ªady
(
°©e
->
sockfd
, 
CURL_SOCKET_BAD
, 0);

1222 if(
rc
 == -1) {

1224 
îr‹
 = 
SOCKERRNO
;

1225 
	`Áûf
(
d©a
, "%s", 
	`Cuæ_°ªº‹
(
c⁄n
, 
îr‹
));

1226 
°©e
->
evít
 = 
TFTP_EVENT_ERROR
;

1228 if(
rc
 != 0) {

1229 
ªsu…
 = 
	`t·p_ª˚ive_∑ckë
(
c⁄n
);

1230 if(
ªsu…
 !
CURLE_OK
)

1231 (
ªsu…
);

1232 
ªsu…
 = 
	`t·p_°©e_machöe
(
°©e
, sèã->
evít
);

1233 if(
ªsu…
 !
CURLE_OK
)

1234 (
ªsu…
);

1235 *
d⁄e
 = (
°©e
->°©ê=
TFTP_STATE_FIN
Ë? 
TRUE
 : 
FALSE
;

1236 if(*
d⁄e
)

1238 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
, -1, NULL);

1243  
ªsu…
;

1244 
	}
}

1253 
CURLcode
 
	$t·p_doög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d›ha£_d⁄e
)

1255 
CURLcode
 
ªsu…
;

1256 
ªsu…
 = 
	`t·p_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

1258 if(*
d›ha£_d⁄e
) {

1259 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

1261 if(!
ªsu…
) {

1265 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

1266 
ªsu…
 = 
CURLE_ABORTED_BY_CALLBACK
;

1268 
ªsu…
 = 
	`Cuæ_•ìdcheck
(
c⁄n
->
d©a
, 
	`Cuæ_tvnow
());

1270  
ªsu…
;

1271 
	}
}

1280 
CURLcode
 
	$t·p_≥rf‹m
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d›ha£_d⁄e
)

1282 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1283 
t·p_°©e_d©a_t
 *
°©e
 = (t·p_°©e_d©a_à*)
c⁄n
->
¥Ÿo
.
t·pc
;

1285 *
d›ha£_d⁄e
 = 
FALSE
;

1287 
ªsu…
 = 
	`t·p_°©e_machöe
(
°©e
, 
TFTP_EVENT_INIT
);

1289 if(
°©e
->°©ê=
TFTP_STATE_FIN
 || 
ªsu…
 !
CURLE_OK
)

1290 (
ªsu…
);

1292 
	`t·p_mu…i_°©emach
(
c⁄n
, 
d›ha£_d⁄e
);

1294 if(*
d›ha£_d⁄e
)

1295 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
, "DOÖhase is complete\n"));

1297  
ªsu…
;

1298 
	}
}

1311 
CURLcode
 
	$t·p_do
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

1313 
t·p_°©e_d©a_t
 *
°©e
;

1314 
CURLcode
 
code
;

1316 *
d⁄e
 = 
FALSE
;

1318 if(!
c⁄n
->
¥Ÿo
.
t·pc
) {

1319 
code
 = 
	`t·p_c⁄√˘
(
c⁄n
, 
d⁄e
);

1320 if(
code
)

1321  
code
;

1324 
°©e
 = (
t·p_°©e_d©a_t
 *)
c⁄n
->
¥Ÿo
.
t·pc
;

1325 if(!
°©e
)

1326  
CURLE_BAD_CALLING_ORDER
;

1328 
code
 = 
	`t·p_≥rf‹m
(
c⁄n
, 
d⁄e
);

1332 if(
code
 =
CURLE_OK
)

1334 
code
 = 
	`t·p_å™¶©e_code
(
°©e
->
îr‹
);

1336  
code
;

1337 
	}
}

1339 
CURLcode
 
	$t·p_£tup_c⁄√˘i⁄
(
c⁄√˘d©a
 * 
c⁄n
)

1341 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1342 * 
ty≥
;

1343 
comm™d
;

1345 
c⁄n
->
sockty≥
 = 
SOCK_DGRAM
;

1349 
ty≥
 = 
	`°r°r
(
d©a
->
°©e
.
∑th
, ";mode=");

1351 if(!
ty≥
)

1352 
ty≥
 = 
	`°r°r
(
c⁄n
->
ho°
.
øwÆloc
, ";mode=");

1354 if(
ty≥
) {

1355 *
ty≥
 = 0;

1356 
comm™d
 = 
	`Cuæ_øw_touµî
(
ty≥
[6]);

1358 
comm™d
) {

1361 
d©a
->
£t
.
¥e„r_ascii
 = 
TRUE
;

1368 
d©a
->
£t
.
¥e„r_ascii
 = 
FALSE
;

1373  
CURLE_OK
;

1374 
	}
}

	@lib/tftp.h

1 #i‚de‡
HEADER_CURL_TFTP_H


2 
	#HEADER_CURL_TFTP_H


	)

24 #i‚de‡
CURL_DISABLE_TFTP


25 c⁄° 
Cuæ_h™dÀr
 
Cuæ_h™dÀr_t·p
;

	@lib/timeval.c

23 
	~"timevÆ.h
"

25 #i‡
deföed
(
WIN32
Ë&& !deföed(
MSDOS
)

27 
timevÆ
 
	$cuæx_tvnow
()

34 
timevÆ
 
now
;

35 
DWORD
 
mûli£c⁄ds
 = 
	`GëTickCou¡
();

36 
now
.
tv_£c
 = 
mûli£c⁄ds
 / 1000;

37 
now
.
tv_u£c
 = (
mûli£c⁄ds
 % 1000) * 1000;

38  
now
;

39 
	}
}

41 #ñi‡
deföed
(
HAVE_CLOCK_GETTIME_MONOTONIC
)

43 
timevÆ
 
	$cuæx_tvnow
()

52 
timevÆ
 
now
;

53 
time•ec
 
t¢ow
;

54 if(0 =
	`˛ock_gëtime
(
CLOCK_MONOTONIC
, &
t¢ow
)) {

55 
now
.
tv_£c
 = 
t¢ow
.tv_sec;

56 
now
.
tv_u£c
 = 
t¢ow
.
tv_n£c
 / 1000;

63 #ifde‡
HAVE_GETTIMEOFDAY


65 ()
	`gëtimeofday
(&
now
, 
NULL
);

68 
now
.
tv_£c
 = ()
	`time
(
NULL
);

69 
now
.
tv_u£c
 = 0;

72  
now
;

73 
	}
}

75 #ñi‡
deföed
(
HAVE_GETTIMEOFDAY
)

77 
timevÆ
 
	$cuæx_tvnow
()

84 
timevÆ
 
now
;

85 ()
	`gëtimeofday
(&
now
, 
NULL
);

86  
now
;

87 
	}
}

91 
timevÆ
 
	$cuæx_tvnow
()

96 
timevÆ
 
now
;

97 
now
.
tv_£c
 = ()
	`time
(
NULL
);

98 
now
.
tv_u£c
 = 0;

99  
now
;

100 
	}
}

110 
	$cuæx_tvdiff
(
timevÆ
 
√wî
, timevÆ 
ﬁdî
)

112  (
√wî
.
tv_£c
-
ﬁdî
.tv_sec)*1000+

113 (
√wî
.
tv_u£c
-
ﬁdî
.tv_usec)/1000;

114 
	}
}

121 
	$cuæx_tvdiff_£cs
(
timevÆ
 
√wî
, timevÆ 
ﬁdî
)

123 if(
√wî
.
tv_£c
 !
ﬁdî
.tv_sec)

124  ()(
√wî
.
tv_£c
-
ﬁdî
.tv_sec)+

125 ()(
√wî
.
tv_u£c
-
ﬁdî
.tv_usec)/1000000.0;

127  ()(
√wî
.
tv_u£c
-
ﬁdî
.tv_usec)/1000000.0;

128 
	}
}

131 
	$Cuæ_tvl⁄g
(
timevÆ
 
t1
)

133  
t1
.
tv_£c
;

134 
	}
}

	@lib/timeval.h

1 #i‚de‡
HEADER_CURL_TIMEVAL_H


2 
	#HEADER_CURL_TIMEVAL_H


	)

30 
	~"cuæ_£tup.h
"

32 
timevÆ
 
cuæx_tvnow
();

40 
cuæx_tvdiff
(
timevÆ
 
t1
, timevÆ 
t2
);

47 
cuæx_tvdiff_£cs
(
timevÆ
 
t1
, timevÆ 
t2
);

49 
Cuæ_tvl⁄g
(
timevÆ
 
t1
);

53 
	#Cuæ_tvnow
(Ë
	`cuæx_tvnow
()

	)

54 
	#Cuæ_tvdiff
(
x
,
y
Ë
	`cuæx_tvdiff
(x,y)

	)

55 
	#Cuæ_tvdiff_£cs
(
x
,
y
Ë
	`cuæx_tvdiff_£cs
(x,y)

	)

	@lib/transfer.c

23 
	~"cuæ_£tup.h
"

25 
	~"°πoof·.h
"

26 
	~"°ªquÆ.h
"

27 
	~"øw°r.h
"

29 #ifde‡
HAVE_NETINET_IN_H


30 
	~<√töë/ö.h
>

32 #ifde‡
HAVE_NETDB_H


33 
	~<√tdb.h
>

35 #ifde‡
HAVE_ARPA_INET_H


36 
	~<¨∑/öë.h
>

38 #ifde‡
HAVE_NET_IF_H


39 
	~<√t/if.h
>

41 #ifde‡
HAVE_SYS_IOCTL_H


42 
	~<sys/io˘l.h
>

44 #ifde‡
HAVE_SIGNAL_H


45 
	~<sig«l.h
>

48 #ifde‡
HAVE_SYS_PARAM_H


49 
	~<sys/∑øm.h
>

52 #ifde‡
HAVE_SYS_SELECT_H


53 
	~<sys/£À˘.h
>

56 #i‚de‡
HAVE_SOCKET


60 
	~"uæd©a.h
"

61 
	~<cuæ/cuæ.h
>

62 
	~"√åc.h
"

64 
	~"c⁄ã¡_ícodög.h
"

65 
	~"ho°ù.h
"

66 
	~"å™s„r.h
"

67 
	~"£ndf.h
"

68 
	~"•ìdcheck.h
"

69 
	~"¥ogªss.h
"

70 
	~"hâp.h
"

71 
	~"uæ.h
"

72 
	~"gëöfo.h
"

73 
	~"vés/vés.h
"

74 
	~"hâp_dige°.h
"

75 
	~"cuæ_¡lm.h
"

76 
	~"hâp_√gŸüã.h
"

77 
	~"sh¨e.h
"

78 
	~"cuæ_mem‹y.h
"

79 
	~"£À˘.h
"

80 
	~"mu…iif.h
"

81 
	~"c⁄√˘.h
"

82 
	~"n⁄-ascii.h
"

84 
	#_MPRINTF_REPLACE


	)

85 
	~<cuæ/m¥ötf.h
>

88 
	~"memdebug.h
"

94 
CURLcode
 
	$Cuæ_fûÃódbuf„r
(
c⁄√˘d©a
 *
c⁄n
, 
byãs
, *
ƒódp
)

96 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

97 
size_t
 
buf„rsize
 = (size_t)
byãs
;

98 
ƒód
;

99 #ifde‡
CURL_DOES_CONVERSIONS


100 
boﬁ
 
£ndög_hâp_hódîs
 = 
FALSE
;

102 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&(
PROTO_FAMILY_HTTP
|
CURLPROTO_RTSP
)) {

103 c⁄° 
HTTP
 *
hâp
 = 
d©a
->
ªq
.
¥Ÿ›
;

105 if(
hâp
->
£ndög
 =
HTTPSEND_REQUEST
)

108 
£ndög_hâp_hódîs
 = 
TRUE
;

112 if(
d©a
->
ªq
.
u∂ﬂd_chunky
) {

114 
buf„rsize
 -= (8 + 2 + 2);

115 
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 += (8 + 2);

120 
ƒód
 = ()
c⁄n
->
	`‰ód_func
(
d©a
->
ªq
.
u∂ﬂd_‰omhîe
, 1,

121 
buf„rsize
, 
c⁄n
->
‰ód_ö
);

123 if(
ƒód
 =
CURL_READFUNC_ABORT
) {

124 
	`Áûf
(
d©a
, "operationáborted by callback");

125 *
ƒódp
 = 0;

126  
CURLE_ABORTED_BY_CALLBACK
;

128 if(
ƒód
 =
CURL_READFUNC_PAUSE
) {

130 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_NONETWORK
) {

134 
	`Áûf
(
d©a
, "Read callbackásked for PAUSE whenÇot supported!");

135  
CURLE_READ_ERROR
;

138 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

140 
k
->
kìp⁄
 |
KEEP_SEND_PAUSE
;

141 if(
d©a
->
ªq
.
u∂ﬂd_chunky
) {

143 
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 -= (8 + 2);

145 *
ƒódp
 = 0;

147  
CURLE_OK
;

149 if((
size_t
)
ƒód
 > 
buf„rsize
) {

151 *
ƒódp
 = 0;

152 
	`Áûf
(
d©a
, "read functionÑeturned funny value");

153  
CURLE_READ_ERROR
;

156 if(!
d©a
->
ªq
.
f‹bidchunk
 && d©a->ªq.
u∂ﬂd_chunky
) {

172 
hexbuf„r
[11];

173 c⁄° *
ídoÊöe_«tive
;

174 c⁄° *
ídoÊöe_√tw‹k
;

175 
hexÀn
;

178 #ifde‡
CURL_DO_LINEEND_CONV


179 (
d©a
->
£t
.
¥e„r_ascii
) ||

181 (
d©a
->
£t
.
¸lf
)) {

183 
ídoÊöe_«tive
 = "\n";

184 
ídoÊöe_√tw‹k
 = "\x0a";

187 
ídoÊöe_«tive
 = "\r\n";

188 
ídoÊöe_√tw‹k
 = "\x0d\x0a";

190 
hexÀn
 = 
	`¢¥ötf
(
hexbuf„r
, (hexbuffer),

191 "%x%s", 
ƒód
, 
ídoÊöe_«tive
);

194 
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 -
hexÀn
;

195 
ƒód
 +
hexÀn
;

198 
	`mem˝y
(
d©a
->
ªq
.
u∂ﬂd_‰omhîe
, 
hexbuf„r
, 
hexÀn
);

201 
	`mem˝y
(
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 + 
ƒód
,

202 
ídoÊöe_√tw‹k
,

203 
	`°æí
(
ídoÊöe_√tw‹k
));

205 #ifde‡
CURL_DOES_CONVERSIONS


206 
CURLcode
 
ªs
;

207 
Àngth
;

208 if(
d©a
->
£t
.
¥e„r_ascii
) {

210 
Àngth
 = 
ƒód
;

214 
Àngth
 = 
	`°æí
(
hexbuf„r
);

216 
ªs
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
d©a
, d©a->
ªq
.
u∂ﬂd_‰omhîe
, 
Àngth
);

218 if(
ªs
)

219 (
ªs
);

222 if((
ƒód
 - 
hexÀn
) == 0)

224 
d©a
->
ªq
.
u∂ﬂd_d⁄e
 = 
TRUE
;

226 
ƒód
+=()
	`°æí
(
ídoÊöe_«tive
);

228 #ifde‡
CURL_DOES_CONVERSIONS


229 if((
d©a
->
£t
.
¥e„r_ascii
Ë&& (!
£ndög_hâp_hódîs
)) {

230 
CURLcode
 
ªs
;

231 
ªs
 = 
	`Cuæ_c⁄vît_to_√tw‹k
(
d©a
, d©a->
ªq
.
u∂ﬂd_‰omhîe
, 
ƒód
);

233 if(
ªs
 !
CURLE_OK
)

234 (
ªs
);

238 *
ƒódp
 = 
ƒód
;

240  
CURLE_OK
;

241 
	}
}

249 
CURLcode
 
	$Cuæ_ªadªwöd
(
c⁄√˘d©a
 *
c⁄n
)

251 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

253 
c⁄n
->
bôs
.
ªwöda·î£nd
 = 
FALSE
;

259 
d©a
->
ªq
.
kìp⁄
 &~
KEEP_SEND
;

264 if(
d©a
->
£t
.
po°fõlds
 ||

265 (
d©a
->
£t
.
hâ¥eq
 =
HTTPREQ_POST_FORM
))

268 if(
d©a
->
£t
.
£ek_func
) {

269 
îr
;

271 
îr
 = (
d©a
->
£t
.
£ek_func
)(d©a->£t.
£ek_˛õ¡
, 0, 
SEEK_SET
);

272 if(
îr
) {

273 
	`Áûf
(
d©a
, "£ek cÆlbackÑëu∫edÉº‹ %d", ()
îr
);

274  
CURLE_SEND_FAIL_REWIND
;

277 if(
d©a
->
£t
.
io˘l_func
) {

278 
cuæi€º
 
îr
;

280 
îr
 = (
d©a
->
£t
.
io˘l_func
)(d©a, 
CURLIOCMD_RESTARTREAD
,

281 
d©a
->
£t
.
io˘l_˛õ¡
);

282 
	`öfof
(
d©a
, "thêio˘»ˇŒbackÑëu∫ed %d\n", ()
îr
);

284 if(
îr
) {

286 
	`Áûf
(
d©a
, "io˘»ˇŒbackÑëu∫edÉº‹ %d", ()
îr
);

287  
CURLE_SEND_FAIL_REWIND
;

294 if(
d©a
->
£t
.
‰ód_func
 =(
cuæ_ªad_ˇŒback
)
‰ód
) {

295 if(-1 !
	`f£ek
(
d©a
->
£t
.
ö
, 0, 
SEEK_SET
))

297  
CURLE_OK
;

301 
	`Áûf
(
d©a
, "necessary dataÑewind wasn'tÖossible");

302  
CURLE_SEND_FAIL_REWIND
;

305  
CURLE_OK
;

306 
	}
}

308 
	$d©a_≥ndög
(c⁄° 
c⁄√˘d©a
 *
c⁄n
)

312  
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&(
CURLPROTO_SCP
|
CURLPROTO_SFTP
) ||

313 #i‡
	`deföed
(
USE_NGHTTP2
)

314 
	`Cuæ_s¶_d©a_≥ndög
(
c⁄n
, 
FIRSTSOCKET
) ||

322 ((
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&
PROTO_FAMILY_HTTP
Ë&& c⁄n->
hâpvîsi⁄
 == 20 &&

323 
c⁄n
->
¥Ÿo
.
hâpc
.
˛o£d
);

325 
	`Cuæ_s¶_d©a_≥ndög
(
c⁄n
, 
FIRSTSOCKET
);

327 
	}
}

329 
	$ªad_ªwöd
(
c⁄√˘d©a
 *
c⁄n
,

330 
size_t
 
thismuch
)

332 
	`DEBUGASSERT
(
c⁄n
->
ªad_pos
 >
thismuch
);

334 
c⁄n
->
ªad_pos
 -
thismuch
;

335 
c⁄n
->
bôs
.
°ªam_was_ªwound
 = 
TRUE
;

337 #ifde‡
DEBUGBUILD


339 
buf
[512 + 1];

340 
size_t
 
show
;

342 
show
 = 
	`CURLMIN
(
c⁄n
->
buf_Àn
 - c⁄n->
ªad_pos
, (
buf
)-1);

343 if(
c⁄n
->
ma°î_buf„r
) {

344 
	`mem˝y
(
buf
, 
c⁄n
->
ma°î_buf„r
 + c⁄n->
ªad_pos
, 
show
);

345 
buf
[
show
] = '\0';

348 
buf
[0] = '\0';

351 
	`DEBUGF
(
	`öfof
(
c⁄n
->
d©a
,

353 
c⁄n
->
ªad_pos
, 
buf
));

356 
	}
}

362 
boﬁ
 
	$Cuæ_mìts_timec⁄dôi⁄
(
Sessi⁄H™dÀ
 *
d©a
, 
time_t
 
timeofdoc
)

364 if((
timeofdoc
 =0Ë|| (
d©a
->
£t
.
timevÆue
 == 0))

365  
TRUE
;

367 
d©a
->
£t
.
timec⁄dôi⁄
) {

368 
CURL_TIMECOND_IFMODSINCE
:

370 if(
timeofdoc
 <
d©a
->
£t
.
timevÆue
) {

371 
	`öfof
(
d©a
,

373 
d©a
->
öfo
.
timec⁄d
 = 
TRUE
;

374  
FALSE
;

377 
CURL_TIMECOND_IFUNMODSINCE
:

378 if(
timeofdoc
 >
d©a
->
£t
.
timevÆue
) {

379 
	`öfof
(
d©a
,

381 
d©a
->
öfo
.
timec⁄d
 = 
TRUE
;

382  
FALSE
;

387  
TRUE
;

388 
	}
}

395 
CURLcode
 
	$ªadwrôe_d©a
(
Sessi⁄H™dÀ
 *
d©a
,

396 
c⁄√˘d©a
 *
c⁄n
,

397 
SögÀReque°
 *
k
,

398 *
didwh©
, 
boﬁ
 *
d⁄e
)

400 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

401 
ssize_t
 
ƒód
;

402 
size_t
 
ex˚ss
 = 0;

403 
boﬁ
 
is_em±y_d©a
 = 
FALSE
;

404 
boﬁ
 
ªadm‹e
 = 
FALSE
;

406 *
d⁄e
 = 
FALSE
;

411 
size_t
 
buf„rsize
 = 
d©a
->
£t
.
buf„r_size
?

412 
d©a
->
£t
.
buf„r_size
 : 
BUFSIZE
;

413 
size_t
 
byã°‹ód
 = 
buf„rsize
;

415 if(
k
->
size
 !-1 && !k->
hódî
) {

419 
cuæ_off_t
 
tŸÆÀ·
 = 
k
->
size
 - k->
byãcou¡
;

420 if(
tŸÆÀ·
 < (
cuæ_off_t
)
byã°‹ód
)

421 
byã°‹ód
 = (
size_t
)
tŸÆÀ·
;

424 if(
byã°‹ód
) {

426 
ªsu…
 = 
	`Cuæ_ªad
(
c⁄n
, c⁄n->
sockfd
, 
k
->
buf
, 
byã°‹ód
, &
ƒód
);

429 if(
CURLE_AGAIN
 =
ªsu…
)

432 if(
ªsu…
>0)

433  
ªsu…
;

438 
ƒód
 = 0;

441 if((
k
->
byãcou¡
 =0Ë&& (k->
wrôebyãcou¡
 == 0)) {

442 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_STARTTRANSFER
);

443 if(
k
->
exp100
 > 
EXP100_SEND_DATA
)

445 
k
->
°¨t100
 = 
	`Cuæ_tvnow
();

448 *
didwh©
 |
KEEP_RECV
;

450 
is_em±y_d©a
 = ((
ƒód
 =0Ë&& (
k
->
bodywrôes
 =0)Ë? 
TRUE
 : 
FALSE
;

453 if(0 < 
ƒód
 || 
is_em±y_d©a
) {

454 
k
->
buf
[
ƒód
] = 0;

456 if(0 >
ƒód
) {

459 
	`DEBUGF
(
	`öfof
(
d©a
, "nread <= 0, server closed connection, bailing\n"));

460 
k
->
kìp⁄
 &~
KEEP_RECV
;

466 
k
->
°r
 = k->
buf
;

468 if(
c⁄n
->
h™dÀr
->
ªadwrôe
) {

469 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`ªadwrôe
(
d©a
, c⁄n, &
ƒód
, &
ªadm‹e
);

470 if(
ªsu…
)

471  
ªsu…
;

472 if(
ªadm‹e
)

476 #i‚de‡
CURL_DISABLE_HTTP


479 if(
k
->
hódî
) {

481 
boﬁ
 
°›_ªadög
 = 
FALSE
;

482 
ªsu…
 = 
	`Cuæ_hâp_ªadwrôe_hódîs
(
d©a
, 
c⁄n
, &
ƒód
, &
°›_ªadög
);

483 if(
ªsu…
)

484  
ªsu…
;

486 if(
c⁄n
->
h™dÀr
->
ªadwrôe
 &&

487 (
k
->
maxdow∆ﬂd
 <0 && 
ƒód
 > 0)) {

488 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`ªadwrôe
(
d©a
, c⁄n, &
ƒód
, &
ªadm‹e
);

489 if(
ªsu…
)

490  
ªsu…
;

491 if(
ªadm‹e
)

495 if(
°›_ªadög
) {

498 if(
ƒód
 > 0) {

499 if(
	`Cuæ_mu…i_pùñöe_íabÀd
(
c⁄n
->
d©a
->
mu…i
)) {

500 
	`öfof
(
d©a
,

503 
ƒód
, 
d©a
->
°©e
.
∑th
);

504 
	`ªad_ªwöd
(
c⁄n
, (
size_t
)
ƒód
);

507 
	`öfof
(
d©a
,

511 
ƒód
, 
d©a
->
°©e
.
∑th
);

524 if(
k
->
°r
 && !k->
hódî
 && (
ƒód
 > 0 || 
is_em±y_d©a
)) {

526 #i‚de‡
CURL_DISABLE_HTTP


527 if(0 =
k
->
bodywrôes
 && !
is_em±y_d©a
) {

530 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&(
PROTO_FAMILY_HTTP
|
CURLPROTO_RTSP
)) {

533 if(
d©a
->
ªq
.
√wuæ
) {

534 if(
c⁄n
->
bôs
.
˛o£
) {

537 
k
->
kìp⁄
 &~
KEEP_RECV
;

538 *
d⁄e
 = 
TRUE
;

539  
CURLE_OK
;

544 
k
->
ign‹ebody
 = 
TRUE
;

545 
	`öfof
(
d©a
, "IgnoringÅheÑesponse-body\n");

547 if(
d©a
->
°©e
.
ªsume_‰om
 && !
k
->
c⁄ã¡_ønge
 &&

548 (
d©a
->
£t
.
hâ¥eq
==
HTTPREQ_GET
) &&

549 !
k
->
ign‹ebody
) {

553 
	`Áûf
(
d©a
, "HTTP server doesn't seemÅo support "

555  
CURLE_RANGE_ERROR
;

558 if(
d©a
->
£t
.
timec⁄dôi⁄
 && !d©a->
°©e
.
ønge
) {

564 if(!
	`Cuæ_mìts_timec⁄dôi⁄
(
d©a
, 
k
->
timeofdoc
)) {

565 *
d⁄e
 = 
TRUE
;

568 
d©a
->
öfo
.
hâpcode
 = 304;

569 
	`öfof
(
d©a
, "Simulateá HTTP 304Ñesponse!\n");

572 
	`c⁄n˛o£
(
c⁄n
, "Simulated 304 handling");

573  
CURLE_OK
;

581 
k
->
bodywrôes
++;

584 if(
d©a
->
£t
.
vîbo£
) {

585 if(
k
->
badhódî
) {

586 
	`Cuæ_debug
(
d©a
, 
CURLINFO_DATA_IN
, d©a->
°©e
.
hódîbuff
,

587 (
size_t
)
k
->
hbuÊí
, 
c⁄n
);

588 if(
k
->
badhódî
 =
HEADER_PARTHEADER
)

589 
	`Cuæ_debug
(
d©a
, 
CURLINFO_DATA_IN
,

590 
k
->
°r
, (
size_t
)
ƒód
, 
c⁄n
);

593 
	`Cuæ_debug
(
d©a
, 
CURLINFO_DATA_IN
,

594 
k
->
°r
, (
size_t
)
ƒód
, 
c⁄n
);

597 #i‚de‡
CURL_DISABLE_HTTP


598 if(
k
->
chunk
) {

606 
CHUNKcode
 
ªs
 =

607 
	`Cuæ_hâpchunk_ªad
(
c⁄n
, 
k
->
°r
, 
ƒód
, &nread);

609 if(
CHUNKE_OK
 < 
ªs
) {

610 if(
CHUNKE_WRITE_ERROR
 =
ªs
) {

611 
	`Áûf
(
d©a
, "Failed writing data");

612  
CURLE_WRITE_ERROR
;

614 
	`Áûf
(
d©a
, "%†ö chunked-ícodög", 
	`Cuæ_chunked_°ªº‹
(
ªs
));

615  
CURLE_RECV_ERROR
;

617 if(
CHUNKE_STOP
 =
ªs
) {

618 
size_t
 
d©Æe·
;

620 
k
->
kìp⁄
 &~
KEEP_RECV
;

628 
d©Æe·
 = 
c⁄n
->
chunk
.dataleft;

629 if(
d©Æe·
 != 0) {

630 
	`öfof
(
c⁄n
->
d©a
, "Leftoversáfter chunking: %zu bytes\n",

631 
d©Æe·
);

632 if(
	`Cuæ_mu…i_pùñöe_íabÀd
(
c⁄n
->
d©a
->
mu…i
)) {

634 
	`öfof
(
c⁄n
->
d©a
, "Rewödög %zu byãs\n",
d©Æe·
);

635 
	`ªad_ªwöd
(
c⁄n
, 
d©Æe·
);

644 if(
k
->
badhódî
 && !k->
ign‹ebody
) {

645 
	`DEBUGF
(
	`öfof
(
d©a
, "Increasing bytecount by %zu from hbuflen\n",

646 
k
->
hbuÊí
));

647 
k
->
byãcou¡
 +k->
hbuÊí
;

650 if((-1 !
k
->
maxdow∆ﬂd
) &&

651 (
k
->
byãcou¡
 + 
ƒód
 >k->
maxdow∆ﬂd
)) {

653 
ex˚ss
 = (
size_t
)(
k
->
byãcou¡
 + 
ƒód
 - k->
maxdow∆ﬂd
);

654 if(
ex˚ss
 > 0 && !
k
->
ign‹ebody
) {

655 if(
	`Cuæ_mu…i_pùñöe_íabÀd
(
c⁄n
->
d©a
->
mu…i
)) {

658 
	`öfof
(
d©a
,

660 " byã†⁄ uæ %†(sizê%" 
CURL_FORMAT_CURL_OFF_T


661 ", maxdow∆ﬂd = %" 
CURL_FORMAT_CURL_OFF_T


662 ", byãcou¡ = %" 
CURL_FORMAT_CURL_OFF_T
 ",Çread = %zd)\n",

663 
ex˚ss
, 
d©a
->
°©e
.
∑th
,

664 
k
->
size
, k->
maxdow∆ﬂd
, k->
byãcou¡
, 
ƒód
);

665 
	`ªad_ªwöd
(
c⁄n
, 
ex˚ss
);

668 
	`öfof
(
d©a
,

671 ", sizê%" 
CURL_FORMAT_CURL_OFF_T


672 ", maxdow∆ﬂd = %" 
CURL_FORMAT_CURL_OFF_T


673 ", byãcou¡ = %" 
CURL_FORMAT_CURL_OFF_T
 "\n",

674 
ex˚ss
, 
k
->
size
, k->
maxdow∆ﬂd
, k->
byãcou¡
);

678 
ƒód
 = (
ssize_t
Ë(
k
->
maxdow∆ﬂd
 - k->
byãcou¡
);

679 if(
ƒód
 < 0 )

680 
ƒód
 = 0;

682 
k
->
kìp⁄
 &~
KEEP_RECV
;

685 
k
->
byãcou¡
 +
ƒód
;

687 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, 
k
->
byãcou¡
);

689 if(!
k
->
chunk
 && (
ƒód
 || k->
badhódî
 || 
is_em±y_d©a
)) {

692 if(
k
->
badhódî
 && !k->
ign‹ebody
) {

697 if(
k
->
maxdow∆ﬂd
 =-1 || (
cuæ_off_t
)k->
hbuÊí
 <= k->maxdownload)

698 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
,

699 
d©a
->
°©e
.
hódîbuff
,

700 
k
->
hbuÊí
);

702 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
,

703 
d©a
->
°©e
.
hódîbuff
,

704 (
size_t
)
k
->
maxdow∆ﬂd
);

706 if(
ªsu…
)

707  
ªsu…
;

709 if(
k
->
badhódî
 < 
HEADER_ALLBAD
) {

715 #ifde‡
HAVE_LIBZ


716 
c⁄n
->
d©a
->
£t
.
hâp_˚_skù
 ?

717 
IDENTITY
 : 
k
->
auto_decodög
) {

718 
IDENTITY
:

723 if(!
k
->
ign‹ebody
) {

725 #i‚de‡
CURL_DISABLE_POP3


726 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&
PROTO_FAMILY_POP3
)

727 
ªsu…
 = 
	`Cuæ_p›3_wrôe
(
c⁄n
, 
k
->
°r
, 
ƒód
);

731 
ªsu…
 = 
	`Cuæ_˛õ¡_wrôe
(
c⁄n
, 
CLIENTWRITE_BODY
, 
k
->
°r
,

732 
ƒód
);

734 #ifde‡
HAVE_LIBZ


737 
DEFLATE
:

739 if(!
k
->
ign‹ebody
)

740 
ªsu…
 = 
	`Cuæ_u√ncode_deÊ©e_wrôe
(
c⁄n
, 
k
, 
ƒód
);

743 
GZIP
:

745 if(!
k
->
ign‹ebody
)

746 
ªsu…
 = 
	`Cuæ_u√ncode_gzù_wrôe
(
c⁄n
, 
k
, 
ƒód
);

749 
COMPRESS
:

751 
	`Áûf
 (
d©a
, "Unrecognized contentÉncodingÅype. "

754 
ªsu…
 = 
CURLE_BAD_CONTENT_ENCODING
;

759 
k
->
badhódî
 = 
HEADER_NORMAL
;

761 if(
ªsu…
)

762  
ªsu…
;

767 if(
c⁄n
->
h™dÀr
->
ªadwrôe
 &&

768 (
ex˚ss
 > 0 && !
c⁄n
->
bôs
.
°ªam_was_ªwound
)) {

770 
k
->
°r
 +
ƒód
;

771 
ƒód
 = (
ssize_t
)
ex˚ss
;

773 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`ªadwrôe
(
d©a
, c⁄n, &
ƒód
, &
ªadm‹e
);

774 if(
ªsu…
)

775  
ªsu…
;

777 if(
ªadm‹e
)

778 
k
->
kìp⁄
 |
KEEP_RECV
;

782 if(
is_em±y_d©a
) {

785 
k
->
kìp⁄
 &~
KEEP_RECV
;

788 } 
	`d©a_≥ndög
(
c⁄n
));

790 if(((
k
->
kìp⁄
 & (
KEEP_RECV
|
KEEP_SEND
)) == KEEP_SEND) &&

791 
c⁄n
->
bôs
.
˛o£
 ) {

795 
	`öfof
(
d©a
, "weáre doneÑeadingándÅhis is setÅo close, stop send\n");

796 
k
->
kìp⁄
 &~
KEEP_SEND
;

799  
CURLE_OK
;

800 
	}
}

805 
CURLcode
 
	$ªadwrôe_u∂ﬂd
(
Sessi⁄H™dÀ
 *
d©a
,

806 
c⁄√˘d©a
 *
c⁄n
,

807 
SögÀReque°
 *
k
,

808 *
didwh©
)

810 
ssize_t
 
i
, 
si
;

811 
ssize_t
 
byãs_wrôãn
;

812 
CURLcode
 
ªsu…
;

813 
ssize_t
 
ƒód
;

814 
boﬁ
 
£ndög_hâp_hódîs
 = 
FALSE
;

816 if((
k
->
byãcou¡
 =0Ë&& (k->
wrôebyãcou¡
 == 0))

817 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_STARTTRANSFER
);

819 *
didwh©
 |
KEEP_SEND
;

832 if(0 =
d©a
->
ªq
.
u∂ﬂd_¥e£¡
) {

834 
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 = 
k
->
u∂ﬂdbuf
;

836 if(!
k
->
u∂ﬂd_d⁄e
) {

839 
fûlcou¡
;

840 
HTTP
 *
hâp
 = 
d©a
->
ªq
.
¥Ÿ›
;

842 if((
k
->
exp100
 =
EXP100_SENDING_REQUEST
) &&

843 (
hâp
->
£ndög
 =
HTTPSEND_BODY
)) {

847 
k
->
exp100
 = 
EXP100_AWAITING_CONTINUE
;

848 
k
->
kìp⁄
 &~
KEEP_SEND
;

849 
k
->
°¨t100
 = 
	`Cuæ_tvnow
();

850 *
didwh©
 &~
KEEP_SEND
;

853 
	`Cuæ_expúe
(
d©a
, d©a->
£t
.
ex≥˘_100_timeout
);

857 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&(
PROTO_FAMILY_HTTP
|
CURLPROTO_RTSP
)) {

858 if(
hâp
->
£ndög
 =
HTTPSEND_REQUEST
)

861 
£ndög_hâp_hódîs
 = 
TRUE
;

863 
£ndög_hâp_hódîs
 = 
FALSE
;

866 
ªsu…
 = 
	`Cuæ_fûÃódbuf„r
(
c⁄n
, 
BUFSIZE
, &
fûlcou¡
);

867 if(
ªsu…
)

868  
ªsu…
;

870 
ƒód
 = (
ssize_t
)
fûlcou¡
;

873 
ƒód
 = 0;

875 if(!
ƒód
 && (
k
->
kìp⁄
 & 
KEEP_SEND_PAUSE
)) {

879 if(
ƒód
<=0) {

881 
k
->
kìp⁄
 &~
KEEP_SEND
;

883 if(
c⁄n
->
bôs
.
ªwöda·î£nd
) {

884 
ªsu…
 = 
	`Cuæ_ªadªwöd
(
c⁄n
);

885 if(
ªsu…
)

886  
ªsu…
;

892 
d©a
->
ªq
.
u∂ﬂd_¥e£¡
 = 
ƒód
;

894 #i‚de‡
CURL_DISABLE_SMTP


895 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
PROTO_FAMILY_SMTP
) {

896 
ªsu…
 = 
	`Cuæ_smç_esˇ≥_eob
(
c⁄n
, 
ƒód
);

897 if(
ªsu…
)

898  
ªsu…
;

904 if((!
£ndög_hâp_hódîs
) && (

905 #ifde‡
CURL_DO_LINEEND_CONV


907 (
d©a
->
£t
.
¥e„r_ascii
) ||

909 (
d©a
->
£t
.
¸lf
))) {

910 if(
d©a
->
°©e
.
s¸©ch
 =
NULL
)

911 
d©a
->
°©e
.
s¸©ch
 = 
	`mÆloc
(2*
BUFSIZE
);

912 if(
d©a
->
°©e
.
s¸©ch
 =
NULL
) {

913 
	`Áûf
 (
d©a
, "FailedÅoálloc scratch buffer!");

914  
CURLE_OUT_OF_MEMORY
;

922 
i
 = 0, 
si
 = 0; i < 
ƒód
; i++, si++) {

923 if(
d©a
->
ªq
.
u∂ﬂd_‰omhîe
[
i
] == 0x0a) {

924 
d©a
->
°©e
.
s¸©ch
[
si
++] = 0x0d;

925 
d©a
->
°©e
.
s¸©ch
[
si
] = 0x0a;

926 if(!
d©a
->
£t
.
¸lf
) {

929 
d©a
->
°©e
.
öfûesize
++;

933 
d©a
->
°©e
.
s¸©ch
[
si
] = d©a->
ªq
.
u∂ﬂd_‰omhîe
[
i
];

935 if(
si
 !
ƒód
) {

938 
ƒód
 = 
si
;

941 
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 = d©a->
°©e
.
s¸©ch
;

944 
d©a
->
ªq
.
u∂ﬂd_¥e£¡
 = 
ƒód
;

954 
ªsu…
 = 
	`Cuæ_wrôe
(
c⁄n
,

955 
c⁄n
->
wrôesockfd
,

956 
d©a
->
ªq
.
u∂ﬂd_‰omhîe
,

957 
d©a
->
ªq
.
u∂ﬂd_¥e£¡
,

958 &
byãs_wrôãn
);

960 if(
ªsu…
)

961  
ªsu…
;

963 if(
d©a
->
£t
.
vîbo£
)

965 
	`Cuæ_debug
(
d©a
, 
CURLINFO_DATA_OUT
, d©a->
ªq
.
u∂ﬂd_‰omhîe
,

966 (
size_t
)
byãs_wrôãn
, 
c⁄n
);

968 
k
->
wrôebyãcou¡
 +
byãs_wrôãn
;

970 if(
k
->
wrôebyãcou¡
 =
d©a
->
°©e
.
öfûesize
) {

972 
k
->
u∂ﬂd_d⁄e
 = 
TRUE
;

973 
	`öfof
(
d©a
, "Weáre completely uploadedánd fine\n");

976 if(
d©a
->
ªq
.
u∂ﬂd_¥e£¡
 !
byãs_wrôãn
) {

980 
d©a
->
ªq
.
u∂ﬂd_¥e£¡
 -
byãs_wrôãn
;

984 
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 +
byãs_wrôãn
;

988 
d©a
->
ªq
.
u∂ﬂd_‰omhîe
 = 
k
->
u∂ﬂdbuf
;

989 
d©a
->
ªq
.
u∂ﬂd_¥e£¡
 = 0;

991 if(
k
->
u∂ﬂd_d⁄e
) {

993 
k
->
kìp⁄
 &~
KEEP_SEND
;

997 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 
k
->
wrôebyãcou¡
);

999 } 
WHILE_FALSE
;

1001  
CURLE_OK
;

1002 
	}
}

1008 
CURLcode
 
	$Cuæ_ªadwrôe
(
c⁄√˘d©a
 *
c⁄n
,

1009 
boﬁ
 *
d⁄e
)

1011 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1012 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

1013 
CURLcode
 
ªsu…
;

1014 
didwh©
=0;

1016 
cuæ_sockë_t
 
fd_ªad
;

1017 
cuæ_sockë_t
 
fd_wrôe
;

1018 
£À˘_ªs
 = 
c⁄n
->
c£À˘_bôs
;

1020 
c⁄n
->
c£À˘_bôs
 = 0;

1025 if((
k
->
kìp⁄
 & 
KEEP_RECVBITS
Ë=
KEEP_RECV
)

1026 
fd_ªad
 = 
c⁄n
->
sockfd
;

1028 
fd_ªad
 = 
CURL_SOCKET_BAD
;

1030 if((
k
->
kìp⁄
 & 
KEEP_SENDBITS
Ë=
KEEP_SEND
)

1031 
fd_wrôe
 = 
c⁄n
->
wrôesockfd
;

1033 
fd_wrôe
 = 
CURL_SOCKET_BAD
;

1035 if(!
£À˘_ªs
)

1037 
£À˘_ªs
 = 
	`Cuæ_sockë_ªady
(
fd_ªad
, 
fd_wrôe
, 0);

1039 if(
£À˘_ªs
 =
CURL_CSELECT_ERR
) {

1040 
	`Áûf
(
d©a
, "select/pollÑeturnedÉrror");

1041  
CURLE_SEND_ERROR
;

1047 if((
k
->
kìp⁄
 & 
KEEP_RECV
) &&

1048 ((
£À˘_ªs
 & 
CURL_CSELECT_IN
Ë|| 
c⁄n
->
bôs
.
°ªam_was_ªwound
)) {

1050 
ªsu…
 = 
	`ªadwrôe_d©a
(
d©a
, 
c⁄n
, 
k
, &
didwh©
, 
d⁄e
);

1051 if(
ªsu…
 || *
d⁄e
)

1052  
ªsu…
;

1056 if((
k
->
kìp⁄
 & 
KEEP_SEND
Ë&& (
£À˘_ªs
 & 
CURL_CSELECT_OUT
)) {

1059 
ªsu…
 = 
	`ªadwrôe_u∂ﬂd
(
d©a
, 
c⁄n
, 
k
, &
didwh©
);

1060 if(
ªsu…
)

1061  
ªsu…
;

1064 
k
->
now
 = 
	`Cuæ_tvnow
();

1065 if(
didwh©
) {

1067 if(
k
->
byãcou¡p
)

1068 *
k
->
byãcou¡p
 = k->
byãcou¡
;

1069 if(
k
->
wrôebyãcou¡p
)

1070 *
k
->
wrôebyãcou¡p
 = k->
wrôebyãcou¡
;

1074 if(
k
->
exp100
 =
EXP100_AWAITING_CONTINUE
) {

1088 
ms
 = 
	`Cuæ_tvdiff
(
k
->
now
, k->
°¨t100
);

1089 if(
ms
 >
d©a
->
£t
.
ex≥˘_100_timeout
) {

1091 
k
->
exp100
 = 
EXP100_SEND_DATA
;

1092 
k
->
kìp⁄
 |
KEEP_SEND
;

1093 
	`öfof
(
d©a
, "Done waiting for 100-continue\n");

1098 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

1099 
ªsu…
 = 
CURLE_ABORTED_BY_CALLBACK
;

1101 
ªsu…
 = 
	`Cuæ_•ìdcheck
(
d©a
, 
k
->
now
);

1102 if(
ªsu…
)

1103  
ªsu…
;

1105 if(
k
->
kìp⁄
) {

1106 if(0 > 
	`Cuæ_timñe·
(
d©a
, &
k
->
now
, 
FALSE
)) {

1107 if(
k
->
size
 != -1) {

1108 
	`Áûf
(
d©a
, "OperationÅimed outáfter %ld milliseconds with %"

1109 
CURL_FORMAT_CURL_OFF_T
 " out of %"

1110 
CURL_FORMAT_CURL_OFF_T
 " bytesÑeceived",

1111 
	`Cuæ_tvdiff
(
k
->
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
), k->
byãcou¡
,

1112 
k
->
size
);

1115 
	`Áûf
(
d©a
, "OperationÅimed outáfter %ld milliseconds with %"

1116 
CURL_FORMAT_CURL_OFF_T
 " bytesÑeceived",

1117 
	`Cuæ_tvdiff
(
k
->
now
, 
d©a
->
¥ogªss
.
t_°¨tsögÀ
), k->
byãcou¡
);

1119  
CURLE_OPERATION_TIMEDOUT
;

1128 if(!(
d©a
->
£t
.
›t_no_body
Ë&& (
k
->
size
 != -1) &&

1129 (
k
->
byãcou¡
 !k->
size
) &&

1130 #ifde‡
CURL_DO_LINEEND_CONV


1135 (
k
->
byãcou¡
 !(k->
size
 + 
d©a
->
°©e
.
¸lf_c⁄vîsi⁄s
)) &&

1137 !
d©a
->
ªq
.
√wuæ
) {

1138 
	`Áûf
(
d©a
, "å™s„∏˛o£d wôh %" 
CURL_FORMAT_CURL_OFF_T


1140 
k
->
size
 - k->
byãcou¡
);

1141  
CURLE_PARTIAL_FILE
;

1143 if(!(
d©a
->
£t
.
›t_no_body
) &&

1144 
k
->
chunk
 &&

1145 (
c⁄n
->
chunk
.
°©e
 !
CHUNK_STOP
)) {

1155 
	`Áûf
(
d©a
, "transfer closed with outstandingÑead dataÑemaining");

1156  
CURLE_PARTIAL_FILE
;

1158 if(
	`Cuæ_pgrsUpd©e
(
c⁄n
))

1159  
CURLE_ABORTED_BY_CALLBACK
;

1163 *
d⁄e
 = (0 =(
k
->
kìp⁄
&(
KEEP_RECV
|
KEEP_SEND
|

1164 
KEEP_RECV_PAUSE
|
KEEP_SEND_PAUSE
))Ë? 
TRUE
 : 
FALSE
;

1166  
CURLE_OK
;

1167 
	}
}

1176 
	$Cuæ_sögÀ_gësock
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

1177 
cuæ_sockë_t
 *
sock
,

1179 
numsocks
)

1181 c⁄° 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1182 
bôm≠
 = 
GETSOCK_BLANK
;

1183 
socködex
 = 0;

1185 if(
c⁄n
->
h™dÀr
->
≥rf‹m_gësock
)

1186  
c⁄n
->
h™dÀr
->
	`≥rf‹m_gësock
(c⁄n, 
sock
, 
numsocks
);

1188 if(
numsocks
 < 2)

1190  
GETSOCK_BLANK
;

1193 if((
d©a
->
ªq
.
kìp⁄
 & 
KEEP_RECVBITS
Ë=
KEEP_RECV
) {

1195 
	`DEBUGASSERT
(
c⁄n
->
sockfd
 !
CURL_SOCKET_BAD
);

1197 
bôm≠
 |
	`GETSOCK_READSOCK
(
socködex
);

1198 
sock
[
socködex
] = 
c⁄n
->
sockfd
;

1202 if((
d©a
->
ªq
.
kìp⁄
 & 
KEEP_SENDBITS
Ë=
KEEP_SEND
) {

1204 if((
c⁄n
->
sockfd
 !c⁄n->
wrôesockfd
) ||

1205 !(
d©a
->
ªq
.
kìp⁄
 & 
KEEP_RECV
)) {

1208 if(
d©a
->
ªq
.
kìp⁄
 & 
KEEP_RECV
)

1209 
socködex
++;

1211 
	`DEBUGASSERT
(
c⁄n
->
wrôesockfd
 !
CURL_SOCKET_BAD
);

1213 
sock
[
socködex
] = 
c⁄n
->
wrôesockfd
;

1216 
bôm≠
 |
	`GETSOCK_WRITESOCK
(
socködex
);

1219  
bôm≠
;

1220 
	}
}

1232 
	$Cuæ_¶ìp_time
(
cuæ_off_t
 
øã_bps
, cuæ_off_à
cur_øã_bps
,

1233 
pkt_size
)

1235 
cuæ_off_t
 
mö_¶ìp
 = 0;

1236 
cuæ_off_t
 
rv
 = 0;

1238 if(
øã_bps
 == 0)

1245 if(
cur_øã_bps
 > (
øã_bps
 + (rate_bps >> 10))) {

1247 
øã_bps
 -=Ñate_bps >> 6;

1248 
mö_¶ìp
 = 1;

1250 if(
cur_øã_bps
 < (
øã_bps
 - (rate_bps >> 10))) {

1252 
øã_bps
 +=Ñate_bps >> 6;

1259 
rv
 = ((
cuæ_off_t
)((
pkt_size
 * 8Ë* 1000Ë/ 
øã_bps
);

1264 if(
rv
 < 
mö_¶ìp
)

1265 
rv
 = 
mö_¶ìp
;

1270 if(
rv
 > 0x7fffffff)

1271 
rv
 = 0x7fffffff;

1273  ()
rv
;

1274 
	}
}

1279 
CURLcode
 
	$Cuæ_¥ëøns„r
(
Sessi⁄H™dÀ
 *
d©a
)

1281 
CURLcode
 
ªs
;

1282 if(!
d©a
->
ch™ge
.
uæ
) {

1284 
	`Áûf
(
d©a
, "No URL set!");

1285  
CURLE_URL_MALFORMAT
;

1291 
ªs
 = 
	`Cuæ_s¶_öô£ssi⁄s
(
d©a
, d©a->
£t
.
s¶
.
max_s¶_£ssi⁄s
);

1292 if(
ªs
)

1293  
ªs
;

1295 
d©a
->
£t
.
fﬁlowloˇti⁄
=0;

1296 
d©a
->
°©e
.
this_is_a_fﬁlow
 = 
FALSE
;

1297 
d©a
->
°©e
.
îr‹buf
 = 
FALSE
;

1298 
d©a
->
°©e
.
hâpvîsi⁄
 = 0;

1300 
d©a
->
°©e
.
s¶_c⁄√˘_ªåy
 = 
FALSE
;

1302 
d©a
->
°©e
.
auth¥obÀm
 = 
FALSE
;

1303 
d©a
->
°©e
.
authho°
.
w™t
 = d©a->
£t
.
hâ∑uth
;

1304 
d©a
->
°©e
.
auth¥oxy
.
w™t
 = d©a->
£t
.
¥oxyauth
;

1305 
	`Cuæ_ß„‰ì
(
d©a
->
öfo
.
wouldªdúe˘
);

1306 
d©a
->
öfo
.
wouldªdúe˘
 = 
NULL
;

1309 if(
d©a
->
ch™ge
.
cookõli°
)

1310 
	`Cuæ_cookõ_lﬂdfûes
(
d©a
);

1313 if(
d©a
->
ch™ge
.
ªsﬁve
)

1314 
ªs
 = 
	`Cuæ_lﬂdho°∑ús
(
d©a
);

1316 if(!
ªs
) {

1320 
d©a
->
°©e
.
Ælow_p‹t
 = 
TRUE
;

1322 #i‡
	`deföed
(
HAVE_SIGNAL
Ë&& deföed(
SIGPIPE
Ë&& !deföed(
HAVE_MSG_NOSIGNAL
)

1326 if(!
d©a
->
£t
.
no_sig«l
)

1327 
d©a
->
°©e
.
¥ev_sig«l
 = 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

1330 
	`Cuæ_öôöfo
(
d©a
);

1331 
	`Cuæ_pgrsSèπNow
(
d©a
);

1333 if(
d©a
->
£t
.
timeout
)

1334 
	`Cuæ_expúe
(
d©a
, d©a->
£t
.
timeout
);

1336 if(
d©a
->
£t
.
c⁄√˘timeout
)

1337 
	`Cuæ_expúe
(
d©a
, d©a->
£t
.
c⁄√˘timeout
);

1342 
d©a
->
°©e
.
authho°
.
picked
 &d©a->°©e.authho°.
w™t
;

1343 
d©a
->
°©e
.
auth¥oxy
.
picked
 &d©a->°©e.auth¥oxy.
w™t
;

1346  
ªs
;

1347 
	}
}

1352 
CURLcode
 
	$Cuæ_po°å™s„r
(
Sessi⁄H™dÀ
 *
d©a
)

1354 #i‡
	`deföed
(
HAVE_SIGNAL
Ë&& deföed(
SIGPIPE
Ë&& !deföed(
HAVE_MSG_NOSIGNAL
)

1356 if(!
d©a
->
£t
.
no_sig«l
)

1357 
	`sig«l
(
SIGPIPE
, 
d©a
->
°©e
.
¥ev_sig«l
);

1359 ()
d©a
;

1362  
CURLE_OK
;

1363 
	}
}

1365 #i‚de‡
CURL_DISABLE_HTTP


1370 
size_t
 
	$°æí_uæ
(c⁄° *
uæ
)

1372 c⁄° *
±r
;

1373 
size_t
 
√wÀn
=0;

1374 
boﬁ
 
À·
=
TRUE
;

1376 
±r
=
uæ
; *ptr;Ötr++) {

1377 *
±r
) {

1379 
À·
=
FALSE
;

1382 
√wÀn
++;

1385 if(
À·
)

1386 
√wÀn
+=3;

1388 
√wÀn
++;

1392  
√wÀn
;

1393 
	}
}

1398 
	$°r˝y_uæ
(*
ouçut
, c⁄° *
uæ
)

1401 
boﬁ
 
À·
=
TRUE
;

1402 c⁄° *
ùå
;

1403 *
›å
 = 
ouçut
;

1404 
ùå
 = 
uæ
;

1405 *
ùå
;

1406 
ùå
++) {

1407 *
ùå
) {

1409 
À·
=
FALSE
;

1412 *
›å
++=*
ùå
;

1415 if(
À·
) {

1416 *
›å
++='%';

1417 *
›å
++='2';

1418 *
›å
++='0';

1421 *
›å
++='+';

1425 *
›å
=0;

1427 
	}
}

1432 
boﬁ
 
	$is_absﬁuã_uæ
(c⁄° *
uæ
)

1434 
¥Ÿ
[16];

1435 
Àâî
;

1437  (2 =
	`ssˇnf
(
uæ
, "%15[^?&/:]://%c", 
¥Ÿ
, &
Àâî
)Ë? 
TRUE
 : 
FALSE
;

1438 
	}
}

1446 *
	$c⁄ˇt_uæ
(c⁄° *
ba£
, c⁄° *
ªluæ
)

1453 *
√we°
;

1454 *
¥Ÿ£p
;

1455 *
∑th£p
;

1456 
size_t
 
√wÀn
;

1458 c⁄° *
u£uæ
 = 
ªluæ
;

1459 
size_t
 
uæÀn
;

1463 *
uæ_˛⁄e
=
	`°rdup
(
ba£
);

1465 if(!
uæ_˛⁄e
)

1466  
NULL
;

1469 
¥Ÿ£p
=
	`°r°r
(
uæ_˛⁄e
, "//");

1470 if(!
¥Ÿ£p
)

1471 
¥Ÿ£p
=
uæ_˛⁄e
;

1473 
¥Ÿ£p
+=2;

1475 if('/' !
ªluæ
[0]) {

1476 
Àvñ
=0;

1480 
∑th£p
 = 
	`°rchr
(
¥Ÿ£p
, '?');

1481 if(
∑th£p
)

1482 *
∑th£p
=0;

1488 if(
u£uæ
[0] != '?') {

1489 
∑th£p
 = 
	`°ºchr
(
¥Ÿ£p
, '/');

1490 if(
∑th£p
)

1491 *
∑th£p
=0;

1496 
∑th£p
 = 
	`°rchr
(
¥Ÿ£p
, '/');

1497 if(
∑th£p
)

1498 
¥Ÿ£p
 = 
∑th£p
+1;

1500 
¥Ÿ£p
 = 
NULL
;

1505 if((
u£uæ
[0] == '.') && (useurl[1] == '/'))

1506 
u£uæ
+=2;

1508 (
u£uæ
[0] == '.') &&

1509 (
u£uæ
[1] == '.') &&

1510 (
u£uæ
[2] == '/')) {

1511 
Àvñ
++;

1512 
u£uæ
+=3;

1515 if(
¥Ÿ£p
) {

1516 
Àvñ
--) {

1518 
∑th£p
 = 
	`°ºchr
(
¥Ÿ£p
, '/');

1519 if(
∑th£p
)

1520 *
∑th£p
=0;

1522 *
¥Ÿ£p
=0;

1531 if((
ªluæ
[0] == '/') && (relurl[1] == '/')) {

1534 *
¥Ÿ£p
=0;

1535 
u£uæ
 = &
ªluæ
[2];

1541 
∑th£p
 = 
	`°rchr
(
¥Ÿ£p
, '/');

1542 if(
∑th£p
) {

1546 *
£p
 = 
	`°rchr
(
¥Ÿ£p
, '?');

1547 if(
£p
 && (£∞< 
∑th£p
))

1548 
∑th£p
 = 
£p
;

1549 *
∑th£p
=0;

1556 
∑th£p
 = 
	`°rchr
(
¥Ÿ£p
, '?');

1557 if(
∑th£p
)

1558 *
∑th£p
=0;

1568 
√wÀn
 = 
	`°æí_uæ
(
u£uæ
);

1570 
uæÀn
 = 
	`°æí
(
uæ_˛⁄e
);

1572 
√we°
 = 
	`mÆloc
(
uæÀn
 + 1 +

1573 
√wÀn
 + 1 );

1575 if(!
√we°
) {

1576 
	`‰ì
(
uæ_˛⁄e
);

1577  
NULL
;

1581 
	`mem˝y
(
√we°
, 
uæ_˛⁄e
, 
uæÀn
);

1584 if(('/' =
u£uæ
[0]Ë|| (
¥Ÿ£p
 && !*protsep) || ('?' == useurl[0]))

1587 
√we°
[
uæÀn
++]='/';

1590 
	`°r˝y_uæ
(&
√we°
[
uæÀn
], 
u£uæ
);

1592 
	`‰ì
(
uæ_˛⁄e
);

1594  
√we°
;

1595 
	}
}

1602 
CURLcode
 
	$Cuæ_fﬁlow
(
Sessi⁄H™dÀ
 *
d©a
,

1603 *
√wuæ
,

1606 
fﬁlowty≥
 
ty≥
)

1608 #ifde‡
CURL_DISABLE_HTTP


1609 ()
d©a
;

1610 ()
√wuæ
;

1611 ()
ty≥
;

1613  
CURLE_TOO_MANY_REDIRECTS
;

1617 
boﬁ
 
dißŒowp‹t
 = 
FALSE
;

1619 if(
ty≥
 =
FOLLOW_REDIR
) {

1620 if((
d©a
->
£t
.
maxªdús
 != -1) &&

1621 (
d©a
->
£t
.
fﬁlowloˇti⁄
 >d©a->£t.
maxªdús
)) {

1622 
	`Áûf
(
d©a
,"Maximum (%ldËªdúe˘†fﬁlowed", d©a->
£t
.
maxªdús
);

1623  
CURLE_TOO_MANY_REDIRECTS
;

1627 
d©a
->
°©e
.
this_is_a_fﬁlow
 = 
TRUE
;

1629 
d©a
->
£t
.
fﬁlowloˇti⁄
++;

1631 if(
d©a
->
£t
.
hâp_auto_ª„ªr
) {

1636 if(
d©a
->
ch™ge
.
ª„ªr_Æloc
) {

1637 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
ª„ªr
);

1638 
d©a
->
ch™ge
.
ª„ªr_Æloc
 = 
FALSE
;

1641 
d©a
->
ch™ge
.
ª„ªr
 = 
	`°rdup
(d©a->ch™ge.
uæ
);

1642 if(!
d©a
->
ch™ge
.
ª„ªr
)

1643  
CURLE_OUT_OF_MEMORY
;

1644 
d©a
->
ch™ge
.
ª„ªr_Æloc
 = 
TRUE
;

1648 if(!
	`is_absﬁuã_uæ
(
√wuæ
)) {

1653 *
absﬁuã
 = 
	`c⁄ˇt_uæ
(
d©a
->
ch™ge
.
uæ
, 
√wuæ
);

1654 if(!
absﬁuã
)

1655  
CURLE_OUT_OF_MEMORY
;

1656 
	`‰ì
(
√wuæ
);

1657 
√wuæ
 = 
absﬁuã
;

1661 
dißŒowp‹t
 = 
TRUE
;

1663 if(
	`°rchr
(
√wuæ
, ' ')) {

1666 *
√we°
;

1667 
size_t
 
√wÀn
 = 
	`°æí_uæ
(
√wuæ
);

1669 
√we°
 = 
	`mÆloc
(
√wÀn
+1);

1670 if(!
√we°
)

1671  
CURLE_OUT_OF_MEMORY
;

1672 
	`°r˝y_uæ
(
√we°
, 
√wuæ
);

1674 
	`‰ì
(
√wuæ
);

1675 
√wuæ
 = 
√we°
;

1680 if(
ty≥
 =
FOLLOW_FAKE
) {

1683 
d©a
->
öfo
.
wouldªdúe˘
 = 
√wuæ
;

1684  
CURLE_OK
;

1687 if(
dißŒowp‹t
)

1688 
d©a
->
°©e
.
Ælow_p‹t
 = 
FALSE
;

1690 if(
d©a
->
ch™ge
.
uæ_Æloc
) {

1691 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
uæ
);

1692 
d©a
->
ch™ge
.
uæ_Æloc
 = 
FALSE
;

1695 
d©a
->
ch™ge
.
uæ
 = 
√wuæ
;

1696 
d©a
->
ch™ge
.
uæ_Æloc
 = 
TRUE
;

1697 
√wuæ
 = 
NULL
;

1699 
	`öfof
(
d©a
, "Issuê™ŸhîÑeque°Åÿthi†URL: '%s'\n", d©a->
ch™ge
.
uæ
);

1708 
d©a
->
öfo
.
hâpcode
) {

1738 if((
d©a
->
£t
.
hâ¥eq
 =
HTTPREQ_POST


1739 || 
d©a
->
£t
.
hâ¥eq
 =
HTTPREQ_POST_FORM
)

1740 && !(
d©a
->
£t
.
kìp_po°
 & 
CURL_REDIR_POST_301
)) {

1741 
	`öfof
(
d©a
, "Switch from POSTÅo GET\n");

1742 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_GET
;

1762 if((
d©a
->
£t
.
hâ¥eq
 =
HTTPREQ_POST


1763 || 
d©a
->
£t
.
hâ¥eq
 =
HTTPREQ_POST_FORM
)

1764 && !(
d©a
->
£t
.
kìp_po°
 & 
CURL_REDIR_POST_302
)) {

1765 
	`öfof
(
d©a
, "Switch from POSTÅo GET\n");

1766 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_GET
;

1773 if(
d©a
->
£t
.
hâ¥eq
 !
HTTPREQ_GET


1774 && !(
d©a
->
£t
.
kìp_po°
 & 
CURL_REDIR_POST_303
)) {

1775 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_GET
;

1776 
	`öfof
(
d©a
, "Disables POST, goes with %s\n",

1777 
d©a
->
£t
.
›t_no_body
?"HEAD":"GET");

1795 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_REDIRECT
);

1796 
	`Cuæ_pgrsRe£tTimesSizes
(
d©a
);

1798  
CURLE_OK
;

1800 
	}
}

1802 
CURLcode


1803 
	$Cuæ_ªc⁄√˘_ªque°
(
c⁄√˘d©a
 **
c⁄≈
)

1805 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1806 
c⁄√˘d©a
 *
c⁄n
 = *
c⁄≈
;

1807 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1815 
	`öfof
(
d©a
, "Re-used connection seems dead, getáÇew one\n");

1817 
	`c⁄n˛o£
(
c⁄n
, "Reconnect dead connection");

1818 
ªsu…
 = 
	`Cuæ_d⁄e
(&
c⁄n
,Ñesu…, 
FALSE
);

1822 *
c⁄≈
 = 
NULL
;

1831 if((
CURLE_OK
 =
ªsu…
Ë|| (
CURLE_SEND_ERROR
 ==Ñesult)) {

1832 
boﬁ
 
async
;

1833 
boﬁ
 
¥Ÿocﬁ_d⁄e
 = 
TRUE
;

1836 
ªsu…
 = 
	`Cuæ_c⁄√˘
(
d©a
, 
c⁄≈
, &
async
, &
¥Ÿocﬁ_d⁄e
);

1837 if(
CURLE_OK
 =
ªsu…
) {

1840 
c⁄n
 = *
c⁄≈
;

1841 if(
async
) {

1844 
ªsu…
 = 
	`Cuæ_ªsﬁvî_waô_ªsﬁv
(
c⁄n
, 
NULL
);

1845 if(
ªsu…
)

1846  
ªsu…
;

1849 
ªsu…
 = 
	`Cuæ_async_ªsﬁved
(
c⁄n
, &
¥Ÿocﬁ_d⁄e
);

1850 if(
ªsu…
)

1851  
ªsu…
;

1856  
ªsu…
;

1857 
	}
}

1862 
CURLcode
 
	$Cuæ_ªåy_ªque°
(
c⁄√˘d©a
 *
c⁄n
,

1863 **
uæ
)

1865 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1867 *
uæ
 = 
NULL
;

1871 if(
d©a
->
£t
.
u∂ﬂd
 &&

1872 !(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&(
PROTO_FAMILY_HTTP
|
CURLPROTO_RTSP
)))

1873  
CURLE_OK
;

1875 if–
d©a
->
°©e
.
s¶_c⁄√˘_ªåy
 ||

1876 ((
d©a
->
ªq
.
byãcou¡
 +

1877 
d©a
->
ªq
.
hódîbyãcou¡
 == 0) &&

1878 
c⁄n
->
bôs
.
ªu£
 &&

1879 !
d©a
->
£t
.
›t_no_body
 &&

1880 
d©a
->
£t
.
π•ªq
 !
RTSPREQ_RECEIVE
)) {

1885 
	`öfof
(
c⁄n
->
d©a
, "Connection died,Ñetryingá fresh connect\n");

1886 *
uæ
 = 
	`°rdup
(
c⁄n
->
d©a
->
ch™ge
.url);

1887 if(!*
uæ
)

1888  
CURLE_OUT_OF_MEMORY
;

1890 
	`c⁄n˛o£
(
c⁄n
, "retry");

1891 
c⁄n
->
bôs
.
ªåy
 = 
TRUE
;

1898 if(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&
PROTO_FAMILY_HTTP
) {

1899 
HTTP
 *
hâp
 = 
d©a
->
ªq
.
¥Ÿ›
;

1900 if(
hâp
->
wrôebyãcou¡
)

1901  
	`Cuæ_ªadªwöd
(
c⁄n
);

1904  
CURLE_OK
;

1905 
	}
}

1912 
	$Cuæ_£tup_å™s„r
(

1913 
c⁄√˘d©a
 *
c⁄n
,

1914 
socködex
,

1915 
cuæ_off_t
 
size
,

1916 
boﬁ
 
gëhódî
,

1917 
cuæ_off_t
 *
byãcou¡p
,

1918 
wrôesocködex
,

1920 
cuæ_off_t
 *
wrôecou¡p


1923 
Sessi⁄H™dÀ
 *
d©a
;

1924 
SögÀReque°
 *
k
;

1926 
	`DEBUGASSERT
(
c⁄n
 !
NULL
);

1928 
d©a
 = 
c⁄n
->data;

1929 
k
 = &
d©a
->
ªq
;

1931 
	`DEBUGASSERT
((
socködex
 <= 1) && (sockindex >= -1));

1934 
c⁄n
->
sockfd
 = 
socködex
 == -1 ?

1935 
CURL_SOCKET_BAD
 : 
c⁄n
->
sock
[
socködex
];

1936 
c⁄n
->
wrôesockfd
 = 
wrôesocködex
 == -1 ?

1937 
CURL_SOCKET_BAD
:
c⁄n
->
sock
[
wrôesocködex
];

1938 
k
->
gëhódî
 = getheader;

1940 
k
->
size
 = size;

1941 
k
->
byãcou¡p
 = bytecountp;

1942 
k
->
wrôebyãcou¡p
 = 
wrôecou¡p
;

1948 if(!
k
->
gëhódî
) {

1949 
k
->
hódî
 = 
FALSE
;

1950 if(
size
 > 0)

1951 
	`Cuæ_pgrsSëDow∆ﬂdSize
(
d©a
, 
size
);

1954 if(
k
->
gëhódî
 || !
d©a
->
£t
.
›t_no_body
) {

1956 if(
c⁄n
->
sockfd
 !
CURL_SOCKET_BAD
)

1957 
k
->
kìp⁄
 |
KEEP_RECV
;

1959 if(
c⁄n
->
wrôesockfd
 !
CURL_SOCKET_BAD
) {

1960 
HTTP
 *
hâp
 = 
d©a
->
ªq
.
¥Ÿ›
;

1970 if((
d©a
->
°©e
.
ex≥˘100hódî
) &&

1971 (
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
&
PROTO_FAMILY_HTTP
) &&

1972 (
hâp
->
£ndög
 =
HTTPSEND_BODY
)) {

1974 
k
->
exp100
 = 
EXP100_AWAITING_CONTINUE
;

1975 
k
->
°¨t100
 = 
	`Cuæ_tvnow
();

1979 
	`Cuæ_expúe
(
d©a
, d©a->
£t
.
ex≥˘_100_timeout
);

1982 if(
d©a
->
°©e
.
ex≥˘100hódî
)

1985 
k
->
exp100
 = 
EXP100_SENDING_REQUEST
;

1988 
k
->
kìp⁄
 |
KEEP_SEND
;

1993 
	}
}

	@lib/transfer.h

1 #i‚de‡
HEADER_CURL_TRANSFER_H


2 
	#HEADER_CURL_TRANSFER_H


	)

25 
CURLcode
 
Cuæ_¥ëøns„r
(
Sessi⁄H™dÀ
 *
d©a
);

26 
CURLcode
 
Cuæ_£c⁄d_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
);

27 
CURLcode
 
Cuæ_po°å™s„r
(
Sessi⁄H™dÀ
 *
d©a
);

30 
	mFOLLOW_NONE
,

32 
	mFOLLOW_FAKE
,

33 
	mFOLLOW_RETRY
,

35 
	mFOLLOW_REDIR
,

36 
	mFOLLOW_LAST


37 } 
	tfﬁlowty≥
;

39 
CURLcode
 
Cuæ_fﬁlow
(
Sessi⁄H™dÀ
 *
d©a
, *
√wuæ
,

40 
fﬁlowty≥
 
ty≥
);

43 
CURLcode
 
Cuæ_ªadwrôe
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

44 
Cuæ_sögÀ_gësock
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

45 
cuæ_sockë_t
 *
socks
,

46 
numsocks
);

47 
CURLcode
 
Cuæ_ªadªwöd
(
c⁄√˘d©a
 *
c⁄n
);

48 
CURLcode
 
Cuæ_fûÃódbuf„r
(
c⁄√˘d©a
 *
c⁄n
, 
byãs
, *
ƒódp
);

49 
CURLcode
 
Cuæ_ªc⁄√˘_ªque°
(
c⁄√˘d©a
 **
c⁄≈
);

50 
CURLcode
 
Cuæ_ªåy_ªque°
(
c⁄√˘d©a
 *
c⁄n
, **
uæ
);

51 
boﬁ
 
Cuæ_mìts_timec⁄dôi⁄
(
Sessi⁄H™dÀ
 *
d©a
, 
time_t
 
timeofdoc
);

55 
Cuæ_£tup_å™s„r
 (
c⁄√˘d©a
 *
d©a
,

56 
socködex
,

57 
cuæ_off_t
 
size
,

58 
boﬁ
 
gëhódî
,

59 
cuæ_off_t
 *
byãcou¡p
,

60 
wrôesocködex
,

63 
cuæ_off_t
 *
wrôecou¡p


66 
Cuæ_¶ìp_time
(
cuæ_off_t
 
øã_bps
, cuæ_off_à
cur_øã_bps
,

67 
pkt_size
);

	@lib/url.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
HAVE_NETINET_IN_H


26 
	~<√töë/ö.h
>

28 #ifde‡
HAVE_NETDB_H


29 
	~<√tdb.h
>

31 #ifde‡
HAVE_ARPA_INET_H


32 
	~<¨∑/öë.h
>

34 #ifde‡
HAVE_NET_IF_H


35 
	~<√t/if.h
>

37 #ifde‡
HAVE_SYS_IOCTL_H


38 
	~<sys/io˘l.h
>

41 #ifde‡
HAVE_SYS_PARAM_H


42 
	~<sys/∑øm.h
>

45 #ifde‡
__VMS


46 
	~<ö.h
>

47 
	~<öë.h
>

50 #i‚de‡
HAVE_SOCKET


54 #ifde‡
HAVE_LIMITS_H


55 
	~<limôs.h
>

58 #ifde‡
USE_LIBIDN


59 
	~<id«.h
>

60 
	~<éd.h
>

61 
	~<°rög¥ï.h
>

62 #ifde‡
HAVE_IDN_FREE_H


63 
	~<idn-‰ì.h
>

66 
idn_‰ì
 (*
±r
);

68 #i‚de‡
HAVE_IDN_FREE


70 
	#idn_‰ì
(
x
Ë(
‰ì
)(x)

	)

72 #ñi‡
deföed
(
USE_WIN32_IDN
)

74 
cuæ_wö32_idn_to_ascii
(c⁄° *
ö
, **
out
);

77 
	~"uæd©a.h
"

78 
	~"√åc.h
"

80 
	~"f‹md©a.h
"

81 
	~"vés/vés.h
"

82 
	~"ho°ù.h
"

83 
	~"å™s„r.h
"

84 
	~"£ndf.h
"

85 
	~"¥ogªss.h
"

86 
	~"cookõ.h
"

87 
	~"°ªquÆ.h
"

88 
	~"°ªº‹.h
"

89 
	~"esˇ≥.h
"

90 
	~"°πok.h
"

91 
	~"sh¨e.h
"

92 
	~"c⁄ã¡_ícodög.h
"

93 
	~"hâp_dige°.h
"

94 
	~"hâp_√gŸüã.h
"

95 
	~"£À˘.h
"

96 
	~"mu…iif.h
"

97 
	~"ósyif.h
"

98 
	~"•ìdcheck.h
"

99 
	~"øw°r.h
"

100 
	~"w¨∆ess.h
"

101 
	~"n⁄-ascii.h
"

102 
	~"öë_±⁄.h
"

105 
	~"·p.h
"

106 
	~"di˘.h
"

107 
	~"ã ë.h
"

108 
	~"t·p.h
"

109 
	~"hâp.h
"

110 
	~"fûe.h
"

111 
	~"cuæ_ld≠.h
"

112 
	~"ssh.h
"

113 
	~"im≠.h
"

114 
	~"uæ.h
"

115 
	~"c⁄√˘.h
"

116 
	~"öë_¡›.h
"

117 
	~"cuæ_¡lm.h
"

118 
	~"cuæ_¡lm_wb.h
"

119 
	~"socks.h
"

120 
	~"cuæ_πmp.h
"

121 
	~"g›hî.h
"

122 
	~"hâp_¥oxy.h
"

123 
	~"bundÀs.h
"

124 
	~"c⁄nˇche.h
"

125 
	~"mu…ih™dÀ.h
"

126 
	~"pùñöe.h
"

127 
	~"dŸdŸ.h
"

129 
	#_MPRINTF_REPLACE


	)

130 
	~<cuæ/m¥ötf.h
>

132 
	~"cuæ_mem‹y.h
"

134 
	~"memdebug.h
"

137 
c⁄√˘d©a
 *

138 
föd_ﬁde°_idÀ_c⁄√˘i⁄
(
Sessi⁄H™dÀ
 *
d©a
);

139 
c⁄√˘d©a
 *

140 
föd_ﬁde°_idÀ_c⁄√˘i⁄_ö_bundÀ
(
Sessi⁄H™dÀ
 *
d©a
,

141 
c⁄√˘bundÀ
 *
bundÀ
);

142 
c⁄n_‰ì
(
c⁄√˘d©a
 *
c⁄n
);

143 
sig«lPùeClo£
(
cuæ_Œi°
 *
pùñöe
, 
boﬁ
 
pùe_broke
);

144 
CURLcode
 
do_öô
(
c⁄√˘d©a
 *
c⁄n
);

145 
CURLcode
 
∑r£_uæ_logö
(
Sessi⁄H™dÀ
 *
d©a
,

146 
c⁄√˘d©a
 *
c⁄n
,

147 **
u£Ωå
, **
∑sswd±r
,

148 **
›ti⁄•å
);

149 
CURLcode
 
∑r£_logö_dëaûs
(c⁄° *
logö
, c⁄° 
size_t
 
Àn
,

150 **
u£Ωå
, **
∑sswd±r
,

151 **
›ti⁄•å
);

156 c⁄° 
Cuæ_h™dÀr
 * c⁄° 
	g¥Ÿocﬁs
[] = {

158 #i‚de‡
CURL_DISABLE_HTTP


159 &
Cuæ_h™dÀr_hâp
,

162 #i‡
deföed
(
USE_SSL
Ë&& !deföed(
CURL_DISABLE_HTTP
)

163 &
Cuæ_h™dÀr_hâps
,

166 #i‚de‡
CURL_DISABLE_FTP


167 &
Cuæ_h™dÀr_·p
,

170 #i‡
deföed
(
USE_SSL
Ë&& !deföed(
CURL_DISABLE_FTP
)

171 &
Cuæ_h™dÀr_·ps
,

174 #i‚de‡
CURL_DISABLE_TELNET


175 &
Cuæ_h™dÀr_ã ë
,

178 #i‚de‡
CURL_DISABLE_DICT


179 &
Cuæ_h™dÀr_di˘
,

182 #i‚de‡
CURL_DISABLE_LDAP


183 &
Cuæ_h™dÀr_ld≠
,

184 #i‡!
deföed
(
CURL_DISABLE_LDAPS
) && \

185 ((
deföed
(
USE_OPENLDAP
Ë&& deföed(
USE_SSL
)) || \

186 (!
deföed
(
USE_OPENLDAP
Ë&& deföed(
HAVE_LDAP_SSL
)))

187 &
Cuæ_h™dÀr_ld≠s
,

191 #i‚de‡
CURL_DISABLE_FILE


192 &
Cuæ_h™dÀr_fûe
,

195 #i‚de‡
CURL_DISABLE_TFTP


196 &
Cuæ_h™dÀr_t·p
,

199 #ifde‡
USE_LIBSSH2


200 &
Cuæ_h™dÀr_s˝
,

201 &
Cuæ_h™dÀr_s·p
,

204 #i‚de‡
CURL_DISABLE_IMAP


205 &
Cuæ_h™dÀr_im≠
,

206 #ifde‡
USE_SSL


207 &
Cuæ_h™dÀr_im≠s
,

211 #i‚de‡
CURL_DISABLE_POP3


212 &
Cuæ_h™dÀr_p›3
,

213 #ifde‡
USE_SSL


214 &
Cuæ_h™dÀr_p›3s
,

218 #i‚de‡
CURL_DISABLE_SMTP


219 &
Cuæ_h™dÀr_smç
,

220 #ifde‡
USE_SSL


221 &
Cuæ_h™dÀr_smçs
,

225 #i‚de‡
CURL_DISABLE_RTSP


226 &
Cuæ_h™dÀr_π•
,

229 #i‚de‡
CURL_DISABLE_GOPHER


230 &
Cuæ_h™dÀr_g›hî
,

233 #ifde‡
USE_LIBRTMP


234 &
Cuæ_h™dÀr_πmp
,

235 &
Cuæ_h™dÀr_πm±
,

236 &
Cuæ_h™dÀr_πm≥
,

237 &
Cuæ_h™dÀr_πm±e
,

238 &
Cuæ_h™dÀr_πmps
,

239 &
Cuæ_h™dÀr_πm±s
,

242 (
Cuæ_h™dÀr
 *Ë
NULL


249 c⁄° 
Cuæ_h™dÀr
 
	gCuæ_h™dÀr_dummy
 = {

251 
ZERO_NULL
,

252 
ZERO_NULL
,

253 
ZERO_NULL
,

254 
ZERO_NULL
,

255 
ZERO_NULL
,

256 
ZERO_NULL
,

257 
ZERO_NULL
,

258 
ZERO_NULL
,

259 
ZERO_NULL
,

260 
ZERO_NULL
,

261 
ZERO_NULL
,

262 
ZERO_NULL
,

263 
ZERO_NULL
,

266 
PROTOPT_NONE


269 
	$Cuæ_‰ì£t
(
Sessi⁄H™dÀ
 *
d©a
)

272 
dup°rög
 
i
;

273 
i
=(
dup°rög
)0; i < 
STRING_LAST
; i++)

274 
	`Cuæ_ß„‰ì
(
d©a
->
£t
.
°r
[
i
]);

276 if(
d©a
->
ch™ge
.
ª„ªr_Æloc
) {

277 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
ª„ªr
);

278 
d©a
->
ch™ge
.
ª„ªr_Æloc
 = 
FALSE
;

280 
d©a
->
ch™ge
.
ª„ªr
 = 
NULL
;

281 if(
d©a
->
ch™ge
.
uæ_Æloc
) {

282 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
uæ
);

283 
d©a
->
ch™ge
.
uæ_Æloc
 = 
FALSE
;

285 
d©a
->
ch™ge
.
uæ
 = 
NULL
;

286 
	}
}

288 
CURLcode
 
	$£t°r›t
(**
ch¨p
, *
s
)

293 
	`Cuæ_ß„‰ì
(*
ch¨p
);

295 if(
s
) {

296 
s
 = 
	`°rdup
(s);

298 if(!
s
)

299  
CURLE_OUT_OF_MEMORY
;

301 *
ch¨p
 = 
s
;

304  
CURLE_OK
;

305 
	}
}

307 
CURLcode
 
	$£t°r›t_u£Ωwd
(*
›ti⁄
, **
u£Ω
, **
∑sswdp
)

309 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

310 *
u£r
 = 
NULL
;

311 *
∑sswd
 = 
NULL
;

315 if(
›ti⁄
) {

316 
ªsu…
 = 
	`∑r£_logö_dëaûs
(
›ti⁄
, 
	`°æí
(option),

317 (
u£Ω
 ? &
u£r
 : 
NULL
),

318 (
∑sswdp
 ? &
∑sswd
 : 
NULL
),

319 
NULL
);

322 if(!
ªsu…
) {

324 if(
u£Ω
) {

325 if(!
u£r
 && 
›ti⁄
 && option[0] == ':') {

327 
u£r
 = 
	`°rdup
("");

328 if(!
u£r
)

329 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

332 
	`Cuæ_ß„‰ì
(*
u£Ω
);

333 *
u£Ω
 = 
u£r
;

337 if(
∑sswdp
) {

338 
	`Cuæ_ß„‰ì
(*
∑sswdp
);

339 *
∑sswdp
 = 
∑sswd
;

343  
ªsu…
;

344 
	}
}

346 
CURLcode
 
	$Cuæ_dup£t
(
Sessi⁄H™dÀ
 *
d°
, Sessi⁄H™dÀ *
§c
)

348 
CURLcode
 
r
 = 
CURLE_OK
;

349 
dup°rög
 
i
;

353 
d°
->
£t
 = 
§c
->set;

356 
	`mem£t
(
d°
->
£t
.
°r
, 0, 
STRING_LAST
 * (*));

359 
i
=(
dup°rög
)0; i< 
STRING_LAST
; i++) {

360 
r
 = 
	`£t°r›t
(&
d°
->
£t
.
°r
[
i
], 
§c
->set.str[i]);

361 if(
r
 !
CURLE_OK
)

366  
r
;

367 
	}
}

378 
CURLcode
 
	$Cuæ_˛o£
(
Sessi⁄H™dÀ
 *
d©a
)

380 
Cuæ_mu…i
 *
m
;

382 if(!
d©a
)

383  
CURLE_OK
;

385 
	`Cuæ_expúe
(
d©a
, 0);

387 
m
 = 
d©a
->
mu…i
;

389 if(
m
)

392 
	`cuæ_mu…i_ªmove_h™dÀ
(
d©a
->
mu…i
, data);

394 if(
d©a
->
mu…i_ósy
)

397 
	`cuæ_mu…i_˛ónup
(
d©a
->
mu…i_ósy
);

402 if(
d©a
->
°©e
.
timeouéi°
) {

403 
	`Cuæ_Œi°_de°roy
(
d©a
->
°©e
.
timeouéi°
, 
NULL
);

404 
d©a
->
°©e
.
timeouéi°
 = 
NULL
;

407 
d©a
->
magic
 = 0;

411 if(
d©a
->
°©e
.
ønge°rögÆloc
)

412 
	`‰ì
(
d©a
->
°©e
.
ønge
);

415 
	`Cuæ_ß„‰ì
(
d©a
->
°©e
.
∑thbuf„r
);

416 
d©a
->
°©e
.
∑th
 = 
NULL
;

419 
	`Cuæ_‰ì_ªque°_°©e
(
d©a
);

422 
	`Cuæ_s¶_˛o£_Æl
(
d©a
);

423 
	`Cuæ_ß„‰ì
(
d©a
->
°©e
.
fú°_ho°
);

424 
	`Cuæ_ß„‰ì
(
d©a
->
°©e
.
s¸©ch
);

425 
	`Cuæ_s¶_‰ì_˚πöfo
(
d©a
);

427 if(
d©a
->
ch™ge
.
ª„ªr_Æloc
) {

428 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
ª„ªr
);

429 
d©a
->
ch™ge
.
ª„ªr_Æloc
 = 
FALSE
;

431 
d©a
->
ch™ge
.
ª„ªr
 = 
NULL
;

433 if(
d©a
->
ch™ge
.
uæ_Æloc
) {

434 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
uæ
);

435 
d©a
->
ch™ge
.
uæ_Æloc
 = 
FALSE
;

437 
d©a
->
ch™ge
.
uæ
 = 
NULL
;

439 
	`Cuæ_ß„‰ì
(
d©a
->
°©e
.
hódîbuff
);

441 
	`Cuæ_Êush_cookõs
(
d©a
, 1);

443 
	`Cuæ_dige°_˛ónup
(
d©a
);

445 
	`Cuæ_ß„‰ì
(
d©a
->
öfo
.
c⁄ã¡ty≥
);

446 
	`Cuæ_ß„‰ì
(
d©a
->
öfo
.
wouldªdúe˘
);

449 
	`Cuæ_ªsﬁvî_˛ónup
(
d©a
->
°©e
.
ªsﬁvî
);

451 
	`Cuæ_c⁄vît_˛o£
(
d©a
);

454 if(
d©a
->
sh¨e
) {

455 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_SHARE
, 
CURL_LOCK_ACCESS_SINGLE
);

456 
d©a
->
sh¨e
->
dúty
--;

457 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_SHARE
);

460 
	`Cuæ_‰ì£t
(
d©a
);

461 
	`‰ì
(
d©a
);

462  
CURLE_OK
;

463 
	}
}

469 
CURLcode
 
	$Cuæ_öô_u£rdeföed
(
U£rDeföed
 *
£t
)

471 
CURLcode
 
ªs
 = 
CURLE_OK
;

473 
£t
->
out
 = 
°dout
;

474 
£t
->
ö
 = 
°dö
;

475 
£t
->
îr
 = 
°dîr
;

478 
£t
->
fwrôe_func
 = (
cuæ_wrôe_ˇŒback
)
fwrôe
;

481 
£t
->
‰ód_func
 = (
cuæ_ªad_ˇŒback
)
‰ód
;

482 
£t
->
is_‰ód_£t
 = 0;

483 
£t
->
is_fwrôe_£t
 = 0;

485 
£t
->
£ek_func
 = 
ZERO_NULL
;

486 
£t
->
£ek_˛õ¡
 = 
ZERO_NULL
;

489 
£t
->
c⁄v‰om√tw‹k
 = 
ZERO_NULL
;

490 
£t
->
c⁄vt⁄ëw‹k
 = 
ZERO_NULL
;

491 
£t
->
c⁄v‰omutf8
 = 
ZERO_NULL
;

493 
£t
->
fûesize
 = -1;

494 
£t
->
po°fõldsize
 = -1;

495 
£t
->
maxªdús
 = -1;

497 
£t
->
hâ¥eq
 = 
HTTPREQ_GET
;

498 
£t
->
π•ªq
 = 
RTSPREQ_OPTIONS
;

499 
£t
->
·p_u£_ïsv
 = 
TRUE
;

500 
£t
->
·p_u£_ïπ
 = 
TRUE
;

501 
£t
->
·p_u£_¥ë
 = 
FALSE
;

502 
£t
->
·p_fûemëhod
 = 
FTPFILE_MULTICWD
;

504 
£t
->
dns_ˇche_timeout
 = 60;

507 
£t
->
s¶
.
max_s¶_£ssi⁄s
 = 5;

509 
£t
->
¥oxyp‹t
 = 
CURL_DEFAULT_PROXY_PORT
;

510 
£t
->
¥oxyty≥
 = 
CURLPROXY_HTTP
;

511 
£t
->
hâ∑uth
 = 
CURLAUTH_BASIC
;

512 
£t
->
¥oxyauth
 = 
CURLAUTH_BASIC
;

515 
£t
->
hide_¥ogªss
 = 
TRUE
;

521 
£t
->
s¶
.
vîify≥î
 = 
TRUE
;

522 
£t
->
s¶
.
vîifyho°
 = 
TRUE
;

523 #ifde‡
USE_TLS_SRP


524 
£t
->
s¶
.
authty≥
 = 
CURL_TLSAUTH_NONE
;

526 
£t
->
ssh_auth_ty≥s
 = 
CURLSSH_AUTH_DEFAULT
;

528 
£t
->
s¶
.
£ssi⁄id
 = 
TRUE
;

530 
£t
->
√w_fûe_≥rms
 = 0644;

531 
£t
->
√w_dúe˘‹y_≥rms
 = 0755;

536 
£t
->
Ælowed_¥Ÿocﬁs
 = 
CURLPROTO_ALL
;

537 
£t
->
ªdú_¥Ÿocﬁs
 =

538 
CURLPROTO_ALL
 & ~(
CURLPROTO_FILE
|
CURLPROTO_SCP
);

540 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

545 
£t
->
socks5_gsßpi_√c
 = 
FALSE
;

547 
ªs
 = 
	`£t°r›t
(&
£t
->
°r
[
STRING_SOCKS5_GSSAPI_SERVICE
],

548 (*Ë
CURL_DEFAULT_SOCKS5_GSSAPI_SERVICE
);

549 if(
ªs
 !
CURLE_OK
)

550  
ªs
;

554 #i‡
	`deföed
(
CURL_CA_BUNDLE
)

555 
ªs
 = 
	`£t°r›t
(&
£t
->
°r
[
STRING_SSL_CAFILE
], (*Ë
CURL_CA_BUNDLE
);

556 #ñi‡
	`deföed
(
CURL_CA_PATH
)

557 
ªs
 = 
	`£t°r›t
(&
£t
->
°r
[
STRING_SSL_CAPATH
], (*Ë
CURL_CA_PATH
);

560 
£t
->
wûdˇrdm©ch
 = 
FALSE
;

561 
£t
->
chunk_bgn
 = 
ZERO_NULL
;

562 
£t
->
chunk_íd
 = 
ZERO_NULL
;

567 
£t
->
t˝_kì∑live
 = 
FALSE
;

568 
£t
->
t˝_kìpötvl
 = 60;

569 
£t
->
t˝_kìpidÀ
 = 60;

571 
£t
->
s¶_íabÀ_≈n
 = 
TRUE
;

572 
£t
->
s¶_íabÀ_Æ≤
 = 
TRUE
;

574 
£t
->
ex≥˘_100_timeout
 = 1000L;

575  
ªs
;

576 
	}
}

586 
CURLcode
 
	$Cuæ_›í
(
Sessi⁄H™dÀ
 **
cuæ
)

588 
CURLcode
 
ªs
 = 
CURLE_OK
;

589 
Sessi⁄H™dÀ
 *
d©a
;

590 
CURLcode
 
°©us
;

593 
d©a
 = 
	`ˇŒoc
(1, (
Sessi⁄H™dÀ
));

594 if(!
d©a
) {

596 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Error: calloc of SessionHandle failed\n"));

597  
CURLE_OUT_OF_MEMORY
;

600 
d©a
->
magic
 = 
CURLEASY_MAGIC_NUMBER
;

602 
°©us
 = 
	`Cuæ_ªsﬁvî_öô
(&
d©a
->
°©e
.
ªsﬁvî
);

603 if(
°©us
) {

604 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Error:Ñesolver_init failed\n"));

605 
	`‰ì
(
d©a
);

606  
°©us
;

611 
d©a
->
°©e
.
hódîbuff
 = 
	`mÆloc
(
HEADERSIZE
);

612 if(!
d©a
->
°©e
.
hódîbuff
) {

613 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "Error: malloc of headerbuff failed\n"));

614 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

617 
ªs
 = 
	`Cuæ_öô_u£rdeföed
(&
d©a
->
£t
);

619 
d©a
->
°©e
.
hódîsize
=
HEADERSIZE
;

621 
	`Cuæ_c⁄vît_öô
(
d©a
);

624 
d©a
->
°©e
.
œ°c⁄√˘
 = 
NULL
;

626 
d©a
->
¥ogªss
.
Êags
 |
PGRS_HIDE
;

627 
d©a
->
°©e
.
cuºít_•ìd
 = -1;

629 
d©a
->
wûdˇrd
.
°©e
 = 
CURLWC_INIT
;

630 
d©a
->
wûdˇrd
.
fûñi°
 = 
NULL
;

631 
d©a
->
£t
.
‚m©ch
 = 
ZERO_NULL
;

632 
d©a
->
£t
.
maxc⁄√˘s
 = 
DEFAULT_CONNCACHE_SIZE
;

635 if(
ªs
) {

636 
	`Cuæ_ªsﬁvî_˛ónup
(
d©a
->
°©e
.
ªsﬁvî
);

637 if(
d©a
->
°©e
.
hódîbuff
)

638 
	`‰ì
(
d©a
->
°©e
.
hódîbuff
);

639 
	`Cuæ_‰ì£t
(
d©a
);

640 
	`‰ì
(
d©a
);

641 
d©a
 = 
NULL
;

644 *
cuæ
 = 
d©a
;

646  
ªs
;

647 
	}
}

649 
CURLcode
 
	$Cuæ_£t›t
(
Sessi⁄H™dÀ
 *
d©a
, 
CURL›ti⁄
 
›ti⁄
,

650 
va_li°
 
∑øm
)

652 *
¨g±r
;

653 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

654 
¨g
;

655 #i‚de‡
CURL_DISABLE_HTTP


656 
cuæ_off_t
 
bigsize
;

659 
›ti⁄
) {

660 
CURLOPT_DNS_CACHE_TIMEOUT
:

661 
d©a
->
£t
.
dns_ˇche_timeout
 = 
	`va_¨g
(
∑øm
, );

663 
CURLOPT_DNS_USE_GLOBAL_CACHE
:

665 
¨g
 = 
	`va_¨g
(
∑øm
, );

666 
d©a
->
£t
.
globÆ_dns_ˇche
 = (0 !
¨g
)?
TRUE
:
FALSE
;

668 
CURLOPT_SSL_CIPHER_LIST
:

670 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSL_CIPHER_LIST
],

671 
	`va_¨g
(
∑øm
, *));

674 
CURLOPT_RANDOM_FILE
:

679 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSL_RANDOM_FILE
],

680 
	`va_¨g
(
∑øm
, *));

682 
CURLOPT_EGDSOCKET
:

686 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSL_EGDSOCKET
],

687 
	`va_¨g
(
∑øm
, *));

689 
CURLOPT_MAXCONNECTS
:

694 
d©a
->
£t
.
maxc⁄√˘s
 = 
	`va_¨g
(
∑øm
, );

696 
CURLOPT_FORBID_REUSE
:

701 
d©a
->
£t
.
ªu£_f‹bid
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

703 
CURLOPT_FRESH_CONNECT
:

708 
d©a
->
£t
.
ªu£_‰esh
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

710 
CURLOPT_VERBOSE
:

715 
d©a
->
£t
.
vîbo£
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

717 
CURLOPT_HEADER
:

721 
d©a
->
£t
.
ö˛ude_hódî
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

723 
CURLOPT_NOPROGRESS
:

727 
d©a
->
£t
.
hide_¥ogªss
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

728 if(
d©a
->
£t
.
hide_¥ogªss
)

729 
d©a
->
¥ogªss
.
Êags
 |
PGRS_HIDE
;

731 
d©a
->
¥ogªss
.
Êags
 &~
PGRS_HIDE
;

733 
CURLOPT_NOBODY
:

737 
d©a
->
£t
.
›t_no_body
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

739 
CURLOPT_FAILONERROR
:

744 
d©a
->
£t
.
hâp_Áû_⁄_îr‹
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

746 
CURLOPT_UPLOAD
:

747 
CURLOPT_PUT
:

752 
d©a
->
£t
.
u∂ﬂd
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

753 if(
d©a
->
£t
.
u∂ﬂd
) {

755 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_PUT
;

756 
d©a
->
£t
.
›t_no_body
 = 
FALSE
;

761 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_GET
;

763 
CURLOPT_FILETIME
:

768 
d©a
->
£t
.
gë_fûëime
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

770 
CURLOPT_FTP_CREATE_MISSING_DIRS
:

775 
	`va_¨g
(
∑øm
, )) {

777 
d©a
->
£t
.
·p_¸óã_missög_dús
 = 0;

780 
d©a
->
£t
.
·p_¸óã_missög_dús
 = 1;

783 
d©a
->
£t
.
·p_¸óã_missög_dús
 = 2;

787 
ªsu…
 = 
CURLE_UNKNOWN_OPTION
;

791 
CURLOPT_SERVER_RESPONSE_TIMEOUT
:

796 
d©a
->
£t
.
£rvî_ª•⁄£_timeout
 = 
	`va_¨g
–
∑øm
 , ) * 1000;

798 
CURLOPT_TFTP_BLKSIZE
:

802 
d©a
->
£t
.
t·p_blksize
 = 
	`va_¨g
(
∑øm
, );

804 
CURLOPT_DIRLISTONLY
:

809 
d©a
->
£t
.
·p_li°_⁄ly
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

811 
CURLOPT_APPEND
:

815 
d©a
->
£t
.
·p_≠≥nd
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

817 
CURLOPT_FTP_FILEMETHOD
:

821 
d©a
->
£t
.
·p_fûemëhod
 = (
cuæ_·pfûe
)
	`va_¨g
(
∑øm
, );

823 
CURLOPT_NETRC
:

827 
d©a
->
£t
.
u£_√åc
 = (
CURL_NETRC_OPTION
)
	`va_¨g
(
∑øm
, );

829 
CURLOPT_NETRC_FILE
:

833 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_NETRC_FILE
],

834 
	`va_¨g
(
∑øm
, *));

836 
CURLOPT_TRANSFERTEXT
:

843 
d©a
->
£t
.
¥e„r_ascii
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

845 
CURLOPT_TIMECONDITION
:

850 
d©a
->
£t
.
timec⁄dôi⁄
 = (
cuæ_TimeC⁄d
)
	`va_¨g
(
∑øm
, );

852 
CURLOPT_TIMEVALUE
:

857 
d©a
->
£t
.
timevÆue
 = (
time_t
)
	`va_¨g
(
∑øm
, );

859 
CURLOPT_SSLVERSION
:

864 
d©a
->
£t
.
s¶
.
vîsi⁄
 = 
	`va_¨g
(
∑øm
, );

867 #i‚de‡
CURL_DISABLE_HTTP


868 
CURLOPT_AUTOREFERER
:

872 
d©a
->
£t
.
hâp_auto_ª„ªr
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

875 
CURLOPT_ACCEPT_ENCODING
:

885 
¨g±r
 = 
	`va_¨g
(
∑øm
, *);

886 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_ENCODING
],

887 (
¨g±r
 && !*argptr)?

888 (*Ë
ALL_CONTENT_ENCODINGS
: 
¨g±r
);

891 
CURLOPT_TRANSFER_ENCODING
:

892 
d©a
->
£t
.
hâp_å™s„r_ícodög
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

895 
CURLOPT_FOLLOWLOCATION
:

899 
d©a
->
£t
.
hâp_fﬁlow_loˇti⁄
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

902 
CURLOPT_UNRESTRICTED_AUTH
:

907 
d©a
->
£t
.
hâp_dißbÀ_ho°«me_check_bef‹e_authítiˇti⁄
 =

908 (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

911 
CURLOPT_MAXREDIRS
:

916 
d©a
->
£t
.
maxªdús
 = 
	`va_¨g
(
∑øm
, );

919 
CURLOPT_POSTREDIR
:

930 
po°Redú
 = 
	`cuæx_¶tosi
(
	`va_¨g
(
∑øm
, ));

931 
d©a
->
£t
.
kìp_po°
 = 
po°Redú
 & 
CURL_REDIR_POST_ALL
;

935 
CURLOPT_POST
:

939 if(
	`va_¨g
(
∑øm
, )) {

940 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_POST
;

941 
d©a
->
£t
.
›t_no_body
 = 
FALSE
;

944 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_GET
;

947 
CURLOPT_COPYPOSTFIELDS
:

953 
¨g±r
 = 
	`va_¨g
(
∑øm
, *);

955 if(!
¨g±r
 || 
d©a
->
£t
.
po°fõldsize
 == -1)

956 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_COPYPOSTFIELDS
], 
¨g±r
);

962 if((
d©a
->
£t
.
po°fõldsize
 < 0) ||

963 (((
cuæ_off_t
Ë!(
size_t
)) &&

964 (
d©a
->
£t
.
po°fõldsize
 > (
cuæ_off_t
)((
size_t
)-1))))

965 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

967 * 
p
;

969 (Ë
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_COPYPOSTFIELDS
], 
NULL
);

976 
p
 = 
	`mÆloc
((
size_t
)(
d©a
->
£t
.
po°fõldsize
?

977 
d©a
->
£t
.
po°fõldsize
:1));

979 if(!
p
)

980 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

982 if(
d©a
->
£t
.
po°fõldsize
)

983 
	`mem˝y
(
p
, 
¨g±r
, (
size_t
)
d©a
->
£t
.
po°fõldsize
);

985 
d©a
->
£t
.
°r
[
STRING_COPYPOSTFIELDS
] = 
p
;

990 
d©a
->
£t
.
po°fõlds
 = d©a->£t.
°r
[
STRING_COPYPOSTFIELDS
];

991 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_POST
;

994 
CURLOPT_POSTFIELDS
:

998 
d©a
->
£t
.
po°fõlds
 = 
	`va_¨g
(
∑øm
, *);

1000 (Ë
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_COPYPOSTFIELDS
], 
NULL
);

1001 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_POST
;

1004 
CURLOPT_POSTFIELDSIZE
:

1009 
bigsize
 = 
	`va_¨g
(
∑øm
, );

1011 if(
d©a
->
£t
.
po°fõldsize
 < 
bigsize
 &&

1012 
d©a
->
£t
.
po°fõlds
 =d©a->£t.
°r
[
STRING_COPYPOSTFIELDS
]) {

1014 (Ë
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_COPYPOSTFIELDS
], 
NULL
);

1015 
d©a
->
£t
.
po°fõlds
 = 
NULL
;

1018 
d©a
->
£t
.
po°fõldsize
 = 
bigsize
;

1021 
CURLOPT_POSTFIELDSIZE_LARGE
:

1026 
bigsize
 = 
	`va_¨g
(
∑øm
, 
cuæ_off_t
);

1028 if(
d©a
->
£t
.
po°fõldsize
 < 
bigsize
 &&

1029 
d©a
->
£t
.
po°fõlds
 =d©a->£t.
°r
[
STRING_COPYPOSTFIELDS
]) {

1031 (Ë
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_COPYPOSTFIELDS
], 
NULL
);

1032 
d©a
->
£t
.
po°fõlds
 = 
NULL
;

1035 
d©a
->
£t
.
po°fõldsize
 = 
bigsize
;

1038 
CURLOPT_HTTPPOST
:

1042 
d©a
->
£t
.
hâµo°
 = 
	`va_¨g
(
∑øm
, 
cuæ_hâµo°
 *);

1043 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_POST_FORM
;

1044 
d©a
->
£t
.
›t_no_body
 = 
FALSE
;

1047 
CURLOPT_REFERER
:

1051 if(
d©a
->
ch™ge
.
ª„ªr_Æloc
) {

1052 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
ª„ªr
);

1053 
d©a
->
ch™ge
.
ª„ªr_Æloc
 = 
FALSE
;

1055 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SET_REFERER
],

1056 
	`va_¨g
(
∑øm
, *));

1057 
d©a
->
ch™ge
.
ª„ªr
 = d©a->
£t
.
°r
[
STRING_SET_REFERER
];

1060 
CURLOPT_USERAGENT
:

1064 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_USERAGENT
],

1065 
	`va_¨g
(
∑øm
, *));

1068 
CURLOPT_HTTPHEADER
:

1072 
d©a
->
£t
.
hódîs
 = 
	`va_¨g
(
∑øm
, 
cuæ_¶i°
 *);

1075 
CURLOPT_PROXYHEADER
:

1086 
d©a
->
£t
.
¥oxyhódîs
 = 
	`va_¨g
(
∑øm
, 
cuæ_¶i°
 *);

1089 
CURLOPT_HEADEROPT
:

1093 
¨g
 = 
	`va_¨g
(
∑øm
, );

1094 
d©a
->
£t
.
£p_hódîs
 = (
¨g
 & 
CURLHEADER_SEPARATE
)? 
TRUE
: 
FALSE
;

1097 
CURLOPT_HTTP200ALIASES
:

1101 
d©a
->
£t
.
hâp200Æü£s
 = 
	`va_¨g
(
∑øm
, 
cuæ_¶i°
 *);

1104 #i‡!
	`deföed
(
CURL_DISABLE_COOKIES
)

1105 
CURLOPT_COOKIE
:

1109 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_COOKIE
],

1110 
	`va_¨g
(
∑øm
, *));

1113 
CURLOPT_COOKIEFILE
:

1117 
¨g±r
 = (*)
	`va_¨g
(
∑øm
, *);

1118 if(
¨g±r
) {

1119 
cuæ_¶i°
 *
˛
;

1122 
˛
 = 
	`cuæ_¶i°_≠≥nd
(
d©a
->
ch™ge
.
cookõli°
, 
¨g±r
);

1123 if(!
˛
) {

1124 
	`cuæ_¶i°_‰ì_Æl
(
d©a
->
ch™ge
.
cookõli°
);

1125 
d©a
->
ch™ge
.
cookõli°
 = 
NULL
;

1126  
CURLE_OUT_OF_MEMORY
;

1128 
d©a
->
ch™ge
.
cookõli°
 = 
˛
;

1132 
CURLOPT_COOKIEJAR
:

1136 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_COOKIEJAR
],

1137 
	`va_¨g
(
∑øm
, *));

1143 
d©a
->
cookõs
 = 
	`Cuæ_cookõ_öô
(d©a, 
NULL
, data->cookies,

1144 
d©a
->
£t
.
cookõ£ssi⁄
);

1147 
CURLOPT_COOKIESESSION
:

1163 
d©a
->
£t
.
cookõ£ssi⁄
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

1166 
CURLOPT_COOKIELIST
:

1167 
¨g±r
 = 
	`va_¨g
(
∑øm
, *);

1169 if(
¨g±r
 =
NULL
)

1172 if(
	`Cuæ_øw_equÆ
(
¨g±r
, "ALL")) {

1174 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
, 
CURL_LOCK_ACCESS_SINGLE
);

1175 
	`Cuæ_cookõ_˛óøŒ
(
d©a
->
cookõs
);

1176 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
);

1178 if(
	`Cuæ_øw_equÆ
(
¨g±r
, "SESS")) {

1180 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
, 
CURL_LOCK_ACCESS_SINGLE
);

1181 
	`Cuæ_cookõ_˛ór£ss
(
d©a
->
cookõs
);

1182 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
);

1184 if(
	`Cuæ_øw_equÆ
(
¨g±r
, "FLUSH")) {

1186 
	`Cuæ_Êush_cookõs
(
d©a
, 0);

1189 if(!
d©a
->
cookõs
)

1191 
d©a
->
cookõs
 = 
	`Cuæ_cookõ_öô
(d©a, 
NULL
, NULL, 
TRUE
);

1193 
¨g±r
 = 
	`°rdup
(argptr);

1194 if(!
¨g±r
) {

1195 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1198 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
, 
CURL_LOCK_ACCESS_SINGLE
);

1200 if(
	`check¥efix
("Së-Cookõ:", 
¨g±r
))

1202 
	`Cuæ_cookõ_add
(
d©a
, d©a->
cookõs
, 
TRUE
, 
¨g±r
 + 11, 
NULL
, NULL);

1206 
	`Cuæ_cookõ_add
(
d©a
, d©a->
cookõs
, 
FALSE
, 
¨g±r
, 
NULL
, NULL);

1208 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_COOKIE
);

1209 
	`‰ì
(
¨g±r
);

1216 
CURLOPT_HTTPGET
:

1220 if(
	`va_¨g
(
∑øm
, )) {

1221 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_GET
;

1222 
d©a
->
£t
.
u∂ﬂd
 = 
FALSE
;

1223 
d©a
->
£t
.
›t_no_body
 = 
FALSE
;

1227 
CURLOPT_HTTP_VERSION
:

1232 
¨g
 = 
	`va_¨g
(
∑øm
, );

1233 #i‚de‡
USE_NGHTTP2


1234 if(
¨g
 =
CURL_HTTP_VERSION_2_0
)

1235  
CURLE_UNSUPPORTED_PROTOCOL
;

1237 
d©a
->
£t
.
hâpvîsi⁄
 = 
¨g
;

1240 
CURLOPT_HTTPAUTH
:

1245 
bôcheck
;

1246 
boﬁ
 
authbôs
;

1247 
auth
 = 
	`va_¨g
(
∑øm
, );

1249 if(
auth
 =
CURLAUTH_NONE
) {

1250 
d©a
->
£t
.
hâ∑uth
 = 
auth
;

1256 
d©a
->
°©e
.
authho°
.
õ°yÀ
 = (
auth
 & 
CURLAUTH_DIGEST_IE
)?
TRUE
:
FALSE
;

1258 if(
auth
 & 
CURLAUTH_DIGEST_IE
) {

1259 
auth
 |
CURLAUTH_DIGEST
;

1260 
auth
 &~
CURLAUTH_DIGEST_IE
;

1264 #i‚de‡
USE_NTLM


1265 
auth
 &~
CURLAUTH_NTLM
;

1266 
auth
 &~
CURLAUTH_NTLM_WB
;

1267 #ñi‡!
	`deföed
(
NTLM_WB_ENABLED
)

1268 
auth
 &~
CURLAUTH_NTLM_WB
;

1270 #i‚de‡
USE_HTTP_NEGOTIATE


1271 
auth
 &~
CURLAUTH_GSSNEGOTIATE
;

1276 
bôcheck
 = 0;

1277 
authbôs
 = 
FALSE
;

1278 
bôcheck
 < 31) {

1279 if(
auth
 & (1UL << 
bôcheck
++)) {

1280 
authbôs
 = 
TRUE
;

1284 if(!
authbôs
)

1285  
CURLE_NOT_BUILT_IN
;

1287 
d©a
->
£t
.
hâ∑uth
 = 
auth
;

1291 
CURLOPT_EXPECT_100_TIMEOUT_MS
:

1296 
d©a
->
£t
.
ex≥˘_100_timeout
 = 
	`va_¨g
(
∑øm
, );

1301 
CURLOPT_CUSTOMREQUEST
:

1305 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_CUSTOMREQUEST
],

1306 
	`va_¨g
(
∑øm
, *));

1314 #i‚de‡
CURL_DISABLE_PROXY


1315 
CURLOPT_HTTPPROXYTUNNEL
:

1319 
d©a
->
£t
.
tu¬ñ_thru_hâµroxy
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

1322 
CURLOPT_PROXYPORT
:

1326 
d©a
->
£t
.
¥oxyp‹t
 = 
	`va_¨g
(
∑øm
, );

1329 
CURLOPT_PROXYAUTH
:

1334 
bôcheck
;

1335 
boﬁ
 
authbôs
;

1336 
auth
 = 
	`va_¨g
(
∑øm
, );

1338 if(
auth
 =
CURLAUTH_NONE
) {

1339 
d©a
->
£t
.
¥oxyauth
 = 
auth
;

1345 
d©a
->
°©e
.
auth¥oxy
.
õ°yÀ
 = (
auth
 & 
CURLAUTH_DIGEST_IE
)?
TRUE
:
FALSE
;

1347 if(
auth
 & 
CURLAUTH_DIGEST_IE
) {

1348 
auth
 |
CURLAUTH_DIGEST
;

1349 
auth
 &~
CURLAUTH_DIGEST_IE
;

1352 #i‚de‡
USE_NTLM


1353 
auth
 &~
CURLAUTH_NTLM
;

1354 
auth
 &~
CURLAUTH_NTLM_WB
;

1355 #ñi‡!
	`deföed
(
NTLM_WB_ENABLED
)

1356 
auth
 &~
CURLAUTH_NTLM_WB
;

1358 #i‚de‡
USE_HTTP_NEGOTIATE


1359 
auth
 &~
CURLAUTH_GSSNEGOTIATE
;

1364 
bôcheck
 = 0;

1365 
authbôs
 = 
FALSE
;

1366 
bôcheck
 < 31) {

1367 if(
auth
 & (1UL << 
bôcheck
++)) {

1368 
authbôs
 = 
TRUE
;

1372 if(!
authbôs
)

1373  
CURLE_NOT_BUILT_IN
;

1375 
d©a
->
£t
.
¥oxyauth
 = 
auth
;

1379 
CURLOPT_PROXY
:

1389 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_PROXY
],

1390 
	`va_¨g
(
∑øm
, *));

1393 
CURLOPT_PROXYTYPE
:

1397 
d©a
->
£t
.
¥oxyty≥
 = (
cuæ_¥oxyty≥
)
	`va_¨g
(
∑øm
, );

1400 
CURLOPT_PROXY_TRANSFER_MODE
:

1404 
	`va_¨g
(
∑øm
, )) {

1406 
d©a
->
£t
.
¥oxy_å™s„r_mode
 = 
FALSE
;

1409 
d©a
->
£t
.
¥oxy_å™s„r_mode
 = 
TRUE
;

1413 
ªsu…
 = 
CURLE_UNKNOWN_OPTION
;

1419 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

1420 
CURLOPT_SOCKS5_GSSAPI_SERVICE
:

1424 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SOCKS5_GSSAPI_SERVICE
],

1425 
	`va_¨g
(
∑øm
, *));

1428 
CURLOPT_SOCKS5_GSSAPI_NEC
:

1432 
d©a
->
£t
.
socks5_gsßpi_√c
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

1436 
CURLOPT_HEADERDATA
:

1440 
d©a
->
£t
.
wrôehódî
 = (*)
	`va_¨g
(
∑øm
, *);

1442 
CURLOPT_ERRORBUFFER
:

1447 
d©a
->
£t
.
îr‹buf„r
 = 
	`va_¨g
(
∑øm
, *);

1449 
CURLOPT_WRITEDATA
:

1454 
d©a
->
£t
.
out
 = 
	`va_¨g
(
∑øm
, *);

1456 
CURLOPT_FTPPORT
:

1460 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_FTPPORT
],

1461 
	`va_¨g
(
∑øm
, *));

1462 
d©a
->
£t
.
·p_u£_p‹t
 = (
NULL
 !d©a->£t.
°r
[
STRING_FTPPORT
]) ?

1463 
TRUE
:
FALSE
;

1466 
CURLOPT_FTP_USE_EPRT
:

1467 
d©a
->
£t
.
·p_u£_ïπ
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

1470 
CURLOPT_FTP_USE_EPSV
:

1471 
d©a
->
£t
.
·p_u£_ïsv
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

1474 
CURLOPT_FTP_USE_PRET
:

1475 
d©a
->
£t
.
·p_u£_¥ë
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

1478 
CURLOPT_FTP_SSL_CCC
:

1479 
d©a
->
£t
.
·p_ccc
 = (
cuæ_·pccc
)
	`va_¨g
(
∑øm
, );

1482 
CURLOPT_FTP_SKIP_PASV_IP
:

1487 
d©a
->
£t
.
·p_skù_ù
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

1490 
CURLOPT_INFILE
:

1495 
d©a
->
£t
.
ö
 = 
	`va_¨g
(
∑øm
, *);

1497 
CURLOPT_INFILESIZE
:

1502 
d©a
->
£t
.
fûesize
 = 
	`va_¨g
(
∑øm
, );

1504 
CURLOPT_INFILESIZE_LARGE
:

1509 
d©a
->
£t
.
fûesize
 = 
	`va_¨g
(
∑øm
, 
cuæ_off_t
);

1511 
CURLOPT_LOW_SPEED_LIMIT
:

1516 
d©a
->
£t
.
low_•ìd_limô
=
	`va_¨g
(
∑øm
, );

1518 
CURLOPT_MAX_SEND_SPEED_LARGE
:

1523 
d©a
->
£t
.
max_£nd_•ìd
=
	`va_¨g
(
∑øm
, 
cuæ_off_t
);

1525 
CURLOPT_MAX_RECV_SPEED_LARGE
:

1530 
d©a
->
£t
.
max_ªcv_•ìd
=
	`va_¨g
(
∑øm
, 
cuæ_off_t
);

1532 
CURLOPT_LOW_SPEED_TIME
:

1537 
d©a
->
£t
.
low_•ìd_time
=
	`va_¨g
(
∑øm
, );

1539 
CURLOPT_URL
:

1543 if(
d©a
->
ch™ge
.
uæ_Æloc
) {

1545 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
uæ
);

1546 
d©a
->
ch™ge
.
uæ_Æloc
 = 
FALSE
;

1548 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SET_URL
],

1549 
	`va_¨g
(
∑øm
, *));

1550 
d©a
->
ch™ge
.
uæ
 = d©a->
£t
.
°r
[
STRING_SET_URL
];

1552 
CURLOPT_PORT
:

1556 
d©a
->
£t
.
u£_p‹t
 = 
	`va_¨g
(
∑øm
, );

1558 
CURLOPT_TIMEOUT
:

1563 
d©a
->
£t
.
timeout
 = 
	`va_¨g
(
∑øm
, ) * 1000L;

1566 
CURLOPT_TIMEOUT_MS
:

1567 
d©a
->
£t
.
timeout
 = 
	`va_¨g
(
∑øm
, );

1570 
CURLOPT_CONNECTTIMEOUT
:

1574 
d©a
->
£t
.
c⁄√˘timeout
 = 
	`va_¨g
(
∑øm
, ) * 1000L;

1577 
CURLOPT_CONNECTTIMEOUT_MS
:

1578 
d©a
->
£t
.
c⁄√˘timeout
 = 
	`va_¨g
(
∑øm
, );

1581 
CURLOPT_ACCEPTTIMEOUT_MS
:

1585 
d©a
->
£t
.
ac˚±timeout
 = 
	`va_¨g
(
∑øm
, );

1588 
CURLOPT_USERPWD
:

1592 
ªsu…
 = 
	`£t°r›t_u£Ωwd
(
	`va_¨g
(
∑øm
, *),

1593 &
d©a
->
£t
.
°r
[
STRING_USERNAME
],

1594 &
d©a
->
£t
.
°r
[
STRING_PASSWORD
]);

1597 
CURLOPT_USERNAME
:

1601 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_USERNAME
],

1602 
	`va_¨g
(
∑øm
, *));

1605 
CURLOPT_PASSWORD
:

1609 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_PASSWORD
],

1610 
	`va_¨g
(
∑øm
, *));

1613 
CURLOPT_LOGIN_OPTIONS
:

1617 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_OPTIONS
],

1618 
	`va_¨g
(
∑øm
, *));

1621 
CURLOPT_XOAUTH2_BEARER
:

1625 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_BEARER
],

1626 
	`va_¨g
(
∑øm
, *));

1629 
CURLOPT_POSTQUOTE
:

1633 
d©a
->
£t
.
po°quŸe
 = 
	`va_¨g
(
∑øm
, 
cuæ_¶i°
 *);

1635 
CURLOPT_PREQUOTE
:

1639 
d©a
->
£t
.
¥equŸe
 = 
	`va_¨g
(
∑øm
, 
cuæ_¶i°
 *);

1641 
CURLOPT_QUOTE
:

1645 
d©a
->
£t
.
quŸe
 = 
	`va_¨g
(
∑øm
, 
cuæ_¶i°
 *);

1647 
CURLOPT_RESOLVE
:

1658 
d©a
->
£t
.
ªsﬁve
 = 
	`va_¨g
(
∑øm
, 
cuæ_¶i°
 *);

1659 
d©a
->
ch™ge
.
ªsﬁve
 = d©a->
£t
.resolve;

1661 
CURLOPT_PROGRESSFUNCTION
:

1665 
d©a
->
£t
.
Ârogªss
 = 
	`va_¨g
(
∑øm
, 
cuæ_¥ogªss_ˇŒback
);

1666 if(
d©a
->
£t
.
Ârogªss
)

1667 
d©a
->
¥ogªss
.
ˇŒback
 = 
TRUE
;

1669 
d©a
->
¥ogªss
.
ˇŒback
 = 
FALSE
;

1672 
CURLOPT_XFERINFOFUNCTION
:

1676 
d©a
->
£t
.
fx„röfo
 = 
	`va_¨g
(
∑øm
, 
cuæ_x„röfo_ˇŒback
);

1677 if(
d©a
->
£t
.
fx„röfo
)

1678 
d©a
->
¥ogªss
.
ˇŒback
 = 
TRUE
;

1680 
d©a
->
¥ogªss
.
ˇŒback
 = 
FALSE
;

1684 
CURLOPT_PROGRESSDATA
:

1688 
d©a
->
£t
.
¥ogªss_˛õ¡
 = 
	`va_¨g
(
∑øm
, *);

1691 #i‚de‡
CURL_DISABLE_PROXY


1692 
CURLOPT_PROXYUSERPWD
:

1696 
ªsu…
 = 
	`£t°r›t_u£Ωwd
(
	`va_¨g
(
∑øm
, *),

1697 &
d©a
->
£t
.
°r
[
STRING_PROXYUSERNAME
],

1698 &
d©a
->
£t
.
°r
[
STRING_PROXYPASSWORD
]);

1700 
CURLOPT_PROXYUSERNAME
:

1704 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_PROXYUSERNAME
],

1705 
	`va_¨g
(
∑øm
, *));

1707 
CURLOPT_PROXYPASSWORD
:

1711 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_PROXYPASSWORD
],

1712 
	`va_¨g
(
∑øm
, *));

1714 
CURLOPT_NOPROXY
:

1718 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_NOPROXY
],

1719 
	`va_¨g
(
∑øm
, *));

1723 
CURLOPT_RANGE
:

1727 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SET_RANGE
],

1728 
	`va_¨g
(
∑øm
, *));

1730 
CURLOPT_RESUME_FROM
:

1734 
d©a
->
£t
.
£t_ªsume_‰om
 = 
	`va_¨g
(
∑øm
, );

1736 
CURLOPT_RESUME_FROM_LARGE
:

1740 
d©a
->
£t
.
£t_ªsume_‰om
 = 
	`va_¨g
(
∑øm
, 
cuæ_off_t
);

1742 
CURLOPT_DEBUGFUNCTION
:

1746 
d©a
->
£t
.
fdebug
 = 
	`va_¨g
(
∑øm
, 
cuæ_debug_ˇŒback
);

1751 
CURLOPT_DEBUGDATA
:

1756 
d©a
->
£t
.
debugd©a
 = 
	`va_¨g
(
∑øm
, *);

1758 
CURLOPT_STDERR
:

1763 
d©a
->
£t
.
îr
 = 
	`va_¨g
(
∑øm
, 
FILE
 *);

1764 if(!
d©a
->
£t
.
îr
)

1765 
d©a
->
£t
.
îr
 = 
°dîr
;

1767 
CURLOPT_HEADERFUNCTION
:

1771 
d©a
->
£t
.
fwrôe_hódî
 = 
	`va_¨g
(
∑øm
, 
cuæ_wrôe_ˇŒback
);

1773 
CURLOPT_WRITEFUNCTION
:

1777 
d©a
->
£t
.
fwrôe_func
 = 
	`va_¨g
(
∑øm
, 
cuæ_wrôe_ˇŒback
);

1778 if(!
d©a
->
£t
.
fwrôe_func
) {

1779 
d©a
->
£t
.
is_fwrôe_£t
 = 0;

1781 
d©a
->
£t
.
fwrôe_func
 = (
cuæ_wrôe_ˇŒback
)
fwrôe
;

1784 
d©a
->
£t
.
is_fwrôe_£t
 = 1;

1786 
CURLOPT_READFUNCTION
:

1790 
d©a
->
£t
.
‰ód_func
 = 
	`va_¨g
(
∑øm
, 
cuæ_ªad_ˇŒback
);

1791 if(!
d©a
->
£t
.
‰ód_func
) {

1792 
d©a
->
£t
.
is_‰ód_£t
 = 0;

1794 
d©a
->
£t
.
‰ód_func
 = (
cuæ_ªad_ˇŒback
)
‰ód
;

1797 
d©a
->
£t
.
is_‰ód_£t
 = 1;

1799 
CURLOPT_SEEKFUNCTION
:

1803 
d©a
->
£t
.
£ek_func
 = 
	`va_¨g
(
∑øm
, 
cuæ_£ek_ˇŒback
);

1805 
CURLOPT_SEEKDATA
:

1809 
d©a
->
£t
.
£ek_˛õ¡
 = 
	`va_¨g
(
∑øm
, *);

1811 
CURLOPT_CONV_FROM_NETWORK_FUNCTION
:

1815 
d©a
->
£t
.
c⁄v‰om√tw‹k
 = 
	`va_¨g
(
∑øm
, 
cuæ_c⁄v_ˇŒback
);

1817 
CURLOPT_CONV_TO_NETWORK_FUNCTION
:

1821 
d©a
->
£t
.
c⁄vt⁄ëw‹k
 = 
	`va_¨g
(
∑øm
, 
cuæ_c⁄v_ˇŒback
);

1823 
CURLOPT_CONV_FROM_UTF8_FUNCTION
:

1827 
d©a
->
£t
.
c⁄v‰omutf8
 = 
	`va_¨g
(
∑øm
, 
cuæ_c⁄v_ˇŒback
);

1829 
CURLOPT_IOCTLFUNCTION
:

1833 
d©a
->
£t
.
io˘l_func
 = 
	`va_¨g
(
∑øm
, 
cuæ_io˘l_ˇŒback
);

1835 
CURLOPT_IOCTLDATA
:

1839 
d©a
->
£t
.
io˘l_˛õ¡
 = 
	`va_¨g
(
∑øm
, *);

1841 
CURLOPT_SSLCERT
:

1845 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_CERT
],

1846 
	`va_¨g
(
∑øm
, *));

1848 
CURLOPT_SSLCERTTYPE
:

1852 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
],

1853 
	`va_¨g
(
∑øm
, *));

1855 
CURLOPT_SSLKEY
:

1859 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_KEY
],

1860 
	`va_¨g
(
∑øm
, *));

1862 
CURLOPT_SSLKEYTYPE
:

1866 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_KEY_TYPE
],

1867 
	`va_¨g
(
∑øm
, *));

1869 
CURLOPT_KEYPASSWD
:

1873 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
],

1874 
	`va_¨g
(
∑øm
, *));

1876 
CURLOPT_SSLENGINE
:

1880 
¨g±r
 = 
	`va_¨g
(
∑øm
, *);

1881 if(
¨g±r
 &&árgptr[0])

1882 
ªsu…
 = 
	`Cuæ_s¶_£t_ígöe
(
d©a
, 
¨g±r
);

1885 
CURLOPT_SSLENGINE_DEFAULT
:

1889 
ªsu…
 = 
	`Cuæ_s¶_£t_ígöe_deÁu…
(
d©a
);

1891 
CURLOPT_CRLF
:

1895 
d©a
->
£t
.
¸lf
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

1898 
CURLOPT_INTERFACE
:

1903 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_DEVICE
],

1904 
	`va_¨g
(
∑øm
, *));

1906 
CURLOPT_LOCALPORT
:

1910 
d©a
->
£t
.
loˇÕ‹t
 = 
	`cuæx_¶tous
(
	`va_¨g
(
∑øm
, ));

1912 
CURLOPT_LOCALPORTRANGE
:

1916 
d©a
->
£t
.
loˇÕ‹å™ge
 = 
	`cuæx_¶tosi
(
	`va_¨g
(
∑øm
, ));

1918 
CURLOPT_KRBLEVEL
:

1922 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_KRB_LEVEL
],

1923 
	`va_¨g
(
∑øm
, *));

1924 
d©a
->
£t
.
krb
 = (
NULL
 !d©a->£t.
°r
[
STRING_KRB_LEVEL
])?
TRUE
:
FALSE
;

1926 
CURLOPT_GSSAPI_DELEGATION
:

1930 
d©a
->
£t
.
gsßpi_dñeg©i⁄
 = 
	`va_¨g
(
∑øm
, );

1932 
CURLOPT_SSL_VERIFYPEER
:

1936 
d©a
->
£t
.
s¶
.
vîify≥î
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

1938 
CURLOPT_SSL_VERIFYHOST
:

1942 
¨g
 = 
	`va_¨g
(
∑øm
, );

1949 if(1 =
¨g
) {

1950 
	`Áûf
(
d©a
, "CURLOPT_SSL_VERIFYHOSTÇoÜonger supports 1ás value!");

1951  
CURLE_BAD_FUNCTION_ARGUMENT
;

1954 
d©a
->
£t
.
s¶
.
vîifyho°
 = (0 !
¨g
)?
TRUE
:
FALSE
;

1956 #ifde‡
USE_SSLEAY


1961 
CURLOPT_SSL_CTX_FUNCTION
:

1965 
d©a
->
£t
.
s¶
.
fs¶˘x
 = 
	`va_¨g
(
∑øm
, 
cuæ_s¶_˘x_ˇŒback
);

1967 
CURLOPT_SSL_CTX_DATA
:

1971 
d©a
->
£t
.
s¶
.
fs¶˘xp
 = 
	`va_¨g
(
∑øm
, *);

1974 #i‡
	`deföed
(
USE_SSLEAY
Ë|| deföed(
USE_QSOSSL
Ë|| deföed(
USE_GSKIT
) || \

1975 
	`deföed
(
USE_NSS
)

1976 
CURLOPT_CERTINFO
:

1977 
d©a
->
£t
.
s¶
.
˚πöfo
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

1980 
CURLOPT_CAINFO
:

1984 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
],

1985 
	`va_¨g
(
∑øm
, *));

1987 
CURLOPT_CAPATH
:

1993 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSL_CAPATH
],

1994 
	`va_¨g
(
∑øm
, *));

1996 
CURLOPT_CRLFILE
:

2001 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSL_CRLFILE
],

2002 
	`va_¨g
(
∑øm
, *));

2004 
CURLOPT_ISSUERCERT
:

2009 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSL_ISSUERCERT
],

2010 
	`va_¨g
(
∑øm
, *));

2012 
CURLOPT_TELNETOPTIONS
:

2016 
d©a
->
£t
.
ã ë_›ti⁄s
 = 
	`va_¨g
(
∑øm
, 
cuæ_¶i°
 *);

2019 
CURLOPT_BUFFERSIZE
:

2024 
d©a
->
£t
.
buf„r_size
 = 
	`va_¨g
(
∑øm
, );

2026 if((
d©a
->
£t
.
buf„r_size
> (
BUFSIZE
 -1 )) ||

2027 (
d©a
->
£t
.
buf„r_size
 < 1))

2028 
d©a
->
£t
.
buf„r_size
 = 0;

2032 
CURLOPT_NOSIGNAL
:

2037 
d©a
->
£t
.
no_sig«l
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2040 
CURLOPT_SHARE
:

2042 
Cuæ_sh¨e
 *
£t
;

2043 
£t
 = 
	`va_¨g
(
∑øm
, 
Cuæ_sh¨e
 *);

2046 if(
d©a
->
sh¨e
) {

2047 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_SHARE
, 
CURL_LOCK_ACCESS_SINGLE
);

2049 if(
d©a
->
dns
.
ho°ˇchëy≥
 =
HCACHE_SHARED
) {

2050 
d©a
->
dns
.
ho°ˇche
 = 
NULL
;

2051 
d©a
->
dns
.
ho°ˇchëy≥
 = 
HCACHE_NONE
;

2054 #i‡!
	`deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_COOKIES
)

2055 if(
d©a
->
sh¨e
->
cookõs
 == data->cookies)

2056 
d©a
->
cookõs
 = 
NULL
;

2059 if(
d©a
->
sh¨e
->
s¶£ssi⁄
 =d©a->
°©e
.
£ssi⁄
)

2060 
d©a
->
°©e
.
£ssi⁄
 = 
NULL
;

2062 
d©a
->
sh¨e
->
dúty
--;

2064 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_SHARE
);

2065 
d©a
->
sh¨e
 = 
NULL
;

2069 
d©a
->
sh¨e
 = 
£t
;

2070 if(
d©a
->
sh¨e
) {

2072 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_SHARE
, 
CURL_LOCK_ACCESS_SINGLE
);

2074 
d©a
->
sh¨e
->
dúty
++;

2076 if(
d©a
->
sh¨e
->
ho°ˇche
) {

2078 
d©a
->
dns
.
ho°ˇche
 = d©a->
sh¨e
->hostcache;

2079 
d©a
->
dns
.
ho°ˇchëy≥
 = 
HCACHE_SHARED
;

2081 #i‡!
	`deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_COOKIES
)

2082 if(
d©a
->
sh¨e
->
cookõs
) {

2084 if(
d©a
->
cookõs
)

2085 
	`Cuæ_cookõ_˛ónup
(
d©a
->
cookõs
);

2087 
d©a
->
cookõs
 = d©a->
sh¨e
->cookies;

2090 if(
d©a
->
sh¨e
->
s¶£ssi⁄
) {

2091 
d©a
->
£t
.
s¶
.
max_s¶_£ssi⁄s
 = d©a->
sh¨e
->max_ssl_sessions;

2092 
d©a
->
°©e
.
£ssi⁄
 = d©a->
sh¨e
->
s¶£ssi⁄
;

2094 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_SHARE
);

2102 
CURLOPT_PRIVATE
:

2106 
d©a
->
£t
.
¥iv©e_d©a
 = 
	`va_¨g
(
∑øm
, *);

2109 
CURLOPT_MAXFILESIZE
:

2113 
d©a
->
£t
.
max_fûesize
 = 
	`va_¨g
(
∑øm
, );

2116 #ifde‡
USE_SSL


2117 
CURLOPT_USE_SSL
:

2121 
d©a
->
£t
.
u£_s¶
 = (
cuæ_u£s¶
)
	`va_¨g
(
∑øm
, );

2124 
CURLOPT_SSL_OPTIONS
:

2125 
¨g
 = 
	`va_¨g
(
∑øm
, );

2126 
d©a
->
£t
.
s¶_íabÀ_bó°
 = 
¨g
&
CURLSSLOPT_ALLOW_BEAST
?
TRUE
:
FALSE
;

2130 
CURLOPT_FTPSSLAUTH
:

2134 
d©a
->
£t
.
·ps¶auth
 = (
cuæ_·∑uth
)
	`va_¨g
(
∑øm
, );

2137 
CURLOPT_IPRESOLVE
:

2138 
d©a
->
£t
.
ùvî
 = 
	`va_¨g
(
∑øm
, );

2141 
CURLOPT_MAXFILESIZE_LARGE
:

2145 
d©a
->
£t
.
max_fûesize
 = 
	`va_¨g
(
∑øm
, 
cuæ_off_t
);

2148 
CURLOPT_TCP_NODELAY
:

2153 
d©a
->
£t
.
t˝_nodñay
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2156 
CURLOPT_FTP_ACCOUNT
:

2157 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_FTP_ACCOUNT
],

2158 
	`va_¨g
(
∑øm
, *));

2161 
CURLOPT_IGNORE_CONTENT_LENGTH
:

2162 
d©a
->
£t
.
ign‹e˛
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2165 
CURLOPT_CONNECT_ONLY
:

2169 
d©a
->
£t
.
c⁄√˘_⁄ly
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2172 
CURLOPT_FTP_ALTERNATIVE_TO_USER
:

2173 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_FTP_ALTERNATIVE_TO_USER
],

2174 
	`va_¨g
(
∑øm
, *));

2177 
CURLOPT_SOCKOPTFUNCTION
:

2181 
d©a
->
£t
.
fsock›t
 = 
	`va_¨g
(
∑øm
, 
cuæ_sock›t_ˇŒback
);

2184 
CURLOPT_SOCKOPTDATA
:

2188 
d©a
->
£t
.
sock›t_˛õ¡
 = 
	`va_¨g
(
∑øm
, *);

2191 
CURLOPT_OPENSOCKETFUNCTION
:

2196 
d©a
->
£t
.
f›ísockë
 = 
	`va_¨g
(
∑øm
, 
cuæ_›ísockë_ˇŒback
);

2199 
CURLOPT_OPENSOCKETDATA
:

2203 
d©a
->
£t
.
›ísockë_˛õ¡
 = 
	`va_¨g
(
∑øm
, *);

2206 
CURLOPT_CLOSESOCKETFUNCTION
:

2211 
d©a
->
£t
.
f˛o£sockë
 = 
	`va_¨g
(
∑øm
, 
cuæ_˛o£sockë_ˇŒback
);

2214 
CURLOPT_CLOSESOCKETDATA
:

2218 
d©a
->
£t
.
˛o£sockë_˛õ¡
 = 
	`va_¨g
(
∑øm
, *);

2221 
CURLOPT_SSL_SESSIONID_CACHE
:

2222 
d©a
->
£t
.
s¶
.
£ssi⁄id
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2225 #ifde‡
USE_LIBSSH2


2227 
CURLOPT_SSH_AUTH_TYPES
:

2228 
d©a
->
£t
.
ssh_auth_ty≥s
 = 
	`va_¨g
(
∑øm
, );

2231 
CURLOPT_SSH_PUBLIC_KEYFILE
:

2235 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSH_PUBLIC_KEY
],

2236 
	`va_¨g
(
∑øm
, *));

2239 
CURLOPT_SSH_PRIVATE_KEYFILE
:

2243 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSH_PRIVATE_KEY
],

2244 
	`va_¨g
(
∑øm
, *));

2246 
CURLOPT_SSH_HOST_PUBLIC_KEY_MD5
:

2251 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSH_HOST_PUBLIC_KEY_MD5
],

2252 
	`va_¨g
(
∑øm
, *));

2254 #ifde‡
HAVE_LIBSSH2_KNOWNHOST_API


2255 
CURLOPT_SSH_KNOWNHOSTS
:

2259 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_SSH_KNOWNHOSTS
],

2260 
	`va_¨g
(
∑øm
, *));

2263 
CURLOPT_SSH_KEYFUNCTION
:

2266 
d©a
->
£t
.
ssh_keyfunc
 = 
	`va_¨g
(
∑øm
, 
cuæ_sshkeyˇŒback
);

2269 
CURLOPT_SSH_KEYDATA
:

2273 
d©a
->
£t
.
ssh_keyfunc_u£Ω
 = 
	`va_¨g
(
∑øm
, *);

2279 
CURLOPT_HTTP_TRANSFER_DECODING
:

2283 
d©a
->
£t
.
hâp_ã_skù
 = (0 =
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2286 
CURLOPT_HTTP_CONTENT_DECODING
:

2290 
d©a
->
£t
.
hâp_˚_skù
 = (0 =
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2293 
CURLOPT_NEW_FILE_PERMS
:

2297 
d©a
->
£t
.
√w_fûe_≥rms
 = 
	`va_¨g
(
∑øm
, );

2300 
CURLOPT_NEW_DIRECTORY_PERMS
:

2304 
d©a
->
£t
.
√w_dúe˘‹y_≥rms
 = 
	`va_¨g
(
∑øm
, );

2307 
CURLOPT_ADDRESS_SCOPE
:

2313 
d©a
->
£t
.
sc›e
 = 
	`cuæx_¶toui
(
	`va_¨g
(
∑øm
, ));

2316 
CURLOPT_PROTOCOLS
:

2321 
d©a
->
£t
.
Ælowed_¥Ÿocﬁs
 = 
	`va_¨g
(
∑øm
, );

2324 
CURLOPT_REDIR_PROTOCOLS
:

2329 
d©a
->
£t
.
ªdú_¥Ÿocﬁs
 = 
	`va_¨g
(
∑øm
, );

2332 
CURLOPT_MAIL_FROM
:

2334 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_MAIL_FROM
],

2335 
	`va_¨g
(
∑øm
, *));

2338 
CURLOPT_MAIL_AUTH
:

2340 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_MAIL_AUTH
],

2341 
	`va_¨g
(
∑øm
, *));

2344 
CURLOPT_MAIL_RCPT
:

2346 
d©a
->
£t
.
maû_r˝t
 = 
	`va_¨g
(
∑øm
, 
cuæ_¶i°
 *);

2349 
CURLOPT_SASL_IR
:

2351 
d©a
->
£t
.
ß¶_ú
 = (0 !
	`va_¨g
(
∑øm
, )Ë? 
TRUE
 : 
FALSE
;

2354 
CURLOPT_RTSP_REQUEST
:

2360 
cuæ_π•ªq
 = 
	`va_¨g
(
∑øm
, );

2361 
Cuæ_Rt•Req
 
π•ªq
 = 
RTSPREQ_NONE
;

2362 
cuæ_π•ªq
) {

2363 
CURL_RTSPREQ_OPTIONS
:

2364 
π•ªq
 = 
RTSPREQ_OPTIONS
;

2367 
CURL_RTSPREQ_DESCRIBE
:

2368 
π•ªq
 = 
RTSPREQ_DESCRIBE
;

2371 
CURL_RTSPREQ_ANNOUNCE
:

2372 
π•ªq
 = 
RTSPREQ_ANNOUNCE
;

2375 
CURL_RTSPREQ_SETUP
:

2376 
π•ªq
 = 
RTSPREQ_SETUP
;

2379 
CURL_RTSPREQ_PLAY
:

2380 
π•ªq
 = 
RTSPREQ_PLAY
;

2383 
CURL_RTSPREQ_PAUSE
:

2384 
π•ªq
 = 
RTSPREQ_PAUSE
;

2387 
CURL_RTSPREQ_TEARDOWN
:

2388 
π•ªq
 = 
RTSPREQ_TEARDOWN
;

2391 
CURL_RTSPREQ_GET_PARAMETER
:

2392 
π•ªq
 = 
RTSPREQ_GET_PARAMETER
;

2395 
CURL_RTSPREQ_SET_PARAMETER
:

2396 
π•ªq
 = 
RTSPREQ_SET_PARAMETER
;

2399 
CURL_RTSPREQ_RECORD
:

2400 
π•ªq
 = 
RTSPREQ_RECORD
;

2403 
CURL_RTSPREQ_RECEIVE
:

2404 
π•ªq
 = 
RTSPREQ_RECEIVE
;

2407 
π•ªq
 = 
RTSPREQ_NONE
;

2410 
d©a
->
£t
.
π•ªq
 =Ñtspreq;

2415 
CURLOPT_RTSP_SESSION_ID
:

2420 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_RTSP_SESSION_ID
],

2421 
	`va_¨g
(
∑øm
, *));

2424 
CURLOPT_RTSP_STREAM_URI
:

2429 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_RTSP_STREAM_URI
],

2430 
	`va_¨g
(
∑øm
, *));

2433 
CURLOPT_RTSP_TRANSPORT
:

2437 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_RTSP_TRANSPORT
],

2438 
	`va_¨g
(
∑øm
, *));

2441 
CURLOPT_RTSP_CLIENT_CSEQ
:

2447 
d©a
->
°©e
.
π•_√xt_˛õ¡_CSeq
 = 
	`va_¨g
(
∑øm
, );

2450 
CURLOPT_RTSP_SERVER_CSEQ
:

2452 
d©a
->
°©e
.
π•_√xt_˛õ¡_CSeq
 = 
	`va_¨g
(
∑øm
, );

2455 
CURLOPT_INTERLEAVEDATA
:

2456 
d©a
->
£t
.
πp_out
 = 
	`va_¨g
(
∑øm
, *);

2458 
CURLOPT_INTERLEAVEFUNCTION
:

2460 
d©a
->
£t
.
fwrôe_πp
 = 
	`va_¨g
(
∑øm
, 
cuæ_wrôe_ˇŒback
);

2463 
CURLOPT_WILDCARDMATCH
:

2464 
d©a
->
£t
.
wûdˇrdm©ch
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2466 
CURLOPT_CHUNK_BGN_FUNCTION
:

2467 
d©a
->
£t
.
chunk_bgn
 = 
	`va_¨g
(
∑øm
, 
cuæ_chunk_bgn_ˇŒback
);

2469 
CURLOPT_CHUNK_END_FUNCTION
:

2470 
d©a
->
£t
.
chunk_íd
 = 
	`va_¨g
(
∑øm
, 
cuæ_chunk_íd_ˇŒback
);

2472 
CURLOPT_FNMATCH_FUNCTION
:

2473 
d©a
->
£t
.
‚m©ch
 = 
	`va_¨g
(
∑øm
, 
cuæ_‚m©ch_ˇŒback
);

2475 
CURLOPT_CHUNK_DATA
:

2476 
d©a
->
wûdˇrd
.
cu°om±r
 = 
	`va_¨g
(
∑øm
, *);

2478 
CURLOPT_FNMATCH_DATA
:

2479 
d©a
->
£t
.
‚m©ch_d©a
 = 
	`va_¨g
(
∑øm
, *);

2481 #ifde‡
USE_TLS_SRP


2482 
CURLOPT_TLSAUTH_USERNAME
:

2483 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_TLSAUTH_USERNAME
],

2484 
	`va_¨g
(
∑øm
, *));

2485 if(
d©a
->
£t
.
°r
[
STRING_TLSAUTH_USERNAME
] && !d©a->£t.
s¶
.
authty≥
)

2486 
d©a
->
£t
.
s¶
.
authty≥
 = 
CURL_TLSAUTH_SRP
;

2488 
CURLOPT_TLSAUTH_PASSWORD
:

2489 
ªsu…
 = 
	`£t°r›t
(&
d©a
->
£t
.
°r
[
STRING_TLSAUTH_PASSWORD
],

2490 
	`va_¨g
(
∑øm
, *));

2491 if(
d©a
->
£t
.
°r
[
STRING_TLSAUTH_USERNAME
] && !d©a->£t.
s¶
.
authty≥
)

2492 
d©a
->
£t
.
s¶
.
authty≥
 = 
CURL_TLSAUTH_SRP
;

2494 
CURLOPT_TLSAUTH_TYPE
:

2495 if(
	`°∫equÆ
((*)
	`va_¨g
(
∑øm
, *), "SRP", 
	`°æí
("SRP")))

2496 
d©a
->
£t
.
s¶
.
authty≥
 = 
CURL_TLSAUTH_SRP
;

2498 
d©a
->
£t
.
s¶
.
authty≥
 = 
CURL_TLSAUTH_NONE
;

2501 
CURLOPT_DNS_SERVERS
:

2502 
ªsu…
 = 
	`Cuæ_£t_dns_£rvîs
(
d©a
, 
	`va_¨g
(
∑øm
, *));

2504 
CURLOPT_DNS_INTERFACE
:

2505 
ªsu…
 = 
	`Cuæ_£t_dns_öãrÁ˚
(
d©a
, 
	`va_¨g
(
∑øm
, *));

2507 
CURLOPT_DNS_LOCAL_IP4
:

2508 
ªsu…
 = 
	`Cuæ_£t_dns_loˇl_ù4
(
d©a
, 
	`va_¨g
(
∑øm
, *));

2510 
CURLOPT_DNS_LOCAL_IP6
:

2511 
ªsu…
 = 
	`Cuæ_£t_dns_loˇl_ù6
(
d©a
, 
	`va_¨g
(
∑øm
, *));

2514 
CURLOPT_TCP_KEEPALIVE
:

2515 
d©a
->
£t
.
t˝_kì∑live
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2517 
CURLOPT_TCP_KEEPIDLE
:

2518 
d©a
->
£t
.
t˝_kìpidÀ
 = 
	`va_¨g
(
∑øm
, );

2520 
CURLOPT_TCP_KEEPINTVL
:

2521 
d©a
->
£t
.
t˝_kìpötvl
 = 
	`va_¨g
(
∑øm
, );

2523 
CURLOPT_SSL_ENABLE_NPN
:

2524 
d©a
->
£t
.
s¶_íabÀ_≈n
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2526 
CURLOPT_SSL_ENABLE_ALPN
:

2527 
d©a
->
£t
.
s¶_íabÀ_Æ≤
 = (0 !
	`va_¨g
(
∑øm
, ))?
TRUE
:
FALSE
;

2532 
ªsu…
 = 
CURLE_UNKNOWN_OPTION
;

2536  
ªsu…
;

2537 
	}
}

2539 
	$c⁄n_‰ì
(
c⁄√˘d©a
 *
c⁄n
)

2541 if(!
c⁄n
)

2545 
	`Cuæ_ªsﬁvî_ˇn˚l
(
c⁄n
);

2549 
	`Cuæ_s¶_˛o£
(
c⁄n
, 
FIRSTSOCKET
);

2550 
	`Cuæ_s¶_˛o£
(
c⁄n
, 
SECONDARYSOCKET
);

2553 if(
CURL_SOCKET_BAD
 !
c⁄n
->
sock
[
SECONDARYSOCKET
])

2554 
	`Cuæ_˛o£sockë
(
c⁄n
, c⁄n->
sock
[
SECONDARYSOCKET
]);

2555 if(
CURL_SOCKET_BAD
 !
c⁄n
->
sock
[
FIRSTSOCKET
])

2556 
	`Cuæ_˛o£sockë
(
c⁄n
, c⁄n->
sock
[
FIRSTSOCKET
]);

2557 if(
CURL_SOCKET_BAD
 !
c⁄n
->
ãmpsock
[0])

2558 
	`Cuæ_˛o£sockë
(
c⁄n
, c⁄n->
ãmpsock
[0]);

2559 if(
CURL_SOCKET_BAD
 !
c⁄n
->
ãmpsock
[1])

2560 
	`Cuæ_˛o£sockë
(
c⁄n
, c⁄n->
ãmpsock
[1]);

2562 #i‡
	`deföed
(
USE_NTLM
Ë&& deföed(
NTLM_WB_ENABLED
)

2563 
	`Cuæ_¡lm_wb_˛ónup
(
c⁄n
);

2566 
	`Cuæ_ß„‰ì
(
c⁄n
->
u£r
);

2567 
	`Cuæ_ß„‰ì
(
c⁄n
->
∑sswd
);

2568 
	`Cuæ_ß„‰ì
(
c⁄n
->
xﬂuth2_bóªr
);

2569 
	`Cuæ_ß„‰ì
(
c⁄n
->
›ti⁄s
);

2570 
	`Cuæ_ß„‰ì
(
c⁄n
->
¥oxyu£r
);

2571 
	`Cuæ_ß„‰ì
(
c⁄n
->
¥oxy∑sswd
);

2572 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
¥oxyu£Ωwd
);

2573 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
uagít
);

2574 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
u£Ωwd
);

2575 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
ac˚±_ícodög
);

2576 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
ã
);

2577 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
øngñöe
);

2578 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
ªf
);

2579 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
ho°
);

2580 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
cookõho°
);

2581 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
π•_å™•‹t
);

2582 
	`Cuæ_ß„‰ì
(
c⁄n
->
åaûî
);

2583 
	`Cuæ_ß„‰ì
(
c⁄n
->
ho°
.
øwÆloc
);

2584 
	`Cuæ_ß„‰ì
(
c⁄n
->
¥oxy
.
øwÆloc
);

2585 
	`Cuæ_ß„‰ì
(
c⁄n
->
ma°î_buf„r
);

2587 
	`Cuæ_Œi°_de°roy
(
c⁄n
->
£nd_pùe
, 
NULL
);

2588 
	`Cuæ_Œi°_de°roy
(
c⁄n
->
ªcv_pùe
, 
NULL
);

2590 
c⁄n
->
£nd_pùe
 = 
NULL
;

2591 
c⁄n
->
ªcv_pùe
 = 
NULL
;

2593 
	`Cuæ_ß„‰ì
(
c⁄n
->
loˇldev
);

2594 
	`Cuæ_‰ì_s¶_c⁄fig
(&
c⁄n
->
s¶_c⁄fig
);

2596 
	`‰ì
(
c⁄n
);

2597 
	}
}

2599 
CURLcode
 
	$Cuæ_disc⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 
dód_c⁄√˘i⁄
)

2601 
Sessi⁄H™dÀ
 *
d©a
;

2602 if(!
c⁄n
)

2603  
CURLE_OK
;

2604 
d©a
 = 
c⁄n
->data;

2606 if(!
d©a
) {

2607 
	`DEBUGF
(
	`Ârötf
(
°dîr
, "DISCONNECT withoutÉasy handle, ignoring\n"));

2608  
CURLE_OK
;

2611 if(
c⁄n
->
dns_íåy
 !
NULL
) {

2612 
	`Cuæ_ªsﬁv_u∆ock
(
d©a
, 
c⁄n
->
dns_íåy
);

2613 
c⁄n
->
dns_íåy
 = 
NULL
;

2616 
	`Cuæ_ho°ˇche_¥u√
(
d©a
);

2619 
has_ho°_¡lm
 = (
c⁄n
->
¡lm
.
°©e
 !
NTLMSTATE_NONE
);

2620 
has_¥oxy_¡lm
 = (
c⁄n
->
¥oxy¡lm
.
°©e
 !
NTLMSTATE_NONE
);

2626 if(
has_ho°_¡lm
) {

2627 
d©a
->
°©e
.
authho°
.
d⁄e
 = 
FALSE
;

2628 
d©a
->
°©e
.
authho°
.
picked
 =

2629 
d©a
->
°©e
.
authho°
.
w™t
;

2632 if(
has_¥oxy_¡lm
) {

2633 
d©a
->
°©e
.
auth¥oxy
.
d⁄e
 = 
FALSE
;

2634 
d©a
->
°©e
.
auth¥oxy
.
picked
 =

2635 
d©a
->
°©e
.
auth¥oxy
.
w™t
;

2638 if(
has_ho°_¡lm
 || 
has_¥oxy_¡lm
)

2639 
d©a
->
°©e
.
auth¥obÀm
 = 
FALSE
;

2643 
	`Cuæ_hâp_¡lm_˛ónup
(
c⁄n
);

2646 if(
d©a
->
ªq
.
√wuæ
) {

2647 
	`‰ì
(
d©a
->
ªq
.
√wuæ
);

2648 
d©a
->
ªq
.
√wuæ
 = 
NULL
;

2651 if(
c⁄n
->
h™dÀr
->
disc⁄√˘
)

2653 
c⁄n
->
h™dÀr
->
	`disc⁄√˘
(c⁄n, 
dód_c⁄√˘i⁄
);

2656 
	`öfof
(
d©a
, "Closög c⁄√˘i⁄ %ld\n", 
c⁄n
->
c⁄√˘i⁄_id
);

2657 
	`Cuæ_c⁄nˇche_ªmove_c⁄n
(
d©a
->
°©e
.
c⁄n_ˇche
, 
c⁄n
);

2659 #i‡
	`deföed
(
USE_LIBIDN
)

2660 if(
c⁄n
->
ho°
.
íˇŒoc
)

2661 
	`idn_‰ì
(
c⁄n
->
ho°
.
íˇŒoc
);

2664 if(
c⁄n
->
¥oxy
.
íˇŒoc
)

2665 
	`idn_‰ì
(
c⁄n
->
¥oxy
.
íˇŒoc
);

2668 #ñi‡
	`deföed
(
USE_WIN32_IDN
)

2669 
	`‰ì
(
c⁄n
->
ho°
.
íˇŒoc
);

2672 if(
c⁄n
->
¥oxy
.
íˇŒoc
)

2673 
	`‰ì
(
c⁄n
->
¥oxy
.
íˇŒoc
);

2678 
	`Cuæ_s¶_˛o£
(
c⁄n
, 
FIRSTSOCKET
);

2681 if(
	`Cuæ_mu…i_pùñöe_íabÀd
(
d©a
->
mu…i
)) {

2682 
	`sig«lPùeClo£
(
c⁄n
->
£nd_pùe
, 
TRUE
);

2683 
	`sig«lPùeClo£
(
c⁄n
->
ªcv_pùe
, 
TRUE
);

2686 
	`c⁄n_‰ì
(
c⁄n
);

2688 
	`Cuæ_•ìdöô
(
d©a
);

2690  
CURLE_OK
;

2691 
	}
}

2698 
boﬁ
 
	$SockëIsDód
(
cuæ_sockë_t
 
sock
)

2700 
svÆ
;

2701 
boﬁ
 
ªt_vÆ
 = 
TRUE
;

2703 
svÆ
 = 
	`Cuæ_sockë_ªady
(
sock
, 
CURL_SOCKET_BAD
, 0);

2704 if(
svÆ
 == 0)

2706 
ªt_vÆ
 = 
FALSE
;

2708  
ªt_vÆ
;

2709 
	}
}

2711 
boﬁ
 
	$IsPùñöögPossibÀ
(c⁄° 
Sessi⁄H™dÀ
 *
h™dÀ
,

2712 c⁄° 
c⁄√˘d©a
 *
c⁄n
)

2714 if((
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
PROTO_FAMILY_HTTP
) &&

2715 
	`Cuæ_mu…i_pùñöe_íabÀd
(
h™dÀ
->
mu…i
) &&

2716 (
h™dÀ
->
£t
.
hâ¥eq
 =
HTTPREQ_GET
 ||

2717 
h™dÀ
->
£t
.
hâ¥eq
 =
HTTPREQ_HEAD
) &&

2718 
h™dÀ
->
£t
.
hâpvîsi⁄
 !
CURL_HTTP_VERSION_1_0
)

2719  
TRUE
;

2721  
FALSE
;

2722 
	}
}

2724 
boﬁ
 
	$Cuæ_isPùñöögE«bÀd
(c⁄° 
Sessi⁄H™dÀ
 *
h™dÀ
)

2726  
	`Cuæ_mu…i_pùñöe_íabÀd
(
h™dÀ
->
mu…i
);

2727 
	}
}

2729 
CURLcode
 
	$Cuæ_addH™dÀToPùñöe
(
Sessi⁄H™dÀ
 *
d©a
,

2730 
cuæ_Œi°
 *
pùñöe
)

2732 if(!
	`Cuæ_Œi°_ö£π_√xt
(
pùñöe
,Öùñöe->
èû
, 
d©a
))

2733  
CURLE_OUT_OF_MEMORY
;

2734  
CURLE_OK
;

2735 
	}
}

2737 
	$Cuæ_ªmoveH™dÀFromPùñöe
(
Sessi⁄H™dÀ
 *
h™dÀ
,

2738 
cuæ_Œi°
 *
pùñöe
)

2740 
cuæ_Œi°_ñemít
 *
cuº
;

2742 
cuº
 = 
pùñöe
->
hód
;

2743 
cuº
) {

2744 if(
cuº
->
±r
 =
h™dÀ
) {

2745 
	`Cuæ_Œi°_ªmove
(
pùñöe
, 
cuº
, 
NULL
);

2748 
cuº
 = cuº->
√xt
;

2752 
	}
}

2755 
	$Cuæ_¥ötPùñöe
(
cuæ_Œi°
 *
pùñöe
)

2757 
cuæ_Œi°_ñemít
 *
cuº
;

2759 
cuº
 = 
pùñöe
->
hód
;

2760 
cuº
) {

2761 
Sessi⁄H™dÀ
 *
d©a
 = (Sessi⁄H™dÀ *Ë
cuº
->
±r
;

2762 
	`öfof
(
d©a
, "H™dÀ i¿pùñöe: %s\n", d©a->
°©e
.
∑th
);

2763 
cuº
 = cuº->
√xt
;

2765 
	}
}

2768 
Sessi⁄H™dÀ
* 
	$gëh™dÀ©hód
(
cuæ_Œi°
 *
pùñöe
)

2770 
cuæ_Œi°_ñemít
 *
cuº
 = 
pùñöe
->
hód
;

2771 if(
cuº
) {

2772  (
Sessi⁄H™dÀ
 *Ë
cuº
->
±r
;

2775  
NULL
;

2776 
	}
}

2780 
	$Cuæ_gëoff_Æl_pùñöes
(
Sessi⁄H™dÀ
 *
d©a
,

2781 
c⁄√˘d©a
 *
c⁄n
)

2783 
boﬁ
 
ªcv_hód
 = (
c⁄n
->
ªadch™√l_öu£
 &&

2784 (
	`gëh™dÀ©hód
(
c⁄n
->
ªcv_pùe
Ë=
d©a
)Ë? 
TRUE
 : 
FALSE
;

2786 
boﬁ
 
£nd_hód
 = (
c⁄n
->
wrôech™√l_öu£
 &&

2787 (
	`gëh™dÀ©hód
(
c⁄n
->
£nd_pùe
Ë=
d©a
)Ë? 
TRUE
 : 
FALSE
;

2789 if(
	`Cuæ_ªmoveH™dÀFromPùñöe
(
d©a
, 
c⁄n
->
ªcv_pùe
Ë&& 
ªcv_hód
)

2790 
c⁄n
->
ªadch™√l_öu£
 = 
FALSE
;

2791 if(
	`Cuæ_ªmoveH™dÀFromPùñöe
(
d©a
, 
c⁄n
->
£nd_pùe
Ë&& 
£nd_hód
)

2792 
c⁄n
->
wrôech™√l_öu£
 = 
FALSE
;

2793 
	}
}

2795 
	$sig«lPùeClo£
(
cuæ_Œi°
 *
pùñöe
, 
boﬁ
 
pùe_broke
)

2797 
cuæ_Œi°_ñemít
 *
cuº
;

2799 if(!
pùñöe
)

2802 
cuº
 = 
pùñöe
->
hód
;

2803 
cuº
) {

2804 
cuæ_Œi°_ñemít
 *
√xt
 = 
cuº
->next;

2805 
Sessi⁄H™dÀ
 *
d©a
 = (Sessi⁄H™dÀ *Ë
cuº
->
±r
;

2807 #ifde‡
DEBUGBUILD


2808 if(
d©a
->
magic
 !
CURLEASY_MAGIC_NUMBER
) {

2810 
	`öfof
(
d©a
, "signalPipeClose() found BAADÉasy handle\n");

2814 if(
pùe_broke
)

2815 
d©a
->
°©e
.
pùe_broke
 = 
TRUE
;

2816 
	`Cuæ_mu…i_h™dÀPùeBªak
(
d©a
);

2817 
	`Cuæ_Œi°_ªmove
(
pùñöe
, 
cuº
, 
NULL
);

2818 
cuº
 = 
√xt
;

2820 
	}
}

2829 
c⁄√˘d©a
 *

2830 
	$föd_ﬁde°_idÀ_c⁄√˘i⁄
(
Sessi⁄H™dÀ
 *
d©a
)

2832 
c⁄nˇche
 *
bc
 = 
d©a
->
°©e
.
c⁄n_ˇche
;

2833 
cuæ_hash_ôî©‹
 
ôî
;

2834 
cuæ_Œi°_ñemít
 *
cuº
;

2835 
cuæ_hash_ñemít
 *
he
;

2836 
highsc‹e
=-1;

2837 
sc‹e
;

2838 
timevÆ
 
now
;

2839 
c⁄√˘d©a
 *
c⁄n_ˇndid©e
 = 
NULL
;

2840 
c⁄√˘bundÀ
 *
bundÀ
;

2842 
now
 = 
	`Cuæ_tvnow
();

2844 
	`Cuæ_hash_°¨t_ôî©e
(
bc
->
hash
, &
ôî
);

2846 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

2847 
he
) {

2848 
c⁄√˘d©a
 *
c⁄n
;

2850 
bundÀ
 = 
he
->
±r
;

2852 
cuº
 = 
bundÀ
->
c⁄n_li°
->
hód
;

2853 
cuº
) {

2854 
c⁄n
 = 
cuº
->
±r
;

2856 if(!
c⁄n
->
öu£
) {

2858 
sc‹e
 = 
	`Cuæ_tvdiff
(
now
, 
c⁄n
->now);

2860 if(
sc‹e
 > 
highsc‹e
) {

2861 
highsc‹e
 = 
sc‹e
;

2862 
c⁄n_ˇndid©e
 = 
c⁄n
;

2865 
cuº
 = cuº->
√xt
;

2868 
he
 = 
	`Cuæ_hash_√xt_ñemít
(&
ôî
);

2871  
c⁄n_ˇndid©e
;

2872 
	}
}

2881 
c⁄√˘d©a
 *

2882 
	$föd_ﬁde°_idÀ_c⁄√˘i⁄_ö_bundÀ
(
Sessi⁄H™dÀ
 *
d©a
,

2883 
c⁄√˘bundÀ
 *
bundÀ
)

2885 
cuæ_Œi°_ñemít
 *
cuº
;

2886 
highsc‹e
=-1;

2887 
sc‹e
;

2888 
timevÆ
 
now
;

2889 
c⁄√˘d©a
 *
c⁄n_ˇndid©e
 = 
NULL
;

2890 
c⁄√˘d©a
 *
c⁄n
;

2892 ()
d©a
;

2894 
now
 = 
	`Cuæ_tvnow
();

2896 
cuº
 = 
bundÀ
->
c⁄n_li°
->
hód
;

2897 
cuº
) {

2898 
c⁄n
 = 
cuº
->
±r
;

2900 if(!
c⁄n
->
öu£
) {

2902 
sc‹e
 = 
	`Cuæ_tvdiff
(
now
, 
c⁄n
->now);

2904 if(
sc‹e
 > 
highsc‹e
) {

2905 
highsc‹e
 = 
sc‹e
;

2906 
c⁄n_ˇndid©e
 = 
c⁄n
;

2909 
cuº
 = cuº->
√xt
;

2912  
c⁄n_ˇndid©e
;

2913 
	}
}

2927 
boﬁ


2928 
	$C⁄√˘i⁄Exi°s
(
Sessi⁄H™dÀ
 *
d©a
,

2929 
c⁄√˘d©a
 *
√edÀ
,

2930 
c⁄√˘d©a
 **
u£this
,

2931 
boﬁ
 *
f‹˚_ªu£
)

2933 
c⁄√˘d©a
 *
check
;

2934 
c⁄√˘d©a
 *
cho£n
 = 0;

2935 
boﬁ
 
ˇnPùñöe
 = 
	`IsPùñöögPossibÀ
(
d©a
, 
√edÀ
);

2936 
boﬁ
 
w™tNTLMhâp
 = ((
d©a
->
°©e
.
authho°
.
w™t
 & 
CURLAUTH_NTLM
) ||

2937 (
d©a
->
°©e
.
authho°
.
w™t
 & 
CURLAUTH_NTLM_WB
)) &&

2938 (
√edÀ
->
h™dÀr
->
¥Ÿocﬁ
 & 
PROTO_FAMILY_HTTP
Ë? 
TRUE
 : 
FALSE
;

2939 
c⁄√˘bundÀ
 *
bundÀ
;

2941 *
f‹˚_ªu£
 = 
FALSE
;

2944 if(
ˇnPùñöe
 && 
	`Cuæ_pùñöe_sôe_bœckli°ed
(
d©a
, 
√edÀ
)) {

2945 
ˇnPùñöe
 = 
FALSE
;

2950 
bundÀ
 = 
	`Cuæ_c⁄nˇche_föd_bundÀ
(
d©a
->
°©e
.
c⁄n_ˇche
,

2951 
√edÀ
->
ho°
.
«me
);

2952 if(
bundÀ
) {

2953 
size_t
 
max_pùe_Àn
 = 
	`Cuæ_mu…i_max_pùñöe_Àngth
(
d©a
->
mu…i
);

2954 
size_t
 
be°_pùe_Àn
 = 
max_pùe_Àn
;

2955 
cuæ_Œi°_ñemít
 *
cuº
;

2957 
	`öfof
(
d©a
, "Found bundle for host %s: %p\n",

2958 
√edÀ
->
ho°
.
«me
, (*)
bundÀ
);

2961 if(
ˇnPùñöe
 && !
bundÀ
->
£rvî_suµ‹ts_pùñöög
) {

2962 
	`öfof
(
d©a
, "Server doesn't supportÖipelining\n");

2963 
ˇnPùñöe
 = 
FALSE
;

2966 
cuº
 = 
bundÀ
->
c⁄n_li°
->
hód
;

2967 
cuº
) {

2968 
boﬁ
 
m©ch
 = 
FALSE
;

2969 
boﬁ
 
¸edítülsM©ch
 = 
FALSE
;

2970 
size_t
 
pùeLí
;

2976 
check
 = 
cuº
->
±r
;

2977 
cuº
 = cuº->
√xt
;

2979 
pùeLí
 = 
check
->
£nd_pùe
->
size
 + check->
ªcv_pùe
->size;

2981 if(!
pùeLí
 && !
check
->
öu£
) {

2985 
boﬁ
 
dód
;

2986 if(
check
->
h™dÀr
->
¥Ÿocﬁ
 & 
CURLPROTO_RTSP
)

2988 
dód
 = 
	`Cuæ_π•_c⁄nisdód
(
check
);

2990 
dód
 = 
	`SockëIsDód
(
check
->
sock
[
FIRSTSOCKET
]);

2992 if(
dód
) {

2993 
check
->
d©a
 = data;

2994 
	`öfof
(
d©a
, "Connection %ld seemsÅo be dead!\n",

2995 
check
->
c⁄√˘i⁄_id
);

2998 
	`Cuæ_disc⁄√˘
(
check
, 
TRUE
);

3003 if(
ˇnPùñöe
) {

3005 
Sessi⁄H™dÀ
* 
sh
 = 
	`gëh™dÀ©hód
(
check
->
£nd_pùe
);

3006 
Sessi⁄H™dÀ
* 
rh
 = 
	`gëh™dÀ©hód
(
check
->
ªcv_pùe
);

3007 if(
sh
) {

3008 if(!
	`IsPùñöögPossibÀ
(
sh
, 
check
))

3011 if(
rh
) {

3012 if(!
	`IsPùñöögPossibÀ
(
rh
, 
check
))

3017 if(
pùeLí
 > 0) {

3023 if(
	`Cuæ_ªsﬁvî_asynch
()) {

3026 if(!
check
->
ù_addr_°r
[0]) {

3027 
	`öfof
(
d©a
,

3029 
check
->
c⁄√˘i⁄_id
);

3034 if((
check
->
sock
[
FIRSTSOCKET
] =
CURL_SOCKET_BAD
) ||

3035 
check
->
bôs
.
˛o£
) {

3038 
	`öfof
(
d©a
, "Connection #%ld isn't openÉnough, can'tÑeuse\n",

3039 
check
->
c⁄√˘i⁄_id
);

3040 #ifde‡
DEBUGBUILD


3041 if(
check
->
ªcv_pùe
->
size
 > 0) {

3042 
	`öfof
(
d©a
,

3044 
check
->
c⁄√˘i⁄_id
);

3051 if((
√edÀ
->
h™dÀr
->
Êags
&
PROTOPT_SSL
) !=

3052 (
check
->
h™dÀr
->
Êags
&
PROTOPT_SSL
))

3054 if(!(
√edÀ
->
h™dÀr
->
¥Ÿocﬁ
 & 
check
->handler->protocol))

3058 if(
√edÀ
->
h™dÀr
->
Êags
&
PROTOPT_SSL
) {

3059 if((
d©a
->
£t
.
s¶
.
vîify≥î
 !
check
->verifypeer) ||

3060 (
d©a
->
£t
.
s¶
.
vîifyho°
 !
check
->verifyhost))

3064 if(
√edÀ
->
bôs
.
¥oxy
 !
check
->bits.proxy)

3068 if(!
ˇnPùñöe
 && 
check
->
öu£
)

3073 if(
√edÀ
->
loˇldev
 ||ÇìdÀ->
loˇÕ‹t
) {

3085 if((
check
->
loˇÕ‹t
 !
√edÀ
->localport) ||

3086 (
check
->
loˇÕ‹å™ge
 !
√edÀ
->localportrange) ||

3087 !
check
->
loˇldev
 ||

3088 !
√edÀ
->
loˇldev
 ||

3089 
	`°rcmp
(
check
->
loˇldev
, 
√edÀ
->localdev))

3093 if((!(
√edÀ
->
h™dÀr
->
Êags
 & 
PROTOPT_CREDSPERREQUEST
)) ||

3094 
w™tNTLMhâp
) {

3097 if(!
	`°ªquÆ
(
√edÀ
->
u£r
, 
check
->user) ||

3098 !
	`°ªquÆ
(
√edÀ
->
∑sswd
, 
check
->passwd)) {

3102 
¸edítülsM©ch
 = 
TRUE
;

3105 if(!
√edÀ
->
bôs
.
hâµroxy
 ||ÇìdÀ->
h™dÀr
->
Êags
&
PROTOPT_SSL
 ||

3106 (
√edÀ
->
bôs
.
hâµroxy
 && 
check
->bits.httpproxy &&

3107 
√edÀ
->
bôs
.
tu¬ñ_¥oxy
 && 
check
->bits.tunnel_proxy &&

3108 
	`Cuæ_øw_equÆ
(
√edÀ
->
¥oxy
.
«me
, 
check
->proxy.name) &&

3109 (
√edÀ
->
p‹t
 =
check
->port))) {

3115 if((
	`Cuæ_øw_equÆ
(
√edÀ
->
h™dÀr
->
scheme
, 
check
->handler->scheme) ||

3116 
√edÀ
->
h™dÀr
->
¥Ÿocﬁ
 & 
check
->handler->protocol) &&

3117 
	`Cuæ_øw_equÆ
(
√edÀ
->
ho°
.
«me
, 
check
->host.name) &&

3118 
√edÀ
->
ªmŸe_p‹t
 =
check
->remote_port) {

3119 if(
√edÀ
->
h™dÀr
->
Êags
 & 
PROTOPT_SSL
) {

3122 if(!
	`Cuæ_s¶_c⁄fig_m©ches
(&
√edÀ
->
s¶_c⁄fig
,

3123 &
check
->
s¶_c⁄fig
)) {

3124 
	`DEBUGF
(
	`öfof
(
d©a
,

3127 
check
->
c⁄√˘i⁄_id
));

3130 if(
check
->
s¶
[
FIRSTSOCKET
].
°©e
 !
s¶_c⁄√˘i⁄_com∂ëe
) {

3131 
	`DEBUGF
(
	`öfof
(
d©a
,

3134 
check
->
c⁄√˘i⁄_id
));

3138 
m©ch
 = 
TRUE
;

3143 if(
check
->
bôs
.
¥oxy
 &&

3144 (
√edÀ
->
¥oxyty≥
 =
check
->proxytype) &&

3145 (
√edÀ
->
bôs
.
tu¬ñ_¥oxy
 =
check
->bits.tunnel_proxy) &&

3146 
	`Cuæ_øw_equÆ
(
√edÀ
->
¥oxy
.
«me
, 
check
->proxy.name) &&

3147 
√edÀ
->
p‹t
 =
check
->port) {

3149 
m©ch
 = 
TRUE
;

3153 if(
m©ch
) {

3159 if(
w™tNTLMhâp
) {

3160 if(
¸edítülsM©ch
 && 
check
->
¡lm
.
°©e
 !
NTLMSTATE_NONE
) {

3161 
cho£n
 = 
check
;

3164 *
f‹˚_ªu£
 = 
TRUE
;

3167 if(
¸edítülsM©ch
)

3169 
cho£n
 = 
check
;

3173 if(
ˇnPùñöe
) {

3178 if(
pùeLí
 == 0) {

3180 
cho£n
 = 
check
;

3185 if(
pùeLí
 >
max_pùe_Àn
)

3189 if(
	`Cuæ_pùñöe_≥«lized
(
d©a
, 
check
))

3192 if(
pùeLí
 < 
be°_pùe_Àn
) {

3195 
cho£n
 = 
check
;

3196 
be°_pùe_Àn
 = 
pùeLí
;

3202 
cho£n
 = 
check
;

3209 if(
cho£n
) {

3210 *
u£this
 = 
cho£n
;

3211  
TRUE
;

3214  
FALSE
;

3215 
	}
}

3219 
boﬁ


3220 
	$C⁄√˘i⁄D⁄e
(
Sessi⁄H™dÀ
 *
d©a
, 
c⁄√˘d©a
 *
c⁄n
)

3223 
size_t
 
maxc⁄√˘s
 =

3224 (
d©a
->
mu…i
->
maxc⁄√˘s
 < 0Ë? d©a->mu…i->
num_ósy
 * 4:

3225 
d©a
->
mu…i
->
maxc⁄√˘s
;

3226 
c⁄√˘d©a
 *
c⁄n_ˇndid©e
 = 
NULL
;

3229 
c⁄n
->
öu£
 = 
FALSE
;

3231 if(
maxc⁄√˘s
 > 0 &&

3232 
d©a
->
°©e
.
c⁄n_ˇche
->
num_c⁄√˘i⁄s
 > 
maxc⁄√˘s
) {

3233 
	`öfof
(
d©a
, "Connection cache is full, closingÅhe oldest one.\n");

3235 
c⁄n_ˇndid©e
 = 
	`föd_ﬁde°_idÀ_c⁄√˘i⁄
(
d©a
);

3237 if(
c⁄n_ˇndid©e
) {

3239 
c⁄n_ˇndid©e
->
d©a
 = data;

3242 ()
	`Cuæ_disc⁄√˘
(
c⁄n_ˇndid©e
, 
FALSE
);

3246  (
c⁄n_ˇndid©e
 =
c⁄n
Ë? 
FALSE
 : 
TRUE
;

3247 
	}
}

3257 
CURLcode
 
	$C⁄√˘i⁄St‹e
(
Sessi⁄H™dÀ
 *
d©a
,

3258 
c⁄√˘d©a
 *
c⁄n
)

3260  
	`Cuæ_c⁄nˇche_add_c⁄n
(
d©a
->
°©e
.
c⁄n_ˇche
, 
c⁄n
);

3261 
	}
}

3269 
CURLcode
 
	$Cuæ_c⁄√˘ed_¥oxy
(
c⁄√˘d©a
 *
c⁄n
,

3270 
socködex
)

3272 if(!
c⁄n
->
bôs
.
¥oxy
 || 
socködex
)

3275  
CURLE_OK
;

3277 
c⁄n
->
¥oxyty≥
) {

3278 #i‚de‡
CURL_DISABLE_PROXY


3279 
CURLPROXY_SOCKS5
:

3280 
CURLPROXY_SOCKS5_HOSTNAME
:

3281  
	`Cuæ_SOCKS5
(
c⁄n
->
¥oxyu£r
, c⁄n->
¥oxy∑sswd
,

3282 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
,

3283 
FIRSTSOCKET
, 
c⁄n
);

3285 
CURLPROXY_SOCKS4
:

3286  
	`Cuæ_SOCKS4
(
c⁄n
->
¥oxyu£r
, c⁄n->
ho°
.
«me
,

3287 
c⁄n
->
ªmŸe_p‹t
, 
FIRSTSOCKET
, c⁄n, 
FALSE
);

3289 
CURLPROXY_SOCKS4A
:

3290  
	`Cuæ_SOCKS4
(
c⁄n
->
¥oxyu£r
, c⁄n->
ho°
.
«me
,

3291 
c⁄n
->
ªmŸe_p‹t
, 
FIRSTSOCKET
, c⁄n, 
TRUE
);

3294 
CURLPROXY_HTTP
:

3295 
CURLPROXY_HTTP_1_0
:

3302  
CURLE_OK
;

3303 
	}
}

3308 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


3309 
	$Cuæ_vîbo£c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
)

3311 if(
c⁄n
->
d©a
->
£t
.
vîbo£
)

3312 
	`öfof
(
c⁄n
->
d©a
, "ConnectedÅo %s (%s)Öort %ld (#%ld)\n",

3313 
c⁄n
->
bôs
.
¥oxy
 ? c⁄n->¥oxy.
di•«me
 : c⁄n->
ho°
.dispname,

3314 
c⁄n
->
ù_addr_°r
, c⁄n->
p‹t
, c⁄n->
c⁄√˘i⁄_id
);

3315 
	}
}

3318 
	$Cuæ_¥Ÿocﬁ_gësock
(
c⁄√˘d©a
 *
c⁄n
,

3319 
cuæ_sockë_t
 *
socks
,

3320 
numsocks
)

3322 if(
c⁄n
->
h™dÀr
->
¥Ÿo_gësock
)

3323  
c⁄n
->
h™dÀr
->
	`¥Ÿo_gësock
(c⁄n, 
socks
, 
numsocks
);

3324  
GETSOCK_BLANK
;

3325 
	}
}

3327 
	$Cuæ_doög_gësock
(
c⁄√˘d©a
 *
c⁄n
,

3328 
cuæ_sockë_t
 *
socks
,

3329 
numsocks
)

3331 if(
c⁄n
 && c⁄n->
h™dÀr
->
doög_gësock
)

3332  
c⁄n
->
h™dÀr
->
	`doög_gësock
(c⁄n, 
socks
, 
numsocks
);

3333  
GETSOCK_BLANK
;

3334 
	}
}

3342 
CURLcode
 
	$Cuæ_¥Ÿocﬁ_c⁄√˘ög
(
c⁄√˘d©a
 *
c⁄n
,

3343 
boﬁ
 *
d⁄e
)

3345 
CURLcode
 
ªsu…
=
CURLE_OK
;

3347 if(
c⁄n
 && c⁄n->
h™dÀr
->
c⁄√˘ög
) {

3348 *
d⁄e
 = 
FALSE
;

3349 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`c⁄√˘ög
(c⁄n, 
d⁄e
);

3352 *
d⁄e
 = 
TRUE
;

3354  
ªsu…
;

3355 
	}
}

3362 
CURLcode
 
	$Cuæ_¥Ÿocﬁ_doög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
)

3364 
CURLcode
 
ªsu…
=
CURLE_OK
;

3366 if(
c⁄n
 && c⁄n->
h™dÀr
->
doög
) {

3367 *
d⁄e
 = 
FALSE
;

3368 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`doög
(c⁄n, 
d⁄e
);

3371 *
d⁄e
 = 
TRUE
;

3373  
ªsu…
;

3374 
	}
}

3381 
CURLcode
 
	$Cuæ_¥Ÿocﬁ_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

3382 
boﬁ
 *
¥Ÿocﬁ_d⁄e
)

3384 
CURLcode
 
ªsu…
=
CURLE_OK
;

3386 *
¥Ÿocﬁ_d⁄e
 = 
FALSE
;

3388 if(
c⁄n
->
bôs
.
t˝c⁄√˘
[
FIRSTSOCKET
] && c⁄n->bôs.
¥Ÿoc⁄n°¨t
) {

3395 if(!
c⁄n
->
h™dÀr
->
c⁄√˘ög
)

3396 *
¥Ÿocﬁ_d⁄e
 = 
TRUE
;

3398  
CURLE_OK
;

3401 if(!
c⁄n
->
bôs
.
¥Ÿoc⁄n°¨t
) {

3403 
ªsu…
 = 
	`Cuæ_¥oxy_c⁄√˘
(
c⁄n
);

3404 if(
ªsu…
)

3405  
ªsu…
;

3407 if(
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 && c⁄n->bôs.
hâµroxy
 &&

3408 (
c⁄n
->
tu¬ñ_°©e
[
FIRSTSOCKET
] !
TUNNEL_COMPLETE
))

3411  
CURLE_OK
;

3413 if(
c⁄n
->
h™dÀr
->
c⁄√˘_ô
) {

3417 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`c⁄√˘_ô
(c⁄n, 
¥Ÿocﬁ_d⁄e
);

3420 *
¥Ÿocﬁ_d⁄e
 = 
TRUE
;

3424 if(!
ªsu…
)

3425 
c⁄n
->
bôs
.
¥Ÿoc⁄n°¨t
 = 
TRUE
;

3428  
ªsu…
;

3429 
	}
}

3434 
boﬁ
 
	$is_ASCII_«me
(c⁄° *
ho°«me
)

3436 c⁄° *
ch
 = (c⁄° *)
ho°«me
;

3438 *
ch
) {

3439 if(*
ch
++ & 0x80)

3440  
FALSE
;

3442  
TRUE
;

3443 
	}
}

3445 #ifde‡
USE_LIBIDN


3449 
boﬁ
 
	$éd_check_«me
(
Sessi⁄H™dÀ
 *
d©a
,

3450 c⁄° *
a˚_ho°«me
)

3452 
size_t
 
îr_pos
;

3453 *
uc_«me
 = 
NULL
;

3454 
rc
;

3455 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


3456 c⁄° *
éd_îrmsg
 = "<no msg>";

3458 ()
d©a
;

3462 
rc
 = 
	`id«_to_unicode_lzlz
(
a˚_ho°«me
, &
uc_«me
, 0);

3463 if(
rc
 !
IDNA_SUCCESS
)

3464  
FALSE
;

3466 
rc
 = 
	`éd_check_lz
(
uc_«me
, &
îr_pos
, 
NULL
);

3467 #i‚de‡
CURL_DISABLE_VERBOSE_STRINGS


3468 #ifde‡
HAVE_TLD_STRERROR


3469 if(
rc
 !
TLD_SUCCESS
)

3470 
éd_îrmsg
 = 
	`éd_°ªº‹
((
Tld_rc
)
rc
);

3472 if(
rc
 =
TLD_INVALID
)

3473 
	`öfof
(
d©a
, "WARNING: %s;Öos %u = `%c'/0x%02X\n",

3474 
éd_îrmsg
, 
îr_pos
, 
uc_«me
[err_pos],

3475 
uc_«me
[
îr_pos
] & 255);

3476 if(
rc
 !
TLD_SUCCESS
)

3477 
	`öfof
(
d©a
, "WARNING: TLD check for %s failed; %s\n",

3478 
uc_«me
, 
éd_îrmsg
);

3480 if(
uc_«me
)

3481 
	`idn_‰ì
(
uc_«me
);

3482 if(
rc
 !
TLD_SUCCESS
)

3483  
FALSE
;

3485  
TRUE
;

3486 
	}
}

3492 
	$fix_ho°«me
(
Sessi⁄H™dÀ
 *
d©a
,

3493 
c⁄√˘d©a
 *
c⁄n
, 
ho°«me
 *
ho°
)

3495 
size_t
 
Àn
;

3497 #i‚de‡
USE_LIBIDN


3498 ()
d©a
;

3499 ()
c⁄n
;

3500 #ñi‡
	`deföed
(
CURL_DISABLE_VERBOSE_STRINGS
)

3501 ()
c⁄n
;

3505 
ho°
->
di•«me
 = ho°->
«me
;

3507 
Àn
 = 
	`°æí
(
ho°
->
«me
);

3508 if(
ho°
->
«me
[
Àn
-1] == '.')

3511 
ho°
->
«me
[
Àn
-1]=0;

3513 if(!
	`is_ASCII_«me
(
ho°
->
«me
)) {

3514 #ifde‡
USE_LIBIDN


3518 if(
	`°rög¥ï_check_vîsi⁄
(
LIBIDN_REQUIRED_VERSION
)) {

3519 *
a˚_ho°«me
 = 
NULL
;

3520 
rc
 = 
	`id«_to_ascii_lz
(
ho°
->
«me
, &
a˚_ho°«me
, 0);

3521 
	`öfof
 (
d©a
, "Input domainÉncodedás `%s'\n",

3522 
	`°rög¥ï_loˇÀ_ch¨£t
 ());

3523 if(
rc
 !
IDNA_SUCCESS
)

3524 
	`öfof
(
d©a
, "FailedÅo convert %sÅo ACE; %s\n",

3525 
ho°
->
«me
, 
	`Cuæ_idn_°ªº‹
(
c⁄n
,
rc
));

3529 ()
	`éd_check_«me
(
d©a
, 
a˚_ho°«me
);

3531 
ho°
->
íˇŒoc
 = 
a˚_ho°«me
;

3533 
ho°
->
«me
 = ho°->
íˇŒoc
;

3536 #ñi‡
	`deföed
(
USE_WIN32_IDN
)

3540 *
a˚_ho°«me
 = 
NULL
;

3541 
rc
 = 
	`cuæ_wö32_idn_to_ascii
(
ho°
->
«me
, &
a˚_ho°«me
);

3542 if(
rc
 == 0)

3543 
	`öfof
(
d©a
, "FailedÅo convert %sÅo ACE;\n",

3544 
ho°
->
«me
);

3546 
ho°
->
íˇŒoc
 = 
a˚_ho°«me
;

3548 
ho°
->
«me
 = ho°->
íˇŒoc
;

3551 
	`öfof
(
d©a
, "IDN supportÇotÖresent, can'tÖarse Unicode domains\n");

3554 
	}
}

3556 
	$Œi°_dt‹
(*
u£r
, *
ñemít
)

3558 ()
u£r
;

3559 ()
ñemít
;

3561 
	}
}

3566 
c⁄√˘d©a
 *
	$Æloˇã_c⁄n
(
Sessi⁄H™dÀ
 *
d©a
)

3568 
c⁄√˘d©a
 *
c⁄n
 = 
	`ˇŒoc
(1, (connectdata));

3569 if(!
c⁄n
)

3570  
NULL
;

3572 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_dummy
;

3578 
c⁄n
->
sock
[
FIRSTSOCKET
] = 
CURL_SOCKET_BAD
;

3579 
c⁄n
->
sock
[
SECONDARYSOCKET
] = 
CURL_SOCKET_BAD
;

3580 
c⁄n
->
ãmpsock
[0] = 
CURL_SOCKET_BAD
;

3581 
c⁄n
->
ãmpsock
[1] = 
CURL_SOCKET_BAD
;

3582 
c⁄n
->
c⁄√˘i⁄_id
 = -1;

3583 
c⁄n
->
p‹t
 = -1;

3584 
c⁄n
->
ªmŸe_p‹t
 = -1;

3589 
	`c⁄n˛o£
(
c⁄n
, "DefaultÅo force-close");

3592 
c⁄n
->
¸óãd
 = 
	`Cuæ_tvnow
();

3594 
c⁄n
->
d©a
 = data;

3597 
c⁄n
->
¥oxyty≥
 = 
d©a
->
£t
.proxytype;

3599 #ifde‡
CURL_DISABLE_PROXY


3601 
c⁄n
->
bôs
.
¥oxy
 = 
FALSE
;

3602 
c⁄n
->
bôs
.
hâµroxy
 = 
FALSE
;

3603 
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
 = 
FALSE
;

3604 
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 = 
FALSE
;

3610 
c⁄n
->
bôs
.
¥oxy
 = (
d©a
->
£t
.
°r
[
STRING_PROXY
] &&

3611 *
d©a
->
£t
.
°r
[
STRING_PROXY
])?
TRUE
:
FALSE
;

3612 
c⁄n
->
bôs
.
hâµroxy
 = (c⁄n->bôs.
¥oxy
 &&

3613 (
c⁄n
->
¥oxyty≥
 =
CURLPROXY_HTTP
 ||

3614 
c⁄n
->
¥oxyty≥
 =
CURLPROXY_HTTP_1_0
))?
TRUE
:
FALSE
;

3615 
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
 =

3616 (
NULL
 !
d©a
->
£t
.
°r
[
STRING_PROXYUSERNAME
])?
TRUE
:
FALSE
;

3617 
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 = 
d©a
->
£t
.
tu¬ñ_thru_hâµroxy
;

3621 
c⁄n
->
bôs
.
u£r_∑sswd
 = (
NULL
 !
d©a
->
£t
.
°r
[
STRING_USERNAME
])?
TRUE
:
FALSE
;

3622 
c⁄n
->
bôs
.
·p_u£_ïsv
 = 
d©a
->
£t
.ftp_use_epsv;

3623 
c⁄n
->
bôs
.
·p_u£_ïπ
 = 
d©a
->
£t
.ftp_use_eprt;

3625 
c⁄n
->
vîify≥î
 = 
d©a
->
£t
.
s¶
.verifypeer;

3626 
c⁄n
->
vîifyho°
 = 
d©a
->
£t
.
s¶
.verifyhost;

3628 
c⁄n
->
ù_vîsi⁄
 = 
d©a
->
£t
.
ùvî
;

3630 #i‡
	`deföed
(
USE_NTLM
Ë&& deföed(
NTLM_WB_ENABLED
)

3631 
c⁄n
->
¡lm_auth_hÕr_sockë
 = 
CURL_SOCKET_BAD
;

3632 
c⁄n
->
¡lm_auth_hÕr_pid
 = 0;

3633 
c⁄n
->
chÆÀnge_hódî
 = 
NULL
;

3634 
c⁄n
->
ª•⁄£_hódî
 = 
NULL
;

3637 if(
	`Cuæ_mu…i_pùñöe_íabÀd
(
d©a
->
mu…i
) &&

3638 !
c⁄n
->
ma°î_buf„r
) {

3640 
c⁄n
->
ma°î_buf„r
 = 
	`ˇŒoc
(
BUFSIZE
,  ());

3641 if(!
c⁄n
->
ma°î_buf„r
)

3642 
îr‹
;

3646 
c⁄n
->
£nd_pùe
 = 
	`Cuæ_Œi°_Æloc
((
cuæ_Œi°_dt‹
Ë
Œi°_dt‹
);

3647 
c⁄n
->
ªcv_pùe
 = 
	`Cuæ_Œi°_Æloc
((
cuæ_Œi°_dt‹
Ë
Œi°_dt‹
);

3648 if(!
c⁄n
->
£nd_pùe
 || !c⁄n->
ªcv_pùe
)

3649 
îr‹
;

3651 #ifde‡
HAVE_GSSAPI


3652 
c⁄n
->
d©a_¥Ÿ
 = 
PROT_CLEAR
;

3656 if(
d©a
->
£t
.
°r
[
STRING_DEVICE
]) {

3657 
c⁄n
->
loˇldev
 = 
	`°rdup
(
d©a
->
£t
.
°r
[
STRING_DEVICE
]);

3658 if(!
c⁄n
->
loˇldev
)

3659 
îr‹
;

3661 
c⁄n
->
loˇÕ‹å™ge
 = 
d©a
->
£t
.localportrange;

3662 
c⁄n
->
loˇÕ‹t
 = 
d©a
->
£t
.localport;

3666 
c⁄n
->
f˛o£sockë
 = 
d©a
->
£t
.fclosesocket;

3667 
c⁄n
->
˛o£sockë_˛õ¡
 = 
d©a
->
£t
.closesocket_client;

3669  
c⁄n
;

3670 
îr‹
:

3672 
	`Cuæ_Œi°_de°roy
(
c⁄n
->
£nd_pùe
, 
NULL
);

3673 
	`Cuæ_Œi°_de°roy
(
c⁄n
->
ªcv_pùe
, 
NULL
);

3675 
c⁄n
->
£nd_pùe
 = 
NULL
;

3676 
c⁄n
->
ªcv_pùe
 = 
NULL
;

3678 
	`Cuæ_ß„‰ì
(
c⁄n
->
ma°î_buf„r
);

3679 
	`Cuæ_ß„‰ì
(
c⁄n
->
loˇldev
);

3680 
	`Cuæ_ß„‰ì
(
c⁄n
);

3681  
NULL
;

3682 
	}
}

3684 
CURLcode
 
	$föd¥Ÿocﬁ
(
Sessi⁄H™dÀ
 *
d©a
,

3685 
c⁄√˘d©a
 *
c⁄n
,

3686 c⁄° *
¥Ÿo°r
)

3688 c⁄° 
Cuæ_h™dÀr
 * c⁄° *
µ
;

3689 c⁄° 
Cuæ_h™dÀr
 *
p
;

3694 
µ
 = 
¥Ÿocﬁs
; (
p
 = *µË!
NULL
;Öp++) {

3695 if(
	`Cuæ_øw_equÆ
(
p
->
scheme
, 
¥Ÿo°r
)) {

3697 if(!(
d©a
->
£t
.
Ælowed_¥Ÿocﬁs
 & 
p
->
¥Ÿocﬁ
))

3703 if(
d©a
->
°©e
.
this_is_a_fﬁlow
 &&

3704 !(
d©a
->
£t
.
ªdú_¥Ÿocﬁs
 & 
p
->
¥Ÿocﬁ
))

3709 
c⁄n
->
h™dÀr
 = c⁄n->
giví
 = 
p
;

3712  
CURLE_OK
;

3720 
	`Áûf
(
d©a
, "PrŸocﬁ %†nŸ suµ‹ãd o∏dißbÀd i¿" 
LIBCURL_NAME
,

3721 
¥Ÿo°r
);

3723  
CURLE_UNSUPPORTED_PROTOCOL
;

3724 
	}
}

3729 
CURLcode
 
	$∑r£uæ™dfûlc⁄n
(
Sessi⁄H™dÀ
 *
d©a
,

3730 
c⁄√˘d©a
 *
c⁄n
,

3731 
boﬁ
 *
¥Ÿ_missög
,

3732 **
u£Ω
, **
∑sswdp
,

3733 **
›ti⁄•
)

3735 *
©
;

3736 *
‰agmít
;

3737 *
∑th
 = 
d©a
->
°©e
.path;

3738 *
quîy
;

3739 
rc
;

3740 
¥Ÿobuf
[16] = "";

3741 c⁄° *
¥Ÿ›
 = "";

3742 
CURLcode
 
ªsu…
;

3743 
boﬁ
 
ªbuûd_uæ
 = 
FALSE
;

3745 *
¥Ÿ_missög
 = 
FALSE
;

3755 if((2 =
	`ssˇnf
(
d©a
->
ch™ge
.
uæ
, "%15[^:]:%[^\n]",

3756 
¥Ÿobuf
, 
∑th
)) &&

3757 
	`Cuæ_øw_equÆ
(
¥Ÿobuf
, "file")) {

3758 if(
∑th
[0] == '/' &&Öath[1] == '/') {

3766 
	`memmove
(
∑th
,Ö©h + 2, 
	`°æí
(path + 2)+1);

3773 if(
∑th
[0] != '/') {

3776 *
±r
=
	`°rchr
(
∑th
, '/');

3777 if(
±r
) {

3793 if(
±r
[1] && ('/' ==Ötr[1]))

3796 
±r
++;

3799 
	`memmove
(
∑th
, 
±r
, 
	`°æí
(ptr)+1);

3803 
¥Ÿ›
 = "file";

3807 
∑th
[0]=0;

3809 if(2 > 
	`ssˇnf
(
d©a
->
ch™ge
.
uæ
,

3811 
¥Ÿobuf
,

3812 
c⁄n
->
ho°
.
«me
, 
∑th
)) {

3818 
rc
 = 
	`ssˇnf
(
d©a
->
ch™ge
.
uæ
, "%[^\n/?]%[^\n]", 
c⁄n
->
ho°
.
«me
, 
∑th
);

3819 if(1 > 
rc
) {

3825 #i‡
	`deföed
(
__DJGPP__
Ë&& (
DJGPP_MINOR
 == 4)

3826 if(!(
rc
 =-1 && *
c⁄n
->
ho°
.
«me
))

3829 
	`Áûf
(
d©a
, "<url> malformed");

3830  
CURLE_URL_MALFORMAT
;

3842 if(
	`check¥efix
("FTP.", 
c⁄n
->
ho°
.
«me
))

3843 
¥Ÿ›
 = "ftp";

3844 if(
	`check¥efix
("DICT.", 
c⁄n
->
ho°
.
«me
))

3845 
¥Ÿ›
 = "DICT";

3846 if(
	`check¥efix
("LDAP.", 
c⁄n
->
ho°
.
«me
))

3847 
¥Ÿ›
 = "LDAP";

3848 if(
	`check¥efix
("IMAP.", 
c⁄n
->
ho°
.
«me
))

3849 
¥Ÿ›
 = "IMAP";

3850 if(
	`check¥efix
("SMTP.", 
c⁄n
->
ho°
.
«me
))

3851 
¥Ÿ›
 = "smtp";

3852 if(
	`check¥efix
("POP3.", 
c⁄n
->
ho°
.
«me
))

3853 
¥Ÿ›
 = "pop3";

3855 
¥Ÿ›
 = "http";

3858 *
¥Ÿ_missög
 = 
TRUE
;

3861 
¥Ÿ›
 = 
¥Ÿobuf
;

3868 
©
 = 
	`°rchr
(
c⁄n
->
ho°
.
«me
, '@');

3869 if(
©
)

3870 
quîy
 = 
	`°rchr
(
©
+1, '?');

3872 
quîy
 = 
	`°rchr
(
c⁄n
->
ho°
.
«me
, '?');

3874 if(
quîy
) {

3883 
size_t
 
ho°Àn
 = 
	`°æí
(
quîy
);

3884 
size_t
 
∑thÀn
 = 
	`°æí
(
∑th
);

3888 
	`memmove
(
∑th
+
ho°Àn
+1,Ö©h, 
∑thÀn
+1);

3891 
	`mem˝y
(
∑th
+1, 
quîy
, 
ho°Àn
);

3893 
∑th
[0]='/';

3894 
ªbuûd_uæ
 = 
TRUE
;

3896 *
quîy
=0;

3898 if(!
∑th
[0]) {

3900 
	`°r˝y
(
∑th
, "/");

3901 
ªbuûd_uæ
 = 
TRUE
;

3908 if(
∑th
[0] == '?') {

3912 
	`memmove
(&
∑th
[1],Ö©h, 
	`°æí
(path)+1);

3913 
∑th
[0] = '/';

3914 
ªbuûd_uæ
 = 
TRUE
;

3918 *
√wp
 = 
	`Cuæ_dedŸdŸify
(
∑th
);

3919 if(!
√wp
)

3920  
CURLE_OUT_OF_MEMORY
;

3922 if(
	`°rcmp
(
√wp
, 
∑th
)) {

3923 
ªbuûd_uæ
 = 
TRUE
;

3924 
	`‰ì
(
d©a
->
°©e
.
∑thbuf„r
);

3925 
d©a
->
°©e
.
∑thbuf„r
 = 
√wp
;

3926 
d©a
->
°©e
.
∑th
 = 
√wp
;

3927 
∑th
 = 
√wp
;

3930 
	`‰ì
(
√wp
);

3939 if(
ªbuûd_uæ
) {

3940 *
ªuæ
;

3942 
size_t
 
∂í
 = 
	`°æí
(
∑th
);

3944 
size_t
 
uæÀn
 = 
	`°æí
(
d©a
->
ch™ge
.
uæ
);

3946 
size_t
 
¥efixÀn
 = 
	`°æí
(
c⁄n
->
ho°
.
«me
);

3948 if(!*
¥Ÿ_missög
)

3949 
¥efixÀn
 +
	`°æí
(
¥Ÿ›
) + strlen("://");

3951 
ªuæ
 = 
	`mÆloc
(
uæÀn
 + 2);

3952 if(!
ªuæ
)

3953  
CURLE_OUT_OF_MEMORY
;

3956 
	`mem˝y
(
ªuæ
, 
d©a
->
ch™ge
.
uæ
, 
¥efixÀn
);

3959 
	`mem˝y
(&
ªuæ
[
¥efixÀn
], 
∑th
, 
∂í
 + 1);

3962 if(
d©a
->
ch™ge
.
uæ_Æloc
) {

3963 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
uæ
);

3964 
d©a
->
ch™ge
.
uæ_Æloc
 = 
FALSE
;

3967 
	`öfof
(
d©a
, "RebuûàURLÅo: %s\n", 
ªuæ
);

3969 
d©a
->
ch™ge
.
uæ
 = 
ªuæ
;

3970 
d©a
->
ch™ge
.
uæ_Æloc
 = 
TRUE
;

3977 
ªsu…
 = 
	`∑r£_uæ_logö
(
d©a
, 
c⁄n
, 
u£Ω
, 
∑sswdp
, 
›ti⁄•
);

3978 if(
ªsu…
 !
CURLE_OK
)

3979  
ªsu…
;

3981 if(
c⁄n
->
ho°
.
«me
[0] == '[') {

3984 *
≥r˚¡
 = 
	`°rchr
(
c⁄n
->
ho°
.
«me
, '%');

3985 if(
≥r˚¡
) {

3986 
idítifõr_off£t
 = 3;

3987 *
ídp
;

3988 
sc›e
;

3989 if(
	`°∫cmp
("%25", 
≥r˚¡
, 3) != 0) {

3990 
	`öfof
(
d©a
,

3992 
idítifõr_off£t
 = 1;

3994 
sc›e
 = 
	`°πoul
(
≥r˚¡
 + 
idítifõr_off£t
, &
ídp
, 10);

3995 if(*
ídp
 == ']') {

3998 
	`memmove
(
≥r˚¡
, 
ídp
, 
	`°æí
(endp)+1);

3999 
c⁄n
->
sc›e
 = ()scope;

4003 #i‡
	`deföed
(
HAVE_NET_IF_H
Ë&& deföed(
IFNAMSIZ
Ë&& deföed(
HAVE_IF_NAMETOINDEX
)

4004 
i‚ame
[
IFNAMSIZ
 + 2];

4005 *
squ¨e_bøckë
;

4006 
sc›eidx
 = 0;

4007 
	`°∫˝y
(
i‚ame
, 
≥r˚¡
 + 
idítifõr_off£t
, 
IFNAMSIZ
 + 2);

4009 
i‚ame
[
IFNAMSIZ
 + 1] = '\0';

4010 
squ¨e_bøckë
 = 
	`°rchr
(
i‚ame
, ']');

4011 if(
squ¨e_bøckë
) {

4013 *
squ¨e_bøckë
 = '\0';

4014 
sc›eidx
 = 
	`if_«mëoödex
(
i‚ame
);

4015 if(
sc›eidx
 == 0) {

4016 
	`öfof
(
d©a
, "InvÆidÇëw‹k i¡îÁ˚: %s; %s\n", 
i‚ame
,

4017 
	`°ªº‹
(
î∫o
));

4020 if(
sc›eidx
 > 0) {

4022 
	`memmove
(
≥r˚¡
,

4023 
≥r˚¡
 + 
idítifõr_off£t
 + 
	`°æí
(
i‚ame
),

4024 
idítifõr_off£t
 + 
	`°æí
(
i‚ame
));

4025 
c⁄n
->
sc›e
 = 
sc›eidx
;

4029 
	`öfof
(
d©a
, "Invalid IPv6áddress format\n");

4034 if(
d©a
->
£t
.
sc›e
)

4036 
c⁄n
->
sc›e
 = 
d©a
->
£t
.scope;

4041 
‰agmít
 = 
	`°rchr
(
∑th
, '#');

4042 if(
‰agmít
) {

4043 *
‰agmít
 = 0;

4048 
‰agmít
 = 
	`°rchr
(
d©a
->
ch™ge
.
uæ
, '#');

4049 if(
‰agmít
)

4050 *
‰agmít
 = 0;

4060  
	`föd¥Ÿocﬁ
(
d©a
, 
c⁄n
, 
¥Ÿ›
);

4061 
	}
}

4067 
CURLcode
 
	$£tup_ønge
(
Sessi⁄H™dÀ
 *
d©a
)

4069 
UæSèã
 *
s
 = &
d©a
->
°©e
;

4070 
s
->
ªsume_‰om
 = 
d©a
->
£t
.
£t_ªsume_‰om
;

4071 if(
s
->
ªsume_‰om
 || 
d©a
->
£t
.
°r
[
STRING_SET_RANGE
]) {

4072 if(
s
->
ønge°rögÆloc
)

4073 
	`‰ì
(
s
->
ønge
);

4075 if(
s
->
ªsume_‰om
)

4076 
s
->
ønge
 = 
	`≠rötf
("%" 
CURL_FORMAT_CURL_OFF_TU
 "-", s->
ªsume_‰om
);

4078 
s
->
ønge
 = 
	`°rdup
(
d©a
->
£t
.
°r
[
STRING_SET_RANGE
]);

4080 
s
->
ønge°rögÆloc
 = (s->
ønge
)?
TRUE
:
FALSE
;

4082 if(!
s
->
ønge
)

4083  
CURLE_OUT_OF_MEMORY
;

4086 
s
->
u£_ønge
 = 
TRUE
;

4089 
s
->
u£_ønge
 = 
FALSE
;

4091  
CURLE_OK
;

4092 
	}
}

4104 
CURLcode
 
	$£tup_c⁄√˘i⁄_öã∫Æs
(
c⁄√˘d©a
 *
c⁄n
)

4106 c⁄° 
Cuæ_h™dÀr
 * 
p
;

4107 
CURLcode
 
ªsu…
;

4108 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

4115 
	`Cuæ_‰ì_ªque°_°©e
(
d©a
);

4117 
	`mem£t
(&
d©a
->
ªq
, 0, (
SögÀReque°
));

4118 
d©a
->
ªq
.
maxdow∆ﬂd
 = -1;

4120 
c⁄n
->
sockty≥
 = 
SOCK_STREAM
;

4123 
p
 = 
c⁄n
->
h™dÀr
;

4125 if(
p
->
£tup_c⁄√˘i⁄
) {

4126 
ªsu…
 = (*
p
->
£tup_c⁄√˘i⁄
)(
c⁄n
);

4128 if(
ªsu…
 !
CURLE_OK
)

4129  
ªsu…
;

4131 
p
 = 
c⁄n
->
h™dÀr
;

4134 if(
c⁄n
->
p‹t
 < 0)

4137 
c⁄n
->
p‹t
 = 
p
->
deÂ‹t
;

4141 if(
c⁄n
->
ªmŸe_p‹t
 < 0)

4142 
c⁄n
->
ªmŸe_p‹t
 = ()c⁄n->
giví
->
deÂ‹t
;

4144  
CURLE_OK
;

4145 
	}
}

4152 
	$Cuæ_‰ì_ªque°_°©e
(
Sessi⁄H™dÀ
 *
d©a
)

4154 
	`Cuæ_ß„‰ì
(
d©a
->
ªq
.
¥Ÿ›
);

4155 
	`Cuæ_ß„‰ì
(
d©a
->
ªq
.
√wuæ
);

4156 
	}
}

4159 #i‚de‡
CURL_DISABLE_PROXY


4164 
boﬁ
 
	$check_n›roxy
(c⁄° * 
«me
, c⁄° * 
no_¥oxy
)

4171 
size_t
 
tok_°¨t
;

4172 
size_t
 
tok_íd
;

4173 c⁄° * 
£∑øt‹
 = ", ";

4174 
size_t
 
no_¥oxy_Àn
;

4175 
size_t
 
«mñí
;

4176 *
íd±r
;

4178 if(
no_¥oxy
 &&Ço_proxy[0]) {

4179 if(
	`Cuæ_øw_equÆ
("*", 
no_¥oxy
)) {

4180  
TRUE
;

4185 
no_¥oxy_Àn
 = 
	`°æí
(
no_¥oxy
);

4186 
íd±r
 = 
	`°rchr
(
«me
, ':');

4187 if(
íd±r
)

4188 
«mñí
 = 
íd±r
 - 
«me
;

4190 
«mñí
 = 
	`°æí
(
«me
);

4192 
tok_°¨t
 = 0;Åok_°¨à< 
no_¥oxy_Àn
;Åok_°¨à
tok_íd
 + 1) {

4193 
tok_°¨t
 < 
no_¥oxy_Àn
 &&

4194 
	`°rchr
(
£∑øt‹
, 
no_¥oxy
[
tok_°¨t
]Ë!
NULL
) {

4196 ++
tok_°¨t
;

4199 if(
tok_°¨t
 =
no_¥oxy_Àn
)

4202 
tok_íd
 = 
tok_°¨t
;Åok_íd < 
no_¥oxy_Àn
 &&

4203 
	`°rchr
(
£∑øt‹
, 
no_¥oxy
[
tok_íd
]Ë=
NULL
; ++tok_end)

4211 if(
no_¥oxy
[
tok_°¨t
] == '.')

4212 ++
tok_°¨t
;

4214 if((
tok_íd
 - 
tok_°¨t
Ë<
«mñí
) {

4216 c⁄° *
checkn
 = 
«me
 + 
«mñí
 - (
tok_íd
 - 
tok_°¨t
);

4217 if(
	`Cuæ_øw_√quÆ
(
no_¥oxy
 + 
tok_°¨t
, 
checkn
,

4218 
tok_íd
 - 
tok_°¨t
)) {

4219 if((
tok_íd
 - 
tok_°¨t
Ë=
«mñí
 || *(
checkn
 - 1) == '.') {

4223  
TRUE
;

4231  
FALSE
;

4232 
	}
}

4239 *
	$dëe˘_¥oxy
(
c⁄√˘d©a
 *
c⁄n
)

4241 *
¥oxy
 = 
NULL
;

4243 #i‚de‡
CURL_DISABLE_HTTP


4261 *
no_¥oxy
=
NULL
;

4262 
¥oxy_ív
[128];

4264 
no_¥oxy
=
	`cuæ_gëív
("no_proxy");

4265 if(!
no_¥oxy
)

4266 
no_¥oxy
=
	`cuæ_gëív
("NO_PROXY");

4268 if(!
	`check_n›roxy
(
c⁄n
->
ho°
.
«me
, 
no_¥oxy
)) {

4270 c⁄° *
¥Ÿ›
 = 
c⁄n
->
h™dÀr
->
scheme
;

4271 *
ívp
 = 
¥oxy_ív
;

4272 *
¥ox
;

4275 *
¥Ÿ›
)

4276 *
ívp
++ = ()
	`tﬁowî
(()*
¥Ÿ›
++);

4279 
	`°r˝y
(
ívp
, "_proxy");

4282 
¥ox
=
	`cuæ_gëív
(
¥oxy_ív
);

4296 if(!
¥ox
 && !
	`Cuæ_øw_equÆ
("hâp_¥oxy", 
¥oxy_ív
)) {

4298 
	`Cuæ_°∫touµî
(
¥oxy_ív
,Öroxy_env, (proxy_env));

4299 
¥ox
=
	`cuæ_gëív
(
¥oxy_ív
);

4302 if(
¥ox
 && *prox) {

4303 
¥oxy
 = 
¥ox
;

4306 
¥oxy
 = 
	`cuæ_gëív
("all_proxy");

4307 if(!
¥oxy
)

4308 
¥oxy
=
	`cuæ_gëív
("ALL_PROXY");

4312 if(
no_¥oxy
)

4313 
	`‰ì
(
no_¥oxy
);

4317 ()
c⁄n
;

4320  
¥oxy
;

4321 
	}
}

4329 
CURLcode
 
	$∑r£_¥oxy
(
Sessi⁄H™dÀ
 *
d©a
,

4330 
c⁄√˘d©a
 *
c⁄n
, *
¥oxy
)

4332 *
¥ox_p‹äo
;

4333 *
ídoÂrŸ
;

4336 *
¥oxy±r
;

4337 *
p‹çå
;

4338 *
©sign
;

4345 
ídoÂrŸ
 = 
	`°r°r
(
¥oxy
, "://");

4346 if(
ídoÂrŸ
) {

4347 
¥oxy±r
 = 
ídoÂrŸ
+3;

4348 if(
	`check¥efix
("socks5h", 
¥oxy
))

4349 
c⁄n
->
¥oxyty≥
 = 
CURLPROXY_SOCKS5_HOSTNAME
;

4350 if(
	`check¥efix
("socks5", 
¥oxy
))

4351 
c⁄n
->
¥oxyty≥
 = 
CURLPROXY_SOCKS5
;

4352 if(
	`check¥efix
("socks4a", 
¥oxy
))

4353 
c⁄n
->
¥oxyty≥
 = 
CURLPROXY_SOCKS4A
;

4354 if(
	`check¥efix
("socks4", 
¥oxy
) || checkprefix("socks",Öroxy))

4355 
c⁄n
->
¥oxyty≥
 = 
CURLPROXY_SOCKS4
;

4359 
¥oxy±r
 = 
¥oxy
;

4362 
©sign
 = 
	`°rchr
(
¥oxy±r
, '@');

4363 if(
©sign
) {

4364 
CURLcode
 
ªs
 = 
CURLE_OK
;

4365 *
¥oxyu£r
 = 
NULL
;

4366 *
¥oxy∑sswd
 = 
NULL
;

4368 
ªs
 = 
	`∑r£_logö_dëaûs
(
¥oxy±r
, 
©sign
 -Öroxyptr,

4369 &
¥oxyu£r
, &
¥oxy∑sswd
, 
NULL
);

4370 if(!
ªs
) {

4375 
	`Cuæ_ß„‰ì
(
c⁄n
->
¥oxyu£r
);

4376 if(
¥oxyu£r
 && 
	`°æí
’roxyu£rË< 
MAX_CURL_USER_LENGTH
)

4377 
c⁄n
->
¥oxyu£r
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
,Öroxyu£r, 0, 
NULL
);

4379 
c⁄n
->
¥oxyu£r
 = 
	`°rdup
("");

4381 if(!
c⁄n
->
¥oxyu£r
)

4382 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

4384 
	`Cuæ_ß„‰ì
(
c⁄n
->
¥oxy∑sswd
);

4385 if(
¥oxy∑sswd
 && 
	`°æí
’roxy∑sswdË< 
MAX_CURL_PASSWORD_LENGTH
)

4386 
c⁄n
->
¥oxy∑sswd
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
,Öroxy∑sswd, 0, 
NULL
);

4388 
c⁄n
->
¥oxy∑sswd
 = 
	`°rdup
("");

4390 if(!
c⁄n
->
¥oxy∑sswd
)

4391 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

4394 if(!
ªs
) {

4395 
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
 = 
TRUE
;

4396 
©sign
++;

4398 if(
©sign
)

4399 
¥oxy±r
 = 
©sign
;

4401 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

4405 
	`Cuæ_ß„‰ì
(
¥oxyu£r
);

4406 
	`Cuæ_ß„‰ì
(
¥oxy∑sswd
);

4408 if(
ªs
)

4409  
ªs
;

4413 
p‹çå
 = 
¥oxy±r
;

4416 if(*
¥oxy±r
 == '[') {

4417 *
±r
 = ++
¥oxy±r
;

4418 *
±r
 && (
	`ISXDIGIT
(*ptr) || (*ptr == ':') || (*ptr == '.')))

4419 
±r
++;

4420 if(*
±r
 == '%') {

4422 if(
	`°∫cmp
("%25", 
±r
, 3))

4423 
	`öfof
(
d©a
, "Please URLÉncode %%ás %%25, see RFC 6874.\n");

4424 
±r
++;

4426 *
±r
 && (
	`ISALPHA
(*±rË|| 
	`ISXDIGIT
(*ptr) || (*ptr == '-') ||

4427 (*
±r
 == '.') || (*ptr == '_') || (*ptr == '~')))

4428 
±r
++;

4430 if(*
±r
 == ']')

4432 *
±r
++ = 0;

4434 
	`öfof
(
d©a
, "Invalid IPv6áddress format\n");

4435 
p‹çå
 = 
±r
;

4443 
¥ox_p‹äo
 = 
	`°rchr
(
p‹çå
, ':');

4444 if(
¥ox_p‹äo
) {

4445 *
¥ox_p‹äo
 = 0x0;

4446 
¥ox_p‹äo
 ++;

4448 
c⁄n
->
p‹t
 = 
	`°πﬁ
(
¥ox_p‹äo
, 
NULL
, 10);

4451 if(
¥oxy±r
[0]=='/')

4455  
CURLE_COULDNT_RESOLVE_PROXY
;

4459 
©sign
 = 
	`°rchr
(
¥oxy±r
, '/');

4460 if(
©sign
)

4461 *
©sign
 = 0x0;

4463 if(
d©a
->
£t
.
¥oxyp‹t
)

4466 
c⁄n
->
p‹t
 = 
d©a
->
£t
.
¥oxyp‹t
;

4470 
c⁄n
->
¥oxy
.
øwÆloc
 = 
	`°rdup
(
¥oxy±r
);

4471 
c⁄n
->
¥oxy
.
«me
 = c⁄n->¥oxy.
øwÆloc
;

4473 if(!
c⁄n
->
¥oxy
.
øwÆloc
)

4474  
CURLE_OUT_OF_MEMORY
;

4476  
CURLE_OK
;

4477 
	}
}

4482 
CURLcode
 
	$∑r£_¥oxy_auth
(
Sessi⁄H™dÀ
 *
d©a
,

4483 
c⁄√˘d©a
 *
c⁄n
)

4485 
¥oxyu£r
[
MAX_CURL_USER_LENGTH
]="";

4486 
¥oxy∑sswd
[
MAX_CURL_PASSWORD_LENGTH
]="";

4488 if(
d©a
->
£t
.
°r
[
STRING_PROXYUSERNAME
] !
NULL
) {

4489 
	`°∫˝y
(
¥oxyu£r
, 
d©a
->
£t
.
°r
[
STRING_PROXYUSERNAME
],

4490 
MAX_CURL_USER_LENGTH
);

4491 
¥oxyu£r
[
MAX_CURL_USER_LENGTH
-1] = '\0';

4493 if(
d©a
->
£t
.
°r
[
STRING_PROXYPASSWORD
] !
NULL
) {

4494 
	`°∫˝y
(
¥oxy∑sswd
, 
d©a
->
£t
.
°r
[
STRING_PROXYPASSWORD
],

4495 
MAX_CURL_PASSWORD_LENGTH
);

4496 
¥oxy∑sswd
[
MAX_CURL_PASSWORD_LENGTH
-1] = '\0';

4499 
c⁄n
->
¥oxyu£r
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
,Öroxyu£r, 0, 
NULL
);

4500 if(!
c⁄n
->
¥oxyu£r
)

4501  
CURLE_OUT_OF_MEMORY
;

4503 
c⁄n
->
¥oxy∑sswd
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
,Öroxy∑sswd, 0, 
NULL
);

4504 if(!
c⁄n
->
¥oxy∑sswd
)

4505  
CURLE_OUT_OF_MEMORY
;

4507  
CURLE_OK
;

4508 
	}
}

4527 
CURLcode
 
	$∑r£_uæ_logö
(
Sessi⁄H™dÀ
 *
d©a
,

4528 
c⁄√˘d©a
 *
c⁄n
,

4529 **
u£r
, **
∑sswd
, **
›ti⁄s
)

4531 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

4532 *
u£Ω
 = 
NULL
;

4533 *
∑sswdp
 = 
NULL
;

4534 *
›ti⁄•
 = 
NULL
;

4543 *
±r
 = 
	`°rchr
(
c⁄n
->
ho°
.
«me
, '@');

4544 *
logö
 = 
c⁄n
->
ho°
.
«me
;

4546 
	`DEBUGASSERT
(!**
u£r
);

4547 
	`DEBUGASSERT
(!**
∑sswd
);

4548 
	`DEBUGASSERT
(!**
›ti⁄s
);

4550 if(!
±r
)

4551 
out
;

4556 
c⁄n
->
ho°
.
«me
 = ++
±r
;

4564 if(
d©a
->
£t
.
u£_√åc
 =
CURL_NETRC_REQUIRED
)

4565 
out
;

4568 
ªsu…
 = 
	`∑r£_logö_dëaûs
(
logö
, 
±r
 -Üogin - 1,

4569 &
u£Ω
, &
∑sswdp
, &
›ti⁄•
);

4570 if(
ªsu…
 !
CURLE_OK
)

4571 
out
;

4573 if(
u£Ω
) {

4574 *
√w«me
;

4577 
c⁄n
->
bôs
.
u£Ωwd_ö_uæ
 = 
TRUE
;

4578 
c⁄n
->
bôs
.
u£r_∑sswd
 = 
TRUE
;

4581 
√w«me
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
, 
u£Ω
, 0, 
NULL
);

4582 if(!
√w«me
) {

4583 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

4584 
out
;

4587 
	`‰ì
(*
u£r
);

4588 *
u£r
 = 
√w«me
;

4591 if(
∑sswdp
) {

4593 *
√w∑sswd
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
, 
∑sswdp
, 0, 
NULL
);

4594 if(!
√w∑sswd
) {

4595 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

4596 
out
;

4599 
	`‰ì
(*
∑sswd
);

4600 *
∑sswd
 = 
√w∑sswd
;

4603 if(
›ti⁄•
) {

4605 *
√w›ti⁄s
 = 
	`cuæ_ósy_u√sˇ≥
(
d©a
, 
›ti⁄•
, 0, 
NULL
);

4606 if(!
√w›ti⁄s
) {

4607 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

4608 
out
;

4611 
	`‰ì
(*
›ti⁄s
);

4612 *
›ti⁄s
 = 
√w›ti⁄s
;

4616 
out
:

4618 
	`Cuæ_ß„‰ì
(
u£Ω
);

4619 
	`Cuæ_ß„‰ì
(
∑sswdp
);

4620 
	`Cuæ_ß„‰ì
(
›ti⁄•
);

4622  
ªsu…
;

4623 
	}
}

4654 
CURLcode
 
	$∑r£_logö_dëaûs
(c⁄° *
logö
, c⁄° 
size_t
 
Àn
,

4655 **
u£Ω
, **
∑sswdp
,

4656 **
›ti⁄•
)

4658 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

4659 *
ubuf
 = 
NULL
;

4660 *
pbuf
 = 
NULL
;

4661 *
obuf
 = 
NULL
;

4662 c⁄° *
p£p
 = 
NULL
;

4663 c⁄° *
o£p
 = 
NULL
;

4664 
size_t
 
uÀn
;

4665 
size_t
 
∂í
;

4666 
size_t
 
ﬁí
;

4669 if(
∑sswdp
) {

4670 
p£p
 = 
	`°rchr
(
logö
, ':');

4673 if(
p£p
 >
logö
 + 
Àn
)

4674 
p£p
 = 
NULL
;

4678 if(
›ti⁄•
) {

4679 
o£p
 = 
	`°rchr
(
logö
, ';');

4682 if(
o£p
 >
logö
 + 
Àn
)

4683 
o£p
 = 
NULL
;

4687 
uÀn
 = (
p£p
 ?

4688 (
size_t
)(
o£p
 && 
p£p
 > o£∞? o£∞- 
logö
 :Ösep -Üogin) :

4689 (
o£p
 ? (
size_t
)(o£∞- 
logö
Ë: 
Àn
));

4690 
∂í
 = (
p£p
 ?

4691 (
o£p
 && o£∞> 
p£p
 ? (
size_t
)(osep -Ösep) :

4692 (
size_t
)(
logö
 + 
Àn
 - 
p£p
)) - 1 : 0);

4693 
ﬁí
 = (
o£p
 ?

4694 (
p£p
 &&Ö£∞> 
o£p
 ? (
size_t
)(psep - osep) :

4695 (
size_t
)(
logö
 + 
Àn
 - 
o£p
)) - 1 : 0);

4698 if(
u£Ω
 && 
uÀn
) {

4699 
ubuf
 = 
	`mÆloc
(
uÀn
 + 1);

4700 if(!
ubuf
)

4701 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

4705 if(!
ªsu…
 && 
∑sswdp
 && 
∂í
) {

4706 
pbuf
 = 
	`mÆloc
(
∂í
 + 1);

4707 if(!
pbuf
) {

4708 
	`Cuæ_ß„‰ì
(
ubuf
);

4709 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

4714 if(!
ªsu…
 && 
›ti⁄•
 && 
ﬁí
) {

4715 
obuf
 = 
	`mÆloc
(
ﬁí
 + 1);

4716 if(!
obuf
) {

4717 
	`Cuæ_ß„‰ì
(
pbuf
);

4718 
	`Cuæ_ß„‰ì
(
ubuf
);

4719 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

4723 if(!
ªsu…
) {

4725 if(
ubuf
) {

4726 
	`mem˝y
(
ubuf
, 
logö
, 
uÀn
);

4727 
ubuf
[
uÀn
] = '\0';

4728 
	`Cuæ_ß„‰ì
(*
u£Ω
);

4729 *
u£Ω
 = 
ubuf
;

4733 if(
pbuf
) {

4734 
	`mem˝y
(
pbuf
, 
p£p
 + 1, 
∂í
);

4735 
pbuf
[
∂í
] = '\0';

4736 
	`Cuæ_ß„‰ì
(*
∑sswdp
);

4737 *
∑sswdp
 = 
pbuf
;

4741 if(
obuf
) {

4742 
	`mem˝y
(
obuf
, 
o£p
 + 1, 
ﬁí
);

4743 
obuf
[
ﬁí
] = '\0';

4744 
	`Cuæ_ß„‰ì
(*
›ti⁄•
);

4745 *
›ti⁄•
 = 
obuf
;

4749  
ªsu…
;

4750 
	}
}

4766 
CURLcode
 
	$∑r£_ªmŸe_p‹t
(
Sessi⁄H™dÀ
 *
d©a
,

4767 
c⁄√˘d©a
 *
c⁄n
)

4769 *
p‹çå
;

4770 
ídbøckë
;

4775 if((1 =
	`ssˇnf
(
c⁄n
->
ho°
.
«me
, "[%*45[0123456789abcdefABCDEF:.]%c",

4776 &
ídbøckë
)) &&

4777 (']' =
ídbøckë
)) {

4779 
c⁄n
->
bôs
.
ùv6_ù
 = 
TRUE
;

4781 
c⁄n
->
ho°
.
«me
++;

4782 
p‹çå
 = 
	`°rchr
(
c⁄n
->
ho°
.
«me
, ']');

4783 if(
p‹çå
) {

4784 *
p‹çå
++ = '\0';

4785 if(':' !*
p‹çå
)

4786 
p‹çå
 = 
NULL
;

4790 #ifde‡
ENABLE_IPV6


4791 
ö6_addr
 
ö6
;

4792 if(
	`Cuæ_öë_±⁄
(
AF_INET6
, 
c⁄n
->
ho°
.
«me
, &
ö6
) > 0) {

4795 
	`Áûf
(
d©a
, "IPv6Çumericaláddress used in URL without brackets");

4796  
CURLE_URL_MALFORMAT
;

4800 
p‹çå
 = 
	`°ºchr
(
c⁄n
->
ho°
.
«me
, ':');

4803 if(
d©a
->
£t
.
u£_p‹t
 && d©a->
°©e
.
Ælow_p‹t
) {

4805 
c⁄n
->
ªmŸe_p‹t
 = ()
d©a
->
£t
.
u£_p‹t
;

4806 if(
p‹çå
)

4807 *
p‹çå
 = '\0';

4809 if(
c⁄n
->
bôs
.
hâµroxy
) {

4811 *
uæ
;

4812 
ty≥
[12]="";

4814 if(
c⁄n
->
bôs
.
ty≥_£t
)

4815 
	`¢¥ötf
(
ty≥
, (type), ";type=%c",

4816 
d©a
->
£t
.
¥e„r_ascii
?'A':

4817 (
d©a
->
£t
.
·p_li°_⁄ly
?'D':'I'));

4824 
uæ
 = 
	`≠rötf
("%s://%s%s%s:%hu%s%s%s", 
c⁄n
->
giví
->
scheme
,

4825 
c⁄n
->
bôs
.
ùv6_ù
?"[":"", c⁄n->
ho°
.
«me
,

4826 
c⁄n
->
bôs
.
ùv6_ù
?"]":"", c⁄n->
ªmŸe_p‹t
,

4827 
d©a
->
°©e
.
¶ash_ªmoved
?"/":"", d©a->°©e.
∑th
,

4828 
ty≥
);

4829 if(!
uæ
)

4830  
CURLE_OUT_OF_MEMORY
;

4832 if(
d©a
->
ch™ge
.
uæ_Æloc
) {

4833 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
uæ
);

4834 
d©a
->
ch™ge
.
uæ_Æloc
 = 
FALSE
;

4837 
d©a
->
ch™ge
.
uæ
 = url;

4838 
d©a
->
ch™ge
.
uæ_Æloc
 = 
TRUE
;

4841 if(
p‹çå
) {

4844 *
ª°
;

4845 
p‹t
;

4847 
p‹t
=
	`°πﬁ
(
p‹çå
+1, &
ª°
, 10);

4849 if((
p‹t
 < 0) || (port > 0xffff)) {

4851 
	`Áûf
(
d©a
, "PortÇumber out ofÑange");

4852  
CURLE_URL_MALFORMAT
;

4855 if(
ª°
 !&
p‹çå
[1]) {

4856 *
p‹çå
 = '\0';

4857 
c⁄n
->
ªmŸe_p‹t
 = 
	`cuæx_u…ous
(
p‹t
);

4863 *
p‹çå
 = '\0';

4865  
CURLE_OK
;

4866 
	}
}

4872 
CURLcode
 
	$ovîride_logö
(
Sessi⁄H™dÀ
 *
d©a
,

4873 
c⁄√˘d©a
 *
c⁄n
,

4874 **
u£Ω
, **
∑sswdp
, **
›ti⁄•
)

4876 if(
d©a
->
£t
.
°r
[
STRING_USERNAME
]) {

4877 
	`‰ì
(*
u£Ω
);

4878 *
u£Ω
 = 
	`°rdup
(
d©a
->
£t
.
°r
[
STRING_USERNAME
]);

4879 if(!*
u£Ω
)

4880  
CURLE_OUT_OF_MEMORY
;

4883 if(
d©a
->
£t
.
°r
[
STRING_PASSWORD
]) {

4884 
	`‰ì
(*
∑sswdp
);

4885 *
∑sswdp
 = 
	`°rdup
(
d©a
->
£t
.
°r
[
STRING_PASSWORD
]);

4886 if(!*
∑sswdp
)

4887  
CURLE_OUT_OF_MEMORY
;

4890 if(
d©a
->
£t
.
°r
[
STRING_OPTIONS
]) {

4891 
	`‰ì
(*
›ti⁄•
);

4892 *
›ti⁄•
 = 
	`°rdup
(
d©a
->
£t
.
°r
[
STRING_OPTIONS
]);

4893 if(!*
›ti⁄•
)

4894  
CURLE_OUT_OF_MEMORY
;

4897 
c⁄n
->
bôs
.
√åc
 = 
FALSE
;

4898 if(
d©a
->
£t
.
u£_√åc
 !
CURL_NETRC_IGNORED
) {

4899 
ªt
 = 
	`Cuæ_∑r£√åc
(
c⁄n
->
ho°
.
«me
,

4900 
u£Ω
, 
∑sswdp
,

4901 
d©a
->
£t
.
°r
[
STRING_NETRC_FILE
]);

4902 if(
ªt
 > 0) {

4903 
	`öfof
(
d©a
, "Couldn't find host %s inÅhe "

4904 
DOT_CHAR
 "netrc file; using defaults\n",

4905 
c⁄n
->
ho°
.
«me
);

4907 if(
ªt
 < 0 ) {

4908  
CURLE_OUT_OF_MEMORY
;

4914 
c⁄n
->
bôs
.
√åc
 = 
TRUE
;

4916 
c⁄n
->
bôs
.
u£r_∑sswd
 = 
TRUE
;

4920  
CURLE_OK
;

4921 
	}
}

4926 
CURLcode
 
	$£t_logö
(
c⁄√˘d©a
 *
c⁄n
,

4927 c⁄° *
u£r
, c⁄° *
∑sswd
,

4928 c⁄° *
›ti⁄s
)

4930 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

4933 if((
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_NEEDSPWD
Ë&& !c⁄n->
bôs
.
u£r_∑sswd
) {

4935 
c⁄n
->
u£r
 = 
	`°rdup
(
CURL_DEFAULT_USER
);

4938 if(
c⁄n
->
u£r
)

4939 
c⁄n
->
∑sswd
 = 
	`°rdup
(
CURL_DEFAULT_PASSWORD
);

4941 
c⁄n
->
∑sswd
 = 
NULL
;

4947 
c⁄n
->
u£r
 = 
	`°rdup
(user);

4950 if(
c⁄n
->
u£r
)

4951 
c⁄n
->
∑sswd
 = 
	`°rdup
(passwd);

4953 
c⁄n
->
∑sswd
 = 
NULL
;

4956 if(!
c⁄n
->
u£r
 || !c⁄n->
∑sswd
)

4957 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

4960 if(!
ªsu…
 && 
›ti⁄s
[0]) {

4961 
c⁄n
->
›ti⁄s
 = 
	`°rdup
(options);

4963 if(!
c⁄n
->
›ti⁄s
)

4964 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

4967  
ªsu…
;

4968 
	}
}

4973 
CURLcode
 
	$ªsﬁve_£rvî
(
Sessi⁄H™dÀ
 *
d©a
,

4974 
c⁄√˘d©a
 *
c⁄n
,

4975 
boﬁ
 *
async
)

4977 
CURLcode
 
ªsu…
=
CURLE_OK
;

4978 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

4983 if(
c⁄n
->
bôs
.
ªu£
)

4987 *
async
 = 
FALSE
;

4991 
rc
;

4992 
Cuæ_dns_íåy
 *
ho°addr
;

4995 
	`fix_ho°«me
(
d©a
, 
c⁄n
, &c⁄n->
ho°
);

4997 if(!
c⁄n
->
¥oxy
.
«me
 || !*conn->proxy.name) {

5000 
c⁄n
->
p‹t
 = c⁄n->
ªmŸe_p‹t
;

5003 
rc
 = 
	`Cuæ_ªsﬁv_timeout
(
c⁄n
, c⁄n->
ho°
.
«me
, ()c⁄n->
p‹t
,

5004 &
ho°addr
, 
timeout_ms
);

5005 if(
rc
 =
CURLRESOLV_PENDING
)

5006 *
async
 = 
TRUE
;

5008 if(
rc
 =
CURLRESOLV_TIMEDOUT
)

5009 
ªsu…
 = 
CURLE_OPERATION_TIMEDOUT
;

5011 if(!
ho°addr
) {

5012 
	`Áûf
(
d©a
, "Couldn'àªsﬁvêho° '%s'", 
c⁄n
->
ho°
.
di•«me
);

5013 
ªsu…
 = 
CURLE_COULDNT_RESOLVE_HOST
;

5021 
	`fix_ho°«me
(
d©a
, 
c⁄n
, &c⁄n->
¥oxy
);

5024 
rc
 = 
	`Cuæ_ªsﬁv_timeout
(
c⁄n
, c⁄n->
¥oxy
.
«me
, ()c⁄n->
p‹t
,

5025 &
ho°addr
, 
timeout_ms
);

5027 if(
rc
 =
CURLRESOLV_PENDING
)

5028 *
async
 = 
TRUE
;

5030 if(
rc
 =
CURLRESOLV_TIMEDOUT
)

5031 
ªsu…
 = 
CURLE_OPERATION_TIMEDOUT
;

5033 if(!
ho°addr
) {

5034 
	`Áûf
(
d©a
, "Couldn'àªsﬁvê¥oxy '%s'", 
c⁄n
->
¥oxy
.
di•«me
);

5035 
ªsu…
 = 
CURLE_COULDNT_RESOLVE_PROXY
;

5039 
	`DEBUGASSERT
(
c⁄n
->
dns_íåy
 =
NULL
);

5040 
c⁄n
->
dns_íåy
 = 
ho°addr
;

5043  
ªsu…
;

5044 
	}
}

5051 
	$ªu£_c⁄n
(
c⁄√˘d©a
 *
ﬁd_c⁄n
,

5052 
c⁄√˘d©a
 *
c⁄n
)

5054 if(
ﬁd_c⁄n
->
¥oxy
.
øwÆloc
)

5055 
	`‰ì
(
ﬁd_c⁄n
->
¥oxy
.
øwÆloc
);

5059 
	`Cuæ_‰ì_s¶_c⁄fig
(&
ﬁd_c⁄n
->
s¶_c⁄fig
);

5061 
c⁄n
->
d©a
 = 
ﬁd_c⁄n
->data;

5065 
c⁄n
->
bôs
.
u£r_∑sswd
 = 
ﬁd_c⁄n
->bits.user_passwd;

5066 if(
c⁄n
->
bôs
.
u£r_∑sswd
) {

5068 
	`Cuæ_ß„‰ì
(
c⁄n
->
u£r
);

5069 
	`Cuæ_ß„‰ì
(
c⁄n
->
∑sswd
);

5070 
c⁄n
->
u£r
 = 
ﬁd_c⁄n
->user;

5071 
c⁄n
->
∑sswd
 = 
ﬁd_c⁄n
->passwd;

5072 
ﬁd_c⁄n
->
u£r
 = 
NULL
;

5073 
ﬁd_c⁄n
->
∑sswd
 = 
NULL
;

5076 
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
 = 
ﬁd_c⁄n
->bits.proxy_user_passwd;

5077 if(
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
) {

5079 
	`Cuæ_ß„‰ì
(
c⁄n
->
¥oxyu£r
);

5080 
	`Cuæ_ß„‰ì
(
c⁄n
->
¥oxy∑sswd
);

5081 
c⁄n
->
¥oxyu£r
 = 
ﬁd_c⁄n
->proxyuser;

5082 
c⁄n
->
¥oxy∑sswd
 = 
ﬁd_c⁄n
->proxypasswd;

5083 
ﬁd_c⁄n
->
¥oxyu£r
 = 
NULL
;

5084 
ﬁd_c⁄n
->
¥oxy∑sswd
 = 
NULL
;

5089 
	`Cuæ_ß„‰ì
(
c⁄n
->
ho°
.
øwÆloc
);

5090 
c⁄n
->
ho°
=
ﬁd_c⁄n
->host;

5093 
	`Cuæ_≥rsi°c⁄nöfo
(
c⁄n
);

5096 
c⁄n
->
bôs
.
ªu£
 = 
TRUE
;

5098 
	`Cuæ_ß„‰ì
(
ﬁd_c⁄n
->
u£r
);

5099 
	`Cuæ_ß„‰ì
(
ﬁd_c⁄n
->
∑sswd
);

5100 
	`Cuæ_ß„‰ì
(
ﬁd_c⁄n
->
¥oxyu£r
);

5101 
	`Cuæ_ß„‰ì
(
ﬁd_c⁄n
->
¥oxy∑sswd
);

5102 
	`Cuæ_ß„‰ì
(
ﬁd_c⁄n
->
loˇldev
);

5104 
	`Cuæ_Œi°_de°roy
(
ﬁd_c⁄n
->
£nd_pùe
, 
NULL
);

5105 
	`Cuæ_Œi°_de°roy
(
ﬁd_c⁄n
->
ªcv_pùe
, 
NULL
);

5107 
ﬁd_c⁄n
->
£nd_pùe
 = 
NULL
;

5108 
ﬁd_c⁄n
->
ªcv_pùe
 = 
NULL
;

5110 
	`Cuæ_ß„‰ì
(
ﬁd_c⁄n
->
ma°î_buf„r
);

5111 
	}
}

5129 
CURLcode
 
	$¸óã_c⁄n
(
Sessi⁄H™dÀ
 *
d©a
,

5130 
c⁄√˘d©a
 **
ö_c⁄√˘
,

5131 
boﬁ
 *
async
)

5133 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

5134 
c⁄√˘d©a
 *
c⁄n
;

5135 
c⁄√˘d©a
 *
c⁄n_ãmp
 = 
NULL
;

5136 
size_t
 
uæÀn
;

5137 *
u£r
 = 
NULL
;

5138 *
∑sswd
 = 
NULL
;

5139 *
›ti⁄s
 = 
NULL
;

5140 
boﬁ
 
ªu£
;

5141 *
¥oxy
 = 
NULL
;

5142 
boﬁ
 
¥Ÿ_missög
 = 
FALSE
;

5143 
boﬁ
 
no_c⁄√˘i⁄s_avaûabÀ
 = 
FALSE
;

5144 
boﬁ
 
f‹˚_ªu£
 = 
FALSE
;

5145 
size_t
 
max_ho°_c⁄√˘i⁄s
 = 
	`Cuæ_mu…i_max_ho°_c⁄√˘i⁄s
(
d©a
->
mu…i
);

5146 
size_t
 
max_tŸÆ_c⁄√˘i⁄s
 = 
	`Cuæ_mu…i_max_tŸÆ_c⁄√˘i⁄s
(
d©a
->
mu…i
);

5148 *
async
 = 
FALSE
;

5154 if(!
d©a
->
ch™ge
.
uæ
) {

5155 
ªsu…
 = 
CURLE_URL_MALFORMAT
;

5156 
out
;

5163 
c⁄n
 = 
	`Æloˇã_c⁄n
(
d©a
);

5165 if(!
c⁄n
) {

5166 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

5167 
out
;

5173 *
ö_c⁄√˘
 = 
c⁄n
;

5183 
	#LEAST_PATH_ALLOC
 256

	)

5184 
uæÀn
=
	`°æí
(
d©a
->
ch™ge
.
uæ
);

5185 if(
uæÀn
 < 
LEAST_PATH_ALLOC
)

5186 
uæÀn
=
LEAST_PATH_ALLOC
;

5194 
	`Cuæ_ß„‰ì
(
d©a
->
°©e
.
∑thbuf„r
);

5195 
d©a
->
°©e
.
∑th
 = 
NULL
;

5197 
d©a
->
°©e
.
∑thbuf„r
 = 
	`mÆloc
(
uæÀn
+2);

5198 if(
NULL
 =
d©a
->
°©e
.
∑thbuf„r
) {

5199 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

5200 
out
;

5202 
d©a
->
°©e
.
∑th
 = d©a->°©e.
∑thbuf„r
;

5204 
c⁄n
->
ho°
.
øwÆloc
 = 
	`mÆloc
(
uæÀn
+2);

5205 if(
NULL
 =
c⁄n
->
ho°
.
øwÆloc
) {

5206 
	`Cuæ_ß„‰ì
(
d©a
->
°©e
.
∑thbuf„r
);

5207 
d©a
->
°©e
.
∑th
 = 
NULL
;

5208 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

5209 
out
;

5212 
c⁄n
->
ho°
.
«me
 = c⁄n->ho°.
øwÆloc
;

5213 
c⁄n
->
ho°
.
«me
[0] = 0;

5215 
u£r
 = 
	`°rdup
("");

5216 
∑sswd
 = 
	`°rdup
("");

5217 
›ti⁄s
 = 
	`°rdup
("");

5218 if(!
u£r
 || !
∑sswd
 || !
›ti⁄s
) {

5219 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

5220 
out
;

5223 
ªsu…
 = 
	`∑r£uæ™dfûlc⁄n
(
d©a
, 
c⁄n
, &
¥Ÿ_missög
, &
u£r
, &
∑sswd
,

5224 &
›ti⁄s
);

5225 if(
ªsu…
 !
CURLE_OK
)

5226 
out
;

5231 if(
¥Ÿ_missög
) {

5235 *
ªuæ
;

5237 
ªuæ
 = 
	`≠rötf
("%s://%s", 
c⁄n
->
h™dÀr
->
scheme
, 
d©a
->
ch™ge
.
uæ
);

5239 if(!
ªuæ
) {

5240 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

5241 
out
;

5244 if(
d©a
->
ch™ge
.
uæ_Æloc
) {

5245 
	`Cuæ_ß„‰ì
(
d©a
->
ch™ge
.
uæ
);

5246 
d©a
->
ch™ge
.
uæ_Æloc
 = 
FALSE
;

5249 
d©a
->
ch™ge
.
uæ
 = 
ªuæ
;

5250 
d©a
->
ch™ge
.
uæ_Æloc
 = 
TRUE
;

5257 if((
c⁄n
->
giví
->
Êags
&
PROTOPT_NOURLQUERY
)) {

5258 *
∑th_q_£p
 = 
	`°rchr
(
c⁄n
->
d©a
->
°©e
.
∑th
, '?');

5259 if(
∑th_q_£p
) {

5267 
∑th_q_£p
[0] = 0;

5271 if(
d©a
->
£t
.
°r
[
STRING_BEARER
]) {

5272 
c⁄n
->
xﬂuth2_bóªr
 = 
	`°rdup
(
d©a
->
£t
.
°r
[
STRING_BEARER
]);

5273 if(!
c⁄n
->
xﬂuth2_bóªr
) {

5274 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

5275 
out
;

5279 #i‚de‡
CURL_DISABLE_PROXY


5283 if(
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
) {

5284 
ªsu…
 = 
	`∑r£_¥oxy_auth
(
d©a
, 
c⁄n
);

5285 if(
ªsu…
 !
CURLE_OK
)

5286 
out
;

5292 if(
d©a
->
£t
.
°r
[
STRING_PROXY
]) {

5293 
¥oxy
 = 
	`°rdup
(
d©a
->
£t
.
°r
[
STRING_PROXY
]);

5295 if(
NULL
 =
¥oxy
) {

5296 
	`Áûf
(
d©a
, "memory shortage");

5297 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

5298 
out
;

5302 if(
d©a
->
£t
.
°r
[
STRING_NOPROXY
] &&

5303 
	`check_n›roxy
(
c⁄n
->
ho°
.
«me
, 
d©a
->
£t
.
°r
[
STRING_NOPROXY
])) {

5304 if(
¥oxy
) {

5305 
	`‰ì
(
¥oxy
);

5306 
¥oxy
 = 
NULL
;

5309 if(!
¥oxy
)

5310 
¥oxy
 = 
	`dëe˘_¥oxy
(
c⁄n
);

5312 if(
¥oxy
 && (!*¥oxy || (
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_NONETWORK
))) {

5313 
	`‰ì
(
¥oxy
);

5315 
¥oxy
 = 
NULL
;

5323 if(
¥oxy
) {

5324 
ªsu…
 = 
	`∑r£_¥oxy
(
d©a
, 
c⁄n
, 
¥oxy
);

5326 
	`Cuæ_ß„‰ì
(
¥oxy
);

5328 if(
ªsu…
)

5329 
out
;

5331 if((
c⁄n
->
¥oxyty≥
 =
CURLPROXY_HTTP
) ||

5332 (
c⁄n
->
¥oxyty≥
 =
CURLPROXY_HTTP_1_0
)) {

5333 #ifde‡
CURL_DISABLE_HTTP


5335 
ªsu…
 = 
CURLE_UNSUPPORTED_PROTOCOL
;

5336 
out
;

5340 if(!(
c⁄n
->
h™dÀr
->
¥Ÿocﬁ
 & 
PROTO_FAMILY_HTTP
) &&

5341 !
c⁄n
->
bôs
.
tu¬ñ_¥oxy
)

5342 
c⁄n
->
h™dÀr
 = &
Cuæ_h™dÀr_hâp
;

5344 
c⁄n
->
bôs
.
hâµroxy
 = 
TRUE
;

5348 
c⁄n
->
bôs
.
hâµroxy
 = 
FALSE
;

5349 
c⁄n
->
bôs
.
¥oxy
 = 
TRUE
;

5353 
c⁄n
->
bôs
.
¥oxy
 = 
FALSE
;

5354 
c⁄n
->
bôs
.
hâµroxy
 = 
FALSE
;

5355 
c⁄n
->
bôs
.
¥oxy_u£r_∑sswd
 = 
FALSE
;

5356 
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 = 
FALSE
;

5365 if((
c⁄n
->
giví
->
Êags
&
PROTOPT_SSL
Ë&& c⁄n->
bôs
.
hâµroxy
)

5366 
c⁄n
->
bôs
.
tu¬ñ_¥oxy
 = 
TRUE
;

5371 
ªsu…
 = 
	`∑r£_ªmŸe_p‹t
(
d©a
, 
c⁄n
);

5372 if(
ªsu…
 !
CURLE_OK
)

5373 
out
;

5377 
ªsu…
 = 
	`ovîride_logö
(
d©a
, 
c⁄n
, &
u£r
, &
∑sswd
, &
›ti⁄s
);

5378 if(
ªsu…
 !
CURLE_OK
)

5379 
out
;

5380 
ªsu…
 = 
	`£t_logö
(
c⁄n
, 
u£r
, 
∑sswd
, 
›ti⁄s
);

5381 if(
ªsu…
 !
CURLE_OK
)

5382 
out
;

5388 
ªsu…
 = 
	`£tup_c⁄√˘i⁄_öã∫Æs
(
c⁄n
);

5389 if(
ªsu…
 !
CURLE_OK
)

5390 
out
;

5392 
c⁄n
->
ªcv
[
FIRSTSOCKET
] = 
Cuæ_ªcv_∂aö
;

5393 
c⁄n
->
£nd
[
FIRSTSOCKET
] = 
Cuæ_£nd_∂aö
;

5394 
c⁄n
->
ªcv
[
SECONDARYSOCKET
] = 
Cuæ_ªcv_∂aö
;

5395 
c⁄n
->
£nd
[
SECONDARYSOCKET
] = 
Cuæ_£nd_∂aö
;

5400 #i‚de‡
CURL_DISABLE_FILE


5401 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_NONETWORK
) {

5402 
boﬁ
 
d⁄e
;

5405 
	`DEBUGASSERT
(
c⁄n
->
h™dÀr
->
c⁄√˘_ô
);

5406 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`c⁄√˘_ô
(c⁄n, &
d⁄e
);

5409 if(
CURLE_OK
 =
ªsu…
) {

5410 
c⁄n
->
d©a
 = data;

5411 
c⁄n
->
bôs
.
t˝c⁄√˘
[
FIRSTSOCKET
] = 
TRUE
;

5413 
	`C⁄√˘i⁄St‹e
(
d©a
, 
c⁄n
);

5418 
ªsu…
 = 
	`£tup_ønge
(
d©a
);

5419 if(
ªsu…
) {

5420 
	`DEBUGASSERT
(
c⁄n
->
h™dÀr
->
d⁄e
);

5422 ()
c⁄n
->
h™dÀr
->
	`d⁄e
(c⁄n, 
ªsu…
, 
FALSE
);

5423 
out
;

5426 
	`Cuæ_£tup_å™s„r
(
c⁄n
, -1, -1, 
FALSE
, 
NULL
,

5427 -1, 
NULL
);

5431 
	`do_öô
(
c⁄n
);

5433 
out
;

5446 
d©a
->
£t
.
s¶
.
CA∑th
 = d©a->£t.
°r
[
STRING_SSL_CAPATH
];

5447 
d©a
->
£t
.
s¶
.
CAfûe
 = d©a->£t.
°r
[
STRING_SSL_CAFILE
];

5448 
d©a
->
£t
.
s¶
.
CRLfûe
 = d©a->£t.
°r
[
STRING_SSL_CRLFILE
];

5449 
d©a
->
£t
.
s¶
.
issuî˚π
 = d©a->£t.
°r
[
STRING_SSL_ISSUERCERT
];

5450 
d©a
->
£t
.
s¶
.
øndom_fûe
 = d©a->£t.
°r
[
STRING_SSL_RANDOM_FILE
];

5451 
d©a
->
£t
.
s¶
.
egdsockë
 = d©a->£t.
°r
[
STRING_SSL_EGDSOCKET
];

5452 
d©a
->
£t
.
s¶
.
cùhî_li°
 = d©a->£t.
°r
[
STRING_SSL_CIPHER_LIST
];

5453 #ifde‡
USE_TLS_SRP


5454 
d©a
->
£t
.
s¶
.
u£∫ame
 = d©a->£t.
°r
[
STRING_TLSAUTH_USERNAME
];

5455 
d©a
->
£t
.
s¶
.
∑ssw‹d
 = d©a->£t.
°r
[
STRING_TLSAUTH_PASSWORD
];

5458 if(!
	`Cuæ_˛⁄e_s¶_c⁄fig
(&
d©a
->
£t
.
s¶
, &
c⁄n
->
s¶_c⁄fig
)) {

5459 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

5460 
out
;

5473 if(
d©a
->
£t
.
ªu£_‰esh
 && !d©a->
°©e
.
this_is_a_fﬁlow
)

5474 
ªu£
 = 
FALSE
;

5476 
ªu£
 = 
	`C⁄√˘i⁄Exi°s
(
d©a
, 
c⁄n
, &
c⁄n_ãmp
, &
f‹˚_ªu£
);

5480 if(
ªu£
 && !
f‹˚_ªu£
 && 
	`IsPùñöögPossibÀ
(
d©a
, 
c⁄n_ãmp
)) {

5481 
size_t
 
pùñí
 = 
c⁄n_ãmp
->
£nd_pùe
->
size
 + c⁄n_ãmp->
ªcv_pùe
->size;

5482 if(
pùñí
 > 0) {

5483 
	`öfof
(
d©a
, "Found connection %ld, withÑequests inÅheÖipe (%zu)\n",

5484 
c⁄n_ãmp
->
c⁄√˘i⁄_id
, 
pùñí
);

5486 if(
c⁄n_ãmp
->
bundÀ
->
num_c⁄√˘i⁄s
 < 
max_ho°_c⁄√˘i⁄s
 &&

5487 
d©a
->
°©e
.
c⁄n_ˇche
->
num_c⁄√˘i⁄s
 < 
max_tŸÆ_c⁄√˘i⁄s
) {

5489 
ªu£
 = 
FALSE
;

5491 
	`öfof
(
d©a
, "We canÑeuse, but we wantáÇew connectionányway\n");

5496 if(
ªu£
) {

5503 
c⁄n_ãmp
->
öu£
 = 
TRUE
;

5505 
	`ªu£_c⁄n
(
c⁄n
, 
c⁄n_ãmp
);

5506 
	`‰ì
(
c⁄n
);

5507 
c⁄n
 = 
c⁄n_ãmp
;

5508 *
ö_c⁄√˘
 = 
c⁄n
;

5511 
	`fix_ho°«me
(
d©a
, 
c⁄n
, &c⁄n->
ho°
);

5513 
	`öfof
(
d©a
, "Re-usingÉxisting connection! (#%ld) with host %s\n",

5514 
c⁄n
->
c⁄√˘i⁄_id
,

5515 
c⁄n
->
¥oxy
.
«me
?c⁄n->¥oxy.
di•«me
:c⁄n->
ho°
.dispname);

5521 
c⁄√˘bundÀ
 *
bundÀ
;

5523 
bundÀ
 = 
	`Cuæ_c⁄nˇche_föd_bundÀ
(
d©a
->
°©e
.
c⁄n_ˇche
,

5524 
c⁄n
->
ho°
.
«me
);

5525 if(
max_ho°_c⁄√˘i⁄s
 > 0 && 
bundÀ
 &&

5526 (
bundÀ
->
num_c⁄√˘i⁄s
 >
max_ho°_c⁄√˘i⁄s
)) {

5527 
c⁄√˘d©a
 *
c⁄n_ˇndid©e
;

5530 
c⁄n_ˇndid©e
 = 
	`föd_ﬁde°_idÀ_c⁄√˘i⁄_ö_bundÀ
(
d©a
, 
bundÀ
);

5532 if(
c⁄n_ˇndid©e
) {

5534 
c⁄n_ˇndid©e
->
d©a
 = data;

5535 ()
	`Cuæ_disc⁄√˘
(
c⁄n_ˇndid©e
, 
FALSE
);

5538 
no_c⁄√˘i⁄s_avaûabÀ
 = 
TRUE
;

5541 if(
max_tŸÆ_c⁄√˘i⁄s
 > 0 &&

5542 (
d©a
->
°©e
.
c⁄n_ˇche
->
num_c⁄√˘i⁄s
 >
max_tŸÆ_c⁄√˘i⁄s
)) {

5543 
c⁄√˘d©a
 *
c⁄n_ˇndid©e
;

5546 
c⁄n_ˇndid©e
 = 
	`föd_ﬁde°_idÀ_c⁄√˘i⁄
(
d©a
);

5548 if(
c⁄n_ˇndid©e
) {

5550 
c⁄n_ˇndid©e
->
d©a
 = data;

5551 ()
	`Cuæ_disc⁄√˘
(
c⁄n_ˇndid©e
, 
FALSE
);

5554 
no_c⁄√˘i⁄s_avaûabÀ
 = 
TRUE
;

5558 if(
no_c⁄√˘i⁄s_avaûabÀ
) {

5559 
	`öfof
(
d©a
, "No connectionsávailable.\n");

5561 
	`c⁄n_‰ì
(
c⁄n
);

5562 *
ö_c⁄√˘
 = 
NULL
;

5564 
ªsu…
 = 
CURLE_NO_CONNECTION_AVAILABLE
;

5565 
out
;

5572 
	`C⁄√˘i⁄St‹e
(
d©a
, 
c⁄n
);

5577 
c⁄n
->
öu£
 = 
TRUE
;

5580 
	`do_öô
(
c⁄n
);

5585 
ªsu…
 = 
	`£tup_ønge
(
d©a
);

5586 if(
ªsu…
)

5587 
out
;

5595 
c⁄n
->
‰ód_func
 = 
d©a
->
£t
.fread_func;

5596 
c⁄n
->
‰ód_ö
 = 
d©a
->
£t
.
ö
;

5597 
c⁄n
->
£ek_func
 = 
d©a
->
£t
.seek_func;

5598 
c⁄n
->
£ek_˛õ¡
 = 
d©a
->
£t
.seek_client;

5603 
ªsu…
 = 
	`ªsﬁve_£rvî
(
d©a
, 
c⁄n
, 
async
);

5605 
out
:

5607 
	`Cuæ_ß„‰ì
(
›ti⁄s
);

5608 
	`Cuæ_ß„‰ì
(
∑sswd
);

5609 
	`Cuæ_ß„‰ì
(
u£r
);

5610 
	`Cuæ_ß„‰ì
(
¥oxy
);

5611  
ªsu…
;

5612 
	}
}

5622 
CURLcode
 
	$Cuæ_£tup_c⁄n
(
c⁄√˘d©a
 *
c⁄n
,

5623 
boﬁ
 *
¥Ÿocﬁ_d⁄e
)

5625 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

5626 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

5628 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_NAMELOOKUP
);

5630 if(
c⁄n
->
h™dÀr
->
Êags
 & 
PROTOPT_NONETWORK
) {

5632 *
¥Ÿocﬁ_d⁄e
 = 
TRUE
;

5633  
ªsu…
;

5635 *
¥Ÿocﬁ_d⁄e
 = 
FALSE
;

5641 
c⁄n
->
bôs
.
¥oxy_c⁄√˘_˛o£d
 = 
FALSE
;

5648 if(
d©a
->
£t
.
°r
[
STRING_USERAGENT
]) {

5649 
	`Cuæ_ß„‰ì
(
c⁄n
->
Ælo˝å
.
uagít
);

5650 
c⁄n
->
Ælo˝å
.
uagít
 =

5651 
	`≠rötf
("U£r-Agít: %s\r\n", 
d©a
->
£t
.
°r
[
STRING_USERAGENT
]);

5652 if(!
c⁄n
->
Ælo˝å
.
uagít
)

5653  
CURLE_OUT_OF_MEMORY
;

5656 
d©a
->
ªq
.
hódîbyãcou¡
 = 0;

5658 #ifde‡
CURL_DO_LINEEND_CONV


5659 
d©a
->
°©e
.
¸lf_c⁄vîsi⁄s
 = 0;

5664 
c⁄n
->
now
 = 
	`Cuæ_tvnow
();

5666 if(
CURL_SOCKET_BAD
 =
c⁄n
->
sock
[
FIRSTSOCKET
]) {

5667 
c⁄n
->
bôs
.
t˝c⁄√˘
[
FIRSTSOCKET
] = 
FALSE
;

5668 
ªsu…
 = 
	`Cuæ_c⁄√˘ho°
(
c⁄n
, c⁄n->
dns_íåy
);

5669 if(
ªsu…
)

5670  
ªsu…
;

5673 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_CONNECT
);

5674 
	`Cuæ_pgrsTime
(
d©a
, 
TIMER_APPCONNECT
);

5675 
c⁄n
->
bôs
.
t˝c⁄√˘
[
FIRSTSOCKET
] = 
TRUE
;

5676 *
¥Ÿocﬁ_d⁄e
 = 
TRUE
;

5677 
	`Cuæ_upd©ec⁄nöfo
(
c⁄n
, c⁄n->
sock
[
FIRSTSOCKET
]);

5678 
	`Cuæ_vîbo£c⁄√˘
(
c⁄n
);

5681 
c⁄n
->
now
 = 
	`Cuæ_tvnow
();

5684 #ifde‡
__EMX__


5692 if((
d©a
->
£t
.
out
)->
_h™dÀ
 =
NULL
) {

5693 
	`_f£tmode
(
°dout
, "b");

5697  
ªsu…
;

5698 
	}
}

5700 
CURLcode
 
	$Cuæ_c⁄√˘
(
Sessi⁄H™dÀ
 *
d©a
,

5701 
c⁄√˘d©a
 **
ö_c⁄√˘
,

5702 
boﬁ
 *
asyn˝
,

5703 
boﬁ
 *
¥Ÿocﬁ_d⁄e
)

5705 
CURLcode
 
code
;

5707 *
asyn˝
 = 
FALSE
;

5710 
code
 = 
	`¸óã_c⁄n
(
d©a
, 
ö_c⁄√˘
, 
asyn˝
);

5712 if(
CURLE_OK
 =
code
) {

5714 if((*
ö_c⁄√˘
)->
£nd_pùe
->
size
 || (*ö_c⁄√˘)->
ªcv_pùe
->size)

5716 *
¥Ÿocﬁ_d⁄e
 = 
TRUE
;

5717 if(!*
asyn˝
) {

5721 
code
 = 
	`Cuæ_£tup_c⁄n
(*
ö_c⁄√˘
, 
¥Ÿocﬁ_d⁄e
);

5725 if(
code
 =
CURLE_NO_CONNECTION_AVAILABLE
) {

5726 *
ö_c⁄√˘
 = 
NULL
;

5727  
code
;

5730 if(
code
 && *
ö_c⁄√˘
) {

5733 
	`Cuæ_disc⁄√˘
(*
ö_c⁄√˘
, 
FALSE
);

5734 *
ö_c⁄√˘
 = 
NULL
;

5737  
code
;

5738 
	}
}

5740 
CURLcode
 
	$Cuæ_d⁄e
(
c⁄√˘d©a
 **
c⁄≈
,

5741 
CURLcode
 
°©us
,

5743 
boﬁ
 
¥em©uª
)

5745 
CURLcode
 
ªsu…
;

5746 
c⁄√˘d©a
 *
c⁄n
;

5747 
Sessi⁄H™dÀ
 *
d©a
;

5749 
	`DEBUGASSERT
(*
c⁄≈
);

5751 
c⁄n
 = *
c⁄≈
;

5752 
d©a
 = 
c⁄n
->data;

5754 if(
c⁄n
->
bôs
.
d⁄e
)

5756  
CURLE_OK
;

5758 
	`Cuæ_gëoff_Æl_pùñöes
(
d©a
, 
c⁄n
);

5760 if((
c⁄n
->
£nd_pùe
->
size
 + c⁄n->
ªcv_pùe
->size != 0 &&

5761 !
d©a
->
£t
.
ªu£_f‹bid
 &&

5762 !
c⁄n
->
bôs
.
˛o£
))

5765  
CURLE_OK
;

5767 
c⁄n
->
bôs
.
d⁄e
 = 
TRUE
;

5770 if(
d©a
->
ªq
.
√wuæ
) {

5771 
	`‰ì
(
d©a
->
ªq
.
√wuæ
);

5772 
d©a
->
ªq
.
√wuæ
 = 
NULL
;

5774 if(
d©a
->
ªq
.
loˇti⁄
) {

5775 
	`‰ì
(
d©a
->
ªq
.
loˇti⁄
);

5776 
d©a
->
ªq
.
loˇti⁄
 = 
NULL
;

5779 
	`Cuæ_ªsﬁvî_ˇn˚l
(
c⁄n
);

5781 if(
c⁄n
->
dns_íåy
) {

5782 
	`Cuæ_ªsﬁv_u∆ock
(
d©a
, 
c⁄n
->
dns_íåy
);

5783 
c⁄n
->
dns_íåy
 = 
NULL
;

5786 
°©us
) {

5787 
CURLE_ABORTED_BY_CALLBACK
:

5788 
CURLE_READ_ERROR
:

5789 
CURLE_WRITE_ERROR
:

5794 
¥em©uª
 = 
TRUE
;

5800 if(
c⁄n
->
h™dÀr
->
d⁄e
)

5801 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`d⁄e
(c⁄n, 
°©us
, 
¥em©uª
);

5803 
ªsu…
 = 
°©us
;

5805 if(!
ªsu…
 && 
	`Cuæ_pgrsD⁄e
(
c⁄n
))

5806 
ªsu…
 = 
CURLE_ABORTED_BY_CALLBACK
;

5810 if(
d©a
->
°©e
.
ãmpwrôe
) {

5811 
	`‰ì
(
d©a
->
°©e
.
ãmpwrôe
);

5812 
d©a
->
°©e
.
ãmpwrôe
 = 
NULL
;

5828 if(
d©a
->
£t
.
ªu£_f‹bid
 || 
c⁄n
->
bôs
.
˛o£
 || 
¥em©uª
) {

5829 
CURLcode
 
ªs2
 = 
	`Cuæ_disc⁄√˘
(
c⁄n
, 
¥em©uª
);

5833 if(!
ªsu…
 && 
ªs2
)

5834 
ªsu…
 = 
ªs2
;

5838 if(
	`C⁄√˘i⁄D⁄e
(
d©a
, 
c⁄n
)) {

5840 
d©a
->
°©e
.
œ°c⁄√˘
 = 
c⁄n
;

5842 
	`öfof
(
d©a
, "Connection #%ldÅo host %sÜeft intact\n",

5843 
c⁄n
->
c⁄√˘i⁄_id
,

5844 
c⁄n
->
bôs
.
hâµroxy
?c⁄n->
¥oxy
.
di•«me
:c⁄n->
ho°
.dispname);

5847 
d©a
->
°©e
.
œ°c⁄√˘
 = 
NULL
;

5850 *
c⁄≈
 = 
NULL
;

5854 
	`Cuæ_‰ì_ªque°_°©e
(
d©a
);

5856  
ªsu…
;

5857 
	}
}

5867 
CURLcode
 
	$do_öô
(
c⁄√˘d©a
 *
c⁄n
)

5869 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

5870 
SögÀReque°
 *
k
 = &
d©a
->
ªq
;

5872 
c⁄n
->
bôs
.
d⁄e
 = 
FALSE
;

5873 
c⁄n
->
bôs
.
do_m‹e
 = 
FALSE
;

5874 
d©a
->
°©e
.
ex≥˘100hódî
 = 
FALSE
;

5876 if(
d©a
->
£t
.
›t_no_body
)

5878 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_HEAD
;

5879 if(
HTTPREQ_HEAD
 =
d©a
->
£t
.
hâ¥eq
)

5885 
d©a
->
£t
.
hâ¥eq
 = 
HTTPREQ_GET
;

5887 
k
->
°¨t
 = 
	`Cuæ_tvnow
();

5888 
k
->
now
 = k->
°¨t
;

5889 
k
->
hódî
 = 
TRUE
;

5891 
k
->
byãcou¡
 = 0;

5893 
k
->
buf
 = 
d©a
->
°©e
.
buf„r
;

5894 
k
->
u∂ﬂdbuf
 = 
d©a
->
°©e
.
u∂ﬂdbuf„r
;

5895 
k
->
hbuÂ
 = 
d©a
->
°©e
.
hódîbuff
;

5896 
k
->
ign‹ebody
=
FALSE
;

5898 
	`Cuæ_•ìdöô
(
d©a
);

5900 
	`Cuæ_pgrsSëU∂ﬂdCou¡î
(
d©a
, 0);

5901 
	`Cuæ_pgrsSëDow∆ﬂdCou¡î
(
d©a
, 0);

5903  
CURLE_OK
;

5904 
	}
}

5912 
	$do_com∂ëe
(
c⁄√˘d©a
 *
c⁄n
)

5914 
c⁄n
->
d©a
->
ªq
.
chunk
=
FALSE
;

5915 
c⁄n
->
d©a
->
ªq
.
maxfd
 = (c⁄n->
sockfd
>c⁄n->
wrôesockfd
?

5916 
c⁄n
->
sockfd
:c⁄n->
wrôesockfd
)+1;

5917 
	`Cuæ_pgrsTime
(
c⁄n
->
d©a
, 
TIMER_PRETRANSFER
);

5918 
	}
}

5920 
CURLcode
 
	$Cuæ_do
(
c⁄√˘d©a
 **
c⁄≈
, 
boﬁ
 *
d⁄e
)

5922 
CURLcode
 
ªsu…
=
CURLE_OK
;

5923 
c⁄√˘d©a
 *
c⁄n
 = *
c⁄≈
;

5924 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

5926 if(
c⁄n
->
h™dÀr
->
do_ô
) {

5928 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`do_ô
(c⁄n, 
d⁄e
);

5931 if((
CURLE_SEND_ERROR
 =
ªsu…
Ë&& 
c⁄n
->
bôs
.
ªu£
) {

5937 if(!
d©a
->
mu…i
) {

5938 
ªsu…
 = 
	`Cuæ_ªc⁄√˘_ªque°
(
c⁄≈
);

5940 if(
ªsu…
 =
CURLE_OK
) {

5942 
c⁄n
 = *
c⁄≈
;

5944 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`do_ô
(c⁄n, 
d⁄e
);

5948  
ªsu…
;

5951 if((
ªsu…
 =
CURLE_OK
Ë&& *
d⁄e
)

5953 
	`do_com∂ëe
(
c⁄n
);

5955  
ªsu…
;

5956 
	}
}

5969 
CURLcode
 
	$Cuæ_do_m‹e
(
c⁄√˘d©a
 *
c⁄n
, *
com∂ëe
)

5971 
CURLcode
 
ªsu…
=
CURLE_OK
;

5973 *
com∂ëe
 = 0;

5975 if(
c⁄n
->
h™dÀr
->
do_m‹e
)

5976 
ªsu…
 = 
c⁄n
->
h™dÀr
->
	`do_m‹e
(c⁄n, 
com∂ëe
);

5978 if(!
ªsu…
 && (*
com∂ëe
 == 1))

5980 
	`do_com∂ëe
(
c⁄n
);

5982  
ªsu…
;

5983 
	}
}

	@lib/url.h

1 #i‚de‡
HEADER_CURL_URL_H


2 
	#HEADER_CURL_URL_H


	)

24 
	~"cuæ_£tup.h
"

30 
CURLcode
 
Cuæ_›í
(
Sessi⁄H™dÀ
 **
cuæ
);

31 
CURLcode
 
Cuæ_öô_u£rdeföed
(
U£rDeföed
 *
£t
);

32 
CURLcode
 
Cuæ_£t›t
(
Sessi⁄H™dÀ
 *
d©a
, 
CURL›ti⁄
 
›ti⁄
,

33 
va_li°
 
¨g
);

34 
CURLcode
 
Cuæ_dup£t
(
Sessi⁄H™dÀ
 * 
d°
, Sessi⁄H™dÀ * 
§c
);

35 
Cuæ_‰ì£t
(
Sessi⁄H™dÀ
 * 
d©a
);

36 
CURLcode
 
Cuæ_˛o£
(
Sessi⁄H™dÀ
 *
d©a
);

37 
CURLcode
 
Cuæ_c⁄√˘
(
Sessi⁄H™dÀ
 *, 
c⁄√˘d©a
 **,

38 
boﬁ
 *
async
, boﬁ *
¥Ÿocﬁ_c⁄√˘
);

39 
CURLcode
 
Cuæ_do
(
c⁄√˘d©a
 **, 
boﬁ
 *
d⁄e
);

40 
CURLcode
 
Cuæ_do_m‹e
(
c⁄√˘d©a
 *, *
com∂ëed
);

41 
CURLcode
 
Cuæ_d⁄e
(
c⁄√˘d©a
 **, CURLcode, 
boﬁ
 
¥em©uª
);

42 
CURLcode
 
Cuæ_disc⁄√˘
(
c⁄√˘d©a
 *, 
boﬁ
 
dód_c⁄√˘i⁄
);

43 
CURLcode
 
Cuæ_¥Ÿocﬁ_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

44 
CURLcode
 
Cuæ_¥Ÿocﬁ_c⁄√˘ög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

45 
CURLcode
 
Cuæ_¥Ÿocﬁ_doög
(
c⁄√˘d©a
 *
c⁄n
, 
boﬁ
 *
d⁄e
);

46 
CURLcode
 
Cuæ_£tup_c⁄n
(
c⁄√˘d©a
 *
c⁄n
,

47 
boﬁ
 *
¥Ÿocﬁ_d⁄e
);

48 
Cuæ_‰ì_ªque°_°©e
(
Sessi⁄H™dÀ
 *
d©a
);

50 
Cuæ_¥Ÿocﬁ_gësock
(
c⁄√˘d©a
 *
c⁄n
,

51 
cuæ_sockë_t
 *
socks
,

52 
numsocks
);

53 
Cuæ_doög_gësock
(
c⁄√˘d©a
 *
c⁄n
,

54 
cuæ_sockë_t
 *
socks
,

55 
numsocks
);

57 
boﬁ
 
Cuæ_isPùñöögE«bÀd
(c⁄° 
Sessi⁄H™dÀ
 *
h™dÀ
);

58 
CURLcode
 
Cuæ_addH™dÀToPùñöe
(
Sessi⁄H™dÀ
 *
h™dÀ
,

59 
cuæ_Œi°
 *
pùñöe
);

60 
Cuæ_ªmoveH™dÀFromPùñöe
(
Sessi⁄H™dÀ
 *
h™dÀ
,

61 
cuæ_Œi°
 *
pùñöe
);

64 
Cuæ_gëoff_Æl_pùñöes
(
Sessi⁄H™dÀ
 *
d©a
,

65 
c⁄√˘d©a
 *
c⁄n
);

67 
Cuæ_˛o£_c⁄√˘i⁄s
(
Sessi⁄H™dÀ
 *
d©a
);

69 
	#CURL_DEFAULT_PROXY_PORT
 1080

	)

70 
	#CURL_DEFAULT_SOCKS5_GSSAPI_SERVICE
 "rcmd"

	)

73 
CURLcode
 
Cuæ_c⁄√˘ed_¥oxy
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

75 #ifde‡
CURL_DISABLE_VERBOSE_STRINGS


76 
	#Cuæ_vîbo£c⁄√˘
(
x
Ë
Cuæ_n›_°mt


	)

78 
Cuæ_vîbo£c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
);

	@lib/urldata.h

1 #i‚de‡
HEADER_CURL_URLDATA_H


2 
	#HEADER_CURL_URLDATA_H


	)

27 
	~"cuæ_£tup.h
"

29 
	#PORT_FTP
 21

	)

30 
	#PORT_FTPS
 990

	)

31 
	#PORT_TELNET
 23

	)

32 
	#PORT_HTTP
 80

	)

33 
	#PORT_HTTPS
 443

	)

34 
	#PORT_DICT
 2628

	)

35 
	#PORT_LDAP
 389

	)

36 
	#PORT_LDAPS
 636

	)

37 
	#PORT_TFTP
 69

	)

38 
	#PORT_SSH
 22

	)

39 
	#PORT_IMAP
 143

	)

40 
	#PORT_IMAPS
 993

	)

41 
	#PORT_POP3
 110

	)

42 
	#PORT_POP3S
 995

	)

43 
	#PORT_SMTP
 25

	)

44 
	#PORT_SMTPS
 465

	)

45 
	#PORT_RTSP
 554

	)

46 
	#PORT_RTMP
 1935

	)

47 
	#PORT_RTMPT
 
PORT_HTTP


	)

48 
	#PORT_RTMPS
 
PORT_HTTPS


	)

49 
	#PORT_GOPHER
 70

	)

51 
	#DICT_MATCH
 "/MATCH:"

	)

52 
	#DICT_MATCH2
 "/M:"

	)

53 
	#DICT_MATCH3
 "/FIND:"

	)

54 
	#DICT_DEFINE
 "/DEFINE:"

	)

55 
	#DICT_DEFINE2
 "/D:"

	)

56 
	#DICT_DEFINE3
 "/LOOKUP:"

	)

58 
	#CURL_DEFAULT_USER
 "™⁄ymous"

	)

59 
	#CURL_DEFAULT_PASSWORD
 "·p@exam∂e.com"

	)

64 
	#PROTO_FAMILY_HTTP
 (
CURLPROTO_HTTP
|
CURLPROTO_HTTPS
)

	)

65 
	#PROTO_FAMILY_FTP
 (
CURLPROTO_FTP
|
CURLPROTO_FTPS
)

	)

66 
	#PROTO_FAMILY_POP3
 (
CURLPROTO_POP3
|
CURLPROTO_POP3S
)

	)

67 
	#PROTO_FAMILY_SMTP
 (
CURLPROTO_SMTP
|
CURLPROTO_SMTPS
)

	)

69 
	#DEFAULT_CONNCACHE_SIZE
 5

	)

72 
	#MAX_IPADR_LEN
 ("ffff:ffff:ffff:ffff:ffff:ffff:255.255.255.255")

	)

77 
	#RESP_TIMEOUT
 (1800*1000)

	)

79 
	~"cookõ.h
"

80 
	~"f‹md©a.h
"

82 #ifde‡
USE_SSLEAY


83 #ifde‡
USE_OPENSSL


84 
	~<›ís¶/rß.h
>

85 
	~<›ís¶/¸y±o.h
>

86 
	~<›ís¶/x509.h
>

87 
	~<›ís¶/≥m.h
>

88 
	~<›ís¶/s¶.h
>

89 
	~<›ís¶/îr.h
>

90 #ifde‡
HAVE_OPENSSL_ENGINE_H


91 
	~<›ís¶/ígöe.h
>

93 #ifde‡
HAVE_OPENSSL_PKCS12_H


94 
	~<›ís¶/pkcs12.h
>

97 
	~<rß.h
>

98 
	~<¸y±o.h
>

99 
	~<x509.h
>

100 
	~<≥m.h
>

101 
	~<s¶.h
>

102 
	~<îr.h
>

103 #ifde‡
HAVE_OPENSSL_ENGINE_H


104 
	~<ígöe.h
>

106 #ifde‡
HAVE_OPENSSL_PKCS12_H


107 
	~<pkcs12.h
>

110 #ifde‡
USE_GNUTLS


111 #îr‹ 
C⁄figuøti⁄
 
îr‹
; 
ˇ¬Ÿ
 
u£
 
GnuTLS
 *
™d
* 
O≥nSSL
.

115 #ifde‡
USE_GNUTLS


116 
	~<gnués/gnués.h
>

119 #ifde‡
USE_POLARSSL


120 
	~<pﬁ¨s¶/s¶.h
>

121 
	~<pﬁ¨s¶/vîsi⁄.h
>

122 #i‡
POLARSSL_VERSION_NUMBER
<0x01010000

123 
	~<pﬁ¨s¶/havege.h
>

125 
	~<pﬁ¨s¶/íå›y.h
>

126 
	~<pﬁ¨s¶/˘r_drbg.h
>

130 #ifde‡
USE_CYASSL


131 #unde‡
OCSP_REQUEST


132 #unde‡
OCSP_RESPONSE


133 
	~<cyas¶/›ís¶/s¶.h
>

136 #ifde‡
USE_NSS


137 
	~<n•r.h
>

138 
	~<pk11pub.h
>

141 #ifde‡
USE_QSOSSL


142 
	~<qsos¶.h
>

145 #ifde‡
USE_GSKIT


146 
	~<gsks¶.h
>

149 #ifde‡
USE_AXTLS


150 
	~<axTLS/s¶.h
>

151 #unde‡
mÆloc


152 #unde‡
ˇŒoc


153 #unde‡
ªÆloc


156 #ifde‡
USE_SCHANNEL


157 
	~"cuæ_s•i.h
"

158 
	~<sch∆•.h
>

159 
	~<sch™√l.h
>

162 #ifde‡
USE_DARWINSSL


163 
	~<Securôy/Securôy.h
>

166 
	~<Securôy/SecuªTøn•‹t.h
>

169 #ifde‡
HAVE_NETINET_IN_H


170 
	~<√töë/ö.h
>

173 
	~"timevÆ.h
"

175 #ifde‡
HAVE_ZLIB_H


176 
	~<zlib.h
>

177 #ifde‡
__SYMBIAN32__


179 #unde‡
WIN32


183 
	~<cuæ/cuæ.h
>

185 
	~"hâp_chunks.h
"

186 
	~"ho°ù.h
"

187 
	~"hash.h
"

188 
	~"•œy.h
"

190 
	~"im≠.h
"

191 
	~"p›3.h
"

192 
	~"smç.h
"

193 
	~"·p.h
"

194 
	~"fûe.h
"

195 
	~"ssh.h
"

196 
	~"hâp.h
"

197 
	~"π•.h
"

198 
	~"wûdˇrd.h
"

199 
	~"mu…ih™dÀ.h
"

201 #ifde‡
HAVE_GSSAPI


202 #ifde‡
HAVE_GSSGNU


203 
	~<gss.h
>

204 #ñi‡
deföed
 
HAVE_GSSMIT


205 
	~<gsßpi/gsßpi.h
>

206 
	~<gsßpi/gsßpi_gíîic.h
>

208 
	~<gsßpi.h
>

212 #ifde‡
HAVE_LIBSSH2_H


213 
	~<libssh2.h
>

214 
	~<libssh2_s·p.h
>

218 #unde‡
BUFSIZE


219 
	#BUFSIZE
 
CURL_MAX_WRITE_SIZE


	)

223 
	#HEADERSIZE
 256

	)

225 
	#CURLEASY_MAGIC_NUMBER
 0xc0dedbadU

	)

229 
	#CURLMAX
(
x
,
y
Ë((x)>(y)?(x):(y))

	)

230 
	#CURLMIN
(
x
,
y
Ë((x)<(y)?(x):(y))

	)

233 #ifde‡
HAVE_GSSAPI


235 
	skrb5buf„r
 {

236 *
	md©a
;

237 
size_t
 
	msize
;

238 
size_t
 
	mödex
;

239 
	meof_Êag
;

242 
	e¥Ÿe˘i⁄_Àvñ
 {

243 
	mPROT_NONE
,

244 
	mPROT_CLEAR
,

245 
	mPROT_SAFE
,

246 
	mPROT_CONFIDENTIAL
,

247 
	mPROT_PRIVATE
,

248 
	mPROT_CMD
,

249 
	mPROT_LAST


253 #ifde‡
USE_SCHANNEL


255 
	scuæ_sch™√l_¸ed
 {

256 
CªdH™dÀ
 
	m¸ed_h™dÀ
;

257 
TimeSèmp
 
	mtime_°amp
;

258 
	mªfcou¡
;

259 
boﬁ
 
	mˇched
;

262 
	scuæ_sch™√l_˘xt
 {

263 
CtxtH™dÀ
 
	m˘xt_h™dÀ
;

264 
TimeSèmp
 
	mtime_°amp
;

270 
	ms¶_c⁄√˘_1
,

271 
	ms¶_c⁄√˘_2
,

272 
	ms¶_c⁄√˘_2_ªadög
,

273 
	ms¶_c⁄√˘_2_wrôög
,

274 
	ms¶_c⁄√˘_3
,

275 
	ms¶_c⁄√˘_d⁄e


276 } 
	ts¶_c⁄√˘_°©e
;

279 
	ms¶_c⁄√˘i⁄_n⁄e
,

280 
	ms¶_c⁄√˘i⁄_√gŸütög
,

281 
	ms¶_c⁄√˘i⁄_com∂ëe


282 } 
	ts¶_c⁄√˘i⁄_°©e
;

285 
	ss¶_c⁄√˘_d©a
 {

289 
boﬁ
 
	mu£
;

290 
s¶_c⁄√˘i⁄_°©e
 
	m°©e
;

291 #ifde‡
USE_SSLEAY


293 
SSL_CTX
* 
	m˘x
;

294 
SSL
* 
	mh™dÀ
;

295 
X509
* 
	m£rvî_˚π
;

296 
s¶_c⁄√˘_°©e
 
	mc⁄√˘ög_°©e
;

298 #ifde‡
USE_GNUTLS


299 
gnués_£ssi⁄_t
 
	m£ssi⁄
;

300 
gnués_˚πifiˇã_¸edítüls_t
 
	m¸ed
;

301 #ifde‡
USE_TLS_SRP


302 
gnués_§p_˛õ¡_¸edítüls_t
 
	m§p_˛õ¡_¸ed
;

304 
s¶_c⁄√˘_°©e
 
	mc⁄√˘ög_°©e
;

306 #ifde‡
USE_POLARSSL


307 
˘r_drbg_c⁄ãxt
 
	m˘r_drbg
;

308 
íå›y_c⁄ãxt
 
	míå›y
;

309 
s¶_c⁄ãxt
 
	ms¶
;

310 
s¶_£ssi⁄
 
	ms¢
;

311 
	m£rvî_fd
;

312 
x509_¸t
 
	mˇ˚π
;

313 
x509_¸t
 
	m˛i˚π
;

314 
x509_¸l
 
	m¸l
;

315 
rß_c⁄ãxt
 
	mrß
;

316 
s¶_c⁄√˘_°©e
 
	mc⁄√˘ög_°©e
;

318 #ifde‡
USE_CYASSL


319 
SSL_CTX
* 
	m˘x
;

320 
SSL
* 
	mh™dÀ
;

321 
s¶_c⁄√˘_°©e
 
	mc⁄√˘ög_°©e
;

323 #ifde‡
USE_NSS


324 
PRFûeDesc
 *
	mh™dÀ
;

325 *
	m˛õ¡_nick«me
;

326 
Sessi⁄H™dÀ
 *
	md©a
;

327 
cuæ_Œi°
 *
	mobj_li°
;

328 
PK11GíîicObje˘
 *
	mobj_˛i˚π
;

329 
s¶_c⁄√˘_°©e
 
	mc⁄√˘ög_°©e
;

331 #ifde‡
USE_QSOSSL


332 
SSLH™dÀ
 *
	mh™dÀ
;

334 #ifde‡
USE_GSKIT


335 
gsk_h™dÀ
 
	mh™dÀ
;

336 
	mio˝‹t
;

337 
s¶_c⁄√˘_°©e
 
	mc⁄√˘ög_°©e
;

339 #ifde‡
USE_AXTLS


340 
SSL_CTX
* 
	ms¶_˘x
;

341 
SSL
* 
	ms¶
;

342 
s¶_c⁄√˘_°©e
 
	mc⁄√˘ög_°©e
;

344 #ifde‡
USE_SCHANNEL


345 
cuæ_sch™√l_¸ed
 *
	m¸ed
;

346 
cuæ_sch™√l_˘xt
 *
	m˘xt
;

347 
SecPkgC⁄ãxt_SåómSizes
 
	m°ªam_sizes
;

348 
s¶_c⁄√˘_°©e
 
	mc⁄√˘ög_°©e
;

349 
size_t
 
	mícd©a_Àngth
, 
	mdecd©a_Àngth
;

350 
size_t
 
	mícd©a_off£t
, 
	mdecd©a_off£t
;

351 *
	mícd©a_buf„r
, *
	mdecd©a_buf„r
;

352 
	mªq_Êags
, 
	mªt_Êags
;

354 #ifde‡
USE_DARWINSSL


355 
SSLC⁄ãxtRef
 
	ms¶_˘x
;

356 
cuæ_sockë_t
 
	ms¶_sockfd
;

357 
s¶_c⁄√˘_°©e
 
	mc⁄√˘ög_°©e
;

358 
boﬁ
 
	ms¶_dúe˘i⁄
;

359 
size_t
 
	ms¶_wrôe_buf„ªd_Àngth
;

363 
	ss¶_c⁄fig_d©a
 {

364 
	mvîsi⁄
;

365 
	m˚πvîifyªsu…
;

367 
boﬁ
 
	mvîify≥î
;

368 
boﬁ
 
	mvîifyho°
;

369 *
	mCA∑th
;

370 *
	mCAfûe
;

371 c⁄° *
	mCRLfûe
;

372 c⁄° *
	missuî˚π
;

373 *
	møndom_fûe
;

374 *
	megdsockë
;

375 *
	mcùhî_li°
;

376 
size_t
 
	mmax_s¶_£ssi⁄s
;

377 
cuæ_s¶_˘x_ˇŒback
 
	mfs¶˘x
;

378 *
	mfs¶˘xp
;

379 
boﬁ
 
	m£ssi⁄id
;

380 
boﬁ
 
	m˚πöfo
;

382 #ifde‡
USE_TLS_SRP


383 *
	mu£∫ame
;

384 *
	m∑ssw‹d
;

385 
CURL_TLSAUTH
 
	mauthty≥
;

390 
	scuæ_s¶_£ssi⁄
 {

391 *
	m«me
;

392 *
	m£ssi⁄id
;

393 
size_t
 
	midsize
;

394 
	mage
;

395 
	mªmŸe_p‹t
;

396 
s¶_c⁄fig_d©a
 
	ms¶_c⁄fig
;

400 
	sdige°d©a
 {

401 *
	mn⁄˚
;

402 *
	m˙⁄˚
;

403 *
	mªÆm
;

404 
	mÆgo
;

405 
boﬁ
 
	m°Æe
;

406 *
	m›aque
;

407 *
	mq›
;

408 *
	mÆg‹ôhm
;

409 
	mnc
;

413 
	mNTLMSTATE_NONE
,

414 
	mNTLMSTATE_TYPE1
,

415 
	mNTLMSTATE_TYPE2
,

416 
	mNTLMSTATE_TYPE3
,

417 
	mNTLMSTATE_LAST


418 } 
	tcuæ¡lm
;

420 #ifde‡
USE_WINDOWS_SSPI


421 
	~"cuæ_s•i.h
"

424 #i‡
deföed
(
CURL_DOES_CONVERSIONS
Ë&& deföed(
HAVE_ICONV
)

425 
	~<ic⁄v.h
>

429 
	s¡lmd©a
 {

430 
cuæ¡lm
 
	m°©e
;

431 #ifde‡
USE_WINDOWS_SSPI


432 
CªdH™dÀ
 
	mh™dÀ
;

433 
CtxtH™dÀ
 
	mc_h™dÀ
;

434 
SEC_WINNT_AUTH_IDENTITY
 
	midítôy
;

435 
SEC_WINNT_AUTH_IDENTITY
 *
	mp_idítôy
;

436 
	mhas_h™dÀs
;

437 *
	mty≥_2
;

438 
	mn_ty≥_2
;

440 
	mÊags
;

441 
	mn⁄˚
[8];

442 * 
	mèrgë_öfo
;

443 
	mèrgë_öfo_Àn
;

447 #ifde‡
USE_HTTP_NEGOTIATE


448 
	s√gŸüãd©a
 {

451 íum { 
	mGSS_AUTHNONE
, 
	mGSS_AUTHRECV
, 
	mGSS_AUTHSENT
 } 
	m°©e
;

452 
boﬁ
 
	mgss
;

453 c⁄° * 
	m¥Ÿocﬁ
;

454 #ifde‡
HAVE_GSSAPI


455 
OM_uöt32
 
	m°©us
;

456 
gss_˘x_id_t
 
	mc⁄ãxt
;

457 
gss_«me_t
 
	m£rvî_«me
;

458 
gss_buf„r_desc
 
	mouçut_tokí
;

460 #ifde‡
USE_WINDOWS_SSPI


461 
DWORD
 
	m°©us
;

462 
CtxtH™dÀ
 *
	mc⁄ãxt
;

463 
CªdH™dÀ
 *
	m¸edítüls
;

464 
	m£rvî_«me
[1024];

465 
size_t
 
	mmax_tokí_Àngth
;

466 
BYTE
 *
	mouçut_tokí
;

467 
size_t
 
	mouçut_tokí_Àngth
;

477 
	sC⁄√˘Bôs
 {

479 
boﬁ
 
	m˛o£
;

480 
boﬁ
 
	mªu£
;

481 
boﬁ
 
	m¥oxy
;

482 
boﬁ
 
	mhâµroxy
;

483 
boﬁ
 
	mu£r_∑sswd
;

484 
boﬁ
 
	m¥oxy_u£r_∑sswd
;

485 
boﬁ
 
	mùv6_ù
;

487 
boﬁ
 
	mùv6
;

489 
boﬁ
 
	mdo_m‹e
;

491 
boﬁ
 
	mt˝c⁄√˘
[2];

493 
boﬁ
 
	m¥Ÿoc⁄n°¨t
;

496 
boﬁ
 
	mªåy
;

498 
boﬁ
 
	mtu¬ñ_¥oxy
;

502 
boﬁ
 
	mauth√g
;

506 
boﬁ
 
	mªwöda·î£nd
;

510 
boﬁ
 
	m·p_u£_ïsv
;

514 
boﬁ
 
	m·p_u£_ïπ
;

517 
boﬁ
 
	m√åc
;

518 
boﬁ
 
	mu£Ωwd_ö_uæ
;

520 
boﬁ
 
	md⁄e
;

524 
boﬁ
 
	m°ªam_was_ªwound
;

527 
boﬁ
 
	m¥oxy_c⁄√˘_˛o£d
;

530 
boﬁ
 
	mbound
;

532 
boﬁ
 
	mty≥_£t
;

535 
	sho°«me
 {

536 *
	møwÆloc
;

537 *
	míˇŒoc
;

538 *
	m«me
;

539 c⁄° *
	mdi•«me
;

546 
	#KEEP_NONE
 0

	)

547 
	#KEEP_RECV
 (1<<0Ë

	)

548 
	#KEEP_SEND
 (1<<1Ë

	)

549 
	#KEEP_RECV_HOLD
 (1<<2Ë

	)

551 
	#KEEP_SEND_HOLD
 (1<<3Ë

	)

553 
	#KEEP_RECV_PAUSE
 (1<<4Ë

	)

554 
	#KEEP_SEND_PAUSE
 (1<<5Ë

	)

556 
	#KEEP_RECVBITS
 (
KEEP_RECV
 | 
KEEP_RECV_HOLD
 | 
KEEP_RECV_PAUSE
)

	)

557 
	#KEEP_SENDBITS
 (
KEEP_SEND
 | 
KEEP_SEND_HOLD
 | 
KEEP_SEND_PAUSE
)

	)

560 #ifde‡
HAVE_LIBZ


562 
	mZLIB_UNINIT
,

563 
	mZLIB_INIT
,

564 
	mZLIB_GZIP_HEADER
,

565 
	mZLIB_GZIP_INFLATING
,

566 
	mZLIB_INIT_GZIP


567 } 
	tzlibInôSèã
;

570 #ifde‡
CURLRES_ASYNCH


571 
	sCuæ_async
 {

572 *
	mho°«me
;

573 
	mp‹t
;

574 
Cuæ_dns_íåy
 *
	mdns
;

575 
boﬁ
 
	md⁄e
;

576 
	m°©us
;

577 *
	mos_•ecific
;

581 
	#FIRSTSOCKET
 0

	)

582 
	#SECONDARYSOCKET
 1

	)

587 
	$CURLcode
 (*
	tCuæ_do_m‹e_func
)(
	tc⁄√˘d©a
 *, *);

588 
	$CURLcode
 (*
	tCuæ_d⁄e_func
)(
	tc⁄√˘d©a
 *, 
	tCURLcode
, 
	tboﬁ
);

590 
	eex≥˘100
 {

591 
EXP100_SEND_DATA
,

592 
EXP100_AWAITING_CONTINUE
,

593 
EXP100_SENDING_REQUEST
,

595 
EXP100_FAILED


598 
	eupgøde101
 {

599 
UPGR101_INIT
,

600 
UPGR101_REQUESTED
,

601 
UPGR101_RECEIVED
,

602 
UPGR101_WORKING


605 
	e√gŸüã≈n
 {

606 
NPN_INIT
,

607 
NPN_HTTP1_1
,

608 
NPN_HTTP2


618 
	sSögÀReque°
 {

619 
cuæ_off_t
 
size
;

620 
cuæ_off_t
 *
byãcou¡p
;

622 
cuæ_off_t
 
maxdow∆ﬂd
;

624 
cuæ_off_t
 *
wrôebyãcou¡p
;

626 
cuæ_off_t
 
byãcou¡
;

627 
cuæ_off_t
 
wrôebyãcou¡
;

629 
hódîbyãcou¡
;

630 
dedu˘hódîcou¡
;

636 
timevÆ
 
°¨t
;

637 
timevÆ
 
now
;

638 
boﬁ
 
hódî
;

640 
HEADER_NORMAL
,

641 
HEADER_PARTHEADER
,

643 
HEADER_ALLBAD


644 } 
badhódî
;

646 
hódîlöe
;

648 *
hbuÂ
;

649 
size_t
 
hbuÊí
;

650 *
°r
;

651 *
°r_°¨t
;

652 *
íd_±r
;

653 *
p
;

654 
boﬁ
 
c⁄ã¡_ønge
;

655 
cuæ_off_t
 
off£t
;

657 
hâpcode
;

659 
timevÆ
 
°¨t100
;

660 
ex≥˘100
 
exp100
;

661 
upgøde101
 
upgr101
;

663 
auto_decodög
;

665 
	#IDENTITY
 0

	)

666 
	#DEFLATE
 1

	)

667 
	#GZIP
 2

	)

668 
	#COMPRESS
 3

	)

670 #ifde‡
HAVE_LIBZ


671 
zlibInôSèã
 
zlib_öô
;

673 
z_°ªam
 
z
;

676 
time_t
 
timeofdoc
;

677 
bodywrôes
;

679 *
buf
;

680 *
u∂ﬂdbuf
;

681 
cuæ_sockë_t
 
maxfd
;

683 
kìp⁄
;

685 
boﬁ
 
u∂ﬂd_d⁄e
;

688 
boﬁ
 
ign‹ebody
;

689 
boﬁ
 
ign‹e˛
;

692 *
loˇti⁄
;

694 *
√wuæ
;

699 
ssize_t
 
u∂ﬂd_¥e£¡
;

705 *
u∂ﬂd_‰omhîe
;

707 
boﬁ
 
chunk
;

708 
boﬁ
 
u∂ﬂd_chunky
;

710 
boﬁ
 
gëhódî
;

712 
boﬁ
 
f‹bidchunk
;

716 *
¥Ÿ›
;

724 
	sCuæ_h™dÀr
 {

725 c⁄° * 
scheme
;

728 
	`CURLcode
 (*
£tup_c⁄√˘i⁄
)(
c⁄√˘d©a
 *);

731 
	`CURLcode
 (*
do_ô
)(
c⁄√˘d©a
 *, 
boﬁ
 *
d⁄e
);

732 
Cuæ_d⁄e_func
 
d⁄e
;

738 
Cuæ_do_m‹e_func
 
do_m‹e
;

746 
	`CURLcode
 (*
c⁄√˘_ô
)(
c⁄√˘d©a
 *, 
boﬁ
 *
d⁄e
);

749 
	`CURLcode
 (*
c⁄√˘ög
)(
c⁄√˘d©a
 *, 
boﬁ
 *
d⁄e
);

750 
	`CURLcode
 (*
doög
)(
c⁄√˘d©a
 *, 
boﬁ
 *
d⁄e
);

754 (*
¥Ÿo_gësock
)(
c⁄√˘d©a
 *
c⁄n
,

755 
cuæ_sockë_t
 *
socks
,

756 
numsocks
);

760 (*
doög_gësock
)(
c⁄√˘d©a
 *
c⁄n
,

761 
cuæ_sockë_t
 *
socks
,

762 
numsocks
);

766 (*
dom‹e_gësock
)(
c⁄√˘d©a
 *
c⁄n
,

767 
cuæ_sockë_t
 *
socks
,

768 
numsocks
);

773 (*
≥rf‹m_gësock
)(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

774 
cuæ_sockë_t
 *
socks
,

775 
numsocks
);

782 
	`CURLcode
 (*
disc⁄√˘
)(
c⁄√˘d©a
 *, 
boﬁ
 
dód_c⁄√˘i⁄
);

786 
	`CURLcode
 (*
ªadwrôe
)(
Sessi⁄H™dÀ
 *
d©a
, 
c⁄√˘d©a
 *
c⁄n
,

787 
ssize_t
 *
ƒód
, 
boﬁ
 *
ªadm‹e
);

789 
deÂ‹t
;

790 
¥Ÿocﬁ
;

792 
Êags
;

795 
	#PROTOPT_NONE
 0

	)

796 
	#PROTOPT_SSL
 (1<<0Ë

	)

797 
	#PROTOPT_DUAL
 (1<<1Ë

	)

798 
	#PROTOPT_CLOSEACTION
 (1<<2Ë

	)

803 
	#PROTOPT_DIRLOCK
 (1<<3)

	)

804 
	#PROTOPT_NONETWORK
 (1<<4Ë

	)

805 
	#PROTOPT_NEEDSPWD
 (1<<5Ë

	)

807 
	#PROTOPT_NOURLQUERY
 (1<<6Ë

	)

809 
	#PROTOPT_CREDSPERREQUEST
 (1<<7Ë

	)

814 
	$ssize_t
 (
	tCuæ_£nd
)(
	tc⁄√˘d©a
 *
	tc⁄n
,

815 
	tsocködex
,

816 c⁄° *
	tbuf
,

817 
	tsize_t
 
	tÀn
,

818 
	tCURLcode
 *
	tîr
);

821 
	$ssize_t
 (
	tCuæ_ªcv
)(
	tc⁄√˘d©a
 *
	tc⁄n
,

822 
	tsocködex
,

823 *
	tbuf
,

824 
	tsize_t
 
	tÀn
,

825 
	tCURLcode
 *
	tîr
);

831 
	sc⁄√˘d©a
 {

835 
Sessi⁄H™dÀ
 *
d©a
;

840 
Cuæ_chunkî
 
chunk
;

842 
cuæ_˛o£sockë_ˇŒback
 
f˛o£sockë
;

843 *
˛o£sockë_˛õ¡
;

845 
boﬁ
 
öu£
;

851 
c⁄√˘i⁄_id
;

858 
Cuæ_dns_íåy
 *
dns_íåy
;

863 
Cuæ_addröfo
 *
ù_addr
;

864 
Cuæ_addröfo
 *
ãm∑ddr
[2];

869 
ù_addr_°r
[
MAX_IPADR_LEN
];

871 
sc›e
;

873 
sockty≥
;

875 
ho°«me
 
ho°
;

876 
ho°«me
 
¥oxy
;

878 
p‹t
;

879 
ªmŸe_p‹t
;

888 
¥im¨y_ù
[
MAX_IPADR_LEN
];

889 
¥im¨y_p‹t
;

895 
loˇl_ù
[
MAX_IPADR_LEN
];

896 
loˇl_p‹t
;

898 *
u£r
;

899 *
∑sswd
;

900 *
›ti⁄s
;

902 *
xﬂuth2_bóªr
;

904 *
¥oxyu£r
;

905 *
¥oxy∑sswd
;

906 
cuæ_¥oxyty≥
 
¥oxyty≥
;

908 
hâpvîsi⁄
;

909 
π•vîsi⁄
;

911 
timevÆ
 
now
;

912 
timevÆ
 
¸óãd
;

913 
cuæ_sockë_t
 
sock
[2];

915 
cuæ_sockë_t
 
ãmpsock
[2];

916 
boﬁ
 
sock_ac˚±ed
[2];

918 
Cuæ_ªcv
 *
ªcv
[2];

919 
Cuæ_£nd
 *
£nd
[2];

921 
s¶_c⁄√˘_d©a
 
s¶
[2];

922 
s¶_c⁄fig_d©a
 
s¶_c⁄fig
;

924 
C⁄√˘Bôs
 
bôs
;

929 
timevÆ
 
c⁄√˘time
;

931 
num_addr
;

932 
timeoutms_≥r_addr
;

935 c⁄° 
Cuæ_h™dÀr
 *
h™dÀr
;

936 c⁄° 
Cuæ_h™dÀr
 *
giví
;

938 
ù_vîsi⁄
;

942 
cuæ_sockë_t
 
sockfd
;

943 
cuæ_sockë_t
 
wrôesockfd
;

949 
	sdy«miˇŒy_Æloˇãd_d©a
 {

950 *
¥oxyu£Ωwd
;

951 *
uagít
;

952 *
ac˚±_ícodög
;

953 *
u£Ωwd
;

954 *
øngñöe
;

955 *
ªf
;

956 *
ho°
;

957 *
cookõho°
;

958 *
π•_å™•‹t
;

959 *
ã
;

960 } 
Ælo˝å
;

962 
£c_com∂ëe
;

963 #ifde‡
HAVE_GSSAPI


964 
¥Ÿe˘i⁄_Àvñ
 
comm™d_¥Ÿ
;

965 
¥Ÿe˘i⁄_Àvñ
 
d©a_¥Ÿ
;

966 
¥Ÿe˘i⁄_Àvñ
 
ªque°_d©a_¥Ÿ
;

967 
size_t
 
buf„r_size
;

968 
krb5buf„r
 
ö_buf„r
;

969 *
≠p_d©a
;

970 c⁄° 
Cuæ_£c_˛õ¡_mech
 *
mech
;

971 
sockaddr_ö
 
loˇl_addr
;

978 
boﬁ
 
ªadch™√l_öu£
;

980 
boﬁ
 
wrôech™√l_öu£
;

982 
cuæ_Œi°
 *
£nd_pùe
;

984 
cuæ_Œi°
 *
ªcv_pùe
;

986 * 
ma°î_buf„r
;

988 
size_t
 
ªad_pos
;

989 
size_t
 
buf_Àn
;

992 
cuæ_£ek_ˇŒback
 
£ek_func
;

993 *
£ek_˛õ¡
;

998 
cuæ_ªad_ˇŒback
 
‰ód_func
;

999 *
‰ód_ö
;

1001 
¡lmd©a
 
¡lm
;

1004 
¡lmd©a
 
¥oxy¡lm
;

1006 #i‡
	`deföed
(
USE_NTLM
Ë&& deföed(
NTLM_WB_ENABLED
)

1008 
cuæ_sockë_t
 
¡lm_auth_hÕr_sockë
;

1009 
pid_t
 
¡lm_auth_hÕr_pid
;

1010 * 
chÆÀnge_hódî
;

1011 * 
ª•⁄£_hódî
;

1014 
sy£º_buf
 [256];

1016 #ifde‡
CURLRES_ASYNCH


1018 
Cuæ_async
 
async
;

1022 *
åaûî
;

1023 
ålMax
;

1024 
ålPos
;

1027 
·p_c⁄n
 
·pc
;

1028 
hâp_c⁄n
 
hâpc
;

1029 
ssh_c⁄n
 
sshc
;

1030 
t·p_°©e_d©a
 *
t·pc
;

1031 
im≠_c⁄n
 
im≠c
;

1032 
p›3_c⁄n
 
p›3c
;

1033 
smç_c⁄n
 
smçc
;

1034 
π•_c⁄n
 
π•c
;

1035 *
gíîic
;

1036 } 
¥Ÿo
;

1038 
c£À˘_bôs
;

1039 
waôf‹
;

1041 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

1042 
socks5_gsßpi_í˘y≥
;

1045 
boﬁ
 
vîify≥î
;

1046 
boﬁ
 
vîifyho°
;

1053 *
loˇldev
;

1054 
loˇÕ‹t
;

1055 
loˇÕ‹å™ge
;

1059 
TUNNEL_INIT
,

1060 
TUNNEL_CONNECT
,

1061 
TUNNEL_COMPLETE


1062 } 
tu¬ñ_°©e
[2];

1063 
c⁄√˘bundÀ
 *
bundÀ
;

1065 
√gŸüã≈n
 
√g≈n
;

1073 
	sPuªInfo
 {

1074 
hâpcode
;

1075 
hâµroxycode
;

1076 
hâpvîsi⁄
;

1077 
fûëime
;

1081 
boﬁ
 
timec⁄d
;

1083 
hódî_size
;

1084 
ªque°_size
;

1085 
¥oxyauthavaû
;

1086 
hâ∑uthavaû
;

1087 
numc⁄√˘s
;

1088 *
c⁄ã¡ty≥
;

1089 *
wouldªdúe˘
;

1099 
c⁄n_¥im¨y_ù
[
MAX_IPADR_LEN
];

1100 
c⁄n_¥im¨y_p‹t
;

1102 
c⁄n_loˇl_ù
[
MAX_IPADR_LEN
];

1103 
c⁄n_loˇl_p‹t
;

1105 
cuæ_˚πöfo
 
˚πs
;

1111 
	sProgªss
 {

1112 
œ°show
;

1114 
cuæ_off_t
 
size_dl
;

1115 
cuæ_off_t
 
size_ul
;

1116 
cuæ_off_t
 
dow∆ﬂded
;

1117 
cuæ_off_t
 
u∂ﬂded
;

1119 
cuæ_off_t
 
cuºít_•ìd
;

1121 
boﬁ
 
ˇŒback
;

1122 
width
;

1123 
Êags
;

1125 
time•ít
;

1127 
cuæ_off_t
 
dl•ìd
;

1128 
cuæ_off_t
 
ul•ìd
;

1130 
t_n¶ookup
;

1131 
t_c⁄√˘
;

1132 
t_≠pc⁄√˘
;

1133 
t_¥ëøns„r
;

1134 
t_°¨âøns„r
;

1135 
t_ªdúe˘
;

1137 
timevÆ
 
°¨t
;

1138 
timevÆ
 
t_°¨tsögÀ
;

1139 
timevÆ
 
t_°¨t›
;

1140 
timevÆ
 
t_ac˚±d©a
;

1141 
	#CURR_TIME
 (5+1Ë

	)

1143 
cuæ_off_t
 
•ìdî
[ 
CURR_TIME
 ];

1144 
timevÆ
 
•ìdî_time
[ 
CURR_TIME
 ];

1145 
•ìdî_c
;

1149 
HTTPREQ_NONE
,

1150 
HTTPREQ_GET
,

1151 
HTTPREQ_POST
,

1152 
HTTPREQ_POST_FORM
,

1153 
HTTPREQ_PUT
,

1154 
HTTPREQ_HEAD
,

1155 
HTTPREQ_CUSTOM
,

1156 
HTTPREQ_LAST


1157 } 
	tCuæ_HâpReq
;

1160 
RTSPREQ_NONE
,

1161 
RTSPREQ_OPTIONS
,

1162 
RTSPREQ_DESCRIBE
,

1163 
RTSPREQ_ANNOUNCE
,

1164 
RTSPREQ_SETUP
,

1165 
RTSPREQ_PLAY
,

1166 
RTSPREQ_PAUSE
,

1167 
RTSPREQ_TEARDOWN
,

1168 
RTSPREQ_GET_PARAMETER
,

1169 
RTSPREQ_SET_PARAMETER
,

1170 
RTSPREQ_RECORD
,

1171 
RTSPREQ_RECEIVE
,

1172 
RTSPREQ_LAST


1173 } 
	tCuæ_Rt•Req
;

1183 
	#MAX_CURL_USER_LENGTH
 256

	)

1184 
	#MAX_CURL_PASSWORD_LENGTH
 256

	)

1186 
	sauth
 {

1187 
w™t
;

1189 
picked
;

1190 
avaû
;

1192 
boﬁ
 
d⁄e
;

1194 
boﬁ
 
mu…i
;

1196 
boﬁ
 
õ°yÀ
;

1200 
	sUæSèã
 {

1203 
c⁄nˇche
 *
c⁄n_ˇche
;

1208 
boﬁ
 
mu…i_ow√d_by_ósy
;

1211 
timevÆ
 
kìps_•ìd
;

1213 
c⁄√˘d©a
 *
œ°c⁄√˘
;

1215 *
hódîbuff
;

1216 
size_t
 
hódîsize
;

1218 
buf„r
[
BUFSIZE
+1];

1219 
u∂ﬂdbuf„r
[
BUFSIZE
+1];

1220 
cuæ_off_t
 
cuºít_•ìd
;

1222 
boﬁ
 
this_is_a_fﬁlow
;

1224 *
fú°_ho°
;

1229 
cuæ_s¶_£ssi⁄
 *
£ssi⁄
;

1230 
£ssi⁄age
;

1231 *
ãmpwrôe
;

1233 
size_t
 
ãmpwrôesize
;

1234 
ãmpwrôëy≥
;

1236 *
s¸©ch
;

1237 
boﬁ
 
îr‹buf
;

1240 
os_î∫o
;

1241 #ifde‡
HAVE_SIGNAL


1243 (*
¥ev_sig«l
)(
sig
);

1245 
boﬁ
 
Ælow_p‹t
;

1247 
dige°d©a
 
dige°
;

1248 
dige°d©a
 
¥oxydige°
;

1250 #ifde‡
USE_HTTP_NEGOTIATE


1251 
√gŸüãd©a
 
√gŸüã
;

1252 
√gŸüãd©a
 
¥oxy√g
;

1255 
auth
 
authho°
;

1256 
auth
 
auth¥oxy
;

1258 
boﬁ
 
auth¥obÀm
;

1260 *
ªsﬁvî
;

1263 #i‡
	`deföed
(
USE_SSLEAY
Ë&& deföed(
HAVE_OPENSSL_ENGINE_H
)

1264 
ENGINE
 *
ígöe
;

1266 
timevÆ
 
expúëime
;

1267 
Cuæ_åì
 
timíode
;

1268 
cuæ_Œi°
 *
timeouéi°
;

1271 *
mo°_ª˚¡_·p_íåy∑th
;

1274 
boﬁ
 
·p_åyög_Æã∫©ive
;

1276 
hâpvîsi⁄
;

1278 
boﬁ
 
ex≥˘100hódî
;

1280 
boﬁ
 
pùe_broke
;

1283 #i‡!
	`deföed
(
WIN32
Ë&& !deföed(
MSDOS
Ë&& !deföed(
__EMX__
) && \

1284 !
	`deföed
(
__SYMBIAN32__
)

1286 
	#CURL_DO_LINEEND_CONV


	)

1288 
boﬁ
 
¥ev_block_had_åaûög_¸
;

1290 
cuæ_off_t
 
¸lf_c⁄vîsi⁄s
;

1292 *
∑thbuf„r
;

1293 *
∑th
;

1295 
boﬁ
 
¶ash_ªmoved
;

1297 
boﬁ
 
u£_ønge
;

1298 
boﬁ
 
ønge°rögÆloc
;

1300 *
ønge
;

1302 
cuæ_off_t
 
ªsume_‰om
;

1305 
π•_√xt_˛õ¡_CSeq
;

1306 
π•_√xt_£rvî_CSeq
;

1307 
π•_CSeq_ªcv
;

1310 
boﬁ
 
s¶_c⁄√˘_ªåy
;

1311 
cuæ_off_t
 
öfûesize
;

1323 
	sDy«micSètic
 {

1324 *
uæ
;

1325 
boﬁ
 
uæ_Æloc
;

1326 *
ª„ªr
;

1327 
boﬁ
 
ª„ªr_Æloc
;

1328 
cuæ_¶i°
 *
cookõli°
;

1330 
cuæ_¶i°
 *
ªsﬁve
;

1343 
Cuæ_mu…i
;

1345 
	edup°rög
 {

1346 
STRING_CERT
,

1347 
STRING_CERT_TYPE
,

1348 
STRING_COOKIE
,

1349 
STRING_COOKIEJAR
,

1350 
STRING_CUSTOMREQUEST
,

1351 
STRING_DEVICE
,

1352 
STRING_ENCODING
,

1353 
STRING_FTP_ACCOUNT
,

1354 
STRING_FTP_ALTERNATIVE_TO_USER
,

1355 
STRING_FTPPORT
,

1356 
STRING_KEY
,

1357 
STRING_KEY_PASSWD
,

1358 
STRING_KEY_TYPE
,

1359 
STRING_KRB_LEVEL
,

1360 
STRING_NETRC_FILE
,

1362 
STRING_COPYPOSTFIELDS
,

1363 
STRING_PROXY
,

1364 
STRING_SET_RANGE
,

1365 
STRING_SET_REFERER
,

1366 
STRING_SET_URL
,

1367 
STRING_SSL_CAPATH
,

1368 
STRING_SSL_CAFILE
,

1369 
STRING_SSL_CIPHER_LIST
,

1370 
STRING_SSL_EGDSOCKET
,

1371 
STRING_SSL_RANDOM_FILE
,

1372 
STRING_USERAGENT
,

1373 
STRING_SSL_CRLFILE
,

1374 
STRING_SSL_ISSUERCERT
,

1375 
STRING_USERNAME
,

1376 
STRING_PASSWORD
,

1377 
STRING_OPTIONS
,

1378 
STRING_PROXYUSERNAME
,

1379 
STRING_PROXYPASSWORD
,

1380 
STRING_NOPROXY
,

1382 
STRING_RTSP_SESSION_ID
,

1383 
STRING_RTSP_STREAM_URI
,

1384 
STRING_RTSP_TRANSPORT
,

1385 #ifde‡
USE_LIBSSH2


1386 
STRING_SSH_PRIVATE_KEY
,

1387 
STRING_SSH_PUBLIC_KEY
,

1388 
STRING_SSH_HOST_PUBLIC_KEY_MD5
,

1389 
STRING_SSH_KNOWNHOSTS
,

1391 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

1392 
STRING_SOCKS5_GSSAPI_SERVICE
,

1394 
STRING_MAIL_FROM
,

1395 
STRING_MAIL_AUTH
,

1397 #ifde‡
USE_TLS_SRP


1398 
STRING_TLSAUTH_USERNAME
,

1399 
STRING_TLSAUTH_PASSWORD
,

1402 
STRING_BEARER
,

1405 
STRING_LAST


1408 
	sU£rDeföed
 {

1409 
FILE
 *
îr
;

1410 *
debugd©a
;

1411 *
îr‹buf„r
;

1412 
¥oxyp‹t
;

1415 *
out
;

1416 *
ö
;

1417 *
wrôehódî
;

1418 *
πp_out
;

1419 
u£_p‹t
;

1420 
hâ∑uth
;

1421 
¥oxyauth
;

1422 
fﬁlowloˇti⁄
;

1423 
maxªdús
;

1426 
kìp_po°
;

1428 
boﬁ
 
‰ì_ª„ªr
;

1430 *
po°fõlds
;

1431 
cuæ_£ek_ˇŒback
 
£ek_func
;

1432 
cuæ_off_t
 
po°fõldsize
;

1435 
loˇÕ‹t
;

1436 
loˇÕ‹å™ge
;

1438 
cuæ_wrôe_ˇŒback
 
fwrôe_func
;

1439 
cuæ_wrôe_ˇŒback
 
fwrôe_hódî
;

1440 
cuæ_wrôe_ˇŒback
 
fwrôe_πp
;

1441 
cuæ_ªad_ˇŒback
 
‰ód_func
;

1442 
is_‰ód_£t
;

1443 
is_fwrôe_£t
;

1444 
cuæ_¥ogªss_ˇŒback
 
Ârogªss
;

1445 
cuæ_x„röfo_ˇŒback
 
fx„röfo
;

1446 
cuæ_debug_ˇŒback
 
fdebug
;

1447 
cuæ_io˘l_ˇŒback
 
io˘l_func
;

1448 
cuæ_sock›t_ˇŒback
 
fsock›t
;

1449 *
sock›t_˛õ¡
;

1450 
cuæ_›ísockë_ˇŒback
 
f›ísockë
;

1453 * 
›ísockë_˛õ¡
;

1454 
cuæ_˛o£sockë_ˇŒback
 
f˛o£sockë
;

1456 * 
˛o£sockë_˛õ¡
;

1458 *
£ek_˛õ¡
;

1461 
cuæ_c⁄v_ˇŒback
 
c⁄v‰om√tw‹k
;

1463 
cuæ_c⁄v_ˇŒback
 
c⁄vt⁄ëw‹k
;

1465 
cuæ_c⁄v_ˇŒback
 
c⁄v‰omutf8
;

1467 *
¥ogªss_˛õ¡
;

1468 *
io˘l_˛õ¡
;

1469 
timeout
;

1470 
c⁄√˘timeout
;

1471 
ac˚±timeout
;

1472 
£rvî_ª•⁄£_timeout
;

1473 
t·p_blksize
 ;

1474 
cuæ_off_t
 
fûesize
;

1475 
low_•ìd_limô
;

1476 
low_•ìd_time
;

1477 
cuæ_off_t
 
max_£nd_•ìd
;

1478 
cuæ_off_t
 
max_ªcv_•ìd
;

1480 
cuæ_off_t
 
£t_ªsume_‰om
;

1481 
cuæ_¶i°
 *
hódîs
;

1482 
cuæ_¶i°
 *
¥oxyhódîs
;

1483 
cuæ_hâµo°
 *
hâµo°
;

1484 
boﬁ
 
£p_hódîs
;

1485 
boﬁ
 
cookõ£ssi⁄
;

1486 
boﬁ
 
¸lf
;

1487 
cuæ_¶i°
 *
quŸe
;

1488 
cuæ_¶i°
 *
po°quŸe
;

1489 
cuæ_¶i°
 *
¥equŸe
;

1490 
cuæ_¶i°
 *
sour˚_quŸe
;

1491 
cuæ_¶i°
 *
sour˚_¥equŸe
;

1493 
cuæ_¶i°
 *
sour˚_po°quŸe
;

1495 
cuæ_¶i°
 *
ã ë_›ti⁄s
;

1496 
cuæ_¶i°
 *
ªsﬁve
;

1498 
cuæ_TimeC⁄d
 
timec⁄dôi⁄
;

1499 
time_t
 
timevÆue
;

1500 
Cuæ_HâpReq
 
hâ¥eq
;

1501 
hâpvîsi⁄
;

1503 
s¶_c⁄fig_d©a
 
s¶
;

1504 
cuæ_¥oxyty≥
 
¥oxyty≥
;

1505 
dns_ˇche_timeout
;

1506 
buf„r_size
;

1507 *
¥iv©e_d©a
;

1509 
cuæ_¶i°
 *
hâp200Æü£s
;

1511 
ùvî
;

1514 
cuæ_off_t
 
max_fûesize
;

1516 
cuæ_·pfûe
 
·p_fûemëhod
;

1518 
·p_¸óã_missög_dús
;

1522 
cuæ_sshkeyˇŒback
 
ssh_keyfunc
;

1523 *
ssh_keyfunc_u£Ω
;

1529 
boﬁ
 
¥ötho°
;

1530 
boﬁ
 
gë_fûëime
;

1531 
boﬁ
 
tu¬ñ_thru_hâµroxy
;

1532 
boﬁ
 
¥e„r_ascii
;

1533 
boﬁ
 
·p_≠≥nd
;

1534 
boﬁ
 
·p_li°_⁄ly
;

1535 
boﬁ
 
·p_u£_p‹t
;

1536 
boﬁ
 
hide_¥ogªss
;

1537 
boﬁ
 
hâp_Áû_⁄_îr‹
;

1538 
boﬁ
 
hâp_fﬁlow_loˇti⁄
;

1539 
boﬁ
 
hâp_å™s„r_ícodög
;

1540 
boﬁ
 
hâp_dißbÀ_ho°«me_check_bef‹e_authítiˇti⁄
;

1541 
boﬁ
 
ö˛ude_hódî
;

1542 
boﬁ
 
hâp_£t_ª„ªr
;

1543 
boﬁ
 
hâp_auto_ª„ªr
;

1544 
boﬁ
 
›t_no_body
;

1545 
boﬁ
 
£t_p‹t
;

1546 
boﬁ
 
u∂ﬂd
;

1547 
CURL_NETRC_OPTION


1548 
u£_√åc
;

1549 
boﬁ
 
vîbo£
;

1550 
boﬁ
 
krb
;

1551 
boﬁ
 
ªu£_f‹bid
;

1552 
boﬁ
 
ªu£_‰esh
;

1553 
boﬁ
 
·p_u£_ïsv
;

1554 
boﬁ
 
·p_u£_ïπ
;

1555 
boﬁ
 
·p_u£_¥ë
;

1557 
cuæ_u£s¶
 
u£_s¶
;

1559 
cuæ_·∑uth
 
·ps¶auth
;

1560 
cuæ_·pccc
 
·p_ccc
;

1561 
boﬁ
 
no_sig«l
;

1562 
boﬁ
 
globÆ_dns_ˇche
;

1563 
boﬁ
 
t˝_nodñay
;

1564 
boﬁ
 
ign‹e˛
;

1565 
boﬁ
 
·p_skù_ù
;

1567 
boﬁ
 
c⁄√˘_⁄ly
;

1568 
boﬁ
 
s¶_íabÀ_bó°
;

1570 
ssh_auth_ty≥s
;

1571 
boﬁ
 
hâp_ã_skù
;

1573 
boﬁ
 
hâp_˚_skù
;

1575 
√w_fûe_≥rms
;

1576 
√w_dúe˘‹y_≥rms
;

1577 
boﬁ
 
¥oxy_å™s„r_mode
;

1579 *
°r
[
STRING_LAST
];

1580 
sc›e
;

1581 
Ælowed_¥Ÿocﬁs
;

1582 
ªdú_¥Ÿocﬁs
;

1583 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

1584 
socks5_gsßpi_√c
;

1586 
cuæ_¶i°
 *
maû_r˝t
;

1587 
boﬁ
 
ß¶_ú
;

1589 
Cuæ_Rt•Req
 
π•ªq
;

1590 
π•vîsi⁄
;

1591 
boﬁ
 
wûdˇrdm©ch
;

1592 
cuæ_chunk_bgn_ˇŒback
 
chunk_bgn
;

1594 
cuæ_chunk_íd_ˇŒback
 
chunk_íd
;

1596 
cuæ_‚m©ch_ˇŒback
 
‚m©ch
;

1598 *
‚m©ch_d©a
;

1600 
gsßpi_dñeg©i⁄
;

1603 
boﬁ
 
t˝_kì∑live
;

1604 
t˝_kìpidÀ
;

1605 
t˝_kìpötvl
;

1607 
size_t
 
maxc⁄√˘s
;

1609 
boﬁ
 
s¶_íabÀ_≈n
;

1610 
boﬁ
 
s¶_íabÀ_Æ≤
;

1612 
ex≥˘_100_timeout
;

1615 
	sNames
 {

1616 
cuæ_hash
 *
ho°ˇche
;

1618 
HCACHE_NONE
,

1619 
HCACHE_GLOBAL
,

1620 
HCACHE_MULTI
,

1621 
HCACHE_SHARED


1622 } 
ho°ˇchëy≥
;

1635 
	sSessi⁄H™dÀ
 {

1637 
Sessi⁄H™dÀ
 *
√xt
;

1638 
Sessi⁄H™dÀ
 *
¥ev
;

1640 
c⁄√˘d©a
 *
ósy_c⁄n
;

1642 
CURLM°©e
 
m°©e
;

1643 
CURLcode
 
ªsu…
;

1645 
Cuæ_mesßge
 
msg
;

1651 
cuæ_sockë_t
 
sockës
[
MAX_SOCKSPEREASYHANDLE
];

1652 
numsocks
;

1654 
Names
 
dns
;

1655 
Cuæ_mu…i
 *
mu…i
;

1658 
Cuæ_mu…i
 *
mu…i_ósy
;

1661 
Cuæ_sh¨e
 *
sh¨e
;

1662 
SögÀReque°
 
ªq
;

1663 
U£rDeföed
 
£t
;

1664 
Dy«micSètic
 
ch™ge
;

1665 
CookõInfo
 *
cookõs
;

1669 
Progªss
 
¥ogªss
;

1670 
UæSèã
 
°©e
;

1672 
WûdˇrdD©a
 
wûdˇrd
;

1673 
PuªInfo
 
öfo
;

1674 
cuæ_és£ssi⁄öfo
 
tsi
;

1676 #i‡
	`deföed
(
CURL_DOES_CONVERSIONS
Ë&& deföed(
HAVE_ICONV
)

1677 
ic⁄v_t
 
outbound_cd
;

1678 
ic⁄v_t
 
öbound_cd
;

1679 
ic⁄v_t
 
utf8_cd
;

1681 
magic
;

1684 
	#LIBCURL_NAME
 "libcuæ"

	)

	@lib/version.c

23 
	~"cuæ_£tup.h
"

25 
	~<cuæ/cuæ.h
>

26 
	~"uæd©a.h
"

27 
	~"vés/vés.h
"

28 
	~"hâp2.h
"

30 
	#_MPRINTF_REPLACE


	)

31 
	~<cuæ/m¥ötf.h
>

33 #ifde‡
USE_ARES


34 #i‡
deföed
(
CURL_STATICLIB
Ë&& !deföed(
CARES_STATICLIB
) && \

35 (
deföed
(
WIN32
Ë|| deföed(
_WIN32
Ë|| 
	$deföed
(
__SYMBIAN32__
))

36 
	#CARES_STATICLIB


	)

38 
	~<¨es.h
>

41 #ifde‡
USE_LIBIDN


42 
	~<°rög¥ï.h
>

45 #i‡
	`deföed
(
HAVE_ICONV
Ë&& deföed(
CURL_DOES_CONVERSIONS
)

46 
	~<ic⁄v.h
>

49 #ifde‡
USE_LIBRTMP


50 
	~<libπmp/πmp.h
>

53 #ifde‡
USE_LIBSSH2


54 
	~<libssh2.h
>

57 #ifde‡
HAVE_LIBSSH2_VERSION


59 
	#CURL_LIBSSH2_VERSION
 
	`libssh2_vîsi⁄
(0)

	)

62 
	#CURL_LIBSSH2_VERSION
 
LIBSSH2_VERSION


	)

65 *
	$cuæ_vîsi⁄
()

67 
vîsi⁄
[200];

68 *
±r
 = 
vîsi⁄
;

69 
size_t
 
Àn
;

70 
size_t
 
À·
 = (
vîsi⁄
);

72 
	`°r˝y
(
±r
, 
LIBCURL_NAME
 "/" 
LIBCURL_VERSION
);

73 
Àn
 = 
	`°æí
(
±r
);

74 
À·
 -
Àn
;

75 
±r
 +
Àn
;

77 if(
À·
 > 1) {

78 
Àn
 = 
	`Cuæ_s¶_vîsi⁄
(
±r
 + 1, 
À·
 - 1);

80 if(
Àn
 > 0) {

81 *
±r
 = ' ';

82 
À·
 -++
Àn
;

83 
±r
 +
Àn
;

87 #ifde‡
HAVE_LIBZ


88 
Àn
 = 
	`¢¥ötf
(
±r
, 
À·
, " zlib/%s", 
	`zlibVîsi⁄
());

89 
À·
 -
Àn
;

90 
±r
 +
Àn
;

92 #ifde‡
USE_ARES


94 
Àn
 = 
	`¢¥ötf
(
±r
, 
À·
, " c-¨es/%s", 
	`¨es_vîsi⁄
(
NULL
));

95 
À·
 -
Àn
;

96 
±r
 +
Àn
;

98 #ifde‡
USE_LIBIDN


99 if(
	`°rög¥ï_check_vîsi⁄
(
LIBIDN_REQUIRED_VERSION
)) {

100 
Àn
 = 
	`¢¥ötf
(
±r
, 
À·
, "Üibidn/%s", 
	`°rög¥ï_check_vîsi⁄
(
NULL
));

101 
À·
 -
Àn
;

102 
±r
 +
Àn
;

105 #ifde‡
USE_WIN32_IDN


106 
Àn
 = 
	`¢¥ötf
(
±r
, 
À·
, " WinIDN");

107 
À·
 -
Àn
;

108 
±r
 +
Àn
;

110 #i‡
	`deföed
(
HAVE_ICONV
Ë&& deföed(
CURL_DOES_CONVERSIONS
)

111 #ifde‡
_LIBICONV_VERSION


112 
Àn
 = 
	`¢¥ötf
(
±r
, 
À·
, " iconv/%d.%d",

113 
_LIBICONV_VERSION
 >> 8, _LIBICONV_VERSION & 255);

116 
Àn
 = 
	`¢¥ötf
(
±r
, 
À·
, " iconv");

118 
À·
 -
Àn
;

119 
±r
 +
Àn
;

121 #ifde‡
USE_LIBSSH2


122 
Àn
 = 
	`¢¥ötf
(
±r
, 
À·
, "Üibssh2/%s", 
CURL_LIBSSH2_VERSION
);

123 
À·
 -
Àn
;

124 
±r
 +
Àn
;

126 #ifde‡
USE_NGHTTP2


127 
Àn
 = 
	`Cuæ_hâp2_vî
(
±r
, 
À·
);

128 
À·
 -
Àn
;

129 
±r
 +
Àn
;

131 #ifde‡
USE_LIBRTMP


133 
suff
[2];

134 if(
RTMP_LIB_VERSION
 & 0xff) {

135 
suff
[0] = (
RTMP_LIB_VERSION
 & 0xff) + 'a' - 1;

136 
suff
[1] = '\0';

139 
suff
[0] = '\0';

141 
	`¢¥ötf
(
±r
, 
À·
, "Üibrtmp/%d.%d%s",

142 
RTMP_LIB_VERSION
 >> 16, (RTMP_LIB_VERSION >> 8) & 0xff,

143 
suff
);

156  
vîsi⁄
;

157 
	}
}

165 c⁄° * c⁄° 
	g¥Ÿocﬁs
[] = {

166 #i‚de‡
CURL_DISABLE_DICT


169 #i‚de‡
CURL_DISABLE_FILE


172 #i‚de‡
CURL_DISABLE_FTP


175 #i‡
deföed
(
USE_SSL
Ë&& !deföed(
CURL_DISABLE_FTP
)

178 #i‚de‡
CURL_DISABLE_GOPHER


181 #i‚de‡
CURL_DISABLE_HTTP


184 #i‡
deföed
(
USE_SSL
Ë&& !deföed(
CURL_DISABLE_HTTP
)

187 #i‚de‡
CURL_DISABLE_IMAP


190 #i‡
deföed
(
USE_SSL
Ë&& !deföed(
CURL_DISABLE_IMAP
)

193 #i‚de‡
CURL_DISABLE_LDAP


195 #i‡!
deföed
(
CURL_DISABLE_LDAPS
) && \

196 ((
deföed
(
USE_OPENLDAP
Ë&& deföed(
USE_SSL
)) || \

197 (!
deföed
(
USE_OPENLDAP
Ë&& deföed(
HAVE_LDAP_SSL
)))

201 #i‚de‡
CURL_DISABLE_POP3


204 #i‡
deföed
(
USE_SSL
Ë&& !deföed(
CURL_DISABLE_POP3
)

207 #ifde‡
USE_LIBRTMP


210 #i‚de‡
CURL_DISABLE_RTSP


213 #ifde‡
USE_LIBSSH2


216 #ifde‡
USE_LIBSSH2


219 #i‚de‡
CURL_DISABLE_SMTP


222 #i‡
deföed
(
USE_SSL
Ë&& !deföed(
CURL_DISABLE_SMTP
)

225 #i‚de‡
CURL_DISABLE_TELNET


228 #i‚de‡
CURL_DISABLE_TFTP


232 
NULL


235 
cuæ_vîsi⁄_öfo_d©a
 
	gvîsi⁄_öfo
 = {

236 
CURLVERSION_NOW
,

237 
LIBCURL_VERSION
,

238 
LIBCURL_VERSION_NUM
,

239 
OS
,

241 #ifde‡
ENABLE_IPV6


242 | 
CURL_VERSION_IPV6


244 #ifde‡
USE_SSL


245 | 
CURL_VERSION_SSL


247 #ifde‡
USE_NTLM


248 | 
CURL_VERSION_NTLM


250 #i‡
deföed
(
USE_NTLM
Ë&& deföed(
NTLM_WB_ENABLED
)

251 | 
CURL_VERSION_NTLM_WB


253 #ifde‡
USE_WINDOWS_SSPI


254 | 
CURL_VERSION_SSPI


256 #ifde‡
HAVE_LIBZ


257 | 
CURL_VERSION_LIBZ


259 #ifde‡
USE_HTTP_NEGOTIATE


260 | 
CURL_VERSION_GSSNEGOTIATE


262 #ifde‡
DEBUGBUILD


263 | 
CURL_VERSION_DEBUG


265 #ifde‡
CURLDEBUG


266 | 
CURL_VERSION_CURLDEBUG


268 #ifde‡
CURLRES_ASYNCH


269 | 
CURL_VERSION_ASYNCHDNS


271 #ifde‡
HAVE_SPNEGO


272 | 
CURL_VERSION_SPNEGO


274 #i‡(
CURL_SIZEOF_CURL_OFF_T
 > 4) && \

275 –(
SIZEOF_OFF_T
 > 4Ë|| 
deföed
(
USE_WIN32_LARGE_FILES
) )

276 | 
CURL_VERSION_LARGEFILE


278 #i‡
deföed
(
CURL_DOES_CONVERSIONS
)

279 | 
CURL_VERSION_CONV


281 #i‡
deföed
(
USE_TLS_SRP
)

282 | 
CURL_VERSION_TLSAUTH_SRP


284 #i‡
deföed
(
USE_NGHTTP2
)

285 | 
CURL_VERSION_HTTP2


288 
NULL
,

290 
NULL
,

291 
¥Ÿocﬁs
,

292 
NULL
,

294 
NULL
,

296 
NULL
,

299 
cuæ_vîsi⁄_öfo_d©a
 *
	$cuæ_vîsi⁄_öfo
(
CURLvîsi⁄
 
°amp
)

301 #ifde‡
USE_LIBSSH2


302 
ssh_buf„r
[80];

305 #ifde‡
USE_SSL


306 
s¶_buf„r
[80];

307 
	`Cuæ_s¶_vîsi⁄
(
s¶_buf„r
, (ssl_buffer));

308 
vîsi⁄_öfo
.
s¶_vîsi⁄
 = 
s¶_buf„r
;

311 #ifde‡
HAVE_LIBZ


312 
vîsi⁄_öfo
.
libz_vîsi⁄
 = 
	`zlibVîsi⁄
();

315 #ifde‡
USE_ARES


317 
¨e¢um
;

318 
vîsi⁄_öfo
.
¨es
 = 
	`¨es_vîsi⁄
(&
¨e¢um
);

319 
vîsi⁄_öfo
.
¨es_num
 = 
¨e¢um
;

322 #ifde‡
USE_LIBIDN


325 
vîsi⁄_öfo
.
libidn
 = 
	`°rög¥ï_check_vîsi⁄
(
LIBIDN_REQUIRED_VERSION
);

326 if(
vîsi⁄_öfo
.
libidn
)

327 
vîsi⁄_öfo
.
„©uªs
 |
CURL_VERSION_IDN
;

328 #ñi‡
	`deföed
(
USE_WIN32_IDN
)

329 
vîsi⁄_öfo
.
„©uªs
 |
CURL_VERSION_IDN
;

332 #i‡
	`deföed
(
HAVE_ICONV
Ë&& deföed(
CURL_DOES_CONVERSIONS
)

333 #ifde‡
_LIBICONV_VERSION


334 
vîsi⁄_öfo
.
ic⁄v_vî_num
 = 
_LIBICONV_VERSION
;

337 
vîsi⁄_öfo
.
ic⁄v_vî_num
 = -1;

341 #ifde‡
USE_LIBSSH2


342 
	`¢¥ötf
(
ssh_buf„r
, (ssh_buf„r), "libssh2/%s", 
LIBSSH2_VERSION
);

343 
vîsi⁄_öfo
.
libssh_vîsi⁄
 = 
ssh_buf„r
;

346 ()
°amp
;

348  &
vîsi⁄_öfo
;

349 
	}
}

	@lib/vtls/axtls.c

29 
	~"cuæ_£tup.h
"

31 #ifde‡
USE_AXTLS


32 
	~<axTLS/s¶.h
>

33 
	~"axés.h
"

35 
	~"£ndf.h
"

36 
	~"öë_±⁄.h
"

37 
	~"vés.h
"

38 
	~"∑r£d©e.h
"

39 
	~"c⁄√˘.h
"

40 
	~"£À˘.h
"

41 
	#_MPRINTF_REPLACE


	)

42 
	~<cuæ/m¥ötf.h
>

43 
	~"cuæ_mem‹y.h
"

44 
	~<uni°d.h
>

46 
	~"memdebug.h
"

47 
	~"ho°check.h
"

51 
	$Cuæ_axés_öô
()

57 
	}
}

59 
	$Cuæ_axés_˛ónup
()

63 
	}
}

65 
CURLcode
 
	$m≠_îr‹_to_cuæ
(
axés_îr
)

67 
axés_îr
) {

68 
SSL_ERROR_NOT_SUPPORTED
:

69 
SSL_ERROR_INVALID_VERSION
:

71  
CURLE_UNSUPPORTED_PROTOCOL
;

73 
SSL_ERROR_NO_CIPHER
:

74  
CURLE_SSL_CIPHER
;

76 
SSL_ERROR_BAD_CERTIFICATE
:

77 
SSL_ERROR_NO_CERT_DEFINED
:

83  
CURLE_SSL_CERTPROBLEM
;

85 
	`SSL_X509_ERROR
(
X509_NOT_OK
):

86 
	`SSL_X509_ERROR
(
X509_VFY_ERROR_NO_TRUSTED_CERT
):

87 
	`SSL_X509_ERROR
(
X509_VFY_ERROR_BAD_SIGNATURE
):

88 
	`SSL_X509_ERROR
(
X509_VFY_ERROR_NOT_YET_VALID
):

89 
	`SSL_X509_ERROR
(
X509_VFY_ERROR_EXPIRED
):

90 
	`SSL_X509_ERROR
(
X509_VFY_ERROR_SELF_SIGNED
):

91 
	`SSL_X509_ERROR
(
X509_VFY_ERROR_INVALID_CHAIN
):

92 
	`SSL_X509_ERROR
(
X509_VFY_ERROR_UNSUPPORTED_DIGEST
):

93 
	`SSL_X509_ERROR
(
X509_INVALID_PRIV_KEY
):

94  
CURLE_PEER_FAILED_VERIFICATION
;

97  
CURLE_SSL_CACERT
;

100  
CURLE_REMOTE_ACCESS_DENIED
;

102 
SSL_ERROR_CONN_LOST
:

103 
SSL_ERROR_SOCK_SETUP_FAILURE
:

104 
SSL_ERROR_INVALID_HANDSHAKE
:

105 
SSL_ERROR_INVALID_PROT_MSG
:

106 
SSL_ERROR_INVALID_HMAC
:

107 
SSL_ERROR_INVALID_SESSION
:

108 
SSL_ERROR_INVALID_KEY
:

109 
SSL_ERROR_FINISHED_INVALID
:

110 
SSL_ERROR_NO_CLIENT_RENOG
:

112  
CURLE_SSL_CONNECT_ERROR
;

115 
	}
}

117 
Cuæ_ªcv
 
	gaxés_ªcv
;

118 
Cuæ_£nd
 
	gaxés_£nd
;

120 
	$‰ì_s¶_°ru˘s
(
s¶_c⁄√˘_d©a
 *
c⁄ns¶
)

122 if(
c⁄ns¶
->
s¶
) {

123 
	`s¶_‰ì
 (
c⁄ns¶
->
s¶
);

124 
c⁄ns¶
->
s¶
 = 
NULL
;

126 if(
c⁄ns¶
->
s¶_˘x
) {

127 
	`s¶_˘x_‰ì
(
c⁄ns¶
->
s¶_˘x
);

128 
c⁄ns¶
->
s¶_˘x
 = 
NULL
;

130 
	}
}

137 
CURLcode
 
	$c⁄√˘_¥ï
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

139 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

140 
SSL_CTX
 *
s¶_˘x
;

141 
SSL
 *
s¶
 = 
NULL
;

142 
˚π_ty≥s
[] = {
SSL_OBJ_X509_CERT
, 
SSL_OBJ_PKCS12
, 0};

143 
key_ty≥s
[] = {
SSL_OBJ_RSA_KEY
, 
SSL_OBJ_PKCS8
, 
SSL_OBJ_PKCS12
, 0};

144 
i
, 
s¶_f˙_ªtu∫
;

145 c⁄° 
uöt8_t
 *
s¶_£ssi⁄id
;

146 
size_t
 
s¶_idsize
;

151 
uöt32_t
 
˛õ¡_›ti⁄
 = 
SSL_NO_DEFAULT_KEY
 |

152 
SSL_SERVER_VERIFY_LATER
 |

153 
SSL_CONNECT_IN_PARTS
;

155 if(
c⁄n
->
s¶
[
socködex
].
°©e
 =
s¶_c⁄√˘i⁄_com∂ëe
)

158  
CURLE_OK
;

162 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

163 
CURL_SSLVERSION_DEFAULT
:

164 
CURL_SSLVERSION_TLSv1
:

167 
	`Áûf
(
d©a
, "axTLS only supports TLS 1.0ánd 1.1, "

169  
CURLE_SSL_CONNECT_ERROR
;

172 #ifde‡ 
AXTLSDEBUG


173 
˛õ¡_›ti⁄
 |
SSL_DISPLAY_STATES
 | 
SSL_DISPLAY_RSA
 | 
SSL_DISPLAY_CERTS
;

177 
s¶_˘x
 = 
	`s¶_˘x_√w
(
˛õ¡_›ti⁄
, 
SSL_DEFAULT_CLNT_SESS
);

178 if(
s¶_˘x
 =
NULL
) {

179 
	`Áûf
(
d©a
, "unableÅo create client SSL context");

180  
CURLE_SSL_CONNECT_ERROR
;

183 
c⁄n
->
s¶
[
socködex
].
s¶_˘x
 = ssl_ctx;

184 
c⁄n
->
s¶
[
socködex
].s¶ = 
NULL
;

187 if(
d©a
->
£t
.
s¶
.
CAfûe
) {

188 if(
	`s¶_obj_lﬂd
(
s¶_˘x
, 
SSL_OBJ_X509_CACERT
, 
d©a
->
£t
.
s¶
.
CAfûe
, 
NULL
)

189 !
SSL_OK
) {

190 
	`öfof
(
d©a
, "errorÑeading ca cert file %s \n",

191 
d©a
->
£t
.
s¶
.
CAfûe
);

192 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

193  
CURLE_SSL_CACERT_BADFILE
;

197 
	`öfof
(
d©a
, "found cîtifiˇã†ö %s\n", d©a->
£t
.
s¶
.
CAfûe
);

209 if(
d©a
->
£t
.
°r
[
STRING_CERT
]) {

210 
i
=0;

212 
˚π_ty≥s
[
i
] != 0) {

213 
s¶_f˙_ªtu∫
 = 
	`s¶_obj_lﬂd
(
s¶_˘x
, 
˚π_ty≥s
[
i
],

214 
d©a
->
£t
.
°r
[
STRING_CERT
], 
NULL
);

215 if(
s¶_f˙_ªtu∫
 =
SSL_OK
) {

216 
	`öfof
(
d©a
, "successfullyÑead cert file %s \n",

217 
d©a
->
£t
.
°r
[
STRING_CERT
]);

220 
i
++;

223 if(
˚π_ty≥s
[
i
] == 0) {

224 
	`Áûf
(
d©a
, "%s isÇot x509 orÖkcs12 format",

225 
d©a
->
£t
.
°r
[
STRING_CERT
]);

226  
CURLE_SSL_CERTPROBLEM
;

233 if(
d©a
->
£t
.
°r
[
STRING_KEY
] && 
˚π_ty≥s
[
i
] !
SSL_OBJ_PKCS12
) {

234 
i
=0;

236 
key_ty≥s
[
i
] != 0) {

237 
s¶_f˙_ªtu∫
 = 
	`s¶_obj_lﬂd
(
s¶_˘x
, 
key_ty≥s
[
i
],

238 
d©a
->
£t
.
°r
[
STRING_KEY
], 
NULL
);

239 if(
s¶_f˙_ªtu∫
 =
SSL_OK
) {

240 
	`öfof
(
d©a
, "successfullyÑead key file %s \n",

241 
d©a
->
£t
.
°r
[
STRING_KEY
]);

244 
i
++;

247 if(
key_ty≥s
[
i
] == 0) {

248 
	`Áûf
(
d©a
, "Failure: %s isÇotá supported key file",

249 
d©a
->
£t
.
°r
[
STRING_KEY
]);

250  
CURLE_SSL_CONNECT_ERROR
;

261 if(!
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, (**Ë&
s¶_£ssi⁄id
, &
s¶_idsize
)) {

263 
	`öfof
 (
d©a
, "SSLÑe-using session ID\n");

264 
s¶
 = 
	`s¶_˛õ¡_√w
(
s¶_˘x
, 
c⁄n
->
sock
[
socködex
],

265 
s¶_£ssi⁄id
, (
uöt8_t
)
s¶_idsize
);

268 
s¶
 = 
	`s¶_˛õ¡_√w
(
s¶_˘x
, 
c⁄n
->
sock
[
socködex
], 
NULL
, 0);

270 
c⁄n
->
s¶
[
socködex
].ssl = ssl;

271  
CURLE_OK
;

272 
	}
}

278 
CURLcode
 
	$c⁄√˘_föish
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

280 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

281 
SSL
 *
s¶
 = 
c⁄n
->s¶[
socködex
].ssl;

282 c⁄° 
uöt8_t
 *
s¶_£ssi⁄id
;

283 
size_t
 
s¶_idsize
;

284 c⁄° *
≥î_CN
;

285 
uöt32_t
 
dns_Æäame_ödex
;

286 c⁄° *
dns_Æäame
;

287 
öt8_t
 
found_subje˘_Æt_«mes
 = 0;

288 
öt8_t
 
found_subje˘_Æt_«me_m©chög_c⁄n
 = 0;

295 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

296 if(
	`s¶_vîify_˚π
(
s¶
Ë!
SSL_OK
) {

297 
	`Cuæ_axés_˛o£
(
c⁄n
, 
socködex
);

298 
	`Áûf
(
d©a
, "server cert verify failed");

299  
CURLE_PEER_FAILED_VERIFICATION
;

303 
	`öfof
(
d©a
, "\t server certificate verification SKIPPED\n");

318 
dns_Æäame_ödex
 = 0; ; dns_altname_index++) {

319 
dns_Æäame
 = 
	`s¶_gë_˚π_subje˘_Æt_dn¢ame
(
s¶
, 
dns_Æäame_ödex
);

320 if(
dns_Æäame
 =
NULL
) {

323 
found_subje˘_Æt_«mes
 = 1;

325 
	`öfof
(
d©a
, "\tComparing subjectáltÇame DNS with hostname: %s <-> %s\n",

326 
dns_Æäame
, 
c⁄n
->
ho°
.
«me
);

327 if(
	`Cuæ_˚π_ho°check
(
dns_Æäame
, 
c⁄n
->
ho°
.
«me
)) {

328 
found_subje˘_Æt_«me_m©chög_c⁄n
 = 1;

334 if(
found_subje˘_Æt_«mes
 && !
found_subje˘_Æt_«me_m©chög_c⁄n
) {

335 if(
d©a
->
£t
.
s¶
.
vîifyho°
) {

337 
	`Cuæ_axés_˛o£
(
c⁄n
, 
socködex
);

338 
	`Áûf
(
d©a
, "\tsubjectAltName(s) doÇot match %s\n",

339 
c⁄n
->
ho°
.
di•«me
);

340  
CURLE_PEER_FAILED_VERIFICATION
;

343 
	`öfof
(
d©a
, "\tsubjectAltName(s) doÇot match %s\n",

344 
c⁄n
->
ho°
.
di•«me
);

346 if(
found_subje˘_Æt_«mes
 == 0) {

349 
≥î_CN
 = 
	`s¶_gë_˚π_dn
(
s¶
, 
SSL_X509_CERT_COMMON_NAME
);

350 if(
≥î_CN
 =
NULL
) {

351 if(
d©a
->
£t
.
s¶
.
vîifyho°
) {

352 
	`Cuæ_axés_˛o£
(
c⁄n
, 
socködex
);

353 
	`Áûf
(
d©a
, "unableÅo obtain commonÇame fromÖeer certificate");

354  
CURLE_PEER_FAILED_VERIFICATION
;

357 
	`öfof
(
d©a
, "unableÅo obtain commonÇame fromÖeer certificate");

360 if(!
	`Cuæ_˚π_ho°check
((c⁄° *)
≥î_CN
, 
c⁄n
->
ho°
.
«me
)) {

361 if(
d©a
->
£t
.
s¶
.
vîifyho°
) {

363 
	`Cuæ_axés_˛o£
(
c⁄n
, 
socködex
);

364 
	`Áûf
(
d©a
, "\tcommonÇame \"%s\" doesÇot match \"%s\"\n",

365 
≥î_CN
, 
c⁄n
->
ho°
.
di•«me
);

366  
CURLE_PEER_FAILED_VERIFICATION
;

369 
	`öfof
(
d©a
, "\tcommonÇame \"%s\" doesÇot match \"%s\"\n",

370 
≥î_CN
, 
c⁄n
->
ho°
.
di•«me
);

376 
c⁄n
->
s¶
[
socködex
].
°©e
 = 
s¶_c⁄√˘i⁄_com∂ëe
;

377 
c⁄n
->
ªcv
[
socködex
] = 
axés_ªcv
;

378 
c⁄n
->
£nd
[
socködex
] = 
axés_£nd
;

381 
s¶_idsize
 = 
	`s¶_gë_£ssi⁄_id_size
(
s¶
);

382 
s¶_£ssi⁄id
 = 
	`s¶_gë_£ssi⁄_id
(
s¶
);

383 if(
	`Cuæ_s¶_add£ssi⁄id
(
c⁄n
, (*Ë
s¶_£ssi⁄id
, 
s¶_idsize
)

384 !
CURLE_OK
)

385 
	`öfof
 (
d©a
, "failedÅoádd sessionÅo cache\n");

387  
CURLE_OK
;

388 
	}
}

394 
CURLcode
 
	$Cuæ_axés_c⁄√˘_n⁄blockög
(

395 
c⁄√˘d©a
 *
c⁄n
,

396 
socködex
,

397 
boﬁ
 *
d⁄e
)

399 
CURLcode
 
c⁄n_°ï
;

400 
s¶_f˙_ªtu∫
;

401 
i
;

403 *
d⁄e
 = 
FALSE
;

406 if(
c⁄n
->
s¶
[
socködex
].
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_1
) {

407 
c⁄n_°ï
 = 
	`c⁄√˘_¥ï
(
c⁄n
, 
socködex
);

408 if(
c⁄n_°ï
 !
CURLE_OK
) {

409 
	`Cuæ_axés_˛o£
(
c⁄n
, 
socködex
);

410  
c⁄n_°ï
;

412 
c⁄n
->
s¶
[
socködex
].
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2
;

415 if(
c⁄n
->
s¶
[
socködex
].
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2
) {

417 if(
	`s¶_h™dshake_°©us
(
c⁄n
->
s¶
[
socködex
].s¶Ë!
SSL_OK
) {

421 
i
=0; i<5; i++) {

422 
s¶_f˙_ªtu∫
 = 
	`s¶_ªad
(
c⁄n
->
s¶
[
socködex
].s¶, 
NULL
);

423 if(
s¶_f˙_ªtu∫
 < 0) {

424 
	`Cuæ_axés_˛o£
(
c⁄n
, 
socködex
);

425 
	`s¶_di•œy_îr‹
(
s¶_f˙_ªtu∫
);

426  
	`m≠_îr‹_to_cuæ
(
s¶_f˙_ªtu∫
);

428  
CURLE_OK
;

431 
	`öfof
 (
c⁄n
->
d©a
, "handshake completed successfully\n");

432 
c⁄n
->
s¶
[
socködex
].
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_3
;

435 if(
c⁄n
->
s¶
[
socködex
].
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_3
) {

436 
c⁄n_°ï
 = 
	`c⁄√˘_föish
(
c⁄n
, 
socködex
);

437 if(
c⁄n_°ï
 !
CURLE_OK
) {

438 
	`Cuæ_axés_˛o£
(
c⁄n
, 
socködex
);

439  
c⁄n_°ï
;

443 
c⁄n
->
s¶
[
socködex
].
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

445 *
d⁄e
 = 
TRUE
;

446  
CURLE_OK
;

450 
c⁄n
->
s¶
[
socködex
].
°©e
 = 
s¶_c⁄√˘i⁄_n⁄e
;

451 
c⁄n
->
s¶
[
socködex
].
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

453  
CURLE_BAD_FUNCTION_ARGUMENT
;

454 
	}
}

461 
CURLcode


462 
	$Cuæ_axés_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

463 
socködex
)

466 
CURLcode
 
c⁄n_°ï
 = 
	`c⁄√˘_¥ï
(
c⁄n
, 
socködex
);

467 
s¶_f˙_ªtu∫
;

468 
SSL
 *
s¶
 = 
c⁄n
->s¶[
socködex
].ssl;

470 if(
c⁄n_°ï
 !
CURLE_OK
) {

471 
	`Cuæ_axés_˛o£
(
c⁄n
, 
socködex
);

472  
c⁄n_°ï
;

476 
	`s¶_h™dshake_°©us
(
s¶
Ë!
SSL_OK
) {

477 
s¶_f˙_ªtu∫
 = 
	`s¶_ªad
(
s¶
, 
NULL
);

478 if(
s¶_f˙_ªtu∫
 < 0) {

479 
	`Cuæ_axés_˛o£
(
c⁄n
, 
socködex
);

480 
	`s¶_di•œy_îr‹
(
s¶_f˙_ªtu∫
);

481  
	`m≠_îr‹_to_cuæ
(
s¶_f˙_ªtu∫
);

483 
	`u¶ìp
(10000);

486 
	`öfof
 (
c⁄n
->
d©a
, "handshake completed successfully\n");

488 
c⁄n_°ï
 = 
	`c⁄√˘_föish
(
c⁄n
, 
socködex
);

489 if(
c⁄n_°ï
 !
CURLE_OK
) {

490 
	`Cuæ_axés_˛o£
(
c⁄n
, 
socködex
);

491  
c⁄n_°ï
;

494  
CURLE_OK
;

495 
	}
}

498 
ssize_t
 
	$axés_£nd
(
c⁄√˘d©a
 *
c⁄n
,

499 
socködex
,

500 c⁄° *
mem
,

501 
size_t
 
Àn
,

502 
CURLcode
 *
îr
)

505 
rc
 = 
	`s¶_wrôe
(
c⁄n
->
s¶
[
socködex
].s¶, 
mem
, ()
Àn
);

507 
	`öfof
(
c⁄n
->
d©a
, "áxtls_send\n");

509 if(
rc
 < 0 ) {

510 *
îr
 = 
	`m≠_îr‹_to_cuæ
(
rc
);

511 
rc
 = -1;

514 *
îr
 = 
CURLE_OK
;

515  
rc
;

516 
	}
}

518 
	$Cuæ_axés_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
)

520 ()
d©a
;

521 
	`öfof
(
d©a
, " Curl_axtls_close_all\n");

522 
	}
}

524 
	$Cuæ_axés_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

526 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

528 
	`öfof
(
c⁄n
->
d©a
, " Curl_axtls_close\n");

537 
	`‰ì_s¶_°ru˘s
(
c⁄ns¶
);

538 
	}
}

544 
	$Cuæ_axés_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

549 
ªtvÆ
 = 0;

550 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

551 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

552 
uöt8_t
 *
buf
;

553 
ssize_t
 
ƒód
;

555 
	`öfof
(
c⁄n
->
d©a
, " Curl_axtls_shutdown\n");

567 if(
c⁄ns¶
->
s¶
) {

568 
wh©
 = 
	`Cuæ_sockë_ªady
(
c⁄n
->
sock
[
socködex
],

569 
CURL_SOCKET_BAD
, 
SSL_SHUTDOWN_TIMEOUT
);

570 if(
wh©
 > 0) {

575 
ƒód
 = (
ssize_t
)
	`s¶_ªad
(
c⁄ns¶
->
s¶
, &
buf
);

577 if(
ƒód
 < 
SSL_OK
) {

578 
	`Áûf
(
d©a
, "closeÇotifyálertÇotÑeceived during shutdown");

579 
ªtvÆ
 = -1;

582 if(0 =
wh©
) {

584 
	`Áûf
(
d©a
, "SSL shutdownÅimeout");

588 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

589 
ªtvÆ
 = -1;

592 
	`‰ì_s¶_°ru˘s
(
c⁄ns¶
);

594  
ªtvÆ
;

595 
	}
}

597 
ssize_t
 
	$axés_ªcv
(
c⁄√˘d©a
 *
c⁄n
,

598 
num
,

599 *
buf
,

600 
size_t
 
buf„rsize
,

601 
CURLcode
 *
îr
)

603 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
num
];

604 
ssize_t
 
ªt
 = 0;

605 
uöt8_t
 *
ªad_buf
;

607 
	`öfof
(
c⁄n
->
d©a
, "áxtls_recv\n");

609 *
îr
 = 
CURLE_OK
;

610 if(
c⁄ns¶
) {

611 
ªt
 = 
	`s¶_ªad
(
c⁄ns¶
->
s¶
, &
ªad_buf
);

612 if(
ªt
 > 
SSL_OK
) {

615 
	`mem˝y
(
buf
, 
ªad_buf
,

616 (
size_t
)
ªt
 > 
buf„rsize
 ? buffersize : (size_t)ret);

618 if(
ªt
 =
SSL_OK
) {

620 *
îr
 = 
CURLE_AGAIN
;

621 
ªt
 = -1;

623 if(
ªt
 == -3) {

626 
	`Cuæ_axés_˛o£
(
c⁄n
, 
num
);

629 
	`Áûf
(
c⁄n
->
d©a
, "axTLSÑecvÉº‹ (%d)", 
ªt
);

630 *
îr
 = 
	`m≠_îr‹_to_cuæ
((Ë
ªt
);

631 
ªt
 = -1;

635  
ªt
;

636 
	}
}

644 
	$Cuæ_axés_check_cxn
(
c⁄√˘d©a
 *
c⁄n
)

650 
	`öfof
(
c⁄n
->
d©a
, " Curl_axtls_check_cxn\n");

652 
	}
}

654 
	$Cuæ_axés_£ssi⁄_‰ì
(*
±r
)

656 ()
±r
;

660 
	}
}

662 
size_t
 
	$Cuæ_axés_vîsi⁄
(*
buf„r
, 
size_t
 
size
)

664  
	`¢¥ötf
(
buf„r
, 
size
, "axTLS/%s", 
	`s¶_vîsi⁄
());

665 
	}
}

	@lib/vtls/axtls.h

1 #i‚de‡
HEADER_CURL_AXTLS_H


2 
	#HEADER_CURL_AXTLS_H


	)

26 #ifde‡
USE_AXTLS


27 
	~"cuæ/cuæ.h
"

28 
	~"uæd©a.h
"

30 
Cuæ_axés_öô
();

31 
Cuæ_axés_˛ónup
();

32 
CURLcode
 
Cuæ_axés_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

33 
CURLcode
 
Cuæ_axés_c⁄√˘_n⁄blockög
(

34 
c⁄√˘d©a
 *
c⁄n
,

35 
socködex
,

36 
boﬁ
 *
d⁄e
);

40 
Cuæ_axés_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
);

43 
Cuæ_axés_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

45 
Cuæ_axés_£ssi⁄_‰ì
(*
±r
);

46 
size_t
 
Cuæ_axés_vîsi⁄
(*
buf„r
, size_à
size
);

47 
Cuæ_axés_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

48 
Cuæ_axés_check_cxn
(
c⁄√˘d©a
 *
c⁄n
);

51 
	#cuæs¶_öô
 
Cuæ_axés_öô


	)

52 
	#cuæs¶_˛ónup
 
Cuæ_axés_˛ónup


	)

53 
	#cuæs¶_c⁄√˘
 
Cuæ_axés_c⁄√˘


	)

54 
	#cuæs¶_c⁄√˘_n⁄blockög
 
Cuæ_axés_c⁄√˘_n⁄blockög


	)

55 
	#cuæs¶_£ssi⁄_‰ì
(
x
Ë
	`Cuæ_axés_£ssi⁄_‰ì
(x)

	)

56 
	#cuæs¶_˛o£_Æl
 
Cuæ_axés_˛o£_Æl


	)

57 
	#cuæs¶_˛o£
 
Cuæ_axés_˛o£


	)

58 
	#cuæs¶_shutdown
(
x
,
y
Ë
	`Cuæ_axés_shutdown
(x,y)

	)

59 
	#cuæs¶_£t_ígöe
(
x
,
y
Ë(x=x, y=y, 
CURLE_NOT_BUILT_IN
)

	)

60 
	#cuæs¶_£t_ígöe_deÁu…
(
x
Ë(x=x, 
CURLE_NOT_BUILT_IN
)

	)

61 
	#cuæs¶_ígöes_li°
(
x
Ë(x=x, (
cuæ_¶i°
 *)
NULL
)

	)

62 
	#cuæs¶_vîsi⁄
 
Cuæ_axés_vîsi⁄


	)

63 
	#cuæs¶_check_cxn
(
x
Ë
	`Cuæ_axés_check_cxn
(x)

	)

64 
	#cuæs¶_d©a_≥ndög
(
x
,
y
Ë(x=x, y=y, 0)

	)

	@lib/vtls/curl_darwinssl.c

29 
	~"cuæ_£tup.h
"

31 
	~"uæd©a.h
"

32 
	~"cuæ_ba£64.h
"

34 #ifde‡
USE_DARWINSSL


36 #ifde‡
HAVE_LIMITS_H


37 
	~<limôs.h
>

40 
	~<Securôy/Securôy.h
>

41 
	~<Securôy/SecuªTøn•‹t.h
>

42 
	~<C‹eFound©i⁄/C‹eFound©i⁄.h
>

43 
	~<Comm⁄Cry±o/Comm⁄Dige°.h
>

51 #i‡(
TARGET_OS_MAC
 && !(
TARGET_OS_EMBEDDED
 || 
TARGET_OS_IPHONE
))

53 #i‡
MAC_OS_X_VERSION_MAX_ALLOWED
 < 1050

57 
	#CURL_BUILD_IOS
 0

	)

58 
	#CURL_BUILD_IOS_7
 0

	)

59 
	#CURL_BUILD_MAC
 1

	)

61 
	#CURL_BUILD_MAC_10_5
 
MAC_OS_X_VERSION_MAX_ALLOWED
 >1050

	)

62 
	#CURL_BUILD_MAC_10_6
 
MAC_OS_X_VERSION_MAX_ALLOWED
 >1060

	)

63 
	#CURL_BUILD_MAC_10_7
 
MAC_OS_X_VERSION_MAX_ALLOWED
 >1070

	)

64 
	#CURL_BUILD_MAC_10_8
 
MAC_OS_X_VERSION_MAX_ALLOWED
 >1080

	)

65 
	#CURL_BUILD_MAC_10_9
 
MAC_OS_X_VERSION_MAX_ALLOWED
 >1090

	)

70 
	#CURL_SUPPORT_MAC_10_5
 
MAC_OS_X_VERSION_MIN_REQUIRED
 <1050

	)

71 
	#CURL_SUPPORT_MAC_10_6
 
MAC_OS_X_VERSION_MIN_REQUIRED
 <1060

	)

72 
	#CURL_SUPPORT_MAC_10_7
 
MAC_OS_X_VERSION_MIN_REQUIRED
 <1070

	)

73 
	#CURL_SUPPORT_MAC_10_8
 
MAC_OS_X_VERSION_MIN_REQUIRED
 <1080

	)

74 
	#CURL_SUPPORT_MAC_10_9
 
MAC_OS_X_VERSION_MIN_REQUIRED
 <1090

	)

76 #ñi‡
TARGET_OS_EMBEDDED
 || 
TARGET_OS_IPHONE


77 
	#CURL_BUILD_IOS
 1

	)

78 
	#CURL_BUILD_IOS_7
 
__IPHONE_OS_VERSION_MAX_ALLOWED
 >70000

	)

79 
	#CURL_BUILD_MAC
 0

	)

80 
	#CURL_BUILD_MAC_10_5
 0

	)

81 
	#CURL_BUILD_MAC_10_6
 0

	)

82 
	#CURL_BUILD_MAC_10_7
 0

	)

83 
	#CURL_BUILD_MAC_10_8
 0

	)

84 
	#CURL_SUPPORT_MAC_10_5
 0

	)

85 
	#CURL_SUPPORT_MAC_10_6
 0

	)

86 
	#CURL_SUPPORT_MAC_10_7
 0

	)

87 
	#CURL_SUPPORT_MAC_10_8
 0

	)

93 #i‡
CURL_BUILD_MAC


94 
	~<sys/sys˘l.h
>

97 
	~"uæd©a.h
"

98 
	~"£ndf.h
"

99 
	~"öë_±⁄.h
"

100 
	~"c⁄√˘.h
"

101 
	~"£À˘.h
"

102 
	~"vés.h
"

103 
	~"cuæ_d¨wös¶.h
"

105 
	#_MPRINTF_REPLACE


	)

106 
	~<cuæ/m¥ötf.h
>

108 
	~"cuæ_mem‹y.h
"

110 
	~"memdebug.h
"

113 
	#ioEº
 -36

	)

114 
	#∑ømEº
 -50

	)

118 
OSSètus
 
	$SockëRód
(
SSLC⁄√˘i⁄Ref
 
c⁄√˘i⁄
,

119 *
d©a
,

122 
size_t
 *
d©aLígth
)

124 
size_t
 
byãsToGo
 = *
d©aLígth
;

125 
size_t
 
öôLí
 = 
byãsToGo
;

126 
UI¡8
 *
cuºD©a
 = (UI¡8 *)
d©a
;

128 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = (s¶_c⁄√˘_d©®*)
c⁄√˘i⁄
;

129 
sock
 = 
c⁄ns¶
->
s¶_sockfd
;

130 
OSSètus
 
πn
 = 
noEº
;

131 
size_t
 
byãsRód
;

132 
ssize_t
 
ºä
;

133 
theEº
;

135 *
d©aLígth
 = 0;

138 
byãsRód
 = 0;

139 
ºä
 = 
	`ªad
(
sock
, 
cuºD©a
, 
byãsToGo
);

140 if(
ºä
 <= 0) {

142 
theEº
 = 
î∫o
;

143 if(
ºä
 == 0) {

145 
πn
 = 
îrSSLClo£dGø˚ful
;

148 
theEº
) {

149 
ENOENT
:

151 
πn
 = 
îrSSLClo£dGø˚ful
;

153 
ECONNRESET
:

154 
πn
 = 
îrSSLClo£dAb‹t
;

156 
EAGAIN
:

157 
πn
 = 
îrSSLWouldBlock
;

158 
c⁄ns¶
->
s¶_dúe˘i⁄
 = 
Ál£
;

161 
πn
 = 
ioEº
;

167 
byãsRód
 = 
ºä
;

169 
byãsToGo
 -
byãsRód
;

170 
cuºD©a
 +
byãsRód
;

172 if(
byãsToGo
 == 0) {

177 *
d©aLígth
 = 
öôLí
 - 
byãsToGo
;

179  
πn
;

180 
	}
}

182 
OSSètus
 
	$SockëWrôe
(
SSLC⁄√˘i⁄Ref
 
c⁄√˘i⁄
,

183 c⁄° *
d©a
,

184 
size_t
 *
d©aLígth
)

186 
size_t
 
byãsSít
 = 0;

188 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = (s¶_c⁄√˘_d©®*)
c⁄√˘i⁄
;

189 
sock
 = 
c⁄ns¶
->
s¶_sockfd
;

190 
ssize_t
 
Àngth
;

191 
size_t
 
d©aLí
 = *
d©aLígth
;

192 c⁄° 
UI¡8
 *
d©aPå
 = (UI¡8 *)
d©a
;

193 
OSSètus
 
‹ä
;

194 
theEº
;

196 *
d©aLígth
 = 0;

199 
Àngth
 = 
	`wrôe
(
sock
,

200 (*)
d©aPå
 + 
byãsSít
,

201 
d©aLí
 - 
byãsSít
);

202 } (
Àngth
 > 0) &&

203 –(
byãsSít
 +
Àngth
Ë< 
d©aLí
) );

205 if(
Àngth
 <= 0) {

206 
theEº
 = 
î∫o
;

207 if(
theEº
 =
EAGAIN
) {

208 
‹ä
 = 
îrSSLWouldBlock
;

209 
c⁄ns¶
->
s¶_dúe˘i⁄
 = 
åue
;

212 
‹ä
 = 
ioEº
;

216 
‹ä
 = 
noEº
;

218 *
d©aLígth
 = 
byãsSít
;

219  
‹ä
;

220 
	}
}

222 
CF_INLINE
 c⁄° *
	$SSLCùhîNameF‹Numbî
(
SSLCùhîSuôe
 
cùhî
) {

223 
cùhî
) {

225 
SSL_RSA_WITH_NULL_MD5
:

228 
SSL_RSA_WITH_NULL_SHA
:

231 
SSL_RSA_EXPORT_WITH_RC4_40_MD5
:

234 
SSL_RSA_WITH_RC4_128_MD5
:

237 
SSL_RSA_WITH_RC4_128_SHA
:

240 
SSL_RSA_EXPORT_WITH_RC2_CBC_40_MD5
:

243 
SSL_RSA_WITH_IDEA_CBC_SHA
:

246 
SSL_RSA_EXPORT_WITH_DES40_CBC_SHA
:

249 
SSL_RSA_WITH_DES_CBC_SHA
:

252 
SSL_RSA_WITH_3DES_EDE_CBC_SHA
:

255 
SSL_DH_DSS_EXPORT_WITH_DES40_CBC_SHA
:

258 
SSL_DH_DSS_WITH_DES_CBC_SHA
:

261 
SSL_DH_DSS_WITH_3DES_EDE_CBC_SHA
:

264 
SSL_DH_RSA_EXPORT_WITH_DES40_CBC_SHA
:

267 
SSL_DH_RSA_WITH_DES_CBC_SHA
:

270 
SSL_DH_RSA_WITH_3DES_EDE_CBC_SHA
:

273 
SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA
:

276 
SSL_DHE_DSS_WITH_DES_CBC_SHA
:

279 
SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA
:

282 
SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA
:

285 
SSL_DHE_RSA_WITH_DES_CBC_SHA
:

288 
SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA
:

291 
SSL_DH_™⁄_EXPORT_WITH_RC4_40_MD5
:

294 
SSL_DH_™⁄_WITH_RC4_128_MD5
:

297 
SSL_DH_™⁄_EXPORT_WITH_DES40_CBC_SHA
:

300 
SSL_DH_™⁄_WITH_DES_CBC_SHA
:

303 
SSL_DH_™⁄_WITH_3DES_EDE_CBC_SHA
:

306 
SSL_FORTEZZA_DMS_WITH_NULL_SHA
:

309 
SSL_FORTEZZA_DMS_WITH_FORTEZZA_CBC_SHA
:

314 
TLS_RSA_WITH_AES_128_CBC_SHA
:

317 
TLS_DH_DSS_WITH_AES_128_CBC_SHA
:

320 
TLS_DH_RSA_WITH_AES_128_CBC_SHA
:

323 
TLS_DHE_DSS_WITH_AES_128_CBC_SHA
:

326 
TLS_DHE_RSA_WITH_AES_128_CBC_SHA
:

329 
TLS_DH_™⁄_WITH_AES_128_CBC_SHA
:

332 
TLS_RSA_WITH_AES_256_CBC_SHA
:

335 
TLS_DH_DSS_WITH_AES_256_CBC_SHA
:

338 
TLS_DH_RSA_WITH_AES_256_CBC_SHA
:

341 
TLS_DHE_DSS_WITH_AES_256_CBC_SHA
:

344 
TLS_DHE_RSA_WITH_AES_256_CBC_SHA
:

347 
TLS_DH_™⁄_WITH_AES_256_CBC_SHA
:

351 
SSL_RSA_WITH_RC2_CBC_MD5
:

354 
SSL_RSA_WITH_IDEA_CBC_MD5
:

357 
SSL_RSA_WITH_DES_CBC_MD5
:

360 
SSL_RSA_WITH_3DES_EDE_CBC_MD5
:

365 
	}
}

367 
CF_INLINE
 c⁄° *
	$TLSCùhîNameF‹Numbî
(
SSLCùhîSuôe
 
cùhî
) {

368 
cùhî
) {

370 
TLS_RSA_WITH_AES_128_CBC_SHA
:

373 
TLS_DH_DSS_WITH_AES_128_CBC_SHA
:

376 
TLS_DH_RSA_WITH_AES_128_CBC_SHA
:

379 
TLS_DHE_DSS_WITH_AES_128_CBC_SHA
:

382 
TLS_DHE_RSA_WITH_AES_128_CBC_SHA
:

385 
TLS_DH_™⁄_WITH_AES_128_CBC_SHA
:

388 
TLS_RSA_WITH_AES_256_CBC_SHA
:

391 
TLS_DH_DSS_WITH_AES_256_CBC_SHA
:

394 
TLS_DH_RSA_WITH_AES_256_CBC_SHA
:

397 
TLS_DHE_DSS_WITH_AES_256_CBC_SHA
:

400 
TLS_DHE_RSA_WITH_AES_256_CBC_SHA
:

403 
TLS_DH_™⁄_WITH_AES_256_CBC_SHA
:

406 #i‡
CURL_BUILD_MAC_10_6
 || 
CURL_BUILD_IOS


408 
TLS_ECDH_ECDSA_WITH_NULL_SHA
:

411 
TLS_ECDH_ECDSA_WITH_RC4_128_SHA
:

414 
TLS_ECDH_ECDSA_WITH_3DES_EDE_CBC_SHA
:

417 
TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA
:

420 
TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA
:

423 
TLS_ECDHE_ECDSA_WITH_NULL_SHA
:

426 
TLS_ECDHE_ECDSA_WITH_RC4_128_SHA
:

429 
TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA
:

432 
TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA
:

435 
TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA
:

438 
TLS_ECDH_RSA_WITH_NULL_SHA
:

441 
TLS_ECDH_RSA_WITH_RC4_128_SHA
:

444 
TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA
:

447 
TLS_ECDH_RSA_WITH_AES_128_CBC_SHA
:

450 
TLS_ECDH_RSA_WITH_AES_256_CBC_SHA
:

453 
TLS_ECDHE_RSA_WITH_NULL_SHA
:

456 
TLS_ECDHE_RSA_WITH_RC4_128_SHA
:

459 
TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA
:

462 
TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA
:

465 
TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA
:

468 
TLS_ECDH_™⁄_WITH_NULL_SHA
:

471 
TLS_ECDH_™⁄_WITH_RC4_128_SHA
:

474 
TLS_ECDH_™⁄_WITH_3DES_EDE_CBC_SHA
:

477 
TLS_ECDH_™⁄_WITH_AES_128_CBC_SHA
:

480 
TLS_ECDH_™⁄_WITH_AES_256_CBC_SHA
:

484 #i‡
CURL_BUILD_MAC_10_8
 || 
CURL_BUILD_IOS


486 
TLS_RSA_WITH_NULL_MD5
:

489 
TLS_RSA_WITH_NULL_SHA
:

492 
TLS_RSA_WITH_RC4_128_MD5
:

495 
TLS_RSA_WITH_RC4_128_SHA
:

498 
TLS_RSA_WITH_3DES_EDE_CBC_SHA
:

501 
TLS_RSA_WITH_NULL_SHA256
:

504 
TLS_RSA_WITH_AES_128_CBC_SHA256
:

507 
TLS_RSA_WITH_AES_256_CBC_SHA256
:

510 
TLS_DH_DSS_WITH_3DES_EDE_CBC_SHA
:

513 
TLS_DH_RSA_WITH_3DES_EDE_CBC_SHA
:

516 
TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA
:

519 
TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA
:

522 
TLS_DH_DSS_WITH_AES_128_CBC_SHA256
:

525 
TLS_DH_RSA_WITH_AES_128_CBC_SHA256
:

528 
TLS_DHE_DSS_WITH_AES_128_CBC_SHA256
:

531 
TLS_DHE_RSA_WITH_AES_128_CBC_SHA256
:

534 
TLS_DH_DSS_WITH_AES_256_CBC_SHA256
:

537 
TLS_DH_RSA_WITH_AES_256_CBC_SHA256
:

540 
TLS_DHE_DSS_WITH_AES_256_CBC_SHA256
:

543 
TLS_DHE_RSA_WITH_AES_256_CBC_SHA256
:

546 
TLS_DH_™⁄_WITH_RC4_128_MD5
:

549 
TLS_DH_™⁄_WITH_3DES_EDE_CBC_SHA
:

552 
TLS_DH_™⁄_WITH_AES_128_CBC_SHA256
:

555 
TLS_DH_™⁄_WITH_AES_256_CBC_SHA256
:

559 
TLS_RSA_WITH_AES_128_GCM_SHA256
:

562 
TLS_RSA_WITH_AES_256_GCM_SHA384
:

565 
TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
:

568 
TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
:

571 
TLS_DH_RSA_WITH_AES_128_GCM_SHA256
:

574 
TLS_DH_RSA_WITH_AES_256_GCM_SHA384
:

577 
TLS_DHE_DSS_WITH_AES_128_GCM_SHA256
:

580 
TLS_DHE_DSS_WITH_AES_256_GCM_SHA384
:

583 
TLS_DH_DSS_WITH_AES_128_GCM_SHA256
:

586 
TLS_DH_DSS_WITH_AES_256_GCM_SHA384
:

589 
TLS_DH_™⁄_WITH_AES_128_GCM_SHA256
:

592 
TLS_DH_™⁄_WITH_AES_256_GCM_SHA384
:

596 
TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
:

599 
TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384
:

602 
TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256
:

605 
TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384
:

608 
TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256
:

611 
TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
:

614 
TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256
:

617 
TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384
:

620 
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
:

623 
TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
:

626 
TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256
:

629 
TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384
:

632 
TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
:

635 
TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
:

638 
TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256
:

641 
TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384
:

644 
TLS_EMPTY_RENEGOTIATION_INFO_SCSV
:

648 
SSL_RSA_WITH_NULL_MD5
:

651 
SSL_RSA_WITH_NULL_SHA
:

654 
SSL_RSA_WITH_RC4_128_MD5
:

657 
SSL_RSA_WITH_RC4_128_SHA
:

660 
SSL_RSA_WITH_3DES_EDE_CBC_SHA
:

663 
SSL_DH_™⁄_WITH_RC4_128_MD5
:

666 
SSL_DH_™⁄_WITH_3DES_EDE_CBC_SHA
:

670 #i‡
CURL_BUILD_MAC_10_9
 || 
CURL_BUILD_IOS_7


672 
TLS_PSK_WITH_RC4_128_SHA
:

675 
TLS_PSK_WITH_3DES_EDE_CBC_SHA
:

678 
TLS_PSK_WITH_AES_128_CBC_SHA
:

681 
TLS_PSK_WITH_AES_256_CBC_SHA
:

684 
TLS_DHE_PSK_WITH_RC4_128_SHA
:

687 
TLS_DHE_PSK_WITH_3DES_EDE_CBC_SHA
:

690 
TLS_DHE_PSK_WITH_AES_128_CBC_SHA
:

693 
TLS_DHE_PSK_WITH_AES_256_CBC_SHA
:

696 
TLS_RSA_PSK_WITH_RC4_128_SHA
:

699 
TLS_RSA_PSK_WITH_3DES_EDE_CBC_SHA
:

702 
TLS_RSA_PSK_WITH_AES_128_CBC_SHA
:

705 
TLS_RSA_PSK_WITH_AES_256_CBC_SHA
:

709 
TLS_PSK_WITH_NULL_SHA
:

712 
TLS_DHE_PSK_WITH_NULL_SHA
:

715 
TLS_RSA_PSK_WITH_NULL_SHA
:

719 
TLS_PSK_WITH_AES_128_GCM_SHA256
:

722 
TLS_PSK_WITH_AES_256_GCM_SHA384
:

725 
TLS_DHE_PSK_WITH_AES_128_GCM_SHA256
:

728 
TLS_DHE_PSK_WITH_AES_256_GCM_SHA384
:

731 
TLS_RSA_PSK_WITH_AES_128_GCM_SHA256
:

734 
TLS_RSA_PSK_WITH_AES_256_GCM_SHA384
:

737 
TLS_PSK_WITH_AES_128_CBC_SHA256
:

740 
TLS_PSK_WITH_AES_256_CBC_SHA384
:

743 
TLS_PSK_WITH_NULL_SHA256
:

746 
TLS_PSK_WITH_NULL_SHA384
:

749 
TLS_DHE_PSK_WITH_AES_128_CBC_SHA256
:

752 
TLS_DHE_PSK_WITH_AES_256_CBC_SHA384
:

755 
TLS_DHE_PSK_WITH_NULL_SHA256
:

758 
TLS_DHE_PSK_WITH_NULL_SHA384
:

761 
TLS_RSA_PSK_WITH_AES_128_CBC_SHA256
:

764 
TLS_RSA_PSK_WITH_AES_256_CBC_SHA384
:

767 
TLS_RSA_PSK_WITH_NULL_SHA256
:

770 
TLS_RSA_PSK_WITH_NULL_SHA384
:

776 
	}
}

778 #i‡
CURL_BUILD_MAC


779 
CF_INLINE
 
	$GëD¨wöVîsi⁄Numbî
(*
maj‹
, *
mö‹
)

781 
mib
[2];

782 *
os_vîsi⁄
;

783 
size_t
 
os_vîsi⁄_Àn
;

784 *
os_vîsi⁄_maj‹
, *
os_vîsi⁄_mö‹
 ;

787 
mib
[0] = 
CTL_KERN
;

788 
mib
[1] = 
KERN_OSRELEASE
;

789 if(
	`sys˘l
(
mib
, 2, 
NULL
, &
os_vîsi⁄_Àn
, NULL, 0) == -1)

791 
os_vîsi⁄
 = 
	`mÆloc
(
os_vîsi⁄_Àn
*());

792 if(!
os_vîsi⁄
)

794 if(
	`sys˘l
(
mib
, 2, 
os_vîsi⁄
, &
os_vîsi⁄_Àn
, 
NULL
, 0) == -1) {

795 
	`‰ì
(
os_vîsi⁄
);

800 
os_vîsi⁄_maj‹
 = 
	`°πok
(
os_vîsi⁄
, ".");

801 
os_vîsi⁄_mö‹
 = 
	`°πok
(
NULL
, ".");

803 *
maj‹
 = 
	`©oi
(
os_vîsi⁄_maj‹
);

804 *
mö‹
 = 
	`©oi
(
os_vîsi⁄_mö‹
);

805 
	`‰ì
(
os_vîsi⁄
);

806 
	}
}

813 
CF_INLINE
 
CFSåögRef
 
	$C›yCîtSubje˘
(
SecCîtifiˇãRef
 
˚π
)

815 
CFSåögRef
 
£rvî_˚π_summ¨y
 = 
	`CFSTR
("(null)");

817 #i‡
CURL_BUILD_IOS


819 
£rvî_˚π_summ¨y
 = 
	`SecCîtifiˇãC›ySubje˘Summ¨y
(
˚π
);

821 #i‡
CURL_BUILD_MAC_10_7


823 if(
SecCîtifiˇãC›yL⁄gDes¸ùti⁄
 !
NULL
)

824 
£rvî_˚π_summ¨y
 =

825 
	`SecCîtifiˇãC›yL⁄gDes¸ùti⁄
(
NULL
, 
˚π
, NULL);

828 #i‡
CURL_BUILD_MAC_10_6


830 if(
SecCîtifiˇãC›ySubje˘Summ¨y
 !
NULL
)

831 
£rvî_˚π_summ¨y
 = 
	`SecCîtifiˇãC›ySubje˘Summ¨y
(
˚π
);

835 ()
	`SecCîtifiˇãC›yComm⁄Name
(
˚π
, &
£rvî_˚π_summ¨y
);

837  
£rvî_˚π_summ¨y
;

838 
	}
}

840 #i‡
CURL_SUPPORT_MAC_10_6


843 
OSSètus
 
	$C›yIdítôyWôhLabñOldSchoﬁ
(*
œbñ
,

844 
SecIdítôyRef
 *
out_c_a_k
)

846 
OSSètus
 
°©us
 = 
îrSecIãmNŸFound
;

847 
SecKeychaöAâribuãLi°
 
©å_li°
;

848 
SecKeychaöAâribuã
 
©å
;

849 
SecKeychaöSórchRef
 
£¨ch
 = 
NULL
;

850 
SecCîtifiˇãRef
 
˚π
 = 
NULL
;

853 
©å_li°
.
cou¡
 = 1L;

854 
©å_li°
.
©å
 = &attr;

857 
©å
.
èg
 = 
kSecLabñIãmAâr
;

858 
©å
.
d©a
 = 
œbñ
;

859 
©å
.
Àngth
 = (
UI¡32
)
	`°æí
(
œbñ
);

862 
°©us
 = 
	`SecKeychaöSórchCª©eFromAâribuãs
(
NULL
,

863 
kSecCîtifiˇãIãmCœss
,

864 &
©å_li°
,

865 &
£¨ch
);

866 if(
°©us
 =
noEº
) {

867 
°©us
 = 
	`SecKeychaöSórchC›yNext
(
£¨ch
,

868 (
SecKeychaöIãmRef
 *)&
˚π
);

869 if(
°©us
 =
noEº
 && 
˚π
) {

871 
°©us
 = 
	`SecIdítôyCª©eWôhCîtifiˇã
(
NULL
, 
˚π
, 
out_c_a_k
);

872 
	`CFRñó£
(
˚π
);

876 if(
£¨ch
)

877 
	`CFRñó£
(
£¨ch
);

878  
°©us
;

879 
	}
}

882 
OSSètus
 
	$C›yIdítôyWôhLabñ
(*
œbñ
,

883 
SecIdítôyRef
 *
out_˚π_™d_key
)

885 
OSSètus
 
°©us
 = 
îrSecIãmNŸFound
;

887 #i‡
CURL_BUILD_MAC_10_7
 || 
CURL_BUILD_IOS


891 if(
SecIãmC›yM©chög
 !
NULL
 && 
kSecCœssIdítôy
 != NULL) {

892 
CFTy≥Ref
 
keys
[4];

893 
CFTy≥Ref
 
vÆues
[4];

894 
CFDi˘i⁄¨yRef
 
quîy_di˘
;

895 
CFSåögRef
 
œbñ_cf
 = 
	`CFSåögCª©eWôhCSåög
(
NULL
, 
œbñ
,

896 
kCFSåögEncodögUTF8
);

899 
vÆues
[0] = 
kSecCœssIdítôy
;

900 
keys
[0] = 
kSecCœss
;

901 
vÆues
[1] = 
kCFBoﬁónTrue
;

902 
keys
[1] = 
kSecRëu∫Ref
;

903 
vÆues
[2] = 
kSecM©chLimôO√
;

904 
keys
[2] = 
kSecM©chLimô
;

906 
vÆues
[3] = 
	`SecPﬁicyCª©eSSL
(
Ál£
, 
œbñ_cf
);

907 
keys
[3] = 
kSecM©chPﬁicy
;

908 
quîy_di˘
 = 
	`CFDi˘i⁄¨yCª©e
(
NULL
, (c⁄° **)
keys
,

909 (c⁄° **)
vÆues
, 4L,

910 &
kCFC›ySåögDi˘i⁄¨yKeyCÆlBacks
,

911 &
kCFTy≥Di˘i⁄¨yVÆueCÆlBacks
);

912 
	`CFRñó£
(
vÆues
[3]);

913 
	`CFRñó£
(
œbñ_cf
);

916 
°©us
 = 
	`SecIãmC›yM©chög
(
quîy_di˘
, (
CFTy≥Ref
 *)
out_˚π_™d_key
);

917 
	`CFRñó£
(
quîy_di˘
);

920 #i‡
CURL_SUPPORT_MAC_10_6


922 
°©us
 = 
	`C›yIdítôyWôhLabñOldSchoﬁ
(
œbñ
, 
out_˚π_™d_key
);

925 #ñi‡
CURL_SUPPORT_MAC_10_6


928 
°©us
 = 
	`C›yIdítôyWôhLabñOldSchoﬁ
(
œbñ
, 
out_˚π_™d_key
);

930  
°©us
;

931 
	}
}

933 
OSSètus
 
	$C›yIdítôyFromPKCS12Fûe
(c⁄° *
cP©h
,

934 c⁄° *
cPassw‹d
,

935 
SecIdítôyRef
 *
out_˚π_™d_key
)

937 
OSSètus
 
°©us
 = 
îrSecIãmNŸFound
;

938 
CFURLRef
 
pkcs_uæ
 = 
	`CFURLCª©eFromFûeSy°emRïª£¡©i⁄
(
NULL
,

939 (c⁄° 
UI¡8
 *)
cP©h
, 
	`°æí
(cP©h), 
Ál£
);

940 
CFSåögRef
 
∑ssw‹d
 = 
cPassw‹d
 ? 
	`CFSåögCª©eWôhCSåög
(
NULL
,

941 
cPassw‹d
, 
kCFSåögEncodögUTF8
Ë: 
NULL
;

942 
CFD©aRef
 
pkcs_d©a
 = 
NULL
;

947 #i‡
CURL_BUILD_MAC_10_7
 || 
CURL_BUILD_IOS


948 if(
	`CFURLCª©eD©aAndPr›îtõsFromResour˚
(
NULL
, 
pkcs_uæ
, &
pkcs_d©a
,

949 
NULL
, NULL, &
°©us
)) {

950 c⁄° *
cKeys
[] = {
kSecImp‹tExp‹tPas•hø£
};

951 c⁄° *
cVÆues
[] = {
∑ssw‹d
};

952 
CFDi˘i⁄¨yRef
 
›ti⁄s
 = 
	`CFDi˘i⁄¨yCª©e
(
NULL
, 
cKeys
, 
cVÆues
,

953 
∑ssw‹d
 ? 1L : 0L, 
NULL
, NULL);

954 
CFAºayRef
 
ôems
 = 
NULL
;

957 
°©us
 = 
	`SecPKCS12Imp‹t
(
pkcs_d©a
, 
›ti⁄s
, &
ôems
);

958 if(
°©us
 =
noEº
 && 
ôems
 && 
	`CFAºayGëCou¡
(items)) {

959 
CFDi˘i⁄¨yRef
 
idítôy_™d_åu°
 = 
	`CFAºayGëVÆueAtIndex
(
ôems
, 0L);

960 c⁄° *
ãmp_idítôy
 = 
	`CFDi˘i⁄¨yGëVÆue
(
idítôy_™d_åu°
,

961 
kSecImp‹tIãmIdítôy
);

964 
	`CFRëaö
(
ãmp_idítôy
);

965 *
out_˚π_™d_key
 = (
SecIdítôyRef
)
ãmp_idítôy
;

968 if(
ôems
)

969 
	`CFRñó£
(
ôems
);

970 
	`CFRñó£
(
›ti⁄s
);

971 
	`CFRñó£
(
pkcs_d©a
);

974 if(
∑ssw‹d
)

975 
	`CFRñó£
(
∑ssw‹d
);

976 
	`CFRñó£
(
pkcs_uæ
);

977  
°©us
;

978 
	}
}

987 
CF_INLINE
 
boﬁ
 
	$is_fûe
(c⁄° *
fûíame
)

989 
°ru˘_°©
 
°
;

991 if(
fûíame
 =
NULL
)

992  
Ál£
;

994 if(
	`°©
(
fûíame
, &
°
) == 0)

995  
	`S_ISREG
(
°
.
°_mode
);

996  
Ál£
;

997 
	}
}

999 
CURLcode
 
	$d¨wös¶_c⁄√˘_°ï1
(
c⁄√˘d©a
 *
c⁄n
,

1000 
socködex
)

1002 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1003 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
socködex
];

1004 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1005 #ifde‡
ENABLE_IPV6


1006 
ö6_addr
 
addr
;

1008 
ö_addr
 
addr
;

1010 
size_t
 
Æl_cùhîs_cou¡
 = 0UL, 
Ælowed_cùhîs_cou¡
 = 0UL, 
i
;

1011 
SSLCùhîSuôe
 *
Æl_cùhîs
 = 
NULL
, *
Ælowed_cùhîs
 = NULL;

1012 *
s¶_£ssi⁄id
;

1013 
size_t
 
s¶_£ssi⁄id_Àn
;

1014 
OSSètus
 
îr
 = 
noEº
;

1015 #i‡
CURL_BUILD_MAC


1016 
d¨wövî_maj
 = 0, 
d¨wövî_mö
 = 0;

1018 
	`GëD¨wöVîsi⁄Numbî
(&
d¨wövî_maj
, &
d¨wövî_mö
);

1021 #i‡
CURL_BUILD_MAC_10_8
 || 
CURL_BUILD_IOS


1022 if(
SSLCª©eC⁄ãxt
 !
NULL
) {

1023 if(
c⁄ns¶
->
s¶_˘x
)

1024 
	`CFRñó£
(
c⁄ns¶
->
s¶_˘x
);

1025 
c⁄ns¶
->
s¶_˘x
 = 
	`SSLCª©eC⁄ãxt
(
NULL
, 
kSSLClõ¡Side
, 
kSSLSåómTy≥
);

1026 if(!
c⁄ns¶
->
s¶_˘x
) {

1027 
	`Áûf
(
d©a
, "SSL: couldn't createá context!");

1028  
CURLE_OUT_OF_MEMORY
;

1033 #i‡
CURL_SUPPORT_MAC_10_8


1034 if(
c⁄ns¶
->
s¶_˘x
)

1035 ()
	`SSLDi•o£C⁄ãxt
(
c⁄ns¶
->
s¶_˘x
);

1036 
îr
 = 
	`SSLNewC⁄ãxt
(
Ál£
, &(
c⁄ns¶
->
s¶_˘x
));

1037 if(
îr
 !
noEº
) {

1038 
	`Áûf
(
d©a
, "SSL: couldn'à¸óãá c⁄ãxt: OSSètu†%d", 
îr
);

1039  
CURLE_OUT_OF_MEMORY
;

1044 if(
c⁄ns¶
->
s¶_˘x
)

1045 ()
	`SSLDi•o£C⁄ãxt
(
c⁄ns¶
->
s¶_˘x
);

1046 
îr
 = 
	`SSLNewC⁄ãxt
(
Ál£
, &(
c⁄ns¶
->
s¶_˘x
));

1047 if(
îr
 !
noEº
) {

1048 
	`Áûf
(
d©a
, "SSL: couldn'à¸óãá c⁄ãxt: OSSètu†%d", 
îr
);

1049  
CURLE_OUT_OF_MEMORY
;

1052 
c⁄ns¶
->
s¶_wrôe_buf„ªd_Àngth
 = 0UL;

1055 #i‡
CURL_BUILD_MAC_10_8
 || 
CURL_BUILD_IOS


1056 if(
SSLSëPrŸocﬁVîsi⁄Max
 !
NULL
) {

1057 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

1058 
CURL_SSLVERSION_DEFAULT
: :

1059 ()
	`SSLSëPrŸocﬁVîsi⁄Mö
(
c⁄ns¶
->
s¶_˘x
, 
kSSLPrŸocﬁ3
);

1060 ()
	`SSLSëPrŸocﬁVîsi⁄Max
(
c⁄ns¶
->
s¶_˘x
, 
kTLSPrŸocﬁ12
);

1062 
CURL_SSLVERSION_TLSv1
:

1063 ()
	`SSLSëPrŸocﬁVîsi⁄Mö
(
c⁄ns¶
->
s¶_˘x
, 
kTLSPrŸocﬁ1
);

1064 ()
	`SSLSëPrŸocﬁVîsi⁄Max
(
c⁄ns¶
->
s¶_˘x
, 
kTLSPrŸocﬁ12
);

1066 
CURL_SSLVERSION_TLSv1_0
:

1067 ()
	`SSLSëPrŸocﬁVîsi⁄Mö
(
c⁄ns¶
->
s¶_˘x
, 
kTLSPrŸocﬁ1
);

1068 ()
	`SSLSëPrŸocﬁVîsi⁄Max
(
c⁄ns¶
->
s¶_˘x
, 
kTLSPrŸocﬁ1
);

1070 
CURL_SSLVERSION_TLSv1_1
:

1071 ()
	`SSLSëPrŸocﬁVîsi⁄Mö
(
c⁄ns¶
->
s¶_˘x
, 
kTLSPrŸocﬁ11
);

1072 ()
	`SSLSëPrŸocﬁVîsi⁄Max
(
c⁄ns¶
->
s¶_˘x
, 
kTLSPrŸocﬁ11
);

1074 
CURL_SSLVERSION_TLSv1_2
:

1075 ()
	`SSLSëPrŸocﬁVîsi⁄Mö
(
c⁄ns¶
->
s¶_˘x
, 
kTLSPrŸocﬁ12
);

1076 ()
	`SSLSëPrŸocﬁVîsi⁄Max
(
c⁄ns¶
->
s¶_˘x
, 
kTLSPrŸocﬁ12
);

1078 
CURL_SSLVERSION_SSLv3
:

1079 ()
	`SSLSëPrŸocﬁVîsi⁄Mö
(
c⁄ns¶
->
s¶_˘x
, 
kSSLPrŸocﬁ3
);

1080 ()
	`SSLSëPrŸocﬁVîsi⁄Max
(
c⁄ns¶
->
s¶_˘x
, 
kSSLPrŸocﬁ3
);

1082 
CURL_SSLVERSION_SSLv2
:

1083 
îr
 = 
	`SSLSëPrŸocﬁVîsi⁄Mö
(
c⁄ns¶
->
s¶_˘x
, 
kSSLPrŸocﬁ2
);

1084 if(
îr
 !
noEº
) {

1085 
	`Áûf
(
d©a
, "Your version ofÅhe OS doesÇot support SSLv2");

1086  
CURLE_SSL_CONNECT_ERROR
;

1088 ()
	`SSLSëPrŸocﬁVîsi⁄Max
(
c⁄ns¶
->
s¶_˘x
, 
kSSLPrŸocﬁ2
);

1092 #i‡
CURL_SUPPORT_MAC_10_8


1093 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1094 
kSSLPrŸocﬁAŒ
,

1095 
Ál£
);

1096 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

1097 
CURL_SSLVERSION_DEFAULT
: :

1098 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1099 
kSSLPrŸocﬁ3
,

1100 
åue
);

1101 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1102 
kTLSPrŸocﬁ1
,

1103 
åue
);

1104 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1105 
kTLSPrŸocﬁ11
,

1106 
åue
);

1107 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1108 
kTLSPrŸocﬁ12
,

1109 
åue
);

1111 
CURL_SSLVERSION_TLSv1
:

1112 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1113 
kTLSPrŸocﬁ1
,

1114 
åue
);

1115 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1116 
kTLSPrŸocﬁ11
,

1117 
åue
);

1118 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1119 
kTLSPrŸocﬁ12
,

1120 
åue
);

1122 
CURL_SSLVERSION_TLSv1_0
:

1123 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1124 
kTLSPrŸocﬁ1
,

1125 
åue
);

1127 
CURL_SSLVERSION_TLSv1_1
:

1128 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1129 
kTLSPrŸocﬁ11
,

1130 
åue
);

1132 
CURL_SSLVERSION_TLSv1_2
:

1133 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1134 
kTLSPrŸocﬁ12
,

1135 
åue
);

1137 
CURL_SSLVERSION_SSLv3
:

1138 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1139 
kSSLPrŸocﬁ3
,

1140 
åue
);

1142 
CURL_SSLVERSION_SSLv2
:

1143 
îr
 = 
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1144 
kSSLPrŸocﬁ2
,

1145 
åue
);

1146 if(
îr
 !
noEº
) {

1147 
	`Áûf
(
d©a
, "Your version ofÅhe OS doesÇot support SSLv2");

1148  
CURLE_SSL_CONNECT_ERROR
;

1155 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
, 
kSSLPrŸocﬁAŒ
, 
Ál£
);

1156 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

1158 
CURL_SSLVERSION_DEFAULT
:

1159 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1160 
kSSLPrŸocﬁ3
,

1161 
åue
);

1162 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1163 
kTLSPrŸocﬁ1
,

1164 
åue
);

1166 
CURL_SSLVERSION_TLSv1
:

1167 
CURL_SSLVERSION_TLSv1_0
:

1168 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1169 
kTLSPrŸocﬁ1
,

1170 
åue
);

1172 
CURL_SSLVERSION_TLSv1_1
:

1173 
	`Áûf
(
d©a
, "Your version ofÅhe OS doesÇot support TLSv1.1");

1174  
CURLE_SSL_CONNECT_ERROR
;

1175 
CURL_SSLVERSION_TLSv1_2
:

1176 
	`Áûf
(
d©a
, "Your version ofÅhe OS doesÇot support TLSv1.2");

1177  
CURLE_SSL_CONNECT_ERROR
;

1178 
CURL_SSLVERSION_SSLv2
:

1179 
îr
 = 
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1180 
kSSLPrŸocﬁ2
,

1181 
åue
);

1182 if(
îr
 !
noEº
) {

1183 
	`Áûf
(
d©a
, "Your version ofÅhe OS doesÇot support SSLv2");

1184  
CURLE_SSL_CONNECT_ERROR
;

1187 
CURL_SSLVERSION_SSLv3
:

1188 ()
	`SSLSëPrŸocﬁVîsi⁄E«bÀd
(
c⁄ns¶
->
s¶_˘x
,

1189 
kSSLPrŸocﬁ3
,

1190 
åue
);

1195 if(
d©a
->
£t
.
°r
[
STRING_KEY
]) {

1196 
	`öfof
(
d©a
, "WARNING: SSL: CURLOPT_SSLKEY is ignored by Secure "

1200 if(
d©a
->
£t
.
°r
[
STRING_CERT
]) {

1201 
SecIdítôyRef
 
˚π_™d_key
 = 
NULL
;

1202 
boﬁ
 
is_˚π_fûe
 = 
	`is_fûe
(
d©a
->
£t
.
°r
[
STRING_CERT
]);

1208 if(
is_˚π_fûe
) {

1209 if(!
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
])

1210 
	`öfof
(
d©a
, "WARNING: SSL: CertificateÅypeÇot set,ássuming "

1212 if(
	`°∫cmp
(
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
], "P12",

1213 
	`°æí
(
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
])) != 0)

1214 
	`öfof
(
d©a
, "WARNING: SSL: The Security framework only supports "

1217 
îr
 = 
	`C›yIdítôyFromPKCS12Fûe
(
d©a
->
£t
.
°r
[
STRING_CERT
],

1218 
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
], &
˚π_™d_key
);

1221 
îr
 = 
	`C›yIdítôyWôhLabñ
(
d©a
->
£t
.
°r
[
STRING_CERT
], &
˚π_™d_key
);

1223 if(
îr
 =
noEº
) {

1224 
SecCîtifiˇãRef
 
˚π
 = 
NULL
;

1225 
CFTy≥Ref
 
˚πs_c
[1];

1226 
CFAºayRef
 
˚πs
;

1229 
îr
 = 
	`SecIdítôyC›yCîtifiˇã
(
˚π_™d_key
, &
˚π
);

1230 if(
îr
 =
noEº
) {

1231 
CFSåögRef
 
˚π_summ¨y
 = 
	`C›yCîtSubje˘
(
˚π
);

1232 
˚π_summ¨y_c
[128];

1234 if(
˚π_summ¨y
) {

1235 
	`mem£t
(
˚π_summ¨y_c
, 0, 128);

1236 if(
	`CFSåögGëCSåög
(
˚π_summ¨y
,

1237 
˚π_summ¨y_c
,

1239 
kCFSåögEncodögUTF8
)) {

1240 
	`öfof
(
d©a
, "Clõ¡ cîtifiˇã: %s\n", 
˚π_summ¨y_c
);

1242 
	`CFRñó£
(
˚π_summ¨y
);

1243 
	`CFRñó£
(
˚π
);

1246 
˚πs_c
[0] = 
˚π_™d_key
;

1247 
˚πs
 = 
	`CFAºayCª©e
(
NULL
, (c⁄° **)
˚πs_c
, 1L,

1248 &
kCFTy≥AºayCÆlBacks
);

1249 
îr
 = 
	`SSLSëCîtifiˇã
(
c⁄ns¶
->
s¶_˘x
, 
˚πs
);

1250 if(
˚πs
)

1251 
	`CFRñó£
(
˚πs
);

1252 if(
îr
 !
noEº
) {

1253 
	`Áûf
(
d©a
, "SSL: SSLSëCîtifiˇã(ËÁûed: OSSètu†%d", 
îr
);

1254  
CURLE_SSL_CERTPROBLEM
;

1256 
	`CFRñó£
(
˚π_™d_key
);

1259 
îr
) {

1260 
îrSecAuthFaûed
: -25264:

1261 
	`Áûf
(
d©a
, "SSL: IncorrectÖassword forÅhe certificate \"%s\" "

1262 "™d it†¥iv©êkey.", 
d©a
->
£t
.
°r
[
STRING_CERT
]);

1265 
	`Áûf
(
d©a
, "SSL: Couldn't make sense ofÅhe data inÅhe "

1267 
d©a
->
£t
.
°r
[
STRING_CERT
]);

1270 
	`Áûf
(
d©a
, "SSL The certificate \"%s\"ÑequiresáÖassword.",

1271 
d©a
->
£t
.
°r
[
STRING_CERT
]);

1273 
îrSecIãmNŸFound
:

1274 
	`Áûf
(
d©a
, "SSL: Can't findÅhe certificate \"%s\"ánd itsÖrivate "

1275 "key i¿thêKeychaö.", 
d©a
->
£t
.
°r
[
STRING_CERT
]);

1278 
	`Áûf
(
d©a
, "SSL: Can'tÜoadÅhe certificate \"%s\"ánd itsÖrivate "

1279 "key: OSSètu†%d", 
d©a
->
£t
.
°r
[
STRING_CERT
], 
îr
);

1282  
CURLE_SSL_CERTPROBLEM
;

1290 #i‡
CURL_BUILD_MAC_10_6
 || 
CURL_BUILD_IOS


1299 #i‡
CURL_BUILD_MAC


1300 if(
SSLSëSessi⁄O±i⁄
 !
NULL
 && 
d¨wövî_maj
 >= 12) {

1302 if(
SSLSëSessi⁄O±i⁄
 !
NULL
) {

1304 
boﬁ
 
bªak_⁄_auth
 = !
d©a
->
£t
.
s¶
.
vîify≥î
 ||

1305 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
];

1306 
îr
 = 
	`SSLSëSessi⁄O±i⁄
(
c⁄ns¶
->
s¶_˘x
,

1307 
kSSLSessi⁄O±i⁄BªakOnSîvîAuth
,

1308 
bªak_⁄_auth
);

1309 if(
îr
 !
noEº
) {

1310 
	`Áûf
(
d©a
, "SSL: SSLSëSessi⁄O±i⁄(ËÁûed: OSSètu†%d", 
îr
);

1311  
CURLE_SSL_CONNECT_ERROR
;

1315 #i‡
CURL_SUPPORT_MAC_10_8


1316 
îr
 = 
	`SSLSëE«bÀCîtVîify
(
c⁄ns¶
->
s¶_˘x
,

1317 
d©a
->
£t
.
s¶
.
vîify≥î
?
åue
:
Ál£
);

1318 if(
îr
 !
noEº
) {

1319 
	`Áûf
(
d©a
, "SSL: SSLSëE«bÀCîtVîify(ËÁûed: OSSètu†%d", 
îr
);

1320  
CURLE_SSL_CONNECT_ERROR
;

1325 
îr
 = 
	`SSLSëE«bÀCîtVîify
(
c⁄ns¶
->
s¶_˘x
,

1326 
d©a
->
£t
.
s¶
.
vîify≥î
?
åue
:
Ál£
);

1327 if(
îr
 !
noEº
) {

1328 
	`Áûf
(
d©a
, "SSL: SSLSëE«bÀCîtVîify(ËÁûed: OSSètu†%d", 
îr
);

1329  
CURLE_SSL_CONNECT_ERROR
;

1333 if(
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]) {

1334 
boﬁ
 
is_˚π_fûe
 = 
	`is_fûe
(
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]);

1336 if(!
is_˚π_fûe
) {

1337 
	`Áûf
(
d©a
, "SSL: can'tÜoad CA certificate file %s",

1338 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]);

1339  
CURLE_SSL_CACERT_BADFILE
;

1341 if(!
d©a
->
£t
.
s¶
.
vîify≥î
) {

1342 
	`Áûf
(
d©a
, "SSL: CA certificate set, but certificate verification "

1344  
CURLE_SSL_CONNECT_ERROR
;

1351 if(
d©a
->
£t
.
s¶
.
vîifyho°
) {

1352 
îr
 = 
	`SSLSëPìrDomaöName
(
c⁄ns¶
->
s¶_˘x
, 
c⁄n
->
ho°
.
«me
,

1353 
	`°æí
(
c⁄n
->
ho°
.
«me
));

1355 if(
îr
 !
noEº
) {

1356 
	`öfof
(
d©a
, "WARNING: SSL: SSLSetPeerDomainName() failed: OSStatus %d\n",

1357 
îr
);

1360 if((
	`Cuæ_öë_±⁄
(
AF_INET
, 
c⁄n
->
ho°
.
«me
, &
addr
))

1361 #ifde‡
ENABLE_IPV6


1362 || (
	`Cuæ_öë_±⁄
(
AF_INET6
, 
c⁄n
->
ho°
.
«me
, &
addr
))

1365 
	`öfof
(
d©a
, "WARNING: using IPáddress, SNI is being disabled by "

1375 ()
	`SSLGëNumbîSuµ‹ãdCùhîs
(
c⁄ns¶
->
s¶_˘x
, &
Æl_cùhîs_cou¡
);

1376 
Æl_cùhîs
 = 
	`mÆloc
(
Æl_cùhîs_cou¡
*(
SSLCùhîSuôe
));

1377 
Ælowed_cùhîs
 = 
	`mÆloc
(
Æl_cùhîs_cou¡
*(
SSLCùhîSuôe
));

1378 if(
Æl_cùhîs
 && 
Ælowed_cùhîs
 &&

1379 
	`SSLGëSuµ‹ãdCùhîs
(
c⁄ns¶
->
s¶_˘x
, 
Æl_cùhîs
,

1380 &
Æl_cùhîs_cou¡
Ë=
noEº
) {

1381 
i
 = 0UL ; i < 
Æl_cùhîs_cou¡
 ; i++) {

1382 #i‡
CURL_BUILD_MAC


1387 if(
d¨wövî_maj
 =12 && 
d¨wövî_mö
 <= 3 &&

1388 
Æl_cùhîs
[
i
] >= 0xC001 &&áll_ciphers[i] <= 0xC032) {

1392 
Æl_cùhîs
[
i
]) {

1394 
SSL_NULL_WITH_NULL_NULL
:

1395 
SSL_RSA_WITH_NULL_MD5
:

1396 
SSL_RSA_WITH_NULL_SHA
:

1398 
SSL_FORTEZZA_DMS_WITH_NULL_SHA
:

1413 
SSL_DH_™⁄_EXPORT_WITH_RC4_40_MD5
:

1414 
SSL_DH_™⁄_WITH_RC4_128_MD5
:

1415 
SSL_DH_™⁄_EXPORT_WITH_DES40_CBC_SHA
:

1416 
SSL_DH_™⁄_WITH_DES_CBC_SHA
:

1417 
SSL_DH_™⁄_WITH_3DES_EDE_CBC_SHA
:

1418 
TLS_DH_™⁄_WITH_AES_128_CBC_SHA
:

1419 
TLS_DH_™⁄_WITH_AES_256_CBC_SHA
:

1430 
SSL_RSA_EXPORT_WITH_RC4_40_MD5
:

1431 
SSL_RSA_EXPORT_WITH_RC2_CBC_40_MD5
:

1432 
SSL_RSA_EXPORT_WITH_DES40_CBC_SHA
:

1433 
SSL_DH_DSS_EXPORT_WITH_DES40_CBC_SHA
:

1434 
SSL_DH_RSA_EXPORT_WITH_DES40_CBC_SHA
:

1435 
SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA
:

1436 
SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA
:

1437 
SSL_RSA_WITH_DES_CBC_SHA
:

1438 
SSL_DH_DSS_WITH_DES_CBC_SHA
:

1439 
SSL_DH_RSA_WITH_DES_CBC_SHA
:

1440 
SSL_DHE_DSS_WITH_DES_CBC_SHA
:

1441 
SSL_DHE_RSA_WITH_DES_CBC_SHA
:

1443 
SSL_RSA_WITH_IDEA_CBC_SHA
:

1444 
SSL_RSA_WITH_IDEA_CBC_MD5
:

1447 
Ælowed_cùhîs
[
Ælowed_cùhîs_cou¡
++] = 
Æl_cùhîs
[
i
];

1451 
îr
 = 
	`SSLSëE«bÀdCùhîs
(
c⁄ns¶
->
s¶_˘x
, 
Ælowed_cùhîs
,

1452 
Ælowed_cùhîs_cou¡
);

1453 if(
îr
 !
noEº
) {

1454 
	`Áûf
(
d©a
, "SSL: SSLSëE«bÀdCùhîs(ËÁûed: OSSètu†%d", 
îr
);

1455  
CURLE_SSL_CONNECT_ERROR
;

1459 
	`Cuæ_ß„‰ì
(
Æl_cùhîs
);

1460 
	`Cuæ_ß„‰ì
(
Ælowed_cùhîs
);

1461 
	`Áûf
(
d©a
, "SSL: FailedÅoállocate memory forállowed ciphers");

1462  
CURLE_OUT_OF_MEMORY
;

1464 
	`Cuæ_ß„‰ì
(
Æl_cùhîs
);

1465 
	`Cuæ_ß„‰ì
(
Ælowed_cùhîs
);

1467 #i‡
CURL_BUILD_MAC_10_9
 || 
CURL_BUILD_IOS_7


1470 if(
SSLSëSessi⁄O±i⁄
 !
NULL
)

1471 
	`SSLSëSessi⁄O±i⁄
(
c⁄ns¶
->
s¶_˘x
, 
kSSLSessi⁄O±i⁄SídO√ByãRec‹d
,

1472 !
d©a
->
£t
.
s¶_íabÀ_bó°
);

1476 if(!
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, (**)&
s¶_£ssi⁄id
,

1477 &
s¶_£ssi⁄id_Àn
)) {

1479 
îr
 = 
	`SSLSëPìrID
(
c⁄ns¶
->
s¶_˘x
, 
s¶_£ssi⁄id
, 
s¶_£ssi⁄id_Àn
);

1480 if(
îr
 !
noEº
) {

1481 
	`Áûf
(
d©a
, "SSL: SSLSëPìrID(ËÁûed: OSSètu†%d", 
îr
);

1482  
CURLE_SSL_CONNECT_ERROR
;

1485 
	`öfof
(
d©a
, "SSLÑe-using session ID\n");

1490 
CURLcode
 
ªtcode
;

1492 
s¶_£ssi⁄id
 = 
	`mÆloc
(256*());

1493 
s¶_£ssi⁄id_Àn
 = 
	`¢¥ötf
(
s¶_£ssi⁄id
, 256, "curl:%s:%hu",

1494 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

1495 
îr
 = 
	`SSLSëPìrID
(
c⁄ns¶
->
s¶_˘x
, 
s¶_£ssi⁄id
, 
s¶_£ssi⁄id_Àn
);

1496 if(
îr
 !
noEº
) {

1497 
	`Áûf
(
d©a
, "SSL: SSLSëPìrID(ËÁûed: OSSètu†%d", 
îr
);

1498  
CURLE_SSL_CONNECT_ERROR
;

1500 
ªtcode
 = 
	`Cuæ_s¶_add£ssi⁄id
(
c⁄n
, 
s¶_£ssi⁄id
, 
s¶_£ssi⁄id_Àn
);

1501 if(
ªtcode
!
CURLE_OK
) {

1502 
	`Áûf
(
d©a
, "failedÅo store ssl session");

1503  
ªtcode
;

1507 
îr
 = 
	`SSLSëIOFuncs
(
c⁄ns¶
->
s¶_˘x
, 
SockëRód
, 
SockëWrôe
);

1508 if(
îr
 !
noEº
) {

1509 
	`Áûf
(
d©a
, "SSL: SSLSëIOFuncs(ËÁûed: OSSètu†%d", 
îr
);

1510  
CURLE_SSL_CONNECT_ERROR
;

1517 
c⁄ns¶
->
s¶_sockfd
 = 
sockfd
;

1518 
îr
 = 
	`SSLSëC⁄√˘i⁄
(
c⁄ns¶
->
s¶_˘x
, connssl);

1519 if(
îr
 !
noEº
) {

1520 
	`Áûf
(
d©a
, "SSL: SSLSëC⁄√˘i⁄(ËÁûed: %d", 
îr
);

1521  
CURLE_SSL_CONNECT_ERROR
;

1524 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2
;

1525  
CURLE_OK
;

1526 
	}
}

1528 
	$≥m_to_dî
(c⁄° *
ö
, **
out
, 
size_t
 *
ouéí
)

1530 *
£p
, *
°¨t
, *
íd
;

1531 
size_t
 
i
, 
j
, 
îr
;

1532 
size_t
 
Àn
;

1533 *
b64
;

1536 
£p
 = 
	`°r°r
(
ö
, "-----");

1537 if(
£p
 =
NULL
)

1539 
£p
 = 
	`°r°r
(sep + 1, "-----");

1540 if(
£p
 =
NULL
)

1543 
°¨t
 = 
£p
 + 5;

1546 
íd
 = 
	`°r°r
(
°¨t
, "-----");

1547 if(
íd
 =
NULL
)

1550 
Àn
 = 
íd
 - 
°¨t
;

1551 *
out
 = 
	`mÆloc
(
Àn
);

1552 if(!*
out
)

1555 
b64
 = 
	`mÆloc
(
Àn
 + 1);

1556 if(!
b64
) {

1557 
	`‰ì
(*
out
);

1562 
i
 = 0, 
j
 = 0; i < 
Àn
; i++) {

1563 if(
°¨t
[
i
] != '\r' && start[i] != '\n')

1564 
b64
[
j
++] = 
°¨t
[
i
];

1566 
b64
[
j
] = '\0';

1568 
îr
 = 
	`Cuæ_ba£64_decode
((c⁄° *)
b64
, 
out
, 
ouéí
);

1569 
	`‰ì
(
b64
);

1570 if(
îr
) {

1571 
	`‰ì
(*
out
);

1576 
	}
}

1578 
	$ªad_˚π
(c⁄° *
fûe
, **
out
, 
size_t
 *
ouéí
)

1580 
fd
;

1581 
ssize_t
 
n
, 
Àn
 = 0, 
ˇp
 = 512;

1582 
size_t
 
dîÀn
;

1583 
buf
[
ˇp
], *
d©a
, *
dî
;

1585 
fd
 = 
	`›í
(
fûe
, 0);

1586 if(
fd
 < 0)

1589 
d©a
 = 
	`mÆloc
(
ˇp
);

1590 if(!
d©a
) {

1591 
	`˛o£
(
fd
);

1596 
n
 = 
	`ªad
(
fd
, 
buf
, (buf));

1597 if(
n
 < 0) {

1598 
	`˛o£
(
fd
);

1599 
	`‰ì
(
d©a
);

1602 if(
n
 == 0) {

1603 
	`˛o£
(
fd
);

1607 if(
Àn
 + 
n
 >
ˇp
) {

1608 
ˇp
 *= 2;

1609 
d©a
 = 
	`ªÆloc
(d©a, 
ˇp
);

1610 if(!
d©a
) {

1611 
	`˛o£
(
fd
);

1616 
	`mem˝y
(
d©a
 + 
Àn
, 
buf
, 
n
);

1617 
Àn
 +
n
;

1619 
d©a
[
Àn
] = '\0';

1625 if(
	`≥m_to_dî
((c⁄° *)
d©a
, &
dî
, &
dîÀn
) == 0) {

1626 
	`‰ì
(
d©a
);

1627 
d©a
 = 
dî
;

1628 
Àn
 = 
dîÀn
;

1631 *
out
 = 
d©a
;

1632 *
ouéí
 = 
Àn
;

1635 
	}
}

1637 
	$s¶îr_to_cuæîr
(
Sessi⁄H™dÀ
 *
d©a
, 
îr
)

1639 
îr
) {

1640 
îrSSLXCîtChaöInvÆid
:

1641 
	`Áûf
(
d©a
, "SSL certificateÖroblem: Invalid certificate chain");

1642  
CURLE_SSL_CACERT
;

1643 
îrSSLUnknownRoŸCît
:

1644 
	`Áûf
(
d©a
, "SSL certificateÖroblem: UntrustedÑoot certificate");

1645  
CURLE_SSL_CACERT
;

1646 
îrSSLNoRoŸCît
:

1647 
	`Áûf
(
d©a
, "SSL certificateÖroblem: NoÑoot certificate");

1648  
CURLE_SSL_CACERT
;

1649 
îrSSLCîtExpúed
:

1650 
	`Áûf
(
d©a
, "SSL certificateÖroblem: Certificate chain hadán "

1652  
CURLE_SSL_CACERT
;

1653 
îrSSLBadCît
:

1654 
	`Áûf
(
d©a
, "SSL certificateÖroblem: Couldn't understandÅhe server "

1656  
CURLE_SSL_CONNECT_ERROR
;

1657 
îrSSLHo°NameMism©ch
:

1658 
	`Áûf
(
d©a
, "SSL certificateÖeer hostname mismatch");

1659  
CURLE_PEER_FAILED_VERIFICATION
;

1661 
	`Áûf
(
d©a
, "SSL u√x≥˘ed cîtifiˇãÉº‹ %d", 
îr
);

1662  
CURLE_SSL_CACERT
;

1664 
	}
}

1666 
	$vîify_˚π
(c⁄° *
ˇfûe
, 
Sessi⁄H™dÀ
 *
d©a
,

1667 
SSLC⁄ãxtRef
 
˘x
)

1669 *
˚πbuf
;

1670 
size_t
 
buÊí
;

1671 if(
	`ªad_˚π
(
ˇfûe
, &
˚πbuf
, &
buÊí
) < 0) {

1672 
	`Áûf
(
d©a
, "SSL: failedÅoÑead or invalid CA certificate");

1673  
CURLE_SSL_CACERT
;

1676 
CFD©aRef
 
˚πd©a
 = 
	`CFD©aCª©e
(
kCFAŒoˇt‹DeÁu…
, 
˚πbuf
, 
buÊí
);

1677 
	`‰ì
(
˚πbuf
);

1678 if(!
˚πd©a
) {

1679 
	`Áûf
(
d©a
, "SSL: failedÅoállocateárray for CA certificate");

1680  
CURLE_OUT_OF_MEMORY
;

1683 
SecCîtifiˇãRef
 
ˇ˚π
 = 
	`SecCîtifiˇãCª©eWôhD©a
(
kCFAŒoˇt‹DeÁu…
,

1684 
˚πd©a
);

1685 
	`CFRñó£
(
˚πd©a
);

1686 if(!
ˇ˚π
) {

1687 
	`Áûf
(
d©a
, "SSL: failedÅo create SecCertificate from CA certificate");

1688  
CURLE_SSL_CACERT
;

1691 
SecTru°Ref
 
åu°
;

1692 
OSSètus
 
ªt
 = 
	`SSLC›yPìrTru°
(
˘x
, &
åu°
);

1693 if(
åu°
 =
NULL
) {

1694 
	`Áûf
(
d©a
, "SSL:Érror getting certificate chain");

1695  
CURLE_OUT_OF_MEMORY
;

1697 if(
ªt
 !
noEº
) {

1698  
	`s¶îr_to_cuæîr
(
d©a
, 
ªt
);

1701 
CFMuèbÀAºayRef
 
¨øy
 = 
	`CFAºayCª©eMuèbÀ
(
kCFAŒoˇt‹DeÁu…
, 0,

1702 &
kCFTy≥AºayCÆlBacks
);

1703 
	`CFAºayAµídVÆue
(
¨øy
, 
ˇ˚π
);

1704 
	`CFRñó£
(
ˇ˚π
);

1706 
ªt
 = 
	`SecTru°SëAnch‹Cîtifiˇãs
(
åu°
, 
¨øy
);

1707 if(
ªt
 !
noEº
) {

1708 
	`CFRñó£
(
åu°
);

1709  
	`s¶îr_to_cuæîr
(
d©a
, 
ªt
);

1712 
SecTru°Resu…Ty≥
 
åu°_evÆ
 = 0;

1713 
ªt
 = 
	`SecTru°EvÆu©e
(
åu°
, &
åu°_evÆ
);

1714 
	`CFRñó£
(
¨øy
);

1715 
	`CFRñó£
(
åu°
);

1716 if(
ªt
 !
noEº
) {

1717  
	`s¶îr_to_cuæîr
(
d©a
, 
ªt
);

1720 
åu°_evÆ
) {

1721 
kSecTru°Resu…Un•ecifõd
:

1722 
kSecTru°Resu…Pro˚ed
:

1723 
	`öfof
(
d©a
, "SSL: certificate verification succeeded (result: %d)",

1724 
åu°_evÆ
);

1725  
CURLE_OK
;

1727 
kSecTru°Resu…RecovîabÀTru°Faûuª
:

1728 
kSecTru°Resu…Díy
:

1730 
	`Áûf
(
d©a
, "SSL: certificate verification failed (result: %d)",

1731 
åu°_evÆ
);

1732  
CURLE_PEER_FAILED_VERIFICATION
;

1734 
	}
}

1736 
CURLcode


1737 
	$d¨wös¶_c⁄√˘_°ï2
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1739 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1740 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1741 
OSSètus
 
îr
;

1742 
SSLCùhîSuôe
 
cùhî
;

1743 
SSLPrŸocﬁ
 
¥Ÿocﬁ
 = 0;

1745 
	`DEBUGASSERT
(
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e


1746 || 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e


1747 || 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
);

1750 
îr
 = 
	`SSLH™dshake
(
c⁄ns¶
->
s¶_˘x
);

1752 if(
îr
 !
noEº
) {

1753 
îr
) {

1754 
îrSSLWouldBlock
:

1755 
c⁄ns¶
->
c⁄√˘ög_°©e
 = c⁄ns¶->
s¶_dúe˘i⁄
 ?

1756 
s¶_c⁄√˘_2_wrôög
 : 
s¶_c⁄√˘_2_ªadög
;

1757  
CURLE_OK
;

1762 if(
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]) {

1763 
ªs
 = 
	`vîify_˚π
(
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
], data,

1764 
c⁄ns¶
->
s¶_˘x
);

1765 if(
ªs
 !
CURLE_OK
)

1766  
ªs
;

1769  
	`d¨wös¶_c⁄√˘_°ï2
(
c⁄n
, 
socködex
);

1772 
îrSSLXCîtChaöInvÆid
:

1773 
	`Áûf
(
d©a
, "SSL certificateÖroblem: Invalid certificate chain");

1774  
CURLE_SSL_CACERT
;

1775 
îrSSLUnknownRoŸCît
:

1776 
	`Áûf
(
d©a
, "SSL certificateÖroblem: UntrustedÑoot certificate");

1777  
CURLE_SSL_CACERT
;

1778 
îrSSLNoRoŸCît
:

1779 
	`Áûf
(
d©a
, "SSL certificateÖroblem: NoÑoot certificate");

1780  
CURLE_SSL_CACERT
;

1781 
îrSSLCîtExpúed
:

1782 
	`Áûf
(
d©a
, "SSL certificateÖroblem: Certificate chain hadán "

1784  
CURLE_SSL_CACERT
;

1785 
îrSSLBadCît
:

1786 
	`Áûf
(
d©a
, "SSL certificateÖroblem: Couldn't understandÅhe server "

1788  
CURLE_SSL_CONNECT_ERROR
;

1791 
îrSecAuthFaûed
:

1792 
	`Áûf
(
d©a
, "SSLáuthentication failed");

1793  
CURLE_SSL_CONNECT_ERROR
;

1794 
îrSSLPìrH™dshakeFaû
:

1795 
	`Áûf
(
d©a
, "SSLÖeer handshake failed,Åhe server mostÜikely "

1797  
CURLE_SSL_CONNECT_ERROR
;

1798 
îrSSLPìrUnknownCA
:

1799 
	`Áûf
(
d©a
, "SSL serverÑejectedÅhe client certificate dueÅo "

1802  
CURLE_SSL_CONNECT_ERROR
;

1806 
îrSSLHo°NameMism©ch
:

1807 
	`Áûf
(
d©a
, "SSL certificateÖeer verification failed,Åhe "

1808 "˚πifiˇã didÇŸ m©ch \"%s\"\n", 
c⁄n
->
ho°
.
di•«me
);

1809  
CURLE_PEER_FAILED_VERIFICATION
;

1812 
îrSSLC⁄√˘i⁄Refu£d
:

1813 
	`Áûf
(
d©a
, "Server droppedÅhe connection duringÅhe SSL handshake");

1814  
CURLE_SSL_CONNECT_ERROR
;

1815 
îrSSLClo£dAb‹t
:

1816 
	`Áûf
(
d©a
, "ServerábortedÅhe SSL handshake");

1817  
CURLE_SSL_CONNECT_ERROR
;

1818 
îrSSLNegŸüti⁄
:

1819 
	`Áûf
(
d©a
, "CouldÇotÇegotiateán SSL cipher suite withÅhe server");

1820  
CURLE_SSL_CONNECT_ERROR
;

1822 
∑ømEº
: 
îrSSLI¡î«l
:

1823 
	`Áûf
(
d©a
, "Internal SSLÉngineÉrrorÉncountered duringÅhe "

1825  
CURLE_SSL_CONNECT_ERROR
;

1826 
îrSSLF©ÆAÀπ
:

1827 
	`Áûf
(
d©a
, "Fatal SSLÉngineÉrrorÉncountered duringÅhe SSL "

1829  
CURLE_SSL_CONNECT_ERROR
;

1831 
	`Áûf
(
d©a
, "Unknown SSLÖrotocolÉrror in connectionÅo %s:%d",

1832 
c⁄n
->
ho°
.
«me
, 
îr
);

1833  
CURLE_SSL_CONNECT_ERROR
;

1838 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_3
;

1841 ()
	`SSLGëNegŸüãdCùhî
(
c⁄ns¶
->
s¶_˘x
, &
cùhî
);

1842 ()
	`SSLGëNegŸüãdPrŸocﬁVîsi⁄
(
c⁄ns¶
->
s¶_˘x
, &
¥Ÿocﬁ
);

1843 
¥Ÿocﬁ
) {

1844 
kSSLPrŸocﬁ2
:

1845 
	`öfof
(
d©a
, "SSL 2.0 connection using %s\n",

1846 
	`SSLCùhîNameF‹Numbî
(
cùhî
));

1848 
kSSLPrŸocﬁ3
:

1849 
	`öfof
(
d©a
, "SSL 3.0 connection using %s\n",

1850 
	`SSLCùhîNameF‹Numbî
(
cùhî
));

1852 
kTLSPrŸocﬁ1
:

1853 
	`öfof
(
d©a
, "TLS 1.0 connection using %s\n",

1854 
	`TLSCùhîNameF‹Numbî
(
cùhî
));

1856 #i‡
CURL_BUILD_MAC_10_8
 || 
CURL_BUILD_IOS


1857 
kTLSPrŸocﬁ11
:

1858 
	`öfof
(
d©a
, "TLS 1.1 connection using %s\n",

1859 
	`TLSCùhîNameF‹Numbî
(
cùhî
));

1861 
kTLSPrŸocﬁ12
:

1862 
	`öfof
(
d©a
, "TLS 1.2 connection using %s\n",

1863 
	`TLSCùhîNameF‹Numbî
(
cùhî
));

1867 
	`öfof
(
d©a
, "UnknownÖrotocol connection\n");

1871  
CURLE_OK
;

1873 
	}
}

1875 
CURLcode


1876 
	$d¨wös¶_c⁄√˘_°ï3
(
c⁄√˘d©a
 *
c⁄n
,

1877 
socködex
)

1879 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1880 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1881 
CFSåögRef
 
£rvî_˚π_summ¨y
;

1882 
£rvî_˚π_summ¨y_c
[128];

1883 
CFAºayRef
 
£rvî_˚πs
 = 
NULL
;

1884 
SecCîtifiˇãRef
 
£rvî_˚π
;

1885 
OSSètus
 
îr
;

1886 
CFIndex
 
i
, 
cou¡
;

1887 
SecTru°Ref
 
åu°
 = 
NULL
;

1892 #i‡
CURL_BUILD_MAC_10_7
 || 
CURL_BUILD_IOS


1893 #i‡
CURL_BUILD_IOS


1894 #¥agm®
	`unu£d
(
£rvî_˚πs
)

1895 
îr
 = 
	`SSLC›yPìrTru°
(
c⁄ns¶
->
s¶_˘x
, &
åu°
);

1898 if(
îr
 =
noEº
 && 
åu°
) {

1899 
cou¡
 = 
	`SecTru°GëCîtifiˇãCou¡
(
åu°
);

1900 
i
 = 0L ; i < 
cou¡
 ; i++) {

1901 
£rvî_˚π
 = 
	`SecTru°GëCîtifiˇãAtIndex
(
åu°
, 
i
);

1902 
£rvî_˚π_summ¨y
 = 
	`C›yCîtSubje˘
(
£rvî_˚π
);

1903 
	`mem£t
(
£rvî_˚π_summ¨y_c
, 0, 128);

1904 if(
	`CFSåögGëCSåög
(
£rvî_˚π_summ¨y
,

1905 
£rvî_˚π_summ¨y_c
,

1907 
kCFSåögEncodögUTF8
)) {

1908 
	`öfof
(
d©a
, "Sîvî cîtifiˇã: %s\n", 
£rvî_˚π_summ¨y_c
);

1910 
	`CFRñó£
(
£rvî_˚π_summ¨y
);

1912 
	`CFRñó£
(
åu°
);

1921 if(
SecTru°EvÆu©eAsync
 !
NULL
) {

1922 #¥agm®
	`unu£d
(
£rvî_˚πs
)

1923 
îr
 = 
	`SSLC›yPìrTru°
(
c⁄ns¶
->
s¶_˘x
, &
åu°
);

1926 if(
îr
 =
noEº
 && 
åu°
) {

1927 
cou¡
 = 
	`SecTru°GëCîtifiˇãCou¡
(
åu°
);

1928 
i
 = 0L ; i < 
cou¡
 ; i++) {

1929 
£rvî_˚π
 = 
	`SecTru°GëCîtifiˇãAtIndex
(
åu°
, 
i
);

1930 
£rvî_˚π_summ¨y
 = 
	`C›yCîtSubje˘
(
£rvî_˚π
);

1931 
	`mem£t
(
£rvî_˚π_summ¨y_c
, 0, 128);

1932 if(
	`CFSåögGëCSåög
(
£rvî_˚π_summ¨y
,

1933 
£rvî_˚π_summ¨y_c
,

1935 
kCFSåögEncodögUTF8
)) {

1936 
	`öfof
(
d©a
, "Sîvî cîtifiˇã: %s\n", 
£rvî_˚π_summ¨y_c
);

1938 
	`CFRñó£
(
£rvî_˚π_summ¨y
);

1940 
	`CFRñó£
(
åu°
);

1944 #i‡
CURL_SUPPORT_MAC_10_8


1945 
îr
 = 
	`SSLC›yPìrCîtifiˇãs
(
c⁄ns¶
->
s¶_˘x
, &
£rvî_˚πs
);

1947 if(
îr
 =
noEº
 && 
£rvî_˚πs
) {

1948 
cou¡
 = 
	`CFAºayGëCou¡
(
£rvî_˚πs
);

1949 
i
 = 0L ; i < 
cou¡
 ; i++) {

1950 
£rvî_˚π
 = (
SecCîtifiˇãRef
)
	`CFAºayGëVÆueAtIndex
(
£rvî_˚πs
,

1951 
i
);

1953 
£rvî_˚π_summ¨y
 = 
	`C›yCîtSubje˘
(
£rvî_˚π
);

1954 
	`mem£t
(
£rvî_˚π_summ¨y_c
, 0, 128);

1955 if(
	`CFSåögGëCSåög
(
£rvî_˚π_summ¨y
,

1956 
£rvî_˚π_summ¨y_c
,

1958 
kCFSåögEncodögUTF8
)) {

1959 
	`öfof
(
d©a
, "Sîvî cîtifiˇã: %s\n", 
£rvî_˚π_summ¨y_c
);

1961 
	`CFRñó£
(
£rvî_˚π_summ¨y
);

1963 
	`CFRñó£
(
£rvî_˚πs
);

1969 #¥agm®
	`unu£d
(
åu°
)

1970 
îr
 = 
	`SSLC›yPìrCîtifiˇãs
(
c⁄ns¶
->
s¶_˘x
, &
£rvî_˚πs
);

1971 if(
îr
 =
noEº
) {

1972 
cou¡
 = 
	`CFAºayGëCou¡
(
£rvî_˚πs
);

1973 
i
 = 0L ; i < 
cou¡
 ; i++) {

1974 
£rvî_˚π
 = (
SecCîtifiˇãRef
)
	`CFAºayGëVÆueAtIndex
(
£rvî_˚πs
, 
i
);

1975 
£rvî_˚π_summ¨y
 = 
	`C›yCîtSubje˘
(
£rvî_˚π
);

1976 
	`mem£t
(
£rvî_˚π_summ¨y_c
, 0, 128);

1977 if(
	`CFSåögGëCSåög
(
£rvî_˚π_summ¨y
,

1978 
£rvî_˚π_summ¨y_c
,

1980 
kCFSåögEncodögUTF8
)) {

1981 
	`öfof
(
d©a
, "Sîvî cîtifiˇã: %s\n", 
£rvî_˚π_summ¨y_c
);

1983 
	`CFRñó£
(
£rvî_˚π_summ¨y
);

1985 
	`CFRñó£
(
£rvî_˚πs
);

1989 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_d⁄e
;

1990  
CURLE_OK
;

1991 
	}
}

1993 
Cuæ_ªcv
 
	gd¨wös¶_ªcv
;

1994 
Cuæ_£nd
 
	gd¨wös¶_£nd
;

1996 
CURLcode


1997 
	$d¨wös¶_c⁄√˘_comm⁄
(
c⁄√˘d©a
 *
c⁄n
,

1998 
socködex
,

1999 
boﬁ
 
n⁄blockög
,

2000 
boﬁ
 *
d⁄e
)

2002 
CURLcode
 
ªtcode
;

2003 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2004 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

2005 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
socködex
];

2006 
timeout_ms
;

2007 
wh©
;

2010 if(
s¶_c⁄√˘i⁄_com∂ëe
 =
c⁄ns¶
->
°©e
) {

2011 *
d⁄e
 = 
TRUE
;

2012  
CURLE_OK
;

2015 if(
s¶_c⁄√˘_1
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

2017 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

2019 if(
timeout_ms
 < 0) {

2021 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

2022  
CURLE_OPERATION_TIMEDOUT
;

2024 
ªtcode
 = 
	`d¨wös¶_c⁄√˘_°ï1
(
c⁄n
, 
socködex
);

2025 if(
ªtcode
)

2026  
ªtcode
;

2029 
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

2030 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

2031 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
) {

2034 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

2036 if(
timeout_ms
 < 0) {

2038 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

2039  
CURLE_OPERATION_TIMEDOUT
;

2043 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_ªadög


2044 || 
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_wrôög
) {

2046 
cuæ_sockë_t
 
wrôefd
 = 
s¶_c⁄√˘_2_wrôög
 ==

2047 
c⁄ns¶
->
c⁄√˘ög_°©e
?
sockfd
:
CURL_SOCKET_BAD
;

2048 
cuæ_sockë_t
 
ªadfd
 = 
s¶_c⁄√˘_2_ªadög
 ==

2049 
c⁄ns¶
->
c⁄√˘ög_°©e
?
sockfd
:
CURL_SOCKET_BAD
;

2051 
wh©
 = 
	`Cuæ_sockë_ªady
(
ªadfd
, 
wrôefd
, 
n⁄blockög
?0:
timeout_ms
);

2052 if(
wh©
 < 0) {

2054 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

2055  
CURLE_SSL_CONNECT_ERROR
;

2057 if(0 =
wh©
) {

2058 if(
n⁄blockög
) {

2059 *
d⁄e
 = 
FALSE
;

2060  
CURLE_OK
;

2064 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

2065  
CURLE_OPERATION_TIMEDOUT
;

2077 
ªtcode
 = 
	`d¨wös¶_c⁄√˘_°ï2
(
c⁄n
, 
socködex
);

2078 if(
ªtcode
 || (
n⁄blockög
 &&

2079 (
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

2080 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

2081 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
)))

2082  
ªtcode
;

2087 if(
s¶_c⁄√˘_3
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

2088 
ªtcode
 = 
	`d¨wös¶_c⁄√˘_°ï3
(
c⁄n
, 
socködex
);

2089 if(
ªtcode
)

2090  
ªtcode
;

2093 if(
s¶_c⁄√˘_d⁄e
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

2094 
c⁄ns¶
->
°©e
 = 
s¶_c⁄√˘i⁄_com∂ëe
;

2095 
c⁄n
->
ªcv
[
socködex
] = 
d¨wös¶_ªcv
;

2096 
c⁄n
->
£nd
[
socködex
] = 
d¨wös¶_£nd
;

2097 *
d⁄e
 = 
TRUE
;

2100 *
d⁄e
 = 
FALSE
;

2103 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

2105  
CURLE_OK
;

2106 
	}
}

2108 
CURLcode


2109 
	$Cuæ_d¨wös¶_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

2110 
socködex
,

2111 
boﬁ
 *
d⁄e
)

2113  
	`d¨wös¶_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
TRUE
, 
d⁄e
);

2114 
	}
}

2116 
CURLcode


2117 
	$Cuæ_d¨wös¶_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

2118 
socködex
)

2120 
CURLcode
 
ªtcode
;

2121 
boﬁ
 
d⁄e
 = 
FALSE
;

2123 
ªtcode
 = 
	`d¨wös¶_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
FALSE
, &
d⁄e
);

2125 if(
ªtcode
)

2126  
ªtcode
;

2128 
	`DEBUGASSERT
(
d⁄e
);

2130  
CURLE_OK
;

2131 
	}
}

2133 
	$Cuæ_d¨wös¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

2135 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

2137 if(
c⁄ns¶
->
s¶_˘x
) {

2138 ()
	`SSLClo£
(
c⁄ns¶
->
s¶_˘x
);

2139 #i‡
CURL_BUILD_MAC_10_8
 || 
CURL_BUILD_IOS


2140 if(
SSLCª©eC⁄ãxt
 !
NULL
)

2141 
	`CFRñó£
(
c⁄ns¶
->
s¶_˘x
);

2142 #i‡
CURL_SUPPORT_MAC_10_8


2144 ()
	`SSLDi•o£C⁄ãxt
(
c⁄ns¶
->
s¶_˘x
);

2147 ()
	`SSLDi•o£C⁄ãxt
(
c⁄ns¶
->
s¶_˘x
);

2149 
c⁄ns¶
->
s¶_˘x
 = 
NULL
;

2151 
c⁄ns¶
->
s¶_sockfd
 = 0;

2152 
	}
}

2154 
	$Cuæ_d¨wös¶_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
)

2157 ()
d©a
;

2158 
	}
}

2160 
	$Cuæ_d¨wös¶_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

2162 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

2163 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2164 
ssize_t
 
ƒód
;

2165 
wh©
;

2166 
rc
;

2167 
buf
[120];

2169 if(!
c⁄ns¶
->
s¶_˘x
)

2172 if(
d©a
->
£t
.
·p_ccc
 !
CURLFTPSSL_CCC_ACTIVE
)

2175 
	`Cuæ_d¨wös¶_˛o£
(
c⁄n
, 
socködex
);

2177 
rc
 = 0;

2179 
wh©
 = 
	`Cuæ_sockë_ªady
(
c⁄n
->
sock
[
socködex
],

2180 
CURL_SOCKET_BAD
, 
SSL_SHUTDOWN_TIMEOUT
);

2183 if(
wh©
 < 0) {

2185 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

2186 
rc
 = -1;

2190 if(!
wh©
) {

2191 
	`Áûf
(
d©a
, "SSL shutdownÅimeout");

2198 
ƒód
 = 
	`ªad
(
c⁄n
->
sock
[
socködex
], 
buf
, (buf));

2200 if(
ƒód
 < 0) {

2201 
	`Áûf
(
d©a
, "ªad: %s", 
	`°ªº‹
(
î∫o
));

2202 
rc
 = -1;

2205 if(
ƒód
 <= 0)

2208 
wh©
 = 
	`Cuæ_sockë_ªady
(
c⁄n
->
sock
[
socködex
], 
CURL_SOCKET_BAD
, 0);

2211  
rc
;

2212 
	}
}

2214 
	$Cuæ_d¨wös¶_£ssi⁄_‰ì
(*
±r
)

2222 
	`Cuæ_ß„‰ì
(
±r
);

2223 
	}
}

2225 
size_t
 
	$Cuæ_d¨wös¶_vîsi⁄
(*
buf„r
, 
size_t
 
size
)

2227  
	`¢¥ötf
(
buf„r
, 
size
, "SecureTransport");

2228 
	}
}

2238 
	$Cuæ_d¨wös¶_check_cxn
(
c⁄√˘d©a
 *
c⁄n
)

2240 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
FIRSTSOCKET
];

2241 
OSSètus
 
îr
;

2242 
SSLSessi⁄Sèã
 
°©e
;

2244 if(
c⁄ns¶
->
s¶_˘x
) {

2245 
îr
 = 
	`SSLGëSessi⁄Sèã
(
c⁄ns¶
->
s¶_˘x
, &
°©e
);

2246 if(
îr
 =
noEº
)

2247  
°©e
 =
kSSLC⁄√˘ed
 || sèã =
kSSLH™dshake
;

2251 
	}
}

2253 
boﬁ
 
	$Cuæ_d¨wös¶_d©a_≥ndög
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

2254 
c⁄nödex
)

2256 c⁄° 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
c⁄nödex
];

2257 
OSSètus
 
îr
;

2258 
size_t
 
buf„r
;

2260 if(
c⁄ns¶
->
s¶_˘x
) {

2261 
îr
 = 
	`SSLGëBuf„ªdRódSize
(
c⁄ns¶
->
s¶_˘x
, &
buf„r
);

2262 if(
îr
 =
noEº
)

2263  
buf„r
 > 0UL;

2264  
Ál£
;

2267  
Ál£
;

2268 
	}
}

2270 
	$Cuæ_d¨wös¶_øndom
(
Sessi⁄H™dÀ
 *
d©a
,

2271 *
íå›y
,

2272 
size_t
 
Àngth
)

2276 
size_t
 
i
;

2277 
u_öt32_t
 
øndom_numbî
 = 0;

2279 
i
 = 0 ; i < 
Àngth
 ; i++) {

2280 if(
i
 % (
u_öt32_t
) == 0)

2281 
øndom_numbî
 = 
	`¨c4øndom
();

2282 
íå›y
[
i
] = 
øndom_numbî
 & 0xFF;

2283 
øndom_numbî
 >>= 8;

2285 
i
 = 
øndom_numbî
 = 0;

2286 ()
d©a
;

2287 
	}
}

2289 
	$Cuæ_d¨wös¶_md5sum
(*
tmp
,

2290 
size_t
 
tm∂í
,

2291 *
md5sum
,

2292 
size_t
 
md5Àn
)

2294 ()
md5Àn
;

2295 ()
	`CC_MD5
(
tmp
, (
CC_LONG
)
tm∂í
, 
md5sum
);

2296 
	}
}

2298 
ssize_t
 
	$d¨wös¶_£nd
(
c⁄√˘d©a
 *
c⁄n
,

2299 
socködex
,

2300 c⁄° *
mem
,

2301 
size_t
 
Àn
,

2302 
CURLcode
 *
cuæcode
)

2305 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

2306 
size_t
 
¥o˚s£d
 = 0UL;

2307 
OSSètus
 
îr
;

2324 if(
c⁄ns¶
->
s¶_wrôe_buf„ªd_Àngth
) {

2326 
îr
 = 
	`SSLWrôe
(
c⁄ns¶
->
s¶_˘x
, 
NULL
, 0UL, &
¥o˚s£d
);

2327 
îr
) {

2328 
noEº
:

2331 
¥o˚s£d
 = 
c⁄ns¶
->
s¶_wrôe_buf„ªd_Àngth
;

2332 
c⁄ns¶
->
s¶_wrôe_buf„ªd_Àngth
 = 0UL;

2334 
îrSSLWouldBlock
:

2335 *
cuæcode
 = 
CURLE_AGAIN
;

2338 
	`Áûf
(
c⁄n
->
d©a
, "SSLWrôe(Ëªtu∫edÉº‹ %d", 
îr
);

2339 *
cuæcode
 = 
CURLE_SEND_ERROR
;

2345 
îr
 = 
	`SSLWrôe
(
c⁄ns¶
->
s¶_˘x
, 
mem
, 
Àn
, &
¥o˚s£d
);

2346 if(
îr
 !
noEº
) {

2347 
îr
) {

2348 
îrSSLWouldBlock
:

2351 
c⁄ns¶
->
s¶_wrôe_buf„ªd_Àngth
 = 
Àn
;

2352 *
cuæcode
 = 
CURLE_AGAIN
;

2355 
	`Áûf
(
c⁄n
->
d©a
, "SSLWrôe(Ëªtu∫edÉº‹ %d", 
îr
);

2356 *
cuæcode
 = 
CURLE_SEND_ERROR
;

2361  (
ssize_t
)
¥o˚s£d
;

2362 
	}
}

2364 
ssize_t
 
	$d¨wös¶_ªcv
(
c⁄√˘d©a
 *
c⁄n
,

2365 
num
,

2366 *
buf
,

2367 
size_t
 
buf„rsize
,

2368 
CURLcode
 *
cuæcode
)

2371 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
num
];

2372 
size_t
 
¥o˚s£d
 = 0UL;

2373 
OSSètus
 
îr
 = 
	`SSLRód
(
c⁄ns¶
->
s¶_˘x
, 
buf
, 
buf„rsize
, &
¥o˚s£d
);

2375 if(
îr
 !
noEº
) {

2376 
îr
) {

2377 
îrSSLWouldBlock
:

2378 if(
¥o˚s£d
)

2379  (
ssize_t
)
¥o˚s£d
;

2380 *
cuæcode
 = 
CURLE_AGAIN
;

2388 
îrSSLClo£dGø˚ful
:

2389 
îrSSLClo£dNoNŸify
:

2390 *
cuæcode
 = 
CURLE_OK
;

2395 
	`Áûf
(
c⁄n
->
d©a
, "SSLRód(Ëªtu∫Éº‹ %d", 
îr
);

2396 *
cuæcode
 = 
CURLE_RECV_ERROR
;

2401  (
ssize_t
)
¥o˚s£d
;

2402 
	}
}

	@lib/vtls/curl_darwinssl.h

1 #i‚de‡
HEADER_CURL_DARWINSSL_H


2 
	#HEADER_CURL_DARWINSSL_H


	)

24 
	~"cuæ_£tup.h
"

26 #ifde‡
USE_DARWINSSL


28 
CURLcode
 
Cuæ_d¨wös¶_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

30 
CURLcode
 
Cuæ_d¨wös¶_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

31 
socködex
,

32 
boﬁ
 *
d⁄e
);

35 
Cuæ_d¨wös¶_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
);

38 
Cuæ_d¨wös¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

40 
Cuæ_d¨wös¶_£ssi⁄_‰ì
(*
±r
);

41 
size_t
 
Cuæ_d¨wös¶_vîsi⁄
(*
buf„r
, size_à
size
);

42 
Cuæ_d¨wös¶_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

43 
Cuæ_d¨wös¶_check_cxn
(
c⁄√˘d©a
 *
c⁄n
);

44 
boﬁ
 
Cuæ_d¨wös¶_d©a_≥ndög
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

45 
c⁄nödex
);

47 
Cuæ_d¨wös¶_øndom
(
Sessi⁄H™dÀ
 *
d©a
,

48 *
íå›y
,

49 
size_t
 
Àngth
);

50 
Cuæ_d¨wös¶_md5sum
(*
tmp
,

51 
size_t
 
tm∂í
,

52 *
md5sum
,

53 
size_t
 
md5Àn
);

56 
	#have_cuæs¶_øndom
 1

	)

57 
	#have_cuæs¶_md5sum
 1

	)

60 
	#cuæs¶_öô
(Ë(1)

	)

61 
	#cuæs¶_˛ónup
(Ë
Cuæ_n›_°mt


	)

62 
	#cuæs¶_c⁄√˘
 
Cuæ_d¨wös¶_c⁄√˘


	)

63 
	#cuæs¶_c⁄√˘_n⁄blockög
 
Cuæ_d¨wös¶_c⁄√˘_n⁄blockög


	)

64 
	#cuæs¶_£ssi⁄_‰ì
(
x
Ë
	`Cuæ_d¨wös¶_£ssi⁄_‰ì
(x)

	)

65 
	#cuæs¶_˛o£_Æl
 
Cuæ_d¨wös¶_˛o£_Æl


	)

66 
	#cuæs¶_˛o£
 
Cuæ_d¨wös¶_˛o£


	)

67 
	#cuæs¶_shutdown
(
x
,
y
Ë0

	)

68 
	#cuæs¶_£t_ígöe
(
x
,
y
Ë(x=x, y=y, 
CURLE_NOT_BUILT_IN
)

	)

69 
	#cuæs¶_£t_ígöe_deÁu…
(
x
Ë(x=x, 
CURLE_NOT_BUILT_IN
)

	)

70 
	#cuæs¶_ígöes_li°
(
x
Ë(x=x, (
cuæ_¶i°
 *)
NULL
)

	)

71 
	#cuæs¶_vîsi⁄
 
Cuæ_d¨wös¶_vîsi⁄


	)

72 
	#cuæs¶_check_cxn
 
Cuæ_d¨wös¶_check_cxn


	)

73 
	#cuæs¶_d©a_≥ndög
(
x
,
y
Ë
	`Cuæ_d¨wös¶_d©a_≥ndög
(x, y)

	)

74 
	#cuæs¶_øndom
(
x
,
y
,
z
Ë
	`Cuæ_d¨wös¶_øndom
(x,y,z)

	)

75 
	#cuæs¶_md5sum
(
a
,
b
,
c
,
d
Ë
	`Cuæ_d¨wös¶_md5sum
◊,b,c,d)

	)

	@lib/vtls/curl_schannel.c

54 
	~"cuæ_£tup.h
"

56 #ifde‡
USE_SCHANNEL


58 #i‚de‡
USE_WINDOWS_SSPI


62 
	~"cuæ_s•i.h
"

63 
	~"cuæ_sch™√l.h
"

64 
	~"vés.h
"

65 
	~"£ndf.h
"

66 
	~"c⁄√˘.h
"

67 
	~"°ªº‹.h
"

68 
	~"£À˘.h
"

69 
	~"öë_±⁄.h
"

70 
	~"cuæ_mu…ibyã.h
"

71 
	~"w¨∆ess.h
"

73 
	#_MPRINTF_REPLACE


	)

74 
	~<cuæ/m¥ötf.h
>

76 
	~"cuæ_mem‹y.h
"

78 
	~"memdebug.h
"

85 
Cuæ_ªcv
 
	gsch™√l_ªcv
;

86 
Cuæ_£nd
 
	gsch™√l_£nd
;

88 #ifde‡
_WIN32_WCE


89 
CURLcode
 
vîify_˚πifiˇã
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

92 
	$InôSecBuf„r
(
SecBuf„r
 *
buf„r
, 
BufTy≥
,

93 *
BufD©aPå
, 
BufByãSize
)

95 
buf„r
->
cbBuf„r
 = 
BufByãSize
;

96 
buf„r
->
Buf„rTy≥
 = 
BufTy≥
;

97 
buf„r
->
pvBuf„r
 = 
BufD©aPå
;

98 
	}
}

100 
	$InôSecBuf„rDesc
(
SecBuf„rDesc
 *
desc
, 
SecBuf„r
 *
BufAº
,

101 
NumAºEÀm
)

103 
desc
->
ulVîsi⁄
 = 
SECBUFFER_VERSION
;

104 
desc
->
pBuf„rs
 = 
BufAº
;

105 
desc
->
cBuf„rs
 = 
NumAºEÀm
;

106 
	}
}

108 
CURLcode


109 
	$sch™√l_c⁄√˘_°ï1
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

111 
ssize_t
 
wrôãn
 = -1;

112 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

113 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

114 
SecBuf„r
 
outbuf
;

115 
SecBuf„rDesc
 
outbuf_desc
;

116 
SCHANNEL_CRED
 
sch™√l_¸ed
;

117 
SECURITY_STATUS
 
s•i_°©us
 = 
SEC_E_OK
;

118 
cuæ_sch™√l_¸ed
 *
ﬁd_¸ed
 = 
NULL
;

119 
ö_addr
 
addr
;

120 #ifde‡
ENABLE_IPV6


121 
ö6_addr
 
addr6
;

123 
TCHAR
 *
ho°_«me
;

124 
CURLcode
 
code
;

126 
	`öfof
(
d©a
, "schannel: SSL/TLS connection with %sÖort %hu (step 1/3)\n",

127 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

130 if(!
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, (**)&
ﬁd_¸ed
, 
NULL
)) {

131 
c⁄ns¶
->
¸ed
 = 
ﬁd_¸ed
;

132 
	`öfof
(
d©a
, "schannel:Ñe-usingÉxisting credential handle\n");

136 
	`mem£t
(&
sch™√l_¸ed
, 0, (schannel_cred));

137 
sch™√l_¸ed
.
dwVîsi⁄
 = 
SCHANNEL_CRED_VERSION
;

139 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

140 #ifde‡
_WIN32_WCE


143 
sch™√l_¸ed
.
dwFœgs
 = 
SCH_CRED_MANUAL_CRED_VALIDATION
 |

144 
SCH_CRED_IGNORE_NO_REVOCATION_CHECK
 |

145 
SCH_CRED_IGNORE_REVOCATION_OFFLINE
;

147 
sch™√l_¸ed
.
dwFœgs
 = 
SCH_CRED_AUTO_CRED_VALIDATION
 |

148 
SCH_CRED_REVOCATION_CHECK_CHAIN
;

150 
	`öfof
(
d©a
, "schannel: checking server certificateÑevocation\n");

153 
sch™√l_¸ed
.
dwFœgs
 = 
SCH_CRED_MANUAL_CRED_VALIDATION
 |

154 
SCH_CRED_IGNORE_NO_REVOCATION_CHECK
 |

155 
SCH_CRED_IGNORE_REVOCATION_OFFLINE
;

156 
	`öfof
(
d©a
, "schannel: disable server certificateÑevocation checks\n");

159 if(!
d©a
->
£t
.
s¶
.
vîifyho°
) {

160 
sch™√l_¸ed
.
dwFœgs
 |
SCH_CRED_NO_SERVERNAME_CHECK
;

161 
	`öfof
(
d©a
, "schannel: verifyhost settingÖrevents Schannel from "

166 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

167 
CURL_SSLVERSION_TLSv1
:

168 
sch™√l_¸ed
.
grbôE«bÀdPrŸocﬁs
 = 
SP_PROT_TLS1_0_CLIENT
 |

169 
SP_PROT_TLS1_1_CLIENT
 |

170 
SP_PROT_TLS1_2_CLIENT
;

172 
CURL_SSLVERSION_TLSv1_0
:

173 
sch™√l_¸ed
.
grbôE«bÀdPrŸocﬁs
 = 
SP_PROT_TLS1_0_CLIENT
;

175 
CURL_SSLVERSION_TLSv1_1
:

176 
sch™√l_¸ed
.
grbôE«bÀdPrŸocﬁs
 = 
SP_PROT_TLS1_1_CLIENT
;

178 
CURL_SSLVERSION_TLSv1_2
:

179 
sch™√l_¸ed
.
grbôE«bÀdPrŸocﬁs
 = 
SP_PROT_TLS1_2_CLIENT
;

181 
CURL_SSLVERSION_SSLv3
:

182 
sch™√l_¸ed
.
grbôE«bÀdPrŸocﬁs
 = 
SP_PROT_SSL3_CLIENT
;

184 
CURL_SSLVERSION_SSLv2
:

185 
sch™√l_¸ed
.
grbôE«bÀdPrŸocﬁs
 = 
SP_PROT_SSL2_CLIENT
;

188 
sch™√l_¸ed
.
grbôE«bÀdPrŸocﬁs
 = 
SP_PROT_TLS1_0_CLIENT
 |

189 
SP_PROT_TLS1_1_CLIENT
 |

190 
SP_PROT_TLS1_2_CLIENT
 |

191 
SP_PROT_SSL3_CLIENT
;

196 
c⁄ns¶
->
¸ed
 = (
cuæ_sch™√l_¸ed
 *)

197 
	`mÆloc
((
cuæ_sch™√l_¸ed
));

198 if(!
c⁄ns¶
->
¸ed
) {

199 
	`Áûf
(
d©a
, "schannel: unableÅoállocate memory");

200  
CURLE_OUT_OF_MEMORY
;

202 
	`mem£t
(
c⁄ns¶
->
¸ed
, 0, (
cuæ_sch™√l_¸ed
));

205 
s•i_°©us
 = 
s_pSecFn
->
	`AcquúeCªdítülsH™dÀ
(
NULL
, (
TCHAR
 *)
UNISP_NAME
,

206 
SECPKG_CRED_OUTBOUND
, 
NULL
, &
sch™√l_¸ed
, NULL, NULL,

207 &
c⁄ns¶
->
¸ed
->
¸ed_h™dÀ
, &c⁄ns¶->¸ed->
time_°amp
);

209 if(
s•i_°©us
 !
SEC_E_OK
) {

210 if(
s•i_°©us
 =
SEC_E_WRONG_PRINCIPAL
)

211 
	`Áûf
(
d©a
, "schannel: SNI or certificate check failed: %s",

212 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
s•i_°©us
));

214 
	`Áûf
(
d©a
, "schannel: AcquireCredentialsHandle failed: %s",

215 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
s•i_°©us
));

216 
	`Cuæ_ß„‰ì
(
c⁄ns¶
->
¸ed
);

217  
CURLE_SSL_CONNECT_ERROR
;

222 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
c⁄n
->
ho°
.
«me
, &
addr
)

223 #ifde‡
ENABLE_IPV6


224 || 
	`Cuæ_öë_±⁄
(
AF_INET6
, 
c⁄n
->
ho°
.
«me
, &
addr6
)

227 
	`öfof
(
d©a
, "schannel: using IPáddress, SNI isÇot supported by OS.\n");

231 
	`InôSecBuf„r
(&
outbuf
, 
SECBUFFER_EMPTY
, 
NULL
, 0);

232 
	`InôSecBuf„rDesc
(&
outbuf_desc
, &
outbuf
, 1);

235 
c⁄ns¶
->
ªq_Êags
 = 
ISC_REQ_SEQUENCE_DETECT
 | 
ISC_REQ_REPLAY_DETECT
 |

236 
ISC_REQ_CONFIDENTIALITY
 | 
ISC_REQ_ALLOCATE_MEMORY
 |

237 
ISC_REQ_STREAM
;

240 
c⁄ns¶
->
˘xt
 = (
cuæ_sch™√l_˘xt
 *)

241 
	`mÆloc
((
cuæ_sch™√l_˘xt
));

242 if(!
c⁄ns¶
->
˘xt
) {

243 
	`Áûf
(
d©a
, "schannel: unableÅoállocate memory");

244  
CURLE_OUT_OF_MEMORY
;

246 
	`mem£t
(
c⁄ns¶
->
˘xt
, 0, (
cuæ_sch™√l_˘xt
));

248 
ho°_«me
 = 
	`Cuæ_c⁄vît_UTF8_to_tch¨
(
c⁄n
->
ho°
.
«me
);

249 if(!
ho°_«me
)

250  
CURLE_OUT_OF_MEMORY
;

254 
s•i_°©us
 = 
s_pSecFn
->
	`InôülizeSecurôyC⁄ãxt
(

255 &
c⁄ns¶
->
¸ed
->
¸ed_h™dÀ
, 
NULL
, 
ho°_«me
,

256 
c⁄ns¶
->
ªq_Êags
, 0, 0, 
NULL
, 0, &c⁄ns¶->
˘xt
->
˘xt_h™dÀ
,

257 &
outbuf_desc
, &
c⁄ns¶
->
ªt_Êags
, &c⁄ns¶->
˘xt
->
time_°amp
);

259 
	`Cuæ_unicode‰ì
(
ho°_«me
);

261 if(
s•i_°©us
 !
SEC_I_CONTINUE_NEEDED
) {

262 if(
s•i_°©us
 =
SEC_E_WRONG_PRINCIPAL
)

263 
	`Áûf
(
d©a
, "schannel: SNI or certificate check failed: %s",

264 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
s•i_°©us
));

266 
	`Áûf
(
d©a
, "schannel: initial InitializeSecurityContext failed: %s",

267 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
s•i_°©us
));

268 
	`Cuæ_ß„‰ì
(
c⁄ns¶
->
˘xt
);

269  
CURLE_SSL_CONNECT_ERROR
;

272 
	`öfof
(
d©a
, "schannel: sending initial handshake data: "

273 "£ndög %lu byãs...\n", 
outbuf
.
cbBuf„r
);

276 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, c⁄n->
sock
[
socködex
], 
outbuf
.
pvBuf„r
,

277 
outbuf
.
cbBuf„r
, &
wrôãn
);

278 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
outbuf
.
pvBuf„r
);

279 if((
code
 !
CURLE_OK
Ë|| (
outbuf
.
cbBuf„r
 !(
size_t
)
wrôãn
)) {

280 
	`Áûf
(
d©a
, "schannel: failedÅo send initial handshake data: "

281 "£¡ %zd o‡%lu byãs", 
wrôãn
, 
outbuf
.
cbBuf„r
);

282  
CURLE_SSL_CONNECT_ERROR
;

285 
	`öfof
(
d©a
, "schannel: sent initial handshake data: "

286 "£¡ %zd byãs\n", 
wrôãn
);

289 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2
;

291  
CURLE_OK
;

292 
	}
}

294 
CURLcode


295 
	$sch™√l_c⁄√˘_°ï2
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

297 
i
;

298 
ssize_t
 
ƒód
 = -1, 
wrôãn
 = -1;

299 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

300 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

301 
SecBuf„r
 
outbuf
[2];

302 
SecBuf„rDesc
 
outbuf_desc
;

303 
SecBuf„r
 
öbuf
[2];

304 
SecBuf„rDesc
 
öbuf_desc
;

305 
SECURITY_STATUS
 
s•i_°©us
 = 
SEC_E_OK
;

306 
TCHAR
 *
ho°_«me
;

307 
CURLcode
 
code
;

308 
boﬁ
 
d‹ód
;

310 
d‹ód
 = (
c⁄ns¶
->
c⁄√˘ög_°©e
 !
s¶_c⁄√˘_2_wrôög
Ë? 
TRUE
 : 
FALSE
;

312 
	`öfof
(
d©a
, "schannel: SSL/TLS connection with %sÖort %hu (step 2/3)\n",

313 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

315 if(!
c⁄ns¶
->
¸ed
 || !c⁄ns¶->
˘xt
)

316  
CURLE_SSL_CONNECT_ERROR
;

319 if(
c⁄ns¶
->
ícd©a_buf„r
 =
NULL
) {

320 
c⁄ns¶
->
ícd©a_off£t
 = 0;

321 
c⁄ns¶
->
ícd©a_Àngth
 = 
CURL_SCHANNEL_BUFFER_INIT_SIZE
;

322 
c⁄ns¶
->
ícd©a_buf„r
 = 
	`mÆloc
(c⁄ns¶->
ícd©a_Àngth
);

323 if(
c⁄ns¶
->
ícd©a_buf„r
 =
NULL
) {

324 
	`Áûf
(
d©a
, "schannel: unableÅoállocate memory");

325  
CURLE_OUT_OF_MEMORY
;

330 if(
c⁄ns¶
->
ícd©a_Àngth
 - c⁄ns¶->
ícd©a_off£t
 <

331 
CURL_SCHANNEL_BUFFER_FREE_SIZE
) {

333 
c⁄ns¶
->
ícd©a_Àngth
 *
CURL_SCHANNEL_BUFFER_STEP_FACTOR
;

334 
c⁄ns¶
->
ícd©a_buf„r
 = 
	`ªÆloc
(connssl->encdata_buffer,

335 
c⁄ns¶
->
ícd©a_Àngth
);

337 if(
c⁄ns¶
->
ícd©a_buf„r
 =
NULL
) {

338 
	`Áûf
(
d©a
, "schannel: unableÅoÑe-allocate memory");

339  
CURLE_OUT_OF_MEMORY
;

344 if(
d‹ód
) {

346 
code
 = 
	`Cuæ_ªad_∂aö
(
c⁄n
->
sock
[
socködex
],

347 (*Ë(
c⁄ns¶
->
ícd©a_buf„r
 + c⁄ns¶->
ícd©a_off£t
),

348 
c⁄ns¶
->
ícd©a_Àngth
 - c⁄ns¶->
ícd©a_off£t
,

349 &
ƒód
);

350 if(
code
 =
CURLE_AGAIN
) {

351 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 !
s¶_c⁄√˘_2_wrôög
)

352 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2_ªadög
;

353 
	`öfof
(
d©a
, "schannel: failedÅoÑeceive handshake, "

355  
CURLE_OK
;

357 if((
code
 !
CURLE_OK
Ë|| (
ƒód
 == 0)) {

358 
	`Áûf
(
d©a
, "schannel: failedÅoÑeceive handshake, "

360  
CURLE_SSL_CONNECT_ERROR
;

364 
c⁄ns¶
->
ícd©a_off£t
 +
ƒód
;

367 
	`öfof
(
d©a
, "schannel:Éncrypted data buffer: offset %zuÜength %zu\n",

368 
c⁄ns¶
->
ícd©a_off£t
, c⁄ns¶->
ícd©a_Àngth
);

371 
	`InôSecBuf„r
(&
öbuf
[0], 
SECBUFFER_TOKEN
, 
	`mÆloc
(
c⁄ns¶
->
ícd©a_off£t
),

372 
	`cuæx_uztoul
(
c⁄ns¶
->
ícd©a_off£t
));

373 
	`InôSecBuf„r
(&
öbuf
[1], 
SECBUFFER_EMPTY
, 
NULL
, 0);

374 
	`InôSecBuf„rDesc
(&
öbuf_desc
, 
öbuf
, 2);

377 
	`InôSecBuf„r
(&
outbuf
[0], 
SECBUFFER_TOKEN
, 
NULL
, 0);

378 
	`InôSecBuf„r
(&
outbuf
[1], 
SECBUFFER_ALERT
, 
NULL
, 0);

379 
	`InôSecBuf„rDesc
(&
outbuf_desc
, 
outbuf
, 2);

381 if(
öbuf
[0].
pvBuf„r
 =
NULL
) {

382 
	`Áûf
(
d©a
, "schannel: unableÅoállocate memory");

383  
CURLE_OUT_OF_MEMORY
;

387 
	`mem˝y
(
öbuf
[0].
pvBuf„r
, 
c⁄ns¶
->
ícd©a_buf„r
,

388 
c⁄ns¶
->
ícd©a_off£t
);

390 
ho°_«me
 = 
	`Cuæ_c⁄vît_UTF8_to_tch¨
(
c⁄n
->
ho°
.
«me
);

391 if(!
ho°_«me
)

392  
CURLE_OUT_OF_MEMORY
;

396 
s•i_°©us
 = 
s_pSecFn
->
	`InôülizeSecurôyC⁄ãxt
(

397 &
c⁄ns¶
->
¸ed
->
¸ed_h™dÀ
, &c⁄ns¶->
˘xt
->
˘xt_h™dÀ
,

398 
ho°_«me
, 
c⁄ns¶
->
ªq_Êags
, 0, 0, &
öbuf_desc
, 0, 
NULL
,

399 &
outbuf_desc
, &
c⁄ns¶
->
ªt_Êags
, &c⁄ns¶->
˘xt
->
time_°amp
);

401 
	`Cuæ_unicode‰ì
(
ho°_«me
);

404 
	`Cuæ_ß„‰ì
(
öbuf
[0].
pvBuf„r
);

407 if(
s•i_°©us
 =
SEC_E_INCOMPLETE_MESSAGE
) {

408 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2_ªadög
;

409 
	`öfof
(
d©a
, "schannel:Ñeceived incomplete message,Çeed more data\n");

410  
CURLE_OK
;

414 if(
s•i_°©us
 =
SEC_I_CONTINUE_NEEDED
 || s•i_°©u†=
SEC_E_OK
) {

415 
i
 = 0; i < 2; i++) {

417 if(
outbuf
[
i
].
Buf„rTy≥
 =
SECBUFFER_TOKEN
 && outbuf[i].
cbBuf„r
 > 0) {

418 
	`öfof
(
d©a
, "schannel: sendingÇext handshake data: "

419 "£ndög %lu byãs...\n", 
outbuf
[
i
].
cbBuf„r
);

422 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, c⁄n->
sock
[
socködex
],

423 
outbuf
[
i
].
pvBuf„r
, outbuf[i].
cbBuf„r
,

424 &
wrôãn
);

425 if((
code
 !
CURLE_OK
Ë|| (
outbuf
[
i
].
cbBuf„r
 !(
size_t
)
wrôãn
)) {

426 
	`Áûf
(
d©a
, "schannel: failedÅo sendÇext handshake data: "

427 "£¡ %zd o‡%lu byãs", 
wrôãn
, 
outbuf
[
i
].
cbBuf„r
);

428  
CURLE_SSL_CONNECT_ERROR
;

433 if(
outbuf
[
i
].
pvBuf„r
 !
NULL
) {

434 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
outbuf
[
i
].
pvBuf„r
);

439 if(
s•i_°©us
 =
SEC_E_WRONG_PRINCIPAL
)

440 
	`Áûf
(
d©a
, "schannel: SNI or certificate check failed: %s",

441 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
s•i_°©us
));

443 
	`Áûf
(
d©a
, "schannel:Çext InitializeSecurityContext failed: %s",

444 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
s•i_°©us
));

445  
CURLE_SSL_CONNECT_ERROR
;

449 if(
öbuf
[1].
Buf„rTy≥
 =
SECBUFFER_EXTRA
 && inbuf[1].
cbBuf„r
 > 0) {

450 
	`öfof
(
d©a
, "sch™√l:Én¸y±ed d©®Àngth: %lu\n", 
öbuf
[1].
cbBuf„r
);

463 if(
c⁄ns¶
->
ícd©a_off£t
 > 
öbuf
[1].
cbBuf„r
) {

464 
	`memmove
(
c⁄ns¶
->
ícd©a_buf„r
,

465 (
c⁄ns¶
->
ícd©a_buf„r
 + c⁄ns¶->
ícd©a_off£t
) -

466 
öbuf
[1].
cbBuf„r
, inbuf[1].cbBuffer);

467 
c⁄ns¶
->
ícd©a_off£t
 = 
öbuf
[1].
cbBuf„r
;

468 if(
s•i_°©us
 =
SEC_I_CONTINUE_NEEDED
) {

469 
d‹ód
 = 
FALSE
;

475 
c⁄ns¶
->
ícd©a_off£t
 = 0;

481 if(
s•i_°©us
 =
SEC_I_CONTINUE_NEEDED
) {

482 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2_ªadög
;

483  
CURLE_OK
;

487 if(
s•i_°©us
 =
SEC_E_OK
) {

488 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_3
;

489 
	`öfof
(
d©a
, "schannel: SSL/TLS handshake complete\n");

492 #ifde‡
_WIN32_WCE


495 if(
d©a
->
£t
.
s¶
.
vîify≥î
)

496  
	`vîify_˚πifiˇã
(
c⁄n
, 
socködex
);

499  
CURLE_OK
;

500 
	}
}

502 
CURLcode


503 
	$sch™√l_c⁄√˘_°ï3
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

505 
CURLcode
 
ªtcode
 = 
CURLE_OK
;

506 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

507 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

508 
cuæ_sch™√l_¸ed
 *
ﬁd_¸ed
 = 
NULL
;

509 
öˇche
;

511 
	`DEBUGASSERT
(
s¶_c⁄√˘_3
 =
c⁄ns¶
->
c⁄√˘ög_°©e
);

513 
	`öfof
(
d©a
, "schannel: SSL/TLS connection with %sÖort %hu (step 3/3)\n",

514 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

516 if(!
c⁄ns¶
->
¸ed
)

517  
CURLE_SSL_CONNECT_ERROR
;

520 if(
c⁄ns¶
->
ªt_Êags
 !c⁄ns¶->
ªq_Êags
) {

521 if(!(
c⁄ns¶
->
ªt_Êags
 & 
ISC_RET_SEQUENCE_DETECT
))

522 
	`Áûf
(
d©a
, "schannel: failedÅo setup sequence detection");

523 if(!(
c⁄ns¶
->
ªt_Êags
 & 
ISC_RET_REPLAY_DETECT
))

524 
	`Áûf
(
d©a
, "schannel: failedÅo setupÑeplay detection");

525 if(!(
c⁄ns¶
->
ªt_Êags
 & 
ISC_RET_CONFIDENTIALITY
))

526 
	`Áûf
(
d©a
, "schannel: failedÅo setup confidentiality");

527 if(!(
c⁄ns¶
->
ªt_Êags
 & 
ISC_RET_ALLOCATED_MEMORY
))

528 
	`Áûf
(
d©a
, "schannel: failedÅo setup memoryállocation");

529 if(!(
c⁄ns¶
->
ªt_Êags
 & 
ISC_RET_STREAM
))

530 
	`Áûf
(
d©a
, "schannel: failedÅo setup stream orientation");

531  
CURLE_SSL_CONNECT_ERROR
;

535 if(
c⁄ns¶
->
¸ed
 && c⁄ns¶->
˘xt
) {

536 
c⁄ns¶
->
¸ed
->
ªfcou¡
++;

537 
	`öfof
(
d©a
, "schannel: incremented credential handleÑefcount = %d\n",

538 
c⁄ns¶
->
¸ed
->
ªfcou¡
);

542 
öˇche
 = !(
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, (**)&
ﬁd_¸ed
, 
NULL
));

543 if(
öˇche
) {

544 if(
ﬁd_¸ed
 !
c⁄ns¶
->
¸ed
) {

545 
	`öfof
(
d©a
, "schannel: old credential handle is stale,Ñemoving\n");

546 
	`Cuæ_s¶_dñ£ssi⁄id
(
c⁄n
, (*)
ﬁd_¸ed
);

547 
öˇche
 = 
FALSE
;

550 if(!
öˇche
) {

551 
ªtcode
 = 
	`Cuæ_s¶_add£ssi⁄id
(
c⁄n
, (*)
c⁄ns¶
->
¸ed
,

552 (
cuæ_sch™√l_¸ed
));

553 if(
ªtcode
) {

554 
	`Áûf
(
d©a
, "schannel: failedÅo store credential handle");

555  
ªtcode
;

558 
c⁄ns¶
->
¸ed
->
ˇched
 = 
TRUE
;

559 
	`öfof
(
d©a
, "schannel: stored credential handle in session cache\n");

563 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_d⁄e
;

565  
CURLE_OK
;

566 
	}
}

568 
CURLcode


569 
	$sch™√l_c⁄√˘_comm⁄
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

570 
boﬁ
 
n⁄blockög
, boﬁ *
d⁄e
)

572 
CURLcode
 
ªtcode
;

573 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

574 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

575 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
socködex
];

576 
timeout_ms
;

577 
wh©
;

580 if(
s¶_c⁄√˘i⁄_com∂ëe
 =
c⁄ns¶
->
°©e
) {

581 *
d⁄e
 = 
TRUE
;

582  
CURLE_OK
;

585 if(
s¶_c⁄√˘_1
 =
c⁄ns¶
->
c⁄√˘ög_°©e
) {

587 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

589 if(
timeout_ms
 < 0) {

591 
	`Áûf
(
d©a
, "SSL/TLS connectionÅimeout");

592  
CURLE_OPERATION_TIMEDOUT
;

595 
ªtcode
 = 
	`sch™√l_c⁄√˘_°ï1
(
c⁄n
, 
socködex
);

596 if(
ªtcode
)

597  
ªtcode
;

600 
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

601 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

602 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
) {

605 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

607 if(
timeout_ms
 < 0) {

609 
	`Áûf
(
d©a
, "SSL/TLS connectionÅimeout");

610  
CURLE_OPERATION_TIMEDOUT
;

614 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_ªadög


615 || 
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_wrôög
) {

617 
cuæ_sockë_t
 
wrôefd
 = 
s¶_c⁄√˘_2_wrôög
 ==

618 
c⁄ns¶
->
c⁄√˘ög_°©e
 ? 
sockfd
 : 
CURL_SOCKET_BAD
;

619 
cuæ_sockë_t
 
ªadfd
 = 
s¶_c⁄√˘_2_ªadög
 ==

620 
c⁄ns¶
->
c⁄√˘ög_°©e
 ? 
sockfd
 : 
CURL_SOCKET_BAD
;

622 
wh©
 = 
	`Cuæ_sockë_ªady
(
ªadfd
, 
wrôefd
, 
n⁄blockög
 ? 0 : 
timeout_ms
);

623 if(
wh©
 < 0) {

625 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL/TLS sockë,Éºno: %d", 
SOCKERRNO
);

626  
CURLE_SSL_CONNECT_ERROR
;

628 if(0 =
wh©
) {

629 if(
n⁄blockög
) {

630 *
d⁄e
 = 
FALSE
;

631  
CURLE_OK
;

635 
	`Áûf
(
d©a
, "SSL/TLS connectionÅimeout");

636  
CURLE_OPERATION_TIMEDOUT
;

649 
ªtcode
 = 
	`sch™√l_c⁄√˘_°ï2
(
c⁄n
, 
socködex
);

650 if(
ªtcode
 || (
n⁄blockög
 &&

651 (
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

652 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

653 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
)))

654  
ªtcode
;

658 if(
s¶_c⁄√˘_3
 =
c⁄ns¶
->
c⁄√˘ög_°©e
) {

659 
ªtcode
 = 
	`sch™√l_c⁄√˘_°ï3
(
c⁄n
, 
socködex
);

660 if(
ªtcode
)

661  
ªtcode
;

664 if(
s¶_c⁄√˘_d⁄e
 =
c⁄ns¶
->
c⁄√˘ög_°©e
) {

665 
c⁄ns¶
->
°©e
 = 
s¶_c⁄√˘i⁄_com∂ëe
;

666 
c⁄n
->
ªcv
[
socködex
] = 
sch™√l_ªcv
;

667 
c⁄n
->
£nd
[
socködex
] = 
sch™√l_£nd
;

668 *
d⁄e
 = 
TRUE
;

671 *
d⁄e
 = 
FALSE
;

674 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

676  
CURLE_OK
;

677 
	}
}

679 
ssize_t


680 
	$sch™√l_£nd
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

681 c⁄° *
buf
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

683 
ssize_t
 
wrôãn
 = -1;

684 
size_t
 
d©a_Àn
 = 0;

685 *
d©a
 = 
NULL
;

686 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

687 
SecBuf„r
 
outbuf
[4];

688 
SecBuf„rDesc
 
outbuf_desc
;

689 
SECURITY_STATUS
 
s•i_°©us
 = 
SEC_E_OK
;

690 
CURLcode
 
code
;

693 if(
c⁄ns¶
->
°ªam_sizes
.
cbMaximumMesßge
 == 0) {

694 
s•i_°©us
 = 
s_pSecFn
->
	`QuîyC⁄ãxtAâribuãs
(

695 &
c⁄ns¶
->
˘xt
->
˘xt_h™dÀ
,

696 
SECPKG_ATTR_STREAM_SIZES
,

697 &
c⁄ns¶
->
°ªam_sizes
);

698 if(
s•i_°©us
 !
SEC_E_OK
) {

699 *
îr
 = 
CURLE_SEND_ERROR
;

705 if(
Àn
 > 
c⁄ns¶
->
°ªam_sizes
.
cbMaximumMesßge
) {

706 *
îr
 = 
CURLE_SEND_ERROR
;

711 
d©a_Àn
 = 
c⁄ns¶
->
°ªam_sizes
.
cbHódî
 + 
Àn
 +

712 
c⁄ns¶
->
°ªam_sizes
.
cbTøûî
;

713 
d©a
 = (*Ë
	`mÆloc
(
d©a_Àn
);

714 if(
d©a
 =
NULL
) {

715 *
îr
 = 
CURLE_OUT_OF_MEMORY
;

720 
	`InôSecBuf„r
(&
outbuf
[0], 
SECBUFFER_STREAM_HEADER
,

721 
d©a
, 
c⁄ns¶
->
°ªam_sizes
.
cbHódî
);

722 
	`InôSecBuf„r
(&
outbuf
[1], 
SECBUFFER_DATA
,

723 
d©a
 + 
c⁄ns¶
->
°ªam_sizes
.
cbHódî
, 
	`cuæx_uztoul
(
Àn
));

724 
	`InôSecBuf„r
(&
outbuf
[2], 
SECBUFFER_STREAM_TRAILER
,

725 
d©a
 + 
c⁄ns¶
->
°ªam_sizes
.
cbHódî
 + 
Àn
,

726 
c⁄ns¶
->
°ªam_sizes
.
cbTøûî
);

727 
	`InôSecBuf„r
(&
outbuf
[3], 
SECBUFFER_EMPTY
, 
NULL
, 0);

728 
	`InôSecBuf„rDesc
(&
outbuf_desc
, 
outbuf
, 4);

731 
	`mem˝y
(
outbuf
[1].
pvBuf„r
, 
buf
, 
Àn
);

734 
s•i_°©us
 = 
s_pSecFn
->
	`En¸y±Mesßge
(&
c⁄ns¶
->
˘xt
->
˘xt_h™dÀ
, 0,

735 &
outbuf_desc
, 0);

738 if(
s•i_°©us
 =
SEC_E_OK
) {

739 
wrôãn
 = 0;

742 
Àn
 = 
outbuf
[0].
cbBuf„r
 + outbuf[1].cbBuffer + outbuf[2].cbBuffer;

761 
Àn
 > (
size_t
)
wrôãn
) {

762 
ssize_t
 
this_wrôe
;

763 
timñe·
;

764 
wh©
;

766 
this_wrôe
 = 0;

768 
timñe·
 = 
	`Cuæ_timñe·
(
c⁄n
->
d©a
, 
NULL
, 
FALSE
);

769 if(
timñe·
 < 0) {

771 
	`Áûf
(
c⁄n
->
d©a
, "schannel:Åimed out sending data "

772 "(byã†£¡: %zd)", 
wrôãn
);

773 *
îr
 = 
CURLE_OPERATION_TIMEDOUT
;

774 
wrôãn
 = -1;

778 
wh©
 = 
	`Cuæ_sockë_ªady
(
CURL_SOCKET_BAD
, 
c⁄n
->
sock
[
socködex
],

779 
timñe·
);

780 if(
wh©
 < 0) {

782 
	`Áûf
(
c⁄n
->
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

783 *
îr
 = 
CURLE_SEND_ERROR
;

784 
wrôãn
 = -1;

787 if(0 =
wh©
) {

788 
	`Áûf
(
c⁄n
->
d©a
, "schannel:Åimed out sending data "

789 "(byã†£¡: %zd)", 
wrôãn
);

790 *
îr
 = 
CURLE_OPERATION_TIMEDOUT
;

791 
wrôãn
 = -1;

796 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, c⁄n->
sock
[
socködex
], 
d©a
 + 
wrôãn
,

797 
Àn
 - 
wrôãn
, &
this_wrôe
);

798 if(
code
 =
CURLE_AGAIN
)

800 if(
code
 !
CURLE_OK
) {

801 *
îr
 = 
code
;

802 
wrôãn
 = -1;

806 
wrôãn
 +
this_wrôe
;

809 if(
s•i_°©us
 =
SEC_E_INSUFFICIENT_MEMORY
) {

810 *
îr
 = 
CURLE_OUT_OF_MEMORY
;

813 *
îr
 = 
CURLE_SEND_ERROR
;

816 
	`Cuæ_ß„‰ì
(
d©a
);

818 if(
Àn
 =(
size_t
)
wrôãn
)

821 
wrôãn
 = 
outbuf
[1].
cbBuf„r
;

823  
wrôãn
;

824 
	}
}

826 
ssize_t


827 
	$sch™√l_ªcv
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

828 *
buf
, 
size_t
 
Àn
, 
CURLcode
 *
îr
)

830 
size_t
 
size
 = 0;

831 
ssize_t
 
ƒód
 = 0, 
ªt
 = -1;

832 
CURLcode
 
ªtcode
;

833 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

834 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

835 
boﬁ
 
d⁄e
 = 
FALSE
;

836 
SecBuf„r
 
öbuf
[4];

837 
SecBuf„rDesc
 
öbuf_desc
;

838 
SECURITY_STATUS
 
s•i_°©us
 = 
SEC_E_OK
;

840 
	`öfof
(
d©a
, "sch™√l: clõ¡ w™t†tÿªad %zu byãs\n", 
Àn
);

841 *
îr
 = 
CURLE_OK
;

844 if(
c⁄ns¶
->
decd©a_buf„r
 =
NULL
) {

845 
c⁄ns¶
->
decd©a_off£t
 = 0;

846 
c⁄ns¶
->
decd©a_Àngth
 = 
CURL_SCHANNEL_BUFFER_INIT_SIZE
;

847 
c⁄ns¶
->
decd©a_buf„r
 = 
	`mÆloc
(c⁄ns¶->
decd©a_Àngth
);

848 if(
c⁄ns¶
->
decd©a_buf„r
 =
NULL
) {

849 
	`Áûf
(
d©a
, "schannel: unableÅoállocate memory");

850 *
îr
 = 
CURLE_OUT_OF_MEMORY
;

856 
c⁄ns¶
->
ícd©a_Àngth
 - c⁄ns¶->
ícd©a_off£t
 <

857 
CURL_SCHANNEL_BUFFER_FREE_SIZE
 || 
c⁄ns¶
->
ícd©a_Àngth
 < 
Àn
) {

859 
c⁄ns¶
->
ícd©a_Àngth
 *
CURL_SCHANNEL_BUFFER_STEP_FACTOR
;

860 
c⁄ns¶
->
ícd©a_buf„r
 = 
	`ªÆloc
(connssl->encdata_buffer,

861 
c⁄ns¶
->
ícd©a_Àngth
);

863 if(
c⁄ns¶
->
ícd©a_buf„r
 =
NULL
) {

864 
	`Áûf
(
d©a
, "schannel: unableÅoÑe-allocate memory");

865 *
îr
 = 
CURLE_OUT_OF_MEMORY
;

871 
	`öfof
(
d©a
, "schannel:Éncrypted data buffer: offset %zuÜength %zu\n",

872 
c⁄ns¶
->
ícd©a_off£t
, c⁄ns¶->
ícd©a_Àngth
);

873 
size
 = 
c⁄ns¶
->
ícd©a_Àngth
 - c⁄ns¶->
ícd©a_off£t
;

874 if(
size
 > 0) {

875 *
îr
 = 
	`Cuæ_ªad_∂aö
(
c⁄n
->
sock
[
socködex
],

876 (*Ë(
c⁄ns¶
->
ícd©a_buf„r
 + c⁄ns¶->
ícd©a_off£t
),

877 
size
, &
ƒód
);

879 if(*
îr
 !
CURLE_OK
)

880 
ªt
 = -1;

882 if(
ƒód
 > 0)

884 
c⁄ns¶
->
ícd©a_off£t
 +
ƒód
;

885 
ªt
 = 
ƒód
;

887 
	`öfof
(
d©a
, "sch™√l:Én¸y±ed d©®gŸ %zd\n", 
ªt
);

890 
	`öfof
(
d©a
, "schannel:Éncrypted data buffer: offset %zuÜength %zu\n",

891 
c⁄ns¶
->
ícd©a_off£t
, c⁄ns¶->
ícd©a_Àngth
);

894 
c⁄ns¶
->
ícd©a_off£t
 > 0 && 
s•i_°©us
 =
SEC_E_OK
 &&

895 
c⁄ns¶
->
decd©a_off£t
 < 
Àn
) {

897 
	`InôSecBuf„r
(&
öbuf
[0], 
SECBUFFER_DATA
, 
c⁄ns¶
->
ícd©a_buf„r
,

898 
	`cuæx_uztoul
(
c⁄ns¶
->
ícd©a_off£t
));

901 
	`InôSecBuf„r
(&
öbuf
[1], 
SECBUFFER_EMPTY
, 
NULL
, 0);

902 
	`InôSecBuf„r
(&
öbuf
[2], 
SECBUFFER_EMPTY
, 
NULL
, 0);

903 
	`InôSecBuf„r
(&
öbuf
[3], 
SECBUFFER_EMPTY
, 
NULL
, 0);

905 
	`InôSecBuf„rDesc
(&
öbuf_desc
, 
öbuf
, 4);

908 
s•i_°©us
 = 
s_pSecFn
->
	`De¸y±Mesßge
(&
c⁄ns¶
->
˘xt
->
˘xt_h™dÀ
,

909 &
öbuf_desc
, 0, 
NULL
);

912 if(
s•i_°©us
 =
SEC_E_INCOMPLETE_MESSAGE
) {

913 
	`öfof
(
d©a
, "schannel: failedÅo decrypt data,Çeed more data\n");

914 *
îr
 = 
CURLE_AGAIN
;

920 if(
s•i_°©us
 =
SEC_E_OK
 || s•i_°©u†=
SEC_I_RENEGOTIATE
 ||

921 
s•i_°©us
 =
SEC_I_CONTEXT_EXPIRED
) {

923 if(
öbuf
[1].
Buf„rTy≥
 =
SECBUFFER_DATA
) {

924 
	`öfof
(
d©a
, "schannel: decrypted dataÜength: %lu\n",

925 
öbuf
[1].
cbBuf„r
);

928 
size
 = 
öbuf
[1].
cbBuf„r
 > 
CURL_SCHANNEL_BUFFER_FREE_SIZE
 ?

929 
öbuf
[1].
cbBuf„r
 : 
CURL_SCHANNEL_BUFFER_FREE_SIZE
;

930 
c⁄ns¶
->
decd©a_Àngth
 - c⁄ns¶->
decd©a_off£t
 < 
size
 ||

931 
c⁄ns¶
->
decd©a_Àngth
 < 
Àn
) {

933 
c⁄ns¶
->
decd©a_Àngth
 *
CURL_SCHANNEL_BUFFER_STEP_FACTOR
;

934 
c⁄ns¶
->
decd©a_buf„r
 = 
	`ªÆloc
(connssl->decdata_buffer,

935 
c⁄ns¶
->
decd©a_Àngth
);

937 if(
c⁄ns¶
->
decd©a_buf„r
 =
NULL
) {

938 
	`Áûf
(
d©a
, "schannel: unableÅoÑe-allocate memory");

939 *
îr
 = 
CURLE_OUT_OF_MEMORY
;

945 
size
 = 
öbuf
[1].
cbBuf„r
;

946 if(
size
 > 0) {

947 
	`mem˝y
(
c⁄ns¶
->
decd©a_buf„r
 + c⁄ns¶->
decd©a_off£t
,

948 
öbuf
[1].
pvBuf„r
, 
size
);

949 
c⁄ns¶
->
decd©a_off£t
 +
size
;

952 
	`öfof
(
d©a
, "sch™√l: de¸y±ed d©®added: %zu\n", 
size
);

953 
	`öfof
(
d©a
, "schannel: decrypted data cached: offset %zuÜength %zu\n",

954 
c⁄ns¶
->
decd©a_off£t
, c⁄ns¶->
decd©a_Àngth
);

958 if(
öbuf
[3].
Buf„rTy≥
 =
SECBUFFER_EXTRA
 && inbuf[3].
cbBuf„r
 > 0) {

959 
	`öfof
(
d©a
, "schannel:Éncrypted dataÜength: %lu\n",

960 
öbuf
[3].
cbBuf„r
);

965 if(
c⁄ns¶
->
ícd©a_off£t
 > 
öbuf
[3].
cbBuf„r
) {

968 
	`memmove
(
c⁄ns¶
->
ícd©a_buf„r
,

969 (
c⁄ns¶
->
ícd©a_buf„r
 + c⁄ns¶->
ícd©a_off£t
) -

970 
öbuf
[3].
cbBuf„r
, inbuf[3].cbBuffer);

971 
c⁄ns¶
->
ícd©a_off£t
 = 
öbuf
[3].
cbBuf„r
;

974 
	`öfof
(
d©a
, "schannel:Éncrypted data cached: offset %zuÜength %zu\n",

975 
c⁄ns¶
->
ícd©a_off£t
, c⁄ns¶->
ícd©a_Àngth
);

979 
c⁄ns¶
->
ícd©a_off£t
 = 0;

984 if(
s•i_°©us
 =
SEC_I_RENEGOTIATE
) {

985 
	`öfof
(
d©a
, "schannel:ÑemoteÖartyÑequests SSL/TLSÑenegotiation\n");

988 
	`öfof
(
d©a
, "schannel:Ñenegotiating SSL/TLS connection\n");

989 
c⁄ns¶
->
°©e
 = 
s¶_c⁄√˘i⁄_√gŸütög
;

990 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2_wrôög
;

991 
ªtcode
 = 
	`sch™√l_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
FALSE
, &
d⁄e
);

992 if(
ªtcode
)

993 *
îr
 = 
ªtcode
;

995 
	`öfof
(
d©a
, "schannel: SSL/TLS connectionÑenegotiated\n");

997  
	`sch™√l_ªcv
(
c⁄n
, 
socködex
, 
buf
, 
Àn
, 
îr
);

1002 
	`öfof
(
d©a
, "schannel: decrypted data buffer: offset %zuÜength %zu\n",

1003 
c⁄ns¶
->
decd©a_off£t
, c⁄ns¶->
decd©a_Àngth
);

1006 
size
 = 
Àn
 < 
c⁄ns¶
->
decd©a_off£t
 ?Üen : connssl->decdata_offset;

1007 if(
size
 > 0) {

1008 
	`mem˝y
(
buf
, 
c⁄ns¶
->
decd©a_buf„r
, 
size
);

1009 
ªt
 = 
size
;

1012 
	`memmove
(
c⁄ns¶
->
decd©a_buf„r
, c⁄ns¶->decd©a_buf„∏+ 
size
,

1013 
c⁄ns¶
->
decd©a_off£t
 - 
size
);

1014 
c⁄ns¶
->
decd©a_off£t
 -
size
;

1016 
	`öfof
(
d©a
, "sch™√l: de¸y±ed d©®ªtu∫ed %zd\n", 
size
);

1017 
	`öfof
(
d©a
, "schannel: decrypted data buffer: offset %zuÜength %zu\n",

1018 
c⁄ns¶
->
decd©a_off£t
, c⁄ns¶->
decd©a_Àngth
);

1022 if(
ªt
 <= 0 && (

1023 
s•i_°©us
 =
SEC_I_CONTEXT_EXPIRED
 || (s•i_°©u†=
SEC_E_OK
 &&

1024 
c⁄ns¶
->
ícd©a_off£t
 > 0 && c⁄ns¶->
ícd©a_buf„r
[0] == 0x15))) {

1025 
	`öfof
(
d©a
, "schannel: server closedÅhe connection\n");

1026 *
îr
 = 
CURLE_OK
;

1031 if(
ªt
 < 0 && 
s•i_°©us
 !
SEC_E_OK
) {

1032 
	`öfof
(
d©a
, "schannel: failedÅoÑead data from server: %s\n",

1033 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
s•i_°©us
));

1034 *
îr
 = 
CURLE_RECV_ERROR
;

1038  
ªt
;

1039 
	}
}

1041 
CURLcode


1042 
	$Cuæ_sch™√l_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

1043 
boﬁ
 *
d⁄e
)

1045  
	`sch™√l_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
TRUE
, 
d⁄e
);

1046 
	}
}

1048 
CURLcode


1049 
	$Cuæ_sch™√l_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1051 
CURLcode
 
ªtcode
;

1052 
boﬁ
 
d⁄e
 = 
FALSE
;

1054 
ªtcode
 = 
	`sch™√l_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
FALSE
, &
d⁄e
);

1055 if(
ªtcode
)

1056  
ªtcode
;

1058 
	`DEBUGASSERT
(
d⁄e
);

1060  
CURLE_OK
;

1061 
	}
}

1063 
boﬁ
 
	$Cuæ_sch™√l_d©a_≥ndög
(c⁄° 
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1065 c⁄° 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1067 if(
c⁄ns¶
->
u£
)

1068  (
c⁄ns¶
->
ícd©a_off£t
 > 0 ||

1069 
c⁄ns¶
->
decd©a_off£t
 > 0 ) ? 
TRUE
 : 
FALSE
;

1071  
FALSE
;

1072 
	}
}

1074 
	$Cuæ_sch™√l_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1076 if(
c⁄n
->
s¶
[
socködex
].
u£
)

1078 
	`Cuæ_s¶_shutdown
(
c⁄n
, 
socködex
);

1079 
	}
}

1081 
	$Cuæ_sch™√l_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1086 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1087 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1089 
	`öfof
(
d©a
, "schannel: shutting down SSL/TLS connection with %sÖort %hu\n",

1090 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

1092 if(
c⁄ns¶
->
¸ed
 && c⁄ns¶->
˘xt
) {

1093 
SecBuf„rDesc
 
BuffDesc
;

1094 
SecBuf„r
 
Buf„r
;

1095 
SECURITY_STATUS
 
s•i_°©us
;

1096 
SecBuf„r
 
outbuf
;

1097 
SecBuf„rDesc
 
outbuf_desc
;

1098 
CURLcode
 
code
;

1099 
TCHAR
 *
ho°_«me
;

1100 
DWORD
 
dwshut
 = 
SCHANNEL_SHUTDOWN
;

1102 
	`InôSecBuf„r
(&
Buf„r
, 
SECBUFFER_TOKEN
, &
dwshut
, (dwshut));

1103 
	`InôSecBuf„rDesc
(&
BuffDesc
, &
Buf„r
, 1);

1105 
s•i_°©us
 = 
s_pSecFn
->
	`AµlyC⁄åﬁTokí
(&
c⁄ns¶
->
˘xt
->
˘xt_h™dÀ
,

1106 &
BuffDesc
);

1108 if(
s•i_°©us
 !
SEC_E_OK
)

1109 
	`Áûf
(
d©a
, "schannel: ApplyControlToken failure: %s",

1110 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
s•i_°©us
));

1112 
ho°_«me
 = 
	`Cuæ_c⁄vît_UTF8_to_tch¨
(
c⁄n
->
ho°
.
«me
);

1113 if(!
ho°_«me
)

1114  
CURLE_OUT_OF_MEMORY
;

1117 
	`InôSecBuf„r
(&
outbuf
, 
SECBUFFER_EMPTY
, 
NULL
, 0);

1118 
	`InôSecBuf„rDesc
(&
outbuf_desc
, &
outbuf
, 1);

1120 
s•i_°©us
 = 
s_pSecFn
->
	`InôülizeSecurôyC⁄ãxt
(

1121 &
c⁄ns¶
->
¸ed
->
¸ed_h™dÀ
,

1122 &
c⁄ns¶
->
˘xt
->
˘xt_h™dÀ
,

1123 
ho°_«me
,

1124 
c⁄ns¶
->
ªq_Êags
,

1127 
NULL
,

1129 &
c⁄ns¶
->
˘xt
->
˘xt_h™dÀ
,

1130 &
outbuf_desc
,

1131 &
c⁄ns¶
->
ªt_Êags
,

1132 &
c⁄ns¶
->
˘xt
->
time_°amp
);

1134 
	`Cuæ_unicode‰ì
(
ho°_«me
);

1136 if((
s•i_°©us
 =
SEC_E_OK
Ë|| (s•i_°©u†=
SEC_I_CONTEXT_EXPIRED
)) {

1138 
ssize_t
 
wrôãn
;

1139 
code
 = 
	`Cuæ_wrôe_∂aö
(
c⁄n
, c⁄n->
sock
[
socködex
], 
outbuf
.
pvBuf„r
,

1140 
outbuf
.
cbBuf„r
, &
wrôãn
);

1142 
s_pSecFn
->
	`FªeC⁄ãxtBuf„r
(
outbuf
.
pvBuf„r
);

1143 if((
code
 !
CURLE_OK
Ë|| (
outbuf
.
cbBuf„r
 !(
size_t
)
wrôãn
)) {

1144 
	`öfof
(
d©a
, "schannel: failedÅo send close msg: %s"

1145 " (byã†wrôãn: %zd)\n", 
	`cuæ_ósy_°ªº‹
(
code
), 
wrôãn
);

1150 if(
c⁄ns¶
->
˘xt
) {

1151 
	`öfof
(
d©a
, "schannel: clear security context handle\n");

1152 
s_pSecFn
->
	`DñëeSecurôyC⁄ãxt
(&
c⁄ns¶
->
˘xt
->
˘xt_h™dÀ
);

1153 
	`Cuæ_ß„‰ì
(
c⁄ns¶
->
˘xt
);

1157 if(
c⁄ns¶
->
¸ed
) {

1159 if(
c⁄ns¶
->
¸ed
->
ªfcou¡
 > 0) {

1160 
c⁄ns¶
->
¸ed
->
ªfcou¡
--;

1161 
	`öfof
(
d©a
, "schannel: decremented credential handleÑefcount = %d\n",

1162 
c⁄ns¶
->
¸ed
->
ªfcou¡
);

1166 if(!
c⁄ns¶
->
¸ed
->
ˇched
 && c⁄ns¶->¸ed->
ªfcou¡
 == 0) {

1167 
	`öfof
(
d©a
, "schannel: clear credential handle\n");

1168 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
c⁄ns¶
->
¸ed
->
¸ed_h™dÀ
);

1169 
	`Cuæ_ß„‰ì
(
c⁄ns¶
->
¸ed
);

1175 if(
c⁄ns¶
->
ícd©a_buf„r
 !
NULL
) {

1176 
	`Cuæ_ß„‰ì
(
c⁄ns¶
->
ícd©a_buf„r
);

1177 
c⁄ns¶
->
ícd©a_Àngth
 = 0;

1178 
c⁄ns¶
->
ícd©a_off£t
 = 0;

1182 if(
c⁄ns¶
->
decd©a_buf„r
 !
NULL
) {

1183 
	`Cuæ_ß„‰ì
(
c⁄ns¶
->
decd©a_buf„r
);

1184 
c⁄ns¶
->
decd©a_Àngth
 = 0;

1185 
c⁄ns¶
->
decd©a_off£t
 = 0;

1188  
CURLE_OK
;

1189 
	}
}

1191 
	$Cuæ_sch™√l_£ssi⁄_‰ì
(*
±r
)

1193 
cuæ_sch™√l_¸ed
 *
¸ed
 = 
±r
;

1195 if(
¸ed
 && cªd->
ˇched
 && cªd->
ªfcou¡
 == 0) {

1196 
s_pSecFn
->
	`FªeCªdítülsH™dÀ
(&
¸ed
->
¸ed_h™dÀ
);

1197 
	`Cuæ_ß„‰ì
(
¸ed
);

1199 
	}
}

1201 
	$Cuæ_sch™√l_öô
()

1203  (
	`Cuæ_s•i_globÆ_öô
(Ë=
CURLE_OK
 ? 1 : 0);

1204 
	}
}

1206 
	$Cuæ_sch™√l_˛ónup
()

1208 
	`Cuæ_s•i_globÆ_˛ónup
();

1209 
	}
}

1211 
size_t
 
	$Cuæ_sch™√l_vîsi⁄
(*
buf„r
, 
size_t
 
size
)

1213 
size
 = 
	`¢¥ötf
(
buf„r
, size, "WinSSL");

1215  
size
;

1216 
	}
}

1218 #ifde‡
_WIN32_WCE


1219 
CURLcode
 
	$vîify_˚πifiˇã
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1221 
SECURITY_STATUS
 
°©us
;

1222 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1223 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1224 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1225 
CERT_CONTEXT
 *
pCîtC⁄ãxtSîvî
 = 
NULL
;

1226 c⁄° 
CERT_CHAIN_CONTEXT
 *
pChaöC⁄ãxt
 = 
NULL
;

1228 
°©us
 = 
s_pSecFn
->
	`QuîyC⁄ãxtAâribuãs
(&
c⁄ns¶
->
˘xt
->
˘xt_h™dÀ
,

1229 
SECPKG_ATTR_REMOTE_CERT_CONTEXT
,

1230 &
pCîtC⁄ãxtSîvî
);

1232 if((
°©us
 !
SEC_E_OK
Ë|| (
pCîtC⁄ãxtSîvî
 =
NULL
)) {

1233 
	`Áûf
(
d©a
, "schannel: FailedÅoÑeadÑemote certificate context: %s",

1234 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
°©us
));

1235 
ªsu…
 = 
CURLE_PEER_FAILED_VERIFICATION
;

1238 if(
ªsu…
 =
CURLE_OK
) {

1239 
CERT_CHAIN_PARA
 
ChaöP¨a
;

1240 
	`mem£t
(&
ChaöP¨a
, 0, (ChainPara));

1241 
ChaöP¨a
.
cbSize
 = (ChainPara);

1243 if(!
	`CîtGëCîtifiˇãChaö
(
NULL
,

1244 
pCîtC⁄ãxtSîvî
,

1245 
NULL
,

1246 
pCîtC⁄ãxtSîvî
->
hCîtSt‹e
,

1247 &
ChaöP¨a
,

1249 
NULL
,

1250 &
pChaöC⁄ãxt
)) {

1251 
	`Áûf
(
d©a
, "schannel: CertGetCertificateChain failed: %s",

1252 
	`Cuæ_s•i_°ªº‹
(
c⁄n
, 
	`GëLa°Eº‹
()));

1253 
pChaöC⁄ãxt
 = 
NULL
;

1254 
ªsu…
 = 
CURLE_PEER_FAILED_VERIFICATION
;

1257 if(
ªsu…
 =
CURLE_OK
) {

1258 
CERT_SIMPLE_CHAIN
 *
pSim∂eChaö
 = 
pChaöC⁄ãxt
->
rgpChaö
[0];

1259 
DWORD
 
dwTru°Eº‹Mask
 = ~(DWORD)(
CERT_TRUST_IS_NOT_TIME_NESTED
|

1260 
CERT_TRUST_REVOCATION_STATUS_UNKNOWN
);

1261 
dwTru°Eº‹Mask
 &
pSim∂eChaö
->
Tru°Sètus
.
dwEº‹Sètus
;

1262 if(
dwTru°Eº‹Mask
) {

1263 if(
dwTru°Eº‹Mask
 & 
CERT_TRUST_IS_PARTIAL_CHAIN
)

1264 
	`Áûf
(
d©a
, "schannel: CertGetCertificateChainÅrustÉrror"

1266 if(
dwTru°Eº‹Mask
 & 
CERT_TRUST_IS_UNTRUSTED_ROOT
)

1267 
	`Áûf
(
d©a
, "schannel: CertGetCertificateChainÅrustÉrror"

1269 if(
dwTru°Eº‹Mask
 & 
CERT_TRUST_IS_NOT_TIME_VALID
)

1270 
	`Áûf
(
d©a
, "schannel: CertGetCertificateChainÅrustÉrror"

1272 
	`Áûf
(
d©a
, "schannel: CertGetCertificateChainÉrror mask: 0x%08x",

1273 
dwTru°Eº‹Mask
);

1274 
ªsu…
 = 
CURLE_PEER_FAILED_VERIFICATION
;

1279 if(
ªsu…
 =
CURLE_OK
) {

1280 if(
d©a
->
£t
.
s¶
.
vîifyho°
) {

1281 
TCHAR
 
˚π_ho°«me_buff
[128];

1282 
xch¨p_u
 
ho°«me
;

1283 
xch¨p_u
 
˚π_ho°«me
;

1284 
DWORD
 
Àn
;

1286 
˚π_ho°«me
.
c⁄°_tch¨_±r
 = 
˚π_ho°«me_buff
;

1287 
ho°«me
.
tch¨_±r
 = 
	`Cuæ_c⁄vît_UTF8_to_tch¨
(
c⁄n
->
ho°
.
«me
);

1289 
Àn
 = 
	`CîtGëNameSåög
(
pCîtC⁄ãxtSîvî
,

1290 
CERT_NAME_DNS_TYPE
,

1292 
NULL
,

1293 
˚π_ho°«me
.
tch¨_±r
,

1295 if(
Àn
 > 0 && *
˚π_ho°«me
.
tch¨_±r
 == '*') {

1297 
ho°«me_Àn
 = 
	`°æí
(
c⁄n
->
ho°
.
«me
);

1298 
˚π_ho°«me
.
tch¨_±r
++;

1299 if(
	`_tcsicmp
(
˚π_ho°«me
.
c⁄°_tch¨_±r
,

1300 
ho°«me
.
c⁄°_tch¨_±r
 + 
ho°«me_Àn
 - 
Àn
 + 2) != 0)

1301 
ªsu…
 = 
CURLE_PEER_FAILED_VERIFICATION
;

1303 if(
Àn
 =0 || 
	`_tcsicmp
(
ho°«me
.
c⁄°_tch¨_±r
,

1304 
˚π_ho°«me
.
c⁄°_tch¨_±r
) != 0) {

1305 
ªsu…
 = 
CURLE_PEER_FAILED_VERIFICATION
;

1307 if(
ªsu…
 =
CURLE_PEER_FAILED_VERIFICATION
) {

1308 *
_˚π_ho°«me
;

1309 
_˚π_ho°«me
 = 
	`Cuæ_c⁄vît_tch¨_to_UTF8
(
˚π_ho°«me
.
tch¨_±r
);

1310 
	`Áûf
(
d©a
, "schannel: CertGetNameString() certificate hostname "

1312 
_˚π_ho°«me
, 
c⁄n
->
ho°
.
«me
);

1313 
	`Cuæ_unicode‰ì
(
_˚π_ho°«me
);

1315 
	`Cuæ_unicode‰ì
(
ho°«me
.
tch¨_±r
);

1319 if(
pChaöC⁄ãxt
)

1320 
	`CîtFªeCîtifiˇãChaö
(
pChaöC⁄ãxt
);

1322 if(
pCîtC⁄ãxtSîvî
)

1323 
	`CîtFªeCîtifiˇãC⁄ãxt
(
pCîtC⁄ãxtSîvî
);

1325  
ªsu…
;

1326 
	}
}

	@lib/vtls/curl_schannel.h

1 #i‚de‡
HEADER_CURL_SCHANNEL_H


2 
	#HEADER_CURL_SCHANNEL_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
USE_SCHANNEL


29 
	~"uæd©a.h
"

31 #i‚de‡
UNISP_NAME_A


32 
	#UNISP_NAME_A
 "Mi¸oso· Unifõd Securôy PrŸocﬁ Providî"

	)

35 #i‚de‡
UNISP_NAME_W


36 
	#UNISP_NAME_W
 
L
"Mi¸oso· Unifõd Securôy PrŸocﬁ Providî"

	)

39 #i‚de‡
UNISP_NAME


40 #ifde‡
UNICODE


41 
	#UNISP_NAME
 
UNISP_NAME_W


	)

43 
	#UNISP_NAME
 
UNISP_NAME_A


	)

47 #i‚de‡
SP_PROT_SSL2_CLIENT


48 
	#SP_PROT_SSL2_CLIENT
 0x00000008

	)

51 #i‚de‡
SP_PROT_SSL3_CLIENT


52 
	#SP_PROT_SSL3_CLIENT
 0x00000008

	)

55 #i‚de‡
SP_PROT_TLS1_CLIENT


56 
	#SP_PROT_TLS1_CLIENT
 0x00000080

	)

59 #i‚de‡
SP_PROT_TLS1_0_CLIENT


60 
	#SP_PROT_TLS1_0_CLIENT
 
SP_PROT_TLS1_CLIENT


	)

63 #i‚de‡
SP_PROT_TLS1_1_CLIENT


64 
	#SP_PROT_TLS1_1_CLIENT
 0x00000200

	)

67 #i‚de‡
SP_PROT_TLS1_2_CLIENT


68 
	#SP_PROT_TLS1_2_CLIENT
 0x00000800

	)

71 #i‚de‡
SECBUFFER_ALERT


72 
	#SECBUFFER_ALERT
 17

	)

75 #i‚de‡
ISC_RET_REPLAY_DETECT


76 
	#ISC_RET_REPLAY_DETECT
 0x00000004

	)

79 #i‚de‡
ISC_RET_SEQUENCE_DETECT


80 
	#ISC_RET_SEQUENCE_DETECT
 0x00000008

	)

83 #i‚de‡
ISC_RET_CONFIDENTIALITY


84 
	#ISC_RET_CONFIDENTIALITY
 0x00000010

	)

87 #i‚de‡
ISC_RET_ALLOCATED_MEMORY


88 
	#ISC_RET_ALLOCATED_MEMORY
 0x00000100

	)

91 #i‚de‡
ISC_RET_STREAM


92 
	#ISC_RET_STREAM
 0x00008000

	)

96 
	#CURL_SCHANNEL_BUFFER_INIT_SIZE
 4096

	)

97 
	#CURL_SCHANNEL_BUFFER_FREE_SIZE
 1024

	)

98 
	#CURL_SCHANNEL_BUFFER_STEP_FACTOR
 2

	)

101 
CURLcode
 
Cuæ_sch™√l_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

103 
CURLcode
 
Cuæ_sch™√l_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

104 
socködex
,

105 
boﬁ
 *
d⁄e
);

107 
boﬁ
 
Cuæ_sch™√l_d©a_≥ndög
(c⁄° 
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

108 
Cuæ_sch™√l_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

109 
Cuæ_sch™√l_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

110 
Cuæ_sch™√l_£ssi⁄_‰ì
(*
±r
);

112 
Cuæ_sch™√l_öô
();

113 
Cuæ_sch™√l_˛ónup
();

114 
size_t
 
Cuæ_sch™√l_vîsi⁄
(*
buf„r
, size_à
size
);

117 
	#cuæs¶_öô
 
Cuæ_sch™√l_öô


	)

118 
	#cuæs¶_˛ónup
 
Cuæ_sch™√l_˛ónup


	)

119 
	#cuæs¶_c⁄√˘
 
Cuæ_sch™√l_c⁄√˘


	)

120 
	#cuæs¶_c⁄√˘_n⁄blockög
 
Cuæ_sch™√l_c⁄√˘_n⁄blockög


	)

121 
	#cuæs¶_£ssi⁄_‰ì
 
Cuæ_sch™√l_£ssi⁄_‰ì


	)

122 
	#cuæs¶_˛o£_Æl
(
x
Ë(x=x, 
CURLE_NOT_BUILT_IN
)

	)

123 
	#cuæs¶_˛o£
 
Cuæ_sch™√l_˛o£


	)

124 
	#cuæs¶_shutdown
 
Cuæ_sch™√l_shutdown


	)

125 
	#cuæs¶_£t_ígöe
(
x
,
y
Ë(x=x, y=y, 
CURLE_NOT_BUILT_IN
)

	)

126 
	#cuæs¶_£t_ígöe_deÁu…
(
x
Ë(x=x, 
CURLE_NOT_BUILT_IN
)

	)

127 
	#cuæs¶_ígöes_li°
(
x
Ë(x=x, (
cuæ_¶i°
 *)
NULL
)

	)

128 
	#cuæs¶_vîsi⁄
 
Cuæ_sch™√l_vîsi⁄


	)

129 
	#cuæs¶_check_cxn
(
x
Ë(x=x, -1)

	)

130 
	#cuæs¶_d©a_≥ndög
 
Cuæ_sch™√l_d©a_≥ndög


	)

	@lib/vtls/cyassl.c

29 
	~"cuæ_£tup.h
"

31 #ifde‡
USE_CYASSL


33 #ifde‡
HAVE_LIMITS_H


34 
	~<limôs.h
>

37 
	~"uæd©a.h
"

38 
	~"£ndf.h
"

39 
	~"öë_±⁄.h
"

40 
	~"cyas¶.h
"

41 
	~"vés.h
"

42 
	~"∑r£d©e.h
"

43 
	~"c⁄√˘.h
"

44 
	~"£À˘.h
"

45 
	~"øw°r.h
"

47 
	#_MPRINTF_REPLACE


	)

48 
	~<cuæ/m¥ötf.h
>

49 
	~"cuæ_mem‹y.h
"

51 
	~<cyas¶/s¶.h
>

52 #ifde‡
HAVE_CYASSL_ERROR_SSL_H


53 
	~<cyas¶/îr‹-s¶.h
>

55 
	~<cyas¶/îr‹.h
>

59 
	~"memdebug.h
"

61 
Cuæ_ªcv
 
	gcyas¶_ªcv
;

62 
Cuæ_£nd
 
	gcyas¶_£nd
;

65 
	$do_fûe_ty≥
(c⁄° *
ty≥
)

67 if(!
ty≥
 || !type[0])

68  
SSL_FILETYPE_PEM
;

69 if(
	`Cuæ_øw_equÆ
(
ty≥
, "PEM"))

70  
SSL_FILETYPE_PEM
;

71 if(
	`Cuæ_øw_equÆ
(
ty≥
, "DER"))

72  
SSL_FILETYPE_ASN1
;

74 
	}
}

80 
CURLcode


81 
	$cyas¶_c⁄√˘_°ï1
(
c⁄√˘d©a
 *
c⁄n
,

82 
socködex
)

84 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

85 
s¶_c⁄√˘_d©a
* 
c⁄s¶
 = &
c⁄n
->
s¶
[
socködex
];

86 
SSL_METHOD
* 
ªq_mëhod
 = 
NULL
;

87 * 
s¶_£ssi⁄id
 = 
NULL
;

88 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
socködex
];

90 if(
c⁄s¶
->
°©e
 =
s¶_c⁄√˘i⁄_com∂ëe
)

91  
CURLE_OK
;

94 if(
d©a
->
£t
.
s¶
.
vîsi⁄
 =
CURL_SSLVERSION_SSLv2
) {

95 
	`Áûf
(
d©a
, "CyaSSL doesÇot support SSLv2");

96  
CURLE_SSL_CONNECT_ERROR
;

100 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

101 
CURL_SSLVERSION_DEFAULT
:

103 
ªq_mëhod
 = 
	`SSLv23_˛õ¡_mëhod
();

105 
CURL_SSLVERSION_TLSv1
:

106 
	`öfof
(
d©a
, "CyaSSL cannot be configuredÅo use TLS 1.0-1.2, "

108 
ªq_mëhod
 = 
	`TLSv1_˛õ¡_mëhod
();

110 
CURL_SSLVERSION_TLSv1_0
:

111 
ªq_mëhod
 = 
	`TLSv1_˛õ¡_mëhod
();

113 
CURL_SSLVERSION_TLSv1_1
:

114 
ªq_mëhod
 = 
	`TLSv1_1_˛õ¡_mëhod
();

116 
CURL_SSLVERSION_TLSv1_2
:

117 
ªq_mëhod
 = 
	`TLSv1_2_˛õ¡_mëhod
();

119 
CURL_SSLVERSION_SSLv3
:

120 
ªq_mëhod
 = 
	`SSLv3_˛õ¡_mëhod
();

123 
ªq_mëhod
 = 
	`TLSv1_˛õ¡_mëhod
();

126 if(!
ªq_mëhod
) {

127 
	`Áûf
(
d©a
, "SSL: couldn't createá method!");

128  
CURLE_OUT_OF_MEMORY
;

131 if(
c⁄s¶
->
˘x
)

132 
	`SSL_CTX_‰ì
(
c⁄s¶
->
˘x
);

133 
c⁄s¶
->
˘x
 = 
	`SSL_CTX_√w
(
ªq_mëhod
);

135 if(!
c⁄s¶
->
˘x
) {

136 
	`Áûf
(
d©a
, "SSL: couldn't createá context!");

137  
CURLE_OUT_OF_MEMORY
;

140 #i‚de‡
NO_FILESYSTEM


142 if(
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]) {

143 if(!
	`SSL_CTX_lﬂd_vîify_loˇti⁄s
(
c⁄s¶
->
˘x
,

144 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
],

145 
d©a
->
£t
.
°r
[
STRING_SSL_CAPATH
])) {

146 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

148 
	`Áûf
(
d©a
,"error setting certificate verifyÜocations:\n"

150 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]?

151 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]: "none",

152 
d©a
->
£t
.
°r
[
STRING_SSL_CAPATH
]?

153 
d©a
->
£t
.
°r
[
STRING_SSL_CAPATH
] : "none");

154  
CURLE_SSL_CACERT_BADFILE
;

159 
	`öfof
(
d©a
, "error setting certificate verifyÜocations,"

165 
	`öfof
(
d©a
, "successfully set certificate verifyÜocations:\n");

167 
	`öfof
(
d©a
,

170 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
] ? data->set.str[STRING_SSL_CAFILE]:

172 
d©a
->
£t
.
°r
[
STRING_SSL_CAPATH
] ? data->set.str[STRING_SSL_CAPATH]:

177 if(
d©a
->
£t
.
°r
[
STRING_CERT
] && d©a->£t.°r[
STRING_KEY
]) {

178 
fûe_ty≥
 = 
	`do_fûe_ty≥
(
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
]);

180 if(
	`SSL_CTX_u£_˚πifiˇã_fûe
(
c⁄s¶
->
˘x
, 
d©a
->
£t
.
°r
[
STRING_CERT
],

181 
fûe_ty≥
) != 1) {

182 
	`Áûf
(
d©a
, "unableÅo use client certificate (no key or wrongÖass"

184  
CURLE_SSL_CONNECT_ERROR
;

187 
fûe_ty≥
 = 
	`do_fûe_ty≥
(
d©a
->
£t
.
°r
[
STRING_KEY_TYPE
]);

188 if(
	`SSL_CTX_u£_Priv©eKey_fûe
(
c⁄s¶
->
˘x
, 
d©a
->
£t
.
°r
[
STRING_KEY
],

189 
fûe_ty≥
) != 1) {

190 
	`Áûf
(
d©a
, "unableÅo setÖrivate key");

191  
CURLE_SSL_CONNECT_ERROR
;

195 if(
	`CyaSSL_no_fûesy°em_vîify
(
c⁄s¶
->
˘x
)!
SSL_SUCCESS
) {

196  
CURLE_SSL_CONNECT_ERROR
;

204 
	`SSL_CTX_£t_vîify
(
c⁄s¶
->
˘x
,

205 
d©a
->
£t
.
s¶
.
vîify≥î
?
SSL_VERIFY_PEER
:
SSL_VERIFY_NONE
,

206 
NULL
);

209 if(
c⁄s¶
->
h™dÀ
)

210 
	`SSL_‰ì
(
c⁄s¶
->
h™dÀ
);

211 
c⁄s¶
->
h™dÀ
 = 
	`SSL_√w
(c⁄s¶->
˘x
);

212 if(!
c⁄s¶
->
h™dÀ
) {

213 
	`Áûf
(
d©a
, "SSL: couldn't createá context (handle)!");

214  
CURLE_OUT_OF_MEMORY
;

218 if(!
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, &
s¶_£ssi⁄id
, 
NULL
)) {

220 if(!
	`SSL_£t_£ssi⁄
(
c⁄s¶
->
h™dÀ
, 
s¶_£ssi⁄id
)) {

221 
	`Áûf
(
d©a
, "SSL: SSL_set_session failed: %s",

222 
	`ERR_îr‹_°rög
(
	`SSL_gë_îr‹
(
c⁄s¶
->
h™dÀ
, 0),
NULL
));

223  
CURLE_SSL_CONNECT_ERROR
;

226 
	`öfof
 (
d©a
, "SSLÑe-using session ID\n");

230 if(!
	`SSL_£t_fd
(
c⁄s¶
->
h™dÀ
, ()
sockfd
)) {

231 
	`Áûf
(
d©a
, "SSL: SSL_set_fd failed");

232  
CURLE_SSL_CONNECT_ERROR
;

235 
c⁄s¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2
;

236  
CURLE_OK
;

237 
	}
}

240 
CURLcode


241 
	$cyas¶_c⁄√˘_°ï2
(
c⁄√˘d©a
 *
c⁄n
,

242 
socködex
)

244 
ªt
 = -1;

245 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

246 
s¶_c⁄√˘_d©a
* 
c⁄s¶
 = &
c⁄n
->
s¶
[
socködex
];

248 
	`öfof
(
d©a
, "CyaSSL: ConnectingÅo %s:%d\n",

249 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

251 
c⁄n
->
ªcv
[
socködex
] = 
cyas¶_ªcv
;

252 
c⁄n
->
£nd
[
socködex
] = 
cyas¶_£nd
;

255 if(
d©a
->
£t
.
s¶
.
vîifyho°
) {

256 
ªt
 = 
	`CyaSSL_check_domaö_«me
(
c⁄s¶
->
h™dÀ
, 
c⁄n
->
ho°
.
«me
);

257 if(
ªt
 =
SSL_FAILURE
)

258  
CURLE_OUT_OF_MEMORY
;

261 
ªt
 = 
	`SSL_c⁄√˘
(
c⁄s¶
->
h™dÀ
);

262 if(
ªt
 != 1) {

263 
îr‹_buf„r
[80];

264 
dëaû
 = 
	`SSL_gë_îr‹
(
c⁄s¶
->
h™dÀ
, 
ªt
);

266 if(
SSL_ERROR_WANT_READ
 =
dëaû
) {

267 
c⁄s¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2_ªadög
;

268  
CURLE_OK
;

270 if(
SSL_ERROR_WANT_WRITE
 =
dëaû
) {

271 
c⁄s¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2_wrôög
;

272  
CURLE_OK
;

277 if(
DOMAIN_NAME_MISMATCH
 =
dëaû
) {

279 
	`Áûf
(
d©a
, "\tsubjectáltÇame(s) or commonÇame doÇot match \"%s\"\n",

280 
c⁄n
->
ho°
.
di•«me
);

281  
CURLE_PEER_FAILED_VERIFICATION
;

288 if(
d©a
->
£t
.
s¶
.
vîifyho°
) {

289 
	`Áûf
(
d©a
,

291 
c⁄n
->
ho°
.
di•«me
);

292  
CURLE_PEER_FAILED_VERIFICATION
;

295 
	`öfof
(
d©a
,

297 
c⁄n
->
ho°
.
di•«me
);

298  
CURLE_OK
;

303 
	`Áûf
(
d©a
, "SSL_c⁄√˘ faûed wôhÉº‹ %d: %s", 
dëaû
,

304 
	`ERR_îr‹_°rög
(
dëaû
, 
îr‹_buf„r
));

305  
CURLE_SSL_CONNECT_ERROR
;

309 
c⁄s¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_3
;

310 
	`öfof
(
d©a
, "SSL connected\n");

312  
CURLE_OK
;

313 
	}
}

316 
CURLcode


317 
	$cyas¶_c⁄√˘_°ï3
(
c⁄√˘d©a
 *
c⁄n
,

318 
socködex
)

320 
CURLcode
 
ªtcode
 = 
CURLE_OK
;

321 *
ﬁd_s¶_£ssi⁄id
=
NULL
;

322 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

323 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

324 
öˇche
;

325 
SSL_SESSION
 *
our_s¶_£ssi⁄id
;

327 
	`DEBUGASSERT
(
s¶_c⁄√˘_3
 =
c⁄ns¶
->
c⁄√˘ög_°©e
);

329 
our_s¶_£ssi⁄id
 = 
	`SSL_gë_£ssi⁄
(
c⁄ns¶
->
h™dÀ
);

331 
öˇche
 = !(
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, &
ﬁd_s¶_£ssi⁄id
, 
NULL
));

332 if(
öˇche
) {

333 if(
ﬁd_s¶_£ssi⁄id
 !
our_s¶_£ssi⁄id
) {

334 
	`öfof
(
d©a
, "old SSL session ID is stale,Ñemoving\n");

335 
	`Cuæ_s¶_dñ£ssi⁄id
(
c⁄n
, 
ﬁd_s¶_£ssi⁄id
);

336 
öˇche
 = 
FALSE
;

339 if(!
öˇche
) {

340 
ªtcode
 = 
	`Cuæ_s¶_add£ssi⁄id
(
c⁄n
, 
our_s¶_£ssi⁄id
,

342 if(
ªtcode
) {

343 
	`Áûf
(
d©a
, "failedÅo store ssl session");

344  
ªtcode
;

348 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_d⁄e
;

350  
ªtcode
;

351 
	}
}

354 
ssize_t
 
	$cyas¶_£nd
(
c⁄√˘d©a
 *
c⁄n
,

355 
socködex
,

356 c⁄° *
mem
,

357 
size_t
 
Àn
,

358 
CURLcode
 *
cuæcode
)

360 
îr‹_buf„r
[80];

361 
memÀn
 = (
Àn
 > (
size_t
)
INT_MAX
) ? INT_MAX : ()len;

362 
rc
 = 
	`SSL_wrôe
(
c⁄n
->
s¶
[
socködex
].
h™dÀ
, 
mem
, 
memÀn
);

364 if(
rc
 < 0) {

365 
îr
 = 
	`SSL_gë_îr‹
(
c⁄n
->
s¶
[
socködex
].
h™dÀ
, 
rc
);

367 
îr
) {

368 
SSL_ERROR_WANT_READ
:

369 
SSL_ERROR_WANT_WRITE
:

371 *
cuæcode
 = 
CURLE_AGAIN
;

374 
	`Áûf
(
c⁄n
->
d©a
, "SSL write: %s,Érrno %d",

375 
	`ERR_îr‹_°rög
(
îr
, 
îr‹_buf„r
),

376 
SOCKERRNO
);

377 *
cuæcode
 = 
CURLE_SEND_ERROR
;

381  
rc
;

382 
	}
}

384 
	$Cuæ_cyas¶_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
)

386 ()
d©a
;

387 
	}
}

389 
	$Cuæ_cyas¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

391 
s¶_c⁄√˘_d©a
 *
c⁄s¶
 = &
c⁄n
->
s¶
[
socködex
];

393 if(
c⁄s¶
->
h™dÀ
) {

394 ()
	`SSL_shutdown
(
c⁄s¶
->
h™dÀ
);

395 
	`SSL_‰ì
 (
c⁄s¶
->
h™dÀ
);

396 
c⁄s¶
->
h™dÀ
 = 
NULL
;

398 if(
c⁄s¶
->
˘x
) {

399 
	`SSL_CTX_‰ì
 (
c⁄s¶
->
˘x
);

400 
c⁄s¶
->
˘x
 = 
NULL
;

402 
	}
}

404 
ssize_t
 
	$cyas¶_ªcv
(
c⁄√˘d©a
 *
c⁄n
,

405 
num
,

406 *
buf
,

407 
size_t
 
buf„rsize
,

408 
CURLcode
 *
cuæcode
)

410 
îr‹_buf„r
[80];

411 
buffsize
 = (
buf„rsize
 > (
size_t
)
INT_MAX
) ? INT_MAX : ()buffersize;

412 
ƒód
 = 
	`SSL_ªad
(
c⁄n
->
s¶
[
num
].
h™dÀ
, 
buf
, 
buffsize
);

414 if(
ƒód
 < 0) {

415 
îr
 = 
	`SSL_gë_îr‹
(
c⁄n
->
s¶
[
num
].
h™dÀ
, 
ƒód
);

417 
îr
) {

418 
SSL_ERROR_ZERO_RETURN
:

420 
SSL_ERROR_WANT_READ
:

421 
SSL_ERROR_WANT_WRITE
:

423 *
cuæcode
 = 
CURLE_AGAIN
;

426 
	`Áûf
(
c⁄n
->
d©a
, "SSLÑead: %s,Érrno %d",

427 
	`ERR_îr‹_°rög
(
îr
, 
îr‹_buf„r
),

428 
SOCKERRNO
);

429 *
cuæcode
 = 
CURLE_RECV_ERROR
;

433  
ƒód
;

434 
	}
}

437 
	$Cuæ_cyas¶_£ssi⁄_‰ì
(*
±r
)

439 ()
±r
;

441 
	}
}

444 
size_t
 
	$Cuæ_cyas¶_vîsi⁄
(*
buf„r
, 
size_t
 
size
)

446 #ifde‡
CYASSL_VERSION


447  
	`¢¥ötf
(
buf„r
, 
size
, "CyaSSL/%s", 
CYASSL_VERSION
);

449  
	`¢¥ötf
(
buf„r
, 
size
, "CyaSSL/%s", "<1.8.8");

451 
	}
}

454 
	$Cuæ_cyas¶_öô
()

456 if(
	`CyaSSL_Inô
() == 0)

460 
	}
}

463 
boﬁ
 
	$Cuæ_cyas¶_d©a_≥ndög
(c⁄° 
c⁄√˘d©a
* 
c⁄n
, 
c⁄nödex
)

465 if(
c⁄n
->
s¶
[
c⁄nödex
].
h™dÀ
)

466  (0 !
	`SSL_≥ndög
(
c⁄n
->
s¶
[
c⁄nödex
].
h™dÀ
)Ë? 
TRUE
 : 
FALSE
;

468  
FALSE
;

469 
	}
}

476 
	$Cuæ_cyas¶_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

478 
ªtvÆ
 = 0;

479 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

481 if(
c⁄ns¶
->
h™dÀ
) {

482 
	`SSL_‰ì
 (
c⁄ns¶
->
h™dÀ
);

483 
c⁄ns¶
->
h™dÀ
 = 
NULL
;

485  
ªtvÆ
;

486 
	}
}

489 
CURLcode


490 
	$cyas¶_c⁄√˘_comm⁄
(
c⁄√˘d©a
 *
c⁄n
,

491 
socködex
,

492 
boﬁ
 
n⁄blockög
,

493 
boﬁ
 *
d⁄e
)

495 
CURLcode
 
ªtcode
;

496 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

497 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

498 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
socködex
];

499 
timeout_ms
;

500 
wh©
;

503 if(
s¶_c⁄√˘i⁄_com∂ëe
 =
c⁄ns¶
->
°©e
) {

504 *
d⁄e
 = 
TRUE
;

505  
CURLE_OK
;

508 if(
s¶_c⁄√˘_1
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

510 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

512 if(
timeout_ms
 < 0) {

514 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

515  
CURLE_OPERATION_TIMEDOUT
;

517 
ªtcode
 = 
	`cyas¶_c⁄√˘_°ï1
(
c⁄n
, 
socködex
);

518 if(
ªtcode
)

519  
ªtcode
;

522 
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

523 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

524 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
) {

527 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

529 if(
timeout_ms
 < 0) {

531 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

532  
CURLE_OPERATION_TIMEDOUT
;

536 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_ªadög


537 || 
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_wrôög
) {

539 
cuæ_sockë_t
 
wrôefd
 = 
s¶_c⁄√˘_2_wrôög
==

540 
c⁄ns¶
->
c⁄√˘ög_°©e
?
sockfd
:
CURL_SOCKET_BAD
;

541 
cuæ_sockë_t
 
ªadfd
 = 
s¶_c⁄√˘_2_ªadög
==

542 
c⁄ns¶
->
c⁄√˘ög_°©e
?
sockfd
:
CURL_SOCKET_BAD
;

544 
wh©
 = 
	`Cuæ_sockë_ªady
(
ªadfd
, 
wrôefd
, 
n⁄blockög
?0:
timeout_ms
);

545 if(
wh©
 < 0) {

547 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

548  
CURLE_SSL_CONNECT_ERROR
;

550 if(0 =
wh©
) {

551 if(
n⁄blockög
) {

552 *
d⁄e
 = 
FALSE
;

553  
CURLE_OK
;

557 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

558  
CURLE_OPERATION_TIMEDOUT
;

571 
ªtcode
 = 
	`cyas¶_c⁄√˘_°ï2
(
c⁄n
, 
socködex
);

572 if(
ªtcode
 || (
n⁄blockög
 &&

573 (
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

574 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

575 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
)))

576  
ªtcode
;

580 if(
s¶_c⁄√˘_3
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

581 
ªtcode
 = 
	`cyas¶_c⁄√˘_°ï3
(
c⁄n
, 
socködex
);

582 if(
ªtcode
)

583  
ªtcode
;

586 if(
s¶_c⁄√˘_d⁄e
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

587 
c⁄ns¶
->
°©e
 = 
s¶_c⁄√˘i⁄_com∂ëe
;

588 
c⁄n
->
ªcv
[
socködex
] = 
cyas¶_ªcv
;

589 
c⁄n
->
£nd
[
socködex
] = 
cyas¶_£nd
;

590 *
d⁄e
 = 
TRUE
;

593 *
d⁄e
 = 
FALSE
;

596 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

598  
CURLE_OK
;

599 
	}
}

602 
CURLcode


603 
	$Cuæ_cyas¶_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

604 
socködex
,

605 
boﬁ
 *
d⁄e
)

607  
	`cyas¶_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
TRUE
, 
d⁄e
);

608 
	}
}

611 
CURLcode


612 
	$Cuæ_cyas¶_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

613 
socködex
)

615 
CURLcode
 
ªtcode
;

616 
boﬁ
 
d⁄e
 = 
FALSE
;

618 
ªtcode
 = 
	`cyas¶_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
FALSE
, &
d⁄e
);

619 if(
ªtcode
)

620  
ªtcode
;

622 
	`DEBUGASSERT
(
d⁄e
);

624  
CURLE_OK
;

625 
	}
}

	@lib/vtls/cyassl.h

1 #i‚de‡
HEADER_CURL_CYASSL_H


2 
	#HEADER_CURL_CYASSL_H


	)

24 
	~"cuæ_£tup.h
"

26 #ifde‡
USE_CYASSL


28 
CURLcode
 
Cuæ_cyas¶_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

29 
boﬁ
 
Cuæ_cyas¶_d©a_≥ndög
(c⁄° 
c⁄√˘d©a
* 
c⁄n
,
c⁄nödex
);

30 
Cuæ_cyas¶_shutdown
(
c⁄√˘d©a
* 
c⁄n
, 
socködex
);

34 
Cuæ_cyas¶_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
);

37 
Cuæ_cyas¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

39 
Cuæ_cyas¶_£ssi⁄_‰ì
(*
±r
);

40 
size_t
 
Cuæ_cyas¶_vîsi⁄
(*
buf„r
, size_à
size
);

41 
Cuæ_cyas¶_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

42 
Cuæ_cyas¶_öô
();

43 
CURLcode
 
Cuæ_cyas¶_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

44 
socködex
,

45 
boﬁ
 *
d⁄e
);

48 
	#cuæs¶_öô
 
Cuæ_cyas¶_öô


	)

49 
	#cuæs¶_˛ónup
(Ë
Cuæ_n›_°mt


	)

50 
	#cuæs¶_c⁄√˘
 
Cuæ_cyas¶_c⁄√˘


	)

51 
	#cuæs¶_c⁄√˘_n⁄blockög
 
Cuæ_cyas¶_c⁄√˘_n⁄blockög


	)

52 
	#cuæs¶_£ssi⁄_‰ì
(
x
Ë
	`Cuæ_cyas¶_£ssi⁄_‰ì
(x)

	)

53 
	#cuæs¶_˛o£_Æl
 
Cuæ_cyas¶_˛o£_Æl


	)

54 
	#cuæs¶_˛o£
 
Cuæ_cyas¶_˛o£


	)

55 
	#cuæs¶_shutdown
(
x
,
y
Ë
	`Cuæ_cyas¶_shutdown
(x,y)

	)

56 
	#cuæs¶_£t_ígöe
(
x
,
y
Ë(x=x, y=y, 
CURLE_NOT_BUILT_IN
)

	)

57 
	#cuæs¶_£t_ígöe_deÁu…
(
x
Ë(x=x, 
CURLE_NOT_BUILT_IN
)

	)

58 
	#cuæs¶_ígöes_li°
(
x
Ë(x=x, (
cuæ_¶i°
 *)
NULL
)

	)

59 
	#cuæs¶_vîsi⁄
 
Cuæ_cyas¶_vîsi⁄


	)

60 
	#cuæs¶_check_cxn
(
x
Ë(x=x, -1)

	)

61 
	#cuæs¶_d©a_≥ndög
(
x
,
y
Ë
	`Cuæ_cyas¶_d©a_≥ndög
(x,y)

	)

	@lib/vtls/gskit.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
USE_GSKIT


27 
	~<gsks¶.h
>

28 
	~<qsﬂsync.h
>

31 #i‚de‡
GSK_SSL_EXTN_SERVERNAME_REQUEST


32 
	#GSK_SSL_EXTN_SERVERNAME_REQUEST
 230

	)

35 #i‚de‡
GSK_TLSV10_CIPHER_SPECS


36 
	#GSK_TLSV10_CIPHER_SPECS
 236

	)

39 #i‚de‡
GSK_TLSV11_CIPHER_SPECS


40 
	#GSK_TLSV11_CIPHER_SPECS
 237

	)

43 #i‚de‡
GSK_TLSV12_CIPHER_SPECS


44 
	#GSK_TLSV12_CIPHER_SPECS
 238

	)

47 #i‚de‡
GSK_PROTOCOL_TLSV11


48 
	#GSK_PROTOCOL_TLSV11
 437

	)

51 #i‚de‡
GSK_PROTOCOL_TLSV12


52 
	#GSK_PROTOCOL_TLSV12
 438

	)

55 #i‚de‡
GSK_FALSE


56 
	#GSK_FALSE
 0

	)

59 #i‚de‡
GSK_TRUE


60 
	#GSK_TRUE
 1

	)

64 #ifde‡
HAVE_LIMITS_H


65 
	~<limôs.h
>

68 
	~<cuæ/cuæ.h
>

69 
	~"uæd©a.h
"

70 
	~"£ndf.h
"

71 
	~"gskô.h
"

72 
	~"vés.h
"

73 
	~"c⁄√˘.h
"

74 
	~"£À˘.h
"

75 
	~"°ªquÆ.h
"

76 
	~"x509a¢1.h
"

78 
	#_MPRINTF_REPLACE


	)

79 
	~<cuæ/m¥ötf.h
>

81 
	~"cuæ_mem‹y.h
"

83 
	~"memdebug.h
"

87 
	#CURL_GSKPROTO_SSLV2
 0

	)

88 
	#CURL_GSKPROTO_SSLV2_MASK
 (1 << 
CURL_GSKPROTO_SSLV2
)

	)

89 
	#CURL_GSKPROTO_SSLV3
 1

	)

90 
	#CURL_GSKPROTO_SSLV3_MASK
 (1 << 
CURL_GSKPROTO_SSLV3
)

	)

91 
	#CURL_GSKPROTO_TLSV10
 2

	)

92 
	#CURL_GSKPROTO_TLSV10_MASK
 (1 << 
CURL_GSKPROTO_TLSV10
)

	)

93 
	#CURL_GSKPROTO_TLSV11
 3

	)

94 
	#CURL_GSKPROTO_TLSV11_MASK
 (1 << 
CURL_GSKPROTO_TLSV11
)

	)

95 
	#CURL_GSKPROTO_TLSV12
 4

	)

96 
	#CURL_GSKPROTO_TLSV12_MASK
 (1 << 
CURL_GSKPROTO_TLSV12
)

	)

97 
	#CURL_GSKPROTO_LAST
 5

	)

102 c⁄° *
	m«me
;

103 c⁄° *
	mgsktokí
;

104 
	mvîsi⁄s
;

105 } 
	tgskô_cùhî
;

107 c⁄° 
gskô_cùhî
 
	gcùhîèbÀ
[] = {

109 
CURL_GSKPROTO_SSLV3_MASK
 | 
CURL_GSKPROTO_TLSV10_MASK
 |

110 
CURL_GSKPROTO_TLSV11_MASK
 | 
CURL_GSKPROTO_TLSV12_MASK
 },

112 
CURL_GSKPROTO_SSLV3_MASK
 | 
CURL_GSKPROTO_TLSV10_MASK
 |

113 
CURL_GSKPROTO_TLSV11_MASK
 | 
CURL_GSKPROTO_TLSV12_MASK
 },

115 
CURL_GSKPROTO_SSLV3_MASK
 | 
CURL_GSKPROTO_TLSV10_MASK
 },

117 
CURL_GSKPROTO_SSLV3_MASK
 | 
CURL_GSKPROTO_TLSV10_MASK
 |

118 
CURL_GSKPROTO_TLSV11_MASK
 | 
CURL_GSKPROTO_TLSV12_MASK
 },

120 
CURL_GSKPROTO_SSLV3_MASK
 | 
CURL_GSKPROTO_TLSV10_MASK
 |

121 
CURL_GSKPROTO_TLSV11_MASK
 | 
CURL_GSKPROTO_TLSV12_MASK
 },

123 
CURL_GSKPROTO_SSLV3_MASK
 | 
CURL_GSKPROTO_TLSV10_MASK
 },

125 
CURL_GSKPROTO_SSLV3_MASK
 | 
CURL_GSKPROTO_TLSV10_MASK
 |

126 
CURL_GSKPROTO_TLSV11_MASK
 },

128 
CURL_GSKPROTO_SSLV3_MASK
 | 
CURL_GSKPROTO_TLSV10_MASK
 |

129 
CURL_GSKPROTO_TLSV11_MASK
 | 
CURL_GSKPROTO_TLSV12_MASK
 },

131 
CURL_GSKPROTO_TLSV10_MASK
 | 
CURL_GSKPROTO_TLSV11_MASK
 |

132 
CURL_GSKPROTO_TLSV12_MASK
 },

134 
CURL_GSKPROTO_TLSV10_MASK
 | 
CURL_GSKPROTO_TLSV11_MASK
 |

135 
CURL_GSKPROTO_TLSV12_MASK
 },

136 { "nuŒ-sha256", "3B", 
CURL_GSKPROTO_TLSV12_MASK
 },

137 { "´s128-sha256", "3D", 
CURL_GSKPROTO_TLSV12_MASK
 },

138 { "´s256-sha256", "3D", 
CURL_GSKPROTO_TLSV12_MASK
 },

139 { "rc4-md5", "1", 
CURL_GSKPROTO_SSLV2_MASK
 },

140 { "exp-rc4-md5", "2", 
CURL_GSKPROTO_SSLV2_MASK
 },

141 { "rc2-md5", "3", 
CURL_GSKPROTO_SSLV2_MASK
 },

142 { "exp-rc2-md5", "4", 
CURL_GSKPROTO_SSLV2_MASK
 },

143 { "des-cbc-md5", "6", 
CURL_GSKPROTO_SSLV2_MASK
 },

144 { "des-cbc3-md5", "7", 
CURL_GSKPROTO_SSLV2_MASK
 },

145 { (c⁄° *Ë
NULL
, (const *) NULL, 0 }

149 
boﬁ
 
	$is_£∑øt‹
(
c
)

152 
c
) {

158  
åue
;

160  
Ál£
;

161 
	}
}

164 
CURLcode
 
	$gskô_°©us
(
Sessi⁄H™dÀ
 *
d©a
, 
rc
,

165 c⁄° *
¥o˙ame
, 
CURLcode
 
defcode
)

167 
CURLcode
 
cc
;

170 
rc
) {

171 
GSK_OK
:

172 
GSK_OS400_ASYNCHRONOUS_SOC_INIT
:

173  
CURLE_OK
;

174 
GSK_KEYRING_OPEN_ERROR
:

175 
GSK_OS400_ERROR_NO_ACCESS
:

176  
CURLE_SSL_CACERT_BADFILE
;

177 
GSK_INSUFFICIENT_STORAGE
:

178  
CURLE_OUT_OF_MEMORY
;

179 
GSK_ERROR_BAD_V2_CIPHER
:

180 
GSK_ERROR_BAD_V3_CIPHER
:

181 
GSK_ERROR_NO_CIPHERS
:

182  
CURLE_SSL_CIPHER
;

183 
GSK_OS400_ERROR_NOT_TRUSTED_ROOT
:

184 
GSK_ERROR_CERT_VALIDATION
:

185  
CURLE_PEER_FAILED_VERIFICATION
;

186 
GSK_OS400_ERROR_TIMED_OUT
:

187  
CURLE_OPERATION_TIMEDOUT
;

188 
GSK_WOULD_BLOCK
:

189  
CURLE_AGAIN
;

190 
GSK_OS400_ERROR_NOT_REGISTERED
:

192 
GSK_ERROR_IO
:

193 
î∫o
) {

194 
ENOMEM
:

195  
CURLE_OUT_OF_MEMORY
;

197 
	`Áûf
(
d©a
, "%†I/OÉº‹: %s", 
¥o˙ame
, 
	`°ªº‹
(
î∫o
));

202 
	`Áûf
(
d©a
, "%s: %s", 
¥o˙ame
, 
	`gsk_°ªº‹
(
rc
));

205  
defcode
;

206 
	}
}

209 
CURLcode
 
	$£t_íum
(
Sessi⁄H™dÀ
 *
d©a
, 
gsk_h™dÀ
 
h
,

210 
GSK_ENUM_ID
 
id
, 
GSK_ENUM_VALUE
 
vÆue
, 
boﬁ
 
unsuµ‹ãd_ok
)

212 
rc
 = 
	`gsk_©åibuã_£t_íum
(
h
, 
id
, 
vÆue
);

214 
rc
) {

215 
GSK_OK
:

216  
CURLE_OK
;

217 
GSK_ERROR_IO
:

218 
	`Áûf
(
d©a
, "gsk_©åibuã_£t_íum(ËI/OÉº‹: %s", 
	`°ªº‹
(
î∫o
));

220 
GSK_ATTRIBUTE_INVALID_ID
:

221 if(
unsuµ‹ãd_ok
)

222  
CURLE_UNSUPPORTED_PROTOCOL
;

224 
	`Áûf
(
d©a
, "gsk_©åibuã_£t_íum(): %s", 
	`gsk_°ªº‹
(
rc
));

227  
CURLE_SSL_CONNECT_ERROR
;

228 
	}
}

231 
CURLcode
 
	$£t_buf„r
(
Sessi⁄H™dÀ
 *
d©a
, 
gsk_h™dÀ
 
h
,

232 
GSK_BUF_ID
 
id
, c⁄° *
buf„r
, 
boﬁ
 
unsuµ‹ãd_ok
)

234 
rc
 = 
	`gsk_©åibuã_£t_buf„r
(
h
, 
id
, 
buf„r
, 0);

236 
rc
) {

237 
GSK_OK
:

238  
CURLE_OK
;

239 
GSK_ERROR_IO
:

240 
	`Áûf
(
d©a
, "gsk_©åibuã_£t_buf„r(ËI/OÉº‹: %s", 
	`°ªº‹
(
î∫o
));

242 
GSK_ATTRIBUTE_INVALID_ID
:

243 if(
unsuµ‹ãd_ok
)

244  
CURLE_UNSUPPORTED_PROTOCOL
;

246 
	`Áûf
(
d©a
, "gsk_©åibuã_£t_buf„r(): %s", 
	`gsk_°ªº‹
(
rc
));

249  
CURLE_SSL_CONNECT_ERROR
;

250 
	}
}

253 
CURLcode
 
	$£t_numîic
(
Sessi⁄H™dÀ
 *
d©a
,

254 
gsk_h™dÀ
 
h
, 
GSK_NUM_ID
 
id
, 
vÆue
)

256 
rc
 = 
	`gsk_©åibuã_£t_numîic_vÆue
(
h
, 
id
, 
vÆue
);

258 
rc
) {

259 
GSK_OK
:

260  
CURLE_OK
;

261 
GSK_ERROR_IO
:

262 
	`Áûf
(
d©a
, "gsk_attribute_set_numeric_value() I/OÉrror: %s",

263 
	`°ªº‹
(
î∫o
));

266 
	`Áûf
(
d©a
, "gsk_©åibuã_£t_numîic_vÆue(): %s", 
	`gsk_°ªº‹
(
rc
));

269  
CURLE_SSL_CONNECT_ERROR
;

270 
	}
}

273 
CURLcode
 
	$£t_ˇŒback
(
Sessi⁄H™dÀ
 *
d©a
,

274 
gsk_h™dÀ
 
h
, 
GSK_CALLBACK_ID
 
id
, *
öfo
)

276 
rc
 = 
	`gsk_©åibuã_£t_ˇŒback
(
h
, 
id
, 
öfo
);

278 
rc
) {

279 
GSK_OK
:

280  
CURLE_OK
;

281 
GSK_ERROR_IO
:

282 
	`Áûf
(
d©a
, "gsk_©åibuã_£t_ˇŒback(ËI/OÉº‹: %s", 
	`°ªº‹
(
î∫o
));

285 
	`Áûf
(
d©a
, "gsk_©åibuã_£t_ˇŒback(): %s", 
	`gsk_°ªº‹
(
rc
));

288  
CURLE_SSL_CONNECT_ERROR
;

289 
	}
}

292 
CURLcode
 
	$£t_cùhîs
(
Sessi⁄H™dÀ
 *
d©a
,

293 
gsk_h™dÀ
 
h
, *
¥ŸoÊags
)

295 c⁄° *
cùhîli°
 = 
d©a
->
£t
.
°r
[
STRING_SSL_CIPHER_LIST
];

296 c⁄° *
˛p
;

297 c⁄° 
gskô_cùhî
 *
˘p
;

298 
i
;

299 
l
;

300 
boﬁ
 
unsuµ‹ãd
;

301 
CURLcode
 
cc
;

303 *
buf
;

304 *
±r
;

305 } 
cùhîs
[
CURL_GSKPROTO_LAST
];

309 if(!
cùhîli°
)

310  
CURLE_OK
;

311 
	`is_£∑øt‹
(*
cùhîli°
))

312 
cùhîli°
++;

313 if(!*
cùhîli°
)

314  
CURLE_OK
;

319 
l
 = 
	`°æí
(
cùhîli°
) + 1;

320 
	`mem£t
((*Ë
cùhîs
, 0,  ciphers);

321 
i
 = 0; i < 
CURL_GSKPROTO_LAST
; i++) {

322 
cùhîs
[
i
].
buf
 = 
	`mÆloc
(
l
);

323 if(!
cùhîs
[
i
].
buf
) {

324 
i
--)

325 
	`‰ì
(
cùhîs
[
i
].
buf
);

326  
CURLE_OUT_OF_MEMORY
;

328 
cùhîs
[
i
].
±r
 = cùhîs[i].
buf
;

329 *
cùhîs
[
i
].
±r
 = '\0';

333 
unsuµ‹ãd
 = 
FALSE
;

334 
cc
 = 
CURLE_OK
;

336 
˛p
 = 
cùhîli°
; *cùhîli° && !
	`is_£∑øt‹
(*cipherlist);)

337 
cùhîli°
++;

338 
l
 = 
cùhîli°
 - 
˛p
;

339 if(!
l
)

342 
˘p
 = 
cùhîèbÀ
; cç->
«me
; ctp++)

343 if(
	`°∫equÆ
(
˘p
->
«me
, 
˛p
, 
l
) && !ctp->name[l])

345 if(!
˘p
->
«me
) {

346 
	`Áûf
(
d©a
, "Unknow¿cùhî %.*s", 
l
, 
˛p
);

347 
cc
 = 
CURLE_SSL_CIPHER
;

350 
unsuµ‹ãd
 |!(
˘p
->
vîsi⁄s
 & (
CURL_GSKPROTO_SSLV2_MASK
 |

351 
CURL_GSKPROTO_SSLV3_MASK
 | 
CURL_GSKPROTO_TLSV10_MASK
));

352 
i
 = 0; i < 
CURL_GSKPROTO_LAST
; i++) {

353 if(
˘p
->
vîsi⁄s
 & (1 << 
i
)) {

354 
	`°r˝y
(
cùhîs
[
i
].
±r
, 
˘p
->
gsktokí
);

355 
cùhîs
[
i
].
±r
 +
	`°æí
(
˘p
->
gsktokí
);

361 
	`is_£∑øt‹
(*
cùhîli°
))

362 
cùhîli°
++;

366 
i
 = 0; i < 
CURL_GSKPROTO_LAST
; i++) {

367 if(!(*
¥ŸoÊags
 & (1 << 
i
)Ë|| !
cùhîs
[i].
buf
[0]) {

368 *
¥ŸoÊags
 &~(1 << 
i
);

369 
cùhîs
[
i
].
buf
[0] = '\0';

374 if(*
¥ŸoÊags
 & 
CURL_GSKPROTO_TLSV11_MASK
) {

375 
cc
 = 
	`£t_buf„r
(
d©a
, 
h
, 
GSK_TLSV11_CIPHER_SPECS
,

376 
cùhîs
[
CURL_GSKPROTO_TLSV11
].
buf
, 
TRUE
);

377 if(
cc
 =
CURLE_UNSUPPORTED_PROTOCOL
) {

378 
cc
 = 
CURLE_OK
;

379 if(
unsuµ‹ãd
) {

380 
	`Áûf
(
d©a
, "TLSv1.1-only ciphersáreÇot yet supported");

381 
cc
 = 
CURLE_SSL_CIPHER
;

385 if(
cc
 =
CURLE_OK
 && (*
¥ŸoÊags
 & 
CURL_GSKPROTO_TLSV12_MASK
)) {

386 
cc
 = 
	`£t_buf„r
(
d©a
, 
h
, 
GSK_TLSV12_CIPHER_SPECS
,

387 
cùhîs
[
CURL_GSKPROTO_TLSV12
].
buf
, 
TRUE
);

388 if(
cc
 =
CURLE_UNSUPPORTED_PROTOCOL
) {

389 
cc
 = 
CURLE_OK
;

390 if(
unsuµ‹ãd
) {

391 
	`Áûf
(
d©a
, "TLSv1.2-only ciphersáreÇot yet supported");

392 
cc
 = 
CURLE_SSL_CIPHER
;

399 if(
cc
 =
CURLE_OK
 && (*
¥ŸoÊags
 & 
CURL_GSKPROTO_TLSV10_MASK
)) {

400 
cc
 = 
	`£t_buf„r
(
d©a
, 
h
, 
GSK_TLSV10_CIPHER_SPECS
,

401 
cùhîs
[
CURL_GSKPROTO_TLSV10
].
buf
, 
TRUE
);

402 if(
cc
 =
CURLE_UNSUPPORTED_PROTOCOL
) {

403 
cc
 = 
CURLE_OK
;

404 
	`°r˝y
(
cùhîs
[
CURL_GSKPROTO_SSLV3
].
±r
,

405 
cùhîs
[
CURL_GSKPROTO_TLSV10
].
±r
);

410 if(
cc
 =
CURLE_OK
 && (*
¥ŸoÊags
 & 
CURL_GSKPROTO_SSLV3_MASK
))

411 
cc
 = 
	`£t_buf„r
(
d©a
, 
h
, 
GSK_V3_CIPHER_SPECS
,

412 
cùhîs
[
CURL_GSKPROTO_SSLV3
].
buf
, 
FALSE
);

413 if(
cc
 =
CURLE_OK
 && (*
¥ŸoÊags
 & 
CURL_GSKPROTO_SSLV2_MASK
))

414 
cc
 = 
	`£t_buf„r
(
d©a
, 
h
, 
GSK_V2_CIPHER_SPECS
,

415 
cùhîs
[
CURL_GSKPROTO_SSLV2
].
buf
, 
FALSE
);

418 
i
 = 0; i < 
CURL_GSKPROTO_LAST
; i++)

419 
	`‰ì
(
cùhîs
[
i
].
buf
);

421  
cc
;

422 
	}
}

425 
	$Cuæ_gskô_öô
()

430 
	}
}

433 
	$Cuæ_gskô_˛ónup
()

436 
	}
}

439 
CURLcode
 
	$öô_ívú⁄mít
(
Sessi⁄H™dÀ
 *
d©a
,

440 
gsk_h™dÀ
 *
ívú
, c⁄° *
≠pid
,

441 c⁄° *
fûe
, c⁄° *
œbñ
,

442 c⁄° *
∑ssw‹d
)

444 
rc
;

445 
CURLcode
 
c
;

446 
gsk_h™dÀ
 
h
;

450 
rc
 = 
	`gsk_ívú⁄mít_›í
(&
h
);

451 
rc
) {

452 
GSK_OK
:

454 
GSK_INSUFFICIENT_STORAGE
:

455  
CURLE_OUT_OF_MEMORY
;

457 
	`Áûf
(
d©a
, "gsk_ívú⁄mít_›í(): %s", 
	`gsk_°ªº‹
(
rc
));

458  
CURLE_SSL_CONNECT_ERROR
;

461 
c
 = 
	`£t_íum
(
d©a
, 
h
, 
GSK_SESSION_TYPE
, 
GSK_CLIENT_SESSION
, 
FALSE
);

462 if(
c
 =
CURLE_OK
 && 
≠pid
)

463 
c
 = 
	`£t_buf„r
(
d©a
, 
h
, 
GSK_OS400_APPLICATION_ID
, 
≠pid
, 
FALSE
);

464 if(
c
 =
CURLE_OK
 && 
fûe
)

465 
c
 = 
	`£t_buf„r
(
d©a
, 
h
, 
GSK_KEYRING_FILE
, 
fûe
, 
FALSE
);

466 if(
c
 =
CURLE_OK
 && 
œbñ
)

467 
c
 = 
	`£t_buf„r
(
d©a
, 
h
, 
GSK_KEYRING_LABEL
, 
œbñ
, 
FALSE
);

468 if(
c
 =
CURLE_OK
 && 
∑ssw‹d
)

469 
c
 = 
	`£t_buf„r
(
d©a
, 
h
, 
GSK_KEYRING_PW
, 
∑ssw‹d
, 
FALSE
);

471 if(
c
 =
CURLE_OK
) {

474 
c
 = 
	`gskô_°©us
(
d©a
, 
	`gsk_ívú⁄mít_öô
(
h
),

475 "gsk_ívú⁄mít_öô()", 
CURLE_SSL_CERTPROBLEM
);

476 if(
c
 =
CURLE_OK
) {

477 *
ívú
 = 
h
;

478  
c
;

482 
	`gsk_ívú⁄mít_˛o£
(&
h
);

483  
c
;

484 
	}
}

487 
	$ˇn˚l_async_h™dshake
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

489 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

490 
Qso_OvîœµedIO_t
 
c°©
;

492 if(
	`QsoC™˚lO≥øti⁄
(
c⁄n
->
sock
[
socködex
], 0) > 0)

493 
	`QsoWaôF‹IOCom∂ëi⁄
(
c⁄ns¶
->
io˝‹t
, &
c°©
, (
timevÆ
 *Ë
NULL
);

494 
	}
}

497 
	$˛o£_async_h™dshake
(
s¶_c⁄√˘_d©a
 *
c⁄ns¶
)

499 
	`QsoDe°royIOCom∂ëi⁄P‹t
(
c⁄ns¶
->
io˝‹t
);

500 
c⁄ns¶
->
io˝‹t
 = -1;

501 
	}
}

504 
	$˛o£_⁄e
(
s¶_c⁄√˘_d©a
 *
c⁄n
,

505 
Sessi⁄H™dÀ
 *
d©a
)

507 if(
c⁄n
->
h™dÀ
) {

508 
	`gskô_°©us
(
d©a
, 
	`gsk_£cuª_soc_˛o£
(&
c⁄n
->
h™dÀ
),

510 
c⁄n
->
h™dÀ
 = (
gsk_h™dÀ
Ë
NULL
;

512 if(
c⁄n
->
io˝‹t
 >= 0)

513 
	`˛o£_async_h™dshake
(
c⁄n
);

514 
	}
}

517 
ssize_t
 
	$gskô_£nd
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

518 c⁄° *
mem
, 
size_t
 
Àn
, 
CURLcode
 *
cuæcode
)

520 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

521 
CURLcode
 
cc
;

522 
wrôãn
;

524 
cc
 = 
	`gskô_°©us
(
d©a
,

525 
	`gsk_£cuª_soc_wrôe
(
c⁄n
->
s¶
[
socködex
].
h™dÀ
,

526 (*Ë
mem
, (Ë
Àn
, &
wrôãn
),

527 "gsk_£cuª_soc_wrôe()", 
CURLE_SEND_ERROR
);

528 if(
cc
 !
CURLE_OK
) {

529 *
cuæcode
 = 
cc
;

530 
wrôãn
 = -1;

532  (
ssize_t
Ë
wrôãn
;

533 
	}
}

536 
ssize_t
 
	$gskô_ªcv
(
c⁄√˘d©a
 *
c⁄n
, 
num
, *
buf
,

537 
size_t
 
buf„rsize
, 
CURLcode
 *
cuæcode
)

539 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

540 
buffsize
;

541 
ƒód
;

542 
CURLcode
 
cc
;

544 
buffsize
 = 
buf„rsize
 > (
size_t
Ë
INT_MAX
? INT_MAX: () buffersize;

545 
cc
 = 
	`gskô_°©us
(
d©a
, 
	`gsk_£cuª_soc_ªad
(
c⁄n
->
s¶
[
num
].
h™dÀ
,

546 
buf
, 
buffsize
, &
ƒód
),

547 "gsk_£cuª_soc_ªad()", 
CURLE_RECV_ERROR
);

548 if(
cc
 !
CURLE_OK
) {

549 *
cuæcode
 = 
cc
;

550 
ƒód
 = -1;

552  (
ssize_t
Ë
ƒód
;

553 
	}
}

556 
CURLcode
 
	$gskô_c⁄√˘_°ï1
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

558 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

559 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

560 
gsk_h™dÀ
 
ívú
;

561 
CURLcode
 
cc
;

562 
rc
;

563 *
keyrögfûe
;

564 *
keyrögpwd
;

565 *
keyrögœbñ
;

566 *
¢i
;

567 
¥ŸoÊags
;

568 
timeout
;

569 
Qso_OvîœµedIO_t
 
comm¨ó
;

573 
c⁄ns¶
->
h™dÀ
 = (
gsk_h™dÀ
Ë
NULL
;

574 
c⁄ns¶
->
io˝‹t
 = -1;

589 
keyrögfûe
 = 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
];

590 
keyrögpwd
 = 
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
];

591 
keyrögœbñ
 = 
d©a
->
£t
.
°r
[
STRING_CERT
];

592 
ívú
 = (
gsk_h™dÀ
Ë
NULL
;

594 if(
keyrögœbñ
 && *keyrögœbñ && !
keyrögpwd
 &&

595 !
	`°rcmp
(
keyrögfûe
, 
CURL_CA_BUNDLE
)) {

597 
	`öô_ívú⁄mít
(
d©a
, &
ívú
, 
keyrögœbñ
, (c⁄° *Ë
NULL
,

598 (c⁄° *Ë
NULL
, (const *) NULL);

601 if(!
ívú
) {

603 
cc
 = 
	`öô_ívú⁄mít
(
d©a
, &
ívú
, (c⁄° *Ë
NULL
,

604 
keyrögfûe
, 
keyrögœbñ
, 
keyrögpwd
);

605 if(
cc
 !
CURLE_OK
)

606  
cc
;

610 
cc
 = 
	`gskô_°©us
(
d©a
, 
	`gsk_£cuª_soc_›í
(
ívú
, &
c⁄ns¶
->
h™dÀ
),

611 "gsk_£cuª_soc_›í()", 
CURLE_SSL_CONNECT_ERROR
);

612 
	`gsk_ívú⁄mít_˛o£
(&
ívú
);

613 if(
cc
 !
CURLE_OK
)

614  
cc
;

617 
¥ŸoÊags
 = 
CURL_GSKPROTO_SSLV3_MASK
 | 
CURL_GSKPROTO_TLSV10_MASK
 |

618 
CURL_GSKPROTO_TLSV11_MASK
 | 
CURL_GSKPROTO_TLSV12_MASK
;

619 
¢i
 = 
c⁄n
->
ho°
.
«me
;

620 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

621 
CURL_SSLVERSION_SSLv2
:

622 
¥ŸoÊags
 = 
CURL_GSKPROTO_SSLV2_MASK
;

623 
¢i
 = (*Ë
NULL
;

625 
CURL_SSLVERSION_SSLv3
:

626 
¥ŸoÊags
 = 
CURL_GSKPROTO_SSLV2_MASK
;

627 
¢i
 = (*Ë
NULL
;

629 
CURL_SSLVERSION_TLSv1
:

630 
¥ŸoÊags
 = 
CURL_GSKPROTO_TLSV10_MASK
 |

631 
CURL_GSKPROTO_TLSV11_MASK
 | 
CURL_GSKPROTO_TLSV12_MASK
;

633 
CURL_SSLVERSION_TLSv1_0
:

634 
¥ŸoÊags
 = 
CURL_GSKPROTO_TLSV10_MASK
;

636 
CURL_SSLVERSION_TLSv1_1
:

637 
¥ŸoÊags
 = 
CURL_GSKPROTO_TLSV11_MASK
;

639 
CURL_SSLVERSION_TLSv1_2
:

640 
¥ŸoÊags
 = 
CURL_GSKPROTO_TLSV12_MASK
;

645 if(
¢i
) {

646 
cc
 = 
	`£t_buf„r
(
d©a
, 
c⁄ns¶
->
h™dÀ
,

647 
GSK_SSL_EXTN_SERVERNAME_REQUEST
, 
¢i
, 
TRUE
);

648 if(
cc
 =
CURLE_UNSUPPORTED_PROTOCOL
)

649 
cc
 = 
CURLE_OK
;

653 if(
cc
 =
CURLE_OK
) {

656 
timeout
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

657 if(
timeout
 < 0)

658 
cc
 = 
CURLE_OPERATION_TIMEDOUT
;

660 
cc
 = 
	`£t_numîic
(
d©a
, 
c⁄ns¶
->
h™dÀ
, 
GSK_HANDSHAKE_TIMEOUT
,

661 (
timeout
 + 999) / 1000);

663 if(
cc
 =
CURLE_OK
)

664 
cc
 = 
	`£t_numîic
(
d©a
, 
c⁄ns¶
->
h™dÀ
, 
GSK_FD
, 
c⁄n
->
sock
[
socködex
]);

665 if(
cc
 =
CURLE_OK
)

666 
cc
 = 
	`£t_cùhîs
(
d©a
, 
c⁄ns¶
->
h™dÀ
, &
¥ŸoÊags
);

667 if(!
¥ŸoÊags
) {

668 
	`Áûf
(
d©a
, "No SSLÖrotocol/cipher combinationÉnabled");

669 
cc
 = 
CURLE_SSL_CIPHER
;

671 if(
cc
 =
CURLE_OK
)

672 
cc
 = 
	`£t_íum
(
d©a
, 
c⁄ns¶
->
h™dÀ
, 
GSK_PROTOCOL_SSLV2
,

673 (
¥ŸoÊags
 & 
CURL_GSKPROTO_SSLV2_MASK
)?

674 
GSK_PROTOCOL_SSLV2_ON
: 
GSK_PROTOCOL_SSLV2_OFF
, 
FALSE
);

675 if(
cc
 =
CURLE_OK
)

676 
cc
 = 
	`£t_íum
(
d©a
, 
c⁄ns¶
->
h™dÀ
, 
GSK_PROTOCOL_SSLV3
,

677 (
¥ŸoÊags
 & 
CURL_GSKPROTO_SSLV3_MASK
)?

678 
GSK_PROTOCOL_SSLV3_ON
: 
GSK_PROTOCOL_SSLV3_OFF
, 
FALSE
);

679 if(
cc
 =
CURLE_OK
)

680 
cc
 = 
	`£t_íum
(
d©a
, 
c⁄ns¶
->
h™dÀ
, 
GSK_PROTOCOL_TLSV1
,

681 (
¥ŸoÊags
 & 
CURL_GSKPROTO_TLSV10_MASK
)?

682 
GSK_PROTOCOL_TLSV1_ON
: 
GSK_PROTOCOL_TLSV1_OFF
, 
FALSE
);

683 if(
cc
 =
CURLE_OK
) {

684 
cc
 = 
	`£t_íum
(
d©a
, 
c⁄ns¶
->
h™dÀ
, 
GSK_PROTOCOL_TLSV11
,

685 (
¥ŸoÊags
 & 
CURL_GSKPROTO_TLSV11_MASK
)?

686 
GSK_TRUE
: 
GSK_FALSE
, 
TRUE
);

687 if(
cc
 =
CURLE_UNSUPPORTED_PROTOCOL
) {

688 
cc
 = 
CURLE_OK
;

689 if(
¥ŸoÊags
 =
CURL_GSKPROTO_TLSV11_MASK
) {

690 
	`Áûf
(
d©a
, "TLS 1.1Çot yet supported");

691 
cc
 = 
CURLE_SSL_CIPHER
;

695 if(
cc
 =
CURLE_OK
) {

696 
cc
 = 
	`£t_íum
(
d©a
, 
c⁄ns¶
->
h™dÀ
, 
GSK_PROTOCOL_TLSV12
,

697 (
¥ŸoÊags
 & 
CURL_GSKPROTO_TLSV12_MASK
)?

698 
GSK_TRUE
: 
GSK_FALSE
, 
TRUE
);

699 if(
cc
 =
CURLE_UNSUPPORTED_PROTOCOL
) {

700 
cc
 = 
CURLE_OK
;

701 if(
¥ŸoÊags
 =
CURL_GSKPROTO_TLSV12_MASK
) {

702 
	`Áûf
(
d©a
, "TLS 1.2Çot yet supported");

703 
cc
 = 
CURLE_SSL_CIPHER
;

707 if(
cc
 =
CURLE_OK
)

708 
cc
 = 
	`£t_íum
(
d©a
, 
c⁄ns¶
->
h™dÀ
, 
GSK_SERVER_AUTH_TYPE
,

709 
d©a
->
£t
.
s¶
.
vîify≥î
? 
GSK_SERVER_AUTH_FULL
:

710 
GSK_SERVER_AUTH_PASSTHRU
, 
FALSE
);

712 if(
cc
 =
CURLE_OK
) {

714 
	`mem£t
(&
comm¨ó
, 0,  commarea);

715 
c⁄ns¶
->
io˝‹t
 = 
	`QsoCª©eIOCom∂ëi⁄P‹t
();

716 if(
c⁄ns¶
->
io˝‹t
 != -1) {

717 
cc
 = 
	`gskô_°©us
(
d©a
, 
	`gsk_£cuª_soc_°¨tInô
(
c⁄ns¶
->
h™dÀ
,

718 
c⁄ns¶
->
io˝‹t
, &
comm¨ó
),

719 "gsk_£cuª_soc_°¨tInô()", 
CURLE_SSL_CONNECT_ERROR
);

720 if(
cc
 =
CURLE_OK
) {

721 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2
;

722  
CURLE_OK
;

725 
	`˛o£_async_h™dshake
(
c⁄ns¶
);

727 if(
î∫o
 !
ENOBUFS
)

728 
cc
 = 
	`gskô_°©us
(
d©a
, 
GSK_ERROR_IO
, "QsoCreateIOCompletionPort()", 0);

731 
cc
 = 
	`gskô_°©us
(
d©a
, 
	`gsk_£cuª_soc_öô
(
c⁄ns¶
->
h™dÀ
),

732 "gsk_£cuª_soc_öô()", 
CURLE_SSL_CONNECT_ERROR
);

733 if(
cc
 =
CURLE_OK
) {

734 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_3
;

735  
CURLE_OK
;

741 
	`˛o£_⁄e
(
c⁄ns¶
, 
d©a
);

742  
cc
;

743 
	}
}

746 
CURLcode
 
	$gskô_c⁄√˘_°ï2
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

747 
boﬁ
 
n⁄blockög
)

749 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

750 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

751 
Qso_OvîœµedIO_t
 
c°©
;

752 
timeout_ms
;

753 
timevÆ
 
°mv
;

754 
CURLcode
 
cc
;

759 
timeout_ms
 = 
n⁄blockög
? 0: 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

760 if(
timeout_ms
 < 0)

761 
timeout_ms
 = 0;

762 
°mv
.
tv_£c
 = 
timeout_ms
 / 1000;

763 
°mv
.
tv_u£c
 = (
timeout_ms
 - stmv.
tv_£c
 * 1000) * 1000;

764 
	`QsoWaôF‹IOCom∂ëi⁄
(
c⁄ns¶
->
io˝‹t
, &
c°©
, &
°mv
)) {

768 if(
î∫o
 =
EINTR
) {

769 if(
n⁄blockög
)

770  
CURLE_OK
;

773 if(
î∫o
 !
ETIME
) {

774 
	`Áûf
(
d©a
, "QsoWaôF‹IOCom∂ëi⁄(ËI/OÉº‹: %s", 
	`°ªº‹
(
î∫o
));

775 
	`ˇn˚l_async_h™dshake
(
c⁄n
, 
socködex
);

776 
	`˛o£_async_h™dshake
(
c⁄ns¶
);

777  
CURLE_SSL_CONNECT_ERROR
;

781 if(
n⁄blockög
)

782  
CURLE_OK
;

783 
	`ˇn˚l_async_h™dshake
(
c⁄n
, 
socködex
);

784 
	`˛o£_async_h™dshake
(
c⁄ns¶
);

785  
CURLE_OPERATION_TIMEDOUT
;

789 
cc
 = 
	`gskô_°©us
(
d©a
, 
c°©
.
ªtu∫VÆue
, "SSL handshake",

790 
CURLE_SSL_CONNECT_ERROR
);

791 if(
cc
 =
CURLE_OK
)

792 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_3
;

793 
	`˛o£_async_h™dshake
(
c⁄ns¶
);

794  
cc
;

795 
	}
}

798 
CURLcode
 
	$gskô_c⁄√˘_°ï3
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

800 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

801 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

802 c⁄° 
gsk_˚π_d©a_ñem
 *
cdev
;

803 
cdec
;

804 c⁄° 
gsk_˚π_d©a_ñem
 *
p
;

805 c⁄° *
˚π
 = (c⁄° *Ë
NULL
;

806 c⁄° *
˚πíd
;

807 
i
;

808 
CURLcode
 
cc
;

812 if(
	`gskô_°©us
(
d©a
, 
	`gsk_©åibuã_gë_˚π_öfo
(
c⁄ns¶
->
h™dÀ
,

813 
GSK_PARTNER_CERT_INFO
,

814 &
cdev
, &
cdec
),

815 "gsk_©åibuã_gë_˚π_öfo()", 
CURLE_SSL_CONNECT_ERROR
) ==

816 
CURLE_OK
) {

817 
	`öfof
(
d©a
, "Server certificate:\n");

818 
p
 = 
cdev
;

819 
i
 = 0; i++ < 
cdec
; 
p
++)

820 
p
->
˚π_d©a_id
) {

821 
CERT_BODY_DER
:

822 
˚π
 = 
p
->
˚π_d©a_p
;

823 
˚πíd
 = 
˚π
 + 
cdev
->
˚π_d©a_l
;

825 
CERT_DN_PRINTABLE
:

826 
	`öfof
(
d©a
, "\àsubje˘: %.*s\n", 
p
->
˚π_d©a_l
,Ö->
˚π_d©a_p
);

828 
CERT_ISSUER_DN_PRINTABLE
:

829 
	`öfof
(
d©a
, "\àissuî: %.*s\n", 
p
->
˚π_d©a_l
,Ö->
˚π_d©a_p
);

831 
CERT_VALID_FROM
:

832 
	`öfof
(
d©a
, "\à°¨àd©e: %.*s\n", 
p
->
˚π_d©a_l
,Ö->
˚π_d©a_p
);

834 
CERT_VALID_TO
:

835 
	`öfof
(
d©a
, "\àexpúêd©e: %.*s\n", 
p
->
˚π_d©a_l
,Ö->
˚π_d©a_p
);

841 
cc
 = 
	`Cuæ_vîifyho°
(
c⁄n
, 
˚π
, 
˚πíd
);

842 if(
cc
 !
CURLE_OK
)

843  
cc
;

850 if(
d©a
->
£t
.
s¶
.
˚πöfo
) {

851 if(
	`Cuæ_s¶_öô_˚πöfo
(
d©a
, 1))

852  
CURLE_OUT_OF_MEMORY
;

853 if(
˚π
) {

854 
cc
 = 
	`Cuæ_exåa˘_˚πöfo
(
c⁄n
, 0, 
˚π
, 
˚πíd
);

855 if(
cc
 !
CURLE_OK
)

856  
cc
;

860 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_d⁄e
;

861  
CURLE_OK
;

862 
	}
}

865 
CURLcode
 
	$gskô_c⁄√˘_comm⁄
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

866 
boﬁ
 
n⁄blockög
, boﬁ *
d⁄e
)

868 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

869 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

870 
timeout_ms
;

871 
Qso_OvîœµedIO_t
 
c°©
;

872 
CURLcode
 
cc
 = 
CURLE_OK
;

874 *
d⁄e
 = 
c⁄ns¶
->
°©e
 =
s¶_c⁄√˘i⁄_com∂ëe
;

875 if(*
d⁄e
)

876  
CURLE_OK
;

879 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_1
) {

881 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

883 if(
timeout_ms
 < 0) {

885 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

886 
cc
 = 
CURLE_OPERATION_TIMEDOUT
;

889 
cc
 = 
	`gskô_c⁄√˘_°ï1
(
c⁄n
, 
socködex
);

893 if(
cc
 =
CURLE_OK
 && 
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2
) {

895 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

897 if(
timeout_ms
 < 0) {

899 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

900 
cc
 = 
CURLE_OPERATION_TIMEDOUT
;

903 
cc
 = 
	`gskô_c⁄√˘_°ï2
(
c⁄n
, 
socködex
, 
n⁄blockög
);

907 if(
cc
 =
CURLE_OK
 && 
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_3
)

908 
cc
 = 
	`gskô_c⁄√˘_°ï3
(
c⁄n
, 
socködex
);

910 if(
cc
 !
CURLE_OK
)

911 
	`˛o£_⁄e
(
c⁄ns¶
, 
d©a
);

912 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_d⁄e
) {

913 
c⁄ns¶
->
°©e
 = 
s¶_c⁄√˘i⁄_com∂ëe
;

914 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

915 
c⁄n
->
ªcv
[
socködex
] = 
gskô_ªcv
;

916 
c⁄n
->
£nd
[
socködex
] = 
gskô_£nd
;

917 *
d⁄e
 = 
TRUE
;

920  
cc
;

921 
	}
}

924 
CURLcode
 
	$Cuæ_gskô_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

925 
socködex
,

926 
boﬁ
 *
d⁄e
)

928 
CURLcode
 
cc
;

930 
cc
 = 
	`gskô_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
TRUE
, 
d⁄e
);

931 if(*
d⁄e
 || 
cc
 !
CURLE_OK
)

932 
c⁄n
->
s¶
[
socködex
].
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

933  
cc
;

934 
	}
}

937 
CURLcode
 
	$Cuæ_gskô_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

939 
CURLcode
 
ªtcode
;

940 
boﬁ
 
d⁄e
;

942 
c⁄n
->
s¶
[
socködex
].
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

943 
ªtcode
 = 
	`gskô_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
FALSE
, &
d⁄e
);

944 if(
ªtcode
)

945  
ªtcode
;

947 
	`DEBUGASSERT
(
d⁄e
);

949  
CURLE_OK
;

950 
	}
}

953 
	$Cuæ_gskô_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

955 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

956 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

958 if(
c⁄ns¶
->
u£
)

959 
	`˛o£_⁄e
(
c⁄ns¶
, 
d©a
);

960 
	}
}

963 
	$Cuæ_gskô_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
)

966 (Ë
d©a
;

968 
	}
}

971 
	$Cuæ_gskô_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

973 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

974 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

975 
ssize_t
 
ƒód
;

976 
wh©
;

977 
rc
;

978 
buf
[120];

980 if(!
c⁄ns¶
->
h™dÀ
)

983 if(
d©a
->
£t
.
·p_ccc
 !
CURLFTPSSL_CCC_ACTIVE
)

986 
	`˛o£_⁄e
(
c⁄ns¶
, 
d©a
);

987 
rc
 = 0;

988 
wh©
 = 
	`Cuæ_sockë_ªady
(
c⁄n
->
sock
[
socködex
],

989 
CURL_SOCKET_BAD
, 
SSL_SHUTDOWN_TIMEOUT
);

992 if(
wh©
 < 0) {

994 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

995 
rc
 = -1;

999 if(!
wh©
) {

1000 
	`Áûf
(
d©a
, "SSL shutdownÅimeout");

1008 
ƒód
 = 
	`ªad
(
c⁄n
->
sock
[
socködex
], 
buf
, (buf));

1010 if(
ƒód
 < 0) {

1011 
	`Áûf
(
d©a
, "ªad: %s", 
	`°ªº‹
(
î∫o
));

1012 
rc
 = -1;

1015 if(
ƒód
 <= 0)

1018 
wh©
 = 
	`Cuæ_sockë_ªady
(
c⁄n
->
sock
[
socködex
], 
CURL_SOCKET_BAD
, 0);

1021  
rc
;

1022 
	}
}

1025 
size_t
 
	$Cuæ_gskô_vîsi⁄
(*
buf„r
, 
size_t
 
size
)

1027 
	`°∫˝y
(
buf„r
, "GSKô", 
size
);

1028  
	`°æí
(
buf„r
);

1029 
	}
}

1032 
	$Cuæ_gskô_check_cxn
(
c⁄√˘d©a
 *
cxn
)

1034 
îr
;

1035 
îæí
;

1039 if(!
cxn
->
s¶
[
FIRSTSOCKET
].
h™dÀ
)

1042 
îr
 = 0;

1043 
îæí
 =  
îr
;

1045 if(
	`gësock›t
(
cxn
->
sock
[
FIRSTSOCKET
], 
SOL_SOCKET
, 
SO_ERROR
,

1046 (*Ë&
îr
, &
îæí
) ||

1047 
îæí
 ! 
îr
 ||Érr)

1051 
	}
}

	@lib/vtls/gskit.h

1 #i‚de‡
HEADER_CURL_GSKIT_H


2 
	#HEADER_CURL_GSKIT_H


	)

24 
	~"cuæ_£tup.h
"

30 
	~"uæd©a.h
"

32 #ifde‡
USE_GSKIT


33 
Cuæ_gskô_öô
();

34 
Cuæ_gskô_˛ónup
();

35 
CURLcode
 
Cuæ_gskô_c⁄√˘
(
c⁄√˘d©a
 * 
c⁄n
, 
socködex
);

36 
CURLcode
 
Cuæ_gskô_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 * 
c⁄n
,

37 
socködex
, 
boﬁ
 * 
d⁄e
);

38 
Cuæ_gskô_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

39 
Cuæ_gskô_˛o£_Æl
(
Sessi⁄H™dÀ
 * 
d©a
);

40 
Cuæ_gskô_shutdown
(
c⁄√˘d©a
 * 
c⁄n
, 
socködex
);

42 
size_t
 
Cuæ_gskô_vîsi⁄
(* 
buf„r
, size_à
size
);

43 
Cuæ_gskô_check_cxn
(
c⁄√˘d©a
 * 
cxn
);

46 
	#cuæs¶_öô
 
Cuæ_gskô_öô


	)

47 
	#cuæs¶_˛ónup
 
Cuæ_gskô_˛ónup


	)

48 
	#cuæs¶_c⁄√˘
 
Cuæ_gskô_c⁄√˘


	)

49 
	#cuæs¶_c⁄√˘_n⁄blockög
 
Cuæ_gskô_c⁄√˘_n⁄blockög


	)

52 
	#cuæs¶_£ssi⁄_‰ì
(
x
Ë
Cuæ_n›_°mt


	)

53 
	#cuæs¶_˛o£_Æl
 
Cuæ_gskô_˛o£_Æl


	)

54 
	#cuæs¶_˛o£
 
Cuæ_gskô_˛o£


	)

55 
	#cuæs¶_shutdown
(
x
,
y
Ë
	`Cuæ_gskô_shutdown
(x,y)

	)

56 
	#cuæs¶_£t_ígöe
(
x
,
y
Ë
CURLE_NOT_BUILT_IN


	)

57 
	#cuæs¶_£t_ígöe_deÁu…
(
x
Ë
CURLE_NOT_BUILT_IN


	)

58 
	#cuæs¶_ígöes_li°
(
x
Ë
NULL


	)

59 
	#cuæs¶_vîsi⁄
 
Cuæ_gskô_vîsi⁄


	)

60 
	#cuæs¶_check_cxn
(
x
Ë
	`Cuæ_gskô_check_cxn
(x)

	)

61 
	#cuæs¶_d©a_≥ndög
(
x
,
y
Ë0

	)

	@lib/vtls/gtls.c

31 
	~"cuæ_£tup.h
"

33 #ifde‡
USE_GNUTLS


35 
	~<gnués/gnués.h
>

36 
	~<gnués/x509.h
>

38 #ifde‡
USE_GNUTLS_NETTLE


39 
	~<gnués/¸y±o.h
>

40 
	~<√âÀ/md5.h
>

42 
	~<g¸y±.h
>

45 
	~"uæd©a.h
"

46 
	~"£ndf.h
"

47 
	~"öë_±⁄.h
"

48 
	~"gés.h
"

49 
	~"vés.h
"

50 
	~"∑r£d©e.h
"

51 
	~"c⁄√˘.h
"

52 
	~"£À˘.h
"

53 
	~"øw°r.h
"

54 
	~"w¨∆ess.h
"

56 
	#_MPRINTF_REPLACE


	)

57 
	~<cuæ/m¥ötf.h
>

58 
	~"cuæ_mem‹y.h
"

60 
	~"memdebug.h
"

66 #i‚de‡
GNUTLS_POINTER_TO_INT_CAST


67 
	#GNUTLS_POINTER_TO_INT_CAST
(
p
Ë((Ë(Ë’))

	)

69 #i‚de‡
GNUTLS_INT_TO_POINTER_CAST


70 
	#GNUTLS_INT_TO_POINTER_CAST
(
i
Ë((*Ë(Ë(i))

	)

76 #ifde‡
GTLSDEBUG


77 
	$és_log_func
(
Àvñ
, c⁄° *
°r
)

79 
	`Ârötf
(
°dîr
, "|<%d>| %s", 
Àvñ
, 
°r
);

80 
	}
}

82 
boﬁ
 
	ggés_öôed
 = 
FALSE
;

84 #i‡
deföed
(
GNUTLS_VERSION_NUMBER
)

85 #i‡(
GNUTLS_VERSION_NUMBER
 >= 0x020c00)

86 #unde‡
gnués_å™•‹t_£t_low©


87 
	#gnués_å™•‹t_£t_low©
(
A
,
B
Ë
Cuæ_n›_°mt


	)

88 
	#USE_GNUTLS_PRIORITY_SET_DIRECT
 1

	)

90 #i‡(
GNUTLS_VERSION_NUMBER
 >= 0x020c03)

91 
	#GNUTLS_MAPS_WINSOCK_ERRORS
 1

	)

94 #ifde‡
USE_NGHTTP2


95 #unde‡
HAS_ALPN


96 #i‡(
GNUTLS_VERSION_NUMBER
 >= 0x030200)

97 
	#HAS_ALPN


	)

126 #i‡
deföed
(
USE_WINSOCK
Ë&& !deföed(
GNUTLS_MAPS_WINSOCK_ERRORS
)

127 
	#gés_EINTR
 4

	)

128 
	#gés_EIO
 5

	)

129 
	#gés_EAGAIN
 11

	)

130 
	$gés_m≠≥d_sockî∫o
()

132 
SOCKERRNO
) {

133 
WSAEWOULDBLOCK
:

134  
gés_EAGAIN
;

135 
WSAEINTR
:

136  
gés_EINTR
;

140  
gés_EIO
;

141 
	}
}

144 
ssize_t
 
	$Cuæ_gés_push
(*
s
, c⁄° *
buf
, 
size_t
 
Àn
)

146 
ssize_t
 
ªt
 = 
	`swrôe
(
	`GNUTLS_POINTER_TO_INT_CAST
(
s
), 
buf
, 
Àn
);

147 #i‡
	`deföed
(
USE_WINSOCK
Ë&& !deföed(
GNUTLS_MAPS_WINSOCK_ERRORS
)

148 if(
ªt
 < 0)

149 
	`gnués_å™•‹t_£t_globÆ_î∫o
(
	`gés_m≠≥d_sockî∫o
());

151  
ªt
;

152 
	}
}

154 
ssize_t
 
	$Cuæ_gés_puŒ
(*
s
, *
buf
, 
size_t
 
Àn
)

156 
ssize_t
 
ªt
 = 
	`§ód
(
	`GNUTLS_POINTER_TO_INT_CAST
(
s
), 
buf
, 
Àn
);

157 #i‡
	`deföed
(
USE_WINSOCK
Ë&& !deföed(
GNUTLS_MAPS_WINSOCK_ERRORS
)

158 if(
ªt
 < 0)

159 
	`gnués_å™•‹t_£t_globÆ_î∫o
(
	`gés_m≠≥d_sockî∫o
());

161  
ªt
;

162 
	}
}

171 
	$Cuæ_gés_öô
()

173 
ªt
 = 1;

174 if(!
gés_öôed
) {

175 
ªt
 = 
	`gnués_globÆ_öô
()?0:1;

176 #ifde‡
GTLSDEBUG


177 
	`gnués_globÆ_£t_log_fun˘i⁄
(
és_log_func
);

178 
	`gnués_globÆ_£t_log_Àvñ
(2);

180 
gés_öôed
 = 
TRUE
;

182  
ªt
;

183 
	}
}

185 
	$Cuæ_gés_˛ónup
()

187 if(
gés_öôed
) {

188 
	`gnués_globÆ_deöô
();

189 
gés_öôed
 = 
FALSE
;

192 
	}
}

194 
	$showtime
(
Sessi⁄H™dÀ
 *
d©a
,

195 c⁄° *
ãxt
,

196 
time_t
 
°amp
)

198 
tm
 
buf„r
;

199 c⁄° 
tm
 *tm = &
buf„r
;

200 
CURLcode
 
ªsu…
 = 
	`Cuæ_gmtime
(
°amp
, &
buf„r
);

201 if(
ªsu…
)

204 
	`¢¥ötf
(
d©a
->
°©e
.
buf„r
,

205 
BUFSIZE
,

207 
ãxt
,

208 
Cuæ_wkday
[
tm
->
tm_wday
?tm->tm_wday-1:6],

209 
tm
->
tm_mday
,

210 
Cuæ_m⁄th
[
tm
->
tm_m⁄
],

211 
tm
->
tm_yór
 + 1900,

212 
tm
->
tm_hour
,

213 
tm
->
tm_mö
,

214 
tm
->
tm_£c
);

215 
	`öfof
(
d©a
, "%s\n", d©a->
°©e
.
buf„r
);

216 
	}
}

218 
gnués_d©um_t
 
	$lﬂd_fûe
 (c⁄° *
fûe
)

220 
FILE
 *
f
;

221 
gnués_d©um_t
 
lﬂded_fûe
 = { 
NULL
, 0 };

222 
fûñí
;

223 *
±r
;

225 if(!(
f
 = 
	`f›í
(
fûe
, "r")))

226  
lﬂded_fûe
;

227 if(
	`f£ek
(
f
, 0, 
SEEK_END
) != 0

228 || (
fûñí
 = 
	`·ñl
(
f
)) < 0

229 || 
	`f£ek
(
f
, 0, 
SEEK_SET
) != 0

230 || !(
±r
 = 
	`mÆloc
((
size_t
)
fûñí
)))

231 
out
;

232 if(
	`‰ód
(
±r
, 1, (
size_t
)
fûñí
, 
f
) < (size_t)filelen) {

233 
	`‰ì
(
±r
);

234 
out
;

237 
lﬂded_fûe
.
d©a
 = 
±r
;

238 
lﬂded_fûe
.
size
 = ()
fûñí
;

239 
out
:

240 
	`f˛o£
(
f
);

241  
lﬂded_fûe
;

242 
	}
}

244 
	$u∆ﬂd_fûe
(
gnués_d©um_t
 
d©a
) {

245 
	`‰ì
(
d©a
.data);

246 
	}
}

250 
CURLcode
 
	$h™dshake
(
c⁄√˘d©a
 *
c⁄n
,

251 
socködex
,

252 
boﬁ
 
durögc⁄√˘
,

253 
boﬁ
 
n⁄blockög
)

255 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

256 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

257 
gnués_£ssi⁄_t
 
£ssi⁄
 = 
c⁄n
->
s¶
[
socködex
].session;

258 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
socködex
];

259 
timeout_ms
;

260 
rc
;

261 
wh©
;

265 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
durögc⁄√˘
);

267 if(
timeout_ms
 < 0) {

269 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

270  
CURLE_OPERATION_TIMEDOUT
;

274 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_ªadög


275 || 
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_wrôög
) {

277 
cuæ_sockë_t
 
wrôefd
 = 
s¶_c⁄√˘_2_wrôög
==

278 
c⁄ns¶
->
c⁄√˘ög_°©e
?
sockfd
:
CURL_SOCKET_BAD
;

279 
cuæ_sockë_t
 
ªadfd
 = 
s¶_c⁄√˘_2_ªadög
==

280 
c⁄ns¶
->
c⁄√˘ög_°©e
?
sockfd
:
CURL_SOCKET_BAD
;

282 
wh©
 = 
	`Cuæ_sockë_ªady
(
ªadfd
, 
wrôefd
,

283 
n⁄blockög
?0:

284 
timeout_ms
?timeout_ms:1000);

285 if(
wh©
 < 0) {

287 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

288  
CURLE_SSL_CONNECT_ERROR
;

290 if(0 =
wh©
) {

291 if(
n⁄blockög
)

292  
CURLE_OK
;

293 if(
timeout_ms
) {

295 
	`Áûf
(
d©a
, "SSL c⁄√˘i⁄Åimeouà© %ld", 
timeout_ms
);

296  
CURLE_OPERATION_TIMEDOUT
;

302 
rc
 = 
	`gnués_h™dshake
(
£ssi⁄
);

304 if((
rc
 =
GNUTLS_E_AGAIN
Ë|| (r¯=
GNUTLS_E_INTERRUPTED
)) {

305 
c⁄ns¶
->
c⁄√˘ög_°©e
 =

306 
	`gnués_ªc‹d_gë_dúe˘i⁄
(
£ssi⁄
)?

307 
s¶_c⁄√˘_2_wrôög
:
s¶_c⁄√˘_2_ªadög
;

309 if(
n⁄blockög
)

310  
CURLE_OK
;

312 if((
rc
 < 0Ë&& !
	`gnués_îr‹_is_Áèl
(rc)) {

313 c⁄° *
°ªº
 = 
NULL
;

315 if(
rc
 =
GNUTLS_E_WARNING_ALERT_RECEIVED
) {

316 
Æît
 = 
	`gnués_Æît_gë
(
£ssi⁄
);

317 
°ªº
 = 
	`gnués_Æît_gë_«me
(
Æît
);

320 if(
°ªº
 =
NULL
)

321 
°ªº
 = 
	`gnués_°ªº‹
(
rc
);

323 
	`Áûf
(
d©a
, "gnués_h™dshake(Ëw¨nög: %s", 
°ªº
);

325 if(
rc
 < 0) {

326 c⁄° *
°ªº
 = 
NULL
;

328 if(
rc
 =
GNUTLS_E_FATAL_ALERT_RECEIVED
) {

329 
Æît
 = 
	`gnués_Æît_gë
(
£ssi⁄
);

330 
°ªº
 = 
	`gnués_Æît_gë_«me
(
Æît
);

333 if(
°ªº
 =
NULL
)

334 
°ªº
 = 
	`gnués_°ªº‹
(
rc
);

336 
	`Áûf
(
d©a
, "gnués_h™dshake(ËÁûed: %s", 
°ªº
);

337  
CURLE_SSL_CONNECT_ERROR
;

341 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

342  
CURLE_OK
;

344 
	}
}

346 
gnués_x509_¸t_fmt_t
 
	$do_fûe_ty≥
(c⁄° *
ty≥
)

348 if(!
ty≥
 || !type[0])

349  
GNUTLS_X509_FMT_PEM
;

350 if(
	`Cuæ_øw_equÆ
(
ty≥
, "PEM"))

351  
GNUTLS_X509_FMT_PEM
;

352 if(
	`Cuæ_øw_equÆ
(
ty≥
, "DER"))

353  
GNUTLS_X509_FMT_DER
;

355 
	}
}

357 
CURLcode


358 
	$gés_c⁄√˘_°ï1
(
c⁄√˘d©a
 *
c⁄n
,

359 
socködex
)

361 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

362 
gnués_£ssi⁄_t
 
£ssi⁄
;

363 
rc
;

364 *
s¶_£ssi⁄id
;

365 
size_t
 
s¶_idsize
;

366 
boﬁ
 
¢i
 = 
TRUE
;

367 #ifde‡
ENABLE_IPV6


368 
ö6_addr
 
addr
;

370 
ö_addr
 
addr
;

372 #i‚de‡
USE_GNUTLS_PRIORITY_SET_DIRECT


373 c⁄° 
cùhî_¥i‹ôy
[] = {

379 
GNUTLS_CIPHER_AES_128_CBC
,

380 
GNUTLS_CIPHER_AES_256_CBC
,

381 
GNUTLS_CIPHER_CAMELLIA_128_CBC
,

382 
GNUTLS_CIPHER_CAMELLIA_256_CBC
,

383 
GNUTLS_CIPHER_3DES_CBC
,

385 c⁄° 
˚π_ty≥_¥i‹ôy
[] = { 
GNUTLS_CRT_X509
, 0 };

386 
¥Ÿocﬁ_¥i‹ôy
[] = { 0, 0, 0, 0 };

388 
	#GNUTLS_CIPHERS
 "NORMAL:-ARCFOUR-128:-CTYPE-ALL:+CTYPE-X509"

	)

392 
	#GNUTLS_SRP
 "+SRP"

	)

393 c⁄° * 
¥i‹ôyli°
;

394 c⁄° *
îr
 = 
NULL
;

396 #ifde‡
HAS_ALPN


397 
¥Ÿocﬁs_size
 = 2;

398 
gnués_d©um_t
 
¥Ÿocﬁs
[2];

401 if(
c⁄n
->
s¶
[
socködex
].
°©e
 =
s¶_c⁄√˘i⁄_com∂ëe
)

404  
CURLE_OK
;

406 if(!
gés_öôed
)

407 
	`Cuæ_gés_öô
();

410 if(
d©a
->
£t
.
s¶
.
vîsi⁄
 =
CURL_SSLVERSION_SSLv2
) {

411 
	`Áûf
(
d©a
, "GnuTLS doesÇot support SSLv2");

412  
CURLE_SSL_CONNECT_ERROR
;

414 if(
d©a
->
£t
.
s¶
.
vîsi⁄
 =
CURL_SSLVERSION_SSLv3
)

415 
¢i
 = 
FALSE
;

418 
rc
 = 
	`gnués_˚πifiˇã_Æloˇã_¸edítüls
(&
c⁄n
->
s¶
[
socködex
].
¸ed
);

419 if(
rc
 !
GNUTLS_E_SUCCESS
) {

420 
	`Áûf
(
d©a
, "gnués_˚π_Æl_¸ed(ËÁûed: %s", 
	`gnués_°ªº‹
(
rc
));

421  
CURLE_SSL_CONNECT_ERROR
;

424 #ifde‡
USE_TLS_SRP


425 if(
d©a
->
£t
.
s¶
.
authty≥
 =
CURL_TLSAUTH_SRP
) {

426 
	`öfof
(
d©a
, "Usög TLS-SRP u£∫ame: %s\n", d©a->
£t
.
s¶
.
u£∫ame
);

428 
rc
 = 
	`gnués_§p_Æloˇã_˛õ¡_¸edítüls
(

429 &
c⁄n
->
s¶
[
socködex
].
§p_˛õ¡_¸ed
);

430 if(
rc
 !
GNUTLS_E_SUCCESS
) {

431 
	`Áûf
(
d©a
, "gnutls_srp_allocate_client_cred() failed: %s",

432 
	`gnués_°ªº‹
(
rc
));

433  
CURLE_OUT_OF_MEMORY
;

436 
rc
 = 
	`gnués_§p_£t_˛õ¡_¸edítüls
(
c⁄n
->
s¶
[
socködex
].

437 
§p_˛õ¡_¸ed
,

438 
d©a
->
£t
.
s¶
.
u£∫ame
,

439 
d©a
->
£t
.
s¶
.
∑ssw‹d
);

440 if(
rc
 !
GNUTLS_E_SUCCESS
) {

441 
	`Áûf
(
d©a
, "gnutls_srp_set_client_cred() failed: %s",

442 
	`gnués_°ªº‹
(
rc
));

443  
CURLE_BAD_FUNCTION_ARGUMENT
;

448 if(
d©a
->
£t
.
s¶
.
CAfûe
) {

450 
	`gnués_˚πifiˇã_£t_vîify_Êags
(
c⁄n
->
s¶
[
socködex
].
¸ed
,

451 
GNUTLS_VERIFY_ALLOW_X509_V1_CA_CRT
);

453 
rc
 = 
	`gnués_˚πifiˇã_£t_x509_åu°_fûe
(
c⁄n
->
s¶
[
socködex
].
¸ed
,

454 
d©a
->
£t
.
s¶
.
CAfûe
,

455 
GNUTLS_X509_FMT_PEM
);

456 if(
rc
 < 0) {

457 
	`öfof
(
d©a
, "errorÑeading ca cert file %s (%s)\n",

458 
d©a
->
£t
.
s¶
.
CAfûe
, 
	`gnués_°ªº‹
(
rc
));

459 if(
d©a
->
£t
.
s¶
.
vîify≥î
)

460  
CURLE_SSL_CACERT_BADFILE
;

463 
	`öfof
(
d©a
, "found %d certificates in %s\n",

464 
rc
, 
d©a
->
£t
.
s¶
.
CAfûe
);

467 if(
d©a
->
£t
.
s¶
.
CRLfûe
) {

469 
rc
 = 
	`gnués_˚πifiˇã_£t_x509_¸l_fûe
(
c⁄n
->
s¶
[
socködex
].
¸ed
,

470 
d©a
->
£t
.
s¶
.
CRLfûe
,

471 
GNUTLS_X509_FMT_PEM
);

472 if(
rc
 < 0) {

473 
	`Áûf
(
d©a
, "errorÑeading crl file %s (%s)",

474 
d©a
->
£t
.
s¶
.
CRLfûe
, 
	`gnués_°ªº‹
(
rc
));

475  
CURLE_SSL_CRL_BADFILE
;

478 
	`öfof
(
d©a
, "found %d CRL in %s\n",

479 
rc
, 
d©a
->
£t
.
s¶
.
CRLfûe
);

483 
rc
 = 
	`gnués_öô
(&
c⁄n
->
s¶
[
socködex
].
£ssi⁄
, 
GNUTLS_CLIENT
);

484 if(
rc
 !
GNUTLS_E_SUCCESS
) {

485 
	`Áûf
(
d©a
, "gnués_öô(ËÁûed: %d", 
rc
);

486  
CURLE_SSL_CONNECT_ERROR
;

490 
£ssi⁄
 = 
c⁄n
->
s¶
[
socködex
].session;

492 if((0 =
	`Cuæ_öë_±⁄
(
AF_INET
, 
c⁄n
->
ho°
.
«me
, &
addr
)) &&

493 #ifde‡
ENABLE_IPV6


494 (0 =
	`Cuæ_öë_±⁄
(
AF_INET6
, 
c⁄n
->
ho°
.
«me
, &
addr
)) &&

496 
¢i
 &&

497 (
	`gnués_£rvî_«me_£t
(
£ssi⁄
, 
GNUTLS_NAME_DNS
, 
c⁄n
->
ho°
.
«me
,

498 
	`°æí
(
c⁄n
->
ho°
.
«me
)) < 0))

499 
	`öfof
(
d©a
, "WARNING: failedÅo configure serverÇame indication (SNI) "

503 
rc
 = 
	`gnués_£t_deÁu…_¥i‹ôy
(
£ssi⁄
);

504 if(
rc
 !
GNUTLS_E_SUCCESS
)

505  
CURLE_SSL_CONNECT_ERROR
;

507 #i‚de‡
USE_GNUTLS_PRIORITY_SET_DIRECT


508 
rc
 = 
	`gnués_cùhî_£t_¥i‹ôy
(
£ssi⁄
, 
cùhî_¥i‹ôy
);

509 if(
rc
 !
GNUTLS_E_SUCCESS
)

510  
CURLE_SSL_CONNECT_ERROR
;

515 
rc
 = 
	`gnués_˚πifiˇã_ty≥_£t_¥i‹ôy
(
£ssi⁄
, 
˚π_ty≥_¥i‹ôy
);

516 if(
rc
 !
GNUTLS_E_SUCCESS
)

517  
CURLE_SSL_CONNECT_ERROR
;

519 if(
d©a
->
£t
.
s¶
.
cùhî_li°
 !
NULL
) {

520 
	`Áûf
(
d©a
, "can'tÖassá custom cipherÜistÅo older GnuTLS"

522  
CURLE_SSL_CONNECT_ERROR
;

525 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

526 
CURL_SSLVERSION_SSLv3
:

527 
¥Ÿocﬁ_¥i‹ôy
[0] = 
GNUTLS_SSL3
;

529 
CURL_SSLVERSION_DEFAULT
:

530 
CURL_SSLVERSION_TLSv1
:

531 
¥Ÿocﬁ_¥i‹ôy
[0] = 
GNUTLS_TLS1_0
;

532 
¥Ÿocﬁ_¥i‹ôy
[1] = 
GNUTLS_TLS1_1
;

533 
¥Ÿocﬁ_¥i‹ôy
[2] = 
GNUTLS_TLS1_2
;

535 
CURL_SSLVERSION_TLSv1_0
:

536 
¥Ÿocﬁ_¥i‹ôy
[0] = 
GNUTLS_TLS1_0
;

538 
CURL_SSLVERSION_TLSv1_1
:

539 
¥Ÿocﬁ_¥i‹ôy
[0] = 
GNUTLS_TLS1_1
;

541 
CURL_SSLVERSION_TLSv1_2
:

542 
¥Ÿocﬁ_¥i‹ôy
[0] = 
GNUTLS_TLS1_2
;

544 
CURL_SSLVERSION_SSLv2
:

546 
	`Áûf
(
d©a
, "GnuTLS doesÇot support SSLv2");

547  
CURLE_SSL_CONNECT_ERROR
;

550 
rc
 = 
	`gnués_¥Ÿocﬁ_£t_¥i‹ôy
(
£ssi⁄
, 
¥Ÿocﬁ_¥i‹ôy
);

551 if(
rc
 !
GNUTLS_E_SUCCESS
) {

552 
	`Áûf
(
d©a
, "Did youÖassá valid GnuTLS cipherÜist?");

553  
CURLE_SSL_CONNECT_ERROR
;

560 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

561 
CURL_SSLVERSION_SSLv3
:

562 
¥i‹ôyli°
 = 
GNUTLS_CIPHERS
 ":-VERS-TLS-ALL:+VERS-SSL3.0";

563 
¢i
 = 
Ál£
;

565 
CURL_SSLVERSION_DEFAULT
:

566 
CURL_SSLVERSION_TLSv1
:

567 
¥i‹ôyli°
 = 
GNUTLS_CIPHERS
 ":-VERS-SSL3.0:" 
GNUTLS_SRP
;

569 
CURL_SSLVERSION_TLSv1_0
:

570 
¥i‹ôyli°
 = 
GNUTLS_CIPHERS
 ":-VERS-SSL3.0:-VERS-TLS-ALL:"

571 "+VERS-TLS1.0:" 
GNUTLS_SRP
;

573 
CURL_SSLVERSION_TLSv1_1
:

574 
¥i‹ôyli°
 = 
GNUTLS_CIPHERS
 ":-VERS-SSL3.0:-VERS-TLS-ALL:"

575 "+VERS-TLS1.1:" 
GNUTLS_SRP
;

577 
CURL_SSLVERSION_TLSv1_2
:

578 
¥i‹ôyli°
 = 
GNUTLS_CIPHERS
 ":-VERS-SSL3.0:-VERS-TLS-ALL:"

579 "+VERS-TLS1.2:" 
GNUTLS_SRP
;

581 
CURL_SSLVERSION_SSLv2
:

583 
	`Áûf
(
d©a
, "GnuTLS doesÇot support SSLv2");

584  
CURLE_SSL_CONNECT_ERROR
;

587 
rc
 = 
	`gnués_¥i‹ôy_£t_dúe˘
(
£ssi⁄
, 
¥i‹ôyli°
, &
îr
);

588 if((
rc
 =
GNUTLS_E_INVALID_REQUEST
Ë&& 
îr
) {

589 if(!
	`°rcmp
(
îr
, 
GNUTLS_SRP
)) {

592 
vÆid¥i‹ôyÀn
 = 
	`cuæx_uztosi
(
îr
 - 
¥i‹ôyli°
);

593 *
¥i‹ôyc›y
 = 
	`°rdup
(
¥i‹ôyli°
);

594 if(!
¥i‹ôyc›y
)

595  
CURLE_OUT_OF_MEMORY
;

597 
	`öfof
(
d©a
, "This GnuTLS doesÇot support SRP\n");

598 if(
vÆid¥i‹ôyÀn
)

600 
¥i‹ôyc›y
[
vÆid¥i‹ôyÀn
 - 1] = 0;

601 
rc
 = 
	`gnués_¥i‹ôy_£t_dúe˘
(
£ssi⁄
, 
¥i‹ôyc›y
, &
îr
);

602 
	`‰ì
(
¥i‹ôyc›y
);

605 if(
rc
 !
GNUTLS_E_SUCCESS
) {

606 
	`Áûf
(
d©a
, "Error %d setting GnuTLS cipherÜist starting with %s",

607 
rc
, 
îr
);

608  
CURLE_SSL_CONNECT_ERROR
;

612 #ifde‡
HAS_ALPN


613 if(
d©a
->
£t
.
hâpvîsi⁄
 =
CURL_HTTP_VERSION_2_0
) {

614 if(
d©a
->
£t
.
s¶_íabÀ_Æ≤
) {

615 
¥Ÿocﬁs
[0].
d©a
 = 
NGHTTP2_PROTO_VERSION_ID
;

616 
¥Ÿocﬁs
[0].
size
 = 
NGHTTP2_PROTO_VERSION_ID_LEN
;

617 
¥Ÿocﬁs
[1].
d©a
 = 
ALPN_HTTP_1_1
;

618 
¥Ÿocﬁs
[1].
size
 = 
ALPN_HTTP_1_1_LENGTH
;

619 
	`gnués_Æ≤_£t_¥Ÿocﬁs
(
£ssi⁄
, 
¥Ÿocﬁs
, 
¥Ÿocﬁs_size
, 0);

620 
	`öfof
(
d©a
, "ALPN, of„rög %s, %s\n", 
NGHTTP2_PROTO_VERSION_ID
,

621 
ALPN_HTTP_1_1
);

624 
	`öfof
(
d©a
, "SSL, can'tÇegotiate HTTP/2.0 without ALPN\n");

629 if(
d©a
->
£t
.
°r
[
STRING_CERT
]) {

630 if(
	`gnués_˚πifiˇã_£t_x509_key_fûe
(

631 
c⁄n
->
s¶
[
socködex
].
¸ed
,

632 
d©a
->
£t
.
°r
[
STRING_CERT
],

633 
d©a
->
£t
.
°r
[
STRING_KEY
] ?

634 
d©a
->
£t
.
°r
[
STRING_KEY
] : d©a->£t.°r[
STRING_CERT
],

635 
	`do_fûe_ty≥
(
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
]) ) !=

636 
GNUTLS_E_SUCCESS
) {

637 
	`Áûf
(
d©a
, "errorÑeading X.509 key or certificate file");

638  
CURLE_SSL_CONNECT_ERROR
;

642 #ifde‡
USE_TLS_SRP


644 if(
d©a
->
£t
.
s¶
.
authty≥
 =
CURL_TLSAUTH_SRP
) {

645 
rc
 = 
	`gnués_¸edítüls_£t
(
£ssi⁄
, 
GNUTLS_CRD_SRP
,

646 
c⁄n
->
s¶
[
socködex
].
§p_˛õ¡_¸ed
);

647 if(
rc
 !
GNUTLS_E_SUCCESS
)

648 
	`Áûf
(
d©a
, "gnués_¸edítüls_£t(ËÁûed: %s", 
	`gnués_°ªº‹
(
rc
));

652 
rc
 = 
	`gnués_¸edítüls_£t
(
£ssi⁄
, 
GNUTLS_CRD_CERTIFICATE
,

653 
c⁄n
->
s¶
[
socködex
].
¸ed
);

656 
	`gnués_å™•‹t_£t_±r
(
£ssi⁄
,

657 
	`GNUTLS_INT_TO_POINTER_CAST
(
c⁄n
->
sock
[
socködex
]));

660 
	`gnués_å™•‹t_£t_push_fun˘i⁄
(
£ssi⁄
, 
Cuæ_gés_push
);

661 
	`gnués_å™•‹t_£t_puŒ_fun˘i⁄
(
£ssi⁄
, 
Cuæ_gés_puŒ
);

664 
	`gnués_å™•‹t_£t_low©
(
£ssi⁄
, 0);

669 if(!
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, &
s¶_£ssi⁄id
, &
s¶_idsize
)) {

671 
	`gnués_£ssi⁄_£t_d©a
(
£ssi⁄
, 
s¶_£ssi⁄id
, 
s¶_idsize
);

674 
	`öfof
 (
d©a
, "SSLÑe-using session ID\n");

677  
CURLE_OK
;

678 
	}
}

680 
Cuæ_ªcv
 
	ggés_ªcv
;

681 
Cuæ_£nd
 
	ggés_£nd
;

683 
CURLcode


684 
	$gés_c⁄√˘_°ï3
(
c⁄√˘d©a
 *
c⁄n
,

685 
socködex
)

687 
˚π_li°_size
;

688 c⁄° 
gnués_d©um_t
 *
chaöp
;

689 
vîify_°©us
;

690 
gnués_x509_¸t_t
 
x509_˚π
,
x509_issuî
;

691 
gnués_d©um_t
 
issuîp
;

692 
˚πbuf
[256] = "";

693 
size_t
 
size
;

694 
Ægo
;

695 
bôs
;

696 
time_t
 
˚π˛ock
;

697 c⁄° *
±r
;

698 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

699 
gnués_£ssi⁄_t
 
£ssi⁄
 = 
c⁄n
->
s¶
[
socködex
].session;

700 
rc
;

701 
öˇche
;

702 *
s¶_£ssi⁄id
;

703 #ifde‡
HAS_ALPN


704 
gnués_d©um_t
 
¥Ÿo
;

706 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

714 
chaöp
 = 
	`gnués_˚πifiˇã_gë_≥îs
(
£ssi⁄
, &
˚π_li°_size
);

715 if(!
chaöp
) {

716 if(
d©a
->
£t
.
s¶
.
vîify≥î
 ||

717 
d©a
->
£t
.
s¶
.
vîifyho°
 ||

718 
d©a
->
£t
.
s¶
.
issuî˚π
) {

719 #ifde‡
USE_TLS_SRP


720 if(
d©a
->
£t
.
s¶
.
authty≥
 =
CURL_TLSAUTH_SRP


721 && 
d©a
->
£t
.
s¶
.
u£∫ame
 !
NULL


722 && !
d©a
->
£t
.
s¶
.
vîify≥î


723 && 
	`gnués_cùhî_gë
(
£ssi⁄
)) {

729 
	`Áûf
(
d©a
, "failedÅo get server cert");

730  
CURLE_PEER_FAILED_VERIFICATION
;

731 #ifde‡
USE_TLS_SRP


735 
	`öfof
(
d©a
, "\t commonÇame: WARNING couldn't obtain\n");

738 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

746 
rc
 = 
	`gnués_˚πifiˇã_vîify_≥îs2
(
£ssi⁄
, &
vîify_°©us
);

747 if(
rc
 < 0) {

748 
	`Áûf
(
d©a
, "£rvî cîàvîify faûed: %d", 
rc
);

749  
CURLE_SSL_CONNECT_ERROR
;

753 if(
vîify_°©us
 & 
GNUTLS_CERT_INVALID
) {

754 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

755 
	`Áûf
(
d©a
, "server certificate verification failed. CAfile: %s "

756 "CRLfûe: %s", 
d©a
->
£t
.
s¶
.
CAfûe
?data->set.ssl.CAfile:"none",

757 
d©a
->
£t
.
s¶
.
CRLfûe
?data->set.ssl.CRLfile:"none");

758  
CURLE_SSL_CACERT
;

761 
	`öfof
(
d©a
, "\t server certificate verification FAILED\n");

764 
	`öfof
(
d©a
, "\t server certificate verification OK\n");

767 
	`öfof
(
d©a
, "\t server certificate verification SKIPPED\n");

770 
	`gnués_x509_¸t_öô
(&
x509_˚π
);

772 if(
chaöp
)

775 
	`gnués_x509_¸t_imp‹t
(
x509_˚π
, 
chaöp
, 
GNUTLS_X509_FMT_DER
);

777 if(
d©a
->
£t
.
s¶
.
issuî˚π
) {

778 
	`gnués_x509_¸t_öô
(&
x509_issuî
);

779 
issuîp
 = 
	`lﬂd_fûe
(
d©a
->
£t
.
s¶
.
issuî˚π
);

780 
	`gnués_x509_¸t_imp‹t
(
x509_issuî
, &
issuîp
, 
GNUTLS_X509_FMT_PEM
);

781 
rc
 = 
	`gnués_x509_¸t_check_issuî
(
x509_˚π
,
x509_issuî
);

782 
	`u∆ﬂd_fûe
(
issuîp
);

783 if(
rc
 <= 0) {

784 
	`Áûf
(
d©a
, "server certificate issuer check failed (IssuerCert: %s)",

785 
d©a
->
£t
.
s¶
.
issuî˚π
?data->set.ssl.issuercert:"none");

786  
CURLE_SSL_ISSUER_ERROR
;

788 
	`öfof
(
d©a
,"\t server certificate issuer check OK (Issuer Cert: %s)\n",

789 
d©a
->
£t
.
s¶
.
issuî˚π
?data->set.ssl.issuercert:"none");

792 
size
=(
˚πbuf
);

793 
rc
 = 
	`gnués_x509_¸t_gë_dn_by_oid
(
x509_˚π
, 
GNUTLS_OID_X520_COMMON_NAME
,

795 
FALSE
,

796 
˚πbuf
,

797 &
size
);

798 if(
rc
) {

799 
	`öfof
(
d©a
, "error fetching CN from cert:%s\n",

800 
	`gnués_°ªº‹
(
rc
));

808 
rc
 = 
	`gnués_x509_¸t_check_ho°«me
(
x509_˚π
, 
c⁄n
->
ho°
.
«me
);

809 #i‡
GNUTLS_VERSION_NUMBER
 < 0x030306

812 if(!
rc
) {

813 #ifde‡
ENABLE_IPV6


814 
	#u£_addr
 
ö6_addr


	)

816 
	#u£_addr
 
ö_addr


	)

818 
addrbuf
[(
u£_addr
)];

819 
˚πaddr
[(
u£_addr
)];

820 
size_t
 
addæí
 = 0, 
˚πaddæí
;

821 
i
;

822 
ªt
 = 0;

824 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
c⁄n
->
ho°
.
«me
, 
addrbuf
) > 0)

825 
addæí
 = 4;

826 #ifde‡
ENABLE_IPV6


827 if(
	`Cuæ_öë_±⁄
(
AF_INET6
, 
c⁄n
->
ho°
.
«me
, 
addrbuf
) > 0)

828 
addæí
 = 16;

831 if(
addæí
) {

832 
i
=0; ; i++) {

833 
˚πaddæí
 = (
˚πaddr
);

834 
ªt
 = 
	`gnués_x509_¸t_gë_subje˘_Æt_«me
(
x509_˚π
, 
i
, 
˚πaddr
,

835 &
˚πaddæí
, 
NULL
);

837 if(
ªt
 =
GNUTLS_E_SHORT_MEMORY_BUFFER
)

839 if(
ªt
 < 0)

841 if(
ªt
 !
GNUTLS_SAN_IPADDRESS
)

843 if(
˚πaddæí
 =
addæí
 && !
	`memcmp
(
addrbuf
, 
˚πaddr
,áddrlen)) {

844 
rc
 = 1;

851 if(!
rc
) {

852 if(
d©a
->
£t
.
s¶
.
vîifyho°
) {

853 
	`Áûf
(
d©a
, "SSL: certificate subjectÇame (%s) doesÇot match "

854 "èrgë ho°Çamê'%s'", 
˚πbuf
, 
c⁄n
->
ho°
.
di•«me
);

855 
	`gnués_x509_¸t_deöô
(
x509_˚π
);

856  
CURLE_PEER_FAILED_VERIFICATION
;

859 
	`öfof
(
d©a
, "\t commonÇame: %s (doesÇot match '%s')\n",

860 
˚πbuf
, 
c⁄n
->
ho°
.
di•«me
);

863 
	`öfof
(
d©a
, "\àcomm⁄Çame: %†(m©ched)\n", 
˚πbuf
);

866 
˚π˛ock
 = 
	`gnués_x509_¸t_gë_expú©i⁄_time
(
x509_˚π
);

868 if(
˚π˛ock
 =(
time_t
)-1) {

869 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

870 
	`Áûf
(
d©a
, "server certÉxpiration date verify failed");

871  
CURLE_SSL_CONNECT_ERROR
;

874 
	`öfof
(
d©a
, "\t server certificateÉxpiration date verify FAILED\n");

877 if(
˚π˛ock
 < 
	`time
(
NULL
)) {

878 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

879 
	`Áûf
(
d©a
, "server certificateÉxpiration date hasÖassed.");

880  
CURLE_PEER_FAILED_VERIFICATION
;

883 
	`öfof
(
d©a
, "\t server certificateÉxpiration date FAILED\n");

886 
	`öfof
(
d©a
, "\t server certificateÉxpiration date OK\n");

889 
˚π˛ock
 = 
	`gnués_x509_¸t_gë_a˘iv©i⁄_time
(
x509_˚π
);

891 if(
˚π˛ock
 =(
time_t
)-1) {

892 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

893 
	`Áûf
(
d©a
, "server certáctivation date verify failed");

894  
CURLE_SSL_CONNECT_ERROR
;

897 
	`öfof
(
d©a
, "\t server certificateáctivation date verify FAILED\n");

900 if(
˚π˛ock
 > 
	`time
(
NULL
)) {

901 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

902 
	`Áûf
(
d©a
, "server certificateÇotáctivated yet.");

903  
CURLE_PEER_FAILED_VERIFICATION
;

906 
	`öfof
(
d©a
, "\t server certificateáctivation date FAILED\n");

909 
	`öfof
(
d©a
, "\t server certificateáctivation date OK\n");

924 
Ægo
 = 
	`gnués_x509_¸t_gë_pk_Æg‹ôhm
(
x509_˚π
, &
bôs
);

925 
	`öfof
(
d©a
, "\t certificateÖublic key: %s\n",

926 
	`gnués_pk_Æg‹ôhm_gë_«me
(
Ægo
));

929 
	`öfof
(
d©a
, "\t certificate version: #%d\n",

930 
	`gnués_x509_¸t_gë_vîsi⁄
(
x509_˚π
));

933 
size
 = (
˚πbuf
);

934 
	`gnués_x509_¸t_gë_dn
(
x509_˚π
, 
˚πbuf
, &
size
);

935 
	`öfof
(
d©a
, "\àsubje˘: %s\n", 
˚πbuf
);

937 
˚π˛ock
 = 
	`gnués_x509_¸t_gë_a˘iv©i⁄_time
(
x509_˚π
);

938 
	`showtime
(
d©a
, "°¨àd©e", 
˚π˛ock
);

940 
˚π˛ock
 = 
	`gnués_x509_¸t_gë_expú©i⁄_time
(
x509_˚π
);

941 
	`showtime
(
d©a
, "expúêd©e", 
˚π˛ock
);

943 
size
 = (
˚πbuf
);

944 
	`gnués_x509_¸t_gë_issuî_dn
(
x509_˚π
, 
˚πbuf
, &
size
);

945 
	`öfof
(
d©a
, "\àissuî: %s\n", 
˚πbuf
);

947 
	`gnués_x509_¸t_deöô
(
x509_˚π
);

950 
±r
 = 
	`gnués_com¥essi⁄_gë_«me
(
	`gnués_com¥essi⁄_gë
(
£ssi⁄
));

952 
	`öfof
(
d©a
, "\àcom¥essi⁄: %s\n", 
±r
);

955 
±r
 = 
	`gnués_cùhî_gë_«me
(
	`gnués_cùhî_gë
(
£ssi⁄
));

956 
	`öfof
(
d©a
, "\àcùhî: %s\n", 
±r
);

959 
±r
 = 
	`gnués_mac_gë_«me
(
	`gnués_mac_gë
(
£ssi⁄
));

960 
	`öfof
(
d©a
, "\àMAC: %s\n", 
±r
);

962 #ifde‡
HAS_ALPN


963 if(
d©a
->
£t
.
s¶_íabÀ_Æ≤
) {

964 
rc
 = 
	`gnués_Æ≤_gë_£À˘ed_¥Ÿocﬁ
(
£ssi⁄
, &
¥Ÿo
);

965 if(
rc
 == 0) {

966 
	`öfof
(
d©a
, "ALPN, sîvîác˚±edÅÿu£ %.*s\n", 
¥Ÿo
.
size
,

967 
¥Ÿo
.
d©a
);

969 if(
¥Ÿo
.
size
 =
NGHTTP2_PROTO_VERSION_ID_LEN
 &&

970 
	`memcmp
(
NGHTTP2_PROTO_VERSION_ID
, 
¥Ÿo
.
d©a
,

971 
NGHTTP2_PROTO_VERSION_ID_LEN
) == 0) {

972 
c⁄n
->
√g≈n
 = 
NPN_HTTP2
;

974 if(
¥Ÿo
.
size
 =
ALPN_HTTP_1_1_LENGTH
 && 
	`memcmp
(
ALPN_HTTP_1_1
,

975 
¥Ÿo
.
d©a
, 
ALPN_HTTP_1_1_LENGTH
) == 0) {

976 
c⁄n
->
√g≈n
 = 
NPN_HTTP1_1
;

980 
	`öfof
(
d©a
, "ALPN, server didÇotágreeÅoáÖrotocol\n");

985 
c⁄n
->
s¶
[
socködex
].
°©e
 = 
s¶_c⁄√˘i⁄_com∂ëe
;

986 
c⁄n
->
ªcv
[
socködex
] = 
gés_ªcv
;

987 
c⁄n
->
£nd
[
socködex
] = 
gés_£nd
;

994 *
c⁄√˘_£ssi⁄id
;

995 
size_t
 
c⁄√˘_idsize
 = 0;

998 
	`gnués_£ssi⁄_gë_d©a
(
£ssi⁄
, 
NULL
, &
c⁄√˘_idsize
);

999 
c⁄√˘_£ssi⁄id
 = 
	`mÆloc
(
c⁄√˘_idsize
);

1001 if(
c⁄√˘_£ssi⁄id
) {

1003 
	`gnués_£ssi⁄_gë_d©a
(
£ssi⁄
, 
c⁄√˘_£ssi⁄id
, &
c⁄√˘_idsize
);

1005 
öˇche
 = !(
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, &
s¶_£ssi⁄id
, 
NULL
));

1006 if(
öˇche
) {

1009 
	`Cuæ_s¶_dñ£ssi⁄id
(
c⁄n
, 
s¶_£ssi⁄id
);

1013 
ªsu…
 = 
	`Cuæ_s¶_add£ssi⁄id
(
c⁄n
, 
c⁄√˘_£ssi⁄id
, 
c⁄√˘_idsize
);

1014 if(
ªsu…
) {

1015 
	`‰ì
(
c⁄√˘_£ssi⁄id
);

1016 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1020 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1023  
ªsu…
;

1024 
	}
}

1036 
CURLcode


1037 
	$gés_c⁄√˘_comm⁄
(
c⁄√˘d©a
 *
c⁄n
,

1038 
socködex
,

1039 
boﬁ
 
n⁄blockög
,

1040 
boﬁ
 *
d⁄e
)

1042 
rc
;

1043 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1046 if(
s¶_c⁄√˘_1
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

1047 
rc
 = 
	`gés_c⁄√˘_°ï1
 (
c⁄n
, 
socködex
);

1048 if(
rc
)

1049  
rc
;

1052 
rc
 = 
	`h™dshake
(
c⁄n
, 
socködex
, 
TRUE
, 
n⁄blockög
);

1053 if(
rc
)

1055  
rc
;

1058 if(
s¶_c⁄√˘_1
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

1059 
rc
 = 
	`gés_c⁄√˘_°ï3
(
c⁄n
, 
socködex
);

1060 if(
rc
)

1061  
rc
;

1064 *
d⁄e
 = 
s¶_c⁄√˘_1
==
c⁄ns¶
->
c⁄√˘ög_°©e
;

1066  
CURLE_OK
;

1067 
	}
}

1069 
CURLcode


1070 
	$Cuæ_gés_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

1071 
socködex
,

1072 
boﬁ
 *
d⁄e
)

1074  
	`gés_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
TRUE
, 
d⁄e
);

1075 
	}
}

1077 
CURLcode


1078 
	$Cuæ_gés_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

1079 
socködex
)

1082 
CURLcode
 
ªtcode
;

1083 
boﬁ
 
d⁄e
 = 
FALSE
;

1085 
ªtcode
 = 
	`gés_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
FALSE
, &
d⁄e
);

1086 if(
ªtcode
)

1087  
ªtcode
;

1089 
	`DEBUGASSERT
(
d⁄e
);

1091  
CURLE_OK
;

1092 
	}
}

1094 
ssize_t
 
	$gés_£nd
(
c⁄√˘d©a
 *
c⁄n
,

1095 
socködex
,

1096 c⁄° *
mem
,

1097 
size_t
 
Àn
,

1098 
CURLcode
 *
cuæcode
)

1100 
ssize_t
 
rc
 = 
	`gnués_ªc‹d_£nd
(
c⁄n
->
s¶
[
socködex
].
£ssi⁄
, 
mem
, 
Àn
);

1102 if(
rc
 < 0 ) {

1103 *
cuæcode
 = (
rc
 =
GNUTLS_E_AGAIN
)

1104 ? 
CURLE_AGAIN


1105 : 
CURLE_SEND_ERROR
;

1107 
rc
 = -1;

1110  
rc
;

1111 
	}
}

1113 
	$Cuæ_gés_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
)

1116 ()
d©a
;

1117 
	}
}

1119 
	$˛o£_⁄e
(
c⁄√˘d©a
 *
c⁄n
,

1120 
idx
)

1122 if(
c⁄n
->
s¶
[
idx
].
£ssi⁄
) {

1123 
	`gnués_bye
(
c⁄n
->
s¶
[
idx
].
£ssi⁄
, 
GNUTLS_SHUT_RDWR
);

1124 
	`gnués_deöô
(
c⁄n
->
s¶
[
idx
].
£ssi⁄
);

1125 
c⁄n
->
s¶
[
idx
].
£ssi⁄
 = 
NULL
;

1127 if(
c⁄n
->
s¶
[
idx
].
¸ed
) {

1128 
	`gnués_˚πifiˇã_‰ì_¸edítüls
(
c⁄n
->
s¶
[
idx
].
¸ed
);

1129 
c⁄n
->
s¶
[
idx
].
¸ed
 = 
NULL
;

1131 #ifde‡
USE_TLS_SRP


1132 if(
c⁄n
->
s¶
[
idx
].
§p_˛õ¡_¸ed
) {

1133 
	`gnués_§p_‰ì_˛õ¡_¸edítüls
(
c⁄n
->
s¶
[
idx
].
§p_˛õ¡_¸ed
);

1134 
c⁄n
->
s¶
[
idx
].
§p_˛õ¡_¸ed
 = 
NULL
;

1137 
	}
}

1139 
	$Cuæ_gés_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1141 
	`˛o£_⁄e
(
c⁄n
, 
socködex
);

1142 
	}
}

1148 
	$Cuæ_gés_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1150 
ssize_t
 
ªsu…
;

1151 
ªtvÆ
 = 0;

1152 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1153 
d⁄e
 = 0;

1154 
buf
[120];

1161 if(
d©a
->
£t
.
·p_ccc
 =
CURLFTPSSL_CCC_ACTIVE
)

1162 
	`gnués_bye
(
c⁄n
->
s¶
[
socködex
].
£ssi⁄
, 
GNUTLS_SHUT_WR
);

1164 if(
c⁄n
->
s¶
[
socködex
].
£ssi⁄
) {

1165 !
d⁄e
) {

1166 
wh©
 = 
	`Cuæ_sockë_ªady
(
c⁄n
->
sock
[
socködex
],

1167 
CURL_SOCKET_BAD
, 
SSL_SHUTDOWN_TIMEOUT
);

1168 if(
wh©
 > 0) {

1171 
ªsu…
 = 
	`gnués_ªc‹d_ªcv
(
c⁄n
->
s¶
[
socködex
].
£ssi⁄
,

1172 
buf
, (buf));

1173 
ªsu…
) {

1177 
d⁄e
 = 1;

1179 
GNUTLS_E_AGAIN
:

1180 
GNUTLS_E_INTERRUPTED
:

1181 
	`öfof
(
d©a
, "GNUTLS_E_AGAIN || GNUTLS_E_INTERRUPTED\n");

1184 
ªtvÆ
 = -1;

1185 
d⁄e
 = 1;

1189 if(0 =
wh©
) {

1191 
	`Áûf
(
d©a
, "SSL shutdownÅimeout");

1192 
d⁄e
 = 1;

1197 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

1198 
ªtvÆ
 = -1;

1199 
d⁄e
 = 1;

1202 
	`gnués_deöô
(
c⁄n
->
s¶
[
socködex
].
£ssi⁄
);

1204 
	`gnués_˚πifiˇã_‰ì_¸edítüls
(
c⁄n
->
s¶
[
socködex
].
¸ed
);

1206 #ifde‡
USE_TLS_SRP


1207 if(
d©a
->
£t
.
s¶
.
authty≥
 =
CURL_TLSAUTH_SRP


1208 && 
d©a
->
£t
.
s¶
.
u£∫ame
 !
NULL
)

1209 
	`gnués_§p_‰ì_˛õ¡_¸edítüls
(
c⁄n
->
s¶
[
socködex
].
§p_˛õ¡_¸ed
);

1212 
c⁄n
->
s¶
[
socködex
].
¸ed
 = 
NULL
;

1213 
c⁄n
->
s¶
[
socködex
].
£ssi⁄
 = 
NULL
;

1215  
ªtvÆ
;

1216 
	}
}

1218 
ssize_t
 
	$gés_ªcv
(
c⁄√˘d©a
 *
c⁄n
,

1219 
num
,

1220 *
buf
,

1221 
size_t
 
buf„rsize
,

1222 
CURLcode
 *
cuæcode
)

1224 
ssize_t
 
ªt
;

1226 
ªt
 = 
	`gnués_ªc‹d_ªcv
(
c⁄n
->
s¶
[
num
].
£ssi⁄
, 
buf
, 
buf„rsize
);

1227 if((
ªt
 =
GNUTLS_E_AGAIN
Ë|| (ªà=
GNUTLS_E_INTERRUPTED
)) {

1228 *
cuæcode
 = 
CURLE_AGAIN
;

1232 if(
ªt
 =
GNUTLS_E_REHANDSHAKE
) {

1235 
CURLcode
 
rc
 = 
	`h™dshake
(
c⁄n
, 
num
, 
FALSE
, FALSE);

1236 if(
rc
)

1238 *
cuæcode
 = 
rc
;

1240 *
cuæcode
 = 
CURLE_AGAIN
;

1244 if(
ªt
 < 0) {

1245 
	`Áûf
(
c⁄n
->
d©a
, "GnuTLSÑecvÉrror (%d): %s",

1246 ()
ªt
, 
	`gnués_°ªº‹
(()ret));

1247 *
cuæcode
 = 
CURLE_RECV_ERROR
;

1251  
ªt
;

1252 
	}
}

1254 
	$Cuæ_gés_£ssi⁄_‰ì
(*
±r
)

1256 
	`‰ì
(
±r
);

1257 
	}
}

1259 
size_t
 
	$Cuæ_gés_vîsi⁄
(*
buf„r
, 
size_t
 
size
)

1261  
	`¢¥ötf
(
buf„r
, 
size
, "GnuTLS/%s", 
	`gnués_check_vîsi⁄
(
NULL
));

1262 
	}
}

1264 
	$Cuæ_gés_£ed
(
Sessi⁄H™dÀ
 *
d©a
)

1268 
boﬁ
 
s¶_£eded
 = 
FALSE
;

1271 #i‚de‡
USE_GNUTLS_NETTLE


1272 
	`g¸y_Á°_øndom_pﬁl
();

1275 if(!
s¶_£eded
 || 
d©a
->
£t
.
°r
[
STRING_SSL_RANDOM_FILE
] ||

1276 
d©a
->
£t
.
°r
[
STRING_SSL_EGDSOCKET
]) {

1283 
s¶_£eded
 = 
TRUE
;

1286 
	}
}

1288 
	$Cuæ_gés_øndom
(
Sessi⁄H™dÀ
 *
d©a
,

1289 *
íå›y
,

1290 
size_t
 
Àngth
)

1292 #i‡
	`deföed
(
USE_GNUTLS_NETTLE
)

1293 ()
d©a
;

1294 
	`gnués_∫d
(
GNUTLS_RND_RANDOM
, 
íå›y
, 
Àngth
);

1295 #ñi‡
	`deföed
(
USE_GNUTLS
)

1296 
	`Cuæ_gés_£ed
(
d©a
);

1297 
	`g¸y_øndomize
(
íå›y
, 
Àngth
, 
GCRY_STRONG_RANDOM
);

1299 
	}
}

1301 
	$Cuæ_gés_md5sum
(*
tmp
,

1302 
size_t
 
tm∂í
,

1303 *
md5sum
,

1304 
size_t
 
md5Àn
)

1306 #i‡
	`deföed
(
USE_GNUTLS_NETTLE
)

1307 
md5_˘x
 
MD5pw
;

1308 
	`md5_öô
(&
MD5pw
);

1309 
	`md5_upd©e
(&
MD5pw
, ()
tm∂í
, 
tmp
);

1310 
	`md5_dige°
(&
MD5pw
, ()
md5Àn
, 
md5sum
);

1311 #ñi‡
	`deföed
(
USE_GNUTLS
)

1312 
g¸y_md_hd_t
 
MD5pw
;

1313 
	`g¸y_md_›í
(&
MD5pw
, 
GCRY_MD_MD5
, 0);

1314 
	`g¸y_md_wrôe
(
MD5pw
, 
tmp
, 
tm∂í
);

1315 
	`mem˝y
(
md5sum
, 
	`g¸y_md_ªad
 (
MD5pw
, 0), 
md5Àn
);

1316 
	`g¸y_md_˛o£
(
MD5pw
);

1318 
	}
}

	@lib/vtls/gtls.h

1 #i‚de‡
HEADER_CURL_GTLS_H


2 
	#HEADER_CURL_GTLS_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
USE_GNUTLS


29 
	~"uæd©a.h
"

31 
Cuæ_gés_öô
();

32 
Cuæ_gés_˛ónup
();

33 
CURLcode
 
Cuæ_gés_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

34 
CURLcode
 
Cuæ_gés_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

35 
socködex
,

36 
boﬁ
 *
d⁄e
);

40 
Cuæ_gés_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
);

43 
Cuæ_gés_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

45 
Cuæ_gés_£ssi⁄_‰ì
(*
±r
);

46 
size_t
 
Cuæ_gés_vîsi⁄
(*
buf„r
, size_à
size
);

47 
Cuæ_gés_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

48 
Cuæ_gés_£ed
(
Sessi⁄H™dÀ
 *
d©a
);

50 
Cuæ_gés_øndom
(
Sessi⁄H™dÀ
 *
d©a
,

51 *
íå›y
,

52 
size_t
 
Àngth
);

53 
Cuæ_gés_md5sum
(*
tmp
,

54 
size_t
 
tm∂í
,

55 *
md5sum
,

56 
size_t
 
md5Àn
);

59 
	#have_cuæs¶_øndom
 1

	)

60 
	#have_cuæs¶_md5sum
 1

	)

63 
	#cuæs¶_öô
 
Cuæ_gés_öô


	)

64 
	#cuæs¶_˛ónup
 
Cuæ_gés_˛ónup


	)

65 
	#cuæs¶_c⁄√˘
 
Cuæ_gés_c⁄√˘


	)

66 
	#cuæs¶_c⁄√˘_n⁄blockög
 
Cuæ_gés_c⁄√˘_n⁄blockög


	)

67 
	#cuæs¶_£ssi⁄_‰ì
(
x
Ë
	`Cuæ_gés_£ssi⁄_‰ì
(x)

	)

68 
	#cuæs¶_˛o£_Æl
 
Cuæ_gés_˛o£_Æl


	)

69 
	#cuæs¶_˛o£
 
Cuæ_gés_˛o£


	)

70 
	#cuæs¶_shutdown
(
x
,
y
Ë
	`Cuæ_gés_shutdown
(x,y)

	)

71 
	#cuæs¶_£t_ígöe
(
x
,
y
Ë(x=x, y=y, 
CURLE_NOT_BUILT_IN
)

	)

72 
	#cuæs¶_£t_ígöe_deÁu…
(
x
Ë(x=x, 
CURLE_NOT_BUILT_IN
)

	)

73 
	#cuæs¶_ígöes_li°
(
x
Ë(x=x, (
cuæ_¶i°
 *)
NULL
)

	)

74 
	#cuæs¶_vîsi⁄
 
Cuæ_gés_vîsi⁄


	)

75 
	#cuæs¶_check_cxn
(
x
Ë(x=x, -1)

	)

76 
	#cuæs¶_d©a_≥ndög
(
x
,
y
Ë(x=x, y=y, 0)

	)

77 
	#cuæs¶_øndom
(
x
,
y
,
z
Ë
	`Cuæ_gés_øndom
(x,y,z)

	)

78 
	#cuæs¶_md5sum
(
a
,
b
,
c
,
d
Ë
	`Cuæ_gés_md5sum
◊,b,c,d)

	)

	@lib/vtls/nss.c

28 
	~"cuæ_£tup.h
"

30 #ifde‡
USE_NSS


32 
	~"uæd©a.h
"

33 
	~"£ndf.h
"

34 
	~"f‹md©a.h
"

35 
	~"uæ.h
"

36 
	~"c⁄√˘.h
"

37 
	~"°ªquÆ.h
"

38 
	~"£À˘.h
"

39 
	~"vés.h
"

40 
	~"Œi°.h
"

42 
	#_MPRINTF_REPLACE


	)

43 
	~<cuæ/m¥ötf.h
>

45 
	~"nssg.h
"

46 
	~<n•r.h
>

47 
	~<nss.h
>

48 
	~<s¶.h
>

49 
	~<s¶îr.h
>

50 
	~<£˚º.h
>

51 
	~<£cmod.h
>

52 
	~<s¶¥Ÿo.h
>

53 
	~<¥ty≥s.h
>

54 
	~<pk11pub.h
>

55 
	~<¥io.h
>

56 
	~<£côem.h
>

57 
	~<£˝‹t.h
>

58 
	~<˚πdb.h
>

59 
	~<ba£64.h
>

60 
	~<˚π.h
>

61 
	~<¥îr‹.h
>

63 
	~"cuæ_mem‹y.h
"

64 
	~"øw°r.h
"

65 
	~"w¨∆ess.h
"

66 
	~"x509a¢1.h
"

69 
	~"memdebug.h
"

71 
	#SSL_DIR
 "/ëc/pki/nssdb"

	)

74 
	#SLOTSIZE
 13

	)

76 
PRFûeDesc
 *
PR_Imp‹tTCPSockë
(
PRI¡32
 
osfd
);

78 
PRLock
 * 
	gnss_öôlock
 = 
NULL
;

79 
PRLock
 * 
	gnss_¸Œock
 = 
NULL
;

80 
cuæ_Œi°
 *
	gnss_¸l_li°
 = 
NULL
;

81 
NSSInôC⁄ãxt
 * 
	gnss_c⁄ãxt
 = 
NULL
;

83 vﬁ©ûê
	göôülized
 = 0;

86 c⁄° *
	m«me
;

87 
	mnum
;

88 } 
	tcùhî_s
;

90 
	#PK11_SETATTRS
(
_©å
, 
_idx
, 
_ty≥
, 
_vÆ
, 
_Àn
) do { \

91 
CK_ATTRIBUTE
 *
±r
 = (
_©å
Ë+ ((
_idx
)++); \

92 
±r
->
ty≥
 = (
_ty≥
); \

93 
±r
->
pVÆue
 = (
_vÆ
); \

94 
±r
->
ulVÆueLí
 = (
_Àn
); \

95 } 
WHILE_FALSE


	)

97 
	#CERT_NewTempCîtifiˇã
 
__CERT_NewTempCîtifiˇã


	)

99 
	#NUM_OF_CIPHERS
 (
cùhîli°
)/(cùhîli°[0])

	)

100 c⁄° 
cùhî_s
 
	gcùhîli°
[] = {

102 {"rc4", 
SSL_EN_RC4_128_WITH_MD5
},

103 {"rc4-md5", 
SSL_EN_RC4_128_WITH_MD5
},

104 {"rc4exp‹t", 
SSL_EN_RC4_128_EXPORT40_WITH_MD5
},

105 {"rc2", 
SSL_EN_RC2_128_CBC_WITH_MD5
},

106 {"rc2exp‹t", 
SSL_EN_RC2_128_CBC_EXPORT40_WITH_MD5
},

107 {"des", 
SSL_EN_DES_64_CBC_WITH_MD5
},

108 {"de£de3", 
SSL_EN_DES_192_EDE3_CBC_WITH_MD5
},

110 {"rß_rc4_128_md5", 
SSL_RSA_WITH_RC4_128_MD5
},

111 {"rß_rc4_128_sha", 
SSL_RSA_WITH_RC4_128_SHA
},

112 {"rß_3des_sha", 
SSL_RSA_WITH_3DES_EDE_CBC_SHA
},

113 {"rß_des_sha", 
SSL_RSA_WITH_DES_CBC_SHA
},

114 {"rß_rc4_40_md5", 
SSL_RSA_EXPORT_WITH_RC4_40_MD5
},

115 {"rß_rc2_40_md5", 
SSL_RSA_EXPORT_WITH_RC2_CBC_40_MD5
},

116 {"rß_nuŒ_md5", 
SSL_RSA_WITH_NULL_MD5
},

117 {"rß_nuŒ_sha", 
SSL_RSA_WITH_NULL_SHA
},

118 {"fùs_3des_sha", 
SSL_RSA_FIPS_WITH_3DES_EDE_CBC_SHA
},

119 {"fùs_des_sha", 
SSL_RSA_FIPS_WITH_DES_CBC_SHA
},

120 {"f‹ãzza", 
SSL_FORTEZZA_DMS_WITH_FORTEZZA_CBC_SHA
},

121 {"f‹ãzza_rc4_128_sha", 
SSL_FORTEZZA_DMS_WITH_RC4_128_SHA
},

122 {"f‹ãzza_nuŒ", 
SSL_FORTEZZA_DMS_WITH_NULL_SHA
},

124 {"rß_des_56_sha", 
TLS_RSA_EXPORT1024_WITH_DES_CBC_SHA
},

125 {"rß_rc4_56_sha", 
TLS_RSA_EXPORT1024_WITH_RC4_56_SHA
},

127 {"dhe_dss_´s_128_cbc_sha", 
TLS_DHE_DSS_WITH_AES_128_CBC_SHA
},

128 {"dhe_dss_´s_256_cbc_sha", 
TLS_DHE_DSS_WITH_AES_256_CBC_SHA
},

129 {"dhe_rß_´s_128_cbc_sha", 
TLS_DHE_RSA_WITH_AES_128_CBC_SHA
},

130 {"dhe_rß_´s_256_cbc_sha", 
TLS_DHE_RSA_WITH_AES_256_CBC_SHA
},

131 {"rß_´s_128_sha", 
TLS_RSA_WITH_AES_128_CBC_SHA
},

132 {"rß_´s_256_sha", 
TLS_RSA_WITH_AES_256_CBC_SHA
},

134 {"ecdh_ecdß_nuŒ_sha", 
TLS_ECDH_ECDSA_WITH_NULL_SHA
},

135 {"ecdh_ecdß_rc4_128_sha", 
TLS_ECDH_ECDSA_WITH_RC4_128_SHA
},

136 {"ecdh_ecdß_3des_sha", 
TLS_ECDH_ECDSA_WITH_3DES_EDE_CBC_SHA
},

137 {"ecdh_ecdß_´s_128_sha", 
TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA
},

138 {"ecdh_ecdß_´s_256_sha", 
TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA
},

139 {"ecdhe_ecdß_nuŒ_sha", 
TLS_ECDHE_ECDSA_WITH_NULL_SHA
},

140 {"ecdhe_ecdß_rc4_128_sha", 
TLS_ECDHE_ECDSA_WITH_RC4_128_SHA
},

141 {"ecdhe_ecdß_3des_sha", 
TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA
},

142 {"ecdhe_ecdß_´s_128_sha", 
TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA
},

143 {"ecdhe_ecdß_´s_256_sha", 
TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA
},

144 {"ecdh_rß_nuŒ_sha", 
TLS_ECDH_RSA_WITH_NULL_SHA
},

145 {"ecdh_rß_128_sha", 
TLS_ECDH_RSA_WITH_RC4_128_SHA
},

146 {"ecdh_rß_3des_sha", 
TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA
},

147 {"ecdh_rß_´s_128_sha", 
TLS_ECDH_RSA_WITH_AES_128_CBC_SHA
},

148 {"ecdh_rß_´s_256_sha", 
TLS_ECDH_RSA_WITH_AES_256_CBC_SHA
},

149 {"echde_rß_nuŒ", 
TLS_ECDHE_RSA_WITH_NULL_SHA
},

150 {"ecdhe_rß_rc4_128_sha", 
TLS_ECDHE_RSA_WITH_RC4_128_SHA
},

151 {"ecdhe_rß_3des_sha", 
TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA
},

152 {"ecdhe_rß_´s_128_sha", 
TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA
},

153 {"ecdhe_rß_´s_256_sha", 
TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA
},

154 {"ecdh_™⁄_nuŒ_sha", 
TLS_ECDH_™⁄_WITH_NULL_SHA
},

155 {"ecdh_™⁄_rc4_128sha", 
TLS_ECDH_™⁄_WITH_RC4_128_SHA
},

156 {"ecdh_™⁄_3des_sha", 
TLS_ECDH_™⁄_WITH_3DES_EDE_CBC_SHA
},

157 {"ecdh_™⁄_´s_128_sha", 
TLS_ECDH_™⁄_WITH_AES_128_CBC_SHA
},

158 {"ecdh_™⁄_´s_256_sha", 
TLS_ECDH_™⁄_WITH_AES_256_CBC_SHA
},

159 #ifde‡
TLS_RSA_WITH_NULL_SHA256


161 {"rß_nuŒ_sha_256", 
TLS_RSA_WITH_NULL_SHA256
},

162 {"rß_´s_128_cbc_sha_256", 
TLS_RSA_WITH_AES_128_CBC_SHA256
},

163 {"rß_´s_256_cbc_sha_256", 
TLS_RSA_WITH_AES_256_CBC_SHA256
},

164 {"dhe_rß_´s_128_cbc_sha_256", 
TLS_DHE_RSA_WITH_AES_128_CBC_SHA256
},

165 {"dhe_rß_´s_256_cbc_sha_256", 
TLS_DHE_RSA_WITH_AES_256_CBC_SHA256
},

166 {"ecdhe_ecdß_´s_128_cbc_sha_256", 
TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
},

167 {"ecdhe_rß_´s_128_cbc_sha_256", 
TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256
},

169 #ifde‡
TLS_RSA_WITH_AES_128_GCM_SHA256


171 {"rß_´s_128_gcm_sha_256", 
TLS_RSA_WITH_AES_128_GCM_SHA256
},

172 {"dhe_rß_´s_128_gcm_sha_256", 
TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
},

173 {"dhe_dss_´s_128_gcm_sha_256", 
TLS_DHE_DSS_WITH_AES_128_GCM_SHA256
},

174 {"ecdhe_ecdß_´s_128_gcm_sha_256", 
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
},

175 {"ecdh_ecdß_´s_128_gcm_sha_256", 
TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256
},

176 {"ecdhe_rß_´s_128_gcm_sha_256", 
TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
},

177 {"ecdh_rß_´s_128_gcm_sha_256", 
TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256
},

181 c⁄° * 
	g≥m_libøry
 = "libnsspem.so";

182 
SECMODModuÀ
* 
	gmod
 = 
NULL
;

185 
PRDescIdítôy
 
	gn•r_io_idítôy
 = 
PR_INVALID_IO_LAYER
;

186 
PRIOMëhods
 
	gn•r_io_mëhods
;

188 c⁄° * 
	$nss_îr‹_to_«me
(
PREº‹Code
 
code
)

190 c⁄° *
«me
 = 
	`PR_Eº‹ToName
(
code
);

191 if(
«me
)

192  
«me
;

195 
	}
}

197 
	$nss_¥öt_îr‹_mesßge
(
Sessi⁄H™dÀ
 *
d©a
, 
PRUöt32
 
îr
)

199 
	`Áûf
(
d©a
, "%s", 
	`PR_Eº‹ToSåög
(
îr
, 
PR_LANGUAGE_I_DEFAULT
));

200 
	}
}

202 
SECSètus
 
	$£t_cùhîs
(
Sessi⁄H™dÀ
 *
d©a
, 
PRFûeDesc
 * 
modñ
,

203 *
cùhî_li°
)

205 
i
;

206 
PRBoﬁ
 
cùhî_°©e
[
NUM_OF_CIPHERS
];

207 
PRBoﬁ
 
found
;

208 *
cùhî
;

214 
i
=0; i<
SSL_NumIm∂emíãdCùhîs
; i++) {

215 
	`SSL_CùhîPªfSë
(
modñ
, 
SSL_Im∂emíãdCùhîs
[
i
], 
PR_FALSE
);

219 
i
=0; i<
NUM_OF_CIPHERS
; i++) {

220 
cùhî_°©e
[
i
] = 
PR_FALSE
;

223 
cùhî
 = 
cùhî_li°
;

225 
cùhî_li°
 && (cipher_list[0])) {

226 (*
cùhî
Ë&& (
	`ISSPACE
(*cipher)))

227 ++
cùhî
;

229 if((
cùhî_li°
 = 
	`°rchr
(
cùhî
, ','))) {

230 *
cùhî_li°
++ = '\0';

233 
found
 = 
PR_FALSE
;

235 
i
=0; i<
NUM_OF_CIPHERS
; i++) {

236 if(
	`Cuæ_øw_equÆ
(
cùhî
, 
cùhîli°
[
i
].
«me
)) {

237 
cùhî_°©e
[
i
] = 
PR_TRUE
;

238 
found
 = 
PR_TRUE
;

243 if(
found
 =
PR_FALSE
) {

244 
	`Áûf
(
d©a
, "Unknow¿cùhî i¿li°: %s", 
cùhî
);

245  
SECFaûuª
;

248 if(
cùhî_li°
) {

249 
cùhî
 = 
cùhî_li°
;

254 
i
=0; i<
NUM_OF_CIPHERS
; i++) {

255 if(!
cùhî_°©e
[
i
])

258 if(
	`SSL_CùhîPªfSë
(
modñ
, 
cùhîli°
[
i
].
num
, 
PR_TRUE
Ë!
SECSuc˚ss
) {

259 
	`Áûf
(
d©a
, "cùhî-suôênŸ suµ‹ãd by NSS: %s", 
cùhîli°
[
i
].
«me
);

260  
SECFaûuª
;

264  
SECSuc˚ss
;

265 
	}
}

271 
	$num_íabÀd_cùhîs
()

273 
PRI¡32
 
pﬁicy
 = 0;

274 
cou¡
 = 0;

275 
i
;

277 
i
=0; i<
NUM_OF_CIPHERS
; i++) {

278 
	`SSL_CùhîPﬁicyGë
(
cùhîli°
[
i
].
num
, &
pﬁicy
);

279 if(
pﬁicy
)

280 
cou¡
++;

282  
cou¡
;

283 
	}
}

292 
	$is_fûe
(c⁄° *
fûíame
)

294 
°ru˘_°©
 
°
;

296 if(
fûíame
 =
NULL
)

299 if(
	`°©
(
fûíame
, &
°
) == 0)

300 if(
	`S_ISREG
(
°
.
°_mode
))

304 
	}
}

312 * 
	$dup_nick«me
(
Sessi⁄H™dÀ
 *
d©a
, 
dup°rög
 
˚π_köd
)

314 c⁄° *
°r
 = 
d©a
->
£t
.°r[
˚π_köd
];

315 c⁄° *
n
;

317 if(!
	`is_fûe
(
°r
))

319  
	`°rdup
(
°r
);

322 
n
 = 
	`°ºchr
(
°r
, '/');

323 if(!
n
) {

324 
	`öfof
(
d©a
, "warning: certificate fileÇame \"%s\" handledásÇickname; "

325 "∂ó£ u£ \"./%s\"Åÿf‹˚ fûê«me\n", 
°r
, str);

326  
	`°rdup
(
°r
);

330  
NULL
;

331 
	}
}

336 
CURLcode
 
	$nss_¸óã_obje˘
(
s¶_c⁄√˘_d©a
 *
s¶
,

337 
CK_OBJECT_CLASS
 
obj_˛ass
,

338 c⁄° *
fûíame
, 
boﬁ
 
ˇ˚π
)

340 
PK11SlŸInfo
 *
¶Ÿ
;

341 
PK11GíîicObje˘
 *
obj
;

342 
CK_BBOOL
 
ckåue
 = 
CK_TRUE
;

343 
CK_BBOOL
 
ckÁl£
 = 
CK_FALSE
;

344 
CK_ATTRIBUTE
 
©ås
[ 4];

345 
©å_˙t
 = 0;

346 
CURLcode
 
îr
 = (
ˇ˚π
)

347 ? 
CURLE_SSL_CACERT_BADFILE


348 : 
CURLE_SSL_CERTPROBLEM
;

350 c⁄° 
¶Ÿ_id
 = (
ˇ˚π
) ? 0 : 1;

351 *
¶Ÿ_«me
 = 
	`≠rötf
("PEM Tokí #%d", 
¶Ÿ_id
);

352 if(!
¶Ÿ_«me
)

353  
CURLE_OUT_OF_MEMORY
;

355 
¶Ÿ
 = 
	`PK11_FödSlŸByName
(
¶Ÿ_«me
);

356 
	`‰ì
(
¶Ÿ_«me
);

357 if(!
¶Ÿ
)

358  
îr
;

360 
	`PK11_SETATTRS
(
©ås
, 
©å_˙t
, 
CKA_CLASS
, &
obj_˛ass
, (obj_class));

361 
	`PK11_SETATTRS
(
©ås
, 
©å_˙t
, 
CKA_TOKEN
, &
ckåue
, (
CK_BBOOL
));

362 
	`PK11_SETATTRS
(
©ås
, 
©å_˙t
, 
CKA_LABEL
, (*)
fûíame
,

363 
	`°æí
(
fûíame
) + 1);

365 if(
CKO_CERTIFICATE
 =
obj_˛ass
) {

366 
CK_BBOOL
 *
pvÆ
 = (
ˇ˚π
Ë? (&
ckåue
Ë: (&
ckÁl£
);

367 
	`PK11_SETATTRS
(
©ås
, 
©å_˙t
, 
CKA_TRUST
, 
pvÆ
, (*pval));

370 
obj
 = 
	`PK11_Cª©eGíîicObje˘
(
¶Ÿ
, 
©ås
, 
©å_˙t
, 
PR_FALSE
);

371 
	`PK11_FªeSlŸ
(
¶Ÿ
);

372 if(!
obj
)

373  
îr
;

375 if(!
	`Cuæ_Œi°_ö£π_√xt
(
s¶
->
obj_li°
, s¶->obj_li°->
èû
, 
obj
)) {

376 
	`PK11_De°royGíîicObje˘
(
obj
);

377  
CURLE_OUT_OF_MEMORY
;

380 if(!
ˇ˚π
 && 
CKO_CERTIFICATE
 =
obj_˛ass
)

382 
s¶
->
obj_˛i˚π
 = 
obj
;

384  
CURLE_OK
;

385 
	}
}

390 
	$nss_de°roy_obje˘
(*
u£r
, *
±r
)

392 
PK11GíîicObje˘
 *
obj
 = (PK11GíîicObje˘ *)
±r
;

393 (Ë
u£r
;

394 
	`PK11_De°royGíîicObje˘
(
obj
);

395 
	}
}

398 
	$nss_de°roy_¸l_ôem
(*
u£r
, *
±r
)

400 
SECIãm
 *
¸l_dî
 = (SECIãm *)
±r
;

401 (Ë
u£r
;

402 
	`SECITEM_FªeIãm
(
¸l_dî
, 
PR_TRUE
);

403 
	}
}

405 
CURLcode
 
	$nss_lﬂd_˚π
(
s¶_c⁄√˘_d©a
 *
s¶
,

406 c⁄° *
fûíame
, 
PRBoﬁ
 
ˇ˚π
)

408 
CURLcode
 
îr
 = (
ˇ˚π
)

409 ? 
CURLE_SSL_CACERT_BADFILE


410 : 
CURLE_SSL_CERTPROBLEM
;

414 if(
	`is_fûe
(
fûíame
))

415 
îr
 = 
	`nss_¸óã_obje˘
(
s¶
, 
CKO_CERTIFICATE
, 
fûíame
, 
ˇ˚π
);

417 if(
CURLE_OK
 =
îr
 && !
ˇ˚π
) {

419 
CERTCîtifiˇã
 *
˚π
;

420 *
nick«me
 = 
NULL
;

421 *
n
 = 
	`°ºchr
(
fûíame
, '/');

422 if(
n
)

423 
n
++;

429 
nick«me
 = 
	`≠rötf
("PEM Tokí #1:%s", 
n
);

430 if(
nick«me
) {

431 
˚π
 = 
	`PK11_FödCîtFromNick«me
(
nick«me
, 
NULL
);

432 if(
˚π
)

433 
	`CERT_De°royCîtifiˇã
(
˚π
);

435 
	`‰ì
(
nick«me
);

439  
îr
;

440 
	}
}

443 
CURLcode
 
	$nss_ˇche_¸l
(
SECIãm
 *
¸l_dî
)

445 
CERTCîtDBH™dÀ
 *
db
 = 
	`CERT_GëDeÁu…CîtDB
();

446 
CERTSig√dCæ
 *
¸l
 = 
	`SEC_FödCæByDERCît
(
db
, 
¸l_dî
, 0);

447 if(
¸l
) {

449 
	`SEC_De°royCæ
(
¸l
);

450 
	`SECITEM_FªeIãm
(
¸l_dî
, 
PR_TRUE
);

451  
CURLE_SSL_CRL_BADFILE
;

455 
	`PR_Lock
(
nss_¸Œock
);

458 if(!
	`Cuæ_Œi°_ö£π_√xt
(
nss_¸l_li°
,Çss_¸l_li°->
èû
, 
¸l_dî
)) {

459 
	`SECITEM_FªeIãm
(
¸l_dî
, 
PR_TRUE
);

460 
	`PR_U∆ock
(
nss_¸Œock
);

461  
CURLE_OUT_OF_MEMORY
;

464 if(
SECSuc˚ss
 !
	`CERT_CacheCRL
(
db
, 
¸l_dî
)) {

466 
	`PR_U∆ock
(
nss_¸Œock
);

467  
CURLE_SSL_CRL_BADFILE
;

471 
	`SSL_CÀ¨Sessi⁄Cache
();

472 
	`PR_U∆ock
(
nss_¸Œock
);

473  
CURLE_OK
;

474 
	}
}

476 
CURLcode
 
	$nss_lﬂd_¸l
(c⁄° * 
¸lfûíame
)

478 
PRFûeDesc
 *
öfûe
;

479 
PRFûeInfo
 
öfo
;

480 
SECIãm
 
fûed©a
 = { 0, 
NULL
, 0 };

481 
SECIãm
 *
¸l_dî
 = 
NULL
;

482 *
body
;

484 
öfûe
 = 
	`PR_O≥n
(
¸lfûíame
, 
PR_RDONLY
, 0);

485 if(!
öfûe
)

486  
CURLE_SSL_CRL_BADFILE
;

488 if(
PR_SUCCESS
 !
	`PR_GëO≥nFûeInfo
(
öfûe
, &
öfo
))

489 
Áû
;

491 if(!
	`SECITEM_AŒocIãm
(
NULL
, &
fûed©a
, 
öfo
.
size
 + 1))

492 
Áû
;

494 if(
öfo
.
size
 !
	`PR_Ród
(
öfûe
, 
fûed©a
.
d©a
, info.size))

495 
Áû
;

497 
¸l_dî
 = 
	`SECITEM_AŒocIãm
(
NULL
, NULL, 0U);

498 if(!
¸l_dî
)

499 
Áû
;

502 
body
 = (*)
fûed©a
.
d©a
;

503 
body
[--
fûed©a
.
Àn
] = '\0';

505 
body
 = 
	`°r°r
(body, "-----BEGIN");

506 if(
body
) {

508 *
åaûî
;

509 *
begö
 = 
	`PORT_Såchr
(
body
, '\n');

510 if(!
begö
)

511 
begö
 = 
	`PORT_Såchr
(
body
, '\r');

512 if(!
begö
)

513 
Áû
;

515 
åaûî
 = 
	`°r°r
(++
begö
, "-----END");

516 if(!
åaûî
)

517 
Áû
;

520 *
åaûî
 = '\0';

521 if(
	`ATOB_C⁄vîtAsciiToIãm
(
¸l_dî
, 
begö
))

522 
Áû
;

524 
	`SECITEM_FªeIãm
(&
fûed©a
, 
PR_FALSE
);

528 *
¸l_dî
 = 
fûed©a
;

530 
	`PR_Clo£
(
öfûe
);

531  
	`nss_ˇche_¸l
(
¸l_dî
);

533 
Áû
:

534 
	`PR_Clo£
(
öfûe
);

535 
	`SECITEM_FªeIãm
(
¸l_dî
, 
PR_TRUE
);

536 
	`SECITEM_FªeIãm
(&
fûed©a
, 
PR_FALSE
);

537  
CURLE_SSL_CRL_BADFILE
;

538 
	}
}

540 
CURLcode
 
	$nss_lﬂd_key
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

541 *
key_fûe
)

543 
PK11SlŸInfo
 *
¶Ÿ
;

544 
SECSètus
 
°©us
;

545 
CURLcode
 
rv
;

546 
s¶_c⁄√˘_d©a
 *
s¶
 = 
c⁄n
->ssl;

547 ()
socködex
;

549 
rv
 = 
	`nss_¸óã_obje˘
(
s¶
, 
CKO_PRIVATE_KEY
, 
key_fûe
, 
FALSE
);

550 if(
CURLE_OK
 !
rv
) {

551 
	`PR_SëEº‹
(
SEC_ERROR_BAD_KEY
, 0);

552  
rv
;

555 
¶Ÿ
 = 
	`PK11_FödSlŸByName
("PEM Token #1");

556 if(!
¶Ÿ
)

557  
CURLE_SSL_CERTPROBLEM
;

560 
	`SECMOD_WaôF‹AnyTokíEvít
(
mod
, 0, 0);

561 
	`PK11_IsPª£¡
(
¶Ÿ
);

563 
°©us
 = 
	`PK11_Authítiˇã
(
¶Ÿ
, 
PR_TRUE
,

564 
c⁄n
->
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
]);

565 
	`PK11_FªeSlŸ
(
¶Ÿ
);

566  (
SECSuc˚ss
 =
°©us
)

567 ? 
CURLE_OK


568 : 
CURLE_SSL_CERTPROBLEM
;

569 
	}
}

571 
	$di•œy_îr‹
(
c⁄√˘d©a
 *
c⁄n
, 
PRI¡32
 
îr
,

572 c⁄° *
fûíame
)

574 
îr
) {

575 
SEC_ERROR_BAD_PASSWORD
:

576 
	`Áûf
(
c⁄n
->
d©a
, "UnableÅoÜoad client key: IncorrectÖassword");

578 
SEC_ERROR_UNKNOWN_CERT
:

579 
	`Áûf
(
c⁄n
->
d©a
, "U«bÀÅÿlﬂd cîtifiˇã %s", 
fûíame
);

585 
	}
}

587 
CURLcode
 
	$˚π_°uff
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

588 *
˚π_fûe
, *
key_fûe
)

590 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

591 
CURLcode
 
rv
;

593 if(
˚π_fûe
) {

594 
rv
 = 
	`nss_lﬂd_˚π
(&
c⁄n
->
s¶
[
socködex
], 
˚π_fûe
, 
PR_FALSE
);

595 if(
CURLE_OK
 !
rv
) {

596 c⁄° 
PREº‹Code
 
îr
 = 
	`PR_GëEº‹
();

597 if(!
	`di•œy_îr‹
(
c⁄n
, 
îr
, 
˚π_fûe
)) {

598 c⁄° *
îr_«me
 = 
	`nss_îr‹_to_«me
(
îr
);

599 
	`Áûf
(
d©a
, "u«bÀÅÿlﬂd clõ¡ cît: %d (%s)", 
îr
, 
îr_«me
);

602  
rv
;

606 if(
key_fûe
 || (
	`is_fûe
(
˚π_fûe
))) {

607 if(
key_fûe
)

608 
rv
 = 
	`nss_lﬂd_key
(
c⁄n
, 
socködex
, 
key_fûe
);

611 
rv
 = 
	`nss_lﬂd_key
(
c⁄n
, 
socködex
, 
˚π_fûe
);

612 if(
CURLE_OK
 !
rv
) {

613 c⁄° 
PREº‹Code
 
îr
 = 
	`PR_GëEº‹
();

614 if(!
	`di•œy_îr‹
(
c⁄n
, 
îr
, 
key_fûe
)) {

615 c⁄° *
îr_«me
 = 
	`nss_îr‹_to_«me
(
îr
);

616 
	`Áûf
(
d©a
, "u«bÀÅÿlﬂd clõ¡ key: %d (%s)", 
îr
, 
îr_«me
);

619  
rv
;

623  
CURLE_OK
;

624 
	}
}

626 * 
	$nss_gë_∑ssw‹d
(
PK11SlŸInfo
 * 
¶Ÿ
, 
PRBoﬁ
 
ªåy
, *
¨g
)

628 ()
¶Ÿ
;

629 if(
ªåy
 || 
NULL
 =
¨g
)

630  
NULL
;

632  (*)
	`PORT_Sådup
((*)
¨g
);

633 
	}
}

637 
SECSètus
 
	$nss_auth_˚π_hook
(*
¨g
, 
PRFûeDesc
 *
fd
, 
PRBoﬁ
 
checksig
,

638 
PRBoﬁ
 
isSîvî
)

640 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
¨g
;

641 if(!
c⁄n
->
d©a
->
£t
.
s¶
.
vîify≥î
) {

642 
	`öfof
(
c⁄n
->
d©a
, "skipping SSLÖeer certificate verification\n");

643  
SECSuc˚ss
;

646  
	`SSL_AuthCîtifiˇã
(
	`CERT_GëDeÁu…CîtDB
(), 
fd
, 
checksig
, 
isSîvî
);

647 
	}
}

652 
	$H™dshakeCÆlback
(
PRFûeDesc
 *
sock
, *
¨g
)

654 #ifde‡
USE_NGHTTP2


655 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©a*Ë
¨g
;

656 
buÊímax
 = 50;

657 
buf
[50];

658 
buÊí
;

659 
SSLNextPrŸoSèã
 
°©e
;

661 if(!
c⁄n
->
d©a
->
£t
.
s¶_íabÀ_≈n
 && !c⁄n->d©a->£t.
s¶_íabÀ_Æ≤
) {

665 if(
	`SSL_GëNextPrŸo
(
sock
, &
°©e
, 
buf
, &
buÊí
, 
buÊímax
Ë=
SECSuc˚ss
) {

667 
°©e
) {

668 
SSL_NEXT_PROTO_NO_SUPPORT
:

669 
SSL_NEXT_PROTO_NO_OVERLAP
:

670 
	`öfof
(
c⁄n
->
d©a
, "TLS,Çeither ALPNÇor NPN succeeded\n");

672 #ifde‡
SSL_ENABLE_ALPN


673 
SSL_NEXT_PROTO_SELECTED
:

674 
	`öfof
(
c⁄n
->
d©a
, "ALPN, sîvîác˚±edÅÿu£ %.*s\n", 
buÊí
, 
buf
);

677 
SSL_NEXT_PROTO_NEGOTIATED
:

678 
	`öfof
(
c⁄n
->
d©a
, "NPN, sîvîác˚±edÅÿu£ %.*s\n", 
buÊí
, 
buf
);

682 if(
buÊí
 =
NGHTTP2_PROTO_VERSION_ID_LEN
 &&

683 
	`memcmp
(
NGHTTP2_PROTO_VERSION_ID
, 
buf
, 
NGHTTP2_PROTO_VERSION_ID_LEN
)

685 
c⁄n
->
√g≈n
 = 
NPN_HTTP2
;

687 if(
buÊí
 =
ALPN_HTTP_1_1_LENGTH
 && 
	`memcmp
(
ALPN_HTTP_1_1
, 
buf
,

688 
ALPN_HTTP_1_1_LENGTH
)) {

689 
c⁄n
->
√g≈n
 = 
NPN_HTTP1_1
;

693 ()
sock
;

694 ()
¨g
;

696 
	}
}

698 
	$di•œy_˚π_öfo
(
Sessi⁄H™dÀ
 *
d©a
,

699 
CERTCîtifiˇã
 *
˚π
)

701 *
subje˘
, *
issuî
, *
comm⁄_«me
;

702 
PREx∂odedTime
 
¥öèbÀTime
;

703 
timeSåög
[256];

704 
PRTime
 
nŸBef‹e
, 
nŸA·î
;

706 
subje˘
 = 
	`CERT_NameToAscii
(&
˚π
->subject);

707 
issuî
 = 
	`CERT_NameToAscii
(&
˚π
->issuer);

708 
comm⁄_«me
 = 
	`CERT_GëComm⁄Name
(&
˚π
->
subje˘
);

709 
	`öfof
(
d©a
, "\tsubje˘: %s\n", 
subje˘
);

711 
	`CERT_GëCîtTimes
(
˚π
, &
nŸBef‹e
, &
nŸA·î
);

712 
	`PR_Ex∂odeTime
(
nŸBef‹e
, 
PR_GMTP¨amëîs
, &
¥öèbÀTime
);

713 
	`PR_F‹m©Time
(
timeSåög
, 256, "%b %d %H:%M:%S %Y GMT", &
¥öèbÀTime
);

714 
	`öfof
(
d©a
, "\t°¨àd©e: %s\n", 
timeSåög
);

715 
	`PR_Ex∂odeTime
(
nŸA·î
, 
PR_GMTP¨amëîs
, &
¥öèbÀTime
);

716 
	`PR_F‹m©Time
(
timeSåög
, 256, "%b %d %H:%M:%S %Y GMT", &
¥öèbÀTime
);

717 
	`öfof
(
d©a
, "\ãxpúêd©e: %s\n", 
timeSåög
);

718 
	`öfof
(
d©a
, "\tcomm⁄Çame: %s\n", 
comm⁄_«me
);

719 
	`öfof
(
d©a
, "\tissuî: %s\n", 
issuî
);

721 
	`PR_Fªe
(
subje˘
);

722 
	`PR_Fªe
(
issuî
);

723 
	`PR_Fªe
(
comm⁄_«me
);

724 
	}
}

726 
	$di•œy_c⁄n_öfo
(
c⁄√˘d©a
 *
c⁄n
, 
PRFûeDesc
 *
sock
)

728 
SSLCh™√lInfo
 
ch™√l
;

729 
SSLCùhîSuôeInfo
 
suôe
;

730 
CERTCîtifiˇã
 *
˚π
;

731 
CERTCîtifiˇã
 *
˚π2
;

732 
CERTCîtifiˇã
 *
˚π3
;

733 
PRTime
 
now
;

734 
i
;

736 if(
	`SSL_GëCh™√lInfo
(
sock
, &
ch™√l
,  channel) ==

737 
SECSuc˚ss
 && 
ch™√l
.
Àngth
 ==  channel &&

738 
ch™√l
.
cùhîSuôe
) {

739 if(
	`SSL_GëCùhîSuôeInfo
(
ch™√l
.
cùhîSuôe
,

740 &
suôe
,  suôeË=
SECSuc˚ss
) {

741 
	`öfof
(
c⁄n
->
d©a
, "SSL c⁄√˘i⁄ usög %s\n", 
suôe
.
cùhîSuôeName
);

745 
˚π
 = 
	`SSL_PìrCîtifiˇã
(
sock
);

747 if(
˚π
) {

748 
	`öfof
(
c⁄n
->
d©a
, "Server certificate:\n");

750 if(!
c⁄n
->
d©a
->
£t
.
s¶
.
˚πöfo
) {

751 
	`di•œy_˚π_öfo
(
c⁄n
->
d©a
, 
˚π
);

752 
	`CERT_De°royCîtifiˇã
(
˚π
);

756 
now
 = 
	`PR_Now
();

757 
i
 = 1;

758 if(!
˚π
->
isRoŸ
) {

759 
˚π2
 = 
	`CERT_FödCîtIssuî
(
˚π
, 
now
, 
˚πUßgeSSLCA
);

760 
˚π2
) {

761 
i
++;

762 if(
˚π2
->
isRoŸ
) {

763 
	`CERT_De°royCîtifiˇã
(
˚π2
);

766 
˚π3
 = 
	`CERT_FödCîtIssuî
(
˚π2
, 
now
, 
˚πUßgeSSLCA
);

767 
	`CERT_De°royCîtifiˇã
(
˚π2
);

768 
˚π2
 = 
˚π3
;

771 
	`Cuæ_s¶_öô_˚πöfo
(
c⁄n
->
d©a
, 
i
);

772 
i
 = 0; 
˚π
; cîà
˚π2
) {

773 
	`Cuæ_exåa˘_˚πöfo
(
c⁄n
, 
i
++, (*)
˚π
->
dîCît
.
d©a
,

774 (*)
˚π
->
dîCît
.
d©a
 + cît->dîCît.
Àn
);

775 if(
˚π
->
isRoŸ
) {

776 
	`CERT_De°royCîtifiˇã
(
˚π
);

779 
˚π2
 = 
	`CERT_FödCîtIssuî
(
˚π
, 
now
, 
˚πUßgeSSLCA
);

780 
	`CERT_De°royCîtifiˇã
(
˚π
);

786 
	}
}

788 
SECSètus
 
	$BadCîtH™dÀr
(*
¨g
, 
PRFûeDesc
 *
sock
)

790 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©®*)
¨g
;

791 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

792 
PREº‹Code
 
îr
 = 
	`PR_GëEº‹
();

793 
CERTCîtifiˇã
 *
˚π
;

796 
d©a
->
£t
.
s¶
.
˚πvîifyªsu…
 = 
îr
;

798 if(
îr
 =
SSL_ERROR_BAD_CERT_DOMAIN
 && !
d©a
->
£t
.
s¶
.
vîifyho°
)

800  
SECSuc˚ss
;

803 
˚π
 = 
	`SSL_PìrCîtifiˇã
(
sock
);

804 if(
˚π
) {

805 
	`öfof
(
d©a
, "Server certificate:\n");

806 
	`di•œy_˚π_öfo
(
d©a
, 
˚π
);

807 
	`CERT_De°royCîtifiˇã
(
˚π
);

810  
SECFaûuª
;

811 
	}
}

820 
SECSètus
 
	$check_issuî_˚π
(
PRFûeDesc
 *
sock
,

821 *
issuî_nick«me
)

823 
CERTCîtifiˇã
 *
˚π
,*
˚π_issuî
,*
issuî
;

824 
SECSètus
 
ªs
=
SECSuc˚ss
;

825 *
¥Ÿo_wö
 = 
NULL
;

833 
˚π
 = 
	`SSL_PìrCîtifiˇã
(
sock
);

834 
˚π_issuî
 = 
	`CERT_FödCîtIssuî
(
˚π
,
	`PR_Now
(),
˚πUßgeObje˘Sig√r
);

836 
¥Ÿo_wö
 = 
	`SSL_RevólPöArg
(
sock
);

837 
issuî
 = 
	`PK11_FödCîtFromNick«me
(
issuî_nick«me
, 
¥Ÿo_wö
);

839 if((!
˚π_issuî
Ë|| (!
issuî
))

840 
ªs
 = 
SECFaûuª
;

841 if(
	`SECITEM_Com∑ªIãm
(&
˚π_issuî
->
dîCît
,

842 &
issuî
->
dîCît
)!=
SECEquÆ
)

843 
ªs
 = 
SECFaûuª
;

845 
	`CERT_De°royCîtifiˇã
(
˚π
);

846 
	`CERT_De°royCîtifiˇã
(
issuî
);

847 
	`CERT_De°royCîtifiˇã
(
˚π_issuî
);

848  
ªs
;

849 
	}
}

855 
SECSètus
 
	$Sñe˘Clõ¡Cît
(*
¨g
, 
PRFûeDesc
 *
sock
,

856 
CERTDi°NamesSå
 *
ˇNames
,

857 
CERTCîtifiˇãSå
 **
pRëCît
,

858 
SECKEYPriv©eKeySå
 **
pRëKey
)

860 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = (s¶_c⁄√˘_d©®*)
¨g
;

861 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄ns¶
->data;

862 c⁄° *
nick«me
 = 
c⁄ns¶
->
˛õ¡_nick«me
;

864 if(
c⁄ns¶
->
obj_˛i˚π
) {

866 c⁄° 
≥m_¶Ÿ«me
[] = "PEM Token #1";

867 
SECIãm
 
˚π_dî
 = { 0, 
NULL
, 0 };

868 *
¥Ÿo_wö
 = 
	`SSL_RevólPöArg
(
sock
);

869 
CERTCîtifiˇãSå
 *
˚π
;

870 
SECKEYPriv©eKeySå
 *
key
;

872 
PK11SlŸInfo
 *
¶Ÿ
 = 
	`PK11_FödSlŸByName
(
≥m_¶Ÿ«me
);

873 if(
NULL
 =
¶Ÿ
) {

874 
	`Áûf
(
d©a
, "NSS: PK11 slŸÇŸ found: %s", 
≥m_¶Ÿ«me
);

875  
SECFaûuª
;

878 if(
	`PK11_RódRawAâribuã
(
PK11_Ty≥Gíîic
, 
c⁄ns¶
->
obj_˛i˚π
, 
CKA_VALUE
,

879 &
˚π_dî
Ë!
SECSuc˚ss
) {

880 
	`Áûf
(
d©a
, "NSS: CKA_VALUEÇot found in PK11 generic object");

881 
	`PK11_FªeSlŸ
(
¶Ÿ
);

882  
SECFaûuª
;

885 
˚π
 = 
	`PK11_FödCîtFromDERCîtIãm
(
¶Ÿ
, &
˚π_dî
, 
¥Ÿo_wö
);

886 
	`SECITEM_FªeIãm
(&
˚π_dî
, 
PR_FALSE
);

887 if(
NULL
 =
˚π
) {

888 
	`Áûf
(
d©a
, "NSS: client certificate from fileÇot found");

889 
	`PK11_FªeSlŸ
(
¶Ÿ
);

890  
SECFaûuª
;

893 
key
 = 
	`PK11_FödPriv©eKeyFromCît
(
¶Ÿ
, 
˚π
, 
NULL
);

894 
	`PK11_FªeSlŸ
(
¶Ÿ
);

895 if(
NULL
 =
key
) {

896 
	`Áûf
(
d©a
, "NSS:Örivate key from fileÇot found");

897 
	`CERT_De°royCîtifiˇã
(
˚π
);

898  
SECFaûuª
;

901 
	`öfof
(
d©a
, "NSS: client certificate from file\n");

902 
	`di•œy_˚π_öfo
(
d©a
, 
˚π
);

904 *
pRëCît
 = 
˚π
;

905 *
pRëKey
 = 
key
;

906  
SECSuc˚ss
;

910 if(
SECSuc˚ss
 !
	`NSS_GëClõ¡AuthD©a
((*)
nick«me
, 
sock
, 
ˇNames
,

911 
pRëCît
, 
pRëKey
)

912 || 
NULL
 =*
pRëCît
) {

914 if(
NULL
 =
nick«me
)

915 
	`Áûf
(
d©a
, "NSS: client certificateÇot found (nicknameÇot "

918 
	`Áûf
(
d©a
, "NSS: clõ¡ cîtifiˇãÇŸ found: %s", 
nick«me
);

920  
SECFaûuª
;

924 
nick«me
 = (*
pRëCît
)->nickname;

925 if(
NULL
 =
nick«me
)

926 
nick«me
 = "[unknown]";

928 if(
NULL
 =*
pRëKey
) {

929 
	`Áûf
(
d©a
, "NSS:Öriv©êkeyÇŸ found f‹ cîtifiˇã: %s", 
nick«me
);

930  
SECFaûuª
;

933 
	`öfof
(
d©a
, "NSS: usög clõ¡ cîtifiˇã: %s\n", 
nick«me
);

934 
	`di•œy_˚π_öfo
(
d©a
, *
pRëCît
);

935  
SECSuc˚ss
;

936 
	}
}

943 
PRBoﬁ


944 
	$isTLSI¡ﬁî™˚Eº‹
(
PRI¡32
 
îr
)

946 
îr
) {

947 
SSL_ERROR_BAD_MAC_ALERT
:

948 
SSL_ERROR_BAD_MAC_READ
:

949 
SSL_ERROR_HANDSHAKE_FAILURE_ALERT
:

950 
SSL_ERROR_HANDSHAKE_UNEXPECTED_ALERT
:

951 
SSL_ERROR_CLIENT_KEY_EXCHANGE_FAILURE
:

952 
SSL_ERROR_ILLEGAL_PARAMETER_ALERT
:

953 
SSL_ERROR_NO_CYPHER_OVERLAP
:

954 
SSL_ERROR_BAD_SERVER
:

955 
SSL_ERROR_BAD_BLOCK_PADDING
:

956 
SSL_ERROR_UNSUPPORTED_VERSION
:

957 
SSL_ERROR_PROTOCOL_VERSION_ALERT
:

958 
SSL_ERROR_RX_MALFORMED_FINISHED
:

959 
SSL_ERROR_BAD_HANDSHAKE_HASH_VALUE
:

960 
SSL_ERROR_DECODE_ERROR_ALERT
:

961 
SSL_ERROR_RX_UNKNOWN_ALERT
:

962  
PR_TRUE
;

964  
PR_FALSE
;

966 
	}
}

969 
	$nss_upd©e_c⁄√˘ög_°©e
(
s¶_c⁄√˘_°©e
 
°©e
, *
£¸ë
)

971 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = (s¶_c⁄√˘_d©®*)
£¸ë
;

972 if(
	`PR_GëEº‹
(Ë!
PR_WOULD_BLOCK_ERROR
)

976 
c⁄ns¶
->
c⁄√˘ög_°©e
) {

977 
s¶_c⁄√˘_2
:

978 
s¶_c⁄√˘_2_ªadög
:

979 
s¶_c⁄√˘_2_wrôög
:

987 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
°©e
;

988 
	}
}

991 
PRI¡32
 
	$n•r_io_ªcv
(
PRFûeDesc
 *
fd
, *
buf
, 
PRI¡32
 
amou¡
,

992 
PRI¡n
 
Êags
, 
PRI¡îvÆTime
 
timeout
)

994 c⁄° 
PRRecvFN
 
ªcv_‚
 = 
fd
->
lowî
->
mëhods
->
ªcv
;

995 c⁄° 
PRI¡32
 
rv
 = 
	`ªcv_‚
(
fd
->
lowî
, 
buf
, 
amou¡
, 
Êags
, 
timeout
);

996 if(
rv
 < 0)

998 
	`nss_upd©e_c⁄√˘ög_°©e
(
s¶_c⁄√˘_2_ªadög
, 
fd
->
£¸ë
);

999  
rv
;

1000 
	}
}

1003 
PRI¡32
 
	$n•r_io_£nd
(
PRFûeDesc
 *
fd
, c⁄° *
buf
, 
PRI¡32
 
amou¡
,

1004 
PRI¡n
 
Êags
, 
PRI¡îvÆTime
 
timeout
)

1006 c⁄° 
PRSídFN
 
£nd_‚
 = 
fd
->
lowî
->
mëhods
->
£nd
;

1007 c⁄° 
PRI¡32
 
rv
 = 
	`£nd_‚
(
fd
->
lowî
, 
buf
, 
amou¡
, 
Êags
, 
timeout
);

1008 if(
rv
 < 0)

1010 
	`nss_upd©e_c⁄√˘ög_°©e
(
s¶_c⁄√˘_2_wrôög
, 
fd
->
£¸ë
);

1011  
rv
;

1012 
	}
}

1015 
PRSètus
 
	$n•r_io_˛o£
(
PRFûeDesc
 *
fd
)

1017 c⁄° 
PRClo£FN
 
˛o£_‚
 = 
	`PR_GëDeÁu…IOMëhods
()->
˛o£
;

1018 
fd
->
£¸ë
 = 
NULL
;

1019  
	`˛o£_‚
(
fd
);

1020 
	}
}

1022 
CURLcode
 
	$nss_öô_c‹e
(
Sessi⁄H™dÀ
 *
d©a
, c⁄° *
˚π_dú
)

1024 
NSSInôP¨amëîs
 
öô∑øms
;

1026 if(
nss_c⁄ãxt
 !
NULL
)

1027  
CURLE_OK
;

1029 
	`mem£t
((*Ë&
öô∑øms
, '\0', (initparams));

1030 
öô∑øms
.
Àngth
 = (initparams);

1032 if(
˚π_dú
) {

1033 c⁄° 
boﬁ
 
u£_sql
 = 
	`NSS_Vîsi⁄Check
("3.12.0");

1034 *
˚π∑th
 = 
	`≠rötf
("%s%s", 
u£_sql
 ? "sql:" : "", 
˚π_dú
);

1035 if(!
˚π∑th
)

1036  
CURLE_OUT_OF_MEMORY
;

1038 
	`öfof
(
d©a
, "Inôülizög NSS wôh cîç©h: %s\n", 
˚π∑th
);

1039 
nss_c⁄ãxt
 = 
	`NSS_InôC⁄ãxt
(
˚π∑th
, "", "", "", &
öô∑øms
,

1040 
NSS_INIT_READONLY
 | 
NSS_INIT_PK11RELOAD
);

1041 
	`‰ì
(
˚π∑th
);

1043 if(
nss_c⁄ãxt
 !
NULL
)

1044  
CURLE_OK
;

1046 
	`öfof
(
d©a
, "UnableÅo initialize NSS database\n");

1049 
	`öfof
(
d©a
, "Initializing NSS with certpath:Çone\n");

1050 
nss_c⁄ãxt
 = 
	`NSS_InôC⁄ãxt
("", "", "", "", &
öô∑øms
, 
NSS_INIT_READONLY


1051 | 
NSS_INIT_NOCERTDB
 | 
NSS_INIT_NOMODDB
 | 
NSS_INIT_FORCEOPEN


1052 | 
NSS_INIT_NOROOTINIT
 | 
NSS_INIT_OPTIMIZESPACE
 | 
NSS_INIT_PK11RELOAD
);

1053 if(
nss_c⁄ãxt
 !
NULL
)

1054  
CURLE_OK
;

1056 
	`öfof
(
d©a
, "UnableÅo initialize NSS\n");

1057  
CURLE_SSL_CACERT_BADFILE
;

1058 
	}
}

1060 
CURLcode
 
	$nss_öô
(
Sessi⁄H™dÀ
 *
d©a
)

1062 *
˚π_dú
;

1063 
°ru˘_°©
 
°
;

1064 
CURLcode
 
rv
;

1066 if(
öôülized
)

1067  
CURLE_OK
;

1070 
nss_¸l_li°
 = 
	`Cuæ_Œi°_Æloc
(
nss_de°roy_¸l_ôem
);

1071 if(!
nss_¸l_li°
)

1072  
CURLE_OUT_OF_MEMORY
;

1075 
˚π_dú
 = 
	`gëív
("SSL_DIR");

1076 if(
˚π_dú
) {

1077 if((
	`°©
(
˚π_dú
, &
°
) != 0) ||

1078 (!
	`S_ISDIR
(
°
.
°_mode
))) {

1079 
˚π_dú
 = 
NULL
;

1084 if(!
˚π_dú
) {

1085 if((
	`°©
(
SSL_DIR
, &
°
) == 0) &&

1086 (
	`S_ISDIR
(
°
.
°_mode
))) {

1087 
˚π_dú
 = (*)
SSL_DIR
;

1091 if(
n•r_io_idítôy
 =
PR_INVALID_IO_LAYER
) {

1093 
n•r_io_idítôy
 = 
	`PR_GëUniqueIdítôy
("libcurl");

1094 if(
n•r_io_idítôy
 =
PR_INVALID_IO_LAYER
)

1095  
CURLE_OUT_OF_MEMORY
;

1098 
	`mem˝y
(&
n•r_io_mëhods
, 
	`PR_GëDeÁu…IOMëhods
(), Çspr_io_methods);

1101 
n•r_io_mëhods
.
ªcv
 = 
n•r_io_ªcv
;

1102 
n•r_io_mëhods
.
£nd
 = 
n•r_io_£nd
;

1103 
n•r_io_mëhods
.
˛o£
 = 
n•r_io_˛o£
;

1106 
rv
 = 
	`nss_öô_c‹e
(
d©a
, 
˚π_dú
);

1107 if(
rv
)

1108  
rv
;

1110 if(
	`num_íabÀd_cùhîs
() == 0)

1111 
	`NSS_SëDome°icPﬁicy
();

1113 
öôülized
 = 1;

1114  
CURLE_OK
;

1115 
	}
}

1123 
	$Cuæ_nss_öô
()

1126 if(
nss_öôlock
 =
NULL
) {

1127 
	`PR_Inô
(
PR_USER_THREAD
, 
PR_PRIORITY_NORMAL
, 256);

1128 
nss_öôlock
 = 
	`PR_NewLock
();

1129 
nss_¸Œock
 = 
	`PR_NewLock
();

1135 
	}
}

1137 
CURLcode
 
	$Cuæ_nss_f‹˚_öô
(
Sessi⁄H™dÀ
 *
d©a
)

1139 
CURLcode
 
rv
;

1140 if(!
nss_öôlock
) {

1141 
	`Áûf
(
d©a
,

1144  
CURLE_FAILED_INIT
;

1147 
	`PR_Lock
(
nss_öôlock
);

1148 
rv
 = 
	`nss_öô
(
d©a
);

1149 
	`PR_U∆ock
(
nss_öôlock
);

1150  
rv
;

1151 
	}
}

1154 
	$Cuæ_nss_˛ónup
()

1159 
	`PR_Lock
(
nss_öôlock
);

1160 if(
öôülized
) {

1164 
	`SSL_CÀ¨Sessi⁄Cache
();

1166 if(
mod
 && 
SECSuc˚ss
 =
	`SECMOD_U∆ﬂdU£rModuÀ
(mod)) {

1167 
	`SECMOD_De°royModuÀ
(
mod
);

1168 
mod
 = 
NULL
;

1170 
	`NSS_ShutdownC⁄ãxt
(
nss_c⁄ãxt
);

1171 
nss_c⁄ãxt
 = 
NULL
;

1175 
	`Cuæ_Œi°_de°roy
(
nss_¸l_li°
, 
NULL
);

1176 
nss_¸l_li°
 = 
NULL
;

1178 
	`PR_U∆ock
(
nss_öôlock
);

1180 
	`PR_De°royLock
(
nss_öôlock
);

1181 
	`PR_De°royLock
(
nss_¸Œock
);

1182 
nss_öôlock
 = 
NULL
;

1184 
öôülized
 = 0;

1185 
	}
}

1196 
	$Cuæ_nss_check_cxn
(
c⁄√˘d©a
 *
c⁄n
)

1198 
rc
;

1199 
buf
;

1201 
rc
 =

1202 
	`PR_Recv
(
c⁄n
->
s¶
[
FIRSTSOCKET
].
h™dÀ
, (*)&
buf
, 1, 
PR_MSG_PEEK
,

1203 
	`PR_Sec⁄dsToI¡îvÆ
(1));

1204 if(
rc
 > 0)

1207 if(
rc
 == 0)

1211 
	}
}

1216 
	$Cuæ_nss_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1218 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1220 if(
c⁄ns¶
->
h™dÀ
) {

1223 
	`Áke_s˛o£
(
c⁄n
->
sock
[
socködex
]);

1224 
c⁄n
->
sock
[
socködex
] = 
CURL_SOCKET_BAD
;

1226 if((
c⁄ns¶
->
˛õ¡_nick«me
 !
NULL
Ë|| (c⁄ns¶->
obj_˛i˚π
 != NULL))

1231 
	`SSL_InvÆid©eSessi⁄
(
c⁄ns¶
->
h™dÀ
);

1233 if(
c⁄ns¶
->
˛õ¡_nick«me
 !
NULL
) {

1234 
	`‰ì
(
c⁄ns¶
->
˛õ¡_nick«me
);

1235 
c⁄ns¶
->
˛õ¡_nick«me
 = 
NULL
;

1238 
	`Cuæ_Œi°_de°roy
(
c⁄ns¶
->
obj_li°
, 
NULL
);

1239 
c⁄ns¶
->
obj_li°
 = 
NULL
;

1240 
c⁄ns¶
->
obj_˛i˚π
 = 
NULL
;

1242 
	`PR_Clo£
(
c⁄ns¶
->
h™dÀ
);

1243 
c⁄ns¶
->
h™dÀ
 = 
NULL
;

1245 
	}
}

1251 
	$Cuæ_nss_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
)

1253 ()
d©a
;

1255 
	}
}

1259 
boﬁ
 
	$is_nss_îr‹
(
CURLcode
 
îr
)

1261 
îr
) {

1262 
CURLE_PEER_FAILED_VERIFICATION
:

1263 
CURLE_SSL_CACERT
:

1264 
CURLE_SSL_CERTPROBLEM
:

1265 
CURLE_SSL_CONNECT_ERROR
:

1266 
CURLE_SSL_ISSUER_ERROR
:

1267  
åue
;

1270  
Ál£
;

1272 
	}
}

1275 
boﬁ
 
	$is_cc_îr‹
(
PRI¡32
 
îr
)

1277 
îr
) {

1278 
SSL_ERROR_BAD_CERT_ALERT
:

1279 
SSL_ERROR_EXPIRED_CERT_ALERT
:

1280 
SSL_ERROR_REVOKED_CERT_ALERT
:

1281  
åue
;

1284  
Ál£
;

1286 
	}
}

1288 
Cuæ_ªcv
 
	gnss_ªcv
;

1289 
Cuæ_£nd
 
	gnss_£nd
;

1291 
CURLcode
 
	$nss_lﬂd_ˇ_˚πifiˇãs
(
c⁄√˘d©a
 *
c⁄n
,

1292 
socködex
)

1294 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1295 c⁄° *
ˇfûe
 = 
d©a
->
£t
.
s¶
.
CAfûe
;

1296 c⁄° *
ˇ∑th
 = 
d©a
->
£t
.
s¶
.
CA∑th
;

1298 if(
ˇfûe
) {

1299 
CURLcode
 
rv
 = 
	`nss_lﬂd_˚π
(&
c⁄n
->
s¶
[
socködex
], 
ˇfûe
, 
PR_TRUE
);

1300 if(
CURLE_OK
 !
rv
)

1301  
rv
;

1304 if(
ˇ∑th
) {

1305 
°ru˘_°©
 
°
;

1306 if(
	`°©
(
ˇ∑th
, &
°
) == -1)

1307  
CURLE_SSL_CACERT_BADFILE
;

1309 if(
	`S_ISDIR
(
°
.
°_mode
)) {

1310 
PRDúE¡ry
 *
íåy
;

1311 
PRDú
 *
dú
 = 
	`PR_O≥nDú
(
ˇ∑th
);

1312 if(!
dú
)

1313  
CURLE_SSL_CACERT_BADFILE
;

1315 (
íåy
 = 
	`PR_RódDú
(
dú
, 
PR_SKIP_BOTH
 | 
PR_SKIP_HIDDEN
))) {

1316 *
fuŒ∑th
 = 
	`≠rötf
("%s/%s", 
ˇ∑th
, 
íåy
->
«me
);

1317 if(!
fuŒ∑th
) {

1318 
	`PR_Clo£Dú
(
dú
);

1319  
CURLE_OUT_OF_MEMORY
;

1322 if(
CURLE_OK
 !
	`nss_lﬂd_˚π
(&
c⁄n
->
s¶
[
socködex
], 
fuŒ∑th
, 
PR_TRUE
))

1325 
	`öfof
(
d©a
, "ÁûedÅÿlﬂd '%s' from CURLOPT_CAPATH\n", 
fuŒ∑th
);

1327 
	`‰ì
(
fuŒ∑th
);

1330 
	`PR_Clo£Dú
(
dú
);

1333 
	`öfof
(
d©a
, "w¨nög: CURLOPT_CAPATHÇŸá dúe˘‹y (%s)\n", 
ˇ∑th
);

1336 
	`öfof
(
d©a
, " CAfile: %s\n CApath: %s\n",

1337 
ˇfûe
 ? cafile : "none",

1338 
ˇ∑th
 ? capath : "none");

1340  
CURLE_OK
;

1341 
	}
}

1343 
CURLcode
 
	$nss_öô_s¶vî
(
SSLVîsi⁄R™ge
 *
s¶vî
,

1344 
Sessi⁄H™dÀ
 *
d©a
)

1346 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

1348 
CURL_SSLVERSION_DEFAULT
:

1349 
s¶vî
->
mö
 = 
SSL_LIBRARY_VERSION_3_0
;

1350 if(
d©a
->
°©e
.
s¶_c⁄√˘_ªåy
) {

1351 
	`öfof
(
d©a
, "TLS disabled dueÅoÖrevious handshake failure\n");

1352 
s¶vî
->
max
 = 
SSL_LIBRARY_VERSION_3_0
;

1353  
CURLE_OK
;

1357 
CURL_SSLVERSION_TLSv1
:

1358 #ifde‡
SSL_LIBRARY_VERSION_TLS_1_2


1359 
s¶vî
->
max
 = 
SSL_LIBRARY_VERSION_TLS_1_2
;

1360 #ñi‡
deföed
 
SSL_LIBRARY_VERSION_TLS_1_1


1361 
s¶vî
->
max
 = 
SSL_LIBRARY_VERSION_TLS_1_1
;

1363 
s¶vî
->
max
 = 
SSL_LIBRARY_VERSION_TLS_1_0
;

1365  
CURLE_OK
;

1367 
CURL_SSLVERSION_SSLv2
:

1368 
s¶vî
->
mö
 = 
SSL_LIBRARY_VERSION_2
;

1369 
s¶vî
->
max
 = 
SSL_LIBRARY_VERSION_2
;

1370  
CURLE_OK
;

1372 
CURL_SSLVERSION_SSLv3
:

1373 
s¶vî
->
mö
 = 
SSL_LIBRARY_VERSION_3_0
;

1374 
s¶vî
->
max
 = 
SSL_LIBRARY_VERSION_3_0
;

1375  
CURLE_OK
;

1377 
CURL_SSLVERSION_TLSv1_0
:

1378 
s¶vî
->
mö
 = 
SSL_LIBRARY_VERSION_TLS_1_0
;

1379 
s¶vî
->
max
 = 
SSL_LIBRARY_VERSION_TLS_1_0
;

1380  
CURLE_OK
;

1382 
CURL_SSLVERSION_TLSv1_1
:

1383 #ifde‡
SSL_LIBRARY_VERSION_TLS_1_1


1384 
s¶vî
->
mö
 = 
SSL_LIBRARY_VERSION_TLS_1_1
;

1385 
s¶vî
->
max
 = 
SSL_LIBRARY_VERSION_TLS_1_1
;

1386  
CURLE_OK
;

1390 
CURL_SSLVERSION_TLSv1_2
:

1391 #ifde‡
SSL_LIBRARY_VERSION_TLS_1_2


1392 
s¶vî
->
mö
 = 
SSL_LIBRARY_VERSION_TLS_1_2
;

1393 
s¶vî
->
max
 = 
SSL_LIBRARY_VERSION_TLS_1_2
;

1394  
CURLE_OK
;

1399 
	`Áûf
(
d©a
, "TLS minor version cannot be set");

1400  
CURLE_SSL_CONNECT_ERROR
;

1401 
	}
}

1403 
CURLcode
 
	$nss_Áû_c⁄√˘
(
s¶_c⁄√˘_d©a
 *
c⁄ns¶
,

1404 
Sessi⁄H™dÀ
 *
d©a
,

1405 
CURLcode
 
cuæîr
)

1407 
SSLVîsi⁄R™ge
 
s¶vî
;

1408 
PREº‹Code
 
îr
 = 0;

1411 
d©a
->
°©e
.
s¶_c⁄√˘_ªåy
 = 
FALSE
;

1413 if(
	`is_nss_îr‹
(
cuæîr
)) {

1415 
îr
 = 
	`PR_GëEº‹
();

1416 if(
	`is_cc_îr‹
(
îr
))

1417 
cuæîr
 = 
CURLE_SSL_CERTPROBLEM
;

1420 
	`öfof
(
d©a
, "NSSÉº‹ %d (%s)\n", 
îr
, 
	`nss_îr‹_to_«me
(err));

1423 
	`nss_¥öt_îr‹_mesßge
(
d©a
, 
îr
);

1427 
	`Cuæ_Œi°_de°roy
(
c⁄ns¶
->
obj_li°
, 
NULL
);

1428 
c⁄ns¶
->
obj_li°
 = 
NULL
;

1430 if(
c⁄ns¶
->
h™dÀ


1431 && (
	`SSL_Vîsi⁄R™geGë
(
c⁄ns¶
->
h™dÀ
, &
s¶vî
Ë=
SECSuc˚ss
)

1432 && (
s¶vî
.
mö
 =
SSL_LIBRARY_VERSION_3_0
)

1433 && (
s¶vî
.
max
 !
SSL_LIBRARY_VERSION_3_0
)

1434 && 
	`isTLSI¡ﬁî™˚Eº‹
(
îr
)) {

1436 
d©a
->
°©e
.
s¶_c⁄√˘_ªåy
 = 
TRUE
;

1437 
	`öfof
(
d©a
, "Error in TLS handshake,Årying SSLv3...\n");

1438  
CURLE_OK
;

1441  
cuæîr
;

1442 
	}
}

1445 
CURLcode
 
	$nss_£t_n⁄block
(
s¶_c⁄√˘_d©a
 *
c⁄ns¶
,

1446 
Sessi⁄H™dÀ
 *
d©a
)

1448 
PRSockëO±i⁄D©a
 
sock_›t
;

1449 
sock_›t
.
›ti⁄
 = 
PR_SockO±_N⁄blockög
;

1450 
sock_›t
.
vÆue
.
n⁄_blockög
 = 
PR_TRUE
;

1452 if(
	`PR_SëSockëO±i⁄
(
c⁄ns¶
->
h™dÀ
, &
sock_›t
Ë!
PR_SUCCESS
)

1453  
	`nss_Áû_c⁄√˘
(
c⁄ns¶
, 
d©a
, 
CURLE_SSL_CONNECT_ERROR
);

1455  
CURLE_OK
;

1456 
	}
}

1458 
CURLcode
 
	$nss_£tup_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1460 
PRFûeDesc
 *
modñ
 = 
NULL
;

1461 
PRFûeDesc
 *
n•r_io
 = 
NULL
;

1462 
PRFûeDesc
 *
n•r_io_°ub
 = 
NULL
;

1463 
PRBoﬁ
 
s¶_no_ˇche
;

1464 
PRBoﬁ
 
s¶_cbc_øndom_iv
;

1465 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1466 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
socködex
];

1467 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1468 
CURLcode
 
cuæîr
;

1470 
SSLVîsi⁄R™ge
 
s¶vî
 = {

1471 
SSL_LIBRARY_VERSION_TLS_1_0
,

1472 
SSL_LIBRARY_VERSION_TLS_1_0


1475 #ifde‡
USE_NGHTTP2


1476 #i‡
	`deföed
(
SSL_ENABLE_NPN
Ë|| deföed(
SSL_ENABLE_ALPN
)

1477 
Æ≤_¥Ÿos_Àn
 = 
NGHTTP2_PROTO_VERSION_ID_LEN
 +

1478 
ALPN_HTTP_1_1_LENGTH
 + 2;

1479 
Æ≤_¥Ÿos
[
NGHTTP2_PROTO_VERSION_ID_LEN
 + 
ALPN_HTTP_1_1_LENGTH


1481 
cur
 = 0;

1486 if(
c⁄ns¶
->
°©e
 =
s¶_c⁄√˘i⁄_com∂ëe
)

1487  
CURLE_OK
;

1489 
c⁄ns¶
->
d©a
 = data;

1492 
c⁄ns¶
->
obj_li°
 = 
	`Cuæ_Œi°_Æloc
(
nss_de°roy_obje˘
);

1493 if(!
c⁄ns¶
->
obj_li°
)

1494  
CURLE_OUT_OF_MEMORY
;

1497 
	`PR_Lock
(
nss_öôlock
);

1498 
cuæîr
 = 
	`nss_öô
(
c⁄n
->
d©a
);

1499 if(
CURLE_OK
 !
cuæîr
) {

1500 
	`PR_U∆ock
(
nss_öôlock
);

1501 
îr‹
;

1504 
cuæîr
 = 
CURLE_SSL_CONNECT_ERROR
;

1506 if(!
mod
) {

1507 *
c⁄fig°rög
 = 
	`≠rötf
("libøry=%†«me=PEM", 
≥m_libøry
);

1508 if(!
c⁄fig°rög
) {

1509 
	`PR_U∆ock
(
nss_öôlock
);

1510 
îr‹
;

1512 
mod
 = 
	`SECMOD_LﬂdU£rModuÀ
(
c⁄fig°rög
, 
NULL
, 
PR_FALSE
);

1513 
	`‰ì
(
c⁄fig°rög
);

1515 if(!
mod
 || !mod->
lﬂded
) {

1516 if(
mod
) {

1517 
	`SECMOD_De°royModuÀ
(
mod
);

1518 
mod
 = 
NULL
;

1520 
	`öfof
(
d©a
, "WARNING: failedÅoÜoad NSS PEMÜibrary %s. Using "

1521 "O≥nSSL PEM cîtifiˇã†wû»nŸ w‹k.\n", 
≥m_libøry
);

1525 
	`PK11_SëPassw‹dFunc
(
nss_gë_∑ssw‹d
);

1526 
	`PR_U∆ock
(
nss_öôlock
);

1528 
modñ
 = 
	`PR_NewTCPSockë
();

1529 if(!
modñ
)

1530 
îr‹
;

1531 
modñ
 = 
	`SSL_Imp‹tFD
(
NULL
, model);

1533 if(
	`SSL_O±i⁄Së
(
modñ
, 
SSL_SECURITY
, 
PR_TRUE
Ë!
SECSuc˚ss
)

1534 
îr‹
;

1535 if(
	`SSL_O±i⁄Së
(
modñ
, 
SSL_HANDSHAKE_AS_SERVER
, 
PR_FALSE
Ë!
SECSuc˚ss
)

1536 
îr‹
;

1537 if(
	`SSL_O±i⁄Së
(
modñ
, 
SSL_HANDSHAKE_AS_CLIENT
, 
PR_TRUE
Ë!
SECSuc˚ss
)

1538 
îr‹
;

1541 
s¶_no_ˇche
 = (
c⁄n
->
s¶_c⁄fig
.
£ssi⁄id
 && 
d©a
->
£t
.
s¶
.
vîify≥î
) ?

1542 
PR_FALSE
 : 
PR_TRUE
;

1543 if(
	`SSL_O±i⁄Së
(
modñ
, 
SSL_NO_CACHE
, 
s¶_no_ˇche
Ë!
SECSuc˚ss
)

1544 
îr‹
;

1547 if(
	`nss_öô_s¶vî
(&
s¶vî
, 
d©a
Ë!
CURLE_OK
)

1548 
îr‹
;

1549 if(
	`SSL_Vîsi⁄R™geSë
(
modñ
, &
s¶vî
Ë!
SECSuc˚ss
)

1550 
îr‹
;

1552 
s¶_cbc_øndom_iv
 = !
d©a
->
£t
.
s¶_íabÀ_bó°
;

1553 #ifde‡
SSL_CBC_RANDOM_IV


1556 if(
	`SSL_O±i⁄Së
(
modñ
, 
SSL_CBC_RANDOM_IV
, 
s¶_cbc_øndom_iv
Ë!
SECSuc˚ss
)

1557 
	`öfof
(
d©a
, "warning: failedÅo set SSL_CBC_RANDOM_IV = %d\n",

1558 
s¶_cbc_øndom_iv
);

1560 if(
s¶_cbc_øndom_iv
)

1561 
	`öfof
(
d©a
, "warning: support for SSL_CBC_RANDOM_IVÇot compiled in\n");

1565 
d©a
->
°©e
.
s¶_c⁄√˘_ªåy
 = 
FALSE
;

1567 if(
d©a
->
£t
.
s¶
.
cùhî_li°
) {

1568 if(
	`£t_cùhîs
(
d©a
, 
modñ
, d©a->
£t
.
s¶
.
cùhî_li°
Ë!
SECSuc˚ss
) {

1569 
cuæîr
 = 
CURLE_SSL_CIPHER
;

1570 
îr‹
;

1574 if(!
d©a
->
£t
.
s¶
.
vîify≥î
 && d©a->£t.s¶.
vîifyho°
)

1575 
	`öfof
(
d©a
, "warning: ignoring value of ssl.verifyhost\n");

1579 if(
	`SSL_AuthCîtifiˇãHook
(
modñ
, 
nss_auth_˚π_hook
, 
c⁄n
Ë!
SECSuc˚ss
)

1580 
îr‹
;

1582 
d©a
->
£t
.
s¶
.
˚πvîifyªsu…
=0;

1583 if(
	`SSL_BadCîtHook
(
modñ
, 
BadCîtH™dÀr
, 
c⁄n
Ë!
SECSuc˚ss
)

1584 
îr‹
;

1586 if(
	`SSL_H™dshakeCÆlback
(
modñ
, 
H™dshakeCÆlback
, 
c⁄n
Ë!
SECSuc˚ss
)

1587 
îr‹
;

1589 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

1590 c⁄° 
CURLcode
 
rv
 = 
	`nss_lﬂd_ˇ_˚πifiˇãs
(
c⁄n
, 
socködex
);

1591 if(
CURLE_OK
 !
rv
) {

1592 
cuæîr
 = 
rv
;

1593 
îr‹
;

1597 if(
d©a
->
£t
.
s¶
.
CRLfûe
) {

1598 c⁄° 
CURLcode
 
rv
 = 
	`nss_lﬂd_¸l
(
d©a
->
£t
.
s¶
.
CRLfûe
);

1599 if(
CURLE_OK
 !
rv
) {

1600 
cuæîr
 = 
rv
;

1601 
îr‹
;

1603 
	`öfof
(
d©a
, " CRLfûe: %s\n", d©a->
£t
.
s¶
.
CRLfûe
);

1606 if(
d©a
->
£t
.
°r
[
STRING_CERT
]) {

1607 *
nick«me
 = 
	`dup_nick«me
(
d©a
, 
STRING_CERT
);

1608 if(
nick«me
) {

1610 
c⁄ns¶
->
obj_˛i˚π
 = 
NULL
;

1613 
CURLcode
 
rv
 = 
	`˚π_°uff
(
c⁄n
, 
socködex
, 
d©a
->
£t
.
°r
[
STRING_CERT
],

1614 
d©a
->
£t
.
°r
[
STRING_KEY
]);

1615 if(
CURLE_OK
 !
rv
) {

1617 
cuæîr
 = 
rv
;

1618 
îr‹
;

1623 
c⁄ns¶
->
˛õ¡_nick«me
 = 
nick«me
;

1626 
c⁄ns¶
->
˛õ¡_nick«me
 = 
NULL
;

1628 if(
	`SSL_GëClõ¡AuthD©aHook
(
modñ
, 
Sñe˘Clõ¡Cît
,

1629 (*)
c⁄ns¶
Ë!
SECSuc˚ss
) {

1630 
cuæîr
 = 
CURLE_SSL_CERTPROBLEM
;

1631 
îr‹
;

1635 
n•r_io
 = 
	`PR_Imp‹tTCPSockë
(
sockfd
);

1636 if(!
n•r_io
)

1637 
îr‹
;

1640 
n•r_io_°ub
 = 
	`PR_Cª©eIOLayîStub
(
n•r_io_idítôy
, &
n•r_io_mëhods
);

1641 if(!
n•r_io_°ub
) {

1642 
	`PR_Clo£
(
n•r_io
);

1643 
îr‹
;

1647 
n•r_io_°ub
->
£¸ë
 = (*)
c⁄ns¶
;

1650 if(
	`PR_PushIOLayî
(
n•r_io
, 
PR_TOP_IO_LAYER
, 
n•r_io_°ub
Ë!
PR_SUCCESS
) {

1651 
	`PR_Clo£
(
n•r_io
);

1652 
	`PR_Clo£
(
n•r_io_°ub
);

1653 
îr‹
;

1657 
c⁄ns¶
->
h™dÀ
 = 
	`SSL_Imp‹tFD
(
modñ
, 
n•r_io
);

1658 if(!
c⁄ns¶
->
h™dÀ
) {

1659 
	`PR_Clo£
(
n•r_io
);

1660 
îr‹
;

1663 
	`PR_Clo£
(
modñ
);

1664 
modñ
 = 
NULL
;

1667 if(
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
]) {

1668 
	`SSL_SëPKCS11PöArg
(
c⁄ns¶
->
h™dÀ
, 
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
]);

1671 #ifde‡
USE_NGHTTP2


1672 if(
d©a
->
£t
.
hâpvîsi⁄
 =
CURL_HTTP_VERSION_2_0
) {

1673 #ifde‡
SSL_ENABLE_NPN


1674 if(
d©a
->
£t
.
s¶_íabÀ_≈n
) {

1675 if(
	`SSL_O±i⁄Së
(
c⁄ns¶
->
h™dÀ
, 
SSL_ENABLE_NPN
, 
PR_TRUE
Ë!
SECSuc˚ss
)

1676 
îr‹
;

1680 #ifde‡
SSL_ENABLE_ALPN


1681 if(
d©a
->
£t
.
s¶_íabÀ_Æ≤
) {

1682 if(
	`SSL_O±i⁄Së
(
c⁄ns¶
->
h™dÀ
, 
SSL_ENABLE_ALPN
, 
PR_TRUE
)

1683 !
SECSuc˚ss
)

1684 
îr‹
;

1688 #i‡
	`deföed
(
SSL_ENABLE_NPN
Ë|| deföed(
SSL_ENABLE_ALPN
)

1689 if(
d©a
->
£t
.
s¶_íabÀ_≈n
 || d©a->£t.
s¶_íabÀ_Æ≤
) {

1690 
Æ≤_¥Ÿos
[
cur
] = 
NGHTTP2_PROTO_VERSION_ID_LEN
;

1691 
cur
++;

1692 
	`mem˝y
(&
Æ≤_¥Ÿos
[
cur
], 
NGHTTP2_PROTO_VERSION_ID
,

1693 
NGHTTP2_PROTO_VERSION_ID_LEN
);

1694 
cur
 +
NGHTTP2_PROTO_VERSION_ID_LEN
;

1695 
Æ≤_¥Ÿos
[
cur
] = 
ALPN_HTTP_1_1_LENGTH
;

1696 
cur
++;

1697 
	`mem˝y
(&
Æ≤_¥Ÿos
[
cur
], 
ALPN_HTTP_1_1
, 
ALPN_HTTP_1_1_LENGTH
);

1699 if(
	`SSL_SëNextPrŸoNego
(
c⁄ns¶
->
h™dÀ
, 
Æ≤_¥Ÿos
, 
Æ≤_¥Ÿos_Àn
)

1700 !
SECSuc˚ss
)

1701 
îr‹
;

1704 
	`öfof
(
d©a
, "SSL, can'tÇegotiate HTTP/2.0 withÇeither NPNÇor ALPN\n");

1712 
	`SSL_Re£tH™dshake
(
c⁄ns¶
->
h™dÀ
, 
PR_FALSE
);

1714 
	`SSL_SëURL
(
c⁄ns¶
->
h™dÀ
, 
c⁄n
->
ho°
.
«me
);

1716  
CURLE_OK
;

1718 
îr‹
:

1719 if(
modñ
)

1720 
	`PR_Clo£
(
modñ
);

1722  
	`nss_Áû_c⁄√˘
(
c⁄ns¶
, 
d©a
, 
cuæîr
);

1723 
	}
}

1725 
CURLcode
 
	$nss_do_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1727 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1728 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1729 
CURLcode
 
cuæîr
 = 
CURLE_SSL_CONNECT_ERROR
;

1730 
PRUöt32
 
timeout
;

1733 c⁄° 
time_À·
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

1734 if(
time_À·
 < 0L) {

1735 
	`Áûf
(
d©a
, "timed out before SSL handshake");

1736 
cuæîr
 = 
CURLE_OPERATION_TIMEDOUT
;

1737 
îr‹
;

1741 
timeout
 = 
	`PR_Mûli£c⁄dsToI¡îvÆ
((
PRUöt32
Ë
time_À·
);

1742 if(
	`SSL_F‹˚H™dshakeWôhTimeout
(
c⁄ns¶
->
h™dÀ
, 
timeout
Ë!
SECSuc˚ss
) {

1743 if(
	`PR_GëEº‹
(Ë=
PR_WOULD_BLOCK_ERROR
)

1745  
CURLE_AGAIN
;

1746 if(
c⁄n
->
d©a
->
£t
.
s¶
.
˚πvîifyªsu…
 =
SSL_ERROR_BAD_CERT_DOMAIN
)

1747 
cuæîr
 = 
CURLE_PEER_FAILED_VERIFICATION
;

1748 if(
c⁄n
->
d©a
->
£t
.
s¶
.
˚πvîifyªsu…
!=0)

1749 
cuæîr
 = 
CURLE_SSL_CACERT
;

1750 
îr‹
;

1753 
c⁄ns¶
->
°©e
 = 
s¶_c⁄√˘i⁄_com∂ëe
;

1754 
c⁄n
->
ªcv
[
socködex
] = 
nss_ªcv
;

1755 
c⁄n
->
£nd
[
socködex
] = 
nss_£nd
;

1757 
	`di•œy_c⁄n_öfo
(
c⁄n
, 
c⁄ns¶
->
h™dÀ
);

1759 if(
d©a
->
£t
.
°r
[
STRING_SSL_ISSUERCERT
]) {

1760 
SECSètus
 
ªt
 = 
SECFaûuª
;

1761 *
nick«me
 = 
	`dup_nick«me
(
d©a
, 
STRING_SSL_ISSUERCERT
);

1762 if(
nick«me
) {

1764 
ªt
 = 
	`check_issuî_˚π
(
c⁄ns¶
->
h™dÀ
, 
nick«me
);

1765 
	`‰ì
(
nick«me
);

1768 if(
SECFaûuª
 =
ªt
) {

1769 
	`öfof
(
d©a
,"SSL certificate issuer check failed\n");

1770 
cuæîr
 = 
CURLE_SSL_ISSUER_ERROR
;

1771 
îr‹
;

1774 
	`öfof
(
d©a
, "SSL certificate issuer check ok\n");

1778  
CURLE_OK
;

1780 
îr‹
:

1781  
	`nss_Áû_c⁄√˘
(
c⁄ns¶
, 
d©a
, 
cuæîr
);

1782 
	}
}

1784 
CURLcode
 
	$nss_c⁄√˘_comm⁄
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

1785 
boﬁ
 *
d⁄e
)

1787 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1788 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1789 c⁄° 
boﬁ
 
blockög
 = (
d⁄e
 =
NULL
);

1790 
CURLcode
 
rv
;

1792 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_1
) {

1793 
rv
 = 
	`nss_£tup_c⁄√˘
(
c⁄n
, 
socködex
);

1794 if(
rv
)

1796  
rv
;

1798 if(!
blockög
) {

1800 
rv
 = 
	`nss_£t_n⁄block
(
c⁄ns¶
, 
d©a
);

1801 if(
rv
)

1802  
rv
;

1805 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2
;

1808 
rv
 = 
	`nss_do_c⁄√˘
(
c⁄n
, 
socködex
);

1809 
rv
) {

1810 
CURLE_OK
:

1812 
CURLE_AGAIN
:

1813 if(!
blockög
)

1815  
CURLE_OK
;

1818  
rv
;

1821 if(
blockög
) {

1823 
rv
 = 
	`nss_£t_n⁄block
(
c⁄ns¶
, 
d©a
);

1824 if(
rv
)

1825  
rv
;

1829 *
d⁄e
 = 
TRUE
;

1831 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_d⁄e
;

1832  
CURLE_OK
;

1833 
	}
}

1835 
CURLcode
 
	$Cuæ_nss_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1837  
	`nss_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
NULL
);

1838 
	}
}

1840 
CURLcode
 
	$Cuæ_nss_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

1841 
socködex
, 
boﬁ
 *
d⁄e
)

1843  
	`nss_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
d⁄e
);

1844 
	}
}

1846 
ssize_t
 
	$nss_£nd
(
c⁄√˘d©a
 *
c⁄n
,

1847 
socködex
,

1848 c⁄° *
mem
,

1849 
size_t
 
Àn
,

1850 
CURLcode
 *
cuæcode
)

1852 
ssize_t
 
rc
 = 
	`PR_Síd
(
c⁄n
->
s¶
[
socködex
].
h™dÀ
, 
mem
, ()
Àn
, 0,

1853 
PR_INTERVAL_NO_WAIT
);

1854 if(
rc
 < 0) {

1855 
PRI¡32
 
îr
 = 
	`PR_GëEº‹
();

1856 if(
îr
 =
PR_WOULD_BLOCK_ERROR
)

1857 *
cuæcode
 = 
CURLE_AGAIN
;

1860 c⁄° *
îr_«me
 = 
	`nss_îr‹_to_«me
(
îr
);

1861 
	`öfof
(
c⁄n
->
d©a
, "SSL wrôe:Éº‹ %d (%s)\n", 
îr
, 
îr_«me
);

1864 
	`nss_¥öt_îr‹_mesßge
(
c⁄n
->
d©a
, 
îr
);

1866 *
cuæcode
 = (
	`is_cc_îr‹
(
îr
))

1867 ? 
CURLE_SSL_CERTPROBLEM


1868 : 
CURLE_SEND_ERROR
;

1872  
rc
;

1873 
	}
}

1875 
ssize_t
 
	$nss_ªcv
(
c⁄√˘d©a
 * 
c⁄n
,

1876 
num
,

1877 *
buf
,

1878 
size_t
 
buf„rsize
,

1879 
CURLcode
 *
cuæcode
)

1881 
ssize_t
 
ƒód
 = 
	`PR_Recv
(
c⁄n
->
s¶
[
num
].
h™dÀ
, 
buf
, ()
buf„rsize
, 0,

1882 
PR_INTERVAL_NO_WAIT
);

1883 if(
ƒód
 < 0) {

1885 
PRI¡32
 
îr
 = 
	`PR_GëEº‹
();

1887 if(
îr
 =
PR_WOULD_BLOCK_ERROR
)

1888 *
cuæcode
 = 
CURLE_AGAIN
;

1891 c⁄° *
îr_«me
 = 
	`nss_îr‹_to_«me
(
îr
);

1892 
	`öfof
(
c⁄n
->
d©a
, "SSLÑód:Éºnÿ%d (%s)\n", 
îr
, 
îr_«me
);

1895 
	`nss_¥öt_îr‹_mesßge
(
c⁄n
->
d©a
, 
îr
);

1897 *
cuæcode
 = (
	`is_cc_îr‹
(
îr
))

1898 ? 
CURLE_SSL_CERTPROBLEM


1899 : 
CURLE_RECV_ERROR
;

1903  
ƒód
;

1904 
	}
}

1906 
size_t
 
	$Cuæ_nss_vîsi⁄
(*
buf„r
, 
size_t
 
size
)

1908  
	`¢¥ötf
(
buf„r
, 
size
, "NSS/%s", 
NSS_VERSION
);

1909 
	}
}

1911 
	$Cuæ_nss_£ed
(
Sessi⁄H™dÀ
 *
d©a
)

1914  !!
	`Cuæ_nss_f‹˚_öô
(
d©a
);

1915 
	}
}

1917 
	$Cuæ_nss_øndom
(
Sessi⁄H™dÀ
 *
d©a
,

1918 *
íå›y
,

1919 
size_t
 
Àngth
)

1921 
	`Cuæ_nss_£ed
(
d©a
);

1922 if(
SECSuc˚ss
 !
	`PK11_Gíî©eR™dom
(
íå›y
, 
	`cuæx_uztosi
(
Àngth
))) {

1924 
	`Áûf
(
d©a
, "PK11_GenerateRandom() failed, callingábort()...");

1925 
	`ab‹t
();

1927 
	}
}

1929 
	$Cuæ_nss_md5sum
(*
tmp
,

1930 
size_t
 
tm∂í
,

1931 *
md5sum
,

1932 
size_t
 
md5Àn
)

1934 
PK11C⁄ãxt
 *
MD5pw
 = 
	`PK11_Cª©eDige°C⁄ãxt
(
SEC_OID_MD5
);

1935 
MD5out
;

1936 
	`PK11_Dige°Op
(
MD5pw
, 
tmp
, 
	`cuæx_uztoui
(
tm∂í
));

1937 
	`PK11_Dige°FöÆ
(
MD5pw
, 
md5sum
, &
MD5out
, 
	`cuæx_uztoui
(
md5Àn
));

1938 
	`PK11_De°royC⁄ãxt
(
MD5pw
, 
PR_TRUE
);

1939 
	}
}

	@lib/vtls/nssg.h

1 #i‚de‡
HEADER_CURL_NSSG_H


2 
	#HEADER_CURL_NSSG_H


	)

24 
	~"cuæ_£tup.h
"

26 #ifde‡
USE_NSS


31 
	~"uæd©a.h
"

33 
CURLcode
 
Cuæ_nss_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

34 
CURLcode
 
Cuæ_nss_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

35 
socködex
,

36 
boﬁ
 *
d⁄e
);

38 
Cuæ_nss_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

42 
Cuæ_nss_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
);

44 
Cuæ_nss_öô
();

45 
Cuæ_nss_˛ónup
();

47 
size_t
 
Cuæ_nss_vîsi⁄
(*
buf„r
, size_à
size
);

48 
Cuæ_nss_check_cxn
(
c⁄√˘d©a
 *
cxn
);

49 
Cuæ_nss_£ed
(
Sessi⁄H™dÀ
 *
d©a
);

52 
CURLcode
 
Cuæ_nss_f‹˚_öô
(
Sessi⁄H™dÀ
 *
d©a
);

54 
Cuæ_nss_øndom
(
Sessi⁄H™dÀ
 *
d©a
,

55 *
íå›y
,

56 
size_t
 
Àngth
);

58 
Cuæ_nss_md5sum
(*
tmp
,

59 
size_t
 
tm∂í
,

60 *
md5sum
,

61 
size_t
 
md5Àn
);

64 
	#have_cuæs¶_øndom
 1

	)

65 
	#have_cuæs¶_md5sum
 1

	)

68 
	#cuæs¶_öô
 
Cuæ_nss_öô


	)

69 
	#cuæs¶_˛ónup
 
Cuæ_nss_˛ónup


	)

70 
	#cuæs¶_c⁄√˘
 
Cuæ_nss_c⁄√˘


	)

71 
	#cuæs¶_c⁄√˘_n⁄blockög
 
Cuæ_nss_c⁄√˘_n⁄blockög


	)

74 
	#cuæs¶_£ssi⁄_‰ì
(
x
Ë
Cuæ_n›_°mt


	)

75 
	#cuæs¶_˛o£_Æl
 
Cuæ_nss_˛o£_Æl


	)

76 
	#cuæs¶_˛o£
 
Cuæ_nss_˛o£


	)

78 
	#cuæs¶_shutdown
(
x
,
y
Ë(x=x, y=y, 1)

	)

79 
	#cuæs¶_£t_ígöe
(
x
,
y
Ë(x=x, y=y, 
CURLE_NOT_BUILT_IN
)

	)

80 
	#cuæs¶_£t_ígöe_deÁu…
(
x
Ë(x=x, 
CURLE_NOT_BUILT_IN
)

	)

81 
	#cuæs¶_ígöes_li°
(
x
Ë(x=x, (
cuæ_¶i°
 *)
NULL
)

	)

82 
	#cuæs¶_vîsi⁄
 
Cuæ_nss_vîsi⁄


	)

83 
	#cuæs¶_check_cxn
(
x
Ë
	`Cuæ_nss_check_cxn
(x)

	)

84 
	#cuæs¶_d©a_≥ndög
(
x
,
y
Ë(x=x, y=y, 0)

	)

85 
	#cuæs¶_øndom
(
x
,
y
,
z
Ë
	`Cuæ_nss_øndom
(x,y,z)

	)

86 
	#cuæs¶_md5sum
(
a
,
b
,
c
,
d
Ë
	`Cuæ_nss_md5sum
◊,b,c,d)

	)

	@lib/vtls/openssl.c

33 
	~"cuæ_£tup.h
"

35 #ifde‡
HAVE_LIMITS_H


36 
	~<limôs.h
>

39 
	~"uæd©a.h
"

40 
	~"£ndf.h
"

41 
	~"f‹md©a.h
"

42 
	~"uæ.h
"

43 
	~"öë_±⁄.h
"

44 
	~"›ís¶.h
"

45 
	~"c⁄√˘.h
"

46 
	~"¶i°.h
"

47 
	~"°ªquÆ.h
"

48 
	~"£À˘.h
"

49 
	~"vés.h
"

50 
	~"øw°r.h
"

51 
	~"ho°check.h
"

53 
	#_MPRINTF_REPLACE


	)

54 
	~<cuæ/m¥ötf.h
>

56 #ifde‡
USE_SSLEAY


58 #ifde‡
USE_OPENSSL


59 
	~<›ís¶/ønd.h
>

60 
	~<›ís¶/x509v3.h
>

61 
	~<›ís¶/dß.h
>

62 
	~<›ís¶/dh.h
>

63 
	~<›ís¶/îr.h
>

64 
	~<›ís¶/md5.h
>

65 
	~<›ís¶/c⁄f.h
>

67 
	~<ønd.h
>

68 
	~<x509v3.h
>

69 
	~<md5.h
>

72 
	~"w¨∆ess.h
"

73 
	~"cuæ_mem‹y.h
"

74 
	~"n⁄-ascii.h
"

77 
	~"memdebug.h
"

79 #i‚de‡
OPENSSL_VERSION_NUMBER


83 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x0090581fL

84 
	#HAVE_SSL_GET1_SESSION
 1

	)

86 #unde‡
HAVE_SSL_GET1_SESSION


89 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x00904100L

90 
	#HAVE_USERDATA_IN_PWD_CALLBACK
 1

	)

92 #unde‡
HAVE_USERDATA_IN_PWD_CALLBACK


95 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x00907001L

97 
	#HAVE_ENGINE_LOAD_FOUR_ARGS


	)

98 
	~<›ís¶/ui.h
>

101 #unde‡
HAVE_ENGINE_LOAD_FOUR_ARGS


104 #i‡(
OPENSSL_VERSION_NUMBER
 >0x00903001LË&& 
deföed
(
HAVE_OPENSSL_PKCS12_H
)

106 
	#HAVE_PKCS12_SUPPORT


	)

109 #unde‡
HAVE_PKCS12_SUPPORT


112 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x00906001L

113 
	#HAVE_ERR_ERROR_STRING_N
 1

	)

116 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x00909000L

117 
	#SSL_METHOD_QUAL
 c⁄°

	)

119 
	#SSL_METHOD_QUAL


	)

122 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x00907000L

124 
	#HAVE_X509_STORE_SET_FLAGS
 1

	)

126 
	#X509_STORE_£t_Êags
(
x
,
y
Ë
Cuæ_n›_°mt


	)

129 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x10000000L

130 
	#HAVE_ERR_REMOVE_THREAD_STATE
 1

	)

133 #i‚de‡
HAVE_SSLV2_CLIENT_METHOD


134 #unde‡
OPENSSL_NO_SSL2


135 
	#OPENSSL_NO_SSL2


	)

144 
	#RAND_LOAD_LENGTH
 1024

	)

146 #i‚de‡
HAVE_USERDATA_IN_PWD_CALLBACK


147 
	gglobÆ_∑sswd
[64];

150 
∑sswd_ˇŒback
(*
buf
, 
num
, 
í¸y±ög


151 #ifde‡
HAVE_USERDATA_IN_PWD_CALLBACK


155 , *
globÆ_∑sswd


159 
DEBUGASSERT
(0 =
í¸y±ög
);

161 if(!
	gí¸y±ög
) {

162 
	gkÀn
 = 
cuæx_uztosi
(
°æí
((*)
globÆ_∑sswd
));

163 if(
	gnum
 > 
	gkÀn
) {

164 
mem˝y
(
buf
, 
globÆ_∑sswd
, 
kÀn
+1);

165  
	gkÀn
;

178 #ifde‡
HAVE_RAND_STATUS


179 
	#£ed_íough
(
x
Ë
	`ønd_íough
()

	)

180 
boﬁ
 
	$ønd_íough
()

182  (0 !
	`RAND_°©us
()Ë? 
TRUE
 : 
FALSE
;

183 
	}
}

185 
	#£ed_íough
(
x
Ë
	`ønd_íough
(x)

	)

186 
boﬁ
 
	$ønd_íough
(
ƒód
)

189  (
ƒód
 > 500Ë? 
TRUE
 : 
FALSE
;

190 
	}
}

193 
	$os¶_£ed
(
Sessi⁄H™dÀ
 *
d©a
)

195 *
buf
 = 
d©a
->
°©e
.
buf„r
;

196 
ƒód
=0;

201 #i‚de‡
RANDOM_FILE


204 if(
d©a
->
£t
.
s¶
.
øndom_fûe
)

205 
	#RANDOM_FILE
 ""

	)

209 
ƒód
 +
	`RAND_lﬂd_fûe
((
d©a
->
£t
.
°r
[
STRING_SSL_RANDOM_FILE
]?

210 
d©a
->
£t
.
°r
[
STRING_SSL_RANDOM_FILE
]:

211 
RANDOM_FILE
),

212 
RAND_LOAD_LENGTH
);

213 if(
	`£ed_íough
(
ƒód
))

214  
ƒód
;

217 #i‡
	`deföed
(
HAVE_RAND_EGD
)

220 #i‚de‡
EGD_SOCKET


223 if(
d©a
->
£t
.
°r
[
STRING_SSL_EGDSOCKET
])

224 
	#EGD_SOCKET
 ""

	)

229 
ªt
 = 
	`RAND_egd
(
d©a
->
£t
.
°r
[
STRING_SSL_EGDSOCKET
]?

230 
d©a
->
£t
.
°r
[
STRING_SSL_EGDSOCKET
]:
EGD_SOCKET
);

231 if(-1 !
ªt
) {

232 
ƒód
 +
ªt
;

233 if(
	`£ed_íough
(
ƒód
))

234  
ƒód
;

242 
øndb
[64];

243 
Àn
 = (
øndb
);

244 
	`RAND_byãs
(
øndb
, 
Àn
);

245 
	`RAND_add
(
øndb
, 
Àn
, (len >> 1));

246 } !
	`RAND_°©us
());

249 
buf
[0]=0;

250 
	`RAND_fûe_«me
(
buf
, 
BUFSIZE
);

251 if(
buf
[0]) {

253 
ƒód
 +
	`RAND_lﬂd_fûe
(
buf
, 
RAND_LOAD_LENGTH
);

254 if(
	`£ed_íough
(
ƒód
))

255  
ƒód
;

258 
	`öfof
(
d©a
, "libcurl isÇow usingá weakÑandom seed!\n");

259  
ƒód
;

260 
	}
}

262 
	$Cuæ_os¶_£ed
(
Sessi⁄H™dÀ
 *
d©a
)

266 
boﬁ
 
s¶_£eded
 = 
FALSE
;

268 if(!
s¶_£eded
 || 
d©a
->
£t
.
°r
[
STRING_SSL_RANDOM_FILE
] ||

269 
d©a
->
£t
.
°r
[
STRING_SSL_EGDSOCKET
]) {

270 
	`os¶_£ed
(
d©a
);

271 
s¶_£eded
 = 
TRUE
;

274 
	}
}

277 #i‚de‡
SSL_FILETYPE_ENGINE


278 
	#SSL_FILETYPE_ENGINE
 42

	)

280 #i‚de‡
SSL_FILETYPE_PKCS12


281 
	#SSL_FILETYPE_PKCS12
 43

	)

283 
	$do_fûe_ty≥
(c⁄° *
ty≥
)

285 if(!
ty≥
 || !type[0])

286  
SSL_FILETYPE_PEM
;

287 if(
	`Cuæ_øw_equÆ
(
ty≥
, "PEM"))

288  
SSL_FILETYPE_PEM
;

289 if(
	`Cuæ_øw_equÆ
(
ty≥
, "DER"))

290  
SSL_FILETYPE_ASN1
;

291 if(
	`Cuæ_øw_equÆ
(
ty≥
, "ENG"))

292  
SSL_FILETYPE_ENGINE
;

293 if(
	`Cuæ_øw_equÆ
(
ty≥
, "P12"))

294  
SSL_FILETYPE_PKCS12
;

296 
	}
}

298 #i‡
deföed
(
HAVE_OPENSSL_ENGINE_H
Ë&& deföed(
HAVE_ENGINE_LOAD_FOUR_ARGS
)

304 
	$s¶_ui_ªadî
(
UI
 *
ui
, 
UI_STRING
 *
uis
)

306 c⁄° *
∑ssw‹d
;

307 
	`UI_gë_°rög_ty≥
(
uis
)) {

308 
UIT_PROMPT
:

309 
UIT_VERIFY
:

310 
∑ssw‹d
 = (c⁄° *)
	`UI_gë0_u£r_d©a
(
ui
);

311 if(
NULL
 !
∑ssw‹d
 &&

312 
	`UI_gë_öput_Êags
(
uis
Ë& 
UI_INPUT_FLAG_DEFAULT_PWD
) {

313 
	`UI_£t_ªsu…
(
ui
, 
uis
, 
∑ssw‹d
);

319  (
	`UI_mëhod_gë_ªadî
(
	`UI_O≥nSSL
()))(
ui
, 
uis
);

320 
	}
}

325 
	$s¶_ui_wrôî
(
UI
 *
ui
, 
UI_STRING
 *
uis
)

327 
	`UI_gë_°rög_ty≥
(
uis
)) {

328 
UIT_PROMPT
:

329 
UIT_VERIFY
:

330 if(
NULL
 !
	`UI_gë0_u£r_d©a
(
ui
) &&

331 
	`UI_gë_öput_Êags
(
uis
Ë& 
UI_INPUT_FLAG_DEFAULT_PWD
) {

337  (
	`UI_mëhod_gë_wrôî
(
	`UI_O≥nSSL
()))(
ui
, 
uis
);

338 
	}
}

342 
	$˚π_°uff
(
c⁄√˘d©a
 *
c⁄n
,

343 
SSL_CTX
* 
˘x
,

344 *
˚π_fûe
,

345 c⁄° *
˚π_ty≥
,

346 *
key_fûe
,

347 c⁄° *
key_ty≥
)

349 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

351 
fûe_ty≥
 = 
	`do_fûe_ty≥
(
˚π_ty≥
);

353 if(
˚π_fûe
 !
NULL
 || 
fûe_ty≥
 =
SSL_FILETYPE_ENGINE
) {

354 
SSL
 *
s¶
;

355 
X509
 *
x509
;

356 
˚π_d⁄e
 = 0;

358 if(
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
]) {

359 #i‚de‡
HAVE_USERDATA_IN_PWD_CALLBACK


364 
size_t
 
Àn
 = 
	`°æí
(
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
]);

365 if(
Àn
 < (
globÆ_∑sswd
))

366 
	`mem˝y
(
globÆ_∑sswd
, 
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
], 
Àn
+1);

368 
globÆ_∑sswd
[0] = '\0';

373 
	`SSL_CTX_£t_deÁu…_∑sswd_cb_u£rd©a
(
˘x
,

374 
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
]);

377 
	`SSL_CTX_£t_deÁu…_∑sswd_cb
(
˘x
, 
∑sswd_ˇŒback
);

381 
	#SSL_CLIENT_CERT_ERR
 \

382 "u«bÀÅÿu£ clõ¡ cîtifiˇã (nÿkey found o∏wr⁄gÖas†phø£?)"

	)

384 
fûe_ty≥
) {

385 
SSL_FILETYPE_PEM
:

387 if(
	`SSL_CTX_u£_˚πifiˇã_chaö_fûe
(
˘x
,

388 
˚π_fûe
) != 1) {

389 
	`Áûf
(
d©a
, 
SSL_CLIENT_CERT_ERR
);

394 
SSL_FILETYPE_ASN1
:

398 if(
	`SSL_CTX_u£_˚πifiˇã_fûe
(
˘x
,

399 
˚π_fûe
,

400 
fûe_ty≥
) != 1) {

401 
	`Áûf
(
d©a
, 
SSL_CLIENT_CERT_ERR
);

405 
SSL_FILETYPE_ENGINE
:

406 #i‡
	`deföed
(
HAVE_OPENSSL_ENGINE_H
Ë&& deföed(
ENGINE_CTRL_GET_CMD_FROM_NAME
)

408 if(
d©a
->
°©e
.
ígöe
) {

409 c⁄° *
cmd_«me
 = "LOAD_CERT_CTRL";

411 c⁄° *
˚π_id
;

412 
X509
 *
˚π
;

413 } 
∑øms
;

415 
∑øms
.
˚π_id
 = 
˚π_fûe
;

416 
∑øms
.
˚π
 = 
NULL
;

419 if(!
	`ENGINE_˘æ
(
d©a
->
°©e
.
ígöe
, 
ENGINE_CTRL_GET_CMD_FROM_NAME
,

420 0, (*)
cmd_«me
, 
NULL
)) {

421 
	`Áûf
(
d©a
, "sslÉngine doesÇot supportÜoading certificates");

426 if(!
	`ENGINE_˘æ_cmd
(
d©a
->
°©e
.
ígöe
, 
cmd_«me
,

427 0, &
∑øms
, 
NULL
, 1)) {

428 
	`Áûf
(
d©a
, "sslÉngine cannotÜoad client cert with id"

429 " '%s' [%s]", 
˚π_fûe
,

430 
	`ERR_îr‹_°rög
(
	`ERR_gë_îr‹
(), 
NULL
));

434 if(!
∑øms
.
˚π
) {

435 
	`Áûf
(
d©a
, "sslÉngine didn't initializedÅhe certificate "

440 if(
	`SSL_CTX_u£_˚πifiˇã
(
˘x
, 
∑øms
.
˚π
) != 1) {

441 
	`Áûf
(
d©a
, "unableÅo set client certificate");

442 
	`X509_‰ì
(
∑øms
.
˚π
);

445 
	`X509_‰ì
(
∑øms
.
˚π
);

448 
	`Áûf
(
d©a
, "cryptoÉngineÇot set, can'tÜoad certificate");

454 
	`Áûf
(
d©a
, "fileÅype ENG for certificateÇot implemented");

458 
SSL_FILETYPE_PKCS12
:

460 #ifde‡
HAVE_PKCS12_SUPPORT


461 
FILE
 *
f
;

462 
PKCS12
 *
p12
;

463 
EVP_PKEY
 *
¥i
;

464 
	`STACK_OF
(
X509
Ë*
ˇ
 = 
NULL
;

465 
i
;

467 
f
 = 
	`f›í
(
˚π_fûe
,"rb");

468 if(!
f
) {

469 
	`Áûf
(
d©a
, "couldÇŸ o≥¿PKCS12 fûê'%s'", 
˚π_fûe
);

472 
p12
 = 
	`d2i_PKCS12_Â
(
f
, 
NULL
);

473 
	`f˛o£
(
f
);

475 if(!
p12
) {

476 
	`Áûf
(
d©a
, "îr‹Ñódög PKCS12 fûê'%s'", 
˚π_fûe
 );

480 
	`PKCS12_PBE_add
();

482 if(!
	`PKCS12_∑r£
(
p12
, 
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
], &
¥i
, &
x509
,

483 &
ˇ
)) {

484 
	`Áûf
(
d©a
,

486 
	`ERR_îr‹_°rög
(
	`ERR_gë_îr‹
(), 
NULL
) );

487 
	`PKCS12_‰ì
(
p12
);

491 
	`PKCS12_‰ì
(
p12
);

493 if(
	`SSL_CTX_u£_˚πifiˇã
(
˘x
, 
x509
) != 1) {

494 
	`Áûf
(
d©a
, 
SSL_CLIENT_CERT_ERR
);

495 
Áû
;

498 if(
	`SSL_CTX_u£_Priv©eKey
(
˘x
, 
¥i
) != 1) {

499 
	`Áûf
(
d©a
, "unableÅo useÖrivate key from PKCS12 file '%s'",

500 
˚π_fûe
);

501 
Áû
;

504 if(!
	`SSL_CTX_check_¥iv©e_key
 (
˘x
)) {

505 
	`Áûf
(
d©a
, "private key from PKCS12 file '%s' "

506 "d€†nŸ m©ch cîtifiˇã i¿ßmêfûe", 
˚π_fûe
);

507 
Áû
;

510 if(
ˇ
 && 
	`sk_X509_num
(ca)) {

511 
i
 = 0; i < 
	`sk_X509_num
(
ˇ
); i++) {

519 
X509
 *
x
 = 
	`sk_X509_p›
(
ˇ
);

520 if(!
	`SSL_CTX_add_exåa_chaö_˚π
(
˘x
, 
x
)) {

521 
	`Áûf
(
d©a
, "cannotádd certificateÅo certificate chain");

522 
Áû
;

527 if(!
	`SSL_CTX_add_˛õ¡_CA
(
˘x
, 
x
)) {

528 
	`Áûf
(
d©a
, "cannotádd certificateÅo client CAÜist");

529 
Áû
;

534 
˚π_d⁄e
 = 1;

535 
Áû
:

536 
	`EVP_PKEY_‰ì
(
¥i
);

537 
	`X509_‰ì
(
x509
);

538 
	`sk_X509_p›_‰ì
(
ˇ
, 
X509_‰ì
);

540 if(!
˚π_d⁄e
)

544 
	`Áûf
(
d©a
, "fileÅype P12 for certificateÇot supported");

549 
	`Áûf
(
d©a
, "nŸ suµ‹ãd fûêty≥ '%s' f‹ cîtifiˇã", 
˚π_ty≥
);

553 
fûe_ty≥
 = 
	`do_fûe_ty≥
(
key_ty≥
);

555 
fûe_ty≥
) {

556 
SSL_FILETYPE_PEM
:

557 if(
˚π_d⁄e
)

559 if(
key_fûe
 =
NULL
)

561 
key_fûe
=
˚π_fûe
;

562 
SSL_FILETYPE_ASN1
:

563 if(
	`SSL_CTX_u£_Priv©eKey_fûe
(
˘x
, 
key_fûe
, 
fûe_ty≥
) != 1) {

564 
	`Áûf
(
d©a
, "unableÅo setÖrivate key file: '%s'Åype %s",

565 
key_fûe
, 
key_ty≥
?key_type:"PEM");

569 
SSL_FILETYPE_ENGINE
:

570 #ifde‡
HAVE_OPENSSL_ENGINE_H


572 
EVP_PKEY
 *
¥iv_key
 = 
NULL
;

573 if(
d©a
->
°©e
.
ígöe
) {

574 #ifde‡
HAVE_ENGINE_LOAD_FOUR_ARGS


575 
UI_METHOD
 *
ui_mëhod
 =

576 
	`UI_¸óã_mëhod
((*)"cURL user interface");

577 if(
NULL
 =
ui_mëhod
) {

578 
	`Áûf
(
d©a
, "unable do create OpenSSL user-interface method");

581 
	`UI_mëhod_£t_›íî
(
ui_mëhod
, 
	`UI_mëhod_gë_›íî
(
	`UI_O≥nSSL
()));

582 
	`UI_mëhod_£t_˛o£r
(
ui_mëhod
, 
	`UI_mëhod_gë_˛o£r
(
	`UI_O≥nSSL
()));

583 
	`UI_mëhod_£t_ªadî
(
ui_mëhod
, 
s¶_ui_ªadî
);

584 
	`UI_mëhod_£t_wrôî
(
ui_mëhod
, 
s¶_ui_wrôî
);

587 
¥iv_key
 = (
EVP_PKEY
 *)

588 
	`ENGINE_lﬂd_¥iv©e_key
(
d©a
->
°©e
.
ígöe
,
key_fûe
,

589 #ifde‡
HAVE_ENGINE_LOAD_FOUR_ARGS


590 
ui_mëhod
,

592 
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
]);

593 #ifde‡
HAVE_ENGINE_LOAD_FOUR_ARGS


594 
	`UI_de°roy_mëhod
(
ui_mëhod
);

596 if(!
¥iv_key
) {

597 
	`Áûf
(
d©a
, "failedÅoÜoadÖrivate key from cryptoÉngine");

600 if(
	`SSL_CTX_u£_Priv©eKey
(
˘x
, 
¥iv_key
) != 1) {

601 
	`Áûf
(
d©a
, "unableÅo setÖrivate key");

602 
	`EVP_PKEY_‰ì
(
¥iv_key
);

605 
	`EVP_PKEY_‰ì
(
¥iv_key
);

608 
	`Áûf
(
d©a
, "cryptoÉngineÇot set, can'tÜoadÖrivate key");

614 
	`Áûf
(
d©a
, "fileÅype ENG forÖrivate keyÇot supported");

617 
SSL_FILETYPE_PKCS12
:

618 if(!
˚π_d⁄e
) {

619 
	`Áûf
(
d©a
, "fileÅype P12 forÖrivate keyÇot supported");

624 
	`Áûf
(
d©a
, "not supported fileÅype forÖrivate key");

628 
s¶
=
	`SSL_√w
(
˘x
);

629 if(
NULL
 =
s¶
) {

630 
	`Áûf
(
d©a
,"unableÅo createán SSL structure");

634 
x509
=
	`SSL_gë_˚πifiˇã
(
s¶
);

638 if(
x509
 !
NULL
) {

639 
EVP_PKEY
 *
pktmp
 = 
	`X509_gë_pubkey
(
x509
);

640 
	`EVP_PKEY_c›y_∑ømëîs
(
pktmp
,
	`SSL_gë_¥iv©ekey
(
s¶
));

641 
	`EVP_PKEY_‰ì
(
pktmp
);

644 
	`SSL_‰ì
(
s¶
);

652 if(!
	`SSL_CTX_check_¥iv©e_key
(
˘x
)) {

653 
	`Áûf
(
d©a
, "Private key doesÇot matchÅhe certificateÖublic key");

656 #i‚de‡
HAVE_USERDATA_IN_PWD_CALLBACK


658 
	`mem£t
(
globÆ_∑sswd
, 0, (global_passwd));

662 
	}
}

665 
	$x509_«me_⁄ñöe
(
X509_NAME
 *
a
, *
buf
, 
size_t
 
size
)

668  
	`X509_NAME_⁄ñöe
(
a
, 
buf
, 
size
);

670 
BIO
 *
bio_out
 = 
	`BIO_√w
(
	`BIO_s_mem
());

671 
BUF_MEM
 *
biomem
;

672 
rc
;

674 if(!
bio_out
)

677 
rc
 = 
	`X509_NAME_¥öt_ex
(
bio_out
, 
a
, 0, 
XN_FLAG_SEP_SPLUS_SPC
);

678 
	`BIO_gë_mem_±r
(
bio_out
, &
biomem
);

680 if((
size_t
)
biomem
->
Àngth
 < 
size
)

681 
size
 = 
biomem
->
Àngth
;

683 
size
--;

685 
	`mem˝y
(
buf
, 
biomem
->
d©a
, 
size
);

686 
buf
[
size
]=0;

688 
	`BIO_‰ì
(
bio_out
);

690  !
rc
;

692 
	}
}

695 
	$˚π_vîify_ˇŒback
(
ok
, 
X509_STORE_CTX
 *
˘x
)

697 
X509
 *
îr_˚π
;

698 
buf
[256];

700 
îr_˚π
=
	`X509_STORE_CTX_gë_cuºít_˚π
(
˘x
);

701 ()
	`x509_«me_⁄ñöe
(
	`X509_gë_subje˘_«me
(
îr_˚π
), 
buf
, (buf));

702  
ok
;

703 
	}
}

707 *
	$SSL_°ªº‹
(
îr‹
, *
buf
, 
size_t
 
size
)

709 #ifde‡
HAVE_ERR_ERROR_STRING_N


713 
	`ERR_îr‹_°rög_n
(
îr‹
, 
buf
, 
size
);

715 (Ë
size
;

716 
	`ERR_îr‹_°rög
(
îr‹
, 
buf
);

718  
buf
;

719 
	}
}

723 #ifde‡
USE_SSLEAY


730 
	$Cuæ_os¶_öô
()

732 #ifde‡
HAVE_ENGINE_LOAD_BUILTIN_ENGINES


733 
	`ENGINE_lﬂd_buûtö_ígöes
();

737 
	`SSL_lﬂd_îr‹_°rögs
();

740 if(!
	`SSLóy_add_s¶_Æg‹ôhms
())

743 
	`O≥nSSL_add_Æl_Æg‹ôhms
();

744 
	`OPENSSL_c⁄fig
(
NULL
);

747 
	}
}

751 #ifde‡
USE_SSLEAY


754 
	$Cuæ_os¶_˛ónup
()

757 
	`EVP_˛ónup
();

759 #ifde‡
HAVE_ENGINE_CLEANUP


761 
	`ENGINE_˛ónup
();

764 #ifde‡
HAVE_CRYPTO_CLEANUP_ALL_EX_DATA


766 
	`CRYPTO_˛ónup_Æl_ex_d©a
();

770 
	`ERR_‰ì_°rögs
();

773 #ifde‡
HAVE_ERR_REMOVE_THREAD_STATE


774 
	`ERR_ªmove_thªad_°©e
(
NULL
);

776 
	`ERR_ªmove_°©e
(0);

778 
	}
}

788 
	$Cuæ_os¶_check_cxn
(
c⁄√˘d©a
 *
c⁄n
)

790 
rc
;

791 
buf
;

793 
rc
 = 
	`SSL_≥ek
(
c⁄n
->
s¶
[
FIRSTSOCKET
].
h™dÀ
, (*)&
buf
, 1);

794 if(
rc
 > 0)

797 if(
rc
 == 0)

801 
	}
}

805 
CURLcode
 
	$Cuæ_os¶_£t_ígöe
(
Sessi⁄H™dÀ
 *
d©a
, c⁄° *
ígöe
)

807 #i‡
	`deföed
(
USE_SSLEAY
Ë&& deföed(
HAVE_OPENSSL_ENGINE_H
)

808 
ENGINE
 *
e
;

810 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x00909000L

811 
e
 = 
	`ENGINE_by_id
(
ígöe
);

814 
e
 = 
	`ENGINE_gë_fú°
();É;É = 
	`ENGINE_gë_√xt
(e)) {

815 c⁄° *
e_id
 = 
	`ENGINE_gë_id
(
e
);

816 if(!
	`°rcmp
(
ígöe
, 
e_id
))

821 if(!
e
) {

822 
	`Áûf
(
d©a
, "SSL Engöê'%s'ÇŸ found", 
ígöe
);

823  
CURLE_SSL_ENGINE_NOTFOUND
;

826 if(
d©a
->
°©e
.
ígöe
) {

827 
	`ENGINE_föish
(
d©a
->
°©e
.
ígöe
);

828 
	`ENGINE_‰ì
(
d©a
->
°©e
.
ígöe
);

829 
d©a
->
°©e
.
ígöe
 = 
NULL
;

831 if(!
	`ENGINE_öô
(
e
)) {

832 
buf
[256];

834 
	`ENGINE_‰ì
(
e
);

835 
	`Áûf
(
d©a
, "FailedÅo initialise SSL Engine '%s':\n%s",

836 
ígöe
, 
	`SSL_°ªº‹
(
	`ERR_gë_îr‹
(), 
buf
, (buf)));

837  
CURLE_SSL_ENGINE_INITFAILED
;

839 
d©a
->
°©e
.
ígöe
 = 
e
;

840  
CURLE_OK
;

842 ()
ígöe
;

843 
	`Áûf
(
d©a
, "SSL EngineÇot supported");

844  
CURLE_SSL_ENGINE_NOTFOUND
;

846 
	}
}

850 
CURLcode
 
	$Cuæ_os¶_£t_ígöe_deÁu…
(
Sessi⁄H™dÀ
 *
d©a
)

852 #ifde‡
HAVE_OPENSSL_ENGINE_H


853 if(
d©a
->
°©e
.
ígöe
) {

854 if(
	`ENGINE_£t_deÁu…
(
d©a
->
°©e
.
ígöe
, 
ENGINE_METHOD_ALL
) > 0) {

855 
	`öfof
(
d©a
,"set default cryptoÉngine '%s'\n",

856 
	`ENGINE_gë_id
(
d©a
->
°©e
.
ígöe
));

859 
	`Áûf
(
d©a
, "set default cryptoÉngine '%s' failed",

860 
	`ENGINE_gë_id
(
d©a
->
°©e
.
ígöe
));

861  
CURLE_SSL_ENGINE_SETFAILED
;

865 (Ë
d©a
;

867  
CURLE_OK
;

868 
	}
}

872 
cuæ_¶i°
 *
	$Cuæ_os¶_ígöes_li°
(
Sessi⁄H™dÀ
 *
d©a
)

874 
cuæ_¶i°
 *
li°
 = 
NULL
;

875 #i‡
	`deföed
(
USE_SSLEAY
Ë&& deföed(
HAVE_OPENSSL_ENGINE_H
)

876 
cuæ_¶i°
 *
beg
;

877 
ENGINE
 *
e
;

879 
e
 = 
	`ENGINE_gë_fú°
();É;É = 
	`ENGINE_gë_√xt
(e)) {

880 
beg
 = 
	`cuæ_¶i°_≠≥nd
(
li°
, 
	`ENGINE_gë_id
(
e
));

881 if(!
beg
) {

882 
	`cuæ_¶i°_‰ì_Æl
(
li°
);

883  
NULL
;

885 
li°
 = 
beg
;

888 (Ë
d©a
;

889  
li°
;

890 
	}
}

896 
	$Cuæ_os¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

898 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

900 if(
c⁄ns¶
->
h™dÀ
) {

901 ()
	`SSL_shutdown
(
c⁄ns¶
->
h™dÀ
);

902 
	`SSL_£t_c⁄√˘_°©e
(
c⁄ns¶
->
h™dÀ
);

904 
	`SSL_‰ì
 (
c⁄ns¶
->
h™dÀ
);

905 
c⁄ns¶
->
h™dÀ
 = 
NULL
;

907 if(
c⁄ns¶
->
˘x
) {

908 
	`SSL_CTX_‰ì
 (
c⁄ns¶
->
˘x
);

909 
c⁄ns¶
->
˘x
 = 
NULL
;

911 
	}
}

917 
	$Cuæ_os¶_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

919 
ªtvÆ
 = 0;

920 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

921 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

922 
buf
[120];

924 
s¶îr‹
;

925 
ssize_t
 
ƒód
;

926 
buffsize
;

927 
îr
;

928 
d⁄e
 = 0;

935 if(
d©a
->
£t
.
·p_ccc
 =
CURLFTPSSL_CCC_ACTIVE
)

936 ()
	`SSL_shutdown
(
c⁄ns¶
->
h™dÀ
);

938 if(
c⁄ns¶
->
h™dÀ
) {

939 
buffsize
 = ()(
buf
);

940 !
d⁄e
) {

941 
wh©
 = 
	`Cuæ_sockë_ªady
(
c⁄n
->
sock
[
socködex
],

942 
CURL_SOCKET_BAD
, 
SSL_SHUTDOWN_TIMEOUT
);

943 if(
wh©
 > 0) {

944 
	`ERR_˛ór_îr‹
();

948 
ƒód
 = (
ssize_t
)
	`SSL_ªad
(
c⁄n
->
s¶
[
socködex
].
h™dÀ
, 
buf
,

949 
buffsize
);

950 
îr
 = 
	`SSL_gë_îr‹
(
c⁄n
->
s¶
[
socködex
].
h™dÀ
, ()
ƒód
);

952 
îr
) {

953 
SSL_ERROR_NONE
:

954 
SSL_ERROR_ZERO_RETURN
:

957 
d⁄e
 = 1;

959 
SSL_ERROR_WANT_READ
:

961 
	`öfof
(
d©a
, "SSL_ERROR_WANT_READ\n");

963 
SSL_ERROR_WANT_WRITE
:

965 
	`öfof
(
d©a
, "SSL_ERROR_WANT_WRITE\n");

966 
d⁄e
 = 1;

970 
s¶îr‹
 = 
	`ERR_gë_îr‹
();

971 
	`Áûf
(
c⁄n
->
d©a
, "SSLÑead: %s,Érrno %d",

972 
	`ERR_îr‹_°rög
(
s¶îr‹
, 
buf
),

973 
SOCKERRNO
);

974 
d⁄e
 = 1;

978 if(0 =
wh©
) {

980 
	`Áûf
(
d©a
, "SSL shutdownÅimeout");

981 
d⁄e
 = 1;

985 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

986 
ªtvÆ
 = -1;

987 
d⁄e
 = 1;

991 if(
d©a
->
£t
.
vîbo£
) {

992 #ifde‡
HAVE_SSL_GET_SHUTDOWN


993 
	`SSL_gë_shutdown
(
c⁄ns¶
->
h™dÀ
)) {

994 
SSL_SENT_SHUTDOWN
:

995 
	`öfof
(
d©a
, "SSL_get_shutdown()Ñeturned SSL_SENT_SHUTDOWN\n");

997 
SSL_RECEIVED_SHUTDOWN
:

998 
	`öfof
(
d©a
, "SSL_get_shutdown()Ñeturned SSL_RECEIVED_SHUTDOWN\n");

1000 
SSL_SENT_SHUTDOWN
|
SSL_RECEIVED_SHUTDOWN
:

1001 
	`öfof
(
d©a
, "SSL_get_shutdown()Ñeturned SSL_SENT_SHUTDOWN|"

1008 
	`SSL_‰ì
 (
c⁄ns¶
->
h™dÀ
);

1009 
c⁄ns¶
->
h™dÀ
 = 
NULL
;

1011  
ªtvÆ
;

1012 
	}
}

1014 
	$Cuæ_os¶_£ssi⁄_‰ì
(*
±r
)

1017 
	`SSL_SESSION_‰ì
(
±r
);

1018 
	}
}

1024 
	$Cuæ_os¶_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
)

1026 #ifde‡
HAVE_OPENSSL_ENGINE_H


1027 if(
d©a
->
°©e
.
ígöe
) {

1028 
	`ENGINE_föish
(
d©a
->
°©e
.
ígöe
);

1029 
	`ENGINE_‰ì
(
d©a
->
°©e
.
ígöe
);

1030 
d©a
->
°©e
.
ígöe
 = 
NULL
;

1033 ()
d©a
;

1036 
	}
}

1038 
	$a¢1_ouçut
(c⁄° 
ASN1_UTCTIME
 *
tm
,

1039 *
buf
,

1040 
size_t
 
sizeofbuf
)

1042 c⁄° *
a¢1_°rög
;

1043 
gmt
=
FALSE
;

1044 
i
;

1045 
yór
=0,
m⁄th
=0,
day
=0,
hour
=0,
möuã
=0,
£c⁄d
=0;

1047 
i
=
tm
->
Àngth
;

1048 
a¢1_°rög
=(c⁄° *)
tm
->
d©a
;

1050 if(
i
 < 10)

1052 if(
a¢1_°rög
[
i
-1] == 'Z')

1053 
gmt
=
TRUE
;

1054 
i
=0; i<10; i++)

1055 if((
a¢1_°rög
[
i
] > '9') || (asn1_string[i] < '0'))

1058 
yór
(
a¢1_°rög
[0]-'0')*10+(asn1_string[1]-'0');

1059 if(
yór
 < 50)

1060 
yór
+=100;

1062 
m⁄th
(
a¢1_°rög
[2]-'0')*10+(asn1_string[3]-'0');

1063 if((
m⁄th
 > 12) || (month < 1))

1066 
day
(
a¢1_°rög
[4]-'0')*10+(asn1_string[5]-'0');

1067 
hour
(
a¢1_°rög
[6]-'0')*10+(asn1_string[7]-'0');

1068 
möuã
(
a¢1_°rög
[8]-'0')*10+(asn1_string[9]-'0');

1070 if((
a¢1_°rög
[10] >= '0') && (asn1_string[10] <= '9') &&

1071 (
a¢1_°rög
[11] >= '0') && (asn1_string[11] <= '9'))

1072 
£c⁄d
(
a¢1_°rög
[10]-'0')*10+(asn1_string[11]-'0');

1074 
	`¢¥ötf
(
buf
, 
sizeofbuf
,

1076 
yór
+1900, 
m⁄th
, 
day
, 
hour
, 
möuã
, 
£c⁄d
, (
gmt
?"GMT":""));

1079 
	}
}

1105 
CURLcode
 
	$vîifyho°
(
c⁄√˘d©a
 *
c⁄n
,

1106 
X509
 *
£rvî_˚π
)

1108 
m©ched
 = -1;

1110 
èrgë
 = 
GEN_DNS
;

1111 
size_t
 
addæí
 = 0;

1112 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1113 
	`STACK_OF
(
GENERAL_NAME
Ë*
Æäames
;

1114 #ifde‡
ENABLE_IPV6


1115 
ö6_addr
 
addr
;

1117 
ö_addr
 
addr
;

1119 
CURLcode
 
ªs
 = 
CURLE_OK
;

1121 #ifde‡
ENABLE_IPV6


1122 if(
c⁄n
->
bôs
.
ùv6_ù
 &&

1123 
	`Cuæ_öë_±⁄
(
AF_INET6
, 
c⁄n
->
ho°
.
«me
, &
addr
)) {

1124 
èrgë
 = 
GEN_IPADD
;

1125 
addæí
 = (
ö6_addr
);

1129 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
c⁄n
->
ho°
.
«me
, &
addr
)) {

1130 
èrgë
 = 
GEN_IPADD
;

1131 
addæí
 = (
ö_addr
);

1135 
Æäames
 = 
	`X509_gë_ext_d2i
(
£rvî_˚π
, 
NID_subje˘_Æt_«me
, 
NULL
, NULL);

1137 if(
Æäames
) {

1138 
numÆts
;

1139 
i
;

1143 
numÆts
 = 
	`sk_GENERAL_NAME_num
(
Æäames
);

1146 
i
=0; (i<
numÆts
Ë&& (
m©ched
 != 1); i++) {

1148 c⁄° 
GENERAL_NAME
 *
check
 = 
	`sk_GENERAL_NAME_vÆue
(
Æäames
, 
i
);

1151 if(
check
->
ty≥
 =
èrgë
) {

1153 c⁄° *
Æçå
 = (*)
	`ASN1_STRING_d©a
(
check
->
d
.
ü5
);

1154 
size_t
 
Æéí
 = (size_tË
	`ASN1_STRING_Àngth
(
check
->
d
.
ü5
);

1156 
èrgë
) {

1157 
GEN_DNS
:

1168 if((
Æéí
 =
	`°æí
(
Æçå
)) &&

1171 
	`Cuæ_˚π_ho°check
(
Æçå
, 
c⁄n
->
ho°
.
«me
))

1172 
m©ched
 = 1;

1174 
m©ched
 = 0;

1177 
GEN_IPADD
:

1180 if((
Æéí
 =
addæí
Ë&& !
	`memcmp
(
Æçå
, &
addr
,áltlen))

1181 
m©ched
 = 1;

1183 
m©ched
 = 0;

1188 
	`GENERAL_NAMES_‰ì
(
Æäames
);

1191 if(
m©ched
 == 1)

1193 
	`öfof
(
d©a
, "\àsubje˘A…Name: %†m©ched\n", 
c⁄n
->
ho°
.
di•«me
);

1194 if(
m©ched
 == 0) {

1197 
	`öfof
(
d©a
, "\àsubje˘A…Namêd€†nŸ m©ch %s\n", 
c⁄n
->
ho°
.
di•«me
);

1198 
	`Áûf
(
d©a
, "SSL:Çoálternative certificate subjectÇame matches "

1199 "èrgë ho°Çamê'%s'", 
c⁄n
->
ho°
.
di•«me
);

1200 
ªs
 = 
CURLE_PEER_FAILED_VERIFICATION
;

1205 
j
,
i
=-1 ;

1209 *
nul°r
 = (*)"";

1210 *
≥î_CN
 = 
nul°r
;

1212 
X509_NAME
 *
«me
 = 
	`X509_gë_subje˘_«me
(
£rvî_˚π
) ;

1213 if(
«me
)

1214 (
j
 = 
	`X509_NAME_gë_ödex_by_NID
(
«me
, 
NID_comm⁄Name
, 
i
))>=0)

1215 
i
=
j
;

1221 if(
i
>=0) {

1222 
ASN1_STRING
 *
tmp
 = 
	`X509_NAME_ENTRY_gë_d©a
(
	`X509_NAME_gë_íåy
(
«me
,
i
));

1229 if(
tmp
) {

1230 if(
	`ASN1_STRING_ty≥
(
tmp
Ë=
V_ASN1_UTF8STRING
) {

1231 
j
 = 
	`ASN1_STRING_Àngth
(
tmp
);

1232 if(
j
 >= 0) {

1233 
≥î_CN
 = 
	`OPENSSL_mÆloc
(
j
+1);

1234 if(
≥î_CN
) {

1235 
	`mem˝y
(
≥î_CN
, 
	`ASN1_STRING_d©a
(
tmp
), 
j
);

1236 
≥î_CN
[
j
] = '\0';

1241 
j
 = 
	`ASN1_STRING_to_UTF8
(&
≥î_CN
, 
tmp
);

1243 if(
≥î_CN
 && (
	`cuæx_uztosi
(
	`°æí
((*Ììr_CN)Ë!
j
)) {

1246 
	`Áûf
(
d©a
, "SSL: illegal certÇame field");

1247 
ªs
 = 
CURLE_PEER_FAILED_VERIFICATION
;

1252 if(
≥î_CN
 =
nul°r
)

1253 
≥î_CN
 = 
NULL
;

1256 
CURLcode
 
rc
 = 
	`Cuæ_c⁄vît_‰om_utf8
(
d©a
, 
≥î_CN
, 
	`°æí
(peer_CN));

1258 if(
rc
) {

1259 
	`OPENSSL_‰ì
(
≥î_CN
);

1260  
rc
;

1264 if(
ªs
)

1267 if(!
≥î_CN
) {

1268 
	`Áûf
(
d©a
,

1270 
ªs
 = 
CURLE_PEER_FAILED_VERIFICATION
;

1272 if(!
	`Cuæ_˚π_ho°check
((c⁄° *)
≥î_CN
, 
c⁄n
->
ho°
.
«me
)) {

1273 
	`Áûf
(
d©a
, "SSL: certificate subjectÇame '%s' doesÇot match "

1274 "èrgë ho°Çamê'%s'", 
≥î_CN
, 
c⁄n
->
ho°
.
di•«me
);

1275 
ªs
 = 
CURLE_PEER_FAILED_VERIFICATION
;

1278 
	`öfof
(
d©a
, "\àcomm⁄Çame: %†(m©ched)\n", 
≥î_CN
);

1280 if(
≥î_CN
)

1281 
	`OPENSSL_‰ì
(
≥î_CN
);

1283  
ªs
;

1284 
	}
}

1289 #ifde‡
SSL_CTRL_SET_MSG_CALLBACK


1291 c⁄° *
	$s¶_msg_ty≥
(
s¶_vî
, 
msg
)

1293 if(
s¶_vî
 =
SSL2_VERSION_MAJOR
) {

1294 
msg
) {

1295 
SSL2_MT_ERROR
:

1297 
SSL2_MT_CLIENT_HELLO
:

1299 
SSL2_MT_CLIENT_MASTER_KEY
:

1301 
SSL2_MT_CLIENT_FINISHED
:

1303 
SSL2_MT_SERVER_HELLO
:

1305 
SSL2_MT_SERVER_VERIFY
:

1307 
SSL2_MT_SERVER_FINISHED
:

1309 
SSL2_MT_REQUEST_CERTIFICATE
:

1311 
SSL2_MT_CLIENT_CERTIFICATE
:

1315 if(
s¶_vî
 =
SSL3_VERSION_MAJOR
) {

1316 
msg
) {

1317 
SSL3_MT_HELLO_REQUEST
:

1319 
SSL3_MT_CLIENT_HELLO
:

1321 
SSL3_MT_SERVER_HELLO
:

1323 
SSL3_MT_CERTIFICATE
:

1325 
SSL3_MT_SERVER_KEY_EXCHANGE
:

1327 
SSL3_MT_CLIENT_KEY_EXCHANGE
:

1329 
SSL3_MT_CERTIFICATE_REQUEST
:

1331 
SSL3_MT_SERVER_DONE
:

1333 
SSL3_MT_CERTIFICATE_VERIFY
:

1335 
SSL3_MT_FINISHED
:

1340 
	}
}

1342 c⁄° *
	$és_π_ty≥
(
ty≥
)

1345 
ty≥
 =
SSL3_RT_CHANGE_CIPHER_SPEC
 ? "TLS change cipher, " :

1346 
ty≥
 =
SSL3_RT_ALERT
 ? "TLSálert, " :

1347 
ty≥
 =
SSL3_RT_HANDSHAKE
 ? "TLS handshake, " :

1348 
ty≥
 =
SSL3_RT_APPLICATION_DATA
 ? "TLSápp data, " :

1350 
	}
}

1356 
	$s¶_és_åa˚
(
dúe˘i⁄
, 
s¶_vî
, 
c⁄ã¡_ty≥
,

1357 c⁄° *
buf
, 
size_t
 
Àn
, c⁄° 
SSL
 *
s¶
,

1358 
c⁄√˘d©a
 *
c⁄n
)

1360 
Sessi⁄H™dÀ
 *
d©a
;

1361 c⁄° *
msg_«me
, *
és_π_«me
;

1362 
s¶_buf
[1024];

1363 
vî
, 
msg_ty≥
, 
txt_Àn
;

1365 if(!
c⁄n
 || !c⁄n->
d©a
 || !c⁄n->d©a->
£t
.
fdebug
 ||

1366 (
dúe˘i⁄
 != 0 && direction != 1))

1369 
d©a
 = 
c⁄n
->data;

1370 
s¶_vî
 >>= 8;

1371 
vî
 = (
s¶_vî
 =
SSL2_VERSION_MAJOR
 ? '2' :

1372 
s¶_vî
 =
SSL3_VERSION_MAJOR
 ? '3' : '?');

1378 if(
s¶_vî
 =
SSL3_VERSION_MAJOR
 && 
c⁄ã¡_ty≥
 != 0)

1379 
és_π_«me
 = 
	`és_π_ty≥
(
c⁄ã¡_ty≥
);

1381 
és_π_«me
 = "";

1383 
msg_ty≥
 = *(*)
buf
;

1384 
msg_«me
 = 
	`s¶_msg_ty≥
(
s¶_vî
, 
msg_ty≥
);

1386 
txt_Àn
 = 
	`¢¥ötf
(
s¶_buf
, (ssl_buf), "SSLv%c, %s%s (%d):\n",

1387 
vî
, 
és_π_«me
, 
msg_«me
, 
msg_ty≥
);

1388 
	`Cuæ_debug
(
d©a
, 
CURLINFO_TEXT
, 
s¶_buf
, (
size_t
)
txt_Àn
, 
NULL
);

1390 
	`Cuæ_debug
(
d©a
, (
dúe˘i⁄
 =1Ë? 
CURLINFO_SSL_DATA_OUT
 :

1391 
CURLINFO_SSL_DATA_IN
, (*)
buf
, 
Àn
, 
NULL
);

1392 (Ë
s¶
;

1393 
	}
}

1396 #ifde‡
USE_SSLEAY


1399 #ifde‡
SSL_CTRL_SET_TLSEXT_HOSTNAME


1400 
	#u£_¢i
(
x
Ë
¢i
 = (x)

	)

1402 
	#u£_¢i
(
x
Ë
Cuæ_n›_°mt


	)

1405 #ifde‡
USE_NGHTTP2


1407 #unde‡
HAS_ALPN


1408 #i‡
deföed
(
HAVE_SSL_CTX_SET_ALPN_PROTOS
) && \

1409 
	$deföed
(
HAVE_SSL_CTX_SET_ALPN_SELECT_CB
)

1410 
	#HAS_ALPN
 1

	)

1413 #i‡!
	`deföed
(
HAVE_SSL_CTX_SET_NEXT_PROTO_SELECT_CB
) || \

1414 
	$deföed
(
OPENSSL_NO_NEXTPROTONEG
)

1415 #i‡!
	`deföed
(
HAS_ALPN
)

1416 #îr‹ 
hâp2
 
buûds
 
ªquúe
 
O≥nSSL
 
wôh
 
NPN
 
‹
 
ALPN
 
suµ‹t


1426 
	$£À˘_√xt_¥Ÿo_cb
(
SSL
 *
s¶
,

1427 **
out
, *
ouéí
,

1428 c⁄° *
ö
, 
öÀn
,

1429 *
¨g
)

1431 
c⁄√˘d©a
 *
c⁄n
 = (c⁄√˘d©a*Ë
¨g
;

1432 
ªtvÆ
 = 
	`nghâp2_£À˘_√xt_¥Ÿocﬁ
(
out
, 
ouéí
, 
ö
, 
öÀn
);

1433 ()
s¶
;

1435 if(
ªtvÆ
 == 1) {

1436 
	`öfof
(
c⁄n
->
d©a
, "NPN,Çegotiated HTTP2 (%s)\n",

1437 
NGHTTP2_PROTO_VERSION_ID
);

1438 
c⁄n
->
√g≈n
 = 
NPN_HTTP2
;

1440 if(
ªtvÆ
 == 0) {

1441 
	`öfof
(
c⁄n
->
d©a
, "NPN,Çegotiated HTTP1.1\n");

1442 
c⁄n
->
√g≈n
 = 
NPN_HTTP1_1
;

1445 
	`öfof
(
c⁄n
->
d©a
, "NPN,Ço overlap, use HTTP1.1\n",

1446 
NGHTTP2_PROTO_VERSION_ID
);

1447 *
out
 = (*)"http/1.1";

1448 *
ouéí
 = ("http/1.1") - 1;

1449 
c⁄n
->
√g≈n
 = 
NPN_HTTP1_1
;

1452  
SSL_TLSEXT_ERR_OK
;

1453 
	}
}

1457 
	$gë_s¶_vîsi⁄_txt
(
SSL_SESSION
 *
£ssi⁄
)

1459 if(
NULL
 =
£ssi⁄
)

1462 
£ssi⁄
->
s¶_vîsi⁄
) {

1463 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x1000100FL

1464 
TLS1_2_VERSION
:

1466 
TLS1_1_VERSION
:

1469 
TLS1_VERSION
:

1471 
SSL3_VERSION
:

1473 
SSL2_VERSION
:

1477 
	}
}

1480 
CURLcode


1481 
	$os¶_c⁄√˘_°ï1
(
c⁄√˘d©a
 *
c⁄n
,

1482 
socködex
)

1484 
CURLcode
 
ªtcode
 = 
CURLE_OK
;

1485 *
cùhîs
;

1486 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1487 
SSL_METHOD_QUAL
 
SSL_METHOD
 *
ªq_mëhod
=
NULL
;

1488 *
s¶_£ssi⁄id
=
NULL
;

1489 
X509_LOOKUP
 *
lookup
=
NULL
;

1490 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
socködex
];

1491 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1492 
˘x_›ti⁄s
;

1493 #ifde‡
SSL_CTRL_SET_TLSEXT_HOSTNAME


1494 
boﬁ
 
¢i
;

1495 #ifde‡
ENABLE_IPV6


1496 
ö6_addr
 
addr
;

1498 
ö_addr
 
addr
;

1501 #ifde‡
HAS_ALPN


1502 
¥Ÿocﬁs
[128];

1505 
	`DEBUGASSERT
(
s¶_c⁄√˘_1
 =
c⁄ns¶
->
c⁄√˘ög_°©e
);

1508 
	`Cuæ_os¶_£ed
(
d©a
);

1510 
d©a
->
£t
.
s¶
.
˚πvîifyªsu…
 = !
X509_V_OK
;

1514 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

1516 
CURL_SSLVERSION_DEFAULT
:

1517 
CURL_SSLVERSION_TLSv1
:

1518 
CURL_SSLVERSION_TLSv1_0
:

1519 
CURL_SSLVERSION_TLSv1_1
:

1520 
CURL_SSLVERSION_TLSv1_2
:

1522 
ªq_mëhod
 = 
	`SSLv23_˛õ¡_mëhod
();

1523 
	`u£_¢i
(
TRUE
);

1525 
CURL_SSLVERSION_SSLv2
:

1526 #ifde‡
OPENSSL_NO_SSL2


1527 
	`Áûf
(
d©a
, "OpenSSL was built without SSLv2 support");

1528  
CURLE_NOT_BUILT_IN
;

1530 #ifde‡
USE_TLS_SRP


1531 if(
d©a
->
£t
.
s¶
.
authty≥
 =
CURL_TLSAUTH_SRP
)

1532  
CURLE_SSL_CONNECT_ERROR
;

1534 
ªq_mëhod
 = 
	`SSLv2_˛õ¡_mëhod
();

1535 
	`u£_¢i
(
FALSE
);

1538 
CURL_SSLVERSION_SSLv3
:

1539 #ifde‡
USE_TLS_SRP


1540 if(
d©a
->
£t
.
s¶
.
authty≥
 =
CURL_TLSAUTH_SRP
)

1541  
CURLE_SSL_CONNECT_ERROR
;

1543 
ªq_mëhod
 = 
	`SSLv3_˛õ¡_mëhod
();

1544 
	`u£_¢i
(
FALSE
);

1548 if(
c⁄ns¶
->
˘x
)

1549 
	`SSL_CTX_‰ì
(
c⁄ns¶
->
˘x
);

1550 
c⁄ns¶
->
˘x
 = 
	`SSL_CTX_√w
(
ªq_mëhod
);

1552 if(!
c⁄ns¶
->
˘x
) {

1553 
	`Áûf
(
d©a
, "SSL: couldn't createá context: %s",

1554 
	`ERR_îr‹_°rög
(
	`ERR_≥ek_îr‹
(), 
NULL
));

1555  
CURLE_OUT_OF_MEMORY
;

1558 #ifde‡
SSL_MODE_RELEASE_BUFFERS


1559 
	`SSL_CTX_£t_mode
(
c⁄ns¶
->
˘x
, 
SSL_MODE_RELEASE_BUFFERS
);

1562 #ifde‡
SSL_CTRL_SET_MSG_CALLBACK


1563 if(
d©a
->
£t
.
fdebug
 && d©a->£t.
vîbo£
) {

1566 if(!
	`SSL_CTX_ˇŒback_˘æ
(
c⁄ns¶
->
˘x
, 
SSL_CTRL_SET_MSG_CALLBACK
,

1567 ((*)())
s¶_és_åa˚
)) {

1568 
	`öfof
(
d©a
, "SSL: couldn't set callback!\n");

1570 if(!
	`SSL_CTX_˘æ
(
c⁄ns¶
->
˘x
, 
SSL_CTRL_SET_MSG_CALLBACK_ARG
, 0,

1571 
c⁄n
)) {

1572 
	`öfof
(
d©a
, "SSL: couldn't set callbackárgument!\n");

1613 
˘x_›ti⁄s
 = 
SSL_OP_ALL
;

1615 #ifde‡
SSL_OP_NO_TICKET


1616 
˘x_›ti⁄s
 |
SSL_OP_NO_TICKET
;

1619 #ifde‡
SSL_OP_NO_COMPRESSION


1620 
˘x_›ti⁄s
 |
SSL_OP_NO_COMPRESSION
;

1623 #ifde‡
SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG


1625 
˘x_›ti⁄s
 &~
SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG
;

1628 #ifde‡
SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS


1631 if(!
c⁄n
->
d©a
->
£t
.
s¶_íabÀ_bó°
)

1632 
˘x_›ti⁄s
 &~
SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS
;

1635 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

1636 
CURL_SSLVERSION_DEFAULT
:

1637 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv2
;

1638 #ifde‡
USE_TLS_SRP


1639 if(
d©a
->
£t
.
s¶
.
authty≥
 =
CURL_TLSAUTH_SRP
) {

1640 
	`öfof
(
d©a
, "Set version TLSv1.x for SRPáuthorisation\n");

1641 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv3
;

1646 
CURL_SSLVERSION_SSLv3
:

1647 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv2
;

1648 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1
;

1649 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x1000100FL

1650 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1_1
;

1651 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1_2
;

1655 
CURL_SSLVERSION_TLSv1
:

1656 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv2
;

1657 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv3
;

1660 
CURL_SSLVERSION_TLSv1_0
:

1661 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv2
;

1662 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv3
;

1663 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x1000100FL

1664 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1_1
;

1665 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1_2
;

1669 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x1000100FL

1670 
CURL_SSLVERSION_TLSv1_1
:

1671 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv2
;

1672 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv3
;

1673 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1
;

1674 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1_2
;

1677 
CURL_SSLVERSION_TLSv1_2
:

1678 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv2
;

1679 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv3
;

1680 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1
;

1681 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1_1
;

1685 #i‚de‡
OPENSSL_NO_SSL2


1686 
CURL_SSLVERSION_SSLv2
:

1687 
˘x_›ti⁄s
 |
SSL_OP_NO_SSLv3
;

1688 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1
;

1689 #i‡
OPENSSL_VERSION_NUMBER
 >= 0x1000100FL

1690 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1_1
;

1691 
˘x_›ti⁄s
 |
SSL_OP_NO_TLSv1_2
;

1697 
	`Áûf
(
d©a
, "Unsupported SSLÖrotocol version");

1698  
CURLE_SSL_CONNECT_ERROR
;

1701 
	`SSL_CTX_£t_›ti⁄s
(
c⁄ns¶
->
˘x
, 
˘x_›ti⁄s
);

1703 #ifde‡
USE_NGHTTP2


1704 if(
d©a
->
£t
.
hâpvîsi⁄
 =
CURL_HTTP_VERSION_2_0
) {

1705 if(
d©a
->
£t
.
s¶_íabÀ_≈n
) {

1706 
	`SSL_CTX_£t_√xt_¥Ÿo_£À˘_cb
(
c⁄ns¶
->
˘x
, 
£À˘_√xt_¥Ÿo_cb
,

1707 
c⁄n
);

1710 #ifde‡
HAS_ALPN


1711 if(
d©a
->
£t
.
s¶_íabÀ_Æ≤
) {

1712 
¥Ÿocﬁs
[0] = 
NGHTTP2_PROTO_VERSION_ID_LEN
;

1713 
	`mem˝y
(&
¥Ÿocﬁs
[1], 
NGHTTP2_PROTO_VERSION_ID
,

1714 
NGHTTP2_PROTO_VERSION_ID_LEN
);

1716 
¥Ÿocﬁs
[
NGHTTP2_PROTO_VERSION_ID_LEN
+1] = 
ALPN_HTTP_1_1_LENGTH
;

1717 
	`mem˝y
(&
¥Ÿocﬁs
[
NGHTTP2_PROTO_VERSION_ID_LEN
+2], 
ALPN_HTTP_1_1
,

1718 
ALPN_HTTP_1_1_LENGTH
);

1723 
	`SSL_CTX_£t_Æ≤_¥Ÿos
(
c⁄ns¶
->
˘x
, 
¥Ÿocﬁs
,

1724 
NGHTTP2_PROTO_VERSION_ID_LEN
 + 
ALPN_HTTP_1_1_LENGTH
 + 2);

1726 
	`öfof
(
d©a
, "ALPN, of„rög %s, %s\n", 
NGHTTP2_PROTO_VERSION_ID
,

1727 
ALPN_HTTP_1_1
);

1733 if(
d©a
->
£t
.
°r
[
STRING_CERT
] || d©a->£t.°r[
STRING_CERT_TYPE
]) {

1734 if(!
	`˚π_°uff
(
c⁄n
,

1735 
c⁄ns¶
->
˘x
,

1736 
d©a
->
£t
.
°r
[
STRING_CERT
],

1737 
d©a
->
£t
.
°r
[
STRING_CERT_TYPE
],

1738 
d©a
->
£t
.
°r
[
STRING_KEY
],

1739 
d©a
->
£t
.
°r
[
STRING_KEY_TYPE
])) {

1741  
CURLE_SSL_CERTPROBLEM
;

1745 
cùhîs
 = 
d©a
->
£t
.
°r
[
STRING_SSL_CIPHER_LIST
];

1746 if(!
cùhîs
)

1747 
cùhîs
 = (*)
DEFAULT_CIPHER_SELECTION
;

1748 if(!
	`SSL_CTX_£t_cùhî_li°
(
c⁄ns¶
->
˘x
, 
cùhîs
)) {

1749 
	`Áûf
(
d©a
, "Áûed sëtög cùhîÜi°: %s", 
cùhîs
);

1750  
CURLE_SSL_CIPHER
;

1753 #ifde‡
USE_TLS_SRP


1754 if(
d©a
->
£t
.
s¶
.
authty≥
 =
CURL_TLSAUTH_SRP
) {

1755 
	`öfof
(
d©a
, "Usög TLS-SRP u£∫ame: %s\n", d©a->
£t
.
s¶
.
u£∫ame
);

1757 if(!
	`SSL_CTX_£t_§p_u£∫ame
(
c⁄ns¶
->
˘x
, 
d©a
->
£t
.
s¶
.
u£∫ame
)) {

1758 
	`Áûf
(
d©a
, "UnableÅo set SRP userÇame");

1759  
CURLE_BAD_FUNCTION_ARGUMENT
;

1761 if(!
	`SSL_CTX_£t_§p_∑ssw‹d
(
c⁄ns¶
->
˘x
,
d©a
->
£t
.
s¶
.
∑ssw‹d
)) {

1762 
	`Áûf
(
d©a
, "failed setting SRPÖassword");

1763  
CURLE_BAD_FUNCTION_ARGUMENT
;

1765 if(!
d©a
->
£t
.
°r
[
STRING_SSL_CIPHER_LIST
]) {

1766 
	`öfof
(
d©a
, "Setting cipherÜist SRP\n");

1768 if(!
	`SSL_CTX_£t_cùhî_li°
(
c⁄ns¶
->
˘x
, "SRP")) {

1769 
	`Áûf
(
d©a
, "failed setting SRP cipherÜist");

1770  
CURLE_SSL_CIPHER
;

1775 if(
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
] || d©a->£t.°r[
STRING_SSL_CAPATH
]) {

1778 if(!
	`SSL_CTX_lﬂd_vîify_loˇti⁄s
(
c⁄ns¶
->
˘x
,

1779 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
],

1780 
d©a
->
£t
.
°r
[
STRING_SSL_CAPATH
])) {

1781 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

1783 
	`Áûf
(
d©a
,"error setting certificate verifyÜocations:\n"

1785 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]?

1786 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]: "none",

1787 
d©a
->
£t
.
°r
[
STRING_SSL_CAPATH
]?

1788 
d©a
->
£t
.
°r
[
STRING_SSL_CAPATH
] : "none");

1789  
CURLE_SSL_CACERT_BADFILE
;

1794 
	`öfof
(
d©a
, "error setting certificate verifyÜocations,"

1800 
	`öfof
(
d©a
, "successfully set certificate verifyÜocations:\n");

1802 
	`öfof
(
d©a
,

1805 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
] ? data->set.str[STRING_SSL_CAFILE]:

1807 
d©a
->
£t
.
°r
[
STRING_SSL_CAPATH
] ? data->set.str[STRING_SSL_CAPATH]:

1811 if(
d©a
->
£t
.
°r
[
STRING_SSL_CRLFILE
]) {

1814 
lookup
=
	`X509_STORE_add_lookup
(
	`SSL_CTX_gë_˚π_°‹e
(
c⁄ns¶
->
˘x
),

1815 
	`X509_LOOKUP_fûe
());

1816 if(!
lookup
 ||

1817 (!
	`X509_lﬂd_¸l_fûe
(
lookup
,
d©a
->
£t
.
°r
[
STRING_SSL_CRLFILE
],

1818 
X509_FILETYPE_PEM
)) ) {

1819 
	`Áûf
(
d©a
,"errorÜoading CRL file: %s",

1820 
d©a
->
£t
.
°r
[
STRING_SSL_CRLFILE
]);

1821  
CURLE_SSL_CRL_BADFILE
;

1825 
	`öfof
(
d©a
, "successfullyÜoad CRL file:\n");

1826 
	`X509_STORE_£t_Êags
(
	`SSL_CTX_gë_˚π_°‹e
(
c⁄ns¶
->
˘x
),

1827 
X509_V_FLAG_CRL_CHECK
|
X509_V_FLAG_CRL_CHECK_ALL
);

1829 
	`öfof
(
d©a
,

1830 " CRLfûe: %s\n", 
d©a
->
£t
.
°r
[
STRING_SSL_CRLFILE
] ?

1831 
d©a
->
£t
.
°r
[
STRING_SSL_CRLFILE
]: "none");

1838 
	`SSL_CTX_£t_vîify
(
c⁄ns¶
->
˘x
,

1839 
d©a
->
£t
.
s¶
.
vîify≥î
?
SSL_VERIFY_PEER
:
SSL_VERIFY_NONE
,

1840 
˚π_vîify_ˇŒback
);

1843 if(
d©a
->
£t
.
s¶
.
fs¶˘x
) {

1844 
ªtcode
 = (*
d©a
->
£t
.
s¶
.
fs¶˘x
)(d©a, 
c⁄ns¶
->
˘x
,

1845 
d©a
->
£t
.
s¶
.
fs¶˘xp
);

1846 if(
ªtcode
) {

1847 
	`Áûf
(
d©a
,"error signaled by ssl ctx callback");

1848  
ªtcode
;

1853 if(
c⁄ns¶
->
h™dÀ
)

1854 
	`SSL_‰ì
(
c⁄ns¶
->
h™dÀ
);

1855 
c⁄ns¶
->
h™dÀ
 = 
	`SSL_√w
(c⁄ns¶->
˘x
);

1856 if(!
c⁄ns¶
->
h™dÀ
) {

1857 
	`Áûf
(
d©a
, "SSL: couldn't createá context (handle)!");

1858  
CURLE_OUT_OF_MEMORY
;

1860 
	`SSL_£t_c⁄√˘_°©e
(
c⁄ns¶
->
h™dÀ
);

1862 
c⁄ns¶
->
£rvî_˚π
 = 0x0;

1864 #ifde‡
SSL_CTRL_SET_TLSEXT_HOSTNAME


1865 if((0 =
	`Cuæ_öë_±⁄
(
AF_INET
, 
c⁄n
->
ho°
.
«me
, &
addr
)) &&

1866 #ifde‡
ENABLE_IPV6


1867 (0 =
	`Cuæ_öë_±⁄
(
AF_INET6
, 
c⁄n
->
ho°
.
«me
, &
addr
)) &&

1869 
¢i
 &&

1870 !
	`SSL_£t_é£xt_ho°_«me
(
c⁄ns¶
->
h™dÀ
, 
c⁄n
->
ho°
.
«me
))

1871 
	`öfof
(
d©a
, "WARNING: failedÅo configure serverÇame indication (SNI) "

1876 if(!
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, &
s¶_£ssi⁄id
, 
NULL
)) {

1878 if(!
	`SSL_£t_£ssi⁄
(
c⁄ns¶
->
h™dÀ
, 
s¶_£ssi⁄id
)) {

1879 
	`Áûf
(
d©a
, "SSL: SSL_set_session failed: %s",

1880 
	`ERR_îr‹_°rög
(
	`ERR_gë_îr‹
(),
NULL
));

1881  
CURLE_SSL_CONNECT_ERROR
;

1884 
	`öfof
 (
d©a
, "SSLÑe-using session ID\n");

1888 if(!
	`SSL_£t_fd
(
c⁄ns¶
->
h™dÀ
, ()
sockfd
)) {

1889 
	`Áûf
(
d©a
, "SSL: SSL_set_fd failed: %s",

1890 
	`ERR_îr‹_°rög
(
	`ERR_gë_îr‹
(),
NULL
));

1891  
CURLE_SSL_CONNECT_ERROR
;

1894 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2
;

1895  
CURLE_OK
;

1896 
	}
}

1898 
CURLcode


1899 
	$os¶_c⁄√˘_°ï2
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

1901 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

1902 
îr
;

1903 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

1904 
	`DEBUGASSERT
(
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e


1905 || 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e


1906 || 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
);

1908 
	`ERR_˛ór_îr‹
();

1910 
îr
 = 
	`SSL_c⁄√˘
(
c⁄ns¶
->
h™dÀ
);

1915 if(1 !
îr
) {

1916 
dëaû
 = 
	`SSL_gë_îr‹
(
c⁄ns¶
->
h™dÀ
, 
îr
);

1918 if(
SSL_ERROR_WANT_READ
 =
dëaû
) {

1919 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2_ªadög
;

1920  
CURLE_OK
;

1922 if(
SSL_ERROR_WANT_WRITE
 =
dëaû
) {

1923 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2_wrôög
;

1924  
CURLE_OK
;

1928 
îrdëaû
;

1929 
îr‹_buf„r
[256];

1931 
CURLcode
 
rc
;

1932 c⁄° *
˚π_¥obÀm
 = 
NULL
;

1933 
Àº
;

1935 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2
;

1939 
îrdëaû
 = 
	`ERR_gë_îr‹
();

1943 
îrdëaû
) {

1955 
rc
 = 
CURLE_SSL_CACERT
;

1957 
Àº
 = 
	`SSL_gë_vîify_ªsu…
(
c⁄ns¶
->
h™dÀ
);

1958 if(
Àº
 !
X509_V_OK
) {

1959 
	`¢¥ötf
(
îr‹_buf„r
, (error_buffer),

1961 
	`X509_vîify_˚π_îr‹_°rög
(
Àº
));

1964 
˚π_¥obÀm
 = "SSL certificateÖroblem, verifyÅhatÅhe CA cert is"

1969 
rc
 = 
CURLE_SSL_CONNECT_ERROR
;

1970 
	`SSL_°ªº‹
(
îrdëaû
, 
îr‹_buf„r
, (error_buffer));

1980 if(
CURLE_SSL_CONNECT_ERROR
 =
rc
 && 
îrdëaû
 == 0) {

1981 
	`Áûf
(
d©a
, "Unknown SSLÖrotocolÉrror in connectionÅo %s:%ld ",

1982 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

1983  
rc
;

1987 
	`Áûf
(
d©a
, "%s%s", 
˚π_¥obÀm
 ? cît_¥obÀm : "", 
îr‹_buf„r
);

1988  
rc
;

1993 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_3
;

1996 
	`öfof
 (
d©a
, "SSL connection using %s / %s\n",

1997 
	`gë_s¶_vîsi⁄_txt
(
	`SSL_gë_£ssi⁄
(
c⁄ns¶
->
h™dÀ
)),

1998 
	`SSL_gë_cùhî
(
c⁄ns¶
->
h™dÀ
));

2000 #ifde‡
HAS_ALPN


2004 if(
d©a
->
£t
.
s¶_íabÀ_Æ≤
) {

2005 c⁄° * 
√g_¥Ÿocﬁ
;

2006 
Àn
;

2007 
	`SSL_gë0_Æ≤_£À˘ed
(
c⁄ns¶
->
h™dÀ
, &
√g_¥Ÿocﬁ
, &
Àn
);

2008 if(
Àn
 != 0) {

2009 
	`öfof
(
d©a
, "ALPN, sîvîác˚±edÅÿu£ %.*s\n", 
Àn
, 
√g_¥Ÿocﬁ
);

2011 if(
Àn
 =
NGHTTP2_PROTO_VERSION_ID_LEN
 &&

2012 
	`memcmp
(
NGHTTP2_PROTO_VERSION_ID
, 
√g_¥Ÿocﬁ
, 
Àn
) == 0) {

2013 
c⁄n
->
√g≈n
 = 
NPN_HTTP2
;

2015 if(
Àn
 =
ALPN_HTTP_1_1_LENGTH
 && 
	`memcmp
(
ALPN_HTTP_1_1
,

2016 
√g_¥Ÿocﬁ
, 
ALPN_HTTP_1_1_LENGTH
) == 0) {

2017 
c⁄n
->
√g≈n
 = 
NPN_HTTP1_1
;

2021 
	`öfof
(
d©a
, "ALPN, server didÇotágreeÅoáÖrotocol\n");

2026  
CURLE_OK
;

2028 
	}
}

2030 
	$a¢1_obje˘_dump
(
ASN1_OBJECT
 *
a
, *
buf
, 
size_t
 
Àn
)

2032 
i
, 
ûí
;

2034 if((
ûí
 = ()
Àn
) < 0)

2037 
i
 = 
	`i2t_ASN1_OBJECT
(
buf
, 
ûí
, 
a
);

2039 if(
i
 >
ûí
)

2043 
	}
}

2045 
	$pubkey_show
(
Sessi⁄H™dÀ
 *
d©a
,

2046 
num
,

2047 c⁄° *
ty≥
,

2048 c⁄° *
«me
,

2049 *
øw
,

2050 
Àn
)

2052 
size_t
 
À·
;

2053 
i
;

2054 
«mebuf
[32];

2055 *
buf„r
;

2057 
À·
 = 
Àn
*3 + 1;

2058 
buf„r
 = 
	`mÆloc
(
À·
);

2059 if(
buf„r
) {

2060 *
±r
=
buf„r
;

2061 
	`¢¥ötf
(
«mebuf
, “amebuf), "%s(%s)", 
ty≥
, 
«me
);

2062 
i
=0; i< 
Àn
; i++) {

2063 
	`¢¥ötf
(
±r
, 
À·
, "%02x:", 
øw
[
i
]);

2064 
±r
 += 3;

2065 
À·
 -= 3;

2067 
	`öfof
(
d©a
, " %s: %s\n", 
«mebuf
, 
buf„r
);

2068 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
num
, 
«mebuf
, 
buf„r
);

2069 
	`‰ì
(
buf„r
);

2071 
	}
}

2073 
	#¥öt_pubkey_BN
(
_ty≥
, 
_«me
, 
_num
) \

2075 if(
pubkey
->
pkey
.
_ty≥
->
_«me
 !
NULL
) { \

2076 
Àn
 = 
	`BN_num_byãs
(
pubkey
->
pkey
.
_ty≥
->
_«me
); \

2077 if(
Àn
 < 
CERTBUFFERSIZE
) { \

2078 
	`BN_bn2bö
(
pubkey
->
pkey
.
_ty≥
->
_«me
, (*)
buÂ
); \

2079 
buÂ
[
Àn
] = 0; \

2080 
	`pubkey_show
(
d©a
, 
_num
, #_ty≥, #_«me, (*)
buÂ
, 
Àn
); \

2083 } 
WHILE_FALSE


	)

2085 
X509V3_ext
(
Sessi⁄H™dÀ
 *
d©a
,

2086 
˚πnum
,

2087 
STACK_OF
(
X509_EXTENSION
Ë*
exts
)

2089 
	gi
;

2090 
size_t
 
	gj
;

2092 if(
sk_X509_EXTENSION_num
(
exts
) <= 0)

2096 
	gi
=0; i<
sk_X509_EXTENSION_num
(
exts
); i++) {

2097 
ASN1_OBJECT
 *
	gobj
;

2098 
X509_EXTENSION
 *
	gext
 = 
sk_X509_EXTENSION_vÆue
(
exts
, 
i
);

2099 
BUF_MEM
 *
	gbiomem
;

2100 
	gbuf
[512];

2101 *
	g±r
=
buf
;

2102 
	g«mebuf
[128];

2103 
BIO
 *
	gbio_out
 = 
BIO_√w
(
BIO_s_mem
());

2105 if(!
	gbio_out
)

2108 
	gobj
 = 
X509_EXTENSION_gë_obje˘
(
ext
);

2110 
a¢1_obje˘_dump
(
obj
, 
«mebuf
, (namebuf));

2112 
öfof
(
d©a
, "%s: %s\n", 
«mebuf
,

2113 
X509_EXTENSION_gë_¸ôiˇl
(
ext
)?"(critical)":"");

2115 if(!
X509V3_EXT_¥öt
(
bio_out
, 
ext
, 0, 0))

2116 
M_ASN1_OCTET_STRING_¥öt
(
bio_out
, 
ext
->
vÆue
);

2118 
BIO_gë_mem_±r
(
bio_out
, &
biomem
);

2123 
	gj
=0; j<(
	gsize_t
)
	gbiomem
->
	gÀngth
; j++) {

2124 c⁄° *
	g£p
="";

2125 if(
	gbiomem
->
	gd©a
[
j
] == '\n') {

2126 
£p
=", ";

2127 
	gj
++;

2129 (
	gj
<(
	gsize_t
)
	gbiomem
->
	gÀngth
Ë&& (biomem->
	gd©a
[
j
] == ' '))

2130 
j
++;

2131 if(
	gj
<(
	gsize_t
)
	gbiomem
->
	gÀngth
)

2132 
	g±r
+=
¢¥ötf
(
±r
, (
buf
)-’å-buf), "%s%c", 
£p
,

2133 
biomem
->
d©a
[
j
]);

2135 
öfof
(
d©a
, " %s\n", 
buf
);

2137 
Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, 
«mebuf
, 
buf
);

2139 
BIO_‰ì
(
bio_out
);

2146 
	$X509_sig«tuª
(
Sessi⁄H™dÀ
 *
d©a
,

2147 
num˚π
,

2148 
ASN1_STRING
 *
sig
)

2150 
buf
[1024];

2151 *
±r
 = 
buf
;

2152 
i
;

2153 
i
=0; i<
sig
->
Àngth
; i++)

2154 
±r
+=
	`¢¥ötf
’å, (
buf
)-’å-buf), "%02x:", 
sig
->
d©a
[
i
]);

2156 
	`öfof
(
d©a
, " Sig«tuª: %s\n", 
buf
);

2157 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
num˚π
, "Sig«tuª", 
buf
);

2158 
	}
}

2160 
	$dump˚π
(
Sessi⁄H™dÀ
 *
d©a
, 
X509
 *
x
, 
num˚π
)

2162 
BIO
 *
bio_out
 = 
	`BIO_√w
(
	`BIO_s_mem
());

2163 
BUF_MEM
 *
biomem
;

2167 
	`PEM_wrôe_bio_X509
(
bio_out
, 
x
);

2169 
	`BIO_gë_mem_±r
(
bio_out
, &
biomem
);

2171 
	`Cuæ_s¶_push_˚πöfo_Àn
(
d©a
, 
num˚π
,

2172 "Cît", 
biomem
->
d©a
, biomem->
Àngth
);

2174 
	`BIO_‰ì
(
bio_out
);

2176 
	}
}

2183 
	#CERTBUFFERSIZE
 8192

	)

2185 
CURLcode
 
	$gë_˚π_chaö
(
c⁄√˘d©a
 *
c⁄n
,

2186 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
)

2189 
	`STACK_OF
(
X509
Ë*
sk
;

2190 
i
;

2191 *
buÂ
;

2192 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2193 
num˚πs
;

2195 
buÂ
 = 
	`mÆloc
(
CERTBUFFERSIZE
);

2196 if(!
buÂ
)

2197  
CURLE_OUT_OF_MEMORY
;

2199 
sk
 = 
	`SSL_gë_≥î_˚π_chaö
(
c⁄ns¶
->
h™dÀ
);

2200 if(!
sk
) {

2201 
	`‰ì
(
buÂ
);

2202  
CURLE_OUT_OF_MEMORY
;

2205 
num˚πs
 = 
	`sk_X509_num
(
sk
);

2206 if(
	`Cuæ_s¶_öô_˚πöfo
(
d©a
, 
num˚πs
)) {

2207 
	`‰ì
(
buÂ
);

2208  
CURLE_OUT_OF_MEMORY
;

2211 
	`öfof
(
d©a
, "--- Certificate chain\n");

2212 
i
=0; i<
num˚πs
; i++) {

2213 
vÆue
;

2214 
ASN1_INTEGER
 *
num
;

2215 
ASN1_TIME
 *
˚πd©e
;

2219 
X509
 *
x
 = 
	`sk_X509_vÆue
(
sk
, 
num˚πs
 - 
i
 - 1);

2221 
X509
 *
x
 = 
	`sk_X509_vÆue
(
sk
, 
i
);

2224 
X509_CINF
 *
cöf
;

2225 
EVP_PKEY
 *
pubkey
=
NULL
;

2226 
j
;

2227 *
±r
;

2229 ()
	`x509_«me_⁄ñöe
(
	`X509_gë_subje˘_«me
(
x
), 
buÂ
, 
CERTBUFFERSIZE
);

2230 
	`öfof
(
d©a
, "%2d Subje˘: %s\n", 
i
, 
buÂ
);

2231 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
i
, "Subje˘", 
buÂ
);

2233 ()
	`x509_«me_⁄ñöe
(
	`X509_gë_issuî_«me
(
x
), 
buÂ
, 
CERTBUFFERSIZE
);

2234 
	`öfof
(
d©a
, " Issuî: %s\n", 
buÂ
);

2235 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
i
, "Issuî", 
buÂ
);

2237 
vÆue
 = 
	`X509_gë_vîsi⁄
(
x
);

2238 
	`öfof
(
d©a
, " Vîsi⁄: %lu (0x%lx)\n", 
vÆue
+1, value);

2239 
	`¢¥ötf
(
buÂ
, 
CERTBUFFERSIZE
, "%lx", 
vÆue
);

2240 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
i
, "Vîsi⁄", 
buÂ
);

2242 
num
=
	`X509_gë_£rülNumbî
(
x
);

2243 if(
num
->
Àngth
 <= 4) {

2244 
vÆue
 = 
	`ASN1_INTEGER_gë
(
num
);

2245 
	`öfof
(
d©a
," Sîü»Numbî: %ld (0x%lx)\n", 
vÆue
, value);

2246 
	`¢¥ötf
(
buÂ
, 
CERTBUFFERSIZE
, "%lx", 
vÆue
);

2249 
À·
 = 
CERTBUFFERSIZE
;

2251 
±r
 = 
buÂ
;

2252 *
±r
++ = 0;

2253 if(
num
->
ty≥
 =
V_ASN1_NEG_INTEGER
)

2254 *
±r
++='-';

2256 
j
=0; (j<
num
->
Àngth
Ë&& (
À·
>=4); j++) {

2258 
	`¢¥ötf
(
±r
, 3, "%02x%c",
num
->
d©a
[
j
],

2259 ((
j
+1 =
num
->
Àngth
)?'\n':':'));

2260 
±r
 += 3;

2261 
À·
-=4;

2263 if(
num
->
Àngth
)

2264 
	`öfof
(
d©a
," Sîü»Numbî: %s\n", 
buÂ
);

2266 
buÂ
[0]=0;

2268 if(
buÂ
[0])

2269 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
i
, "Sîü»Numbî", 
buÂ
);

2271 
cöf
 = 
x
->
˚π_öfo
;

2273 
j
 = 
	`a¢1_obje˘_dump
(
cöf
->
sig«tuª
->
Æg‹ôhm
, 
buÂ
, 
CERTBUFFERSIZE
);

2274 if(!
j
) {

2275 
	`öfof
(
d©a
, " Sig«tuª Alg‹ôhm: %s\n", 
buÂ
);

2276 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
i
, "Sig«tuª Alg‹ôhm", 
buÂ
);

2279 
˚πd©e
 = 
	`X509_gë_nŸBef‹e
(
x
);

2280 
	`a¢1_ouçut
(
˚πd©e
, 
buÂ
, 
CERTBUFFERSIZE
);

2281 
	`öfof
(
d©a
, " Sèπ d©e: %s\n", 
buÂ
);

2282 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
i
, "Sèπ d©e", 
buÂ
);

2284 
˚πd©e
 = 
	`X509_gë_nŸA·î
(
x
);

2285 
	`a¢1_ouçut
(
˚πd©e
, 
buÂ
, 
CERTBUFFERSIZE
);

2286 
	`öfof
(
d©a
, " Expúêd©e: %s\n", 
buÂ
);

2287 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
i
, "Expúêd©e", 
buÂ
);

2289 
j
 = 
	`a¢1_obje˘_dump
(
cöf
->
key
->
Æg‹
->
Æg‹ôhm
, 
buÂ
, 
CERTBUFFERSIZE
);

2290 if(!
j
) {

2291 
	`öfof
(
d©a
, " Publi¯Key Alg‹ôhm: %s\n", 
buÂ
);

2292 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
i
, "Publi¯Key Alg‹ôhm", 
buÂ
);

2295 
pubkey
 = 
	`X509_gë_pubkey
(
x
);

2296 if(!
pubkey
)

2297 
	`öfof
(
d©a
, " UnableÅoÜoadÖublic key\n");

2299 
pubkey
->
ty≥
) {

2300 
EVP_PKEY_RSA
:

2301 
	`öfof
(
d©a
, " RSA Public Key (%d bits)\n",

2302 
	`BN_num_bôs
(
pubkey
->
pkey
.
rß
->
n
));

2303 
	`¢¥ötf
(
buÂ
, 
CERTBUFFERSIZE
, "%d", 
	`BN_num_bôs
(
pubkey
->
pkey
.
rß
->
n
));

2304 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
i
, "RSA Publi¯Key", 
buÂ
);

2306 
	`¥öt_pubkey_BN
(
rß
, 
n
, 
i
);

2307 
	`¥öt_pubkey_BN
(
rß
, 
e
, 
i
);

2308 
	`¥öt_pubkey_BN
(
rß
, 
d
, 
i
);

2309 
	`¥öt_pubkey_BN
(
rß
, 
p
, 
i
);

2310 
	`¥öt_pubkey_BN
(
rß
, 
q
, 
i
);

2311 
	`¥öt_pubkey_BN
(
rß
, 
dmp1
, 
i
);

2312 
	`¥öt_pubkey_BN
(
rß
, 
dmq1
, 
i
);

2313 
	`¥öt_pubkey_BN
(
rß
, 
iqmp
, 
i
);

2315 
EVP_PKEY_DSA
:

2316 
	`¥öt_pubkey_BN
(
dß
, 
p
, 
i
);

2317 
	`¥öt_pubkey_BN
(
dß
, 
q
, 
i
);

2318 
	`¥öt_pubkey_BN
(
dß
, 
g
, 
i
);

2319 
	`¥öt_pubkey_BN
(
dß
, 
¥iv_key
, 
i
);

2320 
	`¥öt_pubkey_BN
(
dß
, 
pub_key
, 
i
);

2322 
EVP_PKEY_DH
:

2323 
	`¥öt_pubkey_BN
(
dh
, 
p
, 
i
);

2324 
	`¥öt_pubkey_BN
(
dh
, 
g
, 
i
);

2325 
	`¥öt_pubkey_BN
(
dh
, 
¥iv_key
, 
i
);

2326 
	`¥öt_pubkey_BN
(
dh
, 
pub_key
, 
i
);

2329 
EVP_PKEY_EC
:

2334 
	`EVP_PKEY_‰ì
(
pubkey
);

2337 
	`X509V3_ext
(
d©a
, 
i
, 
cöf
->
exãnsi⁄s
);

2339 
	`X509_sig«tuª
(
d©a
, 
i
, 
x
->
sig«tuª
);

2341 
	`dump˚π
(
d©a
, 
x
, 
i
);

2344 
	`‰ì
(
buÂ
);

2346  
CURLE_OK
;

2347 
	}
}

2357 
CURLcode
 
	$£rvî˚π
(
c⁄√˘d©a
 *
c⁄n
,

2358 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
,

2359 
boﬁ
 
°ri˘
)

2361 
CURLcode
 
ªtcode
 = 
CURLE_OK
;

2362 
rc
;

2363 
Àº
;

2364 
ASN1_TIME
 *
˚πd©e
;

2365 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2366 
X509
 *
issuî
;

2367 
FILE
 *
Â
;

2368 *
buf„r
 = 
d©a
->
°©e
.buffer;

2370 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

2372 ()
	`gë_˚π_chaö
(
c⁄n
, 
c⁄ns¶
);

2374 
c⁄ns¶
->
£rvî_˚π
 = 
	`SSL_gë_≥î_˚πifiˇã
(c⁄ns¶->
h™dÀ
);

2375 if(!
c⁄ns¶
->
£rvî_˚π
) {

2376 if(
°ri˘
)

2377 
	`Áûf
(
d©a
, "SSL: couldn't getÖeer certificate!");

2378  
CURLE_PEER_FAILED_VERIFICATION
;

2380 
	`öfof
 (
d©a
, "Server certificate:\n");

2382 
rc
 = 
	`x509_«me_⁄ñöe
(
	`X509_gë_subje˘_«me
(
c⁄ns¶
->
£rvî_˚π
),

2383 
buf„r
, 
BUFSIZE
);

2384 
	`öfof
(
d©a
, "\àsubje˘: %s\n", 
rc
?"[NONE]":
buf„r
);

2386 
˚πd©e
 = 
	`X509_gë_nŸBef‹e
(
c⁄ns¶
->
£rvî_˚π
);

2387 
	`a¢1_ouçut
(
˚πd©e
, 
buf„r
, 
BUFSIZE
);

2388 
	`öfof
(
d©a
, "\à°¨àd©e: %s\n", 
buf„r
);

2390 
˚πd©e
 = 
	`X509_gë_nŸA·î
(
c⁄ns¶
->
£rvî_˚π
);

2391 
	`a¢1_ouçut
(
˚πd©e
, 
buf„r
, 
BUFSIZE
);

2392 
	`öfof
(
d©a
, "\àexpúêd©e: %s\n", 
buf„r
);

2394 if(
d©a
->
£t
.
s¶
.
vîifyho°
) {

2395 
ªtcode
 = 
	`vîifyho°
(
c⁄n
, 
c⁄ns¶
->
£rvî_˚π
);

2396 if(
ªtcode
) {

2397 
	`X509_‰ì
(
c⁄ns¶
->
£rvî_˚π
);

2398 
c⁄ns¶
->
£rvî_˚π
 = 
NULL
;

2399  
ªtcode
;

2403 
rc
 = 
	`x509_«me_⁄ñöe
(
	`X509_gë_issuî_«me
(
c⁄ns¶
->
£rvî_˚π
),

2404 
buf„r
, 
BUFSIZE
);

2405 if(
rc
) {

2406 if(
°ri˘
)

2407 
	`Áûf
(
d©a
, "SSL: couldn't get X509-issuerÇame!");

2408 
ªtcode
 = 
CURLE_SSL_CONNECT_ERROR
;

2411 
	`öfof
(
d©a
, "\àissuî: %s\n", 
buf„r
);

2417 if(
d©a
->
£t
.
°r
[
STRING_SSL_ISSUERCERT
]) {

2418 
Â
=
	`f›í
(
d©a
->
£t
.
°r
[
STRING_SSL_ISSUERCERT
],"r");

2419 if(!
Â
) {

2420 if(
°ri˘
)

2421 
	`Áûf
(
d©a
, "SSL: UnableÅo open issuer cert (%s)",

2422 
d©a
->
£t
.
°r
[
STRING_SSL_ISSUERCERT
]);

2423 
	`X509_‰ì
(
c⁄ns¶
->
£rvî_˚π
);

2424 
c⁄ns¶
->
£rvî_˚π
 = 
NULL
;

2425  
CURLE_SSL_ISSUER_ERROR
;

2427 
issuî
 = 
	`PEM_ªad_X509
(
Â
,
NULL
,
ZERO_NULL
,NULL);

2428 if(!
issuî
) {

2429 if(
°ri˘
)

2430 
	`Áûf
(
d©a
, "SSL: UnableÅoÑead issuer cert (%s)",

2431 
d©a
->
£t
.
°r
[
STRING_SSL_ISSUERCERT
]);

2432 
	`X509_‰ì
(
c⁄ns¶
->
£rvî_˚π
);

2433 
	`X509_‰ì
(
issuî
);

2434 
	`f˛o£
(
Â
);

2435  
CURLE_SSL_ISSUER_ERROR
;

2437 
	`f˛o£
(
Â
);

2438 if(
	`X509_check_issued
(
issuî
,
c⁄ns¶
->
£rvî_˚π
Ë!
X509_V_OK
) {

2439 if(
°ri˘
)

2440 
	`Áûf
(
d©a
, "SSL: Certificate issuer check failed (%s)",

2441 
d©a
->
£t
.
°r
[
STRING_SSL_ISSUERCERT
]);

2442 
	`X509_‰ì
(
c⁄ns¶
->
£rvî_˚π
);

2443 
	`X509_‰ì
(
issuî
);

2444 
c⁄ns¶
->
£rvî_˚π
 = 
NULL
;

2445  
CURLE_SSL_ISSUER_ERROR
;

2447 
	`öfof
(
d©a
, "\t SSL certificate issuer check ok (%s)\n",

2448 
d©a
->
£t
.
°r
[
STRING_SSL_ISSUERCERT
]);

2449 
	`X509_‰ì
(
issuî
);

2452 
Àº
 = 
d©a
->
£t
.
s¶
.
˚πvîifyªsu…
=

2453 
	`SSL_gë_vîify_ªsu…
(
c⁄ns¶
->
h™dÀ
);

2454 if(
d©a
->
£t
.
s¶
.
˚πvîifyªsu…
 !
X509_V_OK
) {

2455 if(
d©a
->
£t
.
s¶
.
vîify≥î
) {

2458 if(
°ri˘
)

2459 
	`Áûf
(
d©a
, "SSL certificate verifyÑesult: %s (%ld)",

2460 
	`X509_vîify_˚π_îr‹_°rög
(
Àº
),Üerr);

2461 
ªtcode
 = 
CURLE_PEER_FAILED_VERIFICATION
;

2464 
	`öfof
(
d©a
, "\t SSL certificate verifyÑesult: %s (%ld),"

2466 
	`X509_vîify_˚π_îr‹_°rög
(
Àº
),Üerr);

2469 
	`öfof
(
d©a
, "\t SSL certificate verify ok.\n");

2472 
	`X509_‰ì
(
c⁄ns¶
->
£rvî_˚π
);

2473 
c⁄ns¶
->
£rvî_˚π
 = 
NULL
;

2474 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_d⁄e
;

2476  
ªtcode
;

2477 
	}
}

2480 
CURLcode


2481 
	$os¶_c⁄√˘_°ï3
(
c⁄√˘d©a
 *
c⁄n
,

2482 
socködex
)

2484 
CURLcode
 
ªtcode
 = 
CURLE_OK
;

2485 *
ﬁd_s¶_£ssi⁄id
=
NULL
;

2486 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2487 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

2488 
öˇche
;

2489 
SSL_SESSION
 *
our_s¶_£ssi⁄id
;

2491 
	`DEBUGASSERT
(
s¶_c⁄√˘_3
 =
c⁄ns¶
->
c⁄√˘ög_°©e
);

2493 #ifde‡
HAVE_SSL_GET1_SESSION


2494 
our_s¶_£ssi⁄id
 = 
	`SSL_gë1_£ssi⁄
(
c⁄ns¶
->
h™dÀ
);

2501 
our_s¶_£ssi⁄id
 = 
	`SSL_gë_£ssi⁄
(
c⁄ns¶
->
h™dÀ
);

2513 
öˇche
 = !(
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, &
ﬁd_s¶_£ssi⁄id
, 
NULL
));

2514 if(
öˇche
) {

2515 if(
ﬁd_s¶_£ssi⁄id
 !
our_s¶_£ssi⁄id
) {

2516 
	`öfof
(
d©a
, "old SSL session ID is stale,Ñemoving\n");

2517 
	`Cuæ_s¶_dñ£ssi⁄id
(
c⁄n
, 
ﬁd_s¶_£ssi⁄id
);

2518 
öˇche
 = 
FALSE
;

2521 if(!
öˇche
) {

2522 
ªtcode
 = 
	`Cuæ_s¶_add£ssi⁄id
(
c⁄n
, 
our_s¶_£ssi⁄id
,

2524 if(
ªtcode
) {

2525 
	`Áûf
(
d©a
, "failedÅo store ssl session");

2526  
ªtcode
;

2529 #ifde‡
HAVE_SSL_GET1_SESSION


2535 
	`SSL_SESSION_‰ì
(
our_s¶_£ssi⁄id
);

2546 if(!
d©a
->
£t
.
s¶
.
vîify≥î
 && !d©a->£t.s¶.
vîifyho°
)

2547 ()
	`£rvî˚π
(
c⁄n
, 
c⁄ns¶
, 
FALSE
);

2549 
ªtcode
 = 
	`£rvî˚π
(
c⁄n
, 
c⁄ns¶
, 
TRUE
);

2551 if(
CURLE_OK
 =
ªtcode
)

2552 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_d⁄e
;

2553  
ªtcode
;

2554 
	}
}

2556 
Cuæ_ªcv
 
	gos¶_ªcv
;

2557 
Cuæ_£nd
 
	gos¶_£nd
;

2559 
CURLcode


2560 
	$os¶_c⁄√˘_comm⁄
(
c⁄√˘d©a
 *
c⁄n
,

2561 
socködex
,

2562 
boﬁ
 
n⁄blockög
,

2563 
boﬁ
 *
d⁄e
)

2565 
CURLcode
 
ªtcode
;

2566 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

2567 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

2568 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
socködex
];

2569 
timeout_ms
;

2570 
wh©
;

2573 if(
s¶_c⁄√˘i⁄_com∂ëe
 =
c⁄ns¶
->
°©e
) {

2574 *
d⁄e
 = 
TRUE
;

2575  
CURLE_OK
;

2578 if(
s¶_c⁄√˘_1
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

2580 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

2582 if(
timeout_ms
 < 0) {

2584 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

2585  
CURLE_OPERATION_TIMEDOUT
;

2587 
ªtcode
 = 
	`os¶_c⁄√˘_°ï1
(
c⁄n
, 
socködex
);

2588 if(
ªtcode
)

2589  
ªtcode
;

2592 
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

2593 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

2594 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
) {

2597 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

2599 if(
timeout_ms
 < 0) {

2601 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

2602  
CURLE_OPERATION_TIMEDOUT
;

2606 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_ªadög


2607 || 
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_wrôög
) {

2609 
cuæ_sockë_t
 
wrôefd
 = 
s¶_c⁄√˘_2_wrôög
==

2610 
c⁄ns¶
->
c⁄√˘ög_°©e
?
sockfd
:
CURL_SOCKET_BAD
;

2611 
cuæ_sockë_t
 
ªadfd
 = 
s¶_c⁄√˘_2_ªadög
==

2612 
c⁄ns¶
->
c⁄√˘ög_°©e
?
sockfd
:
CURL_SOCKET_BAD
;

2614 
wh©
 = 
	`Cuæ_sockë_ªady
(
ªadfd
, 
wrôefd
, 
n⁄blockög
?0:
timeout_ms
);

2615 if(
wh©
 < 0) {

2617 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

2618  
CURLE_SSL_CONNECT_ERROR
;

2620 if(0 =
wh©
) {

2621 if(
n⁄blockög
) {

2622 *
d⁄e
 = 
FALSE
;

2623  
CURLE_OK
;

2627 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

2628  
CURLE_OPERATION_TIMEDOUT
;

2640 
ªtcode
 = 
	`os¶_c⁄√˘_°ï2
(
c⁄n
, 
socködex
);

2641 if(
ªtcode
 || (
n⁄blockög
 &&

2642 (
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

2643 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

2644 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
)))

2645  
ªtcode
;

2650 if(
s¶_c⁄√˘_3
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

2651 
ªtcode
 = 
	`os¶_c⁄√˘_°ï3
(
c⁄n
, 
socködex
);

2652 if(
ªtcode
)

2653  
ªtcode
;

2656 if(
s¶_c⁄√˘_d⁄e
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

2657 
c⁄ns¶
->
°©e
 = 
s¶_c⁄√˘i⁄_com∂ëe
;

2658 
c⁄n
->
ªcv
[
socködex
] = 
os¶_ªcv
;

2659 
c⁄n
->
£nd
[
socködex
] = 
os¶_£nd
;

2660 *
d⁄e
 = 
TRUE
;

2663 *
d⁄e
 = 
FALSE
;

2666 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

2668  
CURLE_OK
;

2669 
	}
}

2671 
CURLcode


2672 
	$Cuæ_os¶_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

2673 
socködex
,

2674 
boﬁ
 *
d⁄e
)

2676  
	`os¶_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
TRUE
, 
d⁄e
);

2677 
	}
}

2679 
CURLcode


2680 
	$Cuæ_os¶_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

2681 
socködex
)

2683 
CURLcode
 
ªtcode
;

2684 
boﬁ
 
d⁄e
 = 
FALSE
;

2686 
ªtcode
 = 
	`os¶_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
FALSE
, &
d⁄e
);

2687 if(
ªtcode
)

2688  
ªtcode
;

2690 
	`DEBUGASSERT
(
d⁄e
);

2692  
CURLE_OK
;

2693 
	}
}

2695 
boﬁ
 
	$Cuæ_os¶_d©a_≥ndög
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

2696 
c⁄nödex
)

2698 if(
c⁄n
->
s¶
[
c⁄nödex
].
h™dÀ
)

2700  (0 !
	`SSL_≥ndög
(
c⁄n
->
s¶
[
c⁄nödex
].
h™dÀ
)Ë? 
TRUE
 : 
FALSE
;

2702  
FALSE
;

2703 
	}
}

2705 
ssize_t
 
	$os¶_£nd
(
c⁄√˘d©a
 *
c⁄n
,

2706 
socködex
,

2707 c⁄° *
mem
,

2708 
size_t
 
Àn
,

2709 
CURLcode
 *
cuæcode
)

2713 
îr
;

2714 
îr‹_buf„r
[120];

2716 
s¶îr‹
;

2717 
memÀn
;

2718 
rc
;

2720 
	`ERR_˛ór_îr‹
();

2722 
memÀn
 = (
Àn
 > (
size_t
)
INT_MAX
) ? INT_MAX : ()len;

2723 
rc
 = 
	`SSL_wrôe
(
c⁄n
->
s¶
[
socködex
].
h™dÀ
, 
mem
, 
memÀn
);

2725 if(
rc
 <= 0) {

2726 
îr
 = 
	`SSL_gë_îr‹
(
c⁄n
->
s¶
[
socködex
].
h™dÀ
, 
rc
);

2728 
îr
) {

2729 
SSL_ERROR_WANT_READ
:

2730 
SSL_ERROR_WANT_WRITE
:

2734 *
cuæcode
 = 
CURLE_AGAIN
;

2736 
SSL_ERROR_SYSCALL
:

2737 
	`Áûf
(
c⁄n
->
d©a
, "SSL_write()Ñeturned SYSCALL,Érrno = %d",

2738 
SOCKERRNO
);

2739 *
cuæcode
 = 
CURLE_SEND_ERROR
;

2741 
SSL_ERROR_SSL
:

2744 
s¶îr‹
 = 
	`ERR_gë_îr‹
();

2745 
	`Áûf
(
c⁄n
->
d©a
, "SSL_write()Érror: %s",

2746 
	`ERR_îr‹_°rög
(
s¶îr‹
, 
îr‹_buf„r
));

2747 *
cuæcode
 = 
CURLE_SEND_ERROR
;

2751 
	`Áûf
(
c⁄n
->
d©a
, "SSL_wrôe(Ëªtu∫Éº‹ %d", 
îr
);

2752 *
cuæcode
 = 
CURLE_SEND_ERROR
;

2755  (
ssize_t
)
rc
;

2756 
	}
}

2758 
ssize_t
 
	$os¶_ªcv
(
c⁄√˘d©a
 *
c⁄n
,

2759 
num
,

2760 *
buf
,

2761 
size_t
 
buf„rsize
,

2762 
CURLcode
 *
cuæcode
)

2764 
îr‹_buf„r
[120];

2766 
s¶îr‹
;

2767 
ssize_t
 
ƒód
;

2768 
buffsize
;

2770 
	`ERR_˛ór_îr‹
();

2772 
buffsize
 = (
buf„rsize
 > (
size_t
)
INT_MAX
) ? INT_MAX : ()buffersize;

2773 
ƒód
 = (
ssize_t
)
	`SSL_ªad
(
c⁄n
->
s¶
[
num
].
h™dÀ
, 
buf
, 
buffsize
);

2774 if(
ƒód
 <= 0) {

2776 
îr
 = 
	`SSL_gë_îr‹
(
c⁄n
->
s¶
[
num
].
h™dÀ
, ()
ƒód
);

2778 
îr
) {

2779 
SSL_ERROR_NONE
:

2780 
SSL_ERROR_ZERO_RETURN
:

2782 
SSL_ERROR_WANT_READ
:

2783 
SSL_ERROR_WANT_WRITE
:

2785 *
cuæcode
 = 
CURLE_AGAIN
;

2791 
s¶îr‹
 = 
	`ERR_gë_îr‹
();

2792 if((
ƒód
 < 0Ë|| 
s¶îr‹
) {

2795 
	`Áûf
(
c⁄n
->
d©a
, "SSLÑead: %s,Érrno %d",

2796 
	`ERR_îr‹_°rög
(
s¶îr‹
, 
îr‹_buf„r
),

2797 
SOCKERRNO
);

2798 *
cuæcode
 = 
CURLE_RECV_ERROR
;

2803  
ƒód
;

2804 
	}
}

2806 
size_t
 
	$Cuæ_os¶_vîsi⁄
(*
buf„r
, 
size_t
 
size
)

2808 #ifde‡
YASSL_VERSION


2811  
	`¢¥ötf
(
buf„r
, 
size
, "yas¶/%s", 
YASSL_VERSION
);

2814 #if(
SSLEAY_VERSION_NUMBER
 >= 0x905000)

2816 
sub
[2];

2817 
s¶óy_vÆue
;

2818 
sub
[1]='\0';

2819 
s¶óy_vÆue
=
	`SSLóy
();

2820 if(
s¶óy_vÆue
 < 0x906000) {

2821 
s¶óy_vÆue
=
SSLEAY_VERSION_NUMBER
;

2822 
sub
[0]='\0';

2825 if(
s¶óy_vÆue
&0xff0) {

2826 
sub
[0]=()(((
s¶óy_vÆue
>>4)&0xff) + 'a' -1);

2829 
sub
[0]='\0';

2832  
	`¢¥ötf
(
buf„r
, 
size
, "OpenSSL/%lx.%lx.%lx%s",

2833 (
s¶óy_vÆue
>>28)&0xf,

2834 (
s¶óy_vÆue
>>20)&0xff,

2835 (
s¶óy_vÆue
>>12)&0xff,

2836 
sub
);

2841 #if(
SSLEAY_VERSION_NUMBER
 >= 0x900000)

2842  
	`¢¥ötf
(
buf„r
, 
size
, "OpenSSL/%lx.%lx.%lx",

2843 (
SSLEAY_VERSION_NUMBER
>>28)&0xff,

2844 (
SSLEAY_VERSION_NUMBER
>>20)&0xff,

2845 (
SSLEAY_VERSION_NUMBER
>>12)&0xf);

2849 
sub
[2];

2850 
sub
[1]='\0';

2851 if(
SSLEAY_VERSION_NUMBER
&0x0f) {

2852 
sub
[0]=(
SSLEAY_VERSION_NUMBER
&0x0f) + 'a' -1;

2855 
sub
[0]='\0';

2857  
	`¢¥ötf
(
buf„r
, 
size
, "SSL/%x.%x.%x%s",

2858 (
SSLEAY_VERSION_NUMBER
>>12)&0xff,

2859 (
SSLEAY_VERSION_NUMBER
>>8)&0xf,

2860 (
SSLEAY_VERSION_NUMBER
>>4)&0xf, 
sub
);

2866 
	}
}

2868 
	$Cuæ_os¶_øndom
(
Sessi⁄H™dÀ
 *
d©a
, *
íå›y
,

2869 
size_t
 
Àngth
)

2871 
	`Cuæ_os¶_£ed
(
d©a
);

2872 
	`RAND_byãs
(
íå›y
, 
	`cuæx_uztosi
(
Àngth
));

2873 
	}
}

2875 
	$Cuæ_os¶_md5sum
(*
tmp
,

2876 
size_t
 
tm∂í
,

2877 *
md5sum
 ,

2878 
size_t
 
unu£d
)

2880 
MD5_CTX
 
MD5pw
;

2881 ()
unu£d
;

2882 
	`MD5_Inô
(&
MD5pw
);

2883 
	`MD5_Upd©e
(&
MD5pw
, 
tmp
, 
tm∂í
);

2884 
	`MD5_FöÆ
(
md5sum
, &
MD5pw
);

2885 
	}
}

	@lib/vtls/openssl.h

1 #i‚de‡
HEADER_CURL_SSLUSE_H


2 
	#HEADER_CURL_SSLUSE_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
USE_SSLEAY


32 
	~"uæd©a.h
"

34 
CURLcode
 
Cuæ_os¶_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

35 
CURLcode
 
Cuæ_os¶_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

36 
socködex
,

37 
boﬁ
 *
d⁄e
);

40 
Cuæ_os¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

44 
Cuæ_os¶_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
);

47 
CURLcode
 
Cuæ_os¶_£t_ígöe
(
Sessi⁄H™dÀ
 *
d©a
, c⁄° *
ígöe
);

51 
Cuæ_os¶_£ssi⁄_‰ì
(*
±r
);

54 
CURLcode
 
Cuæ_os¶_£t_ígöe_deÁu…
(
Sessi⁄H™dÀ
 *
d©a
);

57 
cuæ_¶i°
 *
Cuæ_os¶_ígöes_li°
(
Sessi⁄H™dÀ
 *
d©a
);

59 
Cuæ_os¶_öô
();

60 
Cuæ_os¶_˛ónup
();

62 
size_t
 
Cuæ_os¶_vîsi⁄
(*
buf„r
, size_à
size
);

63 
Cuæ_os¶_check_cxn
(
c⁄√˘d©a
 *
cxn
);

64 
Cuæ_os¶_£ed
(
Sessi⁄H™dÀ
 *
d©a
);

66 
Cuæ_os¶_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

67 
boﬁ
 
Cuæ_os¶_d©a_≥ndög
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

68 
c⁄nödex
);

69 
Cuæ_os¶_øndom
(
Sessi⁄H™dÀ
 *
d©a
, *
íå›y
,

70 
size_t
 
Àngth
);

71 
Cuæ_os¶_md5sum
(*
tmp
,

72 
size_t
 
tm∂í
,

73 *
md5sum
 ,

74 
size_t
 
unu£d
);

77 
	#have_cuæs¶_øndom
 1

	)

78 
	#have_cuæs¶_md5sum
 1

	)

81 
	#cuæs¶_öô
 
Cuæ_os¶_öô


	)

82 
	#cuæs¶_˛ónup
 
Cuæ_os¶_˛ónup


	)

83 
	#cuæs¶_c⁄√˘
 
Cuæ_os¶_c⁄√˘


	)

84 
	#cuæs¶_c⁄√˘_n⁄blockög
 
Cuæ_os¶_c⁄√˘_n⁄blockög


	)

85 
	#cuæs¶_£ssi⁄_‰ì
(
x
Ë
	`Cuæ_os¶_£ssi⁄_‰ì
(x)

	)

86 
	#cuæs¶_˛o£_Æl
 
Cuæ_os¶_˛o£_Æl


	)

87 
	#cuæs¶_˛o£
 
Cuæ_os¶_˛o£


	)

88 
	#cuæs¶_shutdown
(
x
,
y
Ë
	`Cuæ_os¶_shutdown
(x,y)

	)

89 
	#cuæs¶_£t_ígöe
(
x
,
y
Ë
	`Cuæ_os¶_£t_ígöe
(x,y)

	)

90 
	#cuæs¶_£t_ígöe_deÁu…
(
x
Ë
	`Cuæ_os¶_£t_ígöe_deÁu…
(x)

	)

91 
	#cuæs¶_ígöes_li°
(
x
Ë
	`Cuæ_os¶_ígöes_li°
(x)

	)

92 
	#cuæs¶_vîsi⁄
 
Cuæ_os¶_vîsi⁄


	)

93 
	#cuæs¶_check_cxn
 
Cuæ_os¶_check_cxn


	)

94 
	#cuæs¶_d©a_≥ndög
(
x
,
y
Ë
	`Cuæ_os¶_d©a_≥ndög
(x,y)

	)

95 
	#cuæs¶_øndom
(
x
,
y
,
z
Ë
	`Cuæ_os¶_øndom
(x,y,z)

	)

96 
	#cuæs¶_md5sum
(
a
,
b
,
c
,
d
Ë
	`Cuæ_os¶_md5sum
◊,b,c,d)

	)

98 
	#DEFAULT_CIPHER_SELECTION
 "ALL!EXPORT!EXPORT40!EXPORT56!aNULL!LOW!RC4"

	)

	@lib/vtls/polarssl.c

30 
	~"cuæ_£tup.h
"

32 #ifde‡
USE_POLARSSL


34 
	~<pﬁ¨s¶/√t.h
>

35 
	~<pﬁ¨s¶/s¶.h
>

36 
	~<pﬁ¨s¶/˚πs.h
>

37 
	~<pﬁ¨s¶/x509.h
>

38 
	~<pﬁ¨s¶/vîsi⁄.h
>

40 #i‡
POLARSSL_VERSION_NUMBER
 < 0x01030000

41 #îr‹ 
too
 
ﬁd
 
Pﬁ¨SSL


44 
	~<pﬁ¨s¶/îr‹.h
>

45 
	~<pﬁ¨s¶/íå›y.h
>

46 
	~<pﬁ¨s¶/˘r_drbg.h
>

48 
	~"uæd©a.h
"

49 
	~"£ndf.h
"

50 
	~"öë_±⁄.h
"

51 
	~"pﬁ¨s¶.h
"

52 
	~"vés.h
"

53 
	~"∑r£d©e.h
"

54 
	~"c⁄√˘.h
"

55 
	~"£À˘.h
"

56 
	~"øw°r.h
"

57 
	~"pﬁ¨s¶_thªadlock.h
"

59 
	#_MPRINTF_REPLACE


	)

60 
	~<cuæ/m¥ötf.h
>

61 
	~"cuæ_mem‹y.h
"

63 
	~"memdebug.h
"

66 #i‡
deföed
(
USE_THREADS_POSIX
Ë|| deföed(
USE_THREADS_WIN32
)

67 
	#THREADING_SUPPORT


	)

70 #i‡
deföed
(
THREADING_SUPPORT
)

71 
íå›y_c⁄ãxt
 
	gíå›y
;

73 
	gíå›y_öô_öôülized
 = 0;

76 
	$íå›y_öô_muãx
(
íå›y_c⁄ãxt
 *
˘x
)

79 
	`pﬁ¨s¶thªadlock_lock_fun˘i⁄
(0);

80 if(
íå›y_öô_öôülized
 == 0) {

81 
	`íå›y_öô
(
˘x
);

82 
íå›y_öô_öôülized
 = 1;

84 
	`pﬁ¨s¶thªadlock_u∆ock_fun˘i⁄
(0);

85 
	}
}

89 
	$íå›y_func_muãx
(*
d©a
, *
ouçut
, 
size_t
 
Àn
)

91 
ªt
;

93 
	`pﬁ¨s¶thªadlock_lock_fun˘i⁄
(1);

94 
ªt
 = 
	`íå›y_func
(
d©a
, 
ouçut
, 
Àn
);

95 
	`pﬁ¨s¶thªadlock_u∆ock_fun˘i⁄
(1);

97  
ªt
;

98 
	}
}

104 #unde‡
POLARSSL_DEBUG


106 #ifde‡
POLARSSL_DEBUG


107 
	$pﬁ¨s¶_debug
(*
c⁄ãxt
, 
Àvñ
, c⁄° *
löe
)

109 
Sessi⁄H™dÀ
 *
d©a
 = 
NULL
;

111 if(!
c⁄ãxt
)

114 
d©a
 = (
Sessi⁄H™dÀ
 *)
c⁄ãxt
;

116 
	`öfof
(
d©a
, "%s", 
löe
);

117 (Ë
Àvñ
;

118 
	}
}

123 #ifde‡
USE_NGHTTP2


124 #unde‡
HAS_ALPN


125 #ifde‡
POLARSSL_SSL_ALPN


126 
	#HAS_ALPN


	)

130 
Cuæ_ªcv
 
	gpﬁ¨s¶_ªcv
;

131 
Cuæ_£nd
 
	gpﬁ¨s¶_£nd
;

134 
CURLcode


135 
	$pﬁ¨s¶_c⁄√˘_°ï1
(
c⁄√˘d©a
 *
c⁄n
,

136 
socködex
)

138 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

139 
s¶_c⁄√˘_d©a
* 
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

141 
boﬁ
 
¢i
 = 
TRUE
;

142 
ªt
 = -1;

143 #ifde‡
ENABLE_IPV6


144 
ö6_addr
 
addr
;

146 
ö_addr
 
addr
;

148 *
ﬁd_£ssi⁄
 = 
NULL
;

149 
size_t
 
ﬁd_£ssi⁄_size
 = 0;

150 
îr‹buf
[128];

151 
	`mem£t
(
îr‹buf
, 0, (errorbuf));

154 if(
d©a
->
£t
.
s¶
.
vîsi⁄
 =
CURL_SSLVERSION_SSLv2
) {

155 
	`Áûf
(
d©a
, "PolarSSL doesÇot support SSLv2");

156  
CURLE_SSL_CONNECT_ERROR
;

158 if(
d©a
->
£t
.
s¶
.
vîsi⁄
 =
CURL_SSLVERSION_SSLv3
)

159 
¢i
 = 
FALSE
;

161 #ifde‡
THREADING_SUPPORT


162 
	`íå›y_öô_muãx
(&
íå›y
);

164 if((
ªt
 = 
	`˘r_drbg_öô
(&
c⁄ns¶
->
˘r_drbg
, 
íå›y_func_muãx
, &
íå›y
,

165 
c⁄ns¶
->
s¢
.
id
, c⁄ns¶->s¢.
Àngth
)) != 0) {

166 #ifde‡
POLARSSL_ERROR_C


167 
	`îr‹_°ªº‹
(
ªt
, 
îr‹buf
, (errorbuf));

169 
	`Áûf
(
d©a
, "Failed - PolarSSL: ctr_drbg_initÑeturned (-0x%04X) %s\n",

170 -
ªt
, 
îr‹buf
);

173 
	`íå›y_öô
(&
c⁄ns¶
->
íå›y
);

175 if((
ªt
 = 
	`˘r_drbg_öô
(&
c⁄ns¶
->
˘r_drbg
, 
íå›y_func
, &c⁄ns¶->
íå›y
,

176 
c⁄ns¶
->
s¢
.
id
, c⁄ns¶->s¢.
Àngth
)) != 0) {

177 #ifde‡
POLARSSL_ERROR_C


178 
	`îr‹_°ªº‹
(
ªt
, 
îr‹buf
, (errorbuf));

180 
	`Áûf
(
d©a
, "Failed - PolarSSL: ctr_drbg_initÑeturned (-0x%04X) %s\n",

181 -
ªt
, 
îr‹buf
);

186 
	`mem£t
(&
c⁄ns¶
->
ˇ˚π
, 0, (
x509_¸t
));

188 if(
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]) {

189 
ªt
 = 
	`x509_¸t_∑r£_fûe
(&
c⁄ns¶
->
ˇ˚π
,

190 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
]);

192 if(
ªt
<0) {

193 #ifde‡
POLARSSL_ERROR_C


194 
	`îr‹_°ªº‹
(
ªt
, 
îr‹buf
, (errorbuf));

196 
	`Áûf
(
d©a
, "ErrorÑeading ca cert file %s - PolarSSL: (-0x%04X) %s",

197 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
], -
ªt
, 
îr‹buf
);

199 if(
d©a
->
£t
.
s¶
.
vîify≥î
)

200  
CURLE_SSL_CACERT_BADFILE
;

205 
	`mem£t
(&
c⁄ns¶
->
˛i˚π
, 0, (
x509_¸t
));

207 if(
d©a
->
£t
.
°r
[
STRING_CERT
]) {

208 
ªt
 = 
	`x509_¸t_∑r£_fûe
(&
c⁄ns¶
->
˛i˚π
,

209 
d©a
->
£t
.
°r
[
STRING_CERT
]);

211 if(
ªt
) {

212 #ifde‡
POLARSSL_ERROR_C


213 
	`îr‹_°ªº‹
(
ªt
, 
îr‹buf
, (errorbuf));

215 
	`Áûf
(
d©a
, "ErrorÑeading client cert file %s - PolarSSL: (-0x%04X) %s",

216 
d©a
->
£t
.
°r
[
STRING_CERT
], -
ªt
, 
îr‹buf
);

218  
CURLE_SSL_CERTPROBLEM
;

223 if(
d©a
->
£t
.
°r
[
STRING_KEY
]) {

224 
pk_c⁄ãxt
 
pk
;

225 
	`pk_öô
(&
pk
);

226 
ªt
 = 
	`pk_∑r£_keyfûe
(&
pk
, 
d©a
->
£t
.
°r
[
STRING_KEY
],

227 
d©a
->
£t
.
°r
[
STRING_KEY_PASSWD
]);

228 if(
ªt
 =0 && !
	`pk_ˇn_do
(&
pk
, 
POLARSSL_PK_RSA
))

229 
ªt
 = 
POLARSSL_ERR_PK_TYPE_MISMATCH
;

230 if(
ªt
 == 0)

231 
	`rß_c›y
(&
c⁄ns¶
->
rß
, 
	`pk_rß
(
pk
));

233 
	`rß_‰ì
(&
c⁄ns¶
->
rß
);

234 
	`pk_‰ì
(&
pk
);

236 if(
ªt
) {

237 #ifde‡
POLARSSL_ERROR_C


238 
	`îr‹_°ªº‹
(
ªt
, 
îr‹buf
, (errorbuf));

240 
	`Áûf
(
d©a
, "ErrorÑeadingÖrivate key %s - PolarSSL: (-0x%04X) %s",

241 
d©a
->
£t
.
°r
[
STRING_KEY
], -
ªt
, 
îr‹buf
);

243  
CURLE_SSL_CERTPROBLEM
;

248 
	`mem£t
(&
c⁄ns¶
->
¸l
, 0, (
x509_¸l
));

250 if(
d©a
->
£t
.
°r
[
STRING_SSL_CRLFILE
]) {

251 
ªt
 = 
	`x509_¸l_∑r£_fûe
(&
c⁄ns¶
->
¸l
,

252 
d©a
->
£t
.
°r
[
STRING_SSL_CRLFILE
]);

254 if(
ªt
) {

255 #ifde‡
POLARSSL_ERROR_C


256 
	`îr‹_°ªº‹
(
ªt
, 
îr‹buf
, (errorbuf));

258 
	`Áûf
(
d©a
, "ErrorÑeading CRL file %s - PolarSSL: (-0x%04X) %s",

259 
d©a
->
£t
.
°r
[
STRING_SSL_CRLFILE
], -
ªt
, 
îr‹buf
);

261  
CURLE_SSL_CRL_BADFILE
;

265 
	`öfof
(
d©a
, "PolarSSL: ConnectingÅo %s:%d\n",

266 
c⁄n
->
ho°
.
«me
, c⁄n->
ªmŸe_p‹t
);

268 if(
	`s¶_öô
(&
c⁄ns¶
->
s¶
)) {

269 
	`Áûf
(
d©a
, "PolarSSL: ssl_init failed");

270  
CURLE_SSL_CONNECT_ERROR
;

273 
	`s¶_£t_ídpoöt
(&
c⁄ns¶
->
s¶
, 
SSL_IS_CLIENT
);

274 
	`s¶_£t_authmode
(&
c⁄ns¶
->
s¶
, 
SSL_VERIFY_OPTIONAL
);

276 
	`s¶_£t_∫g
(&
c⁄ns¶
->
s¶
, 
˘r_drbg_øndom
,

277 &
c⁄ns¶
->
˘r_drbg
);

278 
	`s¶_£t_bio
(&
c⁄ns¶
->
s¶
,

279 
√t_ªcv
, &
c⁄n
->
sock
[
socködex
],

280 
√t_£nd
, &
c⁄n
->
sock
[
socködex
]);

282 
	`s¶_£t_cùhîsuôes
(&
c⁄ns¶
->
s¶
, 
	`s¶_li°_cùhîsuôes
());

283 if(!
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, &
ﬁd_£ssi⁄
, &
ﬁd_£ssi⁄_size
)) {

284 
	`mem˝y
(&
c⁄ns¶
->
s¢
, 
ﬁd_£ssi⁄
, 
ﬁd_£ssi⁄_size
);

285 
	`öfof
(
d©a
, "PolarSSLÑe-using session\n");

288 
	`s¶_£t_£ssi⁄
(&
c⁄ns¶
->
s¶
,

289 &
c⁄ns¶
->
s¢
);

291 
	`s¶_£t_ˇ_chaö
(&
c⁄ns¶
->
s¶
,

292 &
c⁄ns¶
->
ˇ˚π
,

293 &
c⁄ns¶
->
¸l
,

294 
c⁄n
->
ho°
.
«me
);

296 
	`s¶_£t_own_˚π_rß
(&
c⁄ns¶
->
s¶
,

297 &
c⁄ns¶
->
˛i˚π
, &c⁄ns¶->
rß
);

299 if(!
	`Cuæ_öë_±⁄
(
AF_INET
, 
c⁄n
->
ho°
.
«me
, &
addr
) &&

300 #ifde‡
ENABLE_IPV6


301 !
	`Cuæ_öë_±⁄
(
AF_INET6
, 
c⁄n
->
ho°
.
«me
, &
addr
) &&

303 
¢i
 && 
	`s¶_£t_ho°«me
(&
c⁄ns¶
->
s¶
, 
c⁄n
->
ho°
.
«me
)) {

304 
	`öfof
(
d©a
, "WARNING: failedÅo configure "

308 #ifde‡
HAS_ALPN


309 if(
d©a
->
£t
.
hâpvîsi⁄
 =
CURL_HTTP_VERSION_2_0
) {

310 if(
d©a
->
£t
.
s¶_íabÀ_Æ≤
) {

311 c⁄° * 
¥Ÿocﬁs
[] = {

312 
NGHTTP2_PROTO_VERSION_ID
, 
ALPN_HTTP_1_1
, 
NULL


314 
	`s¶_£t_Æ≤_¥Ÿocﬁs
(&
c⁄ns¶
->
s¶
, 
¥Ÿocﬁs
);

315 
	`öfof
(
d©a
, "ALPN, of„rög %s, %s\n", 
¥Ÿocﬁs
[0],

316 
¥Ÿocﬁs
[1]);

321 #ifde‡
POLARSSL_DEBUG


322 
	`s¶_£t_dbg
(&
c⁄ns¶
->
s¶
, 
pﬁ¨s¶_debug
, 
d©a
);

325 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2
;

327  
CURLE_OK
;

328 
	}
}

330 
CURLcode


331 
	$pﬁ¨s¶_c⁄√˘_°ï2
(
c⁄√˘d©a
 *
c⁄n
,

332 
socködex
)

334 
ªt
;

335 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

336 
s¶_c⁄√˘_d©a
* 
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

337 
buf„r
[1024];

339 #ifde‡
HAS_ALPN


340 c⁄° * 
√xt_¥Ÿocﬁ
;

343 
îr‹buf
[128];

344 
	`mem£t
(
îr‹buf
, 0, (errorbuf));

346 
c⁄n
->
ªcv
[
socködex
] = 
pﬁ¨s¶_ªcv
;

347 
c⁄n
->
£nd
[
socködex
] = 
pﬁ¨s¶_£nd
;

350 if(!(
ªt
 = 
	`s¶_h™dshake
(&
c⁄ns¶
->
s¶
)))

352 if(
ªt
 !
POLARSSL_ERR_NET_WANT_READ
 &&

353 
ªt
 !
POLARSSL_ERR_NET_WANT_WRITE
) {

354 #ifde‡
POLARSSL_ERROR_C


355 
	`îr‹_°ªº‹
(
ªt
, 
îr‹buf
, (errorbuf));

357 
	`Áûf
(
d©a
, "ssl_handshakeÑeturned - PolarSSL: (-0x%04X) %s",

358 -
ªt
, 
îr‹buf
);

360  
CURLE_SSL_CONNECT_ERROR
;

363 if(
ªt
 =
POLARSSL_ERR_NET_WANT_READ
) {

364 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2_ªadög
;

365  
CURLE_OK
;

367 if(
ªt
 =
POLARSSL_ERR_NET_WANT_WRITE
) {

368 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_2_wrôög
;

369  
CURLE_OK
;

371 
	`Áûf
(
d©a
, "SSL_c⁄√˘ faûed wôhÉº‹ %d.", 
ªt
);

372  
CURLE_SSL_CONNECT_ERROR
;

377 
	`öfof
(
d©a
, "PolarSSL: Handshake complete, cipher is %s\n",

378 
	`s¶_gë_cùhîsuôe
(&
c⁄n
->
s¶
[
socködex
].ssl)

381 
ªt
 = 
	`s¶_gë_vîify_ªsu…
(&
c⁄n
->
s¶
[
socködex
].ssl);

383 if(
ªt
 && 
d©a
->
£t
.
s¶
.
vîify≥î
) {

384 if(
ªt
 & 
BADCERT_EXPIRED
)

385 
	`Áûf
(
d©a
, "Cert verify failed: BADCERT_EXPIRED");

387 if(
ªt
 & 
BADCERT_REVOKED
) {

388 
	`Áûf
(
d©a
, "Cert verify failed: BADCERT_REVOKED");

389  
CURLE_SSL_CACERT
;

392 if(
ªt
 & 
BADCERT_CN_MISMATCH
)

393 
	`Áûf
(
d©a
, "Cert verify failed: BADCERT_CN_MISMATCH");

395 if(
ªt
 & 
BADCERT_NOT_TRUSTED
)

396 
	`Áûf
(
d©a
, "Cert verify failed: BADCERT_NOT_TRUSTED");

398  
CURLE_PEER_FAILED_VERIFICATION
;

401 if(
	`s¶_gë_≥î_˚π
(&(
c⁄ns¶
->
s¶
))) {

403 
	`mem£t
(
buf„r
, 0, (buffer));

405 if(
	`x509_¸t_öfo
(
buf„r
, (buffer), (*)"* ",

406 
	`s¶_gë_≥î_˚π
(&(
c⁄ns¶
->
s¶
))) != -1)

407 
	`öfof
(
d©a
, "Dumpög cîàöfo:\n%s\n", 
buf„r
);

410 #ifde‡
HAS_ALPN


411 if(
d©a
->
£t
.
s¶_íabÀ_Æ≤
) {

412 
√xt_¥Ÿocﬁ
 = 
	`s¶_gë_Æ≤_¥Ÿocﬁ
(&
c⁄ns¶
->
s¶
);

414 if(
√xt_¥Ÿocﬁ
 !
NULL
) {

415 
	`öfof
(
d©a
, "ALPN, sîvîác˚±edÅÿu£ %s\n", 
√xt_¥Ÿocﬁ
);

417 if(
	`°∫cmp
(
√xt_¥Ÿocﬁ
, 
NGHTTP2_PROTO_VERSION_ID
,

418 
NGHTTP2_PROTO_VERSION_ID_LEN
)) {

419 
c⁄n
->
√g≈n
 = 
NPN_HTTP2
;

421 if(
	`°∫cmp
(
√xt_¥Ÿocﬁ
, 
ALPN_HTTP_1_1
, 
ALPN_HTTP_1_1_LENGTH
)) {

422 
c⁄n
->
√g≈n
 = 
NPN_HTTP1_1
;

426 
	`öfof
(
d©a
, "ALPN, server didÇotágreeÅoáÖrotocol\n");

431 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_3
;

432 
	`öfof
(
d©a
, "SSL connected\n");

434  
CURLE_OK
;

435 
	}
}

437 
CURLcode


438 
	$pﬁ¨s¶_c⁄√˘_°ï3
(
c⁄√˘d©a
 *
c⁄n
,

439 
socködex
)

441 
CURLcode
 
ªtcode
 = 
CURLE_OK
;

442 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

443 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

444 *
ﬁd_s¶_£ssi⁄id
 = 
NULL
;

445 
s¶_£ssi⁄
 *
our_s¶_£ssi⁄id
 = &
c⁄n
->
s¶
[
socködex
].
s¢
 ;

446 
öˇche
;

448 
	`DEBUGASSERT
(
s¶_c⁄√˘_3
 =
c⁄ns¶
->
c⁄√˘ög_°©e
);

451 
öˇche
 = !(
	`Cuæ_s¶_gë£ssi⁄id
(
c⁄n
, &
ﬁd_s¶_£ssi⁄id
, 
NULL
));

452 if(
öˇche
) {

453 if(
ﬁd_s¶_£ssi⁄id
 !
our_s¶_£ssi⁄id
) {

454 
	`öfof
(
d©a
, "old SSL session ID is stale,Ñemoving\n");

455 
	`Cuæ_s¶_dñ£ssi⁄id
(
c⁄n
, 
ﬁd_s¶_£ssi⁄id
);

456 
öˇche
 = 
FALSE
;

459 if(!
öˇche
) {

460 *
√w_£ssi⁄
 = 
	`mÆloc
((
s¶_£ssi⁄
));

462 if(
√w_£ssi⁄
) {

463 
	`mem˝y
(
√w_£ssi⁄
, 
our_s¶_£ssi⁄id
,

464 (
s¶_£ssi⁄
));

466 
ªtcode
 = 
	`Cuæ_s¶_add£ssi⁄id
(
c⁄n
, 
√w_£ssi⁄
,

467 (
s¶_£ssi⁄
));

470 
ªtcode
 = 
CURLE_OUT_OF_MEMORY
;

473 if(
ªtcode
) {

474 
	`Áûf
(
d©a
, "failedÅo store ssl session");

475  
ªtcode
;

479 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_d⁄e
;

481  
CURLE_OK
;

482 
	}
}

484 
ssize_t
 
	$pﬁ¨s¶_£nd
(
c⁄√˘d©a
 *
c⁄n
,

485 
socködex
,

486 c⁄° *
mem
,

487 
size_t
 
Àn
,

488 
CURLcode
 *
cuæcode
)

490 
ªt
 = -1;

492 
ªt
 = 
	`s¶_wrôe
(&
c⁄n
->
s¶
[
socködex
].ssl,

493 (*)
mem
, 
Àn
);

495 if(
ªt
 < 0) {

496 *
cuæcode
 = (
ªt
 =
POLARSSL_ERR_NET_WANT_WRITE
) ?

497 
CURLE_AGAIN
 : 
CURLE_SEND_ERROR
;

498 
ªt
 = -1;

501  
ªt
;

502 
	}
}

504 
	$Cuæ_pﬁ¨s¶_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
)

506 ()
d©a
;

507 
	}
}

509 
	$Cuæ_pﬁ¨s¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

511 
	`rß_‰ì
(&
c⁄n
->
s¶
[
socködex
].
rß
);

512 
	`x509_¸t_‰ì
(&
c⁄n
->
s¶
[
socködex
].
˛i˚π
);

513 
	`x509_¸t_‰ì
(&
c⁄n
->
s¶
[
socködex
].
ˇ˚π
);

514 
	`x509_¸l_‰ì
(&
c⁄n
->
s¶
[
socködex
].
¸l
);

515 
	`s¶_‰ì
(&
c⁄n
->
s¶
[
socködex
].ssl);

516 
	}
}

518 
ssize_t
 
	$pﬁ¨s¶_ªcv
(
c⁄√˘d©a
 *
c⁄n
,

519 
num
,

520 *
buf
,

521 
size_t
 
buf„rsize
,

522 
CURLcode
 *
cuæcode
)

524 
ªt
 = -1;

525 
ssize_t
 
Àn
 = -1;

527 
	`mem£t
(
buf
, 0, 
buf„rsize
);

528 
ªt
 = 
	`s¶_ªad
(&
c⁄n
->
s¶
[
num
].s¶, (*)
buf
, 
buf„rsize
);

530 if(
ªt
 <= 0) {

531 if(
ªt
 =
POLARSSL_ERR_SSL_PEER_CLOSE_NOTIFY
)

534 *
cuæcode
 = (
ªt
 =
POLARSSL_ERR_NET_WANT_READ
) ?

535 
CURLE_AGAIN
 : 
CURLE_RECV_ERROR
;

539 
Àn
 = 
ªt
;

541  
Àn
;

542 
	}
}

544 
	$Cuæ_pﬁ¨s¶_£ssi⁄_‰ì
(*
±r
)

546 
	`‰ì
(
±r
);

547 
	}
}

549 
size_t
 
	$Cuæ_pﬁ¨s¶_vîsi⁄
(*
buf„r
, 
size_t
 
size
)

551 
vîsi⁄
 = 
	`vîsi⁄_gë_numbî
();

552  
	`¢¥ötf
(
buf„r
, 
size
, "Pﬁ¨SSL/%d.%d.%d", 
vîsi⁄
>>24,

553 (
vîsi⁄
>>16)&0xff, (version>>8)&0xff);

554 
	}
}

556 
CURLcode


557 
	$pﬁ¨s¶_c⁄√˘_comm⁄
(
c⁄√˘d©a
 *
c⁄n
,

558 
socködex
,

559 
boﬁ
 
n⁄blockög
,

560 
boﬁ
 *
d⁄e
)

562 
CURLcode
 
ªtcode
;

563 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

564 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

565 
cuæ_sockë_t
 
sockfd
 = 
c⁄n
->
sock
[
socködex
];

566 
timeout_ms
;

567 
wh©
;

570 if(
s¶_c⁄√˘i⁄_com∂ëe
 =
c⁄ns¶
->
°©e
) {

571 *
d⁄e
 = 
TRUE
;

572  
CURLE_OK
;

575 if(
s¶_c⁄√˘_1
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

577 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

579 if(
timeout_ms
 < 0) {

581 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

582  
CURLE_OPERATION_TIMEDOUT
;

584 
ªtcode
 = 
	`pﬁ¨s¶_c⁄√˘_°ï1
(
c⁄n
, 
socködex
);

585 if(
ªtcode
)

586  
ªtcode
;

589 
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

590 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

591 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
) {

594 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

596 if(
timeout_ms
 < 0) {

598 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

599  
CURLE_OPERATION_TIMEDOUT
;

603 if(
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_ªadög


604 || 
c⁄ns¶
->
c⁄√˘ög_°©e
 =
s¶_c⁄√˘_2_wrôög
) {

606 
cuæ_sockë_t
 
wrôefd
 = 
s¶_c⁄√˘_2_wrôög
==

607 
c⁄ns¶
->
c⁄√˘ög_°©e
?
sockfd
:
CURL_SOCKET_BAD
;

608 
cuæ_sockë_t
 
ªadfd
 = 
s¶_c⁄√˘_2_ªadög
==

609 
c⁄ns¶
->
c⁄√˘ög_°©e
?
sockfd
:
CURL_SOCKET_BAD
;

611 
wh©
 = 
	`Cuæ_sockë_ªady
(
ªadfd
, 
wrôefd
, 
n⁄blockög
?0:
timeout_ms
);

612 if(
wh©
 < 0) {

614 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

615  
CURLE_SSL_CONNECT_ERROR
;

617 if(0 =
wh©
) {

618 if(
n⁄blockög
) {

619 *
d⁄e
 = 
FALSE
;

620  
CURLE_OK
;

624 
	`Áûf
(
d©a
, "SSL connectionÅimeout");

625  
CURLE_OPERATION_TIMEDOUT
;

638 
ªtcode
 = 
	`pﬁ¨s¶_c⁄√˘_°ï2
(
c⁄n
, 
socködex
);

639 if(
ªtcode
 || (
n⁄blockög
 &&

640 (
s¶_c⁄√˘_2
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

641 
s¶_c⁄√˘_2_ªadög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
 ||

642 
s¶_c⁄√˘_2_wrôög
 =
c⁄ns¶
->
c⁄√˘ög_°©e
)))

643  
ªtcode
;

647 if(
s¶_c⁄√˘_3
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

648 
ªtcode
 = 
	`pﬁ¨s¶_c⁄√˘_°ï3
(
c⁄n
, 
socködex
);

649 if(
ªtcode
)

650  
ªtcode
;

653 if(
s¶_c⁄√˘_d⁄e
==
c⁄ns¶
->
c⁄√˘ög_°©e
) {

654 
c⁄ns¶
->
°©e
 = 
s¶_c⁄√˘i⁄_com∂ëe
;

655 
c⁄n
->
ªcv
[
socködex
] = 
pﬁ¨s¶_ªcv
;

656 
c⁄n
->
£nd
[
socködex
] = 
pﬁ¨s¶_£nd
;

657 *
d⁄e
 = 
TRUE
;

660 *
d⁄e
 = 
FALSE
;

663 
c⁄ns¶
->
c⁄√˘ög_°©e
 = 
s¶_c⁄√˘_1
;

665  
CURLE_OK
;

666 
	}
}

668 
CURLcode


669 
	$Cuæ_pﬁ¨s¶_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

670 
socködex
,

671 
boﬁ
 *
d⁄e
)

673  
	`pﬁ¨s¶_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
TRUE
, 
d⁄e
);

674 
	}
}

677 
CURLcode


678 
	$Cuæ_pﬁ¨s¶_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
,

679 
socködex
)

681 
CURLcode
 
ªtcode
;

682 
boﬁ
 
d⁄e
 = 
FALSE
;

684 
ªtcode
 = 
	`pﬁ¨s¶_c⁄√˘_comm⁄
(
c⁄n
, 
socködex
, 
FALSE
, &
d⁄e
);

685 if(
ªtcode
)

686  
ªtcode
;

688 
	`DEBUGASSERT
(
d⁄e
);

690  
CURLE_OK
;

691 
	}
}

697 
	$pﬁ¨s¶_öô
()

699  
	`pﬁ¨s¶thªadlock_thªad_£tup
();

700 
	}
}

702 
	$pﬁ¨s¶_˛ónup
()

704 ()
	`pﬁ¨s¶thªadlock_thªad_˛ónup
();

705 
	}
}

	@lib/vtls/polarssl.h

1 #i‚de‡
HEADER_CURL_POLARSSL_H


2 
	#HEADER_CURL_POLARSSL_H


	)

24 
	~"cuæ_£tup.h
"

26 #ifde‡
USE_POLARSSL


29 
pﬁ¨s¶_öô
();

30 
pﬁ¨s¶_˛ónup
();

33 
CURLcode
 
Cuæ_pﬁ¨s¶_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

35 
CURLcode
 
Cuæ_pﬁ¨s¶_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

36 
socködex
,

37 
boﬁ
 *
d⁄e
);

41 
Cuæ_pﬁ¨s¶_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
);

44 
Cuæ_pﬁ¨s¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

46 
Cuæ_pﬁ¨s¶_£ssi⁄_‰ì
(*
±r
);

47 
size_t
 
Cuæ_pﬁ¨s¶_vîsi⁄
(*
buf„r
, size_à
size
);

48 
Cuæ_pﬁ¨s¶_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

51 
	#cuæs¶_öô
(Ë
	`pﬁ¨s¶_öô
()

	)

52 
	#cuæs¶_˛ónup
(Ë
	`pﬁ¨s¶_˛ónup
()

	)

53 
	#cuæs¶_c⁄√˘
 
Cuæ_pﬁ¨s¶_c⁄√˘


	)

54 
	#cuæs¶_c⁄√˘_n⁄blockög
 
Cuæ_pﬁ¨s¶_c⁄√˘_n⁄blockög


	)

55 
	#cuæs¶_£ssi⁄_‰ì
(
x
Ë
	`Cuæ_pﬁ¨s¶_£ssi⁄_‰ì
(x)

	)

56 
	#cuæs¶_˛o£_Æl
 
Cuæ_pﬁ¨s¶_˛o£_Æl


	)

57 
	#cuæs¶_˛o£
 
Cuæ_pﬁ¨s¶_˛o£


	)

58 
	#cuæs¶_shutdown
(
x
,
y
Ë0

	)

59 
	#cuæs¶_£t_ígöe
(
x
,
y
Ë(x=x, y=y, 
CURLE_NOT_BUILT_IN
)

	)

60 
	#cuæs¶_£t_ígöe_deÁu…
(
x
Ë(x=x, 
CURLE_NOT_BUILT_IN
)

	)

61 
	#cuæs¶_ígöes_li°
(
x
Ë(x=x, (
cuæ_¶i°
 *)
NULL
)

	)

62 
	#cuæs¶_vîsi⁄
 
Cuæ_pﬁ¨s¶_vîsi⁄


	)

63 
	#cuæs¶_check_cxn
(
x
Ë(x=x, -1)

	)

64 
	#cuæs¶_d©a_≥ndög
(
x
,
y
Ë(x=x, y=y, 0)

	)

	@lib/vtls/polarssl_threadlock.c

23 
	~"cuæ_£tup.h
"

25 #i‡
deföed
(
USE_POLARSSL
) && \

26 (
deföed
(
USE_THREADS_POSIX
Ë|| 
	$deföed
(
USE_THREADS_WIN32
))

28 #i‡
	`deföed
(
USE_THREADS_POSIX
)

29 #ifde‡
HAVE_PTHREAD_H


30 
	~<±hªad.h
>

32 #ñi‡
	`deföed
(
USE_THREADS_WIN32
)

33 #ifde‡
HAVE_PROCESS_H


34 
	~<¥o˚ss.h
>

38 
	~"pﬁ¨s¶_thªadlock.h
"

40 
	#_MPRINTF_REPLACE


	)

41 
	~<cuæ/m¥ötf.h
>

43 
	~"cuæ_mem‹y.h
"

45 
	~"memdebug.h
"

48 
	#NUMT
 2

	)

51 
POLARSSL_MUTEX_T
 *
muãx_buf
 = 
NULL
;

53 
	$pﬁ¨s¶thªadlock_thªad_£tup
()

55 
i
;

56 
ªt
;

58 
muãx_buf
 = 
	`mÆloc
(
NUMT
 * (
POLARSSL_MUTEX_T
));

59 if(!
muãx_buf
)

62 #ifde‡
HAVE_PTHREAD_H


63 
i
 = 0; i < 
NUMT
; i++) {

64 
ªt
 = 
	`±hªad_muãx_öô
(&
muãx_buf
[
i
], 
NULL
);

65 if(
ªt
)

68 #ñi‡
	`deföed
(
HAVE_PROCESS_H
)

69 
i
 = 0; i < 
NUMT
; i++) {

70 
muãx_buf
[
i
] = 
	`Cª©eMuãx
(0, 
FALSE
, 0);

71 if(
muãx_buf
[
i
] == 0)

77 
	}
}

79 
	$pﬁ¨s¶thªadlock_thªad_˛ónup
()

81 
i
;

82 
ªt
;

84 if(!
muãx_buf
)

87 #ifde‡
HAVE_PTHREAD_H


88 
i
 = 0; i < 
NUMT
; i++) {

89 
ªt
 = 
	`±hªad_muãx_de°roy
(&
muãx_buf
[
i
]);

90 if(
ªt
)

93 #ñi‡
	`deföed
(
HAVE_PROCESS_H
)

94 
i
 = 0; i < 
NUMT
; i++) {

95 
ªt
 = 
	`Clo£H™dÀ
(
muãx_buf
[
i
]);

96 if(!
ªt
)

100 
	`‰ì
(
muãx_buf
);

101 
muãx_buf
 = 
NULL
;

104 
	}
}

106 
	$pﬁ¨s¶thªadlock_lock_fun˘i⁄
(
n
)

108 
ªt
;

109 #ifde‡
HAVE_PTHREAD_H


110 if(
n
 < 
NUMT
) {

111 
ªt
 = 
	`±hªad_muãx_lock
(&
muãx_buf
[
n
]);

112 if(
ªt
) {

113 
	`DEBUGF
(
	`Ârötf
(
°dîr
,

118 #ñi‡
	`deföed
(
HAVE_PROCESS_H
)

119 if(
n
 < 
NUMT
) {

120 
ªt
 = (
	`WaôF‹SögÀObje˘
(
muãx_buf
[
n
], 
INFINITE
)==
WAIT_FAILED
?1:0);

121 if(
ªt
) {

122 
	`DEBUGF
(
	`Ârötf
(
°dîr
,

129 
	}
}

131 
	$pﬁ¨s¶thªadlock_u∆ock_fun˘i⁄
(
n
)

133 
ªt
;

134 #ifde‡
HAVE_PTHREAD_H


135 if(
n
 < 
NUMT
) {

136 
ªt
 = 
	`±hªad_muãx_u∆ock
(&
muãx_buf
[
n
]);

137 if(
ªt
) {

138 
	`DEBUGF
(
	`Ârötf
(
°dîr
,

143 #ñi‡
	`deföed
(
HAVE_PROCESS_H
)

144 if(
n
 < 
NUMT
) {

145 
ªt
 = 
	`Rñó£Muãx
(
muãx_buf
[
n
]);

146 if(!
ªt
) {

147 
	`DEBUGF
(
	`Ârötf
(
°dîr
,

154 
	}
}

	@lib/vtls/polarssl_threadlock.h

1 #i‚de‡
HEADER_CURL_POLARSSL_THREADLOCK_H


2 
	#HEADER_CURL_POLARSSL_THREADLOCK_H


	)

25 
	~"cuæ_£tup.h
"

27 #ifde‡
USE_POLARSSL


29 #i‡
deföed
(
USE_THREADS_POSIX
)

30 
	#POLARSSL_MUTEX_T
 
±hªad_muãx_t


	)

31 #ñi‡
deföed
(
USE_THREADS_WIN32
)

32 
	#POLARSSL_MUTEX_T
 
HANDLE


	)

35 #i‡
deföed
(
USE_THREADS_POSIX
Ë|| deföed(
USE_THREADS_WIN32
)

37 
pﬁ¨s¶thªadlock_thªad_£tup
();

38 
pﬁ¨s¶thªadlock_thªad_˛ónup
();

39 
pﬁ¨s¶thªadlock_lock_fun˘i⁄
(
n
);

40 
pﬁ¨s¶thªadlock_u∆ock_fun˘i⁄
(
n
);

44 
	#pﬁ¨s¶thªadlock_thªad_£tup
(Ë1

	)

45 
	#pﬁ¨s¶thªadlock_thªad_˛ónup
(Ë1

	)

46 
	#pﬁ¨s¶thªadlock_lock_fun˘i⁄
(
x
Ë1

	)

47 
	#pﬁ¨s¶thªadlock_u∆ock_fun˘i⁄
(
x
Ë1

	)

	@lib/vtls/qssl.c

23 
	~"cuæ_£tup.h
"

25 #ifde‡
USE_QSOSSL


27 
	~<qsos¶.h
>

29 #ifde‡
HAVE_LIMITS_H


30 
	~<limôs.h
>

33 
	~<cuæ/cuæ.h
>

34 
	~"uæd©a.h
"

35 
	~"£ndf.h
"

36 
	~"qs¶.h
"

37 
	~"vés.h
"

38 
	~"c⁄√˘.h
"

39 
	~"£À˘.h
"

40 
	~"x509a¢1.h
"

41 
	~"cuæ_mem‹y.h
"

43 
	~"memdebug.h
"

46 
	$Cuæ_qsos¶_öô
()

54 
	}
}

57 
	$Cuæ_qsos¶_˛ónup
()

61 
	}
}

64 
CURLcode
 
	$Cuæ_qsos¶_öô_£ssi⁄
(
Sessi⁄H™dÀ
 * 
d©a
)

67 
rc
;

68 * 
˚π«me
;

69 
SSLInô
 
öô°r
;

70 
SSLInôAµ
 
öô≠p°r
;

84 
˚π«me
 = 
d©a
->
£t
.
°r
[
STRING_CERT
];

86 if(!
˚π«me
) {

87 
˚π«me
 = 
d©a
->
£t
.
°r
[
STRING_SSL_CAFILE
];

89 if(!
˚π«me
)

90  
CURLE_OK
;

93 
	`mem£t
((*Ë&
öô≠p°r
, 0,  initappstr);

94 
öô≠p°r
.
≠∂iˇti⁄ID
 = 
˚π«me
;

95 
öô≠p°r
.
≠∂iˇti⁄IDLí
 = 
	`°æí
(
˚π«me
);

96 
öô≠p°r
.
¥Ÿocﬁ
 = 
SSL_VERSION_CURRENT
;

97 
öô≠p°r
.
£ssi⁄Ty≥
 = 
SSL_REGISTERED_AS_CLIENT
;

98 
rc
 = 
	`SSL_Inô_Aµliˇti⁄
(&
öô≠p°r
);

100 if(
rc
 =
SSL_ERROR_NOT_REGISTERED
) {

101 
öô°r
.
keyrögFûeName
 = 
˚π«me
;

102 
öô°r
.
keyrögPassw‹d
 = 
d©a
->
£t
.
°r
[
STRING_KEY
];

103 
öô°r
.
cùhîSuôeLi°
 = 
NULL
;

104 
öô°r
.
cùhîSuôeLi°Lí
 = 0;

105 
rc
 = 
	`SSL_Inô
(&
öô°r
);

108 
rc
) {

113 
SSL_ERROR_IO
:

114 
	`Áûf
(
d©a
, "SSL_Inô(ËI/OÉº‹: %s", 
	`°ªº‹
(
î∫o
));

115  
CURLE_SSL_CONNECT_ERROR
;

117 
SSL_ERROR_BAD_CIPHER_SUITE
:

118  
CURLE_SSL_CIPHER
;

120 
SSL_ERROR_KEYPASSWORD_EXPIRED
:

121 
SSL_ERROR_NOT_REGISTERED
:

122  
CURLE_SSL_CONNECT_ERROR
;

124 
SSL_ERROR_NO_KEYRING
:

125  
CURLE_SSL_CACERT
;

127 
SSL_ERROR_CERT_EXPIRED
:

128  
CURLE_SSL_CERTPROBLEM
;

131 
	`Áûf
(
d©a
, "SSL_Inô(): %s", 
	`SSL_Såîr‹
(
rc
, 
NULL
));

132  
CURLE_SSL_CONNECT_ERROR
;

135  
CURLE_OK
;

136 
	}
}

139 
CURLcode
 
	$Cuæ_qsos¶_¸óã
(
c⁄√˘d©a
 * 
c⁄n
, 
socködex
)

142 
SSLH™dÀ
 * 
h
;

143 
s¶_c⁄√˘_d©a
 * 
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

145 
h
 = 
	`SSL_Cª©e
(
c⁄n
->
sock
[
socködex
], 
SSL_ENCRYPT
);

147 if(!
h
) {

148 
	`Áûf
(
c⁄n
->
d©a
, "SSL_Cª©e(ËI/OÉº‹: %s", 
	`°ªº‹
(
î∫o
));

149  
CURLE_SSL_CONNECT_ERROR
;

152 
c⁄ns¶
->
h™dÀ
 = 
h
;

153  
CURLE_OK
;

154 
	}
}

157 
	$Cuæ_qsos¶_å≠_˚π
(
SSLH™dÀ
 * 
h
)

161 
	}
}

164 
CURLcode
 
	$Cuæ_qsos¶_h™dshake
(
c⁄√˘d©a
 * 
c⁄n
, 
socködex
)

167 
rc
;

168 
Sessi⁄H™dÀ
 * 
d©a
 = 
c⁄n
->data;

169 
s¶_c⁄√˘_d©a
 * 
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

170 
SSLH™dÀ
 * 
h
 = 
c⁄ns¶
->
h™dÀ
;

171 
timeout_ms
;

173 
h
->
exôPgm
 = 
d©a
->
£t
.
s¶
.
vîify≥î
? 
NULL
: 
Cuæ_qsos¶_å≠_˚π
;

176 
timeout_ms
 = 
	`Cuæ_timñe·
(
d©a
, 
NULL
, 
TRUE
);

178 if(
timeout_ms
 < 0) {

180 
	`Áûf
(
d©a
, "ConnectionÅime-out");

181  
CURLE_OPERATION_TIMEDOUT
;

185 
h
->
timeout
 = (
timeout_ms
 + 1000 - 1) / 1000;

189 
d©a
->
£t
.
s¶
.
vîsi⁄
) {

192 
CURL_SSLVERSION_DEFAULT
:

193 
h
->
¥Ÿocﬁ
 = 
SSL_VERSION_CURRENT
;

196 
CURL_SSLVERSION_TLSv1
:

197 
h
->
¥Ÿocﬁ
 = 
TLS_VERSION_1
;

200 
CURL_SSLVERSION_SSLv2
:

201 
h
->
¥Ÿocﬁ
 = 
SSL_VERSION_2
;

204 
CURL_SSLVERSION_SSLv3
:

205 
h
->
¥Ÿocﬁ
 = 
SSL_VERSION_3
;

208 
CURL_SSLVERSION_TLSv1_0
:

209 
CURL_SSLVERSION_TLSv1_1
:

210 
CURL_SSLVERSION_TLSv1_2
:

211 
	`Áûf
(
d©a
, "TLS minor version cannot be set");

212  
CURLE_SSL_CONNECT_ERROR
;

215 
h
->
≥îCît
 = 
NULL
;

216 
h
->
≥îCîtLí
 = 0;

217 
rc
 = 
	`SSL_H™dshake
(
h
, 
SSL_HANDSHAKE_AS_CLIENT
);

219 
rc
) {

224 
SSL_ERROR_BAD_CERTIFICATE
:

225 
SSL_ERROR_BAD_CERT_SIG
:

226 
SSL_ERROR_NOT_TRUSTED_ROOT
:

227  
CURLE_PEER_FAILED_VERIFICATION
;

229 
SSL_ERROR_BAD_CIPHER_SUITE
:

230 
SSL_ERROR_NO_CIPHERS
:

231  
CURLE_SSL_CIPHER
;

233 
SSL_ERROR_CERTIFICATE_REJECTED
:

234 
SSL_ERROR_CERT_EXPIRED
:

235 
SSL_ERROR_NO_CERTIFICATE
:

236  
CURLE_SSL_CERTPROBLEM
;

238 
SSL_ERROR_IO
:

239 
	`Áûf
(
d©a
, "SSL_H™dshake(ËI/OÉº‹: %s", 
	`°ªº‹
(
î∫o
));

240  
CURLE_SSL_CONNECT_ERROR
;

243 
	`Áûf
(
d©a
, "SSL_H™dshake(): %s", 
	`SSL_Såîr‹
(
rc
, 
NULL
));

244  
CURLE_SSL_CONNECT_ERROR
;

248 
rc
 = 
	`Cuæ_vîifyho°
(
c⁄n
, 
h
->
≥îCît
, h->≥îCîà+ h->
≥îCîtLí
);

249 if(
rc
 !
CURLE_OK
)

250  
rc
;

253 if(
d©a
->
£t
.
s¶
.
˚πöfo
) {

254 if(
	`Cuæ_s¶_öô_˚πöfo
(
d©a
, 1))

255  
CURLE_OUT_OF_MEMORY
;

256 if(
h
->
≥îCît
) {

257 
rc
 = 
	`Cuæ_exåa˘_˚πöfo
(
c⁄n
, 0, 
h
->
≥îCît
,

258 
h
->
≥îCît
 + h->
≥îCîtLí
);

259 if(
rc
 !
CURLE_OK
)

260  
rc
;

264  
CURLE_OK
;

265 
	}
}

268 
Cuæ_ªcv
 
	gqsos¶_ªcv
;

269 
Cuæ_£nd
 
	gqsos¶_£nd
;

271 
CURLcode
 
	$Cuæ_qsos¶_c⁄√˘
(
c⁄√˘d©a
 * 
c⁄n
, 
socködex
)

274 
Sessi⁄H™dÀ
 * 
d©a
 = 
c⁄n
->data;

275 
s¶_c⁄√˘_d©a
 * 
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

276 
rc
;

278 
rc
 = 
	`Cuæ_qsos¶_öô_£ssi⁄
(
d©a
);

280 if(
rc
 =
CURLE_OK
) {

281 
rc
 = 
	`Cuæ_qsos¶_¸óã
(
c⁄n
, 
socködex
);

283 if(
rc
 =
CURLE_OK
) {

284 
rc
 = 
	`Cuæ_qsos¶_h™dshake
(
c⁄n
, 
socködex
);

285 if(
rc
 !
CURLE_OK
)

286 
	`SSL_De°roy
(
c⁄ns¶
->
h™dÀ
);

290 if(
rc
 =
CURLE_OK
) {

291 
c⁄n
->
ªcv
[
socködex
] = 
qsos¶_ªcv
;

292 
c⁄n
->
£nd
[
socködex
] = 
qsos¶_£nd
;

293 
c⁄ns¶
->
°©e
 = 
s¶_c⁄√˘i⁄_com∂ëe
;

296 
c⁄ns¶
->
h™dÀ
 = 
NULL
;

297 
c⁄ns¶
->
u£
 = 
FALSE
;

298 
c⁄ns¶
->
°©e
 = 
s¶_c⁄√˘i⁄_n⁄e
;

301  
rc
;

302 
	}
}

305 
	$Cuæ_qsos¶_˛o£_⁄e
(
s¶_c⁄√˘_d©a
 * 
c⁄n
,

306 
Sessi⁄H™dÀ
 * 
d©a
)

309 
rc
;

311 if(!
c⁄n
->
h™dÀ
)

314 
rc
 = 
	`SSL_De°roy
(
c⁄n
->
h™dÀ
);

316 if(
rc
) {

317 if(
rc
 =
SSL_ERROR_IO
) {

318 
	`Áûf
(
d©a
, "SSL_De°roy(ËI/OÉº‹: %s", 
	`°ªº‹
(
î∫o
));

323 
	`Áûf
(
d©a
, "SSL_De°roy(Ëªtu∫edÉº‹ %s", 
	`SSL_Såîr‹
(
rc
, 
NULL
));

327 
c⁄n
->
h™dÀ
 = 
NULL
;

329 
	}
}

332 
	$Cuæ_qsos¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

335 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

336 
s¶_c⁄√˘_d©a
 *
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

338 if(
c⁄ns¶
->
u£
)

339 (Ë
	`Cuæ_qsos¶_˛o£_⁄e
(
c⁄ns¶
, 
d©a
);

340 
	}
}

343 
	$Cuæ_qsos¶_˛o£_Æl
(
Sessi⁄H™dÀ
 * 
d©a
)

347 (Ë
d©a
;

349 
	}
}

352 
	$Cuæ_qsos¶_shutdown
(
c⁄√˘d©a
 * 
c⁄n
, 
socködex
)

355 
s¶_c⁄√˘_d©a
 * 
c⁄ns¶
 = &
c⁄n
->
s¶
[
socködex
];

356 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

357 
ssize_t
 
ƒód
;

358 
wh©
;

359 
rc
;

360 
buf
[120];

362 if(!
c⁄ns¶
->
h™dÀ
)

365 if(
d©a
->
£t
.
·p_ccc
 !
CURLFTPSSL_CCC_ACTIVE
)

368 if(
	`Cuæ_qsos¶_˛o£_⁄e
(
c⁄ns¶
, 
d©a
))

371 
rc
 = 0;

373 
wh©
 = 
	`Cuæ_sockë_ªady
(
c⁄n
->
sock
[
socködex
],

374 
CURL_SOCKET_BAD
, 
SSL_SHUTDOWN_TIMEOUT
);

377 if(
wh©
 < 0) {

379 
	`Áûf
(
d©a
, "£À˘/pﬁ»⁄ SSL sockë,Éºno: %d", 
SOCKERRNO
);

380 
rc
 = -1;

384 if(!
wh©
) {

385 
	`Áûf
(
d©a
, "SSL shutdownÅimeout");

392 
ƒód
 = 
	`ªad
(
c⁄n
->
sock
[
socködex
], 
buf
, (buf));

394 if(
ƒód
 < 0) {

395 
	`Áûf
(
d©a
, "ªad: %s", 
	`°ªº‹
(
î∫o
));

396 
rc
 = -1;

399 if(
ƒód
 <= 0)

402 
wh©
 = 
	`Cuæ_sockë_ªady
(
c⁄n
->
sock
[
socködex
], 
CURL_SOCKET_BAD
, 0);

405  
rc
;

406 
	}
}

409 
ssize_t
 
	$qsos¶_£nd
(
c⁄√˘d©a
 * 
c⁄n
, 
socködex
,

410 c⁄° * 
mem
, 
size_t
 
Àn
, 
CURLcode
 * 
cuæcode
)

415 
rc
;

417 
rc
 = 
	`SSL_Wrôe
(
c⁄n
->
s¶
[
socködex
].
h™dÀ
, (*Ë
mem
, (Ë
Àn
);

419 if(
rc
 < 0) {

420 
rc
) {

422 
SSL_ERROR_BAD_STATE
:

426 *
cuæcode
 = 
CURLE_AGAIN
;

429 
SSL_ERROR_IO
:

430 
î∫o
) {

431 
EWOULDBLOCK
:

432 
EINTR
:

433 *
cuæcode
 = 
CURLE_AGAIN
;

437 
	`Áûf
(
c⁄n
->
d©a
, "SSL_Wrôe(ËI/OÉº‹: %s", 
	`°ªº‹
(
î∫o
));

438 *
cuæcode
 = 
CURLE_SEND_ERROR
;

443 
	`Áûf
(
c⁄n
->
d©a
, "SSL_Write()ÑeturnedÉrror %s",

444 
	`SSL_Såîr‹
(
rc
, 
NULL
));

445 *
cuæcode
 = 
CURLE_SEND_ERROR
;

449  (
ssize_t
Ë
rc
;

450 
	}
}

453 
ssize_t
 
	$qsos¶_ªcv
(
c⁄√˘d©a
 * 
c⁄n
, 
num
, * 
buf
,

454 
size_t
 
buf„rsize
, 
CURLcode
 * 
cuæcode
)

457 
îr‹_buf„r
[120];

459 
s¶îr‹
;

460 
buffsize
;

461 
ƒód
;

463 
buffsize
 = (
buf„rsize
 > (
size_t
)
INT_MAX
) ? INT_MAX : ()buffersize;

464 
ƒód
 = 
	`SSL_Ród
(
c⁄n
->
s¶
[
num
].
h™dÀ
, 
buf
, 
buffsize
);

466 if(
ƒód
 < 0) {

469 
ƒód
) {

471 
SSL_ERROR_BAD_STATE
:

473 *
cuæcode
 = 
CURLE_AGAIN
;

476 
SSL_ERROR_IO
:

477 
î∫o
) {

478 
EWOULDBLOCK
:

479 *
cuæcode
 = 
CURLE_AGAIN
;

483 
	`Áûf
(
c⁄n
->
d©a
, "SSL_Ród(ËI/OÉº‹: %s", 
	`°ªº‹
(
î∫o
));

484 *
cuæcode
 = 
CURLE_RECV_ERROR
;

488 
	`Áûf
(
c⁄n
->
d©a
, "SSLÑódÉº‹: %s", 
	`SSL_Såîr‹
(
ƒód
, 
NULL
));

489 *
cuæcode
 = 
CURLE_RECV_ERROR
;

493  (
ssize_t
Ë
ƒód
;

494 
	}
}

497 
size_t
 
	$Cuæ_qsos¶_vîsi⁄
(* 
buf„r
, 
size_t
 
size
)

500 
	`°∫˝y
(
buf„r
, "IBM OS/400 SSL", 
size
);

501  
	`°æí
(
buf„r
);

502 
	}
}

505 
	$Cuæ_qsos¶_check_cxn
(
c⁄√˘d©a
 * 
cxn
)

508 
îr
;

509 
îæí
;

513 if(!
cxn
->
s¶
[
FIRSTSOCKET
].
h™dÀ
)

516 
îr
 = 0;

517 
îæí
 =  
îr
;

519 if(
	`gësock›t
(
cxn
->
sock
[
FIRSTSOCKET
], 
SOL_SOCKET
, 
SO_ERROR
,

520 (*Ë&
îr
, &
îæí
) ||

521 
îæí
 ! 
îr
 ||Érr)

525 
	}
}

	@lib/vtls/qssl.h

1 #i‚de‡
HEADER_CURL_QSSL_H


2 
	#HEADER_CURL_QSSL_H


	)

24 
	~"cuæ_£tup.h
"

30 
	~"uæd©a.h
"

32 #ifde‡
USE_QSOSSL


33 
Cuæ_qsos¶_öô
();

34 
Cuæ_qsos¶_˛ónup
();

35 
CURLcode
 
Cuæ_qsos¶_c⁄√˘
(
c⁄√˘d©a
 * 
c⁄n
, 
socködex
);

36 
Cuæ_qsos¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

37 
Cuæ_qsos¶_˛o£_Æl
(
Sessi⁄H™dÀ
 * 
d©a
);

38 
Cuæ_qsos¶_shutdown
(
c⁄√˘d©a
 * 
c⁄n
, 
socködex
);

40 
size_t
 
Cuæ_qsos¶_vîsi⁄
(* 
buf„r
, size_à
size
);

41 
Cuæ_qsos¶_check_cxn
(
c⁄√˘d©a
 * 
cxn
);

44 
	#cuæs¶_öô
 
Cuæ_qsos¶_öô


	)

45 
	#cuæs¶_˛ónup
 
Cuæ_qsos¶_˛ónup


	)

46 
	#cuæs¶_c⁄√˘
 
Cuæ_qsos¶_c⁄√˘


	)

49 
	#cuæs¶_£ssi⁄_‰ì
(
x
Ë
Cuæ_n›_°mt


	)

50 
	#cuæs¶_˛o£_Æl
 
Cuæ_qsos¶_˛o£_Æl


	)

51 
	#cuæs¶_˛o£
 
Cuæ_qsos¶_˛o£


	)

52 
	#cuæs¶_shutdown
(
x
,
y
Ë
	`Cuæ_qsos¶_shutdown
(x,y)

	)

53 
	#cuæs¶_£t_ígöe
(
x
,
y
Ë
CURLE_NOT_BUILT_IN


	)

54 
	#cuæs¶_£t_ígöe_deÁu…
(
x
Ë
CURLE_NOT_BUILT_IN


	)

55 
	#cuæs¶_ígöes_li°
(
x
Ë
NULL


	)

56 
	#cuæs¶_vîsi⁄
 
Cuæ_qsos¶_vîsi⁄


	)

57 
	#cuæs¶_check_cxn
(
x
Ë
	`Cuæ_qsos¶_check_cxn
(x)

	)

58 
	#cuæs¶_d©a_≥ndög
(
x
,
y
Ë0

	)

	@lib/vtls/vtls.c

48 
	~"cuæ_£tup.h
"

50 #ifde‡
HAVE_SYS_TYPES_H


51 
	~<sys/ty≥s.h
>

53 #ifde‡
HAVE_SYS_STAT_H


54 
	~<sys/°©.h
>

56 #ifde‡
HAVE_FCNTL_H


57 
	~<f˙é.h
>

60 
	~"uæd©a.h
"

62 
	~"vés.h
"

63 
	~"›ís¶.h
"

64 
	~"gés.h
"

65 
	~"nssg.h
"

66 
	~"qs¶.h
"

67 
	~"gskô.h
"

68 
	~"pﬁ¨s¶.h
"

69 
	~"axés.h
"

70 
	~"cyas¶.h
"

71 
	~"cuæ_sch™√l.h
"

72 
	~"cuæ_d¨wös¶.h
"

73 
	~"¶i°.h
"

74 
	~"£ndf.h
"

75 
	~"øw°r.h
"

76 
	~"uæ.h
"

77 
	~"cuæ_mem‹y.h
"

78 
	~"¥ogªss.h
"

79 
	~"sh¨e.h
"

80 
	~"timevÆ.h
"

82 
	#_MPRINTF_REPLACE


	)

83 
	~<cuæ/m¥ötf.h
>

86 
	~"memdebug.h
"

89 
	#SSLSESSION_SHARED
(
d©a
Ë(d©a->
sh¨e
 && \

90 (
d©a
->
sh¨e
->
•ecifõr
 & \

91 (1<<
CURL_LOCK_DATA_SSL_SESSION
)))

	)

93 
boﬁ
 
	$ß„_°ªquÆ
(* 
°r1
, * 
°r2
)

95 if(
°r1
 && 
°r2
)

97  (0 !
	`Cuæ_øw_equÆ
(
°r1
, 
°r2
)Ë? 
TRUE
 : 
FALSE
;

100  (!
°r1
 && !
°r2
Ë? 
TRUE
 : 
FALSE
;

101 
	}
}

103 
boﬁ


104 
	$Cuæ_s¶_c⁄fig_m©ches
(
s¶_c⁄fig_d©a
* 
d©a
,

105 
s¶_c⁄fig_d©a
* 
√edÀ
)

107 if((
d©a
->
vîsi⁄
 =
√edÀ
->version) &&

108 (
d©a
->
vîify≥î
 =
√edÀ
->verifypeer) &&

109 (
d©a
->
vîifyho°
 =
√edÀ
->verifyhost) &&

110 
	`ß„_°ªquÆ
(
d©a
->
CA∑th
, 
√edÀ
->CApath) &&

111 
	`ß„_°ªquÆ
(
d©a
->
CAfûe
, 
√edÀ
->CAfile) &&

112 
	`ß„_°ªquÆ
(
d©a
->
øndom_fûe
, 
√edÀ
->random_file) &&

113 
	`ß„_°ªquÆ
(
d©a
->
egdsockë
, 
√edÀ
->egdsocket) &&

114 
	`ß„_°ªquÆ
(
d©a
->
cùhî_li°
, 
√edÀ
->cipher_list))

115  
TRUE
;

117  
FALSE
;

118 
	}
}

120 
boﬁ


121 
	$Cuæ_˛⁄e_s¶_c⁄fig
(
s¶_c⁄fig_d©a
 *
sour˚
,

122 
s¶_c⁄fig_d©a
 *
de°
)

124 
de°
->
£ssi⁄id
 = 
sour˚
->sessionid;

125 
de°
->
vîifyho°
 = 
sour˚
->verifyhost;

126 
de°
->
vîify≥î
 = 
sour˚
->verifypeer;

127 
de°
->
vîsi⁄
 = 
sour˚
->version;

129 if(
sour˚
->
CAfûe
) {

130 
de°
->
CAfûe
 = 
	`°rdup
(
sour˚
->CAfile);

131 if(!
de°
->
CAfûe
)

132  
FALSE
;

135 
de°
->
CAfûe
 = 
NULL
;

137 if(
sour˚
->
CA∑th
) {

138 
de°
->
CA∑th
 = 
	`°rdup
(
sour˚
->CApath);

139 if(!
de°
->
CA∑th
)

140  
FALSE
;

143 
de°
->
CA∑th
 = 
NULL
;

145 if(
sour˚
->
cùhî_li°
) {

146 
de°
->
cùhî_li°
 = 
	`°rdup
(
sour˚
->cipher_list);

147 if(!
de°
->
cùhî_li°
)

148  
FALSE
;

151 
de°
->
cùhî_li°
 = 
NULL
;

153 if(
sour˚
->
egdsockë
) {

154 
de°
->
egdsockë
 = 
	`°rdup
(
sour˚
->egdsocket);

155 if(!
de°
->
egdsockë
)

156  
FALSE
;

159 
de°
->
egdsockë
 = 
NULL
;

161 if(
sour˚
->
øndom_fûe
) {

162 
de°
->
øndom_fûe
 = 
	`°rdup
(
sour˚
->random_file);

163 if(!
de°
->
øndom_fûe
)

164  
FALSE
;

167 
de°
->
øndom_fûe
 = 
NULL
;

169  
TRUE
;

170 
	}
}

172 
	$Cuæ_‰ì_s¶_c⁄fig
(
s¶_c⁄fig_d©a
* 
s¶c
)

174 
	`Cuæ_ß„‰ì
(
s¶c
->
CAfûe
);

175 
	`Cuæ_ß„‰ì
(
s¶c
->
CA∑th
);

176 
	`Cuæ_ß„‰ì
(
s¶c
->
cùhî_li°
);

177 
	`Cuæ_ß„‰ì
(
s¶c
->
egdsockë
);

178 
	`Cuæ_ß„‰ì
(
s¶c
->
øndom_fûe
);

179 
	}
}

194 
	$Cuæ_ønd
(
Sessi⁄H™dÀ
 *
d©a
)

196 
r
;

197 
ønd£ed
;

198 
boﬁ
 
£eded
 = 
FALSE
;

200 #ifde‡
CURLDEBUG


201 *
f‹˚_íå›y
 = 
	`gëív
("CURL_ENTROPY");

202 if(
f‹˚_íå›y
) {

203 if(!
£eded
) {

204 
size_t
 
ñí
 = 
	`°æí
(
f‹˚_íå›y
);

205 
size_t
 
˛í
 = (
ønd£ed
);

206 
size_t
 
mö
 = 
ñí
 < 
˛í
 ?Élen : clen;

207 
	`mem˝y
((*)&
ønd£ed
, 
f‹˚_íå›y
, 
mö
);

208 
£eded
 = 
TRUE
;

211 
ønd£ed
++;

212  
ønd£ed
;

216 #i‚de‡
have_cuæs¶_øndom


217 ()
d©a
;

219 if(
d©a
) {

220 
	`cuæs¶_øndom
(
d©a
, (*)&
r
, (r));

221  
r
;

225 #ifde‡
RANDOM_FILE


226 if(!
£eded
) {

228 
fd
 = 
	`›í
(
RANDOM_FILE
, 
O_RDONLY
);

229 if(
fd
 > -1) {

231 
ssize_t
 
ƒód
 = 
	`ªad
(
fd
, &
ønd£ed
, (randseed));

232 if(
ƒód
 =(
ønd£ed
))

233 
£eded
 = 
TRUE
;

234 
	`˛o£
(
fd
);

239 if(!
£eded
) {

240 
timevÆ
 
now
 = 
	`cuæx_tvnow
();

241 
ønd£ed
 +()
now
.
tv_u£c
 + (Íow.
tv_£c
;

242 
ønd£ed
 =Ñandseed * 1103515245 + 12345;

243 
ønd£ed
 =Ñandseed * 1103515245 + 12345;

244 
ønd£ed
 =Ñandseed * 1103515245 + 12345;

245 
£eded
 = 
TRUE
;

249 
r
 = 
ønd£ed
 =Ñandseed * 1103515245 + 12345;

250  (
r
 << 16) | ((r >> 16) & 0xFFFF);

251 
	}
}

253 #ifde‡
USE_SSL


256 
boﬁ
 
	göô_s¶
=
FALSE
;

264 
	$Cuæ_s¶_öô
()

267 if(
öô_s¶
)

269 
öô_s¶
 = 
TRUE
;

271  
	`cuæs¶_öô
();

272 
	}
}

276 
	$Cuæ_s¶_˛ónup
()

278 if(
öô_s¶
) {

280 
	`cuæs¶_˛ónup
();

281 
öô_s¶
 = 
FALSE
;

283 
	}
}

285 
CURLcode


286 
	$Cuæ_s¶_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

288 
CURLcode
 
ªs
;

290 
c⁄n
->
s¶
[
socködex
].
u£
 = 
TRUE
;

291 
c⁄n
->
s¶
[
socködex
].
°©e
 = 
s¶_c⁄√˘i⁄_√gŸütög
;

293 
ªs
 = 
	`cuæs¶_c⁄√˘
(
c⁄n
, 
socködex
);

295 if(!
ªs
)

296 
	`Cuæ_pgrsTime
(
c⁄n
->
d©a
, 
TIMER_APPCONNECT
);

298  
ªs
;

299 
	}
}

301 
CURLcode


302 
	$Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
,

303 
boﬁ
 *
d⁄e
)

305 
CURLcode
 
ªs
;

307 
c⁄n
->
s¶
[
socködex
].
u£
 = 
TRUE
;

308 #ifde‡
cuæs¶_c⁄√˘_n⁄blockög


309 
ªs
 = 
	`cuæs¶_c⁄√˘_n⁄blockög
(
c⁄n
, 
socködex
, 
d⁄e
);

311 *
d⁄e
 = 
TRUE
;

312 
ªs
 = 
	`cuæs¶_c⁄√˘
(
c⁄n
, 
socködex
);

314 if(!
ªs
 && *
d⁄e
)

315 
	`Cuæ_pgrsTime
(
c⁄n
->
d©a
, 
TIMER_APPCONNECT
);

316  
ªs
;

317 
	}
}

323 
	$Cuæ_s¶_gë£ssi⁄id
(
c⁄√˘d©a
 *
c⁄n
,

324 **
s¶_£ssi⁄id
,

325 
size_t
 *
idsize
)

327 
cuæ_s¶_£ssi⁄
 *
check
;

328 
Sessi⁄H™dÀ
 *
d©a
 = 
c⁄n
->data;

329 
size_t
 
i
;

330 *
gíîÆ_age
;

331 
boﬁ
 
no_m©ch
 = 
TRUE
;

333 *
s¶_£ssi⁄id
 = 
NULL
;

335 if(!
c⁄n
->
s¶_c⁄fig
.
£ssi⁄id
)

337  
TRUE
;

340 if(
	`SSLSESSION_SHARED
(
d©a
)) {

341 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_SSL_SESSION
, 
CURL_LOCK_ACCESS_SINGLE
);

342 
gíîÆ_age
 = &
d©a
->
sh¨e
->
£ssi⁄age
;

345 
gíîÆ_age
 = &
d©a
->
°©e
.
£ssi⁄age
;

347 
i
 = 0; i < 
d©a
->
£t
.
s¶
.
max_s¶_£ssi⁄s
; i++) {

348 
check
 = &
d©a
->
°©e
.
£ssi⁄
[
i
];

349 if(!
check
->
£ssi⁄id
)

352 if(
	`Cuæ_øw_equÆ
(
c⁄n
->
ho°
.
«me
, 
check
->name) &&

353 (
c⁄n
->
ªmŸe_p‹t
 =
check
->remote_port) &&

354 
	`Cuæ_s¶_c⁄fig_m©ches
(&
c⁄n
->
s¶_c⁄fig
, &
check
->ssl_config)) {

356 (*
gíîÆ_age
)++;

357 
check
->
age
 = *
gíîÆ_age
;

358 *
s¶_£ssi⁄id
 = 
check
->
£ssi⁄id
;

359 if(
idsize
)

360 *
idsize
 = 
check
->idsize;

361 
no_m©ch
 = 
FALSE
;

367 if(
	`SSLSESSION_SHARED
(
d©a
))

368 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_SSL_SESSION
);

370  
no_m©ch
;

371 
	}
}

376 
	$Cuæ_s¶_kûl_£ssi⁄
(
cuæ_s¶_£ssi⁄
 *
£ssi⁄
)

378 if(
£ssi⁄
->
£ssi⁄id
) {

382 
	`cuæs¶_£ssi⁄_‰ì
(
£ssi⁄
->
£ssi⁄id
);

384 
£ssi⁄
->
£ssi⁄id
 = 
NULL
;

385 
£ssi⁄
->
age
 = 0;

387 
	`Cuæ_‰ì_s¶_c⁄fig
(&
£ssi⁄
->
s¶_c⁄fig
);

389 
	`Cuæ_ß„‰ì
(
£ssi⁄
->
«me
);

391 
	}
}

396 
	$Cuæ_s¶_dñ£ssi⁄id
(
c⁄√˘d©a
 *
c⁄n
, *
s¶_£ssi⁄id
)

398 
size_t
 
i
;

399 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

401 if(
	`SSLSESSION_SHARED
(
d©a
))

402 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_SSL_SESSION
, 
CURL_LOCK_ACCESS_SINGLE
);

404 
i
 = 0; i < 
d©a
->
£t
.
s¶
.
max_s¶_£ssi⁄s
; i++) {

405 
cuæ_s¶_£ssi⁄
 *
check
 = &
d©a
->
°©e
.
£ssi⁄
[
i
];

407 if(
check
->
£ssi⁄id
 =
s¶_£ssi⁄id
) {

408 
	`Cuæ_s¶_kûl_£ssi⁄
(
check
);

413 if(
	`SSLSESSION_SHARED
(
d©a
))

414 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_SSL_SESSION
);

415 
	}
}

423 
CURLcode
 
	$Cuæ_s¶_add£ssi⁄id
(
c⁄√˘d©a
 *
c⁄n
,

424 *
s¶_£ssi⁄id
,

425 
size_t
 
idsize
)

427 
size_t
 
i
;

428 
Sessi⁄H™dÀ
 *
d©a
=
c⁄n
->data;

429 
cuæ_s¶_£ssi⁄
 *
°‹e
 = &
d©a
->
°©e
.
£ssi⁄
[0];

430 
ﬁde°_age
=
d©a
->
°©e
.
£ssi⁄
[0].
age
;

431 *
˛⁄e_ho°
;

432 *
gíîÆ_age
;

438 
˛⁄e_ho°
 = 
	`°rdup
(
c⁄n
->
ho°
.
«me
);

439 if(!
˛⁄e_ho°
)

440  
CURLE_OUT_OF_MEMORY
;

446 if(
	`SSLSESSION_SHARED
(
d©a
)) {

447 
	`Cuæ_sh¨e_lock
(
d©a
, 
CURL_LOCK_DATA_SSL_SESSION
, 
CURL_LOCK_ACCESS_SINGLE
);

448 
gíîÆ_age
 = &
d©a
->
sh¨e
->
£ssi⁄age
;

451 
gíîÆ_age
 = &
d©a
->
°©e
.
£ssi⁄age
;

455 
i
 = 1; (ò< 
d©a
->
£t
.
s¶
.
max_s¶_£ssi⁄s
) &&

456 
d©a
->
°©e
.
£ssi⁄
[
i
].
£ssi⁄id
; i++) {

457 if(
d©a
->
°©e
.
£ssi⁄
[
i
].
age
 < 
ﬁde°_age
) {

458 
ﬁde°_age
 = 
d©a
->
°©e
.
£ssi⁄
[
i
].
age
;

459 
°‹e
 = &
d©a
->
°©e
.
£ssi⁄
[
i
];

462 if(
i
 =
d©a
->
£t
.
s¶
.
max_s¶_£ssi⁄s
)

464 
	`Cuæ_s¶_kûl_£ssi⁄
(
°‹e
);

466 
°‹e
 = &
d©a
->
°©e
.
£ssi⁄
[
i
];

469 
°‹e
->
£ssi⁄id
 = 
s¶_£ssi⁄id
;

470 
°‹e
->
idsize
 = idsize;

471 
°‹e
->
age
 = *
gíîÆ_age
;

472 if(
°‹e
->
«me
)

474 
	`‰ì
(
°‹e
->
«me
);

475 
°‹e
->
«me
 = 
˛⁄e_ho°
;

476 
°‹e
->
ªmŸe_p‹t
 = 
c⁄n
->remote_port;

480 if(
	`SSLSESSION_SHARED
(
d©a
))

481 
	`Cuæ_sh¨e_u∆ock
(
d©a
, 
CURL_LOCK_DATA_SSL_SESSION
);

483 if(!
	`Cuæ_˛⁄e_s¶_c⁄fig
(&
c⁄n
->
s¶_c⁄fig
, &
°‹e
->ssl_config)) {

484 
°‹e
->
£ssi⁄id
 = 
NULL
;

485 
	`‰ì
(
˛⁄e_ho°
);

486  
CURLE_OUT_OF_MEMORY
;

489  
CURLE_OK
;

490 
	}
}

493 
	$Cuæ_s¶_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
)

495 
size_t
 
i
;

497 if(
d©a
->
°©e
.
£ssi⁄
 && !
	`SSLSESSION_SHARED
(data)) {

498 
i
 = 0; i < 
d©a
->
£t
.
s¶
.
max_s¶_£ssi⁄s
; i++)

500 
	`Cuæ_s¶_kûl_£ssi⁄
(&
d©a
->
°©e
.
£ssi⁄
[
i
]);

503 
	`Cuæ_ß„‰ì
(
d©a
->
°©e
.
£ssi⁄
);

506 
	`cuæs¶_˛o£_Æl
(
d©a
);

507 
	}
}

509 
	$Cuæ_s¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

511 
	`DEBUGASSERT
((
socködex
 <= 1) && (sockindex >= -1));

512 
	`cuæs¶_˛o£
(
c⁄n
, 
socködex
);

513 
	}
}

515 
CURLcode
 
	$Cuæ_s¶_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
)

517 if(
	`cuæs¶_shutdown
(
c⁄n
, 
socködex
))

518  
CURLE_SSL_SHUTDOWN_FAILED
;

520 
c⁄n
->
s¶
[
socködex
].
u£
 = 
FALSE
;

521 
c⁄n
->
s¶
[
socködex
].
°©e
 = 
s¶_c⁄√˘i⁄_n⁄e
;

523 
c⁄n
->
ªcv
[
socködex
] = 
Cuæ_ªcv_∂aö
;

524 
c⁄n
->
£nd
[
socködex
] = 
Cuæ_£nd_∂aö
;

526  
CURLE_OK
;

527 
	}
}

531 
CURLcode
 
	$Cuæ_s¶_£t_ígöe
(
Sessi⁄H™dÀ
 *
d©a
, c⁄° *
ígöe
)

533  
	`cuæs¶_£t_ígöe
(
d©a
, 
ígöe
);

534 
	}
}

538 
CURLcode
 
	$Cuæ_s¶_£t_ígöe_deÁu…
(
Sessi⁄H™dÀ
 *
d©a
)

540  
	`cuæs¶_£t_ígöe_deÁu…
(
d©a
);

541 
	}
}

544 
cuæ_¶i°
 *
	$Cuæ_s¶_ígöes_li°
(
Sessi⁄H™dÀ
 *
d©a
)

546  
	`cuæs¶_ígöes_li°
(
d©a
);

547 
	}
}

553 
CURLcode
 
	$Cuæ_s¶_öô£ssi⁄s
(
Sessi⁄H™dÀ
 *
d©a
, 
size_t
 
amou¡
)

555 
cuæ_s¶_£ssi⁄
 *
£ssi⁄
;

557 if(
d©a
->
°©e
.
£ssi⁄
)

559  
CURLE_OK
;

561 
£ssi⁄
 = 
	`ˇŒoc
(
amou¡
, (
cuæ_s¶_£ssi⁄
));

562 if(!
£ssi⁄
)

563  
CURLE_OUT_OF_MEMORY
;

566 
d©a
->
£t
.
s¶
.
max_s¶_£ssi⁄s
 = 
amou¡
;

567 
d©a
->
°©e
.
£ssi⁄
 = session;

568 
d©a
->
°©e
.
£ssi⁄age
 = 1;

569  
CURLE_OK
;

570 
	}
}

572 
size_t
 
	$Cuæ_s¶_vîsi⁄
(*
buf„r
, 
size_t
 
size
)

574  
	`cuæs¶_vîsi⁄
(
buf„r
, 
size
);

575 
	}
}

585 
	$Cuæ_s¶_check_cxn
(
c⁄√˘d©a
 *
c⁄n
)

587  
	`cuæs¶_check_cxn
(
c⁄n
);

588 
	}
}

590 
boﬁ
 
	$Cuæ_s¶_d©a_≥ndög
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

591 
c⁄nödex
)

593  
	`cuæs¶_d©a_≥ndög
(
c⁄n
, 
c⁄nödex
);

594 
	}
}

596 
	$Cuæ_s¶_‰ì_˚πöfo
(
Sessi⁄H™dÀ
 *
d©a
)

598 
i
;

599 
cuæ_˚πöfo
 *
ci
 = &
d©a
->
öfo
.
˚πs
;

600 if(
ci
->
num_of_˚πs
) {

602 
i
=0; i<
ci
->
num_of_˚πs
; i++) {

603 
	`cuæ_¶i°_‰ì_Æl
(
ci
->
˚πöfo
[
i
]);

604 
ci
->
˚πöfo
[
i
] = 
NULL
;

606 
	`‰ì
(
ci
->
˚πöfo
);

607 
ci
->
˚πöfo
 = 
NULL
;

608 
ci
->
num_of_˚πs
 = 0;

610 
	}
}

612 
	$Cuæ_s¶_öô_˚πöfo
(
Sessi⁄H™dÀ
 * 
d©a
,

613 
num
)

615 
cuæ_˚πöfo
 * 
ci
 = &
d©a
->
öfo
.
˚πs
;

616 
cuæ_¶i°
 * * 
èbÀ
;

620 
	`Cuæ_s¶_‰ì_˚πöfo
(
d©a
);

621 
ci
->
num_of_˚πs
 = 
num
;

622 
èbÀ
 = 
	`ˇŒoc
((
size_t
Ë
num
, (
cuæ_¶i°
 *));

623 if(!
èbÀ
)

626 
ci
->
˚πöfo
 = 
èbÀ
;

628 
	}
}

633 
CURLcode
 
	$Cuæ_s¶_push_˚πöfo_Àn
(
Sessi⁄H™dÀ
 *
d©a
,

634 
˚πnum
,

635 c⁄° *
œbñ
,

636 c⁄° *
vÆue
,

637 
size_t
 
vÆuñí
)

639 
cuæ_˚πöfo
 * 
ci
 = &
d©a
->
öfo
.
˚πs
;

640 * 
ouçut
;

641 
cuæ_¶i°
 * 
∆
;

642 
CURLcode
 
ªs
 = 
CURLE_OK
;

643 
size_t
 
œbñÀn
 = 
	`°æí
(
œbñ
);

644 
size_t
 
ouéí
 = 
œbñÀn
 + 1 + 
vÆuñí
 + 1;

646 
ouçut
 = 
	`mÆloc
(
ouéí
);

647 if(!
ouçut
)

648  
CURLE_OUT_OF_MEMORY
;

651 
	`¢¥ötf
(
ouçut
, 
ouéí
, "%s:", 
œbñ
);

654 
	`mem˝y
(&
ouçut
[
œbñÀn
+1], 
vÆue
, 
vÆuñí
);

657 
ouçut
[
œbñÀn
 + 1 + 
vÆuñí
] = 0;

659 
∆
 = 
	`Cuæ_¶i°_≠≥nd_nodup
(
ci
->
˚πöfo
[
˚πnum
], 
ouçut
);

660 if(!
∆
) {

661 
	`‰ì
(
ouçut
);

662 
	`cuæ_¶i°_‰ì_Æl
(
ci
->
˚πöfo
[
˚πnum
]);

663 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

666 
ci
->
˚πöfo
[
˚πnum
] = 
∆
;

667  
ªs
;

668 
	}
}

674 
CURLcode
 
	$Cuæ_s¶_push_˚πöfo
(
Sessi⁄H™dÀ
 *
d©a
,

675 
˚πnum
,

676 c⁄° *
œbñ
,

677 c⁄° *
vÆue
)

679 
size_t
 
vÆuñí
 = 
	`°æí
(
vÆue
);

681  
	`Cuæ_s¶_push_˚πöfo_Àn
(
d©a
, 
˚πnum
, 
œbñ
, 
vÆue
, 
vÆuñí
);

682 
	}
}

684 #ifde‡
have_cuæs¶_md5sum


685 
	$Cuæ_s¶_md5sum
(*
tmp
,

686 
size_t
 
tm∂í
,

687 *
md5sum
,

688 
size_t
 
md5Àn
)

690 
	`cuæs¶_md5sum
(
tmp
, 
tm∂í
, 
md5sum
, 
md5Àn
);

691 
	}
}

	@lib/vtls/vtls.h

1 #i‚de‡
HEADER_CURL_VTLS_H


2 
	#HEADER_CURL_VTLS_H


	)

24 
	~"cuæ_£tup.h
"

26 #i‚de‡
MD5_DIGEST_LENGTH


27 
	#MD5_DIGEST_LENGTH
 16

	)

31 
	#ALPN_HTTP_1_1_LENGTH
 8

	)

32 
	#ALPN_HTTP_1_1
 "hâp/1.1"

	)

34 
boﬁ
 
Cuæ_s¶_c⁄fig_m©ches
(
s¶_c⁄fig_d©a
* 
d©a
,

35 
s¶_c⁄fig_d©a
* 
√edÀ
);

36 
boﬁ
 
Cuæ_˛⁄e_s¶_c⁄fig
(
s¶_c⁄fig_d©a
* 
sour˚
,

37 
s¶_c⁄fig_d©a
* 
de°
);

38 
Cuæ_‰ì_s¶_c⁄fig
(
s¶_c⁄fig_d©a
* 
s¶c
);

40 
Cuæ_ønd
(
Sessi⁄H™dÀ
 *);

42 #ifde‡
USE_SSL


43 
Cuæ_s¶_öô
();

44 
Cuæ_s¶_˛ónup
();

45 
CURLcode
 
Cuæ_s¶_c⁄√˘
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

46 
CURLcode
 
Cuæ_s¶_c⁄√˘_n⁄blockög
(
c⁄√˘d©a
 *
c⁄n
,

47 
socködex
,

48 
boﬁ
 *
d⁄e
);

51 
Cuæ_s¶_˛o£_Æl
(
Sessi⁄H™dÀ
 *
d©a
);

52 
Cuæ_s¶_˛o£
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

53 
CURLcode
 
Cuæ_s¶_shutdown
(
c⁄√˘d©a
 *
c⁄n
, 
socködex
);

54 
CURLcode
 
Cuæ_s¶_£t_ígöe
(
Sessi⁄H™dÀ
 *
d©a
, c⁄° *
ígöe
);

56 
CURLcode
 
Cuæ_s¶_£t_ígöe_deÁu…
(
Sessi⁄H™dÀ
 *
d©a
);

57 
cuæ_¶i°
 *
Cuæ_s¶_ígöes_li°
(
Sessi⁄H™dÀ
 *
d©a
);

60 
CURLcode
 
Cuæ_s¶_öô£ssi⁄s
(
Sessi⁄H™dÀ
 *, 
size_t
);

61 
size_t
 
Cuæ_s¶_vîsi⁄
(*
buf„r
, size_à
size
);

62 
boﬁ
 
Cuæ_s¶_d©a_≥ndög
(c⁄° 
c⁄√˘d©a
 *
c⁄n
,

63 
c⁄nödex
);

64 
Cuæ_s¶_check_cxn
(
c⁄√˘d©a
 *
c⁄n
);

68 
Cuæ_s¶_‰ì_˚πöfo
(
Sessi⁄H™dÀ
 *
d©a
);

69 
Cuæ_s¶_öô_˚πöfo
(
Sessi⁄H™dÀ
 * 
d©a
, 
num
);

70 
CURLcode
 
Cuæ_s¶_push_˚πöfo_Àn
(
Sessi⁄H™dÀ
 * 
d©a
, 
˚πnum
,

71 c⁄° * 
œbñ
, c⁄° * 
vÆue
,

72 
size_t
 
vÆuñí
);

73 
CURLcode
 
Cuæ_s¶_push_˚πöfo
(
Sessi⁄H™dÀ
 * 
d©a
, 
˚πnum
,

74 c⁄° * 
œbñ
, c⁄° * 
vÆue
);

79 
Cuæ_s¶_gë£ssi⁄id
(
c⁄√˘d©a
 *
c⁄n
,

80 **
s¶_£ssi⁄id
,

81 
size_t
 *
idsize
) ;

83 
CURLcode
 
Cuæ_s¶_add£ssi⁄id
(
c⁄√˘d©a
 *
c⁄n
,

84 *
s¶_£ssi⁄id
,

85 
size_t
 
idsize
);

87 
Cuæ_s¶_kûl_£ssi⁄
(
cuæ_s¶_£ssi⁄
 *
£ssi⁄
);

89 
Cuæ_s¶_dñ£ssi⁄id
(
c⁄√˘d©a
 *
c⁄n
, *
s¶_£ssi⁄id
);

92 
Cuæ_s¶_md5sum
(*
tmp
,

93 
size_t
 
tm∂í
,

94 *
md5sum
,

95 
size_t
 
md5Àn
);

97 
	#SSL_SHUTDOWN_TIMEOUT
 10000

	)

99 #ifde‡
have_cuæs¶_øndom


100 
	#HAVE_CURL_SSL_RANDOM


	)

102 #ifde‡
have_cuæs¶_md5sum


103 
	#HAVE_CURL_SSL_MD5SUM


	)

108 
	#Cuæ_s¶_öô
(Ë1

	)

109 
	#Cuæ_s¶_˛ónup
(Ë
Cuæ_n›_°mt


	)

110 
	#Cuæ_s¶_c⁄√˘
(
x
,
y
Ë
CURLE_NOT_BUILT_IN


	)

111 
	#Cuæ_s¶_˛o£_Æl
(
x
Ë
Cuæ_n›_°mt


	)

112 
	#Cuæ_s¶_˛o£
(
x
,
y
Ë
Cuæ_n›_°mt


	)

113 
	#Cuæ_s¶_shutdown
(
x
,
y
Ë
CURLE_NOT_BUILT_IN


	)

114 
	#Cuæ_s¶_£t_ígöe
(
x
,
y
Ë
CURLE_NOT_BUILT_IN


	)

115 
	#Cuæ_s¶_£t_ígöe_deÁu…
(
x
Ë
CURLE_NOT_BUILT_IN


	)

116 
	#Cuæ_s¶_ígöes_li°
(
x
Ë
NULL


	)

117 
	#Cuæ_s¶_£nd
(
a
,
b
,
c
,
d
,
e
Ë-1

	)

118 
	#Cuæ_s¶_ªcv
(
a
,
b
,
c
,
d
,
e
Ë-1

	)

119 
	#Cuæ_s¶_öô£ssi⁄s
(
x
,
y
Ë
CURLE_OK


	)

120 
	#Cuæ_s¶_vîsi⁄
(
x
,
y
Ë0

	)

121 
	#Cuæ_s¶_d©a_≥ndög
(
x
,
y
Ë0

	)

122 
	#Cuæ_s¶_check_cxn
(
x
Ë0

	)

123 
	#Cuæ_s¶_‰ì_˚πöfo
(
x
Ë
Cuæ_n›_°mt


	)

124 
	#Cuæ_s¶_c⁄√˘_n⁄blockög
(
x
,
y
,
z
Ë
CURLE_NOT_BUILT_IN


	)

125 
	#Cuæ_s¶_kûl_£ssi⁄
(
x
Ë
Cuæ_n›_°mt


	)

	@lib/warnless.c

23 
	~"cuæ_£tup.h
"

25 #i‡
deföed
(
__INTEL_COMPILER
Ë&& deföed(
__unix__
)

27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

30 #ifde‡
HAVE_ARPA_INET_H


31 
	~<¨∑/öë.h
>

36 
	#BUILDING_WARNLESS_C
 1

	)

38 
	~"w¨∆ess.h
"

40 
	#CURL_MASK_SCHAR
 0x7F

	)

41 
	#CURL_MASK_UCHAR
 0xFF

	)

43 #i‡(
SIZEOF_SHORT
 == 2)

44 
	#CURL_MASK_SSHORT
 0x7FFF

	)

45 
	#CURL_MASK_USHORT
 0xFFFF

	)

46 #ñi‡(
SIZEOF_SHORT
 == 4)

47 
	#CURL_MASK_SSHORT
 0x7FFFFFFF

	)

48 
	#CURL_MASK_USHORT
 0xFFFFFFFF

	)

49 #ñi‡(
SIZEOF_SHORT
 == 8)

50 
	#CURL_MASK_SSHORT
 0x7FFFFFFFFFFFFFFF

	)

51 
	#CURL_MASK_USHORT
 0xFFFFFFFFFFFFFFFF

	)

56 #i‡(
SIZEOF_INT
 == 2)

57 
	#CURL_MASK_SINT
 0x7FFF

	)

58 
	#CURL_MASK_UINT
 0xFFFF

	)

59 #ñi‡(
SIZEOF_INT
 == 4)

60 
	#CURL_MASK_SINT
 0x7FFFFFFF

	)

61 
	#CURL_MASK_UINT
 0xFFFFFFFF

	)

62 #ñi‡(
SIZEOF_INT
 == 8)

63 
	#CURL_MASK_SINT
 0x7FFFFFFFFFFFFFFF

	)

64 
	#CURL_MASK_UINT
 0xFFFFFFFFFFFFFFFF

	)

65 #ñi‡(
SIZEOF_INT
 == 16)

66 
	#CURL_MASK_SINT
 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF

	)

67 
	#CURL_MASK_UINT
 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF

	)

72 #i‡(
CURL_SIZEOF_LONG
 == 2)

73 
	#CURL_MASK_SLONG
 0x7FFFL

	)

74 
	#CURL_MASK_ULONG
 0xFFFFUL

	)

75 #ñi‡(
CURL_SIZEOF_LONG
 == 4)

76 
	#CURL_MASK_SLONG
 0x7FFFFFFFL

	)

77 
	#CURL_MASK_ULONG
 0xFFFFFFFFUL

	)

78 #ñi‡(
CURL_SIZEOF_LONG
 == 8)

79 
	#CURL_MASK_SLONG
 0x7FFFFFFFFFFFFFFFL

	)

80 
	#CURL_MASK_ULONG
 0xFFFFFFFFFFFFFFFFUL

	)

81 #ñi‡(
CURL_SIZEOF_LONG
 == 16)

82 
	#CURL_MASK_SLONG
 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFL

	)

83 
	#CURL_MASK_ULONG
 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFUL

	)

88 #i‡(
CURL_SIZEOF_CURL_OFF_T
 == 2)

89 
	#CURL_MASK_SCOFFT
 
	`CURL_OFF_T_C
(0x7FFF)

	)

90 
	#CURL_MASK_UCOFFT
 
	`CURL_OFF_TU_C
(0xFFFF)

	)

91 #ñi‡(
CURL_SIZEOF_CURL_OFF_T
 == 4)

92 
	#CURL_MASK_SCOFFT
 
	`CURL_OFF_T_C
(0x7FFFFFFF)

	)

93 
	#CURL_MASK_UCOFFT
 
	`CURL_OFF_TU_C
(0xFFFFFFFF)

	)

94 #ñi‡(
CURL_SIZEOF_CURL_OFF_T
 == 8)

95 
	#CURL_MASK_SCOFFT
 
	`CURL_OFF_T_C
(0x7FFFFFFFFFFFFFFF)

	)

96 
	#CURL_MASK_UCOFFT
 
	`CURL_OFF_TU_C
(0xFFFFFFFFFFFFFFFF)

	)

97 #ñi‡(
CURL_SIZEOF_CURL_OFF_T
 == 16)

98 
	#CURL_MASK_SCOFFT
 
	`CURL_OFF_T_C
(0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF)

	)

99 
	#CURL_MASK_UCOFFT
 
	`CURL_OFF_TU_C
(0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF)

	)

104 #i‡(
SIZEOF_SIZE_T
 =
SIZEOF_SHORT
)

105 
	#CURL_MASK_SSIZE_T
 
CURL_MASK_SSHORT


	)

106 
	#CURL_MASK_USIZE_T
 
CURL_MASK_USHORT


	)

107 #ñi‡(
SIZEOF_SIZE_T
 =
SIZEOF_INT
)

108 
	#CURL_MASK_SSIZE_T
 
CURL_MASK_SINT


	)

109 
	#CURL_MASK_USIZE_T
 
CURL_MASK_UINT


	)

110 #ñi‡(
SIZEOF_SIZE_T
 =
CURL_SIZEOF_LONG
)

111 
	#CURL_MASK_SSIZE_T
 
CURL_MASK_SLONG


	)

112 
	#CURL_MASK_USIZE_T
 
CURL_MASK_ULONG


	)

113 #ñi‡(
SIZEOF_SIZE_T
 =
CURL_SIZEOF_CURL_OFF_T
)

114 
	#CURL_MASK_SSIZE_T
 
CURL_MASK_SCOFFT


	)

115 
	#CURL_MASK_USIZE_T
 
CURL_MASK_UCOFFT


	)

124 
	$cuæx_u…ous
(
u um
)

126 #ifde‡
__INTEL_COMPILER


127 #¥agm®
	`w¨nög
(
push
)

128 #¥agm®
	`w¨nög
(
dißbÀ
:810)

131 
	`DEBUGASSERT
(
u um
 <(Ë
CURL_MASK_USHORT
);

132  ()(
u um
 & (Ë
CURL_MASK_USHORT
);

134 #ifde‡
__INTEL_COMPILER


135 #¥agm®
	`w¨nög
(
p›
)

137 
	}
}

143 
	$cuæx_u…ouc
(
u um
)

145 #ifde‡
__INTEL_COMPILER


146 #¥agm®
	`w¨nög
(
push
)

147 #¥agm®
	`w¨nög
(
dißbÀ
:810)

150 
	`DEBUGASSERT
(
u um
 <(Ë
CURL_MASK_UCHAR
);

151  ()(
u um
 & (Ë
CURL_MASK_UCHAR
);

153 #ifde‡
__INTEL_COMPILER


154 #¥agm®
	`w¨nög
(
p›
)

156 
	}
}

162 
	$cuæx_u…osi
(
u um
)

164 #ifde‡
__INTEL_COMPILER


165 #¥agm®
	`w¨nög
(
push
)

166 #¥agm®
	`w¨nög
(
dißbÀ
:810)

169 
	`DEBUGASSERT
(
u um
 <(Ë
CURL_MASK_SINT
);

170  ()(
u um
 & (Ë
CURL_MASK_SINT
);

172 #ifde‡
__INTEL_COMPILER


173 #¥agm®
	`w¨nög
(
p›
)

175 
	}
}

181 
cuæ_off_t
 
	$cuæx_uztoso
(
size_t
 
uznum
)

183 #ifde‡
__INTEL_COMPILER


184 #¥agm®
	`w¨nög
(
push
)

185 #¥agm®
	`w¨nög
(
dißbÀ
:810)

188 
	`DEBUGASSERT
(
uznum
 <(
size_t
Ë
CURL_MASK_SCOFFT
);

189  (
cuæ_off_t
)(
uznum
 & (
size_t
Ë
CURL_MASK_SCOFFT
);

191 #ifde‡
__INTEL_COMPILER


192 #¥agm®
	`w¨nög
(
p›
)

194 
	}
}

200 
	$cuæx_uztosi
(
size_t
 
uznum
)

202 #ifde‡
__INTEL_COMPILER


203 #¥agm®
	`w¨nög
(
push
)

204 #¥agm®
	`w¨nög
(
dißbÀ
:810)

207 
	`DEBUGASSERT
(
uznum
 <(
size_t
Ë
CURL_MASK_SINT
);

208  ()(
uznum
 & (
size_t
Ë
CURL_MASK_SINT
);

210 #ifde‡
__INTEL_COMPILER


211 #¥agm®
	`w¨nög
(
p›
)

213 
	}
}

219 
	$cuæx_uztoul
(
size_t
 
uznum
)

221 #ifde‡
__INTEL_COMPILER


222 #¥agm®
	`w¨nög
(
push
)

223 #¥agm®
	`w¨nög
(
dißbÀ
:810)

226 #i‡(
CURL_SIZEOF_LONG
 < 
SIZEOF_SIZE_T
)

227 
	`DEBUGASSERT
(
uznum
 <(
size_t
Ë
CURL_MASK_ULONG
);

229  ()(
uznum
 & (
size_t
Ë
CURL_MASK_ULONG
);

231 #ifde‡
__INTEL_COMPILER


232 #¥agm®
	`w¨nög
(
p›
)

234 
	}
}

240 
	$cuæx_uztoui
(
size_t
 
uznum
)

242 #ifde‡
__INTEL_COMPILER


243 #¥agm®
	`w¨nög
(
push
)

244 #¥agm®
	`w¨nög
(
dißbÀ
:810)

247 #i‡(
SIZEOF_INT
 < 
SIZEOF_SIZE_T
)

248 
	`DEBUGASSERT
(
uznum
 <(
size_t
Ë
CURL_MASK_UINT
);

250  ()(
uznum
 & (
size_t
Ë
CURL_MASK_UINT
);

252 #ifde‡
__INTEL_COMPILER


253 #¥agm®
	`w¨nög
(
p›
)

255 
	}
}

261 
	$cuæx_¶tosi
(
¶num
)

263 #ifde‡
__INTEL_COMPILER


264 #¥agm®
	`w¨nög
(
push
)

265 #¥agm®
	`w¨nög
(
dißbÀ
:810)

268 
	`DEBUGASSERT
(
¶num
 >= 0);

269 #i‡(
SIZEOF_INT
 < 
CURL_SIZEOF_LONG
)

270 
	`DEBUGASSERT
((Ë
¶num
 <(Ë
CURL_MASK_SINT
);

272  ()(
¶num
 & (Ë
CURL_MASK_SINT
);

274 #ifde‡
__INTEL_COMPILER


275 #¥agm®
	`w¨nög
(
p›
)

277 
	}
}

283 
	$cuæx_¶toui
(
¶num
)

285 #ifde‡
__INTEL_COMPILER


286 #¥agm®
	`w¨nög
(
push
)

287 #¥agm®
	`w¨nög
(
dißbÀ
:810)

290 
	`DEBUGASSERT
(
¶num
 >= 0);

291 #i‡(
SIZEOF_INT
 < 
CURL_SIZEOF_LONG
)

292 
	`DEBUGASSERT
((Ë
¶num
 <(Ë
CURL_MASK_UINT
);

294  ()(
¶num
 & (Ë
CURL_MASK_UINT
);

296 #ifde‡
__INTEL_COMPILER


297 #¥agm®
	`w¨nög
(
p›
)

299 
	}
}

305 
	$cuæx_¶tous
(
¶num
)

307 #ifde‡
__INTEL_COMPILER


308 #¥agm®
	`w¨nög
(
push
)

309 #¥agm®
	`w¨nög
(
dißbÀ
:810)

312 
	`DEBUGASSERT
(
¶num
 >= 0);

313 
	`DEBUGASSERT
((Ë
¶num
 <(Ë
CURL_MASK_USHORT
);

314  ()(
¶num
 & (Ë
CURL_MASK_USHORT
);

316 #ifde‡
__INTEL_COMPILER


317 #¥agm®
	`w¨nög
(
p›
)

319 
	}
}

325 
ssize_t
 
	$cuæx_uztosz
(
size_t
 
uznum
)

327 #ifde‡
__INTEL_COMPILER


328 #¥agm®
	`w¨nög
(
push
)

329 #¥agm®
	`w¨nög
(
dißbÀ
:810)

332 
	`DEBUGASSERT
(
uznum
 <(
size_t
Ë
CURL_MASK_SSIZE_T
);

333  (
ssize_t
)(
uznum
 & (
size_t
Ë
CURL_MASK_SSIZE_T
);

335 #ifde‡
__INTEL_COMPILER


336 #¥agm®
	`w¨nög
(
p›
)

338 
	}
}

344 
size_t
 
	$cuæx_sŸouz
(
cuæ_off_t
 
s⁄um
)

346 #ifde‡
__INTEL_COMPILER


347 #¥agm®
	`w¨nög
(
push
)

348 #¥agm®
	`w¨nög
(
dißbÀ
:810)

351 
	`DEBUGASSERT
(
s⁄um
 >= 0);

352  (
size_t
)(
s⁄um
 & (
cuæ_off_t
Ë
CURL_MASK_USIZE_T
);

354 #ifde‡
__INTEL_COMPILER


355 #¥agm®
	`w¨nög
(
p›
)

357 
	}
}

363 
	$cuæx_sztosi
(
ssize_t
 
sznum
)

365 #ifde‡
__INTEL_COMPILER


366 #¥agm®
	`w¨nög
(
push
)

367 #¥agm®
	`w¨nög
(
dißbÀ
:810)

370 
	`DEBUGASSERT
(
sznum
 >= 0);

371 #i‡(
SIZEOF_INT
 < 
SIZEOF_SIZE_T
)

372 
	`DEBUGASSERT
((
size_t
Ë
sznum
 <(size_tË
CURL_MASK_SINT
);

374  ()(
sznum
 & (
ssize_t
Ë
CURL_MASK_SINT
);

376 #ifde‡
__INTEL_COMPILER


377 #¥agm®
	`w¨nög
(
p›
)

379 
	}
}

385 
size_t
 
	$cuæx_sôouz
(
söum
)

387 #ifde‡
__INTEL_COMPILER


388 #¥agm®
	`w¨nög
(
push
)

389 #¥agm®
	`w¨nög
(
dißbÀ
:810)

392 
	`DEBUGASSERT
(
söum
 >= 0);

393  (
size_t
Ë
söum
;

395 #ifde‡
__INTEL_COMPILER


396 #¥agm®
	`w¨nög
(
p›
)

398 
	}
}

400 #ifde‡
USE_WINSOCK


406 
	$cuæx_sktosi
(
cuæ_sockë_t
 
s
)

408  ()((
ssize_t
Ë
s
);

409 
	}
}

415 
cuæ_sockë_t
 
	$cuæx_sôosk
(
i
)

417  (
cuæ_sockë_t
)((
ssize_t
Ë
i
);

418 
	}
}

422 #i‡
deföed
(
WIN32
Ë|| deföed(
_WIN32
)

424 
ssize_t
 
	$cuæx_ªad
(
fd
, *
buf
, 
size_t
 
cou¡
)

426  (
ssize_t
)
	`ªad
(
fd
, 
buf
, 
	`cuæx_uztoui
(
cou¡
));

427 
	}
}

429 
ssize_t
 
	$cuæx_wrôe
(
fd
, c⁄° *
buf
, 
size_t
 
cou¡
)

431  (
ssize_t
)
	`wrôe
(
fd
, 
buf
, 
	`cuæx_uztoui
(
cou¡
));

432 
	}
}

436 #i‡
deföed
(
__INTEL_COMPILER
Ë&& deföed(
__unix__
)

438 
	$cuæx_FD_ISSET
(
fd
, 
fd_£t
 *
fd£t
)

440 #¥agm®
	`w¨nög
(
push
)

441 #¥agm®
	`w¨nög
(
dißbÀ
:1469)

442  
	`FD_ISSET
(
fd
, 
fd£t
);

443 #¥agm®
	`w¨nög
(
p›
)

444 
	}
}

446 
	$cuæx_FD_SET
(
fd
, 
fd_£t
 *
fd£t
)

448 #¥agm®
	`w¨nög
(
push
)

449 #¥agm®
	`w¨nög
(
dißbÀ
:1469)

450 
	`FD_SET
(
fd
, 
fd£t
);

451 #¥agm®
	`w¨nög
(
p›
)

452 
	}
}

454 
	$cuæx_FD_ZERO
(
fd_£t
 *
fd£t
)

456 #¥agm®
	`w¨nög
(
push
)

457 #¥agm®
	`w¨nög
(
dißbÀ
:593)

458 
	`FD_ZERO
(
fd£t
);

459 #¥agm®
	`w¨nög
(
p›
)

460 
	}
}

462 
	$cuæx_ht⁄s
(
u¢um
)

464 #i‡(
__INTEL_COMPILER
 =910Ë&& 
	`deföed
(
__i386__
)

465  ()(((
u¢um
 << 8) & 0xFF00) | ((usnum >> 8) & 0x00FF));

467 #¥agm®
	`w¨nög
(
push
)

468 #¥agm®
	`w¨nög
(
dißbÀ
:810)

469  
	`ht⁄s
(
u¢um
);

470 #¥agm®
	`w¨nög
(
p›
)

472 
	}
}

474 
	$cuæx_¡ohs
(
u¢um
)

476 #i‡(
__INTEL_COMPILER
 =910Ë&& 
	`deföed
(
__i386__
)

477  ()(((
u¢um
 << 8) & 0xFF00) | ((usnum >> 8) & 0x00FF));

479 #¥agm®
	`w¨nög
(
push
)

480 #¥agm®
	`w¨nög
(
dißbÀ
:810)

481  
	`¡ohs
(
u¢um
);

482 #¥agm®
	`w¨nög
(
p›
)

484 
	}
}

	@lib/warnless.h

1 #i‚de‡
HEADER_CURL_WARNLESS_H


2 
	#HEADER_CURL_WARNLESS_H


	)

25 #ifde‡
USE_WINSOCK


26 
	~<cuæ/cuæ.h
>

29 
cuæx_u…ous
(
u um
);

31 
cuæx_u…ouc
(
u um
);

33 
cuæx_u…osi
(
u um
);

35 
cuæx_uztosi
(
size_t
 
uznum
);

37 
cuæ_off_t
 
cuæx_uztoso
(
size_t
 
uznum
);

39 
cuæx_uztoul
(
size_t
 
uznum
);

41 
cuæx_uztoui
(
size_t
 
uznum
);

43 
cuæx_¶tosi
(
¶num
);

45 
cuæx_¶toui
(
¶num
);

47 
cuæx_¶tous
(
¶num
);

49 
ssize_t
 
cuæx_uztosz
(
size_t
 
uznum
);

51 
size_t
 
cuæx_sŸouz
(
cuæ_off_t
 
s⁄um
);

53 
cuæx_sztosi
(
ssize_t
 
sznum
);

55 
size_t
 
cuæx_sôouz
(
söum
);

57 #ifde‡
USE_WINSOCK


59 
cuæx_sktosi
(
cuæ_sockë_t
 
s
);

61 
cuæ_sockë_t
 
cuæx_sôosk
(
i
);

65 #i‡
deföed
(
WIN32
Ë|| deföed(
_WIN32
)

67 
ssize_t
 
cuæx_ªad
(
fd
, *
buf
, 
size_t
 
cou¡
);

69 
ssize_t
 
cuæx_wrôe
(
fd
, c⁄° *
buf
, 
size_t
 
cou¡
);

71 #i‚de‡
BUILDING_WARNLESS_C


72 #unde‡
ªad


73 
	#ªad
(
fd
, 
buf
, 
cou¡
Ë
	`cuæx_ªad
(fd, buf, cou¡)

	)

74 #unde‡
wrôe


75 
	#wrôe
(
fd
, 
buf
, 
cou¡
Ë
	`cuæx_wrôe
(fd, buf, cou¡)

	)

80 #i‡
deföed
(
__INTEL_COMPILER
Ë&& deföed(
__unix__
)

82 
cuæx_FD_ISSET
(
fd
, 
fd_£t
 *
fd£t
);

84 
cuæx_FD_SET
(
fd
, 
fd_£t
 *
fd£t
);

86 
cuæx_FD_ZERO
(
fd_£t
 *
fd£t
);

88 
cuæx_ht⁄s
(
u¢um
);

90 
cuæx_¡ohs
(
u¢um
);

92 #i‚de‡
BUILDING_WARNLESS_C


93 #unde‡
FD_ISSET


94 
	#FD_ISSET
(
a
,
b
Ë
	`cuæx_FD_ISSET
(◊),(b))

	)

95 #unde‡
FD_SET


96 
	#FD_SET
(
a
,
b
Ë
	`cuæx_FD_SET
(◊),(b))

	)

97 #unde‡
FD_ZERO


98 
	#FD_ZERO
(
a
Ë
	`cuæx_FD_ZERO
(◊))

	)

99 #unde‡
ht⁄s


100 
	#ht⁄s
(
a
Ë
	`cuæx_ht⁄s
(◊))

	)

101 #unde‡
¡ohs


102 
	#¡ohs
(
a
Ë
	`cuæx_¡ohs
(◊))

	)

	@lib/wildcard.c

23 
	~"cuæ_£tup.h
"

25 
	~"wûdˇrd.h
"

26 
	~"Œi°.h
"

27 
	~"fûeöfo.h
"

29 
	#_MPRINTF_REPLACE


	)

30 
	~<cuæ/m¥ötf.h
>

32 
	~"cuæ_mem‹y.h
"

34 
	~"memdebug.h
"

36 
CURLcode
 
	$Cuæ_wûdˇrd_öô
(
WûdˇrdD©a
 *
wc
)

38 
	`DEBUGASSERT
(
wc
->
fûñi°
 =
NULL
);

41 
wc
->
fûñi°
 = 
	`Cuæ_Œi°_Æloc
(
Cuæ_fûeöfo_dt‹
);

42 if(!
wc
->
fûñi°
) {;

43  
CURLE_OUT_OF_MEMORY
;

45  
CURLE_OK
;

46 
	}
}

48 
	$Cuæ_wûdˇrd_dt‹
(
WûdˇrdD©a
 *
wc
)

50 if(!
wc
)

53 if(
wc
->
tmp_dt‹
) {

54 
wc
->
	`tmp_dt‹
(wc->
tmp
);

55 
wc
->
tmp_dt‹
 = 
ZERO_NULL
;

56 
wc
->
tmp
 = 
NULL
;

58 
	`DEBUGASSERT
(
wc
->
tmp
 =
NULL
);

60 if(
wc
->
fûñi°
) {

61 
	`Cuæ_Œi°_de°roy
(
wc
->
fûñi°
, 
NULL
);

62 
wc
->
fûñi°
 = 
NULL
;

65 if(
wc
->
∑th
) {

66 
	`‰ì
(
wc
->
∑th
);

67 
wc
->
∑th
 = 
NULL
;

70 if(
wc
->
∑âîn
) {

71 
	`‰ì
(
wc
->
∑âîn
);

72 
wc
->
∑âîn
 = 
NULL
;

75 
wc
->
cu°om±r
 = 
NULL
;

76 
wc
->
°©e
 = 
CURLWC_INIT
;

77 
	}
}

	@lib/wildcard.h

1 #i‚de‡
HEADER_CURL_WILDCARD_H


2 
	#HEADER_CURL_WILDCARD_H


	)

25 
	~<cuæ/cuæ.h
>

29 
	mCURLWC_INIT
 = 0,

30 
	mCURLWC_MATCHING
,

32 
	mCURLWC_DOWNLOADING
,

33 
	mCURLWC_CLEAN
,

34 
	mCURLWC_SKIP
,

35 
	mCURLWC_ERROR
,

36 
	mCURLWC_DONE


38 } 
	tcuæ_wûdˇrd_°©es
;

40 (*
	tcuæ_wûdˇrd_tmp_dt‹
)(*
	t±r
);

43 
	sWûdˇrdD©a
 {

44 
cuæ_wûdˇrd_°©es
 
°©e
;

45 *
∑th
;

46 *
∑âîn
;

47 
cuæ_Œi°
 *
fûñi°
;

48 *
tmp
;

49 
cuæ_wûdˇrd_tmp_dt‹
 
tmp_dt‹
;

50 *
cu°om±r
;

53 
CURLcode
 
	`Cuæ_wûdˇrd_öô
(
WûdˇrdD©a
 *
wc
);

54 
	`Cuæ_wûdˇrd_dt‹
(
WûdˇrdD©a
 *
wc
);

56 
Sessi⁄H™dÀ
;

	@lib/x509asn1.c

23 
	~"cuæ_£tup.h
"

25 #i‡
deföed
(
USE_QSOSSL
Ë|| deföed(
USE_GSKIT
Ë|| deföed(
USE_NSS
)

27 
	~<cuæ/cuæ.h
>

28 
	~"uæd©a.h
"

29 
	~"°ªquÆ.h
"

30 
	~"ho°check.h
"

31 
	~"vés/vés.h
"

32 
	~"£ndf.h
"

33 
	~"öë_±⁄.h
"

34 
	~"cuæ_ba£64.h
"

35 
	~"x509a¢1.h
"

37 
	#_MPRINTF_REPLACE


	)

38 
	~<cuæ/m¥ötf.h
>

40 
	~"cuæ_mem‹y.h
"

42 
	~"memdebug.h
"

46 c⁄° 
	g˙OID
[] = "2.5.4.3";

47 c⁄° 
	gßnOID
[] = "2.5.29.17";

49 c⁄° 
cuæ_OID
 
	gOIDèbÀ
[] = {

68 { 
˙OID
, "CN" },

89 { 
ßnOID
, "subjectAltName" },

96 { (c⁄° *Ë
NULL
, (const *) NULL }

109 c⁄° * 
	$Cuæ_gëASN1EÀmít
(
cuæ_a¢1EÀmít
 * 
ñem
,

110 c⁄° * 
beg
, c⁄° * 
íd
)

112 
b
;

113 
Àn
;

114 
cuæ_a¢1EÀmít
 
ÀÀm
;

121 if(
beg
 >
íd
 || !*beg)

122  (c⁄° *Ë
NULL
;

125 
b
 = (Ë*
beg
++;

126 
ñem
->
c⁄°ru˘ed
 = (
b
 & 0x20) != 0;

127 
ñem
->
˛ass
 = (
b
 >> 6) & 3;

128 
b
 &= 0x1F;

129 if(
b
 == 0x1F)

130  (c⁄° *Ë
NULL
;

131 
ñem
->
èg
 = 
b
;

134 if(
beg
 >
íd
)

135  (c⁄° *Ë
NULL
;

136 
b
 = (Ë*
beg
++;

137 if(!(
b
 & 0x80))

138 
Àn
 = 
b
;

139 if(!(
b
 &= 0x7F)) {

142 if(!
ñem
->
c⁄°ru˘ed
)

143  (c⁄° *Ë
NULL
;

144 
ñem
->
beg
 = beg;

145 
beg
 < 
íd
 && *beg) {

146 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
ÀÀm
, beg, 
íd
);

147 if(!
beg
)

148  (c⁄° *Ë
NULL
;

150 if(
beg
 >
íd
)

151  (c⁄° *Ë
NULL
;

152 
ñem
->
íd
 = 
beg
;

153  
beg
 + 1;

155 if(
beg
 + 
b
 > 
íd
)

156  (c⁄° *Ë
NULL
;

159 
Àn
 = 0;

161 if(
Àn
 & 0xFF000000L)

162  (c⁄° *Ë
NULL
;

163 
Àn
 = (À¿<< 8Ë| (Ë*
beg
++;

164 } --
b
);

166 if((Ë(
íd
 - 
beg
Ë< 
Àn
)

167  (c⁄° *Ë
NULL
;

168 
ñem
->
beg
 = beg;

169 
ñem
->
íd
 = 
beg
 + 
Àn
;

170  
ñem
->
íd
;

171 
	}
}

173 c⁄° 
cuæ_OID
 * 
	$£¨chOID
(c⁄° * 
oid
)

175 c⁄° 
cuæ_OID
 * 
›
;

180 
›
 = 
OIDèbÀ
; op->
numoid
; op++)

181 if(!
	`°rcmp
(
›
->
numoid
, 
oid
Ë|| 
	`cuæ_°ªquÆ
(›->
ãxtoid
, oid))

182  
›
;

184  (c⁄° 
cuæ_OID
 *Ë
NULL
;

185 
	}
}

187 c⁄° * 
	$boﬁ2°r
(c⁄° * 
beg
, c⁄° * 
íd
)

193 if(
íd
 - 
beg
 != 1)

194  (c⁄° *Ë
NULL
;

195  
	`°rdup
(*
beg
? "TRUE": "FALSE");

196 
	}
}

198 c⁄° * 
	$o˘ë2°r
(c⁄° * 
beg
, c⁄° * 
íd
)

200 
size_t
 
n
 = 
íd
 - 
beg
;

201 * 
buf
;

206 
buf
 = 
	`mÆloc
(3 * 
n
 + 1);

207 if(
buf
)

208 
n
 = 0; 
beg
 < 
íd
;Ç += 3)

209 
	`¢¥ötf
(
buf
 + 
n
, 4, "%02x:", *(c⁄° *Ë
beg
++);

210  
buf
;

211 
	}
}

213 c⁄° * 
	$bô2°r
(c⁄° * 
beg
, c⁄° * 
íd
)

219 if(++
beg
 > 
íd
)

220  (c⁄° *Ë
NULL
;

221  
	`o˘ë2°r
(
beg
, 
íd
);

222 
	}
}

224 c⁄° * 
	$öt2°r
(c⁄° * 
beg
, c⁄° * 
íd
)

226 
vÆ
 = 0;

227 
size_t
 
n
 = 
íd
 - 
beg
;

233 if(!
n
)

234  (c⁄° *Ë
NULL
;

236 if(
n
 > 4)

237  
	`o˘ë2°r
(
beg
, 
íd
);

240 if(*
beg
 & 0x80)

241 
vÆ
 = ~val;

244 
vÆ
 = (vÆ << 8Ë| *(c⁄° *Ë
beg
++;

245 
beg
 < 
íd
);

246  
	`cuæ_m≠rötf
("%s%lx", (
vÆ
 < 0 || val >= 10)? "0x": "", val);

247 
	}
}

249 
ssize_t


250 
	$utf8a¢1°r
(* * 
to
, 
ty≥
, c⁄° * 
‰om
, c⁄° * 
íd
)

252 
size_t
 
öÀngth
 = 
íd
 - 
‰om
;

253 
size
 = 1;

254 
size_t
 
ouéígth
;

255 
ch¨size
;

256 
wc
;

257 * 
buf
;

265 *
to
 = (*Ë
NULL
;

266 
ty≥
) {

267 
CURL_ASN1_BMP_STRING
:

268 
size
 = 2;

270 
CURL_ASN1_UNIVERSAL_STRING
:

271 
size
 = 4;

273 
CURL_ASN1_NUMERIC_STRING
:

274 
CURL_ASN1_PRINTABLE_STRING
:

275 
CURL_ASN1_TELETEX_STRING
:

276 
CURL_ASN1_IA5_STRING
:

277 
CURL_ASN1_VISIBLE_STRING
:

278 
CURL_ASN1_UTF8_STRING
:

284 if(
öÀngth
 % 
size
)

286 
buf
 = 
	`mÆloc
(4 * (
öÀngth
 / 
size
) + 1);

287 if(!
buf
)

290 if(
ty≥
 =
CURL_ASN1_UTF8_STRING
) {

292 
ouéígth
 = 
öÀngth
;

293 if(
ouéígth
)

294 
	`mem˝y
(
buf
, 
‰om
, 
ouéígth
);

297 
ouéígth
 = 0; 
‰om
 < 
íd
;) {

298 
wc
 = 0;

299 
size
) {

301 
wc
 = (w¯<< 8Ë| *(c⁄° *Ë
‰om
++;

302 
wc
 = (w¯<< 8Ë| *(c⁄° *Ë
‰om
++;

304 
wc
 = (w¯<< 8Ë| *(c⁄° *Ë
‰om
++;

306 
wc
 = (w¯<< 8Ë| *(c⁄° *Ë
‰om
++;

308 
ch¨size
 = 1;

309 if(
wc
 >= 0x00000080) {

310 if(
wc
 >= 0x00000800) {

311 if(
wc
 >= 0x00010000) {

312 if(
wc
 >= 0x00200000) {

313 
	`‰ì
(
buf
);

316 
buf
[
ouéígth
 + 3] = (Ë(0x80 | (
wc
 & 0x3F));

317 
wc
 = (wc >> 6) | 0x00010000;

318 
ch¨size
++;

320 
buf
[
ouéígth
 + 2] = (Ë(0x80 | (
wc
 & 0x3F));

321 
wc
 = (wc >> 6) | 0x00000800;

322 
ch¨size
++;

324 
buf
[
ouéígth
 + 1] = (Ë(0x80 | (
wc
 & 0x3F));

325 
wc
 = (wc >> 6) | 0x000000C0;

326 
ch¨size
++;

328 
buf
[
ouéígth
] = (Ë
wc
;

329 
ouéígth
 +
ch¨size
;

332 
buf
[
ouéígth
] = '\0';

333 *
to
 = 
buf
;

334  
ouéígth
;

335 
	}
}

337 c⁄° * 
	$°rög2°r
(
ty≥
, c⁄° * 
beg
, c⁄° * 
íd
)

339 * 
buf
;

344 if(
	`utf8a¢1°r
(&
buf
, 
ty≥
, 
beg
, 
íd
) < 0)

345  (c⁄° *Ë
NULL
;

346  
buf
;

347 
	}
}

349 
	$ícodeUöt
(* 
buf
, 
n
, 
x
)

351 
i
 = 0;

352 
y
 = 
x
 / 10;

357 if(
y
) {

358 
i
 +
	`ícodeUöt
(
buf
, 
n
, 
y
);

359 
x
 -
y
 * 10;

361 if(
i
 < 
n
)

362 
buf
[
i
] = (Ë('0' + 
x
);

363 
i
++;

364 if(
i
 < 
n
)

365 
buf
[
i
] = '\0';

366  
i
;

367 
	}
}

369 
	$ícodeOID
(* 
buf
, 
n
, c⁄° * 
beg
, c⁄° * 
íd
)

371 
i
 = 0;

372 
x
;

373 
y
;

380 
y
 = *(c⁄° *Ë
beg
++;

381 
x
 = 
y
 / 40;

382 
y
 -
x
 * 40;

383 
i
 +
	`ícodeUöt
(
buf
 + i, 
n
 - i, 
x
);

384 if(
i
 < 
n
)

385 
buf
[
i
] = '.';

386 
i
++;

387 
i
 +
	`ícodeUöt
(
buf
 + i, 
n
 - i, 
y
);

390 
beg
 < 
íd
) {

391 if(
i
 < 
n
)

392 
buf
[
i
] = '.';

393 
i
++;

394 
x
 = 0;

396 if(
x
 & 0xFF000000)

398 
y
 = *(c⁄° *Ë
beg
++;

399 
x
 = (x << 7Ë| (
y
 & 0x7F);

400 } 
y
 & 0x80);

401 
i
 +
	`ícodeUöt
(
buf
 + i, 
n
 - i, 
x
);

403 if(
i
 < 
n
)

404 
buf
[
i
] = '\0';

405  
i
;

406 
	}
}

408 c⁄° * 
	$OID2°r
(c⁄° * 
beg
, c⁄° * 
íd
, 
boﬁ
 
symbﬁic
)

410 * 
buf
 = (*Ë
NULL
;

411 c⁄° 
cuæ_OID
 * 
›
;

412 
n
;

417 if(
beg
 < 
íd
) {

418 
n
 = 
	`ícodeOID
((*Ë
NULL
, -1, 
beg
, 
íd
);

419 if(
n
 >= 0) {

420 
buf
 = 
	`mÆloc
(
n
 + 1);

421 if(
buf
) {

422 
	`ícodeOID
(
buf
, 
n
, 
beg
, 
íd
);

423 
buf
[
n
] = '\0';

425 if(
symbﬁic
) {

426 
›
 = 
	`£¨chOID
(
buf
);

427 if(
›
) {

428 
	`‰ì
(
buf
);

429 
buf
 = 
	`°rdup
(
›
->
ãxtoid
);

435  
buf
;

436 
	}
}

438 c⁄° * 
	$GTime2°r
(c⁄° * 
beg
, c⁄° * 
íd
)

440 c⁄° * 
tzp
;

441 c⁄° * 
‰a˝
;

442 
£c1
, 
£c2
;

443 
size_t
 
‰a˛
;

444 
size_t
 
tzl
;

445 c⁄° * 
£p
 = "";

450 
‰a˝
 = 
beg
; fø˝ < 
íd
 && *fracp >= '0' && *fracp <= '9'; fracp++)

454 
£c1
 = '0';

455 
‰a˝
 - 
beg
 - 12) {

457 
£c2
 = '0';

460 
£c1
 = 
‰a˝
[-2];

462 
£c2
 = 
‰a˝
[-1];

465  (c⁄° *Ë
NULL
;

469 
tzp
 = 
‰a˝
;

470 
‰a˛
 = 0;

471 if(
‰a˝
 < 
íd
 && (*fracp == '.' || *fracp == ',')) {

472 
‰a˝
++;

474 
tzp
++;

475 
tzp
 < 
íd
 && *tzp >= '0' && *tzp <= '9');

477 
‰a˛
 = 
tzp
 - 
‰a˝
 - 1; fracl && fracp[fracl - 1] == '0'; fracl--)

482 if(
tzp
 >
íd
)

484 if(*
tzp
 == 'Z') {

485 
tzp
 = " GMT";

486 
íd
 = 
tzp
 + 4;

489 
£p
 = " ";

490 
tzp
++;

493 
tzl
 = 
íd
 - 
tzp
;

494  
	`cuæ_m≠rötf
("%.4s-%.2s-%.2s %.2s:%.2s:%c%c%s%.*s%s%.*s",

495 
beg
, beg + 4, beg + 6,

496 
beg
 + 8, beg + 10, 
£c1
, 
£c2
,

497 
‰a˛
? ".": "", fø˛, 
‰a˝
,

498 
£p
, 
tzl
, 
tzp
);

499 
	}
}

501 c⁄° * 
	$UTime2°r
(c⁄° * 
beg
, c⁄° * 
íd
)

503 c⁄° * 
tzp
;

504 
size_t
 
tzl
;

505 c⁄° * 
£c
;

510 
tzp
 = 
beg
;Åz∞< 
íd
 && *tzp >= '0' && *tzp <= '9';Åzp++)

513 
£c
 = 
beg
 + 10;

514 
tzp
 - 
£c
) {

516 
£c
 = "00";

520  (c⁄° *Ë
NULL
;

524 if(
tzp
 >
íd
)

525  (c⁄° *Ë
NULL
;

526 if(*
tzp
 == 'Z') {

527 
tzp
 = "GMT";

528 
íd
 = 
tzp
 + 3;

531 
tzp
++;

533 
tzl
 = 
íd
 - 
tzp
;

534  
	`cuæ_m≠rötf
("%u%.2s-%.2s-%.2s %.2s:%.2s:%.2s %.*s",

535 20 - (*
beg
 >= '5'), beg, beg + 2, beg + 4,

536 
beg
 + 6, beg + 8, 
£c
,

537 
tzl
, 
tzp
);

538 
	}
}

540 c⁄° * 
	$Cuæ_ASN1to°r
(
cuæ_a¢1EÀmít
 * 
ñem
, 
ty≥
)

542 c⁄° 
zîo
 = '\0';

547 if(
ñem
->
c⁄°ru˘ed
)

548  (c⁄° *Ë
NULL
;

550 if(!
ty≥
)

551 
ty≥
 = 
ñem
->
èg
;

553 
ty≥
) {

554 
CURL_ASN1_BOOLEAN
:

555  
	`boﬁ2°r
(
ñem
->
beg
,ÉÀm->
íd
);

556 
CURL_ASN1_INTEGER
:

557 
CURL_ASN1_ENUMERATED
:

558  
	`öt2°r
(
ñem
->
beg
,ÉÀm->
íd
);

559 
CURL_ASN1_BIT_STRING
:

560  
	`bô2°r
(
ñem
->
beg
,ÉÀm->
íd
);

561 
CURL_ASN1_OCTET_STRING
:

562  
	`o˘ë2°r
(
ñem
->
beg
,ÉÀm->
íd
);

563 
CURL_ASN1_NULL
:

564  
	`°rdup
(&
zîo
);

565 
CURL_ASN1_OBJECT_IDENTIFIER
:

566  
	`OID2°r
(
ñem
->
beg
,ÉÀm->
íd
, 
TRUE
);

567 
CURL_ASN1_UTC_TIME
:

568  
	`UTime2°r
(
ñem
->
beg
,ÉÀm->
íd
);

569 
CURL_ASN1_GENERALIZED_TIME
:

570  
	`GTime2°r
(
ñem
->
beg
,ÉÀm->
íd
);

571 
CURL_ASN1_UTF8_STRING
:

572 
CURL_ASN1_NUMERIC_STRING
:

573 
CURL_ASN1_PRINTABLE_STRING
:

574 
CURL_ASN1_TELETEX_STRING
:

575 
CURL_ASN1_IA5_STRING
:

576 
CURL_ASN1_VISIBLE_STRING
:

577 
CURL_ASN1_UNIVERSAL_STRING
:

578 
CURL_ASN1_BMP_STRING
:

579  
	`°rög2°r
(
ty≥
, 
ñem
->
beg
,ÉÀm->
íd
);

582  (c⁄° *Ë
NULL
;

583 
	}
}

585 
ssize_t
 
	$ícodeDN
(* 
buf
, 
size_t
 
n
, 
cuæ_a¢1EÀmít
 * 
dn
)

587 
cuæ_a¢1EÀmít
 
rdn
;

588 
cuæ_a¢1EÀmít
 
©v
;

589 
cuæ_a¢1EÀmít
 
oid
;

590 
cuæ_a¢1EÀmít
 
vÆue
;

591 
size_t
 
l
 = 0;

592 c⁄° * 
p1
;

593 c⁄° * 
p2
;

594 c⁄° * 
p3
;

595 c⁄° * 
°r
;

600 
p1
 = 
dn
->
beg
;Ö1 < dn->
íd
;) {

601 
p1
 = 
	`Cuæ_gëASN1EÀmít
(&
rdn
,Ö1, 
dn
->
íd
);

602 
p2
 = 
rdn
.
beg
;Ö2 <Ñdn.
íd
;) {

603 
p2
 = 
	`Cuæ_gëASN1EÀmít
(&
©v
,Ö2, 
rdn
.
íd
);

604 
p3
 = 
	`Cuæ_gëASN1EÀmít
(&
oid
, 
©v
.
beg
,átv.
íd
);

605 
	`Cuæ_gëASN1EÀmít
(&
vÆue
, 
p3
, 
©v
.
íd
);

606 
°r
 = 
	`Cuæ_ASN1to°r
(&
oid
, 0);

607 if(!
°r
)

612 if(
l
) {

613 
p3
 = 
°r
; 
	`isuµî
(*p3);Ö3++)

615 
p3
 = (*p3 ||Ö3 - 
°r
 > 2)? "/": ", "; *p3;Ö3++) {

616 if(
l
 < 
n
)

617 
buf
[
l
] = *
p3
;

618 
l
++;

623 
p3
 = 
°r
; *p3;Ö3++) {

624 if(
l
 < 
n
)

625 
buf
[
l
] = *
p3
;

626 
l
++;

628 
	`‰ì
((*Ë
°r
);

631 if(
l
 < 
n
)

632 
buf
[
l
] = '=';

633 
l
++;

636 
°r
 = 
	`Cuæ_ASN1to°r
(&
vÆue
, 0);

637 if(!
°r
)

639 
p3
 = 
°r
; *p3;Ö3++) {

640 if(
l
 < 
n
)

641 
buf
[
l
] = *
p3
;

642 
l
++;

644 
	`‰ì
((*Ë
°r
);

648  
l
;

649 
	}
}

651 c⁄° * 
	$Cuæ_DNto°r
(
cuæ_a¢1EÀmít
 * 
dn
)

653 * 
buf
 = (*Ë
NULL
;

654 
ssize_t
 
n
 = 
	`ícodeDN
(
buf
, 0, 
dn
);

659 if(
n
 >= 0) {

660 
buf
 = 
	`mÆloc
(
n
 + 1);

661 if(
buf
) {

662 
	`ícodeDN
(
buf
, 
n
 + 1, 
dn
);

663 
buf
[
n
] = '\0';

666  (c⁄° *Ë
buf
;

667 
	}
}

673 
	$Cuæ_∑r£X509
(
cuæ_X509˚πifiˇã
 * 
˚π
,

674 c⁄° * 
beg
, c⁄° * 
íd
)

676 
cuæ_a¢1EÀmít
 
ñem
;

677 
cuæ_a¢1EÀmít
 
tbsCîtifiˇã
;

678 c⁄° * 
c˝
;

679 c⁄° 
deÁu…Vîsi⁄
 = 0;

685 
˚π
->
˚πifiˇã
.
beg
 = beg;

686 
˚π
->
˚πifiˇã
.
íd
 =Énd;

689 
	`Cuæ_gëASN1EÀmít
(&
ñem
, 
beg
, 
íd
);

690 
beg
 = 
ñem
.beg;

691 
íd
 = 
ñem
.end;

694 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
tbsCîtifiˇã
, beg, 
íd
);

696 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
sig«tuªAlg‹ôhm
, beg, 
íd
);

698 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
sig«tuª
, 
beg
, 
íd
);

701 
beg
 = 
tbsCîtifiˇã
.beg;

702 
íd
 = 
tbsCîtifiˇã
.end;

704 
˚π
->
vîsi⁄
.
beg
 = &
deÁu…Vîsi⁄
;

705 
˚π
->
vîsi⁄
.
íd
 = &
deÁu…Vîsi⁄
 +  defaultVersion;;

706 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
, beg, 
íd
);

707 if(
ñem
.
èg
 == 0) {

708 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
vîsi⁄
, 
ñem
.
beg
,ÉÀm.
íd
);

709 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
, beg, 
íd
);

711 
˚π
->
£rülNumbî
 = 
ñem
;

713 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
sig«tuªAlg‹ôhm
, beg, 
íd
);

715 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
issuî
, beg, 
íd
);

717 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
, beg, 
íd
);

718 
c˝
 = 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
nŸBef‹e
, 
ñem
.
beg
,ÉÀm.
íd
);

719 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
nŸA·î
, 
c˝
, 
ñem
.
íd
);

721 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
subje˘
, beg, 
íd
);

723 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
, beg, 
íd
);

724 
c˝
 = 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
subje˘PublicKeyAlg‹ôhm
,

725 
ñem
.
beg
,ÉÀm.
íd
);

726 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
subje˘PublicKey
, 
c˝
, 
ñem
.
íd
);

728 
˚π
->
issuîUniqueID
.
èg
 = cît->
subje˘UniqueID
.tag = 0;

729 
˚π
->
exãnsi⁄s
.
èg
 = 
ñem
.tag = 0;

730 
˚π
->
issuîUniqueID
.
beg
 = cît->issuîUniqueID.
íd
 = "";

731 
˚π
->
subje˘UniqueID
.
beg
 = cît->subje˘UniqueID.
íd
 = "";

732 
˚π
->
exãnsi⁄s
.
beg
 = cît->exãnsi⁄s.
íd
 = "";

733 if(
beg
 < 
íd
)

734 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
, beg, 
íd
);

735 if(
ñem
.
èg
 == 1) {

736 
˚π
->
issuîUniqueID
 = 
ñem
;

737 if(
beg
 < 
íd
)

738 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
, beg, 
íd
);

740 if(
ñem
.
èg
 == 2) {

741 
˚π
->
subje˘UniqueID
 = 
ñem
;

742 if(
beg
 < 
íd
)

743 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
, beg, 
íd
);

745 if(
ñem
.
èg
 == 3)

746 
	`Cuæ_gëASN1EÀmít
(&
˚π
->
exãnsi⁄s
, 
ñem
.
beg
,ÉÀm.
íd
);

747 
	}
}

749 
size_t
 
	$c›ySub°rög
(* 
to
, c⁄° * 
‰om
)

751 
size_t
 
i
;

756 
i
 = 0; i < 64; i++) {

757 
to
[
i
] = *
‰om
;

758 if(!*
‰om
++)

762 
to
[
i
++] = '\n';

763  
i
;

764 
	}
}

766 c⁄° * 
	$dumpAlgo
(
cuæ_a¢1EÀmít
 * 
∑øm
,

767 c⁄° * 
beg
, c⁄° * 
íd
)

769 
cuæ_a¢1EÀmít
 
oid
;

773 
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
oid
, beg, 
íd
);

774 
∑øm
->
èg
 = 0;

775 
∑øm
->
beg
 =Ö¨am->
íd
 =Énd;

776 if(
beg
 < 
íd
)

777 
	`Cuæ_gëASN1EÀmít
(
∑øm
, 
beg
, 
íd
);

778  
	`OID2°r
(
oid
.
beg
, oid.
íd
, 
TRUE
);

779 
	}
}

781 
	$do_pubkey_fõld
(
Sessi⁄H™dÀ
 * 
d©a
, 
˚πnum
,

782 c⁄° * 
œbñ
, 
cuæ_a¢1EÀmít
 * 
ñem
)

784 c⁄° * 
ouçut
;

788 
ouçut
 = 
	`Cuæ_ASN1to°r
(
ñem
, 0);

789 if(
ouçut
) {

790 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

791 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, 
œbñ
, 
ouçut
);

792 if(!
˚πnum
)

793 
	`öfof
(
d©a
, " %s: %s\n", 
œbñ
, 
ouçut
);

794 
	`‰ì
((*Ë
ouçut
);

796 
	}
}

798 
	$do_pubkey
(
Sessi⁄H™dÀ
 * 
d©a
, 
˚πnum
,

799 c⁄° * 
Ægo
, 
cuæ_a¢1EÀmít
 * 
∑øm
,

800 
cuæ_a¢1EÀmít
 * 
pubkey
)

802 
cuæ_a¢1EÀmít
 
ñem
;

803 
cuæ_a¢1EÀmít
 
pk
;

804 c⁄° * 
p
;

805 c⁄° * 
q
;

806 
Àn
;

807 
i
;

812 
	`Cuæ_gëASN1EÀmít
(&
pk
, 
pubkey
->
beg
 + 1,Öubkey->
íd
);

814 if(
	`cuæ_°ªquÆ
(
Ægo
, "rsaEncryption")) {

815 
p
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
, 
pk
.
beg
,Ök.
íd
);

817 
q
 = 
ñem
.
beg
; !*q && q <ÉÀm.
íd
; q++)

819 
Àn
 = (
ñem
.
íd
 - 
q
) * 8;

820 if(
Àn
)

821 
i
 = *(*Ë
q
; !(i & 0x80); i <<= 1)

822 
Àn
--;

823 if(
Àn
 > 32)

824 
ñem
.
beg
 = 
q
;

825 if(!
˚πnum
)

826 
	`öfof
(
d©a
, " RSA Publi¯Key (%lu bôs)\n", 
Àn
);

827 if(
d©a
->
£t
.
s¶
.
˚πöfo
) {

828 
q
 = 
	`cuæ_m≠rötf
("%lu", 
Àn
);

829 if(
q
) {

830 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "RSA Publi¯Key", 
q
);

831 
	`‰ì
((*Ë
q
);

835 
	`do_pubkey_fõld
(
d©a
, 
˚πnum
, "rß“)", &
ñem
);

836 
	`Cuæ_gëASN1EÀmít
(&
ñem
, 
p
, 
pk
.
íd
);

837 
	`do_pubkey_fõld
(
d©a
, 
˚πnum
, "rß”)", &
ñem
);

839 if(
	`cuæ_°ªquÆ
(
Ægo
, "dsa")) {

840 
p
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
, 
∑øm
->
beg
,Ö¨am->
íd
);

841 
	`do_pubkey_fõld
(
d©a
, 
˚πnum
, "dß’)", &
ñem
);

842 
p
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
,Ö, 
∑øm
->
íd
);

843 
	`do_pubkey_fõld
(
d©a
, 
˚πnum
, "dß(q)", &
ñem
);

844 
	`Cuæ_gëASN1EÀmít
(&
ñem
, 
p
, 
∑øm
->
íd
);

845 
	`do_pubkey_fõld
(
d©a
, 
˚πnum
, "dß(g)", &
ñem
);

846 
	`do_pubkey_fõld
(
d©a
, 
˚πnum
, "dß’ub_key)", &
pk
);

848 if(
	`cuæ_°ªquÆ
(
Ægo
, "dhpublicnumber")) {

849 
p
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
, 
∑øm
->
beg
,Ö¨am->
íd
);

850 
	`do_pubkey_fõld
(
d©a
, 
˚πnum
, "dh’)", &
ñem
);

851 
	`Cuæ_gëASN1EÀmít
(&
ñem
, 
∑øm
->
beg
,Ö¨am->
íd
);

852 
	`do_pubkey_fõld
(
d©a
, 
˚πnum
, "dh(g)", &
ñem
);

853 
	`do_pubkey_fõld
(
d©a
, 
˚πnum
, "dh’ub_key)", &
pk
);

856 if(
	`cuæ_°ªquÆ
(
Ægo
, "ecPublicKey")) {

860 
	}
}

862 
CURLcode
 
	$Cuæ_exåa˘_˚πöfo
(
c⁄√˘d©a
 * 
c⁄n
,

863 
˚πnum
,

864 c⁄° * 
beg
,

865 c⁄° * 
íd
)

867 
cuæ_X509˚πifiˇã
 
˚π
;

868 
Sessi⁄H™dÀ
 * 
d©a
 = 
c⁄n
->data;

869 
cuæ_a¢1EÀmít
 
∑øm
;

870 c⁄° * 
c˝
;

871 * 
˝1
;

872 
size_t
 
˛1
;

873 * 
˝2
;

874 
CURLcode
 
cc
;

875 
vîsi⁄
;

876 
size_t
 
i
;

877 
size_t
 
j
;

879 if(!
d©a
->
£t
.
s¶
.
˚πöfo
)

880 if(
˚πnum
)

881  
CURLE_OK
;

886 
	`Cuæ_∑r£X509
(&
˚π
, 
beg
, 
íd
);

889 
c˝
 = 
	`Cuæ_DNto°r
(&
˚π
.
subje˘
);

890 if(!
c˝
)

891  
CURLE_OUT_OF_MEMORY
;

892 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

893 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "Subje˘", 
c˝
);

894 if(!
˚πnum
)

895 
	`öfof
(
d©a
, "%2d Subje˘: %s\n", 
˚πnum
, 
c˝
);

896 
	`‰ì
((*Ë
c˝
);

899 
c˝
 = 
	`Cuæ_DNto°r
(&
˚π
.
issuî
);

900 if(!
c˝
)

901  
CURLE_OUT_OF_MEMORY
;

902 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

903 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "Issuî", 
c˝
);

904 if(!
˚πnum
)

905 
	`öfof
(
d©a
, " Issuî: %s\n", 
c˝
);

906 
	`‰ì
((*Ë
c˝
);

909 
vîsi⁄
 = 0;

910 
c˝
 = 
˚π
.
vîsi⁄
.
beg
; c˝ < cît.vîsi⁄.
íd
; ccp++)

911 
vîsi⁄
 = (vîsi⁄ << 8Ë| *(c⁄° *Ë
c˝
;

912 if(
d©a
->
£t
.
s¶
.
˚πöfo
) {

913 
c˝
 = 
	`cuæ_m≠rötf
("%lx", 
vîsi⁄
);

914 if(!
c˝
)

915  
CURLE_OUT_OF_MEMORY
;

916 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "Vîsi⁄", 
c˝
);

917 
	`‰ì
((*Ë
c˝
);

919 if(!
˚πnum
)

920 
	`öfof
(
d©a
, " Vîsi⁄: %lu (0x%lx)\n", 
vîsi⁄
 + 1, version);

923 
c˝
 = 
	`Cuæ_ASN1to°r
(&
˚π
.
£rülNumbî
, 0);

924 if(!
c˝
)

925  
CURLE_OUT_OF_MEMORY
;

926 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

927 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "Sîü»Numbî", 
c˝
);

928 if(!
˚πnum
)

929 
	`öfof
(
d©a
, " Sîü»Numbî: %s\n", 
c˝
);

930 
	`‰ì
((*Ë
c˝
);

933 
c˝
 = 
	`dumpAlgo
(&
∑øm
, 
˚π
.
sig«tuªAlg‹ôhm
.
beg
,

934 
˚π
.
sig«tuªAlg‹ôhm
.
íd
);

935 if(!
c˝
)

936  
CURLE_OUT_OF_MEMORY
;

937 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

938 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "Sig«tuª Alg‹ôhm", 
c˝
);

939 if(!
˚πnum
)

940 
	`öfof
(
d©a
, " Sig«tuª Alg‹ôhm: %s\n", 
c˝
);

941 
	`‰ì
((*Ë
c˝
);

944 
c˝
 = 
	`Cuæ_ASN1to°r
(&
˚π
.
nŸBef‹e
, 0);

945 if(!
c˝
)

946  
CURLE_OUT_OF_MEMORY
;

947 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

948 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "Sèπ D©e", 
c˝
);

949 if(!
˚πnum
)

950 
	`öfof
(
d©a
, " Sèπ D©e: %s\n", 
c˝
);

951 
	`‰ì
((*Ë
c˝
);

954 
c˝
 = 
	`Cuæ_ASN1to°r
(&
˚π
.
nŸA·î
, 0);

955 if(!
c˝
)

956  
CURLE_OUT_OF_MEMORY
;

957 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

958 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "ExpúêD©e", 
c˝
);

959 if(!
˚πnum
)

960 
	`öfof
(
d©a
, " ExpúêD©e: %s\n", 
c˝
);

961 
	`‰ì
((*Ë
c˝
);

964 
c˝
 = 
	`dumpAlgo
(&
∑øm
, 
˚π
.
subje˘PublicKeyAlg‹ôhm
.
beg
,

965 
˚π
.
subje˘PublicKeyAlg‹ôhm
.
íd
);

966 if(!
c˝
)

967  
CURLE_OUT_OF_MEMORY
;

968 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

969 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "Publi¯Key Alg‹ôhm", 
c˝
);

970 if(!
˚πnum
)

971 
	`öfof
(
d©a
, " Publi¯Key Alg‹ôhm: %s\n", 
c˝
);

972 
	`do_pubkey
(
d©a
, 
˚πnum
, 
c˝
, &
∑øm
, &
˚π
.
subje˘PublicKey
);

973 
	`‰ì
((*Ë
c˝
);

978 
c˝
 = 
	`Cuæ_ASN1to°r
(&
˚π
.
sig«tuª
, 0);

979 if(!
c˝
)

980  
CURLE_OUT_OF_MEMORY
;

981 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

982 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "Sig«tuª", 
c˝
);

983 if(!
˚πnum
)

984 
	`öfof
(
d©a
, " Sig«tuª: %s\n", 
c˝
);

985 
	`‰ì
((*Ë
c˝
);

988 
cc
 = 
	`Cuæ_ba£64_ícode
(
d©a
, 
˚π
.
˚πifiˇã
.
beg
,

989 
˚π
.
˚πifiˇã
.
íd
 - cît.˚πifiˇã.
beg
,

990 &
˝1
, &
˛1
);

991 if(
cc
 !
CURLE_OK
)

992  
cc
;

1001 
i
 = 28 + 
˛1
 + (cl1 + 64 - 1) / 64 + 26;

1002 
˝2
 = 
	`mÆloc
(
i
 + 1);

1003 if(!
˝2
) {

1004 
	`‰ì
(
˝1
);

1005  
CURLE_OUT_OF_MEMORY
;

1008 
i
 = 
	`c›ySub°rög
(
˝2
, "-----BEGIN CERTIFICATE-----");

1009 
j
 = 0; j < 
˛1
; j += 64)

1010 
i
 +
	`c›ySub°rög
(
˝2
 + i, 
˝1
 + 
j
);

1011 
i
 +
	`c›ySub°rög
(
˝2
 + i, "-----END CERTIFICATE-----");

1012 
˝2
[
i
] = '\0';

1013 
	`‰ì
(
˝1
);

1014 if(
d©a
->
£t
.
s¶
.
˚πöfo
)

1015 
	`Cuæ_s¶_push_˚πöfo
(
d©a
, 
˚πnum
, "Cît", 
˝2
);

1016 if(!
˚πnum
)

1017 
	`öfof
(
d©a
, "%s\n", 
˝2
);

1018 
	`‰ì
(
˝2
);

1019  
CURLE_OK
;

1020 
	}
}

1024 #i‡
deföed
(
USE_QSOSSL
Ë|| deföed(
USE_GSKIT
)

1026 c⁄° * 
	$checkOID
(c⁄° * 
beg
, c⁄° * 
íd
,

1027 c⁄° * 
oid
)

1029 
cuæ_a¢1EÀmít
 
e
;

1030 c⁄° * 
c˝
;

1031 c⁄° * 
p
;

1032 
boﬁ
 
m©ched
;

1037 
c˝
 = 
	`Cuæ_gëASN1EÀmít
(&
e
, 
beg
, 
íd
);

1038 if(!
c˝
 || 
e
.
èg
 !
CURL_ASN1_OBJECT_IDENTIFIER
)

1039  (c⁄° *Ë
NULL
;

1041 
p
 = 
	`OID2°r
(
e
.
beg
,É.
íd
, 
FALSE
);

1042 if(!
p
)

1043  (c⁄° *Ë
NULL
;

1045 
m©ched
 = !
	`°rcmp
(
p
, 
oid
);

1046 
	`‰ì
((*Ë
p
);

1047  
m©ched
? 
c˝
: (c⁄° *Ë
NULL
;

1048 
	}
}

1050 
CURLcode
 
	$Cuæ_vîifyho°
(
c⁄√˘d©a
 * 
c⁄n
,

1051 c⁄° * 
beg
, c⁄° * 
íd
)

1053 
Sessi⁄H™dÀ
 * 
d©a
 = 
c⁄n
->data;

1054 
cuæ_X509˚πifiˇã
 
˚π
;

1055 
cuæ_a¢1EÀmít
 
dn
;

1056 
cuæ_a¢1EÀmít
 
ñem
;

1057 
cuæ_a¢1EÀmít
 
ext
;

1058 
cuæ_a¢1EÀmít
 
«me
;

1059 
i
;

1060 c⁄° * 
p
;

1061 c⁄° * 
q
;

1062 * 
dn¢ame
;

1063 
m©ched
 = -1;

1064 
size_t
 
addæí
 = (size_t) -1;

1065 
ssize_t
 
Àn
;

1066 #ifde‡
ENABLE_IPV6


1067 
ö6_addr
 
addr
;

1069 
ö_addr
 
addr
;

1075 if(!
d©a
->
£t
.
s¶
.
vîifyho°
)

1076  
CURLE_OK
;

1078 if(!
beg
)

1079  
CURLE_PEER_FAILED_VERIFICATION
;

1080 
	`Cuæ_∑r£X509
(&
˚π
, 
beg
, 
íd
);

1083 #ifde‡
ENABLE_IPV6


1084 if(
c⁄n
->
bôs
.
ùv6_ù
 && 
	`Cuæ_öë_±⁄
(
AF_INET6
, c⁄n->
ho°
.
«me
, &
addr
))

1085 
addæí
 = (
ö6_addr
);

1088 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
c⁄n
->
ho°
.
«me
, &
addr
))

1089 
addæí
 = (
ö_addr
);

1092 
p
 = 
˚π
.
exãnsi⁄s
.
beg
;Ö < cît.exãnsi⁄s.
íd
 && 
m©ched
 != 1;) {

1093 
p
 = 
	`Cuæ_gëASN1EÀmít
(&
ext
,Ö, 
˚π
.
exãnsi⁄s
.
íd
);

1095 
ext
.
beg
 = 
	`checkOID
”xt.beg,Éxt.
íd
, 
ßnOID
);

1096 if(
ext
.
beg
) {

1097 
ext
.
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
,Éxt.beg,Éxt.
íd
);

1099 if(
ñem
.
èg
 =
CURL_ASN1_BOOLEAN
)

1100 
ext
.
beg
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
,Éxt.beg,Éxt.
íd
);

1102 
	`Cuæ_gëASN1EÀmít
(&
ñem
,ÉÀm.
beg
,ÉÀm.
íd
);

1104 
q
 = 
ñem
.
beg
; 
m©ched
 !1 && q <ÉÀm.
íd
;) {

1105 
q
 = 
	`Cuæ_gëASN1EÀmít
(&
«me
, q, 
ñem
.
íd
);

1106 
«me
.
èg
) {

1108 
i
 = 0;

1109 
Àn
 = 
	`utf8a¢1°r
(&
dn¢ame
, 
CURL_ASN1_IA5_STRING
,

1110 
«me
.
beg
,Çame.
íd
);

1111 if(
Àn
 > 0)

1112 if(
	`°æí
(
dn¢ame
Ë=(
size_t
Ë
Àn
)

1113 
i
 = 
	`Cuæ_˚π_ho°check
((c⁄° *Ë
dn¢ame
, 
c⁄n
->
ho°
.
«me
);

1114 if(
dn¢ame
)

1115 
	`‰ì
(
dn¢ame
);

1116 if(!
i
)

1117  
CURLE_PEER_FAILED_VERIFICATION
;

1118 
m©ched
 = 
i
;

1122 
m©ched
 = (
size_t
Ë(
«me
.
íd
 - 
q
Ë=
addæí
 &&

1123 !
	`memcmp
(&
addr
, 
q
, 
addæí
);

1130 
m©ched
) {

1133 
	`öfof
(
d©a
, "\àsubje˘A…Name: %†m©ched\n", 
c⁄n
->
ho°
.
di•«me
);

1134  
CURLE_OK
;

1138 
	`öfof
(
d©a
, "\àsubje˘A…Namêd€†nŸ m©ch %s\n", 
c⁄n
->
ho°
.
di•«me
);

1139  
CURLE_PEER_FAILED_VERIFICATION
;

1143 
«me
.
beg
 =Çame.
íd
 = "";

1144 
q
 = 
˚π
.
subje˘
.
beg
;

1147 
q
 < 
˚π
.
subje˘
.
íd
) {

1148 
q
 = 
	`Cuæ_gëASN1EÀmít
(&
dn
, q, 
˚π
.
subje˘
.
íd
);

1149 
p
 = 
dn
.
beg
;Ö < dn.
íd
;) {

1150 
p
 = 
	`Cuæ_gëASN1EÀmít
(&
ñem
,Ö, 
dn
.
íd
);

1152 
ñem
.
beg
 = 
	`checkOID
”Àm.beg,ÉÀm.
íd
, 
˙OID
);

1153 if(
ñem
.
beg
)

1154 
«me
 = 
ñem
;

1159 if(!
	`Cuæ_gëASN1EÀmít
(&
ñem
, 
«me
.
beg
,Çame.
íd
))

1160 
	`Áûf
(
d©a
, "SSL: unableÅo obtain commonÇame fromÖeer certificate");

1162 
Àn
 = 
	`utf8a¢1°r
(&
dn¢ame
, 
ñem
.
èg
,ÉÀm.
beg
,ÉÀm.
íd
);

1163 if(
Àn
 < 0) {

1164 
	`‰ì
(
dn¢ame
);

1165  
CURLE_OUT_OF_MEMORY
;

1167 if(
	`°æí
(
dn¢ame
Ë!(
size_t
Ë
Àn
)

1168 
	`Áûf
(
d©a
, "SSL: illegal certÇame field");

1169 if(
	`Cuæ_˚π_ho°check
((c⁄° *Ë
dn¢ame
, 
c⁄n
->
ho°
.
«me
)) {

1170 
	`öfof
(
d©a
, "\àcomm⁄Çame: %†(m©ched)\n", 
dn¢ame
);

1171 
	`‰ì
(
dn¢ame
);

1172  
CURLE_OK
;

1175 
	`Áûf
(
d©a
, "SSL: certificate subjectÇame '%s' doesÇot match "

1176 "èrgë ho°Çamê'%s'", 
dn¢ame
, 
c⁄n
->
ho°
.
di•«me
);

1177 
	`‰ì
(
dn¢ame
);

1180  
CURLE_PEER_FAILED_VERIFICATION
;

1181 
	}
}

	@lib/x509asn1.h

1 #i‚de‡
HEADER_CURL_X509ASN1_H


2 
	#HEADER_CURL_X509ASN1_H


	)

26 
	~"cuæ_£tup.h
"

28 #i‡
deföed
(
USE_QSOSSL
Ë|| deföed(
USE_GSKIT
Ë|| deföed(
USE_NSS
)

30 
	~"uæd©a.h
"

37 
	#CURL_ASN1_UNIVERSAL
 0

	)

38 
	#CURL_ASN1_APPLICATION
 1

	)

39 
	#CURL_ASN1_CONTEXT_SPECIFIC
 2

	)

40 
	#CURL_ASN1_PRIVATE
 3

	)

43 
	#CURL_ASN1_BOOLEAN
 1

	)

44 
	#CURL_ASN1_INTEGER
 2

	)

45 
	#CURL_ASN1_BIT_STRING
 3

	)

46 
	#CURL_ASN1_OCTET_STRING
 4

	)

47 
	#CURL_ASN1_NULL
 5

	)

48 
	#CURL_ASN1_OBJECT_IDENTIFIER
 6

	)

49 
	#CURL_ASN1_OBJECT_DESCRIPTOR
 7

	)

50 
	#CURL_ASN1_INSTANCE_OF
 8

	)

51 
	#CURL_ASN1_REAL
 9

	)

52 
	#CURL_ASN1_ENUMERATED
 10

	)

53 
	#CURL_ASN1_EMBEDDED
 11

	)

54 
	#CURL_ASN1_UTF8_STRING
 12

	)

55 
	#CURL_ASN1_RELATIVE_OID
 13

	)

56 
	#CURL_ASN1_SEQUENCE
 16

	)

57 
	#CURL_ASN1_SET
 17

	)

58 
	#CURL_ASN1_NUMERIC_STRING
 18

	)

59 
	#CURL_ASN1_PRINTABLE_STRING
 19

	)

60 
	#CURL_ASN1_TELETEX_STRING
 20

	)

61 
	#CURL_ASN1_VIDEOTEX_STRING
 21

	)

62 
	#CURL_ASN1_IA5_STRING
 22

	)

63 
	#CURL_ASN1_UTC_TIME
 23

	)

64 
	#CURL_ASN1_GENERALIZED_TIME
 24

	)

65 
	#CURL_ASN1_GRAPHIC_STRING
 25

	)

66 
	#CURL_ASN1_VISIBLE_STRING
 26

	)

67 
	#CURL_ASN1_GENERAL_STRING
 27

	)

68 
	#CURL_ASN1_UNIVERSAL_STRING
 28

	)

69 
	#CURL_ASN1_CHARACTER_STRING
 29

	)

70 
	#CURL_ASN1_BMP_STRING
 30

	)

79 c⁄° * 
	mbeg
;

80 c⁄° * 
	míd
;

81 
	m˛ass
;

82 
	mèg
;

83 
boﬁ
 
	mc⁄°ru˘ed
;

84 } 
	tcuæ_a¢1EÀmít
;

89 c⁄° * 
	mnumoid
;

90 c⁄° * 
	mãxtoid
;

91 } 
	tcuæ_OID
;

96 
cuæ_a¢1EÀmít
 
	m˚πifiˇã
;

97 
cuæ_a¢1EÀmít
 
	mvîsi⁄
;

98 
cuæ_a¢1EÀmít
 
	m£rülNumbî
;

99 
cuæ_a¢1EÀmít
 
	msig«tuªAlg‹ôhm
;

100 
cuæ_a¢1EÀmít
 
	msig«tuª
;

101 
cuæ_a¢1EÀmít
 
	missuî
;

102 
cuæ_a¢1EÀmít
 
	mnŸBef‹e
;

103 
cuæ_a¢1EÀmít
 
	mnŸA·î
;

104 
cuæ_a¢1EÀmít
 
	msubje˘
;

105 
cuæ_a¢1EÀmít
 
	msubje˘PublicKeyAlg‹ôhm
;

106 
cuæ_a¢1EÀmít
 
	msubje˘PublicKey
;

107 
cuæ_a¢1EÀmít
 
	missuîUniqueID
;

108 
cuæ_a¢1EÀmít
 
	msubje˘UniqueID
;

109 
cuæ_a¢1EÀmít
 
	mexãnsi⁄s
;

110 } 
	tcuæ_X509˚πifiˇã
;

117 c⁄° * 
Cuæ_gëASN1EÀmít
(
cuæ_a¢1EÀmít
 * 
ñem
,

118 c⁄° * 
beg
, c⁄° * 
íd
);

119 c⁄° * 
Cuæ_ASN1to°r
(
cuæ_a¢1EÀmít
 * 
ñem
, 
ty≥
);

120 c⁄° * 
Cuæ_DNto°r
(
cuæ_a¢1EÀmít
 * 
dn
);

121 
Cuæ_∑r£X509
(
cuæ_X509˚πifiˇã
 * 
˚π
,

122 c⁄° * 
beg
, c⁄° * 
íd
);

123 
CURLcode
 
Cuæ_exåa˘_˚πöfo
(
c⁄√˘d©a
 * 
c⁄n
, 
˚πnum
,

124 c⁄° * 
beg
, c⁄° * 
íd
);

125 
CURLcode
 
Cuæ_vîifyho°
(
c⁄√˘d©a
 * 
c⁄n
,

126 c⁄° * 
beg
, c⁄° * 
íd
);

	@packages/OS400/ccsidcurl.c

26 
	~<ic⁄v.h
>

27 
	~<°rög.h
>

28 
	~<°dlib.h
>

29 
	~<î∫o.h
>

30 
	~<°d¨g.h
>

34 
	~"cuæ.h
"

35 
	~"m¥ötf.h
"

36 
	~"¶i°.h
"

37 
	~"uæd©a.h
"

38 
	~"uæ.h
"

39 
	~"gëöfo.h
"

40 
	~"ccsidcuæ.h
"

42 
	~"os400sys.h
"

44 #i‚de‡
SIZE_MAX


45 
	#SIZE_MAX
 ((
size_t
Ë~0Ë

	)

49 
	#ASCII_CCSID
 819

	)

50 
	#NOCONV_CCSID
 65535

	)

51 
	#ICONV_ID_SIZE
 32

	)

52 
	#ICONV_OPEN_ERROR
(
t
Ë(—).
ªtu∫_vÆue
 =-1)

	)

54 
	#ALLOC_GRANULE
 8

	)

58 
	$makeOS400Ic⁄vCode
(
buf
[
ICONV_ID_SIZE
], 
ccsid
)

69 
ccsid
 &= 0xFFFF;

71 if(
ccsid
 =
NOCONV_CCSID
)

72 
ccsid
 = 
ASCII_CCSID
;

74 
	`mem£t
(
buf
, 0, 
ICONV_ID_SIZE
);

75 
	`cuæ_m•rötf
(
buf
, "IBMCCSID%05u0000000", 
ccsid
);

76 
	}
}

79 
ic⁄v_t


80 
	$ic⁄v_›í_CCSID
(
ccsidout
, 
ccsidö
,

81 
c°r
)

84 
‰omcode
[
ICONV_ID_SIZE
];

85 
tocode
[
ICONV_ID_SIZE
];

94 
	`makeOS400Ic⁄vCode
(
‰omcode
, 
ccsidö
);

95 
	`makeOS400Ic⁄vCode
(
tocode
, 
ccsidout
);

96 
	`mem£t
(
tocode
 + 13, 0, Åocode - 13);

98 if(
c°r
)

99 
‰omcode
[18] = '1';

101  
	`ic⁄v_›í
(
tocode
, 
‰omcode
);

102 
	}
}

106 
	$c⁄vît
(* 
d
, 
size_t
 
dÀn
, 
dccsid
,

107 c⁄° * 
s
, 
¶í
, 
sccsid
)

110 
i
;

111 
ic⁄v_t
 
cd
;

112 
size_t
 
l¶í
;

122 if(
sccsid
 == 65535)

123 
sccsid
 = 
ASCII_CCSID
;

125 if(
dccsid
 == 65535)

126 
dccsid
 = 
ASCII_CCSID
;

128 if(
sccsid
 =
dccsid
) {

129 
l¶í
 = 
¶í
 >0? sÀn: 
	`°æí
(
s
) + 1;

130 
i
 = 
l¶í
 < 
dÀn
?Üslen: dlen;

132 if(
s
 !
d
 && 
i
 > 0)

133 
	`mem˝y
(
d
, 
s
, 
i
);

135  
i
;

138 if(
¶í
 < 0) {

139 
l¶í
 = 0;

140 
cd
 = 
	`ic⁄v_›í_CCSID
(
dccsid
, 
sccsid
, 1);

143 
l¶í
 = (
size_t
Ë
¶í
;

144 
cd
 = 
	`ic⁄v_›í_CCSID
(
dccsid
, 
sccsid
, 0);

147 if(
	`ICONV_OPEN_ERROR
(
cd
))

150 
i
 = 
dÀn
;

152 if((Ë
	`ic⁄v
(
cd
, (* *Ë&
s
, &
l¶í
, &
d
, &
dÀn
) < 0)

153 
i
 = -1;

155 
i
 -
dÀn
;

157 
	`ic⁄v_˛o£
(
cd
);

158  
i
;

159 
	}
}

163 
	$dync⁄vît
(
dccsid
, c⁄° * 
s
, 
¶í
, 
sccsid
)

166 * 
d
;

167 * 
˝
;

168 
size_t
 
dÀn
;

169 
l
;

170 
l2
;

171 c⁄° 
nuŒbyã
 = 0;

175 
dÀn
 = (
size_t
Ë(
¶í
 < 0? 
	`°æí
(
s
): slen) + 1;

176 
dÀn
 *
MAX_CONV_EXPANSION
;

177 
d
 = 
	`mÆloc
(
dÀn
);

179 if(!
d
)

180  (*Ë
NULL
;

182 
l
 = 
	`c⁄vît
(
d
, 
dÀn
, 
dccsid
, 
s
, 
¶í
, 
sccsid
);

184 if(
l
 < 0) {

185 
	`‰ì
(
d
);

186  (*Ë
NULL
;

189 if(
¶í
 < 0) {

194 
l2
 = 
	`c⁄vît
(
d
 + 
l
, 
dÀn
 -Ü, 
dccsid
, &
nuŒbyã
, -1, 
ASCII_CCSID
);

196 if(
l2
 < 0) {

197 
	`‰ì
(
d
);

198  (*Ë
NULL
;

201 
l
 +
l2
;

204 if((
size_t
Ë
l
 < 
dÀn
) {

205 
˝
 = 
	`ªÆloc
(
d
, 
l
);

207 if(
˝
)

208 
d
 = 
˝
;

211  
d
;

212 
	}
}

215 
cuæ_¶i°
 *

216 
	$¶i°_c⁄vît
(
dccsid
, 
cuæ_¶i°
 * 
‰om
, 
sccsid
)

219 
cuæ_¶i°
 * 
to
 = (cuæ_¶i° *Ë
NULL
;

220 * 
˝
;

222 ; 
‰om
; from = from->
√xt
) {

223 if(!(
˝
 = 
	`dync⁄vît
(
dccsid
, 
‰om
->
d©a
, -1, 
sccsid
))) {

224 
	`cuæ_¶i°_‰ì_Æl
(
to
);

225  (
cuæ_¶i°
 *Ë
NULL
;

227 
to
 = 
	`Cuæ_¶i°_≠≥nd_nodup
—o, 
˝
);

229  
to
;

230 
	}
}

234 
	$cuæ_vîsi⁄_ccsid
(
ccsid
)

237 
i
;

238 * 
avîsi⁄
;

239 * 
evîsi⁄
;

241 
avîsi⁄
 = 
	`cuæ_vîsi⁄
();

243 if(!
avîsi⁄
)

244  
avîsi⁄
;

246 
i
 = 
	`°æí
(
avîsi⁄
) + 1;

247 
i
 *
MAX_CONV_EXPANSION
;

249 if(!(
evîsi⁄
 = 
	`Cuæ_thªad_buf„r
(
LK_CURL_VERSION
, 
i
)))

250  (*Ë
NULL
;

252 if(
	`c⁄vît
(
evîsi⁄
, 
i
, 
ccsid
, 
avîsi⁄
, -1, 
ASCII_CCSID
) < 0)

253  (*Ë
NULL
;

255  
evîsi⁄
;

256 
	}
}

260 
	$cuæ_ósy_esˇ≥_ccsid
(
CURL
 * 
h™dÀ
, c⁄° * 
°rög
, 
Àngth
,

261 
sccsid
, 
dccsid
)

264 * 
s
;

265 * 
d
;

267 if(!
°rög
) {

268 
î∫o
 = 
EINVAL
;

269  (*Ë
NULL
;

272 
s
 = 
	`dync⁄vît
(
ASCII_CCSID
, s, 
Àngth
?Üígth: -1, 
sccsid
);

274 if(!
s
)

275  (*Ë
NULL
;

277 
d
 = 
	`cuæ_ósy_esˇ≥
(
h™dÀ
, 
s
, 0);

278 
	`‰ì
(
s
);

280 if(!
d
)

281  (*Ë
NULL
;

283 
s
 = 
	`dync⁄vît
(
dccsid
, 
d
, -1, 
ASCII_CCSID
);

284 
	`‰ì
(
d
);

285  
s
;

286 
	}
}

290 
	$cuæ_ósy_u√sˇ≥_ccsid
(
CURL
 * 
h™dÀ
, c⁄° * 
°rög
, 
Àngth
,

291 * 
ouéígth
,

292 
sccsid
, 
dccsid
)

295 * 
s
;

296 * 
d
;

298 if(!
°rög
) {

299 
î∫o
 = 
EINVAL
;

300  (*Ë
NULL
;

303 
s
 = 
	`dync⁄vît
(
ASCII_CCSID
, s, 
Àngth
?Üígth: -1, 
sccsid
);

305 if(!
s
)

306  (*Ë
NULL
;

308 
d
 = 
	`cuæ_ósy_u√sˇ≥
(
h™dÀ
, 
s
, 0, 
ouéígth
);

309 
	`‰ì
(
s
);

311 if(!
d
)

312  (*Ë
NULL
;

314 
s
 = 
	`dync⁄vît
(
dccsid
, 
d
, -1, 
ASCII_CCSID
);

315 
	`‰ì
(
d
);

317 if(
s
 && 
ouéígth
)

318 *
ouéígth
 = 
	`°æí
(
s
);

320  
s
;

321 
	}
}

324 
cuæ_¶i°
 *

325 
	$cuæ_¶i°_≠≥nd_ccsid
(
cuæ_¶i°
 * 
li°
,

326 c⁄° * 
d©a
, 
ccsid
)

329 * 
s
;

331 
s
 = (*Ë
NULL
;

333 if(!
d©a
)

334  
	`cuæ_¶i°_≠≥nd
(
li°
, 
d©a
);

336 
s
 = 
	`dync⁄vît
(
ASCII_CCSID
, 
d©a
, -1, 
ccsid
);

338 if(!
s
)

339  (
cuæ_¶i°
 *Ë
NULL
;

341 
li°
 = 
	`cuæ_¶i°_≠≥nd
÷i°, 
s
);

342 
	`‰ì
(
s
);

343  
li°
;

344 
	}
}

347 
time_t


348 
	$cuæ_gëd©e_ccsid
(c⁄° * 
p
, c⁄° 
time_t
 * 
unu£d
, 
ccsid
)

351 * 
s
;

352 
time_t
 
t
;

354 if(!
p
)

355  
	`cuæ_gëd©e
(
p
, 
unu£d
);

357 
s
 = 
	`dync⁄vît
(
ASCII_CCSID
, 
p
, -1, 
ccsid
);

359 if(!
s
)

360  (
time_t
) -1;

362 
t
 = 
	`cuæ_gëd©e
(
s
, 
unu£d
);

363 
	`‰ì
(
s
);

364  
t
;

365 
	}
}

369 
	$c⁄vît_vîsi⁄_öfo_°rög
(c⁄° * * 
°rögp
,

370 * * 
buÂ
, * 
À·
, 
ccsid
)

373 
l
;

380 if(*
°rögp
) {

381 
l
 = 
	`c⁄vît
(*
buÂ
, *
À·
, 
ccsid
, *
°rögp
, -1, 
ASCII_CCSID
);

383 if(
l
 <= 0)

386 *
°rögp
 = *
buÂ
;

387 *
buÂ
 +
l
;

388 *
À·
 -
l
;

392 
	}
}

395 
cuæ_vîsi⁄_öfo_d©a
 *

396 
	$cuæ_vîsi⁄_öfo_ccsid
(
CURLvîsi⁄
 
°amp
, 
ccsid
)

399 
cuæ_vîsi⁄_öfo_d©a
 * 
p
;

400 * 
˝
;

401 
n
;

402 
≈rŸo
;

403 
i
;

404 
cuæ_vîsi⁄_öfo_d©a
 * 
id
;

410 #i‡
CURLVERSION_NOW
 !
CURLVERSION_FOURTH


411 #îr‹ 
cuæ_vîsi⁄_öfo_d©a
 
°ru˘uª
 
has
 
ch™ged
: 
upgøde
 
this
 
¥o˚duª
.

416 if(
°amp
 > 
CURLVERSION_NOW
)

417  (
cuæ_vîsi⁄_öfo_d©a
 *Ë
NULL
;

419 
p
 = 
	`cuæ_vîsi⁄_öfo
(
°amp
);

421 if(!
p
)

422  
p
;

426 
n
 = 0;

427 
≈rŸo
 = 0;

429 if(
p
->
¥Ÿocﬁs
) {

430 
p
->
¥Ÿocﬁs
[
≈rŸo
])

431 
n
 +
	`°æí
(
p
->
¥Ÿocﬁs
[
≈rŸo
++]);

433 
n
 +
≈rŸo
++;

436 if(
p
->
vîsi⁄
)

437 
n
 +
	`°æí
(
p
->
vîsi⁄
) + 1;

439 if(
p
->
ho°
)

440 
n
 +
	`°æí
(
p
->
ho°
) + 1;

442 if(
p
->
s¶_vîsi⁄
)

443 
n
 +
	`°æí
(
p
->
s¶_vîsi⁄
) + 1;

445 if(
p
->
libz_vîsi⁄
)

446 
n
 +
	`°æí
(
p
->
libz_vîsi⁄
) + 1;

448 if(
p
->
¨es
)

449 
n
 +
	`°æí
(
p
->
¨es
) + 1;

451 if(
p
->
libidn
)

452 
n
 +
	`°æí
(
p
->
libidn
) + 1;

454 if(
p
->
libssh_vîsi⁄
)

455 
n
 +
	`°æí
(
p
->
libssh_vîsi⁄
) + 1;

459 
n
 *
MAX_CONV_EXPANSION
;

461 if(
≈rŸo
)

462 
n
 +
≈rŸo
 * (const *);

464 
˝
 = 
	`Cuæ_thªad_buf„r
(
LK_VERSION_INFO_DATA
, 
n
);

465 
id
 = (
cuæ_vîsi⁄_öfo_d©a
 *Ë
	`Cuæ_thªad_buf„r
(
LK_VERSION_INFO
,

466  *
id
);

468 if(!
id
 || !
˝
)

469  (
cuæ_vîsi⁄_öfo_d©a
 *Ë
NULL
;

473 
	`mem˝y
((*Ë
id
, (*Ë
p
,  *p);

475 if(
id
->
¥Ÿocﬁs
) {

476 
id
->
¥Ÿocﬁs
 = (c⁄° * c⁄° *Ë
˝
;

477 
i
 = 
≈rŸo
 *  
id
->
¥Ÿocﬁs
[0];

478 
	`mem˝y
(
˝
, (*Ë
p
->
¥Ÿocﬁs
, 
i
);

479 
˝
 +
i
;

480 
n
 -
i
;

482 
i
 = 0; 
id
->
¥Ÿocﬁs
[i]; i++)

483 if(
	`c⁄vît_vîsi⁄_öfo_°rög
(((c⁄° * *Ë
id
->
¥Ÿocﬁs
Ë+ 
i
,

484 &
˝
, &
n
, 
ccsid
))

485  (
cuæ_vîsi⁄_öfo_d©a
 *Ë
NULL
;

488 if(
	`c⁄vît_vîsi⁄_öfo_°rög
(&
id
->
vîsi⁄
, &
˝
, &
n
, 
ccsid
))

489  (
cuæ_vîsi⁄_öfo_d©a
 *Ë
NULL
;

491 if(
	`c⁄vît_vîsi⁄_öfo_°rög
(&
id
->
ho°
, &
˝
, &
n
, 
ccsid
))

492  (
cuæ_vîsi⁄_öfo_d©a
 *Ë
NULL
;

494 if(
	`c⁄vît_vîsi⁄_öfo_°rög
(&
id
->
s¶_vîsi⁄
, &
˝
, &
n
, 
ccsid
))

495  (
cuæ_vîsi⁄_öfo_d©a
 *Ë
NULL
;

497 if(
	`c⁄vît_vîsi⁄_öfo_°rög
(&
id
->
libz_vîsi⁄
, &
˝
, &
n
, 
ccsid
))

498  (
cuæ_vîsi⁄_öfo_d©a
 *Ë
NULL
;

500 if(
	`c⁄vît_vîsi⁄_öfo_°rög
(&
id
->
¨es
, &
˝
, &
n
, 
ccsid
))

501  (
cuæ_vîsi⁄_öfo_d©a
 *Ë
NULL
;

503 if(
	`c⁄vît_vîsi⁄_öfo_°rög
(&
id
->
libidn
, &
˝
, &
n
, 
ccsid
))

504  (
cuæ_vîsi⁄_öfo_d©a
 *Ë
NULL
;

506 if(
	`c⁄vît_vîsi⁄_öfo_°rög
(&
id
->
libssh_vîsi⁄
, &
˝
, &
n
, 
ccsid
))

507  (
cuæ_vîsi⁄_öfo_d©a
 *Ë
NULL
;

509  
id
;

510 
	}
}

514 
	$cuæ_ósy_°ªº‹_ccsid
(
CURLcode
 
îr‹
, 
ccsid
)

517 
i
;

518 c⁄° * 
s
;

519 * 
buf
;

521 
s
 = 
	`cuæ_ósy_°ªº‹
(
îr‹
);

523 if(!
s
)

524  
s
;

526 
i
 = 
MAX_CONV_EXPANSION
 * (
	`°æí
(
s
) + 1);

528 if(!(
buf
 = 
	`Cuæ_thªad_buf„r
(
LK_EASY_STRERROR
, 
i
)))

529  (c⁄° *Ë
NULL
;

531 if(
	`c⁄vît
(
buf
, 
i
, 
ccsid
, 
s
, -1, 
ASCII_CCSID
) < 0)

532  (c⁄° *Ë
NULL
;

534  (c⁄° *Ë
buf
;

535 
	}
}

539 
	$cuæ_sh¨e_°ªº‹_ccsid
(
CURLSHcode
 
îr‹
, 
ccsid
)

542 
i
;

543 c⁄° * 
s
;

544 * 
buf
;

546 
s
 = 
	`cuæ_sh¨e_°ªº‹
(
îr‹
);

548 if(!
s
)

549  
s
;

551 
i
 = 
MAX_CONV_EXPANSION
 * (
	`°æí
(
s
) + 1);

553 if(!(
buf
 = 
	`Cuæ_thªad_buf„r
(
LK_SHARE_STRERROR
, 
i
)))

554  (c⁄° *Ë
NULL
;

556 if(
	`c⁄vît
(
buf
, 
i
, 
ccsid
, 
s
, -1, 
ASCII_CCSID
) < 0)

557  (c⁄° *Ë
NULL
;

559  (c⁄° *Ë
buf
;

560 
	}
}

564 
	$cuæ_mu…i_°ªº‹_ccsid
(
CURLMcode
 
îr‹
, 
ccsid
)

567 
i
;

568 c⁄° * 
s
;

569 * 
buf
;

571 
s
 = 
	`cuæ_mu…i_°ªº‹
(
îr‹
);

573 if(!
s
)

574  
s
;

576 
i
 = 
MAX_CONV_EXPANSION
 * (
	`°æí
(
s
) + 1);

578 if(!(
buf
 = 
	`Cuæ_thªad_buf„r
(
LK_MULTI_STRERROR
, 
i
)))

579  (c⁄° *Ë
NULL
;

581 if(
	`c⁄vît
(
buf
, 
i
, 
ccsid
, 
s
, -1, 
ASCII_CCSID
) < 0)

582  (c⁄° *Ë
NULL
;

584  (c⁄° *Ë
buf
;

585 
	}
}

589 
	$cuæ_˚πöfo_‰ì_Æl
(
cuæ_˚πöfo
 *
öfo
)

592 
i
;

595 if(
öfo
) {

596 if(
öfo
->
˚πöfo
) {

597 
i
 = 0; i < 
öfo
->
num_of_˚πs
; i++)

598 
	`cuæ_¶i°_‰ì_Æl
(
öfo
->
˚πöfo
[
i
]);

599 
	`‰ì
((*Ë
öfo
->
˚πöfo
);

601 
	`‰ì
((*Ë
öfo
);

603 
	}
}

606 
CURLcode


607 
	$cuæ_ósy_gëöfo_ccsid
(
CURL
 * 
cuæ
, 
CURLINFO
 
öfo
, ...)

610 
va_li°
 
¨g
;

611 * 
∑ømp
;

612 
CURLcode
 
ªt
;

613 
ccsid
;

614 * * 
˝p
;

615 * 
s
;

616 * 
d
;

617 
Sessi⁄H™dÀ
 * 
d©a
;

618 
cuæ_¶i°
 * * 
¶p
;

619 
cuæ_˚πöfo
 * 
cùf
;

620 
cuæ_˚πöfo
 * 
cùt
;

621 
i
;

626 
d©a
 = (
Sessi⁄H™dÀ
 *Ë
cuæ
;

627 
	`va_°¨t
(
¨g
, 
öfo
);

628 
∑ømp
 = 
	`va_¨g
(
¨g
, *);

629 
ªt
 = 
	`Cuæ_gëöfo
(
d©a
, 
öfo
, 
∑ømp
);

631 if(
ªt
 =
CURLE_OK
)

632 (Ë
öfo
 & 
CURLINFO_TYPEMASK
) {

634 
CURLINFO_STRING
:

635 
ccsid
 = 
	`va_¨g
(
¨g
, );

636 
˝p
 = (* *Ë
∑ømp
;

637 
s
 = *
˝p
;

639 if(
s
) {

640 
d
 = 
	`dync⁄vît
(
ccsid
, 
s
, -1, 
ASCII_CCSID
);

641 *
˝p
 = 
d
;

643 if(!
d
)

644 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

649 
CURLINFO_SLIST
:

650 
ccsid
 = 
	`va_¨g
(
¨g
, );

651 
öfo
) {

652 
CURLINFO_CERTINFO
:

653 
cùf
 = *(
cuæ_˚πöfo
 * *Ë
∑ømp
;

654 if(
cùf
) {

655 if(!(
cùt
 = (
cuæ_˚πöfo
 *Ë
	`mÆloc
( *cipt)))

656 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

658 
cùt
->
˚πöfo
 = (
cuæ_¶i°
 * *)

659 
	`ˇŒoc
(
cùf
->
num_of_˚πs
 +

660 1, (
cuæ_¶i°
 *));

661 if(!
cùt
->
˚πöfo
)

662 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

664 
cùt
->
num_of_˚πs
 = 
cùf
->num_of_certs;

665 
i
 = 0; i < 
cùf
->
num_of_˚πs
; i++)

666 if(
cùf
->
˚πöfo
[
i
])

667 if(!(
cùt
->
˚πöfo
[
i
] = 
	`¶i°_c⁄vît
(
ccsid
,

668 
cùf
->
˚πöfo
[
i
],

669 
ASCII_CCSID
))) {

670 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

676 if(
ªt
 !
CURLE_OK
) {

677 
	`cuæ_˚πöfo_‰ì_Æl
(
cùt
);

678 
cùt
 = (
cuæ_˚πöfo
 *Ë
NULL
;

681 *(
cuæ_˚πöfo
 * *Ë
∑ømp
 = 
cùt
;

686 
CURLINFO_TLS_SESSION
:

690 
¶p
 = (
cuæ_¶i°
 * *Ë
∑ømp
;

691 if(*
¶p
)

692 if(!(*
¶p
 = 
	`¶i°_c⁄vît
(
ccsid
, *¶p, 
ASCII_CCSID
)))

693 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

698 
	`va_íd
(
¨g
);

699  
ªt
;

700 
	}
}

704 
	$Cuæ_is_f‹madd_°rög
(
CURLf‹m›ti⁄
 
›ti⁄
)

707 
›ti⁄
) {

709 
CURLFORM_FILENAME
:

710 
CURLFORM_CONTENTTYPE
:

711 
CURLFORM_BUFFER
:

712 
CURLFORM_FILE
:

713 
CURLFORM_FILECONTENT
:

714 
CURLFORM_COPYCONTENTS
:

715 
CURLFORM_COPYNAME
:

720 
	}
}

724 
	$Cuæ_f‹madd_ªÀa£_loˇl
(
cuæ_f‹ms
 * 
f‹ms
, 
«rgs
, 
skù
)

727 
«rgs
--)

728 if(
«rgs
 !
skù
)

729 if(
	`Cuæ_is_f‹madd_°rög
(
f‹ms
[
«rgs
].
›ti⁄
))

730 if(
f‹ms
[
«rgs
].
vÆue
)

731 
	`‰ì
((*Ë
f‹ms
[
«rgs
].
vÆue
);

733 
	`‰ì
((*Ë
f‹ms
);

734 
	}
}

738 
	$Cuæ_f‹madd_c⁄vît
(
cuæ_f‹ms
 * 
f‹ms
,

739 
f‹mx
, 
Àngthx
, 
ccsid
)

742 
l
;

743 * 
˝
;

744 * 
˝2
;

746 if(
f‹mx
 < 0 || !
f‹ms
[f‹mx].
vÆue
)

749 if(
Àngthx
 >= 0)

750 
l
 = (Ë
f‹ms
[
Àngthx
].
vÆue
;

752 
l
 = 
	`°æí
(
f‹ms
[
f‹mx
].
vÆue
) + 1;

754 
˝
 = 
	`mÆloc
(
MAX_CONV_EXPANSION
 * 
l
);

756 if(!
˝
)

759 
l
 = 
	`c⁄vît
(
˝
, 
MAX_CONV_EXPANSION
 *Ü, 
ASCII_CCSID
,

760 
f‹ms
[
f‹mx
].
vÆue
, 
l
, 
ccsid
);

762 if(
l
 < 0) {

763 
	`‰ì
(
˝
);

767 
˝2
 = 
	`ªÆloc
(
˝
, 
l
);

769 if(
˝2
)

770 
˝
 = 
˝2
;

772 
f‹ms
[
f‹mx
].
vÆue
 = 
˝
;

774 if(
Àngthx
 >= 0)

775 
f‹ms
[
Àngthx
].
vÆue
 = (*Ë
l
;

777  
l
;

778 
	}
}

781 
CURLFORMcode


782 
	$cuæ_f‹madd_ccsid
(
cuæ_hâµo°
 * * 
hâµo°
,

783 
cuæ_hâµo°
 * * 
œ°_po°
, ...)

786 
va_li°
 
¨g
;

787 
CURLf‹m›ti⁄
 
›ti⁄
;

788 
CURLFORMcode
 
ªsu…
;

789 
cuæ_f‹ms
 * 
f‹ms
;

790 
cuæ_f‹ms
 * 
lf‹ms
;

791 
cuæ_f‹ms
 * 
tf‹ms
;

792 
lf‹mÀn
;

793 c⁄° * 
vÆue
;

794 
ccsid
;

795 
«rgs
;

796 
«mex
;

797 
«mñígthx
;

798 
c⁄ã¡x
;

799 
Àngthx
;

800 
c⁄ã¡ccsid
;

801 
«meccsid
;

820 
lf‹mÀn
 = 
ALLOC_GRANULE
;

821 
lf‹ms
 = 
	`mÆloc
(
lf‹mÀn
 *  *lforms);

823 if(!
lf‹ms
)

824  
CURL_FORMADD_MEMORY
;

829 
ªsu…
 = 
CURL_FORMADD_OK
;

830 
«rgs
 = 0;

831 
c⁄ã¡x
 = -1;

832 
Àngthx
 = -1;

833 
«mex
 = -1;

834 
«mñígthx
 = -1;

835 
f‹ms
 = (
cuæ_f‹ms
 *Ë
NULL
;

836 
	`va_°¨t
(
¨g
, 
œ°_po°
);

841 if(
«rgs
 >
lf‹mÀn
) {

842 
lf‹mÀn
 +
ALLOC_GRANULE
;

843 
tf‹ms
 = 
	`ªÆloc
(
lf‹ms
, 
lf‹mÀn
 *  *lforms);

845 if(!
tf‹ms
) {

846 
ªsu…
 = 
CURL_FORMADD_MEMORY
;

850 
lf‹ms
 = 
tf‹ms
;

855 if(
f‹ms
) {

858 
›ti⁄
 = 
f‹ms
->option;

859 
vÆue
 = 
f‹ms
->value;

860 
f‹ms
++;

865 
›ti⁄
 = 
	`va_¨g
(
¨g
, 
CURLf‹m›ti⁄
);

867 if(
›ti⁄
 =
CURLFORM_END
)

873 
›ti⁄
) {

875 
CURLFORM_END
:

876 
f‹ms
 = (
cuæ_f‹ms
 *Ë
NULL
;

879 
CURLFORM_ARRAY
:

880 if(!
f‹ms
) {

881 
f‹ms
 = 
	`va_¨g
(
¨g
, 
cuæ_f‹ms
 *);

885 
ªsu…
 = 
CURL_FORMADD_ILLEGAL_ARRAY
;

888 
CURLFORM_COPYNAME
:

889 
›ti⁄
 = 
CURLFORM_PTRNAME
;

891 
CURLFORM_PTRNAME
:

892 if(
«mex
 >= 0)

893 
ªsu…
 = 
CURL_FORMADD_OPTION_TWICE
;

895 
«mex
 = 
«rgs
;

897 if(!
f‹ms
) {

898 
vÆue
 = 
	`va_¨g
(
¨g
, *);

899 
«meccsid
 = (Ë
	`va_¨g
(
¨g
, );

902 
«meccsid
 = (Ë
f‹ms
->
vÆue
;

903 
f‹ms
++;

908 
CURLFORM_COPYCONTENTS
:

909 if(
c⁄ã¡x
 >= 0)

910 
ªsu…
 = 
CURL_FORMADD_OPTION_TWICE
;

912 
c⁄ã¡x
 = 
«rgs
;

914 if(!
f‹ms
) {

915 
vÆue
 = 
	`va_¨g
(
¨g
, *);

916 
c⁄ã¡ccsid
 = (Ë
	`va_¨g
(
¨g
, );

919 
c⁄ã¡ccsid
 = (Ë
f‹ms
->
vÆue
;

920 
f‹ms
++;

925 
CURLFORM_PTRCONTENTS
:

926 
CURLFORM_BUFFERPTR
:

927 if(!
f‹ms
)

928 
vÆue
 = 
	`va_¨g
(
¨g
, *);

932 
CURLFORM_CONTENTSLENGTH
:

933 
Àngthx
 = 
«rgs
;

935 if(!
f‹ms
)

936 
vÆue
 = (*Ë
	`va_¨g
(
¨g
, );

940 
CURLFORM_NAMELENGTH
:

941 
«mñígthx
 = 
«rgs
;

943 if(!
f‹ms
)

944 
vÆue
 = (*Ë
	`va_¨g
(
¨g
, );

948 
CURLFORM_BUFFERLENGTH
:

949 if(!
f‹ms
)

950 
vÆue
 = (*Ë
	`va_¨g
(
¨g
, );

954 
CURLFORM_CONTENTHEADER
:

955 if(!
f‹ms
)

956 
vÆue
 = (*Ë
	`va_¨g
(
¨g
, 
cuæ_¶i°
 *);

960 
CURLFORM_STREAM
:

961 if(!
f‹ms
)

962 
vÆue
 = (*Ë
	`va_¨g
(
¨g
, *);

966 
CURLFORM_CONTENTTYPE
:

969 if(
	`Cuæ_f‹madd_c⁄vît
(
lf‹ms
, 
c⁄ã¡x
, 
Àngthx
, 
c⁄ã¡ccsid
) < 0) {

970 
ªsu…
 = 
CURL_FORMADD_MEMORY
;

974 
c⁄ã¡x
 = -1;

975 
Àngthx
 = -1;

981 if(!
	`Cuæ_is_f‹madd_°rög
(
›ti⁄
)) {

982 
ªsu…
 = 
CURL_FORMADD_UNKNOWN_OPTION
;

986 if(!
f‹ms
) {

987 
vÆue
 = 
	`va_¨g
(
¨g
, *);

988 
ccsid
 = (Ë
	`va_¨g
(
¨g
, );

991 
ccsid
 = (Ë
f‹ms
->
vÆue
;

992 
f‹ms
++;

997 
lf‹ms
[
«rgs
].
vÆue
 = value;

999 if(
	`Cuæ_f‹madd_c⁄vît
(
lf‹ms
, 
«rgs
, -1, 
ccsid
) < 0) {

1000 
ªsu…
 = 
CURL_FORMADD_MEMORY
;

1004 
vÆue
 = 
lf‹ms
[
«rgs
].value;

1007 if(
ªsu…
 !
CURL_FORMADD_OK
)

1010 
lf‹ms
[
«rgs
].
vÆue
 = value;

1011 
lf‹ms
[
«rgs
++].
›ti⁄
 = option;

1014 
	`va_íd
(
¨g
);

1018 if(
ªsu…
 =
CURL_FORMADD_OK
 && 
«mex
 >= 0) {

1019 if(
	`Cuæ_f‹madd_c⁄vît
(
lf‹ms
, 
«mex
, 
«mñígthx
, 
«meccsid
) < 0)

1020 
ªsu…
 = 
CURL_FORMADD_MEMORY
;

1022 
lf‹ms
[
«mex
].
›ti⁄
 = 
CURLFORM_COPYNAME
;

1025 if(
ªsu…
 =
CURL_FORMADD_OK
) {

1026 if(
	`Cuæ_f‹madd_c⁄vît
(
lf‹ms
, 
c⁄ã¡x
, 
Àngthx
, 
c⁄ã¡ccsid
) < 0)

1027 
ªsu…
 = 
CURL_FORMADD_MEMORY
;

1029 
c⁄ã¡x
 = -1;

1034 if(
ªsu…
 =
CURL_FORMADD_OK
) {

1035 
lf‹ms
[
«rgs
].
›ti⁄
 = 
CURLFORM_END
;

1036 
ªsu…
 = 
	`cuæ_f‹madd
(
hâµo°
, 
œ°_po°
,

1037 
CURLFORM_ARRAY
, 
lf‹ms
, 
CURLFORM_END
);

1042 
	`Cuæ_f‹madd_ªÀa£_loˇl
(
lf‹ms
, 
«rgs
, 
c⁄ã¡x
);

1043  
ªsu…
;

1044 
	}
}

1048 
cuæ_f‹mgë_ˇŒback
 
	m≠≥nd
;

1049 * 
	m¨g
;

1050 
	mccsid
;

1051 } 
	tcfcd©a
;

1054 
size_t


1055 
	$Cuæ_f‹mgë_ˇŒback_ccsid
(* 
¨g
, c⁄° * 
buf
, 
size_t
 
Àn
)

1058 
cfcd©a
 * 
p
;

1059 * 
b
;

1060 
l
;

1061 
size_t
 
ªt
;

1063 
p
 = (
cfcd©a
 *Ë
¨g
;

1065 if((Ë
Àn
 <= 0)

1066  (*
p
->
≠≥nd
)’->
¨g
, 
buf
, 
Àn
);

1068 
b
 = 
	`mÆloc
(
MAX_CONV_EXPANSION
 * 
Àn
);

1070 if(!
b
)

1071  (
size_t
) -1;

1073 
l
 = 
	`c⁄vît
(
b
, 
MAX_CONV_EXPANSION
 * 
Àn
, 
p
->
ccsid
, 
buf
,Üí, 
ASCII_CCSID
);

1075 if(
l
 < 0) {

1076 
	`‰ì
(
b
);

1077  (
size_t
) -1;

1080 
ªt
 = (*
p
->
≠≥nd
)’->
¨g
, 
b
, 
l
);

1081 
	`‰ì
(
b
);

1082  
ªt
 =
l
? 
Àn
: -1;

1083 
	}
}

1087 
	$cuæ_f‹mgë_ccsid
(
cuæ_hâµo°
 * 
f‹m
, * 
¨g
,

1088 
cuæ_f‹mgë_ˇŒback
 
≠≥nd
, 
ccsid
)

1091 
cfcd©a
 
lcfc
;

1093 
lcfc
.
≠≥nd
 =áppend;

1094 
lcfc
.
¨g
 =árg;

1095 
lcfc
.
ccsid
 = ccsid;

1096  
	`cuæ_f‹mgë
(
f‹m
, (*Ë&
lcfc
, 
Cuæ_f‹mgë_ˇŒback_ccsid
);

1097 
	}
}

1100 
CURLcode


1101 
	$cuæ_ósy_£t›t_ccsid
(
CURL
 * 
cuæ
, 
CURL›ti⁄
 
èg
, ...)

1104 
CURLcode
 
ªsu…
;

1105 
va_li°
 
¨g
;

1106 
Sessi⁄H™dÀ
 * 
d©a
;

1107 * 
s
;

1108 * 
˝
;

1109 
ccsid
;

1110 
size_t
 
Àn
;

1111 
cuæ_off_t
 
pfsize
;

1112 
ã°w¨n
 = 1;

1120 if(
ã°w¨n
) {

1121 
ã°w¨n
 = 0;

1123 if((Ë
STRING_LAST
 !(Ë
STRING_BEARER
 + 1)

1124 
	`cuæ_mÂrötf
(
°dîr
,

1128 
d©a
 = (
Sessi⁄H™dÀ
 *Ë
cuæ
;

1129 
	`va_°¨t
(
¨g
, 
èg
);

1131 
èg
) {

1133 
CURLOPT_CAINFO
:

1134 
CURLOPT_CAPATH
:

1135 
CURLOPT_COOKIE
:

1136 
CURLOPT_COOKIEFILE
:

1137 
CURLOPT_COOKIEJAR
:

1138 
CURLOPT_COOKIELIST
:

1139 
CURLOPT_CRLFILE
:

1140 
CURLOPT_CUSTOMREQUEST
:

1141 
CURLOPT_DNS_SERVERS
:

1142 
CURLOPT_EGDSOCKET
:

1143 
CURLOPT_ENCODING
:

1144 
CURLOPT_FTP_ACCOUNT
:

1145 
CURLOPT_FTP_ALTERNATIVE_TO_USER
:

1146 
CURLOPT_FTPPORT
:

1147 
CURLOPT_INTERFACE
:

1148 
CURLOPT_ISSUERCERT
:

1149 
CURLOPT_KEYPASSWD
:

1150 
CURLOPT_KRBLEVEL
:

1151 
CURLOPT_LOGIN_OPTIONS
:

1152 
CURLOPT_MAIL_FROM
:

1153 
CURLOPT_MAIL_AUTH
:

1154 
CURLOPT_NETRC_FILE
:

1155 
CURLOPT_NOPROXY
:

1156 
CURLOPT_PASSWORD
:

1157 
CURLOPT_PROXY
:

1158 
CURLOPT_PROXYPASSWORD
:

1159 
CURLOPT_PROXYUSERNAME
:

1160 
CURLOPT_PROXYUSERPWD
:

1161 
CURLOPT_RANDOM_FILE
:

1162 
CURLOPT_RANGE
:

1163 
CURLOPT_REFERER
:

1164 
CURLOPT_RTSP_SESSION_ID
:

1165 
CURLOPT_RTSP_STREAM_URI
:

1166 
CURLOPT_RTSP_TRANSPORT
:

1167 
CURLOPT_SOCKS5_GSSAPI_SERVICE
:

1168 
CURLOPT_SSH_HOST_PUBLIC_KEY_MD5
:

1169 
CURLOPT_SSH_KNOWNHOSTS
:

1170 
CURLOPT_SSH_PRIVATE_KEYFILE
:

1171 
CURLOPT_SSH_PUBLIC_KEYFILE
:

1172 
CURLOPT_SSLCERT
:

1173 
CURLOPT_SSLCERTTYPE
:

1174 
CURLOPT_SSL_CIPHER_LIST
:

1175 
CURLOPT_SSLENGINE
:

1176 
CURLOPT_SSLKEY
:

1177 
CURLOPT_SSLKEYTYPE
:

1178 
CURLOPT_TLSAUTH_PASSWORD
:

1179 
CURLOPT_TLSAUTH_TYPE
:

1180 
CURLOPT_TLSAUTH_USERNAME
:

1181 
CURLOPT_URL
:

1182 
CURLOPT_USERAGENT
:

1183 
CURLOPT_USERNAME
:

1184 
CURLOPT_USERPWD
:

1185 
CURLOPT_XOAUTH2_BEARER
:

1186 
s
 = 
	`va_¨g
(
¨g
, *);

1187 
ccsid
 = 
	`va_¨g
(
¨g
, );

1189 if(
s
) {

1190 
s
 = 
	`dync⁄vît
(
ASCII_CCSID
, s, -1, 
ccsid
);

1192 if(!
s
) {

1193 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1198 
ªsu…
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
èg
, 
s
);

1200 if(
s
)

1201 
	`‰ì
(
s
);

1205 
CURLOPT_COPYPOSTFIELDS
:

1209 
s
 = 
	`va_¨g
(
¨g
, *);

1210 
ccsid
 = 
	`va_¨g
(
¨g
, );

1212 
pfsize
 = 
d©a
->
£t
.
po°fõldsize
;

1214 if(!
s
 || !
pfsize
 || 
ccsid
 =
NOCONV_CCSID
 || ccsid =
ASCII_CCSID
) {

1215 
ªsu…
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_COPYPOSTFIELDS
, 
s
);

1219 if(
pfsize
 == -1) {

1221 
s
 = 
	`dync⁄vît
(
ASCII_CCSID
, s, -1, 
ccsid
);

1223 if(!
s
) {

1224 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1231 if(
pfsize
 < 0 ||Öfsizê> 
SIZE_MAX
) {

1232 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1236 
Àn
 = 
pfsize
;

1237 
pfsize
 = 
Àn
 * 
MAX_CONV_EXPANSION
;

1239 if(
pfsize
 > 
SIZE_MAX
)

1240 
pfsize
 = 
SIZE_MAX
;

1242 
˝
 = 
	`mÆloc
(
pfsize
);

1244 if(!
˝
) {

1245 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1249 
pfsize
 = 
	`c⁄vît
(
˝
,Öfsize, 
ASCII_CCSID
, 
s
, 
Àn
, 
ccsid
);

1251 if(
pfsize
 < 0) {

1252 
	`‰ì
(
˝
);

1253 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

1257 
d©a
->
£t
.
po°fõldsize
 = 
pfsize
;

1258 
s
 = 
˝
;

1261 
ªsu…
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, 
s
);

1262 
d©a
->
£t
.
°r
[
STRING_COPYPOSTFIELDS
] = 
s
;

1265 
CURLOPT_ERRORBUFFER
:

1267 
ªsu…
 = 
	`Cuæ_£t›t
(
d©a
, 
èg
, 
¨g
);

1271 
	`va_íd
(
¨g
);

1272  
ªsu…
;

1273 
	}
}

1277 
	$cuæ_f‹m_l⁄g_vÆue
(
vÆue
)

1282  (*Ë
vÆue
;

1283 
	}
}

	@packages/OS400/ccsidcurl.h

24 #i‚de‡
__CURL_CCSIDCURL_H


25 
	#__CURL_CCSIDCURL_H


	)

27 
	~"cuæ.h
"

28 
	~"ósy.h
"

29 
	~"mu…i.h
"

32 
CURL_EXTERN
 * 
cuæ_vîsi⁄_ccsid
(
ccsid
);

33 
CURL_EXTERN
 * 
cuæ_ósy_esˇ≥_ccsid
(
CURL
 * 
h™dÀ
,

34 c⁄° * 
°rög
, 
Àngth
,

35 
sccsid
,

36 
dccsid
);

37 
CURL_EXTERN
 * 
cuæ_ósy_u√sˇ≥_ccsid
(
CURL
 * 
h™dÀ
, c⁄° * 
°rög
,

38 
Àngth
, * 
ouéígth
,

39 
sccsid
,

40 
dccsid
);

41 
CURL_EXTERN
 
cuæ_¶i°
 * 
cuæ_¶i°_≠≥nd_ccsid
(cuæ_¶i° * 
l
,

42 c⁄° * 
d©a
,

43 
ccsid
);

44 
CURL_EXTERN
 
time_t
 
cuæ_gëd©e_ccsid
(c⁄° * 
p
, c⁄°Åime_à* 
unu£d
,

45 
ccsid
);

46 
CURL_EXTERN
 
cuæ_vîsi⁄_öfo_d©a
 * 
cuæ_vîsi⁄_öfo_ccsid
(
CURLvîsi⁄
 
°amp
,

47 
cid
);

48 
CURL_EXTERN
 c⁄° * 
cuæ_ósy_°ªº‹_ccsid
(
CURLcode
 
îr‹
,

49 
ccsid
);

50 
CURL_EXTERN
 c⁄° * 
cuæ_sh¨e_°ªº‹_ccsid
(
CURLSHcode
 
îr‹
,

51 
ccsid
);

52 
CURL_EXTERN
 c⁄° * 
cuæ_mu…i_°ªº‹_ccsid
(
CURLMcode
 
îr‹
,

53 
ccsid
);

54 
CURL_EXTERN
 
CURLcode
 
cuæ_ósy_gëöfo_ccsid
(
CURL
 * 
cuæ
, 
CURLINFO
 
öfo
, ...);

55 
CURL_EXTERN
 
CURLFORMcode
 
cuæ_f‹madd_ccsid
(
cuæ_hâµo°
 * * 
hâµo°
,

56 
cuæ_hâµo°
 * * 
œ°_po°
,

58 
CURL_EXTERN
 * 
cuæ_f‹m_l⁄g_vÆue
(
vÆue
);

59 
CURL_EXTERN
 
cuæ_f‹mgë_ccsid
(
cuæ_hâµo°
 * 
f‹m
, * 
¨g
,

60 
cuæ_f‹mgë_ˇŒback
 
≠≥nd
,

61 
ccsid
);

62 
CURL_EXTERN
 
CURLcode
 
cuæ_ósy_£t›t_ccsid
(
CURL
 * 
cuæ
, 
CURL›ti⁄
 
èg
, ...);

63 
CURL_EXTERN
 
cuæ_˚πöfo_‰ì_Æl
(
cuæ_˚πöfo
 *
öfo
);

	@packages/OS400/os400sys.c

26 
	~"cuæbuûd.h
"

27 
	~"c⁄fig-os400.h
"

29 
	~<sys/ty≥s.h
>

30 
	~<sys/sockë.h
>

31 
	~<sys/un.h
>

33 
	~<°dlib.h
>

34 
	~<°ddef.h
>

35 
	~<°rög.h
>

36 
	~<±hªad.h
>

37 
	~<√tdb.h
>

38 
	~<qadπ.h
>

39 
	~<î∫o.h
>

41 #ifde‡
HAVE_ZLIB_H


42 
	~<zlib.h
>

45 #ifde‡
USE_QSOSSL


46 
	~<qsos¶.h
>

49 #ifde‡
USE_GSKIT


50 
	~<gsks¶.h
>

51 
	~<qsﬂsync.h
>

54 #ifde‡
HAVE_GSSAPI


55 
	~<gsßpi.h
>

58 #i‚de‡
CURL_DISABLE_LDAP


59 
	~<ld≠.h
>

62 
	~<√töë/ö.h
>

63 
	~<¨∑/öë.h
>

65 
	~"os400sys.h
"

75 #¥agm®
c⁄vît
(0)

78 
	#MIN_BYTE_GAIN
 1024

	)

81 
	msize
;

82 * 
	mbuf
;

83 } 
	tbuf„r_t
;

86 * 
buf„r_undef
(
loˇlkey_t
 
key
, 
size
);

87 * 
buf„r_thªaded
(
loˇlkey_t
 
key
, 
size
);

88 * 
buf„r_u¡hªaded
(
loˇlkey_t
 
key
, 
size
);

90 
±hªad_muãx_t
 
	gmuãx
 = 
PTHREAD_MUTEX_INITIALIZER
;

91 
±hªad_key_t
 
	gthdkey
;

92 
buf„r_t
 * 
	glocbufs
;

94 * (* 
	gCuæ_thªad_buf„r
)(
loˇlkey_t
 
	gkey
, 
	gsize
Ë
buf„r_undef
;

98 
	$thdbufde°roy
(* 
¥iv©e
)

101 
loˇlkey_t
 
i
;

102 
buf„r_t
 * 
p
;

104 if(
¥iv©e
) {

105 
p
 = (
buf„r_t
 *Ë
¥iv©e
;

107 
i
 = (
loˇlkey_t
Ë0; i < 
LK_LAST
; i++) {

108 if(
p
->
buf
)

109 
	`‰ì
(
p
->
buf
);

111 
p
++;

114 
	`‰ì
(
¥iv©e
);

116 
	}
}

120 
	$ãrmö©e
()

123 if(
Cuæ_thªad_buf„r
 =
buf„r_thªaded
) {

124 
locbufs
 = 
	`±hªad_gë•ecific
(
thdkey
);

125 
	`±hªad_£t•ecific
(
thdkey
, (*Ë
NULL
);

126 
	`±hªad_key_dñëe
(
thdkey
);

129 if(
Cuæ_thªad_buf„r
 !
buf„r_undef
) {

130 
	`thdbufde°roy
((*Ë
locbufs
);

131 
locbufs
 = (
buf„r_t
 *Ë
NULL
;

134 
Cuæ_thªad_buf„r
 = 
buf„r_undef
;

135 
	}
}

139 
	$gë_buf„r
(
buf„r_t
 * 
buf
, 
size
)

142 * 
˝
;

147 if(
size
 < 0)

148  
buf
->buf;

150 if(!
buf
->buf) {

151 if((
buf
->bu‡
	`mÆloc
(
size
)))

152 
buf
->
size
 = size;

154  
buf
->buf;

157 if((Ë
size
 <
buf
->size) {

161 if(
buf
->
size
 - sizê< 
MIN_BYTE_GAIN
)

162  
buf
->buf;

167 if((
˝
 = 
	`ªÆloc
(
buf
->buf, 
size
))) {

168 
buf
->bu‡
˝
;

169 
buf
->
size
 = size;

171 if(
size
 <
buf
->size)

172 
˝
 = 
buf
->buf;

174  
˝
;

175 
	}
}

179 
	$buf„r_u¡hªaded
(
loˇlkey_t
 
key
, 
size
)

182  
	`gë_buf„r
(
locbufs
 + 
key
, 
size
);

183 
	}
}

187 
	$buf„r_thªaded
(
loˇlkey_t
 
key
, 
size
)

190 
buf„r_t
 * 
bufs
;

196 
bufs
 = (
buf„r_t
 *Ë
	`±hªad_gë•ecific
(
thdkey
);

198 if(!
bufs
) {

199 if(
size
 < 0)

200  (*Ë
NULL
;

204 if(!(
bufs
 = 
	`ˇŒoc
((
size_t
Ë
LK_LAST
,  *bufs)))

205  (*Ë
NULL
;

207 if(
	`±hªad_£t•ecific
(
thdkey
, (*Ë
bufs
)) {

208 
	`‰ì
(
bufs
);

209  (*Ë
NULL
;

213  
	`gë_buf„r
(
bufs
 + 
key
, 
size
);

214 
	}
}

218 
	$buf„r_undef
(
loˇlkey_t
 
key
, 
size
)

225 
	`±hªad_muãx_lock
(&
muãx
);

229 if(
Cuæ_thªad_buf„r
 =
buf„r_undef
) {

230 if(!
	`±hªad_key_¸óã
(&
thdkey
, 
thdbufde°roy
))

231 
Cuæ_thªad_buf„r
 = 
buf„r_thªaded
;

232 if(!(
locbufs
 = 
	`ˇŒoc
((
size_t
Ë
LK_LAST
,  *locbufs))) {

233 
	`±hªad_muãx_u∆ock
(&
muãx
);

234  (*Ë
NULL
;

237 
Cuæ_thªad_buf„r
 = 
buf„r_u¡hªaded
;

239 
	`©exô
(
ãrmö©e
);

242 
	`±hªad_muãx_u∆ock
(&
muãx
);

243  
	`Cuæ_thªad_buf„r
(
key
, 
size
);

244 
	}
}

248 
	$£t_thªad_°rög
(
loˇlkey_t
 
key
, c⁄° * 
s
)

251 
i
;

252 * 
˝
;

254 if(!
s
)

255  (*Ë
NULL
;

257 
i
 = 
	`°æí
(
s
) + 1;

258 
˝
 = 
	`Cuæ_thªad_buf„r
(
key
, 
MAX_CONV_EXPANSION
 * 
i
 + 1);

260 if(
˝
) {

261 
i
 = 
	`QadπC⁄vîtE2A
(
˝
, 
s
, 
MAX_CONV_EXPANSION
 * i, i);

262 
˝
[
i
] = '\0';

265  
˝
;

266 
	}
}

270 
	$Cuæ_gë«meöfo_a
(c⁄° 
sockaddr
 * 
ß
, 
cuæ_sockÀn_t
 
ßÀn
,

271 * 
nodíame
, 
cuæ_sockÀn_t
 
nodíamñí
,

272 * 
£rv«me
, 
cuæ_sockÀn_t
 
£rv«mñí
,

273 
Êags
)

276 * 
íodíame
;

277 * 
e£rv«me
;

278 
°©us
;

279 
i
;

281 
íodíame
 = (*Ë
NULL
;

282 
e£rv«me
 = (*Ë
NULL
;

284 if(
nodíame
 && 
nodíamñí
)

285 if(!(
íodíame
 = 
	`mÆloc
(
nodíamñí
)))

286  
EAI_MEMORY
;

288 if(
£rv«me
 && 
£rv«mñí
)

289 if(!(
e£rv«me
 = 
	`mÆloc
(
£rv«mñí
))) {

290 if(
íodíame
)

291 
	`‰ì
(
íodíame
);

293  
EAI_MEMORY
;

296 
°©us
 = 
	`gë«meöfo
(
ß
, 
ßÀn
, 
íodíame
, 
nodíamñí
,

297 
e£rv«me
, 
£rv«mñí
, 
Êags
);

299 if(!
°©us
) {

300 if(
íodíame
) {

301 
i
 = 
	`QadπC⁄vîtE2A
(
nodíame
, 
íodíame
,

302 
nodíamñí
 - 1, 
	`°æí
(
íodíame
));

303 
nodíame
[
i
] = '\0';

306 if(
e£rv«me
) {

307 
i
 = 
	`QadπC⁄vîtE2A
(
£rv«me
, 
e£rv«me
,

308 
£rv«mñí
 - 1, 
	`°æí
(
e£rv«me
));

309 
£rv«me
[
i
] = '\0';

313 if(
íodíame
)

314 
	`‰ì
(
íodíame
);

316 if(
e£rv«me
)

317 
	`‰ì
(
e£rv«me
);

319  
°©us
;

320 
	}
}

324 
	$Cuæ_gëaddröfo_a
(c⁄° * 
nodíame
, c⁄° * 
£rv«me
,

325 c⁄° 
addröfo
 * 
höts
,

326 
addröfo
 * * 
ªs
)

329 * 
íodíame
;

330 * 
e£rv«me
;

331 
°©us
;

332 
i
;

334 
íodíame
 = (*Ë
NULL
;

335 
e£rv«me
 = (*Ë
NULL
;

337 if(
nodíame
) {

338 
i
 = 
	`°æí
(
nodíame
);

340 if(!(
íodíame
 = 
	`mÆloc
(
i
 + 1)))

341  
EAI_MEMORY
;

343 
i
 = 
	`QadπC⁄vîtA2E
(
íodíame
, 
nodíame
, i, i);

344 
íodíame
[
i
] = '\0';

347 if(
£rv«me
) {

348 
i
 = 
	`°æí
(
£rv«me
);

350 if(!(
e£rv«me
 = 
	`mÆloc
(
i
 + 1))) {

351 if(
íodíame
)

352 
	`‰ì
(
íodíame
);

354  
EAI_MEMORY
;

357 
	`QadπC⁄vîtA2E
(
e£rv«me
, 
£rv«me
, 
i
, i);

358 
e£rv«me
[
i
] = '\0';

361 
°©us
 = 
	`gëaddröfo
(
íodíame
, 
e£rv«me
, 
höts
, 
ªs
);

363 if(
íodíame
)

364 
	`‰ì
(
íodíame
);

366 if(
e£rv«me
)

367 
	`‰ì
(
e£rv«me
);

369  
°©us
;

370 
	}
}

373 #ifde‡
USE_QSOSSL


378 
	$Cuæ_SSL_Inô_Aµliˇti⁄_a
(
SSLInôAµ
 * 
öô_≠p
)

381 
rc
;

382 
i
;

383 
SSLInôAµ
 
ü
;

385 if(!
öô_≠p
 || !öô_≠p->
≠∂iˇti⁄ID
 || !öô_≠p->
≠∂iˇti⁄IDLí
)

386  
	`SSL_Inô_Aµliˇti⁄
(
öô_≠p
);

388 
	`mem˝y
((*Ë&
ü
, (*Ë
öô_≠p
,  ia);

389 
i
 = 
ü
.
≠∂iˇti⁄IDLí
;

391 if(!(
ü
.
≠∂iˇti⁄ID
 = 
	`mÆloc
(
i
 + 1))) {

392 
î∫o
 = 
ENOMEM
;

393  
SSL_ERROR_IO
;

396 
	`QadπC⁄vîtA2E
(
ü
.
≠∂iˇti⁄ID
, 
öô_≠p
->≠∂iˇti⁄ID, 
i
, i);

397 
ü
.
≠∂iˇti⁄ID
[
i
] = '\0';

398 
rc
 = 
	`SSL_Inô_Aµliˇti⁄
(&
ü
);

399 
	`‰ì
(
ü
.
≠∂iˇti⁄ID
);

400 
öô_≠p
->
loˇlCîtifiˇãLí
 = 
ü
.localCertificateLen;

401 
öô_≠p
->
£ssi⁄Ty≥
 = 
ü
.sessionType;

402  
rc
;

403 
	}
}

407 
	$Cuæ_SSL_Inô_a
(
SSLInô
 * 
öô
)

410 
rc
;

411 
i
;

412 
SSLInô
 
ü
;

414 if(!
öô
 || (!öô->
keyrögFûeName
 && !öô->
keyrögPassw‹d
))

415  
	`SSL_Inô
(
öô
);

417 
	`mem˝y
((*Ë&
ü
, (*Ë
öô
,  ia);

419 if(
ü
.
keyrögFûeName
) {

420 
i
 = 
	`°æí
(
ü
.
keyrögFûeName
);

422 if(!(
ü
.
keyrögFûeName
 = 
	`mÆloc
(
i
 + 1))) {

423 
î∫o
 = 
ENOMEM
;

424  
SSL_ERROR_IO
;

427 
	`QadπC⁄vîtA2E
(
ü
.
keyrögFûeName
, 
öô
->keyrögFûeName, 
i
, i);

428 
ü
.
keyrögFûeName
[
i
] = '\0';

431 if(
ü
.
keyrögPassw‹d
) {

432 
i
 = 
	`°æí
(
ü
.
keyrögPassw‹d
);

434 if(!(
ü
.
keyrögPassw‹d
 = 
	`mÆloc
(
i
 + 1))) {

435 if(
ü
.
keyrögFûeName
)

436 
	`‰ì
(
ü
.
keyrögFûeName
);

438 
î∫o
 = 
ENOMEM
;

439  
SSL_ERROR_IO
;

442 
	`QadπC⁄vîtA2E
(
ü
.
keyrögPassw‹d
, 
öô
->keyrögPassw‹d, 
i
, i);

443 
ü
.
keyrögPassw‹d
[
i
] = '\0';

446 
rc
 = 
	`SSL_Inô
(&
ü
);

448 if(
ü
.
keyrögFûeName
)

449 
	`‰ì
(
ü
.
keyrögFûeName
);

451 if(
ü
.
keyrögPassw‹d
)

452 
	`‰ì
(
ü
.
keyrögPassw‹d
);

454  
rc
;

455 
	}
}

459 
	$Cuæ_SSL_Såîr‹_a
(
s¶ªtu∫vÆue
, 
SSLEº‹Msg
 * 
£ºmsgp
)

462  
	`£t_thªad_°rög
(
LK_SSL_ERROR
,

463 
	`SSL_Såîr‹
(
s¶ªtu∫vÆue
, 
£ºmsgp
));

464 
	}
}

469 #ifde‡
USE_GSKIT


483 
	sgsk°æi°
 {

484 
gsk°æi°
 * 
	m√xt
;

485 c⁄° * 
	mebcdic°r
;

486 c⁄° * 
	mascii°r
;

489 
	sCuæ_gsk_des¸ùt‹
 {

490 
gsk_h™dÀ
 
	mh
;

491 
gsk°æi°
 * 
	m°æi°
;

496 
	$Cuæ_gsk_ívú⁄mít_›í
(
gsk_h™dÀ
 * 
my_ív_h™dÀ
)

499 
Cuæ_gsk_des¸ùt‹
 * 
p
;

500 
gsk_h™dÀ
 
h
;

501 
rc
;

503 if(!
my_ív_h™dÀ
)

504  
GSK_OS400_ERROR_INVALID_POINTER
;

505 if(!(
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
	`mÆloc
( *p)))

506  
GSK_INSUFFICIENT_STORAGE
;

507 
p
->
°æi°
 = (
gsk°æi°
 *Ë
NULL
;

508 if((
rc
 = 
	`gsk_ívú⁄mít_›í
(&
p
->
h
)Ë!
GSK_OK
)

509 
	`‰ì
(
p
);

511 *
my_ív_h™dÀ
 = (
gsk_h™dÀ
Ë
p
;

512  
rc
;

513 
	}
}

517 
	$Cuæ_gsk_£cuª_soc_›í
(
gsk_h™dÀ
 
my_ív_h™dÀ
,

518 
gsk_h™dÀ
 * 
my_£ssi⁄_h™dÀ
)

521 
Cuæ_gsk_des¸ùt‹
 * 
p
;

522 
gsk_h™dÀ
 
h
;

523 
rc
;

525 if(!
my_ív_h™dÀ
)

526  
GSK_INVALID_HANDLE
;

527 if(!
my_£ssi⁄_h™dÀ
)

528  
GSK_OS400_ERROR_INVALID_POINTER
;

529 
h
 = ((
Cuæ_gsk_des¸ùt‹
 *Ë
my_ív_h™dÀ
)->h;

530 if(!(
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
	`mÆloc
( *p)))

531  
GSK_INSUFFICIENT_STORAGE
;

532 
p
->
°æi°
 = (
gsk°æi°
 *Ë
NULL
;

533 if((
rc
 = 
	`gsk_£cuª_soc_›í
(
h
, &
p
->h)Ë!
GSK_OK
)

534 
	`‰ì
(
p
);

536 *
my_£ssi⁄_h™dÀ
 = (
gsk_h™dÀ
Ë
p
;

537  
rc
;

538 
	}
}

542 
	$gsk_‰ì_h™dÀ
(
Cuæ_gsk_des¸ùt‹
 * 
p
)

545 
gsk°æi°
 * 
q
;

547 (
q
 = 
p
->
°æi°
)) {

548 
p
->
°æi°
 = 
q
;

549 
	`‰ì
((*Ë
q
->
ascii°r
);

550 
	`‰ì
(
q
);

552 
	`‰ì
(
p
);

553 
	}
}

557 
	$Cuæ_gsk_ívú⁄mít_˛o£
(
gsk_h™dÀ
 * 
my_ív_h™dÀ
)

560 
Cuæ_gsk_des¸ùt‹
 * 
p
;

561 
rc
;

563 if(!
my_ív_h™dÀ
)

564  
GSK_OS400_ERROR_INVALID_POINTER
;

565 if(!*
my_ív_h™dÀ
)

566  
GSK_INVALID_HANDLE
;

567 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë*
my_ív_h™dÀ
;

568 if((
rc
 = 
	`gsk_ívú⁄mít_˛o£
(&
p
->
h
)Ë=
GSK_OK
) {

569 
	`gsk_‰ì_h™dÀ
(
p
);

570 *
my_ív_h™dÀ
 = (
gsk_h™dÀ
Ë
NULL
;

572  
rc
;

573 
	}
}

577 
	$Cuæ_gsk_£cuª_soc_˛o£
(
gsk_h™dÀ
 * 
my_£ssi⁄_h™dÀ
)

580 
Cuæ_gsk_des¸ùt‹
 * 
p
;

581 
rc
;

583 if(!
my_£ssi⁄_h™dÀ
)

584  
GSK_OS400_ERROR_INVALID_POINTER
;

585 if(!*
my_£ssi⁄_h™dÀ
)

586  
GSK_INVALID_HANDLE
;

587 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë*
my_£ssi⁄_h™dÀ
;

588 if((
rc
 = 
	`gsk_£cuª_soc_˛o£
(&
p
->
h
)Ë=
GSK_OK
) {

589 
	`gsk_‰ì_h™dÀ
(
p
);

590 *
my_£ssi⁄_h™dÀ
 = (
gsk_h™dÀ
Ë
NULL
;

592  
rc
;

593 
	}
}

597 
	$Cuæ_gsk_ívú⁄mít_öô
(
gsk_h™dÀ
 
my_ív_h™dÀ
)

600 
Cuæ_gsk_des¸ùt‹
 * 
p
;

602 if(!
my_ív_h™dÀ
)

603  
GSK_INVALID_HANDLE
;

604 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_ív_h™dÀ
;

605  
	`gsk_ívú⁄mít_öô
(
p
->
h
);

606 
	}
}

610 
	$Cuæ_gsk_£cuª_soc_öô
(
gsk_h™dÀ
 
my_£ssi⁄_h™dÀ
)

613 
Cuæ_gsk_des¸ùt‹
 * 
p
;

615 if(!
my_£ssi⁄_h™dÀ
)

616  
GSK_INVALID_HANDLE
;

617 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_£ssi⁄_h™dÀ
;

618  
	`gsk_£cuª_soc_öô
(
p
->
h
);

619 
	}
}

623 
	$Cuæ_gsk_©åibuã_£t_buf„r_a
(
gsk_h™dÀ
 
my_gsk_h™dÀ
, 
GSK_BUF_ID
 
bufID
,

624 c⁄° * 
buf„r
, 
bufSize
)

627 
Cuæ_gsk_des¸ùt‹
 * 
p
;

628 * 
ebcdicbuf
;

629 
rc
;

631 if(!
my_gsk_h™dÀ
)

632  
GSK_INVALID_HANDLE
;

633 if(!
buf„r
)

634  
GSK_OS400_ERROR_INVALID_POINTER
;

635 if(
bufSize
 < 0)

636  
GSK_ATTRIBUTE_INVALID_LENGTH
;

637 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_gsk_h™dÀ
;

638 if(!
bufSize
)

639 
bufSize
 = 
	`°æí
(
buf„r
);

640 if(!(
ebcdicbuf
 = 
	`mÆloc
(
bufSize
 + 1)))

641  
GSK_INSUFFICIENT_STORAGE
;

642 
	`QadπC⁄vîtA2E
(
ebcdicbuf
, 
buf„r
, 
bufSize
, bufSize);

643 
ebcdicbuf
[
bufSize
] = '\0';

644 
rc
 = 
	`gsk_©åibuã_£t_buf„r
(
p
->
h
, 
bufID
, 
ebcdicbuf
, 
bufSize
);

645 
	`‰ì
(
ebcdicbuf
);

646  
rc
;

647 
	}
}

651 
	$Cuæ_gsk_©åibuã_£t_íum
(
gsk_h™dÀ
 
my_gsk_h™dÀ
, 
GSK_ENUM_ID
 
íumID
,

652 
GSK_ENUM_VALUE
 
íumVÆue
)

655 
Cuæ_gsk_des¸ùt‹
 * 
p
;

657 if(!
my_gsk_h™dÀ
)

658  
GSK_INVALID_HANDLE
;

659 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_gsk_h™dÀ
;

660  
	`gsk_©åibuã_£t_íum
(
p
->
h
, 
íumID
, 
íumVÆue
);

661 
	}
}

665 
	$Cuæ_gsk_©åibuã_£t_numîic_vÆue
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

666 
GSK_NUM_ID
 
numID
, 
numVÆue
)

669 
Cuæ_gsk_des¸ùt‹
 * 
p
;

671 if(!
my_gsk_h™dÀ
)

672  
GSK_INVALID_HANDLE
;

673 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_gsk_h™dÀ
;

674  
	`gsk_©åibuã_£t_numîic_vÆue
(
p
->
h
, 
numID
, 
numVÆue
);

675 
	}
}

679 
	$Cuæ_gsk_©åibuã_£t_ˇŒback
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

680 
GSK_CALLBACK_ID
 
ˇŒBackID
,

681 * 
ˇŒBackAªaPå
)

684 
Cuæ_gsk_des¸ùt‹
 * 
p
;

686 if(!
my_gsk_h™dÀ
)

687  
GSK_INVALID_HANDLE
;

688 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_gsk_h™dÀ
;

689  
	`gsk_©åibuã_£t_ˇŒback
(
p
->
h
, 
ˇŒBackID
, 
ˇŒBackAªaPå
);

690 
	}
}

694 
	$ˇche°rög
(
Cuæ_gsk_des¸ùt‹
 * 
p
,

695 c⁄° * 
ebcdicbuf
, 
bufsize
, c⁄° * * 
buf„r
)

698 
rc
;

699 * 
asciibuf
;

700 
gsk°æi°
 * 
•
;

702 
•
 = 
p
->
°æi°
; sp; s∞•->
√xt
)

703 if(
•
->
ebcdic°r
 =
ebcdicbuf
)

705 if(!
•
) {

706 if(!(
•
 = (
gsk°æi°
 *Ë
	`mÆloc
( *sp)))

707  
GSK_INSUFFICIENT_STORAGE
;

708 if(!(
asciibuf
 = 
	`mÆloc
(
bufsize
 + 1))) {

709 
	`‰ì
(
•
);

710  
GSK_INSUFFICIENT_STORAGE
;

712 
	`QadπC⁄vîtE2A
(
asciibuf
, 
ebcdicbuf
, 
bufsize
, bufsize);

713 
asciibuf
[
bufsize
] = '\0';

714 
•
->
ebcdic°r
 = 
ebcdicbuf
;

715 
•
->
ascii°r
 = 
asciibuf
;

716 
•
->
√xt
 = 
p
->
°æi°
;

717 
p
->
°æi°
 = 
•
;

719 *
buf„r
 = 
•
->
ascii°r
;

720  
GSK_OK
;

721 
	}
}

725 
	$Cuæ_gsk_©åibuã_gë_buf„r_a
(
gsk_h™dÀ
 
my_gsk_h™dÀ
, 
GSK_BUF_ID
 
bufID
,

726 c⁄° * * 
buf„r
, * 
bufSize
)

729 
Cuæ_gsk_des¸ùt‹
 * 
p
;

730 
rc
;

731 c⁄° * 
mybuf
;

732 
myÀn
;

734 if(!
my_gsk_h™dÀ
)

735  
GSK_INVALID_HANDLE
;

736 if(!
buf„r
 || !
bufSize
)

737  
GSK_OS400_ERROR_INVALID_POINTER
;

738 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_gsk_h™dÀ
;

739 if((
rc
 = 
	`gsk_©åibuã_gë_buf„r
(
p
->
h
, 
bufID
, &
mybuf
, &
myÀn
)Ë!
GSK_OK
)

740  
rc
;

741 if((
rc
 = 
	`ˇche°rög
(
p
, 
mybuf
, 
myÀn
, 
buf„r
)Ë=
GSK_OK
)

742 *
bufSize
 = 
myÀn
;

743  
rc
;

744 
	}
}

748 
	$Cuæ_gsk_©åibuã_gë_íum
(
gsk_h™dÀ
 
my_gsk_h™dÀ
, 
GSK_ENUM_ID
 
íumID
,

749 
GSK_ENUM_VALUE
 * 
íumVÆue
)

752 
Cuæ_gsk_des¸ùt‹
 * 
p
;

754 if(!
my_gsk_h™dÀ
)

755  
GSK_INVALID_HANDLE
;

756 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_gsk_h™dÀ
;

757  
	`gsk_©åibuã_gë_íum
(
p
->
h
, 
íumID
, 
íumVÆue
);

758 
	}
}

762 
	$Cuæ_gsk_©åibuã_gë_numîic_vÆue
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

763 
GSK_NUM_ID
 
numID
, * 
numVÆue
)

766 
Cuæ_gsk_des¸ùt‹
 * 
p
;

768 if(!
my_gsk_h™dÀ
)

769  
GSK_INVALID_HANDLE
;

770 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_gsk_h™dÀ
;

771  
	`gsk_©åibuã_gë_numîic_vÆue
(
p
->
h
, 
numID
, 
numVÆue
);

772 
	}
}

776 
	$Cuæ_gsk_©åibuã_gë_˚π_öfo
(
gsk_h™dÀ
 
my_gsk_h™dÀ
,

777 
GSK_CERT_ID
 
˚πID
,

778 c⁄° 
gsk_˚π_d©a_ñem
 * * 
˚πD©aEÀm
,

779 * 
˚πD©aEÀmítCou¡
)

782 
Cuæ_gsk_des¸ùt‹
 * 
p
;

784 if(!
my_gsk_h™dÀ
)

785  
GSK_INVALID_HANDLE
;

786 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_gsk_h™dÀ
;

788  
	`gsk_©åibuã_gë_˚π_öfo
(
p
->
h
, 
˚πID
,

789 
˚πD©aEÀm
, 
˚πD©aEÀmítCou¡
);

790 
	}
}

794 
	$Cuæ_gsk_£cuª_soc_misc
(
gsk_h™dÀ
 
my_£ssi⁄_h™dÀ
, 
GSK_MISC_ID
 
miscID
)

797 
Cuæ_gsk_des¸ùt‹
 * 
p
;

799 if(!
my_£ssi⁄_h™dÀ
)

800  
GSK_INVALID_HANDLE
;

801 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_£ssi⁄_h™dÀ
;

802  
	`gsk_£cuª_soc_misc
(
p
->
h
, 
miscID
);

803 
	}
}

807 
	$Cuæ_gsk_£cuª_soc_ªad
(
gsk_h™dÀ
 
my_£ssi⁄_h™dÀ
, * 
ªadBuf„r
,

808 
ªadBufSize
, * 
amtRód
)

811 
Cuæ_gsk_des¸ùt‹
 * 
p
;

813 if(!
my_£ssi⁄_h™dÀ
)

814  
GSK_INVALID_HANDLE
;

815 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_£ssi⁄_h™dÀ
;

816  
	`gsk_£cuª_soc_ªad
(
p
->
h
, 
ªadBuf„r
, 
ªadBufSize
, 
amtRód
);

817 
	}
}

821 
	$Cuæ_gsk_£cuª_soc_wrôe
(
gsk_h™dÀ
 
my_£ssi⁄_h™dÀ
, * 
wrôeBuf„r
,

822 
wrôeBufSize
, * 
amtWrôãn
)

825 
Cuæ_gsk_des¸ùt‹
 * 
p
;

827 if(!
my_£ssi⁄_h™dÀ
)

828  
GSK_INVALID_HANDLE
;

829 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_£ssi⁄_h™dÀ
;

830  
	`gsk_£cuª_soc_wrôe
(
p
->
h
, 
wrôeBuf„r
, 
wrôeBufSize
, 
amtWrôãn
);

831 
	}
}

835 
	$Cuæ_gsk_°ªº‹_a
(
gsk_ªtu∫_vÆue
)

838  
	`£t_thªad_°rög
(
LK_GSK_ERROR
, 
	`gsk_°ªº‹
(
gsk_ªtu∫_vÆue
));

839 
	}
}

842 
	$Cuæ_gsk_£cuª_soc_°¨tInô
(
gsk_h™dÀ
 
my_£ssi⁄_h™dÀ
,

843 
IOCom∂ëi⁄P‹t
,

844 
Qso_OvîœµedIO_t
 * 
communiˇti⁄sAªa
)

847 
Cuæ_gsk_des¸ùt‹
 * 
p
;

849 if(!
my_£ssi⁄_h™dÀ
)

850  
GSK_INVALID_HANDLE
;

851 
p
 = (
Cuæ_gsk_des¸ùt‹
 *Ë
my_£ssi⁄_h™dÀ
;

852  
	`gsk_£cuª_soc_°¨tInô
(
p
->
h
, 
IOCom∂ëi⁄P‹t
, 
communiˇti⁄sAªa
);

853 
	}
}

859 #ifde‡
HAVE_GSSAPI


864 
	$Cuæ_gss_c⁄vît_ö_∂a˚
(
OM_uöt32
 * 
mö‹_°©us
, 
gss_buf„r_t
 
buf
)

867 
i
;

868 * 
t
;

873 
i
 = 
buf
->
Àngth
;

875 if(
i
) {

876 if(!(
t
 = 
	`mÆloc
(
i
))) {

877 
	`gss_ªÀa£_buf„r
(
mö‹_°©us
, 
buf
);

879 if(
mö‹_°©us
)

880 *
mö‹_°©us
 = 
ENOMEM
;

885 
	`QadπC⁄vîtE2A
(
t
, 
buf
->
vÆue
, 
i
, i);

886 
	`mem˝y
(
buf
->
vÆue
, 
t
, 
i
);

887 
	`‰ì
(
t
);

891 
	}
}

894 
OM_uöt32


895 
	$Cuæ_gss_imp‹t_«me_a
(
OM_uöt32
 * 
mö‹_°©us
, 
gss_buf„r_t
 
ö_«me
,

896 
gss_OID
 
ö_«me_ty≥
, 
gss_«me_t
 * 
out_«me
)

899 
rc
;

900 
i
;

901 
gss_buf„r_desc
 
ö
;

903 if(!
ö_«me
 || !ö_«me->
vÆue
 || !ö_«me->
Àngth
)

904  
	`gss_imp‹t_«me
(
mö‹_°©us
, 
ö_«me
, 
ö_«me_ty≥
, 
out_«me
);

906 
	`mem˝y
((*Ë&
ö
, (*Ë
ö_«me
,  in);

907 
i
 = 
ö
.
Àngth
;

909 if(!(
ö
.
vÆue
 = 
	`mÆloc
(
i
 + 1))) {

910 if(
mö‹_°©us
)

911 *
mö‹_°©us
 = 
ENOMEM
;

913  
GSS_S_FAILURE
;

916 
	`QadπC⁄vîtA2E
(
ö
.
vÆue
, 
ö_«me
->vÆue, 
i
, i);

917 ((*Ë
ö
.
vÆue
)[
i
] = '\0';

918 
rc
 = 
	`gss_imp‹t_«me
(
mö‹_°©us
, &
ö
, 
ö_«me_ty≥
, 
out_«me
);

919 
	`‰ì
(
ö
.
vÆue
);

920  
rc
;

921 
	}
}

924 
OM_uöt32


925 
	$Cuæ_gss_di•œy_°©us_a
(
OM_uöt32
 * 
mö‹_°©us
, OM_uöt32 
°©us_vÆue
,

926 
°©us_ty≥
, 
gss_OID
 
mech_ty≥
,

927 
gss_msg_˘x_t
 * 
mesßge_c⁄ãxt
, 
gss_buf„r_t
 
°©us_°rög
)

930 
rc
;

932 
rc
 = 
	`gss_di•œy_°©us
(
mö‹_°©us
, 
°©us_vÆue
, 
°©us_ty≥
,

933 
mech_ty≥
, 
mesßge_c⁄ãxt
, 
°©us_°rög
);

935 if(
rc
 !
GSS_S_COMPLETE
 || !
°©us_°rög
 ||

936 !
°©us_°rög
->
Àngth
 || !°©us_°rög->
vÆue
)

937  
rc
;

943 if(
	`Cuæ_gss_c⁄vît_ö_∂a˚
(
mö‹_°©us
, 
°©us_°rög
))

944  
GSS_S_FAILURE
;

946  
rc
;

947 
	}
}

950 
OM_uöt32


951 
	$Cuæ_gss_öô_£c_c⁄ãxt_a
(
OM_uöt32
 * 
mö‹_°©us
,

952 
gss_¸ed_id_t
 
¸ed_h™dÀ
,

953 
gss_˘x_id_t
 * 
c⁄ãxt_h™dÀ
,

954 
gss_«me_t
 
èrgë_«me
, 
gss_OID
 
mech_ty≥
,

955 
gss_Êags_t
 
ªq_Êags
, 
OM_uöt32
 
time_ªq
,

956 
gss_ch™√l_bödögs_t
 
öput_ch™_bödögs
,

957 
gss_buf„r_t
 
öput_tokí
,

958 
gss_OID
 * 
a˘uÆ_mech_ty≥
,

959 
gss_buf„r_t
 
ouçut_tokí
, 
gss_Êags_t
 * 
ªt_Êags
,

960 
OM_uöt32
 * 
time_ªc
)

963 
rc
;

964 
i
;

965 
gss_buf„r_desc
 
ö
;

966 
gss_buf„r_t
 
öp
;

968 
ö
.
vÆue
 = 
NULL
;

970 if((
öp
 = 
öput_tokí
))

971 if(
öp
->
Àngth
 && i≈->
vÆue
) {

972 
i
 = 
öp
->
Àngth
;

974 if(!(
ö
.
vÆue
 = 
	`mÆloc
(
i
 + 1))) {

975 if(
mö‹_°©us
)

976 *
mö‹_°©us
 = 
ENOMEM
;

978  
GSS_S_FAILURE
;

981 
	`QadπC⁄vîtA2E
(
ö
.
vÆue
, 
öput_tokí
->vÆue, 
i
, i);

982 ((*Ë
ö
.
vÆue
)[
i
] = '\0';

983 
ö
.
Àngth
 = 
i
;

984 
öp
 = &
ö
;

987 
rc
 = 
	`gss_öô_£c_c⁄ãxt
(
mö‹_°©us
, 
¸ed_h™dÀ
, 
c⁄ãxt_h™dÀ
,

988 
èrgë_«me
, 
mech_ty≥
, 
ªq_Êags
, 
time_ªq
,

989 
öput_ch™_bödögs
, 
öp
, 
a˘uÆ_mech_ty≥
,

990 
ouçut_tokí
, 
ªt_Êags
, 
time_ªc
);

992 if(
ö
.
vÆue
)

993 
	`‰ì
(
ö
.
vÆue
);

995 if(
rc
 !
GSS_S_COMPLETE
 || !
ouçut_tokí
 ||

996 !
ouçut_tokí
->
Àngth
 || !ouçut_tokí->
vÆue
)

997  
rc
;

1003 if(
	`Cuæ_gss_c⁄vît_ö_∂a˚
(
mö‹_°©us
, 
ouçut_tokí
))

1004  
GSS_S_FAILURE
;

1006  
rc
;

1007 
	}
}

1010 
OM_uöt32


1011 
	$Cuæ_gss_dñëe_£c_c⁄ãxt_a
(
OM_uöt32
 * 
mö‹_°©us
,

1012 
gss_˘x_id_t
 * 
c⁄ãxt_h™dÀ
,

1013 
gss_buf„r_t
 
ouçut_tokí
)

1016 
rc
;

1018 
rc
 = 
	`gss_dñëe_£c_c⁄ãxt
(
mö‹_°©us
, 
c⁄ãxt_h™dÀ
, 
ouçut_tokí
);

1020 if(
rc
 !
GSS_S_COMPLETE
 || !
ouçut_tokí
 ||

1021 !
ouçut_tokí
->
Àngth
 || !ouçut_tokí->
vÆue
)

1022  
rc
;

1028 if(
	`Cuæ_gss_c⁄vît_ö_∂a˚
(
mö‹_°©us
, 
ouçut_tokí
))

1029  
GSS_S_FAILURE
;

1031  
rc
;

1032 
	}
}

1037 #i‚de‡
CURL_DISABLE_LDAP


1042 
	$Cuæ_ld≠_öô_a
(* 
ho°
, 
p‹t
)

1045 
i
;

1046 * 
eho°
;

1047 * 
ªsu…
;

1049 if(!
ho°
)

1050  (*Ë
	`ld≠_öô
(
ho°
, 
p‹t
);

1052 
i
 = 
	`°æí
(
ho°
);

1054 if(!(
eho°
 = 
	`mÆloc
(
i
 + 1)))

1055  (*Ë
NULL
;

1057 
	`QadπC⁄vîtA2E
(
eho°
, 
ho°
, 
i
, i);

1058 
eho°
[
i
] = '\0';

1059 
ªsu…
 = (*Ë
	`ld≠_öô
(
eho°
, 
p‹t
);

1060 
	`‰ì
(
eho°
);

1061  
ªsu…
;

1062 
	}
}

1066 
	$Cuæ_ld≠_sim∂e_böd_s_a
(* 
ld
, * 
dn
, * 
∑sswd
)

1069 
i
;

1070 * 
edn
;

1071 * 
ïasswd
;

1073 
edn
 = (*Ë
NULL
;

1074 
ïasswd
 = (*Ë
NULL
;

1076 if(
dn
) {

1077 
i
 = 
	`°æí
(
dn
);

1079 if(!(
edn
 = 
	`mÆloc
(
i
 + 1)))

1080  
LDAP_NO_MEMORY
;

1082 
	`QadπC⁄vîtA2E
(
edn
, 
dn
, 
i
, i);

1083 
edn
[
i
] = '\0';

1086 if(
∑sswd
) {

1087 
i
 = 
	`°æí
(
∑sswd
);

1089 if(!(
ïasswd
 = 
	`mÆloc
(
i
 + 1))) {

1090 if(
edn
)

1091 
	`‰ì
(
edn
);

1093  
LDAP_NO_MEMORY
;

1096 
	`QadπC⁄vîtA2E
(
ïasswd
, 
∑sswd
, 
i
, i);

1097 
ïasswd
[
i
] = '\0';

1100 
i
 = 
	`ld≠_sim∂e_böd_s
(
ld
, 
edn
, 
ïasswd
);

1102 if(
ïasswd
)

1103 
	`‰ì
(
ïasswd
);

1105 if(
edn
)

1106 
	`‰ì
(
edn
);

1108  
i
;

1109 
	}
}

1113 
	$Cuæ_ld≠_£¨ch_s_a
(* 
ld
, * 
ba£
, 
sc›e
, * 
fûãr
,

1114 * * 
©ås
, 
©ås⁄ly
, 
LDAPMesßge
 * * 
ªs
)

1117 
i
;

1118 
j
;

1119 * 
eba£
;

1120 * 
efûãr
;

1121 * * 
óârs
;

1122 
°©us
;

1124 
eba£
 = (*Ë
NULL
;

1125 
efûãr
 = (*Ë
NULL
;

1126 
óârs
 = (* *Ë
NULL
;

1127 
°©us
 = 
LDAP_SUCCESS
;

1129 if(
ba£
) {

1130 
i
 = 
	`°æí
(
ba£
);

1132 if(!(
eba£
 = 
	`mÆloc
(
i
 + 1)))

1133 
°©us
 = 
LDAP_NO_MEMORY
;

1135 
	`QadπC⁄vîtA2E
(
eba£
, 
ba£
, 
i
, i);

1136 
eba£
[
i
] = '\0';

1140 if(
fûãr
 && 
°©us
 =
LDAP_SUCCESS
) {

1141 
i
 = 
	`°æí
(
fûãr
);

1143 if(!(
efûãr
 = 
	`mÆloc
(
i
 + 1)))

1144 
°©us
 = 
LDAP_NO_MEMORY
;

1146 
	`QadπC⁄vîtA2E
(
efûãr
, 
fûãr
, 
i
, i);

1147 
efûãr
[
i
] = '\0';

1151 if(
©ås
 && 
°©us
 =
LDAP_SUCCESS
) {

1152 
i
 = 0; 
©ås
[i++];)

1155 if(!(
óârs
 = 
	`ˇŒoc
(
i
,  *eattrs)))

1156 
°©us
 = 
LDAP_NO_MEMORY
;

1158 
j
 = 0; 
©ås
[j]; j++) {

1159 
i
 = 
	`°æí
(
©ås
[
j
]);

1161 if(!(
óârs
[
j
] = 
	`mÆloc
(
i
 + 1))) {

1162 
°©us
 = 
LDAP_NO_MEMORY
;

1166 
	`QadπC⁄vîtA2E
(
óârs
[
j
], 
©ås
[j], 
i
, i);

1167 
óârs
[
j
][
i
] = '\0';

1172 if(
°©us
 =
LDAP_SUCCESS
)

1173 
°©us
 = 
	`ld≠_£¨ch_s
(
ld
, 
eba£
?Éba£: "", 
sc›e
,

1174 
efûãr
?Éfilter: "(objectclass=*)",

1175 
óârs
, 
©ås⁄ly
, 
ªs
);

1177 if(
óârs
) {

1178 
j
 = 0; 
óârs
[j]; j++)

1179 
	`‰ì
(
óârs
[
j
]);

1181 
	`‰ì
(
óârs
);

1184 if(
efûãr
)

1185 
	`‰ì
(
efûãr
);

1187 if(
eba£
)

1188 
	`‰ì
(
eba£
);

1190  
°©us
;

1191 
	}
}

1194 
bîvÆ
 * *

1195 
	$Cuæ_ld≠_gë_vÆues_Àn_a
(* 
ld
, 
LDAPMesßge
 * 
íåy
, c⁄° * 
©å
)

1198 
i
;

1199 * 
˝
;

1200 
bîvÆ
 * * 
ªsu…
;

1202 
˝
 = (*Ë
NULL
;

1204 if(
©å
) {

1205 
i
 = 
	`°æí
(
©å
);

1207 if(!(
˝
 = 
	`mÆloc
(
i
 + 1))) {

1208 
	`ld≠_£t_ldî∫o
(
ld
, 
LDAP_NO_MEMORY
, 
NULL
,

1209 
	`ld≠_îr2°rög
(
LDAP_NO_MEMORY
));

1210  (
bîvÆ
 * *Ë
NULL
;

1213 
	`QadπC⁄vîtA2E
(
˝
, 
©å
, 
i
, i);

1214 
˝
[
i
] = '\0';

1217 
ªsu…
 = 
	`ld≠_gë_vÆues_Àn
(
ld
, 
íåy
, 
˝
);

1219 if(
˝
)

1220 
	`‰ì
(
˝
);

1225  
ªsu…
;

1226 
	}
}

1230 
	$Cuæ_ld≠_îr2°rög_a
(
îr‹
)

1233  
	`£t_thªad_°rög
(
LK_LDAP_ERROR
, 
	`ld≠_îr2°rög
(
îr‹
));

1234 
	}
}

1238 
	$Cuæ_ld≠_gë_dn_a
(* 
ld
, 
LDAPMesßge
 * 
íåy
)

1241 
i
;

1242 * 
˝
;

1243 * 
˝2
;

1245 
˝
 = 
	`ld≠_gë_dn
(
ld
, 
íåy
);

1247 if(!
˝
)

1248  
˝
;

1250 
i
 = 
	`°æí
(
˝
);

1252 if(!(
˝2
 = 
	`mÆloc
(
i
 + 1)))

1253  
˝2
;

1255 
	`QadπC⁄vîtE2A
(
˝2
, 
˝
, 
i
, i);

1256 
˝2
[
i
] = '\0';

1262 
	`°r˝y
(
˝
, 
˝2
);

1263 
	`‰ì
(
˝2
);

1264  
˝
;

1265 
	}
}

1269 
	$Cuæ_ld≠_fú°_©åibuã_a
(* 
ld
,

1270 
LDAPMesßge
 * 
íåy
, 
BîEÀmít
 * * 
bî±r
)

1273 
i
;

1274 * 
˝
;

1275 * 
˝2
;

1277 
˝
 = 
	`ld≠_fú°_©åibuã
(
ld
, 
íåy
, 
bî±r
);

1279 if(!
˝
)

1280  
˝
;

1282 
i
 = 
	`°æí
(
˝
);

1284 if(!(
˝2
 = 
	`mÆloc
(
i
 + 1)))

1285  
˝2
;

1287 
	`QadπC⁄vîtE2A
(
˝2
, 
˝
, 
i
, i);

1288 
˝2
[
i
] = '\0';

1294 
	`°r˝y
(
˝
, 
˝2
);

1295 
	`‰ì
(
˝2
);

1296  
˝
;

1297 
	}
}

1301 
	$Cuæ_ld≠_√xt_©åibuã_a
(* 
ld
,

1302 
LDAPMesßge
 * 
íåy
, 
BîEÀmít
 * 
bî±r
)

1305 
i
;

1306 * 
˝
;

1307 * 
˝2
;

1309 
˝
 = 
	`ld≠_√xt_©åibuã
(
ld
, 
íåy
, 
bî±r
);

1311 if(!
˝
)

1312  
˝
;

1314 
i
 = 
	`°æí
(
˝
);

1316 if(!(
˝2
 = 
	`mÆloc
(
i
 + 1)))

1317  
˝2
;

1319 
	`QadπC⁄vîtE2A
(
˝2
, 
˝
, 
i
, i);

1320 
˝2
[
i
] = '\0';

1326 
	`°r˝y
(
˝
, 
˝2
);

1327 
	`‰ì
(
˝2
);

1328  
˝
;

1329 
	}
}

1335 
	$c⁄vît_sockaddr
(
sockaddr_°‹age
 * 
d°addr
,

1336 c⁄° 
sockaddr
 * 
§ˇddr
, 
§˛í
)

1339 c⁄° 
sockaddr_un
 * 
§cu
;

1340 
sockaddr_un
 * 
d°u
;

1341 
i
;

1342 
d°size
;

1346 if(!
§ˇddr
 || 
§˛í
 < 
	`off£tof
(
sockaddr
, 
ß_Ámûy
) +

1347  
§ˇddr
->
ß_Ámûy
 || 
§˛í
 >  *
d°addr
) {

1348 
î∫o
 = 
EINVAL
;

1352 
	`mem˝y
((*Ë
d°addr
, (*Ë
§ˇddr
, 
§˛í
);

1354 
§ˇddr
->
ß_Ámûy
) {

1356 
AF_UNIX
:

1357 
§cu
 = (c⁄° 
sockaddr_un
 *Ë
§ˇddr
;

1358 
d°u
 = (
sockaddr_un
 *Ë
d°addr
;

1359 
d°size
 =  *
d°addr
 - 
	`off£tof
(
sockaddr_un
, 
sun_∑th
);

1360 
§˛í
 -
	`off£tof
(
sockaddr_un
, 
sun_∑th
);

1361 
i
 = 
	`QadπC⁄vîtA2E
(
d°u
->
sun_∑th
, 
§cu
->sun_∑th, 
d°size
 - 1, 
§˛í
);

1362 
d°u
->
sun_∑th
[
i
] = '\0';

1363 
i
 +
	`off£tof
(
sockaddr_un
, 
sun_∑th
);

1364 
§˛í
 = 
i
;

1367  
§˛í
;

1368 
	}
}

1372 
	$Cuæ_os400_c⁄√˘
(
sd
, 
sockaddr
 * 
de°addr
, 
addæí
)

1375 
i
;

1376 
sockaddr_°‹age
 
œddr
;

1378 
i
 = 
	`c⁄vît_sockaddr
(&
œddr
, 
de°addr
, 
addæí
);

1380 if(
i
 < 0)

1383  
	`c⁄√˘
(
sd
, (
sockaddr
 *Ë&
œddr
, 
i
);

1384 
	}
}

1388 
	$Cuæ_os400_böd
(
sd
, 
sockaddr
 * 
loˇœddr
, 
addæí
)

1391 
i
;

1392 
sockaddr_°‹age
 
œddr
;

1394 
i
 = 
	`c⁄vît_sockaddr
(&
œddr
, 
loˇœddr
, 
addæí
);

1396 if(
i
 < 0)

1399  
	`böd
(
sd
, (
sockaddr
 *Ë&
œddr
, 
i
);

1400 
	}
}

1404 
	$Cuæ_os400_£ndto
(
sd
, * 
buf„r
, 
buÊí
, 
Êags
,

1405 
sockaddr
 * 
d°addr
, 
addæí
)

1408 
i
;

1409 
sockaddr_°‹age
 
œddr
;

1411 
i
 = 
	`c⁄vît_sockaddr
(&
œddr
, 
d°addr
, 
addæí
);

1413 if(
i
 < 0)

1416  
	`£ndto
(
sd
, 
buf„r
, 
buÊí
, 
Êags
, (
sockaddr
 *Ë&
œddr
, 
i
);

1417 
	}
}

1421 
	$Cuæ_os400_ªcv‰om
(
sd
, * 
buf„r
, 
buÊí
, 
Êags
,

1422 
sockaddr
 * 
‰omaddr
, * 
addæí
)

1425 
i
;

1426 
rcvÀn
;

1427 
œddæí
;

1428 c⁄° 
sockaddr_un
 * 
§cu
;

1429 
sockaddr_un
 * 
d°u
;

1430 
sockaddr_°‹age
 
œddr
;

1432 if(!
‰omaddr
 || !
addæí
 || *addrlen <= 0)

1433  
	`ªcv‰om
(
sd
, 
buf„r
, 
buÊí
, 
Êags
, 
‰omaddr
, 
addæí
);

1435 
œddæí
 =  
œddr
;

1436 
œddr
.
ss_Ámûy
 = 
AF_UNSPEC
;

1437 
rcvÀn
 = 
	`ªcv‰om
(
sd
, 
buf„r
, 
buÊí
, 
Êags
,

1438 (
sockaddr
 *Ë&
œddr
, &
œddæí
);

1440 if(
rcvÀn
 < 0)

1441  
rcvÀn
;

1443 
œddr
.
ss_Ámûy
) {

1445 
AF_UNIX
:

1446 
§cu
 = (c⁄° 
sockaddr_un
 *Ë&
œddr
;

1447 
d°u
 = (
sockaddr_un
 *Ë
‰omaddr
;

1448 
i
 = *
addæí
 - 
	`off£tof
(
sockaddr_un
, 
sun_∑th
);

1449 
œddæí
 -
	`off£tof
(
sockaddr_un
, 
sun_∑th
);

1450 
i
 = 
	`QadπC⁄vîtE2A
(
d°u
->
sun_∑th
, 
§cu
->sun_∑th, i, 
œddæí
);

1451 
œddæí
 = 
i
 + 
	`off£tof
(
sockaddr_un
, 
sun_∑th
);

1453 if(
œddæí
 < *
addæí
)

1454 
d°u
->
sun_∑th
[
i
] = '\0';

1458 
AF_UNSPEC
:

1462 if(
œddæí
 > *
addæí
)

1463 
œddæí
 = *
addæí
;

1465 if(
œddæí
)

1466 
	`mem˝y
((*Ë
‰omaddr
, (*Ë&
œddr
, 
œddæí
);

1471 *
addæí
 = 
œddæí
;

1472  
rcvÀn
;

1473 
	}
}

1476 #ifde‡
HAVE_LIBZ


1478 
	$Cuæ_os400_zlibVîsi⁄
()

1481  
	`£t_thªad_°rög
(
LK_ZLIB_VERSION
, 
	`zlibVîsi⁄
());

1482 
	}
}

1486 
	$Cuæ_os400_öÊ©eInô_
(
z_°ªamp
 
°rm
, c⁄° * 
vîsi⁄
, 
°ªam_size
)

1489 
z_c⁄°
 * 
msgb4
 = 
°rm
->
msg
;

1490 
ªt
;

1492 
ªt
 = 
	`öÊ©eInô
(
°rm
);

1494 if(
°rm
->
msg
 !
msgb4
)

1495 
°rm
->
msg
 = 
	`£t_thªad_°rög
(
LK_ZLIB_MSG
, strm->msg);

1497  
ªt
;

1498 
	}
}

1502 
	$Cuæ_os400_öÊ©eInô2_
(
z_°ªamp
 
°rm
, 
wödowBôs
,

1503 c⁄° * 
vîsi⁄
, 
°ªam_size
)

1506 
z_c⁄°
 * 
msgb4
 = 
°rm
->
msg
;

1507 
ªt
;

1509 
ªt
 = 
	`öÊ©eInô2
(
°rm
, 
wödowBôs
);

1511 if(
°rm
->
msg
 !
msgb4
)

1512 
°rm
->
msg
 = 
	`£t_thªad_°rög
(
LK_ZLIB_MSG
, strm->msg);

1514  
ªt
;

1515 
	}
}

1519 
	$Cuæ_os400_öÊ©e
(
z_°ªamp
 
°rm
, 
Êush
)

1522 
z_c⁄°
 * 
msgb4
 = 
°rm
->
msg
;

1523 
ªt
;

1525 
ªt
 = 
	`öÊ©e
(
°rm
, 
Êush
);

1527 if(
°rm
->
msg
 !
msgb4
)

1528 
°rm
->
msg
 = 
	`£t_thªad_°rög
(
LK_ZLIB_MSG
, strm->msg);

1530  
ªt
;

1531 
	}
}

1535 
	$Cuæ_os400_öÊ©eEnd
(
z_°ªamp
 
°rm
)

1538 
z_c⁄°
 * 
msgb4
 = 
°rm
->
msg
;

1539 
ªt
;

1541 
ªt
 = 
	`öÊ©eEnd
(
°rm
);

1543 if(
°rm
->
msg
 !
msgb4
)

1544 
°rm
->
msg
 = 
	`£t_thªad_°rög
(
LK_ZLIB_MSG
, strm->msg);

1546  
ªt
;

1547 
	}
}

	@packages/OS400/os400sys.h

26 #i‚de‡
__OS400_SYS_


27 
	#__OS400_SYS_


	)

33 
	mLK_SSL_ERROR
,

34 
	mLK_GSK_ERROR
,

35 
	mLK_LDAP_ERROR
,

36 
	mLK_CURL_VERSION
,

37 
	mLK_VERSION_INFO
,

38 
	mLK_VERSION_INFO_DATA
,

39 
	mLK_EASY_STRERROR
,

40 
	mLK_SHARE_STRERROR
,

41 
	mLK_MULTI_STRERROR
,

42 
	mLK_ZLIB_VERSION
,

43 
	mLK_ZLIB_MSG
,

44 
	mLK_LAST


45 } 
	tloˇlkey_t
;

48 * (* 
Cuæ_thªad_buf„r
)(
loˇlkey_t
 
key
, 
size
);

53 
	#MAX_CONV_EXPANSION
 4

	)

	@packages/vms/curl_crtl_init.c

36 
	~<°dio.h
>

37 
	~<°rög.h
>

40 
	~<des¸ù.h
>

41 
	~< mdef.h
>

42 
	~<°sdef.h
>

44 #¥agm®
membî_Æignmít
 
ßve


45 #¥agm®
nomembî_Æignmít
 
l⁄gw‹d


46 #¥agm®
mesßge
 
ßve


47 #¥agm®
mesßge
 
dißbÀ
 
mißlgndmem


48 
	sôml°_3
 {

49 
	mbuÊí
;

50 
	mômcode
;

51 *
	mbuÁdr
;

52 *
	mªéí
;

54 #¥agm®
mesßge
 
ª°‹e


55 #¥agm®
membî_Æignmít
 
ª°‹e


57 #ifde‡
__VAX


58 
	#ENABLE
 "ENABLE"

	)

59 
	#DISABLE
 "DISABLE"

	)

62 
	#ENABLE
 
TRUE


	)

63 
	#DISABLE
 0

	)

64 
decc$„©uª_gë_ödex
 (c⁄° *
«me
);

65 
decc$„©uª_£t_vÆue
 (
ödex
, 
mode
, 
vÆue
);

68 
SYS$TRNLNM
(

69 c⁄° * 
©å
,

70 c⁄° 
dsc$des¸ùt‹_s
 * 
èbÀ_dsc
,

71 
dsc$des¸ùt‹_s
 * 
«me_dsc
,

72 c⁄° * 
acmode
,

73 c⁄° 
ôml°_3
 * 
ôem_li°
);

74 
SYS$CRELNM
(

75 c⁄° * 
©å
,

76 c⁄° 
dsc$des¸ùt‹_s
 * 
èbÀ_dsc
,

77 c⁄° 
dsc$des¸ùt‹_s
 * 
«me_dsc
,

78 c⁄° * 
acmode
,

79 c⁄° 
ôml°_3
 * 
ôem_li°
);

83 
	gsys_å∆nm


84 (c⁄° * 
	glog«me
,

85 * 
	gvÆue
,

86 
	gvÆue_Àn
)

88 c⁄° 
$DESCRIPTOR
(
èbÀ_dsc
, "LNM$FILE_DEV");

89 c⁄° 
	g©å
 = 
LNM$M_CASE_BLIND
;

90 
dsc$des¸ùt‹_s
 
	g«me_dsc
;

91 
	g°©us
;

92 
	gªsu…
;

93 
ôml°_3
 
	gôl°
[2];

95 
	gôl°
[0].
	gbuÊí
 = 
vÆue_Àn
;

96 
	gôl°
[0].
	gômcode
 = 
LNM$_STRING
;

97 
	gôl°
[0].
	gbuÁdr
 = 
vÆue
;

98 
	gôl°
[0].
	gªéí
 = &
ªsu…
;

100 
	gôl°
[1].
	gbuÊí
 = 0;

101 
	gôl°
[1].
	gômcode
 = 0;

103 
	g«me_dsc
.
	gdsc$w_Àngth
 = 
°æí
(
log«me
);

104 
	g«me_dsc
.
	gdsc$a_poöãr
 = (*)
log«me
;

105 
	g«me_dsc
.
	gdsc$b_dty≥
 = 
DSC$K_DTYPE_T
;

106 
	g«me_dsc
.
	gdsc$b_˛ass
 = 
DSC$K_CLASS_S
;

108 
	g°©us
 = 
SYS$TRNLNM
(&
©å
, &
èbÀ_dsc
, &
«me_dsc
, 0, 
ôl°
);

110 i‡(
$VMS_STATUS_SUCCESS
(
°©us
)) {

114 
	gvÆue
[
ªsu…
] = '\0';

117  
	g°©us
;

121 
	gsys_¸ñnm


122 (c⁄° * 
	glog«me
,

123 c⁄° * 
	gvÆue
)

125 
	gªt_vÆ
;

126 c⁄° * 
	g¥oc_èbÀ
 = "LNM$PROCESS_TABLE";

127 
dsc$des¸ùt‹_s
 
	g¥oc_èbÀ_dsc
;

128 
dsc$des¸ùt‹_s
 
	glog«me_dsc
;

129 
ôml°_3
 
	gôem_li°
[2];

131 
	g¥oc_èbÀ_dsc
.
	gdsc$a_poöãr
 = (*Ë
¥oc_èbÀ
;

132 
	g¥oc_èbÀ_dsc
.
	gdsc$w_Àngth
 = 
°æí
(
¥oc_èbÀ
);

133 
	g¥oc_èbÀ_dsc
.
	gdsc$b_dty≥
 = 
DSC$K_DTYPE_T
;

134 
	g¥oc_èbÀ_dsc
.
	gdsc$b_˛ass
 = 
DSC$K_CLASS_S
;

136 
	glog«me_dsc
.
	gdsc$a_poöãr
 = (*Ë
log«me
;

137 
	glog«me_dsc
.
	gdsc$w_Àngth
 = 
°æí
(
log«me
);

138 
	glog«me_dsc
.
	gdsc$b_dty≥
 = 
DSC$K_DTYPE_T
;

139 
	glog«me_dsc
.
	gdsc$b_˛ass
 = 
DSC$K_CLASS_S
;

141 
	gôem_li°
[0].
	gbuÊí
 = 
°æí
(
vÆue
);

142 
	gôem_li°
[0].
	gômcode
 = 
LNM$_STRING
;

143 
	gôem_li°
[0].
	gbuÁdr
 = (*)
vÆue
;

144 
	gôem_li°
[0].
	gªéí
 = 
NULL
;

146 
	gôem_li°
[1].
	gbuÊí
 = 0;

147 
	gôem_li°
[1].
	gômcode
 = 0;

149 
	gªt_vÆ
 = 
SYS$CRELNM
(
NULL
, &
¥oc_èbÀ_dsc
, &
log«me_dsc
, NULL, 
ôem_li°
);

151  
	gªt_vÆ
;

160 #ifde‡
__VAX


161 
	$£t_„©uª_deÁu…
(c⁄° *
«me
, c⁄° *
vÆue
)

163 
	`sys_¸ñnm
(
«me
, 
vÆue
);

164 
	}
}

166 
	$£t_„©uª_deÁu…
(c⁄° *
«me
, 
vÆue
)

168 
ödex
;

170 
ödex
 = 
	`decc$„©uª_gë_ödex
(
«me
);

172 i‡(
ödex
 > 0)

173 
	`decc$„©uª_£t_vÆue
 (
ödex
, 0, 
vÆue
);

174 
	}
}

177 
	$£t_„©uªs
()

179 
°©us
;

180 
unix_shñl_«me
[255];

181 
u£_unix_£âögs
 = 1;

183 
°©us
 = 
	`sys_å∆nm
("GNV$UNIX_SHELL",

184 
unix_shñl_«me
,  unix_shell_name -1);

185 i‡(!
	`$VMS_STATUS_SUCCESS
(
°©us
)) {

186 
unix_shñl_«me
[0] = 0;

187 
u£_unix_£âögs
 = 0;

191 
	`£t_„©uª_deÁu…
("DECC$ACL_ACCESS_CHECK", 
ENABLE
);

194 
	`£t_„©uª_deÁu…
 ("DECC$ARGV_PARSE_STYLE" , 
ENABLE
);

200 
	`£t_„©uª_deÁu…
("DECC$DISABLE_POSIX_ROOT", 
DISABLE
);

204 
	`£t_„©uª_deÁu…
 ("DECC$EFS_CHARSET", 
ENABLE
);

205 
	`£t_„©uª_deÁu…
 ("DECC$EFS_CASE_PRESERVE", 
ENABLE
);

208 
	`£t_„©uª_deÁu…
 ("DECC$EFS_FILE_TIMESTAMPS", 
ENABLE
);

211 
	`£t_„©uª_deÁu…
 ("DECC$ENABLE_GETENV_CACHE", 
ENABLE
);

214 #ifde‡
__VAX


215 
	`£t_„©uª_deÁu…
 ("DECC$EXEC_FILEATTR_INHERITANCE", "2");

217 
	`£t_„©uª_deÁu…
 ("DECC$EXEC_FILEATTR_INHERITANCE", 2);

221 
	`£t_„©uª_deÁu…
 ("DECC$READDIR_DROPDOTNOTYPE", 
ENABLE
);

225 
	`£t_„©uª_deÁu…
 ("DECC$STDIO_CTX_EOL", 
ENABLE
);

228 
	`£t_„©uª_deÁu…
 ("DECC$RENAME_NO_INHERIT", 
ENABLE
);

230 i‡(
u£_unix_£âögs
) {

233 
	`£t_„©uª_deÁu…
 ("DECC$ALLOW_REMOVE_OPEN_FILES", 
ENABLE
);

236 
	`£t_„©uª_deÁu…
 ("DECC$FILENAME_UNIX_ONLY", 
ENABLE
);

240 
	`£t_„©uª_deÁu…
 ("DECC$FILE_PERMISSION_UNIX", 
ENABLE
);

242 
	`£t_„©uª_deÁu…
 ("DECC$FILE_SHARING", 
ENABLE
);

244 
	`£t_„©uª_deÁu…
 ("DECC$FILE_OWNER_UNIX", 
ENABLE
);

245 
	`£t_„©uª_deÁu…
 ("DECC$POSIX_SEEK_STREAM_FILE", 
ENABLE
);

248 
	`£t_„©uª_deÁu…
("DECC$FILENAME_UNIX_REPORT", 
ENABLE
);

252 
	`£t_„©uª_deÁu…
 ("DECC$GLOB_UNIX_STYLE", 
ENABLE
);

256 
	`£t_„©uª_deÁu…
("DECC$FILENAME_UNIX_NO_VERSION", 
ENABLE
);

260 
	`£t_„©uª_deÁu…
("DECC$UNIX_PATH_BEFORE_LOGNAME", 
ENABLE
);

263 
	`£t_„©uª_deÁu…
("DECC$STRTOL_ERANGE", 
ENABLE
);

269 
	}
}

274 #¥agm®
no°™d¨d


275 #¥agm®
exã∫_modñ
 
ßve


276 #ifde‡
__VAX


277 #¥agm®
exã∫_modñ
 
°ri˘_ªfdef
 "LIB$INITIALIZE" 
nowπ
, , 
n›ic


279 #¥agm®
exã∫_modñ
 
°ri˘_ªfdef
 "LIB$INITIALIZE" 
nowπ
, 

280 #i‡
__INITIAL_POINTER_SIZE


281 #¥agm®
__poöãr_size
 
__ßve


282 #¥agm®
__poöãr_size
 32

284 #¥agm®
__ªquúed_poöãr_size
 
__ßve


285 #¥agm®
__ªquúed_poöãr_size
 32

289 (* c⁄° 
öüºay
[])(Ë{
£t_„©uªs
, 
	}
} ;

290 #i‚de‡
__VAX


291 #i‡
__INITIAL_POINTER_SIZE


292 #¥agm®
__poöãr_size
 
__ª°‹e


294 #¥agm®
__ªquúed_poöãr_size
 
__ª°‹e


303 
LIB$INITIALIZE
();

304 #ifde‡
__DECC


305 #¥agm®
exã∫_modñ
 
°ri˘_ªfdef


307 
	glib_öô_ªf
 = (Ë
LIB$INITIALIZE
;

308 #ifde‡
__DECC


309 #¥agm®
exã∫_modñ
 
ª°‹e


310 #¥agm®
°™d¨d


	@packages/vms/curlmsg.h

1 #i‚de‡
HEADER_CURLMSG_H


2 
	#HEADER_CURLMSG_H


	)

25 #¥agm®
__membî_Æignmít
 
__ßve


26 #¥agm®
__nomembî_Æignmít


51 
	#CURL_FACILITY
 3841

	)

52 
	#CURL_OK
 251756553

	)

53 
	#CURL_UNSUPPORTED_PROTOCOL
 251756562

	)

54 
	#CURL_FAILED_INIT
 251756570

	)

55 
	#CURL_URL_MALFORMAT
 251756578

	)

56 
	#CURL_OBSOLETE4
 251756586

	)

57 
	#CURL_COULDNT_RESOLVE_PROXY
 251756594

	)

58 
	#CURL_COULDNT_RESOLVE_HOST
 251756602

	)

59 
	#CURL_COULDNT_CONNECT
 251756610

	)

60 
	#CURL_FTP_WEIRD_SERVER_REPLY
 251756618

	)

61 
	#CURL_FTP_ACCESS_DENIED
 251756626

	)

62 
	#CURL_OBSOLETE10
 251756634

	)

63 
	#CURL_FTP_WEIRD_PASS_REPLY
 251756642

	)

64 
	#CURL_OBSOLETE12
 251756650

	)

65 
	#CURL_FTP_WEIRD_PASV_REPLY
 251756658

	)

66 
	#CURL_FTP_WEIRD_227_FORMAT
 251756666

	)

67 
	#CURL_FTP_CANT_GET_HOST
 251756674

	)

68 
	#CURL_OBSOLETE16
 251756682

	)

69 
	#CURL_FTP_COULDNT_SET_TYPE
 251756690

	)

70 
	#CURL_PARTIAL_FILE
 251756698

	)

71 
	#CURL_FTP_COULDNT_RETR_FILE
 251756706

	)

72 
	#CURL_OBSOLETE20
 251756714

	)

73 
	#CURL_QUOTE_ERROR
 251756722

	)

74 
	#CURL_HTTP_RETURNED_ERROR
 251756730

	)

75 
	#CURL_WRITE_ERROR
 251756738

	)

76 
	#CURL_OBSOLETE24
 251756746

	)

77 
	#CURL_UPLOAD_FAILED
 251756754

	)

78 
	#CURL_READ_ERROR
 251756762

	)

79 
	#CURL_OUT_OF_MEMORY
 251756770

	)

80 
	#CURL_OPERATION_TIMEOUTED
 251756778

	)

81 
	#CURL_OBSOLETE29
 251756786

	)

82 
	#CURL_FTP_PORT_FAILED
 251756794

	)

83 
	#CURL_FTP_COULDNT_USE_REST
 251756802

	)

84 
	#CURL_OBSOLETE32
 251756810

	)

85 
	#CURL_RANGE_ERROR
 251756818

	)

86 
	#CURL_HTTP_POST_ERROR
 251756826

	)

87 
	#CURL_SSL_CONNECT_ERROR
 251756834

	)

88 
	#CURL_BAD_DOWNLOAD_RESUME
 251756842

	)

89 
	#CURL_FILE_COULDNT_READ_FILE
 251756850

	)

90 
	#CURL_LDAP_CANNOT_BIND
 251756858

	)

91 
	#CURL_LDAP_SEARCH_FAILED
 251756866

	)

92 
	#CURL_OBSOLETE40
 251756874

	)

93 
	#CURL_FUNCTION_NOT_FOUND
 251756882

	)

94 
	#CURL_ABORTED_BY_CALLBACK
 251756890

	)

95 
	#CURL_BAD_FUNCTION_ARGUMENT
 251756898

	)

96 
	#CURL_OBSOLETE44
 251756906

	)

97 
	#CURL_INTERFACE_FAILED
 251756914

	)

98 
	#CURL_OBSOLETE46
 251756922

	)

99 
	#CURL_TOO_MANY_REDIRECTS
 251756930

	)

100 
	#CURL_UNKNOWN_TELNET_OPTION
 251756938

	)

101 
	#CURL_TELNET_OPTION_SYNTAX
 251756946

	)

102 
	#CURL_OBSOLETE50
 251756954

	)

103 
	#CURL_PEER_FAILED_VERIF
 251756962

	)

104 
	#CURL_GOT_NOTHING
 251756970

	)

105 
	#CURL_SSL_ENGINE_NOTFOUND
 251756978

	)

106 
	#CURL_SSL_ENGINE_SETFAILED
 251756986

	)

107 
	#CURL_SEND_ERROR
 251756994

	)

108 
	#CURL_RECV_ERROR
 251757002

	)

109 
	#CURL_OBSOLETE57
 251757010

	)

110 
	#CURL_SSL_CERTPROBLEM
 251757018

	)

111 
	#CURL_SSL_CIPHER
 251757026

	)

112 
	#CURL_SSL_CACERT
 251757034

	)

113 
	#CURL_BAD_CONTENT_ENCODING
 251757042

	)

114 
	#CURL_LDAP_INVALID_URL
 251757050

	)

115 
	#CURL_FILESIZE_EXCEEDED
 251757058

	)

116 
	#CURL_USE_SSL_FAILED
 251757066

	)

117 
	#CURL_SEND_FAIL_REWIND
 251757074

	)

118 
	#CURL_SSL_ENGINE_INITFAILED
 251757082

	)

119 
	#CURL_LOGIN_DENIED
 251757090

	)

120 
	#CURL_TFTP_NOTFOUND
 251757098

	)

121 
	#CURL_TFTP_PERM
 251757106

	)

122 
	#CURL_REMOTE_DISK_FULL
 251757114

	)

123 
	#CURL_TFTP_ILLEGAL
 251757122

	)

124 
	#CURL_TFTP_UNKNOWNID
 251757130

	)

125 
	#CURL_REMOTE_FILE_EXISTS
 251757138

	)

126 
	#CURL_TFTP_NOSUCHUSER
 251757146

	)

127 
	#CURL_CONV_FAILED
 251757154

	)

128 
	#CURL_CONV_REQD
 251757162

	)

129 
	#CURL_SSL_CACERT_BADFILE
 251757170

	)

130 
	#CURL_REMOTE_FILE_NOT_FOUND
 251757178

	)

131 
	#CURL_SSH
 251757186

	)

132 
	#CURL_SSL_SHUTDOWN_FAILED
 251757194

	)

133 
	#CURL_AGAIN
 251757202

	)

134 
	#CURL_SSL_CRL_BADFILE
 251757210

	)

135 
	#CURL_SSL_ISSUER_ERROR
 251757218

	)

136 
	#CURL_CURL_LAST
 251757226

	)

138 #¥agm®
__membî_Æignmít
 
__ª°‹e


	@packages/vms/curlmsg_vms.h

1 #i‚de‡
HEADER_CURLMSG_VMS_H


2 
	#HEADER_CURLMSG_VMS_H


	)

36 
	~"cuæmsg.h
"

52 c⁄° 
	gvms_c⁄d
[] =

54 
CURL_OK
,

55 
CURL_UNSUPPORTED_PROTOCOL
,

56 
CURL_FAILED_INIT
,

57 
CURL_URL_MALFORMAT
,

58 
CURL_OBSOLETE4
,

59 
CURL_COULDNT_RESOLVE_PROXY
,

60 
CURL_COULDNT_RESOLVE_HOST
,

61 
CURL_COULDNT_CONNECT
,

62 
CURL_FTP_WEIRD_SERVER_REPLY
,

63 
CURL_FTP_ACCESS_DENIED
,

64 
CURL_OBSOLETE10
,

65 
CURL_FTP_WEIRD_PASS_REPLY
,

66 
CURL_OBSOLETE12
,

67 
CURL_FTP_WEIRD_PASV_REPLY
,

68 
CURL_FTP_WEIRD_227_FORMAT
,

69 
CURL_FTP_CANT_GET_HOST
,

70 
CURL_OBSOLETE16
,

71 
CURL_FTP_COULDNT_SET_TYPE
,

72 
CURL_PARTIAL_FILE
,

73 
CURL_FTP_COULDNT_RETR_FILE
,

74 
CURL_OBSOLETE20
,

75 
CURL_QUOTE_ERROR
,

76 
CURL_HTTP_RETURNED_ERROR
,

77 
CURL_WRITE_ERROR
,

78 
CURL_OBSOLETE24
,

79 
CURL_UPLOAD_FAILED
,

80 
CURL_READ_ERROR
,

81 
CURL_OUT_OF_MEMORY
,

82 
CURL_OPERATION_TIMEOUTED
,

83 
CURL_OBSOLETE29
,

84 
CURL_FTP_PORT_FAILED
,

85 
CURL_FTP_COULDNT_USE_REST
,

86 
CURL_OBSOLETE32
,

87 
CURL_RANGE_ERROR
,

88 
CURL_HTTP_POST_ERROR
,

89 
CURL_SSL_CONNECT_ERROR
,

90 
CURL_BAD_DOWNLOAD_RESUME
,

91 
CURL_FILE_COULDNT_READ_FILE
,

92 
CURL_LDAP_CANNOT_BIND
,

93 
CURL_LDAP_SEARCH_FAILED
,

94 
CURL_OBSOLETE40
,

95 
CURL_FUNCTION_NOT_FOUND
,

96 
CURL_ABORTED_BY_CALLBACK
,

97 
CURL_BAD_FUNCTION_ARGUMENT
,

98 
CURL_OBSOLETE44
,

99 
CURL_INTERFACE_FAILED
,

100 
CURL_OBSOLETE46
,

101 
CURL_TOO_MANY_REDIRECTS
,

102 
CURL_UNKNOWN_TELNET_OPTION
,

103 
CURL_TELNET_OPTION_SYNTAX
,

104 
CURL_OBSOLETE50
,

105 
CURL_PEER_FAILED_VERIF
,

106 
CURL_GOT_NOTHING
,

107 
CURL_SSL_ENGINE_NOTFOUND
,

108 
CURL_SSL_ENGINE_SETFAILED
,

109 
CURL_SEND_ERROR
,

110 
CURL_RECV_ERROR
,

111 
CURL_OBSOLETE57
,

112 
CURL_SSL_CERTPROBLEM
,

113 
CURL_SSL_CIPHER
,

114 
CURL_SSL_CACERT
,

115 
CURL_BAD_CONTENT_ENCODING
,

116 
CURL_LDAP_INVALID_URL
,

117 
CURL_FILESIZE_EXCEEDED
,

118 
CURL_USE_SSL_FAILED
,

119 
CURL_SEND_FAIL_REWIND
,

120 
CURL_SSL_ENGINE_INITFAILED
,

121 
CURL_LOGIN_DENIED
,

122 
CURL_TFTP_NOTFOUND
,

123 
CURL_TFTP_PERM
,

124 
CURL_REMOTE_DISK_FULL
,

125 
CURL_TFTP_ILLEGAL
,

126 
CURL_TFTP_UNKNOWNID
,

127 
CURL_REMOTE_FILE_EXISTS
,

128 
CURL_TFTP_NOSUCHUSER
,

129 
CURL_CONV_FAILED
,

130 
CURL_CONV_REQD
,

131 
CURL_SSL_CACERT_BADFILE
,

132 
CURL_REMOTE_FILE_NOT_FOUND
,

133 
CURL_SSH
,

134 
CURL_SSL_SHUTDOWN_FAILED
,

135 
CURL_AGAIN
,

136 
CURLE_SSL_CRL_BADFILE
,

137 
CURLE_SSL_ISSUER_ERROR
,

138 
CURL_CURL_LAST


	@packages/vms/report_openssl_version.c

28 
	~<dlf˙.h
>

29 
	~<›ís¶/›ís¶v.h
>

30 
	~<›ís¶/¸y±o.h
>

32 
	~<°rög.h
>

33 
	~<des¸ù.h
>

34 
	~<lib˛idef.h
>

35 
	~<°sdef.h
>

36 
	~<î∫o.h
>

38 
LIB$SET_SYMBOL
(

39 c⁄° 
dsc$des¸ùt‹_s
 * 
symbﬁ
,

40 c⁄° 
dsc$des¸ùt‹_s
 * 
vÆue
,

41 c⁄° * 
èbÀ_ty≥
);

43 
	$maö
(
¨gc
, ** 
¨gv
) {

46 * 
lib±r
;

47 c⁄° * (*
s¶_vîsi⁄
)(
t
);

48 c⁄° * 
vîsi⁄
;

50 i‡(
¨gc
 < 1) {

51 
	`puts
("report_openssl_version filename");

52 
	`exô
(1);

55 
lib±r
 = 
	`dl›í
(
¨gv
[1], 0);

57 
s¶_vîsi⁄
 = (c⁄° * (*)())
	`dlsym
(
lib±r
, "SSLeay_version");

58 i‡((*)
s¶_vîsi⁄
 =
NULL
) {

59 
s¶_vîsi⁄
 = (c⁄° * (*)())
	`dlsym
(
lib±r
, "ssleay_version");

60 i‡((*)
s¶_vîsi⁄
 =
NULL
) {

61 
s¶_vîsi⁄
 = (c⁄° * (*)())
	`dlsym
(
lib±r
, "SSLEAY_VERSION");

65 
	`dl˛o£
(
lib±r
);

67 i‡((*)
s¶_vîsi⁄
 =
NULL
) {

68 
	`puts
("UnableÅoÜookup version of OpenSSL");

69 
	`exô
(1);

72 
vîsi⁄
 = 
	`s¶_vîsi⁄
(
SSLEAY_VERSION
);

74 
	`puts
(
vîsi⁄
);

77 i‡(
¨gc
 > 1) {

78 
°©us
;

79 
dsc$des¸ùt‹_s
 
symbﬁ_dsc
;

80 
dsc$des¸ùt‹_s
 
vÆue_dsc
;

81 c⁄° 
èbÀ_ty≥
 = 
LIB$K_CLI_LOCAL_SYM
;

83 
symbﬁ_dsc
.
dsc$a_poöãr
 = 
¨gv
[2];

84 
symbﬁ_dsc
.
dsc$w_Àngth
 = 
	`°æí
(
¨gv
[2]);

85 
symbﬁ_dsc
.
dsc$b_dty≥
 = 
DSC$K_DTYPE_T
;

86 
symbﬁ_dsc
.
dsc$b_˛ass
 = 
DSC$K_CLASS_S
;

88 
vÆue_dsc
.
dsc$a_poöãr
 = (*)
vîsi⁄
;

89 
vÆue_dsc
.
dsc$w_Àngth
 = 
	`°æí
(
vîsi⁄
);

90 
vÆue_dsc
.
dsc$b_dty≥
 = 
DSC$K_DTYPE_T
;

91 
vÆue_dsc
.
dsc$b_˛ass
 = 
DSC$K_CLASS_S
;

93 
°©us
 = 
	`LIB$SET_SYMBOL
(&
symbﬁ_dsc
, &
vÆue_dsc
, &
èbÀ_ty≥
);

94 i‡(!
	`$VMS_STATUS_SUCCESS
(
°©us
)) {

95 
	`exô
(
°©us
);

99 
	`exô
(0);

100 
	}
}

	@packages/vms/vms_eco_level.h

25 #i‚de‡
_VMS_ECO_LEVEL_H


26 
	#_VMS_ECO_LEVEL_H


	)

28 
	#VMS_ECO_LEVEL
 "0"

	)

	@src/macos/src/curl_GUSIConfig.cpp

1 #deföê
	#GUSI_SOURCE
 #ö˛udê
	~<GUSIC⁄fig.h
> #ö˛udê<sys/cdefs.h> __BEGIN_DECLS GUSIwôhI√tSockës(); GUSIwôhLoˇlSockës(); GUSIwôhMTI√tSockës(); GUSIwôhMTT˝Sockës(); GUSIwôhMTUdpSockës(); GUSIwôhOTI√tSockës(); GUSIwôhOTT˝Sockës(); GUSIwôhOTUdpSockës(); GUSIwôhPPCSockës(); GUSISëupFa˘‹õs(); __END_DECLS GUSISëupFa˘‹õs(Ë{ #ifde‡GUSISëupFa˘‹õs_BegöHook GUSISëupFa˘‹õs_BegöHook #ídif();#ifde‡GUSISëupFa˘‹õs_EndHook_EndHook#ídif}/* De˛¨©i⁄†o‡FûêDevi˚†*/__BEGIN_DECLSGUSIwôhNuŒSockës();GUSISëupDevi˚s();__END_DECLS/* C⁄figuª FûêDevi˚†*/GUSISëupDevi˚s(){#ifde‡GUSISëupDevi˚s_BegöHook_BegöHook#ídif();#ifde‡GUSISëupDevi˚s_EndHook_EndHook#ídif}#i‚de‡__˝lu•lus#îr‹ GUSISëupC⁄fig(Ë√ed†tÿbêwrôã¿ö C++#ídif::FûeSuffix sSuffi˚s[] = {"", '????', '????'};"C" void GUSISëupC⁄fig(){* c⁄fig =::Cª©eIn°™˚(GUSIC⁄figuøti⁄::kNoResour˚);->C⁄figuªDeÁu…Ty≥Cª©‹('TEXT', 'CWIE');->C⁄figuªSuffi˚s((sSuffi˚s)/sizeof(GUSIC⁄figuøti⁄::FûeSuffix)-1, sSuffi˚s);}/**************** END GUSI CONFIGURATION *************************/

	@src/macos/src/macos_main.cpp

1 #ö˛udê
	~<°dlib.h
> #ö˛udê<°rög.h> #ö˛udê<°dio.h> #ö˛udê<Mem‹y.h> #ö˛udê<GUSIComm™dLöe.h> #ö˛udê<°dlib.h> DECLARE_MAIN(cuæËREGISTER_MAIN_START REGISTER_MAIN(cuæËREGISTER_MAIN_END maö(Ë{ ::MaxAµlZ⁄e(); ò1; i <10; i++Ë::M‹eMa°îs(); (Ëexec_comm™ds();  0; }

	@src/tool_binmode.c

22 
	~"toﬁ_£tup.h
"

24 #ifde‡
HAVE_SETMODE


26 #ifde‡
HAVE_IO_H


27 
	~<io.h
>

30 #ifde‡
HAVE_FCNTL_H


31 
	~<f˙é.h
>

34 
	~"toﬁ_bömode.h
"

36 
	~"memdebug.h
"

38 
	$£t_bömode
(
FILE
 *
°ªam
)

40 #ifde‡
O_BINARY


41 #ifde‡
__HIGHC__


42 
	`_£tmode
(
°ªam
, 
O_BINARY
);

44 
	`£tmode
(
	`fûío
(
°ªam
), 
O_BINARY
);

47 ()
°ªam
;

49 
	}
}

	@src/tool_binmode.h

1 #i‚de‡
HEADER_CURL_TOOL_BINMODE_H


2 
	#HEADER_CURL_TOOL_BINMODE_H


	)

24 
	~"toﬁ_£tup.h
"

26 #ifde‡
HAVE_SETMODE


28 
£t_bömode
(
FILE
 *
°ªam
);

32 
	#£t_bömode
(
x
Ë
Cuæ_n›_°mt


	)

	@src/tool_bname.c

22 
	~"toﬁ_£tup.h
"

24 
	~"toﬁ_b«me.h
"

26 
	~"memdebug.h
"

28 #i‚de‡
HAVE_BASENAME


30 *
	$toﬁ_ba£«me
(*
∑th
)

32 *
s1
;

33 *
s2
;

35 
s1
 = 
	`°ºchr
(
∑th
, '/');

36 
s2
 = 
	`°ºchr
(
∑th
, '\\');

38 if(
s1
 && 
s2
) {

39 
∑th
 = (
s1
 > 
s2
) ? s1 + 1 : s2 + 1;

41 if(
s1
)

42 
∑th
 = 
s1
 + 1;

43 if(
s2
)

44 
∑th
 = 
s2
 + 1;

46  
∑th
;

47 
	}
}

	@src/tool_bname.h

1 #i‚de‡
HEADER_CURL_TOOL_BNAME_H


2 
	#HEADER_CURL_TOOL_BNAME_H


	)

24 
	~"toﬁ_£tup.h
"

26 #i‚de‡
HAVE_BASENAME


28 *
toﬁ_ba£«me
(*
∑th
);

30 
	#ba£«me
(
x
Ë
	`toﬁ_ba£«me
((x))

	)

	@src/tool_cb_dbg.c

22 
	~"toﬁ_£tup.h
"

24 
	#ENABLE_CURLX_PRINTF


	)

26 
	~"cuæx.h
"

28 
	~"toﬁ_cfgabÀ.h
"

29 
	~"toﬁ_msgs.h
"

30 
	~"toﬁ_cb_dbg.h
"

31 
	~"toﬁ_utû.h
"

33 
	~"memdebug.h
"

35 
dump
(c⁄° *
timebuf
, c⁄° *
ãxt
,

36 
FILE
 *
°ªam
, c⁄° *
±r
, 
size_t
 
size
,

37 
åa˚
 
åa˚ty≥
, 
cuæ_öfŸy≥
 
öfŸy≥
);

43 
	$toﬁ_debug_cb
(
CURL
 *
h™dÀ
, 
cuæ_öfŸy≥
 
ty≥
,

44 *
d©a
, 
size_t
 
size
,

45 *
u£rd©a
)

47 
O≥øti⁄C⁄fig
 *
›î©i⁄
 = 
u£rd©a
;

48 
GlobÆC⁄fig
 *
c⁄fig
 = 
›î©i⁄
->
globÆ
;

49 
FILE
 *
ouçut
 = 
c⁄fig
->
îr‹s
;

50 c⁄° *
ãxt
;

51 
timevÆ
 
tv
;

52 
tm
 *
now
;

53 
timebuf
[20];

54 
time_t
 
£cs
;

55 
time_t
 
ïoch_off£t
;

56 
known_off£t
;

58 ()
h™dÀ
;

60 if(
c⁄fig
->
åa˚time
) {

61 
tv
 = 
	`tvnow
();

62 if(!
known_off£t
) {

63 
ïoch_off£t
 = 
	`time
(
NULL
Ë- 
tv
.
tv_£c
;

64 
known_off£t
 = 1;

66 
£cs
 = 
ïoch_off£t
 + 
tv
.
tv_£c
;

67 
now
 = 
	`loˇ…ime
(&
£cs
);

68 
	`¢¥ötf
(
timebuf
, (timebuf), "%02d:%02d:%02d.%06ld ",

69 
now
->
tm_hour
,Çow->
tm_mö
,Çow->
tm_£c
, ()
tv
.
tv_u£c
);

72 
timebuf
[0] = 0;

74 if(!
c⁄fig
->
åa˚_°ªam
) {

76 if(
	`cuæx_°ªquÆ
("-", 
c⁄fig
->
åa˚_dump
))

77 
c⁄fig
->
åa˚_°ªam
 = 
°dout
;

78 if(
	`cuæx_°ªquÆ
("%", 
c⁄fig
->
åa˚_dump
))

80 
c⁄fig
->
åa˚_°ªam
 = c⁄fig->
îr‹s
;

82 
c⁄fig
->
åa˚_°ªam
 = 
	`f›í
(c⁄fig->
åa˚_dump
, "w");

83 
c⁄fig
->
åa˚_f›íed
 = 
TRUE
;

87 if(
c⁄fig
->
åa˚_°ªam
)

88 
ouçut
 = 
c⁄fig
->
åa˚_°ªam
;

90 if(!
ouçut
) {

91 
	`w¨nf
(
›î©i⁄
, "FailedÅo create/open output");

95 if(
c⁄fig
->
åa˚ty≥
 =
TRACE_PLAIN
) {

100 c⁄° * c⁄° 
s_öfŸy≥
[] = {

103 
size_t
 
i
;

104 
size_t
 
°
 = 0;

105 
boﬁ
 
√wl
 = 
FALSE
;

106 
boﬁ
 
åa˚d_d©a
 = 
FALSE
;

108 
ty≥
) {

109 
CURLINFO_HEADER_OUT
:

110 if(
size
 > 0) {

111 
i
 = 0; i < 
size
 - 1; i++) {

112 if(
d©a
[
i
] == '\n') {

113 if(!
√wl
) {

114 
	`Ârötf
(
ouçut
, "%s%†", 
timebuf
, 
s_öfŸy≥
[
ty≥
]);

116 ()
	`fwrôe
(
d©a
 + 
°
, 
i
 - sà+ 1, 1, 
ouçut
);

117 
°
 = 
i
 + 1;

118 
√wl
 = 
FALSE
;

121 if(!
√wl
)

122 
	`Ârötf
(
ouçut
, "%s%†", 
timebuf
, 
s_öfŸy≥
[
ty≥
]);

123 ()
	`fwrôe
(
d©a
 + 
°
, 
i
 - sà+ 1, 1, 
ouçut
);

125 
√wl
 = (
size
 && (
d©a
[sizê- 1] !'\n')Ë? 
TRUE
 : 
FALSE
;

126 
åa˚d_d©a
 = 
FALSE
;

128 
CURLINFO_TEXT
:

129 
CURLINFO_HEADER_IN
:

130 if(!
√wl
)

131 
	`Ârötf
(
ouçut
, "%s%†", 
timebuf
, 
s_öfŸy≥
[
ty≥
]);

132 ()
	`fwrôe
(
d©a
, 
size
, 1, 
ouçut
);

133 
√wl
 = (
size
 && (
d©a
[sizê- 1] !'\n')Ë? 
TRUE
 : 
FALSE
;

134 
åa˚d_d©a
 = 
FALSE
;

136 
CURLINFO_DATA_OUT
:

137 
CURLINFO_DATA_IN
:

138 
CURLINFO_SSL_DATA_IN
:

139 
CURLINFO_SSL_DATA_OUT
:

140 if(!
åa˚d_d©a
) {

145 if(!
c⁄fig
->
ißây
 || ((
ouçut
 !
°dîr
Ë&& (ouçuà!
°dout
))) {

146 if(!
√wl
)

147 
	`Ârötf
(
ouçut
, "%s%†", 
timebuf
, 
s_öfŸy≥
[
ty≥
]);

148 
	`Ârötf
(
ouçut
, "[dataÇot shown]\n");

149 
√wl
 = 
FALSE
;

150 
åa˚d_d©a
 = 
TRUE
;

155 
√wl
 = 
FALSE
;

156 
åa˚d_d©a
 = 
FALSE
;

163 #ifde‡
CURL_DOES_CONVERSIONS


168 if((
ty≥
 =
CURLINFO_HEADER_OUT
Ë&& (
size
 > 4)) {

169 
size_t
 
i
;

170 
i
 = 0; i < 
size
 - 4; i++) {

171 if(
	`memcmp
(&
d©a
[
i
], "\r\n\r\n", 4) == 0) {

173 
ãxt
 = "=> Send header";

174 
	`dump
(
timebuf
, 
ãxt
, 
ouçut
, 
d©a
, 
i
 + 4, 
c⁄fig
->
åa˚ty≥
, 
ty≥
);

175 
d©a
 +
i
 + 3;

176 
size
 -
i
 + 4;

177 
ty≥
 = 
CURLINFO_DATA_OUT
;

178 
d©a
 += 1;

185 
ty≥
) {

186 
CURLINFO_TEXT
:

187 
	`Ârötf
(
ouçut
, "%s=Info: %s", 
timebuf
, 
d©a
);

191 
CURLINFO_HEADER_OUT
:

192 
ãxt
 = "=> Send header";

194 
CURLINFO_DATA_OUT
:

195 
ãxt
 = "=> Send data";

197 
CURLINFO_HEADER_IN
:

198 
ãxt
 = "<= Recv header";

200 
CURLINFO_DATA_IN
:

201 
ãxt
 = "<= Recv data";

203 
CURLINFO_SSL_DATA_IN
:

204 
ãxt
 = "<= Recv SSL data";

206 
CURLINFO_SSL_DATA_OUT
:

207 
ãxt
 = "=> Send SSL data";

211 
	`dump
(
timebuf
, 
ãxt
, 
ouçut
, 
d©a
, 
size
, 
c⁄fig
->
åa˚ty≥
, 
ty≥
);

213 
	}
}

215 
	$dump
(c⁄° *
timebuf
, c⁄° *
ãxt
,

216 
FILE
 *
°ªam
, c⁄° *
±r
, 
size_t
 
size
,

217 
åa˚
 
åa˚ty≥
, 
cuæ_öfŸy≥
 
öfŸy≥
)

219 
size_t
 
i
;

220 
size_t
 
c
;

222 
width
 = 0x10;

224 if(
åa˚ty≥
 =
TRACE_ASCII
)

226 
width
 = 0x40;

228 
	`Ârötf
(
°ªam
, "%s%s, %zd byã†(0x%zx)\n", 
timebuf
, 
ãxt
, 
size
, size);

230 
i
 = 0; i < 
size
; i +
width
) {

232 
	`Ârötf
(
°ªam
, "%04zx: ", 
i
);

234 if(
åa˚ty≥
 =
TRACE_BIN
) {

236 
c
 = 0; c < 
width
; c++)

237 if(
i
+
c
 < 
size
)

238 
	`Ârötf
(
°ªam
, "%02x ", 
±r
[
i
+
c
]);

240 
	`Âuts
(" ", 
°ªam
);

243 
c
 = 0; (¯< 
width
Ë&& (
i
+¯< 
size
); c++) {

245 if((
åa˚ty≥
 =
TRACE_ASCII
) &&

246 (
i
+
c
+1 < 
size
Ë&& (
±r
[i+c] == 0x0D) && (ptr[i+c+1] == 0x0A)) {

247 
i
 +(
c
+2-
width
);

250 #ifde‡
CURL_DOES_CONVERSIONS


252 if((
åa˚ty≥
 =
TRACE_ASCII
) &&

253 (
i
+
c
+1 < 
size
Ë&& (
±r
[i+c] == '\r') && (ptr[i+c+1] == '\n')) {

254 
i
 +(
c
+2-
width
);

258 
	`Ârötf
(
°ªam
, "%c", 
	`c⁄vît_ch¨
(
öfŸy≥
, 
±r
[
i
+
c
]));

260 ()
öfŸy≥
;

261 
	`Ârötf
(
°ªam
, "%c", ((
±r
[
i
+
c
] >= 0x20) && (ptr[i+c] < 0x80)) ?

262 
±r
[
i
+
c
] : 
UNPRINTABLE_CHAR
);

265 if((
åa˚ty≥
 =
TRACE_ASCII
) &&

266 (
i
+
c
+2 < 
size
Ë&& (
±r
[i+c+1] == 0x0D) && (ptr[i+c+2] == 0x0A)) {

267 
i
 +(
c
+3-
width
);

271 
	`Âutc
('\n', 
°ªam
);

273 
	`fÊush
(
°ªam
);

274 
	}
}

	@src/tool_cb_dbg.h

1 #i‚de‡
HEADER_CURL_TOOL_CB_DBG_H


2 
	#HEADER_CURL_TOOL_CB_DBG_H


	)

24 
	~"toﬁ_£tup.h
"

30 
toﬁ_debug_cb
(
CURL
 *
h™dÀ
, 
cuæ_öfŸy≥
 
ty≥
,

31 *
d©a
, 
size_t
 
size
,

32 *
u£rd©a
);

	@src/tool_cb_hdr.c

22 
	~"toﬁ_£tup.h
"

24 
	~"øw°r.h
"

26 
	#ENABLE_CURLX_PRINTF


	)

28 
	~"cuæx.h
"

30 
	~"toﬁ_cfgabÀ.h
"

31 
	~"toﬁ_msgs.h
"

32 
	~"toﬁ_cb_hdr.h
"

34 
	~"memdebug.h
"

36 *
∑r£_fûíame
(c⁄° *
±r
, 
size_t
 
Àn
);

42 
size_t
 
	$toﬁ_hódî_cb
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£rd©a
)

44 
HdrCbD©a
 *
hdrcbd©a
 = 
u£rd©a
;

45 
OutSåu˘
 *
outs
 = 
hdrcbd©a
->outs;

46 
OutSåu˘
 *
hóds
 = 
hdrcbd©a
->heads;

47 c⁄° *
°r
 = 
±r
;

48 c⁄° 
size_t
 
cb
 = 
size
 * 
nmemb
;

49 c⁄° *
íd
 = (*)
±r
 + 
cb
;

57 
size_t
 
Áûuª
 = (
size
 * 
nmemb
) ? 0 : 1;

59 if(!
hóds
->
c⁄fig
)

60  
Áûuª
;

62 #ifde‡
DEBUGBUILD


63 if(
size
 * 
nmemb
 > (
size_t
)
CURL_MAX_HTTP_HEADER
) {

64 
	`w¨nf
(
hóds
->
c⁄fig
, "Header dataÉxceeds single call writeÜimit!\n");

65  
Áûuª
;

73 if(
hóds
->
c⁄fig
->
hódîfûe
 && hóds->
°ªam
) {

74 
size_t
 
rc
 = 
	`fwrôe
(
±r
, 
size
, 
nmemb
, 
hóds
->
°ªam
);

75 if(
rc
 !
cb
)

76  
rc
;

86 if(
hdrcbd©a
->
h⁄‹_cd_fûíame
 &&

87 (
cb
 > 20Ë&& 
	`check¥efix
("C⁄ã¡-di•osôi⁄:", 
°r
)) {

88 c⁄° *
p
 = 
°r
 + 20;

93 *
fûíame
;

94 
size_t
 
Àn
;

96 *
p
 && (∞< 
íd
Ë&& !
	`ISALPHA
(*p))

97 
p
++;

98 if(
p
 > 
íd
 - 9)

101 if(
	`memcmp
(
p
, "filename=", 9)) {

103 (
p
 < 
íd
) && (*p != ';'))

104 
p
++;

107 
p
 += 9;

112 
Àn
 = (
ssize_t
)
cb
 - (
p
 - 
°r
);

113 
fûíame
 = 
	`∑r£_fûíame
(
p
, 
Àn
);

114 if(
fûíame
) {

115 
outs
->
fûíame
 = filename;

116 
outs
->
Æloc_fûíame
 = 
TRUE
;

117 
outs
->
is_cd_fûíame
 = 
TRUE
;

118 
outs
->
s_i§eg
 = 
TRUE
;

119 
outs
->
f›íed
 = 
FALSE
;

120 
outs
->
°ªam
 = 
NULL
;

121 
hdrcbd©a
->
h⁄‹_cd_fûíame
 = 
FALSE
;

125  
Áûuª
;

129  
cb
;

130 
	}
}

135 *
	$∑r£_fûíame
(c⁄° *
±r
, 
size_t
 
Àn
)

137 *
c›y
;

138 *
p
;

139 *
q
;

140 
°›
 = '\0';

143 
c›y
 = 
	`mÆloc
(
Àn
+1);

144 if(!
c›y
)

145  
NULL
;

146 
	`mem˝y
(
c›y
, 
±r
, 
Àn
);

147 
c›y
[
Àn
] = '\0';

149 
p
 = 
c›y
;

150 if(*
p
 == '\'' || *p == '"') {

152 
°›
 = *
p
;

153 
p
++;

156 
°›
 = ';';

159 
q
 = 
	`°ºchr
(
c›y
, '/');

160 if(
q
) {

161 
p
 = 
q
 + 1;

162 if(!*
p
) {

163 
	`Cuæ_ß„‰ì
(
c›y
);

164  
NULL
;

171 
q
 = 
	`°ºchr
(
p
, '\\');

172 if(
q
) {

173 
p
 = 
q
 + 1;

174 if(!*
p
) {

175 
	`Cuæ_ß„‰ì
(
c›y
);

176  
NULL
;

181 
q
 = 
p
;

182 *
q
) {

183 if(
q
[1] && (q[0] == '\\'))

184 
q
++;

185 if(
q
[0] =
°›
)

187 
q
++;

189 *
q
 = '\0';

192 
q
 = 
	`°rchr
(
p
, '\r');

193 if(
q
)

194 *
q
 = '\0';

196 
q
 = 
	`°rchr
(
p
, '\n');

197 if(
q
)

198 *
q
 = '\0';

200 if(
c›y
 !
p
)

201 
	`memmove
(
c›y
, 
p
, 
	`°æí
(p) + 1);

207 #ifde‡
DEBUGBUILD


209 *
tdú
 = 
	`cuæx_gëív
("CURL_TESTDIR");

210 if(
tdú
) {

211 
buf„r
[512];

212 
	`¢¥ötf
(
buf„r
, (buf„r), "%s/%s", 
tdú
, 
c›y
);

213 
	`Cuæ_ß„‰ì
(
c›y
);

214 
c›y
 = 
	`°rdup
(
buf„r
);

218 
	`cuæ_‰ì
(
tdú
);

223  
c›y
;

224 
	}
}

	@src/tool_cb_hdr.h

1 #i‚de‡
HEADER_CURL_TOOL_CB_HDR_H


2 
	#HEADER_CURL_TOOL_CB_HDR_H


	)

24 
	~"toﬁ_£tup.h
"

41 
	sHdrCbD©a
 {

42 
OutSåu˘
 *
	mouts
;

43 
OutSåu˘
 *
	mhóds
;

44 
boﬁ
 
	mh⁄‹_cd_fûíame
;

51 
size_t
 
toﬁ_hódî_cb
(*
±r
, size_à
size
, size_à
nmemb
, *
u£rd©a
);

	@src/tool_cb_prg.c

22 
	~"toﬁ_£tup.h
"

24 
	#ENABLE_CURLX_PRINTF


	)

26 
	~"cuæx.h
"

28 
	~"toﬁ_cfgabÀ.h
"

29 
	~"toﬁ_cb_¥g.h
"

30 
	~"toﬁ_utû.h
"

32 
	~"memdebug.h
"

38 
	#MAX_BARLENGTH
 256

	)

40 
	$toﬁ_¥ogªss_cb
(*
˛õ¡p
,

41 
cuæ_off_t
 
d…ŸÆ
, cuæ_off_à
d ow
,

42 
cuæ_off_t
 
u…ŸÆ
, cuæ_off_à
u ow
)

47 
löe
[
MAX_BARLENGTH
+1];

48 
f‹m©
[40];

49 
‰ac
;

50 
≥r˚¡
;

51 
b¨width
;

52 
num
;

53 
timevÆ
 
now
 = 
	`tvnow
();

54 
ProgªssD©a
 *
b¨
 = (ProgªssD©®*)
˛õ¡p
;

55 
cuæ_off_t
 
tŸÆ
;

56 
cuæ_off_t
 
poöt
;

59 
tŸÆ
 = 
d…ŸÆ
 + 
u…ŸÆ
 + 
b¨
->
öôül_size
;

62 
poöt
 = 
d ow
 + 
u ow
 + 
b¨
->
öôül_size
;

64 if(
b¨
->
ˇŒs
 && (
	`tvdiff
(
now
, b¨->
¥evtime
Ë< 100LË&& 
poöt
 < 
tŸÆ
)

69 if(
poöt
 > 
tŸÆ
)

71 
tŸÆ
 = 
poöt
;

74 
b¨
->
ˇŒs
++;

76 if(
tŸÆ
 < 1) {

77 
cuæ_off_t
 
¥evblock
 = 
b¨
->
¥ev
 / 1024;

78 
cuæ_off_t
 
thisblock
 = 
poöt
 / 1024;

79 
thisblock
 > 
¥evblock
) {

80 
	`Ârötf
(
b¨
->
out
, "#");

81 
¥evblock
++;

84 if(
poöt
 !
b¨
->
¥ev
) {

85 
‰ac
 = ()
poöt
 / ()
tŸÆ
;

86 
≥r˚¡
 = 
‰ac
 * 100.0f;

87 
b¨width
 = 
b¨
->
width
 - 7;

88 
num
 = (Ë((()
b¨width
Ë* 
‰ac
);

89 if(
num
 > 
MAX_BARLENGTH
)

90 
num
 = 
MAX_BARLENGTH
;

91 
	`mem£t
(
löe
, '#', 
num
);

92 
löe
[
num
] = '\0';

93 
	`¢¥ötf
(
f‹m©
, (f‹m©), "\r%%-%d†%%5.1f%%%%", 
b¨width
);

94 
	`Ârötf
(
b¨
->
out
, 
f‹m©
, 
löe
, 
≥r˚¡
);

96 
	`fÊush
(
b¨
->
out
);

97 
b¨
->
¥ev
 = 
poöt
;

98 
b¨
->
¥evtime
 = 
now
;

101 
	}
}

103 
	$¥ogªssb¨öô
(
ProgªssD©a
 *
b¨
,

104 
O≥øti⁄C⁄fig
 *
c⁄fig
)

106 #ifde‡
__EMX__


108 
s¸_size
[2];

110 *
cﬁp
;

112 
	`mem£t
(
b¨
, 0, (
ProgªssD©a
));

117 if(
c⁄fig
->
u£_ªsume
)

118 
b¨
->
öôül_size
 = 
c⁄fig
->
ªsume_‰om
;

122 #i‚de‡
__EMX__


126 
cﬁp
 = 
	`cuæx_gëív
("COLUMNS");

127 if(
cﬁp
) {

128 *
íd±r
;

129 
num
 = 
	`°πﬁ
(
cﬁp
, &
íd±r
, 10);

130 if((
íd±r
 !
cﬁp
Ë&& (íd±∏=cﬁ∞+ 
	`°æí
(cﬁp)Ë&& (
num
 > 0))

131 
b¨
->
width
 = ()
num
;

133 
b¨
->
width
 = 79;

134 
	`cuæ_‰ì
(
cﬁp
);

137 
b¨
->
width
 = 79;

145 
	`_s¸size
(
s¸_size
);

146 
b¨
->
width
 = 
s¸_size
[0] - 1;

149 
b¨
->
out
 = 
c⁄fig
->
globÆ
->
îr‹s
;

150 
	}
}

	@src/tool_cb_prg.h

1 #i‚de‡
HEADER_CURL_TOOL_CB_PRG_H


2 
	#HEADER_CURL_TOOL_CB_PRG_H


	)

24 
	~"toﬁ_£tup.h
"

26 
	#CURL_PROGRESS_STATS
 0

	)

27 
	#CURL_PROGRESS_BAR
 1

	)

29 
	sProgªssD©a
 {

30 
	mˇŒs
;

31 
cuæ_off_t
 
	m¥ev
;

32 
timevÆ
 
	m¥evtime
;

33 
	mwidth
;

34 
FILE
 *
	mout
;

35 
cuæ_off_t
 
	möôül_size
;

38 
¥ogªssb¨öô
(
ProgªssD©a
 *
b¨
,

39 
O≥øti⁄C⁄fig
 *
c⁄fig
);

45 
toﬁ_¥ogªss_cb
(*
˛õ¡p
,

46 
cuæ_off_t
 
d…ŸÆ
, cuæ_off_à
d ow
,

47 
cuæ_off_t
 
u…ŸÆ
, cuæ_off_à
u ow
);

	@src/tool_cb_rea.c

22 
	~"toﬁ_£tup.h
"

24 
	#ENABLE_CURLX_PRINTF


	)

26 
	~"cuæx.h
"

28 
	~"toﬁ_cfgabÀ.h
"

29 
	~"toﬁ_cb_ªa.h
"

31 
	~"memdebug.h
"

37 
size_t
 
	$toﬁ_ªad_cb
(*
buf„r
, 
size_t
 
sz
, size_à
nmemb
, *
u£rd©a
)

39 
ssize_t
 
rc
;

40 
InSåu˘
 *
ö
 = 
u£rd©a
;

42 
rc
 = 
	`ªad
(
ö
->
fd
, 
buf„r
, 
sz
*
nmemb
);

43 if(
rc
 < 0) {

44 if(
î∫o
 =
EAGAIN
) {

45 
î∫o
 = 0;

46 
ö
->
c⁄fig
->
ªadbusy
 = 
TRUE
;

47  
CURL_READFUNC_PAUSE
;

50 
rc
 = 0;

52 
ö
->
c⁄fig
->
ªadbusy
 = 
FALSE
;

53  (
size_t
)
rc
;

54 
	}
}

	@src/tool_cb_rea.h

1 #i‚de‡
HEADER_CURL_TOOL_CB_REA_H


2 
	#HEADER_CURL_TOOL_CB_REA_H


	)

24 
	~"toﬁ_£tup.h
"

30 
size_t
 
toﬁ_ªad_cb
(*
buf„r
, size_à
sz
, size_à
nmemb
, *
u£rd©a
);

	@src/tool_cb_see.c

22 
	~"toﬁ_£tup.h
"

24 
	#ENABLE_CURLX_PRINTF


	)

26 
	~"cuæx.h
"

28 
	~"toﬁ_cfgabÀ.h
"

29 
	~"toﬁ_cb_£e.h
"

31 
	~"memdebug.h
"

37 
	#OUR_MAX_SEEK_L
 2147483647L - 1L

	)

38 
	#OUR_MAX_SEEK_O
 
	`CURL_OFF_T_C
(0x7FFFFFFFË- CURL_OFF_T_C(0x1)

	)

47 
	$toﬁ_£ek_cb
(*
u£rd©a
, 
cuæ_off_t
 
off£t
, 
whí˚
)

49 
InSåu˘
 *
ö
 = 
u£rd©a
;

51 #if(
CURL_SIZEOF_CURL_OFF_T
 > 
SIZEOF_OFF_T
Ë&& !
	`deföed
(
USE_WIN32_LARGE_FILES
)

57 if(
off£t
 > 
OUR_MAX_SEEK_O
) {

61 
cuæ_off_t
 
À·
 = 
off£t
;

63 if(
whí˚
 !
SEEK_SET
)

65  
CURL_SEEKFUNC_FAIL
;

67 if(
LSEEK_ERROR
 =
	`l£ek
(
ö
->
fd
, 0, 
SEEK_SET
))

69  
CURL_SEEKFUNC_FAIL
;

71 
À·
) {

72 
°ï
 = (
À·
 > 
OUR_MAX_SEEK_O
Ë? 
OUR_MAX_SEEK_L
 : ()left;

73 if(
LSEEK_ERROR
 =
	`l£ek
(
ö
->
fd
, 
°ï
, 
SEEK_CUR
))

75  
CURL_SEEKFUNC_FAIL
;

76 
À·
 -
°ï
;

78  
CURL_SEEKFUNC_OK
;

82 if(
LSEEK_ERROR
 =
	`l£ek
(
ö
->
fd
, 
off£t
, 
whí˚
))

86  
CURL_SEEKFUNC_CANTSEEK
;

88  
CURL_SEEKFUNC_OK
;

89 
	}
}

91 #i‡
deföed
(
WIN32
Ë&& !deföed(
__MINGW64__
)

93 #ifde‡
__BORLANDC__


95 
	#_l£eki64
(
hnd
,
ofs
,
whí˚
Ë
	`l£ek
(hnd,ofs,whí˚)

	)

98 #ifde‡
__POCC__


99 #if(
__POCC__
 < 450)

101 
	#_l£eki64
(
hnd
,
ofs
,
whí˚
Ë
	`_l£ek
(hnd,ofs,whí˚)

	)

103 
	#_l£eki64
(
hnd
,
ofs
,
whí˚
Ë
	`_l£ek64
(hnd,ofs,whí˚)

	)

107 #ifde‡
_WIN32_WCE


109 #unde‡
_l£eki64


110 
	#_l£eki64
(
hnd
,
ofs
,
whí˚
Ë
	`l£ek
(hnd,ofs,whí˚)

	)

111 #unde‡
_gë_osfh™dÀ


112 
	#_gë_osfh™dÀ
(
fd
Ë(fd)

	)

119 
	$toﬁ_·runˇã64
(
fd
, 
cuæ_off_t
 
whîe
)

121 if(
	`_l£eki64
(
fd
, 
whîe
, 
SEEK_SET
) < 0)

124 if(!
	`SëEndOfFûe
((
HANDLE
)
	`_gë_osfh™dÀ
(
fd
)))

128 
	}
}

	@src/tool_cb_see.h

1 #i‚de‡
HEADER_CURL_TOOL_CB_SEE_H


2 
	#HEADER_CURL_TOOL_CB_SEE_H


	)

24 
	~"toﬁ_£tup.h
"

26 #i‡
deföed
(
WIN32
Ë&& !deföed(
__MINGW64__
)

28 
toﬁ_·runˇã64
(
fd
, 
cuæ_off_t
 
whîe
);

30 #unde‡
·runˇã


31 
	#·runˇã
(
fd
,
whîe
Ë
	`toﬁ_·runˇã64
(fd,whîe)

	)

33 #i‚de‡
HAVE_FTRUNCATE


34 
	#HAVE_FTRUNCATE
 1

	)

43 
toﬁ_£ek_cb
(*
u£rd©a
, 
cuæ_off_t
 
off£t
, 
whí˚
);

	@src/tool_cb_wrt.c

22 
	~"toﬁ_£tup.h
"

24 
	#ENABLE_CURLX_PRINTF


	)

26 
	~"cuæx.h
"

28 
	~"toﬁ_cfgabÀ.h
"

29 
	~"toﬁ_msgs.h
"

30 
	~"toﬁ_cb_wπ.h
"

32 
	~"memdebug.h
"

38 
size_t
 
	$toﬁ_wrôe_cb
(*
buf„r
, 
size_t
 
sz
, size_à
nmemb
, *
u£rd©a
)

40 
size_t
 
rc
;

41 
OutSåu˘
 *
outs
 = 
u£rd©a
;

42 
O≥øti⁄C⁄fig
 *
c⁄fig
 = 
outs
->config;

50 c⁄° 
size_t
 
Áûuª
 = (
sz
 * 
nmemb
) ? 0 : 1;

52 if(!
c⁄fig
)

53  
Áûuª
;

55 #ifde‡
DEBUGBUILD


56 if(
c⁄fig
->
ö˛ude_hódîs
) {

57 if(
sz
 * 
nmemb
 > (
size_t
)
CURL_MAX_HTTP_HEADER
) {

58 
	`w¨nf
(
c⁄fig
, "Header data sizeÉxceeds single call writeÜimit!\n");

59  
Áûuª
;

63 if(
sz
 * 
nmemb
 > (
size_t
)
CURL_MAX_WRITE_SIZE
) {

64 
	`w¨nf
(
c⁄fig
, "Data sizeÉxceeds single call writeÜimit!\n");

65  
Áûuª
;

71 
boﬁ
 
check_Áûs
 = 
FALSE
;

72 if(
outs
->
fûíame
) {

74 if(!*
outs
->
fûíame
)

75 
check_Áûs
 = 
TRUE
;

76 if(!
outs
->
s_i§eg
)

77 
check_Áûs
 = 
TRUE
;

78 if(
outs
->
f›íed
 && !outs->
°ªam
)

79 
check_Áûs
 = 
TRUE
;

80 if(!
outs
->
f›íed
 && outs->
°ªam
)

81 
check_Áûs
 = 
TRUE
;

82 if(!
outs
->
f›íed
 && outs->
byãs
)

83 
check_Áûs
 = 
TRUE
;

87 if(!
outs
->
°ªam
 || outs->
s_i§eg
 || outs->
f›íed
)

88 
check_Áûs
 = 
TRUE
;

89 if(
outs
->
Æloc_fûíame
 || outs->
is_cd_fûíame
 || outs->
öô
)

90 
check_Áûs
 = 
TRUE
;

92 if(
check_Áûs
) {

93 
	`w¨nf
(
c⁄fig
, "Invalid output struct data for write callback\n");

94  
Áûuª
;

99 if(!
outs
->
°ªam
) {

100 
FILE
 *
fûe
;

102 if(!
outs
->
fûíame
 || !*outs->filename) {

103 
	`w¨nf
(
c⁄fig
, "Remote filename hasÇoÜength!\n");

104  
Áûuª
;

107 if(
outs
->
is_cd_fûíame
) {

109 
fûe
 = 
	`f›í
(
outs
->
fûíame
, "rb");

110 if(
fûe
) {

111 
	`f˛o£
(
fûe
);

112 
	`w¨nf
(
c⁄fig
, "RefusögÅÿovîwrôê%s: %s\n", 
outs
->
fûíame
,

113 
	`°ªº‹
(
EEXIST
));

114  
Áûuª
;

119 
fûe
 = 
	`f›í
(
outs
->
fûíame
, "wb");

120 if(!
fûe
) {

121 
	`w¨nf
(
c⁄fig
, "FaûedÅÿ¸óãÅhêfûê%s: %s\n", 
outs
->
fûíame
,

122 
	`°ªº‹
(
î∫o
));

123  
Áûuª
;

125 
outs
->
s_i§eg
 = 
TRUE
;

126 
outs
->
f›íed
 = 
TRUE
;

127 
outs
->
°ªam
 = 
fûe
;

128 
outs
->
byãs
 = 0;

129 
outs
->
öô
 = 0;

132 
rc
 = 
	`fwrôe
(
buf„r
, 
sz
, 
nmemb
, 
outs
->
°ªam
);

134 if((
sz
 * 
nmemb
Ë=
rc
)

136 
outs
->
byãs
 +(
sz
 * 
nmemb
);

138 if(
c⁄fig
->
ªadbusy
) {

139 
c⁄fig
->
ªadbusy
 = 
FALSE
;

140 
	`cuæ_ósy_∑u£
(
c⁄fig
->
ósy
, 
CURLPAUSE_CONT
);

143 if(
c⁄fig
->
nobuf„r
) {

145 
ªs
 = 
	`fÊush
(
outs
->
°ªam
);

146 if(
ªs
)

147  
Áûuª
;

150  
rc
;

151 
	}
}

	@src/tool_cb_wrt.h

1 #i‚de‡
HEADER_CURL_TOOL_CB_WRT_H


2 
	#HEADER_CURL_TOOL_CB_WRT_H


	)

24 
	~"toﬁ_£tup.h
"

30 
size_t
 
toﬁ_wrôe_cb
(*
buf„r
, size_à
sz
, size_à
nmemb
, *
u£rd©a
);

	@src/tool_cfgable.c

22 
	~"toﬁ_£tup.h
"

24 
	~"toﬁ_cfgabÀ.h
"

25 
	~"toﬁ_maö.h
"

27 
	~"memdebug.h
"

29 
	$c⁄fig_öô
(
O≥øti⁄C⁄fig
* 
c⁄fig
)

31 
	`mem£t
(
c⁄fig
, 0, (
O≥øti⁄C⁄fig
));

33 
c⁄fig
->
po°fõldsize
 = -1;

34 
c⁄fig
->
u£_hâpgë
 = 
FALSE
;

35 
c⁄fig
->
¸óã_dús
 = 
FALSE
;

36 
c⁄fig
->
maxªdús
 = 
DEFAULT_MAXREDIRS
;

37 
c⁄fig
->
¥Ÿo
 = 
CURLPROTO_ALL
;

38 
c⁄fig
->
¥Ÿo_¥e£¡
 = 
FALSE
;

39 
c⁄fig
->
¥Ÿo_ªdú
 =

40 
CURLPROTO_ALL
 & ~(
CURLPROTO_FILE
|
CURLPROTO_SCP
);

41 
c⁄fig
->
¥Ÿo_ªdú_¥e£¡
 = 
FALSE
;

42 
	}
}

44 
	$‰ì_c⁄fig_fõlds
(
O≥øti⁄C⁄fig
 *
c⁄fig
)

46 
gëout
 *
uænode
;

48 
	`Cuæ_ß„‰ì
(
c⁄fig
->
øndom_fûe
);

49 
	`Cuæ_ß„‰ì
(
c⁄fig
->
egd_fûe
);

50 
	`Cuæ_ß„‰ì
(
c⁄fig
->
u£øgít
);

51 
	`Cuæ_ß„‰ì
(
c⁄fig
->
cookõ
);

52 
	`Cuæ_ß„‰ì
(
c⁄fig
->
cookõj¨
);

53 
	`Cuæ_ß„‰ì
(
c⁄fig
->
cookõfûe
);

55 
	`Cuæ_ß„‰ì
(
c⁄fig
->
po°fõlds
);

56 
	`Cuæ_ß„‰ì
(
c⁄fig
->
ª„ªr
);

58 
	`Cuæ_ß„‰ì
(
c⁄fig
->
hódîfûe
);

59 
	`Cuæ_ß„‰ì
(
c⁄fig
->
·µ‹t
);

60 
	`Cuæ_ß„‰ì
(
c⁄fig
->
iÁ˚
);

62 
	`Cuæ_ß„‰ì
(
c⁄fig
->
ønge
);

64 
	`Cuæ_ß„‰ì
(
c⁄fig
->
u£Ωwd
);

65 
	`Cuæ_ß„‰ì
(
c⁄fig
->
és_u£∫ame
);

66 
	`Cuæ_ß„‰ì
(
c⁄fig
->
és_∑ssw‹d
);

67 
	`Cuæ_ß„‰ì
(
c⁄fig
->
és_authty≥
);

68 
	`Cuæ_ß„‰ì
(
c⁄fig
->
¥oxyu£Ωwd
);

69 
	`Cuæ_ß„‰ì
(
c⁄fig
->
¥oxy
);

71 
	`Cuæ_ß„‰ì
(
c⁄fig
->
dns_ùv6_addr
);

72 
	`Cuæ_ß„‰ì
(
c⁄fig
->
dns_ùv4_addr
);

73 
	`Cuæ_ß„‰ì
(
c⁄fig
->
dns_öãrÁ˚
);

74 
	`Cuæ_ß„‰ì
(
c⁄fig
->
dns_£rvîs
);

76 
	`Cuæ_ß„‰ì
(
c⁄fig
->
n›roxy
);

78 
	`Cuæ_ß„‰ì
(
c⁄fig
->
maû_‰om
);

79 
	`cuæ_¶i°_‰ì_Æl
(
c⁄fig
->
maû_r˝t
);

80 
	`Cuæ_ß„‰ì
(
c⁄fig
->
maû_auth
);

82 
	`Cuæ_ß„‰ì
(
c⁄fig
->
√åc_fûe
);

84 
uænode
 = 
c⁄fig
->
uæ_li°
;

85 
uænode
) {

86 
gëout
 *
√xt
 = 
uænode
->next;

87 
	`Cuæ_ß„‰ì
(
uænode
->
uæ
);

88 
	`Cuæ_ß„‰ì
(
uænode
->
outfûe
);

89 
	`Cuæ_ß„‰ì
(
uænode
->
öfûe
);

90 
	`Cuæ_ß„‰ì
(
uænode
);

91 
uænode
 = 
√xt
;

93 
c⁄fig
->
uæ_li°
 = 
NULL
;

94 
c⁄fig
->
uæ_œ°
 = 
NULL
;

95 
c⁄fig
->
uæ_gë
 = 
NULL
;

96 
c⁄fig
->
uæ_out
 = 
NULL
;

98 
	`Cuæ_ß„‰ì
(
c⁄fig
->
cùhî_li°
);

99 
	`Cuæ_ß„‰ì
(
c⁄fig
->
˚π
);

100 
	`Cuæ_ß„‰ì
(
c⁄fig
->
˚π_ty≥
);

101 
	`Cuæ_ß„‰ì
(
c⁄fig
->
ˇ˚π
);

102 
	`Cuæ_ß„‰ì
(
c⁄fig
->
ˇ∑th
);

103 
	`Cuæ_ß„‰ì
(
c⁄fig
->
¸lfûe
);

104 
	`Cuæ_ß„‰ì
(
c⁄fig
->
key
);

105 
	`Cuæ_ß„‰ì
(
c⁄fig
->
key_ty≥
);

106 
	`Cuæ_ß„‰ì
(
c⁄fig
->
key_∑sswd
);

107 
	`Cuæ_ß„‰ì
(
c⁄fig
->
pubkey
);

108 
	`Cuæ_ß„‰ì
(
c⁄fig
->
ho°pubmd5
);

109 
	`Cuæ_ß„‰ì
(
c⁄fig
->
ígöe
);

111 
	`Cuæ_ß„‰ì
(
c⁄fig
->
cu°omªque°
);

112 
	`Cuæ_ß„‰ì
(
c⁄fig
->
krbÀvñ
);

114 
	`Cuæ_ß„‰ì
(
c⁄fig
->
xﬂuth2_bóªr
);

116 
	`Cuæ_ß„‰ì
(
c⁄fig
->
wrôeout
);

118 
	`cuæ_¶i°_‰ì_Æl
(
c⁄fig
->
quŸe
);

119 
	`cuæ_¶i°_‰ì_Æl
(
c⁄fig
->
po°quŸe
);

120 
	`cuæ_¶i°_‰ì_Æl
(
c⁄fig
->
¥equŸe
);

122 
	`cuæ_¶i°_‰ì_Æl
(
c⁄fig
->
hódîs
);

123 
	`cuæ_¶i°_‰ì_Æl
(
c⁄fig
->
¥oxyhódîs
);

125 if(
c⁄fig
->
hâµo°
) {

126 
	`cuæ_f‹m‰ì
(
c⁄fig
->
hâµo°
);

127 
c⁄fig
->
hâµo°
 = 
NULL
;

129 
c⁄fig
->
œ°_po°
 = 
NULL
;

131 
	`cuæ_¶i°_‰ì_Æl
(
c⁄fig
->
ã ë_›ti⁄s
);

132 
	`cuæ_¶i°_‰ì_Æl
(
c⁄fig
->
ªsﬁve
);

134 
	`Cuæ_ß„‰ì
(
c⁄fig
->
sock•roxy
);

135 
	`Cuæ_ß„‰ì
(
c⁄fig
->
socks5_gsßpi_£rvi˚
);

137 
	`Cuæ_ß„‰ì
(
c⁄fig
->
·p_accou¡
);

138 
	`Cuæ_ß„‰ì
(
c⁄fig
->
·p_Æã∫©ive_to_u£r
);

139 
	}
}

141 
	$c⁄fig_‰ì
(
O≥øti⁄C⁄fig
 *
c⁄fig
)

143 
O≥øti⁄C⁄fig
 *
œ°
 = 
c⁄fig
;

146 
œ°
) {

147 
O≥øti⁄C⁄fig
 *
¥ev
 = 
œ°
->prev;

149 
	`‰ì_c⁄fig_fõlds
(
œ°
);

150 
	`‰ì
(
œ°
);

152 
œ°
 = 
¥ev
;

154 
	}
}

	@src/tool_cfgable.h

1 #i‚de‡
HEADER_CURL_TOOL_CFGABLE_H


2 
	#HEADER_CURL_TOOL_CFGABLE_H


	)

24 
	~"toﬁ_£tup.h
"

26 
	~"toﬁ_sde˛s.h
"

28 
	~"toﬁ_mëÆök.h
"

30 
	gGlobÆC⁄fig
;

32 
	sO≥øti⁄C⁄fig
 {

33 
CURL
 *
	mósy
;

34 
boﬁ
 
	mªmŸe_time
;

35 *
	møndom_fûe
;

36 *
	megd_fûe
;

37 *
	mu£øgít
;

38 *
	mcookõ
;

39 *
	mcookõj¨
;

40 *
	mcookõfûe
;

41 
boﬁ
 
	mcookõ£ssi⁄
;

42 
boﬁ
 
	mícodög
;

43 
boﬁ
 
	må_ícodög
;

44 
	mauthty≥
;

45 
boﬁ
 
	mu£_ªsume
;

46 
boﬁ
 
	mªsume_‰om_cuºít
;

47 
boﬁ
 
	mdißbÀ_ïsv
;

48 
boﬁ
 
	mdißbÀ_ïπ
;

49 
boﬁ
 
	m·p_¥ë
;

50 
	m¥Ÿo
;

51 
boﬁ
 
	m¥Ÿo_¥e£¡
;

52 
	m¥Ÿo_ªdú
;

53 
boﬁ
 
	m¥Ÿo_ªdú_¥e£¡
;

54 
cuæ_off_t
 
	mªsume_‰om
;

55 *
	mpo°fõlds
;

56 
cuæ_off_t
 
	mpo°fõldsize
;

57 *
	mª„ªr
;

58 
	mtimeout
;

59 
	mc⁄√˘timeout
;

60 
	mmaxªdús
;

61 
cuæ_off_t
 
	mmax_fûesize
;

62 *
	mhódîfûe
;

63 *
	m·µ‹t
;

64 *
	miÁ˚
;

65 
	mloˇÕ‹t
;

66 
	mloˇÕ‹å™ge
;

67 
	mp‹âou£
;

68 *
	mønge
;

69 
	mlow_•ìd_limô
;

70 
	mlow_•ìd_time
;

71 *
	mdns_£rvîs
;

72 *
	mdns_öãrÁ˚
;

73 *
	mdns_ùv4_addr
;

74 *
	mdns_ùv6_addr
;

75 *
	mu£Ωwd
;

76 *
	mlogö_›ti⁄s
;

77 *
	més_u£∫ame
;

78 *
	més_∑ssw‹d
;

79 *
	més_authty≥
;

80 *
	m¥oxyu£Ωwd
;

81 *
	m¥oxy
;

82 
	m¥oxyvî
;

83 *
	mn›roxy
;

84 *
	mmaû_‰om
;

85 
cuæ_¶i°
 *
	mmaû_r˝t
;

86 *
	mmaû_auth
;

87 
boﬁ
 
	mß¶_ú
;

88 
boﬁ
 
	m¥oxytu¬ñ
;

89 
boﬁ
 
	m·p_≠≥nd
;

90 
boﬁ
 
	mu£_ascii
;

91 
boﬁ
 
	maut‹e„ªr
;

92 
boﬁ
 
	mÁû⁄îr‹
;

93 
boﬁ
 
	mö˛ude_hódîs
;

94 
boﬁ
 
	mno_body
;

95 
boﬁ
 
	mdúli°⁄ly
;

96 
boﬁ
 
	mfﬁlowloˇti⁄
;

97 
boﬁ
 
	muƒe°ri˘ed_auth
;

100 
boﬁ
 
	m√åc_›t
;

101 
boﬁ
 
	m√åc
;

102 *
	m√åc_fûe
;

103 
gëout
 *
	muæ_li°
;

104 
gëout
 *
	muæ_œ°
;

105 
gëout
 *
	muæ_gë
;

106 
gëout
 *
	muæ_out
;

107 *
	mcùhî_li°
;

108 *
	m˚π
;

109 *
	m˚π_ty≥
;

110 *
	mˇ˚π
;

111 *
	mˇ∑th
;

112 *
	m¸lfûe
;

113 *
	mkey
;

114 *
	mkey_ty≥
;

115 *
	mkey_∑sswd
;

116 *
	mpubkey
;

117 *
	mho°pubmd5
;

118 *
	mígöe
;

119 
boﬁ
 
	m¸lf
;

120 *
	mcu°omªque°
;

121 *
	mkrbÀvñ
;

122 
	mhâpvîsi⁄
;

123 
boﬁ
 
	mnobuf„r
;

124 
boﬁ
 
	mªadbusy
;

125 
boﬁ
 
	mgloboff
;

126 
boﬁ
 
	mu£_hâpgë
;

127 
boﬁ
 
	mö£cuª_ok
;

128 
boﬁ
 
	m¸óã_dús
;

129 
boﬁ
 
	m·p_¸óã_dús
;

130 
boﬁ
 
	m·p_skù_ù
;

131 
boﬁ
 
	m¥oxy√gŸüã
;

132 
boﬁ
 
	m¥oxy¡lm
;

133 
boﬁ
 
	m¥oxydige°
;

134 
boﬁ
 
	m¥oxybasic
;

135 
boﬁ
 
	m¥oxy™yauth
;

136 *
	mwrôeout
;

137 
boﬁ
 
	mwrôìnv
;

138 
cuæ_¶i°
 *
	mquŸe
;

139 
cuæ_¶i°
 *
	mpo°quŸe
;

140 
cuæ_¶i°
 *
	m¥equŸe
;

141 
	ms¶_vîsi⁄
;

142 
	mù_vîsi⁄
;

143 
cuæ_TimeC⁄d
 
	mtimec⁄d
;

144 
time_t
 
	mc⁄dtime
;

145 
cuæ_¶i°
 *
	mhódîs
;

146 
cuæ_¶i°
 *
	m¥oxyhódîs
;

147 
cuæ_hâµo°
 *
	mhâµo°
;

148 
cuæ_hâµo°
 *
	mœ°_po°
;

149 
cuæ_¶i°
 *
	mã ë_›ti⁄s
;

150 
cuæ_¶i°
 *
	mªsﬁve
;

151 
HâpReq
 
	mhâ¥eq
;

154 
cuæ_off_t
 
	m£nd≥r£c⁄d
;

155 
cuæ_off_t
 
	mªcv≥r£c⁄d
;

157 
boﬁ
 
	m·p_s¶
;

158 
boﬁ
 
	m·p_s¶_ªqd
;

159 
boﬁ
 
	m·p_s¶_c⁄åﬁ
;

160 
boﬁ
 
	m·p_s¶_ccc
;

161 
	m·p_s¶_ccc_mode
;

163 *
	msock•roxy
;

164 
	msocksvî
;

165 *
	msocks5_gsßpi_£rvi˚
;

167 
	msocks5_gsßpi_√c
 ;

170 
boﬁ
 
	mt˝_nodñay
;

171 
	mªq_ªåy
;

172 
	mªåy_dñay
;

173 
	mªåy_maxtime
;

175 *
	m·p_accou¡
;

176 *
	m·p_Æã∫©ive_to_u£r
;

177 
	m·p_fûemëhod
;

178 
	mt·p_blksize
;

179 
boﬁ
 
	mign‹e˛
;

180 
boﬁ
 
	mdißbÀ_£ssi⁄id
;

182 
boﬁ
 
	møw
;

183 
boﬁ
 
	mpo°301
;

184 
boﬁ
 
	mpo°302
;

185 
boﬁ
 
	mpo°303
;

186 
boﬁ
 
	mnokì∑live
;

187 
	mÆivëime
;

188 
boﬁ
 
	mc⁄ã¡_di•osôi⁄
;

190 
	mdeÁu…_node_Êags
;

193 
boﬁ
 
	mx©å
;

194 
	mgsßpi_dñeg©i⁄
;

195 
boﬁ
 
	ms¶_Ælow_bó°
;

197 
boﬁ
 
	mu£_mëÆök
;

198 
mëÆökfûe
 *
	mmëÆökfûe_li°
;

199 
mëÆökfûe
 *
	mmëÆökfûe_œ°
;

200 #ifde‡
CURLDEBUG


201 
boﬁ
 
	mã°_evít_ba£d
;

203 *
	mxﬂuth2_bóªr
;

204 
boﬁ
 
	mn⁄≤
;

205 
boﬁ
 
	mnﬂÕn
;

207 
GlobÆC⁄fig
 *
	mglobÆ
;

208 
O≥øti⁄C⁄fig
 *
	m¥ev
;

209 
O≥øti⁄C⁄fig
 *
	m√xt
;

212 
	sGlobÆC⁄fig
 {

213 
CURL
 *
	mósy
;

214 
	mshowîr‹
;

217 
boﬁ
 
	mmuã
;

218 
boﬁ
 
	mn›rogªss
;

219 
boﬁ
 
	mißây
;

220 
FILE
 *
	mîr‹s
;

221 
boﬁ
 
	mîr‹s_f›íed
;

222 *
	måa˚_dump
;

223 
FILE
 *
	måa˚_°ªam
;

224 
boﬁ
 
	måa˚_f›íed
;

225 
åa˚
 
	måa˚ty≥
;

226 
boﬁ
 
	måa˚time
;

227 
	m¥ogªssmode
;

228 *
	mlibcuæ
;

230 
O≥øti⁄C⁄fig
 *
	mfú°
;

231 
O≥øti⁄C⁄fig
 *
	mcuºít
;

232 
O≥øti⁄C⁄fig
 *
	mœ°
;

235 
c⁄fig_öô
(
O≥øti⁄C⁄fig
 *
c⁄fig
);

236 
c⁄fig_‰ì
(
O≥øti⁄C⁄fig
 *
c⁄fig
);

	@src/tool_convert.c

22 
	~"toﬁ_£tup.h
"

24 #ifde‡
CURL_DOES_CONVERSIONS


26 #ifde‡
HAVE_ICONV


27 
	~<ic⁄v.h
>

30 
	~"toﬁ_c⁄vît.h
"

32 
	~"memdebug.h
"

34 #ifde‡
HAVE_ICONV


37 
ic⁄v_t
 
	göbound_cd
 = (iconv_t)-1;

38 
ic⁄v_t
 
	goutbound_cd
 = (iconv_t)-1;

41 #i‚de‡
CURL_ICONV_CODESET_OF_NETWORK


42 
	#CURL_ICONV_CODESET_OF_NETWORK
 "ISO8859-1"

	)

49 
CURLcode
 
	$c⁄vît_to_√tw‹k
(*
buf„r
, 
size_t
 
Àngth
)

52 *
öput_±r
, *
ouçut_±r
;

53 
size_t
 
ªs
, 
ö_byãs
, 
out_byãs
;

56 if(
outbound_cd
 =(
ic⁄v_t
)-1) {

57 
outbound_cd
 = 
	`ic⁄v_›í
(
CURL_ICONV_CODESET_OF_NETWORK
,

58 
CURL_ICONV_CODESET_OF_HOST
);

59 if(
outbound_cd
 =(
ic⁄v_t
)-1) {

60  
CURLE_CONV_FAILED
;

64 
öput_±r
 = 
ouçut_±r
 = 
buf„r
;

65 
ö_byãs
 = 
out_byãs
 = 
Àngth
;

66 
ªs
 = 
	`ic⁄v
(
outbound_cd
, &
öput_±r
, &
ö_byãs
,

67 &
ouçut_±r
, &
out_byãs
);

68 if((
ªs
 =(
size_t
)-1Ë|| (
ö_byãs
 != 0)) {

69  
CURLE_CONV_FAILED
;

72  
CURLE_OK
;

73 
	}
}

79 
CURLcode
 
	$c⁄vît_‰om_√tw‹k
(*
buf„r
, 
size_t
 
Àngth
)

82 *
öput_±r
, *
ouçut_±r
;

83 
size_t
 
ªs
, 
ö_byãs
, 
out_byãs
;

86 if(
öbound_cd
 =(
ic⁄v_t
)-1) {

87 
öbound_cd
 = 
	`ic⁄v_›í
(
CURL_ICONV_CODESET_OF_HOST
,

88 
CURL_ICONV_CODESET_OF_NETWORK
);

89 if(
öbound_cd
 =(
ic⁄v_t
)-1) {

90  
CURLE_CONV_FAILED
;

94 
öput_±r
 = 
ouçut_±r
 = 
buf„r
;

95 
ö_byãs
 = 
out_byãs
 = 
Àngth
;

96 
ªs
 = 
	`ic⁄v
(
öbound_cd
, &
öput_±r
, &
ö_byãs
,

97 &
ouçut_±r
, &
out_byãs
);

98 if((
ªs
 =(
size_t
)-1Ë|| (
ö_byãs
 != 0)) {

99  
CURLE_CONV_FAILED
;

102  
CURLE_OK
;

103 
	}
}

105 
	$c⁄vît_˛ónup
()

108 if(
öbound_cd
 !(
ic⁄v_t
)-1)

109 ()
	`ic⁄v_˛o£
(
öbound_cd
);

110 if(
outbound_cd
 !(
ic⁄v_t
)-1)

111 ()
	`ic⁄v_˛o£
(
outbound_cd
);

112 
	}
}

116 
	$c⁄vît_ch¨
(
cuæ_öfŸy≥
 
öfŸy≥
, 
this_ch¨
)

119 
öfŸy≥
) {

120 
CURLINFO_DATA_IN
:

121 
CURLINFO_DATA_OUT
:

122 
CURLINFO_SSL_DATA_IN
:

123 
CURLINFO_SSL_DATA_OUT
:

125 if((
this_ch¨
 >= 0x20) && (this_char < 0x7f)) {

127 ()
	`c⁄vît_‰om_√tw‹k
(&
this_ch¨
, 1);

131  
UNPRINTABLE_CHAR
;

136 if(
	`ISPRINT
(
this_ch¨
)

137 && (
this_ch¨
 != '\t')

138 && (
this_ch¨
 != '\r')

139 && (
this_ch¨
 != '\n')) {

141  
this_ch¨
;

146  
UNPRINTABLE_CHAR
;

147 
	}
}

	@src/tool_convert.h

1 #i‚de‡
HEADER_CURL_TOOL_CONVERT_H


2 
	#HEADER_CURL_TOOL_CONVERT_H


	)

24 
	~"toﬁ_£tup.h
"

26 #ifde‡
CURL_DOES_CONVERSIONS


28 #ifde‡
HAVE_ICONV


30 
CURLcode
 
c⁄vît_to_√tw‹k
(*
buf„r
, 
size_t
 
Àngth
);

31 
CURLcode
 
c⁄vît_‰om_√tw‹k
(*
buf„r
, 
size_t
 
Àngth
);

32 
c⁄vît_˛ónup
();

36 
c⁄vît_ch¨
(
cuæ_öfŸy≥
 
öfŸy≥
, 
this_ch¨
);

40 #i‡!
deföed
(
CURL_DOES_CONVERSIONS
Ë|| !deföed(
HAVE_ICONV
)

41 
	#c⁄vît_˛ónup
(Ë
Cuæ_n›_°mt


	)

	@src/tool_dirhie.c

22 
	~"toﬁ_£tup.h
"

24 
	~<sys/°©.h
>

26 #ifde‡
WIN32


27 
	~<dúe˘.h
>

30 
	#ENABLE_CURLX_PRINTF


	)

32 
	~"cuæx.h
"

34 
	~"toﬁ_dúhõ.h
"

36 
	~"memdebug.h
"

38 #ifde‡
NETWARE


39 #i‚de‡
__NOVELL_LIBC__


40 
	#mkdú
 
mkdú_510


	)

44 #ifde‡
WIN32


45 
	#mkdú
(
x
,
y
Ë(
mkdú
)((x))

	)

46 #i‚de‡
__POCC__


47 
	#F_OK
 0

	)

51 
	$show_dú_î∫o
(
FILE
 *
îr‹s
, c⁄° *
«me
)

53 
ERRNO
) {

54 #ifde‡
EACCES


55 
EACCES
:

56 
	`Ârötf
(
îr‹s
, "You d⁄'àhavê≥rmissi⁄Åÿ¸óã %s.\n", 
«me
);

59 #ifde‡
ENAMETOOLONG


60 
ENAMETOOLONG
:

61 
	`Ârötf
(
îr‹s
, "Thêdúe˘‹yÇamê%†i†toÿl⁄g.\n", 
«me
);

64 #ifde‡
EROFS


65 
EROFS
:

66 
	`Ârötf
(
îr‹s
, "%†ªside†⁄áÑód-⁄ly fûêsy°em.\n", 
«me
);

69 #ifde‡
ENOSPC


70 
ENOSPC
:

71 
	`Ârötf
(
îr‹s
, "No spaceÜeft onÅhe file systemÅhat will "

72 "c⁄èöÅhêdúe˘‹y %s.\n", 
«me
);

75 #ifde‡
EDQUOT


76 
EDQUOT
:

77 
	`Ârötf
(
îr‹s
, "Cannot create directory %s because you "

78 "ex˚eded you∏quŸa.\n", 
«me
);

82 
	`Ârötf
(
îr‹s
, "Eº‹ cª©ög dúe˘‹y %s.\n", 
«me
);

85 
	}
}

94 
CURLcode
 
	$¸óã_dú_hõørchy
(c⁄° *
outfûe
, 
FILE
 *
îr‹s
)

96 *
ãmpdú
;

97 *
ãmpdú2
;

98 *
outdup
;

99 *
dúbuûdup
;

100 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

101 
size_t
 
ouéí
;

103 
ouéí
 = 
	`°æí
(
outfûe
);

104 
outdup
 = 
	`°rdup
(
outfûe
);

105 if(!
outdup
)

106  
CURLE_OUT_OF_MEMORY
;

108 
dúbuûdup
 = 
	`mÆloc
(
ouéí
 + 1);

109 if(!
dúbuûdup
) {

110 
	`Cuæ_ß„‰ì
(
outdup
);

111  
CURLE_OUT_OF_MEMORY
;

113 
dúbuûdup
[0] = '\0';

115 
ãmpdú
 = 
	`°πok
(
outdup
, 
DIR_CHAR
);

117 
ãmpdú
 !
NULL
) {

118 
ãmpdú2
 = 
	`°πok
(
NULL
, 
DIR_CHAR
);

121 if(
ãmpdú2
 !
NULL
) {

122 
size_t
 
dÀn
 = 
	`°æí
(
dúbuûdup
);

123 if(
dÀn
)

124 
	`¢¥ötf
(&
dúbuûdup
[
dÀn
], 
ouéí
 - dÀn, "%s%s", 
DIR_CHAR
, 
ãmpdú
);

126 if(0 !
	`°∫cmp
(
outdup
, 
DIR_CHAR
, 1))

127 
	`°r˝y
(
dúbuûdup
, 
ãmpdú
);

129 
	`¢¥ötf
(
dúbuûdup
, 
ouéí
, "%s%s", 
DIR_CHAR
, 
ãmpdú
);

131 if(
	`ac˚ss
(
dúbuûdup
, 
F_OK
) == -1) {

132 if(-1 =
	`mkdú
(
dúbuûdup
,(
mode_t
)0000750)) {

133 
	`show_dú_î∫o
(
îr‹s
, 
dúbuûdup
);

134 
ªsu…
 = 
CURLE_WRITE_ERROR
;

139 
ãmpdú
 = 
ãmpdú2
;

142 
	`Cuæ_ß„‰ì
(
dúbuûdup
);

143 
	`Cuæ_ß„‰ì
(
outdup
);

145  
ªsu…
;

146 
	}
}

	@src/tool_dirhie.h

1 #i‚de‡
HEADER_CURL_TOOL_DIRHIE_H


2 
	#HEADER_CURL_TOOL_DIRHIE_H


	)

24 
	~"toﬁ_£tup.h
"

26 
CURLcode
 
¸óã_dú_hõørchy
(c⁄° *
outfûe
, 
FILE
 *
îr‹s
);

	@src/tool_doswin.c

22 
	~"toﬁ_£tup.h
"

24 #i‡
deföed
(
MSDOS
Ë|| deföed(
WIN32
)

26 #i‡
deföed
(
HAVE_LIBGEN_H
Ë&& deföed(
HAVE_BASENAME
)

27 
	~<libgí.h
>

30 #ifde‡
WIN32


31 
	~"toﬁ_cfgabÀ.h
"

32 
	~"toﬁ_liböfo.h
"

35 
	~"toﬁ_b«me.h
"

36 
	~"toﬁ_doswö.h
"

38 
	~"memdebug.h
"

44 
	#ALWAYS_TRUE
 (1)

	)

45 
	#ALWAYS_FALSE
 (0)

	)

47 #i‡
deföed
(
_MSC_VER
Ë&& !deföed(
__POCC__
)

48 #unde‡
ALWAYS_TRUE


49 #unde‡
ALWAYS_FALSE


50 #i‡(
_MSC_VER
 < 1500)

51 
	#ALWAYS_TRUE
 (0, 1)

	)

52 
	#ALWAYS_FALSE
 (1, 0)

	)

54 
	#ALWAYS_TRUE
 \

55 
	`__¥agma
(
	`w¨nög
(
push
)) \

56 
	`__¥agma
(
	`w¨nög
(
dißbÀ
:4127)) \

58 
	`__¥agma
(
	`w¨nög
(
p›
))

	)

59 
	#ALWAYS_FALSE
 \

60 
	`__¥agma
(
	`w¨nög
(
push
)) \

61 
	`__¥agma
(
	`w¨nög
(
dißbÀ
:4127)) \

63 
	`__¥agma
(
	`w¨nög
(
p›
))

	)

67 #ifde‡
WIN32


68 #unde‡
PATH_MAX


69 
	#PATH_MAX
 
MAX_PATH


	)

72 #i‚de‡
S_ISCHR


73 #ifde‡
S_IFCHR


74 
	#S_ISCHR
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFCHR
)

	)

76 
	#S_ISCHR
(
m
Ë(0Ë

	)

80 #ifde‡
WIN32


81 
	#_u£_l‚
(
f
Ë
ALWAYS_TRUE


	)

82 #ñi‡!
deföed
(
__DJGPP__
) || (__DJGPP__ < 2)

83 
	#_u£_l‚
(
f
Ë
ALWAYS_FALSE


	)

84 #ñi‡
deföed
(
__DJGPP__
)

85 
	~<f˙é.h
>

88 c⁄° *
msdosify
 (c⁄° *
fûe_«me
);

89 *
ª«me_if_dos_devi˚_«me
 (*
fûe_«me
);

101 *
	$ßnôize_dos_«me
(*
fûe_«me
)

103 
√w_«me
[
PATH_MAX
];

105 if(!
fûe_«me
)

106  
NULL
;

108 if(
	`°æí
(
fûe_«me
Ë>
PATH_MAX
)

109 
fûe_«me
[
PATH_MAX
-1] = '\0';

111 
	`°r˝y
(
√w_«me
, 
	`msdosify
(
fûe_«me
));

113 
	`Cuæ_ß„‰ì
(
fûe_«me
);

115  
	`°rdup
(
	`ª«me_if_dos_devi˚_«me
(
√w_«me
));

116 
	}
}

121 c⁄° *
	$msdosify
 (c⁄° *
fûe_«me
)

123 
dos_«me
[
PATH_MAX
];

124 c⁄° 
ûÀgÆ_ch¨s_dos
[] = ".+, ;=[]"

126 c⁄° *
ûÀgÆ_ch¨s_w95
 = &
ûÀgÆ_ch¨s_dos
[8];

127 
idx
, 
dŸ_idx
;

128 c⁄° *
s
 = 
fûe_«me
;

129 *
d
 = 
dos_«me
;

130 c⁄° *c⁄° 
dlimô
 = 
dos_«me
 + (dos_name) - 1;

131 c⁄° *
ûÀgÆ_Æõns
 = 
ûÀgÆ_ch¨s_dos
;

132 
size_t
 
Àn
 = (
ûÀgÆ_ch¨s_dos
) - 1;

135 if(
	`_u£_l‚
(
fûe_«me
)) {

136 
ûÀgÆ_Æõns
 = 
ûÀgÆ_ch¨s_w95
;

137 
Àn
 -(
ûÀgÆ_ch¨s_w95
 - 
ûÀgÆ_ch¨s_dos
);

141 if(
s
[0] >= 'A' && s[0] <= 'z' && s[1] == ':') {

142 *
d
++ = *
s
++;

143 *
d
++ = *
s
++;

146 
idx
 = 0, 
dŸ_idx
 = -1; *
s
 && 
d
 < 
dlimô
; s++, d++) {

147 if(
	`memchr
(
ûÀgÆ_Æõns
, *
s
, 
Àn
)) {

153 if(*
s
 == '.') {

154 if(
idx
 =0 && (
s
[1] == '/' || (s[1] == '.' && s[2] == '/'))) {

156 *
d
++ = *
s
++;

157 if(*
s
 == '.')

158 *
d
++ = *
s
++;

159 *
d
 = *
s
;

161 if(
idx
 == 0)

162 *
d
 = '_';

163 if(
dŸ_idx
 >= 0) {

164 if(
dŸ_idx
 < 5) {

165 
d
[
dŸ_idx
 - 
idx
] = '_';

166 *
d
 = '.';

169 *
d
 = '-';

172 *
d
 = '.';

174 if(*
s
 == '.')

175 
dŸ_idx
 = 
idx
;

177 if(*
s
 == '+' && s[1] == '+') {

178 if(
idx
 - 2 =
dŸ_idx
) {

179 *
d
++ = 'x';

180 *
d
 = 'x';

184 
	`mem˝y
 (
d
, "plus", 4);

185 
d
 += 3;

187 
s
++;

188 
idx
++;

191 *
d
 = '_';

194 *
d
 = *
s
;

195 if(*
s
 == '/') {

196 
idx
 = 0;

197 
dŸ_idx
 = -1;

200 
idx
++;

203 *
d
 = '\0';

204  
dos_«me
;

205 
	}
}

207 *
	$ª«me_if_dos_devi˚_«me
 (*
fûe_«me
)

212 *
ba£
;

213 
°ru˘_°©
 
°_buf
;

214 
‚ame
[
PATH_MAX
];

216 
	`°∫˝y
(
‚ame
, 
fûe_«me
, 
PATH_MAX
-1);

217 
‚ame
[
PATH_MAX
-1] = '\0';

218 
ba£
 = 
	`ba£«me
(
‚ame
);

219 if(((
	`°©
(
ba£
, &
°_buf
)Ë=0Ë&& (
	`S_ISCHR
(°_buf.
°_mode
))) {

220 
size_t
 
bÀn
 = 
	`°æí
(
ba£
);

222 if(
	`°æí
(
‚ame
Ë>
PATH_MAX
-1) {

224 
bÀn
--;

225 
ba£
[
bÀn
] = '\0';

228 
	`memmove
(
ba£
 + 1, ba£, 
bÀn
 + 1);

229 
ba£
[0] = '_';

230 
	`°r˝y
(
fûe_«me
, 
‚ame
);

232  
fûe_«me
;

233 
	}
}

235 #i‡
deföed
(
MSDOS
Ë&& (deföed(
__DJGPP__
Ë|| deföed(
__GO32__
))

240 **
	$__¸t0_glob_fun˘i⁄
(*
¨g
)

242 ()
¨g
;

244 
	}
}

248 #ifde‡
WIN32


265 
CURLcode
 
	$FödWö32CACît
(
O≥øti⁄C⁄fig
 *
c⁄fig
,

266 c⁄° *
bundÀ_fûe
)

268 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

271 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_SSL
) {

273 
DWORD
 
ªs_Àn
;

274 
DWORD
 
buf_tch¨_size
 = 
PATH_MAX
 + 1;

275 
DWORD
 
buf_byãs_size
 = (
TCHAR
Ë* 
buf_tch¨_size
;

276 *
±r
 = 
NULL
;

278 *
buf
 = 
	`mÆloc
(
buf_byãs_size
);

279 if(!
buf
)

280  
CURLE_OUT_OF_MEMORY
;

281 
buf
[0] = '\0';

283 
ªs_Àn
 = 
	`SórchP©hA
(
NULL
, 
bundÀ_fûe
, NULL, 
buf_tch¨_size
, 
buf
, &
±r
);

284 if(
ªs_Àn
 > 0) {

285 
	`Cuæ_ß„‰ì
(
c⁄fig
->
ˇ˚π
);

286 
c⁄fig
->
ˇ˚π
 = 
	`°rdup
(
buf
);

287 if(!
c⁄fig
->
ˇ˚π
)

288 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

291 
	`Cuæ_ß„‰ì
(
buf
);

294  
ªsu…
;

295 
	}
}

	@src/tool_doswin.h

1 #i‚de‡
HEADER_CURL_TOOL_DOSWIN_H


2 
	#HEADER_CURL_TOOL_DOSWIN_H


	)

24 
	~"toﬁ_£tup.h
"

26 #i‡
deföed
(
MSDOS
Ë|| deföed(
WIN32
)

28 *
ßnôize_dos_«me
(*
fûe_«me
);

30 #i‡
deföed
(
MSDOS
Ë&& (deföed(
__DJGPP__
Ë|| deföed(
__GO32__
))

32 **
__¸t0_glob_fun˘i⁄
(*
¨g
);

36 #ifde‡
WIN32


38 
CURLcode
 
FödWö32CACît
(
O≥øti⁄C⁄fig
 *
c⁄fig
,

39 c⁄° *
bundÀ_fûe
);

	@src/tool_easysrc.c

22 
	~"toﬁ_£tup.h
"

24 #i‚de‡
CURL_DISABLE_LIBCURL_OPTION


26 
	#ENABLE_CURLX_PRINTF


	)

28 
	~"cuæx.h
"

30 
	~"toﬁ_cfgabÀ.h
"

31 
	~"toﬁ_ósy§c.h
"

32 
	~"toﬁ_msgs.h
"

34 
	~"memdebug.h
"

38 
cuæ_¶i°
 *
	gósy§c_de˛
 = 
NULL
;

39 
cuæ_¶i°
 *
	gósy§c_d©a
 = 
NULL
;

40 
cuæ_¶i°
 *
	gósy§c_code
 = 
NULL
;

41 
cuæ_¶i°
 *
	gósy§c_tooh¨d
 = 
NULL
;

42 
cuæ_¶i°
 *
	gósy§c_˛ón
 = 
NULL
;

43 
	gósy§c_f‹m_cou¡
 = 0;

44 
	gósy§c_¶i°_cou¡
 = 0;

46 c⁄° *c⁄° 
	g§chód
[]={

57 
NULL


62 c⁄° *c⁄° 
	g§ch¨d
[]={

67 
NULL


69 c⁄° *c⁄° 
	g§˚nd
[]={

74 
NULL


78 
	$ósy§c_‰ì
()

80 
	`cuæ_¶i°_‰ì_Æl
(
ósy§c_de˛
);

81 
ósy§c_de˛
 = 
NULL
;

82 
	`cuæ_¶i°_‰ì_Æl
(
ósy§c_d©a
);

83 
ósy§c_d©a
 = 
NULL
;

84 
	`cuæ_¶i°_‰ì_Æl
(
ósy§c_code
);

85 
ósy§c_code
 = 
NULL
;

86 
	`cuæ_¶i°_‰ì_Æl
(
ósy§c_tooh¨d
);

87 
ósy§c_tooh¨d
 = 
NULL
;

88 
	`cuæ_¶i°_‰ì_Æl
(
ósy§c_˛ón
);

89 
ósy§c_˛ón
 = 
NULL
;

90 
	}
}

93 
CURLcode
 
	$ósy§c_add
(
cuæ_¶i°
 **
∂i°
, c⁄° *
löe
)

95 
CURLcode
 
ªt
 = 
CURLE_OK
;

96 
cuæ_¶i°
 *
li°
 =

97 
	`cuæ_¶i°_≠≥nd
(*
∂i°
, 
löe
);

98 if(!
li°
) {

99 
	`ósy§c_‰ì
();

100 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

103 *
∂i°
 = 
li°
;

104  
ªt
;

105 
	}
}

107 
CURLcode
 
	$ósy§c_addf
(
cuæ_¶i°
 **
∂i°
, c⁄° *
fmt
, ...)

109 
CURLcode
 
ªt
;

110 *
buÂ
;

111 
va_li°
 
≠
;

112 
	`va_°¨t
(
≠
, 
fmt
);

113 
buÂ
 = 
	`cuæx_mv≠rötf
(
fmt
, 
≠
);

114 
	`va_íd
(
≠
);

115 if(! 
buÂ
) {

116 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

119 
ªt
 = 
	`ósy§c_add
(
∂i°
, 
buÂ
);

120 
	`cuæ_‰ì
(
buÂ
);

122  
ªt
;

123 
	}
}

125 
	#CHKRET
(
v
Ëdÿ{
CURLcode
 
ªt
 = (v); if‘ëËÑë;} 
WHILE_FALSE


	)

127 
CURLcode
 
	$ósy§c_öô
()

129 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
,

131  
CURLE_OK
;

132 
	}
}

134 
CURLcode
 
	$ósy§c_≥rf‹m
()

137 if(
ósy§c_tooh¨d
) {

138 
i
;

139 
cuæ_¶i°
 *
±r
;

140 c⁄° *
c
;

141 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
, ""));

143 
i
=0; ((
c
 = 
§ch¨d
[i]Ë!
NULL
); i++)

144 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
, 
c
));

146 
±r
=
ósy§c_tooh¨d
;Öå;Öå =Öå->
√xt
)

147 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
, 
±r
->
d©a
));

148 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
, ""));

149 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
, "*/"));

151 
	`cuæ_¶i°_‰ì_Æl
(
ósy§c_tooh¨d
);

152 
ósy§c_tooh¨d
 = 
NULL
;

155 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
, ""));

156 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
, "ret = curl_easy_perform(hnd);"));

157 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
, ""));

159  
CURLE_OK
;

160 
	}
}

162 
CURLcode
 
	$ósy§c_˛ónup
()

164 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
, "curl_easy_cleanup(hnd);"));

165 
	`CHKRET
(
	`ósy§c_add
(&
ósy§c_code
, "hnd = NULL;"));

167  
CURLE_OK
;

168 
	}
}

170 
	$dum≥asy§c
(
GlobÆC⁄fig
 *
c⁄fig
)

172 
cuæ_¶i°
 *
±r
;

173 *
o
 = 
c⁄fig
->
libcuæ
;

175 if(
o
) {

176 
FILE
 *
out
;

177 
boﬁ
 
f›íed
 = 
FALSE
;

178 if(
	`°rcmp
(
o
, "-")) {

179 
out
 = 
	`f›í
(
o
, "w");

180 
f›íed
 = 
TRUE
;

183 
out
 = 
°dout
;

184 if(!
out
)

185 
	`w¨nf
(
c⁄fig
->
cuºít
, "FaûedÅÿ›í %†tÿwrôêlibcuæ code!\n", 
o
);

187 
i
;

188 c⁄° *
c
;

190 
i
=0; ((
c
 = 
§chód
[i]Ë!
NULL
); i++)

191 
	`Ârötf
(
out
, "%s\n", 
c
);

194 
±r
=
ósy§c_de˛
;Öå;Öå =Öå->
√xt
)

195 
	`Ârötf
(
out
, " %s\n", 
±r
->
d©a
);

198 if(
ósy§c_d©a
) {

199 
	`Ârötf
(
out
, "\n");

201 
±r
=
ósy§c_d©a
;Öå;Öå =Öå->
√xt
)

202 
	`Ârötf
(
out
, " %s\n", 
±r
->
d©a
);

205 
	`Ârötf
(
out
, "\n");

206 
±r
=
ósy§c_code
;Öå;Öå =Öå->
√xt
) {

207 if(
±r
->
d©a
[0]) {

208 
	`Ârötf
(
out
, " %s\n", 
±r
->
d©a
);

211 
	`Ârötf
(
out
, "\n");

215 
±r
=
ósy§c_˛ón
;Öå;Öå =Öå->
√xt
)

216 
	`Ârötf
(
out
, " %s\n", 
±r
->
d©a
);

218 
i
=0; ((
c
 = 
§˚nd
[i]Ë!
NULL
); i++)

219 
	`Ârötf
(
out
, "%s\n", 
c
);

221 if(
f›íed
)

222 
	`f˛o£
(
out
);

226 
	`ósy§c_‰ì
();

227 
	}
}

	@src/tool_easysrc.h

1 #i‚de‡
HEADER_CURL_TOOL_EASYSRC_H


2 
	#HEADER_CURL_TOOL_EASYSRC_H


	)

24 
	~"toﬁ_£tup.h
"

25 #i‚de‡
CURL_DISABLE_LIBCURL_OPTION


29 
cuæ_¶i°
 *
ósy§c_de˛
;

30 
cuæ_¶i°
 *
ósy§c_d©a
;

31 
cuæ_¶i°
 *
ósy§c_code
;

32 
cuæ_¶i°
 *
ósy§c_tooh¨d
;

33 
cuæ_¶i°
 *
ósy§c_˛ón
;

35 
ósy§c_f‹m_cou¡
;

36 
ósy§c_¶i°_cou¡
;

38 
CURLcode
 
ósy§c_öô
();

39 
CURLcode
 
ósy§c_add
(
cuæ_¶i°
 **
∂i°
, c⁄° *
bupf
);

40 
CURLcode
 
ósy§c_addf
(
cuæ_¶i°
 **
∂i°
, c⁄° *
fmt
, ...);

41 
CURLcode
 
ósy§c_≥rf‹m
();

42 
CURLcode
 
ósy§c_˛ónup
();

44 
dum≥asy§c
(
GlobÆC⁄fig
 *
c⁄fig
);

	@src/tool_formparse.c

22 
	~"toﬁ_£tup.h
"

24 
	~"øw°r.h
"

26 
	#ENABLE_CURLX_PRINTF


	)

28 
	~"cuæx.h
"

30 
	~"toﬁ_cfgabÀ.h
"

31 
	~"toﬁ_mfûes.h
"

32 
	~"toﬁ_msgs.h
"

33 
	~"toﬁ_f‹m∑r£.h
"

35 
	~"memdebug.h
"

43 *
	$gë_∑øm_w‹d
(**
°r
, **
íd_pos
)

45 *
±r
 = *
°r
;

46 *
w‹d_begö
 = 
NULL
;

47 *
±r2
;

48 *
esˇ≥
 = 
NULL
;

49 c⁄° *
íd_ch¨s
 = ";,";

52 
w‹d_begö
 = 
±r
;

53 if(*
±r
 == '"') {

54 ++
±r
;

55 *
±r
) {

56 if(*
±r
 == '\\') {

57 if(
±r
[1] == '\\' ||Ötr[1] == '"') {

59 if(!
esˇ≥
)

60 
esˇ≥
 = 
±r
;

62 
±r
 += 2;

66 if(*
±r
 == '"') {

67 *
íd_pos
 = 
±r
;

68 if(
esˇ≥
) {

70 
±r
 = 
±r2
 = 
esˇ≥
;

72 if(*
±r
 == '\\' && (ptr[1] == '\\' ||Ötr[1] == '"'))

73 ++
±r
;

74 *
±r2
++ = *
±r
++;

76 
±r
 < *
íd_pos
);

77 *
íd_pos
 = 
±r2
;

79 *
±r
 && 
NULL
==
	`°rchr
(
íd_ch¨s
, *ptr))

80 ++
±r
;

81 *
°r
 = 
±r
;

82  
w‹d_begö
+1;

84 ++
±r
;

87 
±r
 = 
w‹d_begö
;

90 *
±r
 && 
NULL
==
	`°rchr
(
íd_ch¨s
, *ptr))

91 ++
±r
;

92 *
°r
 = *
íd_pos
 = 
±r
;

93  
w‹d_begö
;

94 
	}
}

143 
	$f‹m∑r£
(
O≥øti⁄C⁄fig
 *
c⁄fig
,

144 c⁄° *
öput
,

145 
cuæ_hâµo°
 **
hâµo°
,

146 
cuæ_hâµo°
 **
œ°_po°
,

147 
boﬁ
 
lôîÆ_vÆue
)

151 
«me
[256];

152 *
c⁄ã¡s
 = 
NULL
;

153 
ty≥_maj‹
[128] = "";

154 
ty≥_mö‹
[128] = "";

155 *
c⁄ç
;

156 c⁄° *
ty≥
 = 
NULL
;

157 *
£p
;

159 if((1 =
	`ssˇnf
(
öput
, "%255[^=]=", 
«me
)) &&

160 ((
c⁄ç
 = 
	`°rchr
(
öput
, '=')Ë!
NULL
)) {

164 
c⁄ã¡s
 = 
	`°rdup
(
c⁄ç
+1);

165 if(!
c⁄ã¡s
) {

166 
	`Ârötf
(
c⁄fig
->
globÆ
->
îr‹s
, "out of memory\n");

169 
c⁄ç
 = 
c⁄ã¡s
;

171 if('@' =
c⁄ç
[0] && !
lôîÆ_vÆue
) {

175 
mu…i_fûes
 *
mu…i_°¨t
 = 
NULL
;

176 
mu…i_fûes
 *
mu…i_cuºít
 = 
NULL
;

178 *
±r
 = 
c⁄ç
;

179 *
íd
 = 
±r
 + 
	`°æí
(ptr);

184 *
fûíame
 = 
NULL
;

185 *
w‹d_íd
;

186 
boﬁ
 
£micﬁ⁄
;

188 
ty≥
 = 
NULL
;

190 ++
±r
;

191 
c⁄ç
 = 
	`gë_∑øm_w‹d
(&
±r
, &
w‹d_íd
);

192 
£micﬁ⁄
 = (';' =*
±r
Ë? 
TRUE
 : 
FALSE
;

193 *
w‹d_íd
 = '\0';

196 
£micﬁ⁄
) {

198 ++
±r
;

199 *
±r
 && (
	`ISSPACE
(*ptr)))

200 ++
±r
;

202 if(
	`check¥efix
("ty≥=", 
±r
)) {

204 
ty≥
 = &
±r
[5];

207 if(2 !
	`ssˇnf
(
ty≥
, "%127[^/]/%127[^;,\n]",

208 
ty≥_maj‹
, 
ty≥_mö‹
)) {

209 
	`w¨nf
(
c⁄fig
, "Illegally formatted content-type field!\n");

210 
	`Cuæ_ß„‰ì
(
c⁄ã¡s
);

211 
	`FªeMu…iInfo
(&
mu…i_°¨t
, &
mu…i_cuºít
);

216 
£p
 = (*)
ty≥
 + 
	`°æí
(
ty≥_maj‹
)+°æí(
ty≥_mö‹
)+1;

222 
±r
 = 
£p
;

223 if(*
£p
==';') {

224 if(!
	`check¥efix
(";fûíame=", 
£p
)) {

225 
±r
 = 
£p
 + 1;

226 ()
	`gë_∑øm_w‹d
(&
±r
, &
£p
);

227 
£micﬁ⁄
 = (';' =*
±r
Ë? 
TRUE
 : 
FALSE
;

231 
£micﬁ⁄
 = 
FALSE
;

233 if(*
£p
)

234 *
£p
 = '\0';

236 if(
	`check¥efix
("fûíame=", 
±r
)) {

237 
±r
 += 9;

238 
fûíame
 = 
	`gë_∑øm_w‹d
(&
±r
, &
w‹d_íd
);

239 
£micﬁ⁄
 = (';' =*
±r
Ë? 
TRUE
 : 
FALSE
;

240 *
w‹d_íd
 = '\0';

244 *
unknown
 = 
NULL
;

245 
unknown
 = 
	`gë_∑øm_w‹d
(&
±r
, &
w‹d_íd
);

246 
£micﬁ⁄
 = (';' =*
±r
Ë? 
TRUE
 : 
FALSE
;

247 if(*
unknown
) {

248 *
w‹d_íd
 = '\0';

249 
	`w¨nf
(
c⁄fig
, "skù unknow¿f‹m fõld: %s\n", 
unknown
);

258 if(*
c⁄ç
 && !
	`AddMu…iFûes
(c⁄ç, 
ty≥
, 
fûíame
, &
mu…i_°¨t
,

259 &
mu…i_cuºít
)) {

260 
	`w¨nf
(
c⁄fig
, "Error building formÖost!\n");

261 
	`Cuæ_ß„‰ì
(
c⁄ã¡s
);

262 
	`FªeMu…iInfo
(&
mu…i_°¨t
, &
mu…i_cuºít
);

267 } 
±r
 < 
íd
);

270 if(
mu…i_°¨t
) {

271 
cuæ_f‹ms
 *
f‹ms
 = 
NULL
;

272 
mu…i_fûes
 *
°¨t
 = 
mu…i_°¨t
;

273 
i
, 
cou¡
 = 0;

274 
°¨t
) {

275 
°¨t
 = sèπ->
√xt
;

276 ++
cou¡
;

278 
f‹ms
 = 
	`mÆloc
((
cou¡
+1)*(
cuæ_f‹ms
));

279 if(!
f‹ms
) {

280 
	`Ârötf
(
c⁄fig
->
globÆ
->
îr‹s
, "Error building formÖost!\n");

281 
	`Cuæ_ß„‰ì
(
c⁄ã¡s
);

282 
	`FªeMu…iInfo
(&
mu…i_°¨t
, &
mu…i_cuºít
);

285 
i
 = 0, 
°¨t
 = 
mu…i_°¨t
; i < 
cou¡
; ++i, sèπ = sèπ->
√xt
) {

286 
f‹ms
[
i
].
›ti⁄
 = 
°¨t
->
f‹m
.option;

287 
f‹ms
[
i
].
vÆue
 = 
°¨t
->
f‹m
.value;

289 
f‹ms
[
cou¡
].
›ti⁄
 = 
CURLFORM_END
;

290 
	`FªeMu…iInfo
(&
mu…i_°¨t
, &
mu…i_cuºít
);

291 if(
	`cuæ_f‹madd
(
hâµo°
, 
œ°_po°
,

292 
CURLFORM_COPYNAME
, 
«me
,

293 
CURLFORM_ARRAY
, 
f‹ms
, 
CURLFORM_END
) != 0) {

294 
	`w¨nf
(
c⁄fig
, "curl_formadd failed!\n");

295 
	`Cuæ_ß„‰ì
(
f‹ms
);

296 
	`Cuæ_ß„‰ì
(
c⁄ã¡s
);

299 
	`Cuæ_ß„‰ì
(
f‹ms
);

303 
cuæ_f‹ms
 
öfo
[4];

304 
i
 = 0;

305 *
˘
 = 
lôîÆ_vÆue
 ? 
NULL
 : 
	`°r°r
(
c⁄ç
, ";type=");

307 
öfo
[
i
].
›ti⁄
 = 
CURLFORM_COPYNAME
;

308 
öfo
[
i
].
vÆue
 = 
«me
;

309 
i
++;

311 if(
˘
) {

312 
öfo
[
i
].
›ti⁄
 = 
CURLFORM_CONTENTTYPE
;

313 
öfo
[
i
].
vÆue
 = &
˘
[6];

314 
i
++;

315 
˘
[0] = '\0';

318 if(
c⁄ç
[0]=='<' && !
lôîÆ_vÆue
) {

319 
öfo
[
i
].
›ti⁄
 = 
CURLFORM_FILECONTENT
;

320 
öfo
[
i
].
vÆue
 = 
c⁄ç
+1;

321 
i
++;

322 
öfo
[
i
].
›ti⁄
 = 
CURLFORM_END
;

324 if(
	`cuæ_f‹madd
(
hâµo°
, 
œ°_po°
,

325 
CURLFORM_ARRAY
, 
öfo
, 
CURLFORM_END
 ) != 0) {

326 
	`w¨nf
(
c⁄fig
, "curl_formadd failed,ÖossiblyÅhe file %s is bad!\n",

327 
c⁄ç
+1);

328 
	`Cuæ_ß„‰ì
(
c⁄ã¡s
);

333 #ifde‡
CURL_DOES_CONVERSIONS


334 if(
	`c⁄vît_to_√tw‹k
(
c⁄ç
, 
	`°æí
(contp))) {

335 
	`w¨nf
(
c⁄fig
, "curl_formadd failed!\n");

336 
	`Cuæ_ß„‰ì
(
c⁄ã¡s
);

340 
öfo
[
i
].
›ti⁄
 = 
CURLFORM_COPYCONTENTS
;

341 
öfo
[
i
].
vÆue
 = 
c⁄ç
;

342 
i
++;

343 
öfo
[
i
].
›ti⁄
 = 
CURLFORM_END
;

344 if(
	`cuæ_f‹madd
(
hâµo°
, 
œ°_po°
,

345 
CURLFORM_ARRAY
, 
öfo
, 
CURLFORM_END
) != 0) {

346 
	`w¨nf
(
c⁄fig
, "curl_formadd failed!\n");

347 
	`Cuæ_ß„‰ì
(
c⁄ã¡s
);

355 
	`w¨nf
(
c⁄fig
, "Illegally formatted input field!\n");

358 
	`Cuæ_ß„‰ì
(
c⁄ã¡s
);

360 
	}
}

	@src/tool_formparse.h

1 #i‚de‡
HEADER_CURL_TOOL_FORMPARSE_H


2 
	#HEADER_CURL_TOOL_FORMPARSE_H


	)

24 
	~"toﬁ_£tup.h
"

26 
f‹m∑r£
(
O≥øti⁄C⁄fig
 *
c⁄fig
,

27 c⁄° *
öput
,

28 
cuæ_hâµo°
 **
hâµo°
,

29 
cuæ_hâµo°
 **
œ°_po°
,

30 
boﬁ
 
lôîÆ_vÆue
);

	@src/tool_getparam.c

22 
	~"toﬁ_£tup.h
"

24 
	~"øw°r.h
"

26 
	#ENABLE_CURLX_PRINTF


	)

28 
	~"cuæx.h
"

30 
	~"toﬁ_bömode.h
"

31 
	~"toﬁ_cfgabÀ.h
"

32 
	~"toﬁ_cb_¥g.h
"

33 
	~"toﬁ_f‹m∑r£.h
"

34 
	~"toﬁ_gë∑øm.h
"

35 
	~"toﬁ_hñ≥rs.h
"

36 
	~"toﬁ_liböfo.h
"

37 
	~"toﬁ_mëÆök.h
"

38 
	~"toﬁ_msgs.h
"

39 
	~"toﬁ_∑ømhÕ.h
"

40 
	~"toﬁ_∑r£cfg.h
"

42 
	~"memdebug.h
"

44 #ifde‡
MSDOS


45 
	#USE_WATT32


	)

48 
	#GëSå
(
°r
,
vÆ
) do { \

49 if(*(
°r
)) { \

50 
	`‰ì
(*(
°r
)); \

51 *(
°r
Ë
NULL
; \

53 if((
vÆ
)) { \

54 *(
°r
Ë
	`°rdup
((
vÆ
)); \

55 if(!(*(
°r
))) \

56  
PARAM_NO_MEM
; \

58 } 
WHILE_FALSE


	)

60 
	sL⁄gSh‹t
 {

61 c⁄° *
	mÀâî
;

62 c⁄° *
	m ame
;

63 
boﬁ
 
	mexå≠¨am
;

66 c⁄° 
L⁄gSh‹t
 
	gÆü£s
[]= {

69 {"*", "uæ", 
TRUE
},

70 {"*4", "dns-ùv4-addr", 
TRUE
},

71 {"*6", "dns-ùv6-addr", 
TRUE
},

72 {"*a", "øndom-fûe", 
TRUE
},

73 {"*b", "egd-fûe", 
TRUE
},

74 {"*B", "ﬂuth2-bóªr", 
TRUE
},

75 {"*c", "c⁄√˘-timeout", 
TRUE
},

76 {"*d", "cùhîs", 
TRUE
},

77 {"*D", "dns-öãrÁ˚", 
TRUE
},

78 {"*e", "dißbÀ-ïsv", 
FALSE
},

79 {"*E", "ïsv", 
FALSE
},

82 #ifde‡
USE_ENVIRONMENT


83 {"*f", "ívú⁄mít", 
FALSE
},

85 {"*F", "dns-£rvîs", 
TRUE
},

86 {"*g", "åa˚", 
TRUE
},

87 {"*G", "≈n", 
FALSE
},

88 {"*h", "åa˚-ascii", 
TRUE
},

89 {"*H", "Æ≤", 
FALSE
},

90 {"*i", "limô-øã", 
TRUE
},

91 {"*j", "com¥es£d", 
FALSE
},

92 {"*J", "å-ícodög", 
FALSE
},

93 {"*k", "dige°", 
FALSE
},

94 {"*l", "√gŸüã", 
FALSE
},

95 {"*m", "¡lm", 
FALSE
},

96 {"*M", "¡lm-wb", 
FALSE
},

97 {"*n", "basic", 
FALSE
},

98 {"*o", "™yauth", 
FALSE
},

99 #ifde‡
USE_WATT32


100 {"*p", "wdebug", 
FALSE
},

102 {"*q", "·p-¸óã-dús", 
FALSE
},

103 {"*r", "¸óã-dús", 
FALSE
},

104 {"*s", "max-ªdús", 
TRUE
},

105 {"*t", "¥oxy-¡lm", 
FALSE
},

106 {"*u", "¸lf", 
FALSE
},

107 {"*v", "°dîr", 
TRUE
},

108 {"*w", "öãrÁ˚", 
TRUE
},

109 {"*x", "krb" , 
TRUE
},

110 {"*x", "krb4" , 
TRUE
},

112 {"*y", "max-fûesize", 
TRUE
},

113 {"*z", "dißbÀ-ïπ", 
FALSE
},

114 {"*Z", "ïπ", 
FALSE
},

117 {"$a", "·p-s¶", 
FALSE
},

119 {"$a", "s¶", 
FALSE
},

121 {"$b", "·p-∑sv", 
FALSE
},

122 {"$c", "socks5", 
TRUE
},

123 {"$c", "socks", 
TRUE
},

126 {"$d", "t˝-nodñay", 
FALSE
},

127 {"$e", "¥oxy-dige°", 
FALSE
},

128 {"$f", "¥oxy-basic", 
FALSE
},

129 {"$g", "ªåy", 
TRUE
},

130 {"$h", "ªåy-dñay", 
TRUE
},

131 {"$i", "ªåy-max-time", 
TRUE
},

132 {"$k", "¥oxy-√gŸüã", 
FALSE
},

133 {"$m", "·p-accou¡", 
TRUE
},

134 {"$n", "¥oxy-™yauth", 
FALSE
},

135 {"$o", "åa˚-time", 
FALSE
},

136 {"$p", "ign‹e-c⁄ã¡-Àngth", 
FALSE
},

137 {"$q", "·p-skù-∑sv-ù", 
FALSE
},

138 {"$r", "·p-mëhod", 
TRUE
},

139 {"$s", "loˇl-p‹t", 
TRUE
},

140 {"$t", "socks4", 
TRUE
},

141 {"$T", "socks4a", 
TRUE
},

142 {"$u", "·p-Æã∫©ive-to-u£r", 
TRUE
},

143 {"$v", "·p-s¶-ªqd", 
FALSE
},

145 {"$v", "s¶-ªqd", 
FALSE
},

147 {"$w", "£ssi⁄id", 
FALSE
},

149 {"$x", "·p-s¶-c⁄åﬁ", 
FALSE
},

150 {"$y", "·p-s¶-ccc", 
FALSE
},

151 {"$j", "·p-s¶-ccc-mode", 
TRUE
},

152 {"$z", "libcuæ", 
TRUE
},

153 {"$#", "øw", 
FALSE
},

154 {"$0", "po°301", 
FALSE
},

155 {"$1", "kì∑live", 
FALSE
},

157 {"$2", "socks5-ho°«me", 
TRUE
},

158 {"$3", "kì∑live-time", 
TRUE
},

159 {"$4", "po°302", 
FALSE
},

160 {"$5", "n›roxy", 
TRUE
},

161 #i‡
deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

162 {"$6", "socks5-gsßpi-£rvi˚", 
TRUE
},

163 {"$7", "socks5-gsßpi-√c", 
FALSE
},

165 {"$8", "¥oxy1.0", 
TRUE
},

166 {"$9", "t·p-blksize", 
TRUE
},

167 {"$A", "maû-‰om", 
TRUE
},

168 {"$B", "maû-r˝t", 
TRUE
},

169 {"$C", "·p-¥ë", 
FALSE
},

170 {"$D", "¥Ÿo", 
TRUE
},

171 {"$E", "¥Ÿo-ªdú", 
TRUE
},

172 {"$F", "ªsﬁve", 
TRUE
},

173 {"$G", "dñeg©i⁄", 
TRUE
},

174 {"$H", "maû-auth", 
TRUE
},

175 {"$I", "po°303", 
FALSE
},

176 {"$J", "mëÆök", 
FALSE
},

177 {"$K", "ß¶-ú", 
FALSE
},

178 {"$L", "ã°-evít", 
FALSE
},

179 {"0", "hâp1.0", 
FALSE
},

180 {"01", "hâp1.1", 
FALSE
},

181 {"02", "hâp2", 
FALSE
},

182 {"1", "ésv1", 
FALSE
},

183 {"10", "ésv1.0", 
FALSE
},

184 {"11", "ésv1.1", 
FALSE
},

185 {"12", "ésv1.2", 
FALSE
},

186 {"2", "s¶v2", 
FALSE
},

187 {"3", "s¶v3", 
FALSE
},

188 {"4", "ùv4", 
FALSE
},

189 {"6", "ùv6", 
FALSE
},

190 {"a", "≠≥nd", 
FALSE
},

191 {"A", "u£r-agít", 
TRUE
},

192 {"b", "cookõ", 
TRUE
},

193 {"B", "u£-ascii", 
FALSE
},

194 {"c", "cookõ-j¨", 
TRUE
},

195 {"C", "c⁄töue-©", 
TRUE
},

196 {"d", "d©a", 
TRUE
},

197 {"da", "d©a-ascii", 
TRUE
},

198 {"db", "d©a-bö¨y", 
TRUE
},

199 {"de", "d©a-uæícode", 
TRUE
},

200 {"D", "dump-hódî", 
TRUE
},

201 {"e", "ª„ªr", 
TRUE
},

202 {"E", "˚π", 
TRUE
},

203 {"Ea", "ˇ˚π", 
TRUE
},

204 {"Eb", "˚π-ty≥", 
TRUE
},

205 {"Ec", "key", 
TRUE
},

206 {"Ed", "key-ty≥", 
TRUE
},

207 {"Ee", "∑ss", 
TRUE
},

208 {"Ef", "ígöe", 
TRUE
},

209 {"Eg", "ˇ∑th ", 
TRUE
},

210 {"Eh", "pubkey", 
TRUE
},

211 {"Ei", "ho°pubmd5", 
TRUE
},

212 {"Ej", "¸lfûe", 
TRUE
},

213 {"Ek", "ésu£r", 
TRUE
},

214 {"El", "é•assw‹d", 
TRUE
},

215 {"Em", "éßuthty≥", 
TRUE
},

216 {"En", "s¶-Ælow-bó°", 
FALSE
},

217 {"Eo", "logö-›ti⁄s", 
TRUE
},

218 {"f", "Áû", 
FALSE
},

219 {"F", "f‹m", 
TRUE
},

220 {"Fs", "f‹m-°rög", 
TRUE
},

221 {"g", "globoff", 
FALSE
},

222 {"G", "gë", 
FALSE
},

223 {"h", "hñp", 
FALSE
},

224 {"H", "hódî", 
TRUE
},

225 {"Hp", "¥oxy-hódî", 
TRUE
},

226 {"i", "ö˛ude", 
FALSE
},

227 {"I", "hód", 
FALSE
},

228 {"j", "junk-£ssi⁄-cookõs", 
FALSE
},

229 {"J", "ªmŸe-hódî-«me", 
FALSE
},

230 {"k", "ö£cuª", 
FALSE
},

231 {"K", "c⁄fig", 
TRUE
},

232 {"l", "li°-⁄ly", 
FALSE
},

233 {"L", "loˇti⁄", 
FALSE
},

234 {"Lt", "loˇti⁄-åu°ed", 
FALSE
},

235 {"m", "max-time", 
TRUE
},

236 {"M", "m™uÆ", 
FALSE
},

237 {"n", "√åc", 
FALSE
},

238 {"no", "√åc-›ti⁄Æ", 
FALSE
},

239 {"√", "√åc-fûe", 
TRUE
},

240 {"N", "buf„r", 
FALSE
},

242 {"o", "ouçut", 
TRUE
},

243 {"O", "ªmŸe-«me", 
FALSE
},

244 {"Oa", "ªmŸe-«me-Æl", 
FALSE
},

245 {"p", "¥oxytu¬ñ", 
FALSE
},

246 {"P", "·µ‹t", 
TRUE
},

248 {"P", "·p-p‹t", 
TRUE
},

249 {"q", "dißbÀ", 
FALSE
},

250 {"Q", "quŸe", 
TRUE
},

251 {"r", "ønge", 
TRUE
},

252 {"R", "ªmŸe-time", 
FALSE
},

253 {"s", "sûít", 
FALSE
},

254 {"S", "show-îr‹", 
FALSE
},

255 {"t", "ã ë-›ti⁄s", 
TRUE
},

257 {"T", "u∂ﬂd-fûe", 
TRUE
},

258 {"u", "u£r", 
TRUE
},

259 {"U", "¥oxy-u£r", 
TRUE
},

260 {"v", "vîbo£", 
FALSE
},

261 {"V", "vîsi⁄", 
FALSE
},

262 {"w", "wrôe-out", 
TRUE
},

263 {"x", "¥oxy", 
TRUE
},

264 {"X", "ªque°", 
TRUE
},

265 {"X", "hâp-ªque°", 
TRUE
},

267 {"Y", "•ìd-limô", 
TRUE
},

268 {"y", "•ìd-time", 
TRUE
},

269 {"z", "time-c⁄d", 
TRUE
},

270 {"#", "¥ogªss-b¨", 
FALSE
},

271 {":", "√xt", 
FALSE
},

272 {"~", "x©å", 
FALSE
},

279 #i‚de‡
UNITTESTS


282 
	$∑r£_˚π_∑ømëî
(c⁄° *
˚π_∑ømëî
,

283 **
˚π«me
,

284 **
∑s•hø£
)

286 
size_t
 
∑øm_Àngth
 = 
	`°æí
(
˚π_∑ømëî
);

287 
size_t
 
•™
;

288 c⁄° *
∑øm_∂a˚
 = 
NULL
;

289 *
˚π«me_∂a˚
 = 
NULL
;

290 *
˚π«me
 = 
NULL
;

291 *
∑s•hø£
 = 
NULL
;

294 if(
∑øm_Àngth
 == 0)

299 if(!
	`°Ωbrk
(
˚π_∑ømëî
, ":\\")) {

300 *
˚π«me
 = 
	`°rdup
(
˚π_∑ømëî
);

304 
˚π«me_∂a˚
 = 
	`mÆloc
(
∑øm_Àngth
 + 1);

305 if(!
˚π«me_∂a˚
)

308 *
˚π«me
 = 
˚π«me_∂a˚
;

309 
∑øm_∂a˚
 = 
˚π_∑ømëî
;

310 *
∑øm_∂a˚
) {

311 
•™
 = 
	`°rc•n
(
∑øm_∂a˚
, ":\\");

312 
	`°∫˝y
(
˚π«me_∂a˚
, 
∑øm_∂a˚
, 
•™
);

313 
∑øm_∂a˚
 +
•™
;

314 
˚π«me_∂a˚
 +
•™
;

317 *
∑øm_∂a˚
) {

321 
∑øm_∂a˚
++;

322 *
∑øm_∂a˚
) {

324 *
˚π«me_∂a˚
++ = '\\';

327 *
˚π«me_∂a˚
++ = '\\';

328 
∑øm_∂a˚
++;

331 *
˚π«me_∂a˚
++ = ':';

332 
∑øm_∂a˚
++;

335 *
˚π«me_∂a˚
++ = '\\';

336 *
˚π«me_∂a˚
++ = *
∑øm_∂a˚
;

337 
∑øm_∂a˚
++;

347 #ifde‡
WIN32


348 if(
∑øm_∂a˚
 &&

349 (
∑øm_∂a˚
 =&
˚π_∑ømëî
[1]) &&

350 (
˚π_∑ømëî
[2] == '\\' || cert_parameter[2] == '/') &&

351 (
	`ISALPHA
(
˚π_∑ømëî
[0])) ) {

356 *
˚π«me_∂a˚
++ = ':';

357 
∑øm_∂a˚
++;

363 
∑øm_∂a˚
++;

364 if(
	`°æí
(
∑øm_∂a˚
) > 0) {

365 *
∑s•hø£
 = 
	`°rdup
(
∑øm_∂a˚
);

367 
d⁄e
;

370 
d⁄e
:

371 *
˚π«me_∂a˚
 = '\0';

372 
	}
}

374 
P¨amëîEº‹
 
	$gë∑ømëî
(*
Êag
,

375 *
√xèrg
,

376 
boﬁ
 *
u£d¨g
,

378 
GlobÆC⁄fig
 *
globÆ
,

379 
O≥øti⁄C⁄fig
 *
c⁄fig
)

381 
Àâî
;

382 
subÀâî
 = '\0';

383 
rc
;

384 c⁄° *
∑r£
 = 
NULL
;

385 
j
;

386 
time_t
 
now
;

387 
hô
 = -1;

388 
boﬁ
 
l⁄g›t
 = 
FALSE
;

389 
boﬁ
 
sögÀ›t
 = 
FALSE
;

390 
P¨amëîEº‹
 
îr
;

391 
boﬁ
 
toggÀ
 = 
TRUE
;

395 if(('-' !
Êag
[0]) ||

396 (('-' =
Êag
[0]) && ('-' == flag[1]))) {

398 *
w‹d
 = ('-' =
Êag
[0]) ? flag+2 : flag;

399 
size_t
 
‚am
 = 
	`°æí
(
w‹d
);

400 
numhôs
 = 0;

402 if(!
	`°∫cmp
(
w‹d
, "no-", 3)) {

404 
w‹d
 += 3;

405 
toggÀ
 = 
FALSE
;

408 
j
 = 0; j < (
Æü£s
)/(aliases[0]); j++) {

409 if(
	`cuæx_°∫equÆ
(
Æü£s
[
j
].
 ame
, 
w‹d
, 
‚am
)) {

410 
l⁄g›t
 = 
TRUE
;

411 
numhôs
++;

412 if(
	`cuæx_øw_equÆ
(
Æü£s
[
j
].
 ame
, 
w‹d
)) {

413 
∑r£
 = 
Æü£s
[
j
].
Àâî
;

414 
hô
 = 
j
;

415 
numhôs
 = 1;

418 
∑r£
 = 
Æü£s
[
j
].
Àâî
;

419 
hô
 = 
j
;

422 if(
numhôs
 > 1) {

424  
PARAM_OPTION_AMBIGUOUS
;

426 if(
hô
 < 0) {

427  
PARAM_OPTION_UNKNOWN
;

431 
Êag
++;

432 
hô
 = -1;

433 
∑r£
 = 
Êag
;

439 if(!
l⁄g›t
) {

440 if(
NULL
 !
∑r£
) {

441 
Àâî
 = ()*
∑r£
;

444 
Àâî
 = '\0';

446 
subÀâî
='\0';

449 
Àâî
 = 
∑r£
[0];

450 
subÀâî
 = 
∑r£
[1];

452 *
u£d¨g
 = 
FALSE
;

454 if(
hô
 < 0) {

455 
j
 = 0; j < (
Æü£s
)/(aliases[0]); j++) {

456 if(
Àâî
 =
Æü£s
[
j
].letter[0]) {

457 
hô
 = 
j
;

461 if(
hô
 < 0) {

462  
PARAM_OPTION_UNKNOWN
;

466 if(
Æü£s
[
hô
].
exå≠¨am
) {

468 if(!
l⁄g›t
 && 
∑r£
[1]) {

469 
√xèrg
 = (*)&
∑r£
[1];

470 
sögÀ›t
 = 
TRUE
;

472 if(!
√xèrg
)

473  
PARAM_REQUIRES_PARAMETER
;

475 *
u£d¨g
 = 
TRUE
;

478 
Àâî
) {

480 
subÀâî
) {

483 
	`GëSå
(&
c⁄fig
->
dns_ùv4_addr
, 
√xèrg
);

487 
	`GëSå
(&
c⁄fig
->
dns_ùv6_addr
, 
√xèrg
);

490 
	`GëSå
(&
c⁄fig
->
øndom_fûe
, 
√xèrg
);

493 
	`GëSå
(&
c⁄fig
->
egd_fûe
, 
√xèrg
);

496 
	`GëSå
(&
c⁄fig
->
xﬂuth2_bóªr
, 
√xèrg
);

499 
îr
 = 
	`°r2udoubÀ
(&
c⁄fig
->
c⁄√˘timeout
, 
√xèrg
);

500 if(
îr
)

501  
îr
;

504 
	`GëSå
(&
c⁄fig
->
cùhî_li°
, 
√xèrg
);

508 
	`GëSå
(&
c⁄fig
->
dns_öãrÁ˚
, 
√xèrg
);

511 
c⁄fig
->
dißbÀ_ïsv
 = 
toggÀ
;

514 
c⁄fig
->
dißbÀ_ïsv
 = (!
toggÀ
)?
TRUE
:
FALSE
;

516 #ifde‡
USE_ENVIRONMENT


518 
c⁄fig
->
wrôìnv
 = 
toggÀ
;

523 
	`GëSå
(&
c⁄fig
->
dns_£rvîs
, 
√xèrg
);

526 
	`GëSå
(&
globÆ
->
åa˚_dump
, 
√xèrg
);

527 if(
globÆ
->
åa˚ty≥
 && (globÆ->åa˚ty≥ !
TRACE_BIN
))

528 
	`w¨nf
(
c⁄fig
, "--trace overridesánÉarlierÅrace/verbose option\n");

529 
globÆ
->
åa˚ty≥
 = 
TRACE_BIN
;

532 
c⁄fig
->
n⁄≤
 = (!
toggÀ
)?
TRUE
:
FALSE
;

535 
	`GëSå
(&
globÆ
->
åa˚_dump
, 
√xèrg
);

536 if(
globÆ
->
åa˚ty≥
 && (globÆ->åa˚ty≥ !
TRACE_ASCII
))

537 
	`w¨nf
(
c⁄fig
,

539 
globÆ
->
åa˚ty≥
 = 
TRACE_ASCII
;

542 
c⁄fig
->
nﬂÕn
 = (!
toggÀ
)?
TRUE
:
FALSE
;

547 *
unô
;

548 
cuæ_off_t
 
vÆue
 = 
	`cuæx_°πoof·
(
√xèrg
, &
unô
, 0);

550 if(!*
unô
)

551 
unô
 = (*)"b";

552 if(
	`°æí
(
unô
) > 1)

553 
unô
 = (*)"w";

555 *
unô
) {

558 
vÆue
 *= 1024*1024*1024;

562 
vÆue
 *= 1024*1024;

566 
vÆue
 *= 1024;

573 
	`w¨nf
(
c⁄fig
, "unsupportedÑate unit. Use G, M, K or B!\n");

574  
PARAM_BAD_USE
;

576 
c⁄fig
->
ªcv≥r£c⁄d
 = 
vÆue
;

577 
c⁄fig
->
£nd≥r£c⁄d
 = 
vÆue
;

582 if(
toggÀ
 && !(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_LIBZ
))

583  
PARAM_LIBCURL_DOESNT_SUPPORT
;

584 
c⁄fig
->
ícodög
 = 
toggÀ
;

588 
c⁄fig
->
å_ícodög
 = 
toggÀ
;

592 if(
toggÀ
)

593 
c⁄fig
->
authty≥
 |
CURLAUTH_DIGEST
;

595 
c⁄fig
->
authty≥
 &~
CURLAUTH_DIGEST
;

599 if(
toggÀ
) {

600 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_GSSNEGOTIATE
)

601 
c⁄fig
->
authty≥
 |
CURLAUTH_GSSNEGOTIATE
;

603  
PARAM_LIBCURL_DOESNT_SUPPORT
;

606 
c⁄fig
->
authty≥
 &~
CURLAUTH_GSSNEGOTIATE
;

610 if(
toggÀ
) {

611 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_NTLM
)

612 
c⁄fig
->
authty≥
 |
CURLAUTH_NTLM
;

614  
PARAM_LIBCURL_DOESNT_SUPPORT
;

617 
c⁄fig
->
authty≥
 &~
CURLAUTH_NTLM
;

621 if(
toggÀ
) {

622 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_NTLM_WB
)

623 
c⁄fig
->
authty≥
 |
CURLAUTH_NTLM_WB
;

625  
PARAM_LIBCURL_DOESNT_SUPPORT
;

628 
c⁄fig
->
authty≥
 &~
CURLAUTH_NTLM_WB
;

632 if(
toggÀ
)

633 
c⁄fig
->
authty≥
 |
CURLAUTH_BASIC
;

635 
c⁄fig
->
authty≥
 &~
CURLAUTH_BASIC
;

639 if(
toggÀ
)

640 
c⁄fig
->
authty≥
 = 
CURLAUTH_ANY
;

644 #ifde‡
USE_WATT32


646 
	`dbug_öô
();

650 
c⁄fig
->
·p_¸óã_dús
 = 
toggÀ
;

654 
c⁄fig
->
¸óã_dús
 = 
toggÀ
;

660 
îr
 = 
	`°r2num
(&
c⁄fig
->
maxªdús
, 
√xèrg
);

661 if(
îr
)

662  
îr
;

663 if(
c⁄fig
->
maxªdús
 < -1)

664  
PARAM_BAD_NUMERIC
;

668 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_NTLM
)

669 
c⁄fig
->
¥oxy¡lm
 = 
toggÀ
;

671  
PARAM_LIBCURL_DOESNT_SUPPORT
;

676 
c⁄fig
->
¸lf
 = 
toggÀ
;

680 if(
	`°rcmp
(
√xèrg
, "-")) {

681 
FILE
 *
√wfûe
 = 
	`f›í
(
√xèrg
, "wt");

682 if(!
√wfûe
)

683 
	`w¨nf
(
c⁄fig
, "FaûedÅÿ›í %s!\n", 
√xèrg
);

685 if(
globÆ
->
îr‹s_f›íed
)

686 
	`f˛o£
(
globÆ
->
îr‹s
);

687 
globÆ
->
îr‹s
 = 
√wfûe
;

688 
globÆ
->
îr‹s_f›íed
 = 
TRUE
;

692 
globÆ
->
îr‹s
 = 
°dout
;

696 
	`GëSå
(&
c⁄fig
->
iÁ˚
, 
√xèrg
);

700 if(
cuæöfo
->
„©uªs
 & (
CURL_VERSION_KERBEROS4
 |

701 
CURL_VERSION_GSSNEGOTIATE
))

702 
	`GëSå
(&
c⁄fig
->
krbÀvñ
, 
√xèrg
);

704  
PARAM_LIBCURL_DOESNT_SUPPORT
;

707 
îr
 = 
	`°r2off£t
(&
c⁄fig
->
max_fûesize
, 
√xèrg
);

708 if(
îr
)

709  
îr
;

712 
c⁄fig
->
dißbÀ_ïπ
 = 
toggÀ
;

715 
c⁄fig
->
dißbÀ_ïπ
 = (!
toggÀ
)?
TRUE
:
FALSE
;

720 
gëout
 *
uæ
;

721 if(
c⁄fig
->
uæ_gë
 || ((c⁄fig->uæ_gë = c⁄fig->
uæ_li°
Ë!
NULL
)) {

724 
c⁄fig
->
uæ_gë
 && (c⁄fig->uæ_gë->
Êags
 & 
GETOUT_URL
))

725 
c⁄fig
->
uæ_gë
 = c⁄fig->uæ_gë->
√xt
;

730 if(
c⁄fig
->
uæ_gë
)

732 
uæ
 = 
c⁄fig
->
uæ_gë
;

735 
uæ
 = 
	`√w_gëout
(
c⁄fig
);

737 if(!
uæ
)

738  
PARAM_NO_MEM
;

741 
	`GëSå
(&
uæ
->uæ, 
√xèrg
);

742 
uæ
->
Êags
 |
GETOUT_URL
;

748 
subÀâî
) {

750 if(
toggÀ
 && !(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_SSL
))

751  
PARAM_LIBCURL_DOESNT_SUPPORT
;

752 
c⁄fig
->
·p_s¶
 = 
toggÀ
;

755 
	`Cuæ_ß„‰ì
(
c⁄fig
->
·µ‹t
);

759 
	`GëSå
(&
c⁄fig
->
sock•roxy
, 
√xèrg
);

760 
c⁄fig
->
socksvî
 = 
CURLPROXY_SOCKS5
;

763 
	`GëSå
(&
c⁄fig
->
sock•roxy
, 
√xèrg
);

764 
c⁄fig
->
socksvî
 = 
CURLPROXY_SOCKS4
;

767 
	`GëSå
(&
c⁄fig
->
sock•roxy
, 
√xèrg
);

768 
c⁄fig
->
socksvî
 = 
CURLPROXY_SOCKS4A
;

772 
	`GëSå
(&
c⁄fig
->
sock•roxy
, 
√xèrg
);

773 
c⁄fig
->
socksvî
 = 
CURLPROXY_SOCKS5_HOSTNAME
;

776 
c⁄fig
->
t˝_nodñay
 = 
toggÀ
;

779 
c⁄fig
->
¥oxydige°
 = 
toggÀ
;

782 
c⁄fig
->
¥oxybasic
 = 
toggÀ
;

785 
îr
 = 
	`°r2unum
(&
c⁄fig
->
ªq_ªåy
, 
√xèrg
);

786 if(
îr
)

787  
îr
;

790 
îr
 = 
	`°r2unum
(&
c⁄fig
->
ªåy_dñay
, 
√xèrg
);

791 if(
îr
)

792  
îr
;

795 
îr
 = 
	`°r2unum
(&
c⁄fig
->
ªåy_maxtime
, 
√xèrg
);

796 if(
îr
)

797  
îr
;

801 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_GSSNEGOTIATE
)

802 
c⁄fig
->
¥oxy√gŸüã
 = 
toggÀ
;

804  
PARAM_LIBCURL_DOESNT_SUPPORT
;

807 
	`GëSå
(&
c⁄fig
->
·p_accou¡
, 
√xèrg
);

810 
c⁄fig
->
¥oxy™yauth
 = 
toggÀ
;

813 
globÆ
->
åa˚time
 = 
toggÀ
;

816 
c⁄fig
->
ign‹e˛
 = 
toggÀ
;

819 
c⁄fig
->
·p_skù_ù
 = 
toggÀ
;

822 
c⁄fig
->
·p_fûemëhod
 = 
	`·pfûemëhod
(c⁄fig, 
√xèrg
);

825 
rc
 = 
	`ssˇnf
(
√xèrg
, "%d - %d",

826 &
c⁄fig
->
loˇÕ‹t
,

827 &
c⁄fig
->
loˇÕ‹å™ge
);

828 if(!
rc
)

829  
PARAM_BAD_USE
;

830 if(
rc
 == 1)

831 
c⁄fig
->
loˇÕ‹å™ge
 = 1;

833 
c⁄fig
->
loˇÕ‹å™ge
 -c⁄fig->
loˇÕ‹t
;

834 if(
c⁄fig
->
loˇÕ‹å™ge
 < 1) {

835 
	`w¨nf
(
c⁄fig
, "badÑange input\n");

836  
PARAM_BAD_USE
;

841 
	`GëSå
(&
c⁄fig
->
·p_Æã∫©ive_to_u£r
, 
√xèrg
);

844 if(
toggÀ
 && !(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_SSL
))

845  
PARAM_LIBCURL_DOESNT_SUPPORT
;

846 
c⁄fig
->
·p_s¶_ªqd
 = 
toggÀ
;

849 
c⁄fig
->
dißbÀ_£ssi⁄id
 = (!
toggÀ
)?
TRUE
:
FALSE
;

852 if(
toggÀ
 && !(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_SSL
))

853  
PARAM_LIBCURL_DOESNT_SUPPORT
;

854 
c⁄fig
->
·p_s¶_c⁄åﬁ
 = 
toggÀ
;

857 
c⁄fig
->
·p_s¶_ccc
 = 
toggÀ
;

858 if(!
c⁄fig
->
·p_s¶_ccc_mode
)

859 
c⁄fig
->
·p_s¶_ccc_mode
 = 
CURLFTPSSL_CCC_PASSIVE
;

862 
c⁄fig
->
·p_s¶_ccc
 = 
TRUE
;

863 
c⁄fig
->
·p_s¶_ccc_mode
 = 
	`·pcccmëhod
(c⁄fig, 
√xèrg
);

866 #ifde‡
CURL_DISABLE_LIBCURL_OPTION


867 
	`w¨nf
(
c⁄fig
,

869  
PARAM_OPTION_UNKNOWN
;

871 
	`GëSå
(&
globÆ
->
libcuæ
, 
√xèrg
);

875 
c⁄fig
->
øw
 = 
toggÀ
;

878 
c⁄fig
->
po°301
 = 
toggÀ
;

881 
c⁄fig
->
nokì∑live
 = (!
toggÀ
)?
TRUE
:
FALSE
;

884 
îr
 = 
	`°r2unum
(&
c⁄fig
->
Æivëime
, 
√xèrg
);

885 if(
îr
)

886  
îr
;

889 
c⁄fig
->
po°302
 = 
toggÀ
;

892 
c⁄fig
->
po°303
 = 
toggÀ
;

896 
	`GëSå
(&
c⁄fig
->
n›roxy
, 
√xèrg
);

898 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

900 
	`GëSå
(&
c⁄fig
->
socks5_gsßpi_£rvi˚
, 
√xèrg
);

903 
c⁄fig
->
socks5_gsßpi_√c
 = 
toggÀ
;

908 
	`GëSå
(&
c⁄fig
->
¥oxy
, 
√xèrg
);

909 
c⁄fig
->
¥oxyvî
 = 
CURLPROXY_HTTP_1_0
;

912 
îr
 = 
	`°r2unum
(&
c⁄fig
->
t·p_blksize
, 
√xèrg
);

913 if(
îr
)

914  
îr
;

917 
	`GëSå
(&
c⁄fig
->
maû_‰om
, 
√xèrg
);

921 
îr
 = 
	`add2li°
(&
c⁄fig
->
maû_r˝t
, 
√xèrg
);

922 if(
îr
)

923  
îr
;

926 
c⁄fig
->
·p_¥ë
 = 
toggÀ
;

929 
c⁄fig
->
¥Ÿo_¥e£¡
 = 
TRUE
;

930 if(
	`¥Ÿo2num
(
c⁄fig
, &c⁄fig->
¥Ÿo
, 
√xèrg
))

931  
PARAM_BAD_USE
;

934 
c⁄fig
->
¥Ÿo_ªdú_¥e£¡
 = 
TRUE
;

935 if(
	`¥Ÿo2num
(
c⁄fig
, &c⁄fig->
¥Ÿo_ªdú
, 
√xèrg
))

936  
PARAM_BAD_USE
;

939 
îr
 = 
	`add2li°
(&
c⁄fig
->
ªsﬁve
, 
√xèrg
);

940 if(
îr
)

941  
îr
;

944 
c⁄fig
->
gsßpi_dñeg©i⁄
 = 
	`dñeg©i⁄
(c⁄fig, 
√xèrg
);

947 
	`GëSå
(&
c⁄fig
->
maû_auth
, 
√xèrg
);

951 #ifde‡
USE_METALINK


952 
mlmaj
, 
mlmö
, 
mÕ©ch
;

953 
	`mëÆök_gë_vîsi⁄
(&
mlmaj
, &
mlmö
, &
mÕ©ch
);

954 if((
mlmaj
*10000)+(
mlmö
*100)+
mÕ©ch
 < 
CURL_REQ_LIBMETALINK_VERS
) {

955 
	`w¨nf
(
c⁄fig
,

959 
CURL_REQ_LIBMETALINK_MAJOR
,

960 
CURL_REQ_LIBMETALINK_MINOR
,

961 
CURL_REQ_LIBMETALINK_PATCH
,

962 
mlmaj
, 
mlmö
, 
mÕ©ch
);

963  
PARAM_BAD_USE
;

966 
c⁄fig
->
u£_mëÆök
 = 
toggÀ
;

968 
	`w¨nf
(
c⁄fig
, "--metalink option is ignored becauseÅhe binary is "

974 
c⁄fig
->
ß¶_ú
 = 
toggÀ
;

977 #ifde‡
CURLDEBUG


978 
c⁄fig
->
ã°_evít_ba£d
 = 
toggÀ
;

980 
	`w¨nf
(
c⁄fig
, "--test-event is ignored unlessá debug build!\n");

986 if(
toggÀ
)

987 
globÆ
->
¥ogªssmode
 = 
CURL_PROGRESS_BAR
;

989 
globÆ
->
¥ogªssmode
 = 
CURL_PROGRESS_STATS
;

992  
PARAM_NEXT_OPERATION
;

994 
c⁄fig
->
x©å
 = 
toggÀ
;

997 
subÀâî
) {

1000 
c⁄fig
->
hâpvîsi⁄
 = 
CURL_HTTP_VERSION_1_0
;

1004 
c⁄fig
->
hâpvîsi⁄
 = 
CURL_HTTP_VERSION_1_1
;

1008 
c⁄fig
->
hâpvîsi⁄
 = 
CURL_HTTP_VERSION_2_0
;

1013 
subÀâî
) {

1016 
c⁄fig
->
s¶_vîsi⁄
 = 
CURL_SSLVERSION_TLSv1
;

1020 
c⁄fig
->
s¶_vîsi⁄
 = 
CURL_SSLVERSION_TLSv1_0
;

1024 
c⁄fig
->
s¶_vîsi⁄
 = 
CURL_SSLVERSION_TLSv1_1
;

1028 
c⁄fig
->
s¶_vîsi⁄
 = 
CURL_SSLVERSION_TLSv1_2
;

1034 
c⁄fig
->
s¶_vîsi⁄
 = 
CURL_SSLVERSION_SSLv2
;

1038 
c⁄fig
->
s¶_vîsi⁄
 = 
CURL_SSLVERSION_SSLv3
;

1042 
c⁄fig
->
ù_vîsi⁄
 = 4;

1046 
c⁄fig
->
ù_vîsi⁄
 = 6;

1050 
c⁄fig
->
·p_≠≥nd
 = 
toggÀ
;

1054 
	`GëSå
(&
c⁄fig
->
u£øgít
, 
√xèrg
);

1057 if(
√xèrg
[0] == '@') {

1058 
√xèrg
++;

1060 if(
	`°rchr
(
√xèrg
, '=')) {

1062 
	`GëSå
(&
c⁄fig
->
cookõ
, 
√xèrg
);

1066 
	`GëSå
(&
c⁄fig
->
cookõfûe
, 
√xèrg
);

1070 
c⁄fig
->
u£_ascii
 = 
toggÀ
;

1074 
	`GëSå
(&
c⁄fig
->
cookõj¨
, 
√xèrg
);

1078 if(!
	`cuæx_°ªquÆ
(
√xèrg
, "-")) {

1079 
îr
 = 
	`°r2off£t
(&
c⁄fig
->
ªsume_‰om
, 
√xèrg
);

1080 if(
îr
)

1081  
îr
;

1082 
c⁄fig
->
ªsume_‰om_cuºít
 = 
FALSE
;

1085 
c⁄fig
->
ªsume_‰om_cuºít
 = 
TRUE
;

1086 
c⁄fig
->
ªsume_‰om
 = 0;

1088 
c⁄fig
->
u£_ªsume
=
TRUE
;

1093 *
po°d©a
 = 
NULL
;

1094 
FILE
 *
fûe
;

1095 
size_t
 
size
 = 0;

1097 if(
subÀâî
 == 'e') {

1104 c⁄° *
p
 = 
	`°rchr
(
√xèrg
, '=');

1105 
size_t
 
∆í
;

1106 
is_fûe
;

1107 if(!
p
)

1109 
p
 = 
	`°rchr
(
√xèrg
, '@');

1110 if(
p
) {

1111 
∆í
 = 
p
 - 
√xèrg
;

1112 
is_fûe
 = *
p
++;

1116 
∆í
 = 
is_fûe
 = 0;

1117 
p
 = 
√xèrg
;

1119 if('@' =
is_fûe
) {

1122 if(
	`cuæx_°ªquÆ
("-", 
p
)) {

1123 
fûe
 = 
°dö
;

1124 
	`£t_bömode
(
°dö
);

1127 
fûe
 = 
	`f›í
(
p
, "rb");

1128 if(!
fûe
)

1129 
	`w¨nf
(
c⁄fig
,

1131 "™Ém±y POST.\n", 
√xèrg
);

1134 
îr
 = 
	`fûe2mem‹y
(&
po°d©a
, &
size
, 
fûe
);

1136 if(
fûe
 && (fûê!
°dö
))

1137 
	`f˛o£
(
fûe
);

1138 if(
îr
)

1139  
îr
;

1142 
	`GëSå
(&
po°d©a
, 
p
);

1143 if(
po°d©a
)

1144 
size
 = 
	`°æí
(
po°d©a
);

1147 if(!
po°d©a
) {

1150 
po°d©a
 = 
	`°rdup
("");

1151 if(!
po°d©a
)

1152  
PARAM_NO_MEM
;

1153 
size
 = 0;

1156 *
íc
 = 
	`cuæ_ósy_esˇ≥
(
c⁄fig
->
ósy
, 
po°d©a
, ()
size
);

1157 
	`Cuæ_ß„‰ì
(
po°d©a
);

1158 if(
íc
) {

1161 
size_t
 
ouéí
 = 
∆í
 + 
	`°æí
(
íc
) + 2;

1162 *
n
 = 
	`mÆloc
(
ouéí
);

1163 if(!
n
) {

1164 
	`cuæ_‰ì
(
íc
);

1165  
PARAM_NO_MEM
;

1167 if(
∆í
 > 0) {

1168 
	`¢¥ötf
(
n
, 
ouéí
, "%.*s=%s", 
∆í
, 
√xèrg
, 
íc
);

1169 
size
 = 
ouéí
-1;

1172 
	`°r˝y
(
n
, 
íc
);

1173 
size
 = 
ouéí
-2;

1175 
	`cuæ_‰ì
(
íc
);

1176 
po°d©a
 = 
n
;

1179  
PARAM_NO_MEM
;

1182 if('@' =*
√xèrg
) {

1185 
√xèrg
++;

1187 if(
	`cuæx_°ªquÆ
("-", 
√xèrg
)) {

1188 
fûe
 = 
°dö
;

1189 if(
subÀâî
 == 'b')

1190 
	`£t_bömode
(
°dö
);

1193 
fûe
 = 
	`f›í
(
√xèrg
, "rb");

1194 if(!
fûe
)

1195 
	`w¨nf
(
c⁄fig
, "Couldn'tÑead data from file \"%s\",Åhis makes "

1196 "™Ém±y POST.\n", 
√xèrg
);

1199 if(
subÀâî
 == 'b')

1201 
îr
 = 
	`fûe2mem‹y
(&
po°d©a
, &
size
, 
fûe
);

1203 
îr
 = 
	`fûe2°rög
(&
po°d©a
, 
fûe
);

1204 if(
po°d©a
)

1205 
size
 = 
	`°æí
(
po°d©a
);

1208 if(
fûe
 && (fûê!
°dö
))

1209 
	`f˛o£
(
fûe
);

1210 if(
îr
)

1211  
îr
;

1213 if(!
po°d©a
) {

1216 
po°d©a
 = 
	`°rdup
("");

1217 if(!
po°d©a
)

1218  
PARAM_NO_MEM
;

1222 
	`GëSå
(&
po°d©a
, 
√xèrg
);

1223 if(
po°d©a
)

1224 
size
 = 
	`°æí
(
po°d©a
);

1227 #ifde‡
CURL_DOES_CONVERSIONS


1228 if(
subÀâî
 != 'b') {

1230 if(
	`c⁄vît_to_√tw‹k
(
po°d©a
, 
	`°æí
(postdata))) {

1231 
	`Cuæ_ß„‰ì
(
po°d©a
);

1232  
PARAM_NO_MEM
;

1237 if(
c⁄fig
->
po°fõlds
) {

1240 *
ﬁdpo°
 = 
c⁄fig
->
po°fõlds
;

1241 
cuæ_off_t
 
ﬁdÀn
 = 
c⁄fig
->
po°fõldsize
;

1242 
cuæ_off_t
 
√wÀn
 = 
ﬁdÀn
 + 
	`cuæx_uztoso
(
size
) + 2;

1243 
c⁄fig
->
po°fõlds
 = 
	`mÆloc
((
size_t
)
√wÀn
);

1244 if(!
c⁄fig
->
po°fõlds
) {

1245 
	`Cuæ_ß„‰ì
(
ﬁdpo°
);

1246 
	`Cuæ_ß„‰ì
(
po°d©a
);

1247  
PARAM_NO_MEM
;

1249 
	`mem˝y
(
c⁄fig
->
po°fõlds
, 
ﬁdpo°
, (
size_t
)
ﬁdÀn
);

1251 
c⁄fig
->
po°fõlds
[
ﬁdÀn
] = '\x26';

1252 
	`mem˝y
(&
c⁄fig
->
po°fõlds
[
ﬁdÀn
+1], 
po°d©a
, 
size
);

1253 
c⁄fig
->
po°fõlds
[
ﬁdÀn
+1+
size
] = '\0';

1254 
	`Cuæ_ß„‰ì
(
ﬁdpo°
);

1255 
	`Cuæ_ß„‰ì
(
po°d©a
);

1256 
c⁄fig
->
po°fõldsize
 +
size
+1;

1259 
c⁄fig
->
po°fõlds
 = 
po°d©a
;

1260 
c⁄fig
->
po°fõldsize
 = 
	`cuæx_uztoso
(
size
);

1275 
	`GëSå
(&
c⁄fig
->
hódîfûe
, 
√xèrg
);

1279 *
±r
 = 
	`°r°r
(
√xèrg
, ";auto");

1280 if(
±r
) {

1283 
c⁄fig
->
aut‹e„ªr
 = 
TRUE
;

1284 *
±r
 = 0;

1287 
c⁄fig
->
aut‹e„ªr
 = 
FALSE
;

1288 
	`GëSå
(&
c⁄fig
->
ª„ªr
, 
√xèrg
);

1292 
subÀâî
) {

1295 
	`GëSå
(&
c⁄fig
->
ˇ˚π
, 
√xèrg
);

1298 
	`GëSå
(&
c⁄fig
->
˚π_ty≥
, 
√xèrg
);

1301 
	`GëSå
(&
c⁄fig
->
key
, 
√xèrg
);

1304 
	`GëSå
(&
c⁄fig
->
key_ty≥
, 
√xèrg
);

1307 
	`GëSå
(&
c⁄fig
->
key_∑sswd
, 
√xèrg
);

1308 
	`˛ó«rg
(
√xèrg
);

1311 
	`GëSå
(&
c⁄fig
->
ígöe
, 
√xèrg
);

1312 if(
c⁄fig
->
ígöe
 && 
	`cuæx_øw_equÆ
(config->engine,"list"))

1313  
PARAM_ENGINES_REQUESTED
;

1317 
	`GëSå
(&
c⁄fig
->
ˇ∑th
, 
√xèrg
);

1320 
	`GëSå
(&
c⁄fig
->
pubkey
, 
√xèrg
);

1323 
	`GëSå
(&
c⁄fig
->
ho°pubmd5
, 
√xèrg
);

1324 if(!
c⁄fig
->
ho°pubmd5
 || 
	`°æí
(config->hostpubmd5) != 32)

1325  
PARAM_BAD_USE
;

1329 
	`GëSå
(&
c⁄fig
->
¸lfûe
, 
√xèrg
);

1332 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_TLSAUTH_SRP
)

1333 
	`GëSå
(&
c⁄fig
->
és_u£∫ame
, 
√xèrg
);

1335  
PARAM_LIBCURL_DOESNT_SUPPORT
;

1338 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_TLSAUTH_SRP
)

1339 
	`GëSå
(&
c⁄fig
->
és_∑ssw‹d
, 
√xèrg
);

1341  
PARAM_LIBCURL_DOESNT_SUPPORT
;

1344 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_TLSAUTH_SRP
) {

1345 
	`GëSå
(&
c⁄fig
->
és_authty≥
, 
√xèrg
);

1346 if(!
	`°ªquÆ
(
c⁄fig
->
és_authty≥
, "SRP"))

1347  
PARAM_LIBCURL_DOESNT_SUPPORT
;

1350  
PARAM_LIBCURL_DOESNT_SUPPORT
;

1353 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_SSL
)

1354 
c⁄fig
->
s¶_Ælow_bó°
 = 
toggÀ
;

1358 
	`GëSå
(&
c⁄fig
->
logö_›ti⁄s
, 
√xèrg
);

1363 *
˚π«me
, *
∑s•hø£
;

1364 
	`∑r£_˚π_∑ømëî
(
√xèrg
, &
˚π«me
, &
∑s•hø£
);

1365 
	`Cuæ_ß„‰ì
(
c⁄fig
->
˚π
);

1366 
c⁄fig
->
˚π
 = 
˚π«me
;

1367 if(
∑s•hø£
) {

1368 
	`Cuæ_ß„‰ì
(
c⁄fig
->
key_∑sswd
);

1369 
c⁄fig
->
key_∑sswd
 = 
∑s•hø£
;

1371 
	`˛ó«rg
(
√xèrg
);

1377 
c⁄fig
->
Áû⁄îr‹
 = 
toggÀ
;

1382 if(
	`f‹m∑r£
(
c⁄fig
,

1383 
√xèrg
,

1384 &
c⁄fig
->
hâµo°
,

1385 &
c⁄fig
->
œ°_po°
,

1386 (
subÀâî
=='s')?
TRUE
:
FALSE
))

1387  
PARAM_BAD_USE
;

1388 if(
	`SëHTTPªque°
(
c⁄fig
, 
HTTPREQ_POST
, &c⁄fig->
hâ¥eq
))

1389  
PARAM_BAD_USE
;

1393 
c⁄fig
->
globoff
 = 
toggÀ
;

1397 
c⁄fig
->
u£_hâpgë
 = 
TRUE
;

1401 if(
toggÀ
) {

1402  
PARAM_HELP_REQUESTED
;

1408 if(
subÀâî
 == 'p')

1409 
îr
 = 
	`add2li°
(&
c⁄fig
->
¥oxyhódîs
, 
√xèrg
);

1411 
îr
 = 
	`add2li°
(&
c⁄fig
->
hódîs
, 
√xèrg
);

1412 if(
îr
)

1413  
îr
;

1416 
c⁄fig
->
ö˛ude_hódîs
 = 
toggÀ
;

1420 
c⁄fig
->
cookõ£ssi⁄
 = 
toggÀ
;

1426 
c⁄fig
->
no_body
 = 
toggÀ
;

1427 if(
	`SëHTTPªque°
(
c⁄fig
,

1428 (
c⁄fig
->
no_body
)?
HTTPREQ_HEAD
:
HTTPREQ_GET
,

1429 &
c⁄fig
->
hâ¥eq
))

1430  
PARAM_BAD_USE
;

1433 if(
c⁄fig
->
ö˛ude_hódîs
) {

1434 
	`w¨nf
(
c⁄fig
,

1436  
PARAM_BAD_USE
;

1438 
c⁄fig
->
c⁄ã¡_di•osôi⁄
 = 
toggÀ
;

1441 
c⁄fig
->
ö£cuª_ok
 = 
toggÀ
;

1444 if(
	`∑r£c⁄fig
(
√xèrg
, 
globÆ
))

1445 
	`w¨nf
(
c⁄fig
, "errorÅryingÑead config fromÅhe '%s' file\n",

1446 
√xèrg
);

1449 
c⁄fig
->
dúli°⁄ly
 = 
toggÀ
;

1452 
c⁄fig
->
fﬁlowloˇti⁄
 = 
toggÀ
;

1453 
subÀâî
) {

1457 
c⁄fig
->
uƒe°ri˘ed_auth
 = 
toggÀ
;

1463 
îr
 = 
	`°r2udoubÀ
(&
c⁄fig
->
timeout
, 
√xèrg
);

1464 if(
îr
)

1465  
îr
;

1468 if(
toggÀ
) {

1469 #ifde‡
USE_MANUAL


1470  
PARAM_MANUAL_REQUESTED
;

1472 
	`w¨nf
(
c⁄fig
,

1474  
PARAM_OPTION_UNKNOWN
;

1479 
subÀâî
) {

1482 
c⁄fig
->
√åc_›t
 = 
toggÀ
;

1485 
	`GëSå
(&
c⁄fig
->
√åc_fûe
, 
√xèrg
);

1490 
c⁄fig
->
√åc
 = 
toggÀ
;

1497 if(
l⁄g›t
)

1498 
c⁄fig
->
nobuf„r
 = (!
toggÀ
)?
TRUE
:
FALSE
;

1500 
c⁄fig
->
nobuf„r
 = 
toggÀ
;

1503 if(
subÀâî
 == 'a') {

1504 
c⁄fig
->
deÁu…_node_Êags
 = 
toggÀ
?
GETOUT_USEREMOTE
:0;

1511 
gëout
 *
uæ
;

1512 if(
c⁄fig
->
uæ_out
 || ((c⁄fig->uæ_ouàc⁄fig->
uæ_li°
Ë!
NULL
)) {

1515 
c⁄fig
->
uæ_out
 && (c⁄fig->uæ_out->
Êags
 & 
GETOUT_OUTFILE
))

1516 
c⁄fig
->
uæ_out
 = c⁄fig->uæ_out->
√xt
;

1521 if(
c⁄fig
->
uæ_out
)

1523 
uæ
 = 
c⁄fig
->
uæ_out
;

1526 
uæ
 = 
	`√w_gëout
(
c⁄fig
);

1528 if(!
uæ
)

1529  
PARAM_NO_MEM
;

1532 if('o' =
Àâî
) {

1533 
	`GëSå
(&
uæ
->
outfûe
, 
√xèrg
);

1534 
uæ
->
Êags
 &~
GETOUT_USEREMOTE
;

1537 
uæ
->
outfûe
 = 
NULL
;

1538 if(
toggÀ
)

1539 
uæ
->
Êags
 |
GETOUT_USEREMOTE
;

1541 
uæ
->
Êags
 &~
GETOUT_USEREMOTE
;

1543 
uæ
->
Êags
 |
GETOUT_OUTFILE
;

1553 
	`GëSå
(&
c⁄fig
->
·µ‹t
, 
√xèrg
);

1557 
c⁄fig
->
¥oxytu¬ñ
 = 
toggÀ
;

1565 
√xèrg
[0]) {

1568 
√xèrg
++;

1569 
îr
 = 
	`add2li°
(&
c⁄fig
->
po°quŸe
, 
√xèrg
);

1573 
√xèrg
++;

1574 
îr
 = 
	`add2li°
(&
c⁄fig
->
¥equŸe
, 
√xèrg
);

1577 
îr
 = 
	`add2li°
(&
c⁄fig
->
quŸe
, 
√xèrg
);

1580 if(
îr
)

1581  
îr
;

1588 if(
	`ISDIGIT
(*
√xèrg
Ë&& !
	`°rchr
(nextarg, '-')) {

1589 
buf„r
[32];

1590 
cuæ_off_t
 
off
;

1591 
	`w¨nf
(
c⁄fig
,

1594 
off
 = 
	`cuæx_°πoof·
(
√xèrg
, 
NULL
, 10);

1595 
	`¢¥ötf
(
buf„r
, (buf„r), "%" 
CURL_FORMAT_CURL_OFF_T
 "-", 
off
);

1596 
	`Cuæ_ß„‰ì
(
c⁄fig
->
ønge
);

1597 
c⁄fig
->
ønge
 = 
	`°rdup
(
buf„r
);

1598 if(!
c⁄fig
->
ønge
)

1599  
PARAM_NO_MEM
;

1603 *
tmp_ønge
;

1604 
tmp_ønge
 = 
√xèrg
;

1605 *
tmp_ønge
 != '\0') {

1606 if(!
	`ISDIGIT
(*
tmp_ønge
) && *tmp_range != '-' && *tmp_range != ',') {

1607 
	`w¨nf
(
c⁄fig
,"Invalid character is found in givenÑange. "

1613 
tmp_ønge
++;

1616 
	`GëSå
(&
c⁄fig
->
ønge
, 
√xèrg
);

1621 
c⁄fig
->
ªmŸe_time
 = 
toggÀ
;

1625 if(
toggÀ
)

1626 
globÆ
->
muã
 = globÆ->
n›rogªss
 = 
TRUE
;

1628 
globÆ
->
muã
 = globÆ->
n›rogªss
 = 
FALSE
;

1629 if(
globÆ
->
showîr‹
 < 0)

1633 
globÆ
->
showîr‹
 = (!
toggÀ
)?
TRUE
:
FALSE
;

1637 
globÆ
->
showîr‹
 = 
toggÀ
?1:0;

1641 
îr
 = 
	`add2li°
(&
c⁄fig
->
ã ë_›ti⁄s
, 
√xèrg
);

1642 if(
îr
)

1643  
îr
;

1648 
gëout
 *
uæ
;

1649 if(
c⁄fig
->
uæ_out
 || ((c⁄fig->uæ_ouàc⁄fig->
uæ_li°
Ë!
NULL
)) {

1652 
c⁄fig
->
uæ_out
 && (c⁄fig->uæ_out->
Êags
 & 
GETOUT_UPLOAD
))

1653 
c⁄fig
->
uæ_out
 = c⁄fig->uæ_out->
√xt
;

1658 if(
c⁄fig
->
uæ_out
)

1660 
uæ
 = 
c⁄fig
->
uæ_out
;

1663 
uæ
 = 
	`√w_gëout
(
c⁄fig
);

1665 if(!
uæ
)

1666  
PARAM_NO_MEM
;

1668 
uæ
->
Êags
 |
GETOUT_UPLOAD
;

1669 if(!*
√xèrg
)

1670 
uæ
->
Êags
 |
GETOUT_NOUPLOAD
;

1673 
	`GëSå
(&
uæ
->
öfûe
, 
√xèrg
);

1680 
	`GëSå
(&
c⁄fig
->
u£Ωwd
, 
√xèrg
);

1681 
	`˛ó«rg
(
√xèrg
);

1685 
	`GëSå
(&
c⁄fig
->
¥oxyu£Ωwd
, 
√xèrg
);

1686 
	`˛ó«rg
(
√xèrg
);

1689 if(
toggÀ
) {

1691 
	`Cuæ_ß„‰ì
(
globÆ
->
åa˚_dump
);

1692 
globÆ
->
åa˚_dump
 = 
	`°rdup
("%");

1693 if(!
globÆ
->
åa˚_dump
)

1694  
PARAM_NO_MEM
;

1695 if(
globÆ
->
åa˚ty≥
 && (globÆ->åa˚ty≥ !
TRACE_PLAIN
))

1696 
	`w¨nf
(
c⁄fig
,

1698 
globÆ
->
åa˚ty≥
 = 
TRACE_PLAIN
;

1702 
globÆ
->
åa˚ty≥
 = 
TRACE_NONE
;

1705 if(
toggÀ
)

1706  
PARAM_VERSION_INFO_REQUESTED
;

1711 if('@' =*
√xèrg
) {

1714 
FILE
 *
fûe
;

1715 c⁄° *
‚ame
;

1716 
√xèrg
++;

1717 if(
	`cuæx_°ªquÆ
("-", 
√xèrg
)) {

1718 
‚ame
 = "<stdin>";

1719 
fûe
 = 
°dö
;

1722 
‚ame
 = 
√xèrg
;

1723 
fûe
 = 
	`f›í
(
√xèrg
, "r");

1725 
îr
 = 
	`fûe2°rög
(&
c⁄fig
->
wrôeout
, 
fûe
);

1726 if(
fûe
 && (fûê!
°dö
))

1727 
	`f˛o£
(
fûe
);

1728 if(
îr
)

1729  
îr
;

1730 if(!
c⁄fig
->
wrôeout
)

1731 
	`w¨nf
(
c⁄fig
, "FaûedÅÿªad %s", 
‚ame
);

1734 
	`GëSå
(&
c⁄fig
->
wrôeout
, 
√xèrg
);

1738 
	`GëSå
(&
c⁄fig
->
¥oxy
, 
√xèrg
);

1739 
c⁄fig
->
¥oxyvî
 = 
CURLPROXY_HTTP
;

1743 
	`GëSå
(&
c⁄fig
->
cu°omªque°
, 
√xèrg
);

1747 
îr
 = 
	`°r2unum
(&
c⁄fig
->
low_•ìd_time
, 
√xèrg
);

1748 if(
îr
)

1749  
îr
;

1750 if(!
c⁄fig
->
low_•ìd_limô
)

1751 
c⁄fig
->
low_•ìd_limô
 = 1;

1755 
îr
 = 
	`°r2unum
(&
c⁄fig
->
low_•ìd_limô
, 
√xèrg
);

1756 if(
îr
)

1757  
îr
;

1758 if(!
c⁄fig
->
low_•ìd_time
)

1759 
c⁄fig
->
low_•ìd_time
 = 30;

1762 *
√xèrg
) {

1764 
√xèrg
++;

1767 
c⁄fig
->
timec⁄d
 = 
CURL_TIMECOND_IFMODSINCE
;

1771 
c⁄fig
->
timec⁄d
 = 
CURL_TIMECOND_IFUNMODSINCE
;

1772 
√xèrg
++;

1776 
c⁄fig
->
timec⁄d
 = 
CURL_TIMECOND_LASTMOD
;

1777 
√xèrg
++;

1780 
now
 = 
	`time
(
NULL
);

1781 
c⁄fig
->
c⁄dtime
=
	`cuæ_gëd©e
(
√xèrg
, &
now
);

1782 if(-1 =()
c⁄fig
->
c⁄dtime
) {

1784 
°ru˘_°©
 
°©buf
;

1785 if(-1 =
	`°©
(
√xèrg
, &
°©buf
)) {

1787 
c⁄fig
->
timec⁄d
 = 
CURL_TIMECOND_NONE
;

1788 
	`w¨nf
(
c⁄fig
,

1795 
c⁄fig
->
c⁄dtime
 = 
°©buf
.
°_mtime
;

1800  
PARAM_OPTION_UNKNOWN
;

1802 
hô
 = -1;

1804 } !
l⁄g›t
 && !
sögÀ›t
 && *++
∑r£
 && !*
u£d¨g
);

1806  
PARAM_OK
;

1807 
	}
}

1809 
P¨amëîEº‹
 
	$∑r£_¨gs
(
GlobÆC⁄fig
 *
c⁄fig
, 
¨gc
,

1810 
¨gv_ôem_t
 
¨gv
[])

1812 
i
;

1813 
boﬁ
 
°ûlÊags
;

1814 *
‹ig_›t
;

1815 
P¨amëîEº‹
 
ªsu…
 = 
PARAM_OK
;

1816 
O≥øti⁄C⁄fig
 *
›î©i⁄
 = 
c⁄fig
->
fú°
;

1818 
i
 = 1, 
°ûlÊags
 = 
TRUE
; i < 
¨gc
 && !
ªsu…
; i++) {

1819 
‹ig_›t
 = 
¨gv
[
i
];

1821 if(
°ûlÊags
 && ('-' =
¨gv
[
i
][0])) {

1822 *
√xèrg
;

1823 
boﬁ
 
∑sßrg
;

1824 *
Êag
 = 
¨gv
[
i
];

1826 if(
	`cuæx_°ªquÆ
("--", 
¨gv
[
i
]))

1829 
°ûlÊags
 = 
FALSE
;

1831 
√xèrg
 = (
i
 < (
¨gc
 - 1)Ë? 
¨gv
[ò+ 1] : 
NULL
;

1833 
ªsu…
 = 
	`gë∑ømëî
(
Êag
, 
√xèrg
, &
∑sßrg
, 
c⁄fig
, 
›î©i⁄
);

1834 if(
ªsu…
 =
PARAM_NEXT_OPERATION
) {

1837 
ªsu…
 = 
PARAM_OK
;

1839 if(
›î©i⁄
->
uæ_li°
 && o≥øti⁄->uæ_li°->
uæ
) {

1841 
›î©i⁄
->
√xt
 = 
	`mÆloc
((
O≥øti⁄C⁄fig
));

1842 if(
›î©i⁄
->
√xt
) {

1844 
	`c⁄fig_öô
(
›î©i⁄
->
√xt
);

1847 
›î©i⁄
->
√xt
->
ósy
 = 
c⁄fig
->easy;

1850 
›î©i⁄
->
√xt
->
globÆ
 = 
c⁄fig
;

1853 
c⁄fig
->
œ°
 = 
›î©i⁄
->
√xt
;

1856 
›î©i⁄
->
√xt
->
¥ev
 = operation;

1857 
›î©i⁄
 = o≥øti⁄->
√xt
;

1860 
ªsu…
 = 
PARAM_NO_MEM
;

1863 if(!
ªsu…
 && 
∑sßrg
)

1864 
i
++;

1868 
boﬁ
 
u£d
;

1871 
ªsu…
 = 
	`gë∑ømëî
((*)"--uæ", 
¨gv
[
i
], &
u£d
, 
c⁄fig
,

1872 
›î©i⁄
);

1876 if(
ªsu…
 &&Ñesu… !
PARAM_HELP_REQUESTED
 &&

1877 
ªsu…
 !
PARAM_MANUAL_REQUESTED
 &&

1878 
ªsu…
 !
PARAM_VERSION_INFO_REQUESTED
 &&

1879 
ªsu…
 !
PARAM_ENGINES_REQUESTED
) {

1880 c⁄° *
ªas⁄
 = 
	`∑øm2ãxt
(
ªsu…
);

1882 if(!
	`cuæx_°ªquÆ
(":", 
‹ig_›t
))

1883 
	`hñpf
(
c⁄fig
->
îr‹s
, "›ti⁄ %s: %s\n", 
‹ig_›t
, 
ªas⁄
);

1885 
	`hñpf
(
c⁄fig
->
îr‹s
, "%s\n", 
ªas⁄
);

1888  
ªsu…
;

1889 
	}
}

	@src/tool_getparam.h

1 #i‚de‡
HEADER_CURL_TOOL_GETPARAM_H


2 
	#HEADER_CURL_TOOL_GETPARAM_H


	)

24 
	~"toﬁ_£tup.h
"

27 
	mPARAM_OK
 = 0,

28 
	mPARAM_OPTION_AMBIGUOUS
,

29 
	mPARAM_OPTION_UNKNOWN
,

30 
	mPARAM_REQUIRES_PARAMETER
,

31 
	mPARAM_BAD_USE
,

32 
	mPARAM_HELP_REQUESTED
,

33 
	mPARAM_MANUAL_REQUESTED
,

34 
	mPARAM_VERSION_INFO_REQUESTED
,

35 
	mPARAM_ENGINES_REQUESTED
,

36 
	mPARAM_GOT_EXTRA_PARAMETER
,

37 
	mPARAM_BAD_NUMERIC
,

38 
	mPARAM_NEGATIVE_NUMERIC
,

39 
	mPARAM_LIBCURL_DOESNT_SUPPORT
,

40 
	mPARAM_NO_MEM
,

41 
	mPARAM_NEXT_OPERATION
,

42 
	mPARAM_LAST


43 } 
	tP¨amëîEº‹
;

45 
	gGlobÆC⁄fig
;

46 
	gO≥øti⁄C⁄fig
;

48 
P¨amëîEº‹
 
gë∑ømëî
(*
Êag
, *
√xèrg
, 
boﬁ
 *
u£d¨g
,

49 
GlobÆC⁄fig
 *
globÆ
,

50 
O≥øti⁄C⁄fig
 *
›î©i⁄
);

52 #ifde‡
UNITTESTS


53 
∑r£_˚π_∑ømëî
(c⁄° *
˚π_∑ømëî
,

54 **
˚π«me
,

55 **
∑s•hø£
);

58 
P¨amëîEº‹
 
∑r£_¨gs
(
GlobÆC⁄fig
 *
c⁄fig
, 
¨gc
,

59 
¨gv_ôem_t
 
¨gv
[]);

	@src/tool_getpass.c

22 
	~"toﬁ_£tup.h
"

24 #i‚de‡
HAVE_GETPASS_R


27 #ifde‡
HAVE_FCNTL_H


28 
	~<f˙é.h
>

31 #ifde‡
HAVE_TERMIOS_H


32 
	~<ãrmios.h
>

33 #ñi‡
deföed
(
HAVE_TERMIO_H
)

34 
	~<ãrmio.h
>

37 #ifde‡
__VMS


38 #ö˛udê
des¸ù


39 #ö˛udê
°¨Àt


40 #ö˛udê
iodef


43 #ifde‡
WIN32


44 
	~<c⁄io.h
>

47 #ifde‡
NETWARE


48 #ifde‡
__NOVELL_LIBC__


49 
	~<s¸ìn.h
>

51 
	~<nwc⁄io.h
>

55 
	#_MPRINTF_REPLACE


	)

56 
	~<cuæ/m¥ötf.h
>

58 
	~"toﬁ_gë∑ss.h
"

60 
	~"memdebug.h
"

62 #ifde‡
__VMS


64 *
	$gë∑ss_r
(c⁄° *
¥om±
, *
buf„r
, 
size_t
 
buÊí
)

66 
°s
;

67 
ch™
;

72 
	s_iosb


74 
iosb$w_°©us
;

75 
iosb$w_b˙t
;

76 
unu£d
;

77 } 
iosb
;

79 
	`$DESCRIPTOR
(
âdesc
, "TT");

81 
buf„r
[0] = '\0';

82 
°s
 = 
	`sys$assign
(&
âdesc
, &
ch™
, 0, 0);

83 if(
°s
 & 1) {

84 
°s
 = 
	`sys$qiow
(0, 
ch™
,

85 
IO$_READPROMPT
 | 
IO$M_NOECHO
,

86 &
iosb
, 0, 0, 
buf„r
, 
buÊí
, 0, 0,

87 
¥om±
, 
	`°æí
(prompt));

89 if((
°s
 & 1Ë&& (
iosb
.
iosb$w_°©us
 & 1))

90 
buf„r
[
iosb
.
iosb$w_b˙t
] = '\0';

92 
°s
 = 
	`sys$dassgn
(
ch™
);

94  
buf„r
;

95 
	}
}

96 
	#DONE


	)

99 #ifde‡
__SYMBIAN32__


100 
	#gëch
(Ë
	`gëch¨
()

	)

103 #i‡
deföed
(
WIN32
Ë|| deföed(
__SYMBIAN32__
)

105 *
	$gë∑ss_r
(c⁄° *
¥om±
, *
buf„r
, 
size_t
 
buÊí
)

107 
size_t
 
i
;

108 
	`Âuts
(
¥om±
, 
°dîr
);

110 
i
 = 0; i < 
buÊí
; i++) {

111 
buf„r
[
i
] = ()
	`gëch
();

112 if(
buf„r
[
i
] == '\r' || buffer[i] == '\n') {

113 
buf„r
[
i
] = '\0';

117 if(
buf„r
[
i
] == '\b')

120 
i
 = i - (i >= 1 ? 2 : 1);

122 #i‚de‡
__SYMBIAN32__


124 
	`Âuts
("\n", 
°dîr
);

127 if(
i
 =
buÊí
)

128 
buf„r
[
buÊí
-1] = '\0';

130  
buf„r
;

131 
	}
}

132 
	#DONE


	)

135 #ifde‡
NETWARE


137 #ifde‡
__NOVELL_LIBC__


138 *
	$gë∑ss_r
(c⁄° *
¥om±
, *
buf„r
, 
size_t
 
buÊí
)

140  
	`gë∑ssw‹d
(
¥om±
, 
buf„r
, 
buÊí
);

141 
	}
}

143 *
	$gë∑ss_r
(c⁄° *
¥om±
, *
buf„r
, 
size_t
 
buÊí
)

145 
size_t
 
i
 = 0;

147 
	`¥ötf
("%s", 
¥om±
);

149 
buf„r
[
i
++] = 
	`gëch
();

150 if(
buf„r
[
i
-1] == '\b') {

153 if(
i
 > 1) {

154 
	`¥ötf
("\b \b");

155 
i
 = i - 2;

158 
	`RögTheBñl
();

159 
i
 = i - 1;

162 if(
buf„r
[
i
-1] != 13)

163 
	`putch¨
('*');

165 } (
buf„r
[
i
-1] !13Ë&& (ò< 
buÊí
));

166 
buf„r
[
i
-1] = '\0';

167 
	`¥ötf
("\r\n");

168  
buf„r
;

169 
	}
}

171 
	#DONE


	)

174 #i‚de‡
DONE


176 #ifde‡
HAVE_TERMIOS_H


177 
	#°ru˘_ãrm
 
ãrmios


	)

178 #ñi‡
deföed
(
HAVE_TERMIO_H
)

179 
	#°ru˘_ãrm
 
ãrmio


	)

181 #unde‡
°ru˘_ãrm


184 
boﬁ
 
	$âyecho
(
boﬁ
 
íabÀ
, 
fd
)

186 #ifde‡
°ru˘_ãrm


187 
°ru˘_ãrm
 
wôhecho
;

188 
°ru˘_ãrm
 
n€cho
;

190 if(!
íabÀ
) {

193 #ifde‡
HAVE_TERMIOS_H


194 
	`tcgë©å
(
fd
, &
wôhecho
);

195 
n€cho
 = 
wôhecho
;

196 
n€cho
.
c_lÊag
 &~
ECHO
;

197 
	`tc£èâr
(
fd
, 
TCSANOW
, &
n€cho
);

198 #ñi‡
	`deföed
(
HAVE_TERMIO_H
)

199 
	`io˘l
(
fd
, 
TCGETA
, &
wôhecho
);

200 
n€cho
 = 
wôhecho
;

201 
n€cho
.
c_lÊag
 &~
ECHO
;

202 
	`io˘l
(
fd
, 
TCSETA
, &
n€cho
);

205 ()
fd
;

206  
FALSE
;

208  
TRUE
;

213 #ifde‡
HAVE_TERMIOS_H


214 
	`tc£èâr
(
fd
, 
TCSAFLUSH
, &
wôhecho
);

215 #ñi‡
	`deföed
(
HAVE_TERMIO_H
)

216 
	`io˘l
(
fd
, 
TCSETA
, &
wôhecho
);

218  
FALSE
;

220  
TRUE
;

222 
	}
}

224 *
	$gë∑ss_r
(c⁄° *
¥om±
,

225 *
∑ssw‹d
,

226 
size_t
 
buÊí
)

228 
ssize_t
 
ƒód
;

229 
boﬁ
 
dißbÀd
;

230 
fd
 = 
	`›í
("/dev/ây", 
O_RDONLY
);

231 if(-1 =
fd
)

232 
fd
 = 1;

234 
dißbÀd
 = 
	`âyecho
(
FALSE
, 
fd
);

236 
	`Âuts
(
¥om±
, 
°dîr
);

237 
ƒód
 = 
	`ªad
(
fd
, 
∑ssw‹d
, 
buÊí
);

238 if(
ƒód
 > 0)

239 
∑ssw‹d
[--
ƒód
] = '\0';

241 
∑ssw‹d
[0] = '\0';

243 if(
dißbÀd
) {

245 
	`Âuts
("\n", 
°dîr
);

246 ()
	`âyecho
(
TRUE
, 
fd
);

249 if(1 !
fd
)

250 
	`˛o£
(
fd
);

252  
∑ssw‹d
;

253 
	}
}

	@src/tool_getpass.h

1 #i‚de‡
HEADER_CURL_TOOL_GETPASS_H


2 
	#HEADER_CURL_TOOL_GETPASS_H


	)

24 
	~"toﬁ_£tup.h
"

26 #i‚de‡
HAVE_GETPASS_R


33 * 
gë∑ss_r
(c⁄° *
¥om±
, * 
buf„r
, 
size_t
 
buÊí
);

	@src/tool_help.c

22 
	~"toﬁ_£tup.h
"

24 
	~"toﬁ_∑nykey.h
"

25 
	~"toﬁ_hñp.h
"

26 
	~"toﬁ_liböfo.h
"

27 
	~"toﬁ_vîsi⁄.h
"

29 
	~"memdebug.h
"

31 #ifde‡
MSDOS


32 
	#USE_WATT32


	)

46 c⁄° *c⁄° 
	ghñ±ext
[] = {

81 #ifde‡
USE_ENVIRONMENT


121 #i‚de‡
CURL_DISABLE_LIBCURL_OPTION


199 #i‡
deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

235 #ifde‡
USE_WATT32


241 
NULL


244 #ifde‡
NETWARE


245 
	#PRINT_LINES_PAUSE
 23

	)

248 #ifde‡
__SYMBIAN32__


249 
	#PRINT_LINES_PAUSE
 16

	)

252 
	s„©
 {

253 c⁄° *
	m«me
;

254 
	mbômask
;

257 c⁄° 
„©
 
	g„©s
[] = {

258 {"AsynchDNS", 
CURL_VERSION_ASYNCHDNS
},

259 {"Debug", 
CURL_VERSION_DEBUG
},

260 {"TøckMem‹y", 
CURL_VERSION_CURLDEBUG
},

261 {"GSS-NegŸüã", 
CURL_VERSION_GSSNEGOTIATE
},

262 {"IDN", 
CURL_VERSION_IDN
},

263 {"IPv6", 
CURL_VERSION_IPV6
},

264 {"L¨gefûe", 
CURL_VERSION_LARGEFILE
},

265 {"NTLM", 
CURL_VERSION_NTLM
},

266 {"NTLM_WB", 
CURL_VERSION_NTLM_WB
},

267 {"SPNEGO", 
CURL_VERSION_SPNEGO
},

268 {"SSL", 
CURL_VERSION_SSL
},

269 {"SSPI", 
CURL_VERSION_SSPI
},

270 {"krb4", 
CURL_VERSION_KERBEROS4
},

271 {"libz", 
CURL_VERSION_LIBZ
},

272 {"Ch¨C⁄v", 
CURL_VERSION_CONV
},

273 {"TLS-SRP", 
CURL_VERSION_TLSAUTH_SRP
},

274 {"HTTP2", 
CURL_VERSION_HTTP2
}

277 
	$toﬁ_hñp
()

279 
i
;

280 
i
 = 0; 
hñ±ext
[i]; i++) {

281 
	`puts
(
hñ±ext
[
i
]);

282 #ifde‡
PRINT_LINES_PAUSE


283 if(
i
 && ((ò% 
PRINT_LINES_PAUSE
) == 0))

284 
	`toﬁ_¥esßnykey
();

287 
	}
}

289 
	$toﬁ_vîsi⁄_öfo
()

291 c⁄° *c⁄° *
¥Ÿo
;

293 
	`¥ötf
(
CURL_ID
 "%s\n", 
	`cuæ_vîsi⁄
());

294 if(
cuæöfo
->
¥Ÿocﬁs
) {

295 
	`¥ötf
("Protocols: ");

296 
¥Ÿo
 = 
cuæöfo
->
¥Ÿocﬁs
; *proto; ++proto) {

297 
	`¥ötf
("%†", *
¥Ÿo
);

299 
	`puts
("");

301 if(
cuæöfo
->
„©uªs
) {

302 
i
;

303 
	`¥ötf
("Features: ");

304 
i
 = 0; i < (
„©s
)/(feats[0]); i++) {

305 if(
cuæöfo
->
„©uªs
 & 
„©s
[
i
].
bômask
)

306 
	`¥ötf
("%†", 
„©s
[
i
].
«me
);

308 #ifde‡
USE_METALINK


309 
	`¥ötf
("Metalink ");

311 
	`puts
("");

313 
	}
}

315 
	$toﬁ_li°_ígöes
(
CURL
 *
cuæ
)

317 
cuæ_¶i°
 *
ígöes
 = 
NULL
;

320 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_SSL_ENGINES
, &
ígöes
);

322 
	`puts
("Build-timeÉngines:");

323 if(
ígöes
) {

324 ; 
ígöes
;Éngöe†ígöes->
√xt
)

325 
	`¥ötf
(" %s\n", 
ígöes
->
d©a
);

328 
	`puts
(" <none>");

332 
	`cuæ_¶i°_‰ì_Æl
(
ígöes
);

333 
	}
}

	@src/tool_help.h

1 #i‚de‡
HEADER_CURL_TOOL_HELP_H


2 
	#HEADER_CURL_TOOL_HELP_H


	)

24 
	~"toﬁ_£tup.h
"

26 
toﬁ_hñp
();

27 
toﬁ_li°_ígöes
(
CURL
 *
cuæ
);

28 
toﬁ_vîsi⁄_öfo
();

	@src/tool_helpers.c

22 
	~"toﬁ_£tup.h
"

24 
	~"øw°r.h
"

26 
	#ENABLE_CURLX_PRINTF


	)

28 
	~"cuæx.h
"

30 
	~"toﬁ_cfgabÀ.h
"

31 
	~"toﬁ_msgs.h
"

32 
	~"toﬁ_gë∑øm.h
"

33 
	~"toﬁ_hñ≥rs.h
"

35 
	~"memdebug.h
"

41 c⁄° *
	$∑øm2ãxt
(
ªs
)

43 
P¨amëîEº‹
 
îr‹
 = (P¨amëîEº‹)
ªs
;

44 
îr‹
) {

45 
PARAM_GOT_EXTRA_PARAMETER
:

47 
PARAM_OPTION_UNKNOWN
:

49 
PARAM_OPTION_AMBIGUOUS
:

51 
PARAM_REQUIRES_PARAMETER
:

53 
PARAM_BAD_USE
:

55 
PARAM_BAD_NUMERIC
:

57 
PARAM_NEGATIVE_NUMERIC
:

59 
PARAM_LIBCURL_DOESNT_SUPPORT
:

61 
PARAM_NO_MEM
:

66 
	}
}

68 
	$SëHTTPªque°
(
O≥øti⁄C⁄fig
 *
c⁄fig
, 
HâpReq
 
ªq
, HâpReq *
°‹e
)

70 if((*
°‹e
 =
HTTPREQ_UNSPEC
) ||

71 (*
°‹e
 =
ªq
)) {

72 *
°‹e
 = 
ªq
;

75 
	`w¨nf
(
c⁄fig
, "You can only select one HTTPÑequest!\n");

77 
	}
}

	@src/tool_helpers.h

1 #i‚de‡
HEADER_CURL_TOOL_HELPERS_H


2 
	#HEADER_CURL_TOOL_HELPERS_H


	)

24 
	~"toﬁ_£tup.h
"

26 c⁄° *
∑øm2ãxt
(
ªs
);

28 
SëHTTPªque°
(
O≥øti⁄C⁄fig
 *
c⁄fig
, 
HâpReq
 
ªq
,

29 
HâpReq
 *
°‹e
);

	@src/tool_homedir.c

22 
	~"toﬁ_£tup.h
"

24 #ifde‡
HAVE_PWD_H


25 
	~<pwd.h
>

28 
	~"toﬁ_homedú.h
"

30 
	~"memdebug.h
"

32 *
	$GëEnv
(c⁄° *
v¨übÀ
, 
do_ex∑nd
)

34 *
ív
 = 
NULL
;

35 #ifde‡
WIN32


36 
buf1
[1024], 
buf2
[1024];

37 
DWORD
 
rc
;

42 
rc
 = 
	`GëEnvú⁄mítV¨übÀ
(
v¨übÀ
, 
buf1
, (buf1));

43 if(
rc
 > 0 &&Ñ¯< (
buf1
)) {

44 
ív
 = 
buf1
;

45 
v¨übÀ
 = 
buf1
;

47 if(
do_ex∑nd
 && 
	`°rchr
(
v¨übÀ
,'%')) {

49 
rc
 = 
	`Ex∑ndEnvú⁄mítSåögs
 (
v¨übÀ
, 
buf2
, (buf2));

50 if(
rc
 > 0 &&Ñ¯< (
buf2
) &&

51 !
	`°rchr
(
buf2
,'%'))

52 
ív
 = 
buf2
;

55 ()
do_ex∑nd
;

57 
ív
 = 
	`gëív
(
v¨übÀ
);

59  (
ív
 &&Énv[0]Ë? 
	`°rdup
”nvË: 
NULL
;

60 
	}
}

63 *
	$homedú
()

65 *
home
;

67 
home
 = 
	`GëEnv
("CURL_HOME", 
FALSE
);

68 if(
home
)

69  
home
;

71 
home
 = 
	`GëEnv
("HOME", 
FALSE
);

72 if(
home
)

73  
home
;

75 #i‡
	`deföed
(
HAVE_GETPWUID
Ë&& deföed(
HAVE_GETEUID
)

77 
∑sswd
 *
pw
 = 
	`gëpwuid
(
	`gëeuid
());

79 if(
pw
) {

80 
home
 = 
pw
->
pw_dú
;

81 if(
home
 && home[0])

82 
home
 = 
	`°rdup
(home);

84 
home
 = 
NULL
;

88 #ifde‡
WIN32


89 
home
 = 
	`GëEnv
("APPDATA", 
TRUE
);

90 if(!
home
)

91 
home
 = 
	`GëEnv
("%USERPROFILE%\\Aµliˇti⁄ D©a", 
TRUE
);

94  
home
;

95 
	}
}

	@src/tool_homedir.h

1 #i‚de‡
HEADER_CURL_TOOL_HOMEDIR_H


2 
	#HEADER_CURL_TOOL_HOMEDIR_H


	)

24 
	~"toﬁ_£tup.h
"

26 *
homedú
();

	@src/tool_hugehelp.c

1 
	~"toﬁ_£tup.h
"

2 #i‚de‡
HAVE_LIBZ


7 #ifde‡
USE_MANUAL


8 
	~"toﬁ_hugehñp.h
"

9 
	$hugehñp
()

11 
	`Âuts
(

27 , 
°dout
);

28 
	`Âuts
(

38 , 
°dout
);

39 
	`Âuts
(

55 , 
°dout
);

56 
	`Âuts
(

68 , 
°dout
);

69 
	`Âuts
(

79 , 
°dout
);

80 
	`Âuts
(

90 , 
°dout
);

91 
	`Âuts
(

102 , 
°dout
);

103 
	`Âuts
(

113 , 
°dout
);

114 
	`Âuts
(

125 , 
°dout
);

126 
	`Âuts
(

135 , 
°dout
);

136 
	`Âuts
(

145 , 
°dout
);

146 
	`Âuts
(

157 , 
°dout
);

158 
	`Âuts
(

172 , 
°dout
);

173 
	`Âuts
(

183 , 
°dout
);

184 
	`Âuts
(

194 , 
°dout
);

195 
	`Âuts
(

208 , 
°dout
);

209 
	`Âuts
(

220 , 
°dout
);

221 
	`Âuts
(

230 , 
°dout
);

231 
	`Âuts
(

241 , 
°dout
);

242 
	`Âuts
(

250 , 
°dout
);

251 
	`Âuts
(

260 , 
°dout
);

261 
	`Âuts
(

269 , 
°dout
);

270 
	`Âuts
(

278 , 
°dout
);

279 
	`Âuts
(

291 , 
°dout
);

292 
	`Âuts
(

301 , 
°dout
);

302 
	`Âuts
(

310 , 
°dout
);

311 
	`Âuts
(

320 , 
°dout
);

321 
	`Âuts
(

330 , 
°dout
);

331 
	`Âuts
(

342 , 
°dout
);

343 
	`Âuts
(

351 , 
°dout
);

352 
	`Âuts
(

364 , 
°dout
);

365 
	`Âuts
(

373 , 
°dout
);

374 
	`Âuts
(

384 , 
°dout
);

385 
	`Âuts
(

398 , 
°dout
);

399 
	`Âuts
(

408 , 
°dout
);

409 
	`Âuts
(

417 , 
°dout
);

418 
	`Âuts
(

426 , 
°dout
);

427 
	`Âuts
(

437 , 
°dout
);

438 
	`Âuts
(

452 , 
°dout
);

453 
	`Âuts
(

465 , 
°dout
);

466 
	`Âuts
(

475 , 
°dout
);

476 
	`Âuts
(

486 , 
°dout
);

487 
	`Âuts
(

498 , 
°dout
);

499 
	`Âuts
(

508 , 
°dout
);

509 
	`Âuts
(

522 , 
°dout
);

523 
	`Âuts
(

533 , 
°dout
);

534 
	`Âuts
(

541 , 
°dout
);

542 
	`Âuts
(

554 , 
°dout
);

555 
	`Âuts
(

566 , 
°dout
);

567 
	`Âuts
(

576 , 
°dout
);

577 
	`Âuts
(

587 , 
°dout
);

588 
	`Âuts
(

598 , 
°dout
);

599 
	`Âuts
(

609 , 
°dout
);

610 
	`Âuts
(

619 , 
°dout
);

620 
	`Âuts
(

630 , 
°dout
);

631 
	`Âuts
(

639 , 
°dout
);

640 
	`Âuts
(

647 , 
°dout
);

648 
	`Âuts
(

656 , 
°dout
);

657 
	`Âuts
(

667 , 
°dout
);

668 
	`Âuts
(

679 , 
°dout
);

680 
	`Âuts
(

690 , 
°dout
);

691 
	`Âuts
(

701 , 
°dout
);

702 
	`Âuts
(

712 , 
°dout
);

713 
	`Âuts
(

723 , 
°dout
);

724 
	`Âuts
(

732 , 
°dout
);

733 
	`Âuts
(

742 , 
°dout
);

743 
	`Âuts
(

753 , 
°dout
);

754 
	`Âuts
(

761 , 
°dout
);

762 
	`Âuts
(

773 , 
°dout
);

774 
	`Âuts
(

788 , 
°dout
);

789 
	`Âuts
(

804 , 
°dout
);

805 
	`Âuts
(

818 , 
°dout
);

819 
	`Âuts
(

829 , 
°dout
);

830 
	`Âuts
(

840 , 
°dout
);

841 
	`Âuts
(

851 , 
°dout
);

852 
	`Âuts
(

863 , 
°dout
);

864 
	`Âuts
(

874 , 
°dout
);

875 
	`Âuts
(

885 , 
°dout
);

886 
	`Âuts
(

897 , 
°dout
);

898 
	`Âuts
(

906 , 
°dout
);

907 
	`Âuts
(

916 , 
°dout
);

917 
	`Âuts
(

926 , 
°dout
);

927 
	`Âuts
(

936 , 
°dout
);

937 
	`Âuts
(

946 , 
°dout
);

947 
	`Âuts
(

957 , 
°dout
);

958 
	`Âuts
(

965 , 
°dout
);

966 
	`Âuts
(

974 , 
°dout
);

975 
	`Âuts
(

986 , 
°dout
);

987 
	`Âuts
(

998 , 
°dout
);

999 
	`Âuts
(

1010 , 
°dout
);

1011 
	`Âuts
(

1020 , 
°dout
);

1021 
	`Âuts
(

1032 , 
°dout
);

1033 
	`Âuts
(

1043 , 
°dout
);

1044 
	`Âuts
(

1055 , 
°dout
);

1056 
	`Âuts
(

1066 , 
°dout
);

1067 
	`Âuts
(

1074 , 
°dout
);

1075 
	`Âuts
(

1083 , 
°dout
);

1084 
	`Âuts
(

1096 , 
°dout
);

1097 
	`Âuts
(

1106 , 
°dout
);

1107 
	`Âuts
(

1115 , 
°dout
);

1116 
	`Âuts
(

1130 , 
°dout
);

1131 
	`Âuts
(

1142 , 
°dout
);

1143 
	`Âuts
(

1154 , 
°dout
);

1155 
	`Âuts
(

1167 , 
°dout
);

1168 
	`Âuts
(

1179 , 
°dout
);

1180 
	`Âuts
(

1189 , 
°dout
);

1190 
	`Âuts
(

1199 , 
°dout
);

1200 
	`Âuts
(

1209 , 
°dout
);

1210 
	`Âuts
(

1217 , 
°dout
);

1218 
	`Âuts
(

1226 , 
°dout
);

1227 
	`Âuts
(

1239 , 
°dout
);

1240 
	`Âuts
(

1248 , 
°dout
);

1249 
	`Âuts
(

1257 , 
°dout
);

1258 
	`Âuts
(

1268 , 
°dout
);

1269 
	`Âuts
(

1280 , 
°dout
);

1281 
	`Âuts
(

1289 , 
°dout
);

1290 
	`Âuts
(

1299 , 
°dout
);

1300 
	`Âuts
(

1311 , 
°dout
);

1312 
	`Âuts
(

1326 , 
°dout
);

1327 
	`Âuts
(

1336 , 
°dout
);

1337 
	`Âuts
(

1346 , 
°dout
);

1347 
	`Âuts
(

1357 , 
°dout
);

1358 
	`Âuts
(

1367 , 
°dout
);

1368 
	`Âuts
(

1381 , 
°dout
);

1382 
	`Âuts
(

1391 , 
°dout
);

1392 
	`Âuts
(

1401 , 
°dout
);

1402 
	`Âuts
(

1413 , 
°dout
);

1414 
	`Âuts
(

1423 , 
°dout
);

1424 
	`Âuts
(

1434 , 
°dout
);

1435 
	`Âuts
(

1445 , 
°dout
);

1446 
	`Âuts
(

1456 , 
°dout
);

1457 
	`Âuts
(

1467 , 
°dout
);

1468 
	`Âuts
(

1481 , 
°dout
);

1482 
	`Âuts
(

1492 , 
°dout
);

1493 
	`Âuts
(

1500 , 
°dout
);

1501 
	`Âuts
(

1509 , 
°dout
);

1510 
	`Âuts
(

1521 , 
°dout
);

1522 
	`Âuts
(

1532 , 
°dout
);

1533 
	`Âuts
(

1547 , 
°dout
);

1548 
	`Âuts
(

1559 , 
°dout
);

1560 
	`Âuts
(

1572 , 
°dout
);

1573 
	`Âuts
(

1585 , 
°dout
);

1586 
	`Âuts
(

1595 , 
°dout
);

1596 
	`Âuts
(

1606 , 
°dout
);

1607 
	`Âuts
(

1615 , 
°dout
);

1616 
	`Âuts
(

1625 , 
°dout
);

1626 
	`Âuts
(

1640 , 
°dout
);

1641 
	`Âuts
(

1651 , 
°dout
);

1652 
	`Âuts
(

1664 , 
°dout
);

1665 
	`Âuts
(

1674 , 
°dout
);

1675 
	`Âuts
(

1682 , 
°dout
);

1683 
	`Âuts
(

1692 , 
°dout
);

1693 
	`Âuts
(

1703 , 
°dout
);

1704 
	`Âuts
(

1715 , 
°dout
);

1716 
	`Âuts
(

1729 , 
°dout
);

1730 
	`Âuts
(

1742 , 
°dout
);

1743 
	`Âuts
(

1755 , 
°dout
);

1756 
	`Âuts
(

1767 , 
°dout
);

1768 
	`Âuts
(

1779 , 
°dout
);

1780 
	`Âuts
(

1790 , 
°dout
);

1791 
	`Âuts
(

1802 , 
°dout
);

1803 
	`Âuts
(

1810 , 
°dout
);

1811 
	`Âuts
(

1818 , 
°dout
);

1819 
	`Âuts
(

1829 , 
°dout
);

1830 
	`Âuts
(

1841 , 
°dout
);

1842 
	`Âuts
(

1853 , 
°dout
);

1854 
	`Âuts
(

1865 , 
°dout
);

1866 
	`Âuts
(

1881 , 
°dout
);

1882 
	`Âuts
(

1895 , 
°dout
);

1896 
	`Âuts
(

1909 , 
°dout
);

1910 
	`Âuts
(

1920 , 
°dout
);

1921 
	`Âuts
(

1933 , 
°dout
);

1934 
	`Âuts
(

1944 , 
°dout
);

1945 
	`Âuts
(

1954 , 
°dout
);

1955 
	`Âuts
(

1962 , 
°dout
);

1963 
	`Âuts
(

1975 , 
°dout
);

1976 
	`Âuts
(

1984 , 
°dout
);

1985 
	`Âuts
(

1995 , 
°dout
);

1996 
	`Âuts
(

2006 , 
°dout
);

2007 
	`Âuts
(

2015 , 
°dout
);

2016 
	`Âuts
(

2030 , 
°dout
);

2031 
	`Âuts
(

2041 , 
°dout
);

2042 
	`Âuts
(

2053 , 
°dout
);

2054 
	`Âuts
(

2063 , 
°dout
);

2064 
	`Âuts
(

2075 , 
°dout
);

2076 
	`Âuts
(

2087 , 
°dout
);

2088 
	`Âuts
(

2098 , 
°dout
);

2099 
	`Âuts
(

2110 , 
°dout
);

2111 
	`Âuts
(

2123 , 
°dout
);

2124 
	`Âuts
(

2134 , 
°dout
);

2135 
	`Âuts
(

2144 , 
°dout
);

2145 
	`Âuts
(

2156 , 
°dout
);

2157 
	`Âuts
(

2170 , 
°dout
);

2171 
	`Âuts
(

2180 , 
°dout
);

2181 
	`Âuts
(

2190 , 
°dout
);

2191 
	`Âuts
(

2204 , 
°dout
);

2205 
	`Âuts
(

2217 , 
°dout
);

2218 
	`Âuts
(

2230 , 
°dout
);

2231 
	`Âuts
(

2242 , 
°dout
);

2243 
	`Âuts
(

2256 , 
°dout
);

2257 
	`Âuts
(

2269 , 
°dout
);

2270 
	`Âuts
(

2281 , 
°dout
);

2282 
	`Âuts
(

2292 , 
°dout
);

2293 
	`Âuts
(

2305 , 
°dout
);

2306 
	`Âuts
(

2317 , 
°dout
);

2318 
	`Âuts
(

2330 , 
°dout
);

2331 
	`Âuts
(

2341 , 
°dout
);

2342 
	`Âuts
(

2353 , 
°dout
);

2354 
	`Âuts
(

2364 , 
°dout
);

2365 
	`Âuts
(

2373 , 
°dout
);

2374 
	`Âuts
(

2387 , 
°dout
);

2388 
	`Âuts
(

2396 , 
°dout
);

2397 
	`Âuts
(

2406 , 
°dout
);

2407 
	`Âuts
(

2418 , 
°dout
);

2419 
	`Âuts
(

2428 , 
°dout
);

2429 
	`Âuts
(

2440 , 
°dout
);

2441 
	`Âuts
(

2453 , 
°dout
);

2454 
	`Âuts
(

2465 , 
°dout
);

2466 
	`Âuts
(

2476 , 
°dout
);

2477 
	`Âuts
(

2486 , 
°dout
);

2487 
	`Âuts
(

2495 , 
°dout
);

2496 
	`Âuts
(

2505 , 
°dout
);

2506 
	`Âuts
(

2517 , 
°dout
);

2518 
	`Âuts
(

2528 , 
°dout
);

2529 
	`Âuts
(

2540 , 
°dout
);

2541 
	`Âuts
(

2549 , 
°dout
);

2550 
	`Âuts
(

2561 , 
°dout
);

2562 
	`Âuts
(

2571 , 
°dout
);

2572 
	`Âuts
(

2582 , 
°dout
);

2583 
	`Âuts
(

2596 , 
°dout
);

2597 
	`Âuts
(

2606 , 
°dout
);

2607 
	`Âuts
(

2619 , 
°dout
);

2620 
	`Âuts
(

2631 , 
°dout
);

2632 
	`Âuts
(

2641 , 
°dout
);

2642 
	`Âuts
(

2656 , 
°dout
);

2657 
	`Âuts
(

2666 , 
°dout
);

2667 
	`Âuts
(

2684 , 
°dout
);

2685 
	`Âuts
(

2699 , 
°dout
);

2700 
	`Âuts
(

2712 , 
°dout
);

2713 
	`Âuts
(

2725 , 
°dout
);

2726 
	`Âuts
(

2739 , 
°dout
);

2740 
	`Âuts
(

2753 , 
°dout
);

2754 
	`Âuts
(

2768 , 
°dout
);

2769 
	`Âuts
(

2784 , 
°dout
);

2785 
	`Âuts
(

2800 , 
°dout
);

2801 
	`Âuts
(

2814 , 
°dout
);

2815 
	`Âuts
(

2828 , 
°dout
);

2829 
	`Âuts
(

2840 , 
°dout
);

2841 
	`Âuts
(

2855 , 
°dout
);

2856 
	`Âuts
(

2869 , 
°dout
);

2870 
	`Âuts
(

2886 , 
°dout
);

2887 
	`Âuts
(

2900 , 
°dout
);

2901 
	`Âuts
(

2918 , 
°dout
);

2919 
	`Âuts
(

2939 , 
°dout
);

2940 
	`Âuts
(

2960 , 
°dout
);

2961 
	`Âuts
(

2977 , 
°dout
);

2978 
	`Âuts
(

2996 , 
°dout
);

2997 
	`Âuts
(

3022 , 
°dout
);

3023 
	`Âuts
(

3044 , 
°dout
);

3045 
	`Âuts
(

3062 , 
°dout
);

3063 
	`Âuts
(

3078 , 
°dout
);

3079 
	`Âuts
(

3099 , 
°dout
);

3100 
	`Âuts
(

3115 , 
°dout
);

3116 
	`Âuts
(

3130 , 
°dout
);

3131 
	`Âuts
(

3141 , 
°dout
);

3142 
	`Âuts
(

3155 , 
°dout
);

3156 
	`Âuts
(

3170 , 
°dout
);

3171 
	`Âuts
(

3184 , 
°dout
);

3185 
	`Âuts
(

3195 , 
°dout
);

3196 
	`Âuts
(

3210 , 
°dout
);

3211 
	`Âuts
(

3232 , 
°dout
);

3233 
	`Âuts
(

3251 , 
°dout
);

3252 
	`Âuts
(

3268 , 
°dout
);

3269 
	`Âuts
(

3284 , 
°dout
);

3285 
	`Âuts
(

3298 , 
°dout
);

3299 
	`Âuts
(

3310 , 
°dout
);

3311 
	`Âuts
(

3326 , 
°dout
);

3327 
	`Âuts
(

3341 , 
°dout
);

3342 
	`Âuts
(

3355 , 
°dout
);

3356 
	`Âuts
(

3370 , 
°dout
);

3371 
	`Âuts
(

3379 , 
°dout
);

3380 
	`Âuts
(

3390 , 
°dout
);

3391 
	`Âuts
(

3399 , 
°dout
);

3400 
	`Âuts
(

3414 , 
°dout
);

3415 
	`Âuts
(

3429 , 
°dout
);

3430 
	`Âuts
(

3443 , 
°dout
);

3444 
	`Âuts
(

3456 , 
°dout
);

3457 
	`Âuts
(

3467 , 
°dout
);

3468 
	`Âuts
(

3478 , 
°dout
);

3479 
	`Âuts
(

3489 , 
°dout
);

3490 
	`Âuts
(

3504 , 
°dout
);

3505 
	`Âuts
(

3518 , 
°dout
);

3519 
	`Âuts
(

3529 , 
°dout
);

3530 
	`Âuts
(

3543 , 
°dout
);

3544 
	`Âuts
(

3554 , 
°dout
);

3555 
	`Âuts
(

3566 , 
°dout
);

3567 
	`Âuts
(

3579 , 
°dout
);

3580 
	`Âuts
(

3593 , 
°dout
);

3594 
	`Âuts
(

3610 , 
°dout
);

3611 
	`Âuts
(

3624 , 
°dout
);

3625 
	`Âuts
(

3635 , 
°dout
);

3636 
	`Âuts
(

3650 , 
°dout
);

3651 
	`Âuts
(

3666 , 
°dout
);

3667 
	`Âuts
(

3680 , 
°dout
);

3681 
	`Âuts
(

3693 , 
°dout
);

3694 
	`Âuts
(

3710 , 
°dout
);

3711 
	`Âuts
(

3725 , 
°dout
);

3726 
	`Âuts
(

3738 , 
°dout
);

3739 
	`Âuts
(

3749 , 
°dout
);

3750 
	`Âuts
(

3770 , 
°dout
);

3771 
	`Âuts
(

3786 , 
°dout
);

3787 
	`Âuts
(

3794 , 
°dout
);

3795 
	`Âuts
(

3806 , 
°dout
);

3807 
	`Âuts
(

3818 , 
°dout
);

3819 
	`Âuts
(

3835 , 
°dout
);

3836 
	`Âuts
(

3847 , 
°dout
);

3848 
	`Âuts
(

3864 , 
°dout
);

3865 
	`Âuts
(

3882 , 
°dout
);

3883 
	`Âuts
(

3894 , 
°dout
);

3895 
	`Âuts
(

3912 , 
°dout
);

3913 
	`Âuts
(

3929 , 
°dout
);

3930 
	`Âuts
(

3944 , 
°dout
);

3945 
	`Âuts
(

3960 , 
°dout
);

3961 
	`Âuts
(

3977 , 
°dout
);

3978 
	`Âuts
(

3991 , 
°dout
);

3992 
	`Âuts
(

4006 , 
°dout
);

4007 
	`Âuts
(

4020 , 
°dout
);

4021 
	`Âuts
(

4035 , 
°dout
);

4036 
	`Âuts
(

4049 , 
°dout
);

4050 
	`Âuts
(

4063 , 
°dout
);

4064 
	`Âuts
(

4076 , 
°dout
);

4077 
	`Âuts
(

4086 , 
°dout
);

4087 
	`Âuts
(

4099 , 
°dout
);

4100 
	`Âuts
(

4114 , 
°dout
);

4115 
	`Âuts
(

4124 , 
°dout
);

4125 
	`Âuts
(

4138 , 
°dout
);

4139 
	`Âuts
(

4151 , 
°dout
);

4152 
	`Âuts
(

4163 , 
°dout
);

4164 
	`Âuts
(

4179 , 
°dout
);

4180 
	`Âuts
(

4197 , 
°dout
);

4198 
	`Âuts
(

4200 , 
°dout
) ;

4201 
	}
}

4204 
	~"toﬁ_hugehñp.h
"

4205 
	$hugehñp
(Ë{
	}
}

4212 #ifde‡
USE_MANUAL


4213 
	~"toﬁ_hugehñp.h
"

4214 
	~<zlib.h
>

4215 
	~"memdebug.h
"

4216 c⁄° 
	ghugehñpgz
[] = {

8204 
	#BUF_SIZE
 0x10000

	)

8205 
voidpf
 
	$zÆloc_func
(
voidpf
 
›aque
, 
ôems
, 
size
)

8207 (Ë
›aque
;

8209  (
voidpf
Ë
	`ˇŒoc
(
ôems
, 
size
);

8210 
	}
}

8211 
	$z‰ì_func
(
voidpf
 
›aque
, voidp‡
±r
)

8213 (Ë
›aque
;

8214 
	`‰ì
(
±r
);

8215 
	}
}

8217 
	$hugehñp
()

8219 * 
buf
;

8220 
°©us
,
hódîÀn
;

8221 
z_°ªam
 
z
;

8224 i‡(
hugehñpgz
[3] & 0xfe)

8227 
hódîÀn
 = 10;

8228 
	`mem£t
(&
z
, 0, (
z_°ªam
));

8229 
z
.
zÆloc
 = (
Æloc_func
)
zÆloc_func
;

8230 
z
.
z‰ì
 = (
‰ì_func
)
z‰ì_func
;

8231 
z
.
avaû_ö
 = ()((
hugehñpgz
Ë- 
hódîÀn
);

8232 
z
.
√xt_ö
 = (*)
hugehñpgz
 + 
hódîÀn
;

8234 i‡(
	`öÊ©eInô2
(&
z
, -
MAX_WBITS
Ë!
Z_OK
)

8237 
buf
 = 
	`mÆloc
(
BUF_SIZE
);

8238 i‡(
buf
) {

8240 
z
.
avaû_out
 = 
BUF_SIZE
;

8241 
z
.
√xt_out
 = 
buf
;

8242 
°©us
 = 
	`öÊ©e
(&
z
, 
Z_SYNC_FLUSH
);

8243 i‡(
°©us
 =
Z_OK
 || sètu†=
Z_STREAM_END
) {

8244 
	`fwrôe
(
buf
, 
BUF_SIZE
 - 
z
.
avaû_out
, 1, 
°dout
);

8245 i‡(
°©us
 =
Z_STREAM_END
)

8251 
	`‰ì
(
buf
);

8253 
	`öÊ©eEnd
(&
z
);

8254 
	}
}

8257 
	~"toﬁ_hugehñp.h
"

8258 
	$hugehñp
(Ë{
	}
}

	@src/tool_hugehelp.h

1 #i‚de‡
HEADER_CURL_TOOL_HUGEHELP_H


2 
	#HEADER_CURL_TOOL_HUGEHELP_H


	)

24 
	~"toﬁ_£tup.h
"

26 
hugehñp
();

	@src/tool_libinfo.c

22 
	~"toﬁ_£tup.h
"

24 
	~"øw°r.h
"

26 
	#ENABLE_CURLX_PRINTF


	)

28 
	~"cuæx.h
"

30 
	~"toﬁ_liböfo.h
"

32 
	~"memdebug.h
"

36 
cuæ_vîsi⁄_öfo_d©a
 *
	gcuæöfo
 = 
NULL
;

37 
	gbuût_ö_¥Ÿos
 = 0;

47 
CURLcode
 
	$gë_libcuæ_öfo
()

49 
	s¥Ÿo_«me_∑âîn
 {

50 c⁄° *
¥Ÿo_«me
;

51 
¥Ÿo_∑âîn
;

52 } c⁄° 
possibly_buût_ö
[] = {

53 { "di˘", 
CURLPROTO_DICT
 },

54 { "fûe", 
CURLPROTO_FILE
 },

55 { "·p", 
CURLPROTO_FTP
 },

56 { "·ps", 
CURLPROTO_FTPS
 },

57 { "g›hî", 
CURLPROTO_GOPHER
 },

58 { "hâp", 
CURLPROTO_HTTP
 },

59 { "hâps", 
CURLPROTO_HTTPS
 },

60 { "im≠", 
CURLPROTO_IMAP
 },

61 { "im≠s", 
CURLPROTO_IMAPS
 },

62 { "ld≠", 
CURLPROTO_LDAP
 },

63 { "ld≠s", 
CURLPROTO_LDAPS
 },

64 { "p›3", 
CURLPROTO_POP3
 },

65 { "p›3s", 
CURLPROTO_POP3S
 },

66 { "πmp", 
CURLPROTO_RTMP
 },

67 { "π•", 
CURLPROTO_RTSP
 },

68 { "s˝", 
CURLPROTO_SCP
 },

69 { "s·p", 
CURLPROTO_SFTP
 },

70 { "smç", 
CURLPROTO_SMTP
 },

71 { "smçs", 
CURLPROTO_SMTPS
 },

72 { "ã ë", 
CURLPROTO_TELNET
 },

73 { "t·p", 
CURLPROTO_TFTP
 },

74 { 
NULL
, 0 }

77 
¥Ÿo_«me_∑âîn
 c⁄° *
p
;

78 c⁄° *c⁄° *
¥Ÿo
;

81 
cuæöfo
 = 
	`cuæ_vîsi⁄_öfo
(
CURLVERSION_NOW
);

82 if(!
cuæöfo
)

83  
CURLE_FAILED_INIT
;

86 
buût_ö_¥Ÿos
 = 0;

87 if(
cuæöfo
->
¥Ÿocﬁs
) {

88 
¥Ÿo
 = 
cuæöfo
->
¥Ÿocﬁs
; *proto;Öroto++) {

89 
p
 = 
possibly_buût_ö
;Ö->
¥Ÿo_«me
;Ö++) {

90 if(
	`cuæx_øw_equÆ
(*
¥Ÿo
, 
p
->
¥Ÿo_«me
)) {

91 
buût_ö_¥Ÿos
 |
p
->
¥Ÿo_∑âîn
;

98  
CURLE_OK
;

99 
	}
}

	@src/tool_libinfo.h

1 #i‚de‡
HEADER_CURL_TOOL_LIBINFO_H


2 
	#HEADER_CURL_TOOL_LIBINFO_H


	)

24 
	~"toﬁ_£tup.h
"

28 
cuæ_vîsi⁄_öfo_d©a
 *
cuæöfo
;

29 
buût_ö_¥Ÿos
;

31 
CURLcode
 
gë_libcuæ_öfo
();

	@src/tool_main.c

22 
	~"toﬁ_£tup.h
"

24 
	~<sys/°©.h
>

26 #ifde‡
HAVE_SIGNAL_H


27 
	~<sig«l.h
>

30 #ifde‡
USE_NSS


31 
	~<n•r.h
>

32 
	~<∂¨ías.h
>

35 
	#ENABLE_CURLX_PRINTF


	)

37 
	~"cuæx.h
"

39 
	~"toﬁ_cfgabÀ.h
"

40 
	~"toﬁ_c⁄vît.h
"

41 
	~"toﬁ_msgs.h
"

42 
	~"toﬁ_›î©e.h
"

43 
	~"toﬁ_∑nykey.h
"

44 
	~"toﬁ_vms.h
"

45 
	~"toﬁ_maö.h
"

46 
	~"toﬁ_liböfo.h
"

53 
	~"memdebug.h
"

55 #ifde‡
__VMS


62 
	gvms_show
 = 0;

66 #i‚de‡
UNITTESTS


74 
	$maö_checkfds
()

76 #ifde‡
HAVE_PIPE


77 
fd
[2] = { 
STDIN_FILENO
, STDIN_FILENO };

78 
fd
[0] =
STDIN_FILENO
 ||

79 
fd
[0] =
STDOUT_FILENO
 ||

80 
fd
[0] =
STDERR_FILENO
 ||

81 
fd
[1] =
STDIN_FILENO
 ||

82 
fd
[1] =
STDOUT_FILENO
 ||

83 
fd
[1] =
STDERR_FILENO
)

84 if(
	`pùe
(
fd
) < 0)

87 
	`˛o£
(
fd
[0]);

88 
	`˛o£
(
fd
[1]);

90 
	}
}

92 #ifde‡
CURLDEBUG


93 
	$mem‹y_åackög_öô
()

95 *
ív
;

97 
ív
 = 
	`cuæx_gëív
("CURL_MEMDEBUG");

98 if(
ív
) {

100 
‚ame
[
CURL_MT_LOGFNAME_BUFSIZE
];

101 if(
	`°æí
(
ív
Ë>
CURL_MT_LOGFNAME_BUFSIZE
)

102 
ív
[
CURL_MT_LOGFNAME_BUFSIZE
-1] = '\0';

103 
	`°r˝y
(
‚ame
, 
ív
);

104 
	`cuæ_‰ì
(
ív
);

105 
	`cuæ_memdebug
(
‚ame
);

111 
ív
 = 
	`cuæx_gëív
("CURL_MEMLIMIT");

112 if(
ív
) {

113 *
íd±r
;

114 
num
 = 
	`°πﬁ
(
ív
, &
íd±r
, 10);

115 if((
íd±r
 !
ív
Ë&& (íd±∏=ív + 
	`°æí
”nv)Ë&& (
num
 > 0))

116 
	`cuæ_memlimô
(
num
);

117 
	`cuæ_‰ì
(
ív
);

119 
	}
}

121 
	#mem‹y_åackög_öô
(Ë
Cuæ_n›_°mt


	)

129 
CURLcode
 
	$maö_öô
(
GlobÆC⁄fig
 *
c⁄fig
)

131 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

133 #i‡
	`deföed
(
__DJGPP__
Ë|| deföed(
__GO32__
)

135 
_dj°©_Êags
 |
_STAT_INODE
 | 
_STAT_EXEC_MAGIC
 | 
_STAT_DIRSIZE
;

139 
c⁄fig
->
showîr‹
 = -1;

140 
c⁄fig
->
îr‹s
 = 
°dîr
;

143 
c⁄fig
->
fú°
 = c⁄fig->
œ°
 = 
	`mÆloc
((
O≥øti⁄C⁄fig
));

144 if(
c⁄fig
->
fú°
) {

146 
ªsu…
 = 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

147 if(!
ªsu…
) {

149 
ªsu…
 = 
	`gë_libcuæ_öfo
();

151 if(!
ªsu…
) {

153 
c⁄fig
->
ósy
 = 
	`cuæ_ósy_öô
();

154 if(
c⁄fig
->
ósy
) {

156 
	`c⁄fig_öô
(
c⁄fig
->
fú°
);

157 
c⁄fig
->
fú°
->
ósy
 = config->easy;

158 
c⁄fig
->
fú°
->
globÆ
 = config;

161 
	`hñpf
(
°dîr
, "error initializing curlÉasy handle\n");

162 
ªsu…
 = 
CURLE_FAILED_INIT
;

163 
	`‰ì
(
c⁄fig
->
fú°
);

167 
	`hñpf
(
°dîr
, "errorÑetrieving curlÜibrary information\n");

168 
	`‰ì
(
c⁄fig
->
fú°
);

172 
	`hñpf
(
°dîr
, "error initializing curlÜibrary\n");

173 
	`‰ì
(
c⁄fig
->
fú°
);

177 
	`hñpf
(
°dîr
, "error initializing curl\n");

178 
ªsu…
 = 
CURLE_FAILED_INIT
;

181  
ªsu…
;

182 
	}
}

184 
	$‰ì_c⁄fig_fõlds
(
GlobÆC⁄fig
 *
c⁄fig
)

186 
	`Cuæ_ß„‰ì
(
c⁄fig
->
åa˚_dump
);

188 if(
c⁄fig
->
îr‹s_f›íed
 && c⁄fig->
îr‹s
)

189 
	`f˛o£
(
c⁄fig
->
îr‹s
);

190 
c⁄fig
->
îr‹s
 = 
NULL
;

192 if(
c⁄fig
->
åa˚_f›íed
 && c⁄fig->
åa˚_°ªam
)

193 
	`f˛o£
(
c⁄fig
->
åa˚_°ªam
);

194 
c⁄fig
->
åa˚_°ªam
 = 
NULL
;

196 
	`Cuæ_ß„‰ì
(
c⁄fig
->
libcuæ
);

197 
	}
}

203 
	$maö_‰ì
(
GlobÆC⁄fig
 *
c⁄fig
)

206 
	`cuæ_ósy_˛ónup
(
c⁄fig
->
ósy
);

207 
c⁄fig
->
ósy
 = 
NULL
;

210 
	`cuæ_globÆ_˛ónup
();

211 
	`c⁄vît_˛ónup
();

212 
	`mëÆök_˛ónup
();

213 #ifde‡
USE_NSS


214 if(
	`PR_Inôülized
()) {

216 
	`PL_Aª«Föish
();

218 
	`PR_CÀ™up
();

221 
	`‰ì_c⁄fig_fõlds
(
c⁄fig
);

224 
	`c⁄fig_‰ì
(
c⁄fig
->
œ°
);

225 
c⁄fig
->
fú°
 = 
NULL
;

226 
c⁄fig
->
œ°
 = 
NULL
;

227 
	}
}

232 
	$maö
(
¨gc
, *
¨gv
[])

234 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

235 
GlobÆC⁄fig
 
globÆ
;

236 
	`mem£t
(&
globÆ
, 0, (global));

238 
	`maö_checkfds
();

240 #i‡
	`deföed
(
HAVE_SIGNAL
Ë&& deföed(
SIGPIPE
)

241 ()
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

245 
	`mem‹y_åackög_öô
();

249 
ªsu…
 = 
	`maö_öô
(&
globÆ
);

250 if(!
ªsu…
) {

252 
ªsu…
 = 
	`›î©e
(&
globÆ
, 
¨gc
, 
¨gv
);

254 #ifde‡
__SYMBIAN32__


255 if(
globÆ
.
showîr‹
)

256 
	`toﬁ_¥esßnykey
();

260 
	`maö_‰ì
(&
globÆ
);

263 #ifde‡
__NOVELL_LIBC__


264 if(
	`gëív
("_IN_NETWARE_BASH_"Ë=
NULL
)

265 
	`toﬁ_¥esßnykey
();

268 #ifde‡
__VMS


269 
	`vms_•ecül_exô
(
ªs
, 
vms_show
);

271  ()
ªsu…
;

273 
	}
}

	@src/tool_main.h

1 #i‚de‡
HEADER_CURL_TOOL_MAIN_H


2 
	#HEADER_CURL_TOOL_MAIN_H


	)

24 
	~"toﬁ_£tup.h
"

26 
	#DEFAULT_MAXREDIRS
 50L

	)

28 
	#RETRY_SLEEP_DEFAULT
 1000L

	)

29 
	#RETRY_SLEEP_MAX
 600000L

	)

31 #i‚de‡
STDIN_FILENO


32 
	#STDIN_FILENO
 
	`fûío
(
°dö
)

	)

35 #i‚de‡
STDOUT_FILENO


36 
	#STDOUT_FILENO
 
	`fûío
(
°dout
)

	)

39 #i‚de‡
STDERR_FILENO


40 
	#STDERR_FILENO
 
	`fûío
(
°dîr
)

	)

	@src/tool_metalink.c

22 
	~"toﬁ_£tup.h
"

24 #ifde‡
USE_METALINK


26 
	~<sys/°©.h
>

28 #ifde‡
HAVE_FCNTL_H


29 
	~<f˙é.h
>

32 #ifde‡
USE_SSLEAY


33 #ifde‡
USE_OPENSSL


34 
	~<›ís¶/md5.h
>

35 
	~<›ís¶/sha.h
>

37 
	~<md5.h
>

38 
	~<sha.h
>

40 #ñi‡
deföed
(
USE_GNUTLS_NETTLE
)

41 
	~<√âÀ/md5.h
>

42 
	~<√âÀ/sha.h
>

43 
	#MD5_CTX
 
md5_˘x


	)

44 
	#SHA_CTX
 
sha1_˘x


	)

45 
	#SHA256_CTX
 
sha256_˘x


	)

46 #ñi‡
deföed
(
USE_GNUTLS
)

47 
	~<g¸y±.h
>

48 
	#MD5_CTX
 
g¸y_md_hd_t


	)

49 
	#SHA_CTX
 
g¸y_md_hd_t


	)

50 
	#SHA256_CTX
 
g¸y_md_hd_t


	)

51 #ñi‡
deföed
(
USE_NSS
)

52 
	~<nss.h
>

53 
	~<pk11pub.h
>

54 
	#MD5_CTX
 *

	)

55 
	#SHA_CTX
 *

	)

56 
	#SHA256_CTX
 *

	)

57 
NSSInôC⁄ãxt
 *
	gnss_c⁄ãxt
;

58 #ñi‡
deföed
(
USE_POLARSSL
)

59 
	~<pﬁ¨s¶/md5.h
>

60 
	~<pﬁ¨s¶/sha1.h
>

61 
	~<pﬁ¨s¶/sha256.h
>

62 
	#MD5_CTX
 
md5_c⁄ãxt


	)

63 
	#SHA_CTX
 
sha1_c⁄ãxt


	)

64 
	#SHA256_CTX
 
sha256_c⁄ãxt


	)

65 #ñi‡(
deföed
(
__MAC_OS_X_VERSION_MAX_ALLOWED
) && \

66 (
	g__MAC_OS_X_VERSION_MAX_ALLOWED
 >= 1040)) || \

67 (
deföed
(
__IPHONE_OS_VERSION_MAX_ALLOWED
) && \

68 (
__IPHONE_OS_VERSION_MAX_ALLOWED
 >= 20000))

75 
	#COMMON_DIGEST_FOR_OPENSSL


	)

76 
	~<Comm⁄Cry±o/Comm⁄Dige°.h
>

77 #ñi‡
deföed
(
_WIN32
)

80 
	~<wö¸y±.h
>

82 
	swö32_¸y±o_hash
 {

83 
HCRYPTPROV
 
hCry±Prov
;

84 
HCRYPTHASH
 
	mhHash
;

87 #i‚de‡
ALG_SID_SHA_256


88 
	#ALG_SID_SHA_256
 12

	)

90 #i‚de‡
CALG_SHA_256


91 
	#CALG_SHA_256
 (
ALG_CLASS_HASH
 | 
ALG_TYPE_ANY
 | 
ALG_SID_SHA_256
)

	)

93 
	#MD5_CTX
 
wö32_¸y±o_hash


	)

94 
	#SHA_CTX
 
wö32_¸y±o_hash


	)

95 
	#SHA256_CTX
 
wö32_¸y±o_hash


	)

100 
	~"øw°r.h
"

102 
	#ENABLE_CURLX_PRINTF


	)

104 
	~"cuæx.h
"

106 
	~"toﬁ_gë∑øm.h
"

107 
	~"toﬁ_∑ømhÕ.h
"

108 
	~"toﬁ_cfgabÀ.h
"

109 
	~"toﬁ_mëÆök.h
"

110 
	~"toﬁ_msgs.h
"

112 
	~"memdebug.h
"

115 
	#GëSå
(
°r
,
vÆ
) do { \

116 if(*(
°r
)) { \

117 
	`‰ì
(*(
°r
)); \

118 *(
°r
Ë
NULL
; \

120 if((
vÆ
)) \

121 *(
°r
Ë
	`°rdup
((
vÆ
)); \

122 if(!(
vÆ
)) \

123  
PARAM_NO_MEM
; \

124 } 
WHILE_FALSE


	)

126 #ifde‡
USE_GNUTLS_NETTLE


128 
	$MD5_Inô
(
MD5_CTX
 *
˘x
)

130 
	`md5_öô
(
˘x
);

132 
	}
}

134 
	$MD5_Upd©e
(
MD5_CTX
 *
˘x
,

135 c⁄° *
öput
,

136 
öputLí
)

138 
	`md5_upd©e
(
˘x
, 
öputLí
, 
öput
);

139 
	}
}

141 
	$MD5_FöÆ
(
dige°
[16], 
MD5_CTX
 *
˘x
)

143 
	`md5_dige°
(
˘x
, 16, 
dige°
);

144 
	}
}

146 
	$SHA1_Inô
(
SHA_CTX
 *
˘x
)

148 
	`sha1_öô
(
˘x
);

150 
	}
}

152 
	$SHA1_Upd©e
(
SHA_CTX
 *
˘x
,

153 c⁄° *
öput
,

154 
öputLí
)

156 
	`sha1_upd©e
(
˘x
, 
öputLí
, 
öput
);

157 
	}
}

159 
	$SHA1_FöÆ
(
dige°
[20], 
SHA_CTX
 *
˘x
)

161 
	`sha1_dige°
(
˘x
, 20, 
dige°
);

162 
	}
}

164 
	$SHA256_Inô
(
SHA256_CTX
 *
˘x
)

166 
	`sha256_öô
(
˘x
);

168 
	}
}

170 
	$SHA256_Upd©e
(
SHA256_CTX
 *
˘x
,

171 c⁄° *
öput
,

172 
öputLí
)

174 
	`sha256_upd©e
(
˘x
, 
öputLí
, 
öput
);

175 
	}
}

177 
	$SHA256_FöÆ
(
dige°
[32], 
SHA256_CTX
 *
˘x
)

179 
	`sha256_dige°
(
˘x
, 32, 
dige°
);

180 
	}
}

182 #ñi‡
deföed
(
USE_GNUTLS
)

184 
	$MD5_Inô
(
MD5_CTX
 *
˘x
)

186 
	`g¸y_md_›í
(
˘x
, 
GCRY_MD_MD5
, 0);

188 
	}
}

190 
	$MD5_Upd©e
(
MD5_CTX
 *
˘x
,

191 c⁄° *
öput
,

192 
öputLí
)

194 
	`g¸y_md_wrôe
(*
˘x
, 
öput
, 
öputLí
);

195 
	}
}

197 
	$MD5_FöÆ
(
dige°
[16], 
MD5_CTX
 *
˘x
)

199 
	`mem˝y
(
dige°
, 
	`g¸y_md_ªad
(*
˘x
, 0), 16);

200 
	`g¸y_md_˛o£
(*
˘x
);

201 
	}
}

203 
	$SHA1_Inô
(
SHA_CTX
 *
˘x
)

205 
	`g¸y_md_›í
(
˘x
, 
GCRY_MD_SHA1
, 0);

207 
	}
}

209 
	$SHA1_Upd©e
(
SHA_CTX
 *
˘x
,

210 c⁄° *
öput
,

211 
öputLí
)

213 
	`g¸y_md_wrôe
(*
˘x
, 
öput
, 
öputLí
);

214 
	}
}

216 
	$SHA1_FöÆ
(
dige°
[20], 
SHA_CTX
 *
˘x
)

218 
	`mem˝y
(
dige°
, 
	`g¸y_md_ªad
(*
˘x
, 0), 20);

219 
	`g¸y_md_˛o£
(*
˘x
);

220 
	}
}

222 
	$SHA256_Inô
(
SHA256_CTX
 *
˘x
)

224 
	`g¸y_md_›í
(
˘x
, 
GCRY_MD_SHA256
, 0);

226 
	}
}

228 
	$SHA256_Upd©e
(
SHA256_CTX
 *
˘x
,

229 c⁄° *
öput
,

230 
öputLí
)

232 
	`g¸y_md_wrôe
(*
˘x
, 
öput
, 
öputLí
);

233 
	}
}

235 
	$SHA256_FöÆ
(
dige°
[32], 
SHA256_CTX
 *
˘x
)

237 
	`mem˝y
(
dige°
, 
	`g¸y_md_ªad
(*
˘x
, 0), 32);

238 
	`g¸y_md_˛o£
(*
˘x
);

239 
	}
}

241 #ñi‡
deföed
(
USE_NSS
)

243 
	$nss_hash_öô
(**
p˘x
, 
SECOidTag
 
hash_Æg
)

245 
PK11C⁄ãxt
 *
˘x
;

248 if(!
	`NSS_IsInôülized
(Ë&& !
nss_c⁄ãxt
) {

249 
NSSInôP¨amëîs
 
∑øms
;

250 
∑øms
.
Àngth
 = Öarams;

251 
nss_c⁄ãxt
 = 
	`NSS_InôC⁄ãxt
("", "", "", "", &
∑øms
, 
NSS_INIT_READONLY


252 | 
NSS_INIT_NOCERTDB
 | 
NSS_INIT_NOMODDB
 | 
NSS_INIT_FORCEOPEN


253 | 
NSS_INIT_NOROOTINIT
 | 
NSS_INIT_OPTIMIZESPACE
 | 
NSS_INIT_PK11RELOAD
);

256 
˘x
 = 
	`PK11_Cª©eDige°C⁄ãxt
(
hash_Æg
);

257 if(!
˘x
)

260 if(
	`PK11_Dige°Begö
(
˘x
Ë!
SECSuc˚ss
) {

261 
	`PK11_De°royC⁄ãxt
(
˘x
, 
PR_TRUE
);

265 *
p˘x
 = 
˘x
;

267 
	}
}

269 
	$nss_hash_föÆ
(**
p˘x
, *
out
, 
Àn
)

271 
PK11C⁄ãxt
 *
˘x
 = *
p˘x
;

272 
ouéí
;

273 
	`PK11_Dige°FöÆ
(
˘x
, 
out
, &
ouéí
, 
Àn
);

274 
	`PK11_De°royC⁄ãxt
(
˘x
, 
PR_TRUE
);

275 
	}
}

277 
	$MD5_Inô
(
MD5_CTX
 *
p˘x
)

279  
	`nss_hash_öô
(
p˘x
, 
SEC_OID_MD5
);

280 
	}
}

282 
	$MD5_Upd©e
(
MD5_CTX
 *
p˘x
,

283 c⁄° *
öput
,

284 
öput_Àn
)

286 
	`PK11_Dige°Op
(*
p˘x
, 
öput
, 
öput_Àn
);

287 
	}
}

289 
	$MD5_FöÆ
(
dige°
[16], 
MD5_CTX
 *
p˘x
)

291 
	`nss_hash_föÆ
(
p˘x
, 
dige°
, 16);

292 
	}
}

294 
	$SHA1_Inô
(
SHA_CTX
 *
p˘x
)

296  
	`nss_hash_öô
(
p˘x
, 
SEC_OID_SHA1
);

297 
	}
}

299 
	$SHA1_Upd©e
(
SHA_CTX
 *
p˘x
,

300 c⁄° *
öput
,

301 
öput_Àn
)

303 
	`PK11_Dige°Op
(*
p˘x
, 
öput
, 
öput_Àn
);

304 
	}
}

306 
	$SHA1_FöÆ
(
dige°
[20], 
SHA_CTX
 *
p˘x
)

308 
	`nss_hash_föÆ
(
p˘x
, 
dige°
, 20);

309 
	}
}

311 
	$SHA256_Inô
(
SHA256_CTX
 *
p˘x
)

313  
	`nss_hash_öô
(
p˘x
, 
SEC_OID_SHA256
);

314 
	}
}

316 
	$SHA256_Upd©e
(
SHA256_CTX
 *
p˘x
,

317 c⁄° *
öput
,

318 
öput_Àn
)

320 
	`PK11_Dige°Op
(*
p˘x
, 
öput
, 
öput_Àn
);

321 
	}
}

323 
	$SHA256_FöÆ
(
dige°
[32], 
SHA256_CTX
 *
p˘x
)

325 
	`nss_hash_föÆ
(
p˘x
, 
dige°
, 32);

326 
	}
}

328 #ñi‡
deföed
(
USE_POLARSSL
)

330 
	$MD5_Inô
(
MD5_CTX
 *
˘x
)

332 
	`md5_°¨ts
(
˘x
);

334 
	}
}

336 
	$MD5_Upd©e
(
MD5_CTX
 *
˘x
,

337 c⁄° *
öput
,

338 
öputLí
)

340 
	`md5_upd©e
(
˘x
, 
öput
, 
öputLí
);

341 
	}
}

343 
	$MD5_FöÆ
(
dige°
[16], 
MD5_CTX
 *
˘x
)

345 
	`md5_föish
(
˘x
, 
dige°
);

346 
	}
}

348 
	$SHA1_Inô
(
SHA_CTX
 *
˘x
)

350 
	`sha1_°¨ts
(
˘x
);

352 
	}
}

354 
	$SHA1_Upd©e
(
SHA_CTX
 *
˘x
,

355 c⁄° *
öput
,

356 
öputLí
)

358 
	`sha1_upd©e
(
˘x
, 
öput
, 
öputLí
);

359 
	}
}

361 
	$SHA1_FöÆ
(
dige°
[20], 
SHA_CTX
 *
˘x
)

363 
	`sha1_föish
(
˘x
, 
dige°
);

364 
	}
}

366 
	$SHA256_Inô
(
SHA256_CTX
 *
˘x
)

368 
	`sha256_°¨ts
(
˘x
, 0);

370 
	}
}

372 
	$SHA256_Upd©e
(
SHA256_CTX
 *
˘x
,

373 c⁄° *
öput
,

374 
öputLí
)

376 
	`sha256_upd©e
(
˘x
, 
öput
, 
öputLí
);

377 
	}
}

379 
	$SHA256_FöÆ
(
dige°
[32], 
SHA256_CTX
 *
˘x
)

381 
	`sha256_föish
(
˘x
, 
dige°
);

382 
	}
}

384 #ñi‡
deföed
(
_WIN32
Ë&& !deföed(
USE_SSLEAY
)

386 
	$wö32_¸y±o_föÆ
(
wö32_¸y±o_hash
 *
˘x
,

387 *
dige°
,

388 
dige°Lí
)

390 
Àngth
;

391 
	`Cry±GëHashP¨am
(
˘x
->
hHash
, 
HP_HASHVAL
, 
NULL
, &
Àngth
, 0);

392 if(
Àngth
 =
dige°Lí
)

393 
	`Cry±GëHashP¨am
(
˘x
->
hHash
, 
HP_HASHVAL
, 
dige°
, &
Àngth
, 0);

394 if(
˘x
->
hHash
)

395 
	`Cry±De°royHash
(
˘x
->
hHash
);

396 if(
˘x
->
hCry±Prov
)

397 
	`Cry±Rñó£C⁄ãxt
(
˘x
->
hCry±Prov
, 0);

398 
	}
}

400 
	$MD5_Inô
(
MD5_CTX
 *
˘x
)

402 if(
	`Cry±AcquúeC⁄ãxt
(&
˘x
->
hCry±Prov
, 
NULL
, NULL,

403 
PROV_RSA_FULL
, 
CRYPT_VERIFYCONTEXT
)) {

404 
	`Cry±Cª©eHash
(
˘x
->
hCry±Prov
, 
CALG_MD5
, 0, 0, &˘x->
hHash
);

407 
	}
}

409 
	$MD5_Upd©e
(
MD5_CTX
 *
˘x
,

410 c⁄° *
öput
,

411 
öputLí
)

413 
	`Cry±HashD©a
(
˘x
->
hHash
, (*)
öput
, 
öputLí
, 0);

414 
	}
}

416 
	$MD5_FöÆ
(
dige°
[16], 
MD5_CTX
 *
˘x
)

418 
	`wö32_¸y±o_föÆ
(
˘x
, 
dige°
, 16);

419 
	}
}

421 
	$SHA1_Inô
(
SHA_CTX
 *
˘x
)

423 if(
	`Cry±AcquúeC⁄ãxt
(&
˘x
->
hCry±Prov
, 
NULL
, NULL,

424 
PROV_RSA_FULL
, 
CRYPT_VERIFYCONTEXT
)) {

425 
	`Cry±Cª©eHash
(
˘x
->
hCry±Prov
, 
CALG_SHA1
, 0, 0, &˘x->
hHash
);

428 
	}
}

430 
	$SHA1_Upd©e
(
SHA_CTX
 *
˘x
,

431 c⁄° *
öput
,

432 
öputLí
)

434 
	`Cry±HashD©a
(
˘x
->
hHash
, (*)
öput
, 
öputLí
, 0);

435 
	}
}

437 
	$SHA1_FöÆ
(
dige°
[20], 
SHA_CTX
 *
˘x
)

439 
	`wö32_¸y±o_föÆ
(
˘x
, 
dige°
, 20);

440 
	}
}

442 
	$SHA256_Inô
(
SHA256_CTX
 *
˘x
)

444 if(
	`Cry±AcquúeC⁄ãxt
(&
˘x
->
hCry±Prov
, 
NULL
, NULL,

445 
PROV_RSA_AES
, 
CRYPT_VERIFYCONTEXT
)) {

446 
	`Cry±Cª©eHash
(
˘x
->
hCry±Prov
, 
CALG_SHA_256
, 0, 0, &˘x->
hHash
);

449 
	}
}

451 
	$SHA256_Upd©e
(
SHA256_CTX
 *
˘x
,

452 c⁄° *
öput
,

453 
öputLí
)

455 
	`Cry±HashD©a
(
˘x
->
hHash
, (*)
öput
, 
öputLí
, 0);

456 
	}
}

458 
	$SHA256_FöÆ
(
dige°
[32], 
SHA256_CTX
 *
˘x
)

460 
	`wö32_¸y±o_föÆ
(
˘x
, 
dige°
, 32);

461 
	}
}

465 c⁄° 
dige°_∑øms
 
	gMD5_DIGEST_PARAMS
[] = {

467 (
Cuæ_dige°_öô_func
Ë
MD5_Inô
,

468 (
Cuæ_dige°_upd©e_func
Ë
MD5_Upd©e
,

469 (
Cuæ_dige°_föÆ_func
Ë
MD5_FöÆ
,

470 (
MD5_CTX
),

475 c⁄° 
dige°_∑øms
 
	gSHA1_DIGEST_PARAMS
[] = {

477 (
Cuæ_dige°_öô_func
Ë
SHA1_Inô
,

478 (
Cuæ_dige°_upd©e_func
Ë
SHA1_Upd©e
,

479 (
Cuæ_dige°_föÆ_func
Ë
SHA1_FöÆ
,

480 (
SHA_CTX
),

485 c⁄° 
dige°_∑øms
 
	gSHA256_DIGEST_PARAMS
[] = {

487 (
Cuæ_dige°_öô_func
Ë
SHA256_Inô
,

488 (
Cuæ_dige°_upd©e_func
Ë
SHA256_Upd©e
,

489 (
Cuæ_dige°_föÆ_func
Ë
SHA256_FöÆ
,

490 (
SHA256_CTX
),

495 c⁄° 
mëÆök_dige°_def
 
	gSHA256_DIGEST_DEF
[] = {

496 {"sha-256", 
SHA256_DIGEST_PARAMS
}

499 c⁄° 
mëÆök_dige°_def
 
	gSHA1_DIGEST_DEF
[] = {

500 {"sha-1", 
SHA1_DIGEST_PARAMS
}

503 c⁄° 
mëÆök_dige°_def
 
	gMD5_DIGEST_DEF
[] = {

504 {"md5", 
MD5_DIGEST_PARAMS
}

514 c⁄° 
mëÆök_dige°_Æüs
 
	gdige°_Æü£s
[] = {

515 {"sha-256", 
SHA256_DIGEST_DEF
},

516 {"sha256", 
SHA256_DIGEST_DEF
},

517 {"sha-1", 
SHA1_DIGEST_DEF
},

518 {"sha1", 
SHA1_DIGEST_DEF
},

519 {"md5", 
MD5_DIGEST_DEF
},

520 {
NULL
, NULL}

523 
dige°_c⁄ãxt
 *
	$Cuæ_dige°_öô
(c⁄° 
dige°_∑øms
 *
d∑øms
)

525 
dige°_c⁄ãxt
 *
˘xt
;

528 
˘xt
 = 
	`mÆloc
( *ctxt);

530 if(!
˘xt
)

531  
˘xt
;

533 
˘xt
->
dige°_hash˘x
 = 
	`mÆloc
(
d∑øms
->
dige°_˘xtsize
);

535 if(!
˘xt
->
dige°_hash˘x
) {

536 
	`‰ì
(
˘xt
);

537  
NULL
;

540 
˘xt
->
dige°_hash
 = 
d∑øms
;

542 if(
d∑øms
->
	`dige°_öô
(
˘xt
->
dige°_hash˘x
) != 1) {

543 
	`‰ì
(
˘xt
);

544  
NULL
;

547  
˘xt
;

548 
	}
}

550 
	$Cuæ_dige°_upd©e
(
dige°_c⁄ãxt
 *
c⁄ãxt
,

551 c⁄° *
d©a
,

552 
Àn
)

554 (*
c⁄ãxt
->
dige°_hash
->
dige°_upd©e
)(c⁄ãxt->
dige°_hash˘x
, 
d©a
, 
Àn
);

557 
	}
}

559 
	$Cuæ_dige°_föÆ
(
dige°_c⁄ãxt
 *
c⁄ãxt
, *
ªsu…
)

561 (*
c⁄ãxt
->
dige°_hash
->
dige°_föÆ
)(
ªsu…
, c⁄ãxt->
dige°_hash˘x
);

563 
	`‰ì
(
c⁄ãxt
->
dige°_hash˘x
);

564 
	`‰ì
(
c⁄ãxt
);

567 
	}
}

569 
	$hex_to_uöt
(c⁄° *
s
)

571 
v
[2];

572 
i
;

573 
i
 = 0; i < 2; ++i) {

574 
v
[
i
] = 
	`Cuæ_øw_touµî
(
s
[i]);

575 if('0' <
v
[
i
] && v[i] <= '9') {

576 
v
[
i
] -= '0';

578 if('A' <
v
[
i
] && v[i] <= 'Z') {

579 
v
[
i
] -= 'A'-10;

582  ()((
v
[0] << 4) | v[1]);

583 
	}
}

599 
	$check_hash
(c⁄° *
fûíame
,

600 c⁄° 
mëÆök_dige°_def
 *
dige°_def
,

601 c⁄° *
dige°
, 
FILE
 *
îr‹
)

603 *
ªsu…
;

604 
dige°_c⁄ãxt
 *
d˘x
;

605 
check_ok
, 
Êags
, 
fd
;

607 
Êags
 = 
O_RDONLY
;

608 #ifde‡
O_BINARY


610 
Êags
 |
O_BINARY
;

613 
fd
 = 
	`›í
(
fûíame
, 
Êags
);

614 if(
fd
 == -1) {

615 
	`Ârötf
(
îr‹
, "MëÆök: vÆid©ög (%sË[%s] FAILED (%s)\n", 
fûíame
,

616 
dige°_def
->
hash_«me
, 
	`°ªº‹
(
î∫o
));

620 
d˘x
 = 
	`Cuæ_dige°_öô
(
dige°_def
->
d∑øms
);

621 if(!
d˘x
) {

622 
	`Ârötf
(
îr‹
, "MëÆök: vÆid©ög (%sË[%s] FAILED (%s)\n", 
fûíame
,

623 
dige°_def
->
hash_«me
, "failedÅo initialize hashálgorithm");

624 
	`˛o£
(
fd
);

628 
ªsu…
 = 
	`mÆloc
(
dige°_def
->
d∑øms
->
dige°_ªsu…Àn
);

630 
buf
[4096];

631 
ssize_t
 
Àn
 = 
	`ªad
(
fd
, 
buf
, (buf));

632 if(
Àn
 == 0) {

635 if(
Àn
 == -1) {

636 
	`Ârötf
(
îr‹
, "MëÆök: vÆid©ög (%sË[%s] FAILED (%s)\n", 
fûíame
,

637 
dige°_def
->
hash_«me
, 
	`°ªº‹
(
î∫o
));

638 
	`Cuæ_dige°_föÆ
(
d˘x
, 
ªsu…
);

639 
	`˛o£
(
fd
);

642 
	`Cuæ_dige°_upd©e
(
d˘x
, 
buf
, ()
Àn
);

644 
	`Cuæ_dige°_föÆ
(
d˘x
, 
ªsu…
);

645 
check_ok
 = 
	`memcmp
(
ªsu…
, 
dige°
,

646 
dige°_def
->
d∑øms
->
dige°_ªsu…Àn
) == 0;

648 if(
check_ok
)

649 
	`Ârötf
(
îr‹
, "MëÆök: vÆid©ög (%sË[%s] OK\n", 
fûíame
,

650 
dige°_def
->
hash_«me
);

652 
	`Ârötf
(
îr‹
, "Metalink: validating (%s) [%s] FAILED (digest mismatch)\n",

653 
fûíame
, 
dige°_def
->
hash_«me
);

655 
	`‰ì
(
ªsu…
);

656 
	`˛o£
(
fd
);

657  
check_ok
;

658 
	}
}

660 
	$mëÆök_check_hash
(
GlobÆC⁄fig
 *
c⁄fig
,

661 
mëÆökfûe
 *
mlfûe
,

662 c⁄° *
fûíame
)

664 
rv
;

665 
	`Ârötf
(
c⁄fig
->
îr‹s
, "MëÆök: vÆid©ög (%s)...\n", 
fûíame
);

666 if(
mlfûe
->
checksum
 =
NULL
) {

667 
	`Ârötf
(
c⁄fig
->
îr‹s
,

668 "MëÆök: vÆid©ög (%sËFAILED (dige° missög)\n", 
fûíame
);

671 
rv
 = 
	`check_hash
(
fûíame
, 
mlfûe
->
checksum
->
dige°_def
,

672 
mlfûe
->
checksum
->
dige°
, 
c⁄fig
->
îr‹s
);

673  
rv
;

674 
	}
}

676 
mëÆök_checksum
 *
	g√w_mëÆök_checksum_‰om_hex_dige°


677 (c⁄° 
mëÆök_dige°_def
 *
	gdige°_def
, c⁄° *
	ghex_dige°
)

679 
mëÆök_checksum
 *
	gchksum
;

680 *
	gdige°
;

681 
size_t
 
	gi
;

682 
size_t
 
	gÀn
 = 
°æí
(
hex_dige°
);

683 
	gdige°
 = 
mÆloc
(
Àn
/2);

684 
	gi
 = 0; i < 
	gÀn
; i += 2) {

685 
dige°
[
i
/2] = 
hex_to_uöt
(
hex_dige°
+i);

687 
	gchksum
 = 
mÆloc
((
mëÆök_checksum
));

688 
	gchksum
->
	gdige°_def
 = 
dige°_def
;

689 
	gchksum
->
	gdige°
 = 
dige°
;

690  
	gchksum
;

693 
mëÆök_ªsour˚
 *
	$√w_mëÆök_ªsour˚
(c⁄° *
uæ
)

695 
mëÆök_ªsour˚
 *
ªs
;

696 
ªs
 = 
	`mÆloc
((
mëÆök_ªsour˚
));

697 
ªs
->
√xt
 = 
NULL
;

698 
ªs
->
uæ
 = 
	`°rdup
(url);

699  
ªs
;

700 
	}
}

705 
	$check_hex_dige°
(c⁄° *
hex_dige°
,

706 c⁄° 
mëÆök_dige°_def
 *
dige°_def
)

708 
size_t
 
i
;

709 
i
 = 0; 
hex_dige°
[i]; ++i) {

710 
c
 = 
hex_dige°
[
i
];

711 if(!(('0' <
c
 && c <= '9') || ('a' <= c && c <= 'z') ||

712 ('A' <
c
 && c <= 'Z'))) {

716  
dige°_def
->
d∑øms
->
dige°_ªsu…Àn
 * 2 =
i
;

717 
	}
}

719 
mëÆökfûe
 *
	$√w_mëÆökfûe
(
mëÆök_fûe_t
 *
fûeöfo
)

721 
mëÆökfûe
 *
f
;

722 
f
 = (
mëÆökfûe
*)
	`mÆloc
((metalinkfile));

723 
f
->
√xt
 = 
NULL
;

724 
f
->
fûíame
 = 
	`°rdup
(
fûeöfo
->
«me
);

725 
f
->
checksum
 = 
NULL
;

726 
f
->
ªsour˚
 = 
NULL
;

727 if(
fûeöfo
->
checksums
) {

728 c⁄° 
mëÆök_dige°_Æüs
 *
dige°_Æüs
;

729 
dige°_Æüs
 = 
dige°_Æü£s
; dige°_Æüs->
Æüs_«me
;

730 ++
dige°_Æüs
) {

731 
mëÆök_checksum_t
 **
p
;

732 
p
 = 
fûeöfo
->
checksums
; *p; ++p) {

733 if(
	`Cuæ_øw_equÆ
(
dige°_Æüs
->
Æüs_«me
, (*
p
)->
ty≥
) &&

734 
	`check_hex_dige°
((*
p
)->
hash
, 
dige°_Æüs
->
dige°_def
)) {

735 
f
->
checksum
 =

736 
	`√w_mëÆök_checksum_‰om_hex_dige°
(
dige°_Æüs
->
dige°_def
,

737 (*
p
)->
hash
);

741 if(
f
->
checksum
) {

746 if(
fûeöfo
->
ªsour˚s
) {

747 
mëÆök_ªsour˚_t
 **
p
;

748 
mëÆök_ªsour˚
 
roŸ
, *
èû
;

749 
roŸ
.
√xt
 = 
NULL
;

750 
èû
 = &
roŸ
;

751 
p
 = 
fûeöfo
->
ªsour˚s
; *p; ++p) {

752 
mëÆök_ªsour˚
 *
ªs
;

762 if((*
p
)->
ty≥
 =
NULL
 ||

763 
	`Cuæ_øw_equÆ
((*
p
)->
ty≥
, "http") ||

764 
	`Cuæ_øw_equÆ
((*
p
)->
ty≥
, "https") ||

765 
	`Cuæ_øw_equÆ
((*
p
)->
ty≥
, "ftp") ||

766 
	`Cuæ_øw_equÆ
((*
p
)->
ty≥
, "ftps")) {

767 
ªs
 = 
	`√w_mëÆök_ªsour˚
((*
p
)->
uæ
);

768 
èû
->
√xt
 = 
ªs
;

769 
èû
 = 
ªs
;

772 
f
->
ªsour˚
 = 
roŸ
.
√xt
;

774  
f
;

775 
	}
}

777 
	$∑r£_mëÆök
(
O≥øti⁄C⁄fig
 *
c⁄fig
, 
OutSåu˘
 *
outs
,

778 c⁄° *
mëÆök_uæ
)

780 
mëÆök_îr‹_t
 
r
;

781 
mëÆök_t
* 
mëÆök
;

782 
mëÆök_fûe_t
 **
fûes
;

783 
boﬁ
 
w¨nögs
 = 
FALSE
;

786 
r
 = 
	`mëÆök_∑r£_föÆ
(
outs
->
mëÆök_∑r£r
, 
NULL
, 0, &
mëÆök
);

787 
outs
->
mëÆök_∑r£r
 = 
NULL
;

788 if(
r
 != 0) {

791 if(
mëÆök
->
fûes
 =
NULL
) {

792 
	`Ârötf
(
c⁄fig
->
globÆ
->
îr‹s
, "Metalink:Öarsing (%s) WARNING "

794 
mëÆök_uæ
);

795 
	`mëÆök_dñëe
(
mëÆök
);

798 
fûes
 = 
mëÆök
->files; *files; ++files) {

799 
gëout
 *
uæ
;

801 if(!(*
fûes
)->
ªsour˚s
) {

802 
	`Ârötf
(
c⁄fig
->
globÆ
->
îr‹s
, "Metalink:Öarsing (%s) WARNING "

804 
mëÆök_uæ
, (*
fûes
)->
«me
);

807 if(
c⁄fig
->
uæ_gë
 ||

808 ((
c⁄fig
->
uæ_gë
 = c⁄fig->
uæ_li°
Ë!
NULL
)) {

811 
c⁄fig
->
uæ_gë
 && (c⁄fig->uæ_gë->
Êags
 & 
GETOUT_URL
))

812 
c⁄fig
->
uæ_gë
 = c⁄fig->uæ_gë->
√xt
;

817 if(
c⁄fig
->
uæ_gë
)

819 
uæ
 = 
c⁄fig
->
uæ_gë
;

822 
uæ
 = 
	`√w_gëout
(
c⁄fig
);

824 if(
uæ
) {

825 
mëÆökfûe
 *
mlfûe
;

826 
mlfûe
 = 
	`√w_mëÆökfûe
(*
fûes
);

827 if(!
mlfûe
->
checksum
) {

828 
w¨nögs
 = 
TRUE
;

829 
	`Ârötf
(
c⁄fig
->
globÆ
->
îr‹s
,

831 
mëÆök_uæ
);

834 
	`GëSå
(&
uæ
->uæ, 
mlfûe
->
fûíame
);

837 
uæ
->
Êags
 |
GETOUT_URL
 | 
GETOUT_METALINK
;

839 if(
c⁄fig
->
mëÆökfûe_li°
) {

840 
c⁄fig
->
mëÆökfûe_œ°
->
√xt
 = 
mlfûe
;

841 
c⁄fig
->
mëÆökfûe_œ°
 = 
mlfûe
;

844 
c⁄fig
->
mëÆökfûe_li°
 = c⁄fig->
mëÆökfûe_œ°
 = 
mlfûe
;

848 
	`mëÆök_dñëe
(
mëÆök
);

849  (
w¨nögs
) ? -2 : 0;

850 
	}
}

852 
size_t
 
	$mëÆök_wrôe_cb
(*
buf„r
, 
size_t
 
sz
, size_à
nmemb
,

853 *
u£rd©a
)

855 
OutSåu˘
 *
outs
 = 
u£rd©a
;

856 
O≥øti⁄C⁄fig
 *
c⁄fig
 = 
outs
->config;

857 
rv
;

865 c⁄° 
size_t
 
Áûuª
 = (
sz
 * 
nmemb
) ? 0 : 1;

867 if(!
c⁄fig
)

868  
Áûuª
;

870 
rv
 = 
	`mëÆök_∑r£_upd©e
(
outs
->
mëÆök_∑r£r
, 
buf„r
, 
sz
 *
nmemb
);

871 if(
rv
 == 0)

872  
sz
 * 
nmemb
;

874 
	`Ârötf
(
c⁄fig
->
globÆ
->
îr‹s
, "Metalink:Öarsing FAILED\n");

875  
Áûuª
;

877 
	}
}

882 
	$check_c⁄ã¡_ty≥
(c⁄° *
c⁄ã¡_ty≥
, c⁄° *
medü_ty≥
)

884 c⁄° *
±r
 = 
c⁄ã¡_ty≥
;

885 
size_t
 
medü_ty≥_Àn
 = 
	`°æí
(
medü_ty≥
);

886 ; *
±r
 && (*ptr == ' ' || *ptr == '\t'); ++ptr);

887 if(!*
±r
) {

890  
	`Cuæ_øw_√quÆ
(
±r
, 
medü_ty≥
, 
medü_ty≥_Àn
) &&

891 (*(
±r
+
medü_ty≥_Àn
) == '\0' || *(ptr+media_type_len) == ' ' ||

892 *(
±r
+
medü_ty≥_Àn
) == '\t' || *(ptr+media_type_len) == ';');

893 
	}
}

895 
	$check_mëÆök_c⁄ã¡_ty≥
(c⁄° *
c⁄ã¡_ty≥
)

897  
	`check_c⁄ã¡_ty≥
(
c⁄ã¡_ty≥
, "application/metalink+xml");

898 
	}
}

900 
	$cou¡_√xt_mëÆök_ªsour˚
(
mëÆökfûe
 *
mlfûe
)

902 
cou¡
 = 0;

903 
mëÆök_ªsour˚
 *
ªs
;

904 
ªs
 = 
mlfûe
->
ªsour˚
;Ñes;Ñe†ªs->
√xt
, ++
cou¡
);

905  
cou¡
;

906 
	}
}

908 
	$dñëe_mëÆök_checksum
(
mëÆök_checksum
 *
chksum
)

910 if(
chksum
 =
NULL
) {

913 
	`Cuæ_ß„‰ì
(
chksum
->
dige°
);

914 
	`Cuæ_ß„‰ì
(
chksum
);

915 
	}
}

917 
	$dñëe_mëÆök_ªsour˚
(
mëÆök_ªsour˚
 *
ªs
)

919 if(
ªs
 =
NULL
) {

922 
	`Cuæ_ß„‰ì
(
ªs
->
uæ
);

923 
	`Cuæ_ß„‰ì
(
ªs
);

924 
	}
}

926 
	$dñëe_mëÆökfûe
(
mëÆökfûe
 *
mlfûe
)

928 
mëÆök_ªsour˚
 *
ªs
;

929 if(
mlfûe
 =
NULL
) {

932 
	`Cuæ_ß„‰ì
(
mlfûe
->
fûíame
);

933 
	`dñëe_mëÆök_checksum
(
mlfûe
->
checksum
);

934 
ªs
 = 
mlfûe
->
ªsour˚
;Ñes;) {

935 
mëÆök_ªsour˚
 *
√xt
;

936 
√xt
 = 
ªs
->next;

937 
	`dñëe_mëÆök_ªsour˚
(
ªs
);

938 
ªs
 = 
√xt
;

940 
	`Cuæ_ß„‰ì
(
mlfûe
);

941 
	}
}

943 
	$˛ón_mëÆök
(
O≥øti⁄C⁄fig
 *
c⁄fig
)

945 
c⁄fig
->
mëÆökfûe_li°
) {

946 
mëÆökfûe
 *
mlfûe
 = 
c⁄fig
->
mëÆökfûe_li°
;

947 
c⁄fig
->
mëÆökfûe_li°
 = c⁄fig->mëÆökfûe_li°->
√xt
;

948 
	`dñëe_mëÆökfûe
(
mlfûe
);

950 
c⁄fig
->
mëÆökfûe_œ°
 = 0;

951 
	}
}

953 
	$mëÆök_˛ónup
()

955 #ifde‡
USE_NSS


956 if(
nss_c⁄ãxt
) {

957 
	`NSS_ShutdownC⁄ãxt
(
nss_c⁄ãxt
);

958 
nss_c⁄ãxt
 = 
NULL
;

961 
	}
}

	@src/tool_metalink.h

1 #i‚de‡
HEADER_CURL_TOOL_METALINK_H


2 
	#HEADER_CURL_TOOL_METALINK_H


	)

24 
	~"toﬁ_£tup.h
"

26 
	gGlobÆC⁄fig
;

27 
	gO≥øti⁄C⁄fig
;

30 (* 
	tCuæ_dige°_öô_func
)(*
	tc⁄ãxt
);

32 (* 
	tCuæ_dige°_upd©e_func
)(*
	tc⁄ãxt
,

33 c⁄° *
	td©a
,

34 
	tÀn
);

35 (* 
	tCuæ_dige°_föÆ_func
)(*
	tªsu…
, *
	tc⁄ãxt
);

38 
Cuæ_dige°_öô_func
 
dige°_öô
;

39 
Cuæ_dige°_upd©e_func
 
dige°_upd©e
;

40 
Cuæ_dige°_föÆ_func
 
dige°_föÆ
;

41 
dige°_˘xtsize
;

42 
dige°_ªsu…Àn
;

43 } 
	tdige°_∑øms
;

46 c⁄° 
dige°_∑øms
 *
dige°_hash
;

47 *
dige°_hash˘x
;

48 } 
	tdige°_c⁄ãxt
;

50 
dige°_c⁄ãxt
 * 
	`Cuæ_dige°_öô
(c⁄° 
dige°_∑øms
 *
d∑øms
);

51 
	`Cuæ_dige°_upd©e
(
dige°_c⁄ãxt
 *
c⁄ãxt
,

52 c⁄° *
d©a
,

53 
Àn
);

54 
	`Cuæ_dige°_föÆ
(
dige°_c⁄ãxt
 *
c⁄ãxt
, *
ªsu…
);

57 c⁄° *
hash_«me
;

58 c⁄° 
dige°_∑øms
 *
d∑øms
;

59 } 
	tmëÆök_dige°_def
;

62 c⁄° *
Æüs_«me
;

63 c⁄° 
mëÆök_dige°_def
 *
dige°_def
;

64 } 
	tmëÆök_dige°_Æüs
;

66 
	smëÆök_checksum
 {

67 c⁄° 
mëÆök_dige°_def
 *
dige°_def
;

69 *
dige°
;

70 } 
	tmëÆök_checksum
;

72 
	smëÆök_ªsour˚
 {

73 
mëÆök_ªsour˚
 *
√xt
;

74 *
uæ
;

75 } 
	tmëÆök_ªsour˚
;

77 
	smëÆökfûe
 {

78 
mëÆökfûe
 *
√xt
;

79 *
fûíame
;

80 
mëÆök_checksum
 *
checksum
;

81 
mëÆök_ªsour˚
 *
ªsour˚
;

82 } 
	tmëÆökfûe
;

84 #ifde‡
USE_METALINK


89 
	#CURL_REQ_LIBMETALINK_MAJOR
 0

	)

90 
	#CURL_REQ_LIBMETALINK_MINOR
 1

	)

91 
	#CURL_REQ_LIBMETALINK_PATCH
 0

	)

93 
	#CURL_REQ_LIBMETALINK_VERS
 ((
CURL_REQ_LIBMETALINK_MAJOR
 * 10000) + \

94 (
CURL_REQ_LIBMETALINK_MINOR
 * 100) + \

95 
CURL_REQ_LIBMETALINK_PATCH
)

	)

97 c⁄° 
dige°_∑øms
 
MD5_DIGEST_PARAMS
[1];

98 c⁄° 
dige°_∑øms
 
SHA1_DIGEST_PARAMS
[1];

99 c⁄° 
dige°_∑øms
 
SHA256_DIGEST_PARAMS
[1];

101 
	~<mëÆök/mëÆök.h
>

106 
	`cou¡_√xt_mëÆök_ªsour˚
(
mëÆökfûe
 *
mlfûe
);

107 
	`˛ón_mëÆök
(
O≥øti⁄C⁄fig
 *
c⁄fig
);

119 
	`∑r£_mëÆök
(
O≥øti⁄C⁄fig
 *
c⁄fig
, 
OutSåu˘
 *
outs
,

120 c⁄° *
mëÆök_uæ
);

125 
size_t
 
	`mëÆök_wrôe_cb
(*
buf„r
, size_à
sz
, size_à
nmemb
,

126 *
u£rd©a
);

132 
	`check_mëÆök_c⁄ã¡_ty≥
(c⁄° *
c⁄ã¡_ty≥
);

148 
	`mëÆök_check_hash
(
GlobÆC⁄fig
 *
c⁄fig
,

149 
mëÆökfûe
 *
mlfûe
,

150 c⁄° *
fûíame
);

155 
	`mëÆök_˛ónup
();

159 
	#cou¡_√xt_mëÆök_ªsour˚
(
x
Ë0

	)

160 
	#˛ón_mëÆök
(
x
Ë()
	)
x

163 
	#mëÆök_˛ónup
(Ë
Cuæ_n›_°mt


	)

	@src/tool_mfiles.c

22 
	~"toﬁ_£tup.h
"

24 
	~"toﬁ_mfûes.h
"

26 
	~"memdebug.h
"

28 
	$AµídNode
(
mu…i_fûes
 **
fú°
,

29 
mu…i_fûes
 **
œ°
,

30 
mu…i_fûes
 *
√w
)

32 
	`DEBUGASSERT
(((*
fú°
Ë&& (*
œ°
)) || ((!*first) && (!*last)));

34 if(*
œ°
)

35 (*
œ°
)->
√xt
 = 
√w
;

37 *
fú°
 = 
√w
;

38 *
œ°
 = 
√w
;

39 
	}
}

58 
mu…i_fûes
 *
	$AddMu…iFûes
(c⁄° *
fûe_«me
,

59 c⁄° *
ty≥_«me
,

60 c⁄° *
show_fûíame
,

61 
mu…i_fûes
 **
mu…i_fú°
,

62 
mu…i_fûes
 **
mu…i_œ°
)

64 
mu…i_fûes
 *
mu…i
;

65 
mu…i_fûes
 *
mu…i_ty≥
;

66 
mu…i_fûes
 *
mu…i_«me
;

68 
mu…i
 = 
	`ˇŒoc
(1, (
mu…i_fûes
));

69 if(
mu…i
) {

70 
mu…i
->
f‹m
.
›ti⁄
 = 
CURLFORM_FILE
;

71 
mu…i
->
f‹m
.
vÆue
 = 
fûe_«me
;

72 
	`AµídNode
(
mu…i_fú°
, 
mu…i_œ°
, 
mu…i
);

75 
	`FªeMu…iInfo
(
mu…i_fú°
, 
mu…i_œ°
);

76  
NULL
;

79 if(
ty≥_«me
) {

80 
mu…i_ty≥
 = 
	`ˇŒoc
(1, (
mu…i_fûes
));

81 if(
mu…i_ty≥
) {

82 
mu…i_ty≥
->
f‹m
.
›ti⁄
 = 
CURLFORM_CONTENTTYPE
;

83 
mu…i_ty≥
->
f‹m
.
vÆue
 = 
ty≥_«me
;

84 
	`AµídNode
(
mu…i_fú°
, 
mu…i_œ°
, 
mu…i_ty≥
);

87 
	`FªeMu…iInfo
(
mu…i_fú°
, 
mu…i_œ°
);

88  
NULL
;

92 if(
show_fûíame
) {

93 
mu…i_«me
 = 
	`ˇŒoc
(1, (
mu…i_fûes
));

94 if(
mu…i_«me
) {

95 
mu…i_«me
->
f‹m
.
›ti⁄
 = 
CURLFORM_FILENAME
;

96 
mu…i_«me
->
f‹m
.
vÆue
 = 
show_fûíame
;

97 
	`AµídNode
(
mu…i_fú°
, 
mu…i_œ°
, 
mu…i_«me
);

100 
	`FªeMu…iInfo
(
mu…i_fú°
, 
mu…i_œ°
);

101  
NULL
;

105  *
mu…i_œ°
;

106 
	}
}

112 
	$FªeMu…iInfo
(
mu…i_fûes
 **
mu…i_fú°
,

113 
mu…i_fûes
 **
mu…i_œ°
)

115 
mu…i_fûes
 *
√xt
;

116 
mu…i_fûes
 *
ôem
 = *
mu…i_fú°
;

118 
ôem
) {

119 
√xt
 = 
ôem
->next;

120 
	`Cuæ_ß„‰ì
(
ôem
);

121 
ôem
 = 
√xt
;

123 *
mu…i_fú°
 = 
NULL
;

124 if(
mu…i_œ°
)

125 *
mu…i_œ°
 = 
NULL
;

126 
	}
}

	@src/tool_mfiles.h

1 #i‚de‡
HEADER_CURL_TOOL_MFILES_H


2 
	#HEADER_CURL_TOOL_MFILES_H


	)

24 
	~"toﬁ_£tup.h
"

31 
	smu…i_fûes
 {

32 
cuæ_f‹ms
 
	mf‹m
;

33 
mu…i_fûes
 *
	m√xt
;

36 
mu…i_fûes
 *
AddMu…iFûes
(c⁄° *
fûe_«me
,

37 c⁄° *
ty≥_«me
,

38 c⁄° *
show_fûíame
,

39 
mu…i_fûes
 **
mu…i_fú°
,

40 
mu…i_fûes
 **
mu…i_œ°
);

42 
FªeMu…iInfo
(
mu…i_fûes
 **
mu…i_fú°
,

43 
mu…i_fûes
 **
mu…i_œ°
);

	@src/tool_msgs.c

22 
	~"toﬁ_£tup.h
"

24 
	#ENABLE_CURLX_PRINTF


	)

26 
	~"cuæx.h
"

28 
	~"toﬁ_cfgabÀ.h
"

29 
	~"toﬁ_msgs.h
"

31 
	~"memdebug.h
"

33 
	#WARN_PREFIX
 "W¨nög: "

	)

34 
	#WARN_TEXTWIDTH
 (79 - ()
	`°æí
(
WARN_PREFIX
))

	)

41 
	$w¨nf
(
O≥øti⁄C⁄fig
 *
c⁄fig
, c⁄° *
fmt
, ...)

43 if(!
c⁄fig
->
globÆ
->
muã
) {

44 
va_li°
 
≠
;

45 
Àn
;

46 *
±r
;

47 
¥öt_buf„r
[256];

49 
	`va_°¨t
(
≠
, 
fmt
);

50 
Àn
 = 
	`v¢¥ötf
(
¥öt_buf„r
, ’röt_buf„r), 
fmt
, 
≠
);

51 
	`va_íd
(
≠
);

53 
±r
 = 
¥öt_buf„r
;

54 
Àn
 > 0) {

55 
	`Âuts
(
WARN_PREFIX
, 
c⁄fig
->
globÆ
->
îr‹s
);

57 if(
Àn
 > ()
WARN_TEXTWIDTH
) {

58 
cut
 = 
WARN_TEXTWIDTH
-1;

60 !
	`ISSPACE
(
±r
[
cut
]) && cut) {

61 
cut
--;

63 if(0 =
cut
)

66 
cut
 = 
WARN_TEXTWIDTH
-1;

68 ()
	`fwrôe
(
±r
, 
cut
 + 1, 1, 
c⁄fig
->
globÆ
->
îr‹s
);

69 
	`Âuts
("\n", 
c⁄fig
->
globÆ
->
îr‹s
);

70 
±r
 +
cut
+1;

71 
Àn
 -
cut
;

74 
	`Âuts
(
±r
, 
c⁄fig
->
globÆ
->
îr‹s
);

75 
Àn
 = 0;

79 
	}
}

85 
	$hñpf
(
FILE
 *
îr‹s
, c⁄° *
fmt
, ...)

87 
va_li°
 
≠
;

88 if(
fmt
) {

89 
	`va_°¨t
(
≠
, 
fmt
);

90 
	`Âuts
("cuæ: ", 
îr‹s
);

91 
	`vÂrötf
(
îr‹s
, 
fmt
, 
≠
);

92 
	`va_íd
(
≠
);

94 
	`Ârötf
(
îr‹s
, "curl:Åry 'curl --help' "

95 #ifde‡
USE_MANUAL


99 
	}
}

	@src/tool_msgs.h

1 #i‚de‡
HEADER_CURL_TOOL_MSGS_H


2 
	#HEADER_CURL_TOOL_MSGS_H


	)

24 
	~"toﬁ_£tup.h
"

26 
w¨nf
(
O≥øti⁄C⁄fig
 *
c⁄fig
, c⁄° *
fmt
, ...);

28 
hñpf
(
FILE
 *
îr‹s
, c⁄° *
fmt
, ...);

	@src/tool_operate.c

22 
	~"toﬁ_£tup.h
"

24 #ifde‡
HAVE_FCNTL_H


25 
	~<f˙é.h
>

28 #ifde‡
HAVE_UTIME_H


29 
	~<utime.h
>

30 #ñi‡
deföed
(
HAVE_SYS_UTIME_H
)

31 
	~<sys/utime.h
>

34 #ifde‡
HAVE_LOCALE_H


35 
	~<loˇÀ.h
>

38 #ifde‡
HAVE_NETINET_TCP_H


39 
	~<√töë/t˝.h
>

42 #ifde‡
__VMS


43 
	~<Ábdef.h
>

46 
	~"øw°r.h
"

48 
	#ENABLE_CURLX_PRINTF


	)

50 
	~"cuæx.h
"

52 
	~"toﬁ_bömode.h
"

53 
	~"toﬁ_cfgabÀ.h
"

54 
	~"toﬁ_cb_dbg.h
"

55 
	~"toﬁ_cb_hdr.h
"

56 
	~"toﬁ_cb_¥g.h
"

57 
	~"toﬁ_cb_ªa.h
"

58 
	~"toﬁ_cb_£e.h
"

59 
	~"toﬁ_cb_wπ.h
"

60 
	~"toﬁ_dúhõ.h
"

61 
	~"toﬁ_doswö.h
"

62 
	~"toﬁ_ósy§c.h
"

63 
	~"toﬁ_gë∑øm.h
"

64 
	~"toﬁ_hñ≥rs.h
"

65 
	~"toﬁ_homedú.h
"

66 
	~"toﬁ_liböfo.h
"

67 
	~"toﬁ_maö.h
"

68 
	~"toﬁ_mëÆök.h
"

69 
	~"toﬁ_msgs.h
"

70 
	~"toﬁ_›î©e.h
"

71 
	~"toﬁ_›îhÕ.h
"

72 
	~"toﬁ_∑ømhÕ.h
"

73 
	~"toﬁ_∑r£cfg.h
"

74 
	~"toﬁ_£t›t.h
"

75 
	~"toﬁ_¶ìp.h
"

76 
	~"toﬁ_uæglob.h
"

77 
	~"toﬁ_utû.h
"

78 
	~"toﬁ_wrôìnv.h
"

79 
	~"toﬁ_wrôeout.h
"

80 
	~"toﬁ_x©å.h
"

81 
	~"toﬁ_vms.h
"

82 
	~"toﬁ_hñp.h
"

83 
	~"toﬁ_hugehñp.h
"

85 
	~"memdebug.h
"

87 #ifde‡
CURLDEBUG


89 
CURLcode
 
cuæ_ósy_≥rf‹m_ev
(
CURL
 *
ósy
);

92 
	#CURL£∑øt‹
 "--_cuæ_--"

	)

94 #i‚de‡
O_BINARY


97 
	#O_BINARY
 0

	)

100 
	#CURL_CA_CERT_ERRORMSG1
 \

106 " usögÅhê--ˇ˚π o±i⁄.\n"

	)

108 
	#CURL_CA_CERT_ERRORMSG2
 \

114 "Åhê-k (‹ --ö£cuªË›ti⁄.\n"

	)

116 
boﬁ
 
	$is_Áèl_îr‹
(
CURLcode
 
code
)

118 
code
) {

120 
CURLE_FAILED_INIT
:

121 
CURLE_OUT_OF_MEMORY
:

122 
CURLE_UNKNOWN_OPTION
:

123 
CURLE_FUNCTION_NOT_FOUND
:

124 
CURLE_BAD_FUNCTION_ARGUMENT
:

126  
TRUE
;

132  
FALSE
;

133 
	}
}

135 #ifde‡
__VMS


146 
cuæ_off_t
 
	$vms_ªÆfûesize
(c⁄° * 
«me
,

147 c⁄° 
°ru˘_°©
 * 
°©_buf
)

149 
buf„r
[8192];

150 
cuæ_off_t
 
cou¡
;

151 
ªt_°©
;

152 
FILE
 * 
fûe
;

154 
fûe
 = 
	`f›í
(
«me
, "r");

155 if(
fûe
 =
NULL
) {

158 
cou¡
 = 0;

159 
ªt_°©
 = 1;

160 
ªt_°©
 > 0) {

161 
ªt_°©
 = 
	`‰ód
(
buf„r
, 1, (buf„r), 
fûe
);

162 if(
ªt_°©
 != 0)

163 
cou¡
 +
ªt_°©
;

165 
	`f˛o£
(
fûe
);

167  
cou¡
;

168 
	}
}

176 
cuæ_off_t
 
	$VmsS≥cülSize
(c⁄° * 
«me
,

177 c⁄° 
°ru˘_°©
 * 
°©_buf
)

179 
°©_buf
->
°_Áb_rfm
) {

180 
FAB$C_VAR
:

181 
FAB$C_VFC
:

182  
	`vms_ªÆfûesize
(
«me
, 
°©_buf
);

185  
°©_buf
->
°_size
;

187 
	}
}

190 
CURLcode
 
	$›î©e_do
(
GlobÆC⁄fig
 *
globÆ
,

191 
O≥øti⁄C⁄fig
 *
c⁄fig
)

193 
îr‹buf„r
[
CURL_ERROR_SIZE
];

194 
ProgªssD©a
 
¥ogªssb¨
;

195 
gëout
 *
uænode
;

197 
HdrCbD©a
 
hdrcbd©a
;

198 
OutSåu˘
 
hóds
;

200 
mëÆökfûe
 *
mlfûe_œ°
 = 
NULL
;

202 
CURL
 *
cuæ
 = 
c⁄fig
->
ósy
;

203 *
hâpgëfõlds
 = 
NULL
;

205 
CURLcode
 
ªs
 = 
CURLE_OK
;

206 
li
;

209 
boﬁ
 
‹ig_n›rogªss
 = 
globÆ
->
n›rogªss
;

210 
boﬁ
 
‹ig_ißây
 = 
globÆ
->
ißây
;

212 
îr‹buf„r
[0] = '\0';

215 
	`mem£t
(&
hdrcbd©a
, 0, (
HdrCbD©a
));

216 
	`mem£t
(&
hóds
, 0, (
OutSåu˘
));

217 
hóds
.
°ªam
 = 
°dout
;

218 
hóds
.
c⁄fig
 = config;

227 if(!
c⁄fig
->
uæ_li°
 || !c⁄fig->uæ_li°->
uæ
) {

228 
	`hñpf
(
globÆ
->
îr‹s
, "no URL specified!\n");

229 
ªs
 = 
CURLE_FAILED_INIT
;

230 
quô_cuæ
;

242 if(!
c⁄fig
->
ˇ˚π
 &&

243 !
c⁄fig
->
ˇ∑th
 &&

244 !
c⁄fig
->
ö£cuª_ok
) {

245 *
ív
;

246 
ív
 = 
	`cuæx_gëív
("CURL_CA_BUNDLE");

247 if(
ív
) {

248 
c⁄fig
->
ˇ˚π
 = 
	`°rdup
(
ív
);

249 if(!
c⁄fig
->
ˇ˚π
) {

250 
	`cuæ_‰ì
(
ív
);

251 
	`hñpf
(
globÆ
->
îr‹s
, "out of memory\n");

252 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

253 
quô_cuæ
;

257 
ív
 = 
	`cuæx_gëív
("SSL_CERT_DIR");

258 if(
ív
) {

259 
c⁄fig
->
ˇ∑th
 = 
	`°rdup
(
ív
);

260 if(!
c⁄fig
->
ˇ∑th
) {

261 
	`cuæ_‰ì
(
ív
);

262 
	`hñpf
(
globÆ
->
îr‹s
, "out of memory\n");

263 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

264 
quô_cuæ
;

268 
ív
 = 
	`cuæx_gëív
("SSL_CERT_FILE");

269 if(
ív
) {

270 
c⁄fig
->
ˇ˚π
 = 
	`°rdup
(
ív
);

271 if(!
c⁄fig
->
ˇ˚π
) {

272 
	`cuæ_‰ì
(
ív
);

273 
	`hñpf
(
globÆ
->
îr‹s
, "out of memory\n");

274 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

275 
quô_cuæ
;

281 if(
ív
)

282 
	`cuæ_‰ì
(
ív
);

283 #ifde‡
WIN32


285 
ªs
 = 
	`FödWö32CACît
(
c⁄fig
, "curl-ca-bundle.crt");

286 if(
ªs
)

287 
quô_cuæ
;

292 if(
c⁄fig
->
po°fõlds
) {

293 if(
c⁄fig
->
u£_hâpgë
) {

295 
hâpgëfõlds
 = 
	`°rdup
(
c⁄fig
->
po°fõlds
);

296 
	`Cuæ_ß„‰ì
(
c⁄fig
->
po°fõlds
);

297 if(!
hâpgëfõlds
) {

298 
	`hñpf
(
globÆ
->
îr‹s
, "out of memory\n");

299 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

300 
quô_cuæ
;

302 if(
	`SëHTTPªque°
(
c⁄fig
,

303 (
c⁄fig
->
no_body
?
HTTPREQ_HEAD
:
HTTPREQ_GET
),

304 &
c⁄fig
->
hâ¥eq
)) {

305 
ªs
 = 
CURLE_FAILED_INIT
;

306 
quô_cuæ
;

310 if(
	`SëHTTPªque°
(
c⁄fig
, 
HTTPREQ_SIMPLEPOST
, &c⁄fig->
hâ¥eq
)) {

311 
ªs
 = 
CURLE_FAILED_INIT
;

312 
quô_cuæ
;

318 if(
c⁄fig
->
hódîfûe
) {

320 if(!
	`cuæx_°ªquÆ
(
c⁄fig
->
hódîfûe
, "-")) {

321 
FILE
 *
√wfûe
 = 
	`f›í
(
c⁄fig
->
hódîfûe
, "wb");

322 if(!
√wfûe
) {

323 
	`w¨nf
(
c⁄fig
, "FaûedÅÿ›í %s\n", c⁄fig->
hódîfûe
);

324 
ªs
 = 
CURLE_WRITE_ERROR
;

325 
quô_cuæ
;

328 
hóds
.
fûíame
 = 
c⁄fig
->
hódîfûe
;

329 
hóds
.
s_i§eg
 = 
TRUE
;

330 
hóds
.
f›íed
 = 
TRUE
;

331 
hóds
.
°ªam
 = 
√wfûe
;

336 
	`£t_bömode
(
hóds
.
°ªam
);

346 
uænode
 = 
c⁄fig
->
uæ_li°
; uænode; uænodêuænode->
√xt
) {

348 
up
;

349 *
öfûes
;

350 *
outfûes
;

351 
öfûíum
;

352 
URLGlob
 *
öglob
;

354 
mëÆök
 = 0;

355 
mëÆökfûe
 *
mlfûe
;

356 
mëÆök_ªsour˚
 *
mÃes
;

358 
outfûes
 = 
NULL
;

359 
öfûíum
 = 1;

360 
öglob
 = 
NULL
;

362 if(
uænode
->
Êags
 & 
GETOUT_METALINK
) {

363 
mëÆök
 = 1;

364 if(
mlfûe_œ°
 =
NULL
) {

365 
mlfûe_œ°
 = 
c⁄fig
->
mëÆökfûe_li°
;

367 
mlfûe
 = 
mlfûe_œ°
;

368 
mlfûe_œ°
 = mlfûe_œ°->
√xt
;

369 
mÃes
 = 
mlfûe
->
ªsour˚
;

372 
mlfûe
 = 
NULL
;

373 
mÃes
 = 
NULL
;

378 if(!
uænode
->
uæ
) {

381 
	`Cuæ_ß„‰ì
(
uænode
->
outfûe
);

382 
	`Cuæ_ß„‰ì
(
uænode
->
öfûe
);

383 
uænode
->
Êags
 = 0;

388 if(
uænode
->
outfûe
) {

389 
outfûes
 = 
	`°rdup
(
uænode
->
outfûe
);

390 if(!
outfûes
) {

391 
	`hñpf
(
globÆ
->
îr‹s
, "out of memory\n");

392 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

397 
öfûes
 = 
uænode
->
öfûe
;

399 if(!
c⁄fig
->
globoff
 && 
öfûes
) {

401 
ªs
 = (
CURLcode
Ë
	`glob_uæ
(&
öglob
, 
öfûes
, &
öfûíum
,

402 
globÆ
->
showîr‹
?globÆ->
îr‹s
:
NULL
);

403 if(
ªs
) {

404 
	`Cuæ_ß„‰ì
(
outfûes
);

411 
up
 = 0 ; u∞< 
öfûíum
; up++) {

413 *
u∂ﬂdfûe
;

414 
£∑øt‹
;

415 
URLGlob
 *
uæs
;

416 
uænum
;

418 
u∂ﬂdfûe
 = 
NULL
;

419 
uæs
 = 
NULL
;

420 
uænum
 = 0;

422 if(!
up
 && !
öfûes
)

423 
Cuæ_n›_°mt
;

425 if(
öglob
) {

426 
ªs
 = (
CURLcode
Ë
	`glob_√xt_uæ
(&
u∂ﬂdfûe
, 
öglob
);

427 if(
ªs
 =
CURLE_OUT_OF_MEMORY
)

428 
	`hñpf
(
globÆ
->
îr‹s
, "out of memory\n");

430 if(!
up
) {

431 
u∂ﬂdfûe
 = 
	`°rdup
(
öfûes
);

432 if(!
u∂ﬂdfûe
) {

433 
	`hñpf
(
globÆ
->
îr‹s
, "out of memory\n");

434 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

438 
u∂ﬂdfûe
 = 
NULL
;

439 if(!
u∂ﬂdfûe
)

443 if(
mëÆök
) {

446 
uænum
 = 
	`cou¡_√xt_mëÆök_ªsour˚
(
mlfûe
);

449 if(!
c⁄fig
->
globoff
) {

452 
ªs
 = (
CURLcode
Ë
	`glob_uæ
(&
uæs
, 
uænode
->
uæ
, &
uænum
,

453 
globÆ
->
showîr‹
?globÆ->
îr‹s
:
NULL
);

454 if(
ªs
) {

455 
	`Cuæ_ß„‰ì
(
u∂ﬂdfûe
);

460 
uænum
 = 1;

463 
£∑øt‹
((!
outfûes
 || 
	`cuæx_°ªquÆ
(outfûes, "-")Ë&& 
uænum
 > 1);

466 
li
 = 0 ;Üò< 
uænum
;Üi++) {

468 
öfd
;

469 
boﬁ
 
öfd›í
;

470 *
outfûe
;

471 
OutSåu˘
 
outs
;

472 
InSåu˘
 
öput
;

473 
timevÆ
 
ªåy°¨t
;

474 
cuæ_off_t
 
u∂ﬂdfûesize
;

475 
ªåy_numªåõs
;

476 
ªåy_¶ìp_deÁu…
;

477 
ªåy_¶ìp
;

478 *
this_uæ
 = 
NULL
;

479 
mëÆök_√xt_ªs
 = 0;

481 
outfûe
 = 
NULL
;

482 
öfd›í
 = 
FALSE
;

483 
öfd
 = 
STDIN_FILENO
;

484 
u∂ﬂdfûesize
 = -1;

487 
	`mem£t
(&
outs
, 0, (
OutSåu˘
));

488 
outs
.
°ªam
 = 
°dout
;

489 
outs
.
c⁄fig
 = config;

491 if(
mëÆök
) {

494 
outfûe
 = 
	`°rdup
(
mlfûe
->
fûíame
);

495 if(!
outfûe
) {

496 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

497 
show_îr‹
;

499 
this_uæ
 = 
	`°rdup
(
mÃes
->
uæ
);

500 if(!
this_uæ
) {

501 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

502 
show_îr‹
;

506 if(
uæs
) {

507 
ªs
 = (
CURLcode
Ë
	`glob_√xt_uæ
(&
this_uæ
, 
uæs
);

508 if(
ªs
)

509 
show_îr‹
;

511 if(!
li
) {

512 
this_uæ
 = 
	`°rdup
(
uænode
->
uæ
);

513 if(!
this_uæ
) {

514 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

515 
show_îr‹
;

519 
this_uæ
 = 
NULL
;

520 if(!
this_uæ
)

523 if(
outfûes
) {

524 
outfûe
 = 
	`°rdup
(
outfûes
);

525 if(!
outfûe
) {

526 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

527 
show_îr‹
;

532 if(((
uænode
->
Êags
&
GETOUT_USEREMOTE
) ||

533 (
outfûe
 && !
	`cuæx_°ªquÆ
("-", outfile))) &&

534 (
mëÆök
 || !
c⁄fig
->
u£_mëÆök
)) {

541 if(!
outfûe
) {

543 
ªs
 = 
	`gë_uæ_fûe_«me
(&
outfûe
, 
this_uæ
);

544 if(
ªs
)

545 
show_îr‹
;

546 if((!
outfûe
 || !*outfûeË&& !
c⁄fig
->
c⁄ã¡_di•osôi⁄
) {

547 
	`hñpf
(
globÆ
->
îr‹s
, "Remote fileÇame hasÇoÜength!\n");

548 
ªs
 = 
CURLE_WRITE_ERROR
;

549 
quô_uæs
;

551 #i‡
	`deföed
(
MSDOS
Ë|| deföed(
WIN32
)

554 
outfûe
 = 
	`ßnôize_dos_«me
(outfile);

555 if(!
outfûe
) {

556 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

557 
show_îr‹
;

561 if(
uæs
) {

563 *
°‹efûe
 = 
outfûe
;

564 
ªs
 = (
CURLcode
Ë
	`glob_m©ch_uæ
(&
outfûe
, 
°‹efûe
, 
uæs
);

565 
	`Cuæ_ß„‰ì
(
°‹efûe
);

566 if(
ªs
) {

568 
	`w¨nf
(
c⁄fig
, "bad output glob!\n");

569 
quô_uæs
;

576 if(
c⁄fig
->
¸óã_dús
 || 
mëÆök
) {

577 
ªs
 = 
	`¸óã_dú_hõørchy
(
outfûe
, 
globÆ
->
îr‹s
);

579 if(
ªs
 =
CURLE_WRITE_ERROR
)

580 
quô_uæs
;

581 if(
ªs
) {

582 
show_îr‹
;

586 if((
uænode
->
Êags
 & 
GETOUT_USEREMOTE
)

587 && 
c⁄fig
->
c⁄ã¡_di•osôi⁄
) {

589 
	`DEBUGASSERT
(!
outs
.
fûíame
);

592 if(
c⁄fig
->
ªsume_‰om_cuºít
) {

595 
°ru˘_°©
 
fûeöfo
;

597 if(0 =
	`°©
(
outfûe
, &
fûeöfo
))

599 
c⁄fig
->
ªsume_‰om
 = 
fûeöfo
.
°_size
;

602 
c⁄fig
->
ªsume_‰om
 = 0;

605 if(
c⁄fig
->
ªsume_‰om
) {

606 #ifde‡
__VMS


609 
FILE
 *
fûe
 = 
	`f›í
(
outfûe
, 
c⁄fig
->
ªsume_‰om
?"ab":"wb",

613 
FILE
 *
fûe
 = 
	`f›í
(
outfûe
, 
c⁄fig
->
ªsume_‰om
?"ab":"wb");

615 if(!
fûe
) {

616 
	`hñpf
(
globÆ
->
îr‹s
, "C™'à›í '%s'!\n", 
outfûe
);

617 
ªs
 = 
CURLE_WRITE_ERROR
;

618 
quô_uæs
;

620 
outs
.
f›íed
 = 
TRUE
;

621 
outs
.
°ªam
 = 
fûe
;

622 
outs
.
öô
 = 
c⁄fig
->
ªsume_‰om
;

625 
outs
.
°ªam
 = 
NULL
;

627 
outs
.
fûíame
 = 
outfûe
;

628 
outs
.
s_i§eg
 = 
TRUE
;

631 if(
u∂ﬂdfûe
 && !
	`°dö_u∂ﬂd
(uploadfile)) {

635 
°ru˘_°©
 
fûeöfo
;

637 
this_uæ
 = 
	`add_fûe_«me_to_uæ
(
cuæ
,Åhis_uæ, 
u∂ﬂdfûe
);

638 if(!
this_uæ
) {

639 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

640 
show_îr‹
;

656 #ifde‡
__VMS


658 
öfd
 = -1;

659 if(
	`°©
(
u∂ﬂdfûe
, &
fûeöfo
) == 0) {

660 
fûeöfo
.
°_size
 = 
	`VmsS≥cülSize
(
u∂ﬂdfûe
, &fileinfo);

661 
fûeöfo
.
°_Áb_rfm
) {

662 
FAB$C_VAR
:

663 
FAB$C_VFC
:

664 
FAB$C_STMCR
:

665 
öfd
 = 
	`›í
(
u∂ﬂdfûe
, 
O_RDONLY
 | 
O_BINARY
);

668 
öfd
 = 
	`›í
(
u∂ﬂdfûe
, 
O_RDONLY
 | 
O_BINARY
,

672 if(
öfd
 == -1)

674 
öfd
 = 
	`›í
(
u∂ﬂdfûe
, 
O_RDONLY
 | 
O_BINARY
);

675 if((
öfd
 =-1Ë|| 
	`f°©
(öfd, &
fûeöfo
))

678 
	`hñpf
(
globÆ
->
îr‹s
, "C™'à›í '%s'!\n", 
u∂ﬂdfûe
);

679 if(
öfd
 != -1) {

680 
	`˛o£
(
öfd
);

681 
öfd
 = 
STDIN_FILENO
;

683 
ªs
 = 
CURLE_READ_ERROR
;

684 
quô_uæs
;

686 
öfd›í
 = 
TRUE
;

689 if(
	`S_ISREG
(
fûeöfo
.
°_mode
))

690 
u∂ﬂdfûesize
 = 
fûeöfo
.
°_size
;

693 if(
u∂ﬂdfûe
 && 
	`°dö_u∂ﬂd
(uploadfile)) {

696 
authbôs
 = 0;

697 
bôcheck
 = 0;

698 
bôcheck
 < 32) {

699 if(
c⁄fig
->
authty≥
 & (1UL << 
bôcheck
++)) {

700 
authbôs
++;

701 if(
authbôs
 > 1) {

712 if(
c⁄fig
->
¥oxy™yauth
 || (
authbôs
>1)) {

713 
	`w¨nf
(
c⁄fig
,

719 
	`DEBUGASSERT
(
öfd›í
 =
FALSE
);

720 
	`DEBUGASSERT
(
öfd
 =
STDIN_FILENO
);

722 
	`£t_bömode
(
°dö
);

723 if(
	`cuæx_°ªquÆ
(
u∂ﬂdfûe
, ".")) {

724 if(
	`cuæx_n⁄block
((
cuæ_sockë_t
)
öfd
, 
TRUE
) < 0)

725 
	`w¨nf
(
c⁄fig
,

726 "f˙é faûed o¿fd=%d: %s\n", 
öfd
, 
	`°ªº‹
(
î∫o
));

730 if(
u∂ﬂdfûe
 && 
c⁄fig
->
ªsume_‰om_cuºít
)

731 
c⁄fig
->
ªsume_‰om
 = -1;

733 if(
	`ouçut_ex≥˘ed
(
this_uæ
, 
u∂ﬂdfûe
Ë&& 
outs
.
°ªam
 &&

734 
	`ißây
(
	`fûío
(
outs
.
°ªam
)))

737 
globÆ
->
n›rogªss
 = globÆ->
ißây
 = 
TRUE
;

741 
globÆ
->
n›rogªss
 = 
‹ig_n›rogªss
;

742 
globÆ
->
ißây
 = 
‹ig_ißây
;

745 if(
uænum
 > 1 && !
globÆ
->
muã
) {

746 
	`Ârötf
(
globÆ
->
îr‹s
, "\n[%lu/%lu]: %s --> %s\n",

747 
li
+1, 
uænum
, 
this_uæ
, 
outfûe
 ? outfile : "<stdout>");

748 if(
£∑øt‹
)

749 
	`¥ötf
("%s%s\n", 
CURL£∑øt‹
, 
this_uæ
);

751 if(
hâpgëfõlds
) {

752 *
uæbuf„r
;

754 c⁄° *
pc
 = 
	`°r°r
(
this_uæ
, "://");

755 
£p
 = '?';

756 if(
pc
)

757 
pc
 += 3;

759 
pc
 = 
this_uæ
;

761 
pc
 = 
	`°ºchr
(pc, '/');

763 if(
pc
) {

766 if(
	`°rchr
(
pc
, '?'))

769 
£p
='&';

774 if(
pc
)

775 
uæbuf„r
 = 
	`≠rötf
("%s%c%s", 
this_uæ
, 
£p
, 
hâpgëfõlds
);

780 
uæbuf„r
 = 
	`≠rötf
("%s/?%s", 
this_uæ
, 
hâpgëfõlds
);

782 if(!
uæbuf„r
) {

783 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

784 
show_îr‹
;

787 
	`Cuæ_ß„‰ì
(
this_uæ
);

788 
this_uæ
 = 
uæbuf„r
;

791 if(!
globÆ
->
îr‹s
)

792 
globÆ
->
îr‹s
 = 
°dîr
;

794 if((!
outfûe
 || !
	`°rcmp
(outfûe, "-")Ë&& !
c⁄fig
->
u£_ascii
) {

797 
	`£t_bömode
(
°dout
);

800 if(
c⁄fig
->
t˝_nodñay
)

801 
	`my_£t›t
(
cuæ
, 
CURLOPT_TCP_NODELAY
, 1L);

804 
	`my_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, &
outs
);

805 if(
mëÆök
 || !
c⁄fig
->
u£_mëÆök
)

807 
	`my_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
toﬁ_wrôe_cb
);

808 #ifde‡
USE_METALINK


812 
	`my_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
mëÆök_wrôe_cb
);

816 
öput
.
fd
 = 
öfd
;

817 
öput
.
c⁄fig
 = config;

825 
	`my_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
öput
);

827 
	`my_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
toﬁ_ªad_cb
);

831 
	`my_£t›t
(
cuæ
, 
CURLOPT_SEEKDATA
, &
öput
);

832 
	`my_£t›t
(
cuæ
, 
CURLOPT_SEEKFUNCTION
, 
toﬁ_£ek_cb
);

834 if(
c⁄fig
->
ªcv≥r£c⁄d
)

837 
	`my_£t›t
(
cuæ
, 
CURLOPT_BUFFERSIZE
, ()
c⁄fig
->
ªcv≥r£c⁄d
);

840 if(
u∂ﬂdfûesize
 != -1)

841 
	`my_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE_LARGE
, 
u∂ﬂdfûesize
);

842 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_URL
, 
this_uæ
);

843 
	`my_£t›t
(
cuæ
, 
CURLOPT_NOPROGRESS
, 
globÆ
->
n›rogªss
?1L:0L);

844 if(
c⁄fig
->
no_body
) {

845 
	`my_£t›t
(
cuæ
, 
CURLOPT_NOBODY
, 1L);

846 
	`my_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

851 if(!
c⁄fig
->
u£_mëÆök
)

852 
	`my_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 
c⁄fig
->
ö˛ude_hódîs
?1L:0L);

854 if(
c⁄fig
->
xﬂuth2_bóªr
)

855 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_XOAUTH2_BEARER
, 
c⁄fig
->
xﬂuth2_bóªr
);

857 #i‡!
	`deföed
(
CURL_DISABLE_PROXY
)

861 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_PROXY
, 
c⁄fig
->
¥oxy
);

862 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_PROXYUSERPWD
, 
c⁄fig
->
¥oxyu£Ωwd
);

865 
	`my_£t›t
(
cuæ
, 
CURLOPT_HTTPPROXYTUNNEL
, 
c⁄fig
->
¥oxytu¬ñ
?1L:0L);

868 if(
c⁄fig
->
¥oxy
)

869 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_PROXYTYPE
, ()
c⁄fig
->
¥oxyvî
);

872 if(
c⁄fig
->
sock•roxy
) {

873 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_PROXY
, 
c⁄fig
->
sock•roxy
);

874 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_PROXYTYPE
, ()
c⁄fig
->
socksvî
);

878 if(
c⁄fig
->
¥oxy™yauth
)

879 
	`my_£t›t_bômask
(
cuæ
, 
CURLOPT_PROXYAUTH
,

880 ()
CURLAUTH_ANY
);

881 if(
c⁄fig
->
¥oxy√gŸüã
)

882 
	`my_£t›t_bômask
(
cuæ
, 
CURLOPT_PROXYAUTH
,

883 ()
CURLAUTH_GSSNEGOTIATE
);

884 if(
c⁄fig
->
¥oxy¡lm
)

885 
	`my_£t›t_bômask
(
cuæ
, 
CURLOPT_PROXYAUTH
,

886 ()
CURLAUTH_NTLM
);

887 if(
c⁄fig
->
¥oxydige°
)

888 
	`my_£t›t_bômask
(
cuæ
, 
CURLOPT_PROXYAUTH
,

889 ()
CURLAUTH_DIGEST
);

890 if(
c⁄fig
->
¥oxybasic
)

891 
	`my_£t›t_bômask
(
cuæ
, 
CURLOPT_PROXYAUTH
,

892 ()
CURLAUTH_BASIC
);

895 
	`my_£t›t
(
cuæ
, 
CURLOPT_NOPROXY
, 
c⁄fig
->
n›roxy
);

899 
	`my_£t›t
(
cuæ
, 
CURLOPT_FAILONERROR
, 
c⁄fig
->
Áû⁄îr‹
?1L:0L);

900 
	`my_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 
u∂ﬂdfûe
?1L:0L);

901 
	`my_£t›t
(
cuæ
, 
CURLOPT_DIRLISTONLY
, 
c⁄fig
->
dúli°⁄ly
?1L:0L);

902 
	`my_£t›t
(
cuæ
, 
CURLOPT_APPEND
, 
c⁄fig
->
·p_≠≥nd
?1L:0L);

904 if(
c⁄fig
->
√åc_›t
)

905 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_NETRC
, ()
CURL_NETRC_OPTIONAL
);

906 if(
c⁄fig
->
√åc
 || c⁄fig->
√åc_fûe
)

907 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_NETRC
, ()
CURL_NETRC_REQUIRED
);

909 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_NETRC
, ()
CURL_NETRC_IGNORED
);

911 if(
c⁄fig
->
√åc_fûe
)

912 
	`my_£t›t
(
cuæ
, 
CURLOPT_NETRC_FILE
, 
c⁄fig
->
√åc_fûe
);

914 
	`my_£t›t
(
cuæ
, 
CURLOPT_TRANSFERTEXT
, 
c⁄fig
->
u£_ascii
?1L:0L);

915 if(
c⁄fig
->
logö_›ti⁄s
)

916 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_LOGIN_OPTIONS
, 
c⁄fig
->
logö_›ti⁄s
);

917 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_USERPWD
, 
c⁄fig
->
u£Ωwd
);

918 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_RANGE
, 
c⁄fig
->
ønge
);

919 
	`my_£t›t
(
cuæ
, 
CURLOPT_ERRORBUFFER
, 
îr‹buf„r
);

920 
	`my_£t›t
(
cuæ
, 
CURLOPT_TIMEOUT_MS
, ()(
c⁄fig
->
timeout
 * 1000));

922 if(
buût_ö_¥Ÿos
 & 
CURLPROTO_HTTP
) {

924 
po°Redú
 = 0;

926 
	`my_£t›t
(
cuæ
, 
CURLOPT_FOLLOWLOCATION
,

927 
c⁄fig
->
fﬁlowloˇti⁄
?1L:0L);

928 
	`my_£t›t
(
cuæ
, 
CURLOPT_UNRESTRICTED_AUTH
,

929 
c⁄fig
->
uƒe°ri˘ed_auth
?1L:0L);

931 
c⁄fig
->
hâ¥eq
) {

932 
HTTPREQ_SIMPLEPOST
:

933 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_POSTFIELDS
,

934 
c⁄fig
->
po°fõlds
);

935 
	`my_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE_LARGE
,

936 
c⁄fig
->
po°fõldsize
);

938 
HTTPREQ_POST
:

939 
	`my_£t›t_hâµo°
(
cuæ
, 
CURLOPT_HTTPPOST
, 
c⁄fig
->
hâµo°
);

945 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_REFERER
, 
c⁄fig
->
ª„ªr
);

946 
	`my_£t›t
(
cuæ
, 
CURLOPT_AUTOREFERER
, 
c⁄fig
->
aut‹e„ªr
?1L:0L);

947 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_USERAGENT
, 
c⁄fig
->
u£øgít
);

948 
	`my_£t›t_¶i°
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
c⁄fig
->
hódîs
);

951 if(
c⁄fig
->
¥oxyhódîs
) {

952 
	`my_£t›t_¶i°
(
cuæ
, 
CURLOPT_PROXYHEADER
, 
c⁄fig
->
¥oxyhódîs
);

953 
	`my_£t›t
(
cuæ
, 
CURLOPT_HEADEROPT
, 
CURLHEADER_SEPARATE
);

957 
	`my_£t›t
(
cuæ
, 
CURLOPT_MAXREDIRS
, 
c⁄fig
->
maxªdús
);

960 if(
c⁄fig
->
hâpvîsi⁄
)

961 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_HTTP_VERSION
, 
c⁄fig
->
hâpvîsi⁄
);

964 if(
c⁄fig
->
authty≥
)

965 
	`my_£t›t_bômask
(
cuæ
, 
CURLOPT_HTTPAUTH
, ()
c⁄fig
->
authty≥
);

969 if(
c⁄fig
->
po°301
)

970 
po°Redú
 |
CURL_REDIR_POST_301
;

971 if(
c⁄fig
->
po°302
)

972 
po°Redú
 |
CURL_REDIR_POST_302
;

973 if(
c⁄fig
->
po°303
)

974 
po°Redú
 |
CURL_REDIR_POST_303
;

975 
	`my_£t›t
(
cuæ
, 
CURLOPT_POSTREDIR
, 
po°Redú
);

978 if(
c⁄fig
->
ícodög
)

979 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_ACCEPT_ENCODING
, "");

982 if(
c⁄fig
->
å_ícodög
)

983 
	`my_£t›t
(
cuæ
, 
CURLOPT_TRANSFER_ENCODING
, 1L);

987 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_FTPPORT
, 
c⁄fig
->
·µ‹t
);

988 
	`my_£t›t
(
cuæ
, 
CURLOPT_LOW_SPEED_LIMIT
,

989 
c⁄fig
->
low_•ìd_limô
);

990 
	`my_£t›t
(
cuæ
, 
CURLOPT_LOW_SPEED_TIME
, 
c⁄fig
->
low_•ìd_time
);

991 
	`my_£t›t
(
cuæ
, 
CURLOPT_MAX_SEND_SPEED_LARGE
,

992 
c⁄fig
->
£nd≥r£c⁄d
);

993 
	`my_£t›t
(
cuæ
, 
CURLOPT_MAX_RECV_SPEED_LARGE
,

994 
c⁄fig
->
ªcv≥r£c⁄d
);

996 if(
c⁄fig
->
u£_ªsume
)

997 
	`my_£t›t
(
cuæ
, 
CURLOPT_RESUME_FROM_LARGE
, 
c⁄fig
->
ªsume_‰om
);

999 
	`my_£t›t
(
cuæ
, 
CURLOPT_RESUME_FROM_LARGE
, 
	`CURL_OFF_T_C
(0));

1001 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_SSLCERT
, 
c⁄fig
->
˚π
);

1002 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_SSLCERTTYPE
, 
c⁄fig
->
˚π_ty≥
);

1003 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_SSLKEY
, 
c⁄fig
->
key
);

1004 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_SSLKEYTYPE
, 
c⁄fig
->
key_ty≥
);

1005 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_KEYPASSWD
, 
c⁄fig
->
key_∑sswd
);

1007 if(
buût_ö_¥Ÿos
 & (
CURLPROTO_SCP
|
CURLPROTO_SFTP
)) {

1011 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_SSH_PRIVATE_KEYFILE
, 
c⁄fig
->
key
);

1013 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_SSH_PUBLIC_KEYFILE
, 
c⁄fig
->
pubkey
);

1017 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_SSH_HOST_PUBLIC_KEY_MD5
,

1018 
c⁄fig
->
ho°pubmd5
);

1021 if(
c⁄fig
->
ˇ˚π
)

1022 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_CAINFO
, 
c⁄fig
->
ˇ˚π
);

1023 if(
c⁄fig
->
ˇ∑th
)

1024 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_CAPATH
, 
c⁄fig
->
ˇ∑th
);

1025 if(
c⁄fig
->
¸lfûe
)

1026 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_CRLFILE
, 
c⁄fig
->
¸lfûe
);

1028 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_SSL
) {

1029 if(
c⁄fig
->
ö£cuª_ok
) {

1030 
	`my_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

1031 
	`my_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYHOST
, 0L);

1034 
	`my_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYPEER
, 1L);

1040 if(
buût_ö_¥Ÿos
 & (
CURLPROTO_SCP
|
CURLPROTO_SFTP
)) {

1041 if(!
c⁄fig
->
ö£cuª_ok
) {

1042 *
home
;

1043 *
fûe
;

1044 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

1045 
home
 = 
	`homedú
();

1046 if(
home
) {

1047 
fûe
 = 
	`≠rötf
("%s/%sssh/known_ho°s", 
home
, 
DOT_CHAR
);

1048 if(
fûe
) {

1050 
ªs
 = 
	`ªs_£t›t_°r
(
cuæ
, 
CURLOPT_SSH_KNOWNHOSTS
, 
fûe
);

1051 
	`cuæ_‰ì
(
fûe
);

1052 if(
ªs
 =
CURLE_UNKNOWN_OPTION
)

1054 
ªs
 = 
CURLE_OK
;

1056 
	`Cuæ_ß„‰ì
(
home
);

1058 if(
ªs
)

1059 
show_îr‹
;

1063 if(
c⁄fig
->
no_body
 || c⁄fig->
ªmŸe_time
) {

1065 
	`my_£t›t
(
cuæ
, 
CURLOPT_FILETIME
, 1L);

1068 
	`my_£t›t
(
cuæ
, 
CURLOPT_CRLF
, 
c⁄fig
->
¸lf
?1L:0L);

1069 
	`my_£t›t_¶i°
(
cuæ
, 
CURLOPT_QUOTE
, 
c⁄fig
->
quŸe
);

1070 
	`my_£t›t_¶i°
(
cuæ
, 
CURLOPT_POSTQUOTE
, 
c⁄fig
->
po°quŸe
);

1071 
	`my_£t›t_¶i°
(
cuæ
, 
CURLOPT_PREQUOTE
, 
c⁄fig
->
¥equŸe
);

1073 #i‡!
	`deföed
(
CURL_DISABLE_HTTP
Ë&& !deföed(
CURL_DISABLE_COOKIES
)

1074 if(
c⁄fig
->
cookõ
)

1075 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_COOKIE
, 
c⁄fig
->
cookõ
);

1077 if(
c⁄fig
->
cookõfûe
)

1078 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_COOKIEFILE
, 
c⁄fig
->
cookõfûe
);

1081 if(
c⁄fig
->
cookõj¨
)

1082 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_COOKIEJAR
, 
c⁄fig
->
cookõj¨
);

1085 
	`my_£t›t
(
cuæ
, 
CURLOPT_COOKIESESSION
, 
c⁄fig
->
cookõ£ssi⁄
?1L:0L);

1087 if(
c⁄fig
->
cookõ
 || c⁄fig->
cookõfûe
 || c⁄fig->
cookõj¨
) {

1088 
	`w¨nf
(
c⁄fig
, "cookie option(s) usedÉvenÅhough cookie support "

1090  
CURLE_NOT_BUILT_IN
;

1094 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_SSLVERSION
, 
c⁄fig
->
s¶_vîsi⁄
);

1095 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_TIMECONDITION
, ()
c⁄fig
->
timec⁄d
);

1096 
	`my_£t›t
(
cuæ
, 
CURLOPT_TIMEVALUE
, ()
c⁄fig
->
c⁄dtime
);

1097 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_CUSTOMREQUEST
, 
c⁄fig
->
cu°omªque°
);

1098 
	`my_£t›t
(
cuæ
, 
CURLOPT_STDERR
, 
globÆ
->
îr‹s
);

1101 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_INTERFACE
, 
c⁄fig
->
iÁ˚
);

1102 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_KRBLEVEL
, 
c⁄fig
->
krbÀvñ
);

1104 
	`¥ogªssb¨öô
(&
¥ogªssb¨
, 
c⁄fig
);

1105 if((
globÆ
->
¥ogªssmode
 =
CURL_PROGRESS_BAR
) &&

1106 !
globÆ
->
n›rogªss
 && !globÆ->
muã
) {

1109 
	`my_£t›t
(
cuæ
, 
CURLOPT_XFERINFOFUNCTION
, 
toﬁ_¥ogªss_cb
);

1110 
	`my_£t›t
(
cuæ
, 
CURLOPT_XFERINFODATA
, &
¥ogªssb¨
);

1114 if(
c⁄fig
->
dns_£rvîs
)

1115 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_DNS_SERVERS
, 
c⁄fig
->
dns_£rvîs
);

1118 if(
c⁄fig
->
dns_öãrÁ˚
)

1119 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_DNS_INTERFACE
, 
c⁄fig
->
dns_öãrÁ˚
);

1120 if(
c⁄fig
->
dns_ùv4_addr
)

1121 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_DNS_LOCAL_IP4
, 
c⁄fig
->
dns_ùv4_addr
);

1122 if(
c⁄fig
->
dns_ùv6_addr
)

1123 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_DNS_LOCAL_IP6
, 
c⁄fig
->
dns_ùv6_addr
);

1126 
	`my_£t›t_¶i°
(
cuæ
, 
CURLOPT_TELNETOPTIONS
, 
c⁄fig
->
ã ë_›ti⁄s
);

1129 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_RANDOM_FILE
, 
c⁄fig
->
øndom_fûe
);

1130 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_EGDSOCKET
, 
c⁄fig
->
egd_fûe
);

1131 
	`my_£t›t
(
cuæ
, 
CURLOPT_CONNECTTIMEOUT_MS
,

1132 ()(
c⁄fig
->
c⁄√˘timeout
 * 1000));

1134 if(
c⁄fig
->
cùhî_li°
)

1135 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_SSL_CIPHER_LIST
, 
c⁄fig
->
cùhî_li°
);

1138 if(
c⁄fig
->
dißbÀ_ïsv
)

1140 
	`my_£t›t
(
cuæ
, 
CURLOPT_FTP_USE_EPSV
, 0L);

1143 if(
c⁄fig
->
dißbÀ_ïπ
)

1145 
	`my_£t›t
(
cuæ
, 
CURLOPT_FTP_USE_EPRT
, 0L);

1147 if(
globÆ
->
åa˚ty≥
 !
TRACE_NONE
) {

1148 
	`my_£t›t
(
cuæ
, 
CURLOPT_DEBUGFUNCTION
, 
toﬁ_debug_cb
);

1149 
	`my_£t›t
(
cuæ
, 
CURLOPT_DEBUGDATA
, 
c⁄fig
);

1150 
	`my_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

1154 if(
c⁄fig
->
ígöe
) {

1155 
ªs
 = 
	`ªs_£t›t_°r
(
cuæ
, 
CURLOPT_SSLENGINE
, 
c⁄fig
->
ígöe
);

1156 if(
ªs
)

1157 
show_îr‹
;

1158 
	`my_£t›t
(
cuæ
, 
CURLOPT_SSLENGINE_DEFAULT
, 1L);

1162 
	`my_£t›t
(
cuæ
, 
CURLOPT_FTP_CREATE_MISSING_DIRS
,

1163 
c⁄fig
->
·p_¸óã_dús
?1L:0L);

1166 if(
c⁄fig
->
max_fûesize
)

1167 
	`my_£t›t
(
cuæ
, 
CURLOPT_MAXFILESIZE_LARGE
,

1168 
c⁄fig
->
max_fûesize
);

1170 if(4 =
c⁄fig
->
ù_vîsi⁄
)

1171 
	`my_£t›t
(
cuæ
, 
CURLOPT_IPRESOLVE
, 
CURL_IPRESOLVE_V4
);

1172 if(6 =
c⁄fig
->
ù_vîsi⁄
)

1173 
	`my_£t›t
(
cuæ
, 
CURLOPT_IPRESOLVE
, 
CURL_IPRESOLVE_V6
);

1175 
	`my_£t›t
(
cuæ
, 
CURLOPT_IPRESOLVE
, 
CURL_IPRESOLVE_WHATEVER
);

1178 if(
c⁄fig
->
·p_s¶_ªqd
)

1179 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_USE_SSL
, ()
CURLUSESSL_ALL
);

1182 if(
c⁄fig
->
·p_s¶
)

1183 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_USE_SSL
, ()
CURLUSESSL_TRY
);

1186 if(
c⁄fig
->
·p_s¶_c⁄åﬁ
)

1187 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_USE_SSL
, ()
CURLUSESSL_CONTROL
);

1190 if(
c⁄fig
->
·p_s¶_ccc
)

1191 
	`my_£t›t_íum
(
cuæ
, 
CURLOPT_FTP_SSL_CCC
,

1192 ()
c⁄fig
->
·p_s¶_ccc_mode
);

1194 #i‡
	`deföed
(
HAVE_GSSAPI
Ë|| deföed(
USE_WINDOWS_SSPI
)

1199 if(
c⁄fig
->
socks5_gsßpi_£rvi˚
)

1200 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_SOCKS5_GSSAPI_SERVICE
,

1201 
c⁄fig
->
socks5_gsßpi_£rvi˚
);

1204 if(
c⁄fig
->
socks5_gsßpi_√c
)

1205 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_SOCKS5_GSSAPI_NEC
,

1206 
c⁄fig
->
socks5_gsßpi_√c
);

1210 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_FTP_ACCOUNT
, 
c⁄fig
->
·p_accou¡
);

1212 
	`my_£t›t
(
cuæ
, 
CURLOPT_IGNORE_CONTENT_LENGTH
, 
c⁄fig
->
ign‹e˛
?1L:0L);

1215 
	`my_£t›t
(
cuæ
, 
CURLOPT_FTP_SKIP_PASV_IP
, 
c⁄fig
->
·p_skù_ù
?1L:0L);

1218 
	`my_£t›t
(
cuæ
, 
CURLOPT_FTP_FILEMETHOD
, ()
c⁄fig
->
·p_fûemëhod
);

1221 if(
c⁄fig
->
loˇÕ‹t
) {

1222 
	`my_£t›t
(
cuæ
, 
CURLOPT_LOCALPORT
, ()
c⁄fig
->
loˇÕ‹t
);

1223 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_LOCALPORTRANGE
,

1224 ()
c⁄fig
->
loˇÕ‹å™ge
);

1228 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_FTP_ALTERNATIVE_TO_USER
,

1229 
c⁄fig
->
·p_Æã∫©ive_to_u£r
);

1232 if(
c⁄fig
->
dißbÀ_£ssi⁄id
)

1234 
	`my_£t›t
(
cuæ
, 
CURLOPT_SSL_SESSIONID_CACHE
, 0L);

1237 if(
c⁄fig
->
øw
) {

1238 
	`my_£t›t
(
cuæ
, 
CURLOPT_HTTP_CONTENT_DECODING
, 0L);

1239 
	`my_£t›t
(
cuæ
, 
CURLOPT_HTTP_TRANSFER_DECODING
, 0L);

1243 if(!
c⁄fig
->
nokì∑live
) {

1244 
	`my_£t›t
(
cuæ
, 
CURLOPT_TCP_KEEPALIVE
, 1L);

1245 if(
c⁄fig
->
Æivëime
 != 0) {

1246 #i‡!
	`deföed
(
TCP_KEEPIDLE
Ë|| !deföed(
TCP_KEEPINTVL
)

1247 
	`w¨nf
(
c⁄fig
, "Keep-alive functionality somewhat crippled dueÅo "

1250 
	`my_£t›t
(
cuæ
, 
CURLOPT_TCP_KEEPIDLE
, 
c⁄fig
->
Æivëime
);

1251 
	`my_£t›t
(
cuæ
, 
CURLOPT_TCP_KEEPINTVL
, 
c⁄fig
->
Æivëime
);

1255 
	`my_£t›t
(
cuæ
, 
CURLOPT_TCP_KEEPALIVE
, 0L);

1258 if(
c⁄fig
->
t·p_blksize
)

1259 
	`my_£t›t
(
cuæ
, 
CURLOPT_TFTP_BLKSIZE
, 
c⁄fig
->
t·p_blksize
);

1261 if(
c⁄fig
->
maû_‰om
)

1262 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_MAIL_FROM
, 
c⁄fig
->
maû_‰om
);

1264 if(
c⁄fig
->
maû_r˝t
)

1265 
	`my_£t›t_¶i°
(
cuæ
, 
CURLOPT_MAIL_RCPT
, 
c⁄fig
->
maû_r˝t
);

1268 if(
c⁄fig
->
·p_¥ë
)

1269 
	`my_£t›t
(
cuæ
, 
CURLOPT_FTP_USE_PRET
, 1L);

1271 if(
c⁄fig
->
¥Ÿo_¥e£¡
)

1272 
	`my_£t›t_Êags
(
cuæ
, 
CURLOPT_PROTOCOLS
, 
c⁄fig
->
¥Ÿo
);

1273 if(
c⁄fig
->
¥Ÿo_ªdú_¥e£¡
)

1274 
	`my_£t›t_Êags
(
cuæ
, 
CURLOPT_REDIR_PROTOCOLS
, 
c⁄fig
->
¥Ÿo_ªdú
);

1276 if(
c⁄fig
->
c⁄ã¡_di•osôi⁄


1277 && (
uænode
->
Êags
 & 
GETOUT_USEREMOTE
)

1278 && (
	`check¥efix
("hâp://", 
this_uæ
) ||

1279 
	`check¥efix
("hâps://", 
this_uæ
)))

1280 
hdrcbd©a
.
h⁄‹_cd_fûíame
 = 
TRUE
;

1282 
hdrcbd©a
.
h⁄‹_cd_fûíame
 = 
FALSE
;

1284 
hdrcbd©a
.
outs
 = &outs;

1285 
hdrcbd©a
.
hóds
 = &heads;

1287 
	`my_£t›t
(
cuæ
, 
CURLOPT_HEADERFUNCTION
, 
toﬁ_hódî_cb
);

1288 
	`my_£t›t
(
cuæ
, 
CURLOPT_HEADERDATA
, &
hdrcbd©a
);

1290 if(
c⁄fig
->
ªsﬁve
)

1292 
	`my_£t›t_¶i°
(
cuæ
, 
CURLOPT_RESOLVE
, 
c⁄fig
->
ªsﬁve
);

1295 if(
cuæöfo
->
„©uªs
 & 
CURL_VERSION_TLSAUTH_SRP
) {

1296 if(
c⁄fig
->
és_u£∫ame
)

1297 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_TLSAUTH_USERNAME
,

1298 
c⁄fig
->
és_u£∫ame
);

1299 if(
c⁄fig
->
és_∑ssw‹d
)

1300 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_TLSAUTH_PASSWORD
,

1301 
c⁄fig
->
és_∑ssw‹d
);

1302 if(
c⁄fig
->
és_authty≥
)

1303 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_TLSAUTH_TYPE
,

1304 
c⁄fig
->
és_authty≥
);

1308 if(
c⁄fig
->
gsßpi_dñeg©i⁄
)

1309 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_GSSAPI_DELEGATION
,

1310 
c⁄fig
->
gsßpi_dñeg©i⁄
);

1313 if(
c⁄fig
->
s¶_Ælow_bó°
)

1314 
	`my_£t›t
(
cuæ
, 
CURLOPT_SSL_OPTIONS
, ()
CURLSSLOPT_ALLOW_BEAST
);

1316 if(
c⁄fig
->
maû_auth
)

1317 
	`my_£t›t_°r
(
cuæ
, 
CURLOPT_MAIL_AUTH
, 
c⁄fig
->
maû_auth
);

1320 if(
c⁄fig
->
ß¶_ú
)

1321 
	`my_£t›t
(
cuæ
, 
CURLOPT_SASL_IR
, 1L);

1323 if(
c⁄fig
->
n⁄≤
) {

1324 
	`my_£t›t
(
cuæ
, 
CURLOPT_SSL_ENABLE_NPN
, 0L);

1327 if(
c⁄fig
->
nﬂÕn
) {

1328 
	`my_£t›t
(
cuæ
, 
CURLOPT_SSL_ENABLE_ALPN
, 0L);

1332 
ªåy_¶ìp_deÁu…
 = (
c⁄fig
->
ªåy_dñay
) ?

1333 
c⁄fig
->
ªåy_dñay
*1000L : 
RETRY_SLEEP_DEFAULT
;

1335 
ªåy_numªåõs
 = 
c⁄fig
->
ªq_ªåy
;

1336 
ªåy_¶ìp
 = 
ªåy_¶ìp_deÁu…
;

1337 
ªåy°¨t
 = 
	`tvnow
();

1339 #i‚de‡
CURL_DISABLE_LIBCURL_OPTION


1340 
ªs
 = 
	`ósy§c_≥rf‹m
();

1341 if(
ªs
) {

1342 
show_îr‹
;

1347 #ifde‡
USE_METALINK


1348 if(!
mëÆök
 && 
c⁄fig
->
u£_mëÆök
) {

1350 if(
outs
.
mëÆök_∑r£r
)

1351 
	`mëÆök_∑r£r_c⁄ãxt_dñëe
(
outs
.
mëÆök_∑r£r
);

1352 
outs
.
mëÆök_∑r£r
 = 
	`mëÆök_∑r£r_c⁄ãxt_√w
();

1353 if(
outs
.
mëÆök_∑r£r
 =
NULL
) {

1354 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

1355 
show_îr‹
;

1357 
	`Ârötf
(
c⁄fig
->
globÆ
->
îr‹s
,

1358 "MëÆök:Ö¨sög (%sËmëÆök/XML...\n", 
this_uæ
);

1360 if(
mëÆök
)

1361 
	`Ârötf
(
c⁄fig
->
globÆ
->
îr‹s
,

1363 
mlfûe
->
fûíame
, 
this_uæ
);

1366 #ifde‡
CURLDEBUG


1367 if(
c⁄fig
->
ã°_evít_ba£d
)

1368 
ªs
 = 
	`cuæ_ósy_≥rf‹m_ev
(
cuæ
);

1371 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

1373 if(
outs
.
is_cd_fûíame
 && outs.
°ªam
 && !
globÆ
->
muã
 &&

1374 
outs
.
fûíame
)

1375 
	`¥ötf
("cuæ: SavedÅÿfûíamê'%s'\n", 
outs
.
fûíame
);

1379 if(
ªåy_numªåõs
 &&

1380 (!
c⁄fig
->
ªåy_maxtime
 ||

1381 (
	`tvdiff
(
	`tvnow
(), 
ªåy°¨t
) <

1382 
c⁄fig
->
ªåy_maxtime
*1000L)) ) {

1384 
RETRY_NO
,

1385 
RETRY_TIMEOUT
,

1386 
RETRY_HTTP
,

1387 
RETRY_FTP
,

1388 
RETRY_LAST


1389 } 
ªåy
 = 
RETRY_NO
;

1390 
ª•⁄£
;

1391 if((
CURLE_OPERATION_TIMEDOUT
 =
ªs
) ||

1392 (
CURLE_COULDNT_RESOLVE_HOST
 =
ªs
) ||

1393 (
CURLE_COULDNT_RESOLVE_PROXY
 =
ªs
) ||

1394 (
CURLE_FTP_ACCEPT_TIMEOUT
 =
ªs
))

1396 
ªåy
 = 
RETRY_TIMEOUT
;

1397 if((
CURLE_OK
 =
ªs
) ||

1398 (
c⁄fig
->
Áû⁄îr‹
 &&

1399 (
CURLE_HTTP_RETURNED_ERROR
 =
ªs
))) {

1403 *
ef„˘ive_uæ
 = 
NULL
;

1404 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_EFFECTIVE_URL
, &
ef„˘ive_uæ
);

1405 if(
ef„˘ive_uæ
 &&

1406 
	`check¥efix
("hâp", 
ef„˘ive_uæ
)) {

1408 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_RESPONSE_CODE
, &
ª•⁄£
);

1410 
ª•⁄£
) {

1415 
ªåy
 = 
RETRY_HTTP
;

1430 if(
ªs
) {

1431 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_RESPONSE_CODE
, &
ª•⁄£
);

1433 if(
ª•⁄£
/100 == 4)

1439 
ªåy
 = 
RETRY_FTP
;

1442 if(
ªåy
) {

1443 c⁄° * c⁄° 
m
[]={

1444 
NULL
, "timeout", "HTTPÉrror", "FTPÉrror"

1446 
	`w¨nf
(
c⁄fig
, "TransientÖroblem: %s "

1449 
m
[
ªåy
], 
ªåy_¶ìp
/1000L, 
ªåy_numªåõs
);

1451 
	`toﬁ_go_¶ìp
(
ªåy_¶ìp
);

1452 
ªåy_numªåõs
--;

1453 if(!
c⁄fig
->
ªåy_dñay
) {

1454 
ªåy_¶ìp
 *= 2;

1455 if(
ªåy_¶ìp
 > 
RETRY_SLEEP_MAX
)

1456 
ªåy_¶ìp
 = 
RETRY_SLEEP_MAX
;

1458 if(
outs
.
byãs
 && outs.
fûíame
) {

1461 if(!
globÆ
->
muã
)

1462 
	`Ârötf
(
globÆ
->
îr‹s
, "Throwingáway %"

1463 
CURL_FORMAT_CURL_OFF_T
 " bytes\n",

1464 
outs
.
byãs
);

1465 
	`fÊush
(
outs
.
°ªam
);

1467 #ifde‡
HAVE_FTRUNCATE


1468 if(
	`·runˇã
–
	`fûío
(
outs
.
°ªam
), outs.
öô
)) {

1471 if(!
globÆ
->
muã
)

1472 
	`Ârötf
(
globÆ
->
îr‹s
,

1474 
ªs
 = 
CURLE_WRITE_ERROR
;

1475 
quô_uæs
;

1479 
	`f£ek
(
outs
.
°ªam
, 0, 
SEEK_END
);

1485 
	`f£ek
(
outs
.
°ªam
, ()outs.
öô
, 
SEEK_SET
);

1487 
outs
.
byãs
 = 0;

1492 if(
mëÆök
) {

1496 
ª•⁄£
;

1497 if(
CURLE_OK
 =
ªs
) {

1500 *
ef„˘ive_uæ
 = 
NULL
;

1501 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_EFFECTIVE_URL
, &
ef„˘ive_uæ
);

1502 if(
ef„˘ive_uæ
 &&

1503 
	`cuæx_°∫equÆ
(
ef„˘ive_uæ
, "http", 4)) {

1505 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_RESPONSE_CODE
, &
ª•⁄£
);

1506 if(
ª•⁄£
 != 200 &&Ñesponse != 206) {

1507 
mëÆök_√xt_ªs
 = 1;

1508 
	`Ârötf
(
globÆ
->
îr‹s
,

1511 
mlfûe
->
fûíame
, 
this_uæ
, 
ª•⁄£
);

1516 
mëÆök_√xt_ªs
 = 1;

1517 
	`Ârötf
(
globÆ
->
îr‹s
,

1519 
mlfûe
->
fûíame
, 
this_uæ
,

1520 (
îr‹buf„r
[0]) ?

1521 
îr‹buf„r
 : 
	`cuæ_ósy_°ªº‹
((
CURLcode
)
ªs
));

1524 if(
mëÆök
 && !
mëÆök_√xt_ªs
)

1525 
	`Ârötf
(
globÆ
->
îr‹s
, "Metalink: fetching (%s) from (%s) OK\n",

1526 
mlfûe
->
fûíame
, 
this_uæ
);

1533 if((
globÆ
->
¥ogªssmode
 =
CURL_PROGRESS_BAR
) &&

1534 
¥ogªssb¨
.
ˇŒs
)

1537 
	`Âuts
("\n", 
¥ogªssb¨
.
out
);

1539 if(
c⁄fig
->
wrôeout
)

1540 
	`ourWrôeOut
(
cuæ
, &
outs
, 
c⁄fig
->
wrôeout
);

1542 if(
c⁄fig
->
wrôìnv
)

1543 
	`ourWrôeEnv
(
cuæ
);

1552 
show_îr‹
:

1554 #ifde‡
__VMS


1555 if(
	`is_vms_shñl
()) {

1557 if(!
globÆ
->
showîr‹
)

1558 
vms_show
 = 
VMSSTS_HIDE
;

1562 if(
ªs
 && 
globÆ
->
showîr‹
) {

1563 
	`Ârötf
(
globÆ
->
îr‹s
, "cuæ: (%dË%s\n", 
ªs
, (
îr‹buf„r
[0]) ?

1564 
îr‹buf„r
 : 
	`cuæ_ósy_°ªº‹
((
CURLcode
)
ªs
));

1565 if(
ªs
 =
CURLE_SSL_CACERT
)

1566 
	`Ârötf
(
globÆ
->
îr‹s
, "%s%s",

1567 
CURL_CA_CERT_ERRORMSG1
, 
CURL_CA_CERT_ERRORMSG2
);

1583 
quô_uæs
:

1586 if(!
ªs
 && 
c⁄fig
->
x©å
 && 
outs
.
f›íed
 && outs.
°ªam
) {

1587 
rc
 = 
	`fwrôe_x©å
(
cuæ
, 
	`fûío
(
outs
.
°ªam
));

1588 if(
rc
)

1589 
	`w¨nf
(
c⁄fig
, "Error settingÉxtendedáttributes: %s\n",

1590 
	`°ªº‹
(
î∫o
));

1594 if(
outs
.
f›íed
 && outs.
°ªam
) {

1595 
rc
 = 
	`f˛o£
(
outs
.
°ªam
);

1596 if(!
ªs
 && 
rc
) {

1598 
ªs
 = 
CURLE_WRITE_ERROR
;

1599 
	`Ârötf
(
globÆ
->
îr‹s
, "(%dËFaûed wrôög body\n", 
ªs
);

1602 if(!
outs
.
s_i§eg
 && outs.
°ªam
) {

1604 
rc
 = 
	`fÊush
(
outs
.
°ªam
);

1605 if(!
ªs
 && 
rc
) {

1607 
ªs
 = 
CURLE_WRITE_ERROR
;

1608 
	`Ârötf
(
globÆ
->
îr‹s
, "(%dËFaûed wrôög body\n", 
ªs
);

1612 #ifde‡
__AMIGA__


1613 if(!
ªs
 && 
outs
.
s_i§eg
 && outs.
fûíame
) {

1615 if(
	`°æí
(
uæ
) > 78)

1616 
uæ
[79] = '\0';

1617 
	`SëCommít
(
outs
.
fûíame
, 
uæ
);

1621 #ifde‡
HAVE_UTIME


1623 if(!
ªs
 && 
c⁄fig
->
ªmŸe_time
 && 
outs
.
s_i§eg
 && outs.
fûíame
) {

1625 
fûëime
 = -1;

1626 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_FILETIME
, &
fûëime
);

1627 if(
fûëime
 >= 0) {

1628 
utimbuf
 
times
;

1629 
times
.
a˘ime
 = (
time_t
)
fûëime
;

1630 
times
.
modtime
 = (
time_t
)
fûëime
;

1631 
	`utime
(
outs
.
fûíame
, &
times
);

1636 #ifde‡
USE_METALINK


1637 if(!
mëÆök
 && 
c⁄fig
->
u£_mëÆök
 && 
ªs
 =
CURLE_OK
) {

1638 
rv
 = 
	`∑r£_mëÆök
(
c⁄fig
, &
outs
, 
this_uæ
);

1639 if(
rv
 == 0)

1640 
	`Ârötf
(
c⁄fig
->
globÆ
->
îr‹s
, "Metalink:Öarsing (%s) OK\n",

1641 
this_uæ
);

1642 if(
rv
 == -1)

1643 
	`Ârötf
(
c⁄fig
->
globÆ
->
îr‹s
, "Metalink:Öarsing (%s) FAILED\n",

1644 
this_uæ
);

1646 if(
mëÆök
 && 
ªs
 =
CURLE_OK
 && !
mëÆök_√xt_ªs
) {

1647 
rv
 = 
	`mëÆök_check_hash
(
globÆ
, 
mlfûe
, 
outs
.
fûíame
);

1648 if(
rv
 == 0) {

1649 
mëÆök_√xt_ªs
 = 1;

1655 if(
outs
.
Æloc_fûíame
)

1656 
	`Cuæ_ß„‰ì
(
outs
.
fûíame
);

1657 #ifde‡
USE_METALINK


1658 if(
outs
.
mëÆök_∑r£r
)

1659 
	`mëÆök_∑r£r_c⁄ãxt_dñëe
(
outs
.
mëÆök_∑r£r
);

1661 
	`mem£t
(&
outs
, 0, (
OutSåu˘
));

1662 
hdrcbd©a
.
outs
 = 
NULL
;

1666 
	`Cuæ_ß„‰ì
(
outfûe
);

1667 
	`Cuæ_ß„‰ì
(
this_uæ
);

1669 if(
öfd›í
)

1670 
	`˛o£
(
öfd
);

1672 if(
mëÆök
) {

1674 if(
	`is_Áèl_îr‹
(
ªs
)) {

1677 if(!
mëÆök_√xt_ªs
)

1679 
mÃes
 = mÃes->
√xt
;

1680 if(
mÃes
 =
NULL
)

1687 if(
uænum
 > 1) {

1689 if(
	`is_Áèl_îr‹
(
ªs
))

1692 if(
ªs
)

1700 
	`Cuæ_ß„‰ì
(
u∂ﬂdfûe
);

1702 if(
uæs
) {

1704 
	`glob_˛ónup
(
uæs
);

1705 
uæs
 = 
NULL
;

1708 if(
öfûíum
 > 1) {

1710 if(
	`is_Áèl_îr‹
(
ªs
))

1713 if(
ªs
)

1721 
	`Cuæ_ß„‰ì
(
outfûes
);

1723 if(
öglob
) {

1725 
	`glob_˛ónup
(
öglob
);

1726 
öglob
 = 
NULL
;

1731 
	`Cuæ_ß„‰ì
(
uænode
->
uæ
);

1732 
	`Cuæ_ß„‰ì
(
uænode
->
outfûe
);

1733 
	`Cuæ_ß„‰ì
(
uænode
->
öfûe
);

1734 
uænode
->
Êags
 = 0;

1739 if(
	`is_Áèl_îr‹
(
ªs
))

1740 
quô_cuæ
;

1748 
quô_cuæ
:

1751 
globÆ
->
n›rogªss
 = 
‹ig_n›rogªss
;

1752 
globÆ
->
ißây
 = 
‹ig_ißây
;

1755 
	`Cuæ_ß„‰ì
(
hâpgëfõlds
);

1758 
	`˛ón_gëout
(
c⁄fig
);

1760 
hdrcbd©a
.
hóds
 = 
NULL
;

1763 if(
hóds
.
f›íed
 && hóds.
°ªam
)

1764 
	`f˛o£
(
hóds
.
°ªam
);

1766 if(
hóds
.
Æloc_fûíame
)

1767 
	`Cuæ_ß„‰ì
(
hóds
.
fûíame
);

1770 
	`˛ón_mëÆök
(
c⁄fig
);

1772  
ªs
;

1773 
	}
}

1775 
CURLcode
 
	$›î©e
(
GlobÆC⁄fig
 *
c⁄fig
, 
¨gc
, 
¨gv_ôem_t
 
¨gv
[])

1777 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

1780 #ifde‡
HAVE_SETLOCALE


1781 
	`£éoˇÀ
(
LC_ALL
, "");

1785 if((
¨gc
 =1Ë|| (!
	`cuæx_°ªquÆ
(
¨gv
[1], "-q"))) {

1786 
	`∑r£c⁄fig
(
NULL
, 
c⁄fig
);

1789 if((
¨gc
 < 2Ë&& (!
c⁄fig
->
fú°
->
uæ_li°
)) {

1790 
	`hñpf
(
c⁄fig
->
îr‹s
, 
NULL
);

1791 
ªsu…
 = 
CURLE_FAILED_INIT
;

1795 if(!
ªsu…
) {

1797 
P¨amëîEº‹
 
ªs
 = 
	`∑r£_¨gs
(
c⁄fig
, 
¨gc
, 
¨gv
);

1798 if(
ªs
) {

1799 
ªsu…
 = 
CURLE_OK
;

1802 if(
ªs
 =
PARAM_HELP_REQUESTED
)

1803 
	`toﬁ_hñp
();

1805 if(
ªs
 =
PARAM_MANUAL_REQUESTED
)

1806 
	`hugehñp
();

1808 if(
ªs
 =
PARAM_VERSION_INFO_REQUESTED
)

1809 
	`toﬁ_vîsi⁄_öfo
();

1811 if(
ªs
 =
PARAM_ENGINES_REQUESTED
)

1812 
	`toﬁ_li°_ígöes
(
c⁄fig
->
ósy
);

1814 
ªsu…
 = 
CURLE_FAILED_INIT
;

1817 #i‚de‡
CURL_DISABLE_LIBCURL_OPTION


1819 
ªsu…
 = 
	`ósy§c_öô
();

1823 if(!
ªsu…
) {

1824 
size_t
 
cou¡
 = 0;

1825 
O≥øti⁄C⁄fig
 *
›î©i⁄
 = 
c⁄fig
->
fú°
;

1828 !
ªsu…
 && 
›î©i⁄
) {

1829 
ªsu…
 = 
	`gë_¨gs
(
›î©i⁄
, 
cou¡
++);

1831 
›î©i⁄
 = o≥øti⁄->
√xt
;

1835 
c⁄fig
->
cuºít
 = c⁄fig->
fú°
;

1838 !
ªsu…
 && 
c⁄fig
->
cuºít
) {

1839 
ªsu…
 = 
	`›î©e_do
(
c⁄fig
, c⁄fig->
cuºít
);

1841 
c⁄fig
->
cuºít
 = c⁄fig->cuºít->
√xt
;

1844 #i‚de‡
CURL_DISABLE_LIBCURL_OPTION


1846 
	`ósy§c_˛ónup
();

1849 
	`dum≥asy§c
(
c⁄fig
);

1853 
	`hñpf
(
c⁄fig
->
îr‹s
, "out of memory\n");

1857  
ªsu…
;

1858 
	}
}

	@src/tool_operate.h

1 #i‚de‡
HEADER_CURL_TOOL_OPERATE_H


2 
	#HEADER_CURL_TOOL_OPERATE_H


	)

24 
	~"toﬁ_£tup.h
"

26 
CURLcode
 
›î©e
(
GlobÆC⁄fig
 *
c⁄fig
, 
¨gc
, 
¨gv_ôem_t
 
¨gv
[]);

	@src/tool_operhlp.c

22 
	~"toﬁ_£tup.h
"

24 
	~"øw°r.h
"

26 
	#ENABLE_CURLX_PRINTF


	)

28 
	~"cuæx.h
"

30 
	~"toﬁ_cfgabÀ.h
"

31 
	~"toﬁ_c⁄vît.h
"

32 
	~"toﬁ_›îhÕ.h
"

33 
	~"toﬁ_mëÆök.h
"

35 
	~"memdebug.h
"

37 
	$˛ón_gëout
(
O≥øti⁄C⁄fig
 *
c⁄fig
)

39 
gëout
 *
√xt
;

40 
gëout
 *
node
 = 
c⁄fig
->
uæ_li°
;

42 
node
) {

43 
√xt
 = 
node
->next;

44 
	`Cuæ_ß„‰ì
(
node
->
uæ
);

45 
	`Cuæ_ß„‰ì
(
node
->
outfûe
);

46 
	`Cuæ_ß„‰ì
(
node
->
öfûe
);

47 
	`Cuæ_ß„‰ì
(
node
);

48 
node
 = 
√xt
;

50 
c⁄fig
->
uæ_li°
 = 
NULL
;

51 
	}
}

53 
boﬁ
 
	$ouçut_ex≥˘ed
(c⁄° *
uæ
, c⁄° *
u∂ﬂdfûe
)

55 if(!
u∂ﬂdfûe
)

56  
TRUE
;

57 if(
	`check¥efix
("hâp://", 
uæ
) || checkprefix("https://", url))

58  
TRUE
;

60  
FALSE
;

61 
	}
}

63 
boﬁ
 
	$°dö_u∂ﬂd
(c⁄° *
u∂ﬂdfûe
)

65  (
	`cuæx_°ªquÆ
(
u∂ﬂdfûe
, "-") ||

66 
	`cuæx_°ªquÆ
(
u∂ﬂdfûe
, ".")Ë? 
TRUE
 : 
FALSE
;

67 
	}
}

73 *
	$add_fûe_«me_to_uæ
(
CURL
 *
cuæ
, *
uæ
, c⁄° *
fûíame
)

76 *
±r
 = 
	`°r°r
(
uæ
, "://");

77 if(
±r
)

78 
±r
 += 3;

80 
±r
 = 
uæ
;

81 
±r
 = 
	`°ºchr
(ptr, '/');

82 if(!
±r
 || !
	`°æí
(++ptr)) {

89 c⁄° *
fûï
 = 
	`°ºchr
(
fûíame
, '/');

90 *
fûe2
 = 
	`°ºchr
(
fûï
?fûï:
fûíame
, '\\');

91 *
ícfûe
;

93 if(
fûe2
)

94 
fûï
 = 
fûe2
 + 1;

95 if(
fûï
)

96 
fûï
++;

98 
fûï
 = 
fûíame
;

101 
ícfûe
 = 
	`cuæ_ósy_esˇ≥
(
cuæ
, 
fûï
, 0 );

102 if(
ícfûe
) {

103 *
uæbuf„r
;

104 if(
±r
)

106 
uæbuf„r
 = 
	`≠rötf
("%s%s", 
uæ
, 
ícfûe
);

109 
uæbuf„r
 = 
	`≠rötf
("%s/%s", 
uæ
, 
ícfûe
);

111 
	`cuæ_‰ì
(
ícfûe
);

112 
	`Cuæ_ß„‰ì
(
uæ
);

114 if(!
uæbuf„r
)

115  
NULL
;

117 
uæ
 = 
uæbuf„r
;

120 
	`Cuæ_ß„‰ì
(
uæ
);

122  
uæ
;

123 
	}
}

129 
CURLcode
 
	$gë_uæ_fûe_«me
(**
fûíame
, c⁄° *
uæ
)

131 c⁄° *
pc
;

133 *
fûíame
 = 
NULL
;

136 
pc
 = 
	`°r°r
(
uæ
, "://");

137 if(
pc
)

138 
pc
 += 3;

140 
pc
 = 
uæ
;

141 
pc
 = 
	`°ºchr
(pc, '/');

143 if(
pc
) {

145 
pc
++;

146 if(*
pc
) {

147 *
fûíame
 = 
	`°rdup
(
pc
);

148 if(!*
fûíame
)

149  
CURLE_OUT_OF_MEMORY
;

157 #ifde‡
DEBUGBUILD


159 *
tdú
 = 
	`cuæx_gëív
("CURL_TESTDIR");

160 if(
tdú
) {

161 
buf„r
[512];

162 
	`¢¥ötf
(
buf„r
, (buf„r), "%s/%s", 
tdú
, *
fûíame
);

163 
	`Cuæ_ß„‰ì
(*
fûíame
);

164 *
fûíame
 = 
	`°rdup
(
buf„r
);

165 
	`cuæ_‰ì
(
tdú
);

170  
CURLE_OK
;

171 
	}
}

	@src/tool_operhlp.h

1 #i‚de‡
HEADER_CURL_TOOL_OPERHLP_H


2 
	#HEADER_CURL_TOOL_OPERHLP_H


	)

24 
	~"toﬁ_£tup.h
"

26 
	gO≥øti⁄C⁄fig
;

28 
˛ón_gëout
(
O≥øti⁄C⁄fig
 *
c⁄fig
);

30 
boﬁ
 
ouçut_ex≥˘ed
(c⁄° *
uæ
, c⁄° *
u∂ﬂdfûe
);

32 
boﬁ
 
°dö_u∂ﬂd
(c⁄° *
u∂ﬂdfûe
);

34 *
add_fûe_«me_to_uæ
(
CURL
 *
cuæ
, *
uæ
, c⁄° *
fûíame
);

36 
CURLcode
 
gë_uæ_fûe_«me
(**
fûíame
, c⁄° *
uæ
);

	@src/tool_panykey.c

22 
	~"toﬁ_£tup.h
"

24 #i‡
deföed
(
__SYMBIAN32__
Ë|| deföed(
NETWARE
)

26 #ifde‡
NETWARE


27 #ifde‡
__NOVELL_LIBC__


28 
	~<s¸ìn.h
>

30 
	~<nwc⁄io.h
>

34 
	~"toﬁ_∑nykey.h
"

36 
	~"memdebug.h
"

38 
	$toﬁ_¥esßnykey
()

40 #i‡
	`deföed
(
__SYMBIAN32__
)

41 
	`gëch¨
();

42 #ñi‡
	`deföed
(
NETWARE
)

43 
	`¥esßnykey
();

45 
	}
}

	@src/tool_panykey.h

1 #i‚de‡
HEADER_CURL_TOOL_PANYKEY_H


2 
	#HEADER_CURL_TOOL_PANYKEY_H


	)

24 
	~"toﬁ_£tup.h
"

26 #i‡
deföed
(
__SYMBIAN32__
Ë|| deföed(
NETWARE
)

28 
toﬁ_¥esßnykey
();

32 
	#toﬁ_¥esßnykey
(Ë
Cuæ_n›_°mt


	)

	@src/tool_paramhlp.c

22 
	~"toﬁ_£tup.h
"

24 
	~"øw°r.h
"

26 
	#ENABLE_CURLX_PRINTF


	)

28 
	~"cuæx.h
"

30 
	~"toﬁ_cfgabÀ.h
"

31 
	~"toﬁ_gë∑øm.h
"

32 
	~"toﬁ_gë∑ss.h
"

33 
	~"toﬁ_homedú.h
"

34 
	~"toﬁ_msgs.h
"

35 
	~"toﬁ_∑ømhÕ.h
"

36 
	~"toﬁ_vîsi⁄.h
"

38 
	~"memdebug.h
"

40 
gëout
 *
	$√w_gëout
(
O≥øti⁄C⁄fig
 *
c⁄fig
)

42 
gëout
 *
node
 = 
	`ˇŒoc
(1, (getout));

43 
gëout
 *
œ°
 = 
c⁄fig
->
uæ_œ°
;

44 if(
node
) {

46 if(
œ°
)

47 
œ°
->
√xt
 = 
node
;

49 
c⁄fig
->
uæ_li°
 = 
node
;

52 
c⁄fig
->
uæ_œ°
 = 
node
;

54 
node
->
Êags
 = 
c⁄fig
->
deÁu…_node_Êags
;

56  
node
;

57 
	}
}

59 
P¨amëîEº‹
 
	$fûe2°rög
(**
buÂ
, 
FILE
 *
fûe
)

61 
buf„r
[256];

62 *
±r
;

63 *
°rög
 = 
NULL
;

64 
size_t
 
°rögÀn
 = 0;

65 
size_t
 
buÊí
;

67 if(
fûe
) {

68 
	`fgës
(
buf„r
, (buf„r), 
fûe
)) {

69 if((
±r
 = 
	`°rchr
(
buf„r
, '\r')Ë!
NULL
)

70 *
±r
 = '\0';

71 if((
±r
 = 
	`°rchr
(
buf„r
, '\n')Ë!
NULL
)

72 *
±r
 = '\0';

73 
buÊí
 = 
	`°æí
(
buf„r
);

74 if((
±r
 = 
	`ªÆloc
(
°rög
, 
°rögÀn
+
buÊí
+1)Ë=
NULL
) {

75 
	`Cuæ_ß„‰ì
(
°rög
);

76  
PARAM_NO_MEM
;

78 
°rög
 = 
±r
;

79 
	`°r˝y
(
°rög
+
°rögÀn
, 
buf„r
);

80 
°rögÀn
 +
buÊí
;

83 *
buÂ
 = 
°rög
;

84  
PARAM_OK
;

85 
	}
}

87 
P¨amëîEº‹
 
	$fûe2mem‹y
(**
buÂ
, 
size_t
 *
size
, 
FILE
 *
fûe
)

89 *
√wbuf
;

90 *
buf„r
 = 
NULL
;

91 
size_t
 
Æloc
 = 512;

92 
size_t
 
nu£d
 = 0;

93 
size_t
 
ƒód
;

95 if(
fûe
) {

97 if(!
buf„r
 || (
Æloc
 =
nu£d
)) {

99 if(
Æloc
+1 > ((
size_t
)-1)/2) {

100 
	`Cuæ_ß„‰ì
(
buf„r
);

101  
PARAM_NO_MEM
;

103 
Æloc
 *= 2;

105 if((
√wbuf
 = 
	`ªÆloc
(
buf„r
, 
Æloc
+1)Ë=
NULL
) {

106 
	`Cuæ_ß„‰ì
(
buf„r
);

107  
PARAM_NO_MEM
;

109 
buf„r
 = 
√wbuf
;

111 
ƒód
 = 
	`‰ód
(
buf„r
+
nu£d
, 1, 
Æloc
-nu£d, 
fûe
);

112 
nu£d
 +
ƒód
;

113 } 
ƒód
);

115 
buf„r
[
nu£d
] = '\0';

117 if(
Æloc
 !
nu£d
) {

118 if((
√wbuf
 = 
	`ªÆloc
(
buf„r
, 
nu£d
+1)Ë=
NULL
) {

119 
	`Cuæ_ß„‰ì
(
buf„r
);

120  
PARAM_NO_MEM
;

122 
buf„r
 = 
√wbuf
;

125 if(!
nu£d
) {

126 
	`Cuæ_ß„‰ì
(
buf„r
);

129 *
size
 = 
nu£d
;

130 *
buÂ
 = 
buf„r
;

131  
PARAM_OK
;

132 
	}
}

134 
	$˛ó«rg
(*
°r
)

136 #ifde‡
HAVE_WRITABLE_ARGV


140 if(
°r
) {

141 
size_t
 
Àn
 = 
	`°æí
(
°r
);

142 
	`mem£t
(
°r
, ' ', 
Àn
);

145 ()
°r
;

147 
	}
}

158 
P¨amëîEº‹
 
	$°r2num
(*
vÆ
, c⁄° *
°r
)

160 if(
°r
) {

161 *
íd±r
;

162 
num
 = 
	`°πﬁ
(
°r
, &
íd±r
, 10);

163 if((
íd±r
 !
°r
Ë&& (íd±∏=°∏+ 
	`°æí
(str))) {

164 *
vÆ
 = 
num
;

165  
PARAM_OK
;

168  
PARAM_BAD_NUMERIC
;

169 
	}
}

180 
P¨amëîEº‹
 
	$°r2unum
(*
vÆ
, c⁄° *
°r
)

182 
P¨amëîEº‹
 
ªsu…
 = 
	`°r2num
(
vÆ
, 
°r
);

183 if(
ªsu…
 !
PARAM_OK
)

184  
ªsu…
;

185 if(*
vÆ
 < 0)

186  
PARAM_NEGATIVE_NUMERIC
;

188  
PARAM_OK
;

189 
	}
}

200 
P¨amëîEº‹
 
	$°r2doubÀ
(*
vÆ
, c⁄° *
°r
)

202 if(
°r
) {

203 *
íd±r
;

204 
num
 = 
	`°πod
(
°r
, &
íd±r
);

205 if((
íd±r
 !
°r
Ë&& (íd±∏=°∏+ 
	`°æí
(str))) {

206 *
vÆ
 = 
num
;

207  
PARAM_OK
;

210  
PARAM_BAD_NUMERIC
;

211 
	}
}

222 
P¨amëîEº‹
 
	$°r2udoubÀ
(*
vÆ
, c⁄° *
°r
)

224 
P¨amëîEº‹
 
ªsu…
 = 
	`°r2doubÀ
(
vÆ
, 
°r
);

225 if(
ªsu…
 !
PARAM_OK
)

226  
ªsu…
;

227 if(*
vÆ
 < 0)

228  
PARAM_NEGATIVE_NUMERIC
;

230  
PARAM_OK
;

231 
	}
}

244 
	$¥Ÿo2num
(
O≥øti⁄C⁄fig
 *
c⁄fig
, *
vÆ
, c⁄° *
°r
)

246 *
buf„r
;

247 c⁄° *
£p
 = ",";

248 *
tokí
;

250 
	s•rŸos
 {

251 c⁄° *
«me
;

252 
bô
;

253 } c⁄° 
¥Ÿos
[] = {

254 { "Æl", 
CURLPROTO_ALL
 },

255 { "hâp", 
CURLPROTO_HTTP
 },

256 { "hâps", 
CURLPROTO_HTTPS
 },

257 { "·p", 
CURLPROTO_FTP
 },

258 { "·ps", 
CURLPROTO_FTPS
 },

259 { "s˝", 
CURLPROTO_SCP
 },

260 { "s·p", 
CURLPROTO_SFTP
 },

261 { "ã ë", 
CURLPROTO_TELNET
 },

262 { "ld≠", 
CURLPROTO_LDAP
 },

263 { "ld≠s", 
CURLPROTO_LDAPS
 },

264 { "di˘", 
CURLPROTO_DICT
 },

265 { "fûe", 
CURLPROTO_FILE
 },

266 { "t·p", 
CURLPROTO_TFTP
 },

267 { "im≠", 
CURLPROTO_IMAP
 },

268 { "im≠s", 
CURLPROTO_IMAPS
 },

269 { "p›3", 
CURLPROTO_POP3
 },

270 { "p›3s", 
CURLPROTO_POP3S
 },

271 { "smç", 
CURLPROTO_SMTP
 },

272 { "smçs", 
CURLPROTO_SMTPS
 },

273 { "π•", 
CURLPROTO_RTSP
 },

274 { "g›hî", 
CURLPROTO_GOPHER
 },

275 { 
NULL
, 0 }

278 if(!
°r
)

281 
buf„r
 = 
	`°rdup
(
°r
);

282 if(!
buf„r
)

285 
tokí
 = 
	`°πok
(
buf„r
, 
£p
);

286 
tokí
;

287 
tokí
 = 
	`°πok
(
NULL
, 
£p
)) {

288 
	ee_a˘i⁄
 { 
Ælow
, 
díy
, 
£t
 } 
a˘i⁄
 =állow;

290 
•rŸos
 c⁄° *
µ
;

293 !
	`ISALNUM
(*
tokí
)) {

294 *
tokí
++) {

296 
a˘i⁄
 = 
£t
;

299 
a˘i⁄
 = 
díy
;

302 
a˘i⁄
 = 
Ælow
;

305 
	`Cuæ_ß„‰ì
(
buf„r
);

310 
µ
=
¥Ÿos
;Öp->
«me
;Öp++) {

311 if(
	`cuæx_øw_equÆ
(
tokí
, 
µ
->
«me
)) {

312 
a˘i⁄
) {

313 
díy
:

314 *
vÆ
 &~(
µ
->
bô
);

316 
Ælow
:

317 *
vÆ
 |
µ
->
bô
;

319 
£t
:

320 *
vÆ
 = 
µ
->
bô
;

327 if(!(
µ
->
«me
)) {

330 if(
a˘i⁄
 =
£t
)

331 *
vÆ
 = 0;

332 
	`w¨nf
(
c⁄fig
, "uƒecognizedÖrŸocﬁ '%s'\n", 
tokí
);

335 
	`Cuæ_ß„‰ì
(
buf„r
);

337 
	}
}

347 
P¨amëîEº‹
 
	$°r2off£t
(
cuæ_off_t
 *
vÆ
, c⁄° *
°r
)

349 *
íd±r
;

350 if(
°r
[0] == '-')

352  
PARAM_NEGATIVE_NUMERIC
;

354 #if(
CURL_SIZEOF_CURL_OFF_T
 > 
CURL_SIZEOF_LONG
)

355 *
vÆ
 = 
	`cuæx_°πoof·
(
°r
, &
íd±r
, 0);

356 if((*
vÆ
 =
CURL_OFF_T_MAX
 || *vÆ =
CURL_OFF_T_MIN
Ë&& (
ERRNO
 =
ERANGE
))

357  
PARAM_BAD_NUMERIC
;

359 *
vÆ
 = 
	`°πﬁ
(
°r
, &
íd±r
, 0);

360 if((*
vÆ
 =
LONG_MIN
 || *vÆ =
LONG_MAX
Ë&& 
ERRNO
 =
ERANGE
)

361  
PARAM_BAD_NUMERIC
;

363 if((
íd±r
 !
°r
Ë&& (íd±∏=°∏+ 
	`°æí
(str)))

364  
PARAM_OK
;

366  
PARAM_BAD_NUMERIC
;

367 
	}
}

369 
CURLcode
 
	$check∑sswd
(c⁄° *
köd
,

370 c⁄° 
size_t
 
i
,

371 c⁄° 
boﬁ
 
œ°
,

372 **
u£Ωwd
)

374 *
p£p
;

375 *
o£p
;

377 if(!*
u£Ωwd
)

378  
CURLE_OK
;

381 
p£p
 = 
	`°rchr
(*
u£Ωwd
, ':');

384 
o£p
 = 
	`°rchr
(*
u£Ωwd
, ';');

386 if(!
p£p
 && **
u£Ωwd
 != ';') {

388 
∑sswd
[256] = "";

389 
¥om±
[256];

390 
size_t
 
∑sswdÀn
;

391 
size_t
 
u£æí
 = 
	`°æí
(*
u£Ωwd
);

392 *
∑s•å
;

394 if(
o£p
)

395 *
o£p
 = '\0';

398 if(!
i
 && 
œ°
)

399 
	`cuæx_m¢¥ötf
(
¥om±
, (prompt),

401 
köd
, *
u£Ωwd
);

403 
	`cuæx_m¢¥ötf
(
¥om±
, (prompt),

405 
CURL_FORMAT_CURL_OFF_TU
 ":",

406 
köd
, *
u£Ωwd
, 
i
 + 1);

409 
	`gë∑ss_r
(
¥om±
, 
∑sswd
, (passwd));

410 
∑sswdÀn
 = 
	`°æí
(
∑sswd
);

412 if(
o£p
)

413 *
o£p
 = ';';

416 
∑s•å
 = 
	`ªÆloc
(*
u£Ωwd
,

417 
∑sswdÀn
 + 1 +

418 
u£æí
 + 1);

419 if(!
∑s•å
)

420  
CURLE_OUT_OF_MEMORY
;

423 
∑s•å
[
u£æí
] = ':';

424 
	`mem˝y
(&
∑s•å
[
u£æí
+1], 
∑sswd
, 
∑sswdÀn
+1);

425 *
u£Ωwd
 = 
∑s•å
;

428  
CURLE_OK
;

429 
	}
}

431 
P¨amëîEº‹
 
	$add2li°
(
cuæ_¶i°
 **
li°
, c⁄° *
±r
)

433 
cuæ_¶i°
 *
√wli°
 = 
	`cuæ_¶i°_≠≥nd
(*
li°
, 
±r
);

434 if(
√wli°
)

435 *
li°
 = 
√wli°
;

437  
PARAM_NO_MEM
;

439  
PARAM_OK
;

440 
	}
}

442 
	$·pfûemëhod
(
O≥øti⁄C⁄fig
 *
c⁄fig
, c⁄° *
°r
)

444 if(
	`cuæx_øw_equÆ
("sögÀcwd", 
°r
))

445  
CURLFTPMETHOD_SINGLECWD
;

446 if(
	`cuæx_øw_equÆ
("nocwd", 
°r
))

447  
CURLFTPMETHOD_NOCWD
;

448 if(
	`cuæx_øw_equÆ
("mu…icwd", 
°r
))

449  
CURLFTPMETHOD_MULTICWD
;

450 
	`w¨nf
(
c⁄fig
, "uƒecognized fç fûêmëhod '%s', usög deÁu…\n", 
°r
);

451  
CURLFTPMETHOD_MULTICWD
;

452 
	}
}

454 
	$·pcccmëhod
(
O≥øti⁄C⁄fig
 *
c⁄fig
, c⁄° *
°r
)

456 if(
	`cuæx_øw_equÆ
("∑ssive", 
°r
))

457  
CURLFTPSSL_CCC_PASSIVE
;

458 if(
	`cuæx_øw_equÆ
("a˘ive", 
°r
))

459  
CURLFTPSSL_CCC_ACTIVE
;

460 
	`w¨nf
(
c⁄fig
, "uƒecognized fç CCC mëhod '%s', usög deÁu…\n", 
°r
);

461  
CURLFTPSSL_CCC_PASSIVE
;

462 
	}
}

464 
	$dñeg©i⁄
(
O≥øti⁄C⁄fig
 *
c⁄fig
, *
°r
)

466 if(
	`cuæx_øw_equÆ
("n⁄e", 
°r
))

467  
CURLGSSAPI_DELEGATION_NONE
;

468 if(
	`cuæx_øw_equÆ
("pﬁicy", 
°r
))

469  
CURLGSSAPI_DELEGATION_POLICY_FLAG
;

470 if(
	`cuæx_øw_equÆ
("Æways", 
°r
))

471  
CURLGSSAPI_DELEGATION_FLAG
;

472 
	`w¨nf
(
c⁄fig
, "uƒecognized dñeg©i⁄ mëhod '%s', usögÇ⁄e\n", 
°r
);

473  
CURLGSSAPI_DELEGATION_NONE
;

474 
	}
}

479 *
	$my_u£øgít
()

481  
	`°rdup
(
CURL_NAME
 "/" 
CURL_VERSION
);

482 
	}
}

484 
CURLcode
 
	$gë_¨gs
(
O≥øti⁄C⁄fig
 *
c⁄fig
, c⁄° 
size_t
 
i
)

486 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

487 
boﬁ
 
œ°
 = (
c⁄fig
->
√xt
 ? 
FALSE
 : 
TRUE
);

490 if(
c⁄fig
->
u£Ωwd
 && !c⁄fig->
xﬂuth2_bóªr
) {

491 
ªsu…
 = 
	`check∑sswd
("ho°", 
i
, 
œ°
, &
c⁄fig
->
u£Ωwd
);

492 if(
ªsu…
)

493  
ªsu…
;

497 if(
c⁄fig
->
¥oxyu£Ωwd
) {

498 
ªsu…
 = 
	`check∑sswd
("¥oxy", 
i
, 
œ°
, &
c⁄fig
->
¥oxyu£Ωwd
);

499 if(
ªsu…
)

500  
ªsu…
;

504 if(!
c⁄fig
->
u£øgít
) {

505 
c⁄fig
->
u£øgít
 = 
	`my_u£øgít
();

506 if(!
c⁄fig
->
u£øgít
) {

507 
	`hñpf
(
c⁄fig
->
globÆ
->
îr‹s
, "out of memory\n");

508 
ªsu…
 = 
CURLE_OUT_OF_MEMORY
;

512  
ªsu…
;

513 
	}
}

	@src/tool_paramhlp.h

1 #i‚de‡
HEADER_CURL_TOOL_PARAMHLP_H


2 
	#HEADER_CURL_TOOL_PARAMHLP_H


	)

24 
	~"toﬁ_£tup.h
"

26 
gëout
 *
√w_gëout
(
O≥øti⁄C⁄fig
 *
c⁄fig
);

28 
P¨amëîEº‹
 
fûe2°rög
(**
buÂ
, 
FILE
 *
fûe
);

30 
P¨amëîEº‹
 
fûe2mem‹y
(**
buÂ
, 
size_t
 *
size
, 
FILE
 *
fûe
);

32 
˛ó«rg
(*
°r
);

34 
P¨amëîEº‹
 
°r2num
(*
vÆ
, c⁄° *
°r
);

35 
P¨amëîEº‹
 
°r2unum
(*
vÆ
, c⁄° *
°r
);

36 
P¨amëîEº‹
 
°r2doubÀ
(*
vÆ
, c⁄° *
°r
);

37 
P¨amëîEº‹
 
°r2udoubÀ
(*
vÆ
, c⁄° *
°r
);

39 
¥Ÿo2num
(
O≥øti⁄C⁄fig
 *
c⁄fig
, *
vÆ
, c⁄° *
°r
);

41 
P¨amëîEº‹
 
°r2off£t
(
cuæ_off_t
 *
vÆ
, c⁄° *
°r
);

43 
CURLcode
 
gë_¨gs
(
O≥øti⁄C⁄fig
 *
c⁄fig
, c⁄° 
size_t
 
i
);

45 
P¨amëîEº‹
 
add2li°
(
cuæ_¶i°
 **
li°
, c⁄° *
±r
);

47 
·pfûemëhod
(
O≥øti⁄C⁄fig
 *
c⁄fig
, c⁄° *
°r
);

49 
·pcccmëhod
(
O≥øti⁄C⁄fig
 *
c⁄fig
, c⁄° *
°r
);

51 
dñeg©i⁄
(
O≥øti⁄C⁄fig
 *
c⁄fig
, *
°r
);

	@src/tool_parsecfg.c

22 
	~"toﬁ_£tup.h
"

24 
	#ENABLE_CURLX_PRINTF


	)

26 
	~"cuæx.h
"

28 
	~"toﬁ_cfgabÀ.h
"

29 
	~"toﬁ_gë∑øm.h
"

30 
	~"toﬁ_hñ≥rs.h
"

31 
	~"toﬁ_homedú.h
"

32 
	~"toﬁ_msgs.h
"

33 
	~"toﬁ_∑r£cfg.h
"

35 
	~"memdebug.h
"

37 
	#CURLRC
 
DOT_CHAR
 "cuærc"

	)

41 
	#ISSEP
(
x
,
dash
Ë(!dash && (((xË='='Ë|| ((xË=':')))

	)

43 c⁄° *
un¶ashquŸe
(c⁄° *
löe
, *
∑øm
);

44 *
my_gë_löe
(
FILE
 *
Â
);

47 
	$∑r£c⁄fig
(c⁄° *
fûíame
, 
GlobÆC⁄fig
 *
globÆ
)

49 
ªs
;

50 
FILE
 *
fûe
;

51 
fûebuf„r
[512];

52 
boﬁ
 
u£d¨g
;

53 *
home
;

54 
rc
 = 0;

55 
O≥øti⁄C⁄fig
 *
›î©i⁄
 = 
globÆ
->
fú°
;

57 if(!
fûíame
 || !*filename) {

60 #i‚de‡
__AMIGA__


61 
fûíame
 = 
CURLRC
;

62 
home
 = 
	`homedú
();

63 if(
home
) {

64 if(
	`°æí
(
home
Ë< ((
fûebuf„r
Ë- såÀn(
CURLRC
))) {

65 
	`¢¥ötf
(
fûebuf„r
, (filebuffer),

66 "%s%s%s", 
home
, 
DIR_CHAR
, 
CURLRC
);

68 #ifde‡
WIN32


72 
fûe
 = 
	`f›í
(
fûebuf„r
, "r");

73 if(
fûe
 !
NULL
) {

74 
	`f˛o£
(
fûe
);

75 
fûíame
 = 
fûebuf„r
;

82 
n
 = 
	`GëModuÀFûeName
(0, 
fûebuf„r
, (filebuffer));

83 if(
n
 > 0 &&Ç < ()(
fûebuf„r
)) {

85 *
œ°dúch¨
 = 
	`°ºchr
(
fûebuf„r
, '\\');

86 if(
œ°dúch¨
) {

87 
size_t
 
ªmaöög
;

88 *
œ°dúch¨
 = 0;

90 
ªmaöög
 = (
fûebuf„r
Ë- 
	`°æí
(filebuffer);

91 if(
	`°æí
(
CURLRC
Ë< 
ªmaöög
 - 1) {

92 
	`¢¥ötf
(
œ°dúch¨
, 
ªmaöög
,

93 "%s%s", 
DIR_CHAR
, 
CURLRC
);

97 
fûíame
 = 
fûebuf„r
;

103 
fûíame
 = 
fûebuf„r
;

106 
	`Cuæ_ß„‰ì
(
home
);

112 
fûíame
 = "ENV:" 
CURLRC
;

117 if(
	`°rcmp
(
fûíame
,"-"))

118 
fûe
 = 
	`f›í
(
fûíame
, "r");

120 
fûe
 = 
°dö
;

122 if(
fûe
) {

123 *
löe
;

124 *
Æöe
;

125 *
›ti⁄
;

126 *
∑øm
;

127 
löío
 = 0;

128 
boﬁ
 
Ælo˚d_∑øm
;

129 
boﬁ
 
dashed_›ti⁄
;

131 
NULL
 !(
Æöe
 = 
	`my_gë_löe
(
fûe
))) {

132 
löío
++;

133 
löe
 = 
Æöe
;

134 
Ælo˚d_∑øm
=
FALSE
;

137 *
löe
 && 
	`ISSPACE
(*line))

138 
löe
++;

140 *
löe
) {

147 
	`Cuæ_ß„‰ì
(
Æöe
);

152 
›ti⁄
 = 
löe
;

155 
dashed_›ti⁄
 = 
›ti⁄
[0]=='-'?
TRUE
:
FALSE
;

157 *
löe
 && !
	`ISSPACE
(*löeË&& !
	`ISSEP
(*löe, 
dashed_›ti⁄
))

158 
löe
++;

161 if(*
löe
)

162 *
löe
++ = '\0';

164 #ifde‡
DEBUG_CONFIG


165 
	`Ârötf
(
°dîr
, "GOT: %s\n", 
›ti⁄
);

169 *
löe
 && (
	`ISSPACE
(*löeË|| 
	`ISSEP
(*löe, 
dashed_›ti⁄
)))

170 
löe
++;

173 if(*
löe
 == '\"') {

175 
löe
++;

176 
∑øm
 = 
	`mÆloc
(
	`°æí
(
löe
) + 1);

177 if(!
∑øm
) {

179 
	`Cuæ_ß„‰ì
(
Æöe
);

180 
rc
 = 1;

183 
Ælo˚d_∑øm
 = 
TRUE
;

184 ()
	`un¶ashquŸe
(
löe
, 
∑øm
);

187 
∑øm
 = 
löe
;

188 *
löe
 && !
	`ISSPACE
(*line))

189 
löe
++;

190 *
löe
 = '\0';

193 
löe
++;

195 *
löe
 && 
	`ISSPACE
(*line))

196 
löe
++;

198 *
löe
) {

205 
	`w¨nf
(
›î©i⁄
, "%s:%d: warning: '%s' uses unquoted white space in"

207 
fûíame
, 
löío
, 
›ti⁄
);

211 if(
∑øm
 && !*param) {

214 if(
Ælo˚d_∑øm
)

215 
	`Cuæ_ß„‰ì
(
∑øm
);

216 
∑øm
 = 
NULL
;

219 #ifde‡
DEBUG_CONFIG


220 
	`Ârötf
(
°dîr
, "PARAM: \"%s\"\n",(
∑øm
 ?Öaram : "(null)"));

222 
ªs
 = 
	`gë∑ømëî
(
›ti⁄
, 
∑øm
, &
u£d¨g
, 
globÆ
, 
›î©i⁄
);

224 if(
∑øm
 && *∑øm && !
u£d¨g
)

226 
ªs
 = 
PARAM_GOT_EXTRA_PARAMETER
;

228 if(
ªs
 =
PARAM_NEXT_OPERATION
) {

229 if(
›î©i⁄
->
uæ_li°
 && o≥øti⁄->uæ_li°->
uæ
) {

231 
›î©i⁄
->
√xt
 = 
	`mÆloc
((
O≥øti⁄C⁄fig
));

232 if(
›î©i⁄
->
√xt
) {

234 
	`c⁄fig_öô
(
›î©i⁄
->
√xt
);

237 
›î©i⁄
->
√xt
->
ósy
 = 
globÆ
->easy;

240 
›î©i⁄
->
√xt
->
globÆ
 = global;

243 
globÆ
->
œ°
 = 
›î©i⁄
->
√xt
;

246 
›î©i⁄
->
√xt
->
¥ev
 = operation;

247 
›î©i⁄
 = o≥øti⁄->
√xt
;

250 
ªs
 = 
PARAM_NO_MEM
;

254 if(
ªs
 !
PARAM_OK
 &&Ñe†!
PARAM_NEXT_OPERATION
) {

256 if(!
	`°rcmp
(
fûíame
, "-")) {

257 
fûíame
 = (*)"<stdin>";

259 if(
ªs
 !
PARAM_HELP_REQUESTED
 &&

260 
ªs
 !
PARAM_MANUAL_REQUESTED
 &&

261 
ªs
 !
PARAM_VERSION_INFO_REQUESTED
 &&

262 
ªs
 !
PARAM_ENGINES_REQUESTED
) {

263 c⁄° *
ªas⁄
 = 
	`∑øm2ãxt
(
ªs
);

264 
	`w¨nf
(
›î©i⁄
, "%s:%d: warning: '%s' %s\n",

265 
fûíame
, 
löío
, 
›ti⁄
, 
ªas⁄
);

269 if(
Ælo˚d_∑øm
)

270 
	`Cuæ_ß„‰ì
(
∑øm
);

272 
	`Cuæ_ß„‰ì
(
Æöe
);

274 if(
fûe
 !
°dö
)

275 
	`f˛o£
(
fûe
);

278 
rc
 = 1;

280  
rc
;

281 
	}
}

290 c⁄° *
	$un¶ashquŸe
(c⁄° *
löe
, *
∑øm
)

292 *
löe
 && (*line != '\"')) {

293 if(*
löe
 == '\\') {

294 
out
;

295 
löe
++;

298 
out
 = *
löe
) {

302 
out
 = '\t';

305 
out
 = '\n';

308 
out
 = '\r';

311 
out
 = '\v';

314 *
∑øm
++ = 
out
;

315 
löe
++;

318 *
∑øm
++ = *
löe
++;

320 *
∑øm
 = '\0';

321  
löe
;

322 
	}
}

329 *
	$my_gë_löe
(
FILE
 *
Â
)

331 
buf
[4096];

332 *
∆
 = 
NULL
;

333 *
löe
 = 
NULL
;

336 if(
NULL
 =
	`fgës
(
buf
, (buf), 
Â
))

338 if(!
löe
) {

339 
löe
 = 
	`°rdup
(
buf
);

340 if(!
löe
)

341  
NULL
;

344 *
±r
;

345 
size_t
 
löñí
 = 
	`°æí
(
löe
);

346 
±r
 = 
	`ªÆloc
(
löe
, 
löñí
 + 
	`°æí
(
buf
) + 1);

347 if(!
±r
) {

348 
	`Cuæ_ß„‰ì
(
löe
);

349  
NULL
;

351 
löe
 = 
±r
;

352 
	`°r˝y
(&
löe
[
löñí
], 
buf
);

354 
∆
 = 
	`°rchr
(
löe
, '\n');

355 } !
∆
);

357 if(
∆
)

358 *
∆
 = '\0';

360  
löe
;

361 
	}
}

	@src/tool_parsecfg.h

1 #i‚de‡
HEADER_CURL_TOOL_PARSECFG_H


2 
	#HEADER_CURL_TOOL_PARSECFG_H


	)

24 
	~"toﬁ_£tup.h
"

26 
∑r£c⁄fig
(c⁄° *
fûíame
, 
GlobÆC⁄fig
 *
c⁄fig
);

	@src/tool_sdecls.h

1 #i‚de‡
HEADER_CURL_TOOL_SDECLS_H


2 
	#HEADER_CURL_TOOL_SDECLS_H


	)

24 
	~"toﬁ_£tup.h
"

25 #ifde‡
USE_METALINK


26 
	~<mëÆök/mëÆök.h
>

65 
	sOutSåu˘
 {

66 *
	mfûíame
;

67 
boﬁ
 
	mÆloc_fûíame
;

68 
boﬁ
 
	mis_cd_fûíame
;

69 
boﬁ
 
	ms_i§eg
;

70 
boﬁ
 
	mf›íed
;

71 
FILE
 *
	m°ªam
;

72 
O≥øti⁄C⁄fig
 *
	mc⁄fig
;

73 
cuæ_off_t
 
	mbyãs
;

74 
cuæ_off_t
 
	möô
;

75 #ifde‡
USE_METALINK


76 
mëÆök_∑r£r_c⁄ãxt_t
 *
	mmëÆök_∑r£r
;

91 
	sInSåu˘
 {

92 
	mfd
;

93 
O≥øti⁄C⁄fig
 *
	mc⁄fig
;

103 
	sgëout
 {

104 
gëout
 *
	m√xt
;

105 *
	muæ
;

106 *
	moutfûe
;

107 *
	möfûe
;

108 
	mÊags
;

111 
	#GETOUT_OUTFILE
 (1<<0Ë

	)

112 
	#GETOUT_URL
 (1<<1Ë

	)

113 
	#GETOUT_USEREMOTE
 (1<<2Ë

	)

114 
	#GETOUT_UPLOAD
 (1<<3Ë

	)

115 
	#GETOUT_NOUPLOAD
 (1<<4Ë

	)

116 
	#GETOUT_METALINK
 (1<<5Ë

	)

123 
	mTRACE_NONE
,

124 
	mTRACE_BIN
,

125 
	mTRACE_ASCII
,

126 
	mTRACE_PLAIN


127 } 
	tåa˚
;

135 
	mHTTPREQ_UNSPEC
,

136 
	mHTTPREQ_GET
,

137 
	mHTTPREQ_HEAD
,

138 
	mHTTPREQ_POST
,

139 
	mHTTPREQ_SIMPLEPOST
,

140 
	mHTTPREQ_CUSTOM
,

141 
	mHTTPREQ_LAST


142 } 
	tHâpReq
;

150 
	~"toﬁ_cfgabÀ.h
"

	@src/tool_setopt.c

22 
	~"toﬁ_£tup.h
"

24 #i‚de‡
CURL_DISABLE_LIBCURL_OPTION


26 
	#ENABLE_CURLX_PRINTF


	)

28 
	~"cuæx.h
"

30 
	~"toﬁ_cfgabÀ.h
"

31 
	~"toﬁ_ósy§c.h
"

32 
	~"toﬁ_£t›t.h
"

34 
	~"memdebug.h
"

41 
	#NV
(
e
Ë{#e,É}

	)

42 
	#NV1
(
e
, 
v
Ë{#e, (v)}

	)

43 
	#NVEND
 {
NULL
, 0}

	)

45 c⁄° 
NameVÆue
 
	g£t›t_nv_CURLPROXY
[] = {

46 
NV
(
CURLPROXY_HTTP
),

47 
NV
(
CURLPROXY_HTTP_1_0
),

48 
NV
(
CURLPROXY_SOCKS4
),

49 
NV
(
CURLPROXY_SOCKS5
),

50 
NV
(
CURLPROXY_SOCKS4A
),

51 
NV
(
CURLPROXY_SOCKS5_HOSTNAME
),

52 
NVEND
,

55 c⁄° 
NameVÆueUnsig√d
 
	g£t›t_nv_CURLAUTH
[] = {

56 
NV
(
CURLAUTH_ANY
),

57 
NV
(
CURLAUTH_ANYSAFE
),

58 
NV
(
CURLAUTH_BASIC
),

59 
NV
(
CURLAUTH_DIGEST
),

60 
NV
(
CURLAUTH_GSSNEGOTIATE
),

61 
NV
(
CURLAUTH_NTLM
),

62 
NV
(
CURLAUTH_DIGEST_IE
),

63 
NV
(
CURLAUTH_NTLM_WB
),

64 
NV
(
CURLAUTH_ONLY
),

65 
NV
(
CURLAUTH_NONE
),

66 
NVEND
,

69 c⁄° 
NameVÆue
 
	g£t›t_nv_CURL_HTTP_VERSION
[] = {

70 
NV
(
CURL_HTTP_VERSION_NONE
),

71 
NV
(
CURL_HTTP_VERSION_1_0
),

72 
NV
(
CURL_HTTP_VERSION_1_1
),

73 
NVEND
,

76 c⁄° 
NameVÆue
 
	g£t›t_nv_CURL_SSLVERSION
[] = {

77 
NV
(
CURL_SSLVERSION_DEFAULT
),

78 
NV
(
CURL_SSLVERSION_TLSv1
),

79 
NV
(
CURL_SSLVERSION_SSLv2
),

80 
NV
(
CURL_SSLVERSION_SSLv3
),

81 
NV
(
CURL_SSLVERSION_TLSv1_0
),

82 
NV
(
CURL_SSLVERSION_TLSv1_1
),

83 
NV
(
CURL_SSLVERSION_TLSv1_2
),

84 
NVEND
,

87 c⁄° 
NameVÆue
 
	g£t›t_nv_CURL_TIMECOND
[] = {

88 
NV
(
CURL_TIMECOND_IFMODSINCE
),

89 
NV
(
CURL_TIMECOND_IFUNMODSINCE
),

90 
NV
(
CURL_TIMECOND_LASTMOD
),

91 
NV
(
CURL_TIMECOND_NONE
),

92 
NVEND
,

95 c⁄° 
NameVÆue
 
	g£t›t_nv_CURLFTPSSL_CCC
[] = {

96 
NV
(
CURLFTPSSL_CCC_NONE
),

97 
NV
(
CURLFTPSSL_CCC_PASSIVE
),

98 
NV
(
CURLFTPSSL_CCC_ACTIVE
),

99 
NVEND
,

102 c⁄° 
NameVÆue
 
	g£t›t_nv_CURLUSESSL
[] = {

103 
NV
(
CURLUSESSL_NONE
),

104 
NV
(
CURLUSESSL_TRY
),

105 
NV
(
CURLUSESSL_CONTROL
),

106 
NV
(
CURLUSESSL_ALL
),

107 
NVEND
,

110 c⁄° 
NameVÆue
 
	g£t›t_nv_CURL_NETRC
[] = {

111 
NV
(
CURL_NETRC_IGNORED
),

112 
NV
(
CURL_NETRC_OPTIONAL
),

113 
NV
(
CURL_NETRC_REQUIRED
),

114 
NVEND
,

119 c⁄° 
NameVÆue
 
	g£t›t_nv_CURLPROTO
[] = {

120 
NV
(
CURLPROTO_ALL
),

121 
NV
(
CURLPROTO_DICT
),

122 
NV
(
CURLPROTO_FILE
),

123 
NV
(
CURLPROTO_FTP
),

124 
NV
(
CURLPROTO_FTPS
),

125 
NV
(
CURLPROTO_GOPHER
),

126 
NV
(
CURLPROTO_HTTP
),

127 
NV
(
CURLPROTO_HTTPS
),

128 
NV
(
CURLPROTO_IMAP
),

129 
NV
(
CURLPROTO_IMAPS
),

130 
NV
(
CURLPROTO_LDAP
),

131 
NV
(
CURLPROTO_LDAPS
),

132 
NV
(
CURLPROTO_POP3
),

133 
NV
(
CURLPROTO_POP3S
),

134 
NV
(
CURLPROTO_RTSP
),

135 
NV
(
CURLPROTO_SCP
),

136 
NV
(
CURLPROTO_SFTP
),

137 
NV
(
CURLPROTO_SMTP
),

138 
NV
(
CURLPROTO_SMTPS
),

139 
NV
(
CURLPROTO_TELNET
),

140 
NV
(
CURLPROTO_TFTP
),

141 
NVEND
,

145 c⁄° 
NameVÆue
 
	g£t›t_nv_CURLNONZERODEFAULTS
[] = {

146 
NV1
(
CURLOPT_SSL_VERIFYPEER
, 1),

147 
NV1
(
CURLOPT_SSL_VERIFYHOST
, 1),

148 
NV1
(
CURLOPT_SSL_ENABLE_NPN
, 1),

149 
NV1
(
CURLOPT_SSL_ENABLE_ALPN
, 1),

150 
NVEND


154 
	#ADD
(
¨gs
) do { \

155 
ªt
 = 
ósy§c_add
 
¨gs
; \

156 if(
ªt
) \

157 
nomem
; \

158 } 
WHILE_FALSE


	)

159 
	#ADDF
(
¨gs
) do { \

160 
ªt
 = 
ósy§c_addf
 
¨gs
; \

161 if(
ªt
) \

162 
nomem
; \

163 } 
WHILE_FALSE


	)

165 
	#DECL0
(
s
Ë
	`ADD
((&
ósy§c_de˛
, s))

	)

166 
	#DECL1
(
f
,
a
Ë
	`ADDF
((&
ósy§c_de˛
, f,a))

	)

168 
	#DATA0
(
s
Ë
	`ADD
((&
ósy§c_d©a
, s))

	)

169 
	#DATA1
(
f
,
a
Ë
	`ADDF
((&
ósy§c_d©a
, f,a))

	)

170 
	#DATA2
(
f
,
a
,
b
Ë
	`ADDF
((&
ósy§c_d©a
, f,a,b))

	)

171 
	#DATA3
(
f
,
a
,
b
,
c
Ë
	`ADDF
((&
ósy§c_d©a
, f,a,b,c))

	)

173 
	#CODE0
(
s
Ë
	`ADD
((&
ósy§c_code
, s))

	)

174 
	#CODE1
(
f
,
a
Ë
	`ADDF
((&
ósy§c_code
, f,a))

	)

175 
	#CODE2
(
f
,
a
,
b
Ë
	`ADDF
((&
ósy§c_code
, f,a,b))

	)

176 
	#CODE3
(
f
,
a
,
b
,
c
Ë
	`ADDF
((&
ósy§c_code
, f,a,b,c))

	)

178 
	#CLEAN0
(
s
Ë
	`ADD
((&
ósy§c_˛ón
, s))

	)

179 
	#CLEAN1
(
f
,
a
Ë
	`ADDF
((&
ósy§c_˛ón
, f,a))

	)

181 
	#REM0
(
s
Ë
	`ADD
((&
ósy§c_tooh¨d
, s))

	)

182 
	#REM1
(
f
,
a
Ë
	`ADDF
((&
ósy§c_tooh¨d
, f,a))

	)

183 
	#REM2
(
f
,
a
,
b
Ë
	`ADDF
((&
ósy§c_tooh¨d
, f,a,b))

	)

187 *
	$c_esˇ≥
(c⁄° *
°r
)

189 
size_t
 
Àn
 = 0;

190 c⁄° *
s
;

191 
c
;

192 *
esˇ≥d
, *
e
;

194 
Àn
 = 
	`°æí
(
°r
);

195 
esˇ≥d
 = 
	`mÆloc
(4 * 
Àn
 + 1);

196 if(!
esˇ≥d
)

197  
NULL
;

199 
e
 = 
esˇ≥d
;

200 
s
=
°r
; (
c
=*s) != '\0'; s++) {

201 if(
c
=='\n') {

202 
	`°r˝y
(
e
, "\\n");

203 
e
 += 2;

205 if(
c
=='\r') {

206 
	`°r˝y
(
e
, "\\r");

207 
e
 += 2;

209 if(
c
=='\t') {

210 
	`°r˝y
(
e
, "\\t");

211 
e
 += 2;

213 if(
c
=='\\') {

214 
	`°r˝y
(
e
, "\\\\");

215 
e
 += 2;

217 if(
c
=='"') {

218 
	`°r˝y
(
e
, "\\\"");

219 
e
 += 2;

221 if(! 
	`i•röt
(
c
)) {

222 
	`¢¥ötf
(
e
, 4, "\\%03o", 
c
);

223 
e
 += 4;

226 *
e
++ = 
c
;

228 *
e
 = '\0';

229  
esˇ≥d
;

230 
	}
}

233 
CURLcode
 
	$toﬁ_£t›t_íum
(
CURL
 *
cuæ
, 
GlobÆC⁄fig
 *
c⁄fig
,

234 c⁄° *
«me
, 
CURL›ti⁄
 
èg
,

235 c⁄° 
NameVÆue
 *
nvli°
, 
lvÆ
)

237 
CURLcode
 
ªt
 = 
CURLE_OK
;

238 
boﬁ
 
skù
 = 
FALSE
;

240 
ªt
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
èg
, 
lvÆ
);

241 if(!
lvÆ
)

242 
skù
 = 
TRUE
;

244 if(
c⁄fig
->
libcuæ
 && !
skù
 && !
ªt
) {

246 c⁄° 
NameVÆue
 *
nv
 = 
NULL
;

247 
nv
=
nvli°
;Çv->
«me
;Çv++) {

248 if(
nv
->
vÆue
 =
lvÆ
) ;

250 if(! 
nv
->
«me
) {

254 
	`CODE2
("cuæ_ósy_£t›t(hnd, %s, %ldL);", 
«me
, 
lvÆ
);

257 
	`CODE2
("cuæ_ósy_£t›t(hnd, %s, (l⁄g)%s);", 
«me
, 
nv
->name);

261 
nomem
:

262  
ªt
;

263 
	}
}

266 
CURLcode
 
	$toﬁ_£t›t_Êags
(
CURL
 *
cuæ
, 
GlobÆC⁄fig
 *
c⁄fig
,

267 c⁄° *
«me
, 
CURL›ti⁄
 
èg
,

268 c⁄° 
NameVÆue
 *
nvli°
, 
lvÆ
)

270 
CURLcode
 
ªt
 = 
CURLE_OK
;

271 
boﬁ
 
skù
 = 
FALSE
;

273 
ªt
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
èg
, 
lvÆ
);

274 if(!
lvÆ
)

275 
skù
 = 
TRUE
;

277 if(
c⁄fig
->
libcuæ
 && !
skù
 && !
ªt
) {

279 
¥ómbÀ
[80];

280 
ª°
 = 
lvÆ
;

281 c⁄° 
NameVÆue
 *
nv
 = 
NULL
;

282 
	`¢¥ötf
(
¥ómbÀ
, (preamble),

283 "cuæ_ósy_£t›t(hnd, %s, ", 
«me
);

284 
nv
=
nvli°
;Çv->
«me
;Çv++) {

285 if((
nv
->
vÆue
 & ~ 
ª°
) == 0) {

287 
ª°
 &~ 
nv
->
vÆue
;

288 
	`CODE3
("%s(long)%s%s",

289 
¥ómbÀ
, 
nv
->
«me
, 
ª°
 ? " |" : ");");

290 if(!
ª°
)

293 
	`¢¥ötf
(
¥ómbÀ
, ’ªambÀ), "%*s", 
	`°æí
(preamble), "");

299 if(
ª°
)

300 
	`CODE2
("%s%ldL);", 
¥ómbÀ
, 
ª°
);

303 
nomem
:

304  
ªt
;

305 
	}
}

308 
CURLcode
 
	$toﬁ_£t›t_bômask
(
CURL
 *
cuæ
, 
GlobÆC⁄fig
 *
c⁄fig
,

309 c⁄° *
«me
, 
CURL›ti⁄
 
èg
,

310 c⁄° 
NameVÆueUnsig√d
 *
nvli°
,

311 
lvÆ
)

313 
CURLcode
 
ªt
 = 
CURLE_OK
;

314 
boﬁ
 
skù
 = 
FALSE
;

316 
ªt
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
èg
, 
lvÆ
);

317 if(!
lvÆ
)

318 
skù
 = 
TRUE
;

320 if(
c⁄fig
->
libcuæ
 && !
skù
 && !
ªt
) {

322 
¥ómbÀ
[80];

323 
ª°
 = ()
lvÆ
;

324 c⁄° 
NameVÆueUnsig√d
 *
nv
 = 
NULL
;

325 
	`¢¥ötf
(
¥ómbÀ
, (preamble),

326 "cuæ_ósy_£t›t(hnd, %s, ", 
«me
);

327 
nv
=
nvli°
;Çv->
«me
;Çv++) {

328 if((
nv
->
vÆue
 & ~ 
ª°
) == 0) {

330 
ª°
 &~ 
nv
->
vÆue
;

331 
	`CODE3
("%s(long)%s%s",

332 
¥ómbÀ
, 
nv
->
«me
, 
ª°
 ? " |" : ");");

333 if(!
ª°
)

336 
	`¢¥ötf
(
¥ómbÀ
, ’ªambÀ), "%*s", 
	`°æí
(preamble), "");

342 if(
ª°
)

343 
	`CODE2
("%s%luUL);", 
¥ómbÀ
, 
ª°
);

346 
nomem
:

347  
ªt
;

348 
	}
}

351 
CURLcode
 
	$toﬁ_£t›t_hâµo°
(
CURL
 *
cuæ
, 
GlobÆC⁄fig
 *
c⁄fig
,

352 c⁄° *
«me
, 
CURL›ti⁄
 
èg
,

353 
cuæ_hâµo°
 *
po°
)

355 
CURLcode
 
ªt
 = 
CURLE_OK
;

356 *
esˇ≥d
 = 
NULL
;

357 
boﬁ
 
skù
 = 
FALSE
;

359 
ªt
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
èg
, 
po°
);

360 if(!
po°
)

361 
skù
 = 
TRUE
;

363 if(
c⁄fig
->
libcuæ
 && !
skù
 && !
ªt
) {

364 
cuæ_hâµo°
 *
µ
, *
p
;

365 
i
;

367 
i
 = ++ 
ósy§c_f‹m_cou¡
;

368 
	`DECL1
("°ru˘ cuæ_hâµo° *po°%d;", 
i
);

369 
	`DATA1
("po°%d = NULL;", 
i
);

370 
	`CLEAN1
("cuæ_f‹m‰ì’o°%d);", 
i
);

371 
	`CLEAN1
("po°%d = NULL;", 
i
);

372 if(
i
 == 1)

373 
	`DECL0
("struct curl_httppost *postend;");

374 
	`DATA0
("postend = NULL;");

375 
p
=
po°
;Ö;Öı->
√xt
) {

376 
	`DATA1
("cuæ_f‹madd(&po°%d, &po°íd,", 
i
);

377 
	`DATA1
(" CURLFORM_COPYNAME, \"%s\",", 
p
->
«me
);

378 
µ
=
p
;Öp;Öpıp->
m‹e
) {

381 
	`Cuæ_ß„‰ì
(
esˇ≥d
);

382 
esˇ≥d
 = 
	`c_esˇ≥
(
µ
->
c⁄ã¡s
);

383 if(!
esˇ≥d
) {

384 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

385 
nomem
;

387 if(
µ
->
Êags
 & 
HTTPPOST_FILENAME
) {

389 
	`DATA1
(" CURLFORM_FILE, \"%s\",", 
esˇ≥d
);

391 if(
µ
->
Êags
 & 
HTTPPOST_READFILE
) {

393 
	`DATA1
(" CURLFORM_FILECONTENT, \"%s\",", 
esˇ≥d
);

396 
	`DATA1
(" CURLFORM_COPYCONTENTS, \"%s\",", 
esˇ≥d
);

397 if(
µ
->
showfûíame
) {

398 
	`Cuæ_ß„‰ì
(
esˇ≥d
);

399 
esˇ≥d
 = 
	`c_esˇ≥
(
µ
->
showfûíame
);

400 if(!
esˇ≥d
) {

401 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

402 
nomem
;

404 
	`DATA1
(" CURLFORM_FILENAME, \"%s\",", 
esˇ≥d
);

406 if(
µ
->
c⁄ã¡ty≥
) {

407 
	`Cuæ_ß„‰ì
(
esˇ≥d
);

408 
esˇ≥d
 = 
	`c_esˇ≥
(
µ
->
c⁄ã¡ty≥
);

409 if(!
esˇ≥d
) {

410 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

411 
nomem
;

413 
	`DATA1
(" CURLFORM_CONTENTTYPE, \"%s\",", 
esˇ≥d
);

416 
	`DATA0
(" CURLFORM_END);");

418 
	`CODE2
("cuæ_ósy_£t›t(hnd, %s,Öo°%d);", 
«me
, 
i
);

421 
nomem
:

422 
	`Cuæ_ß„‰ì
(
esˇ≥d
);

423  
ªt
;

424 
	}
}

427 
CURLcode
 
	$toﬁ_£t›t_¶i°
(
CURL
 *
cuæ
, 
GlobÆC⁄fig
 *
c⁄fig
,

428 c⁄° *
«me
, 
CURL›ti⁄
 
èg
,

429 
cuæ_¶i°
 *
li°
)

431 
CURLcode
 
ªt
 = 
CURLE_OK
;

432 *
esˇ≥d
 = 
NULL
;

433 
boﬁ
 
skù
 = 
FALSE
;

435 
ªt
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
èg
, 
li°
);

436 if(!
li°
)

437 
skù
 = 
TRUE
;

439 if(
c⁄fig
->
libcuæ
 && !
skù
 && !
ªt
) {

440 
cuæ_¶i°
 *
s
;

441 
i
;

443 
i
 = ++ 
ósy§c_¶i°_cou¡
;

444 
	`DECL1
("°ru˘ cuæ_¶i° *¶i°%d;", 
i
);

445 
	`DATA1
("¶i°%d = NULL;", 
i
);

446 
	`CLEAN1
("cuæ_¶i°_‰ì_Æl(¶i°%d);", 
i
);

447 
	`CLEAN1
("¶i°%d = NULL;", 
i
);

448 
s
=
li°
; s; s=s->
√xt
) {

449 
	`Cuæ_ß„‰ì
(
esˇ≥d
);

450 
esˇ≥d
 = 
	`c_esˇ≥
(
s
->
d©a
);

451 if(!
esˇ≥d
) {

452 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

453 
nomem
;

455 
	`DATA3
("¶i°%d = cuæ_¶i°_≠≥nd(¶i°%d, \"%s\");", 
i
, i, 
esˇ≥d
);

457 
	`CODE2
("cuæ_ósy_£t›t(hnd, %s, sli°%d);", 
«me
, 
i
);

460 
nomem
:

461 
	`Cuæ_ß„‰ì
(
esˇ≥d
);

462  
ªt
;

463 
	}
}

467 
CURLcode
 
	$toﬁ_£t›t
(
CURL
 *
cuæ
, 
boﬁ
 
°r
, 
GlobÆC⁄fig
 *
c⁄fig
,

468 c⁄° *
«me
, 
CURL›ti⁄
 
èg
, ...)

470 
va_li°
 
¨g
;

471 
buf
[256];

472 c⁄° *
vÆue
 = 
NULL
;

473 
boﬁ
 
ªm¨k
 = 
FALSE
;

474 
boﬁ
 
skù
 = 
FALSE
;

475 
boﬁ
 
esˇ≥
 = 
FALSE
;

476 *
esˇ≥d
 = 
NULL
;

477 
CURLcode
 
ªt
 = 
CURLE_OK
;

479 
	`va_°¨t
(
¨g
, 
èg
);

481 if(
èg
 < 
CURLOPTTYPE_OBJECTPOINT
) {

483 
lvÆ
 = 
	`va_¨g
(
¨g
, );

484 
defvÆ
 = 0L;

485 c⁄° 
NameVÆue
 *
nv
 = 
NULL
;

486 
nv
=
£t›t_nv_CURLNONZERODEFAULTS
;Çv->
«me
;Çv++) {

487 if(!
	`°rcmp
(
«me
, 
nv
->name)) {

488 
defvÆ
 = 
nv
->
vÆue
;

493 
	`¢¥ötf
(
buf
, (buf), "%ldL", 
lvÆ
);

494 
vÆue
 = 
buf
;

495 
ªt
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
èg
, 
lvÆ
);

496 if(
lvÆ
 =
defvÆ
)

497 
skù
 = 
TRUE
;

499 if(
èg
 < 
CURLOPTTYPE_OFF_T
) {

501 *
pvÆ
 = 
	`va_¨g
(
¨g
, *);

504 if(
èg
 >
CURLOPTTYPE_FUNCTIONPOINT
) {

505 if(
pvÆ
) {

506 
vÆue
 = "functionpointer";

507 
ªm¨k
 = 
TRUE
;

510 
skù
 = 
TRUE
;

513 if(
pvÆ
 && 
°r
) {

514 
vÆue
 = (*)
pvÆ
;

515 
esˇ≥
 = 
TRUE
;

517 if(
pvÆ
) {

518 
vÆue
 = "objectpointer";

519 
ªm¨k
 = 
TRUE
;

522 
skù
 = 
TRUE
;

524 
ªt
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
èg
, 
pvÆ
);

529 
cuæ_off_t
 
ovÆ
 = 
	`va_¨g
(
¨g
, curl_off_t);

530 
	`¢¥ötf
(
buf
, (buf),

531 "(cuæ_off_t)%" 
CURL_FORMAT_CURL_OFF_T
, 
ovÆ
);

532 
vÆue
 = 
buf
;

533 
ªt
 = 
	`cuæ_ósy_£t›t
(
cuæ
, 
èg
, 
ovÆ
);

535 if(!
ovÆ
)

536 
skù
 = 
TRUE
;

539 
	`va_íd
(
¨g
);

541 if(
c⁄fig
->
libcuæ
 && !
skù
 && !
ªt
) {

544 if(
ªm¨k
)

545 
	`REM2
("%†£àtÿ®%s", 
«me
, 
vÆue
);

547 if(
esˇ≥
) {

548 
esˇ≥d
 = 
	`c_esˇ≥
(
vÆue
);

549 if(!
esˇ≥d
) {

550 
ªt
 = 
CURLE_OUT_OF_MEMORY
;

551 
nomem
;

553 
	`CODE2
("cuæ_ósy_£t›t(hnd, %s, \"%s\");", 
«me
, 
esˇ≥d
);

556 
	`CODE2
("cuæ_ósy_£t›t(hnd, %s, %s);", 
«me
, 
vÆue
);

560 
nomem
:

561 
	`Cuæ_ß„‰ì
(
esˇ≥d
);

562  
ªt
;

563 
	}
}

	@src/tool_setopt.h

1 #i‚de‡
HEADER_CURL_TOOL_SETOPT_H


2 
	#HEADER_CURL_TOOL_SETOPT_H


	)

24 
	~"toﬁ_£tup.h
"

30 
	#SETOPT_CHECK
(
v
) do { \

31 
ªs
 = (
v
); \

32 if(
ªs
) \

33 
show_îr‹
; \

34 } 
WHILE_FALSE


	)

36 #i‚de‡
CURL_DISABLE_LIBCURL_OPTION


40 c⁄° *
	m«me
;

41 
	mvÆue
;

42 } 
	tNameVÆue
;

45 c⁄° *
	m«me
;

46 
	mvÆue
;

47 } 
	tNameVÆueUnsig√d
;

49 c⁄° 
NameVÆue
 
£t›t_nv_CURLPROXY
[];

50 c⁄° 
NameVÆue
 
£t›t_nv_CURL_HTTP_VERSION
[];

51 c⁄° 
NameVÆue
 
£t›t_nv_CURL_SSLVERSION
[];

52 c⁄° 
NameVÆue
 
£t›t_nv_CURL_TIMECOND
[];

53 c⁄° 
NameVÆue
 
£t›t_nv_CURLFTPSSL_CCC
[];

54 c⁄° 
NameVÆue
 
£t›t_nv_CURLUSESSL
[];

55 c⁄° 
NameVÆue
 
£t›t_nv_CURL_NETRC
[];

56 c⁄° 
NameVÆue
 
£t›t_nv_CURLPROTO
[];

57 c⁄° 
NameVÆueUnsig√d
 
£t›t_nv_CURLAUTH
[];

60 
	#£t›t_nv_CURLOPT_HTTP_VERSION
 
£t›t_nv_CURL_HTTP_VERSION


	)

61 
	#£t›t_nv_CURLOPT_HTTPAUTH
 
£t›t_nv_CURLAUTH


	)

62 
	#£t›t_nv_CURLOPT_SSLVERSION
 
£t›t_nv_CURL_SSLVERSION


	)

63 
	#£t›t_nv_CURLOPT_TIMECONDITION
 
£t›t_nv_CURL_TIMECOND


	)

64 
	#£t›t_nv_CURLOPT_FTP_SSL_CCC
 
£t›t_nv_CURLFTPSSL_CCC


	)

65 
	#£t›t_nv_CURLOPT_USE_SSL
 
£t›t_nv_CURLUSESSL


	)

66 
	#£t›t_nv_CURLOPT_NETRC
 
£t›t_nv_CURL_NETRC


	)

67 
	#£t›t_nv_CURLOPT_PROTOCOLS
 
£t›t_nv_CURLPROTO


	)

68 
	#£t›t_nv_CURLOPT_REDIR_PROTOCOLS
 
£t›t_nv_CURLPROTO


	)

69 
	#£t›t_nv_CURLOPT_PROXYTYPE
 
£t›t_nv_CURLPROXY


	)

70 
	#£t›t_nv_CURLOPT_PROXYAUTH
 
£t›t_nv_CURLAUTH


	)

74 
CURLcode
 
toﬁ_£t›t_íum
(
CURL
 *
cuæ
, 
GlobÆC⁄fig
 *
c⁄fig
,

75 c⁄° *
«me
, 
CURL›ti⁄
 
èg
,

76 c⁄° 
NameVÆue
 *
nv
, 
lvÆ
);

77 
CURLcode
 
toﬁ_£t›t_Êags
(
CURL
 *
cuæ
, 
GlobÆC⁄fig
 *
c⁄fig
,

78 c⁄° *
«me
, 
CURL›ti⁄
 
èg
,

79 c⁄° 
NameVÆue
 *
nv
, 
lvÆ
);

80 
CURLcode
 
toﬁ_£t›t_bômask
(
CURL
 *
cuæ
, 
GlobÆC⁄fig
 *
c⁄fig
,

81 c⁄° *
«me
, 
CURL›ti⁄
 
èg
,

82 c⁄° 
NameVÆueUnsig√d
 *
nv
, 
lvÆ
);

83 
CURLcode
 
toﬁ_£t›t_hâµo°
(
CURL
 *
cuæ
, 
GlobÆC⁄fig
 *
c⁄fig
,

84 c⁄° *
«me
, 
CURL›ti⁄
 
èg
,

85 
cuæ_hâµo°
 *
hâµo°
);

86 
CURLcode
 
toﬁ_£t›t_¶i°
(
CURL
 *
cuæ
, 
GlobÆC⁄fig
 *
c⁄fig
,

87 c⁄° *
«me
, 
CURL›ti⁄
 
èg
,

88 
cuæ_¶i°
 *
li°
);

89 
CURLcode
 
toﬁ_£t›t
(
CURL
 *
cuæ
, 
boﬁ
 
°r
, 
GlobÆC⁄fig
 *
c⁄fig
,

90 c⁄° *
«me
, 
CURL›ti⁄
 
èg
, ...);

92 
	#my_£t›t
(
x
,
y
,
z
) \

93 
	`SETOPT_CHECK
(
	`toﬁ_£t›t
(
x
, 
FALSE
, 
globÆ
, #y, 
y
, 
z
))

	)

95 
	#my_£t›t_°r
(
x
,
y
,
z
) \

96 
	`SETOPT_CHECK
(
	`toﬁ_£t›t
(
x
, 
TRUE
, 
globÆ
, #y, 
y
, 
z
))

	)

98 
	#my_£t›t_íum
(
x
,
y
,
z
) \

99 
	`SETOPT_CHECK
(
	`toﬁ_£t›t_íum
(
x
, 
globÆ
, #y, 
y
, 
£t›t_nv_
 ## y, 
z
))

	)

101 
	#my_£t›t_Êags
(
x
,
y
,
z
) \

102 
	`SETOPT_CHECK
(
	`toﬁ_£t›t_Êags
(
x
, 
globÆ
, #y, 
y
, 
£t›t_nv_
 ## y, 
z
))

	)

104 
	#my_£t›t_bômask
(
x
,
y
,
z
) \

105 
	`SETOPT_CHECK
(
	`toﬁ_£t›t_bômask
(
x
, 
globÆ
, #y, 
y
, 
£t›t_nv_
 ## y, 
z
))

	)

107 
	#my_£t›t_hâµo°
(
x
,
y
,
z
) \

108 
	`SETOPT_CHECK
(
	`toﬁ_£t›t_hâµo°
(
x
, 
globÆ
, #y, 
y
, 
z
))

	)

110 
	#my_£t›t_¶i°
(
x
,
y
,
z
) \

111 
	`SETOPT_CHECK
(
	`toﬁ_£t›t_¶i°
(
x
, 
globÆ
, #y, 
y
, 
z
))

	)

113 
	#ªs_£t›t
(
x
,
y
,
z
Ë
	`toﬁ_£t›t
(x, 
FALSE
, 
globÆ
, #y, y, z)

	)

115 
	#ªs_£t›t_°r
(
x
,
y
,
z
Ë
	`toﬁ_£t›t
(x, 
TRUE
, 
globÆ
, #y, y, z)

	)

121 
	#my_£t›t
(
x
,
y
,
z
) \

122 
	`SETOPT_CHECK
(
	`cuæ_ósy_£t›t
(
x
, 
y
, 
z
))

	)

124 
	#my_£t›t_°r
(
x
,
y
,
z
) \

125 
	`SETOPT_CHECK
(
	`cuæ_ósy_£t›t
(
x
, 
y
, 
z
))

	)

127 
	#my_£t›t_íum
(
x
,
y
,
z
) \

128 
	`SETOPT_CHECK
(
	`cuæ_ósy_£t›t
(
x
, 
y
, 
z
))

	)

130 
	#my_£t›t_Êags
(
x
,
y
,
z
) \

131 
	`SETOPT_CHECK
(
	`cuæ_ósy_£t›t
(
x
, 
y
, 
z
))

	)

133 
	#my_£t›t_bômask
(
x
,
y
,
z
) \

134 
	`SETOPT_CHECK
(
	`cuæ_ósy_£t›t
(
x
, 
y
, 
z
))

	)

136 
	#my_£t›t_hâµo°
(
x
,
y
,
z
) \

137 
	`SETOPT_CHECK
(
	`cuæ_ósy_£t›t
(
x
, 
y
, 
z
))

	)

139 
	#my_£t›t_¶i°
(
x
,
y
,
z
) \

140 
	`SETOPT_CHECK
(
	`cuæ_ósy_£t›t
(
x
, 
y
, 
z
))

	)

142 
	#ªs_£t›t
(
x
,
y
,
z
Ë
	`cuæ_ósy_£t›t
(x,y,z)

	)

144 
	#ªs_£t›t_°r
(
x
,
y
,
z
Ë
	`cuæ_ósy_£t›t
(x,y,z)

	)

	@src/tool_setup.h

1 #i‚de‡
HEADER_CURL_TOOL_SETUP_H


2 
	#HEADER_CURL_TOOL_SETUP_H


	)

25 
	#CURL_NO_OLDIES


	)

36 
	~"cuæ_£tup.h
"

42 
	~<cuæ/cuæ.h
>

48 #i‡
deföed
(
macötosh
Ë&& deföed(
__MRC__
)

49 
	#maö
(
x
,
y
Ë
	`cuæ_maö
(x,y)

	)

52 #ifde‡
TPF


53 #unde‡
£À˘


55 
	#£À˘
(
a
,
b
,
c
,
d
,
e
Ë
	`çf_£À˘_bsd
◊,b,c,d,e)

	)

57 
	#CONF_DEFAULT
 (0|
CONF_NOPROGRESS
)

	)

60 #i‚de‡
OS


61 
	#OS
 "unknown"

	)

64 #i‚de‡
UNPRINTABLE_CHAR


66 
	#UNPRINTABLE_CHAR
 '.'

	)

69 #i‚de‡
HAVE_STRDUP


70 
	~"°rdup.h
"

71 
	#°rdup
(
±r
Ë
	`cuæx_°rdup
’å)

	)

	@src/tool_sleep.c

22 
	~"toﬁ_£tup.h
"

24 #ifde‡
HAVE_SYS_SELECT_H


25 
	~<sys/£À˘.h
>

28 #ifde‡
HAVE_SYS_POLL_H


29 
	~<sys/pﬁl.h
>

30 #ñi‡
deföed
(
HAVE_POLL_H
)

31 
	~<pﬁl.h
>

34 #ifde‡
MSDOS


35 
	~<dos.h
>

38 
	~"toﬁ_¶ìp.h
"

40 
	~"memdebug.h
"

42 
	$toﬁ_go_¶ìp
(
ms
)

44 #i‡
	`deföed
(
MSDOS
)

45 
	`dñay
(
ms
);

46 #ñi‡
	`deföed
(
WIN32
)

47 
	`SÀï
(
ms
);

48 #ñi‡
	`deföed
(
HAVE_POLL_FINE
)

49 
	`pﬁl
((*)0, 0, ()
ms
);

51 
timevÆ
 
timeout
;

52 
timeout
.
tv_£c
 = 
ms
 / 1000L;

53 
ms
 = ms % 1000L;

54 
timeout
.
tv_u£c
 = 
ms
 * 1000L;

55 
	`£À˘
(0, 
NULL
, NULL, NULL, &
timeout
);

57 
	}
}

	@src/tool_sleep.h

1 #i‚de‡
HEADER_CURL_TOOL_SLEEP_H


2 
	#HEADER_CURL_TOOL_SLEEP_H


	)

24 
	~"toﬁ_£tup.h
"

26 
toﬁ_go_¶ìp
(
ms
);

	@src/tool_urlglob.c

22 
	~"toﬁ_£tup.h
"

24 
	#_MPRINTF_REPLACE


	)

25 
	~<cuæ/m¥ötf.h
>

27 
	~"toﬁ_uæglob.h
"

28 
	~"toﬁ_vms.h
"

30 
	~"memdebug.h
"

33 
	mGLOB_OK
,

34 
	mGLOB_NO_MEM
 = 
CURLE_OUT_OF_MEMORY
,

35 
	mGLOB_ERROR
 = 
CURLE_URL_MALFORMAT


36 } 
	tGlobCode
;

38 
	#GLOBERROR
(
°rög
, 
cﬁumn
, 
code
) \

39 
glob
->
îr‹
 = 
°rög
, glob->
pos
 = 
cﬁumn
, 
code


	)

41 
glob_˛ónup
(
URLGlob
* 
glob
);

43 
GlobCode
 
	$glob_fixed
(
URLGlob
 *
glob
, *
fixed
, 
size_t
 
Àn
)

45 
URLP©ã∫
 *
∑t
 = &
glob
->
∑âîn
[glob->
size
];

46 
∑t
->
ty≥
 = 
UPTSë
;

47 
∑t
->
c⁄ã¡
.
Së
.
size
 = 1;

48 
∑t
->
c⁄ã¡
.
Së
.
±r_s
 = 0;

49 
∑t
->
globödex
 = -1;

51 
∑t
->
c⁄ã¡
.
Së
.
ñemíts
 = 
	`mÆloc
((*));

53 if(!
∑t
->
c⁄ã¡
.
Së
.
ñemíts
)

54  
	`GLOBERROR
("ouào‡mem‹y", 0, 
GLOB_NO_MEM
);

56 
∑t
->
c⁄ã¡
.
Së
.
ñemíts
[0] = 
	`mÆloc
(
Àn
+1);

57 if(!
∑t
->
c⁄ã¡
.
Së
.
ñemíts
[0])

58  
	`GLOBERROR
("ouào‡mem‹y", 0, 
GLOB_NO_MEM
);

60 
	`mem˝y
(
∑t
->
c⁄ã¡
.
Së
.
ñemíts
[0], 
fixed
, 
Àn
);

61 
∑t
->
c⁄ã¡
.
Së
.
ñemíts
[0][
Àn
] = 0;

63  
GLOB_OK
;

64 
	}
}

70 
	$mu…ùly
(*
amou¡
, 
wôh
)

72 
sum
 = *
amou¡
 * 
wôh
;

73 if(
sum
/
wôh
 !*
amou¡
)

75 *
amou¡
 = 
sum
;

77 
	}
}

79 
GlobCode
 
	$glob_£t
(
URLGlob
 *
glob
, **
∑âî≈
,

80 
size_t
 *
po•
, *
amou¡
,

81 
globödex
)

86 
URLP©ã∫
 *
∑t
;

87 
boﬁ
 
d⁄e
 = 
FALSE
;

88 *
buf
 = 
glob
->
glob_buf„r
;

89 *
∑âîn
 = *
∑âî≈
;

90 *
›©ã∫
 = 
∑âîn
;

91 
size_t
 
›os
 = *
po•
-1;

93 
∑t
 = &
glob
->
∑âîn
[glob->
size
];

95 
∑t
->
ty≥
 = 
UPTSë
;

96 
∑t
->
c⁄ã¡
.
Së
.
size
 = 0;

97 
∑t
->
c⁄ã¡
.
Së
.
±r_s
 = 0;

98 
∑t
->
c⁄ã¡
.
Së
.
ñemíts
 = 
NULL
;

99 
∑t
->
globödex
 = globindex;

101 !
d⁄e
) {

102 *
∑âîn
) {

104  
	`GLOBERROR
("unm©ched bø˚", 
›os
, 
GLOB_ERROR
);

108  
	`GLOBERROR
("√°ed bø˚", *
po•
, 
GLOB_ERROR
);

111 if(
›©ã∫
 =
∑âîn
)

112  
	`GLOBERROR
("em±y såög wôhö bø˚s", *
po•
, 
GLOB_ERROR
);

115 if(
	`mu…ùly
(
amou¡
, 
∑t
->
c⁄ã¡
.
Së
.
size
+1))

116  
	`GLOBERROR
("øngêovîÊow", 0, 
GLOB_ERROR
);

121 *
buf
 = '\0';

122 if(
∑t
->
c⁄ã¡
.
Së
.
ñemíts
) {

123 **
√w_¨r
 = 
	`ªÆloc
(
∑t
->
c⁄ã¡
.
Së
.
ñemíts
,

124 (
∑t
->
c⁄ã¡
.
Së
.
size
 + 1) * (*));

125 if(!
√w_¨r
)

126  
	`GLOBERROR
("ouào‡mem‹y", 0, 
GLOB_NO_MEM
);

128 
∑t
->
c⁄ã¡
.
Së
.
ñemíts
 = 
√w_¨r
;

131 
∑t
->
c⁄ã¡
.
Së
.
ñemíts
 = 
	`mÆloc
((*));

133 if(!
∑t
->
c⁄ã¡
.
Së
.
ñemíts
)

134  
	`GLOBERROR
("ouào‡mem‹y", 0, 
GLOB_NO_MEM
);

136 
∑t
->
c⁄ã¡
.
Së
.
ñemíts
[∑t->c⁄ã¡.Së.
size
] =

137 
	`°rdup
(
glob
->
glob_buf„r
);

138 if(!
∑t
->
c⁄ã¡
.
Së
.
ñemíts
[∑t->c⁄ã¡.Së.
size
])

139  
	`GLOBERROR
("ouào‡mem‹y", 0, 
GLOB_NO_MEM
);

140 ++
∑t
->
c⁄ã¡
.
Së
.
size
;

142 if(*
∑âîn
 == '}') {

143 
∑âîn
++;

144 
d⁄e
 = 
TRUE
;

148 
buf
 = 
glob
->
glob_buf„r
;

149 ++
∑âîn
;

150 ++(*
po•
);

154  
	`GLOBERROR
("u√x≥˘ed clo£ bøckë", *
po•
, 
GLOB_ERROR
);

157 if(
∑âîn
[1]) {

158 ++
∑âîn
;

159 ++(*
po•
);

163 *
buf
++ = *
∑âîn
++;

164 ++(*
po•
);

168 *
∑âî≈
 = 
∑âîn
;

169  
GLOB_OK
;

170 
	}
}

172 
GlobCode
 
	$glob_ønge
(
URLGlob
 *
glob
, **
∑âî≈
,

173 
size_t
 *
po•
, *
amou¡
,

174 
globödex
)

182 
URLP©ã∫
 *
∑t
;

183 
rc
;

184 *
∑âîn
 = *
∑âî≈
;

185 *
c
;

187 
∑t
 = &
glob
->
∑âîn
[glob->
size
];

188 
∑t
->
globödex
 = globindex;

190 if(
	`ISALPHA
(*
∑âîn
)) {

192 
mö_c
;

193 
max_c
;

194 
°ï
=1;

196 
∑t
->
ty≥
 = 
UPTCh¨R™ge
;

198 
rc
 = 
	`ssˇnf
(
∑âîn
, "%c-%c", &
mö_c
, &
max_c
);

200 if((
rc
 =2Ë&& (
∑âîn
[3] == ':')) {

201 *
ídp
;

202 
l°ï
;

203 
î∫o
 = 0;

204 
l°ï
 = 
	`°πoul
(&
∑âîn
[3], &
ídp
, 10);

205 if(
î∫o
 || (*
ídp
 != ']'))

206 
°ï
 = -1;

208 
∑âîn
 = 
ídp
+1;

209 
°ï
 = ()
l°ï
;

210 if(
°ï
 > (
max_c
 - 
mö_c
))

211 
°ï
 = -1;

215 
∑âîn
 += 4;

217 *
po•
 +(
∑âîn
 - *
∑âî≈
);

219 if((
rc
 !2Ë|| (
mö_c
 >
max_c
) || ((max_c - min_c) > ('z' - 'a')) ||

220 (
°ï
 < 0) )

222  
	`GLOBERROR
("badÑ™ge", *
po•
, 
GLOB_ERROR
);

225 
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
°ï
 = step;

226 
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
±r_c
 =Ö©->c⁄ã¡.Ch¨R™ge.
mö_c
 = min_c;

227 
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
max_c
 = max_c;

229 if(
	`mu…ùly
(
amou¡
, (
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
max_c
 -

230 
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
mö_c
 + 1)))

231  
	`GLOBERROR
("øngêovîÊow", *
po•
, 
GLOB_ERROR
);

233 if(
	`ISDIGIT
(*
∑âîn
)) {

235 
mö_n
;

236 
max_n
 = 0;

237 
°ï_n
 = 0;

238 *
ídp
;

240 
∑t
->
ty≥
 = 
UPTNumR™ge
;

241 
∑t
->
c⁄ã¡
.
NumR™ge
.
∑dÀngth
 = 0;

243 if(*
∑âîn
 == '0') {

245 
c
 = 
∑âîn
;

246 
	`ISDIGIT
(*
c
)) {

247 
c
++;

248 ++
∑t
->
c⁄ã¡
.
NumR™ge
.
∑dÀngth
;

253 
î∫o
 = 0;

254 
mö_n
 = 
	`°πoul
(
∑âîn
, &
ídp
, 10);

255 if(
î∫o
 || (
ídp
 =
∑âîn
))

256 
ídp
=
NULL
;

258 if(*
ídp
 != '-')

259 
ídp
 = 
NULL
;

261 
∑âîn
 = 
ídp
+1;

262 
î∫o
 = 0;

263 
max_n
 = 
	`°πoul
(
∑âîn
, &
ídp
, 10);

264 if(
î∫o
 || (*
ídp
 == ':')) {

265 
∑âîn
 = 
ídp
+1;

266 
î∫o
 = 0;

267 
°ï_n
 = 
	`°πoul
(
∑âîn
, &
ídp
, 10);

268 if(
î∫o
)

270 
ídp
 = 
NULL
;

273 
°ï_n
 = 1;

274 if(
ídp
 && (*endp == ']')) {

275 
∑âîn

ídp
+1;

278 
ídp
 = 
NULL
;

282 *
po•
 +(
∑âîn
 - *
∑âî≈
);

284 if(!
ídp
 || (
mö_n
 > 
max_n
Ë|| (
°ï_n
 > (max_n - min_n)))

286  
	`GLOBERROR
("badÑ™ge", *
po•
, 
GLOB_ERROR
);

290 
∑t
->
c⁄ã¡
.
NumR™ge
.
±r_n
 =Ö©->c⁄ã¡.NumR™ge.
mö_n
 = min_n;

291 
∑t
->
c⁄ã¡
.
NumR™ge
.
max_n
 = max_n;

292 
∑t
->
c⁄ã¡
.
NumR™ge
.
°ï
 = 
°ï_n
;

294 if(
	`mu…ùly
(
amou¡
, (
∑t
->
c⁄ã¡
.
NumR™ge
.
max_n
 -

295 
∑t
->
c⁄ã¡
.
NumR™ge
.
mö_n
 + 1)))

296  
	`GLOBERROR
("øngêovîÊow", *
po•
, 
GLOB_ERROR
);

299  
	`GLOBERROR
("badÑ™gê•ecifiˇti⁄", *
po•
, 
GLOB_ERROR
);

301 *
∑âî≈
 = 
∑âîn
;

302  
GLOB_OK
;

303 
	}
}

305 
boﬁ
 
	$≥ek_ùv6
(c⁄° *
°r
, 
size_t
 *
skù
)

312 
size_t
 
i
 = 0;

313 
size_t
 
cﬁ⁄s
 = 0;

314 if(
°r
[
i
++] != '[') {

315  
FALSE
;

318 c⁄° 
c
 = 
°r
[
i
++];

319 if(
	`ISALNUM
(
c
) || c == '.' || c == '%') {

322 if(
c
 == ':') {

323 
cﬁ⁄s
++;

325 if(
c
 == ']') {

326 *
skù
 = 
i
;

327  
cﬁ⁄s
 >2 ? 
TRUE
 : 
FALSE
;

330  
FALSE
;

333 
	}
}

335 
GlobCode
 
	$glob_∑r£
(
URLGlob
 *
glob
, *
∑âîn
,

336 
size_t
 
pos
, *
amou¡
)

341 
GlobCode
 
ªs
 = 
GLOB_OK
;

342 
globödex
 = 0;

344 *
amou¡
 = 1;

346 *
∑âîn
 && !
ªs
) {

347 *
buf
 = 
glob
->
glob_buf„r
;

348 
size_t
 
subÀn
 = 0;

349 *
∑âîn
 && *pattern != '{') {

350 if(*
∑âîn
 == '[') {

352 
size_t
 
skù
;

353 if(
	`≥ek_ùv6
(
∑âîn
, &
skù
)) {

354 
	`mem˝y
(
buf
, 
∑âîn
, 
skù
);

355 
buf
 +
skù
;

356 
∑âîn
 +
skù
;

357 
subÀn
 +
skù
;

362 if(*
∑âîn
 == '}' || *pattern == ']')

363  
	`GLOBERROR
("unm©ched clo£ bø˚/bøckë", 
pos
, 
GLOB_ERROR
);

366 if(*
∑âîn
 == '\\' &&

367 (*(
∑âîn
+1) == '{' || *(pattern+1) == '[' ||

368 *(
∑âîn
+1) == '}' || *(pattern+1) == ']') ) {

371 ++
∑âîn
;

372 ++
pos
;

374 *
buf
++ = *
∑âîn
++;

375 ++
pos
;

376 
subÀn
++;

378 if(
subÀn
) {

380 *
buf
 = '\0';

381 
ªs
 = 
	`glob_fixed
(
glob
, glob->
glob_buf„r
, 
subÀn
);

384 *
∑âîn
) {

390 
∑âîn
++;

391 
pos
++;

392 
ªs
 = 
	`glob_£t
(
glob
, &
∑âîn
, &
pos
, 
amou¡
, 
globödex
++);

397 
∑âîn
++;

398 
pos
++;

399 
ªs
 = 
	`glob_ønge
(
glob
, &
∑âîn
, &
pos
, 
amou¡
, 
globödex
++);

404 if(++
glob
->
size
 > 
GLOB_PATTERN_NUM
)

405  
	`GLOBERROR
("toÿm™y globs", 
pos
, 
GLOB_ERROR
);

407  
ªs
;

408 
	}
}

410 
	$glob_uæ
(
URLGlob
** 
glob
, * 
uæ
, *
uænum
, 
FILE
 *
îr‹
)

416 
URLGlob
 *
glob_ex∑nd
;

417 
amou¡
 = 0;

418 *
glob_buf„r
;

419 
GlobCode
 
ªs
;

421 *
glob
 = 
NULL
;

423 
glob_buf„r
 = 
	`mÆloc
(
	`°æí
(
uæ
) + 1);

424 if(!
glob_buf„r
)

425  
CURLE_OUT_OF_MEMORY
;

427 
glob_ex∑nd
 = 
	`ˇŒoc
(1, (
URLGlob
));

428 if(!
glob_ex∑nd
) {

429 
	`Cuæ_ß„‰ì
(
glob_buf„r
);

430  
CURLE_OUT_OF_MEMORY
;

432 
glob_ex∑nd
->
uæÀn
 = 
	`°æí
(
uæ
);

433 
glob_ex∑nd
->
glob_buf„r
 = glob_buffer;

435 
ªs
 = 
	`glob_∑r£
(
glob_ex∑nd
, 
uæ
, 1, &
amou¡
);

436 if(!
ªs
)

437 *
uænum
 = 
amou¡
;

439 if(
îr‹
 && 
glob_ex∑nd
->error) {

440 
ãxt
[128];

441 c⁄° *
t
;

442 if(
glob_ex∑nd
->
pos
) {

443 
	`¢¥ötf
(
ãxt
, —ext), "%†ö cﬁum¿%zu", 
glob_ex∑nd
->
îr‹
,

444 
glob_ex∑nd
->
pos
);

445 
t
 = 
ãxt
;

448 
t
 = 
glob_ex∑nd
->
îr‹
;

451 
	`Ârötf
(
îr‹
, "cuæ: (%dË[globbög] %s\n", 
ªs
, 
t
);

454 
	`glob_˛ónup
(
glob_ex∑nd
);

455 *
uænum
 = 1;

456  
ªs
;

459 *
glob
 = 
glob_ex∑nd
;

460  
CURLE_OK
;

461 
	}
}

463 
	$glob_˛ónup
(
URLGlob
* 
glob
)

465 
size_t
 
i
;

466 
ñem
;

469 
i
 = 
glob
->
size
 - 1; i < glob->size; --i) {

470 if((
glob
->
∑âîn
[
i
].
ty≥
 =
UPTSë
) &&

471 (
glob
->
∑âîn
[
i
].
c⁄ã¡
.
Së
.
ñemíts
)) {

472 
ñem
 = 
glob
->
∑âîn
[
i
].
c⁄ã¡
.
Së
.
size
 - 1;

473 
ñem
 >= 0;

474 --
ñem
) {

475 
	`Cuæ_ß„‰ì
(
glob
->
∑âîn
[
i
].
c⁄ã¡
.
Së
.
ñemíts
[
ñem
]);

477 
	`Cuæ_ß„‰ì
(
glob
->
∑âîn
[
i
].
c⁄ã¡
.
Së
.
ñemíts
);

480 
	`Cuæ_ß„‰ì
(
glob
->
glob_buf„r
);

481 
	`Cuæ_ß„‰ì
(
glob
);

482 
	}
}

484 
	$glob_√xt_uæ
(**
globbed
, 
URLGlob
 *
glob
)

486 
URLP©ã∫
 *
∑t
;

487 
size_t
 
i
;

488 
size_t
 
j
;

489 
size_t
 
Àn
;

490 
size_t
 
buÊí
 = 
glob
->
uæÀn
 + 1;

491 *
buf
 = 
glob
->
glob_buf„r
;

493 *
globbed
 = 
NULL
;

495 if(!
glob
->
bìnhîe
)

496 
glob
->
bìnhîe
 = 1;

498 
boﬁ
 
ˇºy
 = 
TRUE
;

503 
i
 = 
glob
->
size
 - 1; 
ˇºy
 && (i < glob->size); --i) {

504 
ˇºy
 = 
FALSE
;

505 
∑t
 = &
glob
->
∑âîn
[
i
];

506 
∑t
->
ty≥
) {

507 
UPTSë
:

508 if((
∑t
->
c⁄ã¡
.
Së
.
ñemíts
) &&

509 (++
∑t
->
c⁄ã¡
.
Së
.
±r_s
 =∑t->c⁄ã¡.Së.
size
)) {

510 
∑t
->
c⁄ã¡
.
Së
.
±r_s
 = 0;

511 
ˇºy
 = 
TRUE
;

514 
UPTCh¨R™ge
:

515 
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
±r_c
 = ()’©->c⁄ã¡.Ch¨R™ge.
°ï
 +

516 ()(()
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
±r_c
));

517 if(
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
±r_c
 >Ö©->c⁄ã¡.Ch¨R™ge.
max_c
) {

518 
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
±r_c
 =Ö©->c⁄ã¡.Ch¨R™ge.
mö_c
;

519 
ˇºy
 = 
TRUE
;

522 
UPTNumR™ge
:

523 
∑t
->
c⁄ã¡
.
NumR™ge
.
±r_n
 +∑t->c⁄ã¡.NumR™ge.
°ï
;

524 if(
∑t
->
c⁄ã¡
.
NumR™ge
.
±r_n
 >Ö©->c⁄ã¡.NumR™ge.
max_n
) {

525 
∑t
->
c⁄ã¡
.
NumR™ge
.
±r_n
 =Ö©->c⁄ã¡.NumR™ge.
mö_n
;

526 
ˇºy
 = 
TRUE
;

530 
	`¥ötf
("öã∫ÆÉº‹: invÆidÖ©ã∫Åy≥ (%d)\n", ()
∑t
->
ty≥
);

531  
CURLE_FAILED_INIT
;

534 if(
ˇºy
) {

536  
CURLE_OK
;

540 
j
 = 0; j < 
glob
->
size
; ++j) {

541 
∑t
 = &
glob
->
∑âîn
[
j
];

542 
∑t
->
ty≥
) {

543 
UPTSë
:

544 if(
∑t
->
c⁄ã¡
.
Së
.
ñemíts
) {

545 
Àn
 = 
	`°æí
(
∑t
->
c⁄ã¡
.
Së
.
ñemíts
[∑t->c⁄ã¡.Së.
±r_s
]);

546 
	`¢¥ötf
(
buf
, 
buÊí
, "%s",

547 
∑t
->
c⁄ã¡
.
Së
.
ñemíts
[∑t->c⁄ã¡.Së.
±r_s
]);

548 
buf
 +
Àn
;

549 
buÊí
 -
Àn
;

552 
UPTCh¨R™ge
:

553 *
buf
++ = 
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
±r_c
;

555 
UPTNumR™ge
:

556 
Àn
 = 
	`¢¥ötf
(
buf
, 
buÊí
, "%0*ld",

557 
∑t
->
c⁄ã¡
.
NumR™ge
.
∑dÀngth
,

558 
∑t
->
c⁄ã¡
.
NumR™ge
.
±r_n
);

559 
buf
 +
Àn
;

560 
buÊí
 -
Àn
;

563 
	`¥ötf
("öã∫ÆÉº‹: invÆidÖ©ã∫Åy≥ (%d)\n", ()
∑t
->
ty≥
);

564  
CURLE_FAILED_INIT
;

567 *
buf
 = '\0';

569 *
globbed
 = 
	`°rdup
(
glob
->
glob_buf„r
);

570 if(!*
globbed
)

571  
CURLE_OUT_OF_MEMORY
;

573  
CURLE_OK
;

574 
	}
}

576 
	$glob_m©ch_uæ
(**
ªsu…
, *
fûíame
, 
URLGlob
 *
glob
)

578 *
èrgë
;

579 
size_t
 
Ælocsize
;

580 
numbuf
[18];

581 *
≠≥ndthis
 = 
NULL
;

582 
size_t
 
≠≥ndÀn
 = 0;

583 
size_t
 
°rögÀn
 = 0;

585 *
ªsu…
 = 
NULL
;

591 
Ælocsize
 = 
	`°æí
(
fûíame
) + 1;

593 
èrgë
 = 
	`mÆloc
(
Ælocsize
);

594 if(!
èrgë
)

595  
CURLE_OUT_OF_MEMORY
;

597 *
fûíame
) {

598 if(*
fûíame
 ='#' && 
	`ISDIGIT
(filename[1])) {

599 
i
;

600 *
±r
 = 
fûíame
;

601 
num
 = 
	`°πoul
(&
fûíame
[1], &filename, 10);

602 
URLP©ã∫
 *
∑t
 =
NULL
;

604 if(
num
 < 
glob
->
size
) {

605 
num
--;

607 
i
=0; i<
glob
->
size
; i++) {

608 if(
glob
->
∑âîn
[
i
].
globödex
 =()
num
) {

609 
∑t
 = &
glob
->
∑âîn
[
i
];

615 if(
∑t
) {

616 
∑t
->
ty≥
) {

617 
UPTSë
:

618 if(
∑t
->
c⁄ã¡
.
Së
.
ñemíts
) {

619 
≠≥ndthis
 = 
∑t
->
c⁄ã¡
.
Së
.
ñemíts
[∑t->c⁄ã¡.Së.
±r_s
];

620 
≠≥ndÀn
 =

621 
	`°æí
(
∑t
->
c⁄ã¡
.
Së
.
ñemíts
[∑t->c⁄ã¡.Së.
±r_s
]);

624 
UPTCh¨R™ge
:

625 
numbuf
[0] = 
∑t
->
c⁄ã¡
.
Ch¨R™ge
.
±r_c
;

626 
numbuf
[1] = 0;

627 
≠≥ndthis
 = 
numbuf
;

628 
≠≥ndÀn
 = 1;

630 
UPTNumR™ge
:

631 
	`¢¥ötf
(
numbuf
, (numbuf), "%0*d",

632 
∑t
->
c⁄ã¡
.
NumR™ge
.
∑dÀngth
,

633 
∑t
->
c⁄ã¡
.
NumR™ge
.
±r_n
);

634 
≠≥ndthis
 = 
numbuf
;

635 
≠≥ndÀn
 = 
	`°æí
(
numbuf
);

638 
	`Ârötf
(
°dîr
, "internalÉrror: invalidÖatternÅype (%d)\n",

639 ()
∑t
->
ty≥
);

640 
	`Cuæ_ß„‰ì
(
èrgë
);

641  
CURLE_FAILED_INIT
;

646 
fûíame
 = 
±r
;

647 
≠≥ndthis
 = 
fûíame
++;

648 
≠≥ndÀn
 = 1;

652 
≠≥ndthis
 = 
fûíame
++;

653 
≠≥ndÀn
 = 1;

655 if(
≠≥ndÀn
 + 
°rögÀn
 >
Ælocsize
) {

656 *
√w°r
;

659 
Ælocsize
 = (
≠≥ndÀn
 + 
°rögÀn
) * 2;

660 
√w°r
 = 
	`ªÆloc
(
èrgë
, 
Ælocsize
 + 1);

661 if(!
√w°r
) {

662 
	`Cuæ_ß„‰ì
(
èrgë
);

663  
CURLE_OUT_OF_MEMORY
;

665 
èrgë
 = 
√w°r
;

667 
	`mem˝y
(&
èrgë
[
°rögÀn
], 
≠≥ndthis
, 
≠≥ndÀn
);

668 
°rögÀn
 +
≠≥ndÀn
;

670 
èrgë
[
°rögÀn
]= '\0';

671 *
ªsu…
 = 
èrgë
;

672  
CURLE_OK
;

673 
	}
}

	@src/tool_urlglob.h

1 #i‚de‡
HEADER_CURL_TOOL_URLGLOB_H


2 
	#HEADER_CURL_TOOL_URLGLOB_H


	)

24 
	~"toﬁ_£tup.h
"

27 
	mUPTSë
 = 1,

28 
	mUPTCh¨R™ge
,

29 
	mUPTNumR™ge


30 } 
	tURLP©ã∫Ty≥
;

33 
URLP©ã∫Ty≥
 
	mty≥
;

34 
	mglobödex
;

38 **
	mñemíts
;

39 
	msize
;

40 
	m±r_s
;

41 } 
	mSë
;

43 
	mmö_c
;

44 
	mmax_c
;

45 
	m±r_c
;

46 
	m°ï
;

47 } 
	mCh¨R™ge
;

49 
	mmö_n
;

50 
	mmax_n
;

51 
	m∑dÀngth
;

52 
	m±r_n
;

53 
	m°ï
;

54 } 
	mNumR™ge
 ;

55 } 
	mc⁄ã¡
;

56 } 
	tURLP©ã∫
;

59 
	#GLOB_PATTERN_NUM
 100

	)

62 
URLP©ã∫
 
	m∑âîn
[
GLOB_PATTERN_NUM
];

63 
size_t
 
	msize
;

64 
size_t
 
	muæÀn
;

65 *
	mglob_buf„r
;

66 
	mbìnhîe
;

67 c⁄° *
	mîr‹
;

68 
size_t
 
	mpos
;

69 } 
	tURLGlob
;

71 
glob_uæ
(
URLGlob
**, *, *, 
FILE
 *);

72 
glob_√xt_uæ
(**, 
URLGlob
 *);

73 
glob_m©ch_uæ
(**, *, 
URLGlob
 *);

74 
glob_˛ónup
(
URLGlob
* 
glob
);

	@src/tool_util.c

22 
	~"toﬁ_£tup.h
"

24 
	~"toﬁ_utû.h
"

26 
	~"memdebug.h
"

28 #i‡
deföed
(
WIN32
Ë&& !deföed(
MSDOS
)

30 
timevÆ
 
	$toﬁ_tvnow
()

37 
timevÆ
 
now
;

38 
DWORD
 
mûli£c⁄ds
 = 
	`GëTickCou¡
();

39 
now
.
tv_£c
 = 
mûli£c⁄ds
 / 1000;

40 
now
.
tv_u£c
 = (
mûli£c⁄ds
 % 1000) * 1000;

41  
now
;

42 
	}
}

44 #ñi‡
deföed
(
HAVE_CLOCK_GETTIME_MONOTONIC
)

46 
timevÆ
 
	$toﬁ_tvnow
()

55 
timevÆ
 
now
;

56 
time•ec
 
t¢ow
;

57 if(0 =
	`˛ock_gëtime
(
CLOCK_MONOTONIC
, &
t¢ow
)) {

58 
now
.
tv_£c
 = 
t¢ow
.tv_sec;

59 
now
.
tv_u£c
 = 
t¢ow
.
tv_n£c
 / 1000;

66 #ifde‡
HAVE_GETTIMEOFDAY


68 ()
	`gëtimeofday
(&
now
, 
NULL
);

71 
now
.
tv_£c
 = ()
	`time
(
NULL
);

72 
now
.
tv_u£c
 = 0;

75  
now
;

76 
	}
}

78 #ñi‡
deföed
(
HAVE_GETTIMEOFDAY
)

80 
timevÆ
 
	$toﬁ_tvnow
()

87 
timevÆ
 
now
;

88 ()
	`gëtimeofday
(&
now
, 
NULL
);

89  
now
;

90 
	}
}

94 
timevÆ
 
	$toﬁ_tvnow
()

99 
timevÆ
 
now
;

100 
now
.
tv_£c
 = ()
	`time
(
NULL
);

101 
now
.
tv_u£c
 = 0;

102  
now
;

103 
	}
}

113 
	$toﬁ_tvdiff
(
timevÆ
 
√wî
, timevÆ 
ﬁdî
)

115  (
√wî
.
tv_£c
-
ﬁdî
.tv_sec)*1000+

116 (
√wî
.
tv_u£c
-
ﬁdî
.tv_usec)/1000;

117 
	}
}

124 
	$toﬁ_tvdiff_£cs
(
timevÆ
 
√wî
, timevÆ 
ﬁdî
)

126 if(
√wî
.
tv_£c
 !
ﬁdî
.tv_sec)

127  ()(
√wî
.
tv_£c
-
ﬁdî
.tv_sec)+

128 ()(
√wî
.
tv_u£c
-
ﬁdî
.tv_usec)/1000000.0;

130  ()(
√wî
.
tv_u£c
-
ﬁdî
.tv_usec)/1000000.0;

131 
	}
}

134 
	$toﬁ_tvl⁄g
(
timevÆ
 
t1
)

136  
t1
.
tv_£c
;

137 
	}
}

	@src/tool_util.h

1 #i‚de‡
HEADER_CURL_TOOL_UTIL_H


2 
	#HEADER_CURL_TOOL_UTIL_H


	)

24 
	~"toﬁ_£tup.h
"

26 
timevÆ
 
toﬁ_tvnow
();

34 
toﬁ_tvdiff
(
timevÆ
 
t1
, timevÆ 
t2
);

41 
toﬁ_tvdiff_£cs
(
timevÆ
 
t1
, timevÆ 
t2
);

43 
toﬁ_tvl⁄g
(
timevÆ
 
t1
);

45 #unde‡
tvnow


46 #unde‡
tvdiff


47 #unde‡
tvdiff_£cs


48 #unde‡
tvl⁄g


50 
	#tvnow
(Ë
	`toﬁ_tvnow
()

	)

51 
	#tvdiff
(
a
,
b
Ë
	`toﬁ_tvdiff
(◊), (b))

	)

52 
	#tvdiff_£cs
(
a
,
b
Ë
	`toﬁ_tvdiff_£cs
(◊), (b))

	)

53 
	#tvl⁄g
(
a
Ë
	`toﬁ_tvl⁄g
(◊))

	)

	@src/tool_version.h

1 #i‚de‡
HEADER_CURL_TOOL_VERSION_H


2 
	#HEADER_CURL_TOOL_VERSION_H


	)

24 
	~<cuæ/cuævî.h
>

26 
	#CURL_NAME
 "cuæ"

	)

27 
	#CURL_COPYRIGHT
 
LIBCURL_COPYRIGHT


	)

28 
	#CURL_VERSION
 "7.37.1"

	)

29 
	#CURL_VERSION_MAJOR
 
LIBCURL_VERSION_MAJOR


	)

30 
	#CURL_VERSION_MINOR
 
LIBCURL_VERSION_MINOR


	)

31 
	#CURL_VERSION_PATCH
 
LIBCURL_VERSION_PATCH


	)

32 
	#CURL_ID
 
CURL_NAME
 " " 
CURL_VERSION
 " (" 
OS
 "Ë"

	)

	@src/tool_vms.c

22 
	~"toﬁ_£tup.h
"

24 #ifde‡
__VMS


26 #i‡
deföed
(
__DECC
Ë&& !deföed(
__VAX
) && \

27 
deföed
(
__CRTL_VER
Ë&& (
	g__CRTL_VER
 >= 70301000)

28 
	~<unixlib.h
>

31 
	#ENABLE_CURLX_PRINTF


	)

32 
	~"cuæx.h
"

34 
	~"cuæmsg_vms.h
"

35 
	~"toﬁ_vms.h
"

37 
	~"memdebug.h
"

39 
decc$__posix_exô
(
__°©us
);

40 
decc$exô
(
__°©us
);

42 
	gvms_shñl
 = -1;

48 
	$is_vms_shñl
()

50 *
shñl
;

53 if(
vms_shñl
 >= 0)

54  
vms_shñl
;

56 
shñl
 = 
	`gëív
("SHELL");

59 if(
shñl
 =
NULL
) {

60 
vms_shñl
 = 1;

65 if(
	`°rcmp
(
shñl
, "DCL") == 0) {

66 
vms_shñl
 = 1;

70 
vms_shñl
 = 0;

72 
	}
}

91 
	$vms_•ecül_exô
(
code
, 
vms_show
)

93 
vms_code
;

96 #i‡
__CRTL_VER
 >= 70000000

97 if(
	`is_vms_shñl
() == 0) {

98 
	`decc$__posix_exô
(
code
);

102 if(
code
 > 
CURL_LAST
) {

103 
vms_code
 = 
CURL_LAST
;

106 
vms_code
 = 
vms_c⁄d
[
code
] | 
vms_show
;

108 
	`decc$exô
(
vms_code
);

109 
	}
}

111 #i‡
deföed
(
__DECC
Ë&& !deföed(
__VAX
) && \

112 
deföed
(
__CRTL_VER
Ë&& (
	g__CRTL_VER
 >= 70301000)

126 *
«me
;

127 
	mvÆue
;

128 } 
	tdecc_„©_t
;

131 
decc_„©_t
 
	gdecc_„©_¨øy
[] = {

140 { (*)
NULL
, 0 }

144 
	gdecc_öô_d⁄e
 = -1;

147 
	$decc_öô
()

149 
„©_ödex
;

150 
„©_vÆue
;

151 
„©_vÆue_max
;

152 
„©_vÆue_mö
;

153 
i
;

154 
°s
;

157 
decc_öô_d⁄e
 = 1;

160 
i
 = 0; 
decc_„©_¨øy
[i].
«me
 !
NULL
; i++) {

163 
„©_ödex
 = 
	`decc$„©uª_gë_ödex
–
decc_„©_¨øy
[
i
].
«me
);

165 if(
„©_ödex
 >= 0) {

167 
„©_vÆue
 = 
	`decc$„©uª_gë_vÆue
–
„©_ödex
, 1);

168 
„©_vÆue_mö
 = 
	`decc$„©uª_gë_vÆue
–
„©_ödex
, 2);

169 
„©_vÆue_max
 = 
	`decc$„©uª_gë_vÆue
–
„©_ödex
, 3);

171 if((
decc_„©_¨øy
[
i
].
vÆue
 >
„©_vÆue_mö
) &&

172 (
decc_„©_¨øy
[
i
].
vÆue
 <
„©_vÆue_max
)) {

174 if(
„©_vÆue
 !
decc_„©_¨øy
[
i
].
vÆue
) {

175 
°s
 = 
	`decc$„©uª_£t_vÆue
–
„©_ödex
, 1,

176 
decc_„©_¨øy
[
i
].
vÆue
);

181 
	`¥ötf
(" INVALID DECC FEATURE VALUE, %d: %d <= %s <= %d.\n",

182 
„©_vÆue
,

183 
„©_vÆue_mö
, 
decc_„©_¨øy
[
i
].
«me
, 
„©_vÆue_max
);

188 
	`¥ötf
(" UNKNOWN DECC FEATURE: %s.\n", 
decc_„©_¨øy
[
i
].
«me
);

192 
	}
}

196 #¥agm®
no°™d¨d


200 #¥agm®
exã∫_modñ
 
ßve


201 #¥agm®
exã∫_modñ
 
°ri˘_ªfdef
 "LIB$INITIALIZ" 2, 
n›ic
, 
nowπ


202 c⁄° 
	g•¨e
[8] = {0};

203 #¥agm®
exã∫_modñ
 
°ri˘_ªfdef
 "LIB$INITIALIZE" 2, 
n›ic
, 
nowπ


204 (*c⁄° 
	gx_decc_öô
)(Ë
decc_öô
;

205 #¥agm®
exã∫_modñ
 
ª°‹e


208 #¥agm®
exã∫_modñ
 
ßve


209 
LIB$INITIALIZE
();

210 #¥agm®
exã∫_modñ
 
°ri˘_ªfdef


211 
	gdmy_lib$öôülize
 = (Ë
LIB$INITIALIZE
;

212 #¥agm®
exã∫_modñ
 
ª°‹e


214 #¥agm®
°™d¨d


	@src/tool_vms.h

1 #i‚de‡
HEADER_CURL_TOOL_VMS_H


2 
	#HEADER_CURL_TOOL_VMS_H


	)

24 
	~"toﬁ_£tup.h
"

26 #ifde‡
__VMS


33 
vms_show
;

35 
is_vms_shñl
();

36 
vms_•ecül_exô
(
code
, 
vms_show
);

38 #unde‡
exô


39 
	#exô
(
__code
Ë
	`vms_•ecül_exô
((__code), (0))

	)

41 
	#VMS_STS
(
c
,
f
,
e
,
s
Ë(((c&0xF)<<28)|((f&0xFFF)<<16)|(”&0x1FFF)<3)|(s&7))

	)

42 
	#VMSSTS_HIDE
 
	`VMS_STS
(1,0,0,0)

	)

	@src/tool_writeenv.c

22 
	~"toﬁ_£tup.h
"

24 #ifde‡
USE_ENVIRONMENT


26 #ifde‡
__riscos__


27 
	~<kî√l.h
>

30 
	#_MPRINTF_REPLACE


	)

31 
	~<cuæ/m¥ötf.h
>

33 
	~"toﬁ_wrôìnv.h
"

35 
	~"memdebug.h
"

39 c⁄° * 
	m«me
;

40 
CURLINFO
 
	mid
;

42 
	mwrôìnv_NONE
,

43 
	mwrôìnv_DOUBLE
,

44 
	mwrôìnv_LONG
,

45 
	mwrôìnv_STRING


46 } 
	mty≥
;

47 } 
	gv¨übÀs
[14] =

49 {"cuæ_uæ_ef„˘ive", 
CURLINFO_EFFECTIVE_URL
, 
wrôìnv_STRING
},

50 {"cuæ_hâp_code", 
CURLINFO_RESPONSE_CODE
, 
wrôìnv_LONG
},

51 {"cuæ_time_tŸÆ", 
CURLINFO_TOTAL_TIME
, 
wrôìnv_DOUBLE
},

52 {"cuæ_time_«mñookup", 
CURLINFO_NAMELOOKUP_TIME
, 
wrôìnv_DOUBLE
},

53 {"cuæ_time_c⁄√˘", 
CURLINFO_CONNECT_TIME
, 
wrôìnv_DOUBLE
},

54 {"cuæ_time_¥ëøns„r", 
CURLINFO_PRETRANSFER_TIME
, 
wrôìnv_DOUBLE
},

55 {"cuæ_time_°¨âøns„r", 
CURLINFO_STARTTRANSFER_TIME
, 
wrôìnv_DOUBLE
},

56 {"cuæ_size_hódî", 
CURLINFO_HEADER_SIZE
, 
wrôìnv_LONG
},

57 {"cuæ_size_ªque°", 
CURLINFO_REQUEST_SIZE
, 
wrôìnv_LONG
},

58 {"cuæ_size_dow∆ﬂd", 
CURLINFO_SIZE_DOWNLOAD
, 
wrôìnv_DOUBLE
},

59 {"cuæ_size_u∂ﬂd", 
CURLINFO_SIZE_UPLOAD
, 
wrôìnv_DOUBLE
},

60 {"cuæ_•ìd_dow∆ﬂd", 
CURLINFO_SPEED_DOWNLOAD
, 
wrôìnv_DOUBLE
},

61 {"cuæ_•ìd_u∂ﬂd", 
CURLINFO_SPEED_UPLOAD
, 
wrôìnv_DOUBLE
},

62 {
NULL
, 0, 
wrôìnv_NONE
}

65 
	$öã∫ÆSëEnv
(c⁄° * 
«me
, * 
vÆue
)

68 #ifde‡
__riscos__


69 
	`_kî√l_£ãnv
(
«me
, 
vÆue
);

70 #ñi‡
	`deföed
 (
CURLDEBUG
)

71 
	`cuæ_memlog
("ENV %†%s\n", 
«me
, 
vÆue
);

74 
	}
}

76 
	$ourWrôeEnv
(
CURL
 *
cuæ
)

78 
i
;

79 *
°rög
, 
numãxt
[10];

80 
l⁄göfo
;

81 
doubÀöfo
;

83 
i
=0; 
v¨übÀs
[i].
«me
; i++) {

84 
v¨übÀs
[
i
].
ty≥
) {

85 
wrôìnv_STRING
:

86 if(
	`cuæ_ósy_gëöfo
(
cuæ
, 
v¨übÀs
[
i
].
id
, &
°rög
Ë=
CURLE_OK
)

87 
	`öã∫ÆSëEnv
(
v¨übÀs
[
i
].
«me
, 
°rög
);

89 
	`öã∫ÆSëEnv
(
v¨übÀs
[
i
].
«me
, 
NULL
);

92 
wrôìnv_LONG
:

93 if(
	`cuæ_ósy_gëöfo
(
cuæ
, 
v¨übÀs
[
i
].
id
, &
l⁄göfo
Ë=
CURLE_OK
) {

94 
	`cuæ_m•rötf
(
numãxt
, "%5ld", 
l⁄göfo
);

95 
	`öã∫ÆSëEnv
(
v¨übÀs
[
i
].
«me
, 
numãxt
);

98 
	`öã∫ÆSëEnv
(
v¨übÀs
[
i
].
«me
, 
NULL
);

100 
wrôìnv_DOUBLE
:

101 if(
	`cuæ_ósy_gëöfo
(
cuæ
, 
v¨übÀs
[
i
].
id
, &
doubÀöfo
Ë=
CURLE_OK
) {

102 
	`cuæ_m•rötf
(
numãxt
, "%6.2f", 
doubÀöfo
);

103 
	`öã∫ÆSëEnv
(
v¨übÀs
[
i
].
«me
, 
numãxt
);

106 
	`öã∫ÆSëEnv
(
v¨übÀs
[
i
].
«me
, 
NULL
);

114 
	}
}

	@src/tool_writeenv.h

1 #i‚de‡
HEADER_CURL_TOOL_WRITEENV_H


2 
	#HEADER_CURL_TOOL_WRITEENV_H


	)

24 
	~"toﬁ_£tup.h
"

26 #ifde‡
USE_ENVIRONMENT


28 
ourWrôeEnv
(
CURL
 *
cuæ
);

31 
	#ourWrôeEnv
(
x
Ë
Cuæ_n›_°mt


	)

	@src/tool_writeout.c

22 
	~"toﬁ_£tup.h
"

24 
	#_MPRINTF_REPLACE


	)

25 
	~<cuæ/m¥ötf.h
>

27 
	~"toﬁ_cfgabÀ.h
"

28 
	~"toﬁ_wrôeout.h
"

30 
	~"memdebug.h
"

33 
	mVAR_NONE
,

34 
	mVAR_TOTAL_TIME
,

35 
	mVAR_NAMELOOKUP_TIME
,

36 
	mVAR_CONNECT_TIME
,

37 
	mVAR_APPCONNECT_TIME
,

38 
	mVAR_PRETRANSFER_TIME
,

39 
	mVAR_STARTTRANSFER_TIME
,

40 
	mVAR_SIZE_DOWNLOAD
,

41 
	mVAR_SIZE_UPLOAD
,

42 
	mVAR_SPEED_DOWNLOAD
,

43 
	mVAR_SPEED_UPLOAD
,

44 
	mVAR_HTTP_CODE
,

45 
	mVAR_HTTP_CODE_PROXY
,

46 
	mVAR_HEADER_SIZE
,

47 
	mVAR_REQUEST_SIZE
,

48 
	mVAR_EFFECTIVE_URL
,

49 
	mVAR_CONTENT_TYPE
,

50 
	mVAR_NUM_CONNECTS
,

51 
	mVAR_REDIRECT_TIME
,

52 
	mVAR_REDIRECT_COUNT
,

53 
	mVAR_FTP_ENTRY_PATH
,

54 
	mVAR_REDIRECT_URL
,

55 
	mVAR_SSL_VERIFY_RESULT
,

56 
	mVAR_EFFECTIVE_FILENAME
,

57 
	mVAR_PRIMARY_IP
,

58 
	mVAR_PRIMARY_PORT
,

59 
	mVAR_LOCAL_IP
,

60 
	mVAR_LOCAL_PORT
,

61 
	mVAR_NUM_OF_VARS


62 } 
	tª∂a˚id
;

64 
	sv¨übÀ
 {

65 c⁄° *
	m«me
;

66 
ª∂a˚id
 
	mid
;

70 c⁄° 
v¨übÀ
 
	gª∂a˚míts
[]={

71 {"uæ_ef„˘ive", 
VAR_EFFECTIVE_URL
},

72 {"hâp_code", 
VAR_HTTP_CODE
},

73 {"ª•⁄£_code", 
VAR_HTTP_CODE
},

74 {"hâp_c⁄√˘", 
VAR_HTTP_CODE_PROXY
},

75 {"time_tŸÆ", 
VAR_TOTAL_TIME
},

76 {"time_«mñookup", 
VAR_NAMELOOKUP_TIME
},

77 {"time_c⁄√˘", 
VAR_CONNECT_TIME
},

78 {"time_≠pc⁄√˘", 
VAR_APPCONNECT_TIME
},

79 {"time_¥ëøns„r", 
VAR_PRETRANSFER_TIME
},

80 {"time_°¨âøns„r", 
VAR_STARTTRANSFER_TIME
},

81 {"size_hódî", 
VAR_HEADER_SIZE
},

82 {"size_ªque°", 
VAR_REQUEST_SIZE
},

83 {"size_dow∆ﬂd", 
VAR_SIZE_DOWNLOAD
},

84 {"size_u∂ﬂd", 
VAR_SIZE_UPLOAD
},

85 {"•ìd_dow∆ﬂd", 
VAR_SPEED_DOWNLOAD
},

86 {"•ìd_u∂ﬂd", 
VAR_SPEED_UPLOAD
},

87 {"c⁄ã¡_ty≥", 
VAR_CONTENT_TYPE
},

88 {"num_c⁄√˘s", 
VAR_NUM_CONNECTS
},

89 {"time_ªdúe˘", 
VAR_REDIRECT_TIME
},

90 {"num_ªdúe˘s", 
VAR_REDIRECT_COUNT
},

91 {"·p_íåy_∑th", 
VAR_FTP_ENTRY_PATH
},

92 {"ªdúe˘_uæ", 
VAR_REDIRECT_URL
},

93 {"s¶_vîify_ªsu…", 
VAR_SSL_VERIFY_RESULT
},

94 {"fûíame_ef„˘ive", 
VAR_EFFECTIVE_FILENAME
},

95 {"ªmŸe_ù", 
VAR_PRIMARY_IP
},

96 {"ªmŸe_p‹t", 
VAR_PRIMARY_PORT
},

97 {"loˇl_ù", 
VAR_LOCAL_IP
},

98 {"loˇl_p‹t", 
VAR_LOCAL_PORT
},

99 {
NULL
, 
VAR_NONE
}

102 
	$ourWrôeOut
(
CURL
 *
cuæ
, 
OutSåu˘
 *
outs
, c⁄° *
wrôeöfo
)

104 
FILE
 *
°ªam
 = 
°dout
;

105 c⁄° *
±r
 = 
wrôeöfo
;

106 *
°rögp
 = 
NULL
;

107 
l⁄göfo
;

108 
doubÀöfo
;

110 
±r
 && *ptr) {

111 if('%' =*
±r
) {

112 if('%' =
±r
[1]) {

114 
	`Âutc
('%', 
°ªam
);

115 
±r
 += 2;

119 *
íd
;

120 
kìpô
;

121 
i
;

122 if(('{' =
±r
[1]Ë&& ((
íd
 = 
	`°rchr
’å, '}')Ë!
NULL
)) {

123 
boﬁ
 
m©ch
 = 
FALSE
;

124 
±r
 += 2;

125 
kìpô
 = *
íd
;

126 *
íd
 = 0;

127 
i
 = 0; 
ª∂a˚míts
[i].
«me
; i++) {

128 if(
	`cuæ_°ªquÆ
(
±r
, 
ª∂a˚míts
[
i
].
«me
)) {

129 
m©ch
 = 
TRUE
;

130 
ª∂a˚míts
[
i
].
id
) {

131 
VAR_EFFECTIVE_URL
:

132 if((
CURLE_OK
 ==

133 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_EFFECTIVE_URL
, &
°rögp
))

134 && 
°rögp
)

135 
	`Âuts
(
°rögp
, 
°ªam
);

137 
VAR_HTTP_CODE
:

138 if(
CURLE_OK
 ==

139 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_RESPONSE_CODE
, &
l⁄göfo
))

140 
	`Ârötf
(
°ªam
, "%03ld", 
l⁄göfo
);

142 
VAR_HTTP_CODE_PROXY
:

143 if(
CURLE_OK
 ==

144 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_HTTP_CONNECTCODE
,

145 &
l⁄göfo
))

146 
	`Ârötf
(
°ªam
, "%03ld", 
l⁄göfo
);

148 
VAR_HEADER_SIZE
:

149 if(
CURLE_OK
 ==

150 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_HEADER_SIZE
, &
l⁄göfo
))

151 
	`Ârötf
(
°ªam
, "%ld", 
l⁄göfo
);

153 
VAR_REQUEST_SIZE
:

154 if(
CURLE_OK
 ==

155 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_REQUEST_SIZE
, &
l⁄göfo
))

156 
	`Ârötf
(
°ªam
, "%ld", 
l⁄göfo
);

158 
VAR_NUM_CONNECTS
:

159 if(
CURLE_OK
 ==

160 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_NUM_CONNECTS
, &
l⁄göfo
))

161 
	`Ârötf
(
°ªam
, "%ld", 
l⁄göfo
);

163 
VAR_REDIRECT_COUNT
:

164 if(
CURLE_OK
 ==

165 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_REDIRECT_COUNT
, &
l⁄göfo
))

166 
	`Ârötf
(
°ªam
, "%ld", 
l⁄göfo
);

168 
VAR_REDIRECT_TIME
:

169 if(
CURLE_OK
 ==

170 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_REDIRECT_TIME
,

171 &
doubÀöfo
))

172 
	`Ârötf
(
°ªam
, "%.3f", 
doubÀöfo
);

174 
VAR_TOTAL_TIME
:

175 if(
CURLE_OK
 ==

176 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_TOTAL_TIME
, &
doubÀöfo
))

177 
	`Ârötf
(
°ªam
, "%.3f", 
doubÀöfo
);

179 
VAR_NAMELOOKUP_TIME
:

180 if(
CURLE_OK
 ==

181 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_NAMELOOKUP_TIME
,

182 &
doubÀöfo
))

183 
	`Ârötf
(
°ªam
, "%.3f", 
doubÀöfo
);

185 
VAR_CONNECT_TIME
:

186 if(
CURLE_OK
 ==

187 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_CONNECT_TIME
, &
doubÀöfo
))

188 
	`Ârötf
(
°ªam
, "%.3f", 
doubÀöfo
);

190 
VAR_APPCONNECT_TIME
:

191 if(
CURLE_OK
 ==

192 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_APPCONNECT_TIME
,

193 &
doubÀöfo
))

194 
	`Ârötf
(
°ªam
, "%.3f", 
doubÀöfo
);

196 
VAR_PRETRANSFER_TIME
:

197 if(
CURLE_OK
 ==

198 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_PRETRANSFER_TIME
,

199 &
doubÀöfo
))

200 
	`Ârötf
(
°ªam
, "%.3f", 
doubÀöfo
);

202 
VAR_STARTTRANSFER_TIME
:

203 if(
CURLE_OK
 ==

204 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_STARTTRANSFER_TIME
,

205 &
doubÀöfo
))

206 
	`Ârötf
(
°ªam
, "%.3f", 
doubÀöfo
);

208 
VAR_SIZE_UPLOAD
:

209 if(
CURLE_OK
 ==

210 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_SIZE_UPLOAD
, &
doubÀöfo
))

211 
	`Ârötf
(
°ªam
, "%.0f", 
doubÀöfo
);

213 
VAR_SIZE_DOWNLOAD
:

214 if(
CURLE_OK
 ==

215 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_SIZE_DOWNLOAD
,

216 &
doubÀöfo
))

217 
	`Ârötf
(
°ªam
, "%.0f", 
doubÀöfo
);

219 
VAR_SPEED_DOWNLOAD
:

220 if(
CURLE_OK
 ==

221 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_SPEED_DOWNLOAD
,

222 &
doubÀöfo
))

223 
	`Ârötf
(
°ªam
, "%.3f", 
doubÀöfo
);

225 
VAR_SPEED_UPLOAD
:

226 if(
CURLE_OK
 ==

227 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_SPEED_UPLOAD
, &
doubÀöfo
))

228 
	`Ârötf
(
°ªam
, "%.3f", 
doubÀöfo
);

230 
VAR_CONTENT_TYPE
:

231 if((
CURLE_OK
 ==

232 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_CONTENT_TYPE
, &
°rögp
))

233 && 
°rögp
)

234 
	`Âuts
(
°rögp
, 
°ªam
);

236 
VAR_FTP_ENTRY_PATH
:

237 if((
CURLE_OK
 ==

238 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_FTP_ENTRY_PATH
, &
°rögp
))

239 && 
°rögp
)

240 
	`Âuts
(
°rögp
, 
°ªam
);

242 
VAR_REDIRECT_URL
:

243 if((
CURLE_OK
 ==

244 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_REDIRECT_URL
, &
°rögp
))

245 && 
°rögp
)

246 
	`Âuts
(
°rögp
, 
°ªam
);

248 
VAR_SSL_VERIFY_RESULT
:

249 if(
CURLE_OK
 ==

250 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_SSL_VERIFYRESULT
,

251 &
l⁄göfo
))

252 
	`Ârötf
(
°ªam
, "%ld", 
l⁄göfo
);

254 
VAR_EFFECTIVE_FILENAME
:

255 if(
outs
->
fûíame
)

256 
	`Ârötf
(
°ªam
, "%s", 
outs
->
fûíame
);

258 
VAR_PRIMARY_IP
:

259 if(
CURLE_OK
 ==

260 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_PRIMARY_IP
,

261 &
°rögp
))

262 
	`Ârötf
(
°ªam
, "%s", 
°rögp
);

264 
VAR_PRIMARY_PORT
:

265 if(
CURLE_OK
 ==

266 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_PRIMARY_PORT
,

267 &
l⁄göfo
))

268 
	`Ârötf
(
°ªam
, "%ld", 
l⁄göfo
);

270 
VAR_LOCAL_IP
:

271 if(
CURLE_OK
 ==

272 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_LOCAL_IP
,

273 &
°rögp
))

274 
	`Ârötf
(
°ªam
, "%s", 
°rögp
);

276 
VAR_LOCAL_PORT
:

277 if(
CURLE_OK
 ==

278 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_LOCAL_PORT
,

279 &
l⁄göfo
))

280 
	`Ârötf
(
°ªam
, "%ld", 
l⁄göfo
);

288 if(!
m©ch
) {

289 
	`Ârötf
(
°dîr
, "cuæ: unknow¿--wrôe-ouàv¨übÀ: '%s'\n", 
±r
);

291 
±r
 = 
íd
 + 1;

292 *
íd
 = 
kìpô
;

296 
	`Âutc
('%', 
°ªam
);

297 
	`Âutc
(
±r
[1], 
°ªam
);

298 
±r
 += 2;

302 if('\\' =*
±r
) {

303 
±r
[1]) {

305 
	`Âutc
('\r', 
°ªam
);

308 
	`Âutc
('\n', 
°ªam
);

311 
	`Âutc
('\t', 
°ªam
);

315 
	`Âutc
(*
±r
, 
°ªam
);

316 
	`Âutc
(
±r
[1], 
°ªam
);

319 
±r
 += 2;

322 
	`Âutc
(*
±r
, 
°ªam
);

323 
±r
++;

327 
	}
}

	@src/tool_writeout.h

1 #i‚de‡
HEADER_CURL_TOOL_WRITEOUT_H


2 
	#HEADER_CURL_TOOL_WRITEOUT_H


	)

24 
	~"toﬁ_£tup.h
"

26 
ourWrôeOut
(
CURL
 *
cuæ
, 
OutSåu˘
 *
outs
, c⁄° *
wrôeöfo
);

	@src/tool_xattr.c

22 
	~"toﬁ_£tup.h
"

24 #ifde‡
HAVE_FSETXATTR


25 
	~<sys/x©å.h
>

26 
	#USE_XATTR


	)

27 #ñi‡
deföed
(
__FªeBSD_vîsi⁄
) && (__FreeBSD_version > 500000)

28 
	~<sys/ty≥s.h
>

29 
	~<sys/exèâr.h
>

30 
	#USE_XATTR


	)

33 
	~"toﬁ_x©å.h
"

35 
	~"memdebug.h
"

37 #ifde‡
USE_XATTR


40 c⁄° 
	sx©å_m≠pög
 {

41 c⁄° *
	m©å
;

42 
CURLINFO
 
	möfo
;

43 } 
	gm≠pögs
[] = {

47 { "u£r.xdg.‹igö.uæ", 
CURLINFO_EFFECTIVE_URL
 },

48 { "u£r.mime_ty≥", 
CURLINFO_CONTENT_TYPE
 },

49 { 
NULL
, 
CURLINFO_NONE
 }

55 
	$fwrôe_x©å
(
CURL
 *
cuæ
, 
fd
)

57 
i
 = 0;

58 
îr
 = 0;

60 
îr
 =0 && 
m≠pögs
[
i
].
©å
 !
NULL
) {

61 *
vÆue
 = 
NULL
;

62 
CURLcode
 
rc
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
m≠pögs
[
i
].
öfo
, &
vÆue
);

63 if(
rc
 =
CURLE_OK
 && 
vÆue
) {

64 #ifde‡
HAVE_FSETXATTR_6


65 
îr
 = 
	`f£tx©å
(
fd
, 
m≠pögs
[
i
].
©å
, 
vÆue
, 
	`°æí
(value), 0, 0);

66 #ñi‡
	`deföed
(
HAVE_FSETXATTR_5
)

67 
îr
 = 
	`f£tx©å
(
fd
, 
m≠pögs
[
i
].
©å
, 
vÆue
, 
	`°æí
(value), 0);

68 #ñi‡
	`deföed
(
__FªeBSD_vîsi⁄
)

69 
îr
 = 
	`exèâr_£t_fd
(
fd
, 
EXTATTR_NAMESPACE_USER
, 
m≠pögs
[
i
].
©å
, 
vÆue
,

70 
	`°æí
(
vÆue
));

73 
îr
 =Érr < 0 ?Érr : 0;

76 
i
++;

78  
îr
;

79 
	}
}

81 
	$fwrôe_x©å
(
CURL
 *
cuæ
, 
fd
)

83 ()
cuæ
;

84 ()
fd
;

86 
	}
}

	@src/tool_xattr.h

1 #i‚de‡
HEADER_CURL_TOOL_XATTR_H


2 
	#HEADER_CURL_TOOL_XATTR_H


	)

24 
	~"toﬁ_£tup.h
"

26 
fwrôe_x©å
(
CURL
 *
cuæ
, 
fd
);

	@src/version.h

1 #i‚de‡
HEADER_CURL_VERSION_H


2 
	#HEADER_CURL_VERSION_H


	)

25 
	~<cuæ/cuævî.h
>

27 
	#CURL_NAME
 "cuæ"

	)

28 
	#CURL_COPYRIGHT
 
LIBCURL_COPYRIGHT


	)

29 
	#CURL_VERSION
 "7.22.0"

	)

30 
	#CURL_VERSION_MAJOR
 
LIBCURL_VERSION_MAJOR


	)

31 
	#CURL_VERSION_MINOR
 
LIBCURL_VERSION_MINOR


	)

32 
	#CURL_VERSION_PATCH
 
LIBCURL_VERSION_PATCH


	)

33 
	#CURL_ID
 
CURL_NAME
 " " 
CURL_VERSION
 " (" 
OS
 "Ë"

	)

	@tests/libtest/chkhostname.c

22 
	~"cuæ_£tup.h
"

24 
	~"cuæ_gëho°«me.h
"

26 
	#HOSTNAME_MAX
 1024

	)

28 
	$maö
(
¨gc
, *
¨gv
[])

30 
buff
[
HOSTNAME_MAX
];

31 i‡(
¨gc
 != 2) {

32 
	`¥ötf
("Ußge: %†EXPECTED_HOSTNAME\n", 
¨gv
[0]);

36 i‡(
	`Cuæ_gëho°«me
(
buff
, 
HOSTNAME_MAX
)) {

37 
	`¥ötf
("Curl_gethostname() failed\n");

42 if(
	`°∫cmp
(
buff
, 
¨gv
[1], 
HOSTNAME_MAX
)) {

43 
	`¥ötf
("got unexpected hostÇame back, LD_PRELOAD failed\n");

47 
	}
}

	@tests/libtest/first.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_LOCALE_H


25 
	~<loˇÀ.h
>

28 #ifde‡
HAVE_IO_H


29 
	~<io.h
>

32 #ifde‡
HAVE_FCNTL_H


33 
	~<f˙é.h
>

36 #ifde‡
CURLDEBUG


37 
	#MEMDEBUG_NODEFINES


	)

38 
	~"memdebug.h
"

41 
	$£À˘_wøµî
(
nfds
, 
fd_£t
 *
rd
, fd_£à*
wr
, fd_£à*
exc
,

42 
timevÆ
 *
tv
)

44 if(
nfds
 < 0) {

45 
	`SET_SOCKERRNO
(
EINVAL
);

48 #ifde‡
USE_WINSOCK


54 if(!
nfds
) {

55 
	`SÀï
(1000*
tv
->
tv_£c
 +Åv->
tv_u£c
/1000);

59  
	`£À˘
(
nfds
, 
rd
, 
wr
, 
exc
, 
tv
);

60 
	}
}

62 
	$waô_ms
(
ms
)

64 
timevÆ
 
t
;

65 
t
.
tv_£c
 = 
ms
/1000;

66 
ms
 -()
t
.
tv_£c
 * 1000;

67 
t
.
tv_u£c
 = 
ms
 * 1000;

68 
	`£À˘_wøµî
(0, 
NULL
, NULL , NULL, &
t
);

69 
	}
}

71 *
	glibã°_¨g2
=
NULL
;

72 *
	glibã°_¨g3
=
NULL
;

73 
	gã°_¨gc
;

74 **
	gã°_¨gv
;

76 
timevÆ
 
	gtv_ã°_°¨t
;

78 #ifde‡
UNITTESTS


79 
	gunôÁû
;

82 #ifde‡
CURLDEBUG


83 
	$mem‹y_åackög_öô
()

85 *
ív
;

87 
ív
 = 
	`cuæ_gëív
("CURL_MEMDEBUG");

88 if(
ív
) {

90 
‚ame
[
CURL_MT_LOGFNAME_BUFSIZE
];

91 if(
	`°æí
(
ív
Ë>
CURL_MT_LOGFNAME_BUFSIZE
)

92 
ív
[
CURL_MT_LOGFNAME_BUFSIZE
-1] = '\0';

93 
	`°r˝y
(
‚ame
, 
ív
);

94 
	`cuæ_‰ì
(
ív
);

95 
	`cuæ_memdebug
(
‚ame
);

101 
ív
 = 
	`cuæ_gëív
("CURL_MEMLIMIT");

102 if(
ív
) {

103 *
íd±r
;

104 
num
 = 
	`°πﬁ
(
ív
, &
íd±r
, 10);

105 if((
íd±r
 !
ív
Ë&& (íd±∏=ív + 
	`°æí
”nv)Ë&& (
num
 > 0))

106 
	`cuæ_memlimô
(
num
);

107 
	`cuæ_‰ì
(
ív
);

109 
	}
}

111 
	#mem‹y_åackög_öô
(Ë
Cuæ_n›_°mt


	)

114 
	$maö
(
¨gc
, **
¨gv
)

116 *
URL
;

118 #ifde‡
O_BINARY


119 #ifde‡
__HIGHC__


120 
	`_£tmode
(
°dout
, 
O_BINARY
);

122 
	`£tmode
(
	`fûío
(
°dout
), 
O_BINARY
);

126 
	`mem‹y_åackög_öô
();

133 #ifde‡
HAVE_SETLOCALE


134 
	`£éoˇÀ
(
LC_ALL
, "");

137 if(
¨gc
< 2 ) {

138 
	`Ârötf
(
°dîr
, "Pass URLásárgumentÖlease\n");

142 
ã°_¨gc
 = 
¨gc
;

143 
ã°_¨gv
 = 
¨gv
;

145 if(
¨gc
>2)

146 
libã°_¨g2
=
¨gv
[2];

148 if(
¨gc
>3)

149 
libã°_¨g3
=
¨gv
[3];

151 
URL
 = 
¨gv
[1];

153 
	`Ârötf
(
°dîr
, "URL: %s\n", 
URL
);

155  
	`ã°
(
URL
);

156 
	}
}

	@tests/libtest/lib1500.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

30 
	$ã°
(*
URL
)

32 
CURL
* 
cuæs
 = 
NULL
;

33 
CURLM
* 
mu…i
 = 
NULL
;

34 
°ûl_ru¬ög
;

35 
i
 = 
TEST_ERR_FAILURE
;

36 
ªs
 = 0;

37 
CURLMsg
 *
msg
;

39 
	`°¨t_ã°_timög
();

41 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

43 
	`mu…i_öô
(
mu…i
);

45 
	`ósy_öô
(
cuæs
);

47 
	`ósy_£t›t
(
cuæs
, 
CURLOPT_URL
, 
URL
);

48 
	`ósy_£t›t
(
cuæs
, 
CURLOPT_HEADER
, 1L);

50 
	`mu…i_add_h™dÀ
(
mu…i
, 
cuæs
);

52 
	`mu…i_≥rf‹m
(
mu…i
, &
°ûl_ru¬ög
);

54 
	`ab‹t_⁄_ã°_timeout
();

56 
°ûl_ru¬ög
) {

57 
num
;

58 
ªs
 = 
	`cuæ_mu…i_waô
(
mu…i
, 
NULL
, 0, 
TEST_HANG_TIMEOUT
, &
num
);

59 i‡(
ªs
 !
CURLM_OK
) {

60 
	`¥ötf
("cuæ_mu…i_waô(Ëªtu∫ed %d\n", 
ªs
);

61 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

62 
ã°_˛ónup
;

65 
	`ab‹t_⁄_ã°_timeout
();

67 
	`mu…i_≥rf‹m
(
mu…i
, &
°ûl_ru¬ög
);

69 
	`ab‹t_⁄_ã°_timeout
();

72 
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
mu…i
, &
°ûl_ru¬ög
);

73 if(
msg
)

76 
i
 = 
msg
->
d©a
.
ªsu…
;

78 
ã°_˛ónup
:

82 
	`cuæ_mu…i_˛ónup
(
mu…i
);

83 
	`cuæ_ósy_˛ónup
(
cuæs
);

84 
	`cuæ_globÆ_˛ónup
();

86 if(
ªs
)

87 
i
 = 
ªs
;

89  
i
;

90 
	}
}

	@tests/libtest/lib1501.c

22 
	~"ã°.h
"

24 
	~<f˙é.h
>

26 
	~"ã°utû.h
"

27 
	~"w¨∆ess.h
"

28 
	~"memdebug.h
"

30 
	#TEST_HANG_TIMEOUT
 30 * 1000

	)

34 
	#MAX_BLOCKED_TIME_US
 500000

	)

37 
	$ñ≠£d
(
timevÆ
 *
bef‹e
,

38 
timevÆ
 *
a·î
)

40 
ssize_t
 
ªsu…
;

42 
ªsu…
 = (
a·î
->
tv_£c
 - 
bef‹e
->tv_sec) * 1000000 +

43 
a·î
->
tv_u£c
 - 
bef‹e
->tv_usec;

44 i‡(
ªsu…
 < 0)

45 
ªsu…
 = 0;

47  
	`cuæx_sztosi
(
ªsu…
);

48 
	}
}

51 
	$ã°
(*
URL
)

53 
CURL
 *
h™dÀ
 = 
NULL
;

54 
CURLM
 *
mh™dÀ
 = 
NULL
;

55 
ªs
 = 0;

56 
°ûl_ru¬ög
 = 0;

58 
	`°¨t_ã°_timög
();

60 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

62 
	`ósy_öô
(
h™dÀ
);

64 
	`ósy_£t›t
(
h™dÀ
, 
CURLOPT_URL
, 
URL
);

65 
	`ósy_£t›t
(
h™dÀ
, 
CURLOPT_VERBOSE
, 1L);

67 
	`mu…i_öô
(
mh™dÀ
);

69 
	`mu…i_add_h™dÀ
(
mh™dÀ
, 
h™dÀ
);

71 
	`mu…i_≥rf‹m
(
mh™dÀ
, &
°ûl_ru¬ög
);

73 
	`ab‹t_⁄_ã°_timeout
();

75 
°ûl_ru¬ög
) {

76 
timevÆ
 
timeout
;

77 
fd_£t
 
fdªad
;

78 
fd_£t
 
fdwrôe
;

79 
fd_£t
 
fdex˚p
;

80 
maxfd
 = -99;

81 
timevÆ
 
bef‹e
;

82 
timevÆ
 
a·î
;

83 
e
;

85 
timeout
.
tv_£c
 = 0;

86 
timeout
.
tv_u£c
 = 100000L;

88 
	`FD_ZERO
(&
fdªad
);

89 
	`FD_ZERO
(&
fdwrôe
);

90 
	`FD_ZERO
(&
fdex˚p
);

92 
	`mu…i_fd£t
(
mh™dÀ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

96 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

98 
	`ab‹t_⁄_ã°_timeout
();

100 
	`Ârötf
(
°dîr
, "ping\n");

101 
bef‹e
 = 
	`tutû_tvnow
();

103 
	`mu…i_≥rf‹m
(
mh™dÀ
, &
°ûl_ru¬ög
);

105 
	`ab‹t_⁄_ã°_timeout
();

107 
a·î
 = 
	`tutû_tvnow
();

108 
e
 = 
	`ñ≠£d
(&
bef‹e
, &
a·î
);

109 
	`Ârötf
(
°dîr
, "p⁄g = %d\n", 
e
);

111 if(
e
 > 
MAX_BLOCKED_TIME_US
) {

112 
ªs
 = 100;

117 
ã°_˛ónup
:

121 
	`cuæ_mu…i_˛ónup
(
mh™dÀ
);

122 
	`cuæ_ósy_˛ónup
(
h™dÀ
);

123 
	`cuæ_globÆ_˛ónup
();

125  
ªs
;

126 
	}
}

	@tests/libtest/lib1502.c

30 
	~"ã°.h
"

32 #ifde‡
HAVE_LIMITS_H


33 
	~<limôs.h
>

36 
	~"ã°utû.h
"

37 
	~"w¨∆ess.h
"

38 
	~"memdebug.h
"

40 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

42 
	$ã°
(*
URL
)

44 
CURL
* 
ósy
 = 
NULL
;

45 
CURLM
* 
mu…i
 = 
NULL
;

46 
°ûl_ru¬ög
;

47 
ªs
 = 0;

49 
ªdúe˘
[160];

52 
cuæ_¶i°
 *
dns_ˇche_li°
;

54 
	`•rötf
(
ªdúe˘
, "googÀ.com:%s:%s", 
libã°_¨g2
, 
libã°_¨g3
);

56 
	`°¨t_ã°_timög
();

58 
dns_ˇche_li°
 = 
	`cuæ_¶i°_≠≥nd
(
NULL
, 
ªdúe˘
);

59 if(!
dns_ˇche_li°
) {

60 
	`Ârötf
(
°dîr
, "curl_slist_append() failed\n");

61  
TEST_ERR_MAJOR_BAD
;

64 
	`ªs_globÆ_öô
(
CURL_GLOBAL_ALL
);

65 if(
ªs
) {

66 
	`cuæ_¶i°_‰ì_Æl
(
dns_ˇche_li°
);

67  
ªs
;

70 
	`ósy_öô
(
ósy
);

72 
	`ósy_£t›t
(
ósy
, 
CURLOPT_URL
, 
URL
);

73 
	`ósy_£t›t
(
ósy
, 
CURLOPT_HEADER
, 1L);

74 
	`ósy_£t›t
(
ósy
, 
CURLOPT_RESOLVE
, 
dns_ˇche_li°
);

76 
	`mu…i_öô
(
mu…i
);

78 
	`mu…i_add_h™dÀ
(
mu…i
, 
ósy
);

80 
	`mu…i_≥rf‹m
(
mu…i
, &
°ûl_ru¬ög
);

82 
	`ab‹t_⁄_ã°_timeout
();

84 
°ûl_ru¬ög
) {

85 
timevÆ
 
timeout
;

86 
fd_£t
 
fdªad
;

87 
fd_£t
 
fdwrôe
;

88 
fd_£t
 
fdex˚p
;

89 
maxfd
 = -99;

91 
	`FD_ZERO
(&
fdªad
);

92 
	`FD_ZERO
(&
fdwrôe
);

93 
	`FD_ZERO
(&
fdex˚p
);

94 
timeout
.
tv_£c
 = 1;

95 
timeout
.
tv_u£c
 = 0;

97 
	`mu…i_fd£t
(
mu…i
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

101 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

103 
	`ab‹t_⁄_ã°_timeout
();

105 
	`mu…i_≥rf‹m
(
mu…i
, &
°ûl_ru¬ög
);

107 
	`ab‹t_⁄_ã°_timeout
();

110 
ã°_˛ónup
:

112 #ifde‡
LIB1502


114 
	`cuæ_mu…i_˛ónup
(
mu…i
);

115 
	`cuæ_ósy_˛ónup
(
ósy
);

116 
	`cuæ_globÆ_˛ónup
();

119 #ifde‡
LIB1503


121 
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…i
, 
ósy
);

122 
	`cuæ_mu…i_˛ónup
(
mu…i
);

123 
	`cuæ_ósy_˛ónup
(
ósy
);

124 
	`cuæ_globÆ_˛ónup
();

127 #ifde‡
LIB1504


129 
	`cuæ_ósy_˛ónup
(
ósy
);

130 
	`cuæ_mu…i_˛ónup
(
mu…i
);

131 
	`cuæ_globÆ_˛ónup
();

134 #ifde‡
LIB1505


136 
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…i
, 
ósy
);

137 
	`cuæ_ósy_˛ónup
(
ósy
);

138 
	`cuæ_mu…i_˛ónup
(
mu…i
);

139 
	`cuæ_globÆ_˛ónup
();

142 
	`cuæ_¶i°_‰ì_Æl
(
dns_ˇche_li°
);

144  
ªs
;

145 
	}
}

	@tests/libtest/lib1506.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

30 
	#NUM_HANDLES
 4

	)

32 
	$ã°
(*
URL
)

34 
ªs
 = 0;

35 
CURL
 *
cuæ
[
NUM_HANDLES
] = {0};

36 
ru¬ög
;

37 
CURLM
 *
m
 = 
NULL
;

38 
i
;

39 
èrgë_uæ
[256];

40 
dn£¡ry
[256];

41 
cuæ_¶i°
 *
¶i°
 = 
NULL
, *
¶i°2
;

42 *
p‹t
 = 
libã°_¨g3
;

43 *
addªss
 = 
libã°_¨g2
;

45 ()
URL
;

48 
i
=0; i < 
NUM_HANDLES
; i++) {

49 
	`•rötf
(
dn£¡ry
, "£rvî%d.exam∂e.com:%s:%s", 
i
 + 1, 
p‹t
, 
addªss
);

50 
	`¥ötf
("%s\n", 
dn£¡ry
);

51 
¶i°2
 = 
	`cuæ_¶i°_≠≥nd
(
¶i°
, 
dn£¡ry
);

52 if(!
¶i°2
) {

53 
	`Ârötf
(
°dîr
, "curl_slist_append() failed\n");

54 
ã°_˛ónup
;

56 
¶i°
 = 
¶i°2
;

59 
	`°¨t_ã°_timög
();

61 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

63 
	`mu…i_öô
(
m
);

65 
	`mu…i_£t›t
(
m
, 
CURLMOPT_MAXCONNECTS
, 3L);

68 
i
=0; i < 
NUM_HANDLES
; i++) {

70 
	`ósy_öô
(
cuæ
[
i
]);

72 
	`•rötf
(
èrgë_uæ
, "http://server%d.example.com:%s/path/1506%04i",

73 
i
 + 1, 
p‹t
, i + 1);

74 
èrgë_uæ
[(target_url) - 1] = '\0';

75 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_URL
, 
èrgë_uæ
);

77 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_VERBOSE
, 1L);

79 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_HEADER
, 1L);

81 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_RESOLVE
, 
¶i°
);

84 
	`Ârötf
(
°dîr
, "Startát URL 0\n");

86 
i
=0; i < 
NUM_HANDLES
; i++) {

88 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
[
i
]);

91 
timevÆ
 
öãrvÆ
;

92 
fd_£t
 
rd
, 
wr
, 
exc
;

93 
maxfd
 = -99;

95 
öãrvÆ
.
tv_£c
 = 1;

96 
öãrvÆ
.
tv_u£c
 = 0;

98 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

100 
	`ab‹t_⁄_ã°_timeout
();

102 if(!
ru¬ög
)

105 
	`FD_ZERO
(&
rd
);

106 
	`FD_ZERO
(&
wr
);

107 
	`FD_ZERO
(&
exc
);

109 
	`mu…i_fd£t
(
m
, &
rd
, &
wr
, &
exc
, &
maxfd
);

113 
	`£À˘_ã°
(
maxfd
+1, &
rd
, &
wr
, &
exc
, &
öãrvÆ
);

115 
	`ab‹t_⁄_ã°_timeout
();

117 
	`waô_ms
(1);

120 
ã°_˛ónup
:

124 
i
=0; i < 
NUM_HANDLES
; i++) {

125 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
cuæ
[
i
]);

126 
	`cuæ_ósy_˛ónup
(
cuæ
[
i
]);

129 
	`cuæ_¶i°_‰ì_Æl
(
¶i°
);

131 
	`cuæ_mu…i_˛ónup
(
m
);

132 
	`cuæ_globÆ_˛ónup
();

134  
ªs
;

135 
	}
}

	@tests/libtest/lib1507.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

31 
	#USERNAME
 "u£r@exam∂e.com"

	)

32 
	#PASSWORD
 "123qwîty"

	)

33 
	#RECIPIENT
 "<1507-ªcùõ¡@exam∂e.com>"

	)

34 
	#MAILFROM
 "<1507-ªÆu£r@exam∂e.com>"

	)

36 
	#MULTI_PERFORM_HANG_TIMEOUT
 60 * 1000

	)

38 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

40 ()
±r
;

41 ()
size
;

42 ()
nmemb
;

43 ()
u£Ω
;

44  
CURL_READFUNC_ABORT
;

45 
	}
}

47 
timevÆ
 
	$tvnow
()

52 
timevÆ
 
now
;

53 
now
.
tv_£c
 = ()
	`time
(
NULL
);

54 
now
.
tv_u£c
 = 0;

55  
now
;

56 
	}
}

58 
	$tvdiff
(
timevÆ
 
√wî
, timevÆ 
ﬁdî
)

60  (
√wî
.
tv_£c
-
ﬁdî
.tv_sec)*1000+

61 (
√wî
.
tv_u£c
-
ﬁdî
.tv_usec)/1000;

62 
	}
}

64 
	$ã°
(*
URL
)

66 
ªs
 = 0;

67 
CURL
 *
cuæ
 = 
NULL
;

68 
CURLM
 *
mcuæ
 = 
NULL
;

69 
°ûl_ru¬ög
 = 1;

70 
timevÆ
 
mp_°¨t
;

71 
cuæ_¶i°
* 
r˝t_li°
 = 
NULL
;

73 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_DEFAULT
);

75 
	`ósy_öô
(
cuæ
);

77 
	`mu…i_öô
(
mcuæ
);

79 
r˝t_li°
 = 
	`cuæ_¶i°_≠≥nd
‘˝t_li°, 
RECIPIENT
);

84 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

86 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_USERNAME
, 
USERNAME
);

87 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_PASSWORD
, 
PASSWORD
);

89 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

90 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

91 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_FROM
, 
MAILFROM
);

92 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_MAIL_RCPT
, 
r˝t_li°
);

93 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

94 
	`mu…i_add_h™dÀ
(
mcuæ
, 
cuæ
);

96 
mp_°¨t
 = 
	`tvnow
();

99 
	`cuæ_mu…i_≥rf‹m
(
mcuæ
, &
°ûl_ru¬ög
);

101 
°ûl_ru¬ög
) {

102 
timevÆ
 
timeout
;

103 
rc
;

105 
fd_£t
 
fdªad
;

106 
fd_£t
 
fdwrôe
;

107 
fd_£t
 
fdex˚p
;

108 
maxfd
 = -1;

110 
cuæ_timeo
 = -1;

112 
	`FD_ZERO
(&
fdªad
);

113 
	`FD_ZERO
(&
fdwrôe
);

114 
	`FD_ZERO
(&
fdex˚p
);

117 
timeout
.
tv_£c
 = 1;

118 
timeout
.
tv_u£c
 = 0;

120 
	`cuæ_mu…i_timeout
(
mcuæ
, &
cuæ_timeo
);

121 if(
cuæ_timeo
 >= 0) {

122 
timeout
.
tv_£c
 = 
cuæ_timeo
 / 1000;

123 if(
timeout
.
tv_£c
 > 1)

124 
timeout
.
tv_£c
 = 1;

126 
timeout
.
tv_u£c
 = (
cuæ_timeo
 % 1000) * 1000;

130 
	`cuæ_mu…i_fd£t
(
mcuæ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

138 
rc
 = 
	`£À˘
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

140 i‡(
	`tvdiff
(
	`tvnow
(), 
mp_°¨t
Ë> 
MULTI_PERFORM_HANG_TIMEOUT
) {

141 
	`Ârötf
(
°dîr
, "ABORTING TEST, since it seems "

146 
rc
) {

152 
	`cuæ_mu…i_≥rf‹m
(
mcuæ
, &
°ûl_ru¬ög
);

157 
ã°_˛ónup
:

159 
	`cuæ_¶i°_‰ì_Æl
(
r˝t_li°
);

160 
	`cuæ_mu…i_ªmove_h™dÀ
(
mcuæ
, 
cuæ
);

161 
	`cuæ_mu…i_˛ónup
(
mcuæ
);

162 
	`cuæ_ósy_˛ónup
(
cuæ
);

163 
	`cuæ_globÆ_˛ónup
();

165  
ªs
;

166 
	}
}

	@tests/libtest/lib1508.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	$ã°
(*
URL
)

30 
ªs
 = 0;

31 
CURLM
 *
m
 = 
NULL
;

33 ()
URL
;

35 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

37 
	`mu…i_öô
(
m
);

39 
ã°_˛ónup
:

43 
	`cuæ_mu…i_˛ónup
(
m
);

44 
	`cuæ_globÆ_˛ónup
();

46 
	`¥ötf
("Weáre done\n");

48  
ªs
;

49 
	}
}

	@tests/libtest/lib1509.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
size_t
 
WrôeOuçut
(*
±r
, size_à
size
, size_à
nmemb
, *
°ªam
);

29 
size_t
 
WrôeHódî
(*
±r
, size_à
size
, size_à
nmemb
, *
°ªam
);

31 
	gªÆHódîSize
 = 0;

33 
	$ã°
(*
URL
)

35 
hódîSize
;

36 
CURLcode
 
code
;

37 
CURL
 *
cuæ
 = 
NULL
;

38 
ªs
 = 0;

40 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

42 
	`ósy_öô
(
cuæ
);

44 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

46 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, *
WrôeOuçut
);

47 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_HEADERFUNCTION
, *
WrôeHódî
);

49 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

50 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

51 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

52 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_HTTPPROXYTUNNEL
, 1L);

54 
code
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

55 if(
CURLE_OK
 !
code
) {

56 
	`Ârötf
(
°dîr
, "%s:%d curl_easy_perform() failed, "

58 
__FILE__
, 
__LINE__
, ()
code
, 
	`cuæ_ósy_°ªº‹
(code));

59 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

60 
ã°_˛ónup
;

63 
code
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_HEADER_SIZE
, &
hódîSize
);

64 if(
CURLE_OK
 !
code
) {

65 
	`Ârötf
(
°dîr
, "%s:%d curl_easy_getinfo() failed, "

67 
__FILE__
, 
__LINE__
, ()
code
, 
	`cuæ_ósy_°ªº‹
(code));

68 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

69 
ã°_˛ónup
;

72 
	`¥ötf
("hódîÜígth i†........: %lu\n", 
hódîSize
);

73 
	`¥ötf
("hódîÜígth should be..: %lu\n", 
ªÆHódîSize
);

75 
ã°_˛ónup
:

77 
	`cuæ_ósy_˛ónup
(
cuæ
);

78 
	`cuæ_globÆ_˛ónup
();

80  
ªs
;

81 
	}
}

83 
size_t
 
	$WrôeOuçut
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

85 
	`fwrôe
(
±r
, 
size
, 
nmemb
, 
°ªam
);

86  
nmemb
 * 
size
;

87 
	}
}

89 
size_t
 
	$WrôeHódî
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

91 ()
±r
;

92 ()
°ªam
;

93 
ªÆHódîSize
 +
size
 * 
nmemb
;

95  
nmemb
 * 
size
;

96 
	}
}

	@tests/libtest/lib1510.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

30 
	#NUM_URLS
 4

	)

32 
	$ã°
(*
URL
)

34 
ªs
 = 0;

35 
CURL
 *
cuæ
 = 
NULL
;

36 
i
;

37 
èrgë_uæ
[256];

38 
dn£¡ry
[256];

39 
cuæ_¶i°
 *
¶i°
 = 
NULL
, *
¶i°2
;

40 *
p‹t
 = 
libã°_¨g3
;

41 *
addªss
 = 
libã°_¨g2
;

43 ()
URL
;

46 
i
=0; i < 
NUM_URLS
; i++) {

47 
	`•rötf
(
dn£¡ry
, "£rvî%d.exam∂e.com:%s:%s", 
i
 + 1, 
p‹t
, 
addªss
);

48 
	`¥ötf
("%s\n", 
dn£¡ry
);

49 
¶i°2
 = 
	`cuæ_¶i°_≠≥nd
(
¶i°
, 
dn£¡ry
);

50 if(!
¶i°2
) {

51 
	`Ârötf
(
°dîr
, "curl_slist_append() failed\n");

52 
ã°_˛ónup
;

54 
¶i°
 = 
¶i°2
;

57 
	`°¨t_ã°_timög
();

59 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

62 
	`ósy_öô
(
cuæ
);

65 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

67 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

69 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_RESOLVE
, 
¶i°
);

71 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_MAXCONNECTS
, 3L);

74 
i
=0; i < 
NUM_URLS
; i++) {

76 
	`•rötf
(
èrgë_uæ
, "http://server%d.example.com:%s/path/1510%04i",

77 
i
 + 1, 
p‹t
, i + 1);

78 
èrgë_uæ
[(target_url) - 1] = '\0';

79 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
èrgë_uæ
);

81 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

83 
	`ab‹t_⁄_ã°_timeout
();

86 
ã°_˛ónup
:

90 
	`cuæ_ósy_˛ónup
(
cuæ
);

92 
	`cuæ_¶i°_‰ì_Æl
(
¶i°
);

94 
	`cuæ_globÆ_˛ónup
();

96  
ªs
;

97 
	}
}

	@tests/libtest/lib1511.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
unmë
;

29 
CURL
* 
cuæ
 = 
NULL
;

30 
ªs
 = 0;

32 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

34 
	`ósy_öô
(
cuæ
);

36 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

37 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

38 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_TIMECONDITION
, ()
CURL_TIMECOND_IFMODSINCE
);

41 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_TIMEVALUE
, 1566210680L);

43 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

44 if(
ªs
)

45 
ã°_˛ónup
;

47 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_CONDITION_UNMET
, &
unmë
);

48 if(
unmë
 != 1L) {

49 
ªs
 = 
TEST_ERR_FAILURE
;

50 
ã°_˛ónup
;

54 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_TIMEVALUE
, 1L);

56 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

57 if(
ªs
)

58 
ã°_˛ónup
;

60 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_CONDITION_UNMET
, &
unmë
);

61 if(
unmë
 != 0L) {

62 
ªs
 = 
TEST_ERR_FAILURE
;

63 
ã°_˛ónup
;

66 
ªs
 = 
TEST_ERR_SUCCESS
;

68 
ã°_˛ónup
:

71 
	`cuæ_ósy_˛ónup
(
cuæ
);

72 
	`cuæ_globÆ_˛ónup
();

74  
ªs
;

75 
	}
}

	@tests/libtest/lib1512.c

29 
	~"ã°.h
"

31 
	~"memdebug.h
"

33 
	#NUM_HANDLES
 2

	)

35 
	$ã°
(*
URL
)

37 
ªs
 = 0;

38 
CURL
 *
cuæ
[
NUM_HANDLES
] = {
NULL
, NULL};

39 *
p‹t
 = 
libã°_¨g3
;

40 *
addªss
 = 
libã°_¨g2
;

41 
dn£¡ry
[256];

42 
cuæ_¶i°
 *
¶i°
 = 
NULL
;

43 
i
;

44 
èrgë_uæ
[256];

45 ()
URL
;

47 if(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

48 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

49  
TEST_ERR_MAJOR_BAD
;

52 
	`•rötf
(
dn£¡ry
, "£rvî.exam∂e.cuæ:%s:%s", 
p‹t
, 
addªss
);

53 
	`¥ötf
("%s\n", 
dn£¡ry
);

54 
¶i°
 = 
	`cuæ_¶i°_≠≥nd
(¶i°, 
dn£¡ry
);

57 
i
=0; i < 
NUM_HANDLES
; i++) {

59 
	`ósy_öô
(
cuæ
[
i
]);

61 
	`•rötf
(
èrgë_uæ
, "http://server.example.curl:%s/path/1512%04i",

62 
p‹t
, 
i
 + 1);

63 
èrgë_uæ
[(target_url) - 1] = '\0';

64 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_URL
, 
èrgë_uæ
);

66 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_VERBOSE
, 1L);

68 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_HEADER
, 1L);

70 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_DNS_USE_GLOBAL_CACHE
, 1L);

74 
	`ósy_£t›t
(
cuæ
[0], 
CURLOPT_RESOLVE
, 
¶i°
);

77 
i
=0; (ò< 
NUM_HANDLES
Ë&& !
ªs
; i++)

78 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
[
i
]);

80 
ã°_˛ónup
:

82 
	`cuæ_ósy_˛ónup
(
cuæ
[0]);

83 
	`cuæ_ósy_˛ónup
(
cuæ
[1]);

84 
	`cuæ_¶i°_‰ì_Æl
(
¶i°
);

85 
	`cuæ_globÆ_˛ónup
();

87  
ªs
;

88 
	}
}

	@tests/libtest/lib1513.c

29 
	~"ã°.h
"

31 
	~"memdebug.h
"

33 
	$¥ogªssKûÀr
(*
¨g
,

34 
d…ŸÆ
,

35 
d ow
,

36 
u…ŸÆ
,

37 
u ow
)

39 ()
¨g
;

40 ()
d…ŸÆ
;

41 ()
d ow
;

42 ()
u…ŸÆ
;

43 ()
u ow
;

45 
	}
}

47 
	$ã°
(*
URL
)

49 
CURL
 *
cuæ
;

50 
ªs
=0;

52 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

54 
	`ósy_öô
(
cuæ
);

56 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

57 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_TIMEOUT
, ()7);

58 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_NOSIGNAL
, ()1);

59 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_PROGRESSFUNCTION
, 
¥ogªssKûÀr
);

60 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_PROGRESSDATA
, 
NULL
);

61 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_NOPROGRESS
, ()0);

63 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

65 
ã°_˛ónup
:

69 
	`cuæ_ósy_˛ónup
(
cuæ
);

70 
	`cuæ_globÆ_˛ónup
();

72  
ªs
;

73 
	}
}

	@tests/libtest/lib1514.c

27 
	~"ã°.h
"

29 
	~"memdebug.h
"

31 
	gd©a
[]="dummy";

33 
	sWrôeThis
 {

34 *
	mªad±r
;

35 
size_t
 
	msizñe·
;

38 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

40 
WrôeThis
 *
pooh
 = (WrôeThi†*)
u£Ω
;

42 if(
size
*
nmemb
 < 1)

45 if(
pooh
->
sizñe·
) {

46 *(*)
±r
 = 
pooh
->
ªad±r
[0];

47 
pooh
->
ªad±r
++;

48 
pooh
->
sizñe·
--;

53 
	}
}

55 
	$ã°
(*
URL
)

57 
CURL
 *
cuæ
;

58 
CURLcode
 
ªsu…
 = 
CURLE_OK
;

59 
ªs
 = 0;

60 
WrôeThis
 
pooh
 = { 
d©a
, (data)-1 };

62 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

64 
	`ósy_öô
(
cuæ
);

66 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

67 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

69 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

70 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
pooh
);

72 
ªsu…
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

74 
ã°_˛ónup
:

76 
	`cuæ_ósy_˛ónup
(
cuæ
);

77 
	`cuæ_globÆ_˛ónup
();

79  ()
ªsu…
;

80 
	}
}

	@tests/libtest/lib1515.c

29 
	~"ã°.h
"

30 
	~"ã°utû.h
"

31 
	~"w¨∆ess.h
"

32 
	~"memdebug.h
"

34 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

36 
	#DNS_TIMEOUT
 1

	)

38 #i‡
deföed
(
WIN32
Ë|| deföed(
_WIN32
)

39 
	#¶ìp
(
s
Ë
	`SÀï
(†* 1000)

	)

42 
	#_MPRINTF_REPLACE


	)

43 
	~<cuæ/m¥ötf.h
>

45 
	$debug_ˇŒback
(
CURL
 *
cuæ
, 
cuæ_öfŸy≥
 
öfo
, *
msg
, 
size_t
 
Àn
, *
±r
)

47 ()
cuæ
;

48 ()
±r
;

50 if(
öfo
 =
CURLINFO_TEXT
)

51 
	`Ârötf
(
°dîr
, "debug: %.*s", (Ë
Àn
, 
msg
);

54 
	}
}

56 
	$do_⁄e_ªque°
(
CURLM
 *
m
, *
URL
, *
ªsﬁve
)

58 
CURL
 *
cuæs
;

59 
cuæ_¶i°
 *
ªsﬁve_li°
 = 
NULL
;

60 
°ûl_ru¬ög
;

61 
ªs
 = 0;

62 
CURLMsg
 *
msg
;

63 
msgs_À·
;

65 
ªsﬁve_li°
 = 
	`cuæ_¶i°_≠≥nd
‘esﬁve_li°, 
ªsﬁve
);

67 
	`ósy_öô
(
cuæs
);

69 
	`ósy_£t›t
(
cuæs
, 
CURLOPT_URL
, 
URL
);

70 
	`ósy_£t›t
(
cuæs
, 
CURLOPT_RESOLVE
, 
ªsﬁve_li°
);

71 
	`ósy_£t›t
(
cuæs
, 
CURLOPT_DEBUGFUNCTION
, 
debug_ˇŒback
);

72 
	`ósy_£t›t
(
cuæs
, 
CURLOPT_VERBOSE
, 1);

73 
	`ósy_£t›t
(
cuæs
, 
CURLOPT_DNS_CACHE_TIMEOUT
, 
DNS_TIMEOUT
);

75 
	`mu…i_add_h™dÀ
(
m
, 
cuæs
);

76 
	`mu…i_≥rf‹m
(
m
, &
°ûl_ru¬ög
);

78 
	`ab‹t_⁄_ã°_timeout
();

80 
°ûl_ru¬ög
) {

81 
timevÆ
 
timeout
;

82 
fd_£t
 
fdªad
, 
fdwrôe
, 
fdex˚p
;

83 
maxfd
 = -99;

85 
	`FD_ZERO
(&
fdªad
);

86 
	`FD_ZERO
(&
fdwrôe
);

87 
	`FD_ZERO
(&
fdex˚p
);

88 
timeout
.
tv_£c
 = 1;

89 
timeout
.
tv_u£c
 = 0;

91 
	`mu…i_fd£t
(
m
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

92 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

94 
	`ab‹t_⁄_ã°_timeout
();

95 
	`mu…i_≥rf‹m
(
m
, &
°ûl_ru¬ög
);

97 
	`ab‹t_⁄_ã°_timeout
();

100 (
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
m
, &
msgs_À·
))) {

101 if(
msg
->msg =
CURLMSG_DONE
 && msg->
ósy_h™dÀ
 =
cuæs
) {

102 
ªs
 = 
msg
->
d©a
.
ªsu…
;

107 
ã°_˛ónup
:

109 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
cuæs
);

110 
	`cuæ_ósy_˛ónup
(
cuæs
);

111 
	`cuæ_¶i°_‰ì_Æl
(
ªsﬁve_li°
);

113  
ªs
;

114 
	}
}

116 
	$ã°
(*
URL
)

118 
CURLM
* 
mu…i
 = 
NULL
;

119 
ªs
 = 0;

120 *
addªss
 = 
libã°_¨g2
;

121 *
p‹t
 = 
libã°_¨g3
;

122 *
∑th
 = 
URL
;

123 
dns_íåy
[256];

124 
i
;

125 
cou¡
 = 2;

127 
	`¢¥ötf
(
dns_íåy
, (dns_íåy), "ã°£rvî.exam∂e.com:%s:%s", 
p‹t
, 
addªss
);

129 
	`°¨t_ã°_timög
();

131 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

132 
	`mu…i_öô
(
mu…i
);

134 
i
 = 1; i <
cou¡
; i++) {

135 
èrgë_uæ
[256];

136 
	`¢¥ötf
(
èrgë_uæ
, —¨gë_uæ), "hâp://ã°£rvî.exam∂e.com:%s%s%04d", 
p‹t
, 
∑th
, 
i
);

139 if((
ªs
 = 
	`do_⁄e_ªque°
(
mu…i
, 
èrgë_uæ
, 
dns_íåy
)))

140 
ã°_˛ónup
;

142 if(
i
 < 
cou¡
)

143 
	`¶ìp
(
DNS_TIMEOUT
 + 1);

146 
ã°_˛ónup
:

148 
	`cuæ_mu…i_˛ónup
(
mu…i
);

150  (Ë
ªs
;

151 
	}
}

	@tests/libtest/lib1525.c

29 
	~"ã°.h
"

31 
	~"memdebug.h
"

33 
	gd©a
 [] = "Hello Cloud!\n";

35 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

37 
size_t
 
amou¡
 = 
nmemb
 * 
size
;

38 i‡(
amou¡
 < 
	`°æí
(
d©a
)) {

39  
	`°æí
(
d©a
);

41 ()
°ªam
;

42 
	`mem˝y
(
±r
, 
d©a
, 
	`°æí
(data));

43  
	`°æí
(
d©a
);

44 
	}
}

47 
	$ã°
(*
URL
)

49 
CURL
 *
cuæ
 = 
NULL
;

50 
CURLcode
 
ªs
 = 
CURLE_FAILED_INIT
;

52 
cuæ_¶i°
 *
hhl
 = 
NULL
;

54 if(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

55 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

56  
TEST_ERR_MAJOR_BAD
;

59 if((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

60 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

61 
	`cuæ_globÆ_˛ónup
();

62  
TEST_ERR_MAJOR_BAD
;

65 
hhl
 = 
	`cuæ_¶i°_≠≥nd
(hhl, "User-Agent: Http Agent");

67 i‡(!
hhl
) {

68 
ã°_˛ónup
;

71 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

72 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

73 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
hhl
);

74 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYHEADER
, 
hhl
);

75 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADEROPT
, 
CURLHEADER_UNIFIED
);

76 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 0L);

77 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

78 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

79 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYTYPE
, 
CURLPROXY_HTTP
);

80 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

81 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
fwrôe
);

82 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

83 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPPROXYTUNNEL
, 1L);

84 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE
, 
	`°æí
(
d©a
));

86 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

88 
ã°_˛ónup
:

90 
	`cuæ_ósy_˛ónup
(
cuæ
);

92 
	`cuæ_¶i°_‰ì_Æl
(
hhl
);

94 
	`cuæ_globÆ_˛ónup
();

96  ()
ªs
;

97 
	}
}

	@tests/libtest/lib1526.c

28 
	~"ã°.h
"

30 
	~"memdebug.h
"

32 
	gd©a
 [] = "Hello Cloud!\n";

34 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

36 
size_t
 
amou¡
 = 
nmemb
 * 
size
;

37 i‡(
amou¡
 < 
	`°æí
(
d©a
)) {

38  
	`°æí
(
d©a
);

40 ()
°ªam
;

41 
	`mem˝y
(
±r
, 
d©a
, 
	`°æí
(data));

42  
	`°æí
(
d©a
);

43 
	}
}

45 
	$ã°
(*
URL
)

47 
CURL
 *
cuæ
 = 
NULL
;

48 
CURLcode
 
ªs
 = 
CURLE_FAILED_INIT
;

50 
cuæ_¶i°
 *
hhl
 = 
NULL
, *
phl
 = NULL, *
tmp
 = NULL;

52 if(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

53 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

54  
TEST_ERR_MAJOR_BAD
;

57 if((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

58 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

59 
	`cuæ_globÆ_˛ónup
();

60  
TEST_ERR_MAJOR_BAD
;

63 
hhl
 = 
	`cuæ_¶i°_≠≥nd
(hhl, "User-Agent: Http Agent");

64 
phl
 = 
	`cuæ_¶i°_≠≥nd
(phl, "User-Agent: Proxy Agent");

65 i‡(!
hhl
 || !
phl
) {

66 
ã°_˛ónup
;

68 
tmp
 = 
	`cuæ_¶i°_≠≥nd
(
phl
, "Expect:");

69 i‡(!
tmp
) {

70 
ã°_˛ónup
;

72 
phl
 = 
tmp
;

74 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

75 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

76 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
hhl
);

77 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYHEADER
, 
phl
);

78 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADEROPT
, 
CURLHEADER_SEPARATE
);

79 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 0L);

80 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

81 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

82 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYTYPE
, 
CURLPROXY_HTTP
);

83 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

84 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
fwrôe
);

85 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

86 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPPROXYTUNNEL
, 1L);

87 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE
, 
	`°æí
(
d©a
));

89 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

91 
ã°_˛ónup
:

93 
	`cuæ_ósy_˛ónup
(
cuæ
);

95 
	`cuæ_¶i°_‰ì_Æl
(
hhl
);

97 
	`cuæ_¶i°_‰ì_Æl
(
phl
);

99 
	`cuæ_globÆ_˛ónup
();

101  ()
ªs
;

102 
	}
}

	@tests/libtest/lib1527.c

28 
	~"ã°.h
"

30 
	~"memdebug.h
"

32 
	gd©a
 [] = "Hello Cloud!\n";

34 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

36 
size_t
 
amou¡
 = 
nmemb
 * 
size
;

37 i‡(
amou¡
 < 
	`°æí
(
d©a
)) {

38  
	`°æí
(
d©a
);

40 ()
°ªam
;

41 
	`mem˝y
(
±r
, 
d©a
, 
	`°æí
(data));

42  
	`°æí
(
d©a
);

43 
	}
}

46 
	$ã°
(*
URL
)

48 
CURL
 *
cuæ
 = 
NULL
;

49 
CURLcode
 
ªs
 = 
CURLE_FAILED_INIT
;

51 
cuæ_¶i°
 *
hhl
 = 
NULL
, *
tmp
 = NULL;

53 if(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

54 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

55  
TEST_ERR_MAJOR_BAD
;

58 if((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

59 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

60 
	`cuæ_globÆ_˛ónup
();

61  
TEST_ERR_MAJOR_BAD
;

64 
hhl
 = 
	`cuæ_¶i°_≠≥nd
(hhl, "User-Agent: Http Agent");

65 i‡(!
hhl
) {

66 
ã°_˛ónup
;

68 
tmp
 = 
	`cuæ_¶i°_≠≥nd
(
hhl
, "Expect: 100-continue");

69 i‡(!
tmp
) {

70 
ã°_˛ónup
;

72 
hhl
 = 
tmp
;

74 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

75 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

76 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
hhl
);

77 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 0L);

78 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

79 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

80 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYTYPE
, 
CURLPROXY_HTTP
);

81 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

82 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
fwrôe
);

83 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

84 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPPROXYTUNNEL
, 1L);

85 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE
, 
	`°æí
(
d©a
));

87 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

89 
ã°_˛ónup
:

91 
	`cuæ_ósy_˛ónup
(
cuæ
);

93 
	`cuæ_¶i°_‰ì_Æl
(
hhl
);

95 
	`cuæ_globÆ_˛ónup
();

97  ()
ªs
;

98 
	}
}

	@tests/libtest/lib1528.c

23 
	~"ã°.h
"

25 
	~"memdebug.h
"

27 
	$ã°
(*
URL
)

29 
CURL
 *
cuæ
 = 
NULL
;

30 
CURLcode
 
ªs
 = 
CURLE_FAILED_INIT
;

32 
cuæ_¶i°
 *
hhl
 = 
NULL
;

33 
cuæ_¶i°
 *
phl
 = 
NULL
;

35 if(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

36 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

37  
TEST_ERR_MAJOR_BAD
;

40 if((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

41 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

42 
	`cuæ_globÆ_˛ónup
();

43  
TEST_ERR_MAJOR_BAD
;

46 
hhl
 = 
	`cuæ_¶i°_≠≥nd
(hhl, "User-Agent: Http Agent");

47 
phl
 = 
	`cuæ_¶i°_≠≥nd
(phl, "Proxy-User-Agent: Http Agent2");

49 i‡(!
hhl
) {

50 
ã°_˛ónup
;

53 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

54 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

55 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
hhl
);

56 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYHEADER
, 
phl
);

57 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADEROPT
, 
CURLHEADER_SEPARATE
);

58 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

59 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYTYPE
, 
CURLPROXY_HTTP
);

60 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

62 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

64 
ã°_˛ónup
:

66 
	`cuæ_ósy_˛ónup
(
cuæ
);

67 
	`cuæ_¶i°_‰ì_Æl
(
hhl
);

68 
	`cuæ_¶i°_‰ì_Æl
(
phl
);

69 
	`cuæ_globÆ_˛ónup
();

71  ()
ªs
;

72 
	}
}

	@tests/libtest/lib1900.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

29 
	#MAX_URLS
 200

	)

30 
	#MAX_BLACKLIST
 20

	)

32 
	guætime
[
MAX_URLS
];

33 *
	guæ°rög
[
MAX_URLS
];

34 
CURL
 *
	gh™dÀs
[
MAX_URLS
];

35 *
	gsôe_bœckli°
[
MAX_BLACKLIST
];

36 *
	g£rvî_bœckli°
[
MAX_BLACKLIST
];

37 
	gnum_h™dÀs
;

38 
	gbœckli°_num_£rvîs
;

39 
	gbœckli°_num_sôes
;

41 
size_t


42 
	$wrôe_ˇŒback
(*
c⁄ã¡s
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

44 
size_t
 
ªÆsize
 = 
size
 * 
nmemb
;

45 ()
c⁄ã¡s
;

46 ()
u£Ω
;

48  
ªÆsize
;

49 
	}
}

51 
	$∑r£_uæ_fûe
(c⁄° *
fûíame
)

53 
FILE
 *
f
;

54 
fûëime
;

55 
buf
[200];

57 
num_h™dÀs
 = 0;

58 
bœckli°_num_sôes
 = 0;

59 
bœckli°_num_£rvîs
 = 0;

61 
f
 = 
	`f›í
(
fûíame
, "rb");

62 if(!
f
)

65 !
	`„of
(
f
)) {

66 if(
	`fsˇnf
(
f
, "%d %s\n", &
fûëime
, 
buf
)) {

67 
uætime
[
num_h™dÀs
] = 
fûëime
;

68 
uæ°rög
[
num_h™dÀs
] = 
	`°rdup
(
buf
);

69 
num_h™dÀs
++;

73 if(
	`fsˇnf
(
f
, "bœckli°_sôê%s\n", 
buf
)) {

74 
sôe_bœckli°
[
bœckli°_num_sôes
] = 
	`°rdup
(
buf
);

75 
bœckli°_num_sôes
++;

81 
	`f˛o£
(
f
);

83 
sôe_bœckli°
[
bœckli°_num_sôes
] = 
NULL
;

84 
£rvî_bœckli°
[
bœckli°_num_£rvîs
] = 
NULL
;

85  
num_h™dÀs
;

86 
	}
}

88 
	$‰ì_uæs
()

90 
i
;

91 
i
 = 0;ò< 
num_h™dÀs
;i++) {

92 
	`Cuæ_ß„‰ì
(
uæ°rög
[
i
]);

94 
i
 = 0;ò< 
bœckli°_num_£rvîs
;i++) {

95 
	`Cuæ_ß„‰ì
(
£rvî_bœckli°
[
i
]);

97 
i
 = 0;ò< 
bœckli°_num_sôes
;i++) {

98 
	`Cuæ_ß„‰ì
(
sôe_bœckli°
[
i
]);

100 
	}
}

102 
	$¸óã_h™dÀs
()

104 
i
;

106 
i
 = 0;ò< 
num_h™dÀs
;i++) {

107 
h™dÀs
[
i
] = 
	`cuæ_ósy_öô
();

110 
	}
}

112 
	$£tup_h™dÀ
(*
ba£_uæ
, 
CURLM
 *
m
, 
h™dÀnum
)

114 
uæbuf
[256];

116 
	`•rötf
(
uæbuf
, "%s%s", 
ba£_uæ
, 
uæ°rög
[
h™dÀnum
]);

117 
	`cuæ_ósy_£t›t
(
h™dÀs
[
h™dÀnum
], 
CURLOPT_URL
, 
uæbuf
);

118 
	`cuæ_ósy_£t›t
(
h™dÀs
[
h™dÀnum
], 
CURLOPT_VERBOSE
, 1L);

119 
	`cuæ_ósy_£t›t
(
h™dÀs
[
h™dÀnum
], 
CURLOPT_FAILONERROR
, 1L);

120 
	`cuæ_ósy_£t›t
(
h™dÀs
[
h™dÀnum
], 
CURLOPT_WRITEFUNCTION
, 
wrôe_ˇŒback
);

121 
	`cuæ_ósy_£t›t
(
h™dÀs
[
h™dÀnum
], 
CURLOPT_WRITEDATA
, 
NULL
);

122 
	`cuæ_mu…i_add_h™dÀ
(
m
, 
h™dÀs
[
h™dÀnum
]);

123 
	}
}

125 
	$ªmove_h™dÀs
()

127 
i
;

129 
i
 = 0;ò< 
num_h™dÀs
;i++) {

130 if(
h™dÀs
[
i
])

131 
	`cuæ_ósy_˛ónup
(
h™dÀs
[
i
]);

133 
	}
}

135 
	$ã°
(*
URL
)

137 
ªs
 = 0;

138 
CURLM
 *
m
 = 
NULL
;

139 
CURLMsg
 *
msg
;

140 
msgs_À·
;

141 
ru¬ög
;

142 
h™dÀnum
 = 0;

143 
timevÆ
 
œ°_h™dÀ_add
;

145 if(
	`∑r£_uæ_fûe
("log/urls.txt") <= 0)

146 
ã°_˛ónup
;

148 
	`°¨t_ã°_timög
();

150 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

152 
	`mu…i_öô
(
m
);

154 
	`¸óã_h™dÀs
();

156 
	`mu…i_£t›t
(
m
, 
CURLMOPT_PIPELINING
, 1L);

157 
	`mu…i_£t›t
(
m
, 
CURLMOPT_MAX_HOST_CONNECTIONS
, 2L);

158 
	`mu…i_£t›t
(
m
, 
CURLMOPT_MAX_PIPELINE_LENGTH
, 3L);

159 
	`mu…i_£t›t
(
m
, 
CURLMOPT_CONTENT_LENGTH_PENALTY_SIZE
, 15000L);

160 
	`mu…i_£t›t
(
m
, 
CURLMOPT_CHUNK_LENGTH_PENALTY_SIZE
, 10000L);

162 
	`mu…i_£t›t
(
m
, 
CURLMOPT_PIPELINING_SITE_BL
, 
sôe_bœckli°
);

163 
	`mu…i_£t›t
(
m
, 
CURLMOPT_PIPELINING_SERVER_BL
, 
£rvî_bœckli°
);

165 
œ°_h™dÀ_add
 = 
	`tutû_tvnow
();

168 
timevÆ
 
öãrvÆ
;

169 
timevÆ
 
now
;

170 
m¢ow
, 
m¶a°
;

171 
fd_£t
 
rd
, 
wr
, 
exc
;

172 
maxfd
 = -99;

173 
timeout
;

175 
öãrvÆ
.
tv_£c
 = 1;

176 
öãrvÆ
.
tv_u£c
 = 0;

178 if(
h™dÀnum
 < 
num_h™dÀs
) {

179 
now
 = 
	`tutû_tvnow
();

180 
m¢ow
 = 
now
.
tv_£c
 * 1000 +Çow.
tv_u£c
 / 1000;

181 
m¶a°
 = 
œ°_h™dÀ_add
.
tv_£c
 * 1000 +Üa°_h™dÀ_add.
tv_u£c
 / 1000;

182 if(
m¢ow
 - 
m¶a°
 >
uætime
[
h™dÀnum
] && h™dÀnum < 
num_h™dÀs
) {

183 
	`Ârötf
(
°dout
, "Addög h™dÀ %d\n", 
h™dÀnum
);

184 
	`£tup_h™dÀ
(
URL
, 
m
, 
h™dÀnum
);

185 
œ°_h™dÀ_add
 = 
now
;

186 
h™dÀnum
++;

190 
	`cuæ_mu…i_≥rf‹m
(
m
, &
ru¬ög
);

192 
	`ab‹t_⁄_ã°_timeout
();

195 (
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
m
, &
msgs_À·
))) {

196 i‡(
msg
->msg =
CURLMSG_DONE
) {

197 
i
, 
found
 = 0;

200 
i
 = 0; i < 
num_h™dÀs
; i++) {

201 
found
 = (
msg
->
ósy_h™dÀ
 =
h™dÀs
[
i
]);

202 if(
found
)

206 
	`¥ötf
("H™dÀ %d Com∂ëed wôh sètu†%d\n", 
i
, 
msg
->
d©a
.
ªsu…
);

207 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
h™dÀs
[
i
]);

211 if(
h™dÀnum
 =
num_h™dÀs
 && !
ru¬ög
) {

215 
	`FD_ZERO
(&
rd
);

216 
	`FD_ZERO
(&
wr
);

217 
	`FD_ZERO
(&
exc
);

219 
	`cuæ_mu…i_fd£t
(
m
, &
rd
, &
wr
, &
exc
, &
maxfd
);

223 
	`cuæ_mu…i_timeout
(
m
, &
timeout
);

225 if(
timeout
 < 0)

226 
timeout
 = 1;

228 
öãrvÆ
.
tv_£c
 = 
timeout
 / 1000;

229 
öãrvÆ
.
tv_u£c
 = (
timeout
 % 1000) * 1000;

231 
öãrvÆ
.
tv_£c
 = 0;

232 
öãrvÆ
.
tv_u£c
 = 1000;

234 
	`£À˘_ã°
(
maxfd
+1, &
rd
, &
wr
, &
exc
, &
öãrvÆ
);

236 
	`ab‹t_⁄_ã°_timeout
();

239 
ã°_˛ónup
:

241 
	`ªmove_h™dÀs
();

245 
	`cuæ_mu…i_˛ónup
(
m
);

246 
	`cuæ_globÆ_˛ónup
();

248 
	`‰ì_uæs
();

249  
ªs
;

250 
	}
}

	@tests/libtest/lib500.c

22 
	~"ã°.h
"

24 
	~"ã°åa˚.h
"

25 
	~"memdebug.h
"

27 #ifde‡
LIB585


29 
	gcou¡î
;

31 
cuæ_sockë_t
 
	$t°_›ísockë
(*
˛õ¡p
,

32 
cuæsockty≥
 
puΩo£
,

33 
cuæ_sockaddr
 *
addr
)

35 ()
˛õ¡p
;

36 ()
puΩo£
;

37 
	`¥ötf
("[OPEN] cou¡î: %d\n", ++
cou¡î
);

38  
	`sockë
(
addr
->
Ámûy
,áddr->
sockty≥
,áddr->
¥Ÿocﬁ
);

39 
	}
}

41 
	$t°_˛o£sockë
(*
˛õ¡p
, 
cuæ_sockë_t
 
sock
)

43 ()
˛õ¡p
;

44 
	`¥ötf
("[CLOSE] cou¡î: %d\n", 
cou¡î
--);

45  
	`s˛o£
(
sock
);

46 
	}
}

48 
	$£tupˇŒbacks
(
CURL
 *
cuæ
)

50 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_OPENSOCKETFUNCTION
, 
t°_›ísockë
);

51 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_CLOSESOCKETFUNCTION
, 
t°_˛o£sockë
);

52 
cou¡î
 = 0;

53 
	}
}

56 
	#£tupˇŒbacks
(
x
Ë
Cuæ_n›_°mt


	)

60 
	$ã°
(*
URL
)

62 
CURLcode
 
ªs
;

63 
CURL
 *
cuæ
;

64 *
ù°r
=
NULL
;

66 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

67 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

68  
TEST_ERR_MAJOR_BAD
;

71 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

72 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

73 
	`cuæ_globÆ_˛ónup
();

74  
TEST_ERR_MAJOR_BAD
;

77 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

78 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

80 
libã°_debug_c⁄fig
.
nohex
 = 1;

81 
libã°_debug_c⁄fig
.
åa˚time
 = 1;

82 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_DEBUGDATA
, &
libã°_debug_c⁄fig
);

83 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_DEBUGFUNCTION
, 
libã°_debug_cb
);

84 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

86 if(
libã°_¨g3
 && !
	`°rcmp
(libtest_arg3, "activeftp"))

87 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_FTPPORT
, "-");

89 
	`£tupˇŒbacks
(
cuæ
);

91 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

93 if(!
ªs
) {

94 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_PRIMARY_IP
, &
ù°r
);

95 i‡(
libã°_¨g2
) {

96 
FILE
 *
moo
 = 
	`f›í
(
libã°_¨g2
, "wb");

97 if(
moo
) {

98 
time_«mñookup
;

99 
time_c⁄√˘
;

100 
time_¥ëøns„r
;

101 
time_°¨âøns„r
;

102 
time_tŸÆ
;

103 
	`Ârötf
(
moo
, "IP: %s\n", 
ù°r
);

104 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_NAMELOOKUP_TIME
, &
time_«mñookup
);

105 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_CONNECT_TIME
, &
time_c⁄√˘
);

106 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_PRETRANSFER_TIME
, &
time_¥ëøns„r
);

107 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_STARTTRANSFER_TIME
,

108 &
time_°¨âøns„r
);

109 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_TOTAL_TIME
, &
time_tŸÆ
);

113 if(
time_«mñookup
 > 
time_c⁄√˘
) {

114 
	`Ârötf
(
moo
, "namelookup vs connect: %f %f\n",

115 
time_«mñookup
, 
time_c⁄√˘
);

117 if(
time_c⁄√˘
 > 
time_¥ëøns„r
) {

118 
	`Ârötf
(
moo
, "connect vsÖretransfer: %f %f\n",

119 
time_c⁄√˘
, 
time_¥ëøns„r
);

121 if(
time_¥ëøns„r
 > 
time_°¨âøns„r
) {

122 
	`Ârötf
(
moo
, "pretransfer vs starttransfer: %f %f\n",

123 
time_¥ëøns„r
, 
time_°¨âøns„r
);

125 if(
time_°¨âøns„r
 > 
time_tŸÆ
) {

126 
	`Ârötf
(
moo
, "starttransfer vsÅotal: %f %f\n",

127 
time_°¨âøns„r
, 
time_tŸÆ
);

130 
	`f˛o£
(
moo
);

135 
ã°_˛ónup
:

137 
	`cuæ_ósy_˛ónup
(
cuæ
);

138 
	`cuæ_globÆ_˛ónup
();

140  ()
ªs
;

141 
	}
}

	@tests/libtest/lib501.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURLcode
 
ªs
;

29 
CURL
 *
cuæ
;

31 ()
URL
;

33 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

34 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

35  
TEST_ERR_MAJOR_BAD
;

38 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

39 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

40 
	`cuæ_globÆ_˛ónup
();

41  
TEST_ERR_MAJOR_BAD
;

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

46 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

48 
ã°_˛ónup
:

50 
	`cuæ_ósy_˛ónup
(
cuæ
);

51 
	`cuæ_globÆ_˛ónup
();

53  ()
ªs
;

54 
	}
}

	@tests/libtest/lib502.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

34 
	$ã°
(*
URL
)

36 
CURL
 *
c
 = 
NULL
;

37 
CURLM
 *
m
 = 
NULL
;

38 
ªs
 = 0;

39 
ru¬ög
;

41 
	`°¨t_ã°_timög
();

43 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

45 
	`ósy_öô
(
c
);

47 
	`ósy_£t›t
(
c
, 
CURLOPT_URL
, 
URL
);

49 
	`mu…i_öô
(
m
);

51 
	`mu…i_add_h™dÀ
(
m
, 
c
);

54 
timevÆ
 
timeout
;

55 
fd_£t
 
fdªad
, 
fdwrôe
, 
fdex˚p
;

56 
maxfd
 = -99;

58 
timeout
.
tv_£c
 = 0;

59 
timeout
.
tv_u£c
 = 100000L;

61 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

63 
	`ab‹t_⁄_ã°_timeout
();

65 if(!
ru¬ög
)

68 
	`FD_ZERO
(&
fdªad
);

69 
	`FD_ZERO
(&
fdwrôe
);

70 
	`FD_ZERO
(&
fdex˚p
);

72 
	`mu…i_fd£t
(
m
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

76 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

78 
	`ab‹t_⁄_ã°_timeout
();

81 
ã°_˛ónup
:

85 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
c
);

86 
	`cuæ_mu…i_˛ónup
(
m
);

87 
	`cuæ_ósy_˛ónup
(
c
);

88 
	`cuæ_globÆ_˛ónup
();

90  
ªs
;

91 
	}
}

	@tests/libtest/lib503.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

38 
	$ã°
(*
URL
)

40 
CURL
 *
c
 = 
NULL
;

41 
CURLM
 *
m
 = 
NULL
;

42 
ªs
 = 0;

43 
ru¬ög
;

45 
	`°¨t_ã°_timög
();

47 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

49 
	`ósy_öô
(
c
);

51 
	`ósy_£t›t
(
c
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

52 
	`ósy_£t›t
(
c
, 
CURLOPT_URL
, 
URL
);

53 
	`ósy_£t›t
(
c
, 
CURLOPT_USERPWD
, "test:ing");

54 
	`ósy_£t›t
(
c
, 
CURLOPT_PROXYUSERPWD
, "test:ing");

55 
	`ósy_£t›t
(
c
, 
CURLOPT_HTTPPROXYTUNNEL
, 1L);

56 
	`ósy_£t›t
(
c
, 
CURLOPT_HEADER
, 1L);

57 
	`ósy_£t›t
(
c
, 
CURLOPT_VERBOSE
, 1L);

59 
	`mu…i_öô
(
m
);

61 
	`mu…i_add_h™dÀ
(
m
, 
c
);

64 
timevÆ
 
öãrvÆ
;

65 
fd_£t
 
rd
, 
wr
, 
exc
;

66 
maxfd
 = -99;

68 
öãrvÆ
.
tv_£c
 = 1;

69 
öãrvÆ
.
tv_u£c
 = 0;

71 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

73 
	`ab‹t_⁄_ã°_timeout
();

75 if(!
ru¬ög
)

78 
	`FD_ZERO
(&
rd
);

79 
	`FD_ZERO
(&
wr
);

80 
	`FD_ZERO
(&
exc
);

82 
	`mu…i_fd£t
(
m
, &
rd
, &
wr
, &
exc
, &
maxfd
);

86 
	`£À˘_ã°
(
maxfd
+1, &
rd
, &
wr
, &
exc
, &
öãrvÆ
);

88 
	`ab‹t_⁄_ã°_timeout
();

91 
ã°_˛ónup
:

95 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
c
);

96 
	`cuæ_mu…i_˛ónup
(
m
);

97 
	`cuæ_ósy_˛ónup
(
c
);

98 
	`cuæ_globÆ_˛ónup
();

100  
ªs
;

101 
	}
}

	@tests/libtest/lib504.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

37 
	$ã°
(*
URL
)

39 
CURL
 *
c
 = 
NULL
;

40 
ªs
 = 0;

41 
CURLM
 *
m
 = 
NULL
;

42 
fd_£t
 
rd
, 
wr
, 
exc
;

43 
ru¬ög
;

45 
	`°¨t_ã°_timög
();

47 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

49 
	`ósy_öô
(
c
);

53 i‡(
libã°_¨g2
)

54 
	`ósy_£t›t
(
c
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

55 
	`ósy_£t›t
(
c
, 
CURLOPT_URL
, 
URL
);

56 
	`ósy_£t›t
(
c
, 
CURLOPT_VERBOSE
, 1L);

58 
	`mu…i_öô
(
m
);

60 
	`mu…i_add_h™dÀ
(
m
, 
c
);

63 
timevÆ
 
öãrvÆ
;

64 
maxfd
 = -99;

66 
öãrvÆ
.
tv_£c
 = 1;

67 
öãrvÆ
.
tv_u£c
 = 0;

69 
	`Ârötf
(
°dîr
, "curl_multi_perform()\n");

71 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

73 
	`ab‹t_⁄_ã°_timeout
();

75 if(!
ru¬ög
) {

77 
numÀ·
;

78 
CURLMsg
 *
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
m
, &
numÀ·
);

79 
	`Ârötf
(
°dîr
, "Expected:ÇotÑunning\n");

80 if(
msg
 && !
numÀ·
)

81 
ªs
 = 
TEST_ERR_SUCCESS
;

83 
ªs
 = 
TEST_ERR_FAILURE
;

86 
	`Ârötf
(
°dîr
, "ru¬ög =%d\n", 
ru¬ög
);

88 
	`FD_ZERO
(&
rd
);

89 
	`FD_ZERO
(&
wr
);

90 
	`FD_ZERO
(&
exc
);

92 
	`Ârötf
(
°dîr
, "curl_multi_fdset()\n");

94 
	`mu…i_fd£t
(
m
, &
rd
, &
wr
, &
exc
, &
maxfd
);

98 
	`£À˘_ã°
(
maxfd
+1, &
rd
, &
wr
, &
exc
, &
öãrvÆ
);

100 
	`ab‹t_⁄_ã°_timeout
();

103 
ã°_˛ónup
:

107 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
c
);

108 
	`cuæ_mu…i_˛ónup
(
m
);

109 
	`cuæ_ósy_˛ónup
(
c
);

110 
	`cuæ_globÆ_˛ónup
();

112  
ªs
;

113 
	}
}

	@tests/libtest/lib505.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_FCNTL_H


25 
	~<f˙é.h
>

28 
	~"memdebug.h
"

37 
	$ã°
(*
URL
)

39 
CURL
 *
cuæ
;

40 
CURLcode
 
ªs
 = 
CURLE_OK
;

41 
FILE
 *
hd_§c
 ;

42 
hd
 ;

43 
°ru˘_°©
 
fûe_öfo
;

44 
cuæ_¶i°
 *
hl
;

45 
îr‹
;

47 
cuæ_¶i°
 *
hódîli°
=
NULL
;

48 c⁄° *
buf_1
 = "RNFR 505";

49 c⁄° *
buf_2
 = "RNTO 505-forreal";

51 i‡(!
libã°_¨g2
) {

52 
	`Ârötf
(
°dîr
, "Usage: <url> <file-to-upload>\n");

53  
TEST_ERR_USAGE
;

56 
hd_§c
 = 
	`f›í
(
libã°_¨g2
, "rb");

57 if(
NULL
 =
hd_§c
) {

58 
îr‹
 = 
ERRNO
;

59 
	`Ârötf
(
°dîr
, "fopen() failed withÉrror: %d %s\n",

60 
îr‹
, 
	`°ªº‹
(error));

61 
	`Ârötf
(
°dîr
, "Eº‹ o≥nög fûe: %s\n", 
libã°_¨g2
);

62  
TEST_ERR_MAJOR_BAD
;

66 
hd
 = 
	`f°©
(
	`fûío
(
hd_§c
), &
fûe_öfo
);

67 if(
hd
 == -1) {

69 
îr‹
 = 
ERRNO
;

70 
	`Ârötf
(
°dîr
, "fstat() failed withÉrror: %d %s\n",

71 
îr‹
, 
	`°ªº‹
(error));

72 
	`Ârötf
(
°dîr
, "ERROR: c™nŸ o≥¿fûê%s\n", 
libã°_¨g2
);

73 
	`f˛o£
(
hd_§c
);

74  
TEST_ERR_MAJOR_BAD
;

77 if(! 
fûe_öfo
.
°_size
) {

78 
	`Ârötf
(
°dîr
, "ERROR: fûê%†ha†zîÿsize!\n", 
libã°_¨g2
);

79 
	`f˛o£
(
hd_§c
);

80  
TEST_ERR_MAJOR_BAD
;

83 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

84 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

85 
	`f˛o£
(
hd_§c
);

86  
TEST_ERR_MAJOR_BAD
;

90 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

91 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

92 
	`cuæ_globÆ_˛ónup
();

93 
	`f˛o£
(
hd_§c
);

94  
TEST_ERR_MAJOR_BAD
;

99 i‡((
hl
 = 
	`cuæ_¶i°_≠≥nd
(
hódîli°
, 
buf_1
)Ë=
NULL
) {

100 
	`Ârötf
(
°dîr
, "curl_slist_append() failed\n");

101 
	`cuæ_ósy_˛ónup
(
cuæ
);

102 
	`cuæ_globÆ_˛ónup
();

103 
	`f˛o£
(
hd_§c
);

104  
TEST_ERR_MAJOR_BAD
;

106 i‡((
hódîli°
 = 
	`cuæ_¶i°_≠≥nd
(
hl
, 
buf_2
)Ë=
NULL
) {

107 
	`Ârötf
(
°dîr
, "curl_slist_append() failed\n");

108 
	`cuæ_¶i°_‰ì_Æl
(
hl
);

109 
	`cuæ_ósy_˛ónup
(
cuæ
);

110 
	`cuæ_globÆ_˛ónup
();

111 
	`f˛o£
(
hd_§c
);

112  
TEST_ERR_MAJOR_BAD
;

114 
hódîli°
 = 
hl
;

117 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

120 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

123 
	`ã°_£t›t
(
cuæ
,
CURLOPT_URL
, 
URL
);

126 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTQUOTE
, 
hódîli°
);

129 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READDATA
, 
hd_§c
);

132 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE_LARGE
,

133 (
cuæ_off_t
)
fûe_öfo
.
°_size
);

136 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

138 
ã°_˛ónup
:

141 
	`cuæ_¶i°_‰ì_Æl
(
hódîli°
);

144 
	`f˛o£
(
hd_§c
);

146 
	`cuæ_ósy_˛ónup
(
cuæ
);

147 
	`cuæ_globÆ_˛ónup
();

149  
ªs
;

150 
	}
}

	@tests/libtest/lib506.c

22 
	~"ã°.h
"

24 
	~<cuæ/m¥ötf.h
>

26 
	~"memdebug.h
"

28 c⁄° *
	gHOSTHEADER
 = "Host: www.host.foo.com";

29 c⁄° *
	gJAR
 = "log/jar506";

30 
	#THREADS
 2

	)

33 
	sTd©a
 {

34 
CURLSH
 *
	msh¨e
;

35 *
	muæ
;

38 
	su£rd©a
 {

39 *
	mãxt
;

40 
	mcou¡î
;

43 
	glock
[3];

46 
	$my_lock
(
CURL
 *
h™dÀ
, 
cuæ_lock_d©a
 
d©a
, 
cuæ_lock_ac˚ss
 
œc˚ss
,

47 *
u£±r
 )

49 c⁄° *
wh©
;

50 
u£rd©a
 *
u£r
 = (u£rd©®*)
u£±r
;

51 
locknum
;

53 ()
h™dÀ
;

54 ()
œc˚ss
;

56  
d©a
 ) {

57 
CURL_LOCK_DATA_SHARE
:

58 
wh©
 = "share";

59 
locknum
 = 0;

61 
CURL_LOCK_DATA_DNS
:

62 
wh©
 = "dns";

63 
locknum
 = 1;

65 
CURL_LOCK_DATA_COOKIE
:

66 
wh©
 = "cookie";

67 
locknum
 = 2;

70 
	`Ârötf
(
°dîr
, "lock:Çÿsuch d©a: %d\n", ()
d©a
);

75 if(
lock
[
locknum
]) {

76 
	`¥ötf
("lock: doubÀÜocked %s\n", 
wh©
);

79 
lock
[
locknum
]++;

81 
	`¥ötf
("lock: %-6†[%s]: %d\n", 
wh©
, 
u£r
->
ãxt
, u£r->
cou¡î
);

82 
u£r
->
cou¡î
++;

83 
	}
}

86 
	$my_u∆ock
(
CURL
 *
h™dÀ
, 
cuæ_lock_d©a
 
d©a
, *
u£±r
 )

88 c⁄° *
wh©
;

89 
u£rd©a
 *
u£r
 = (u£rd©®*)
u£±r
;

90 
locknum
;

91 ()
h™dÀ
;

92  
d©a
 ) {

93 
CURL_LOCK_DATA_SHARE
:

94 
wh©
 = "share";

95 
locknum
 = 0;

97 
CURL_LOCK_DATA_DNS
:

98 
wh©
 = "dns";

99 
locknum
 = 1;

101 
CURL_LOCK_DATA_COOKIE
:

102 
wh©
 = "cookie";

103 
locknum
 = 2;

106 
	`Ârötf
(
°dîr
, "u∆ock:Çÿsuch d©a: %d\n", ()
d©a
);

111 if(!
lock
[
locknum
]) {

112 
	`¥ötf
("u∆ock: doubÀ u∆ocked %s\n", 
wh©
);

115 
lock
[
locknum
]--;

117 
	`¥ötf
("u∆ock: %-6†[%s]: %d\n", 
wh©
, 
u£r
->
ãxt
, u£r->
cou¡î
);

118 
u£r
->
cou¡î
++;

119 
	}
}

123 
cuæ_¶i°
 *
	$£tho°
(
cuæ_¶i°
 *
hódîs
)

125 ()
hódîs
;

126  
	`cuæ_¶i°_≠≥nd
(
NULL
, 
HOSTHEADER
 );

127 
	}
}

131 *
	$fúe
(*
±r
)

133 
CURLcode
 
code
;

134 
cuæ_¶i°
 *
hódîs
;

135 
Td©a
 *
td©a
 = (Td©a*)
±r
;

136 
CURL
 *
cuæ
;

137 
i
=0;

139 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

140 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

141  
NULL
;

144 
hódîs
 = 
	`£tho°
(
NULL
);

145 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

146 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
hódîs
);

147 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
td©a
->
uæ
);

148 
	`¥ötf
( "CURLOPT_SHARE\n" );

149 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SHARE
, 
td©a
->
sh¨e
);

151 
	`¥ötf
( "PERFORM\n" );

152 
code
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

153 if–
code
 !
CURLE_OK
 ) {

154 
	`Ârötf
(
°dîr
, "perform url '%s'Ñepeat %d failed, curlcode %d\n",

155 
td©a
->
uæ
, 
i
, ()
code
);

158 
	`¥ötf
( "CLEANUP\n" );

159 
	`cuæ_ósy_˛ónup
(
cuæ
);

160 
	`cuæ_¶i°_‰ì_Æl
(
hódîs
);

162  
NULL
;

163 
	}
}

167 *
	$subuæ
(c⁄° *
ba£
, 
i
)

169  
	`cuæ_m≠rötf
("%s%.4d", 
ba£
, 
i
);

170 
	}
}

174 
	$ã°
(*
URL
)

176 
ªs
;

177 
CURLSHcode
 
scode
 = 
CURLSHE_OK
;

178 *
uæ
 = 
NULL
;

179 
Td©a
 
td©a
;

180 
CURL
 *
cuæ
;

181 
CURLSH
 *
sh¨e
;

182 
cuæ_¶i°
 *
hódîs
 = 
NULL
;

183 
i
;

184 
u£rd©a
 
u£r
;

186 
u£r
.
ãxt
 = (*)"Pigs in space";

187 
u£r
.
cou¡î
 = 0;

189 
	`¥ötf
( "GLOBAL_INIT\n" );

190 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

191 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

192  
TEST_ERR_MAJOR_BAD
;

196 
	`¥ötf
( "SHARE_INIT\n" );

197 i‡((
sh¨e
 = 
	`cuæ_sh¨e_öô
()Ë=
NULL
) {

198 
	`Ârötf
(
°dîr
, "curl_share_init() failed\n");

199 
	`cuæ_globÆ_˛ónup
();

200  
TEST_ERR_MAJOR_BAD
;

203 i‡–
CURLSHE_OK
 =
scode
 ) {

204 
	`¥ötf
( "CURLSHOPT_LOCKFUNC\n" );

205 
scode
 = 
	`cuæ_sh¨e_£t›t
–
sh¨e
, 
CURLSHOPT_LOCKFUNC
, 
my_lock
);

207 i‡–
CURLSHE_OK
 =
scode
 ) {

208 
	`¥ötf
( "CURLSHOPT_UNLOCKFUNC\n" );

209 
scode
 = 
	`cuæ_sh¨e_£t›t
–
sh¨e
, 
CURLSHOPT_UNLOCKFUNC
, 
my_u∆ock
);

211 i‡–
CURLSHE_OK
 =
scode
 ) {

212 
	`¥ötf
( "CURLSHOPT_USERDATA\n" );

213 
scode
 = 
	`cuæ_sh¨e_£t›t
–
sh¨e
, 
CURLSHOPT_USERDATA
, &
u£r
);

215 i‡–
CURLSHE_OK
 =
scode
 ) {

216 
	`¥ötf
( "CURL_LOCK_DATA_COOKIE\n" );

217 
scode
 = 
	`cuæ_sh¨e_£t›t
–
sh¨e
, 
CURLSHOPT_SHARE
, 
CURL_LOCK_DATA_COOKIE
);

219 i‡–
CURLSHE_OK
 =
scode
 ) {

220 
	`¥ötf
( "CURL_LOCK_DATA_DNS\n" );

221 
scode
 = 
	`cuæ_sh¨e_£t›t
–
sh¨e
, 
CURLSHOPT_SHARE
, 
CURL_LOCK_DATA_DNS
);

224 i‡–
CURLSHE_OK
 !
scode
 ) {

225 
	`Ârötf
(
°dîr
, "curl_share_setopt() failed\n");

226 
	`cuæ_sh¨e_˛ónup
(
sh¨e
);

227 
	`cuæ_globÆ_˛ónup
();

228  
TEST_ERR_MAJOR_BAD
;

232 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

233 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

234 
	`cuæ_sh¨e_˛ónup
(
sh¨e
);

235 
	`cuæ_globÆ_˛ónup
();

236  
TEST_ERR_MAJOR_BAD
;

238 
	`¥ötf
( "CURLOPT_SHARE\n" );

239 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_SHARE
, 
sh¨e
 );

240 
	`¥ötf
( "CURLOPT_COOKIELIST injected_and_clobbered\n" );

241 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_COOKIELIST
,

244 
	`¥ötf
( "CURLOPT_COOKIELIST ALL\n" );

245 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_COOKIELIST
, "ALL" );

246 
	`¥ötf
( "CURLOPT_COOKIELIST session\n" );

247 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_COOKIELIST
, "Set-Cookie: session=elephants" );

248 
	`¥ötf
( "CURLOPT_COOKIELIST injected\n" );

249 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_COOKIELIST
,

252 
	`¥ötf
( "CURLOPT_COOKIELIST SESS\n" );

253 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_COOKIELIST
, "SESS" );

254 
	`¥ötf
( "CLEANUP\n" );

255 
	`cuæ_ósy_˛ónup
–
cuæ
 );

258 
ªs
 = 0;

261 
i
=1; i<=
THREADS
; i++ ) {

264 
td©a
.
uæ
 = 
	`subuæ
–
URL
, 
i
 );

265 
td©a
.
sh¨e
 = share;

268 
	`¥ötf
–"***Ñu¿%d\n",
i
 );

269 
	`fúe
–&
td©a
 );

271 
	`cuæ_‰ì
–
td©a
.
uæ
 );

277 
	`¥ötf
–"***Ñu¿%d\n", 
i
 );

278 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

279 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

280 
	`cuæ_sh¨e_˛ónup
(
sh¨e
);

281 
	`cuæ_globÆ_˛ónup
();

282  
TEST_ERR_MAJOR_BAD
;

285 
uæ
 = 
	`subuæ
–
URL
, 
i
 );

286 
hódîs
 = 
	`£tho°
–
NULL
 );

287 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_HTTPHEADER
, 
hódîs
 );

288 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_URL
, 
uæ
 );

289 
	`¥ötf
( "CURLOPT_SHARE\n" );

290 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_SHARE
, 
sh¨e
 );

291 
	`¥ötf
( "CURLOPT_COOKIEJAR\n" );

292 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_COOKIEJAR
, 
JAR
 );

293 
	`¥ötf
( "CURLOPT_COOKIELIST FLUSH\n" );

294 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_COOKIELIST
, "FLUSH" );

296 
	`¥ötf
( "PERFORM\n" );

297 
	`cuæ_ósy_≥rf‹m
–
cuæ
 );

300 
	`¥ötf
( "try SHARE_CLEANUP...\n" );

301 
scode
 = 
	`cuæ_sh¨e_˛ónup
–
sh¨e
 );

302 i‡–
scode
==
CURLSHE_OK
 )

304 
	`Ârötf
(
°dîr
, "curl_share_cleanup succeed butÉrrorÉxpected\n");

305 
sh¨e
 = 
NULL
;

307 
	`¥ötf
( "SHARE_CLEANUP failed, correct\n" );

310 
ã°_˛ónup
:

313 
	`¥ötf
( "CLEANUP\n" );

314 
	`cuæ_ósy_˛ónup
–
cuæ
 );

316 i‡–
hódîs
 )

317 
	`cuæ_¶i°_‰ì_Æl
–
hódîs
 );

319 i‡–
uæ
 )

320 
	`cuæ_‰ì
(
uæ
);

323 
	`¥ötf
( "SHARE_CLEANUP\n" );

324 
scode
 = 
	`cuæ_sh¨e_˛ónup
–
sh¨e
 );

325 i‡–
scode
!=
CURLSHE_OK
 )

326 
	`Ârötf
(
°dîr
, "curl_share_cleanup failed, codeÉrrno %d\n",

327 ()
scode
);

329 
	`¥ötf
( "GLOBAL_CLEANUP\n" );

330 
	`cuæ_globÆ_˛ónup
();

332  
ªs
;

333 
	}
}

	@tests/libtest/lib507.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

30 
	$ã°
(*
URL
)

32 
CURL
* 
cuæs
 = 
NULL
;

33 
CURLM
* 
mu…i
 = 
NULL
;

34 
°ûl_ru¬ög
;

35 
i
 = -1;

36 
ªs
 = 0;

37 
CURLMsg
 *
msg
;

39 
	`°¨t_ã°_timög
();

41 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

43 
	`mu…i_öô
(
mu…i
);

45 
	`ósy_öô
(
cuæs
);

47 
	`ósy_£t›t
(
cuæs
, 
CURLOPT_URL
, 
URL
);

48 
	`ósy_£t›t
(
cuæs
, 
CURLOPT_HEADER
, 1L);

50 
	`mu…i_add_h™dÀ
(
mu…i
, 
cuæs
);

52 
	`mu…i_≥rf‹m
(
mu…i
, &
°ûl_ru¬ög
);

54 
	`ab‹t_⁄_ã°_timeout
();

56 
°ûl_ru¬ög
) {

57 
timevÆ
 
timeout
;

58 
fd_£t
 
fdªad
;

59 
fd_£t
 
fdwrôe
;

60 
fd_£t
 
fdex˚p
;

61 
maxfd
 = -99;

63 
	`FD_ZERO
(&
fdªad
);

64 
	`FD_ZERO
(&
fdwrôe
);

65 
	`FD_ZERO
(&
fdex˚p
);

66 
timeout
.
tv_£c
 = 1;

67 
timeout
.
tv_u£c
 = 0;

69 
	`mu…i_fd£t
(
mu…i
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

73 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

75 
	`ab‹t_⁄_ã°_timeout
();

77 
	`mu…i_≥rf‹m
(
mu…i
, &
°ûl_ru¬ög
);

79 
	`ab‹t_⁄_ã°_timeout
();

82 
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
mu…i
, &
°ûl_ru¬ög
);

83 if(
msg
)

86 
i
 = 
msg
->
d©a
.
ªsu…
;

88 
ã°_˛ónup
:

92 
	`cuæ_mu…i_˛ónup
(
mu…i
);

93 
	`cuæ_ósy_˛ónup
(
cuæs
);

94 
	`cuæ_globÆ_˛ónup
();

96 if(
ªs
)

97 
i
 = 
ªs
;

99  
i
;

100 
	}
}

	@tests/libtest/lib508.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	gd©a
[]="this is what weÖostÅoÅhe silly web server\n";

28 
	sWrôeThis
 {

29 *
	mªad±r
;

30 
size_t
 
	msizñe·
;

33 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

35 
WrôeThis
 *
pooh
 = (WrôeThi†*)
u£Ω
;

37 if(
size
*
nmemb
 < 1)

40 if(
pooh
->
sizñe·
) {

41 *(*)
±r
 = 
pooh
->
ªad±r
[0];

42 
pooh
->
ªad±r
++;

43 
pooh
->
sizñe·
--;

48 
	}
}

50 
	$ã°
(*
URL
)

52 
CURL
 *
cuæ
;

53 
CURLcode
 
ªs
=
CURLE_OK
;

55 
WrôeThis
 
pooh
;

57 
pooh
.
ªad±r
 = 
d©a
;

58 
pooh
.
sizñe·
 = 
	`°æí
(
d©a
);

60 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

61 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

62  
TEST_ERR_MAJOR_BAD
;

65 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

66 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

67 
	`cuæ_globÆ_˛ónup
();

68  
TEST_ERR_MAJOR_BAD
;

72 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

75 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

77 #ifde‡
CURL_DOES_CONVERSIONS


79 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_TRANSFERTEXT
, 1L);

83 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, ()
pooh
.
sizñe·
);

86 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

89 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
pooh
);

92 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

95 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

98 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

100 
ã°_˛ónup
:

103 
	`cuæ_ósy_˛ónup
(
cuæ
);

104 
	`cuæ_globÆ_˛ónup
();

106  
ªs
;

107 
	}
}

	@tests/libtest/lib509.c

22 
	~"ã°.h
"

39 
	g£í_mÆloc
 = 0;

40 
	g£í_‰ì
 = 0;

41 
	g£í_ªÆloc
 = 0;

42 
	g£í_°rdup
 = 0;

43 
	g£í_ˇŒoc
 = 0;

45 *
cu°om_mÆloc
(
size_t
 
size
);

46 
cu°om_‰ì
(*
±r
);

47 *
cu°om_ªÆloc
(*
±r
, 
size_t
 
size
);

48 *
cu°om_°rdup
(c⁄° *
±r
);

49 *
cu°om_ˇŒoc
(
size_t
 
nmemb
, size_à
size
);

52 *
	$cu°om_ˇŒoc
(
size_t
 
nmemb
, size_à
size
)

54 if(!
£í_ˇŒoc
) {

55 
	`¥ötf
("seen custom_calloc()\n");

56 
£í_ˇŒoc
 = 1;

58  (
ˇŒoc
)(
nmemb
, 
size
);

59 
	}
}

61 *
	$cu°om_mÆloc
(
size_t
 
size
)

63 if(!
£í_mÆloc
 && 
£í_ˇŒoc
) {

64 
	`¥ötf
("seen custom_malloc()\n");

65 
£í_mÆloc
 = 1;

67  (
mÆloc
)(
size
);

68 
	}
}

70 *
	$cu°om_°rdup
(c⁄° *
±r
)

72 if(!
£í_°rdup
 && 
£í_mÆloc
) {

79 
£í_°rdup
 = 1;

81  (
°rdup
)(
±r
);

82 
	}
}

84 *
	$cu°om_ªÆloc
(*
±r
, 
size_t
 
size
)

86 if(!
£í_ªÆloc
 && 
£í_mÆloc
) {

87 
	`¥ötf
("seen custom_realloc()\n");

88 
£í_ªÆloc
 = 1;

90  (
ªÆloc
)(
±r
, 
size
);

91 
	}
}

93 
	$cu°om_‰ì
(*
±r
)

95 if(!
£í_‰ì
 && 
£í_ªÆloc
) {

96 
	`¥ötf
("seen custom_free()\n");

97 
£í_‰ì
 = 1;

99 (
‰ì
)(
±r
);

100 
	}
}

103 
	$ã°
(*
URL
)

105 
a
[] = {0x2f, 0x3a, 0x3b, 0x3c, 0x3d, 0x3e, 0x3f,

107 
CURLcode
 
ªs
;

108 
CURL
 *
cuæ
;

109 
asize
;

110 *
°r
 = 
NULL
;

112 ()
URL
;

114 
ªs
 = 
	`cuæ_globÆ_öô_mem
(
CURL_GLOBAL_ALL
,

115 
cu°om_mÆloc
,

116 
cu°om_‰ì
,

117 
cu°om_ªÆloc
,

118 
cu°om_°rdup
,

119 
cu°om_ˇŒoc
);

120 i‡(
ªs
 !
CURLE_OK
) {

121 
	`Ârötf
(
°dîr
, "curl_global_init_mem() failed\n");

122  
TEST_ERR_MAJOR_BAD
;

125 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

126 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

127 
	`cuæ_globÆ_˛ónup
();

128  
TEST_ERR_MAJOR_BAD
;

131 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_USERAGENT
, "test509");

133 
asize
 = ()(
a
);

134 
°r
 = 
	`cuæ_ósy_esˇ≥
(
cuæ
, (*)
a
, 
asize
);

136 
ã°_˛ónup
:

138 if(
°r
)

139 
	`cuæ_‰ì
(
°r
);

141 
	`cuæ_ósy_˛ónup
(
cuæ
);

142 
	`cuæ_globÆ_˛ónup
();

144  ()
ªs
;

145 
	}
}

	@tests/libtest/lib510.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 c⁄° *
	gpo°
[]={

31 
NULL


35 
	sWrôeThis
 {

36 
	mcou¡î
;

39 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

41 
WrôeThis
 *
pooh
 = (WrôeThi†*)
u£Ω
;

42 c⁄° *
d©a
;

44 if(
size
*
nmemb
 < 1)

47 
d©a
 = 
po°
[
pooh
->
cou¡î
];

49 if(
d©a
) {

50 
size_t
 
Àn
 = 
	`°æí
(
d©a
);

51 
	`mem˝y
(
±r
, 
d©a
, 
Àn
);

52 
pooh
->
cou¡î
++;

53  
Àn
;

56 
	}
}

58 
	$ã°
(*
URL
)

60 
CURL
 *
cuæ
;

61 
CURLcode
 
ªs
=
CURLE_OK
;

62 
cuæ_¶i°
 *
¶i°
 = 
NULL
;

63 
WrôeThis
 
pooh
;

64 
pooh
.
cou¡î
 = 0;

66 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

67 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

68  
TEST_ERR_MAJOR_BAD
;

71 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

72 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

73 
	`cuæ_globÆ_˛ónup
();

74  
TEST_ERR_MAJOR_BAD
;

77 
¶i°
 = 
	`cuæ_¶i°_≠≥nd
(slist, "Transfer-Encoding: chunked");

78 i‡(
¶i°
 =
NULL
) {

79 
	`Ârötf
(
°dîr
, "curl_slist_append() failed\n");

80 
	`cuæ_ósy_˛ónup
(
cuæ
);

81 
	`cuæ_globÆ_˛ónup
();

82  
TEST_ERR_MAJOR_BAD
;

86 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

89 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

91 #ifde‡
CURL_DOES_CONVERSIONS


93 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_TRANSFERTEXT
, 1L);

97 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

100 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
pooh
);

103 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

106 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

109 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
¶i°
);

111 #ifde‡
LIB565


112 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPAUTH
, ()
CURLAUTH_DIGEST
);

113 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_USERPWD
, "foo:bar");

117 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

119 
ã°_˛ónup
:

122 if(
¶i°
)

123 
	`cuæ_¶i°_‰ì_Æl
(
¶i°
);

126 
	`cuæ_ósy_˛ónup
(
cuæ
);

127 
	`cuæ_globÆ_˛ónup
();

129  
ªs
;

130 
	}
}

	@tests/libtest/lib511.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURLcode
 
ªs
;

29 
CURL
 *
cuæ
;

31 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

32 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

33  
TEST_ERR_MAJOR_BAD
;

36 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

37 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

38 
	`cuæ_globÆ_˛ónup
();

39  
TEST_ERR_MAJOR_BAD
;

42 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

43 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_FILETIME
, 1L);

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_NOBODY
, 1L);

45 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

47 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

49 
ã°_˛ónup
:

51 
	`cuæ_ósy_˛ónup
(
cuæ
);

52 
	`cuæ_globÆ_˛ónup
();

54  ()
ªs
;

55 
	}
}

	@tests/libtest/lib512.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

29 
	$ã°
(*
URL
)

31 
CURLcode
 
code
;

32 
CURL
 *
cuæ
;

33 
CURL
 *
cuæ2
;

34 
rc
 = 99;

36 
code
 = 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

37 if(
code
 =
CURLE_OK
) {

39 
cuæ
 = 
	`cuæ_ósy_öô
();

40 if(
cuæ
) {

42 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

43 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

45 
cuæ2
 = 
	`cuæ_ósy_duph™dÀ
(
cuæ
);

46 if(
cuæ2
) {

48 
code
 = 
	`cuæ_ósy_£t›t
(
cuæ2
, 
CURLOPT_URL
, 
URL
);

49 if(
code
 =
CURLE_OK
) {

51 
code
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ2
);

52 if(
code
 =
CURLE_OK
)

53 
rc
 = 0;

55 
rc
 = 1;

58 
rc
 = 2;

60 
	`cuæ_ósy_˛ónup
(
cuæ2
);

63 
rc
 = 3;

65 
	`cuæ_ósy_˛ónup
(
cuæ
);

68 
rc
 = 4;

70 
	`cuæ_globÆ_˛ónup
();

73 
rc
 = 5;

75  
rc
;

76 
	}
}

	@tests/libtest/lib513.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

28 ()
±r
;

29 ()
size
;

30 ()
nmemb
;

31 ()
u£Ω
;

32  
CURL_READFUNC_ABORT
;

33 
	}
}

35 
	$ã°
(*
URL
)

37 
CURL
 *
cuæ
;

38 
CURLcode
 
ªs
=
CURLE_OK
;

40 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

41 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

42  
TEST_ERR_MAJOR_BAD
;

45 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

46 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

47 
	`cuæ_globÆ_˛ónup
();

48  
TEST_ERR_MAJOR_BAD
;

52 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

55 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

58 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, 1L);

61 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

64 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READDATA
, 
NULL
);

67 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

70 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

73 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

75 
ã°_˛ónup
:

78 
	`cuæ_ósy_˛ónup
(
cuæ
);

79 
	`cuæ_globÆ_˛ónup
();

81  ()
ªs
;

82 
	}
}

	@tests/libtest/lib514.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURL
 *
cuæ
;

29 
CURLcode
 
ªs
=
CURLE_OK
;

31 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

32 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

33  
TEST_ERR_MAJOR_BAD
;

36 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

37 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

38 
	`cuæ_globÆ_˛ónup
();

39  
TEST_ERR_MAJOR_BAD
;

43 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

54 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, "moo");

55 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, 3L);

56 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

61 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_NOBODY
, 1L);

63 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

64 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

69 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

71 
ã°_˛ónup
:

74 
	`cuæ_ósy_˛ónup
(
cuæ
);

75 
	`cuæ_globÆ_˛ónup
();

77  ()
ªs
;

78 
	}
}

	@tests/libtest/lib515.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURL
 *
cuæ
;

29 
CURLcode
 
ªs
=
CURLE_OK
;

31 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

32 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

33  
TEST_ERR_MAJOR_BAD
;

36 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

37 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

38 
	`cuæ_globÆ_˛ónup
();

39  
TEST_ERR_MAJOR_BAD
;

43 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, 
NULL
);

45 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, 0L);

46 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

47 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

50 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

52 
ã°_˛ónup
:

55 
	`cuæ_ósy_˛ónup
(
cuæ
);

56 
	`cuæ_globÆ_˛ónup
();

58  ()
ªs
;

59 
	}
}

	@tests/libtest/lib516.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURL
 *
cuæ
;

29 
CURLcode
 
ªs
=
CURLE_OK
;

31 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

32 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

33  
TEST_ERR_MAJOR_BAD
;

36 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

37 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

38 
	`cuæ_globÆ_˛ónup
();

39  
TEST_ERR_MAJOR_BAD
;

43 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPPOST
, 
NULL
);

45 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

46 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

49 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

51 
ã°_˛ónup
:

54 
	`cuæ_ósy_˛ónup
(
cuæ
);

55 
	`cuæ_globÆ_˛ónup
();

57  ()
ªs
;

58 
	}
}

	@tests/libtest/lib517.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 c⁄° * c⁄° 
	gd©es
[]={

119 
NULL


122 
	$ã°
(*
URL
)

124 
i
;

126 ()
URL
;

128 
i
=0; 
d©es
[i]; i++) {

129 
	`¥ötf
("%d: %†=> %ld\n", 
i
, 
d©es
[i], ()
	`cuæ_gëd©e
(d©es[i], 
NULL
));

133 
	}
}

	@tests/libtest/lib518.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_SYS_RESOURCE_H


25 
	~<sys/ªsour˚.h
>

27 #ifde‡
HAVE_FCNTL_H


28 
	~<f˙é.h
>

30 #ifde‡
HAVE_LIMITS_H


31 
	~<limôs.h
>

34 
	~"w¨∆ess.h
"

35 
	~"memdebug.h
"

37 #i‚de‡
FD_SETSIZE


41 
	#SAFETY_MARGIN
 (16)

	)

42 
	#NUM_OPEN
 (
FD_SETSIZE
 + 10)

	)

43 
	#NUM_NEEDED
 (
NUM_OPEN
 + 
SAFETY_MARGIN
)

	)

45 #i‡
deföed
(
WIN32
Ë|| deföed(
_WIN32
Ë|| deföed(
MSDOS
)

46 
	#DEV_NULL
 "NUL"

	)

48 
	#DEV_NULL
 "/dev/nuŒ"

	)

51 #i‡
deföed
(
HAVE_GETRLIMIT
Ë&& deföed(
HAVE_SETRLIMIT
)

53 *
	gfd
 = 
NULL
;

54 
æimô
 
	gnum_›í
;

55 
	gmsgbuff
[256];

57 
	$°‹e_îrmsg
(c⁄° *
msg
, 
îr
)

59 i‡(!
îr
)

60 
	`•rötf
(
msgbuff
, "%s", 
msg
);

62 
	`•rötf
(
msgbuff
, "%s,Éºnÿ%d, %s", 
msg
, 
îr
, 
	`°ªº‹
(err));

63 
	}
}

65 
	$˛o£_fûe_des¸ùt‹s
()

67 
num_›í
.
æim_cur
 = 0;

68 
num_›í
.
æim_cur
 <Çum_›í.
æim_max
;

69 
num_›í
.
æim_cur
++)

70 i‡(
fd
[
num_›í
.
æim_cur
] > 0)

71 
	`˛o£
(
fd
[
num_›í
.
æim_cur
]);

72 
	`‰ì
(
fd
);

73 
fd
 = 
NULL
;

74 
	}
}

76 
	$f›í_w‹ks
()

78 
FILE
 *
Âa
[3];

79 
i
;

80 
ªt
 = 1;

82 
i
 = 0; i < 3; i++) {

83 
Âa
[
i
] = 
NULL
;

85 
i
 = 0; i < 3; i++) {

86 
Âa
[
i
] = 
	`f›í
(
DEV_NULL
, "r");

87 i‡(
Âa
[
i
] =
NULL
) {

88 
	`°‹e_îrmsg
("f›í(ËÁûed", 
ERRNO
);

89 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

90 
ªt
 = 0;

94 
i
 = 0; i < 3; i++) {

95 i‡(
Âa
[
i
] !
NULL
)

96 
	`f˛o£
(
Âa
[
i
]);

98  
ªt
;

99 
	}
}

101 
	$æimô
(
kìp_›í
)

103 
nôems
, 
i
;

104 *
memchunk
 = 
NULL
;

105 *
fmt
;

106 
æimô
 
æ
;

107 
°rbuff
[256];

108 
°rbuff1
[81];

109 
°rbuff2
[81];

110 
fmt_u
[] = "%u";

111 
fmt_lu
[] = "%lu";

112 #ifde‡
HAVE_LONGLONG


113 
fmt_Œu
[] = "%llu";

115 i‡((
æ
.
æim_max
) > ())

116 
fmt
 = 
fmt_Œu
;

119 
fmt
 = ((
æ
.
æim_max
Ë< ())?
fmt_u
:
fmt_lu
;

123 i‡(
	`gëæimô
(
RLIMIT_NOFILE
, &
æ
) != 0) {

124 
	`°‹e_îrmsg
("gëæimô(ËÁûed", 
ERRNO
);

125 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

131 #ifde‡
RLIM_INFINITY


132 i‡(
æ
.
æim_cur
 =
RLIM_INFINITY
)

133 
	`°r˝y
(
°rbuff
, "INFINITY");

136 
	`•rötf
(
°rbuff
, 
fmt
, 
æ
.
æim_cur
);

137 
	`Ârötf
(
°dîr
, "öôü»so·Üimô: %s\n", 
°rbuff
);

139 #ifde‡
RLIM_INFINITY


140 i‡(
æ
.
æim_max
 =
RLIM_INFINITY
)

141 
	`°r˝y
(
°rbuff
, "INFINITY");

144 
	`•rötf
(
°rbuff
, 
fmt
, 
æ
.
æim_max
);

145 
	`Ârötf
(
°dîr
, "öôü»h¨dÜimô: %s\n", 
°rbuff
);

149 
	`Ârötf
(
°dîr
, "ã°518 FD_SETSIZE: %d\n", 
FD_SETSIZE
);

150 
	`Ârötf
(
°dîr
, "ã°518 NUM_OPEN : %d\n", 
NUM_OPEN
);

151 
	`Ârötf
(
°dîr
, "ã°518 NUM_NEEDED: %d\n", 
NUM_NEEDED
);

162 i‡(
æ
.
æim_cur
 !æ.
æim_max
) {

164 #ifde‡
OPEN_MAX


165 i‡((
æ
.
æim_cur
 > 0) &&

166 (
æ
.
æim_cur
 < 
OPEN_MAX
)) {

167 
	`Ârötf
(
°dîr
, "raising softÜimit upÅo OPEN_MAX\n");

168 
æ
.
æim_cur
 = 
OPEN_MAX
;

169 i‡(
	`£ålimô
(
RLIMIT_NOFILE
, &
æ
) != 0) {

171 
	`°‹e_îrmsg
("£ålimô(ËÁûed", 
ERRNO
);

172 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

173 
msgbuff
[0] = '\0';

178 
	`Ârötf
(
°dîr
, "raising softÜimit upÅo hardÜimit\n");

179 
æ
.
æim_cur
 =Ñl.
æim_max
;

180 i‡(
	`£ålimô
(
RLIMIT_NOFILE
, &
æ
) != 0) {

182 
	`°‹e_îrmsg
("£ålimô(ËÁûed", 
ERRNO
);

183 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

184 
msgbuff
[0] = '\0';

189 i‡(
	`gëæimô
(
RLIMIT_NOFILE
, &
æ
) != 0) {

190 
	`°‹e_îrmsg
("gëæimô(ËÁûed", 
ERRNO
);

191 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

197 #ifde‡
RLIM_INFINITY


198 i‡(
æ
.
æim_cur
 =
RLIM_INFINITY
)

199 
	`°r˝y
(
°rbuff
, "INFINITY");

202 
	`•rötf
(
°rbuff
, 
fmt
, 
æ
.
æim_cur
);

203 
	`Ârötf
(
°dîr
, "cuºíàso·Üimô: %s\n", 
°rbuff
);

205 #ifde‡
RLIM_INFINITY


206 i‡(
æ
.
æim_max
 =
RLIM_INFINITY
)

207 
	`°r˝y
(
°rbuff
, "INFINITY");

210 
	`•rötf
(
°rbuff
, 
fmt
, 
æ
.
æim_max
);

211 
	`Ârötf
(
°dîr
, "cuºíàh¨dÜimô: %s\n", 
°rbuff
);

230 
num_›í
.
æim_cur
 = 
NUM_NEEDED
;

232 i‡((
æ
.
æim_cur
 > 0) &&

233 #ifde‡
RLIM_INFINITY


234 (
æ
.
æim_cur
 !
RLIM_INFINITY
) &&

236 (
æ
.
æim_cur
 <
num_›í
.rlim_cur)) {

237 
	`•rötf
(
°rbuff2
, 
fmt
, 
æ
.
æim_cur
);

238 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_cur
);

239 
	`•rötf
(
°rbuff
, "fdsÇeeded %s > systemÜimit %s",

240 
°rbuff1
, 
°rbuff2
);

241 
	`°‹e_îrmsg
(
°rbuff
, 0);

242 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

255 
nôems
 = 
i
 = 1;Çitems <= i; i *= 2)

256 
nôems
 = 
i
;

257 i‡(
nôems
 > 0x7fff)

258 
nôems
 = 0x40000;

260 
num_›í
.
æim_max
 = (*
memchunk
Ë* (
size_t
)
nôems
;

261 
	`•rötf
(
°rbuff
, 
fmt
, 
num_›í
.
æim_max
);

262 
	`Ârötf
(
°dîr
, "Æloˇtög memchunk %†byãáºay\n", 
°rbuff
);

263 
memchunk
 = 
	`mÆloc
((*memchunkË* (
size_t
)
nôems
);

264 i‡(!
memchunk
) {

265 
	`Ârötf
(
°dîr
, "memchunk, malloc() failed\n");

266 
nôems
 /= 2;

268 } 
nôems
 && !
memchunk
);

269 i‡(!
memchunk
) {

270 
	`°‹e_îrmsg
("memchunk, mÆloc(ËÁûed", 
ERRNO
);

271 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

277 
	`Ârötf
(
°dîr
, "initializing memchunkárray\n");

279 
i
 = 0; i < 
nôems
; i++)

280 
memchunk
[
i
] = -1;

284 
num_›í
.
æim_max
 = 
NUM_OPEN
;

288 i‡((
size_t
)(
num_›í
.
æim_max
Ë> ((size_t)-1Ë/ (*
fd
)) {

289 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_max
);

290 
	`•rötf
(
°rbuff
, "unableÅoállocateánárray for %s "

291 "fûêdes¸ùt‹s, would ovîÊow size_t", 
°rbuff1
);

292 
	`°‹e_îrmsg
(
°rbuff
, 0);

293 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

294 
	`‰ì
(
memchunk
);

300 
	`•rötf
(
°rbuff
, 
fmt
, 
num_›í
.
æim_max
);

301 
	`Ârötf
(
°dîr
, "Æloˇtögáºay f‹ %†fûêdes¸ùt‹s\n", 
°rbuff
);

303 
fd
 = 
	`mÆloc
((*fdË* (
size_t
)(
num_›í
.
æim_max
));

304 i‡(!
fd
) {

305 
	`°‹e_îrmsg
("fd, mÆloc(ËÁûed", 
ERRNO
);

306 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

307 
	`‰ì
(
memchunk
);

313 
	`Ârötf
(
°dîr
, "initializing fdárray\n");

315 
num_›í
.
æim_cur
 = 0;

316 
num_›í
.
æim_cur
 <Çum_›í.
æim_max
;

317 
num_›í
.
æim_cur
++)

318 
fd
[
num_›í
.
æim_cur
] = -1;

320 
	`•rötf
(
°rbuff
, 
fmt
, 
num_›í
.
æim_max
);

321 
	`Ârötf
(
°dîr
, "åyögÅÿ›í %†fûêdes¸ùt‹s\n", 
°rbuff
);

325 
fd
[0] = 
	`›í
(
DEV_NULL
, 
O_RDONLY
);

326 i‡(
fd
[0] < 0) {

327 
	`•rötf
(
°rbuff
, "›íög o‡%†Áûed", 
DEV_NULL
);

328 
	`°‹e_îrmsg
(
°rbuff
, 
ERRNO
);

329 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

330 
	`‰ì
(
fd
);

331 
fd
 = 
NULL
;

332 
	`‰ì
(
memchunk
);

338 
num_›í
.
æim_cur
 = 1;

339 
num_›í
.
æim_cur
 <Çum_›í.
æim_max
;

340 
num_›í
.
æim_cur
++) {

342 
fd
[
num_›í
.
æim_cur
] = 
	`dup
(fd[0]);

344 i‡(
fd
[
num_›í
.
æim_cur
] < 0) {

346 
fd
[
num_›í
.
æim_cur
] = -1;

348 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_cur
);

349 
	`•rötf
(
°rbuff
, "dup(Ë©ãm± %†Áûed", 
°rbuff1
);

350 
	`Ârötf
(
°dîr
, "%s\n", 
°rbuff
);

352 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_cur
);

353 
	`•rötf
(
°rbuff
, "fd†sy°emÜimô sìm†˛o£Åÿ%s", 
°rbuff1
);

354 
	`Ârötf
(
°dîr
, "%s\n", 
°rbuff
);

356 
num_›í
.
æim_max
 = 
NUM_NEEDED
;

358 
	`•rötf
(
°rbuff2
, 
fmt
, 
num_›í
.
æim_max
);

359 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_cur
);

360 
	`•rötf
(
°rbuff
, "fdsÇeeded %s > systemÜimit %s",

361 
°rbuff2
, 
°rbuff1
);

362 
	`°‹e_îrmsg
(
°rbuff
, 0);

363 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

365 
num_›í
.
æim_cur
 = 0;

366 
fd
[
num_›í
.
æim_cur
] >= 0;

367 
num_›í
.
æim_cur
++)

368 
	`˛o£
(
fd
[
num_›í
.
æim_cur
]);

369 
	`‰ì
(
fd
);

370 
fd
 = 
NULL
;

371 
	`‰ì
(
memchunk
);

378 
	`•rötf
(
°rbuff
, 
fmt
, 
num_›í
.
æim_max
);

379 
	`Ârötf
(
°dîr
, "%†fûêdes¸ùt‹†›í\n", 
°rbuff
);

381 #i‡!
	`deföed
(
HAVE_POLL_FINE
) && \

382 !
	`deföed
(
USE_WINSOCK
) && \

383 !
	`deföed
(
TPF
)

396 
num_›í
.
æim_cur
 = 
FD_SETSIZE
 - 
SAFETY_MARGIN
;

397 i‡(
num_›í
.
æim_max
 >Çum_›í.
æim_cur
) {

398 
	`•rötf
(
°rbuff
, "£À˘Üimô i†FD_SETSIZE %d", 
FD_SETSIZE
);

399 
	`°‹e_îrmsg
(
°rbuff
, 0);

400 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

401 
	`˛o£_fûe_des¸ùt‹s
();

402 
	`‰ì
(
memchunk
);

406 
num_›í
.
æim_cur
 = 
FD_SETSIZE
 - 
SAFETY_MARGIN
;

407 
æ
.
æim_cur
 = 0;

408 
æ
.
æim_cur
 < 
num_›í
.
æim_max
;

409 
æ
.
æim_cur
++) {

410 i‡((
fd
[
æ
.
æim_cur
] > 0) &&

411 (()
fd
[
æ
.
æim_cur
] > 
num_›í
.rlim_cur)) {

412 
	`•rötf
(
°rbuff
, "£À˘Üimô i†FD_SETSIZE %d", 
FD_SETSIZE
);

413 
	`°‹e_îrmsg
(
°rbuff
, 0);

414 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

415 
	`˛o£_fûe_des¸ùt‹s
();

416 
	`‰ì
(
memchunk
);

432 i‡(!
	`f›í_w‹ks
()) {

433 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_max
);

434 
	`•rötf
(
°rbuff
, "stdio fopen() fails with %s fds open()",

435 
°rbuff1
);

436 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

437 
	`•rötf
(
°rbuff
, "stdio fopen() fails withÜots of fds open()");

438 
	`°‹e_îrmsg
(
°rbuff
, 0);

439 
	`˛o£_fûe_des¸ùt‹s
();

440 
	`‰ì
(
memchunk
);

447 
	`‰ì
(
memchunk
);

451 i‡(!
kìp_›í
) {

452 
	`˛o£_fûe_des¸ùt‹s
();

456 
	}
}

458 
	$ã°
(*
URL
)

460 
CURLcode
 
ªs
;

461 
CURL
 *
cuæ
;

463 if(!
	`°rcmp
(
URL
, "check")) {

465 if(
	`æimô
(
FALSE
)) {

466 
	`Ârötf
(
°dout
, "æimôÖrobÀm: %s\n", 
msgbuff
);

472 i‡(
	`æimô
(
TRUE
)) {

474  
TEST_ERR_MAJOR_BAD
;

480 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

481 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

482 
	`˛o£_fûe_des¸ùt‹s
();

483  
TEST_ERR_MAJOR_BAD
;

486 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

487 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

488 
	`˛o£_fûe_des¸ùt‹s
();

489 
	`cuæ_globÆ_˛ónup
();

490  
TEST_ERR_MAJOR_BAD
;

493 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

494 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

496 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

498 
ã°_˛ónup
:

500 
	`˛o£_fûe_des¸ùt‹s
();

501 
	`cuæ_ósy_˛ónup
(
cuæ
);

502 
	`cuæ_globÆ_˛ónup
();

504  ()
ªs
;

505 
	}
}

509 
	$ã°
(*
URL
)

511 ()
URL
;

512 
	`¥ötf
("systemÜacksÇecessary system function(s)");

514 
	}
}

	@tests/libtest/lib519.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURLcode
 
ªs
;

29 
CURL
 *
cuæ
;

31 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

32 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

33  
TEST_ERR_MAJOR_BAD
;

36 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

37 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

38 
	`cuæ_globÆ_˛ónup
();

39  
TEST_ERR_MAJOR_BAD
;

42 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

43 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_USERPWD
, "monster:underbed");

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

45 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

48 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

50 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_USERPWD
, "anothermonster:inwardrobe");

53 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

55 
ã°_˛ónup
:

57 
	`cuæ_ósy_˛ónup
(
cuæ
);

58 
	`cuæ_globÆ_˛ónup
();

60  ()
ªs
;

61 
	}
}

	@tests/libtest/lib520.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURLcode
 
ªs
;

29 
CURL
 *
cuæ
;

31 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

32 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

33  
TEST_ERR_MAJOR_BAD
;

36 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

37 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

38 
	`cuæ_globÆ_˛ónup
();

39  
TEST_ERR_MAJOR_BAD
;

42 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

43 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_FILETIME
, 1L);

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

46 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

48 
ã°_˛ónup
:

50 
	`cuæ_ósy_˛ónup
(
cuæ
);

51 
	`cuæ_globÆ_˛ónup
();

53  ()
ªs
;

54 
	}
}

	@tests/libtest/lib521.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURLcode
 
ªs
;

29 
CURL
 *
cuæ
;

31 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

32 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

33  
TEST_ERR_MAJOR_BAD
;

36 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

37 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

38 
	`cuæ_globÆ_˛ónup
();

39  
TEST_ERR_MAJOR_BAD
;

42 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

43 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PORT
, 
	`°πﬁ
(
libã°_¨g2
, 
NULL
, 10));

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_USERPWD
, "xxx:yyy");

45 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

47 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

49 
ã°_˛ónup
:

51 
	`cuæ_ósy_˛ónup
(
cuæ
);

52 
	`cuæ_globÆ_˛ónup
();

54  ()
ªs
;

55 
	}
}

	@tests/libtest/lib523.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURLcode
 
ªs
;

29 
CURL
 *
cuæ
;

31 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

32 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

33  
TEST_ERR_MAJOR_BAD
;

36 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

37 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

38 
	`cuæ_globÆ_˛ónup
();

39  
TEST_ERR_MAJOR_BAD
;

42 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

43 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PORT
, 19999L);

45 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_USERPWD
, "xxx:yyy");

46 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

48 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

50 
ã°_˛ónup
:

52 
	`cuæ_ósy_˛ónup
(
cuæ
);

53 
	`cuæ_globÆ_˛ónup
();

55  ()
ªs
;

56 
	}
}

	@tests/libtest/lib524.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURLcode
 
ªs
;

29 
CURL
 *
cuæ
;

31 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

32 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

33  
TEST_ERR_MAJOR_BAD
;

36 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

37 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

38 
	`cuæ_globÆ_˛ónup
();

39  
TEST_ERR_MAJOR_BAD
;

42 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

43 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

46 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

48 
ã°_˛ónup
:

50 
	`cuæ_ósy_˛ónup
(
cuæ
);

51 
	`cuæ_globÆ_˛ónup
();

53  ()
ªs
;

54 
	}
}

	@tests/libtest/lib525.c

22 
	~"ã°.h
"

24 
	~<f˙é.h
>

26 
	~"ã°utû.h
"

27 
	~"w¨∆ess.h
"

28 
	~"memdebug.h
"

30 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

32 
	$ã°
(*
URL
)

34 
ªs
 = 0;

35 
CURL
 *
cuæ
 = 
NULL
;

36 
FILE
 *
hd_§c
 = 
NULL
;

37 
hd
 ;

38 
îr‹
;

39 
°ru˘_°©
 
fûe_öfo
;

40 
CURLM
 *
m
 = 
NULL
;

41 
ru¬ög
;

43 
	`°¨t_ã°_timög
();

45 if(!
libã°_¨g2
) {

46 #ifde‡
LIB529


48 
	`Ârötf
(
°dîr
, "Usage:Üib529 [url] [uploadfile]\n");

51 
	`Ârötf
(
°dîr
, "Usage:Üib525 [url] [uploadfile]\n");

53  
TEST_ERR_USAGE
;

56 
hd_§c
 = 
	`f›í
(
libã°_¨g2
, "rb");

57 if(
NULL
 =
hd_§c
) {

58 
îr‹
 = 
ERRNO
;

59 
	`Ârötf
(
°dîr
, "fopen() failed withÉrror: %d (%s)\n",

60 
îr‹
, 
	`°ªº‹
(error));

61 
	`Ârötf
(
°dîr
, "Eº‹ o≥nög fûe: (%s)\n", 
libã°_¨g2
);

62  
TEST_ERR_FOPEN
;

66 
hd
 = 
	`f°©
(
	`fûío
(
hd_§c
), &
fûe_öfo
);

67 if(
hd
 == -1) {

69 
îr‹
 = 
ERRNO
;

70 
	`Ârötf
(
°dîr
, "fstat() failed withÉrror: %d (%s)\n",

71 
îr‹
, 
	`°ªº‹
(error));

72 
	`Ârötf
(
°dîr
, "ERROR: c™nŸ o≥¿fûê(%s)\n", 
libã°_¨g2
);

73 
	`f˛o£
(
hd_§c
);

74  
TEST_ERR_FSTAT
;

77 
	`ªs_globÆ_öô
(
CURL_GLOBAL_ALL
);

78 if(
ªs
) {

79 
	`f˛o£
(
hd_§c
);

80  
ªs
;

83 
	`ósy_öô
(
cuæ
);

86 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

89 
	`ósy_£t›t
(
cuæ
,
CURLOPT_URL
, 
URL
);

92 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

95 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_FTPPORT
, "-");

98 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, 
hd_§c
);

109 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE_LARGE
, (
cuæ_off_t
)
fûe_öfo
.
°_size
);

111 
	`mu…i_öô
(
m
);

113 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
);

116 
timevÆ
 
öãrvÆ
;

117 
fd_£t
 
rd
, 
wr
, 
exc
;

118 
maxfd
 = -99;

120 
öãrvÆ
.
tv_£c
 = 1;

121 
öãrvÆ
.
tv_u£c
 = 0;

123 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

125 
	`ab‹t_⁄_ã°_timeout
();

127 if(!
ru¬ög
)

130 
	`FD_ZERO
(&
rd
);

131 
	`FD_ZERO
(&
wr
);

132 
	`FD_ZERO
(&
exc
);

134 
	`mu…i_fd£t
(
m
, &
rd
, &
wr
, &
exc
, &
maxfd
);

138 
	`£À˘_ã°
(
maxfd
+1, &
rd
, &
wr
, &
exc
, &
öãrvÆ
);

140 
	`ab‹t_⁄_ã°_timeout
();

143 
ã°_˛ónup
:

145 #ifde‡
LIB529


148 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
cuæ
);

149 
	`cuæ_mu…i_˛ónup
(
m
);

150 
	`cuæ_ósy_˛ónup
(
cuæ
);

151 
	`cuæ_globÆ_˛ónup
();

155 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
cuæ
);

156 
	`cuæ_ósy_˛ónup
(
cuæ
);

157 
	`cuæ_mu…i_˛ónup
(
m
);

158 
	`cuæ_globÆ_˛ónup
();

162 
	`f˛o£
(
hd_§c
);

164  
ªs
;

165 
	}
}

	@tests/libtest/lib526.c

41 
	~"ã°.h
"

43 
	~<f˙é.h
>

45 
	~"ã°utû.h
"

46 
	~"w¨∆ess.h
"

47 
	~"memdebug.h
"

49 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

51 
	#NUM_HANDLES
 4

	)

53 
	$ã°
(*
URL
)

55 
ªs
 = 0;

56 
CURL
 *
cuæ
[
NUM_HANDLES
];

57 
ru¬ög
;

58 
CURLM
 *
m
 = 
NULL
;

59 
cuºít
 = 0;

60 
i
;

62 
i
=0; i < 
NUM_HANDLES
; i++)

63 
cuæ
[
i
] = 
NULL
;

65 
	`°¨t_ã°_timög
();

67 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

70 
i
=0; i < 
NUM_HANDLES
; i++) {

71 
	`ósy_öô
(
cuæ
[
i
]);

73 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_URL
, 
URL
);

75 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_VERBOSE
, 1L);

78 
	`mu…i_öô
(
m
);

80 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
[
cuºít
]);

82 
	`Ârötf
(
°dîr
, "Startát URL 0\n");

85 
timevÆ
 
öãrvÆ
;

86 
fd_£t
 
rd
, 
wr
, 
exc
;

87 
maxfd
 = -99;

89 
öãrvÆ
.
tv_£c
 = 1;

90 
öãrvÆ
.
tv_u£c
 = 0;

92 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

94 
	`ab‹t_⁄_ã°_timeout
();

96 if(!
ru¬ög
) {

97 #ifde‡
LIB527


101 
	`cuæ_ósy_˛ónup
(
cuæ
[
cuºít
]);

102 
cuæ
[
cuºít
] = 
NULL
;

104 if(++
cuºít
 < 
NUM_HANDLES
) {

105 
	`Ârötf
(
°dîr
, "Adv™cögÅÿURL %d\n", 
cuºít
);

106 #ifde‡
LIB532


108 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
cuæ
[0]);

112 
	`cuæ_ósy_ª£t
(
cuæ
[0]);

113 
	`ósy_£t›t
(
cuæ
[0], 
CURLOPT_URL
, 
URL
);

115 
	`ósy_£t›t
(
cuæ
[0], 
CURLOPT_VERBOSE
, 1L);

118 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
[0]);

120 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
[
cuºít
]);

128 
	`FD_ZERO
(&
rd
);

129 
	`FD_ZERO
(&
wr
);

130 
	`FD_ZERO
(&
exc
);

132 
	`mu…i_fd£t
(
m
, &
rd
, &
wr
, &
exc
, &
maxfd
);

136 
	`£À˘_ã°
(
maxfd
+1, &
rd
, &
wr
, &
exc
, &
öãrvÆ
);

138 
	`ab‹t_⁄_ã°_timeout
();

141 
ã°_˛ónup
:

143 #i‡
	`deföed
(
LIB526
)

148 
i
=0; i < 
NUM_HANDLES
; i++) {

149 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
cuæ
[
i
]);

150 
	`cuæ_ósy_˛ónup
(
cuæ
[
i
]);

152 
	`cuæ_mu…i_˛ónup
(
m
);

153 
	`cuæ_globÆ_˛ónup
();

155 #ñi‡
	`deföed
(
LIB527
)

164 if(
ªs
)

165 
i
=0; i < 
NUM_HANDLES
; i++)

166 
	`cuæ_ósy_˛ónup
(
cuæ
[
i
]);

168 
	`cuæ_mu…i_˛ónup
(
m
);

169 
	`cuæ_globÆ_˛ónup
();

171 #ñi‡
	`deföed
(
LIB532
)

176 
i
=0; i < 
NUM_HANDLES
; i++)

177 
	`cuæ_ósy_˛ónup
(
cuæ
[
i
]);

178 
	`cuæ_mu…i_˛ónup
(
m
);

179 
	`cuæ_globÆ_˛ónup
();

183  
ªs
;

184 
	}
}

	@tests/libtest/lib530.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

30 
	#NUM_HANDLES
 4

	)

32 
	$ã°
(*
URL
)

34 
ªs
 = 0;

35 
CURL
 *
cuæ
[
NUM_HANDLES
];

36 
ru¬ög
;

37 
CURLM
 *
m
 = 
NULL
;

38 
i
;

39 
èrgë_uæ
[256];

40 
h™dÀs_added
 = 0;

42 
i
=0; i < 
NUM_HANDLES
; i++)

43 
cuæ
[
i
] = 
NULL
;

45 
	`°¨t_ã°_timög
();

47 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

49 
	`mu…i_öô
(
m
);

52 
i
=0; i < 
NUM_HANDLES
; i++) {

54 
	`ósy_öô
(
cuæ
[
i
]);

56 
	`•rötf
(
èrgë_uæ
, "%s%04i", 
URL
, 
i
 + 1);

57 
èrgë_uæ
[(target_url) - 1] = '\0';

58 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_URL
, 
èrgë_uæ
);

60 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_VERBOSE
, 1L);

62 
	`ósy_£t›t
(
cuæ
[
i
], 
CURLOPT_HEADER
, 1L);

68 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
[
h™dÀs_added
++]);

70 
	`mu…i_£t›t
(
m
, 
CURLMOPT_PIPELINING
, 1L);

72 
	`Ârötf
(
°dîr
, "Startát URL 0\n");

75 
timevÆ
 
öãrvÆ
;

76 
fd_£t
 
rd
, 
wr
, 
exc
;

77 
maxfd
 = -99;

79 
öãrvÆ
.
tv_£c
 = 1;

80 
öãrvÆ
.
tv_u£c
 = 0;

82 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

84 
	`ab‹t_⁄_ã°_timeout
();

86 if(!
ru¬ög
 && 
h™dÀs_added
 >
NUM_HANDLES
)

91 
h™dÀs_added
 < 
NUM_HANDLES
)

92 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
[
h™dÀs_added
++]);

94 
	`FD_ZERO
(&
rd
);

95 
	`FD_ZERO
(&
wr
);

96 
	`FD_ZERO
(&
exc
);

98 
	`mu…i_fd£t
(
m
, &
rd
, &
wr
, &
exc
, &
maxfd
);

102 
	`£À˘_ã°
(
maxfd
+1, &
rd
, &
wr
, &
exc
, &
öãrvÆ
);

104 
	`ab‹t_⁄_ã°_timeout
();

107 
ã°_˛ónup
:

111 
i
=0; i < 
NUM_HANDLES
; i++) {

112 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
cuæ
[
i
]);

113 
	`cuæ_ósy_˛ónup
(
cuæ
[
i
]);

116 
	`cuæ_mu…i_˛ónup
(
m
);

117 
	`cuæ_globÆ_˛ónup
();

119  
ªs
;

120 
	}
}

	@tests/libtest/lib533.c

24 
	~"ã°.h
"

26 
	~<f˙é.h
>

28 
	~"ã°utû.h
"

29 
	~"w¨∆ess.h
"

30 
	~"memdebug.h
"

32 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

34 
	$ã°
(*
URL
)

36 
ªs
 = 0;

37 
CURL
 *
cuæ
 = 
NULL
;

38 
ru¬ög
;

39 
CURLM
 *
m
 = 
NULL
;

40 
cuºít
=0;

42 
	`°¨t_ã°_timög
();

44 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

46 
	`ósy_öô
(
cuæ
);

48 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

49 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

50 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_FAILONERROR
, 1L);

52 
	`mu…i_öô
(
m
);

54 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
);

56 
	`Ârötf
(
°dîr
, "Startát URL 0\n");

59 
timevÆ
 
öãrvÆ
;

60 
fd_£t
 
rd
, 
wr
, 
exc
;

61 
maxfd
 = -99;

63 
öãrvÆ
.
tv_£c
 = 1;

64 
öãrvÆ
.
tv_u£c
 = 0;

66 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

68 
	`ab‹t_⁄_ã°_timeout
();

70 if(!
ru¬ög
) {

71 if(!
cuºít
++) {

72 
	`Ârötf
(
°dîr
, "AdvancingÅo URL 1\n");

74 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
cuæ
);

78 
	`cuæ_ósy_ª£t
(
cuæ
);

79 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
libã°_¨g2
);

80 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

81 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_FAILONERROR
, 1L);

84 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
);

90 
	`FD_ZERO
(&
rd
);

91 
	`FD_ZERO
(&
wr
);

92 
	`FD_ZERO
(&
exc
);

94 
	`mu…i_fd£t
(
m
, &
rd
, &
wr
, &
exc
, &
maxfd
);

98 
	`£À˘_ã°
(
maxfd
+1, &
rd
, &
wr
, &
exc
, &
öãrvÆ
);

100 
	`ab‹t_⁄_ã°_timeout
();

103 
ã°_˛ónup
:

107 
	`cuæ_ósy_˛ónup
(
cuæ
);

108 
	`cuæ_mu…i_˛ónup
(
m
);

109 
	`cuæ_globÆ_˛ónup
();

111  
ªs
;

112 
	}
}

	@tests/libtest/lib536.c

22 
	~"ã°.h
"

24 
	~<f˙é.h
>

26 
	~"ã°utû.h
"

27 
	~"w¨∆ess.h
"

28 
	~"memdebug.h
"

30 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

32 
	$≥rf‹m
(
CURLM
 *
mu…i
)

34 
h™dÀs
;

35 
fd_£t
 
fdªad
, 
fdwrôe
, 
fdex˚p
;

36 
ªs
 = 0;

39 
timevÆ
 
öãrvÆ
;

40 
maxfd
 = -99;

42 
öãrvÆ
.
tv_£c
 = 0;

43 
öãrvÆ
.
tv_u£c
 = 100000L;

45 
	`ªs_mu…i_≥rf‹m
(
mu…i
, &
h™dÀs
);

46 if(
ªs
)

47  
ªs
;

49 
	`ªs_ã°_timedout
();

50 if(
ªs
)

51  
ªs
;

53 if(!
h™dÀs
)

56 
	`FD_ZERO
(&
fdªad
);

57 
	`FD_ZERO
(&
fdwrôe
);

58 
	`FD_ZERO
(&
fdex˚p
);

60 
	`ªs_mu…i_fd£t
(
mu…i
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

61 if(
ªs
)

62  
ªs
;

66 
	`ªs_£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
öãrvÆ
);

67 if(
ªs
)

68  
ªs
;

70 
	`ªs_ã°_timedout
();

71 if(
ªs
)

72  
ªs
;

76 
	}
}

78 
	$ã°
(*
URL
)

80 
CURLM
 *
mu…i
 = 
NULL
;

81 
CURL
 *
ósy
 = 
NULL
;

82 
ªs
 = 0;

84 
	`°¨t_ã°_timög
();

86 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

88 
	`mu…i_öô
(
mu…i
);

90 
	`ósy_öô
(
ósy
);

92 
	`mu…i_£t›t
(
mu…i
, 
CURLMOPT_PIPELINING
, 1L);

94 
	`ósy_£t›t
(
ósy
, 
CURLOPT_WRITEFUNCTION
, 
fwrôe
);

95 
	`ósy_£t›t
(
ósy
, 
CURLOPT_FAILONERROR
, 1L);

96 
	`ósy_£t›t
(
ósy
, 
CURLOPT_URL
, 
URL
);

98 
	`ªs_mu…i_add_h™dÀ
(
mu…i
, 
ósy
);

99 if(
ªs
) {

100 
	`¥ötf
("curl_multi_add_handle() 1 failed\n");

101 
ã°_˛ónup
;

104 
ªs
 = 
	`≥rf‹m
(
mu…i
);

105 if(
ªs
) {

106 
	`¥ötf
("retrieve 1 failed\n");

107 
ã°_˛ónup
;

110 
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…i
, 
ósy
);

112 
	`cuæ_ósy_ª£t
(
ósy
);

114 
	`ósy_£t›t
(
ósy
, 
CURLOPT_FAILONERROR
, 1L);

115 
	`ósy_£t›t
(
ósy
, 
CURLOPT_URL
, 
libã°_¨g2
);

117 
	`ªs_mu…i_add_h™dÀ
(
mu…i
, 
ósy
);

118 if(
ªs
) {

119 
	`¥ötf
("curl_multi_add_handle() 2 failed\n");

120 
ã°_˛ónup
;

123 
ªs
 = 
	`≥rf‹m
(
mu…i
);

124 if(
ªs
) {

125 
	`¥ötf
("retrieve 2 failed\n");

126 
ã°_˛ónup
;

129 
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…i
, 
ósy
);

131 
ã°_˛ónup
:

135 
	`cuæ_ósy_˛ónup
(
ósy
);

136 
	`cuæ_mu…i_˛ónup
(
mu…i
);

137 
	`cuæ_globÆ_˛ónup
();

139 
	`¥ötf
("Finished!\n");

141  
ªs
;

142 
	}
}

	@tests/libtest/lib537.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_SYS_RESOURCE_H


25 
	~<sys/ªsour˚.h
>

27 #ifde‡
HAVE_FCNTL_H


28 
	~<f˙é.h
>

30 #ifde‡
HAVE_LIMITS_H


31 
	~<limôs.h
>

34 
	~"w¨∆ess.h
"

35 
	~"memdebug.h
"

37 #i‡!
deföed
(
HAVE_POLL_FINE
) && \

38 !
deföed
(
USE_WINSOCK
) && \

39 !
deföed
(
TPF
) && \

40 !
	$deföed
(
FD_SETSIZE
)

44 
	#SAFETY_MARGIN
 (11)

	)

46 #i‡
	`deföed
(
WIN32
Ë|| deföed(
_WIN32
Ë|| deföed(
MSDOS
)

47 
	#DEV_NULL
 "NUL"

	)

49 
	#DEV_NULL
 "/dev/nuŒ"

	)

52 #i‡
	`deföed
(
HAVE_GETRLIMIT
Ë&& deföed(
HAVE_SETRLIMIT
)

54 *
fd
 = 
NULL
;

55 
æimô
 
num_›í
;

56 
msgbuff
[256];

58 
	$°‹e_îrmsg
(c⁄° *
msg
, 
îr
)

60 i‡(!
îr
)

61 
	`•rötf
(
msgbuff
, "%s", 
msg
);

63 
	`•rötf
(
msgbuff
, "%s,Éºnÿ%d, %s", 
msg
, 
îr
, 
	`°ªº‹
(err));

64 
	}
}

66 
	$˛o£_fûe_des¸ùt‹s
()

68 
num_›í
.
æim_cur
 = 0;

69 
num_›í
.
æim_cur
 <Çum_›í.
æim_max
;

70 
num_›í
.
æim_cur
++)

71 i‡(
fd
[
num_›í
.
æim_cur
] > 0)

72 
	`˛o£
(
fd
[
num_›í
.
æim_cur
]);

73 
	`‰ì
(
fd
);

74 
fd
 = 
NULL
;

75 
	}
}

77 
	$f›í_w‹ks
()

79 
FILE
 *
Âa
[3];

80 
i
;

81 
ªt
 = 1;

83 
i
 = 0; i < 3; i++) {

84 
Âa
[
i
] = 
NULL
;

86 
i
 = 0; i < 3; i++) {

87 
Âa
[
i
] = 
	`f›í
(
DEV_NULL
, "r");

88 i‡(
Âa
[
i
] =
NULL
) {

89 
	`°‹e_îrmsg
("f›í(ËÁûed", 
ERRNO
);

90 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

91 
ªt
 = 0;

95 
i
 = 0; i < 3; i++) {

96 i‡(
Âa
[
i
] !
NULL
)

97 
	`f˛o£
(
Âa
[
i
]);

99  
ªt
;

100 
	}
}

102 
	$æimô
(
kìp_›í
)

104 *
tmpfd
;

105 
nôems
, 
i
;

106 *
memchunk
 = 
NULL
;

107 *
fmt
;

108 
æimô
 
æ
;

109 
°rbuff
[256];

110 
°rbuff1
[81];

111 
fmt_u
[] = "%u";

112 
fmt_lu
[] = "%lu";

113 #ifde‡
HAVE_LONGLONG


114 
fmt_Œu
[] = "%llu";

116 i‡((
æ
.
æim_max
) > ())

117 
fmt
 = 
fmt_Œu
;

120 
fmt
 = ((
æ
.
æim_max
Ë< ())?
fmt_u
:
fmt_lu
;

124 i‡(
	`gëæimô
(
RLIMIT_NOFILE
, &
æ
) != 0) {

125 
	`°‹e_îrmsg
("gëæimô(ËÁûed", 
ERRNO
);

126 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

132 #ifde‡
RLIM_INFINITY


133 i‡(
æ
.
æim_cur
 =
RLIM_INFINITY
)

134 
	`°r˝y
(
°rbuff
, "INFINITY");

137 
	`•rötf
(
°rbuff
, 
fmt
, 
æ
.
æim_cur
);

138 
	`Ârötf
(
°dîr
, "öôü»so·Üimô: %s\n", 
°rbuff
);

140 #ifde‡
RLIM_INFINITY


141 i‡(
æ
.
æim_max
 =
RLIM_INFINITY
)

142 
	`°r˝y
(
°rbuff
, "INFINITY");

145 
	`•rötf
(
°rbuff
, 
fmt
, 
æ
.
æim_max
);

146 
	`Ârötf
(
°dîr
, "öôü»h¨dÜimô: %s\n", 
°rbuff
);

157 i‡(
æ
.
æim_cur
 !æ.
æim_max
) {

159 #ifde‡
OPEN_MAX


160 i‡((
æ
.
æim_cur
 > 0) &&

161 (
æ
.
æim_cur
 < 
OPEN_MAX
)) {

162 
	`Ârötf
(
°dîr
, "raising softÜimit upÅo OPEN_MAX\n");

163 
æ
.
æim_cur
 = 
OPEN_MAX
;

164 i‡(
	`£ålimô
(
RLIMIT_NOFILE
, &
æ
) != 0) {

166 
	`°‹e_îrmsg
("£ålimô(ËÁûed", 
ERRNO
);

167 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

168 
msgbuff
[0] = '\0';

173 
	`Ârötf
(
°dîr
, "raising softÜimit upÅo hardÜimit\n");

174 
æ
.
æim_cur
 =Ñl.
æim_max
;

175 i‡(
	`£ålimô
(
RLIMIT_NOFILE
, &
æ
) != 0) {

177 
	`°‹e_îrmsg
("£ålimô(ËÁûed", 
ERRNO
);

178 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

179 
msgbuff
[0] = '\0';

184 i‡(
	`gëæimô
(
RLIMIT_NOFILE
, &
æ
) != 0) {

185 
	`°‹e_îrmsg
("gëæimô(ËÁûed", 
ERRNO
);

186 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

192 #ifde‡
RLIM_INFINITY


193 i‡(
æ
.
æim_cur
 =
RLIM_INFINITY
)

194 
	`°r˝y
(
°rbuff
, "INFINITY");

197 
	`•rötf
(
°rbuff
, 
fmt
, 
æ
.
æim_cur
);

198 
	`Ârötf
(
°dîr
, "cuºíàso·Üimô: %s\n", 
°rbuff
);

200 #ifde‡
RLIM_INFINITY


201 i‡(
æ
.
æim_max
 =
RLIM_INFINITY
)

202 
	`°r˝y
(
°rbuff
, "INFINITY");

205 
	`•rötf
(
°rbuff
, 
fmt
, 
æ
.
æim_max
);

206 
	`Ârötf
(
°dîr
, "cuºíàh¨dÜimô: %s\n", 
°rbuff
);

229 
nôems
 = 
i
 = 1;Çitems <= i; i *= 2)

230 
nôems
 = 
i
;

231 i‡(
nôems
 > 0x7fff)

232 
nôems
 = 0x40000;

234 
num_›í
.
æim_max
 = (*
memchunk
Ë* (
size_t
)
nôems
;

235 
	`•rötf
(
°rbuff
, 
fmt
, 
num_›í
.
æim_max
);

236 
	`Ârötf
(
°dîr
, "Æloˇtög memchunk %†byãáºay\n", 
°rbuff
);

237 
memchunk
 = 
	`mÆloc
((*memchunkË* (
size_t
)
nôems
);

238 i‡(!
memchunk
) {

239 
	`Ârötf
(
°dîr
, "memchunk, malloc() failed\n");

240 
nôems
 /= 2;

242 } 
nôems
 && !
memchunk
);

243 i‡(!
memchunk
) {

244 
	`°‹e_îrmsg
("memchunk, mÆloc(ËÁûed", 
ERRNO
);

245 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

251 
	`Ârötf
(
°dîr
, "initializing memchunkárray\n");

253 
i
 = 0; i < 
nôems
; i++)

254 
memchunk
[
i
] = -1;

258 #ifde‡
RLIM_INFINITY


259 i‡((
æ
.
æim_cur
 > 0Ë&& (æ.æim_cu∏!
RLIM_INFINITY
)) {

261 i‡(
æ
.
æim_cur
 > 0) {

264 
num_›í
.
æim_max
 = 
æ
.
æim_cur
 - 
SAFETY_MARGIN
;

268 
nôems
 = 
i
 = 1;Çitems <= i; i *= 2)

269 
nôems
 = 
i
;

270 i‡(
nôems
 > 0x7fff)

271 
nôems
 = 0x40000;

272 
num_›í
.
æim_max
 = 
nôems
;

277 i‡((
size_t
)(
num_›í
.
æim_max
Ë> ((size_t)-1Ë/ (*
fd
)) {

278 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_max
);

279 
	`•rötf
(
°rbuff
, "unableÅoállocateánárray for %s "

280 "fûêdes¸ùt‹s, would ovîÊow size_t", 
°rbuff1
);

281 
	`°‹e_îrmsg
(
°rbuff
, 0);

282 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

283 
	`‰ì
(
memchunk
);

290 
	`•rötf
(
°rbuff
, 
fmt
, 
num_›í
.
æim_max
);

291 
	`Ârötf
(
°dîr
, "Æloˇtögáºay f‹ %†fûêdes¸ùt‹s\n", 
°rbuff
);

292 
fd
 = 
	`mÆloc
((*fdË* (
size_t
)(
num_›í
.
æim_max
));

293 i‡(!
fd
) {

294 
	`Ârötf
(
°dîr
, "fd, malloc() failed\n");

295 
num_›í
.
æim_max
 /= 2;

297 } 
num_›í
.
æim_max
 && !
fd
);

298 i‡(!
fd
) {

299 
	`°‹e_îrmsg
("fd, mÆloc(ËÁûed", 
ERRNO
);

300 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

301 
	`‰ì
(
memchunk
);

307 
	`Ârötf
(
°dîr
, "initializing fdárray\n");

309 
num_›í
.
æim_cur
 = 0;

310 
num_›í
.
æim_cur
 <Çum_›í.
æim_max
;

311 
num_›í
.
æim_cur
++)

312 
fd
[
num_›í
.
æim_cur
] = -1;

314 
	`•rötf
(
°rbuff
, 
fmt
, 
num_›í
.
æim_max
);

315 
	`Ârötf
(
°dîr
, "åyögÅÿ›í %†fûêdes¸ùt‹s\n", 
°rbuff
);

319 
fd
[0] = 
	`›í
(
DEV_NULL
, 
O_RDONLY
);

320 i‡(
fd
[0] < 0) {

321 
	`•rötf
(
°rbuff
, "›íög o‡%†Áûed", 
DEV_NULL
);

322 
	`°‹e_îrmsg
(
°rbuff
, 
ERRNO
);

323 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

324 
	`‰ì
(
fd
);

325 
fd
 = 
NULL
;

326 
	`‰ì
(
memchunk
);

332 
num_›í
.
æim_cur
 = 1;

333 
num_›í
.
æim_cur
 <Çum_›í.
æim_max
;

334 
num_›í
.
æim_cur
++) {

336 
fd
[
num_›í
.
æim_cur
] = 
	`dup
(fd[0]);

338 i‡(
fd
[
num_›í
.
æim_cur
] < 0) {

340 
fd
[
num_›í
.
æim_cur
] = -1;

342 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_cur
);

343 
	`•rötf
(
°rbuff
, "dup(Ë©ãm± %†Áûed", 
°rbuff1
);

344 
	`Ârötf
(
°dîr
, "%s\n", 
°rbuff
);

346 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_cur
);

347 
	`•rötf
(
°rbuff
, "fd†sy°emÜimô sìm†˛o£Åÿ%s", 
°rbuff1
);

348 
	`Ârötf
(
°dîr
, "%s\n", 
°rbuff
);

350 
num_›í
.
æim_max
 =Çum_›í.
æim_cur
 - 
SAFETY_MARGIN
;

352 
num_›í
.
æim_cur
 -num_›í.
æim_max
;

353 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_cur
);

354 
	`•rötf
(
°rbuff
, "˛osög %†fûêdes¸ùt‹s", 
°rbuff1
);

355 
	`Ârötf
(
°dîr
, "%s\n", 
°rbuff
);

357 
num_›í
.
æim_cur
 =Çum_›í.
æim_max
;

358 
fd
[
num_›í
.
æim_cur
] >= 0;

359 
num_›í
.
æim_cur
++) {

360 
	`˛o£
(
fd
[
num_›í
.
æim_cur
]);

361 
fd
[
num_›í
.
æim_cur
] = -1;

364 
	`•rötf
(
°rbuff
, 
fmt
, 
num_›í
.
æim_max
);

365 
	`Ârötf
(
°dîr
, "shrökögáºay f‹ %†fûêdes¸ùt‹s\n", 
°rbuff
);

369 
tmpfd
 = 
	`ªÆloc
(
fd
, (*fdË* (
size_t
)(
num_›í
.
æim_max
));

370 i‡(
tmpfd
) {

371 
fd
 = 
tmpfd
;

372 
tmpfd
 = 
NULL
;

381 
	`•rötf
(
°rbuff
, 
fmt
, 
num_›í
.
æim_max
);

382 
	`Ârötf
(
°dîr
, "%†fûêdes¸ùt‹†›í\n", 
°rbuff
);

384 #i‡!
	`deföed
(
HAVE_POLL_FINE
) && \

385 !
	`deföed
(
USE_WINSOCK
) && \

386 !
	`deföed
(
TPF
)

399 
num_›í
.
æim_cur
 = 
FD_SETSIZE
 - 
SAFETY_MARGIN
;

400 i‡(
num_›í
.
æim_max
 >Çum_›í.
æim_cur
) {

401 
	`•rötf
(
°rbuff
, "£À˘Üimô i†FD_SETSIZE %d", 
FD_SETSIZE
);

402 
	`°‹e_îrmsg
(
°rbuff
, 0);

403 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

404 
	`˛o£_fûe_des¸ùt‹s
();

405 
	`‰ì
(
memchunk
);

409 
num_›í
.
æim_cur
 = 
FD_SETSIZE
 - 
SAFETY_MARGIN
;

410 
æ
.
æim_cur
 = 0;

411 
æ
.
æim_cur
 < 
num_›í
.
æim_max
;

412 
æ
.
æim_cur
++) {

413 i‡((
fd
[
æ
.
æim_cur
] > 0) &&

414 (()
fd
[
æ
.
æim_cur
] > 
num_›í
.rlim_cur)) {

415 
	`•rötf
(
°rbuff
, "£À˘Üimô i†FD_SETSIZE %d", 
FD_SETSIZE
);

416 
	`°‹e_îrmsg
(
°rbuff
, 0);

417 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

418 
	`˛o£_fûe_des¸ùt‹s
();

419 
	`‰ì
(
memchunk
);

435 i‡(!
	`f›í_w‹ks
()) {

436 
	`•rötf
(
°rbuff1
, 
fmt
, 
num_›í
.
æim_max
);

437 
	`•rötf
(
°rbuff
, "stdio fopen() fails with %s fds open()",

438 
°rbuff1
);

439 
	`Ârötf
(
°dîr
, "%s\n", 
msgbuff
);

440 
	`•rötf
(
°rbuff
, "stdio fopen() fails withÜots of fds open()");

441 
	`°‹e_îrmsg
(
°rbuff
, 0);

442 
	`˛o£_fûe_des¸ùt‹s
();

443 
	`‰ì
(
memchunk
);

450 
	`‰ì
(
memchunk
);

454 i‡(!
kìp_›í
) {

455 
	`˛o£_fûe_des¸ùt‹s
();

459 
	}
}

461 
	$ã°
(*
URL
)

463 
CURLcode
 
ªs
;

464 
CURL
 *
cuæ
;

466 if(!
	`°rcmp
(
URL
, "check")) {

468 if(
	`æimô
(
FALSE
)) {

469 
	`Ârötf
(
°dout
, "æimôÖrobÀm: %s\n", 
msgbuff
);

475 i‡(
	`æimô
(
TRUE
)) {

477  
TEST_ERR_MAJOR_BAD
;

483 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

484 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

485 
	`˛o£_fûe_des¸ùt‹s
();

486  
TEST_ERR_MAJOR_BAD
;

489 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

490 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

491 
	`˛o£_fûe_des¸ùt‹s
();

492 
	`cuæ_globÆ_˛ónup
();

493  
TEST_ERR_MAJOR_BAD
;

496 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

497 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

499 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

501 
ã°_˛ónup
:

503 
	`˛o£_fûe_des¸ùt‹s
();

504 
	`cuæ_ósy_˛ónup
(
cuæ
);

505 
	`cuæ_globÆ_˛ónup
();

507  ()
ªs
;

508 
	}
}

512 
	$ã°
(*
URL
)

514 ()
URL
;

515 
	`¥ötf
("systemÜacksÇecessary system function(s)");

517 
	}
}

	@tests/libtest/lib539.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURLcode
 
ªs
;

29 
CURL
 *
cuæ
;

30 *
√wURL
 = 
NULL
;

31 
cuæ_¶i°
 *
¶i°
 = 
NULL
;

33 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

34 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

35  
TEST_ERR_MAJOR_BAD
;

38 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

39 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

40 
	`cuæ_globÆ_˛ónup
();

41  
TEST_ERR_MAJOR_BAD
;

47 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

48 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

49 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_FTP_FILEMETHOD
, (Ë
CURLFTPMETHOD_SINGLECWD
);

51 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

61 
√wURL
 = 
	`mÆloc
(
	`°æí
(
URL
) + 3);

62 i‡(
√wURL
 =
NULL
) {

63 
	`cuæ_ósy_˛ónup
(
cuæ
);

64 
	`cuæ_globÆ_˛ónup
();

65  
TEST_ERR_MAJOR_BAD
;

67 
√wURL
 = 
	`°rˇt
(
	`°r˝y
“ewURL, 
URL
), "./");

69 
¶i°
 = 
	`cuæ_¶i°_≠≥nd
 (
NULL
, "SYST");

70 i‡(
¶i°
 =
NULL
) {

71 
	`‰ì
(
√wURL
);

72 
	`cuæ_ósy_˛ónup
(
cuæ
);

73 
	`cuæ_globÆ_˛ónup
();

74  
TEST_ERR_MAJOR_BAD
;

77 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
√wURL
);

78 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_FTP_FILEMETHOD
, (Ë
CURLFTPMETHOD_NOCWD
);

79 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_QUOTE
, 
¶i°
);

81 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

83 
ã°_˛ónup
:

85 
	`cuæ_¶i°_‰ì_Æl
(
¶i°
);

86 if(
√wURL
)

87 
	`‰ì
(
√wURL
);

88 
	`cuæ_ósy_˛ónup
(
cuæ
);

89 
	`cuæ_globÆ_˛ónup
();

91  ()
ªs
;

92 
	}
}

	@tests/libtest/lib540.c

31 
	~"ã°.h
"

33 #ifde‡
HAVE_LIMITS_H


34 
	~<limôs.h
>

37 
	~"ã°utû.h
"

38 
	~"w¨∆ess.h
"

39 
	~"memdebug.h
"

41 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

43 
	#PROXY
 
libã°_¨g2


	)

44 
	#PROXYUSERPWD
 
libã°_¨g3


	)

45 
	#HOST
 
ã°_¨gv
[4]

	)

47 
	#NUM_HANDLES
 2

	)

49 
CURL
 *
	geh
[
NUM_HANDLES
];

51 
	$öô
(
num
, 
CURLM
 *
cm
, c⁄° * 
uæ
, c⁄° * 
u£Ωwd
,

52 
cuæ_¶i°
 *
hódîs
)

54 
ªs
 = 0;

56 
	`ªs_ósy_öô
(
eh
[
num
]);

57 if(
ªs
)

58 
öô_Áûed
;

60 
	`ªs_ósy_£t›t
(
eh
[
num
], 
CURLOPT_URL
, 
uæ
);

61 if(
ªs
)

62 
öô_Áûed
;

64 
	`ªs_ósy_£t›t
(
eh
[
num
], 
CURLOPT_PROXY
, 
PROXY
);

65 if(
ªs
)

66 
öô_Áûed
;

68 
	`ªs_ósy_£t›t
(
eh
[
num
], 
CURLOPT_PROXYUSERPWD
, 
u£Ωwd
);

69 if(
ªs
)

70 
öô_Áûed
;

72 
	`ªs_ósy_£t›t
(
eh
[
num
], 
CURLOPT_PROXYAUTH
, ()
CURLAUTH_ANY
);

73 if(
ªs
)

74 
öô_Áûed
;

76 
	`ªs_ósy_£t›t
(
eh
[
num
], 
CURLOPT_VERBOSE
, 1L);

77 if(
ªs
)

78 
öô_Áûed
;

80 
	`ªs_ósy_£t›t
(
eh
[
num
], 
CURLOPT_HEADER
, 1L);

81 if(
ªs
)

82 
öô_Áûed
;

84 
	`ªs_ósy_£t›t
(
eh
[
num
], 
CURLOPT_HTTPHEADER
, 
hódîs
);

85 if(
ªs
)

86 
öô_Áûed
;

88 
	`ªs_mu…i_add_h™dÀ
(
cm
, 
eh
[
num
]);

89 if(
ªs
)

90 
öô_Áûed
;

94 
öô_Áûed
:

96 
	`cuæ_ósy_˛ónup
(
eh
[
num
]);

97 
eh
[
num
] = 
NULL
;

99  
ªs
;

100 
	}
}

102 
	$lo›
(
num
, 
CURLM
 *
cm
, c⁄° * 
uæ
, c⁄° * 
u£Ωwd
,

103 
cuæ_¶i°
 *
hódîs
)

105 
CURLMsg
 *
msg
;

106 
L
;

107 
Q
, 
U
 = -1;

108 
fd_£t
 
R
, 
W
, 
E
;

109 
timevÆ
 
T
;

110 
ªs
 = 0;

112 
ªs
 = 
	`öô
(
num
, 
cm
, 
uæ
, 
u£Ωwd
, 
hódîs
);

113 if(
ªs
)

114  
ªs
;

116 
U
) {

118 
M
 = -99;

120 
	`ªs_mu…i_≥rf‹m
(
cm
, &
U
);

121 if(
ªs
)

122  
ªs
;

124 
	`ªs_ã°_timedout
();

125 if(
ªs
)

126  
ªs
;

128 i‡(
U
) {

129 
	`FD_ZERO
(&
R
);

130 
	`FD_ZERO
(&
W
);

131 
	`FD_ZERO
(&
E
);

133 
	`ªs_mu…i_fd£t
(
cm
, &
R
, &
W
, &
E
, &
M
);

134 if(
ªs
)

135  
ªs
;

139 
	`ªs_mu…i_timeout
(
cm
, &
L
);

140 if(
ªs
)

141  
ªs
;

145 if(
L
 != -1) {

146 
ôimeout
 = (
L
 > ()
INT_MAX
) ? INT_MAX : ()L;

147 
T
.
tv_£c
 = 
ôimeout
/1000;

148 
T
.
tv_u£c
 = (
ôimeout
%1000)*1000;

151 
T
.
tv_£c
 = 5;

152 
T
.
tv_u£c
 = 0;

155 
	`ªs_£À˘_ã°
(
M
+1, &
R
, &
W
, &
E
, &
T
);

156 if(
ªs
)

157  
ªs
;

160 (
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
cm
, &
Q
)Ë!
NULL
) {

161 if(
msg
->msg =
CURLMSG_DONE
) {

162 
i
;

163 
CURL
 *
e
 = 
msg
->
ósy_h™dÀ
;

164 
	`Ârötf
(
°dîr
, "R: %d - %s\n", ()
msg
->
d©a
.
ªsu…
,

165 
	`cuæ_ósy_°ªº‹
(
msg
->
d©a
.
ªsu…
));

166 
	`cuæ_mu…i_ªmove_h™dÀ
(
cm
, 
e
);

167 
	`cuæ_ósy_˛ónup
(
e
);

168 
i
=0; i < 
NUM_HANDLES
; i++) {

169 if(
eh
[
i
] =
e
) {

170 
eh
[
i
] = 
NULL
;

176 
	`Ârötf
(
°dîr
, "E: CURLMsg (%d)\n", ()
msg
->msg);

179 
	`ªs_ã°_timedout
();

180 if(
ªs
)

181  
ªs
;

185 
	}
}

187 
	$ã°
(*
URL
)

189 
CURLM
 *
cm
 = 
NULL
;

190 
cuæ_¶i°
 *
hódîs
 = 
NULL
;

191 
buf„r
[246];

192 
ªs
 = 0;

193 
i
;

195 
i
=0; i < 
NUM_HANDLES
; i++)

196 
eh
[
i
] = 
NULL
;

198 
	`°¨t_ã°_timög
();

200 if(
ã°_¨gc
 < 4)

203 
	`•rötf
(
buf„r
, "Ho°: %s", 
HOST
);

206 
hódîs
 = 
	`cuæ_¶i°_≠≥nd
(hódîs, 
buf„r
);

207 if(!
hódîs
) {

208 
	`Ârötf
(
°dîr
, "curl_slist_append() failed\n");

209  
TEST_ERR_MAJOR_BAD
;

212 
	`ªs_globÆ_öô
(
CURL_GLOBAL_ALL
);

213 if(
ªs
) {

214 
	`cuæ_¶i°_‰ì_Æl
(
hódîs
);

215  
ªs
;

218 
	`ªs_mu…i_öô
(
cm
);

219 if(
ªs
) {

220 
	`cuæ_globÆ_˛ónup
();

221 
	`cuæ_¶i°_‰ì_Æl
(
hódîs
);

222  
ªs
;

225 
ªs
 = 
	`lo›
(0, 
cm
, 
URL
, 
PROXYUSERPWD
, 
hódîs
);

226 if(
ªs
)

227 
ã°_˛ónup
;

229 
	`Ârötf
(
°dîr
, "lib540:Çow we doÅheÑequestágain\n");

231 
ªs
 = 
	`lo›
(1, 
cm
, 
URL
, 
PROXYUSERPWD
, 
hódîs
);

233 
ã°_˛ónup
:

237 
i
=0; i < 
NUM_HANDLES
; i++) {

238 
	`cuæ_mu…i_ªmove_h™dÀ
(
cm
, 
eh
[
i
]);

239 
	`cuæ_ósy_˛ónup
(
eh
[
i
]);

242 
	`cuæ_mu…i_˛ónup
(
cm
);

243 
	`cuæ_globÆ_˛ónup
();

245 
	`cuæ_¶i°_‰ì_Æl
(
hódîs
);

247  
ªs
;

248 
	}
}

	@tests/libtest/lib541.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_FCNTL_H


25 
	~<f˙é.h
>

28 
	~"memdebug.h
"

34 
	$ã°
(*
URL
)

36 
CURL
 *
cuæ
;

37 
CURLcode
 
ªs
 = 
CURLE_OK
;

38 
FILE
 *
hd_§c
 ;

39 
hd
;

40 
°ru˘_°©
 
fûe_öfo
;

41 
îr‹
;

43 i‡(!
libã°_¨g2
) {

44 
	`Ârötf
(
°dîr
, "Usage: <url> <file-to-upload>\n");

45  
TEST_ERR_USAGE
;

48 
hd_§c
 = 
	`f›í
(
libã°_¨g2
, "rb");

49 if(
NULL
 =
hd_§c
) {

50 
îr‹
 = 
ERRNO
;

51 
	`Ârötf
(
°dîr
, "fopen() failed withÉrror: %d %s\n",

52 
îr‹
, 
	`°ªº‹
(error));

53 
	`Ârötf
(
°dîr
, "Eº‹ o≥nög fûe: %s\n", 
libã°_¨g2
);

58 
hd
 = 
	`f°©
(
	`fûío
(
hd_§c
), &
fûe_öfo
);

59 if(
hd
 == -1) {

61 
îr‹
 = 
ERRNO
;

62 
	`Ârötf
(
°dîr
, "fstat() failed withÉrror: %d %s\n",

63 
îr‹
, 
	`°ªº‹
(error));

64 
	`Ârötf
(
°dîr
, "ERROR: c™nŸ o≥¿fûê%s\n", 
libã°_¨g2
);

65 
	`f˛o£
(
hd_§c
);

66  
TEST_ERR_MAJOR_BAD
;

69 if(! 
fûe_öfo
.
°_size
) {

70 
	`Ârötf
(
°dîr
, "ERROR: fûê%†ha†zîÿsize!\n", 
libã°_¨g2
);

71 
	`f˛o£
(
hd_§c
);

72  
TEST_ERR_MAJOR_BAD
;

75 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

76 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

77 
	`f˛o£
(
hd_§c
);

78  
TEST_ERR_MAJOR_BAD
;

82 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

83 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

84 
	`cuæ_globÆ_˛ónup
();

85 
	`f˛o£
(
hd_§c
);

86  
TEST_ERR_MAJOR_BAD
;

90 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

93 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

96 
	`ã°_£t›t
(
cuæ
,
CURLOPT_URL
, 
URL
);

99 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READDATA
, 
hd_§c
);

102 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

106 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

108 
ã°_˛ónup
:

111 
	`f˛o£
(
hd_§c
);

113 
	`cuæ_ósy_˛ónup
(
cuæ
);

114 
	`cuæ_globÆ_˛ónup
();

116  
ªs
;

117 
	}
}

	@tests/libtest/lib542.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_FCNTL_H


25 
	~<f˙é.h
>

28 
	~"memdebug.h
"

34 
	$ã°
(*
URL
)

36 
CURL
 *
cuæ
;

37 
CURLcode
 
ªs
 = 
CURLE_OK
;

39 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

40 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

41  
TEST_ERR_MAJOR_BAD
;

45 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

46 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

47 
	`cuæ_globÆ_˛ónup
();

48  
TEST_ERR_MAJOR_BAD
;

52 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

55 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_NOBODY
, 1L);

58 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 0L);

61 
	`ã°_£t›t
(
cuæ
,
CURLOPT_URL
, 
URL
);

64 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

66 
ã°_˛ónup
:

68 
	`cuæ_ósy_˛ónup
(
cuæ
);

69 
	`cuæ_globÆ_˛ónup
();

71  
ªs
;

72 
	}
}

	@tests/libtest/lib543.c

24 
	~"ã°.h
"

26 
	~"memdebug.h
"

28 
	$ã°
(*
URL
)

30 
a
[] = {0x9c, 0x26, 0x4b, 0x3d, 0x49, 0x4, 0xa1, 0x1,

34 
CURL
 *
ósy
;

35 
asize
;

36 *
s
;

37 ()
URL
;

39 i‡((
ósy
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

40 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

41  
TEST_ERR_MAJOR_BAD
;

44 
asize
 = ()(
a
);

46 
s
 = 
	`cuæ_ósy_esˇ≥
(
ósy
, (*)
a
, 
asize
);

48 if(
s
)

49 
	`¥ötf
("%s\n", 
s
);

51 if(
s
)

52 
	`cuæ_‰ì
(
s
);

54 
	`cuæ_ósy_˛ónup
(
ósy
);

57 
	}
}

	@tests/libtest/lib544.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	gã°°rög
[] =

27 #ifde‡
CURL_DOES_CONVERSIONS


37 
	$ã°
(*
URL
)

39 
CURL
 *
cuæ
;

40 
CURLcode
 
ªs
=
CURLE_OK
;

42 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

43 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

44  
TEST_ERR_MAJOR_BAD
;

47 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

48 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

49 
	`cuæ_globÆ_˛ónup
();

50  
TEST_ERR_MAJOR_BAD
;

54 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

56 #ifde‡
LIB545


57 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, (Ë 
ã°°rög
 - 1);

60 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_COPYPOSTFIELDS
, 
ã°°rög
);

62 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

63 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

66 
	`°r˝y
(
ã°°rög
, "FAIL");

69 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

71 
ã°_˛ónup
:

74 
	`cuæ_ósy_˛ónup
(
cuæ
);

75 
	`cuæ_globÆ_˛ónup
();

77  ()
ªs
;

78 
	}
}

	@tests/libtest/lib547.c

27 
	~"ã°.h
"

29 
	~"memdebug.h
"

31 #ifde‡
CURL_DOES_CONVERSIONS


33 
	#UPLOADTHIS
 "\x74\x68\x69\x73\x20\x69\x73\x20\x74\x68\x65\x20\x62" \

35 "\x74\x6f\x20\x75\x70\x6c\x6f\x61\x64\x0a"

	)

37 
	#UPLOADTHIS
 "thi†i†thêblurb wêw™àtÿu∂ﬂd\n"

	)

40 #i‚de‡
LIB548


41 
size_t
 
	$ªadˇŒback
(*
±r
,

42 
size_t
 
size
,

43 
size_t
 
nmemb
,

44 *
˛õ¡p
)

46 *
cou¡î
 = (*)
˛õ¡p
;

48 if(*
cou¡î
) {

50 
	`Ârötf
(
°dîr
, "READ ALREADY DONE!\n");

53 (*
cou¡î
)++;

55 if(
size
 * 
nmemb
 > 
	`°æí
(
UPLOADTHIS
)) {

56 
	`Ârötf
(
°dîr
, "READ!\n");

57 
	`°r˝y
(
±r
, 
UPLOADTHIS
);

58  
	`°æí
(
UPLOADTHIS
);

60 
	`Ârötf
(
°dîr
, "READ NOT FINE!\n");

62 
	}
}

63 
cuæi€º
 
	$io˘lˇŒback
(
CURL
 *
h™dÀ
,

64 
cmd
,

65 *
˛õ¡p
)

67 *
cou¡î
 = (*)
˛õ¡p
;

68 ()
h™dÀ
;

69 if(
cmd
 =
CURLIOCMD_RESTARTREAD
) {

70 
	`Ârötf
(
°dîr
, "REWIND!\n");

71 *
cou¡î
 = 0;

73  
CURLIOE_OK
;

74 
	}
}

80 
	$ã°
(*
URL
)

82 
CURLcode
 
ªs
;

83 
CURL
 *
cuæ
;

84 #i‚de‡
LIB548


85 
cou¡î
=0;

88 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

89 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

90  
TEST_ERR_MAJOR_BAD
;

93 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

94 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

95 
	`cuæ_globÆ_˛ónup
();

96  
TEST_ERR_MAJOR_BAD
;

99 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

100 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

101 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

102 #ifde‡
LIB548


104 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, 
UPLOADTHIS
);

107 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_IOCTLFUNCTION
, 
io˘lˇŒback
);

108 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_IOCTLDATA
, &
cou¡î
);

109 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªadˇŒback
);

110 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
cou¡î
);

112 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, ()
	`°æí
(
UPLOADTHIS
));

114 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

115 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

116 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYUSERPWD
, 
libã°_¨g3
);

117 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYAUTH
,

118 (Ë(
CURLAUTH_NTLM
 | 
CURLAUTH_DIGEST
 | 
CURLAUTH_BASIC
) );

120 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

122 
ã°_˛ónup
:

124 
	`cuæ_ósy_˛ónup
(
cuæ
);

125 
	`cuæ_globÆ_˛ónup
();

127  ()
ªs
;

128 
	}
}

	@tests/libtest/lib549.c

27 
	~"ã°.h
"

29 
	~"memdebug.h
"

31 
	$ã°
(*
URL
)

33 
CURLcode
 
ªs
;

34 
CURL
 *
cuæ
;

36 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

37 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

38  
TEST_ERR_MAJOR_BAD
;

41 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

42 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

43 
	`cuæ_globÆ_˛ónup
();

44  
TEST_ERR_MAJOR_BAD
;

47 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

48 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

49 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXY_TRANSFER_MODE
, 1L);

50 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

51 if(
libã°_¨g3
) {

53 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_TRANSFERTEXT
, 1L);

56 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

58 
ã°_˛ónup
:

60 
	`cuæ_ósy_˛ónup
(
cuæ
);

61 
	`cuæ_globÆ_˛ónup
();

63  ()
ªs
;

64 
	}
}

	@tests/libtest/lib552.c

26 
	~"ã°.h
"

28 
	~"w¨∆ess.h
"

29 
	~"memdebug.h
"

31 
	sd©a
 {

32 
	måa˚_ascii
;

36 
	$dump
(c⁄° *
ãxt
,

37 
FILE
 *
°ªam
, *
±r
, 
size_t
 
size
,

38 
nohex
)

40 
size_t
 
i
;

41 
size_t
 
c
;

43 
width
=0x10;

45 if(
nohex
)

47 
width
 = 0x40;

49 
	`Ârötf
(
°ªam
, "%s, %d byã†(0x%x)\n", 
ãxt
, ()
size
, ()size);

51 
i
=0; i<
size
; i+
width
) {

53 
	`Ârötf
(
°ªam
, "%04x: ", ()
i
);

55 if(!
nohex
) {

57 
c
 = 0; c < 
width
; c++)

58 if(
i
+
c
 < 
size
)

59 
	`Ârötf
(
°ªam
, "%02x ", 
±r
[
i
+
c
]);

61 
	`Âuts
(" ", 
°ªam
);

64 
c
 = 0; (¯< 
width
Ë&& (
i
+¯< 
size
); c++) {

66 i‡(
nohex
 && (
i
+
c
+1 < 
size
Ë&& 
±r
[i+c]==0x0D &&Ötr[i+c+1]==0x0A) {

67 
i
+=(
c
+2-
width
);

70 
	`Ârötf
(
°ªam
, "%c",

71 (
±r
[
i
+
c
]>=0x20) && (ptr[i+c]<0x80)?ptr[i+c]:'.');

73 i‡(
nohex
 && (
i
+
c
+2 < 
size
Ë&& 
±r
[i+c+1]==0x0D &&Ötr[i+c+2]==0x0A) {

74 
i
+=(
c
+3-
width
);

78 
	`Âutc
('\n', 
°ªam
);

80 
	`fÊush
(
°ªam
);

81 
	}
}

84 
	$my_åa˚
(
CURL
 *
h™dÀ
, 
cuæ_öfŸy≥
 
ty≥
,

85 *
d©a
, 
size_t
 
size
,

86 *
u£Ω
)

88 
d©a
 *
c⁄fig
 = (d©®*)
u£Ω
;

89 c⁄° *
ãxt
;

90 ()
h™dÀ
;

92 
ty≥
) {

93 
CURLINFO_TEXT
:

94 
	`Ârötf
(
°dîr
, "=Info: %s", (*)
d©a
);

98 
CURLINFO_HEADER_OUT
:

99 
ãxt
 = "=> Send header";

101 
CURLINFO_DATA_OUT
:

102 
ãxt
 = "=> Send data";

104 
CURLINFO_SSL_DATA_OUT
:

105 
ãxt
 = "=> Send SSL data";

107 
CURLINFO_HEADER_IN
:

108 
ãxt
 = "<= Recv header";

110 
CURLINFO_DATA_IN
:

111 
ãxt
 = "<= Recv data";

113 
CURLINFO_SSL_DATA_IN
:

114 
ãxt
 = "<= Recv SSL data";

118 
	`dump
(
ãxt
, 
°dîr
, (*)
d©a
, 
size
, 
c⁄fig
->
åa˚_ascii
);

120 
	}
}

123 
size_t
 
	gcuºít_off£t
 = 0;

124 
	gd©abuf
[70000];

126 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

128 
size_t
 
amou¡
 = 
nmemb
 * 
size
;

129 
size_t
 
avaûabÀ
 = (
d©abuf
Ë- 
cuºít_off£t
;

130 
size_t
 
giví
 = 
amou¡
 < 
avaûabÀ
 ?ámount :ávailable;

131 ()
°ªam
;

132 
	`mem˝y
(
±r
, 
d©abuf
 + 
cuºít_off£t
, 
giví
);

133 
cuºít_off£t
 +
giví
;

134  
giví
;

135 
	}
}

138 
size_t
 
	$wrôe_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

140 
amou¡
 = 
	`cuæx_uztosi
(
size
 * 
nmemb
);

141 
	`¥ötf
("%.*s", 
amou¡
, (*)
±r
);

142 ()
°ªam
;

143  
size
 * 
nmemb
;

144 
	}
}

147 
cuæi€º
 
	$io˘l_ˇŒback
(
CURL
 * 
h™dÀ
, 
cmd
, *
˛õ¡p
)

149 ()
˛õ¡p
;

150 i‡(
cmd
 =
CURLIOCMD_RESTARTREAD
 ) {

151 
	`¥ötf
("APPLICATION:Ñecievedá CURLIOCMD_RESTARTREADÑequest\n");

152 
	`¥ötf
("APPLICATION: ** REWINDING! **\n");

153 
cuºít_off£t
 = 0;

154  
CURLIOE_OK
;

156 ()
h™dÀ
;

157  
CURLIOE_UNKNOWNCMD
;

158 
	}
}

162 
	$ã°
(*
URL
)

164 
CURL
 *
cuæ
;

165 
CURLcode
 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

166 
d©a
 
c⁄fig
;

167 
size_t
 
i
;

168 c⁄° 
fûl
[] = "test data";

170 
c⁄fig
.
åa˚_ascii
 = 1;

172 if((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

173 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

174 
	`cuæ_globÆ_˛ónup
();

175  
TEST_ERR_MAJOR_BAD
;

178 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_DEBUGFUNCTION
, 
my_åa˚
);

179 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_DEBUGDATA
, &
c⁄fig
);

181 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

184 
i
=0; i < (
d©abuf
); ++i)

185 
d©abuf
[
i
] = 
fûl
[i %  fill];

188 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

190 #ifde‡
CURL_DOES_CONVERSIONS


192 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_TRANSFERTEXT
, 1L);

196 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, (Ë(
d©abuf
));

197 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

200 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WRITEFUNCTION
, 
wrôe_ˇŒback
);

203 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_IOCTLFUNCTION
, 
io˘l_ˇŒback
);

205 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

207 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

210 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYAUTH
, ()
CURLAUTH_ANY
);

212 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

213 
	`Ârötf
(
°dîr
, "cuæ_ósy_≥rf‹m = %d\n", ()
ªs
);

215 
ã°_˛ónup
:

217 
	`cuæ_ósy_˛ónup
(
cuæ
);

218 
	`cuæ_globÆ_˛ónup
();

219  ()
ªs
;

220 
	}
}

	@tests/libtest/lib553.c

27 
	~"ã°.h
"

29 
	~"memdebug.h
"

31 
	#POSTLEN
 40960

	)

33 
size_t
 
	$myªadfunc
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
)

35 
size_t
 
tŸÆ
=
POSTLEN
;

36 
buf
[1024];

37 ()
°ªam
;

39 
	`mem£t
(
buf
, 'A', (buf));

41 
size
 *
nmemb
;

42 i‡(
size
 > 
tŸÆ
)

43 
size
 = 
tŸÆ
;

45 if(
size
 > (
buf
))

46 
size
 = (
buf
);

48 
	`mem˝y
(
±r
, 
buf
, 
size
);

49 
tŸÆ
 -
size
;

50  
size
;

51 
	}
}

53 
	#NUM_HEADERS
 8

	)

54 
	#SIZE_HEADERS
 5000

	)

56 
	gbuf
[
SIZE_HEADERS
 + 100];

58 
	$ã°
(*
URL
)

60 
CURL
 *
cuæ
;

61 
CURLcode
 
ªs
 = 
CURLE_FAILED_INIT
;

62 
i
;

63 
cuæ_¶i°
 *
hódîli°
=
NULL
, *
hl
;

65 if(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

66 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

67  
TEST_ERR_MAJOR_BAD
;

70 if((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

71 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

72 
	`cuæ_globÆ_˛ónup
();

73  
TEST_ERR_MAJOR_BAD
;

76 
i
 = 0; i < 
NUM_HEADERS
; i++) {

77 
Àn
 = 
	`•rötf
(
buf
, "Hódî%d: ", 
i
);

78 
	`mem£t
(&
buf
[
Àn
], 'A', 
SIZE_HEADERS
);

79 
buf
[
Àn
 + 
SIZE_HEADERS
]=0;

80 
hl
 = 
	`cuæ_¶i°_≠≥nd
(
hódîli°
, 
buf
);

81 i‡(!
hl
)

82 
ã°_˛ónup
;

83 
hódîli°
 = 
hl
;

86 
hl
 = 
	`cuæ_¶i°_≠≥nd
(
hódîli°
, "Expect: ");

87 i‡(!
hl
)

88 
ã°_˛ónup
;

89 
hódîli°
 = 
hl
;

91 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

92 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
hódîli°
);

93 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

94 #ifde‡
CURL_DOES_CONVERSIONS


96 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_TRANSFERTEXT
, 1L);

98 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, ()
POSTLEN
);

99 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

100 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

101 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
myªadfunc
);

103 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

105 
ã°_˛ónup
:

107 
	`cuæ_ósy_˛ónup
(
cuæ
);

109 
	`cuæ_¶i°_‰ì_Æl
(
hódîli°
);

111 
	`cuæ_globÆ_˛ónup
();

113  ()
ªs
;

114 
	}
}

	@tests/libtest/lib554.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	gd©a
[]=

27 #ifde‡
CURL_DOES_CONVERSIONS


36 
	sWrôeThis
 {

37 *
	mªad±r
;

38 
size_t
 
	msizñe·
;

41 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

43 #ifde‡
LIB587


44 ()
±r
;

45 ()
size
;

46 ()
nmemb
;

47 ()
u£Ω
;

48  
CURL_READFUNC_ABORT
;

51 
WrôeThis
 *
pooh
 = (WrôeThi†*)
u£Ω
;

53 if(
size
*
nmemb
 < 1)

56 if(
pooh
->
sizñe·
) {

57 *(*)
±r
 = 
pooh
->
ªad±r
[0];

58 
pooh
->
ªad±r
++;

59 
pooh
->
sizñe·
--;

65 
	}
}

67 
	$ã°
(*
URL
)

69 
CURL
 *
cuæ
;

70 
CURLcode
 
ªs
=
CURLE_OK
;

71 
CURLFORMcode
 
f‹mrc
;

73 
cuæ_hâµo°
 *
f‹mpo°
=
NULL
;

74 
cuæ_hâµo°
 *
œ°±r
=
NULL
;

75 
WrôeThis
 
pooh
;

76 
WrôeThis
 
pooh2
;

78 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

79 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

80  
TEST_ERR_MAJOR_BAD
;

83 
pooh
.
ªad±r
 = 
d©a
;

84 
pooh
.
sizñe·
 = 
	`°æí
(
d©a
);

87 
f‹mrc
 = 
	`cuæ_f‹madd
(&
f‹mpo°
,

88 &
œ°±r
,

89 
CURLFORM_COPYNAME
, "sendfile",

90 
CURLFORM_STREAM
, &
pooh
,

91 
CURLFORM_CONTENTSLENGTH
, ()
pooh
.
sizñe·
,

92 
CURLFORM_FILENAME
, "postit2.c",

93 
CURLFORM_END
);

95 if(
f‹mrc
)

96 
	`¥ötf
("cuæ_f‹madd(1Ë%d\n", ()
f‹mrc
);

101 
pooh2
.
ªad±r
 = 
d©a
;

102 
pooh2
.
sizñe·
 = 
	`°æí
(
d©a
);

105 
f‹mrc
 = 
	`cuæ_f‹madd
(&
f‹mpo°
,

106 &
œ°±r
,

107 
CURLFORM_COPYNAME
, "callbackdata",

108 
CURLFORM_STREAM
, &
pooh2
,

109 
CURLFORM_CONTENTSLENGTH
, ()
pooh2
.
sizñe·
,

110 
CURLFORM_END
);

112 if(
f‹mrc
)

113 
	`¥ötf
("cuæ_f‹madd(1Ë%d\n", ()
f‹mrc
);

116 
f‹mrc
 = 
	`cuæ_f‹madd
(&
f‹mpo°
,

117 &
œ°±r
,

118 
CURLFORM_COPYNAME
, "filename",

119 #ifde‡
CURL_DOES_CONVERSIONS


122 
CURLFORM_COPYCONTENTS
,

125 
CURLFORM_COPYCONTENTS
, "postit2.c",

127 
CURLFORM_END
);

129 if(
f‹mrc
)

130 
	`¥ötf
("cuæ_f‹madd(2Ë%d\n", ()
f‹mrc
);

133 
f‹mrc
 = 
	`cuæ_f‹madd
(&
f‹mpo°
,

134 &
œ°±r
,

135 
CURLFORM_COPYNAME
, "submit",

136 #ifde‡
CURL_DOES_CONVERSIONS


139 
CURLFORM_COPYCONTENTS
, "\x73\x65\x6e\x64",

141 
CURLFORM_COPYCONTENTS
, "send",

143 
CURLFORM_END
);

145 if(
f‹mrc
)

146 
	`¥ötf
("cuæ_f‹madd(3Ë%d\n", ()
f‹mrc
);

148 
f‹mrc
 = 
	`cuæ_f‹madd
(&
f‹mpo°
, &
œ°±r
,

149 
CURLFORM_COPYNAME
, "somename",

150 
CURLFORM_BUFFER
, "somefile.txt",

151 
CURLFORM_BUFFERPTR
, "blah blah",

152 
CURLFORM_BUFFERLENGTH
, ()9,

153 
CURLFORM_END
);

155 if(
f‹mrc
)

156 
	`¥ötf
("cuæ_f‹madd(4Ë%d\n", ()
f‹mrc
);

158 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

159 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

160 
	`cuæ_f‹m‰ì
(
f‹mpo°
);

161 
	`cuæ_globÆ_˛ónup
();

162  
TEST_ERR_MAJOR_BAD
;

166 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

169 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

172 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, ()
pooh
.
sizñe·
);

175 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

178 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPPOST
, 
f‹mpo°
);

181 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

184 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

187 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

189 
ã°_˛ónup
:

192 
	`cuæ_ósy_˛ónup
(
cuæ
);

193 
	`cuæ_globÆ_˛ónup
();

196 
	`cuæ_f‹m‰ì
(
f‹mpo°
);

198  
ªs
;

199 
	}
}

	@tests/libtest/lib555.c

31 
	~"ã°.h
"

32 
	~"ã°utû.h
"

33 
	~"w¨∆ess.h
"

34 
	~"memdebug.h
"

36 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

38 
	#UPLOADTHIS
 "thi†i†thêblurb wêw™àtÿu∂ﬂd\n"

	)

40 
size_t
 
	$ªadˇŒback
(*
±r
,

41 
size_t
 
size
,

42 
size_t
 
nmemb
,

43 *
˛õ¡p
)

45 *
cou¡î
 = (*)
˛õ¡p
;

47 if(*
cou¡î
) {

49 
	`Ârötf
(
°dîr
, "READ ALREADY DONE!\n");

52 (*
cou¡î
)++;

54 if(
size
 * 
nmemb
 > 
	`°æí
(
UPLOADTHIS
)) {

55 
	`Ârötf
(
°dîr
, "READ!\n");

56 
	`°r˝y
(
±r
, 
UPLOADTHIS
);

57  
	`°æí
(
UPLOADTHIS
);

59 
	`Ârötf
(
°dîr
, "READ NOT FINE!\n");

61 
	}
}

62 
cuæi€º
 
	$io˘lˇŒback
(
CURL
 *
h™dÀ
,

63 
cmd
,

64 *
˛õ¡p
)

66 *
cou¡î
 = (*)
˛õ¡p
;

67 ()
h™dÀ
;

68 if(
cmd
 =
CURLIOCMD_RESTARTREAD
) {

69 
	`Ârötf
(
°dîr
, "REWIND!\n");

70 *
cou¡î
 = 0;

72  
CURLIOE_OK
;

73 
	}
}

76 
	$ã°
(*
URL
)

78 
ªs
 = 0;

79 
CURL
 *
cuæ
 = 
NULL
;

80 
cou¡î
=0;

81 
CURLM
 *
m
 = 
NULL
;

82 
ru¬ög
=1;

84 
	`°¨t_ã°_timög
();

86 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

88 
	`ósy_öô
(
cuæ
);

90 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

91 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

92 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

95 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_IOCTLFUNCTION
, 
io˘lˇŒback
);

96 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_IOCTLDATA
, &
cou¡î
);

97 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªadˇŒback
);

98 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
cou¡î
);

100 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, 
	`°æí
(
UPLOADTHIS
));

102 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

103 #ifde‡
CURL_DOES_CONVERSIONS


105 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_TRANSFERTEXT
, 1L);

107 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

108 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_PROXYUSERPWD
, 
libã°_¨g3
);

109 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_PROXYAUTH
,

110 (Ë(
CURLAUTH_NTLM
 | 
CURLAUTH_DIGEST
 | 
CURLAUTH_BASIC
) );

112 
	`mu…i_öô
(
m
);

114 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
);

116 
ru¬ög
) {

117 
timevÆ
 
timeout
;

118 
fd_£t
 
fdªad
, 
fdwrôe
, 
fdex˚p
;

119 
maxfd
 = -99;

121 
timeout
.
tv_£c
 = 0;

122 
timeout
.
tv_u£c
 = 100000L;

124 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

126 
	`ab‹t_⁄_ã°_timeout
();

128 #ifde‡
TPF


129 
	`¶ìp
(1);

132 if(!
ru¬ög
)

135 
	`FD_ZERO
(&
fdªad
);

136 
	`FD_ZERO
(&
fdwrôe
);

137 
	`FD_ZERO
(&
fdex˚p
);

139 
	`mu…i_fd£t
(
m
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

143 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

145 
	`ab‹t_⁄_ã°_timeout
();

148 
ã°_˛ónup
:

152 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
cuæ
);

153 
	`cuæ_mu…i_˛ónup
(
m
);

154 
	`cuæ_ósy_˛ónup
(
cuæ
);

155 
	`cuæ_globÆ_˛ónup
();

157  
ªs
;

158 
	}
}

	@tests/libtest/lib556.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

27 #i‚de‡
STDIN_FILENO


28 
	#STDIN_FILENO
 0

	)

30 #i‚de‡
STDOUT_FILENO


31 
	#STDOUT_FILENO
 1

	)

33 #i‚de‡
STDERR_FILENO


34 
	#STDERR_FILENO
 2

	)

37 
	$ã°
(*
URL
)

39 
CURLcode
 
ªs
;

40 
CURL
 *
cuæ
;

42 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

43 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

44  
TEST_ERR_MAJOR_BAD
;

47 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

48 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

49 
	`cuæ_globÆ_˛ónup
();

50  
TEST_ERR_MAJOR_BAD
;

53 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

54 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_CONNECT_ONLY
, 1L);

55 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

57 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

59 if(!
ªs
) {

61 c⁄° *
ªque°
 =

62 #ifde‡
CURL_DOES_CONVERSIONS


71 
size_t
 
iﬁí
;

72 
buf
[1024];

74 
ªs
 = 
	`cuæ_ósy_£nd
(
cuæ
, 
ªque°
, 
	`°æí
‘eque°), &
iﬁí
);

76 if(!
ªs
) {

78 
size_t
 
tŸÆ
=0;

82 
ªs
 = 
	`cuæ_ósy_ªcv
(
cuæ
, 
buf
, 1024, &
iﬁí
);

84 #ifde‡
TPF


85 
	`¶ìp
(1);

88 if(
iﬁí
) {

90 if(!
	`wrôe
(
STDOUT_FILENO
, 
buf
, 
iﬁí
))

93 
tŸÆ
 +
iﬁí
;

95 } ((
ªs
 =
CURLE_OK
Ë|| (ª†=
CURLE_AGAIN
)Ë&& (
tŸÆ
 < 129));

99 
ã°_˛ónup
:

101 
	`cuæ_ósy_˛ónup
(
cuæ
);

102 
	`cuæ_globÆ_˛ónup
();

104  ()
ªs
;

105 
	}
}

	@tests/libtest/lib557.c

28 
	~"ã°.h
"

30 
	~<cuæ/m¥ötf.h
>

32 
	~"memdebug.h
"

35 #i‡(
CURL_SIZEOF_CURL_OFF_T
 > 
CURL_SIZEOF_LONG
)

36 
	#MPRNT_SUFFIX_CURL_OFF_T
 
LL


	)

38 
	#MPRNT_SUFFIX_CURL_OFF_T
 
L


	)

42 #ifde‡
CURL_ISOCPP


43 
	#MPRNT_OFF_T_C_HELPER2
(
VÆ
,
Suffix
ËVÆ ## 
	)
Suffix

45 
	#MPRNT_OFF_T_C_HELPER2
(
VÆ
,
Suffix
ËVÆ 
	)
Suffix

47 
	#MPRNT_OFF_T_C_HELPER1
(
VÆ
,
Suffix
Ë
	`MPRNT_OFF_T_C_HELPER2
(VÆ,Suffix)

	)

48 
	#MPRNT_OFF_T_C
(
VÆ
Ë
	`MPRNT_OFF_T_C_HELPER1
(VÆ,
MPRNT_SUFFIX_CURL_OFF_T
)

	)

51 
	#BUFSZ
 256

	)

52 
	#USHORT_TESTS_ARRSZ
 1 + 100

	)

53 
	#SSHORT_TESTS_ARRSZ
 1 + 100

	)

54 
	#UINT_TESTS_ARRSZ
 1 + 100

	)

55 
	#SINT_TESTS_ARRSZ
 1 + 100

	)

56 
	#ULONG_TESTS_ARRSZ
 1 + 100

	)

57 
	#SLONG_TESTS_ARRSZ
 1 + 100

	)

58 
	#COFFT_TESTS_ARRSZ
 1 + 100

	)

61 
	sunssh‹t_°
 {

62 
	mnum
;

63 c⁄° *
	mex≥˘ed
;

64 
	mªsu…
[
BUFSZ
];

68 
	ssigsh‹t_°
 {

69 
	mnum
;

70 c⁄° *
	mex≥˘ed
;

71 
	mªsu…
[
BUFSZ
];

75 
	sunsöt_°
 {

76 
	mnum
;

77 c⁄° *
	mex≥˘ed
;

78 
	mªsu…
[
BUFSZ
];

82 
	ssigöt_°
 {

83 
	mnum
;

84 c⁄° *
	mex≥˘ed
;

85 
	mªsu…
[
BUFSZ
];

89 
	sun¶⁄g_°
 {

90 
	mnum
;

91 c⁄° *
	mex≥˘ed
;

92 
	mªsu…
[
BUFSZ
];

96 
	ssigl⁄g_°
 {

97 
	mnum
;

98 c⁄° *
	mex≥˘ed
;

99 
	mªsu…
[
BUFSZ
];

103 
	scuæoff_°
 {

104 
cuæ_off_t
 
	mnum
;

105 c⁄° *
	mex≥˘ed
;

106 
	mªsu…
[
BUFSZ
];

110 
unssh‹t_°
 
	gus_ã°
[
USHORT_TESTS_ARRSZ
];

111 
sigsh‹t_°
 
	gss_ã°
[
SSHORT_TESTS_ARRSZ
];

112 
unsöt_°
 
	gui_ã°
[
UINT_TESTS_ARRSZ
];

113 
sigöt_°
 
	gsi_ã°
[
SINT_TESTS_ARRSZ
];

114 
un¶⁄g_°
 
	gul_ã°
[
ULONG_TESTS_ARRSZ
];

115 
sigl⁄g_°
 
	g¶_ã°
[
SLONG_TESTS_ARRSZ
];

116 
cuæoff_°
 
	gco_ã°
[
COFFT_TESTS_ARRSZ
];

119 
	$ã°_unsig√d_sh‹t_f‹m©tög
()

121 
i
, 
j
;

122 
num_ush‹t_ã°s
;

123 
Áûed
 = 0;

125 #i‡(
SIZEOF_SHORT
 == 1)

127 
i
=1; 
us_ã°
[i].
num
 = 0xFFU; us_ã°[i].
ex≥˘ed
 = "256";

128 
i
++; 
us_ã°
[i].
num
 = 0xF0U; us_ã°[i].
ex≥˘ed
 = "240";

129 
i
++; 
us_ã°
[i].
num
 = 0x0FU; us_ã°[i].
ex≥˘ed
 = "15";

131 
i
++; 
us_ã°
[i].
num
 = 0xE0U; us_ã°[i].
ex≥˘ed
 = "224";

132 
i
++; 
us_ã°
[i].
num
 = 0x0EU; us_ã°[i].
ex≥˘ed
 = "14";

134 
i
++; 
us_ã°
[i].
num
 = 0xC0U; us_ã°[i].
ex≥˘ed
 = "192";

135 
i
++; 
us_ã°
[i].
num
 = 0x0CU; us_ã°[i].
ex≥˘ed
 = "12";

137 
i
++; 
us_ã°
[i].
num
 = 0x01U; us_ã°[i].
ex≥˘ed
 = "1";

138 
i
++; 
us_ã°
[i].
num
 = 0x00U; us_ã°[i].
ex≥˘ed
 = "0";

140 
num_ush‹t_ã°s
 = 
i
;

142 #ñi‡(
SIZEOF_SHORT
 == 2)

144 
i
=1; 
us_ã°
[i].
num
 = 0xFFFFU; us_ã°[i].
ex≥˘ed
 = "65535";

145 
i
++; 
us_ã°
[i].
num
 = 0xFF00U; us_ã°[i].
ex≥˘ed
 = "65280";

146 
i
++; 
us_ã°
[i].
num
 = 0x00FFU; us_ã°[i].
ex≥˘ed
 = "255";

148 
i
++; 
us_ã°
[i].
num
 = 0xF000U; us_ã°[i].
ex≥˘ed
 = "61440";

149 
i
++; 
us_ã°
[i].
num
 = 0x0F00U; us_ã°[i].
ex≥˘ed
 = "3840";

150 
i
++; 
us_ã°
[i].
num
 = 0x00F0U; us_ã°[i].
ex≥˘ed
 = "240";

151 
i
++; 
us_ã°
[i].
num
 = 0x000FU; us_ã°[i].
ex≥˘ed
 = "15";

153 
i
++; 
us_ã°
[i].
num
 = 0xC000U; us_ã°[i].
ex≥˘ed
 = "49152";

154 
i
++; 
us_ã°
[i].
num
 = 0x0C00U; us_ã°[i].
ex≥˘ed
 = "3072";

155 
i
++; 
us_ã°
[i].
num
 = 0x00C0U; us_ã°[i].
ex≥˘ed
 = "192";

156 
i
++; 
us_ã°
[i].
num
 = 0x000CU; us_ã°[i].
ex≥˘ed
 = "12";

158 
i
++; 
us_ã°
[i].
num
 = 0x0001U; us_ã°[i].
ex≥˘ed
 = "1";

159 
i
++; 
us_ã°
[i].
num
 = 0x0000U; us_ã°[i].
ex≥˘ed
 = "0";

161 
num_ush‹t_ã°s
 = 
i
;

163 #ñi‡(
SIZEOF_SHORT
 == 4)

165 
i
=1; 
us_ã°
[i].
num
 = 0xFFFFFFFFU; us_ã°[i].
ex≥˘ed
 = "4294967295";

166 
i
++; 
us_ã°
[i].
num
 = 0xFFFF0000U; us_ã°[i].
ex≥˘ed
 = "4294901760";

167 
i
++; 
us_ã°
[i].
num
 = 0x0000FFFFU; us_ã°[i].
ex≥˘ed
 = "65535";

169 
i
++; 
us_ã°
[i].
num
 = 0xFF000000U; us_ã°[i].
ex≥˘ed
 = "4278190080";

170 
i
++; 
us_ã°
[i].
num
 = 0x00FF0000U; us_ã°[i].
ex≥˘ed
 = "16711680";

171 
i
++; 
us_ã°
[i].
num
 = 0x0000FF00U; us_ã°[i].
ex≥˘ed
 = "65280";

172 
i
++; 
us_ã°
[i].
num
 = 0x000000FFU; us_ã°[i].
ex≥˘ed
 = "255";

174 
i
++; 
us_ã°
[i].
num
 = 0xF0000000U; us_ã°[i].
ex≥˘ed
 = "4026531840";

175 
i
++; 
us_ã°
[i].
num
 = 0x0F000000U; us_ã°[i].
ex≥˘ed
 = "251658240";

176 
i
++; 
us_ã°
[i].
num
 = 0x00F00000U; us_ã°[i].
ex≥˘ed
 = "15728640";

177 
i
++; 
us_ã°
[i].
num
 = 0x000F0000U; us_ã°[i].
ex≥˘ed
 = "983040";

178 
i
++; 
us_ã°
[i].
num
 = 0x0000F000U; us_ã°[i].
ex≥˘ed
 = "61440";

179 
i
++; 
us_ã°
[i].
num
 = 0x00000F00U; us_ã°[i].
ex≥˘ed
 = "3840";

180 
i
++; 
us_ã°
[i].
num
 = 0x000000F0U; us_ã°[i].
ex≥˘ed
 = "240";

181 
i
++; 
us_ã°
[i].
num
 = 0x0000000FU; us_ã°[i].
ex≥˘ed
 = "15";

183 
i
++; 
us_ã°
[i].
num
 = 0xC0000000U; us_ã°[i].
ex≥˘ed
 = "3221225472";

184 
i
++; 
us_ã°
[i].
num
 = 0x0C000000U; us_ã°[i].
ex≥˘ed
 = "201326592";

185 
i
++; 
us_ã°
[i].
num
 = 0x00C00000U; us_ã°[i].
ex≥˘ed
 = "12582912";

186 
i
++; 
us_ã°
[i].
num
 = 0x000C0000U; us_ã°[i].
ex≥˘ed
 = "786432";

187 
i
++; 
us_ã°
[i].
num
 = 0x0000C000U; us_ã°[i].
ex≥˘ed
 = "49152";

188 
i
++; 
us_ã°
[i].
num
 = 0x00000C00U; us_ã°[i].
ex≥˘ed
 = "3072";

189 
i
++; 
us_ã°
[i].
num
 = 0x000000C0U; us_ã°[i].
ex≥˘ed
 = "192";

190 
i
++; 
us_ã°
[i].
num
 = 0x0000000CU; us_ã°[i].
ex≥˘ed
 = "12";

192 
i
++; 
us_ã°
[i].
num
 = 0x00000001U; us_ã°[i].
ex≥˘ed
 = "1";

193 
i
++; 
us_ã°
[i].
num
 = 0x00000000U; us_ã°[i].
ex≥˘ed
 = "0";

195 
num_ush‹t_ã°s
 = 
i
;

199 
i
=1; i<=
num_ush‹t_ã°s
; i++) {

201 
j
=0; j<
BUFSZ
; j++)

202 
us_ã°
[
i
].
ªsu…
[
j
] = 'X';

203 
us_ã°
[
i
].
ªsu…
[
BUFSZ
-1] = '\0';

205 ()
	`cuæ_m•rötf
(
us_ã°
[
i
].
ªsu…
, "%hu", us_ã°[i].
num
);

207 if(
	`memcmp
(
us_ã°
[
i
].
ªsu…
,

208 
us_ã°
[
i
].
ex≥˘ed
,

209 
	`°æí
(
us_ã°
[
i
].
ex≥˘ed
))) {

210 
	`¥ötf
("unsigned shortÅest #%.2d: Failed (Expected: %s Got: %s)\n",

211 
i
, 
us_ã°
[i].
ex≥˘ed
, us_ã°[i].
ªsu…
);

212 
Áûed
++;

217 if(!
Áûed
)

218 
	`¥ötf
("All curl_mprintf() unsigned shortÅests OK!\n");

220 
	`¥ötf
("Some curl_mprintf() unsigned shortÅests Failed!\n");

222  
Áûed
;

223 
	}
}

226 
	$ã°_sig√d_sh‹t_f‹m©tög
()

228 
i
, 
j
;

229 
num_ssh‹t_ã°s
;

230 
Áûed
 = 0;

232 #i‡(
SIZEOF_SHORT
 == 1)

234 
i
=1; 
ss_ã°
[i].
num
 = 0x7F; ss_ã°[i].
ex≥˘ed
 = "127";

236 
i
++; 
ss_ã°
[i].
num
 = 0x70; ss_ã°[i].
ex≥˘ed
 = "112";

237 
i
++; 
ss_ã°
[i].
num
 = 0x07; ss_ã°[i].
ex≥˘ed
 = "7";

239 
i
++; 
ss_ã°
[i].
num
 = 0x50; ss_ã°[i].
ex≥˘ed
 = "80";

240 
i
++; 
ss_ã°
[i].
num
 = 0x05; ss_ã°[i].
ex≥˘ed
 = "5";

242 
i
++; 
ss_ã°
[i].
num
 = 0x01; ss_ã°[i].
ex≥˘ed
 = "1";

243 
i
++; 
ss_ã°
[i].
num
 = 0x00; ss_ã°[i].
ex≥˘ed
 = "0";

245 
i
++; 
ss_ã°
[i].
num
 = -0x7F -1; ss_ã°[i].
ex≥˘ed
 = "-128";

247 
i
++; 
ss_ã°
[i].
num
 = -0x70 -1; ss_ã°[i].
ex≥˘ed
 = "-113";

248 
i
++; 
ss_ã°
[i].
num
 = -0x07 -1; ss_ã°[i].
ex≥˘ed
 = "-8";

250 
i
++; 
ss_ã°
[i].
num
 = -0x50 -1; ss_ã°[i].
ex≥˘ed
 = "-81";

251 
i
++; 
ss_ã°
[i].
num
 = -0x05 -1; ss_ã°[i].
ex≥˘ed
 = "-6";

253 
i
++; 
ss_ã°
[i].
num
 = 0x00 -1; ss_ã°[i].
ex≥˘ed
 = "-1";

255 
num_ssh‹t_ã°s
 = 
i
;

257 #ñi‡(
SIZEOF_SHORT
 == 2)

259 
i
=1; 
ss_ã°
[i].
num
 = 0x7FFF; ss_ã°[i].
ex≥˘ed
 = "32767";

260 
i
++; 
ss_ã°
[i].
num
 = 0x7FFE; ss_ã°[i].
ex≥˘ed
 = "32766";

261 
i
++; 
ss_ã°
[i].
num
 = 0x7FFD; ss_ã°[i].
ex≥˘ed
 = "32765";

262 
i
++; 
ss_ã°
[i].
num
 = 0x7F00; ss_ã°[i].
ex≥˘ed
 = "32512";

263 
i
++; 
ss_ã°
[i].
num
 = 0x07F0; ss_ã°[i].
ex≥˘ed
 = "2032";

264 
i
++; 
ss_ã°
[i].
num
 = 0x007F; ss_ã°[i].
ex≥˘ed
 = "127";

266 
i
++; 
ss_ã°
[i].
num
 = 0x7000; ss_ã°[i].
ex≥˘ed
 = "28672";

267 
i
++; 
ss_ã°
[i].
num
 = 0x0700; ss_ã°[i].
ex≥˘ed
 = "1792";

268 
i
++; 
ss_ã°
[i].
num
 = 0x0070; ss_ã°[i].
ex≥˘ed
 = "112";

269 
i
++; 
ss_ã°
[i].
num
 = 0x0007; ss_ã°[i].
ex≥˘ed
 = "7";

271 
i
++; 
ss_ã°
[i].
num
 = 0x5000; ss_ã°[i].
ex≥˘ed
 = "20480";

272 
i
++; 
ss_ã°
[i].
num
 = 0x0500; ss_ã°[i].
ex≥˘ed
 = "1280";

273 
i
++; 
ss_ã°
[i].
num
 = 0x0050; ss_ã°[i].
ex≥˘ed
 = "80";

274 
i
++; 
ss_ã°
[i].
num
 = 0x0005; ss_ã°[i].
ex≥˘ed
 = "5";

276 
i
++; 
ss_ã°
[i].
num
 = 0x0001; ss_ã°[i].
ex≥˘ed
 = "1";

277 
i
++; 
ss_ã°
[i].
num
 = 0x0000; ss_ã°[i].
ex≥˘ed
 = "0";

279 
i
++; 
ss_ã°
[i].
num
 = -0x7FFF -1; ss_ã°[i].
ex≥˘ed
 = "-32768";

280 
i
++; 
ss_ã°
[i].
num
 = -0x7FFE -1; ss_ã°[i].
ex≥˘ed
 = "-32767";

281 
i
++; 
ss_ã°
[i].
num
 = -0x7FFD -1; ss_ã°[i].
ex≥˘ed
 = "-32766";

282 
i
++; 
ss_ã°
[i].
num
 = -0x7F00 -1; ss_ã°[i].
ex≥˘ed
 = "-32513";

283 
i
++; 
ss_ã°
[i].
num
 = -0x07F0 -1; ss_ã°[i].
ex≥˘ed
 = "-2033";

284 
i
++; 
ss_ã°
[i].
num
 = -0x007F -1; ss_ã°[i].
ex≥˘ed
 = "-128";

286 
i
++; 
ss_ã°
[i].
num
 = -0x7000 -1; ss_ã°[i].
ex≥˘ed
 = "-28673";

287 
i
++; 
ss_ã°
[i].
num
 = -0x0700 -1; ss_ã°[i].
ex≥˘ed
 = "-1793";

288 
i
++; 
ss_ã°
[i].
num
 = -0x0070 -1; ss_ã°[i].
ex≥˘ed
 = "-113";

289 
i
++; 
ss_ã°
[i].
num
 = -0x0007 -1; ss_ã°[i].
ex≥˘ed
 = "-8";

291 
i
++; 
ss_ã°
[i].
num
 = -0x5000 -1; ss_ã°[i].
ex≥˘ed
 = "-20481";

292 
i
++; 
ss_ã°
[i].
num
 = -0x0500 -1; ss_ã°[i].
ex≥˘ed
 = "-1281";

293 
i
++; 
ss_ã°
[i].
num
 = -0x0050 -1; ss_ã°[i].
ex≥˘ed
 = "-81";

294 
i
++; 
ss_ã°
[i].
num
 = -0x0005 -1; ss_ã°[i].
ex≥˘ed
 = "-6";

296 
i
++; 
ss_ã°
[i].
num
 = 0x0000 -1; ss_ã°[i].
ex≥˘ed
 = "-1";

298 
num_ssh‹t_ã°s
 = 
i
;

300 #ñi‡(
SIZEOF_SHORT
 == 4)

302 
i
=1; 
ss_ã°
[i].
num
 = 0x7FFFFFFF; ss_ã°[i].
ex≥˘ed
 = "2147483647";

303 
i
++; 
ss_ã°
[i].
num
 = 0x7FFFFFFE; ss_ã°[i].
ex≥˘ed
 = "2147483646";

304 
i
++; 
ss_ã°
[i].
num
 = 0x7FFFFFFD; ss_ã°[i].
ex≥˘ed
 = "2147483645";

305 
i
++; 
ss_ã°
[i].
num
 = 0x7FFF0000; ss_ã°[i].
ex≥˘ed
 = "2147418112";

306 
i
++; 
ss_ã°
[i].
num
 = 0x00007FFF; ss_ã°[i].
ex≥˘ed
 = "32767";

308 
i
++; 
ss_ã°
[i].
num
 = 0x7F000000; ss_ã°[i].
ex≥˘ed
 = "2130706432";

309 
i
++; 
ss_ã°
[i].
num
 = 0x007F0000; ss_ã°[i].
ex≥˘ed
 = "8323072";

310 
i
++; 
ss_ã°
[i].
num
 = 0x00007F00; ss_ã°[i].
ex≥˘ed
 = "32512";

311 
i
++; 
ss_ã°
[i].
num
 = 0x0000007F; ss_ã°[i].
ex≥˘ed
 = "127";

313 
i
++; 
ss_ã°
[i].
num
 = 0x70000000; ss_ã°[i].
ex≥˘ed
 = "1879048192";

314 
i
++; 
ss_ã°
[i].
num
 = 0x07000000; ss_ã°[i].
ex≥˘ed
 = "117440512";

315 
i
++; 
ss_ã°
[i].
num
 = 0x00700000; ss_ã°[i].
ex≥˘ed
 = "7340032";

316 
i
++; 
ss_ã°
[i].
num
 = 0x00070000; ss_ã°[i].
ex≥˘ed
 = "458752";

317 
i
++; 
ss_ã°
[i].
num
 = 0x00007000; ss_ã°[i].
ex≥˘ed
 = "28672";

318 
i
++; 
ss_ã°
[i].
num
 = 0x00000700; ss_ã°[i].
ex≥˘ed
 = "1792";

319 
i
++; 
ss_ã°
[i].
num
 = 0x00000070; ss_ã°[i].
ex≥˘ed
 = "112";

320 
i
++; 
ss_ã°
[i].
num
 = 0x00000007; ss_ã°[i].
ex≥˘ed
 = "7";

322 
i
++; 
ss_ã°
[i].
num
 = 0x50000000; ss_ã°[i].
ex≥˘ed
 = "1342177280";

323 
i
++; 
ss_ã°
[i].
num
 = 0x05000000; ss_ã°[i].
ex≥˘ed
 = "83886080";

324 
i
++; 
ss_ã°
[i].
num
 = 0x00500000; ss_ã°[i].
ex≥˘ed
 = "5242880";

325 
i
++; 
ss_ã°
[i].
num
 = 0x00050000; ss_ã°[i].
ex≥˘ed
 = "327680";

326 
i
++; 
ss_ã°
[i].
num
 = 0x00005000; ss_ã°[i].
ex≥˘ed
 = "20480";

327 
i
++; 
ss_ã°
[i].
num
 = 0x00000500; ss_ã°[i].
ex≥˘ed
 = "1280";

328 
i
++; 
ss_ã°
[i].
num
 = 0x00000050; ss_ã°[i].
ex≥˘ed
 = "80";

329 
i
++; 
ss_ã°
[i].
num
 = 0x00000005; ss_ã°[i].
ex≥˘ed
 = "5";

331 
i
++; 
ss_ã°
[i].
num
 = 0x00000001; ss_ã°[i].
ex≥˘ed
 = "1";

332 
i
++; 
ss_ã°
[i].
num
 = 0x00000000; ss_ã°[i].
ex≥˘ed
 = "0";

334 
i
++; 
ss_ã°
[i].
num
 = -0x7FFFFFFF -1; ss_ã°[i].
ex≥˘ed
 = "-2147483648";

335 
i
++; 
ss_ã°
[i].
num
 = -0x7FFFFFFE -1; ss_ã°[i].
ex≥˘ed
 = "-2147483647";

336 
i
++; 
ss_ã°
[i].
num
 = -0x7FFFFFFD -1; ss_ã°[i].
ex≥˘ed
 = "-2147483646";

337 
i
++; 
ss_ã°
[i].
num
 = -0x7FFF0000 -1; ss_ã°[i].
ex≥˘ed
 = "-2147418113";

338 
i
++; 
ss_ã°
[i].
num
 = -0x00007FFF -1; ss_ã°[i].
ex≥˘ed
 = "-32768";

340 
i
++; 
ss_ã°
[i].
num
 = -0x7F000000 -1; ss_ã°[i].
ex≥˘ed
 = "-2130706433";

341 
i
++; 
ss_ã°
[i].
num
 = -0x007F0000 -1; ss_ã°[i].
ex≥˘ed
 = "-8323073";

342 
i
++; 
ss_ã°
[i].
num
 = -0x00007F00 -1; ss_ã°[i].
ex≥˘ed
 = "-32513";

343 
i
++; 
ss_ã°
[i].
num
 = -0x0000007F -1; ss_ã°[i].
ex≥˘ed
 = "-128";

345 
i
++; 
ss_ã°
[i].
num
 = -0x70000000 -1; ss_ã°[i].
ex≥˘ed
 = "-1879048193";

346 
i
++; 
ss_ã°
[i].
num
 = -0x07000000 -1; ss_ã°[i].
ex≥˘ed
 = "-117440513";

347 
i
++; 
ss_ã°
[i].
num
 = -0x00700000 -1; ss_ã°[i].
ex≥˘ed
 = "-7340033";

348 
i
++; 
ss_ã°
[i].
num
 = -0x00070000 -1; ss_ã°[i].
ex≥˘ed
 = "-458753";

349 
i
++; 
ss_ã°
[i].
num
 = -0x00007000 -1; ss_ã°[i].
ex≥˘ed
 = "-28673";

350 
i
++; 
ss_ã°
[i].
num
 = -0x00000700 -1; ss_ã°[i].
ex≥˘ed
 = "-1793";

351 
i
++; 
ss_ã°
[i].
num
 = -0x00000070 -1; ss_ã°[i].
ex≥˘ed
 = "-113";

352 
i
++; 
ss_ã°
[i].
num
 = -0x00000007 -1; ss_ã°[i].
ex≥˘ed
 = "-8";

354 
i
++; 
ss_ã°
[i].
num
 = -0x50000000 -1; ss_ã°[i].
ex≥˘ed
 = "-1342177281";

355 
i
++; 
ss_ã°
[i].
num
 = -0x05000000 -1; ss_ã°[i].
ex≥˘ed
 = "-83886081";

356 
i
++; 
ss_ã°
[i].
num
 = -0x00500000 -1; ss_ã°[i].
ex≥˘ed
 = "-5242881";

357 
i
++; 
ss_ã°
[i].
num
 = -0x00050000 -1; ss_ã°[i].
ex≥˘ed
 = "-327681";

358 
i
++; 
ss_ã°
[i].
num
 = -0x00005000 -1; ss_ã°[i].
ex≥˘ed
 = "-20481";

359 
i
++; 
ss_ã°
[i].
num
 = -0x00000500 -1; ss_ã°[i].
ex≥˘ed
 = "-1281";

360 
i
++; 
ss_ã°
[i].
num
 = -0x00000050 -1; ss_ã°[i].
ex≥˘ed
 = "-81";

361 
i
++; 
ss_ã°
[i].
num
 = -0x00000005 -1; ss_ã°[i].
ex≥˘ed
 = "-6";

363 
i
++; 
ss_ã°
[i].
num
 = 0x00000000 -1; ss_ã°[i].
ex≥˘ed
 = "-1";

365 
num_ssh‹t_ã°s
 = 
i
;

369 
i
=1; i<=
num_ssh‹t_ã°s
; i++) {

371 
j
=0; j<
BUFSZ
; j++)

372 
ss_ã°
[
i
].
ªsu…
[
j
] = 'X';

373 
ss_ã°
[
i
].
ªsu…
[
BUFSZ
-1] = '\0';

375 ()
	`cuæ_m•rötf
(
ss_ã°
[
i
].
ªsu…
, "%hd", ss_ã°[i].
num
);

377 if(
	`memcmp
(
ss_ã°
[
i
].
ªsu…
,

378 
ss_ã°
[
i
].
ex≥˘ed
,

379 
	`°æí
(
ss_ã°
[
i
].
ex≥˘ed
))) {

380 
	`¥ötf
("signed shortÅest #%.2d: Failed (Expected: %s Got: %s)\n",

381 
i
, 
ss_ã°
[i].
ex≥˘ed
, ss_ã°[i].
ªsu…
);

382 
Áûed
++;

387 if(!
Áûed
)

388 
	`¥ötf
("All curl_mprintf() signed shortÅests OK!\n");

390 
	`¥ötf
("Some curl_mprintf() signed shortÅests Failed!\n");

392  
Áûed
;

393 
	}
}

396 
	$ã°_unsig√d_öt_f‹m©tög
()

398 
i
, 
j
;

399 
num_uöt_ã°s
;

400 
Áûed
 = 0;

402 #i‡(
SIZEOF_INT
 == 2)

404 
i
=1; 
ui_ã°
[i].
num
 = 0xFFFFU; ui_ã°[i].
ex≥˘ed
 = "65535";

405 
i
++; 
ui_ã°
[i].
num
 = 0xFF00U; ui_ã°[i].
ex≥˘ed
 = "65280";

406 
i
++; 
ui_ã°
[i].
num
 = 0x00FFU; ui_ã°[i].
ex≥˘ed
 = "255";

408 
i
++; 
ui_ã°
[i].
num
 = 0xF000U; ui_ã°[i].
ex≥˘ed
 = "61440";

409 
i
++; 
ui_ã°
[i].
num
 = 0x0F00U; ui_ã°[i].
ex≥˘ed
 = "3840";

410 
i
++; 
ui_ã°
[i].
num
 = 0x00F0U; ui_ã°[i].
ex≥˘ed
 = "240";

411 
i
++; 
ui_ã°
[i].
num
 = 0x000FU; ui_ã°[i].
ex≥˘ed
 = "15";

413 
i
++; 
ui_ã°
[i].
num
 = 0xC000U; ui_ã°[i].
ex≥˘ed
 = "49152";

414 
i
++; 
ui_ã°
[i].
num
 = 0x0C00U; ui_ã°[i].
ex≥˘ed
 = "3072";

415 
i
++; 
ui_ã°
[i].
num
 = 0x00C0U; ui_ã°[i].
ex≥˘ed
 = "192";

416 
i
++; 
ui_ã°
[i].
num
 = 0x000CU; ui_ã°[i].
ex≥˘ed
 = "12";

418 
i
++; 
ui_ã°
[i].
num
 = 0x0001U; ui_ã°[i].
ex≥˘ed
 = "1";

419 
i
++; 
ui_ã°
[i].
num
 = 0x0000U; ui_ã°[i].
ex≥˘ed
 = "0";

421 
num_uöt_ã°s
 = 
i
;

423 #ñi‡(
SIZEOF_INT
 == 4)

425 
i
=1; 
ui_ã°
[i].
num
 = 0xFFFFFFFFU; ui_ã°[i].
ex≥˘ed
 = "4294967295";

426 
i
++; 
ui_ã°
[i].
num
 = 0xFFFF0000U; ui_ã°[i].
ex≥˘ed
 = "4294901760";

427 
i
++; 
ui_ã°
[i].
num
 = 0x0000FFFFU; ui_ã°[i].
ex≥˘ed
 = "65535";

429 
i
++; 
ui_ã°
[i].
num
 = 0xFF000000U; ui_ã°[i].
ex≥˘ed
 = "4278190080";

430 
i
++; 
ui_ã°
[i].
num
 = 0x00FF0000U; ui_ã°[i].
ex≥˘ed
 = "16711680";

431 
i
++; 
ui_ã°
[i].
num
 = 0x0000FF00U; ui_ã°[i].
ex≥˘ed
 = "65280";

432 
i
++; 
ui_ã°
[i].
num
 = 0x000000FFU; ui_ã°[i].
ex≥˘ed
 = "255";

434 
i
++; 
ui_ã°
[i].
num
 = 0xF0000000U; ui_ã°[i].
ex≥˘ed
 = "4026531840";

435 
i
++; 
ui_ã°
[i].
num
 = 0x0F000000U; ui_ã°[i].
ex≥˘ed
 = "251658240";

436 
i
++; 
ui_ã°
[i].
num
 = 0x00F00000U; ui_ã°[i].
ex≥˘ed
 = "15728640";

437 
i
++; 
ui_ã°
[i].
num
 = 0x000F0000U; ui_ã°[i].
ex≥˘ed
 = "983040";

438 
i
++; 
ui_ã°
[i].
num
 = 0x0000F000U; ui_ã°[i].
ex≥˘ed
 = "61440";

439 
i
++; 
ui_ã°
[i].
num
 = 0x00000F00U; ui_ã°[i].
ex≥˘ed
 = "3840";

440 
i
++; 
ui_ã°
[i].
num
 = 0x000000F0U; ui_ã°[i].
ex≥˘ed
 = "240";

441 
i
++; 
ui_ã°
[i].
num
 = 0x0000000FU; ui_ã°[i].
ex≥˘ed
 = "15";

443 
i
++; 
ui_ã°
[i].
num
 = 0xC0000000U; ui_ã°[i].
ex≥˘ed
 = "3221225472";

444 
i
++; 
ui_ã°
[i].
num
 = 0x0C000000U; ui_ã°[i].
ex≥˘ed
 = "201326592";

445 
i
++; 
ui_ã°
[i].
num
 = 0x00C00000U; ui_ã°[i].
ex≥˘ed
 = "12582912";

446 
i
++; 
ui_ã°
[i].
num
 = 0x000C0000U; ui_ã°[i].
ex≥˘ed
 = "786432";

447 
i
++; 
ui_ã°
[i].
num
 = 0x0000C000U; ui_ã°[i].
ex≥˘ed
 = "49152";

448 
i
++; 
ui_ã°
[i].
num
 = 0x00000C00U; ui_ã°[i].
ex≥˘ed
 = "3072";

449 
i
++; 
ui_ã°
[i].
num
 = 0x000000C0U; ui_ã°[i].
ex≥˘ed
 = "192";

450 
i
++; 
ui_ã°
[i].
num
 = 0x0000000CU; ui_ã°[i].
ex≥˘ed
 = "12";

452 
i
++; 
ui_ã°
[i].
num
 = 0x00000001U; ui_ã°[i].
ex≥˘ed
 = "1";

453 
i
++; 
ui_ã°
[i].
num
 = 0x00000000U; ui_ã°[i].
ex≥˘ed
 = "0";

455 
num_uöt_ã°s
 = 
i
;

457 #ñi‡(
SIZEOF_INT
 == 8)

459 
i
=1; 
ui_ã°
[i].
num
 = 0xFFFFFFFFFFFFFFFFU; ui_ã°[i].
ex≥˘ed
 = "18446744073709551615";

460 
i
++; 
ui_ã°
[i].
num
 = 0xFFFFFFFF00000000U; ui_ã°[i].
ex≥˘ed
 = "18446744069414584320";

461 
i
++; 
ui_ã°
[i].
num
 = 0x00000000FFFFFFFFU; ui_ã°[i].
ex≥˘ed
 = "4294967295";

463 
i
++; 
ui_ã°
[i].
num
 = 0xFFFF000000000000U; ui_ã°[i].
ex≥˘ed
 = "18446462598732840960";

464 
i
++; 
ui_ã°
[i].
num
 = 0x0000FFFF00000000U; ui_ã°[i].
ex≥˘ed
 = "281470681743360";

465 
i
++; 
ui_ã°
[i].
num
 = 0x00000000FFFF0000U; ui_ã°[i].
ex≥˘ed
 = "4294901760";

466 
i
++; 
ui_ã°
[i].
num
 = 0x000000000000FFFFU; ui_ã°[i].
ex≥˘ed
 = "65535";

468 
i
++; 
ui_ã°
[i].
num
 = 0xFF00000000000000U; ui_ã°[i].
ex≥˘ed
 = "18374686479671623680";

469 
i
++; 
ui_ã°
[i].
num
 = 0x00FF000000000000U; ui_ã°[i].
ex≥˘ed
 = "71776119061217280";

470 
i
++; 
ui_ã°
[i].
num
 = 0x0000FF0000000000U; ui_ã°[i].
ex≥˘ed
 = "280375465082880";

471 
i
++; 
ui_ã°
[i].
num
 = 0x000000FF00000000U; ui_ã°[i].
ex≥˘ed
 = "1095216660480";

472 
i
++; 
ui_ã°
[i].
num
 = 0x00000000FF000000U; ui_ã°[i].
ex≥˘ed
 = "4278190080";

473 
i
++; 
ui_ã°
[i].
num
 = 0x0000000000FF0000U; ui_ã°[i].
ex≥˘ed
 = "16711680";

474 
i
++; 
ui_ã°
[i].
num
 = 0x000000000000FF00U; ui_ã°[i].
ex≥˘ed
 = "65280";

475 
i
++; 
ui_ã°
[i].
num
 = 0x00000000000000FFU; ui_ã°[i].
ex≥˘ed
 = "255";

477 
i
++; 
ui_ã°
[i].
num
 = 0xF000000000000000U; ui_ã°[i].
ex≥˘ed
 = "17293822569102704640";

478 
i
++; 
ui_ã°
[i].
num
 = 0x0F00000000000000U; ui_ã°[i].
ex≥˘ed
 = "1080863910568919040";

479 
i
++; 
ui_ã°
[i].
num
 = 0x00F0000000000000U; ui_ã°[i].
ex≥˘ed
 = "67553994410557440";

480 
i
++; 
ui_ã°
[i].
num
 = 0x000F000000000000U; ui_ã°[i].
ex≥˘ed
 = "4222124650659840";

481 
i
++; 
ui_ã°
[i].
num
 = 0x0000F00000000000U; ui_ã°[i].
ex≥˘ed
 = "263882790666240";

482 
i
++; 
ui_ã°
[i].
num
 = 0x00000F0000000000U; ui_ã°[i].
ex≥˘ed
 = "16492674416640";

483 
i
++; 
ui_ã°
[i].
num
 = 0x000000F000000000U; ui_ã°[i].
ex≥˘ed
 = "1030792151040";

484 
i
++; 
ui_ã°
[i].
num
 = 0x0000000F00000000U; ui_ã°[i].
ex≥˘ed
 = "64424509440";

485 
i
++; 
ui_ã°
[i].
num
 = 0x00000000F0000000U; ui_ã°[i].
ex≥˘ed
 = "4026531840";

486 
i
++; 
ui_ã°
[i].
num
 = 0x000000000F000000U; ui_ã°[i].
ex≥˘ed
 = "251658240";

487 
i
++; 
ui_ã°
[i].
num
 = 0x0000000000F00000U; ui_ã°[i].
ex≥˘ed
 = "15728640";

488 
i
++; 
ui_ã°
[i].
num
 = 0x00000000000F0000U; ui_ã°[i].
ex≥˘ed
 = "983040";

489 
i
++; 
ui_ã°
[i].
num
 = 0x000000000000F000U; ui_ã°[i].
ex≥˘ed
 = "61440";

490 
i
++; 
ui_ã°
[i].
num
 = 0x0000000000000F00U; ui_ã°[i].
ex≥˘ed
 = "3840";

491 
i
++; 
ui_ã°
[i].
num
 = 0x00000000000000F0U; ui_ã°[i].
ex≥˘ed
 = "240";

492 
i
++; 
ui_ã°
[i].
num
 = 0x000000000000000FU; ui_ã°[i].
ex≥˘ed
 = "15";

494 
i
++; 
ui_ã°
[i].
num
 = 0xC000000000000000U; ui_ã°[i].
ex≥˘ed
 = "13835058055282163712";

495 
i
++; 
ui_ã°
[i].
num
 = 0x0C00000000000000U; ui_ã°[i].
ex≥˘ed
 = "864691128455135232";

496 
i
++; 
ui_ã°
[i].
num
 = 0x00C0000000000000U; ui_ã°[i].
ex≥˘ed
 = "54043195528445952";

497 
i
++; 
ui_ã°
[i].
num
 = 0x000C000000000000U; ui_ã°[i].
ex≥˘ed
 = "3377699720527872";

498 
i
++; 
ui_ã°
[i].
num
 = 0x0000C00000000000U; ui_ã°[i].
ex≥˘ed
 = "211106232532992";

499 
i
++; 
ui_ã°
[i].
num
 = 0x00000C0000000000U; ui_ã°[i].
ex≥˘ed
 = "13194139533312";

500 
i
++; 
ui_ã°
[i].
num
 = 0x000000C000000000U; ui_ã°[i].
ex≥˘ed
 = "824633720832";

501 
i
++; 
ui_ã°
[i].
num
 = 0x0000000C00000000U; ui_ã°[i].
ex≥˘ed
 = "51539607552";

502 
i
++; 
ui_ã°
[i].
num
 = 0x00000000C0000000U; ui_ã°[i].
ex≥˘ed
 = "3221225472";

503 
i
++; 
ui_ã°
[i].
num
 = 0x000000000C000000U; ui_ã°[i].
ex≥˘ed
 = "201326592";

504 
i
++; 
ui_ã°
[i].
num
 = 0x0000000000C00000U; ui_ã°[i].
ex≥˘ed
 = "12582912";

505 
i
++; 
ui_ã°
[i].
num
 = 0x00000000000C0000U; ui_ã°[i].
ex≥˘ed
 = "786432";

506 
i
++; 
ui_ã°
[i].
num
 = 0x000000000000C000U; ui_ã°[i].
ex≥˘ed
 = "49152";

507 
i
++; 
ui_ã°
[i].
num
 = 0x0000000000000C00U; ui_ã°[i].
ex≥˘ed
 = "3072";

508 
i
++; 
ui_ã°
[i].
num
 = 0x00000000000000C0U; ui_ã°[i].
ex≥˘ed
 = "192";

509 
i
++; 
ui_ã°
[i].
num
 = 0x000000000000000CU; ui_ã°[i].
ex≥˘ed
 = "12";

511 
i
++; 
ui_ã°
[i].
num
 = 0x00000001U; ui_ã°[i].
ex≥˘ed
 = "1";

512 
i
++; 
ui_ã°
[i].
num
 = 0x00000000U; ui_ã°[i].
ex≥˘ed
 = "0";

514 
num_uöt_ã°s
 = 
i
;

518 
i
=1; i<=
num_uöt_ã°s
; i++) {

520 
j
=0; j<
BUFSZ
; j++)

521 
ui_ã°
[
i
].
ªsu…
[
j
] = 'X';

522 
ui_ã°
[
i
].
ªsu…
[
BUFSZ
-1] = '\0';

524 ()
	`cuæ_m•rötf
(
ui_ã°
[
i
].
ªsu…
, "%u", ui_ã°[i].
num
);

526 if(
	`memcmp
(
ui_ã°
[
i
].
ªsu…
,

527 
ui_ã°
[
i
].
ex≥˘ed
,

528 
	`°æí
(
ui_ã°
[
i
].
ex≥˘ed
))) {

529 
	`¥ötf
("unsigned intÅest #%.2d: Failed (Expected: %s Got: %s)\n",

530 
i
, 
ui_ã°
[i].
ex≥˘ed
, ui_ã°[i].
ªsu…
);

531 
Áûed
++;

536 if(!
Áûed
)

537 
	`¥ötf
("All curl_mprintf() unsigned intÅests OK!\n");

539 
	`¥ötf
("Some curl_mprintf() unsigned intÅests Failed!\n");

541  
Áûed
;

542 
	}
}

545 
	$ã°_sig√d_öt_f‹m©tög
()

547 
i
, 
j
;

548 
num_söt_ã°s
;

549 
Áûed
 = 0;

551 #i‡(
SIZEOF_INT
 == 2)

553 
i
=1; 
si_ã°
[i].
num
 = 0x7FFF; si_ã°[i].
ex≥˘ed
 = "32767";

554 
i
++; 
si_ã°
[i].
num
 = 0x7FFE; si_ã°[i].
ex≥˘ed
 = "32766";

555 
i
++; 
si_ã°
[i].
num
 = 0x7FFD; si_ã°[i].
ex≥˘ed
 = "32765";

556 
i
++; 
si_ã°
[i].
num
 = 0x7F00; si_ã°[i].
ex≥˘ed
 = "32512";

557 
i
++; 
si_ã°
[i].
num
 = 0x07F0; si_ã°[i].
ex≥˘ed
 = "2032";

558 
i
++; 
si_ã°
[i].
num
 = 0x007F; si_ã°[i].
ex≥˘ed
 = "127";

560 
i
++; 
si_ã°
[i].
num
 = 0x7000; si_ã°[i].
ex≥˘ed
 = "28672";

561 
i
++; 
si_ã°
[i].
num
 = 0x0700; si_ã°[i].
ex≥˘ed
 = "1792";

562 
i
++; 
si_ã°
[i].
num
 = 0x0070; si_ã°[i].
ex≥˘ed
 = "112";

563 
i
++; 
si_ã°
[i].
num
 = 0x0007; si_ã°[i].
ex≥˘ed
 = "7";

565 
i
++; 
si_ã°
[i].
num
 = 0x5000; si_ã°[i].
ex≥˘ed
 = "20480";

566 
i
++; 
si_ã°
[i].
num
 = 0x0500; si_ã°[i].
ex≥˘ed
 = "1280";

567 
i
++; 
si_ã°
[i].
num
 = 0x0050; si_ã°[i].
ex≥˘ed
 = "80";

568 
i
++; 
si_ã°
[i].
num
 = 0x0005; si_ã°[i].
ex≥˘ed
 = "5";

570 
i
++; 
si_ã°
[i].
num
 = 0x0001; si_ã°[i].
ex≥˘ed
 = "1";

571 
i
++; 
si_ã°
[i].
num
 = 0x0000; si_ã°[i].
ex≥˘ed
 = "0";

573 
i
++; 
si_ã°
[i].
num
 = -0x7FFF -1; si_ã°[i].
ex≥˘ed
 = "-32768";

574 
i
++; 
si_ã°
[i].
num
 = -0x7FFE -1; si_ã°[i].
ex≥˘ed
 = "-32767";

575 
i
++; 
si_ã°
[i].
num
 = -0x7FFD -1; si_ã°[i].
ex≥˘ed
 = "-32766";

576 
i
++; 
si_ã°
[i].
num
 = -0x7F00 -1; si_ã°[i].
ex≥˘ed
 = "-32513";

577 
i
++; 
si_ã°
[i].
num
 = -0x07F0 -1; si_ã°[i].
ex≥˘ed
 = "-2033";

578 
i
++; 
si_ã°
[i].
num
 = -0x007F -1; si_ã°[i].
ex≥˘ed
 = "-128";

580 
i
++; 
si_ã°
[i].
num
 = -0x7000 -1; si_ã°[i].
ex≥˘ed
 = "-28673";

581 
i
++; 
si_ã°
[i].
num
 = -0x0700 -1; si_ã°[i].
ex≥˘ed
 = "-1793";

582 
i
++; 
si_ã°
[i].
num
 = -0x0070 -1; si_ã°[i].
ex≥˘ed
 = "-113";

583 
i
++; 
si_ã°
[i].
num
 = -0x0007 -1; si_ã°[i].
ex≥˘ed
 = "-8";

585 
i
++; 
si_ã°
[i].
num
 = -0x5000 -1; si_ã°[i].
ex≥˘ed
 = "-20481";

586 
i
++; 
si_ã°
[i].
num
 = -0x0500 -1; si_ã°[i].
ex≥˘ed
 = "-1281";

587 
i
++; 
si_ã°
[i].
num
 = -0x0050 -1; si_ã°[i].
ex≥˘ed
 = "-81";

588 
i
++; 
si_ã°
[i].
num
 = -0x0005 -1; si_ã°[i].
ex≥˘ed
 = "-6";

590 
i
++; 
si_ã°
[i].
num
 = 0x0000 -1; si_ã°[i].
ex≥˘ed
 = "-1";

592 
num_söt_ã°s
 = 
i
;

594 #ñi‡(
SIZEOF_INT
 == 4)

596 
i
=1; 
si_ã°
[i].
num
 = 0x7FFFFFFF; si_ã°[i].
ex≥˘ed
 = "2147483647";

597 
i
++; 
si_ã°
[i].
num
 = 0x7FFFFFFE; si_ã°[i].
ex≥˘ed
 = "2147483646";

598 
i
++; 
si_ã°
[i].
num
 = 0x7FFFFFFD; si_ã°[i].
ex≥˘ed
 = "2147483645";

599 
i
++; 
si_ã°
[i].
num
 = 0x7FFF0000; si_ã°[i].
ex≥˘ed
 = "2147418112";

600 
i
++; 
si_ã°
[i].
num
 = 0x00007FFF; si_ã°[i].
ex≥˘ed
 = "32767";

602 
i
++; 
si_ã°
[i].
num
 = 0x7F000000; si_ã°[i].
ex≥˘ed
 = "2130706432";

603 
i
++; 
si_ã°
[i].
num
 = 0x007F0000; si_ã°[i].
ex≥˘ed
 = "8323072";

604 
i
++; 
si_ã°
[i].
num
 = 0x00007F00; si_ã°[i].
ex≥˘ed
 = "32512";

605 
i
++; 
si_ã°
[i].
num
 = 0x0000007F; si_ã°[i].
ex≥˘ed
 = "127";

607 
i
++; 
si_ã°
[i].
num
 = 0x70000000; si_ã°[i].
ex≥˘ed
 = "1879048192";

608 
i
++; 
si_ã°
[i].
num
 = 0x07000000; si_ã°[i].
ex≥˘ed
 = "117440512";

609 
i
++; 
si_ã°
[i].
num
 = 0x00700000; si_ã°[i].
ex≥˘ed
 = "7340032";

610 
i
++; 
si_ã°
[i].
num
 = 0x00070000; si_ã°[i].
ex≥˘ed
 = "458752";

611 
i
++; 
si_ã°
[i].
num
 = 0x00007000; si_ã°[i].
ex≥˘ed
 = "28672";

612 
i
++; 
si_ã°
[i].
num
 = 0x00000700; si_ã°[i].
ex≥˘ed
 = "1792";

613 
i
++; 
si_ã°
[i].
num
 = 0x00000070; si_ã°[i].
ex≥˘ed
 = "112";

614 
i
++; 
si_ã°
[i].
num
 = 0x00000007; si_ã°[i].
ex≥˘ed
 = "7";

616 
i
++; 
si_ã°
[i].
num
 = 0x50000000; si_ã°[i].
ex≥˘ed
 = "1342177280";

617 
i
++; 
si_ã°
[i].
num
 = 0x05000000; si_ã°[i].
ex≥˘ed
 = "83886080";

618 
i
++; 
si_ã°
[i].
num
 = 0x00500000; si_ã°[i].
ex≥˘ed
 = "5242880";

619 
i
++; 
si_ã°
[i].
num
 = 0x00050000; si_ã°[i].
ex≥˘ed
 = "327680";

620 
i
++; 
si_ã°
[i].
num
 = 0x00005000; si_ã°[i].
ex≥˘ed
 = "20480";

621 
i
++; 
si_ã°
[i].
num
 = 0x00000500; si_ã°[i].
ex≥˘ed
 = "1280";

622 
i
++; 
si_ã°
[i].
num
 = 0x00000050; si_ã°[i].
ex≥˘ed
 = "80";

623 
i
++; 
si_ã°
[i].
num
 = 0x00000005; si_ã°[i].
ex≥˘ed
 = "5";

625 
i
++; 
si_ã°
[i].
num
 = 0x00000001; si_ã°[i].
ex≥˘ed
 = "1";

626 
i
++; 
si_ã°
[i].
num
 = 0x00000000; si_ã°[i].
ex≥˘ed
 = "0";

628 
i
++; 
si_ã°
[i].
num
 = -0x7FFFFFFF -1; si_ã°[i].
ex≥˘ed
 = "-2147483648";

629 
i
++; 
si_ã°
[i].
num
 = -0x7FFFFFFE -1; si_ã°[i].
ex≥˘ed
 = "-2147483647";

630 
i
++; 
si_ã°
[i].
num
 = -0x7FFFFFFD -1; si_ã°[i].
ex≥˘ed
 = "-2147483646";

631 
i
++; 
si_ã°
[i].
num
 = -0x7FFF0000 -1; si_ã°[i].
ex≥˘ed
 = "-2147418113";

632 
i
++; 
si_ã°
[i].
num
 = -0x00007FFF -1; si_ã°[i].
ex≥˘ed
 = "-32768";

634 
i
++; 
si_ã°
[i].
num
 = -0x7F000000 -1; si_ã°[i].
ex≥˘ed
 = "-2130706433";

635 
i
++; 
si_ã°
[i].
num
 = -0x007F0000 -1; si_ã°[i].
ex≥˘ed
 = "-8323073";

636 
i
++; 
si_ã°
[i].
num
 = -0x00007F00 -1; si_ã°[i].
ex≥˘ed
 = "-32513";

637 
i
++; 
si_ã°
[i].
num
 = -0x0000007F -1; si_ã°[i].
ex≥˘ed
 = "-128";

639 
i
++; 
si_ã°
[i].
num
 = -0x70000000 -1; si_ã°[i].
ex≥˘ed
 = "-1879048193";

640 
i
++; 
si_ã°
[i].
num
 = -0x07000000 -1; si_ã°[i].
ex≥˘ed
 = "-117440513";

641 
i
++; 
si_ã°
[i].
num
 = -0x00700000 -1; si_ã°[i].
ex≥˘ed
 = "-7340033";

642 
i
++; 
si_ã°
[i].
num
 = -0x00070000 -1; si_ã°[i].
ex≥˘ed
 = "-458753";

643 
i
++; 
si_ã°
[i].
num
 = -0x00007000 -1; si_ã°[i].
ex≥˘ed
 = "-28673";

644 
i
++; 
si_ã°
[i].
num
 = -0x00000700 -1; si_ã°[i].
ex≥˘ed
 = "-1793";

645 
i
++; 
si_ã°
[i].
num
 = -0x00000070 -1; si_ã°[i].
ex≥˘ed
 = "-113";

646 
i
++; 
si_ã°
[i].
num
 = -0x00000007 -1; si_ã°[i].
ex≥˘ed
 = "-8";

648 
i
++; 
si_ã°
[i].
num
 = -0x50000000 -1; si_ã°[i].
ex≥˘ed
 = "-1342177281";

649 
i
++; 
si_ã°
[i].
num
 = -0x05000000 -1; si_ã°[i].
ex≥˘ed
 = "-83886081";

650 
i
++; 
si_ã°
[i].
num
 = -0x00500000 -1; si_ã°[i].
ex≥˘ed
 = "-5242881";

651 
i
++; 
si_ã°
[i].
num
 = -0x00050000 -1; si_ã°[i].
ex≥˘ed
 = "-327681";

652 
i
++; 
si_ã°
[i].
num
 = -0x00005000 -1; si_ã°[i].
ex≥˘ed
 = "-20481";

653 
i
++; 
si_ã°
[i].
num
 = -0x00000500 -1; si_ã°[i].
ex≥˘ed
 = "-1281";

654 
i
++; 
si_ã°
[i].
num
 = -0x00000050 -1; si_ã°[i].
ex≥˘ed
 = "-81";

655 
i
++; 
si_ã°
[i].
num
 = -0x00000005 -1; si_ã°[i].
ex≥˘ed
 = "-6";

657 
i
++; 
si_ã°
[i].
num
 = 0x00000000 -1; si_ã°[i].
ex≥˘ed
 = "-1";

659 
num_söt_ã°s
 = 
i
;

661 #ñi‡(
SIZEOF_INT
 == 8)

663 
i
=1; 
si_ã°
[i].
num
 = 0x7FFFFFFFFFFFFFFF; si_ã°[i].
ex≥˘ed
 = "9223372036854775807";

664 
i
++; 
si_ã°
[i].
num
 = 0x7FFFFFFFFFFFFFFE; si_ã°[i].
ex≥˘ed
 = "9223372036854775806";

665 
i
++; 
si_ã°
[i].
num
 = 0x7FFFFFFFFFFFFFFD; si_ã°[i].
ex≥˘ed
 = "9223372036854775805";

666 
i
++; 
si_ã°
[i].
num
 = 0x7FFFFFFF00000000; si_ã°[i].
ex≥˘ed
 = "9223372032559808512";

667 
i
++; 
si_ã°
[i].
num
 = 0x000000007FFFFFFF; si_ã°[i].
ex≥˘ed
 = "2147483647";

669 
i
++; 
si_ã°
[i].
num
 = 0x7FFF000000000000; si_ã°[i].
ex≥˘ed
 = "9223090561878065152";

670 
i
++; 
si_ã°
[i].
num
 = 0x00007FFF00000000; si_ã°[i].
ex≥˘ed
 = "140733193388032";

671 
i
++; 
si_ã°
[i].
num
 = 0x000000007FFF0000; si_ã°[i].
ex≥˘ed
 = "2147418112";

672 
i
++; 
si_ã°
[i].
num
 = 0x0000000000007FFF; si_ã°[i].
ex≥˘ed
 = "32767";

674 
i
++; 
si_ã°
[i].
num
 = 0x7F00000000000000; si_ã°[i].
ex≥˘ed
 = "9151314442816847872";

675 
i
++; 
si_ã°
[i].
num
 = 0x007F000000000000; si_ã°[i].
ex≥˘ed
 = "35747322042253312";

676 
i
++; 
si_ã°
[i].
num
 = 0x00007F0000000000; si_ã°[i].
ex≥˘ed
 = "139637976727552";

677 
i
++; 
si_ã°
[i].
num
 = 0x0000007F00000000; si_ã°[i].
ex≥˘ed
 = "545460846592";

678 
i
++; 
si_ã°
[i].
num
 = 0x000000007F000000; si_ã°[i].
ex≥˘ed
 = "2130706432";

679 
i
++; 
si_ã°
[i].
num
 = 0x00000000007F0000; si_ã°[i].
ex≥˘ed
 = "8323072";

680 
i
++; 
si_ã°
[i].
num
 = 0x0000000000007F00; si_ã°[i].
ex≥˘ed
 = "32512";

681 
i
++; 
si_ã°
[i].
num
 = 0x000000000000007F; si_ã°[i].
ex≥˘ed
 = "127";

683 
i
++; 
si_ã°
[i].
num
 = 0x7000000000000000; si_ã°[i].
ex≥˘ed
 = "8070450532247928832";

684 
i
++; 
si_ã°
[i].
num
 = 0x0700000000000000; si_ã°[i].
ex≥˘ed
 = "504403158265495552";

685 
i
++; 
si_ã°
[i].
num
 = 0x0070000000000000; si_ã°[i].
ex≥˘ed
 = "31525197391593472";

686 
i
++; 
si_ã°
[i].
num
 = 0x0007000000000000; si_ã°[i].
ex≥˘ed
 = "1970324836974592";

687 
i
++; 
si_ã°
[i].
num
 = 0x0000700000000000; si_ã°[i].
ex≥˘ed
 = "123145302310912";

688 
i
++; 
si_ã°
[i].
num
 = 0x0000070000000000; si_ã°[i].
ex≥˘ed
 = "7696581394432";

689 
i
++; 
si_ã°
[i].
num
 = 0x0000007000000000; si_ã°[i].
ex≥˘ed
 = "481036337152";

690 
i
++; 
si_ã°
[i].
num
 = 0x0000000700000000; si_ã°[i].
ex≥˘ed
 = "30064771072";

691 
i
++; 
si_ã°
[i].
num
 = 0x0000000070000000; si_ã°[i].
ex≥˘ed
 = "1879048192";

692 
i
++; 
si_ã°
[i].
num
 = 0x0000000007000000; si_ã°[i].
ex≥˘ed
 = "117440512";

693 
i
++; 
si_ã°
[i].
num
 = 0x0000000000700000; si_ã°[i].
ex≥˘ed
 = "7340032";

694 
i
++; 
si_ã°
[i].
num
 = 0x0000000000070000; si_ã°[i].
ex≥˘ed
 = "458752";

695 
i
++; 
si_ã°
[i].
num
 = 0x0000000000007000; si_ã°[i].
ex≥˘ed
 = "28672";

696 
i
++; 
si_ã°
[i].
num
 = 0x0000000000000700; si_ã°[i].
ex≥˘ed
 = "1792";

697 
i
++; 
si_ã°
[i].
num
 = 0x0000000000000070; si_ã°[i].
ex≥˘ed
 = "112";

698 
i
++; 
si_ã°
[i].
num
 = 0x0000000000000007; si_ã°[i].
ex≥˘ed
 = "7";

700 
i
++; 
si_ã°
[i].
num
 = 0x0000000000000001; si_ã°[i].
ex≥˘ed
 = "1";

701 
i
++; 
si_ã°
[i].
num
 = 0x0000000000000000; si_ã°[i].
ex≥˘ed
 = "0";

703 
i
++; 
si_ã°
[i].
num
 = -0x7FFFFFFFFFFFFFFF -1; si_ã°[i].
ex≥˘ed
 = "-9223372036854775808";

704 
i
++; 
si_ã°
[i].
num
 = -0x7FFFFFFFFFFFFFFE -1; si_ã°[i].
ex≥˘ed
 = "-9223372036854775807";

705 
i
++; 
si_ã°
[i].
num
 = -0x7FFFFFFFFFFFFFFD -1; si_ã°[i].
ex≥˘ed
 = "-9223372036854775806";

706 
i
++; 
si_ã°
[i].
num
 = -0x7FFFFFFF00000000 -1; si_ã°[i].
ex≥˘ed
 = "-9223372032559808513";

707 
i
++; 
si_ã°
[i].
num
 = -0x000000007FFFFFFF -1; si_ã°[i].
ex≥˘ed
 = "-2147483648";

709 
i
++; 
si_ã°
[i].
num
 = -0x7FFF000000000000 -1; si_ã°[i].
ex≥˘ed
 = "-9223090561878065153";

710 
i
++; 
si_ã°
[i].
num
 = -0x00007FFF00000000 -1; si_ã°[i].
ex≥˘ed
 = "-140733193388033";

711 
i
++; 
si_ã°
[i].
num
 = -0x000000007FFF0000 -1; si_ã°[i].
ex≥˘ed
 = "-2147418113";

712 
i
++; 
si_ã°
[i].
num
 = -0x0000000000007FFF -1; si_ã°[i].
ex≥˘ed
 = "-32768";

714 
i
++; 
si_ã°
[i].
num
 = -0x7F00000000000000 -1; si_ã°[i].
ex≥˘ed
 = "-9151314442816847873";

715 
i
++; 
si_ã°
[i].
num
 = -0x007F000000000000 -1; si_ã°[i].
ex≥˘ed
 = "-35747322042253313";

716 
i
++; 
si_ã°
[i].
num
 = -0x00007F0000000000 -1; si_ã°[i].
ex≥˘ed
 = "-139637976727553";

717 
i
++; 
si_ã°
[i].
num
 = -0x0000007F00000000 -1; si_ã°[i].
ex≥˘ed
 = "-545460846593";

718 
i
++; 
si_ã°
[i].
num
 = -0x000000007F000000 -1; si_ã°[i].
ex≥˘ed
 = "-2130706433";

719 
i
++; 
si_ã°
[i].
num
 = -0x00000000007F0000 -1; si_ã°[i].
ex≥˘ed
 = "-8323073";

720 
i
++; 
si_ã°
[i].
num
 = -0x0000000000007F00 -1; si_ã°[i].
ex≥˘ed
 = "-32513";

721 
i
++; 
si_ã°
[i].
num
 = -0x000000000000007F -1; si_ã°[i].
ex≥˘ed
 = "-128";

723 
i
++; 
si_ã°
[i].
num
 = -0x7000000000000000 -1; si_ã°[i].
ex≥˘ed
 = "-8070450532247928833";

724 
i
++; 
si_ã°
[i].
num
 = -0x0700000000000000 -1; si_ã°[i].
ex≥˘ed
 = "-504403158265495553";

725 
i
++; 
si_ã°
[i].
num
 = -0x0070000000000000 -1; si_ã°[i].
ex≥˘ed
 = "-31525197391593473";

726 
i
++; 
si_ã°
[i].
num
 = -0x0007000000000000 -1; si_ã°[i].
ex≥˘ed
 = "-1970324836974593";

727 
i
++; 
si_ã°
[i].
num
 = -0x0000700000000000 -1; si_ã°[i].
ex≥˘ed
 = "-123145302310913";

728 
i
++; 
si_ã°
[i].
num
 = -0x0000070000000000 -1; si_ã°[i].
ex≥˘ed
 = "-7696581394433";

729 
i
++; 
si_ã°
[i].
num
 = -0x0000007000000000 -1; si_ã°[i].
ex≥˘ed
 = "-481036337153";

730 
i
++; 
si_ã°
[i].
num
 = -0x0000000700000000 -1; si_ã°[i].
ex≥˘ed
 = "-30064771073";

731 
i
++; 
si_ã°
[i].
num
 = -0x0000000070000000 -1; si_ã°[i].
ex≥˘ed
 = "-1879048193";

732 
i
++; 
si_ã°
[i].
num
 = -0x0000000007000000 -1; si_ã°[i].
ex≥˘ed
 = "-117440513";

733 
i
++; 
si_ã°
[i].
num
 = -0x0000000000700000 -1; si_ã°[i].
ex≥˘ed
 = "-7340033";

734 
i
++; 
si_ã°
[i].
num
 = -0x0000000000070000 -1; si_ã°[i].
ex≥˘ed
 = "-458753";

735 
i
++; 
si_ã°
[i].
num
 = -0x0000000000007000 -1; si_ã°[i].
ex≥˘ed
 = "-28673";

736 
i
++; 
si_ã°
[i].
num
 = -0x0000000000000700 -1; si_ã°[i].
ex≥˘ed
 = "-1793";

737 
i
++; 
si_ã°
[i].
num
 = -0x0000000000000070 -1; si_ã°[i].
ex≥˘ed
 = "-113";

738 
i
++; 
si_ã°
[i].
num
 = -0x0000000000000007 -1; si_ã°[i].
ex≥˘ed
 = "-8";

740 
i
++; 
si_ã°
[i].
num
 = 0x0000000000000000 -1; si_ã°[i].
ex≥˘ed
 = "-1";

742 
num_söt_ã°s
 = 
i
;

746 
i
=1; i<=
num_söt_ã°s
; i++) {

748 
j
=0; j<
BUFSZ
; j++)

749 
si_ã°
[
i
].
ªsu…
[
j
] = 'X';

750 
si_ã°
[
i
].
ªsu…
[
BUFSZ
-1] = '\0';

752 ()
	`cuæ_m•rötf
(
si_ã°
[
i
].
ªsu…
, "%d", si_ã°[i].
num
);

754 if(
	`memcmp
(
si_ã°
[
i
].
ªsu…
,

755 
si_ã°
[
i
].
ex≥˘ed
,

756 
	`°æí
(
si_ã°
[
i
].
ex≥˘ed
))) {

757 
	`¥ötf
("signed intÅest #%.2d: Failed (Expected: %s Got: %s)\n",

758 
i
, 
si_ã°
[i].
ex≥˘ed
, si_ã°[i].
ªsu…
);

759 
Áûed
++;

764 if(!
Áûed
)

765 
	`¥ötf
("All curl_mprintf() signed intÅests OK!\n");

767 
	`¥ötf
("Some curl_mprintf() signed intÅests Failed!\n");

769  
Áûed
;

770 
	}
}

773 
	$ã°_unsig√d_l⁄g_f‹m©tög
()

775 
i
, 
j
;

776 
num_ul⁄g_ã°s
;

777 
Áûed
 = 0;

779 #i‡(
CURL_SIZEOF_LONG
 == 2)

781 
i
=1; 
ul_ã°
[i].
num
 = 0xFFFFUL; ul_ã°[i].
ex≥˘ed
 = "65535";

782 
i
++; 
ul_ã°
[i].
num
 = 0xFF00UL; ul_ã°[i].
ex≥˘ed
 = "65280";

783 
i
++; 
ul_ã°
[i].
num
 = 0x00FFUL; ul_ã°[i].
ex≥˘ed
 = "255";

785 
i
++; 
ul_ã°
[i].
num
 = 0xF000UL; ul_ã°[i].
ex≥˘ed
 = "61440";

786 
i
++; 
ul_ã°
[i].
num
 = 0x0F00UL; ul_ã°[i].
ex≥˘ed
 = "3840";

787 
i
++; 
ul_ã°
[i].
num
 = 0x00F0UL; ul_ã°[i].
ex≥˘ed
 = "240";

788 
i
++; 
ul_ã°
[i].
num
 = 0x000FUL; ul_ã°[i].
ex≥˘ed
 = "15";

790 
i
++; 
ul_ã°
[i].
num
 = 0xC000UL; ul_ã°[i].
ex≥˘ed
 = "49152";

791 
i
++; 
ul_ã°
[i].
num
 = 0x0C00UL; ul_ã°[i].
ex≥˘ed
 = "3072";

792 
i
++; 
ul_ã°
[i].
num
 = 0x00C0UL; ul_ã°[i].
ex≥˘ed
 = "192";

793 
i
++; 
ul_ã°
[i].
num
 = 0x000CUL; ul_ã°[i].
ex≥˘ed
 = "12";

795 
i
++; 
ul_ã°
[i].
num
 = 0x0001UL; ul_ã°[i].
ex≥˘ed
 = "1";

796 
i
++; 
ul_ã°
[i].
num
 = 0x0000UL; ul_ã°[i].
ex≥˘ed
 = "0";

798 
num_ul⁄g_ã°s
 = 
i
;

800 #ñi‡(
CURL_SIZEOF_LONG
 == 4)

802 
i
=1; 
ul_ã°
[i].
num
 = 0xFFFFFFFFUL; ul_ã°[i].
ex≥˘ed
 = "4294967295";

803 
i
++; 
ul_ã°
[i].
num
 = 0xFFFF0000UL; ul_ã°[i].
ex≥˘ed
 = "4294901760";

804 
i
++; 
ul_ã°
[i].
num
 = 0x0000FFFFUL; ul_ã°[i].
ex≥˘ed
 = "65535";

806 
i
++; 
ul_ã°
[i].
num
 = 0xFF000000UL; ul_ã°[i].
ex≥˘ed
 = "4278190080";

807 
i
++; 
ul_ã°
[i].
num
 = 0x00FF0000UL; ul_ã°[i].
ex≥˘ed
 = "16711680";

808 
i
++; 
ul_ã°
[i].
num
 = 0x0000FF00UL; ul_ã°[i].
ex≥˘ed
 = "65280";

809 
i
++; 
ul_ã°
[i].
num
 = 0x000000FFUL; ul_ã°[i].
ex≥˘ed
 = "255";

811 
i
++; 
ul_ã°
[i].
num
 = 0xF0000000UL; ul_ã°[i].
ex≥˘ed
 = "4026531840";

812 
i
++; 
ul_ã°
[i].
num
 = 0x0F000000UL; ul_ã°[i].
ex≥˘ed
 = "251658240";

813 
i
++; 
ul_ã°
[i].
num
 = 0x00F00000UL; ul_ã°[i].
ex≥˘ed
 = "15728640";

814 
i
++; 
ul_ã°
[i].
num
 = 0x000F0000UL; ul_ã°[i].
ex≥˘ed
 = "983040";

815 
i
++; 
ul_ã°
[i].
num
 = 0x0000F000UL; ul_ã°[i].
ex≥˘ed
 = "61440";

816 
i
++; 
ul_ã°
[i].
num
 = 0x00000F00UL; ul_ã°[i].
ex≥˘ed
 = "3840";

817 
i
++; 
ul_ã°
[i].
num
 = 0x000000F0UL; ul_ã°[i].
ex≥˘ed
 = "240";

818 
i
++; 
ul_ã°
[i].
num
 = 0x0000000FUL; ul_ã°[i].
ex≥˘ed
 = "15";

820 
i
++; 
ul_ã°
[i].
num
 = 0xC0000000UL; ul_ã°[i].
ex≥˘ed
 = "3221225472";

821 
i
++; 
ul_ã°
[i].
num
 = 0x0C000000UL; ul_ã°[i].
ex≥˘ed
 = "201326592";

822 
i
++; 
ul_ã°
[i].
num
 = 0x00C00000UL; ul_ã°[i].
ex≥˘ed
 = "12582912";

823 
i
++; 
ul_ã°
[i].
num
 = 0x000C0000UL; ul_ã°[i].
ex≥˘ed
 = "786432";

824 
i
++; 
ul_ã°
[i].
num
 = 0x0000C000UL; ul_ã°[i].
ex≥˘ed
 = "49152";

825 
i
++; 
ul_ã°
[i].
num
 = 0x00000C00UL; ul_ã°[i].
ex≥˘ed
 = "3072";

826 
i
++; 
ul_ã°
[i].
num
 = 0x000000C0UL; ul_ã°[i].
ex≥˘ed
 = "192";

827 
i
++; 
ul_ã°
[i].
num
 = 0x0000000CUL; ul_ã°[i].
ex≥˘ed
 = "12";

829 
i
++; 
ul_ã°
[i].
num
 = 0x00000001UL; ul_ã°[i].
ex≥˘ed
 = "1";

830 
i
++; 
ul_ã°
[i].
num
 = 0x00000000UL; ul_ã°[i].
ex≥˘ed
 = "0";

832 
num_ul⁄g_ã°s
 = 
i
;

834 #ñi‡(
CURL_SIZEOF_LONG
 == 8)

836 
i
=1; 
ul_ã°
[i].
num
 = 0xFFFFFFFFFFFFFFFFUL; ul_ã°[i].
ex≥˘ed
 = "18446744073709551615";

837 
i
++; 
ul_ã°
[i].
num
 = 0xFFFFFFFF00000000UL; ul_ã°[i].
ex≥˘ed
 = "18446744069414584320";

838 
i
++; 
ul_ã°
[i].
num
 = 0x00000000FFFFFFFFUL; ul_ã°[i].
ex≥˘ed
 = "4294967295";

840 
i
++; 
ul_ã°
[i].
num
 = 0xFFFF000000000000UL; ul_ã°[i].
ex≥˘ed
 = "18446462598732840960";

841 
i
++; 
ul_ã°
[i].
num
 = 0x0000FFFF00000000UL; ul_ã°[i].
ex≥˘ed
 = "281470681743360";

842 
i
++; 
ul_ã°
[i].
num
 = 0x00000000FFFF0000UL; ul_ã°[i].
ex≥˘ed
 = "4294901760";

843 
i
++; 
ul_ã°
[i].
num
 = 0x000000000000FFFFUL; ul_ã°[i].
ex≥˘ed
 = "65535";

845 
i
++; 
ul_ã°
[i].
num
 = 0xFF00000000000000UL; ul_ã°[i].
ex≥˘ed
 = "18374686479671623680";

846 
i
++; 
ul_ã°
[i].
num
 = 0x00FF000000000000UL; ul_ã°[i].
ex≥˘ed
 = "71776119061217280";

847 
i
++; 
ul_ã°
[i].
num
 = 0x0000FF0000000000UL; ul_ã°[i].
ex≥˘ed
 = "280375465082880";

848 
i
++; 
ul_ã°
[i].
num
 = 0x000000FF00000000UL; ul_ã°[i].
ex≥˘ed
 = "1095216660480";

849 
i
++; 
ul_ã°
[i].
num
 = 0x00000000FF000000UL; ul_ã°[i].
ex≥˘ed
 = "4278190080";

850 
i
++; 
ul_ã°
[i].
num
 = 0x0000000000FF0000UL; ul_ã°[i].
ex≥˘ed
 = "16711680";

851 
i
++; 
ul_ã°
[i].
num
 = 0x000000000000FF00UL; ul_ã°[i].
ex≥˘ed
 = "65280";

852 
i
++; 
ul_ã°
[i].
num
 = 0x00000000000000FFUL; ul_ã°[i].
ex≥˘ed
 = "255";

854 
i
++; 
ul_ã°
[i].
num
 = 0xF000000000000000UL; ul_ã°[i].
ex≥˘ed
 = "17293822569102704640";

855 
i
++; 
ul_ã°
[i].
num
 = 0x0F00000000000000UL; ul_ã°[i].
ex≥˘ed
 = "1080863910568919040";

856 
i
++; 
ul_ã°
[i].
num
 = 0x00F0000000000000UL; ul_ã°[i].
ex≥˘ed
 = "67553994410557440";

857 
i
++; 
ul_ã°
[i].
num
 = 0x000F000000000000UL; ul_ã°[i].
ex≥˘ed
 = "4222124650659840";

858 
i
++; 
ul_ã°
[i].
num
 = 0x0000F00000000000UL; ul_ã°[i].
ex≥˘ed
 = "263882790666240";

859 
i
++; 
ul_ã°
[i].
num
 = 0x00000F0000000000UL; ul_ã°[i].
ex≥˘ed
 = "16492674416640";

860 
i
++; 
ul_ã°
[i].
num
 = 0x000000F000000000UL; ul_ã°[i].
ex≥˘ed
 = "1030792151040";

861 
i
++; 
ul_ã°
[i].
num
 = 0x0000000F00000000UL; ul_ã°[i].
ex≥˘ed
 = "64424509440";

862 
i
++; 
ul_ã°
[i].
num
 = 0x00000000F0000000UL; ul_ã°[i].
ex≥˘ed
 = "4026531840";

863 
i
++; 
ul_ã°
[i].
num
 = 0x000000000F000000UL; ul_ã°[i].
ex≥˘ed
 = "251658240";

864 
i
++; 
ul_ã°
[i].
num
 = 0x0000000000F00000UL; ul_ã°[i].
ex≥˘ed
 = "15728640";

865 
i
++; 
ul_ã°
[i].
num
 = 0x00000000000F0000UL; ul_ã°[i].
ex≥˘ed
 = "983040";

866 
i
++; 
ul_ã°
[i].
num
 = 0x000000000000F000UL; ul_ã°[i].
ex≥˘ed
 = "61440";

867 
i
++; 
ul_ã°
[i].
num
 = 0x0000000000000F00UL; ul_ã°[i].
ex≥˘ed
 = "3840";

868 
i
++; 
ul_ã°
[i].
num
 = 0x00000000000000F0UL; ul_ã°[i].
ex≥˘ed
 = "240";

869 
i
++; 
ul_ã°
[i].
num
 = 0x000000000000000FUL; ul_ã°[i].
ex≥˘ed
 = "15";

871 
i
++; 
ul_ã°
[i].
num
 = 0xC000000000000000UL; ul_ã°[i].
ex≥˘ed
 = "13835058055282163712";

872 
i
++; 
ul_ã°
[i].
num
 = 0x0C00000000000000UL; ul_ã°[i].
ex≥˘ed
 = "864691128455135232";

873 
i
++; 
ul_ã°
[i].
num
 = 0x00C0000000000000UL; ul_ã°[i].
ex≥˘ed
 = "54043195528445952";

874 
i
++; 
ul_ã°
[i].
num
 = 0x000C000000000000UL; ul_ã°[i].
ex≥˘ed
 = "3377699720527872";

875 
i
++; 
ul_ã°
[i].
num
 = 0x0000C00000000000UL; ul_ã°[i].
ex≥˘ed
 = "211106232532992";

876 
i
++; 
ul_ã°
[i].
num
 = 0x00000C0000000000UL; ul_ã°[i].
ex≥˘ed
 = "13194139533312";

877 
i
++; 
ul_ã°
[i].
num
 = 0x000000C000000000UL; ul_ã°[i].
ex≥˘ed
 = "824633720832";

878 
i
++; 
ul_ã°
[i].
num
 = 0x0000000C00000000UL; ul_ã°[i].
ex≥˘ed
 = "51539607552";

879 
i
++; 
ul_ã°
[i].
num
 = 0x00000000C0000000UL; ul_ã°[i].
ex≥˘ed
 = "3221225472";

880 
i
++; 
ul_ã°
[i].
num
 = 0x000000000C000000UL; ul_ã°[i].
ex≥˘ed
 = "201326592";

881 
i
++; 
ul_ã°
[i].
num
 = 0x0000000000C00000UL; ul_ã°[i].
ex≥˘ed
 = "12582912";

882 
i
++; 
ul_ã°
[i].
num
 = 0x00000000000C0000UL; ul_ã°[i].
ex≥˘ed
 = "786432";

883 
i
++; 
ul_ã°
[i].
num
 = 0x000000000000C000UL; ul_ã°[i].
ex≥˘ed
 = "49152";

884 
i
++; 
ul_ã°
[i].
num
 = 0x0000000000000C00UL; ul_ã°[i].
ex≥˘ed
 = "3072";

885 
i
++; 
ul_ã°
[i].
num
 = 0x00000000000000C0UL; ul_ã°[i].
ex≥˘ed
 = "192";

886 
i
++; 
ul_ã°
[i].
num
 = 0x000000000000000CUL; ul_ã°[i].
ex≥˘ed
 = "12";

888 
i
++; 
ul_ã°
[i].
num
 = 0x00000001UL; ul_ã°[i].
ex≥˘ed
 = "1";

889 
i
++; 
ul_ã°
[i].
num
 = 0x00000000UL; ul_ã°[i].
ex≥˘ed
 = "0";

891 
num_ul⁄g_ã°s
 = 
i
;

895 
i
=1; i<=
num_ul⁄g_ã°s
; i++) {

897 
j
=0; j<
BUFSZ
; j++)

898 
ul_ã°
[
i
].
ªsu…
[
j
] = 'X';

899 
ul_ã°
[
i
].
ªsu…
[
BUFSZ
-1] = '\0';

901 ()
	`cuæ_m•rötf
(
ul_ã°
[
i
].
ªsu…
, "%lu", ul_ã°[i].
num
);

903 if(
	`memcmp
(
ul_ã°
[
i
].
ªsu…
,

904 
ul_ã°
[
i
].
ex≥˘ed
,

905 
	`°æí
(
ul_ã°
[
i
].
ex≥˘ed
))) {

906 
	`¥ötf
("unsignedÜongÅest #%.2d: Failed (Expected: %s Got: %s)\n",

907 
i
, 
ul_ã°
[i].
ex≥˘ed
, ul_ã°[i].
ªsu…
);

908 
Áûed
++;

913 if(!
Áûed
)

914 
	`¥ötf
("All curl_mprintf() unsignedÜongÅests OK!\n");

916 
	`¥ötf
("Some curl_mprintf() unsignedÜongÅests Failed!\n");

918  
Áûed
;

919 
	}
}

922 
	$ã°_sig√d_l⁄g_f‹m©tög
()

924 
i
, 
j
;

925 
num_¶⁄g_ã°s
;

926 
Áûed
 = 0;

928 #i‡(
CURL_SIZEOF_LONG
 == 2)

930 
i
=1; 
¶_ã°
[i].
num
 = 0x7FFFL; sl_ã°[i].
ex≥˘ed
 = "32767";

931 
i
++; 
¶_ã°
[i].
num
 = 0x7FFEL; sl_ã°[i].
ex≥˘ed
 = "32766";

932 
i
++; 
¶_ã°
[i].
num
 = 0x7FFDL; sl_ã°[i].
ex≥˘ed
 = "32765";

933 
i
++; 
¶_ã°
[i].
num
 = 0x7F00L; sl_ã°[i].
ex≥˘ed
 = "32512";

934 
i
++; 
¶_ã°
[i].
num
 = 0x07F0L; sl_ã°[i].
ex≥˘ed
 = "2032";

935 
i
++; 
¶_ã°
[i].
num
 = 0x007FL; sl_ã°[i].
ex≥˘ed
 = "127";

937 
i
++; 
¶_ã°
[i].
num
 = 0x7000L; sl_ã°[i].
ex≥˘ed
 = "28672";

938 
i
++; 
¶_ã°
[i].
num
 = 0x0700L; sl_ã°[i].
ex≥˘ed
 = "1792";

939 
i
++; 
¶_ã°
[i].
num
 = 0x0070L; sl_ã°[i].
ex≥˘ed
 = "112";

940 
i
++; 
¶_ã°
[i].
num
 = 0x0007L; sl_ã°[i].
ex≥˘ed
 = "7";

942 
i
++; 
¶_ã°
[i].
num
 = 0x5000L; sl_ã°[i].
ex≥˘ed
 = "20480";

943 
i
++; 
¶_ã°
[i].
num
 = 0x0500L; sl_ã°[i].
ex≥˘ed
 = "1280";

944 
i
++; 
¶_ã°
[i].
num
 = 0x0050L; sl_ã°[i].
ex≥˘ed
 = "80";

945 
i
++; 
¶_ã°
[i].
num
 = 0x0005L; sl_ã°[i].
ex≥˘ed
 = "5";

947 
i
++; 
¶_ã°
[i].
num
 = 0x0001L; sl_ã°[i].
ex≥˘ed
 = "1";

948 
i
++; 
¶_ã°
[i].
num
 = 0x0000L; sl_ã°[i].
ex≥˘ed
 = "0";

950 
i
++; 
¶_ã°
[i].
num
 = -0x7FFFL -1L; sl_ã°[i].
ex≥˘ed
 = "-32768";

951 
i
++; 
¶_ã°
[i].
num
 = -0x7FFEL -1L; sl_ã°[i].
ex≥˘ed
 = "-32767";

952 
i
++; 
¶_ã°
[i].
num
 = -0x7FFDL -1L; sl_ã°[i].
ex≥˘ed
 = "-32766";

953 
i
++; 
¶_ã°
[i].
num
 = -0x7F00L -1L; sl_ã°[i].
ex≥˘ed
 = "-32513";

954 
i
++; 
¶_ã°
[i].
num
 = -0x07F0L -1L; sl_ã°[i].
ex≥˘ed
 = "-2033";

955 
i
++; 
¶_ã°
[i].
num
 = -0x007FL -1L; sl_ã°[i].
ex≥˘ed
 = "-128";

957 
i
++; 
¶_ã°
[i].
num
 = -0x7000L -1L; sl_ã°[i].
ex≥˘ed
 = "-28673";

958 
i
++; 
¶_ã°
[i].
num
 = -0x0700L -1L; sl_ã°[i].
ex≥˘ed
 = "-1793";

959 
i
++; 
¶_ã°
[i].
num
 = -0x0070L -1L; sl_ã°[i].
ex≥˘ed
 = "-113";

960 
i
++; 
¶_ã°
[i].
num
 = -0x0007L -1L; sl_ã°[i].
ex≥˘ed
 = "-8";

962 
i
++; 
¶_ã°
[i].
num
 = -0x5000L -1L; sl_ã°[i].
ex≥˘ed
 = "-20481";

963 
i
++; 
¶_ã°
[i].
num
 = -0x0500L -1L; sl_ã°[i].
ex≥˘ed
 = "-1281";

964 
i
++; 
¶_ã°
[i].
num
 = -0x0050L -1L; sl_ã°[i].
ex≥˘ed
 = "-81";

965 
i
++; 
¶_ã°
[i].
num
 = -0x0005L -1L; sl_ã°[i].
ex≥˘ed
 = "-6";

967 
i
++; 
¶_ã°
[i].
num
 = 0x0000L -1L; sl_ã°[i].
ex≥˘ed
 = "-1";

969 
num_¶⁄g_ã°s
 = 
i
;

971 #ñi‡(
CURL_SIZEOF_LONG
 == 4)

973 
i
=1; 
¶_ã°
[i].
num
 = 0x7FFFFFFFL; sl_ã°[i].
ex≥˘ed
 = "2147483647";

974 
i
++; 
¶_ã°
[i].
num
 = 0x7FFFFFFEL; sl_ã°[i].
ex≥˘ed
 = "2147483646";

975 
i
++; 
¶_ã°
[i].
num
 = 0x7FFFFFFDL; sl_ã°[i].
ex≥˘ed
 = "2147483645";

976 
i
++; 
¶_ã°
[i].
num
 = 0x7FFF0000L; sl_ã°[i].
ex≥˘ed
 = "2147418112";

977 
i
++; 
¶_ã°
[i].
num
 = 0x00007FFFL; sl_ã°[i].
ex≥˘ed
 = "32767";

979 
i
++; 
¶_ã°
[i].
num
 = 0x7F000000L; sl_ã°[i].
ex≥˘ed
 = "2130706432";

980 
i
++; 
¶_ã°
[i].
num
 = 0x007F0000L; sl_ã°[i].
ex≥˘ed
 = "8323072";

981 
i
++; 
¶_ã°
[i].
num
 = 0x00007F00L; sl_ã°[i].
ex≥˘ed
 = "32512";

982 
i
++; 
¶_ã°
[i].
num
 = 0x0000007FL; sl_ã°[i].
ex≥˘ed
 = "127";

984 
i
++; 
¶_ã°
[i].
num
 = 0x70000000L; sl_ã°[i].
ex≥˘ed
 = "1879048192";

985 
i
++; 
¶_ã°
[i].
num
 = 0x07000000L; sl_ã°[i].
ex≥˘ed
 = "117440512";

986 
i
++; 
¶_ã°
[i].
num
 = 0x00700000L; sl_ã°[i].
ex≥˘ed
 = "7340032";

987 
i
++; 
¶_ã°
[i].
num
 = 0x00070000L; sl_ã°[i].
ex≥˘ed
 = "458752";

988 
i
++; 
¶_ã°
[i].
num
 = 0x00007000L; sl_ã°[i].
ex≥˘ed
 = "28672";

989 
i
++; 
¶_ã°
[i].
num
 = 0x00000700L; sl_ã°[i].
ex≥˘ed
 = "1792";

990 
i
++; 
¶_ã°
[i].
num
 = 0x00000070L; sl_ã°[i].
ex≥˘ed
 = "112";

991 
i
++; 
¶_ã°
[i].
num
 = 0x00000007L; sl_ã°[i].
ex≥˘ed
 = "7";

993 
i
++; 
¶_ã°
[i].
num
 = 0x50000000L; sl_ã°[i].
ex≥˘ed
 = "1342177280";

994 
i
++; 
¶_ã°
[i].
num
 = 0x05000000L; sl_ã°[i].
ex≥˘ed
 = "83886080";

995 
i
++; 
¶_ã°
[i].
num
 = 0x00500000L; sl_ã°[i].
ex≥˘ed
 = "5242880";

996 
i
++; 
¶_ã°
[i].
num
 = 0x00050000L; sl_ã°[i].
ex≥˘ed
 = "327680";

997 
i
++; 
¶_ã°
[i].
num
 = 0x00005000L; sl_ã°[i].
ex≥˘ed
 = "20480";

998 
i
++; 
¶_ã°
[i].
num
 = 0x00000500L; sl_ã°[i].
ex≥˘ed
 = "1280";

999 
i
++; 
¶_ã°
[i].
num
 = 0x00000050L; sl_ã°[i].
ex≥˘ed
 = "80";

1000 
i
++; 
¶_ã°
[i].
num
 = 0x00000005L; sl_ã°[i].
ex≥˘ed
 = "5";

1002 
i
++; 
¶_ã°
[i].
num
 = 0x00000001L; sl_ã°[i].
ex≥˘ed
 = "1";

1003 
i
++; 
¶_ã°
[i].
num
 = 0x00000000L; sl_ã°[i].
ex≥˘ed
 = "0";

1005 
i
++; 
¶_ã°
[i].
num
 = -0x7FFFFFFFL -1L; sl_ã°[i].
ex≥˘ed
 = "-2147483648";

1006 
i
++; 
¶_ã°
[i].
num
 = -0x7FFFFFFEL -1L; sl_ã°[i].
ex≥˘ed
 = "-2147483647";

1007 
i
++; 
¶_ã°
[i].
num
 = -0x7FFFFFFDL -1L; sl_ã°[i].
ex≥˘ed
 = "-2147483646";

1008 
i
++; 
¶_ã°
[i].
num
 = -0x7FFF0000L -1L; sl_ã°[i].
ex≥˘ed
 = "-2147418113";

1009 
i
++; 
¶_ã°
[i].
num
 = -0x00007FFFL -1L; sl_ã°[i].
ex≥˘ed
 = "-32768";

1011 
i
++; 
¶_ã°
[i].
num
 = -0x7F000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-2130706433";

1012 
i
++; 
¶_ã°
[i].
num
 = -0x007F0000L -1L; sl_ã°[i].
ex≥˘ed
 = "-8323073";

1013 
i
++; 
¶_ã°
[i].
num
 = -0x00007F00L -1L; sl_ã°[i].
ex≥˘ed
 = "-32513";

1014 
i
++; 
¶_ã°
[i].
num
 = -0x0000007FL -1L; sl_ã°[i].
ex≥˘ed
 = "-128";

1016 
i
++; 
¶_ã°
[i].
num
 = -0x70000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-1879048193";

1017 
i
++; 
¶_ã°
[i].
num
 = -0x07000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-117440513";

1018 
i
++; 
¶_ã°
[i].
num
 = -0x00700000L -1L; sl_ã°[i].
ex≥˘ed
 = "-7340033";

1019 
i
++; 
¶_ã°
[i].
num
 = -0x00070000L -1L; sl_ã°[i].
ex≥˘ed
 = "-458753";

1020 
i
++; 
¶_ã°
[i].
num
 = -0x00007000L -1L; sl_ã°[i].
ex≥˘ed
 = "-28673";

1021 
i
++; 
¶_ã°
[i].
num
 = -0x00000700L -1L; sl_ã°[i].
ex≥˘ed
 = "-1793";

1022 
i
++; 
¶_ã°
[i].
num
 = -0x00000070L -1L; sl_ã°[i].
ex≥˘ed
 = "-113";

1023 
i
++; 
¶_ã°
[i].
num
 = -0x00000007L -1L; sl_ã°[i].
ex≥˘ed
 = "-8";

1025 
i
++; 
¶_ã°
[i].
num
 = -0x50000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-1342177281";

1026 
i
++; 
¶_ã°
[i].
num
 = -0x05000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-83886081";

1027 
i
++; 
¶_ã°
[i].
num
 = -0x00500000L -1L; sl_ã°[i].
ex≥˘ed
 = "-5242881";

1028 
i
++; 
¶_ã°
[i].
num
 = -0x00050000L -1L; sl_ã°[i].
ex≥˘ed
 = "-327681";

1029 
i
++; 
¶_ã°
[i].
num
 = -0x00005000L -1L; sl_ã°[i].
ex≥˘ed
 = "-20481";

1030 
i
++; 
¶_ã°
[i].
num
 = -0x00000500L -1L; sl_ã°[i].
ex≥˘ed
 = "-1281";

1031 
i
++; 
¶_ã°
[i].
num
 = -0x00000050L -1L; sl_ã°[i].
ex≥˘ed
 = "-81";

1032 
i
++; 
¶_ã°
[i].
num
 = -0x00000005L -1L; sl_ã°[i].
ex≥˘ed
 = "-6";

1034 
i
++; 
¶_ã°
[i].
num
 = 0x00000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-1";

1036 
num_¶⁄g_ã°s
 = 
i
;

1038 #ñi‡(
CURL_SIZEOF_LONG
 == 8)

1040 
i
=1; 
¶_ã°
[i].
num
 = 0x7FFFFFFFFFFFFFFFL; sl_ã°[i].
ex≥˘ed
 = "9223372036854775807";

1041 
i
++; 
¶_ã°
[i].
num
 = 0x7FFFFFFFFFFFFFFEL; sl_ã°[i].
ex≥˘ed
 = "9223372036854775806";

1042 
i
++; 
¶_ã°
[i].
num
 = 0x7FFFFFFFFFFFFFFDL; sl_ã°[i].
ex≥˘ed
 = "9223372036854775805";

1043 
i
++; 
¶_ã°
[i].
num
 = 0x7FFFFFFF00000000L; sl_ã°[i].
ex≥˘ed
 = "9223372032559808512";

1044 
i
++; 
¶_ã°
[i].
num
 = 0x000000007FFFFFFFL; sl_ã°[i].
ex≥˘ed
 = "2147483647";

1046 
i
++; 
¶_ã°
[i].
num
 = 0x7FFF000000000000L; sl_ã°[i].
ex≥˘ed
 = "9223090561878065152";

1047 
i
++; 
¶_ã°
[i].
num
 = 0x00007FFF00000000L; sl_ã°[i].
ex≥˘ed
 = "140733193388032";

1048 
i
++; 
¶_ã°
[i].
num
 = 0x000000007FFF0000L; sl_ã°[i].
ex≥˘ed
 = "2147418112";

1049 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000007FFFL; sl_ã°[i].
ex≥˘ed
 = "32767";

1051 
i
++; 
¶_ã°
[i].
num
 = 0x7F00000000000000L; sl_ã°[i].
ex≥˘ed
 = "9151314442816847872";

1052 
i
++; 
¶_ã°
[i].
num
 = 0x007F000000000000L; sl_ã°[i].
ex≥˘ed
 = "35747322042253312";

1053 
i
++; 
¶_ã°
[i].
num
 = 0x00007F0000000000L; sl_ã°[i].
ex≥˘ed
 = "139637976727552";

1054 
i
++; 
¶_ã°
[i].
num
 = 0x0000007F00000000L; sl_ã°[i].
ex≥˘ed
 = "545460846592";

1055 
i
++; 
¶_ã°
[i].
num
 = 0x000000007F000000L; sl_ã°[i].
ex≥˘ed
 = "2130706432";

1056 
i
++; 
¶_ã°
[i].
num
 = 0x00000000007F0000L; sl_ã°[i].
ex≥˘ed
 = "8323072";

1057 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000007F00L; sl_ã°[i].
ex≥˘ed
 = "32512";

1058 
i
++; 
¶_ã°
[i].
num
 = 0x000000000000007FL; sl_ã°[i].
ex≥˘ed
 = "127";

1060 
i
++; 
¶_ã°
[i].
num
 = 0x7000000000000000L; sl_ã°[i].
ex≥˘ed
 = "8070450532247928832";

1061 
i
++; 
¶_ã°
[i].
num
 = 0x0700000000000000L; sl_ã°[i].
ex≥˘ed
 = "504403158265495552";

1062 
i
++; 
¶_ã°
[i].
num
 = 0x0070000000000000L; sl_ã°[i].
ex≥˘ed
 = "31525197391593472";

1063 
i
++; 
¶_ã°
[i].
num
 = 0x0007000000000000L; sl_ã°[i].
ex≥˘ed
 = "1970324836974592";

1064 
i
++; 
¶_ã°
[i].
num
 = 0x0000700000000000L; sl_ã°[i].
ex≥˘ed
 = "123145302310912";

1065 
i
++; 
¶_ã°
[i].
num
 = 0x0000070000000000L; sl_ã°[i].
ex≥˘ed
 = "7696581394432";

1066 
i
++; 
¶_ã°
[i].
num
 = 0x0000007000000000L; sl_ã°[i].
ex≥˘ed
 = "481036337152";

1067 
i
++; 
¶_ã°
[i].
num
 = 0x0000000700000000L; sl_ã°[i].
ex≥˘ed
 = "30064771072";

1068 
i
++; 
¶_ã°
[i].
num
 = 0x0000000070000000L; sl_ã°[i].
ex≥˘ed
 = "1879048192";

1069 
i
++; 
¶_ã°
[i].
num
 = 0x0000000007000000L; sl_ã°[i].
ex≥˘ed
 = "117440512";

1070 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000700000L; sl_ã°[i].
ex≥˘ed
 = "7340032";

1071 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000070000L; sl_ã°[i].
ex≥˘ed
 = "458752";

1072 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000007000L; sl_ã°[i].
ex≥˘ed
 = "28672";

1073 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000000700L; sl_ã°[i].
ex≥˘ed
 = "1792";

1074 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000000070L; sl_ã°[i].
ex≥˘ed
 = "112";

1075 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000000007L; sl_ã°[i].
ex≥˘ed
 = "7";

1077 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000000001L; sl_ã°[i].
ex≥˘ed
 = "1";

1078 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000000000L; sl_ã°[i].
ex≥˘ed
 = "0";

1080 
i
++; 
¶_ã°
[i].
num
 = -0x7FFFFFFFFFFFFFFFL -1L; sl_ã°[i].
ex≥˘ed
 = "-9223372036854775808";

1081 
i
++; 
¶_ã°
[i].
num
 = -0x7FFFFFFFFFFFFFFEL -1L; sl_ã°[i].
ex≥˘ed
 = "-9223372036854775807";

1082 
i
++; 
¶_ã°
[i].
num
 = -0x7FFFFFFFFFFFFFFDL -1L; sl_ã°[i].
ex≥˘ed
 = "-9223372036854775806";

1083 
i
++; 
¶_ã°
[i].
num
 = -0x7FFFFFFF00000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-9223372032559808513";

1084 
i
++; 
¶_ã°
[i].
num
 = -0x000000007FFFFFFFL -1L; sl_ã°[i].
ex≥˘ed
 = "-2147483648";

1086 
i
++; 
¶_ã°
[i].
num
 = -0x7FFF000000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-9223090561878065153";

1087 
i
++; 
¶_ã°
[i].
num
 = -0x00007FFF00000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-140733193388033";

1088 
i
++; 
¶_ã°
[i].
num
 = -0x000000007FFF0000L -1L; sl_ã°[i].
ex≥˘ed
 = "-2147418113";

1089 
i
++; 
¶_ã°
[i].
num
 = -0x0000000000007FFFL -1L; sl_ã°[i].
ex≥˘ed
 = "-32768";

1091 
i
++; 
¶_ã°
[i].
num
 = -0x7F00000000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-9151314442816847873";

1092 
i
++; 
¶_ã°
[i].
num
 = -0x007F000000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-35747322042253313";

1093 
i
++; 
¶_ã°
[i].
num
 = -0x00007F0000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-139637976727553";

1094 
i
++; 
¶_ã°
[i].
num
 = -0x0000007F00000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-545460846593";

1095 
i
++; 
¶_ã°
[i].
num
 = -0x000000007F000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-2130706433";

1096 
i
++; 
¶_ã°
[i].
num
 = -0x00000000007F0000L -1L; sl_ã°[i].
ex≥˘ed
 = "-8323073";

1097 
i
++; 
¶_ã°
[i].
num
 = -0x0000000000007F00L -1L; sl_ã°[i].
ex≥˘ed
 = "-32513";

1098 
i
++; 
¶_ã°
[i].
num
 = -0x000000000000007FL -1L; sl_ã°[i].
ex≥˘ed
 = "-128";

1100 
i
++; 
¶_ã°
[i].
num
 = -0x7000000000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-8070450532247928833";

1101 
i
++; 
¶_ã°
[i].
num
 = -0x0700000000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-504403158265495553";

1102 
i
++; 
¶_ã°
[i].
num
 = -0x0070000000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-31525197391593473";

1103 
i
++; 
¶_ã°
[i].
num
 = -0x0007000000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-1970324836974593";

1104 
i
++; 
¶_ã°
[i].
num
 = -0x0000700000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-123145302310913";

1105 
i
++; 
¶_ã°
[i].
num
 = -0x0000070000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-7696581394433";

1106 
i
++; 
¶_ã°
[i].
num
 = -0x0000007000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-481036337153";

1107 
i
++; 
¶_ã°
[i].
num
 = -0x0000000700000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-30064771073";

1108 
i
++; 
¶_ã°
[i].
num
 = -0x0000000070000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-1879048193";

1109 
i
++; 
¶_ã°
[i].
num
 = -0x0000000007000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-117440513";

1110 
i
++; 
¶_ã°
[i].
num
 = -0x0000000000700000L -1L; sl_ã°[i].
ex≥˘ed
 = "-7340033";

1111 
i
++; 
¶_ã°
[i].
num
 = -0x0000000000070000L -1L; sl_ã°[i].
ex≥˘ed
 = "-458753";

1112 
i
++; 
¶_ã°
[i].
num
 = -0x0000000000007000L -1L; sl_ã°[i].
ex≥˘ed
 = "-28673";

1113 
i
++; 
¶_ã°
[i].
num
 = -0x0000000000000700L -1L; sl_ã°[i].
ex≥˘ed
 = "-1793";

1114 
i
++; 
¶_ã°
[i].
num
 = -0x0000000000000070L -1L; sl_ã°[i].
ex≥˘ed
 = "-113";

1115 
i
++; 
¶_ã°
[i].
num
 = -0x0000000000000007L -1L; sl_ã°[i].
ex≥˘ed
 = "-8";

1117 
i
++; 
¶_ã°
[i].
num
 = 0x0000000000000000L -1L; sl_ã°[i].
ex≥˘ed
 = "-1";

1119 
num_¶⁄g_ã°s
 = 
i
;

1123 
i
=1; i<=
num_¶⁄g_ã°s
; i++) {

1125 
j
=0; j<
BUFSZ
; j++)

1126 
¶_ã°
[
i
].
ªsu…
[
j
] = 'X';

1127 
¶_ã°
[
i
].
ªsu…
[
BUFSZ
-1] = '\0';

1129 ()
	`cuæ_m•rötf
(
¶_ã°
[
i
].
ªsu…
, "%ld", sl_ã°[i].
num
);

1131 if(
	`memcmp
(
¶_ã°
[
i
].
ªsu…
,

1132 
¶_ã°
[
i
].
ex≥˘ed
,

1133 
	`°æí
(
¶_ã°
[
i
].
ex≥˘ed
))) {

1134 
	`¥ötf
("signedÜongÅest #%.2d: Failed (Expected: %s Got: %s)\n",

1135 
i
, 
¶_ã°
[i].
ex≥˘ed
, sl_ã°[i].
ªsu…
);

1136 
Áûed
++;

1141 if(!
Áûed
)

1142 
	`¥ötf
("All curl_mprintf() signedÜongÅests OK!\n");

1144 
	`¥ötf
("Some curl_mprintf() signedÜongÅests Failed!\n");

1146  
Áûed
;

1147 
	}
}

1150 
	$ã°_cuæ_off_t_f‹m©tög
()

1152 
i
, 
j
;

1153 
num_cof·_ã°s
;

1154 
Áûed
 = 0;

1156 #i‡(
CURL_SIZEOF_CURL_OFF_T
 == 2)

1158 
i
=1; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFF); co_ã°[i].
ex≥˘ed
 = "32767";

1159 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFE); co_ã°[i].
ex≥˘ed
 = "32766";

1160 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFD); co_ã°[i].
ex≥˘ed
 = "32765";

1161 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7F00); co_ã°[i].
ex≥˘ed
 = "32512";

1162 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x07F0); co_ã°[i].
ex≥˘ed
 = "2032";

1163 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x007F); co_ã°[i].
ex≥˘ed
 = "127";

1165 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7000); co_ã°[i].
ex≥˘ed
 = "28672";

1166 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0700); co_ã°[i].
ex≥˘ed
 = "1792";

1167 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0070); co_ã°[i].
ex≥˘ed
 = "112";

1168 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0007); co_ã°[i].
ex≥˘ed
 = "7";

1170 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x5000); co_ã°[i].
ex≥˘ed
 = "20480";

1171 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0500); co_ã°[i].
ex≥˘ed
 = "1280";

1172 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0050); co_ã°[i].
ex≥˘ed
 = "80";

1173 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0005); co_ã°[i].
ex≥˘ed
 = "5";

1175 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0001); co_ã°[i].
ex≥˘ed
 = "1";

1176 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000); co_ã°[i].
ex≥˘ed
 = "0";

1178 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFFË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-32768";

1179 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFEË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-32767";

1180 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFDË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-32766";

1181 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7F00Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-32513";

1182 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x07F0Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-2033";

1183 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x007FË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-128";

1185 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-28673";

1186 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0700Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1793";

1187 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0070Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-113";

1188 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0007Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-8";

1190 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x5000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-20481";

1191 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0500Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1281";

1192 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0050Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-81";

1193 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0005Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-6";

1195 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1";

1197 
num_cof·_ã°s
 = 
i
;

1199 #ñi‡(
CURL_SIZEOF_CURL_OFF_T
 == 4)

1201 
i
=1; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFFFFFF); co_ã°[i].
ex≥˘ed
 = "2147483647";

1202 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFFFFFE); co_ã°[i].
ex≥˘ed
 = "2147483646";

1203 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFFFFFD); co_ã°[i].
ex≥˘ed
 = "2147483645";

1204 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFF0000); co_ã°[i].
ex≥˘ed
 = "2147418112";

1205 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00007FFF); co_ã°[i].
ex≥˘ed
 = "32767";

1207 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7F000000); co_ã°[i].
ex≥˘ed
 = "2130706432";

1208 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x007F0000); co_ã°[i].
ex≥˘ed
 = "8323072";

1209 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00007F00); co_ã°[i].
ex≥˘ed
 = "32512";

1210 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000007F); co_ã°[i].
ex≥˘ed
 = "127";

1212 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x70000000); co_ã°[i].
ex≥˘ed
 = "1879048192";

1213 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x07000000); co_ã°[i].
ex≥˘ed
 = "117440512";

1214 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00700000); co_ã°[i].
ex≥˘ed
 = "7340032";

1215 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00070000); co_ã°[i].
ex≥˘ed
 = "458752";

1216 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00007000); co_ã°[i].
ex≥˘ed
 = "28672";

1217 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00000700); co_ã°[i].
ex≥˘ed
 = "1792";

1218 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00000070); co_ã°[i].
ex≥˘ed
 = "112";

1219 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00000007); co_ã°[i].
ex≥˘ed
 = "7";

1221 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x50000000); co_ã°[i].
ex≥˘ed
 = "1342177280";

1222 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x05000000); co_ã°[i].
ex≥˘ed
 = "83886080";

1223 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00500000); co_ã°[i].
ex≥˘ed
 = "5242880";

1224 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00050000); co_ã°[i].
ex≥˘ed
 = "327680";

1225 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00005000); co_ã°[i].
ex≥˘ed
 = "20480";

1226 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00000500); co_ã°[i].
ex≥˘ed
 = "1280";

1227 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00000050); co_ã°[i].
ex≥˘ed
 = "80";

1228 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00000005); co_ã°[i].
ex≥˘ed
 = "5";

1230 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00000001); co_ã°[i].
ex≥˘ed
 = "1";

1231 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00000000); co_ã°[i].
ex≥˘ed
 = "0";

1233 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFFFFFFË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-2147483648";

1234 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFFFFFEË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-2147483647";

1235 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFFFFFDË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-2147483646";

1236 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFF0000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-2147418113";

1237 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00007FFFË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-32768";

1239 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7F000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-2130706433";

1240 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x007F0000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-8323073";

1241 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00007F00Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-32513";

1242 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000007FË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-128";

1244 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x70000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1879048193";

1245 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x07000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-117440513";

1246 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00700000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-7340033";

1247 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00070000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-458753";

1248 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00007000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-28673";

1249 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00000700Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1793";

1250 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00000070Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-113";

1251 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00000007Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-8";

1253 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x50000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1342177281";

1254 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x05000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-83886081";

1255 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00500000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-5242881";

1256 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00050000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-327681";

1257 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00005000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-20481";

1258 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00000500Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1281";

1259 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00000050Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-81";

1260 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00000005Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-6";

1262 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1";

1264 
num_cof·_ã°s
 = 
i
;

1266 #ñi‡(
CURL_SIZEOF_CURL_OFF_T
 == 8)

1268 
i
=1; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFFFFFFFFFFFFFF); co_ã°[i].
ex≥˘ed
 = "9223372036854775807";

1269 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFFFFFFFFFFFFFE); co_ã°[i].
ex≥˘ed
 = "9223372036854775806";

1270 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFFFFFFFFFFFFFD); co_ã°[i].
ex≥˘ed
 = "9223372036854775805";

1271 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFFFFFF00000000); co_ã°[i].
ex≥˘ed
 = "9223372032559808512";

1272 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x000000007FFFFFFF); co_ã°[i].
ex≥˘ed
 = "2147483647";

1274 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7FFF000000000000); co_ã°[i].
ex≥˘ed
 = "9223090561878065152";

1275 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00007FFF00000000); co_ã°[i].
ex≥˘ed
 = "140733193388032";

1276 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x000000007FFF0000); co_ã°[i].
ex≥˘ed
 = "2147418112";

1277 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000007FFF); co_ã°[i].
ex≥˘ed
 = "32767";

1279 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7F00000000000000); co_ã°[i].
ex≥˘ed
 = "9151314442816847872";

1280 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x007F000000000000); co_ã°[i].
ex≥˘ed
 = "35747322042253312";

1281 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00007F0000000000); co_ã°[i].
ex≥˘ed
 = "139637976727552";

1282 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000007F00000000); co_ã°[i].
ex≥˘ed
 = "545460846592";

1283 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x000000007F000000); co_ã°[i].
ex≥˘ed
 = "2130706432";

1284 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x00000000007F0000); co_ã°[i].
ex≥˘ed
 = "8323072";

1285 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000007F00); co_ã°[i].
ex≥˘ed
 = "32512";

1286 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x000000000000007F); co_ã°[i].
ex≥˘ed
 = "127";

1288 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x7000000000000000); co_ã°[i].
ex≥˘ed
 = "8070450532247928832";

1289 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0700000000000000); co_ã°[i].
ex≥˘ed
 = "504403158265495552";

1290 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0070000000000000); co_ã°[i].
ex≥˘ed
 = "31525197391593472";

1291 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0007000000000000); co_ã°[i].
ex≥˘ed
 = "1970324836974592";

1292 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000700000000000); co_ã°[i].
ex≥˘ed
 = "123145302310912";

1293 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000070000000000); co_ã°[i].
ex≥˘ed
 = "7696581394432";

1294 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000007000000000); co_ã°[i].
ex≥˘ed
 = "481036337152";

1295 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000700000000); co_ã°[i].
ex≥˘ed
 = "30064771072";

1296 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000070000000); co_ã°[i].
ex≥˘ed
 = "1879048192";

1297 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000007000000); co_ã°[i].
ex≥˘ed
 = "117440512";

1298 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000700000); co_ã°[i].
ex≥˘ed
 = "7340032";

1299 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000070000); co_ã°[i].
ex≥˘ed
 = "458752";

1300 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000007000); co_ã°[i].
ex≥˘ed
 = "28672";

1301 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000000700); co_ã°[i].
ex≥˘ed
 = "1792";

1302 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000000070); co_ã°[i].
ex≥˘ed
 = "112";

1303 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000000007); co_ã°[i].
ex≥˘ed
 = "7";

1305 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000000001); co_ã°[i].
ex≥˘ed
 = "1";

1306 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000000000); co_ã°[i].
ex≥˘ed
 = "0";

1308 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFFFFFFFFFFFFFFË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-9223372036854775808";

1309 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFFFFFFFFFFFFFEË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-9223372036854775807";

1310 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFFFFFFFFFFFFFDË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-9223372036854775806";

1311 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFFFFFF00000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-9223372032559808513";

1312 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x000000007FFFFFFFË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-2147483648";

1314 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7FFF000000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-9223090561878065153";

1315 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00007FFF00000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-140733193388033";

1316 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x000000007FFF0000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-2147418113";

1317 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000000007FFFË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-32768";

1319 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7F00000000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-9151314442816847873";

1320 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x007F000000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-35747322042253313";

1321 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00007F0000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-139637976727553";

1322 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000007F00000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-545460846593";

1323 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x000000007F000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-2130706433";

1324 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x00000000007F0000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-8323073";

1325 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000000007F00Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-32513";

1326 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x000000000000007FË-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-128";

1328 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x7000000000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-8070450532247928833";

1329 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0700000000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-504403158265495553";

1330 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0070000000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-31525197391593473";

1331 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0007000000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1970324836974593";

1332 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000700000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-123145302310913";

1333 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000070000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-7696581394433";

1334 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000007000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-481036337153";

1335 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000700000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-30064771073";

1336 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000070000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1879048193";

1337 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000007000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-117440513";

1338 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000000700000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-7340033";

1339 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000000070000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-458753";

1340 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000000007000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-28673";

1341 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000000000700Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1793";

1342 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000000000070Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-113";

1343 
i
++; 
co_ã°
[i].
num
 = -
	`MPRNT_OFF_T_C
(0x0000000000000007Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-8";

1345 
i
++; 
co_ã°
[i].
num
 = 
	`MPRNT_OFF_T_C
(0x0000000000000000Ë-MPRNT_OFF_T_C(1); co_ã°[i].
ex≥˘ed
 = "-1";

1347 
num_cof·_ã°s
 = 
i
;

1351 
i
=1; i<=
num_cof·_ã°s
; i++) {

1353 
j
=0; j<
BUFSZ
; j++)

1354 
co_ã°
[
i
].
ªsu…
[
j
] = 'X';

1355 
co_ã°
[
i
].
ªsu…
[
BUFSZ
-1] = '\0';

1357 ()
	`cuæ_m•rötf
(
co_ã°
[
i
].
ªsu…
, "%" 
CURL_FORMAT_CURL_OFF_T
, co_ã°[i].
num
);

1359 if(
	`memcmp
(
co_ã°
[
i
].
ªsu…
,

1360 
co_ã°
[
i
].
ex≥˘ed
,

1361 
	`°æí
(
co_ã°
[
i
].
ex≥˘ed
))) {

1362 
	`¥ötf
("curl_off_tÅest #%.2d: Failed (Expected: %s Got: %s)\n",

1363 
i
, 
co_ã°
[i].
ex≥˘ed
, co_ã°[i].
ªsu…
);

1364 
Áûed
++;

1369 if(!
Áûed
)

1370 
	`¥ötf
("All curl_mprintf() curl_off_tÅests OK!\n");

1372 
	`¥ötf
("Some curl_mprintf() curl_off_tÅests Failed!\n");

1374  
Áûed
;

1375 
	}
}

1378 
	$ã°
(*
URL
)

1380 
îr‹s
 = 0;

1381 ()
URL
;

1383 
îr‹s
 +
	`ã°_unsig√d_sh‹t_f‹m©tög
();

1385 
îr‹s
 +
	`ã°_sig√d_sh‹t_f‹m©tög
();

1387 
îr‹s
 +
	`ã°_unsig√d_öt_f‹m©tög
();

1389 
îr‹s
 +
	`ã°_sig√d_öt_f‹m©tög
();

1391 
îr‹s
 +
	`ã°_unsig√d_l⁄g_f‹m©tög
();

1393 
îr‹s
 +
	`ã°_sig√d_l⁄g_f‹m©tög
();

1395 
îr‹s
 +
	`ã°_cuæ_off_t_f‹m©tög
();

1397 if(
îr‹s
)

1398  
TEST_ERR_MAJOR_BAD
;

1401 
	}
}

	@tests/libtest/lib558.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
a
[] = {0x2f, 0x3a, 0x3b, 0x3c, 0x3d, 0x3e, 0x3f,

30 
CURLcode
 
ªs
 = 
CURLE_OK
;

31 *
±r
 = 
NULL
;

32 
asize
;

34 ()
URL
;

36 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

37 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

38  
TEST_ERR_MAJOR_BAD
;

41 
±r
 = 
	`mÆloc
(558);

42 
	`Cuæ_ß„‰ì
(
±r
);

44 
asize
 = ()(
a
);

45 
±r
 = 
	`cuæ_ósy_esˇ≥
(
NULL
, (*)
a
, 
asize
);

46 if(
±r
)

47 
	`cuæ_‰ì
(
±r
);

49 
	`cuæ_globÆ_˛ónup
();

51  ()
ªs
;

52 
	}
}

	@tests/libtest/lib560.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"w¨∆ess.h
"

26 
	~"memdebug.h
"

28 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

40 
	$ã°
(*
URL
)

42 
CURL
 *
hâp_h™dÀ
 = 
NULL
;

43 
CURLM
 *
mu…i_h™dÀ
 = 
NULL
;

44 
ªs
 = 0;

46 
°ûl_ru¬ög
;

48 
	`°¨t_ã°_timög
();

54 
	`ósy_öô
(
hâp_h™dÀ
);

57 
	`ósy_£t›t
(
hâp_h™dÀ
, 
CURLOPT_URL
, 
URL
);

58 
	`ósy_£t›t
(
hâp_h™dÀ
, 
CURLOPT_HEADER
, 1L);

59 
	`ósy_£t›t
(
hâp_h™dÀ
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

60 
	`ósy_£t›t
(
hâp_h™dÀ
, 
CURLOPT_SSL_VERIFYHOST
, 0L);

63 
	`mu…i_öô
(
mu…i_h™dÀ
);

66 
	`mu…i_add_h™dÀ
(
mu…i_h™dÀ
, 
hâp_h™dÀ
);

69 
	`mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

71 
	`ab‹t_⁄_ã°_timeout
();

73 
°ûl_ru¬ög
) {

74 
timevÆ
 
timeout
;

76 
fd_£t
 
fdªad
;

77 
fd_£t
 
fdwrôe
;

78 
fd_£t
 
fdex˚p
;

79 
maxfd
 = -99;

81 
	`FD_ZERO
(&
fdªad
);

82 
	`FD_ZERO
(&
fdwrôe
);

83 
	`FD_ZERO
(&
fdex˚p
);

86 
timeout
.
tv_£c
 = 1;

87 
timeout
.
tv_u£c
 = 0;

90 
	`mu…i_fd£t
(
mu…i_h™dÀ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

94 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

96 
	`ab‹t_⁄_ã°_timeout
();

99 
	`mu…i_≥rf‹m
(
mu…i_h™dÀ
, &
°ûl_ru¬ög
);

101 
	`ab‹t_⁄_ã°_timeout
();

104 
ã°_˛ónup
:

108 
	`cuæ_mu…i_˛ónup
(
mu…i_h™dÀ
);

109 
	`cuæ_ósy_˛ónup
(
hâp_h™dÀ
);

110 
	`cuæ_globÆ_˛ónup
();

112  
ªs
;

113 
	}
}

	@tests/libtest/lib562.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_FCNTL_H


25 
	~<f˙é.h
>

28 
	~"memdebug.h
"

38 
	$ã°
(*
URL
)

40 
CURL
 *
cuæ
;

41 
CURLcode
 
ªs
 = 
CURLE_OK
;

43 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

44 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

45  
TEST_ERR_MAJOR_BAD
;

49 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

50 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

51 
	`cuæ_globÆ_˛ónup
();

52  
TEST_ERR_MAJOR_BAD
;

56 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

59 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PORT
, 
	`°πﬁ
(
libã°_¨g2
, 
NULL
, 10));

62 
	`ã°_£t›t
(
cuæ
,
CURLOPT_URL
, 
URL
);

65 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

67 
ã°_˛ónup
:

69 
	`cuæ_ósy_˛ónup
(
cuæ
);

70 
	`cuæ_globÆ_˛ónup
();

72  
ªs
;

73 
	}
}

	@tests/libtest/lib564.c

22 
	~"ã°.h
"

24 
	~<f˙é.h
>

26 
	~"ã°utû.h
"

27 
	~"w¨∆ess.h
"

28 
	~"memdebug.h
"

30 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

32 
	$ã°
(*
URL
)

34 
ªs
 = 0;

35 
CURL
 *
cuæ
 = 
NULL
;

36 
ru¬ög
;

37 
CURLM
 *
m
 = 
NULL
;

39 
	`°¨t_ã°_timög
();

41 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

43 
	`ósy_öô
(
cuæ
);

45 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

46 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

47 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

48 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_PROXYTYPE
, ()
CURLPROXY_SOCKS4
);

50 
	`mu…i_öô
(
m
);

52 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
);

54 
	`Ârötf
(
°dîr
, "Startát URL 0\n");

57 
timevÆ
 
öãrvÆ
;

58 
fd_£t
 
rd
, 
wr
, 
exc
;

59 
maxfd
 = -99;

61 
öãrvÆ
.
tv_£c
 = 1;

62 
öãrvÆ
.
tv_u£c
 = 0;

64 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

66 
	`ab‹t_⁄_ã°_timeout
();

68 if(!
ru¬ög
)

71 
	`FD_ZERO
(&
rd
);

72 
	`FD_ZERO
(&
wr
);

73 
	`FD_ZERO
(&
exc
);

75 
	`mu…i_fd£t
(
m
, &
rd
, &
wr
, &
exc
, &
maxfd
);

79 
	`£À˘_ã°
(
maxfd
+1, &
rd
, &
wr
, &
exc
, &
öãrvÆ
);

81 
	`ab‹t_⁄_ã°_timeout
();

84 
ã°_˛ónup
:

88 
	`cuæ_ósy_˛ónup
(
cuæ
);

89 
	`cuæ_mu…i_˛ónup
(
m
);

90 
	`cuæ_globÆ_˛ónup
();

92  
ªs
;

93 
	}
}

	@tests/libtest/lib566.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURLcode
 
ªs
;

29 
CURL
 *
cuæ
;

31 
c⁄ã¡_Àngth
 = 3;

33 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

34 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

35  
TEST_ERR_MAJOR_BAD
;

38 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

39 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

40 
	`cuæ_globÆ_˛ónup
();

41  
TEST_ERR_MAJOR_BAD
;

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

45 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

47 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

49 if(!
ªs
) {

50 
FILE
 *
moo
;

51 
ªs
 = 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_CONTENT_LENGTH_DOWNLOAD
,

52 &
c⁄ã¡_Àngth
);

53 
moo
 = 
	`f›í
(
libã°_¨g2
, "wb");

54 if(
moo
) {

55 
	`Ârötf
(
moo
, "CL: %.0f\n", 
c⁄ã¡_Àngth
);

56 
	`f˛o£
(
moo
);

60 
ã°_˛ónup
:

62 
	`cuæ_ósy_˛ónup
(
cuæ
);

63 
	`cuæ_globÆ_˛ónup
();

65  ()
ªs
;

66 
	}
}

	@tests/libtest/lib567.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

29 
	$ã°
(*
URL
)

31 
CURLcode
 
ªs
;

32 
CURL
 *
cuæ
;

33 
cuæ_¶i°
 *
cu°om_hódîs
=
NULL
;

35 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

36 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

37  
TEST_ERR_MAJOR_BAD
;

40 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

41 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

42 
	`cuæ_globÆ_˛ónup
();

43  
TEST_ERR_MAJOR_BAD
;

47 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADERDATA
, 
°dout
);

48 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
°dout
);

50 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

51 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
URL
);

52 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_OPTIONS
);

53 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_USERAGENT
, "test567");

55 
cu°om_hódîs
 = 
	`cuæ_¶i°_≠≥nd
(custom_headers, "Test-Number: 567");

56 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSPHEADER
, 
cu°om_hódîs
);

58 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

60 
ã°_˛ónup
:

62 if(
cu°om_hódîs
)

63 
	`cuæ_¶i°_‰ì_Æl
(
cu°om_hódîs
);

64 
	`cuæ_ósy_˛ónup
(
cuæ
);

65 
	`cuæ_globÆ_˛ónup
();

67  ()
ªs
;

68 
	}
}

	@tests/libtest/lib568.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_SYS_STAT_H


25 
	~<sys/°©.h
>

27 #ifde‡
HAVE_FCNTL_H


28 
	~<f˙é.h
>

31 
	~<cuæ/m¥ötf.h
>

33 
	~"memdebug.h
"

36 *
	$subuæ
(c⁄° *
ba£
, 
i
)

38  
	`cuæ_m≠rötf
("%s%.4d", 
ba£
, 
i
);

39 
	}
}

44 
	$ã°
(*
URL
)

46 
ªs
;

47 
CURL
 *
cuæ
;

48 
sdp
;

49 
FILE
 *
sdpf
 = 
NULL
;

50 
°ru˘_°©
 
fûe_öfo
;

51 *
°ªam_uri
 = 
NULL
;

52 
ªque°
=1;

53 
cuæ_¶i°
 *
cu°om_hódîs
=
NULL
;

55 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

56 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

57  
TEST_ERR_MAJOR_BAD
;

60 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

61 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

62 
	`cuæ_globÆ_˛ónup
();

63  
TEST_ERR_MAJOR_BAD
;

66 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADERDATA
, 
°dout
);

67 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
°dout
);

69 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

71 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

72 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

73 
ã°_˛ónup
;

75 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

76 
	`‰ì
(
°ªam_uri
);

77 
°ªam_uri
 = 
NULL
;

79 
sdp
 = 
	`›í
("log/fûe568.txt", 
O_RDONLY
);

80 
	`f°©
(
sdp
, &
fûe_öfo
);

81 
	`˛o£
(
sdp
);

83 
sdpf
 = 
	`f›í
("log/file568.txt", "rb");

84 if(
sdpf
 =
NULL
) {

85 
	`Ârötf
(
°dîr
, "can't openÜog/file568.txt\n");

86 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

87 
ã°_˛ónup
;

89 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_ANNOUNCE
);

91 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READDATA
, 
sdpf
);

92 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

93 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE_LARGE
, (
cuæ_off_t
Ë
fûe_öfo
.
°_size
);

96 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

97 if(
ªs
)

98 
ã°_˛ónup
;

100 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 0L);

101 
	`f˛o£
(
sdpf
);

102 
sdpf
 = 
NULL
;

105 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

106 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

107 
ã°_˛ónup
;

109 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

110 
	`‰ì
(
°ªam_uri
);

111 
°ªam_uri
 = 
NULL
;

113 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_DESCRIBE
);

114 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

115 if(
ªs
)

116 
ã°_˛ónup
;

120 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

121 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

122 
ã°_˛ónup
;

124 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

125 
	`‰ì
(
°ªam_uri
);

126 
°ªam_uri
 = 
NULL
;

128 
cu°om_hódîs
 = 
	`cuæ_¶i°_≠≥nd
(custom_headers,

130 if(!
cu°om_hódîs
) {

131 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

132 
ã°_˛ónup
;

134 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSPHEADER
, 
cu°om_hódîs
);

135 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_ANNOUNCE
);

136 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, "postyfield=postystuff&project=curl\n");

138 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

139 if(
ªs
)

140 
ã°_˛ónup
;

142 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, 
NULL
);

143 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSPHEADER
, 
NULL
);

144 
	`cuæ_¶i°_‰ì_Æl
(
cu°om_hódîs
);

145 
cu°om_hódîs
 = 
NULL
;

148 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

149 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

150 
ã°_˛ónup
;

152 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

153 
	`‰ì
(
°ªam_uri
);

154 
°ªam_uri
 = 
NULL
;

156 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_OPTIONS
);

157 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

159 
ã°_˛ónup
:

161 if(
sdpf
)

162 
	`f˛o£
(
sdpf
);

164 if(
°ªam_uri
)

165 
	`‰ì
(
°ªam_uri
);

167 if(
cu°om_hódîs
)

168 
	`cuæ_¶i°_‰ì_Æl
(
cu°om_hódîs
);

170 
	`cuæ_ósy_˛ónup
(
cuæ
);

171 
	`cuæ_globÆ_˛ónup
();

173  
ªs
;

174 
	}
}

	@tests/libtest/lib569.c

22 
	~"ã°.h
"

24 
	~<cuæ/m¥ötf.h
>

26 
	~"memdebug.h
"

29 *
	$subuæ
(c⁄° *
ba£
, 
i
)

31  
	`cuæ_m≠rötf
("%s%.4d", 
ba£
, 
i
);

32 
	}
}

37 
	$ã°
(*
URL
)

39 
ªs
;

40 
CURL
 *
cuæ
;

41 *
°ªam_uri
 = 
NULL
;

42 *
π•_£ssi⁄_id
;

43 
ªque°
=1;

44 
i
;

45 
FILE
 *
idfûe
 = 
NULL
;

47 
idfûe
 = 
	`f›í
(
libã°_¨g2
, "wb");

48 if(
idfûe
 =
NULL
) {

49 
	`Ârötf
(
°dîr
, "couldn't openÅhe Session ID File\n");

50  
TEST_ERR_MAJOR_BAD
;

53 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

54 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

55 
	`f˛o£
(
idfûe
);

56  
TEST_ERR_MAJOR_BAD
;

59 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

60 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

61 
	`cuæ_globÆ_˛ónup
();

62 
	`f˛o£
(
idfûe
);

63  
TEST_ERR_MAJOR_BAD
;

66 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADERDATA
, 
°dout
);

67 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
°dout
);

68 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

70 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

72 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_SETUP
);

73 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

74 if(
ªs
 !()
CURLE_BAD_FUNCTION_ARGUMENT
) {

75 
	`Ârötf
(
°dîr
, "This should have failed. "

77 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

78 
ã°_˛ónup
;

82 
i
 = 0; i < 3; i++) {

83 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

84 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

85 
ã°_˛ónup
;

87 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

88 
	`‰ì
(
°ªam_uri
);

89 
°ªam_uri
 = 
NULL
;

91 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_SETUP
);

92 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_TRANSPORT
, "Fake/NotReal/JustATest;foo=baz");

93 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

94 if(
ªs
)

95 
ã°_˛ónup
;

97 
	`cuæ_ósy_gëöfo
(
cuæ
, 
CURLINFO_RTSP_SESSION_ID
, &
π•_£ssi⁄_id
);

98 
	`Ârötf
(
idfûe
, "GŸ Sessi⁄ ID: [%s]\n", 
π•_£ssi⁄_id
);

99 
π•_£ssi⁄_id
 = 
NULL
;

101 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

102 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

103 
ã°_˛ónup
;

105 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

106 
	`‰ì
(
°ªam_uri
);

107 
°ªam_uri
 = 
NULL
;

109 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_TEARDOWN
);

110 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

113 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_SESSION_ID
, 
NULL
);

116 
ã°_˛ónup
:

118 if(
idfûe
)

119 
	`f˛o£
(
idfûe
);

121 if(
°ªam_uri
)

122 
	`‰ì
(
°ªam_uri
);

124 
	`cuæ_ósy_˛ónup
(
cuæ
);

125 
	`cuæ_globÆ_˛ónup
();

127  
ªs
;

128 
	}
}

	@tests/libtest/lib570.c

22 
	~"ã°.h
"

24 
	~<cuæ/m¥ötf.h
>

26 
	~"memdebug.h
"

29 *
	$subuæ
(c⁄° *
ba£
, 
i
)

31  
	`cuæ_m≠rötf
("%s%.4d", 
ba£
, 
i
);

32 
	}
}

34 
	$ã°
(*
URL
)

36 
ªs
;

37 
CURL
 *
cuæ
;

38 
ªque°
=1;

39 *
°ªam_uri
 = 
NULL
;

41 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

42 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

43  
TEST_ERR_MAJOR_BAD
;

46 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

47 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

48 
	`cuæ_globÆ_˛ónup
();

49  
TEST_ERR_MAJOR_BAD
;

52 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADERDATA
, 
°dout
);

53 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
°dout
);

54 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

56 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

58 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_OPTIONS
);

60 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

61 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

62 
ã°_˛ónup
;

64 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

65 
	`‰ì
(
°ªam_uri
);

66 
°ªam_uri
 = 
NULL
;

68 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

69 if(
ªs
 !()
CURLE_RTSP_CSEQ_ERROR
) {

70 
	`Ârötf
(
°dîr
, "FailedÅo detect CSeq mismatch");

71 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

72 
ã°_˛ónup
;

75 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_CLIENT_CSEQ
, 999L);

76 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_TRANSPORT
,

78 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_SETUP
);

80 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

81 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

82 
ã°_˛ónup
;

84 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

85 
	`‰ì
(
°ªam_uri
);

86 
°ªam_uri
 = 
NULL
;

88 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

89 if(
ªs
)

90 
ã°_˛ónup
;

92 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_PLAY
);

94 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

95 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

96 
ã°_˛ónup
;

98 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

99 
	`‰ì
(
°ªam_uri
);

100 
°ªam_uri
 = 
NULL
;

102 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

103 if(
ªs
 !
CURLE_RTSP_SESSION_ERROR
) {

104 
	`Ârötf
(
°dîr
, "FailedÅo detectá Session ID mismatch");

107 
ã°_˛ónup
:

109 if(
°ªam_uri
)

110 
	`‰ì
(
°ªam_uri
);

112 
	`cuæ_ósy_˛ónup
(
cuæ
);

113 
	`cuæ_globÆ_˛ónup
();

115  
ªs
;

116 
	}
}

	@tests/libtest/lib571.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_NETINET_IN_H


25 
	~<√töë/ö.h
>

27 #ifde‡
HAVE_NETDB_H


28 
	~<√tdb.h
>

30 #ifde‡
HAVE_ARPA_INET_H


31 
	~<¨∑/öë.h
>

33 #ifde‡
HAVE_SYS_STAT_H


34 
	~<sys/°©.h
>

36 #ifde‡
HAVE_FCNTL_H


37 
	~<f˙é.h
>

40 
	~<cuæ/m¥ötf.h
>

42 
	~"w¨∆ess.h
"

43 
	~"memdebug.h
"

45 
	#RTP_PKT_CHANNEL
(
p
Ë(()(()(’)[1])))

	)

47 
	#RTP_PKT_LENGTH
(
p
) (((()(()((p)[2]))) << 8) | \

48 (()(()((
p
)[3]))))

	)

50 
	#RTP_DATA_SIZE
 12

	)

51 c⁄° *
	gRTP_DATA
 = "$_1234\n\0asdf";

53 
	gπp_∑ckë_cou¡
 = 0;

55 
size_t
 
	$πp_wrôe
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
°ªam
) {

56 *
d©a
 = (*)
±r
;

57 
ch™√l
 = 
	`RTP_PKT_CHANNEL
(
d©a
);

58 
mesßge_size
;

59 
coded_size
 = 
	`RTP_PKT_LENGTH
(
d©a
);

60 
size_t
 
Áûuª
 = (
size
 * 
nmemb
) ? 0 : 1;

61 
i
;

62 ()
°ªam
;

64 
mesßge_size
 = 
	`cuæx_uztosi
(
size
 * 
nmemb
) - 4;

66 
	`¥ötf
("RTP: mesßgêsizê%d, ch™√»%d\n", 
mesßge_size
, 
ch™√l
);

67 if(
mesßge_size
 !
coded_size
) {

68 
	`¥ötf
("RTPÉmbedded size (%d) doesÇot matchÅhe write size (%d).\n",

69 
coded_size
, 
mesßge_size
);

70  
Áûuª
;

73 
d©a
 += 4;

74 
i
 = 0; i < 
mesßge_size
; i+
RTP_DATA_SIZE
) {

75 if(
mesßge_size
 - 
i
 > 
RTP_DATA_SIZE
) {

76 if(
	`memcmp
(
RTP_DATA
, 
d©a
 + 
i
, 
RTP_DATA_SIZE
) != 0) {

77 
	`¥ötf
("RTP PAYLOAD CORRUPTED [%s]\n", 
d©a
 + 
i
);

78  
Áûuª
;

81 i‡(
	`memcmp
(
RTP_DATA
, 
d©a
 + 
i
, 
mesßge_size
 - i) != 0) {

82 
	`¥ötf
("RTP PAYLOAD END CORRUPTED (%d), [%s]\n",

83 
mesßge_size
 - 
i
, 
d©a
 + i);

84  
Áûuª
;

89 
πp_∑ckë_cou¡
++;

90 
	`Ârötf
(
°dîr
, "∑ckë cou¡ i†%d\n", 
πp_∑ckë_cou¡
);

92  
size
 * 
nmemb
;

93 
	}
}

96 *
	$subuæ
(c⁄° *
ba£
, 
i
)

98  
	`cuæ_m≠rötf
("%s%.4d", 
ba£
, 
i
);

99 
	}
}

101 
	$ã°
(*
URL
)

103 
ªs
;

104 
CURL
 *
cuæ
;

105 *
°ªam_uri
 = 
NULL
;

106 
ªque°
=1;

107 
FILE
 *
¥Ÿofûe
 = 
NULL
;

109 
¥Ÿofûe
 = 
	`f›í
(
libã°_¨g2
, "wb");

110 if(
¥Ÿofûe
 =
NULL
) {

111 
	`Ârötf
(
°dîr
, "Couldn't openÅheÖrotocol dump file\n");

112  
TEST_ERR_MAJOR_BAD
;

115 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

116 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

117 
	`f˛o£
(
¥Ÿofûe
);

118  
TEST_ERR_MAJOR_BAD
;

121 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

122 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

123 
	`f˛o£
(
¥Ÿofûe
);

124 
	`cuæ_globÆ_˛ónup
();

125  
TEST_ERR_MAJOR_BAD
;

127 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

129 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

130 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

131 
ã°_˛ónup
;

133 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

134 
	`‰ì
(
°ªam_uri
);

135 
°ªam_uri
 = 
NULL
;

137 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_INTERLEAVEFUNCTION
, 
πp_wrôe
);

138 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_TIMEOUT
, 3L);

139 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

140 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
¥Ÿofûe
);

142 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_TRANSPORT
, "RTP/AVP/TCP;interleaved=0-1");

143 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_SETUP
);

145 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

146 if(
ªs
)

147 
ã°_˛ónup
;

150 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

151 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

152 
ã°_˛ónup
;

154 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

155 
	`‰ì
(
°ªam_uri
);

156 
°ªam_uri
 = 
NULL
;

157 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_PLAY
);

159 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

160 if(
ªs
)

161 
ã°_˛ónup
;

164 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

165 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

166 
ã°_˛ónup
;

168 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

169 
	`‰ì
(
°ªam_uri
);

170 
°ªam_uri
 = 
NULL
;

171 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_DESCRIBE
);

173 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

174 if(
ªs
)

175 
ã°_˛ónup
;

177 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

178 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

179 
ã°_˛ónup
;

181 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

182 
	`‰ì
(
°ªam_uri
);

183 
°ªam_uri
 = 
NULL
;

184 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_PLAY
);

186 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

187 if(
ªs
)

188 
ã°_˛ónup
;

190 
	`Ârötf
(
°dîr
, "PLAY COMPLETE\n");

193 !
ªs
 && 
πp_∑ckë_cou¡
 < 13) {

194 
	`Ârötf
(
°dîr
, "LOOPY LOOP!\n");

195 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_RECEIVE
);

196 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

199 
ã°_˛ónup
:

201 if(
°ªam_uri
)

202 
	`‰ì
(
°ªam_uri
);

204 if(
¥Ÿofûe
)

205 
	`f˛o£
(
¥Ÿofûe
);

207 
	`cuæ_ósy_˛ónup
(
cuæ
);

208 
	`cuæ_globÆ_˛ónup
();

210  
ªs
;

211 
	}
}

	@tests/libtest/lib572.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_SYS_STAT_H


25 
	~<sys/°©.h
>

27 #ifde‡
HAVE_FCNTL_H


28 
	~<f˙é.h
>

31 
	~<cuæ/m¥ötf.h
>

33 
	~"memdebug.h
"

36 *
	$subuæ
(c⁄° *
ba£
, 
i
)

38  
	`cuæ_m≠rötf
("%s%.4d", 
ba£
, 
i
);

39 
	}
}

44 
	$ã°
(*
URL
)

46 
ªs
;

47 
CURL
 *
cuæ
;

48 
∑øms
;

49 
FILE
 *
∑ømsf
 = 
NULL
;

50 
°ru˘_°©
 
fûe_öfo
;

51 *
°ªam_uri
 = 
NULL
;

52 
ªque°
=1;

53 
cuæ_¶i°
 *
cu°om_hódîs
=
NULL
;

55 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

56 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

57  
TEST_ERR_MAJOR_BAD
;

60 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

61 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

62 
	`cuæ_globÆ_˛ónup
();

63  
TEST_ERR_MAJOR_BAD
;

67 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADERDATA
, 
°dout
);

68 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WRITEDATA
, 
°dout
);

69 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

71 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

74 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

75 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

76 
ã°_˛ónup
;

78 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

79 
	`‰ì
(
°ªam_uri
);

80 
°ªam_uri
 = 
NULL
;

82 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_TRANSPORT
, "Planes/Trains/Automobiles");

83 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_SETUP
);

84 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

85 if(
ªs
)

86 
ã°_˛ónup
;

88 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

89 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

90 
ã°_˛ónup
;

92 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

93 
	`‰ì
(
°ªam_uri
);

94 
°ªam_uri
 = 
NULL
;

97 
∑øms
 = 
	`›í
("log/fûe572.txt", 
O_RDONLY
);

98 
	`f°©
(
∑øms
, &
fûe_öfo
);

99 
	`˛o£
(
∑øms
);

101 
∑ømsf
 = 
	`f›í
("log/file572.txt", "rb");

102 if(
∑ømsf
 =
NULL
) {

103 
	`Ârötf
(
°dîr
, "can't openÜog/file572.txt\n");

104 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

105 
ã°_˛ónup
;

107 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_GET_PARAMETER
);

109 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READDATA
, 
∑ømsf
);

110 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

111 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE_LARGE
, (
cuæ_off_t
Ë
fûe_öfo
.
°_size
);

113 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

114 if(
ªs
)

115 
ã°_˛ónup
;

117 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 0L);

118 
	`f˛o£
(
∑ømsf
);

119 
∑ømsf
 = 
NULL
;

122 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

123 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

124 
ã°_˛ónup
;

126 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

127 
	`‰ì
(
°ªam_uri
);

128 
°ªam_uri
 = 
NULL
;

130 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

131 if(
ªs
)

132 
ã°_˛ónup
;

136 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

137 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

138 
ã°_˛ónup
;

140 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

141 
	`‰ì
(
°ªam_uri
);

142 
°ªam_uri
 = 
NULL
;

144 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_GET_PARAMETER
);

145 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, "packets_received\njitter\n");

147 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

148 if(
ªs
)

149 
ã°_˛ónup
;

151 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, 
NULL
);

154 if((
°ªam_uri
 = 
	`subuæ
(
URL
, 
ªque°
++)Ë=
NULL
) {

155 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

156 
ã°_˛ónup
;

158 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_STREAM_URI
, 
°ªam_uri
);

159 
	`‰ì
(
°ªam_uri
);

160 
°ªam_uri
 = 
NULL
;

162 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_RTSP_REQUEST
, 
CURL_RTSPREQ_OPTIONS
);

163 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

165 
ã°_˛ónup
:

167 if(
∑ømsf
)

168 
	`f˛o£
(
∑ømsf
);

170 if(
°ªam_uri
)

171 
	`‰ì
(
°ªam_uri
);

173 if(
cu°om_hódîs
)

174 
	`cuæ_¶i°_‰ì_Æl
(
cu°om_hódîs
);

176 
	`cuæ_ósy_˛ónup
(
cuæ
);

177 
	`cuæ_globÆ_˛ónup
();

179  
ªs
;

180 
	}
}

	@tests/libtest/lib573.c

22 
	~"ã°.h
"

24 
	~"ã°åa˚.h
"

25 
	~"ã°utû.h
"

26 
	~"w¨∆ess.h
"

27 
	~"memdebug.h
"

29 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

35 
	$ã°
(*
URL
)

37 
CURL
 *
c
 = 
NULL
;

38 
CURLM
 *
m
 = 
NULL
;

39 
ªs
 = 0;

40 
ru¬ög
 = 1;

41 
c⁄√˘_time
 = 0.0;

42 
dbl_ïsû⁄
;

44 
dbl_ïsû⁄
 = 1.0;

46 
dbl_ïsû⁄
 /= 2.0;

47 } ()(1.0 + (
dbl_ïsû⁄
/2.0)) > ()1.0);

49 
	`°¨t_ã°_timög
();

51 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

53 
	`ósy_öô
(
c
);

55 
	`ósy_£t›t
(
c
, 
CURLOPT_HEADER
, 1L);

56 
	`ósy_£t›t
(
c
, 
CURLOPT_URL
, 
URL
);

58 
libã°_debug_c⁄fig
.
nohex
 = 1;

59 
libã°_debug_c⁄fig
.
åa˚time
 = 1;

60 
	`ósy_£t›t
(
c
, 
CURLOPT_DEBUGDATA
, &
libã°_debug_c⁄fig
);

61 
	`ósy_£t›t
(
c
, 
CURLOPT_DEBUGFUNCTION
, 
libã°_debug_cb
);

62 
	`ósy_£t›t
(
c
, 
CURLOPT_VERBOSE
, 1L);

64 
	`mu…i_öô
(
m
);

66 
	`mu…i_add_h™dÀ
(
m
, 
c
);

68 
ru¬ög
) {

69 
timevÆ
 
timeout
;

70 
fd_£t
 
fdªad
, 
fdwrôe
, 
fdex˚p
;

71 
maxfd
 = -99;

73 
timeout
.
tv_£c
 = 0;

74 
timeout
.
tv_u£c
 = 100000L;

76 
	`mu…i_≥rf‹m
(
m
, &
ru¬ög
);

78 
	`ab‹t_⁄_ã°_timeout
();

80 if(!
ru¬ög
)

83 
	`FD_ZERO
(&
fdªad
);

84 
	`FD_ZERO
(&
fdwrôe
);

85 
	`FD_ZERO
(&
fdex˚p
);

87 
	`mu…i_fd£t
(
m
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

91 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

93 
	`ab‹t_⁄_ã°_timeout
();

96 
	`cuæ_ósy_gëöfo
(
c
, 
CURLINFO_CONNECT_TIME
, &
c⁄√˘_time
);

97 i‡(
c⁄√˘_time
 < 
dbl_ïsû⁄
) {

98 
	`Ârötf
(
°dîr
, "connectÅime is <Épsilon\n");

99 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

102 
ã°_˛ónup
:

106 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
c
);

107 
	`cuæ_mu…i_˛ónup
(
m
);

108 
	`cuæ_ósy_˛ónup
(
c
);

109 
	`cuæ_globÆ_˛ónup
();

111  
ªs
;

112 
	}
}

	@tests/libtest/lib574.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$√w_‚m©ch
(c⁄° *
∑âîn
, c⁄° *
°rög
)

28 ()
∑âîn
;

29 ()
°rög
;

30  
CURL_FNMATCHFUNC_MATCH
;

31 
	}
}

33 
	$ã°
(*
URL
)

35 
ªs
;

36 
CURL
 *
cuæ
;

38 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

39 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

40  
TEST_ERR_MAJOR_BAD
;

43 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

44 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

45 
	`cuæ_globÆ_˛ónup
();

46  
TEST_ERR_MAJOR_BAD
;

49 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

50 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_WILDCARDMATCH
, 1L);

51 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_FNMATCH_FUNCTION
, 
√w_‚m©ch
);

53 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

54 if(
ªs
) {

55 
	`Ârötf
(
°dîr
, "cuæ_ósy_≥rf‹m(ËÁûed %d\n", 
ªs
);

56 
ã°_˛ónup
;

58 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

59 if(
ªs
) {

60 
	`Ârötf
(
°dîr
, "cuæ_ósy_≥rf‹m(ËÁûed %d\n", 
ªs
);

61 
ã°_˛ónup
;

64 
ã°_˛ónup
:

65 
	`cuæ_ósy_˛ónup
(
cuæ
);

66 
	`cuæ_globÆ_˛ónup
();

67  
ªs
;

68 
	}
}

	@tests/libtest/lib575.c

22 
	~"ã°.h
"

24 
	~<f˙é.h
>

26 
	~"ã°utû.h
"

27 
	~"w¨∆ess.h
"

28 
	~"memdebug.h
"

30 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

38 
	$ã°
(*
URL
)

40 
CURL
 *
h™dÀ
 = 
NULL
;

41 
CURL
 *
duph™dÀ
 = 
NULL
;

42 
CURLM
 *
mh™dÀ
 = 
NULL
;

43 
ªs
 = 0;

44 
°ûl_ru¬ög
 = 0;

46 
	`°¨t_ã°_timög
();

48 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

50 
	`ósy_öô
(
h™dÀ
);

52 
	`ósy_£t›t
(
h™dÀ
, 
CURLOPT_URL
, 
URL
);

53 
	`ósy_£t›t
(
h™dÀ
, 
CURLOPT_WILDCARDMATCH
, 1L);

54 
	`ósy_£t›t
(
h™dÀ
, 
CURLOPT_VERBOSE
, 1L);

56 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
h™dÀ
);

57 if(
ªs
)

58 
ã°_˛ónup
;

60 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
h™dÀ
);

61 if(
ªs
)

62 
ã°_˛ónup
;

64 
duph™dÀ
 = 
	`cuæ_ósy_duph™dÀ
(
h™dÀ
);

65 if(!
duph™dÀ
)

66 
ã°_˛ónup
;

67 
	`cuæ_ósy_˛ónup
(
h™dÀ
);

68 
h™dÀ
 = 
duph™dÀ
;

70 
	`mu…i_öô
(
mh™dÀ
);

72 
	`mu…i_add_h™dÀ
(
mh™dÀ
, 
h™dÀ
);

74 
	`mu…i_≥rf‹m
(
mh™dÀ
, &
°ûl_ru¬ög
);

76 
	`ab‹t_⁄_ã°_timeout
();

78 
°ûl_ru¬ög
) {

79 
timevÆ
 
timeout
;

80 
fd_£t
 
fdªad
;

81 
fd_£t
 
fdwrôe
;

82 
fd_£t
 
fdex˚p
;

83 
maxfd
 = -99;

85 
timeout
.
tv_£c
 = 0;

86 
timeout
.
tv_u£c
 = 100000L;

88 
	`FD_ZERO
(&
fdªad
);

89 
	`FD_ZERO
(&
fdwrôe
);

90 
	`FD_ZERO
(&
fdex˚p
);

92 
	`mu…i_fd£t
(
mh™dÀ
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

96 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
timeout
);

98 
	`ab‹t_⁄_ã°_timeout
();

100 
	`mu…i_≥rf‹m
(
mh™dÀ
, &
°ûl_ru¬ög
);

102 
	`ab‹t_⁄_ã°_timeout
();

105 
ã°_˛ónup
:

109 
	`cuæ_mu…i_˛ónup
(
mh™dÀ
);

110 
	`cuæ_ósy_˛ónup
(
h™dÀ
);

111 
	`cuæ_globÆ_˛ónup
();

113  
ªs
;

114 
	}
}

	@tests/libtest/lib576.c

22 
	~"ã°.h
"

24 
	~"ã°utû.h
"

25 
	~"memdebug.h
"

28 
	mªmaös
;

29 
	m¥öt_c⁄ã¡
;

30 } 
	tchunk_d©a_t
;

33 
chunk_bgn
(c⁄° 
cuæ_fûeöfo
 *
föfo
, *
±r
, 
ªmaös
);

35 
chunk_íd
(*
±r
);

38 
	$chunk_bgn
(c⁄° 
cuæ_fûeöfo
 *
föfo
, *
±r
, 
ªmaös
)

40 
chunk_d©a_t
 *
ch_d
 = 
±r
;

41 
ch_d
->
ªmaös
 =Ñemains;

43 
	`¥ötf
("=============================================================\n");

44 
	`¥ötf
("Remaös: %d\n", 
ªmaös
);

45 
	`¥ötf
("Fûíame: %s\n", 
föfo
->
fûíame
);

46 if(
föfo
->
°rögs
.
≥rm
) {

47 
	`¥ötf
("Pîmissi⁄s: %s", 
föfo
->
°rögs
.
≥rm
);

48 if(
föfo
->
Êags
 & 
CURLFINFOFLAG_KNOWN_PERM
)

49 
	`¥ötf
(" (∑r£d => %o)", 
föfo
->
≥rm
);

50 
	`¥ötf
("\n");

52 
	`¥ötf
("Size: %ldB\n", ()
föfo
->
size
);

53 if(
föfo
->
°rögs
.
u£r
)

54 
	`¥ötf
("U£r: %s\n", 
föfo
->
°rögs
.
u£r
);

55 if(
föfo
->
°rögs
.
group
)

56 
	`¥ötf
("Group: %s\n", 
föfo
->
°rögs
.
group
);

57 if(
föfo
->
°rögs
.
time
)

58 
	`¥ötf
("Time: %s\n", 
föfo
->
°rögs
.
time
);

59 
	`¥ötf
("Filetype: ");

60 
föfo
->
fûëy≥
) {

61 
CURLFILETYPE_FILE
:

62 
	`¥ötf
("regular file\n");

64 
CURLFILETYPE_DIRECTORY
:

65 
	`¥ötf
("directory\n");

67 
CURLFILETYPE_SYMLINK
:

68 
	`¥ötf
("symlink\n");

69 
	`¥ötf
("T¨gë: %s\n", 
föfo
->
°rögs
.
èrgë
);

72 
	`¥ötf
("otherÅype\n");

75 if(
föfo
->
fûëy≥
 =
CURLFILETYPE_FILE
) {

76 
ch_d
->
¥öt_c⁄ã¡
 = 1;

77 
	`¥ötf
("Content:\n-------------------------------------------------------------\n");

79 if(
	`°rcmp
(
föfo
->
fûíame
, "someothertext.txt") == 0) {

80 
	`¥ötf
("# THIS CONTENT WAS SKIPPED IN CHUNK_BGN CALLBACK #\n");

81  
CURL_CHUNK_BGN_FUNC_SKIP
;

83  
CURL_CHUNK_BGN_FUNC_OK
;

84 
	}
}

87 
	$chunk_íd
(*
±r
)

89 
chunk_d©a_t
 *
ch_d
 = 
±r
;

90 if(
ch_d
->
¥öt_c⁄ã¡
) {

91 
ch_d
->
¥öt_c⁄ã¡
 = 0;

92 
	`¥ötf
("-------------------------------------------------------------\n");

94 if(
ch_d
->
ªmaös
 == 1)

95 
	`¥ötf
("=============================================================\n");

96  
CURL_CHUNK_END_FUNC_OK
;

97 
	}
}

99 
	$ã°
(*
URL
)

101 
CURL
 *
h™dÀ
 = 
NULL
;

102 
CURLcode
 
ªs
 = 
CURLE_OK
;

103 
chunk_d©a_t
 
chunk_d©a
 = {0,0};

104 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

105 
h™dÀ
 = 
	`cuæ_ósy_öô
();

106 if(!
h™dÀ
) {

107 
ªs
 = 
CURLE_OUT_OF_MEMORY
;

108 
ã°_˛ónup
;

111 
	`ã°_£t›t
(
h™dÀ
, 
CURLOPT_URL
, 
URL
);

112 
	`ã°_£t›t
(
h™dÀ
, 
CURLOPT_WILDCARDMATCH
, 1L);

113 
	`ã°_£t›t
(
h™dÀ
, 
CURLOPT_CHUNK_BGN_FUNCTION
, 
chunk_bgn
);

114 
	`ã°_£t›t
(
h™dÀ
, 
CURLOPT_CHUNK_END_FUNCTION
, 
chunk_íd
);

115 
	`ã°_£t›t
(
h™dÀ
, 
CURLOPT_CHUNK_DATA
, &
chunk_d©a
);

117 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
h™dÀ
);

119 
ã°_˛ónup
:

120 if(
h™dÀ
)

121 
	`cuæ_ósy_˛ónup
(
h™dÀ
);

122 
	`cuæ_globÆ_˛ónup
();

123  
ªs
;

124 
	}
}

	@tests/libtest/lib578.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

27 
	gd©a
[]="this isá short string.\n";

29 
size_t
 
	gd©a_size
 = (
d©a
) / ();

31 
	$¥ogªss_ˇŒback
(*
˛õ¡p
, 
d…ŸÆ
, 
d ow
, 
u…ŸÆ
, 
u ow
)

33 
FILE
 *
moo
 = 
	`f›í
(
libã°_¨g2
, "wb");

35 ()
˛õ¡p
;

36 ()
d…ŸÆ
;

37 ()
d ow
;

39 if(
moo
) {

40 i‡((
size_t
)
u…ŸÆ
 =
d©a_size
 && (size_t)
u ow
 == data_size)

41 
	`Ârötf
(
moo
, "PASSED, UL data matched data size\n");

43 
	`Ârötf
(
moo
, "Progªs†ˇŒback cÆÀd wôh UL %‡ouào‡%f\n", 
u ow
, 
u…ŸÆ
);

44 
	`f˛o£
(
moo
);

47 
	}
}

49 
	$ã°
(*
URL
)

51 
CURL
 *
cuæ
;

52 
CURLcode
 
ªs
=
CURLE_OK
;

54 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

55 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

56  
TEST_ERR_MAJOR_BAD
;

59 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

60 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

61 
	`cuæ_globÆ_˛ónup
();

62  
TEST_ERR_MAJOR_BAD
;

66 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

69 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

71 #ifde‡
CURL_DOES_CONVERSIONS


73 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_TRANSFERTEXT
, 1L);

77 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDSIZE
, 
d©a_size
);

78 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POSTFIELDS
, 
d©a
);

81 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_NOPROGRESS
, 0L);

82 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROGRESSFUNCTION
, 
¥ogªss_ˇŒback
);

87 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

90 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

93 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

95 
ã°_˛ónup
:

98 
	`cuæ_ósy_˛ónup
(
cuæ
);

99 
	`cuæ_globÆ_˛ónup
();

101  
ªs
;

102 
	}
}

	@tests/libtest/lib579.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 c⁄° * c⁄° 
	gpo°
[]={

31 
NULL


35 
	sWrôeThis
 {

36 
	mcou¡î
;

39 
	$¥ogªss_ˇŒback
(*
˛õ¡p
, 
d…ŸÆ
, 
d ow
,

40 
u…ŸÆ
, 
u ow
)

42 
FILE
 *
moo
;

43 
¥ev_u…ŸÆ
 = -1;

44 
¥ev_u ow
 = -1;

45 ()
˛õ¡p
;

46 ()
d…ŸÆ
;

47 ()
d ow
;

53 if((
¥ev_u…ŸÆ
 !()
u…ŸÆ
) ||

54 (
¥ev_u ow
 !()
u ow
)) {

56 
moo
 = 
	`f›í
(
libã°_¨g2
, "ab");

57 if(
moo
) {

58 
	`Ârötf
(
moo
, "Progress callback called with UL %d out of %d\n",

59 ()
u ow
, ()
u…ŸÆ
);

60 
	`f˛o£
(
moo
);

62 
¥ev_u ow
 = (Ë
u ow
;

63 
¥ev_u…ŸÆ
 = (Ë
u…ŸÆ
;

66 
	}
}

68 
size_t
 
	$ªad_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
u£Ω
)

70 
WrôeThis
 *
pooh
 = (WrôeThi†*)
u£Ω
;

71 c⁄° *
d©a
;

73 if(
size
*
nmemb
 < 1)

76 
d©a
 = 
po°
[
pooh
->
cou¡î
];

78 if(
d©a
) {

79 
size_t
 
Àn
 = 
	`°æí
(
d©a
);

80 
	`mem˝y
(
±r
, 
d©a
, 
Àn
);

81 
pooh
->
cou¡î
++;

82  
Àn
;

85 
	}
}

87 
	$ã°
(*
URL
)

89 
CURL
 *
cuæ
;

90 
CURLcode
 
ªs
=
CURLE_OK
;

91 
cuæ_¶i°
 *
¶i°
 = 
NULL
;

92 
WrôeThis
 
pooh
;

93 
pooh
.
cou¡î
 = 0;

95 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

96 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

97  
TEST_ERR_MAJOR_BAD
;

100 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

101 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

102 
	`cuæ_globÆ_˛ónup
();

103  
TEST_ERR_MAJOR_BAD
;

106 
¶i°
 = 
	`cuæ_¶i°_≠≥nd
(slist, "Transfer-Encoding: chunked");

107 i‡(
¶i°
 =
NULL
) {

108 
	`Ârötf
(
°dîr
, "curl_slist_append() failed\n");

109 
	`cuæ_ósy_˛ónup
(
cuæ
);

110 
	`cuæ_globÆ_˛ónup
();

111  
TEST_ERR_MAJOR_BAD
;

115 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

118 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_POST
, 1L);

120 #ifde‡
CURL_DOES_CONVERSIONS


122 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_TRANSFERTEXT
, 1L);

126 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READFUNCTION
, 
ªad_ˇŒback
);

129 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_READDATA
, &
pooh
);

132 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

135 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

138 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPHEADER
, 
¶i°
);

140 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPAUTH
, ()
CURLAUTH_DIGEST
);

141 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_USERPWD
, "foo:bar");

144 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_NOPROGRESS
, 0L);

145 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROGRESSFUNCTION
, 
¥ogªss_ˇŒback
);

148 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

150 
ã°_˛ónup
:

153 if(
¶i°
)

154 
	`cuæ_¶i°_‰ì_Æl
(
¶i°
);

157 
	`cuæ_ósy_˛ónup
(
cuæ
);

158 
	`cuæ_globÆ_˛ónup
();

160  
ªs
;

161 
	}
}

	@tests/libtest/lib582.c

22 
	~"ã°.h
"

24 
	~<f˙é.h
>

26 
	~"ã°utû.h
"

27 
	~"w¨∆ess.h
"

28 
	~"memdebug.h
"

30 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

32 
	sSockës


34 
cuæ_sockë_t
 *
	msockës
;

35 
	mcou¡
;

36 
	mmax_cou¡
;

39 
	sRódWrôeSockës


41 
Sockës
 
	mªad
, 
	mwrôe
;

47 
	$ªmoveFd
(
Sockës
* 
sockës
, 
cuæ_sockë_t
 
fd
, 
míti⁄
)

49 
i
;

51 if(
míti⁄
)

52 
	`Ârötf
(
°dîr
, "Removêsockë fd %d\n", (Ë
fd
);

54 
i
 = 0; i < 
sockës
->
cou¡
; ++i) {

55 i‡(
sockës
->sockës[
i
] =
fd
) {

56 i‡(
i
 < 
sockës
->
cou¡
 - 1)

57 
	`memmove
(&
sockës
->sockës[
i
], &sockets->sockets[i + 1],

58 (
cuæ_sockë_t
Ë* (
sockës
->
cou¡
 - (
i
 + 1)));

59 --
sockës
->
cou¡
;

62 
	}
}

67 
	$addFd
(
Sockës
* 
sockës
, 
cuæ_sockë_t
 
fd
, c⁄° *
wh©
)

73 
	`Ârötf
(
°dîr
, "Add sockë fd %d f‹ %s\n", (Ë
fd
, 
wh©
);

74 
	`ªmoveFd
(
sockës
, 
fd
, 0);

78 if(!
sockës
->sockets) {

79 
sockës
->sockë†
	`mÆloc
((
cuæ_sockë_t
) * 20U);

80 if(!
sockës
->sockets)

82 
sockës
->
max_cou¡
 = 20;

84 if(
sockës
->
cou¡
 + 1 > sockës->
max_cou¡
) {

85 
cuæ_sockë_t
 *
ﬁd±r
 = 
sockës
->sockets;

86 
sockës
->sockë†
	`ªÆloc
(
ﬁd±r
, (
cuæ_sockë_t
) *

87 (
sockës
->
max_cou¡
 + 20));

88 if(!
sockës
->sockets) {

90 
sockës
->sockë†
ﬁd±r
;

93 
sockës
->
max_cou¡
 += 20;

98 
sockës
->sockës[sockës->
cou¡
] = 
fd
;

99 ++
sockës
->
cou¡
;

100 
	}
}

105 
	$cuæSockëCÆlback
(
CURL
 *
ósy
, 
cuæ_sockë_t
 
s
, 
a˘i⁄
,

106 *
u£Ω
, *
sockëp
)

108 
RódWrôeSockës
* 
sockës
 = 
u£Ω
;

110 ()
ósy
;

111 ()
sockëp
;

113 i‡(
a˘i⁄
 =
CURL_POLL_IN
 ||á˘i⁄ =
CURL_POLL_INOUT
)

114 
	`addFd
(&
sockës
->
ªad
, 
s
, "read");

116 i‡(
a˘i⁄
 =
CURL_POLL_OUT
 ||á˘i⁄ =
CURL_POLL_INOUT
)

117 
	`addFd
(&
sockës
->
wrôe
, 
s
, "write");

119 if(
a˘i⁄
 =
CURL_POLL_REMOVE
) {

120 
	`ªmoveFd
(&
sockës
->
ªad
, 
s
, 1);

121 
	`ªmoveFd
(&
sockës
->
wrôe
, 
s
, 0);

125 
	}
}

130 
	$cuæTimîCÆlback
(
CURLM
 *
mu…i
, 
timeout_ms
, *
u£Ω
)

132 
timevÆ
* 
timeout
 = 
u£Ω
;

134 ()
mu…i
;

135 i‡(
timeout_ms
 != -1) {

136 *
timeout
 = 
	`tutû_tvnow
();

137 
timeout
->
tv_u£c
 +
timeout_ms
 * 1000;

140 
timeout
->
tv_£c
 = -1;

143 
	}
}

148 
	$checkF‹Com∂ëi⁄
(
CURLM
* 
cuæ
, * 
suc˚ss
)

150 
numMesßges
;

151 
CURLMsg
* 
mesßge
;

152 
ªsu…
 = 0;

153 *
suc˚ss
 = 0;

154 (
mesßge
 = 
	`cuæ_mu…i_öfo_ªad
(
cuæ
, &
numMesßges
)Ë!
NULL
) {

155 i‡(
mesßge
->
msg
 =
CURLMSG_DONE
) {

156 
ªsu…
 = 1;

157 i‡(
mesßge
->
d©a
.
ªsu…
 =
CURLE_OK
)

158 *
suc˚ss
 = 1;

160 *
suc˚ss
 = 0;

163 
	`Ârötf
(
°dîr
, "Gotán unexpected message from curl: %i\n",

164 ()
mesßge
->
msg
);

165 
ªsu…
 = 1;

166 *
suc˚ss
 = 0;

169  
ªsu…
;

170 
	}
}

172 
	$gëMi¸oSec⁄dTimeout
(
timevÆ
* 
timeout
)

174 
timevÆ
 
now
;

175 
ssize_t
 
ªsu…
;

176 
now
 = 
	`tutû_tvnow
();

177 
ªsu…
 = (
timeout
->
tv_£c
 - 
now
.tv_sec) * 1000000 +

178 
timeout
->
tv_u£c
 - 
now
.tv_usec;

179 i‡(
ªsu…
 < 0)

180 
ªsu…
 = 0;

182  
	`cuæx_sztosi
(
ªsu…
);

183 
	}
}

188 
	$upd©eFdSë
(
Sockës
* 
sockës
, 
fd_£t
* 
fd£t
,

189 
cuæ_sockë_t
 *
maxFd
)

191 
i
;

192 
i
 = 0; i < 
sockës
->
cou¡
; ++i) {

193 
	`FD_SET
(
sockës
->sockës[
i
], 
fd£t
);

194 i‡(*
maxFd
 < 
sockës
->sockës[
i
] + 1) {

195 *
maxFd
 = 
sockës
->sockës[
i
] + 1;

198 
	}
}

200 
	$nŸifyCuæ
(
CURLM
 *
cuæ
, 
cuæ_sockë_t
 
s
, 
evBômask
,

201 c⁄° *
öfo
)

203 
numh™dÀs
 = 0;

204 
CURLMcode
 
ªsu…
 = 
	`cuæ_mu…i_sockë_a˘i⁄
(
cuæ
, 
s
, 
evBômask
, &
numh™dÀs
);

205 i‡(
ªsu…
 !
CURLM_OK
) {

206 
	`Ârötf
(
°dîr
, "CurlÉrror on %s: %i (%s)\n",

207 
öfo
, 
ªsu…
, 
	`cuæ_mu…i_°ªº‹
(result));

209 
	}
}

214 
	$checkFdSë
(
CURLM
 *
cuæ
, 
Sockës
 *
sockës
, 
fd_£t
 *
fd£t
,

215 
evBômask
, c⁄° *
«me
)

217 
i
;

218 
i
 = 0; i < 
sockës
->
cou¡
; ++i) {

219 i‡(
	`FD_ISSET
(
sockës
->sockës[
i
], 
fd£t
)) {

220 
	`nŸifyCuæ
(
cuæ
, 
sockës
->sockës[
i
], 
evBômask
, 
«me
);

223 
	}
}

225 
	$ã°
(*
URL
)

227 
ªs
 = 0;

228 
CURL
 *
cuæ
 = 
NULL
;

229 
FILE
 *
hd_§c
 = 
NULL
;

230 
hd
 ;

231 
îr‹
;

232 
°ru˘_°©
 
fûe_öfo
;

233 
CURLM
 *
m
 = 
NULL
;

234 
RódWrôeSockës
 
sockës
 = {{
NULL
, 0, 0}, {NULL, 0, 0}};

235 
timevÆ
 
timeout
 = {-1, 0};

236 
suc˚ss
 = 0;

238 
	`°¨t_ã°_timög
();

240 i‡(!
libã°_¨g3
) {

241 
	`Ârötf
(
°dîr
, "Usage:Üib582 [url] [filename] [username]\n");

242  
TEST_ERR_USAGE
;

245 
hd_§c
 = 
	`f›í
(
libã°_¨g2
, "rb");

246 if(
NULL
 =
hd_§c
) {

247 
îr‹
 = 
ERRNO
;

248 
	`Ârötf
(
°dîr
, "fopen() failed withÉrror: %d (%s)\n",

249 
îr‹
, 
	`°ªº‹
(error));

250 
	`Ârötf
(
°dîr
, "Eº‹ o≥nög fûe: (%s)\n", 
libã°_¨g2
);

251  
TEST_ERR_FOPEN
;

255 
hd
 = 
	`f°©
(
	`fûío
(
hd_§c
), &
fûe_öfo
);

256 if(
hd
 == -1) {

258 
îr‹
 = 
ERRNO
;

259 
	`Ârötf
(
°dîr
, "fstat() failed withÉrror: %d (%s)\n",

260 
îr‹
, 
	`°ªº‹
(error));

261 
	`Ârötf
(
°dîr
, "ERROR: c™nŸ o≥¿fûê(%s)\n", 
libã°_¨g2
);

262 
	`f˛o£
(
hd_§c
);

263  
TEST_ERR_FSTAT
;

265 
	`Ârötf
(
°dîr
, "SëÅÿu∂ﬂd %d byãs\n", ()
fûe_öfo
.
°_size
);

267 
	`ªs_globÆ_öô
(
CURL_GLOBAL_ALL
);

268 if(
ªs
) {

269 
	`f˛o£
(
hd_§c
);

270  
ªs
;

273 
	`ósy_öô
(
cuæ
);

276 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

279 
	`ósy_£t›t
(
cuæ
,
CURLOPT_URL
, 
URL
);

282 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

285 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_READDATA
, 
hd_§c
);

287 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_USERPWD
, 
libã°_¨g3
);

288 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_SSH_PUBLIC_KEYFILE
, "curl_client_key.pub");

289 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_SSH_PRIVATE_KEYFILE
, "curl_client_key");

291 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE_LARGE
, (
cuæ_off_t
)
fûe_öfo
.
°_size
);

293 
	`mu…i_öô
(
m
);

295 
	`mu…i_£t›t
(
m
, 
CURLMOPT_SOCKETFUNCTION
, 
cuæSockëCÆlback
);

296 
	`mu…i_£t›t
(
m
, 
CURLMOPT_SOCKETDATA
, &
sockës
);

298 
	`mu…i_£t›t
(
m
, 
CURLMOPT_TIMERFUNCTION
, 
cuæTimîCÆlback
);

299 
	`mu…i_£t›t
(
m
, 
CURLMOPT_TIMERDATA
, &
timeout
);

301 
	`mu…i_add_h™dÀ
(
m
, 
cuæ
);

303 !
	`checkF‹Com∂ëi⁄
(
m
, &
suc˚ss
))

305 
fd_£t
 
ªadSë
, 
wrôeSë
;

306 
cuæ_sockë_t
 
maxFd
 = 0;

307 
timevÆ
 
tv
 = {10, 0};

309 
	`FD_ZERO
(&
ªadSë
);

310 
	`FD_ZERO
(&
wrôeSë
);

311 
	`upd©eFdSë
(&
sockës
.
ªad
, &
ªadSë
, &
maxFd
);

312 
	`upd©eFdSë
(&
sockës
.
wrôe
, &
wrôeSë
, &
maxFd
);

314 i‡(
timeout
.
tv_£c
 != -1)

316 
usTimeout
 = 
	`gëMi¸oSec⁄dTimeout
(&
timeout
);

317 
tv
.
tv_£c
 = 
usTimeout
 / 1000000;

318 
tv
.
tv_u£c
 = 
usTimeout
 % 1000000;

320 i‡(
maxFd
 <= 0)

322 
tv
.
tv_£c
 = 0;

323 
tv
.
tv_u£c
 = 100000;

326 
	`£À˘_ã°
(
maxFd
, &
ªadSë
, &
wrôeSë
, 
NULL
, &
tv
);

329 
	`checkFdSë
(
m
, &
sockës
.
ªad
, &
ªadSë
, 
CURL_CSELECT_IN
, "read");

330 
	`checkFdSë
(
m
, &
sockës
.
wrôe
, &
wrôeSë
, 
CURL_CSELECT_OUT
, "write");

332 i‡(
timeout
.
tv_£c
 !-1 && 
	`gëMi¸oSec⁄dTimeout
(&timeout) == 0)

335 
	`nŸifyCuæ
(
m
, 
CURL_SOCKET_TIMEOUT
, 0, "timeout");

338 
	`ab‹t_⁄_ã°_timeout
();

341 i‡(!
suc˚ss
)

343 
	`Ârötf
(
°dîr
, "Error uploading file.\n");

344 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

347 
ã°_˛ónup
:

351 
	`cuæ_mu…i_ªmove_h™dÀ
(
m
, 
cuæ
);

352 
	`cuæ_ósy_˛ónup
(
cuæ
);

353 
	`cuæ_mu…i_˛ónup
(
m
);

354 
	`cuæ_globÆ_˛ónup
();

357 
	`f˛o£
(
hd_§c
);

360 if(
sockës
.
ªad
.sockets)

361 
	`‰ì
(
sockës
.
ªad
.sockets);

362 if(
sockës
.
wrôe
.sockets)

363 
	`‰ì
(
sockës
.
wrôe
.sockets);

365  
ªs
;

366 
	}
}

	@tests/libtest/lib583.c

27 
	~"ã°.h
"

29 
	~<sys/°©.h
>

31 
	~"memdebug.h
"

33 
	$ã°
(*
URL
)

35 
°ûlRu¬ög
;

36 
CURLM
* 
mu…iH™dÀ
 = 
NULL
;

37 
CURL
* 
cuæ
 = 
NULL
;

38 
ªs
 = 0;

40 
	`globÆ_öô
(
CURL_GLOBAL_ALL
);

42 
	`mu…i_öô
(
mu…iH™dÀ
);

44 
	`ósy_öô
(
cuæ
);

46 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_USERPWD
, 
libã°_¨g2
);

47 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_SSH_PUBLIC_KEYFILE
, "curl_client_key.pub");

48 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_SSH_PRIVATE_KEYFILE
, "curl_client_key");

50 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_UPLOAD
, 1L);

51 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

53 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

54 
	`ósy_£t›t
(
cuæ
, 
CURLOPT_INFILESIZE
, ()5);

56 
	`mu…i_add_h™dÀ
(
mu…iH™dÀ
, 
cuæ
);

61 
	`Ârötf
(
°dîr
, "curl_multi_perform()...\n");

63 
	`mu…i_≥rf‹m
(
mu…iH™dÀ
, &
°ûlRu¬ög
);

65 
	`Ârötf
(
°dîr
, "curl_multi_perform() succeeded\n");

67 
	`Ârötf
(
°dîr
, "curl_multi_remove_handle()...\n");

68 
ªs
 = (Ë
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…iH™dÀ
, 
cuæ
);

69 if(
ªs
)

70 
	`Ârötf
(
°dîr
, "curl_multi_remove_handle() failed, "

71 "wôh codê%d\n", 
ªs
);

73 
	`Ârötf
(
°dîr
, "curl_multi_remove_handle() succeeded\n");

75 
ã°_˛ónup
:

79 
	`cuæ_ósy_˛ónup
(
cuæ
);

80 
	`cuæ_mu…i_˛ónup
(
mu…iH™dÀ
);

81 
	`cuæ_globÆ_˛ónup
();

83  
ªs
;

84 
	}
}

	@tests/libtest/lib586.c

22 
	~"ã°.h
"

24 
	~<cuæ/m¥ötf.h
>

26 
	~"memdebug.h
"

28 
	#THREADS
 2

	)

31 
	sTd©a
 {

32 
CURLSH
 *
	msh¨e
;

33 *
	muæ
;

36 
	su£rd©a
 {

37 *
	mãxt
;

38 
	mcou¡î
;

42 
	$my_lock
(
CURL
 *
h™dÀ
, 
cuæ_lock_d©a
 
d©a
, 
cuæ_lock_ac˚ss
 
œc˚ss
,

43 *
u£±r
 )

45 c⁄° *
wh©
;

46 
u£rd©a
 *
u£r
 = (u£rd©®*)
u£±r
;

48 ()
h™dÀ
;

49 ()
œc˚ss
;

51  
d©a
 ) {

52 
CURL_LOCK_DATA_SHARE
:

53 
wh©
 = "share";

55 
CURL_LOCK_DATA_DNS
:

56 
wh©
 = "dns";

58 
CURL_LOCK_DATA_COOKIE
:

59 
wh©
 = "cookie";

61 
CURL_LOCK_DATA_SSL_SESSION
:

62 
wh©
 = "ssl_session";

65 
	`Ârötf
(
°dîr
, "lock:Çÿsuch d©a: %d\n", ()
d©a
);

68 
	`¥ötf
("lock: %-6†[%s]: %d\n", 
wh©
, 
u£r
->
ãxt
, u£r->
cou¡î
);

69 
u£r
->
cou¡î
++;

70 
	}
}

73 
	$my_u∆ock
(
CURL
 *
h™dÀ
, 
cuæ_lock_d©a
 
d©a
, *
u£±r
 )

75 c⁄° *
wh©
;

76 
u£rd©a
 *
u£r
 = (u£rd©®*)
u£±r
;

77 ()
h™dÀ
;

78  
d©a
 ) {

79 
CURL_LOCK_DATA_SHARE
:

80 
wh©
 = "share";

82 
CURL_LOCK_DATA_DNS
:

83 
wh©
 = "dns";

85 
CURL_LOCK_DATA_COOKIE
:

86 
wh©
 = "cookie";

88 
CURL_LOCK_DATA_SSL_SESSION
:

89 
wh©
 = "ssl_session";

92 
	`Ârötf
(
°dîr
, "u∆ock:Çÿsuch d©a: %d\n", ()
d©a
);

95 
	`¥ötf
("u∆ock: %-6†[%s]: %d\n", 
wh©
, 
u£r
->
ãxt
, u£r->
cou¡î
);

96 
u£r
->
cou¡î
++;

97 
	}
}

100 *
	$fúe
(*
±r
)

102 
CURLcode
 
code
;

103 
Td©a
 *
td©a
 = (Td©a*)
±r
;

104 
CURL
 *
cuæ
;

105 
i
=0;

107 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

108 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

109  
NULL
;

112 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SSL_VERIFYPEER
, 0L);

113 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

114 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_URL
, 
td©a
->
uæ
);

115 
	`¥ötf
( "CURLOPT_SHARE\n" );

116 
	`cuæ_ósy_£t›t
(
cuæ
, 
CURLOPT_SHARE
, 
td©a
->
sh¨e
);

118 
	`¥ötf
( "PERFORM\n" );

119 
code
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

120 if–
code
 !
CURLE_OK
 ) {

121 
	`Ârötf
(
°dîr
, "perform url '%s'Ñepeat %d failed, curlcode %d\n",

122 
td©a
->
uæ
, 
i
, ()
code
);

125 
	`¥ötf
( "CLEANUP\n" );

126 
	`cuæ_ósy_˛ónup
(
cuæ
);

128  
NULL
;

129 
	}
}

132 
	$ã°
(*
URL
)

134 
ªs
;

135 
CURLSHcode
 
scode
 = 
CURLSHE_OK
;

136 *
uæ
;

137 
Td©a
 
td©a
;

138 
CURL
 *
cuæ
;

139 
CURLSH
 *
sh¨e
;

140 
i
;

141 
u£rd©a
 
u£r
;

143 
u£r
.
ãxt
 = (*)"Pigs in space";

144 
u£r
.
cou¡î
 = 0;

146 
	`¥ötf
( "GLOBAL_INIT\n" );

147 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

148 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

149  
TEST_ERR_MAJOR_BAD
;

153 
	`¥ötf
( "SHARE_INIT\n" );

154 i‡((
sh¨e
 = 
	`cuæ_sh¨e_öô
()Ë=
NULL
) {

155 
	`Ârötf
(
°dîr
, "curl_share_init() failed\n");

156 
	`cuæ_globÆ_˛ónup
();

157  
TEST_ERR_MAJOR_BAD
;

160 i‡–
CURLSHE_OK
 =
scode
 ) {

161 
	`¥ötf
( "CURLSHOPT_LOCKFUNC\n" );

162 
scode
 = 
	`cuæ_sh¨e_£t›t
–
sh¨e
, 
CURLSHOPT_LOCKFUNC
, 
my_lock
);

164 i‡–
CURLSHE_OK
 =
scode
 ) {

165 
	`¥ötf
( "CURLSHOPT_UNLOCKFUNC\n" );

166 
scode
 = 
	`cuæ_sh¨e_£t›t
–
sh¨e
, 
CURLSHOPT_UNLOCKFUNC
, 
my_u∆ock
);

168 i‡–
CURLSHE_OK
 =
scode
 ) {

169 
	`¥ötf
( "CURLSHOPT_USERDATA\n" );

170 
scode
 = 
	`cuæ_sh¨e_£t›t
–
sh¨e
, 
CURLSHOPT_USERDATA
, &
u£r
);

172 i‡–
CURLSHE_OK
 =
scode
 ) {

173 
	`¥ötf
( "CURL_LOCK_DATA_SSL_SESSION\n" );

174 
scode
 = 
	`cuæ_sh¨e_£t›t
–
sh¨e
, 
CURLSHOPT_SHARE
, 
CURL_LOCK_DATA_SSL_SESSION
);

177 i‡–
CURLSHE_OK
 !
scode
 ) {

178 
	`Ârötf
(
°dîr
, "curl_share_setopt() failed\n");

179 
	`cuæ_sh¨e_˛ónup
(
sh¨e
);

180 
	`cuæ_globÆ_˛ónup
();

181  
TEST_ERR_MAJOR_BAD
;

185 
ªs
 = 0;

188 
i
=1; i<=
THREADS
; i++ ) {

191 
td©a
.
uæ
 = 
URL
;

192 
td©a
.
sh¨e
 = share;

195 
	`¥ötf
–"***Ñu¿%d\n",
i
 );

196 
	`fúe
–&
td©a
 );

201 
	`¥ötf
–"***Ñu¿%d\n", 
i
 );

202 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

203 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

204 
	`cuæ_sh¨e_˛ónup
(
sh¨e
);

205 
	`cuæ_globÆ_˛ónup
();

206  
TEST_ERR_MAJOR_BAD
;

209 
uæ
 = 
URL
;

210 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_URL
, 
uæ
 );

211 
	`¥ötf
( "CURLOPT_SHARE\n" );

212 
	`ã°_£t›t
–
cuæ
, 
CURLOPT_SHARE
, 
sh¨e
 );

214 
	`¥ötf
( "PERFORM\n" );

215 
	`cuæ_ósy_≥rf‹m
–
cuæ
 );

218 
	`¥ötf
( "try SHARE_CLEANUP...\n" );

219 
scode
 = 
	`cuæ_sh¨e_˛ónup
–
sh¨e
 );

220 i‡–
scode
==
CURLSHE_OK
 )

222 
	`Ârötf
(
°dîr
, "curl_share_cleanup succeed butÉrrorÉxpected\n");

223 
sh¨e
 = 
NULL
;

225 
	`¥ötf
( "SHARE_CLEANUP failed, correct\n" );

228 
ã°_˛ónup
:

231 
	`¥ötf
( "CLEANUP\n" );

232 
	`cuæ_ósy_˛ónup
–
cuæ
 );

235 
	`¥ötf
( "SHARE_CLEANUP\n" );

236 
scode
 = 
	`cuæ_sh¨e_˛ónup
–
sh¨e
 );

237 i‡–
scode
!=
CURLSHE_OK
 )

238 
	`Ârötf
(
°dîr
, "curl_share_cleanup failed, codeÉrrno %d\n",

239 ()
scode
);

241 
	`¥ötf
( "GLOBAL_CLEANUP\n" );

242 
	`cuæ_globÆ_˛ónup
();

244  
ªs
;

245 
	}
}

	@tests/libtest/lib590.c

22 
	~"ã°.h
"

37 
	~"memdebug.h
"

39 
	$ã°
(*
URL
)

41 
CURLcode
 
ªs
;

42 
CURL
 *
cuæ
;

44 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

45 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

46  
TEST_ERR_MAJOR_BAD
;

49 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

50 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

51 
	`cuæ_globÆ_˛ónup
();

52  
TEST_ERR_MAJOR_BAD
;

55 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

56 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

57 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYAUTH
,

58 (Ë(
CURLAUTH_BASIC
 | 
CURLAUTH_DIGEST
 | 
CURLAUTH_NTLM
));

59 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXY
, 
libã°_¨g2
);

60 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROXYUSERPWD
, "me:password");

62 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

64 
ã°_˛ónup
:

66 
	`cuæ_ósy_˛ónup
(
cuæ
);

67 
	`cuæ_globÆ_˛ónup
();

69  ()
ªs
;

70 
	}
}

	@tests/libtest/lib591.c

22 
	~"ã°.h
"

26 #ifde‡
HAVE_LIMITS_H


27 
	~<limôs.h
>

30 
	~<f˙é.h
>

32 
	~"ã°utû.h
"

33 
	~"w¨∆ess.h
"

34 
	~"memdebug.h
"

36 
	#TEST_HANG_TIMEOUT
 60 * 1000

	)

38 
	$ã°
(*
URL
)

40 
CURL
 *
ósy
 = 
NULL
;

41 
CURLM
 *
mu…i
 = 
NULL
;

42 
ªs
 = 0;

43 
ru¬ög
;

44 
msgs_À·
;

45 
CURLMsg
 *
msg
;

46 
FILE
 *
u∂ﬂd
 = 
NULL
;

47 
îr‹
;

49 
	`°¨t_ã°_timög
();

51 
u∂ﬂd
 = 
	`f›í
(
libã°_¨g3
, "rb");

52 if(!
u∂ﬂd
) {

53 
îr‹
 = 
ERRNO
;

54 
	`Ârötf
(
°dîr
, "fopen() failed withÉrror: %d (%s)\n",

55 
îr‹
, 
	`°ªº‹
(error));

56 
	`Ârötf
(
°dîr
, "Eº‹ o≥nög fûe: (%s)\n", 
libã°_¨g3
);

57  
TEST_ERR_FOPEN
;

60 
	`ªs_globÆ_öô
(
CURL_GLOBAL_ALL
);

61 if(
ªs
) {

62 
	`f˛o£
(
u∂ﬂd
);

63  
ªs
;

66 
	`ósy_öô
(
ósy
);

69 
	`ósy_£t›t
(
ósy
, 
CURLOPT_VERBOSE
, 1L);

72 
	`ósy_£t›t
(
ósy
, 
CURLOPT_URL
, 
URL
);

75 
	`ósy_£t›t
(
ósy
, 
CURLOPT_UPLOAD
, 1L);

78 
	`ósy_£t›t
(
ósy
, 
CURLOPT_READDATA
, 
u∂ﬂd
);

81 
	`ósy_£t›t
(
ósy
, 
CURLOPT_FTPPORT
, "-");

84 
	`ósy_£t›t
(
ósy
, 
CURLOPT_ACCEPTTIMEOUT_MS
,

85 
	`°πﬁ
(
libã°_¨g2
, 
NULL
, 10)*1000);

87 
	`mu…i_öô
(
mu…i
);

89 
	`mu…i_add_h™dÀ
(
mu…i
, 
ósy
);

92 
timevÆ
 
öãrvÆ
;

93 
fd_£t
 
fdªad
;

94 
fd_£t
 
fdwrôe
;

95 
fd_£t
 
fdex˚p
;

96 
timeout
 = -99;

97 
maxfd
 = -99;

99 
	`mu…i_≥rf‹m
(
mu…i
, &
ru¬ög
);

101 
	`ab‹t_⁄_ã°_timeout
();

103 if(!
ru¬ög
)

106 
	`FD_ZERO
(&
fdªad
);

107 
	`FD_ZERO
(&
fdwrôe
);

108 
	`FD_ZERO
(&
fdex˚p
);

110 
	`mu…i_fd£t
(
mu…i
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

114 
	`mu…i_timeout
(
mu…i
, &
timeout
);

118 if(
timeout
 != -1L) {

119 
ôimeout
 = (
timeout
 > ()
INT_MAX
) ? INT_MAX : ()timeout;

120 
öãrvÆ
.
tv_£c
 = 
ôimeout
/1000;

121 
öãrvÆ
.
tv_u£c
 = (
ôimeout
%1000)*1000;

124 
öãrvÆ
.
tv_£c
 = 0;

125 
öãrvÆ
.
tv_u£c
 = 100000L;

128 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
öãrvÆ
);

130 
	`ab‹t_⁄_ã°_timeout
();

133 
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
mu…i
, &
msgs_À·
);

134 if(
msg
)

135 
ªs
 = 
msg
->
d©a
.
ªsu…
;

137 
ã°_˛ónup
:

141 
	`cuæ_mu…i_˛ónup
(
mu…i
);

142 
	`cuæ_ósy_˛ónup
(
ósy
);

143 
	`cuæ_globÆ_˛ónup
();

146 
	`f˛o£
(
u∂ﬂd
);

148  
ªs
;

149 
	}
}

	@tests/libtest/lib597.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_LIMITS_H


25 
	~<limôs.h
>

28 
	~"ã°utû.h
"

29 
	~"w¨∆ess.h
"

30 
	~"memdebug.h
"

32 
	#TEST_HANG_TIMEOUT
 5 * 1000

	)

46 
	mCONNECT_ONLY_PHASE
 = 0,

47 
	mQUIT_PHASE
,

48 
	mLAST_PHASE


51 
	$ã°
(*
URL
)

53 
CURL
 *
ósy
 = 
NULL
;

54 
CURLM
 *
mu…i
 = 
NULL
;

55 
ªs
 = 0;

56 
ru¬ög
;

57 
msgs_À·
;

58 
pha£
;

59 
CURLMsg
 *
msg
;

61 
	`°¨t_ã°_timög
();

63 
	`ªs_globÆ_öô
(
CURL_GLOBAL_ALL
);

64 if(
ªs
) {

65  
ªs
;

68 
	`ósy_öô
(
ósy
);

70 
	`mu…i_öô
(
mu…i
);

72 
pha£
 = 
CONNECT_ONLY_PHASE
;Öha£ < 
LAST_PHASE
; ++phase) {

74 
	`ósy_£t›t
(
ósy
, 
CURLOPT_VERBOSE
, 1L);

77 
	`ósy_£t›t
(
ósy
, 
CURLOPT_URL
, 
URL
);

80 i‡(
pha£
 =
CONNECT_ONLY_PHASE
)

81 
	`ósy_£t›t
(
ósy
, 
CURLOPT_CONNECT_ONLY
, 1L);

84 i‡(
pha£
 =
QUIT_PHASE
) {

85 
	`ósy_£t›t
(
ósy
, 
CURLOPT_CONNECT_ONLY
, 0L);

86 
	`ósy_£t›t
(
ósy
, 
CURLOPT_NOBODY
, 1L);

87 
	`ósy_£t›t
(
ósy
, 
CURLOPT_FORBID_REUSE
, 1L);

90 
	`mu…i_add_h™dÀ
(
mu…i
, 
ósy
);

93 
timevÆ
 
öãrvÆ
;

94 
fd_£t
 
fdªad
;

95 
fd_£t
 
fdwrôe
;

96 
fd_£t
 
fdex˚p
;

97 
timeout
 = -99;

98 
maxfd
 = -99;

100 
	`mu…i_≥rf‹m
(
mu…i
, &
ru¬ög
);

102 
	`ab‹t_⁄_ã°_timeout
();

104 if(!
ru¬ög
)

107 
	`FD_ZERO
(&
fdªad
);

108 
	`FD_ZERO
(&
fdwrôe
);

109 
	`FD_ZERO
(&
fdex˚p
);

111 
	`mu…i_fd£t
(
mu…i
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

115 
	`mu…i_timeout
(
mu…i
, &
timeout
);

119 if(
timeout
 != -1L) {

120 
ôimeout
 = (
timeout
 > ()
INT_MAX
) ? INT_MAX : ()timeout;

121 
öãrvÆ
.
tv_£c
 = 
ôimeout
/1000;

122 
öãrvÆ
.
tv_u£c
 = (
ôimeout
%1000)*1000;

125 
öãrvÆ
.
tv_£c
 = 
TEST_HANG_TIMEOUT
/1000+1;

126 
öãrvÆ
.
tv_u£c
 = 0;

129 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
öãrvÆ
);

131 
	`ab‹t_⁄_ã°_timeout
();

134 
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
mu…i
, &
msgs_À·
);

135 if(
msg
)

136 
ªs
 = 
msg
->
d©a
.
ªsu…
;

138 
	`mu…i_ªmove_h™dÀ
(
mu…i
, 
ósy
);

141 
ã°_˛ónup
:

145 
	`cuæ_mu…i_˛ónup
(
mu…i
);

146 
	`cuæ_ósy_˛ónup
(
ósy
);

147 
	`cuæ_globÆ_˛ónup
();

149  
ªs
;

150 
	}
}

	@tests/libtest/lib598.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$ã°
(*
URL
)

28 
CURLcode
 
ªs
;

29 
CURL
 *
cuæ
;

31 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

32 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

33  
TEST_ERR_MAJOR_BAD
;

36 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

37 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

38 
	`cuæ_globÆ_˛ónup
();

39  
TEST_ERR_MAJOR_BAD
;

42 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

43 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_REFERER
, "http://example.com/the-moo");

45 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_USERAGENT
, "the-mooágentÇext generation");

46 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_COOKIE
, "name=moo");

47 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

49 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

50 if(
ªs
) {

51 
	`Ârötf
(
°dîr
, "retrieve 1 failed\n");

52 
ã°_˛ónup
;

55 
	`cuæ_ósy_ª£t
(
cuæ
);

57 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

58 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

59 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

61 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

62 if(
ªs
)

63 
	`Ârötf
(
°dîr
, "retrieve 2 failed\n");

65 
ã°_˛ónup
:

67 
	`cuæ_ósy_˛ónup
(
cuæ
);

68 
	`cuæ_globÆ_˛ónup
();

70  ()
ªs
;

71 
	}
}

	@tests/libtest/lib599.c

22 
	~"ã°.h
"

24 
	~"memdebug.h
"

26 
	$¥ogªss_ˇŒback
(*
˛õ¡p
, 
d…ŸÆ
,

27 
d ow
, 
u…ŸÆ
, 
u ow
)

29 ()
˛õ¡p
;

30 ()
u ow
;

31 ()
u…ŸÆ
;

33 if((
d…ŸÆ
 > 0.0Ë&& (
d ow
 > dltotal)) {

35 
	`¥ötf
("%.0‡> %.0‡!!\n", 
d…ŸÆ
, 
d ow
);

40 
	}
}

42 
	$ã°
(*
URL
)

44 
CURL
 *
cuæ
;

45 
CURLcode
 
ªs
=
CURLE_OK
;

47 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

48 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

49  
TEST_ERR_MAJOR_BAD
;

52 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

53 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

54 
	`cuæ_globÆ_˛ónup
();

55  
TEST_ERR_MAJOR_BAD
;

59 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
URL
);

62 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_NOPROGRESS
, 0L);

63 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_PROGRESSFUNCTION
, 
¥ogªss_ˇŒback
);

66 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

69 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_FOLLOWLOCATION
, 1L);

72 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

75 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

77 
ã°_˛ónup
:

80 
	`cuæ_ósy_˛ónup
(
cuæ
);

81 
	`cuæ_globÆ_˛ónup
();

83  
ªs
;

84 
	}
}

	@tests/libtest/libauthretry.c

27 
	~"ã°.h
"

28 
	~"°ªquÆ.h
"

29 
	~"memdebug.h
"

31 
CURLcode
 
	$£nd_ªque°
(
CURL
 *
cuæ
, c⁄° *
uæ
, 
£q
,

32 
auth_scheme
, c⁄° *
u£Ωwd
)

34 
CURLcode
 
ªs
;

35 * 
fuŒ_uæ
 = 
	`mÆloc
(
	`°æí
(
uæ
) + 4 + 1);

36 i‡(!
fuŒ_uæ
) {

37 
	`Ârötf
(
°dîr
, "NotÉnough memory for full url\n");

38  
CURLE_OUT_OF_MEMORY
;

41 
	`•rötf
(
fuŒ_uæ
, "%s%04d", 
uæ
, 
£q
);

42 
	`Ârötf
(
°dîr
, "SendingÇewÑequest %dÅo %s with credential %s "

43 "◊uth %ld)\n", 
£q
, 
fuŒ_uæ
, 
u£Ωwd
, 
auth_scheme
);

44 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_URL
, 
fuŒ_uæ
);

45 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_VERBOSE
, 1L);

46 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HEADER
, 1L);

47 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPGET
, 1L);

48 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_USERPWD
, 
u£Ωwd
);

49 
	`ã°_£t›t
(
cuæ
, 
CURLOPT_HTTPAUTH
, 
auth_scheme
);

51 
ªs
 = 
	`cuæ_ósy_≥rf‹m
(
cuæ
);

53 
ã°_˛ónup
:

54 
	`‰ì
(
fuŒ_uæ
);

55  
ªs
;

56 
	}
}

58 
CURLcode
 
	$£nd_wr⁄g_∑ssw‹d
(
CURL
 *
cuæ
, c⁄° *
uæ
, 
£q
,

59 
auth_scheme
)

61  
	`£nd_ªque°
(
cuæ
, 
uæ
, 
£q
, 
auth_scheme
, "testuser:wrongpass");

62 
	}
}

64 
CURLcode
 
	$£nd_right_∑ssw‹d
(
CURL
 *
cuæ
, c⁄° *
uæ
, 
£q
,

65 
auth_scheme
)

67  
	`£nd_ªque°
(
cuæ
, 
uæ
, 
£q
, 
auth_scheme
, "testuser:testpass");

68 
	}
}

70 
	$∑r£_auth_«me
(c⁄° *
¨g
)

72 i‡(!
¨g
)

73  
CURLAUTH_NONE
;

74 i‡(
	`°ªquÆ
(
¨g
, "basic"))

75  
CURLAUTH_BASIC
;

76 i‡(
	`°ªquÆ
(
¨g
, "digest"))

77  
CURLAUTH_DIGEST
;

78 i‡(
	`°ªquÆ
(
¨g
, "ntlm"))

79  
CURLAUTH_NTLM
;

80  
CURLAUTH_NONE
;

81 
	}
}

83 
	$ã°
(*
uæ
)

85 
CURLcode
 
ªs
;

86 
CURL
 *
cuæ
 = 
NULL
;

88 
maö_auth_scheme
 = 
	`∑r£_auth_«me
(
libã°_¨g2
);

89 
ÁŒback_auth_scheme
 = 
	`∑r£_auth_«me
(
libã°_¨g3
);

91 i‡(
maö_auth_scheme
 =
CURLAUTH_NONE
 ||

92 
ÁŒback_auth_scheme
 =
CURLAUTH_NONE
) {

93 
	`Ârötf
(
°dîr
, "auth schemesÇot found on commandline\n");

94  
TEST_ERR_MAJOR_BAD
;

97 i‡(
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
Ë!
CURLE_OK
) {

98 
	`Ârötf
(
°dîr
, "curl_global_init() failed\n");

99  
TEST_ERR_MAJOR_BAD
;

104 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

105 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

106 
	`cuæ_globÆ_˛ónup
();

107  
TEST_ERR_MAJOR_BAD
;

110 
ªs
 = 
	`£nd_wr⁄g_∑ssw‹d
(
cuæ
, 
uæ
, 100, 
maö_auth_scheme
);

111 i‡(
ªs
 !
CURLE_OK
)

112 
ã°_˛ónup
;

113 
	`cuæ_ósy_ª£t
(
cuæ
);

115 
ªs
 = 
	`£nd_right_∑ssw‹d
(
cuæ
, 
uæ
, 200, 
ÁŒback_auth_scheme
);

116 i‡(
ªs
 !
CURLE_OK
)

117 
ã°_˛ónup
;

118 
	`cuæ_ósy_ª£t
(
cuæ
);

120 
	`cuæ_ósy_˛ónup
(
cuæ
);

124 i‡((
cuæ
 = 
	`cuæ_ósy_öô
()Ë=
NULL
) {

125 
	`Ârötf
(
°dîr
, "curl_easy_init() failed\n");

126 
	`cuæ_globÆ_˛ónup
();

127  
TEST_ERR_MAJOR_BAD
;

130 
ªs
 = 
	`£nd_wr⁄g_∑ssw‹d
(
cuæ
, 
uæ
, 300, 
maö_auth_scheme
);

131 i‡(
ªs
 !
CURLE_OK
)

132 
ã°_˛ónup
;

133 
	`cuæ_ósy_ª£t
(
cuæ
);

135 
ªs
 = 
	`£nd_wr⁄g_∑ssw‹d
(
cuæ
, 
uæ
, 400, 
ÁŒback_auth_scheme
);

136 i‡(
ªs
 !
CURLE_OK
)

137 
ã°_˛ónup
;

138 
	`cuæ_ósy_ª£t
(
cuæ
);

140 
ªs
 = 
	`£nd_right_∑ssw‹d
(
cuæ
, 
uæ
, 500, 
ÁŒback_auth_scheme
);

141 i‡(
ªs
 !
CURLE_OK
)

142 
ã°_˛ónup
;

143 
	`cuæ_ósy_ª£t
(
cuæ
);

145 
ã°_˛ónup
:

147 
	`cuæ_ósy_˛ónup
(
cuæ
);

148 
	`cuæ_globÆ_˛ónup
();

150  ()
ªs
;

151 
	}
}

	@tests/libtest/libntlmconnect.c

22 
	~"ã°.h
"

24 #ifde‡
HAVE_LIMITS_H


25 
	~<limôs.h
>

27 
	~<as£π.h
>

29 
	~"ã°utû.h
"

30 
	~"w¨∆ess.h
"

31 
	~"memdebug.h
"

33 
	#TEST_HANG_TIMEOUT
 5 * 1000

	)

34 
	#MAX_EASY_HANDLES
 3

	)

36 
CURL
 *
	gósy
[
MAX_EASY_HANDLES
];

37 
cuæ_sockë_t
 
	gsockës
[
MAX_EASY_HANDLES
];

38 
	gªs
 = 0;

40 
size_t
 
	$ˇŒback
(* 
±r
, 
size_t
 
size
, size_à
nmemb
, * 
d©a
)

42 
ssize_t
 
idx
 = ((
CURL
 **Ë
d©a
Ë- 
ósy
;

43 
cuæ_sockë_t
 
sock
;

44 
l⁄gd©a
;

45 
CURLcode
 
code
;

47 c⁄° 
size_t
 
Áûuª
 = (
size
 * 
nmemb
) ? 0 : 1;

49 *
ouçut
 = 
	`mÆloc
(
size
 * 
nmemb
 + 1);

50 i‡(!
ouçut
) {

51 
	`Ârötf
(
°dîr
, "output, malloc() failed\n");

52 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

53  
Áûuª
;

56 
	`mem˝y
(
ouçut
, 
±r
, 
size
 * 
nmemb
);

57 
ouçut
[
size
 * 
nmemb
] = '\0';

58 
	`Ârötf
(
°dout
, "%s", 
ouçut
);

59 
	`‰ì
(
ouçut
);

62 
code
 = 
	`cuæ_ósy_gëöfo
(
ósy
[
idx
], 
CURLINFO_LASTSOCKET
, &
l⁄gd©a
);

63 i‡(
CURLE_OK
 !
code
) {

64 
	`Ârötf
(
°dîr
, "%s:%d curl_easy_getinfo() failed, "

66 
__FILE__
, 
__LINE__
, ()
code
, 
	`cuæ_ósy_°ªº‹
(code));

67 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

68  
Áûuª
;

70 i‡(
l⁄gd©a
 == -1L)

71 
sock
 = 
CURL_SOCKET_BAD
;

73 
sock
 = (
cuæ_sockë_t
)
l⁄gd©a
;

75 i‡(
sock
 !
CURL_SOCKET_BAD
) {

77 i‡(
sockës
[
idx
] =
CURL_SOCKET_BAD
) {

79 
sockës
[
idx
] = 
sock
;

81 i‡(
sock
 !
sockës
[
idx
]) {

84 
	`Ârötf
(
°dîr
, "Handle %d started on socket %dánd movedÅo %d\n",

85 
	`cuæx_sztosi
(
idx
), ()
sockës
[idx], ()
sock
);

86 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

87  
Áûuª
;

90  
size
 * 
nmemb
;

91 
	}
}

93 
	eH™dÀSèã
 {

94 
	mRódyF‹NewH™dÀ
,

95 
	mNìdSockëF‹NewH™dÀ
,

96 
	mNoM‹eH™dÀs


99 
	$ã°
(*
uæ
)

101 
CURLM
 *
mu…i
 = 
NULL
;

102 
ru¬ög
;

103 
i
, 
j
;

104 
num_h™dÀs
 = 0;

105 
H™dÀSèã
 
°©e
 = 
RódyF‹NewH™dÀ
;

106 * 
fuŒ_uæ
 = 
	`mÆloc
(
	`°æí
(
uæ
) + 4 + 1);

108 
	`°¨t_ã°_timög
();

110 i‡(!
fuŒ_uæ
) {

111 
	`Ârötf
(
°dîr
, "NotÉnough memory for full url\n");

112  
TEST_ERR_MAJOR_BAD
;

115 
i
 = 0; i < 
MAX_EASY_HANDLES
; ++i) {

116 
ósy
[
i
] = 
NULL
;

117 
sockës
[
i
] = 
CURL_SOCKET_BAD
;

120 
	`ªs_globÆ_öô
(
CURL_GLOBAL_ALL
);

121 if(
ªs
) {

122 
	`‰ì
(
fuŒ_uæ
);

123  
ªs
;

126 
	`mu…i_öô
(
mu…i
);

128 #ifde‡
USE_PIPELINING


129 
	`mu…i_£t›t
(
mu…i
, 
CURLMOPT_PIPELINING
, 1L);

130 
	`mu…i_£t›t
(
mu…i
, 
CURLMOPT_MAX_HOST_CONNECTIONS
, 5L);

131 
	`mu…i_£t›t
(
mu…i
, 
CURLMOPT_MAX_TOTAL_CONNECTIONS
, 10L);

135 
timevÆ
 
öãrvÆ
;

136 
fd_£t
 
fdªad
;

137 
fd_£t
 
fdwrôe
;

138 
fd_£t
 
fdex˚p
;

139 
timeout
 = -99;

140 
maxfd
 = -99;

141 
boﬁ
 
found_√w_sockë
 = 
FALSE
;

144 i‡(
°©e
 =
RódyF‹NewH™dÀ
) {

145 
	`ósy_öô
(
ósy
[
num_h™dÀs
]);

147 i‡(
num_h™dÀs
 % 3 == 2) {

148 
	`•rötf
(
fuŒ_uæ
, "%s0200", 
uæ
);

149 
	`ósy_£t›t
(
ósy
[
num_h™dÀs
], 
CURLOPT_HTTPAUTH
, 
CURLAUTH_NTLM
);

151 
	`•rötf
(
fuŒ_uæ
, "%s0100", 
uæ
);

152 
	`ósy_£t›t
(
ósy
[
num_h™dÀs
], 
CURLOPT_HTTPAUTH
, 
CURLAUTH_BASIC
);

154 
	`ósy_£t›t
(
ósy
[
num_h™dÀs
], 
CURLOPT_FRESH_CONNECT
, 1L);

155 
	`ósy_£t›t
(
ósy
[
num_h™dÀs
], 
CURLOPT_URL
, 
fuŒ_uæ
);

156 
	`ósy_£t›t
(
ósy
[
num_h™dÀs
], 
CURLOPT_VERBOSE
, 1L);

157 
	`ósy_£t›t
(
ósy
[
num_h™dÀs
], 
CURLOPT_HTTPGET
, 1L);

158 
	`ósy_£t›t
(
ósy
[
num_h™dÀs
], 
CURLOPT_USERPWD
, "testuser:testpass");

159 
	`ósy_£t›t
(
ósy
[
num_h™dÀs
], 
CURLOPT_WRITEFUNCTION
, 
ˇŒback
);

160 
	`ósy_£t›t
(
ósy
[
num_h™dÀs
], 
CURLOPT_WRITEDATA
,Éasy +Çum_handles);

161 
	`ósy_£t›t
(
ósy
[
num_h™dÀs
], 
CURLOPT_HEADER
, 1L);

163 
	`mu…i_add_h™dÀ
(
mu…i
, 
ósy
[
num_h™dÀs
]);

164 
num_h™dÀs
 += 1;

165 
°©e
 = 
NìdSockëF‹NewH™dÀ
;

168 
	`mu…i_≥rf‹m
(
mu…i
, &
ru¬ög
);

170 
	`ab‹t_⁄_ã°_timeout
();

172 if(!
ru¬ög
 && 
°©e
 =
NoM‹eH™dÀs
)

175 
	`FD_ZERO
(&
fdªad
);

176 
	`FD_ZERO
(&
fdwrôe
);

177 
	`FD_ZERO
(&
fdex˚p
);

179 
	`mu…i_fd£t
(
mu…i
, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
maxfd
);

184 
i
 = 0; i <
maxfd
; ++i) {

185 
boﬁ
 
sockë_exi°s
 = 
FALSE
;

186 
cuæ_sockë_t
 
curfd
 = (cuæ_sockë_t)
i
;

188 i‡(!
	`FD_ISSET
(
curfd
, &
fdªad
)) {

194 
j
 = 0; j < 
num_h™dÀs
; ++j) {

195 i‡(
sockës
[
j
] =
curfd
) {

196 
sockë_exi°s
 = 
TRUE
;

200 i‡(
sockë_exi°s
) {

204 i‡(
found_√w_sockë
 || 
°©e
 !
NìdSockëF‹NewH™dÀ
) {

205 
	`Ârötf
(
°dîr
, "UnexpectedÇew socket\n");

206 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

207 
ã°_˛ónup
;

211 i‡(
sockës
[
num_h™dÀs
-1] !
CURL_SOCKET_BAD
) {

214 
	`as£π
(
curfd
 !
sockës
[
num_h™dÀs
-1]);

215 
	`Ârötf
(
°dîr
, "Handle %d wroteÅo socket %dÅhen detected on %d\n",

216 
num_h™dÀs
-1, ()
sockës
[num_h™dÀs-1], ()
curfd
);

217 
ªs
 = 
TEST_ERR_MAJOR_BAD
;

218 
ã°_˛ónup
;

221 
sockës
[
num_h™dÀs
-1] = 
curfd
;

222 
found_√w_sockë
 = 
TRUE
;

227 i‡(
°©e
 =
NìdSockëF‹NewH™dÀ
) {

228 if(
maxfd
 !-1 && !
found_√w_sockë
) {

229 
	`Ârötf
(
°dîr
, "Warning: socket didÇot open immediately forÇew "

233 
°©e
 = 
num_h™dÀs
 < 
MAX_EASY_HANDLES
 ? 
RódyF‹NewH™dÀ


234 : 
NoM‹eH™dÀs
;

237 
	`mu…i_timeout
(
mu…i
, &
timeout
);

241 
	`Ârötf
(
°dîr
, "%s:%dÇum_handles %dÅimeout %ld\n",

242 
__FILE__
, 
__LINE__
, 
num_h™dÀs
, 
timeout
);

244 if(
timeout
 != -1L) {

245 
ôimeout
 = (
timeout
 > ()
INT_MAX
) ? INT_MAX : ()timeout;

246 
öãrvÆ
.
tv_£c
 = 
ôimeout
/1000;

247 
öãrvÆ
.
tv_u£c
 = (
ôimeout
%1000)*1000;

250 
öãrvÆ
.
tv_£c
 = 
TEST_HANG_TIMEOUT
/1000+1;

251 
öãrvÆ
.
tv_u£c
 = 0;

256 if(!
ru¬ög
 && 
num_h™dÀs
 =
MAX_EASY_HANDLES
) {

261 
	`£À˘_ã°
(
maxfd
+1, &
fdªad
, &
fdwrôe
, &
fdex˚p
, &
öãrvÆ
);

263 
	`ab‹t_⁄_ã°_timeout
();

266 
ã°_˛ónup
:

270 
i
 = 0; i < 
MAX_EASY_HANDLES
; i++) {

271 
	`cuæ_mu…i_ªmove_h™dÀ
(
mu…i
, 
ósy
[
i
]);

272 
	`cuæ_ósy_˛ónup
(
ósy
[
i
]);

275 
	`cuæ_mu…i_˛ónup
(
mu…i
);

276 
	`cuæ_globÆ_˛ónup
();

278 
	`‰ì
(
fuŒ_uæ
);

280  
ªs
;

281 
	}
}

	@tests/libtest/sethostname.c

22 
	~"cuæ_£tup.h
"

24 
	~"£tho°«me.h
"

30 
	$gëho°«me
(*
«me
, 
GETHOSTNAME_TYPE_ARG2
 
«mñí
)

32 c⁄° *
f‹˚_ho°«me
 = 
	`gëív
("CURL_GETHOSTNAME");

33 if(
f‹˚_ho°«me
) {

34 
	`°∫˝y
(
«me
, 
f‹˚_ho°«me
, 
«mñí
);

35 
«me
[
«mñí
-1] = '\0';

41 
	}
}

	@tests/libtest/sethostname.h

23 #ifde‡
CURL_STATICLIB


24 
	#LIBHOSTNAME_EXTERN


	)

25 #ñi‡
deföed
(
WIN32
Ë|| deföed(
__SYMBIAN32__
)

26 #i‡
deföed
(
BUILDING_LIBCURL
)

27 
	#LIBHOSTNAME_EXTERN
 
	`__de˛•ec
(
dŒexp‹t
)

	)

29 
	#LIBHOSTNAME_EXTERN
 
	`__de˛•ec
(
dŒimp‹t
)

	)

31 #ñi‡
deföed
(
BUILDING_LIBCURL
Ë&& deföed(
CURL_HIDDEN_SYMBOLS
)

32 
	#LIBHOSTNAME_EXTERN
 
CURL_EXTERN_SYMBOL


	)

34 
	#LIBHOSTNAME_EXTERN


	)

37 #ifde‡
USE_WINSOCK


38 
	#FUNCALLCONV
 
__°dˇŒ


	)

40 
	#FUNCALLCONV


	)

43 
LIBHOSTNAME_EXTERN
 
FUNCALLCONV


44 
gëho°«me
(*
«me
, 
GETHOSTNAME_TYPE_ARG2
 
«mñí
);

	@tests/libtest/test.h

28 
	#CURL_NO_OLDIES


	)

30 
	~"cuæ_£tup.h
"

32 
	~<cuæ/cuæ.h
>

34 #ifde‡
HAVE_SYS_SELECT_H


36 
	~<sys/£À˘.h
>

39 #ifde‡
TPF


40 
	~"£À˘.h
"

43 
	#ã°_£t›t
(
A
,
B
,
C
) \

44 if((
ªs
 = 
	`cuæ_ósy_£t›t
((
A
),(
B
),(
C
))Ë!
CURLE_OK
Ë
ã°_˛ónup


	)

46 
	#ã°_mu…i_£t›t
(
A
,
B
,
C
) \

47 if((
ªs
 = 
	`cuæ_mu…i_£t›t
((
A
),(
B
),(
C
))Ë!
CURLE_OK
Ë
ã°_˛ónup


	)

49 *
libã°_¨g2
;

50 *
libã°_¨g3
;

53 
ã°_¨gc
;

54 **
ã°_¨gv
;

56 
timevÆ
 
tv_ã°_°¨t
;

58 
£À˘_wøµî
(
nfds
, 
fd_£t
 *
rd
, fd_£à*
wr
, fd_£à*
exc
,

59 
timevÆ
 *
tv
);

61 
waô_ms
(
ms
);

63 
ã°
(*
URL
);

66 #ifde‡
UNITTESTS


67 
unôÁû
;

79 
	#TEST_ERR_MAJOR_BAD
 126

	)

80 
	#TEST_ERR_RUNS_FOREVER
 125

	)

81 
	#TEST_ERR_EASY_INIT
 124

	)

82 
	#TEST_ERR_MULTI_INIT
 123

	)

83 
	#TEST_ERR_NUM_HANDLES
 122

	)

84 
	#TEST_ERR_SELECT
 121

	)

85 
	#TEST_ERR_SUCCESS
 120

	)

86 
	#TEST_ERR_FAILURE
 119

	)

87 
	#TEST_ERR_USAGE
 118

	)

88 
	#TEST_ERR_FOPEN
 117

	)

89 
	#TEST_ERR_FSTAT
 116

	)

90 
	#TEST_ERR_BAD_TIMEOUT
 115

	)

123 
	#exe_ósy_öô
(
A
,
Y
,
Z
) do { \

124 if(((
A
Ë
	`cuæ_ósy_öô
()Ë=
NULL
) { \

125 
	`Ârötf
(
°dîr
, "%s:%d cuæ_ósy_öô(ËÁûed\n", (
Y
), (
Z
)); \

126 
ªs
 = 
TEST_ERR_EASY_INIT
; \

128 } 
WHILE_FALSE


	)

130 
	#ªs_ósy_öô
(
A
) \

131 
	`exe_ósy_öô
((
A
),(
__FILE__
),(
__LINE__
))

	)

133 
	#chk_ósy_öô
(
A
,
Y
,
Z
) do { \

134 
	`exe_ósy_öô
((
A
),(
Y
),(
Z
)); \

135 if(
ªs
) \

136 
ã°_˛ónup
; \

137 } 
WHILE_FALSE


	)

139 
	#ósy_öô
(
A
) \

140 
	`chk_ósy_öô
((
A
),(
__FILE__
),(
__LINE__
))

	)

144 
	#exe_mu…i_öô
(
A
,
Y
,
Z
) do { \

145 if(((
A
Ë
	`cuæ_mu…i_öô
()Ë=
NULL
) { \

146 
	`Ârötf
(
°dîr
, "%s:%d cuæ_mu…i_öô(ËÁûed\n", (
Y
), (
Z
)); \

147 
ªs
 = 
TEST_ERR_MULTI_INIT
; \

149 } 
WHILE_FALSE


	)

151 
	#ªs_mu…i_öô
(
A
) \

152 
	`exe_mu…i_öô
((
A
),(
__FILE__
),(
__LINE__
))

	)

154 
	#chk_mu…i_öô
(
A
,
Y
,
Z
) do { \

155 
	`exe_mu…i_öô
((
A
),(
Y
),(
Z
)); \

156 if(
ªs
) \

157 
ã°_˛ónup
; \

158 } 
WHILE_FALSE


	)

160 
	#mu…i_öô
(
A
) \

161 
	`chk_mu…i_öô
((
A
),(
__FILE__
),(
__LINE__
))

	)

165 
	#exe_ósy_£t›t
(
A
,
B
,
C
,
Y
,
Z
) do { \

166 
CURLcode
 
ec
; \

167 if((
ec
 = 
	`cuæ_ósy_£t›t
((
A
),(
B
),(
C
))Ë!
CURLE_OK
) { \

168 
	`Ârötf
(
°dîr
, "%s:%d curl_easy_setopt() failed, " \

170 (
Y
), (
Z
), ()
ec
, 
	`cuæ_ósy_°ªº‹
(ec)); \

171 
ªs
 = ()
ec
; \

173 } 
WHILE_FALSE


	)

175 
	#ªs_ósy_£t›t
(
A
,
B
,
C
) \

176 
	`exe_ósy_£t›t
((
A
),(
B
),(
C
),(
__FILE__
),(
__LINE__
))

	)

178 
	#chk_ósy_£t›t
(
A
,
B
,
C
,
Y
,
Z
) do { \

179 
	`exe_ósy_£t›t
((
A
),(
B
),(
C
),(
Y
),(
Z
)); \

180 if(
ªs
) \

181 
ã°_˛ónup
; \

182 } 
WHILE_FALSE


	)

184 
	#ósy_£t›t
(
A
,
B
,
C
) \

185 
	`chk_ósy_£t›t
((
A
),(
B
),(
C
),(
__FILE__
),(
__LINE__
))

	)

189 
	#exe_mu…i_£t›t
(
A
,
B
,
C
,
Y
,
Z
) do { \

190 
CURLMcode
 
ec
; \

191 if((
ec
 = 
	`cuæ_mu…i_£t›t
((
A
),(
B
),(
C
))Ë!
CURLM_OK
) { \

192 
	`Ârötf
(
°dîr
, "%s:%d curl_multi_setopt() failed, " \

194 (
Y
), (
Z
), ()
ec
, 
	`cuæ_mu…i_°ªº‹
(ec)); \

195 
ªs
 = ()
ec
; \

197 } 
WHILE_FALSE


	)

199 
	#ªs_mu…i_£t›t
(
A
,
B
,
C
) \

200 
	`exe_mu…i_£t›t
((
A
),(
B
),(
C
),(
__FILE__
),(
__LINE__
))

	)

202 
	#chk_mu…i_£t›t
(
A
,
B
,
C
,
Y
,
Z
) do { \

203 
	`exe_mu…i_£t›t
((
A
),(
B
),(
C
),(
Y
),(
Z
)); \

204 if(
ªs
) \

205 
ã°_˛ónup
; \

206 } 
WHILE_FALSE


	)

208 
	#mu…i_£t›t
(
A
,
B
,
C
) \

209 
	`chk_mu…i_£t›t
((
A
),(
B
),(
C
),(
__FILE__
),(
__LINE__
))

	)

213 
	#exe_mu…i_add_h™dÀ
(
A
,
B
,
Y
,
Z
) do { \

214 
CURLMcode
 
ec
; \

215 if((
ec
 = 
	`cuæ_mu…i_add_h™dÀ
((
A
),(
B
))Ë!
CURLM_OK
) { \

216 
	`Ârötf
(
°dîr
, "%s:%d curl_multi_add_handle() failed, " \

218 (
Y
), (
Z
), ()
ec
, 
	`cuæ_mu…i_°ªº‹
(ec)); \

219 
ªs
 = ()
ec
; \

221 } 
WHILE_FALSE


	)

223 
	#ªs_mu…i_add_h™dÀ
(
A
,
B
) \

224 
	`exe_mu…i_add_h™dÀ
((
A
),(
B
),(
__FILE__
),(
__LINE__
))

	)

226 
	#chk_mu…i_add_h™dÀ
(
A
,
B
,
Y
,
Z
) do { \

227 
	`exe_mu…i_add_h™dÀ
((
A
),(
B
),(
Y
),(
Z
)); \

228 if(
ªs
) \

229 
ã°_˛ónup
; \

230 } 
WHILE_FALSE


	)

232 
	#mu…i_add_h™dÀ
(
A
,
B
) \

233 
	`chk_mu…i_add_h™dÀ
((
A
),(
B
),(
__FILE__
),(
__LINE__
))

	)

237 
	#exe_mu…i_ªmove_h™dÀ
(
A
,
B
,
Y
,
Z
) do { \

238 
CURLMcode
 
ec
; \

239 if((
ec
 = 
	`cuæ_mu…i_ªmove_h™dÀ
((
A
),(
B
))Ë!
CURLM_OK
) { \

240 
	`Ârötf
(
°dîr
, "%s:%d curl_multi_remove_handle() failed, " \

242 (
Y
), (
Z
), ()
ec
, 
	`cuæ_mu…i_°ªº‹
(ec)); \

243 
ªs
 = ()
ec
; \

245 } 
WHILE_FALSE


	)

247 
	#ªs_mu…i_ªmove_h™dÀ
(
A
,
B
) \

248 
	`exe_mu…i_ªmove_h™dÀ
((
A
),(
B
),(
__FILE__
),(
__LINE__
))

	)

250 
	#chk_mu…i_ªmove_h™dÀ
(
A
,
B
,
Y
,
Z
) do { \

251 
	`exe_mu…i_ªmove_h™dÀ
((
A
),(
B
),(
Y
),(
Z
)); \

252 if(
ªs
) \

253 
ã°_˛ónup
; \

254 } 
WHILE_FALSE


	)

257 
	#mu…i_ªmove_h™dÀ
(
A
,
B
) \

258 
	`chk_mu…i_ªmove_h™dÀ
((
A
),(
B
),(
__FILE__
),(
__LINE__
))

	)

262 
	#exe_mu…i_≥rf‹m
(
A
,
B
,
Y
,
Z
) do { \

263 
CURLMcode
 
ec
; \

264 if((
ec
 = 
	`cuæ_mu…i_≥rf‹m
((
A
),(
B
))Ë!
CURLM_OK
) { \

265 
	`Ârötf
(
°dîr
, "%s:%d curl_multi_perform() failed, " \

267 (
Y
), (
Z
), ()
ec
, 
	`cuæ_mu…i_°ªº‹
(ec)); \

268 
ªs
 = ()
ec
; \

270 if(*((
B
)) < 0) { \

271 
	`Ârötf
(
°dîr
, "%s:%d curl_multi_perform() succeeded, " \

273 (
Y
), (
Z
), ()*((
B
))); \

274 
ªs
 = 
TEST_ERR_NUM_HANDLES
; \

276 } 
WHILE_FALSE


	)

278 
	#ªs_mu…i_≥rf‹m
(
A
,
B
) \

279 
	`exe_mu…i_≥rf‹m
((
A
),(
B
),(
__FILE__
),(
__LINE__
))

	)

281 
	#chk_mu…i_≥rf‹m
(
A
,
B
,
Y
,
Z
) do { \

282 
	`exe_mu…i_≥rf‹m
((
A
),(
B
),(
Y
),(
Z
)); \

283 if(
ªs
) \

284 
ã°_˛ónup
; \

285 } 
WHILE_FALSE


	)

287 
	#mu…i_≥rf‹m
(
A
,
B
) \

288 
	`chk_mu…i_≥rf‹m
((
A
),(
B
),(
__FILE__
),(
__LINE__
))

	)

292 
	#exe_mu…i_fd£t
(
A
,
B
,
C
,
D
,
E
,
Y
,
Z
) do { \

293 
CURLMcode
 
ec
; \

294 if((
ec
 = 
	`cuæ_mu…i_fd£t
((
A
),(
B
),(
C
),(
D
),(
E
))Ë!
CURLM_OK
) { \

295 
	`Ârötf
(
°dîr
, "%s:%d curl_multi_fdset() failed, " \

297 (
Y
), (
Z
), ()
ec
, 
	`cuæ_mu…i_°ªº‹
(ec)); \

298 
ªs
 = ()
ec
; \

300 if(*((
E
)) < -1) { \

301 
	`Ârötf
(
°dîr
, "%s:%d curl_multi_fdset() succeeded, " \

303 (
Y
), (
Z
), ()*((
E
))); \

304 
ªs
 = 
TEST_ERR_NUM_HANDLES
; \

306 } 
WHILE_FALSE


	)

308 
	#ªs_mu…i_fd£t
(
A
,
B
,
C
,
D
,
E
) \

309 
	`exe_mu…i_fd£t
((
A
),(
B
),(
C
),(
D
),(
E
),(
__FILE__
),(
__LINE__
))

	)

311 
	#chk_mu…i_fd£t
(
A
,
B
,
C
,
D
,
E
,
Y
,
Z
) do { \

312 
	`exe_mu…i_fd£t
((
A
),(
B
),(
C
),(
D
),(
E
),(
Y
),(
Z
)); \

313 if(
ªs
) \

314 
ã°_˛ónup
; \

315 } 
WHILE_FALSE


	)

317 
	#mu…i_fd£t
(
A
,
B
,
C
,
D
,
E
) \

318 
	`chk_mu…i_fd£t
((
A
),(
B
),(
C
),(
D
),(
E
),(
__FILE__
),(
__LINE__
))

	)

322 
	#exe_mu…i_timeout
(
A
,
B
,
Y
,
Z
) do { \

323 
CURLMcode
 
ec
; \

324 if((
ec
 = 
	`cuæ_mu…i_timeout
((
A
),(
B
))Ë!
CURLM_OK
) { \

325 
	`Ârötf
(
°dîr
, "%s:%d curl_multi_timeout() failed, " \

327 (
Y
), (
Z
), ()
ec
, 
	`cuæ_mu…i_°ªº‹
(ec)); \

328 
ªs
 = ()
ec
; \

330 if(*((
B
)) < -1L) { \

331 
	`Ârötf
(
°dîr
, "%s:%d curl_multi_timeout() succeeded, " \

333 (
Y
), (
Z
), ()*((
B
))); \

334 
ªs
 = 
TEST_ERR_BAD_TIMEOUT
; \

336 } 
WHILE_FALSE


	)

338 
	#ªs_mu…i_timeout
(
A
,
B
) \

339 
	`exe_mu…i_timeout
((
A
),(
B
),(
__FILE__
),(
__LINE__
))

	)

341 
	#chk_mu…i_timeout
(
A
,
B
,
Y
,
Z
) do { \

342 
	`exe_mu…i_timeout
((
A
),(
B
),(
Y
),(
Z
)); \

343 if(
ªs
) \

344 
ã°_˛ónup
; \

345 } 
WHILE_FALSE


	)

347 
	#mu…i_timeout
(
A
,
B
) \

348 
	`chk_mu…i_timeout
((
A
),(
B
),(
__FILE__
),(
__LINE__
))

	)

352 
	#exe_£À˘_ã°
(
A
,
B
,
C
,
D
,
E
,
Y
,
Z
) do { \

353 
ec
; \

354 if(
	`£À˘_wøµî
((
A
),(
B
),(
C
),(
D
),(
E
)) == -1 ) { \

355 
ec
 = 
SOCKERRNO
; \

356 
	`Ârötf
(
°dîr
, "%s:%d select() failed, with " \

358 (
Y
), (
Z
), 
ec
, 
	`°ªº‹
(ec)); \

359 
ªs
 = 
TEST_ERR_SELECT
; \

361 } 
WHILE_FALSE


	)

363 
	#ªs_£À˘_ã°
(
A
,
B
,
C
,
D
,
E
) \

364 
	`exe_£À˘_ã°
((
A
),(
B
),(
C
),(
D
),(
E
),(
__FILE__
),(
__LINE__
))

	)

366 
	#chk_£À˘_ã°
(
A
,
B
,
C
,
D
,
E
,
Y
,
Z
) do { \

367 
	`exe_£À˘_ã°
((
A
),(
B
),(
C
),(
D
),(
E
),(
Y
),(
Z
)); \

368 if(
ªs
) \

369 
ã°_˛ónup
; \

370 } 
WHILE_FALSE


	)

372 
	#£À˘_ã°
(
A
,
B
,
C
,
D
,
E
) \

373 
	`chk_£À˘_ã°
((
A
),(
B
),(
C
),(
D
),(
E
),(
__FILE__
),(
__LINE__
))

	)

377 
	#°¨t_ã°_timög
() do { \

378 
tv_ã°_°¨t
 = 
	`tutû_tvnow
(); \

379 } 
WHILE_FALSE


	)

381 
	#exe_ã°_timedout
(
Y
,
Z
) do { \

382 if(
	`tutû_tvdiff
(
	`tutû_tvnow
(), 
tv_ã°_°¨t
Ë> 
TEST_HANG_TIMEOUT
) { \

383 
	`Ârötf
(
°dîr
, "%s:%d ABORTING TEST, since it seems " \

384 "th© iàwould havêru¿f‹evî.\n", (
Y
), (
Z
)); \

385 
ªs
 = 
TEST_ERR_RUNS_FOREVER
; \

387 } 
WHILE_FALSE


	)

389 
	#ªs_ã°_timedout
() \

390 
	`exe_ã°_timedout
((
__FILE__
),(
__LINE__
))

	)

392 
	#chk_ã°_timedout
(
Y
,
Z
) do { \

393 
	`exe_ã°_timedout
(
Y
,
Z
); \

394 if(
ªs
) \

395 
ã°_˛ónup
; \

396 } 
WHILE_FALSE


	)

398 
	#ab‹t_⁄_ã°_timeout
() \

399 
	`chk_ã°_timedout
((
__FILE__
),(
__LINE__
))

	)

403 
	#exe_globÆ_öô
(
A
,
Y
,
Z
) do { \

404 
CURLcode
 
ec
; \

405 if((
ec
 = 
	`cuæ_globÆ_öô
((
A
))Ë!
CURLE_OK
) { \

406 
	`Ârötf
(
°dîr
, "%s:%d curl_global_init() failed, " \

408 (
Y
), (
Z
), ()
ec
, 
	`cuæ_ósy_°ªº‹
(ec)); \

409 
ªs
 = ()
ec
; \

411 } 
WHILE_FALSE


	)

413 
	#ªs_globÆ_öô
(
A
) \

414 
	`exe_globÆ_öô
((
A
),(
__FILE__
),(
__LINE__
))

	)

416 
	#chk_globÆ_öô
(
A
,
Y
,
Z
) do { \

417 
	`exe_globÆ_öô
((
A
),(
Y
),(
Z
)); \

418 if(
ªs
) \

419  
ªs
; \

420 } 
WHILE_FALSE


	)

425 
	#globÆ_öô
(
A
) \

426 
	`chk_globÆ_öô
((
A
),(
__FILE__
),(
__LINE__
))

	)

	@tests/libtest/testtrace.c

23 
	~"ã°.h
"

25 
	#_MPRINTF_REPLACE


	)

26 
	~<cuæ/m¥ötf.h
>

28 
	~"ã°utû.h
"

29 
	~"ã°åa˚.h
"

30 
	~"memdebug.h
"

32 
libã°_åa˚_cfg
 
	glibã°_debug_c⁄fig
;

34 
time_t
 
	gïoch_off£t
;

35 
	gknown_off£t
;

38 
	$libã°_debug_dump
(c⁄° *
timebuf
, c⁄° *
ãxt
, 
FILE
 *
°ªam
,

39 c⁄° *
±r
, 
size_t
 
size
, 
nohex
)

41 
size_t
 
i
;

42 
size_t
 
c
;

44 
width
 = 0x10;

46 if(
nohex
)

48 
width
 = 0x40;

50 
	`Ârötf
(
°ªam
, "%s%s, %d byã†(0x%x)\n", 
timebuf
, 
ãxt
,

51 ()
size
, ()size);

53 
i
 = 0; i < 
size
; i +
width
) {

55 
	`Ârötf
(
°ªam
, "%04x: ", ()
i
);

57 if(!
nohex
) {

59 
c
 = 0; c < 
width
; c++)

60 if(
i
+
c
 < 
size
)

61 
	`Ârötf
(
°ªam
, "%02x ", 
±r
[
i
+
c
]);

63 
	`Âuts
(" ", 
°ªam
);

66 
c
 = 0; (¯< 
width
Ë&& (
i
+¯< 
size
); c++) {

68 if(
nohex
 &&

69 (
i
+
c
+1 < 
size
Ë&& (
±r
[i+c] == 0x0D) && (ptr[i+c+1] == 0x0A)) {

70 
i
 +(
c
+2-
width
);

73 
	`Ârötf
(
°ªam
, "%c", ((
±r
[
i
+
c
] >= 0x20) && (ptr[i+c] < 0x80)) ?

74 
±r
[
i
+
c
] : '.');

76 if(
nohex
 &&

77 (
i
+
c
+2 < 
size
Ë&& (
±r
[i+c+1] == 0x0D) && (ptr[i+c+2] == 0x0A)) {

78 
i
 +(
c
+3-
width
);

82 
	`Âutc
('\n', 
°ªam
);

84 
	`fÊush
(
°ªam
);

85 
	}
}

87 
	$libã°_debug_cb
(
CURL
 *
h™dÀ
, 
cuæ_öfŸy≥
 
ty≥
,

88 *
d©a
, 
size_t
 
size
,

89 *
u£Ω
)

92 
libã°_åa˚_cfg
 *
åa˚_cfg
 = 
u£Ω
;

93 c⁄° *
ãxt
;

94 
timevÆ
 
tv
;

95 
tm
 *
now
;

96 
timebuf
[20];

97 *
time°r
;

98 
time_t
 
£cs
;

100 ()
h™dÀ
;

102 
timebuf
[0] = '\0';

103 
time°r
 = &
timebuf
[0];

105 if(
åa˚_cfg
->
åa˚time
) {

106 
tv
 = 
	`tutû_tvnow
();

107 if(!
known_off£t
) {

108 
ïoch_off£t
 = 
	`time
(
NULL
Ë- 
tv
.
tv_£c
;

109 
known_off£t
 = 1;

111 
£cs
 = 
ïoch_off£t
 + 
tv
.
tv_£c
;

112 
now
 = 
	`loˇ…ime
(&
£cs
);

113 
	`¢¥ötf
(
timebuf
, (timebuf), "%02d:%02d:%02d.%06ld ",

114 
now
->
tm_hour
,Çow->
tm_mö
,Çow->
tm_£c
, ()
tv
.
tv_u£c
);

117 
ty≥
) {

118 
CURLINFO_TEXT
:

119 
	`Ârötf
(
°dîr
, "%s=Info: %s", 
time°r
, (*)
d©a
);

123 
CURLINFO_HEADER_OUT
:

124 
ãxt
 = "=> Send header";

126 
CURLINFO_DATA_OUT
:

127 
ãxt
 = "=> Send data";

129 
CURLINFO_SSL_DATA_OUT
:

130 
ãxt
 = "=> Send SSL data";

132 
CURLINFO_HEADER_IN
:

133 
ãxt
 = "<= Recv header";

135 
CURLINFO_DATA_IN
:

136 
ãxt
 = "<= Recv data";

138 
CURLINFO_SSL_DATA_IN
:

139 
ãxt
 = "<= Recv SSL data";

143 
	`libã°_debug_dump
(
timebuf
, 
ãxt
, 
°dîr
, 
d©a
, 
size
, 
åa˚_cfg
->
nohex
);

145 
	}
}

	@tests/libtest/testtrace.h

1 #i‚de‡
HEADER_LIBTEST_TESTTRACE_H


2 
	#HEADER_LIBTEST_TESTTRACE_H


	)

25 
	slibã°_åa˚_cfg
 {

26 
	måa˚time
;

27 
	mnohex
;

30 
libã°_åa˚_cfg
 
libã°_debug_c⁄fig
;

32 
libã°_debug_cb
(
CURL
 *
h™dÀ
, 
cuæ_öfŸy≥
 
ty≥
,

33 *
d©a
, 
size_t
 
size
,

34 *
u£Ω
);

	@tests/libtest/testutil.c

22 
	~"cuæ_£tup.h
"

24 
	~"ã°utû.h
"

25 
	~"memdebug.h
"

27 #i‡
deföed
(
WIN32
Ë&& !deföed(
MSDOS
)

29 
timevÆ
 
	$tutû_tvnow
()

36 
timevÆ
 
now
;

37 
DWORD
 
mûli£c⁄ds
 = 
	`GëTickCou¡
();

38 
now
.
tv_£c
 = 
mûli£c⁄ds
 / 1000;

39 
now
.
tv_u£c
 = (
mûli£c⁄ds
 % 1000) * 1000;

40  
now
;

41 
	}
}

43 #ñi‡
deföed
(
HAVE_CLOCK_GETTIME_MONOTONIC
)

45 
timevÆ
 
	$tutû_tvnow
()

54 
timevÆ
 
now
;

55 
time•ec
 
t¢ow
;

56 if(0 =
	`˛ock_gëtime
(
CLOCK_MONOTONIC
, &
t¢ow
)) {

57 
now
.
tv_£c
 = 
t¢ow
.tv_sec;

58 
now
.
tv_u£c
 = 
t¢ow
.
tv_n£c
 / 1000;

65 #ifde‡
HAVE_GETTIMEOFDAY


67 ()
	`gëtimeofday
(&
now
, 
NULL
);

70 
now
.
tv_£c
 = ()
	`time
(
NULL
);

71 
now
.
tv_u£c
 = 0;

74  
now
;

75 
	}
}

77 #ñi‡
deföed
(
HAVE_GETTIMEOFDAY
)

79 
timevÆ
 
	$tutû_tvnow
()

86 
timevÆ
 
now
;

87 ()
	`gëtimeofday
(&
now
, 
NULL
);

88  
now
;

89 
	}
}

93 
timevÆ
 
	$tutû_tvnow
()

98 
timevÆ
 
now
;

99 
now
.
tv_£c
 = ()
	`time
(
NULL
);

100 
now
.
tv_u£c
 = 0;

101  
now
;

102 
	}
}

112 
	$tutû_tvdiff
(
timevÆ
 
√wî
, timevÆ 
ﬁdî
)

114  (
√wî
.
tv_£c
-
ﬁdî
.tv_sec)*1000+

115 (
√wî
.
tv_u£c
-
ﬁdî
.tv_usec)/1000;

116 
	}
}

123 
	$tutû_tvdiff_£cs
(
timevÆ
 
√wî
, timevÆ 
ﬁdî
)

125 if(
√wî
.
tv_£c
 !
ﬁdî
.tv_sec)

126  ()(
√wî
.
tv_£c
-
ﬁdî
.tv_sec)+

127 ()(
√wî
.
tv_u£c
-
ﬁdî
.tv_usec)/1000000.0;

129  ()(
√wî
.
tv_u£c
-
ﬁdî
.tv_usec)/1000000.0;

130 
	}
}

133 
	$tutû_tvl⁄g
(
timevÆ
 
t1
)

135  
t1
.
tv_£c
;

136 
	}
}

	@tests/libtest/testutil.h

1 #i‚de‡
HEADER_CURL_LIBTEST_TESTUTIL_H


2 
	#HEADER_CURL_LIBTEST_TESTUTIL_H


	)

24 
	~"cuæ_£tup.h
"

26 
timevÆ
 
tutû_tvnow
();

34 
tutû_tvdiff
(
timevÆ
 
t1
, timevÆ 
t2
);

41 
tutû_tvdiff_£cs
(
timevÆ
 
t1
, timevÆ 
t2
);

43 
tutû_tvl⁄g
(
timevÆ
 
t1
);

	@tests/server/fake_ntlm.c

23 
	~"£rvî_£tup.h
"

32 
	#ENABLE_CURLX_PRINTF


	)

33 
	~"cuæx.h
"

34 
	~"gë∑π.h
"

35 
	~"utû.h
"

38 
	~"memdebug.h
"

40 #i‚de‡
DEFAULT_LOGFILE


41 
	#DEFAULT_LOGFILE
 "log/Áke_¡lm.log"

	)

44 c⁄° *
	g£rvîlogfûe
 = 
DEFAULT_LOGFILE
;

50 *
	$¥öèbÀ
(*
öbuf
, 
size_t
 
öÀngth
)

52 *
outbuf
;

53 *
√wbuf
;

54 
size_t
 
√wsize
;

55 
size_t
 
outsize
;

56 
size_t
 
outö¸
 = 0;

57 
size_t
 
i
, 
o
 = 0;

59 
	#HEX_FMT_STR
 "[0x%02X]"

	)

60 
	#HEX_STR_LEN
 6

	)

61 
	#NOTHING_STR
 "[NOTHING]"

	)

62 
	#NOTHING_LEN
 9

	)

64 if(!
öÀngth
)

65 
öÀngth
 = 
	`°æí
(
öbuf
);

67 if(
öÀngth
) {

68 
outö¸
 = ((
öÀngth
/2Ë< (
HEX_STR_LEN
+1)) ? HEX_STR_LEN+1 : inlength/2;

69 
outsize
 = 
öÀngth
 + 
outö¸
;

72 
outsize
 = 
NOTHING_LEN
 + 1;

74 
outbuf
 = 
	`mÆloc
(
outsize
);

75 if(!
outbuf
)

76  
NULL
;

78 if(!
öÀngth
) {

79 
	`•rötf
(&
outbuf
[0], "%s", 
NOTHING_STR
);

80  
outbuf
;

83 
i
=0; i<
öÀngth
; i++) {

85 if(
o
 > 
outsize
 - (
HEX_STR_LEN
 + 1)) {

86 
√wsize
 = 
outsize
 + 
outö¸
;

87 
√wbuf
 = 
	`ªÆloc
(
outbuf
, 
√wsize
);

88 if(!
√wbuf
) {

89 
	`‰ì
(
outbuf
);

90  
NULL
;

92 
outbuf
 = 
√wbuf
;

93 
outsize
 = 
√wsize
;

96 if((
öbuf
[
i
] > 0x20) && (inbuf[i] < 0x7F)) {

97 
outbuf
[
o
] = 
öbuf
[
i
];

98 
o
++;

101 
	`•rötf
(&
outbuf
[
o
], 
HEX_FMT_STR
, 
öbuf
[
i
]);

102 
o
 +
HEX_STR_LEN
;

106 
outbuf
[
o
] = '\0';

108  
outbuf
;

109 
	}
}

111 
	$maö
(
¨gc
, *
¨gv
[])

113 
buf
[1024];

114 
FILE
 *
°ªam
;

115 *
fûíame
;

116 
îr‹
;

117 *
ty≥1_öput
 = 
NULL
, *
ty≥3_öput
 = NULL;

118 *
ty≥1_ouçut
 = 
NULL
, *
ty≥3_ouçut
 = NULL;

119 
size_t
 
size
 = 0;

120 
ã°num
;

121 c⁄° *
ív
;

122 
¨g
 = 1;

123 *
hñ≥r_u£r
 = (*)"unknown";

124 *
hñ≥r_¥Ÿo
 = (*)"unknown";

125 *
hñ≥r_domaö
 = (*)"unknown";

126 
boﬁ
 
u£_ˇched_¸eds
 = 
FALSE
;

127 *
msgbuf
;

129 
buf
[0] = '\0';

131 
¨gc
 > 
¨g
) {

132 if(!
	`°rcmp
("--u£-ˇched-¸eds", 
¨gv
[
¨g
])) {

133 
u£_ˇched_¸eds
 = 
TRUE
;

134 
¨g
++;

136 if(!
	`°rcmp
("--hñ≥r-¥Ÿocﬁ", 
¨gv
[
¨g
])) {

137 
¨g
++;

138 if(
¨gc
 > 
¨g
)

139 
hñ≥r_¥Ÿo
 = 
¨gv
[
¨g
++];

141 if(!
	`°rcmp
("--u£∫ame", 
¨gv
[
¨g
])) {

142 
¨g
++;

143 if(
¨gc
 > 
¨g
)

144 
hñ≥r_u£r
 = 
¨gv
[
¨g
++];

146 if(!
	`°rcmp
("--domaö", 
¨gv
[
¨g
])) {

147 
¨g
++;

148 if(
¨gc
 > 
¨g
)

149 
hñ≥r_domaö
 = 
¨gv
[
¨g
++];

152 
	`puts
("Usage: fake_ntlm [option]\n"

157 
	`exô
(1);

161 
	`logmsg
("fake_ntlm (user: %s) (proto: %s) (domain: %s) (cached creds: %s)",

162 
hñ≥r_u£r
, 
hñ≥r_¥Ÿo
, 
hñ≥r_domaö
,

163 (
u£_ˇched_¸eds
) ? "yes" : "no");

165 
ív
 = 
	`gëív
("CURL_NTLM_AUTH_TESTNUM");

166 i‡(
ív
) {

167 *
íd±r
;

168 
 um
 = 
	`°πﬁ
(
ív
, &
íd±r
, 10);

169 if((
íd±r
 !
ív
 + 
	`°æí
”nv)Ë|| (
 um
 < 1L)) {

170 
	`logmsg
("TestÇumberÇot valid in CURL_NTLM_AUTH_TESTNUM");

171 
	`exô
(1);

173 
ã°num
 = 
 um
;

175 
	`logmsg
("TestÇumberÇot specified in CURL_NTLM_AUTH_TESTNUM");

176 
	`exô
(1);

179 
ív
 = 
	`gëív
("CURL_NTLM_AUTH_SRCDIR");

180 i‡(
ív
) {

181 
∑th
 = 
ív
;

184 
fûíame
 = 
	`ã°2fûe
(
ã°num
);

185 
°ªam
=
	`f›í
(
fûíame
, "rb");

186 if(!
°ªam
) {

187 
îr‹
 = 
î∫o
;

188 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

189 
	`logmsg
("Eº‹ o≥nög fûe: %s", 
fûíame
);

190 
	`logmsg
("Couldn'à›íÅe° fûê%ld", 
ã°num
);

191 
	`exô
(1);

195 
îr‹
 = 
	`gë∑π
(&
ty≥1_öput
, &
size
, "¡lm_auth_ty≥1", "öput", 
°ªam
);

196 
	`f˛o£
(
°ªam
);

197 if(
îr‹
 || 
size
 == 0) {

198 
	`logmsg
("gë∑π(Ëty≥ 1 i≈uàÁûed wôhÉº‹: %d", 
îr‹
);

199 
	`exô
(1);

203 
°ªam
=
	`f›í
(
fûíame
, "rb");

204 if(!
°ªam
) {

205 
îr‹
 = 
î∫o
;

206 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

207 
	`logmsg
("Eº‹ o≥nög fûe: %s", 
fûíame
);

208 
	`logmsg
("Couldn'à›íÅe° fûê%ld", 
ã°num
);

209 
	`exô
(1);

212 
size
 = 0;

213 
îr‹
 = 
	`gë∑π
(&
ty≥3_öput
, &
size
, "¡lm_auth_ty≥3", "öput", 
°ªam
);

214 
	`f˛o£
(
°ªam
);

215 if(
îr‹
 || 
size
 == 0) {

216 
	`logmsg
("gë∑π(Ëty≥ 3 i≈uàÁûed wôhÉº‹: %d", 
îr‹
);

217 
	`exô
(1);

221 
	`fgës
(
buf
, (buf), 
°dö
)) {

222 if(
	`°rcmp
(
buf
, 
ty≥1_öput
) == 0) {

223 
°ªam
=
	`f›í
(
fûíame
, "rb");

224 if(!
°ªam
) {

225 
îr‹
 = 
î∫o
;

226 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

227 
	`logmsg
("Eº‹ o≥nög fûe: %s", 
fûíame
);

228 
	`logmsg
("Couldn'à›íÅe° fûê%ld", 
ã°num
);

229 
	`exô
(1);

232 
size
 = 0;

233 
îr‹
 = 
	`gë∑π
(&
ty≥1_ouçut
, &
size
, "¡lm_auth_ty≥1", "ouçut", 
°ªam
);

234 
	`f˛o£
(
°ªam
);

235 if(
îr‹
 || 
size
 == 0) {

236 
	`logmsg
("gë∑π(Ëty≥ 1 ouçuàÁûed wôhÉº‹: %d", 
îr‹
);

237 
	`exô
(1);

240 
	`¥ötf
("%s", 
ty≥1_ouçut
);

241 
	`fÊush
(
°dout
);

243 if(
	`°∫cmp
(
buf
, 
ty≥3_öput
, 
	`°æí
(type3_input)) == 0) {

244 
°ªam
=
	`f›í
(
fûíame
, "rb");

245 if(!
°ªam
) {

246 
îr‹
 = 
î∫o
;

247 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

248 
	`logmsg
("Eº‹ o≥nög fûe: %s", 
fûíame
);

249 
	`logmsg
("Couldn'à›íÅe° fûê%ld", 
ã°num
);

250 
	`exô
(1);

253 
size
 = 0;

254 
îr‹
 = 
	`gë∑π
(&
ty≥3_ouçut
, &
size
, "¡lm_auth_ty≥3", "ouçut", 
°ªam
);

255 
	`f˛o£
(
°ªam
);

256 if(
îr‹
 || 
size
 == 0) {

257 
	`logmsg
("gë∑π(Ëty≥ 3 ouçuàÁûed wôhÉº‹: %d", 
îr‹
);

258 
	`exô
(1);

261 
	`¥ötf
("%s", 
ty≥3_ouçut
);

262 
	`fÊush
(
°dout
);

265 
	`¥ötf
("UnknownÑequest\n");

266 
msgbuf
 = 
	`¥öèbÀ
(
buf
, 0);

267 if(
msgbuf
) {

268 
	`logmsg
("övÆid i≈ut: '%s'\n", 
msgbuf
);

269 
	`‰ì
(
msgbuf
);

272 
	`logmsg
("OOM f‹m©tög invÆid i≈ut: '%s'\n", 
buf
);

273 
	`exô
(1);

277 
	}
}

	@tests/server/getpart.c

22 
	~"£rvî_£tup.h
"

24 
	~"gë∑π.h
"

26 
	#ENABLE_CURLX_PRINTF


	)

29 
	~"cuæx.h
"

32 
	sSessi⁄H™dÀ
 {

33 
	mÁke
;

36 
	~"cuæ_ba£64.h
"

37 
	~"cuæ_mem‹y.h
"

40 
	~"memdebug.h
"

42 
	#EAT_SPACE
(
p
Ë*’Ë&& 
	`ISSPACE
(*’))Ë’)++

	)

44 
	#EAT_WORD
(
p
Ë*’Ë&& !
	`ISSPACE
(*’)Ë&& ('>' !*’))Ë’)++

	)

46 #ifde‡
DEBUG_GETPART


47 
	#show
(
x
Ë
¥ötf
 
	)
x

49 
	#show
(
x
Ë
Cuæ_n›_°mt


	)

52 #i‡
deföed
(
_MSC_VER
Ë&& deföed(
_DLL
)

53 #¥agm®
w¨nög
(
dißbÀ
:4232)

56 
cuæ_mÆloc_ˇŒback
 
	gCuæ_cmÆloc
 = (cuæ_mÆloc_ˇŒback)
mÆloc
;

57 
cuæ_‰ì_ˇŒback
 
	gCuæ_c‰ì
 = (cuæ_‰ì_ˇŒback)
‰ì
;

58 
cuæ_ªÆloc_ˇŒback
 
	gCuæ_¸óŒoc
 = (cuæ_ªÆloc_ˇŒback)
ªÆloc
;

59 
cuæ_°rdup_ˇŒback
 
	gCuæ_c°rdup
 = (cuæ_°rdup_ˇŒback)
°rdup
;

60 
cuæ_ˇŒoc_ˇŒback
 
	gCuæ_cˇŒoc
 = (cuæ_ˇŒoc_ˇŒback)
ˇŒoc
;

61 #i‡
deföed
(
WIN32
Ë&& deföed(
UNICODE
)

62 
cuæ_wcsdup_ˇŒback
 
	gCuæ_cwcsdup
 = (cuæ_wcsdup_ˇŒback)
_wcsdup
;

65 #i‡
deföed
(
_MSC_VER
Ë&& deföed(
_DLL
)

66 #¥agm®
w¨nög
(:4232)

87 
	$ªadlöe
(**
buf„r
, 
size_t
 *
bufsize
, 
FILE
 *
°ªam
)

89 
size_t
 
off£t
 = 0;

90 
size_t
 
Àngth
;

91 *
√w±r
;

93 if(!*
buf„r
) {

94 *
buf„r
 = 
	`mÆloc
(128);

95 if(!*
buf„r
)

96  
GPE_OUT_OF_MEMORY
;

97 *
bufsize
 = 128;

101 
byã°‹ód
 = 
	`cuæx_uztosi
(*
bufsize
 - 
off£t
);

103 if(!
	`fgës
(*
buf„r
 + 
off£t
, 
byã°‹ód
, 
°ªam
))

104  (
off£t
 !0Ë? 
GPE_OK
 : 
GPE_END_OF_FILE
 ;

106 
Àngth
 = 
off£t
 + 
	`°æí
(*
buf„r
 + offset);

107 if(*(*
buf„r
 + 
Àngth
 - 1) == '\n')

109 
off£t
 = 
Àngth
;

110 if(
Àngth
 < *
bufsize
 - 1)

113 
√w±r
 = 
	`ªÆloc
(*
buf„r
, *
bufsize
 * 2);

114 if(!
√w±r
)

115  
GPE_OUT_OF_MEMORY
;

116 *
buf„r
 = 
√w±r
;

117 *
bufsize
 *= 2;

120  
GPE_OK
;

121 
	}
}

149 
	$≠≥ndd©a
(**
d°_buf
,

150 
size_t
 *
d°_Àn
,

151 
size_t
 *
d°_Æloc
,

152 *
§c_buf
,

153 
§c_b64
)

155 
size_t
 
√ed_Æloc
 = 0;

156 
size_t
 
§c_Àn
 = 
	`°æí
(
§c_buf
);

158 if(!
§c_Àn
)

159  
GPE_OK
;

161 
√ed_Æloc
 = 
§c_Àn
 + *
d°_Àn
 + 1;

163 if(
§c_b64
) {

164 if(
§c_buf
[
§c_Àn
 - 1] == '\r')

165 
§c_Àn
--;

167 if(
§c_buf
[
§c_Àn
 - 1] == '\n')

168 
§c_Àn
--;

172 if(
√ed_Æloc
 > *
d°_Æloc
) {

173 
size_t
 
√wsize
 = 
√ed_Æloc
 * 2;

174 *
√w±r
 = 
	`ªÆloc
(*
d°_buf
, 
√wsize
);

175 if(!
√w±r
) {

176  
GPE_OUT_OF_MEMORY
;

178 *
d°_Æloc
 = 
√wsize
;

179 *
d°_buf
 = 
√w±r
;

183 
	`mem˝y
(*
d°_buf
 + *
d°_Àn
, 
§c_buf
, 
§c_Àn
);

184 *
d°_Àn
 +
§c_Àn
;

185 *(*
d°_buf
 + *
d°_Àn
) = '\0';

187  
GPE_OK
;

188 
	}
}

190 
	$decoded©a
(**
buf
,

191 
size_t
 *
Àn
)

193 
îr‹
 = 0;

194 *
buf64
 = 
NULL
;

195 
size_t
 
§c_Àn
 = 0;

197 if(!*
Àn
)

198  
GPE_OK
;

201 
îr‹
 = (Ë
	`Cuæ_ba£64_decode
(*
buf
, &
buf64
, &
§c_Àn
);

202 if(
îr‹
)

203  
GPE_OUT_OF_MEMORY
;

205 if(!
§c_Àn
) {

212 if(
buf64
)

213 
	`‰ì
(
buf64
);

215  
GPE_OUT_OF_MEMORY
;

219 
	`mem˝y
(*
buf
, 
buf64
, 
§c_Àn
);

220 *
Àn
 = 
§c_Àn
;

221 *(*
buf
 + 
§c_Àn
) = '\0';

223 
	`‰ì
(
buf64
);

225  
GPE_OK
;

226 
	}
}

250 
	$gë∑π
(**
outbuf
, 
size_t
 *
ouéí
,

251 c⁄° *
maö
, c⁄° *
sub
, 
FILE
 *
°ªam
)

253 
	#MAX_TAG_LEN
 79

	)

254 
couãr
[
MAX_TAG_LEN
+1];

255 
cmaö
[
MAX_TAG_LEN
+1];

256 
csub
[
MAX_TAG_LEN
+1];

257 
±ag
[
MAX_TAG_LEN
+1];

258 
∑â
[
MAX_TAG_LEN
+1];

259 *
buf„r
 = 
NULL
;

260 *
±r
;

261 *
íd
;

263 
ssize_t
 
sig
;

264 
size_t
 
uns
;

265 } 
Àn
;

266 
size_t
 
bufsize
 = 0;

267 
size_t
 
ouèŒoc
 = 256;

268 
ö_w™ãd_∑π
 = 0;

269 
ba£64
 = 0;

270 
îr‹
;

273 
STATE_OUTSIDE
 = 0,

274 
STATE_OUTER
 = 1,

275 
STATE_INMAIN
 = 2,

276 
STATE_INSUB
 = 3,

277 
STATE_ILLEGAL
 = 4

278 } 
°©e
 = 
STATE_OUTSIDE
;

280 *
ouéí
 = 0;

281 *
outbuf
 = 
	`mÆloc
(
ouèŒoc
);

282 if(!*
outbuf
)

283  
GPE_OUT_OF_MEMORY
;

284 *(*
outbuf
) = '\0';

286 
couãr
[0] = 
cmaö
[0] = 
csub
[0] = 
±ag
[0] = 
∑â
[0] = '\0';

288 (
îr‹
 = 
	`ªadlöe
(&
buf„r
, &
bufsize
, 
°ªam
)Ë=
GPE_OK
) {

290 
±r
 = 
buf„r
;

291 
	`EAT_SPACE
(
±r
);

293 if('<' !*
±r
) {

294 if(
ö_w™ãd_∑π
) {

295 
	`show
(("=> %s", 
buf„r
));

296 
îr‹
 = 
	`≠≥ndd©a
(
outbuf
, 
ouéí
, &
ouèŒoc
, 
buf„r
, 
ba£64
);

297 if(
îr‹
)

303 
±r
++;

305 if('/' =*
±r
) {

310 
±r
++;

311 
íd
 = 
±r
;

312 
	`EAT_WORD
(
íd
);

313 if((
Àn
.
sig
 = 
íd
 - 
±r
Ë> 
MAX_TAG_LEN
) {

314 
îr‹
 = 
GPE_NO_BUFFER_SPACE
;

317 
	`mem˝y
(
±ag
, 
±r
, 
Àn
.
uns
);

318 
±ag
[
Àn
.
uns
] = '\0';

320 if((
STATE_INSUB
 =
°©e
Ë&& !
	`°rcmp
(
csub
, 
±ag
)) {

322 
°©e
 = 
STATE_INMAIN
;

323 
csub
[0] = '\0';

324 if(
ö_w™ãd_∑π
) {

326 
ö_w™ãd_∑π
 = 0;

329 if(
ba£64
) {

330 
îr‹
 = 
	`decoded©a
(
outbuf
, 
ouéí
);

331 if(
îr‹
)

332  
îr‹
;

337 if((
STATE_INMAIN
 =
°©e
Ë&& !
	`°rcmp
(
cmaö
, 
±ag
)) {

339 
°©e
 = 
STATE_OUTER
;

340 
cmaö
[0] = '\0';

341 if(
ö_w™ãd_∑π
) {

343 
ö_w™ãd_∑π
 = 0;

346 if(
ba£64
) {

347 
îr‹
 = 
	`decoded©a
(
outbuf
, 
ouéí
);

348 if(
îr‹
)

349  
îr‹
;

354 if((
STATE_OUTER
 =
°©e
Ë&& !
	`°rcmp
(
couãr
, 
±ag
)) {

356 
°©e
 = 
STATE_OUTSIDE
;

357 
couãr
[0] = '\0';

358 if(
ö_w™ãd_∑π
) {

360 
ö_w™ãd_∑π
 = 0;

366 if(!
ö_w™ãd_∑π
) {

372 
íd
 = 
±r
;

373 
	`EAT_WORD
(
íd
);

374 if((
Àn
.
sig
 = 
íd
 - 
±r
Ë> 
MAX_TAG_LEN
) {

375 
îr‹
 = 
GPE_NO_BUFFER_SPACE
;

378 
	`mem˝y
(
±ag
, 
±r
, 
Àn
.
uns
);

379 
±ag
[
Àn
.
uns
] = '\0';

382 if(('!' =
±ag
[0]) || ('?' ==Ötag[0])) {

383 
	`show
(("* ign‹ög (%s)", 
buf„r
));

388 
±r
 = 
íd
;

389 
	`EAT_SPACE
(
±r
);

390 
íd
 = 
±r
;

391 *
íd
 && ('>' != *end))

392 
íd
++;

393 if((
Àn
.
sig
 = 
íd
 - 
±r
Ë> 
MAX_TAG_LEN
) {

394 
îr‹
 = 
GPE_NO_BUFFER_SPACE
;

397 
	`mem˝y
(
∑â
, 
±r
, 
Àn
.
uns
);

398 
∑â
[
Àn
.
uns
] = '\0';

400 if(
STATE_OUTSIDE
 =
°©e
) {

402 
	`°r˝y
(
couãr
, 
±ag
);

403 
°©e
 = 
STATE_OUTER
;

406 if(
STATE_OUTER
 =
°©e
) {

408 
	`°r˝y
(
cmaö
, 
±ag
);

409 
°©e
 = 
STATE_INMAIN
;

412 if(
STATE_INMAIN
 =
°©e
) {

414 
	`°r˝y
(
csub
, 
±ag
);

415 
°©e
 = 
STATE_INSUB
;

416 if(!
	`°rcmp
(
cmaö
, 
maö
Ë&& !°rcmp(
csub
, 
sub
)) {

418 
ö_w™ãd_∑π
 = 1;

419 if(
	`°r°r
(
∑â
, "base64="))

422 
ba£64
 = 1;

429 if(
ö_w™ãd_∑π
) {

430 
	`show
(("=> %s", 
buf„r
));

431 
îr‹
 = 
	`≠≥ndd©a
(
outbuf
, 
ouéí
, &
ouèŒoc
, 
buf„r
, 
ba£64
);

432 if(
îr‹
)

438 if(
buf„r
)

439 
	`‰ì
(
buf„r
);

441 if(
îr‹
 !
GPE_OK
) {

442 if(
îr‹
 =
GPE_END_OF_FILE
)

443 
îr‹
 = 
GPE_OK
;

445 if(*
outbuf
)

446 
	`‰ì
(*
outbuf
);

447 *
outbuf
 = 
NULL
;

448 *
ouéí
 = 0;

452  
îr‹
;

453 
	}
}

	@tests/server/getpart.h

1 #i‚de‡
HEADER_CURL_SERVER_GETPART_H


2 
	#HEADER_CURL_SERVER_GETPART_H


	)

24 
	~"£rvî_£tup.h
"

26 
	#GPE_NO_BUFFER_SPACE
 -2

	)

27 
	#GPE_OUT_OF_MEMORY
 -1

	)

28 
	#GPE_OK
 0

	)

29 
	#GPE_END_OF_FILE
 1

	)

31 
gë∑π
(**
outbuf
, 
size_t
 *
ouéí
,

32 c⁄° *
maö
, c⁄° *
sub
, 
FILE
 *
°ªam
);

	@tests/server/resolve.c

22 
	~"£rvî_£tup.h
"

34 #ifde‡
HAVE_SIGNAL_H


35 
	~<sig«l.h
>

37 #ifde‡
HAVE_NETINET_IN_H


38 
	~<√töë/ö.h
>

40 #ifde‡
_XOPEN_SOURCE_EXTENDED


42 
	~<¨∑/öë.h
>

44 #ifde‡
HAVE_NETDB_H


45 
	~<√tdb.h
>

48 
	#ENABLE_CURLX_PRINTF


	)

51 
	~"cuæx.h
"

52 
	~"utû.h
"

55 
	~"memdebug.h
"

57 
boﬁ
 
	gu£_ùv6
 = 
FALSE
;

58 c⁄° *
	gùv_öu£
 = "IPv4";

60 c⁄° *
	g£rvîlogfûe
="";

62 
	$maö
(
¨gc
, *
¨gv
[])

64 
¨g
=1;

65 c⁄° *
ho°
 = 
NULL
;

66 
rc
 = 0;

68 
¨gc
>
¨g
) {

69 if(!
	`°rcmp
("--vîsi⁄", 
¨gv
[
¨g
])) {

70 
	`¥ötf
("resolve IPv4%s\n",

71 #ifde‡
ENABLE_IPV6


79 if(!
	`°rcmp
("--ùv6", 
¨gv
[
¨g
])) {

80 
ùv_öu£
 = "IPv6";

81 
u£_ùv6
 = 
TRUE
;

82 
¨g
++;

84 if(!
	`°rcmp
("--ùv4", 
¨gv
[
¨g
])) {

86 
ùv_öu£
 = "IPv4";

87 
u£_ùv6
 = 
FALSE
;

88 
¨g
++;

91 
ho°
 = 
¨gv
[
¨g
++];

94 if(!
ho°
) {

95 
	`puts
("Usage:Ñesolve [option] <host>\n"

98 #ifde‡
ENABLE_IPV6


105 #ifde‡
WIN32


106 
	`wö32_öô
();

107 
	`©exô
(
wö32_˛ónup
);

110 if(!
u£_ùv6
) {

112 
ho°ít
 *
he
;

114 
he
 = 
	`gëho°by«me
(
ho°
);

116 
rc
 = !
he
;

119 #ifde‡
ENABLE_IPV6


121 
cuæ_sockë_t
 
s
 = 
	`sockë
(
PF_INET6
, 
SOCK_DGRAM
, 0);

122 if(
s
 =
CURL_SOCKET_BAD
)

124 
rc
 = -1;

126 
	`s˛o£
(
s
);

129 i‡(
rc
 == 0) {

131 
addröfo
 *
ai
;

132 
addröfo
 
höts
;

134 
	`mem£t
(&
höts
, 0, (hints));

135 
höts
.
ai_Ámûy
 = 
PF_INET6
;

136 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

137 
höts
.
ai_Êags
 = 
AI_CANONNAME
;

140 
rc
 = (
gëaddröfo
)(
ho°
, "80", &
höts
, &
ai
);

144 
	`puts
("IPv6 support has been disabled inÅhisÖrogram");

148 if(
rc
)

149 
	`¥ötf
("Resﬁvög %†'%s' didn'àw‹k\n", 
ùv_öu£
, 
ho°
);

151  !!
rc
;

152 
	}
}

	@tests/server/rtspd.c

22 
	~"£rvî_£tup.h
"

30 #ifde‡
HAVE_SIGNAL_H


31 
	~<sig«l.h
>

33 #ifde‡
HAVE_NETINET_IN_H


34 
	~<√töë/ö.h
>

36 #ifde‡
HAVE_ARPA_INET_H


37 
	~<¨∑/öë.h
>

39 #ifde‡
HAVE_NETDB_H


40 
	~<√tdb.h
>

42 #ifde‡
HAVE_NETINET_TCP_H


43 
	~<√töë/t˝.h
>

46 
	#ENABLE_CURLX_PRINTF


	)

49 
	~"cuæx.h
"

50 
	~"gë∑π.h
"

51 
	~"utû.h
"

52 
	~"£rvî_sockaddr.h
"

55 
	~"memdebug.h
"

57 #ifde‡
USE_WINSOCK


58 #unde‡
EINTR


59 
	#EINTR
 4

	)

60 #unde‡
ERANGE


61 
	#ERANGE
 34

	)

64 #ifde‡
ENABLE_IPV6


65 
boﬁ
 
	gu£_ùv6
 = 
FALSE
;

67 c⁄° *
	gùv_öu£
 = "IPv4";

68 
	g£rvîlog¶ocked
 = 0;

70 
	#REQBUFSIZ
 150000

	)

71 
	#REQBUFSIZ_TXT
 "149999"

	)

73 
	g¥evã°no
=-1;

74 
	g¥ev∑πno
=-1;

75 
boﬁ
 
	g¥evboun˚
=
FALSE
;

79 
	#RCMD_NORMALREQ
 0

	)

80 
	#RCMD_IDLE
 1

	)

81 
	#RCMD_STREAM
 2

	)

84 
	mRPROT_NONE
 = 0,

85 
	mRPROT_RTSP
 = 1,

86 
	mRPROT_HTTP
 = 2

87 } 
	tªq¥Ÿ_t
;

89 
	#SET_RTP_PKT_CHN
(
p
,
c
Ë(’)[1] = ()((cË& 0xFF))

	)

91 
	#SET_RTP_PKT_LEN
(
p
,
l
) (((p)[2] = ()(((l) >> 8) & 0xFF)), \

92 ((
p
)[3] = ()((
l
Ë& 0xFF)))

	)

94 
	shâ¥eque°
 {

95 
	mªqbuf
[
REQBUFSIZ
];

96 
size_t
 
	mchecködex
;

97 
size_t
 
	moff£t
;

98 
	mã°no
;

99 
	m∑πno
;

100 
boﬁ
 
	m›í
;

101 
boﬁ
 
	mauth_ªq
;

103 
boﬁ
 
	mauth
;

104 
size_t
 
	m˛
;

105 
boﬁ
 
	mdige°
;

106 
boﬁ
 
	m¡lm
;

107 
	mpùe
;

109 
	mskù
;

113 
	mrcmd
;

114 
ªq¥Ÿ_t
 
	m¥Ÿocﬁ
;

115 
	m¥Ÿ_vîsi⁄
;

116 
boﬁ
 
	mpùñöög
;

117 *
	mπp_buf„r
;

118 
size_t
 
	mπp_buf„rsize
;

121 
Pro˚ssReque°
(
hâ¥eque°
 *
ªq
);

122 
°‹îeque°
(*
ªqbuf
, 
size_t
 
tŸÆsize
);

124 
	#DEFAULT_PORT
 8999

	)

126 #i‚de‡
DEFAULT_LOGFILE


127 
	#DEFAULT_LOGFILE
 "log/π•d.log"

	)

130 c⁄° *
	g£rvîlogfûe
 = 
DEFAULT_LOGFILE
;

132 
	#RTSPDVERSION
 "cURLÅe° suôêRTSP sîvî/0.1"

	)

134 
	#REQUEST_DUMP
 "log/£rvî.öput"

	)

135 
	#RESPONSE_DUMP
 "log/£rvî.ª•⁄£"

	)

138 
	#MAXDOCNAMELEN
 140000

	)

139 
	#MAXDOCNAMELEN_TXT
 "139999"

	)

141 
	#REQUEST_KEYWORD_SIZE
 256

	)

142 
	#REQUEST_KEYWORD_SIZE_TXT
 "255"

	)

144 
	#CMD_AUTH_REQUIRED
 "auth_ªquúed"

	)

148 
	#CMD_IDLE
 "idÀ"

	)

151 
	#CMD_STREAM
 "°ªam"

	)

153 
	#END_OF_HEADERS
 "\r\n\r\n"

	)

156 
	mDOCNUMBER_NOTHING
 = -7,

157 
	mDOCNUMBER_QUIT
 = -6,

158 
	mDOCNUMBER_BADCONNECT
 = -5,

159 
	mDOCNUMBER_INTERNAL
= -4,

160 
	mDOCNUMBER_CONNECT
 = -3,

161 
	mDOCNUMBER_WERULEZ
 = -2,

162 
	mDOCNUMBER_404
 = -1

167 c⁄° *
	gdocquô
 =

168 "HTTP/1.1 200 Goodbye" 
END_OF_HEADERS
;

171 c⁄° *
	gdocc⁄√˘
 =

172 "HTTP/1.1 200 Mighty föêödìd" 
END_OF_HEADERS
;

175 c⁄° *
	gdocbadc⁄√˘
 =

176 "HTTP/1.1 501 F‹biddí you foﬁ" 
END_OF_HEADERS
;

179 c⁄° *
	gdoc404_HTTP
 = "HTTP/1.1 404 Not Found\r\n"

180 "Sîvî: " 
RTSPDVERSION
 "\r\n"

183 
END_OF_HEADERS


190 "<P><HR><ADDRESS>" 
RTSPDVERSION
 "</ADDRESS>\n" "</BODY></HTML>\n";

193 c⁄° *
	gdoc404_RTSP
 = "RTSP/1.0 404 Not Found\r\n"

194 "Sîvî: " 
RTSPDVERSION


195 
END_OF_HEADERS
;

198 
	#RTP_DATA_SIZE
 12

	)

199 c⁄° *
	gRTP_DATA
 = "$_1234\n\0asdf";

203 #i‚de‡
HAVE_SIGINTERRUPT


204 
	#sigöãºu±
(
x
,
y
Ëdÿ{} 0)

	)

209 
	$RETSIGTYPE
 (*
	tSIGHANDLER_T
)();

211 #ifde‡
SIGHUP


212 
SIGHANDLER_T
 
ﬁd_sighup_h™dÀr
 = 
SIG_ERR
;

215 #ifde‡
SIGPIPE


216 
SIGHANDLER_T
 
ﬁd_sigpùe_h™dÀr
 = 
SIG_ERR
;

219 #ifde‡
SIGALRM


220 
SIGHANDLER_T
 
ﬁd_sigÆrm_h™dÀr
 = 
SIG_ERR
;

223 #ifde‡
SIGINT


224 
SIGHANDLER_T
 
ﬁd_sigöt_h™dÀr
 = 
SIG_ERR
;

227 #ifde‡
SIGTERM


228 
SIGHANDLER_T
 
ﬁd_sigãrm_h™dÀr
 = 
SIG_ERR
;

231 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

232 
SIGHANDLER_T
 
ﬁd_sigbªak_h™dÀr
 = 
SIG_ERR
;

237 
SIG_ATOMIC_T
 
gŸ_exô_sig«l
 = 0;

241 vﬁ©ûê
exô_sig«l
 = 0;

248 
RETSIGTYPE
 
	$exô_sig«l_h™dÀr
(
signum
)

250 
ﬁd_î∫o
 = 
î∫o
;

251 if(
gŸ_exô_sig«l
 == 0) {

252 
gŸ_exô_sig«l
 = 1;

253 
exô_sig«l
 = 
signum
;

255 ()
	`sig«l
(
signum
, 
exô_sig«l_h™dÀr
);

256 
î∫o
 = 
ﬁd_î∫o
;

257 
	}
}

259 
	$ö°Æl_sig«l_h™dÀrs
()

261 #ifde‡
SIGHUP


263 if((
ﬁd_sighup_h™dÀr
 = 
	`sig«l
(
SIGHUP
, 
SIG_IGN
)Ë=
SIG_ERR
)

264 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGHUP h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

266 #ifde‡
SIGPIPE


268 if((
ﬁd_sigpùe_h™dÀr
 = 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
)Ë=
SIG_ERR
)

269 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGPIPE h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

271 #ifde‡
SIGALRM


273 if((
ﬁd_sigÆrm_h™dÀr
 = 
	`sig«l
(
SIGALRM
, 
SIG_IGN
)Ë=
SIG_ERR
)

274 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGALRM h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

276 #ifde‡
SIGINT


278 if((
ﬁd_sigöt_h™dÀr
 = 
	`sig«l
(
SIGINT
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

279 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGINT h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

281 
	`sigöãºu±
(
SIGINT
, 1);

283 #ifde‡
SIGTERM


285 if((
ﬁd_sigãrm_h™dÀr
 = 
	`sig«l
(
SIGTERM
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

286 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGTERM h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

288 
	`sigöãºu±
(
SIGTERM
, 1);

290 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

292 if((
ﬁd_sigbªak_h™dÀr
 = 
	`sig«l
(
SIGBREAK
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

293 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGBREAK h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

295 
	`sigöãºu±
(
SIGBREAK
, 1);

297 
	}
}

299 
	$ª°‹e_sig«l_h™dÀrs
()

301 #ifde‡
SIGHUP


302 if(
SIG_ERR
 !
ﬁd_sighup_h™dÀr
)

303 ()
	`sig«l
(
SIGHUP
, 
ﬁd_sighup_h™dÀr
);

305 #ifde‡
SIGPIPE


306 if(
SIG_ERR
 !
ﬁd_sigpùe_h™dÀr
)

307 ()
	`sig«l
(
SIGPIPE
, 
ﬁd_sigpùe_h™dÀr
);

309 #ifde‡
SIGALRM


310 if(
SIG_ERR
 !
ﬁd_sigÆrm_h™dÀr
)

311 ()
	`sig«l
(
SIGALRM
, 
ﬁd_sigÆrm_h™dÀr
);

313 #ifde‡
SIGINT


314 if(
SIG_ERR
 !
ﬁd_sigöt_h™dÀr
)

315 ()
	`sig«l
(
SIGINT
, 
ﬁd_sigöt_h™dÀr
);

317 #ifde‡
SIGTERM


318 if(
SIG_ERR
 !
ﬁd_sigãrm_h™dÀr
)

319 ()
	`sig«l
(
SIGTERM
, 
ﬁd_sigãrm_h™dÀr
);

321 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

322 if(
SIG_ERR
 !
ﬁd_sigbªak_h™dÀr
)

323 ()
	`sig«l
(
SIGBREAK
, 
ﬁd_sigbªak_h™dÀr
);

325 
	}
}

327 
	$Pro˚ssReque°
(
hâ¥eque°
 *
ªq
)

329 *
löe
=&
ªq
->
ªqbuf
[ªq->
checködex
];

330 
boﬁ
 
chunked
 = 
FALSE
;

331 
ªque°
[
REQUEST_KEYWORD_SIZE
];

332 
doc
[
MAXDOCNAMELEN
];

333 
¥Ÿ_°r
[5];

334 
logbuf
[256];

335 
¥Ÿ_maj‹
, 
¥Ÿ_mö‹
;

336 *
íd
;

337 
îr‹
;

338 
íd
 = 
	`°r°r
(
löe
, 
END_OF_HEADERS
);

340 
	`logmsg
("ProcessRequest() called withÅestno %ldándÜine [%s]",

341 
ªq
->
ã°no
, 
löe
);

345 if((
ªq
->
ã°no
 =
DOCNUMBER_NOTHING
) &&

346 
	`ssˇnf
(
löe
,

347 "%" 
REQUEST_KEYWORD_SIZE_TXT
"†%" 
MAXDOCNAMELEN_TXT
 "s %4s/%d.%d",

348 
ªque°
,

349 
doc
,

350 
¥Ÿ_°r
,

351 &
¥Ÿ_maj‹
,

352 &
¥Ÿ_mö‹
) == 5) {

353 *
±r
;

355 if(!
	`°rcmp
(
¥Ÿ_°r
, "HTTP")) {

356 
ªq
->
¥Ÿocﬁ
 = 
RPROT_HTTP
;

358 if(!
	`°rcmp
(
¥Ÿ_°r
, "RTSP")) {

359 
ªq
->
¥Ÿocﬁ
 = 
RPROT_RTSP
;

362 
ªq
->
¥Ÿocﬁ
 = 
RPROT_NONE
;

363 
	`logmsg
("gŸ unknow¿¥Ÿocﬁ %s", 
¥Ÿ_°r
);

367 
ªq
->
¥Ÿ_vîsi⁄
 = 
¥Ÿ_maj‹
*10 + 
¥Ÿ_mö‹
;

370 
±r
 = 
	`°ºchr
(
doc
, '/');

373 if(
±r
) {

374 
FILE
 *
°ªam
;

375 *
fûíame
;

377 if((
	`°æí
(
doc
Ë+ såÀn(
ªque°
)) < 200)

378 
	`•rötf
(
logbuf
, "GotÑequest: %s %s %s/%d.%d",

379 
ªque°
, 
doc
, 
¥Ÿ_°r
, 
¥Ÿ_maj‹
, 
¥Ÿ_mö‹
);

381 
	`•rötf
(
logbuf
, "Gotá *HUGE*Ñequest %s/%d.%d",

382 
¥Ÿ_°r
, 
¥Ÿ_maj‹
, 
¥Ÿ_mö‹
);

383 
	`logmsg
("%s", 
logbuf
);

385 if(!
	`°∫cmp
("/vîifõd£rvî", 
±r
, 15)) {

386 
	`logmsg
("Are-we-friendly questionÑeceived");

387 
ªq
->
ã°no
 = 
DOCNUMBER_WERULEZ
;

391 if(!
	`°∫cmp
("/quô", 
±r
, 5)) {

392 
	`logmsg
("Request-to-quitÑeceived");

393 
ªq
->
ã°no
 = 
DOCNUMBER_QUIT
;

397 
±r
++;

400 *
±r
 && !
	`ISDIGIT
(*ptr))

401 
±r
++;

403 
ªq
->
ã°no
 = 
	`°πﬁ
(
±r
, &ptr, 10);

405 if(
ªq
->
ã°no
 > 10000) {

406 
ªq
->
∑πno
 =Ñeq->
ã°no
 % 10000;

407 
ªq
->
ã°no
 /= 10000;

410 
ªq
->
∑πno
 = 0;

412 
	`•rötf
(
logbuf
, "RequestedÅestÇumber %ldÖart %ld",

413 
ªq
->
ã°no
,Ñeq->
∑πno
);

414 
	`logmsg
("%s", 
logbuf
);

416 
fûíame
 = 
	`ã°2fûe
(
ªq
->
ã°no
);

418 
°ªam
=
	`f›í
(
fûíame
, "rb");

419 if(!
°ªam
) {

420 
îr‹
 = 
î∫o
;

421 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

422 
	`logmsg
("Eº‹ o≥nög fûe: %s", 
fûíame
);

423 
	`logmsg
("Couldn'à›íÅe° fûê%ld", 
ªq
->
ã°no
);

424 
ªq
->
›í
 = 
FALSE
;

428 *
cmd
 = 
NULL
;

429 
size_t
 
cmdsize
 = 0;

430 
num
=0;

432 
πp_ch™√l
 = 0;

433 
πp_size
 = 0;

434 
πp_∑πno
 = -1;

435 
i
 = 0;

436 *
πp_s¸©ch
 = 
NULL
;

439 
îr‹
 = 
	`gë∑π
(&
cmd
, &
cmdsize
, "ª∂y", "£rvîcmd", 
°ªam
);

440 
	`f˛o£
(
°ªam
);

441 if(
îr‹
) {

442 
	`logmsg
("gë∑π(ËÁûed wôhÉº‹: %d", 
îr‹
);

443 
ªq
->
›í
 = 
FALSE
;

446 
±r
 = 
cmd
;

448 if(
cmdsize
) {

449 
	`logmsg
("FoundáÑeply-servercmd section!");

451 if(!
	`°∫cmp
(
CMD_AUTH_REQUIRED
, 
±r
, 
	`°æí
(CMD_AUTH_REQUIRED))) {

452 
	`logmsg
("instructedÅoÑequireáuthorization header");

453 
ªq
->
auth_ªq
 = 
TRUE
;

455 if(!
	`°∫cmp
(
CMD_IDLE
, 
±r
, 
	`°æí
(CMD_IDLE))) {

456 
	`logmsg
("instructedÅo idle");

457 
ªq
->
rcmd
 = 
RCMD_IDLE
;

458 
ªq
->
›í
 = 
TRUE
;

460 if(!
	`°∫cmp
(
CMD_STREAM
, 
±r
, 
	`°æí
(CMD_STREAM))) {

461 
	`logmsg
("instructedÅo stream");

462 
ªq
->
rcmd
 = 
RCMD_STREAM
;

464 if(1 =
	`ssˇnf
(
±r
, "pùe: %d", &
num
)) {

465 
	`logmsg
("ö°ru˘edÅÿÆlowáÖùêsizêo‡%d", 
num
);

466 if(
num
 < 0)

467 
	`logmsg
("negativeÖipe size ignored");

468 if(
num
 > 0)

469 
ªq
->
pùe
 = 
num
-1;

472 if(1 =
	`ssˇnf
(
±r
, "skù: %d", &
num
)) {

473 
	`logmsg
("ö°ru˘edÅÿskùÅhi†numbî o‡byã†%d", 
num
);

474 
ªq
->
skù
 = 
num
;

476 if(3 =
	`ssˇnf
(
±r
, "rtp:Öart %d channel %d size %d",

477 &
πp_∑πno
, &
πp_ch™√l
, &
πp_size
)) {

479 if(
πp_∑πno
 =
ªq
->
∑πno
) {

480 
	`logmsg
("RTP:Öart %d channel %d size %d",

481 
πp_∑πno
, 
πp_ch™√l
, 
πp_size
);

485 
πp_s¸©ch
 = 
	`mÆloc
(
πp_size
 + 4 + 
RTP_DATA_SIZE
);

488 
πp_s¸©ch
[0] = '$';

491 
	`SET_RTP_PKT_CHN
(
πp_s¸©ch
 ,
πp_ch™√l
);

494 
	`SET_RTP_PKT_LEN
(
πp_s¸©ch
, 
πp_size
);

497 
i
 = 0; i < 
πp_size
; i+
RTP_DATA_SIZE
) {

498 
	`mem˝y
(
πp_s¸©ch
 + 4 + 
i
, 
RTP_DATA
, 
RTP_DATA_SIZE
);

501 if(
ªq
->
πp_buf„r
 =
NULL
) {

502 
ªq
->
πp_buf„r
 = 
πp_s¸©ch
;

503 
ªq
->
πp_buf„rsize
 = 
πp_size
 + 4;

505 
ªq
->
πp_buf„r
 = 
	`ªÆloc
‘eq->πp_buf„r,Ñeq->
πp_buf„rsize
 + 
πp_size
 + 4);

506 
	`mem˝y
(
ªq
->
πp_buf„r
 +Ñeq->
πp_buf„rsize
, 
πp_s¸©ch
, 
πp_size
 + 4);

507 
ªq
->
πp_buf„rsize
 +
πp_size
 + 4;

508 
	`‰ì
(
πp_s¸©ch
);

510 
	`logmsg
("πp_buf„rsizêi†%zu,Ñç_sizêi†%d.", 
ªq
->
πp_buf„rsize
, 
πp_size
);

515 
	`logmsg
("fu¬y in°ru˘i⁄ found: %s", 
±r
);

518 
±r
 = 
	`°rchr
(ptr, '\n');

519 if(
±r
)

520 
±r
++;

522 
±r
 = 
NULL
;

523 } 
±r
 && *ptr);

524 
	`logmsg
("DoneÖarsing server commands");

526 if(
cmd
)

527 
	`‰ì
(
cmd
);

531 if(
	`ssˇnf
(
ªq
->
ªqbuf
, "CONNECT %" 
MAXDOCNAMELEN_TXT
 "s HTTP/%d.%d",

532 
doc
, &
¥Ÿ_maj‹
, &
¥Ÿ_mö‹
) == 3) {

533 
	`•rötf
(
logbuf
, "Receivedá CONNECT %s HTTP/%d.%dÑequest",

534 
doc
, 
¥Ÿ_maj‹
, 
¥Ÿ_mö‹
);

535 
	`logmsg
("%s", 
logbuf
);

537 if(
ªq
->
¥Ÿ_vîsi⁄
 == 10)

538 
ªq
->
›í
 = 
FALSE
;

540 if(!
	`°∫cmp
(
doc
, "bad", 3))

542 
ªq
->
ã°no
 = 
DOCNUMBER_BADCONNECT
;

543 if(!
	`°∫cmp
(
doc
, "test", 4)) {

546 *
p‹ç
 = 
	`°rchr
(
doc
, ':');

547 if(
p‹ç
 && (*’‹ç+1Ë!'\0'Ë&& 
	`ISDIGIT
(*(portp+1)))

548 
ªq
->
ã°no
 = 
	`°πﬁ
(
p‹ç
+1, 
NULL
, 10);

550 
ªq
->
ã°no
 = 
DOCNUMBER_CONNECT
;

553 
ªq
->
ã°no
 = 
DOCNUMBER_CONNECT
;

556 
	`logmsg
("DidÇot findÅestÇumber in PATH");

557 
ªq
->
ã°no
 = 
DOCNUMBER_404
;

562 if(!
íd
) {

564 
	`logmsg
("ProcessRequestÑeturned withoutá completeÑequest");

567 
	`logmsg
("ProcessRequest foundá completeÑequest");

569 if(
ªq
->
pùe
)

572 
ªq
->
checködex
 +(
íd
 - 
löe
Ë+ 
	`°æí
(
END_OF_HEADERS
);

586 if(
gŸ_exô_sig«l
)

589 if((
ªq
->
˛
==0Ë&& 
	`cuæx_°∫equÆ
("C⁄ã¡-Lígth:", 
löe
, 15)) {

594 *
íd±r
;

595 *
±r
 = 
löe
 + 15;

596 
˛í
 = 0;

597 *
±r
 && 
	`ISSPACE
(*ptr))

598 
±r
++;

599 
íd±r
 = 
±r
;

600 
î∫o
 = 0;

601 
˛í
 = 
	`°πoul
(
±r
, &
íd±r
, 10);

602 if((
±r
 =
íd±r
Ë|| !
	`ISSPACE
(*íd±rË|| (
ERANGE
 =
î∫o
)) {

604 
	`logmsg
("Found invÆid C⁄ã¡-Lígth: (%sËöÅhêªque°", 
±r
);

605 
ªq
->
›í
 = 
FALSE
;

608 
ªq
->
˛
 = 
˛í
 -Ñeq->
skù
;

610 
	`logmsg
("Found C⁄ã¡-Lígth: %lu i¿thêªque°", 
˛í
);

611 if(
ªq
->
skù
)

612 
	`logmsg
("... buàwû»ab‹àa·î %zu byãs", 
ªq
->
˛
);

615 if(
	`cuæx_°∫equÆ
("Tøns„r-Encodög: chunked", 
löe
,

616 
	`°æí
("Transfer-Encoding: chunked"))) {

618 
chunked
 = 
TRUE
;

621 if(
chunked
) {

622 if(
	`°r°r
(
ªq
->
ªqbuf
, "\r\n0\r\n\r\n"))

629 
löe
 = 
	`°rchr
(line, '\n');

630 if(
löe
)

631 
löe
++;

633 } 
löe
);

635 if(!
ªq
->
auth
 && 
	`°r°r
‘eq->
ªqbuf
, "Authorization:")) {

636 
ªq
->
auth
 = 
TRUE
;

637 if(
ªq
->
auth_ªq
)

638 
	`logmsg
("Authorization header found,ásÑequired");

641 if(!
ªq
->
dige°
 && 
	`°r°r
‘eq->
ªqbuf
, "Authorization: Digest")) {

645 
ªq
->
∑πno
 += 1000;

646 
ªq
->
dige°
 = 
TRUE
;

647 
	`logmsg
("Re˚ived Dige°Ñeque°, sídög back d©®%ld", 
ªq
->
∑πno
);

649 if(!
ªq
->
¡lm
 &&

650 
	`°r°r
(
ªq
->
ªqbuf
, "Authorization: NTLM TlRMTVNTUAAD")) {

652 
ªq
->
∑πno
 += 1002;

653 
ªq
->
¡lm
 = 
TRUE
;

654 
	`logmsg
("Re˚ived NTLMÅy≥-3, sídög back d©®%ld", 
ªq
->
∑πno
);

655 if(
ªq
->
˛
) {

656 
	`logmsg
(" Ex≥˘ög %zu POSTed byãs", 
ªq
->
˛
);

659 if(!
ªq
->
¡lm
 &&

660 
	`°r°r
(
ªq
->
ªqbuf
, "Authorization: NTLM TlRMTVNTUAAB")) {

662 
ªq
->
∑πno
 += 1001;

663 
ªq
->
¡lm
 = 
TRUE
;

664 
	`logmsg
("Re˚ived NTLMÅy≥-1, sídög back d©®%ld", 
ªq
->
∑πno
);

666 if((
ªq
->
∑πno
 >1000Ë&& 
	`°r°r
‘eq->
ªqbuf
, "Authorization: Basic")) {

670 
ªq
->
∑πno
 += 1;

671 
	`logmsg
("Re˚ived Basi¯ªque°, sídög back d©®%ld", 
ªq
->
∑πno
);

673 if(
	`°r°r
(
ªq
->
ªqbuf
, "Connection: close"))

674 
ªq
->
›í
 = 
FALSE
;

676 if(!
ªq
->
pùe
 &&

677 
ªq
->
›í
 &&

678 
ªq
->
¥Ÿ_vîsi⁄
 >= 11 &&

679 
íd
 &&

680 
ªq
->
ªqbuf
 +Ñeq->
off£t
 > 
íd
 + 
	`°æí
(
END_OF_HEADERS
) &&

681 (!
	`°∫cmp
(
ªq
->
ªqbuf
, "GET", 
	`°æí
("GET")) ||

682 !
	`°∫cmp
(
ªq
->
ªqbuf
, "HEAD", 
	`°æí
("HEAD")))) {

685 
ªq
->
checködex
 = (
íd
 -Ñeq->
ªqbuf
Ë+ 
	`°æí
(
END_OF_HEADERS
);

686 
ªq
->
pùñöög
 = 
TRUE
;

689 
ªq
->
pùe
) {

690 if(
gŸ_exô_sig«l
)

693 
löe
 = &
ªq
->
ªqbuf
[ªq->
checködex
];

694 
íd
 = 
	`°r°r
(
löe
, 
END_OF_HEADERS
);

695 if(!
íd
)

697 
ªq
->
checködex
 +(
íd
 - 
löe
Ë+ 
	`°æí
(
END_OF_HEADERS
);

698 
ªq
->
pùe
--;

705 if(
ªq
->
auth_ªq
 && !ªq->
auth
)

708 if(
ªq
->
˛
 > 0) {

709 if(
ªq
->
˛
 <ªq->
off£t
 - (
íd
 -Ñeq->
ªqbuf
Ë- 
	`°æí
(
END_OF_HEADERS
))

716 
	}
}

719 
	$°‹îeque°
(*
ªqbuf
, 
size_t
 
tŸÆsize
)

721 
ªs
;

722 
îr‹
 = 0;

723 
size_t
 
wrôãn
;

724 
size_t
 
wrôñe·
;

725 
FILE
 *
dump
;

727 i‡(
ªqbuf
 =
NULL
)

729 i‡(
tŸÆsize
 == 0)

733 
dump
 = 
	`f›í
(
REQUEST_DUMP
, "ab");

734 } (
dump
 =
NULL
Ë&& ((
îr‹
 = 
î∫o
Ë=
EINTR
));

735 i‡(
dump
 =
NULL
) {

736 
	`logmsg
("Error opening file %sÉrror: %d %s",

737 
REQUEST_DUMP
, 
îr‹
, 
	`°ªº‹
(error));

738 
	`logmsg
("FaûedÅÿwrôêªque° i≈uàtÿ" 
REQUEST_DUMP
);

742 
wrôñe·
 = 
tŸÆsize
;

744 
wrôãn
 = 
	`fwrôe
(&
ªqbuf
[
tŸÆsize
-
wrôñe·
],

745 1, 
wrôñe·
, 
dump
);

746 if(
gŸ_exô_sig«l
)

747 
°‹îeque°_˛ónup
;

748 if(
wrôãn
 > 0)

749 
wrôñe·
 -
wrôãn
;

750 } (
wrôñe·
 > 0Ë&& ((
îr‹
 = 
î∫o
Ë=
EINTR
));

752 if(
wrôñe·
 == 0)

753 
	`logmsg
("WrŸêªque° (%zu byãsËöpuàtÿ" 
REQUEST_DUMP
, 
tŸÆsize
);

754 if(
wrôñe·
 > 0) {

755 
	`logmsg
("Error writing file %sÉrror: %d %s",

756 
REQUEST_DUMP
, 
îr‹
, 
	`°ªº‹
(error));

757 
	`logmsg
("Wrote only (%zu bytes) of (%zu bytes)Ñequest inputÅo %s",

758 
tŸÆsize
-
wrôñe·
,ÅŸÆsize, 
REQUEST_DUMP
);

761 
°‹îeque°_˛ónup
:

764 
ªs
 = 
	`f˛o£
(
dump
);

765 } 
ªs
 && ((
îr‹
 = 
î∫o
Ë=
EINTR
));

766 if(
ªs
)

767 
	`logmsg
("Error closing file %sÉrror: %d %s",

768 
REQUEST_DUMP
, 
îr‹
, 
	`°ªº‹
(error));

769 
	}
}

772 
	$gë_ªque°
(
cuæ_sockë_t
 
sock
, 
hâ¥eque°
 *
ªq
)

774 
îr‹
;

775 
Áû
 = 0;

776 
d⁄e_¥o˚ssög
 = 0;

777 *
ªqbuf
 = 
ªq
->reqbuf;

778 
ssize_t
 
gŸ
 = 0;

780 *
pùîeq
 = 
NULL
;

781 
size_t
 
pùîeq_Àngth
 = 0;

783 if(
ªq
->
pùñöög
) {

784 
pùîeq
 = 
ªqbuf
 + 
ªq
->
checködex
;

785 
pùîeq_Àngth
 = 
ªq
->
off£t
 -Ñeq->
checködex
;

790 
ªq
->
checködex
 = 0;

791 
ªq
->
off£t
 = 0;

792 
ªq
->
ã°no
 = 
DOCNUMBER_NOTHING
;

793 
ªq
->
∑πno
 = 0;

794 
ªq
->
›í
 = 
TRUE
;

795 
ªq
->
auth_ªq
 = 
FALSE
;

796 
ªq
->
auth
 = 
FALSE
;

797 
ªq
->
˛
 = 0;

798 
ªq
->
dige°
 = 
FALSE
;

799 
ªq
->
¡lm
 = 
FALSE
;

800 
ªq
->
pùe
 = 0;

801 
ªq
->
skù
 = 0;

802 
ªq
->
rcmd
 = 
RCMD_NORMALREQ
;

803 
ªq
->
¥Ÿocﬁ
 = 
RPROT_NONE
;

804 
ªq
->
¥Ÿ_vîsi⁄
 = 0;

805 
ªq
->
pùñöög
 = 
FALSE
;

806 
ªq
->
πp_buf„r
 = 
NULL
;

807 
ªq
->
πp_buf„rsize
 = 0;

811 !
d⁄e_¥o˚ssög
 && (
ªq
->
off£t
 < 
REQBUFSIZ
-1)) {

812 if(
pùîeq_Àngth
 && 
pùîeq
) {

813 
	`memmove
(
ªqbuf
, 
pùîeq
, 
pùîeq_Àngth
);

814 
gŸ
 = 
	`cuæx_uztosz
(
pùîeq_Àngth
);

815 
pùîeq_Àngth
 = 0;

818 if(
ªq
->
skù
)

822 
gŸ
 = 
	`§ód
(
sock
, 
ªqbuf
 + 
ªq
->
off£t
,Ñeq->
˛
);

824 
gŸ
 = 
	`§ód
(
sock
, 
ªqbuf
 + 
ªq
->
off£t
, 
REQBUFSIZ
-1 -Ñeq->offset);

826 if(
gŸ_exô_sig«l
)

828 if(
gŸ
 == 0) {

829 
	`logmsg
("Connection closed by client");

830 
Áû
 = 1;

832 if(
gŸ
 < 0) {

833 
îr‹
 = 
SOCKERRNO
;

834 
	`logmsg
("ªcv(Ëªtu∫edÉº‹: (%dË%s", 
îr‹
, 
	`°ªº‹
(error));

835 
Áû
 = 1;

837 if(
Áû
) {

839 
ªqbuf
[
ªq
->
off£t
] = '\0';

840 
	`°‹îeque°
(
ªqbuf
, 
ªq
->
off£t
);

844 
	`logmsg
("Ród %zd byãs", 
gŸ
);

846 
ªq
->
off£t
 +(
size_t
)
gŸ
;

847 
ªqbuf
[
ªq
->
off£t
] = '\0';

849 
d⁄e_¥o˚ssög
 = 
	`Pro˚ssReque°
(
ªq
);

850 if(
gŸ_exô_sig«l
)

852 if(
d⁄e_¥o˚ssög
 && 
ªq
->
pùe
) {

853 
	`logmsg
("Waiting foránotherÖipedÑequest");

854 
d⁄e_¥o˚ssög
 = 0;

855 
ªq
->
pùe
--;

859 if((
ªq
->
off£t
 =
REQBUFSIZ
-1Ë&& (
gŸ
 > 0)) {

860 
	`logmsg
("Request would overflow buffer, closing connection");

862 
ªqbuf
[
REQBUFSIZ
-1] = '\0';

863 
Áû
 = 1;

865 if(
ªq
->
off£t
 > 
REQBUFSIZ
-1) {

866 
	`logmsg
("Request buffer overflow, closing connection");

868 
ªqbuf
[
REQBUFSIZ
-1] = '\0';

869 
Áû
 = 1;

872 
ªqbuf
[
ªq
->
off£t
] = '\0';

875 
	`°‹îeque°
(
ªqbuf
, 
ªq
->
pùñöög
 ?Ñeq->
checködex
 :Ñeq->
off£t
);

876 if(
gŸ_exô_sig«l
)

879  
Áû
;

880 
	}
}

883 
	$£nd_doc
(
cuæ_sockë_t
 
sock
, 
hâ¥eque°
 *
ªq
)

885 
ssize_t
 
wrôãn
;

886 
size_t
 
cou¡
;

887 c⁄° *
buf„r
;

888 *
±r
=
NULL
;

889 
FILE
 *
°ªam
;

890 *
cmd
=
NULL
;

891 
size_t
 
cmdsize
=0;

892 
FILE
 *
dump
;

893 
boﬁ
 
≥rsi°™t
 = 
TRUE
;

894 
boﬁ
 
£ndÁûuª
 = 
FALSE
;

895 
size_t
 
ª•⁄£size
;

896 
îr‹
 = 0;

897 
ªs
;

899 
wóª
[256];

901 
∑πbuf
[80]="data";

903 
	`logmsg
("SídÑe•⁄£Çumbî %ldÖ¨à%ld", 
ªq
->
ã°no
,Ñeq->
∑πno
);

905 
ªq
->
rcmd
) {

907 
RCMD_NORMALREQ
:

909 
RCMD_STREAM
:

910 
	#STREAMTHIS
 "®°rögÅÿ°ªam 01234567890\n"

	)

911 
cou¡
 = 
	`°æí
(
STREAMTHIS
);

913 
wrôãn
 = 
	`swrôe
(
sock
, 
STREAMTHIS
, 
cou¡
);

914 if(
gŸ_exô_sig«l
)

916 if(
wrôãn
 !(
ssize_t
)
cou¡
) {

917 
	`logmsg
("Stopped streaming");

922 
RCMD_IDLE
:

927 
ªq
->
›í
 = 
FALSE
;

929 if(
ªq
->
ã°no
 < 0) {

930 
size_t
 
msgÀn
;

931 
msgbuf
[64];

933 
ªq
->
ã°no
) {

934 
DOCNUMBER_QUIT
:

935 
	`logmsg
("ReplyingÅo QUIT");

936 
buf„r
 = 
docquô
;

938 
DOCNUMBER_WERULEZ
:

940 
	`logmsg
("Identifying ourselvesás friends");

941 
	`•rötf
(
msgbuf
, "RTSP_SERVER WE ROOLZ: %ld\r\n", ()
	`gëpid
());

942 
msgÀn
 = 
	`°æí
(
msgbuf
);

943 
	`•rötf
(
wóª
, "HTTP/1.1 200 OK\r\nContent-Length: %zu\r\n\r\n%s",

944 
msgÀn
, 
msgbuf
);

945 
buf„r
 = 
wóª
;

947 
DOCNUMBER_INTERNAL
:

948 
	`logmsg
("Bailing out dueÅo internalÉrror");

950 
DOCNUMBER_CONNECT
:

951 
	`logmsg
("ReplyingÅo CONNECT");

952 
buf„r
 = 
docc⁄√˘
;

954 
DOCNUMBER_BADCONNECT
:

955 
	`logmsg
("ReplyingÅoá bad CONNECT");

956 
buf„r
 = 
docbadc⁄√˘
;

958 
DOCNUMBER_404
:

960 
	`logmsg
("ReplyingÅo withá 404");

961 if(
ªq
->
¥Ÿocﬁ
 =
RPROT_HTTP
) {

962 
buf„r
 = 
doc404_HTTP
;

964 
buf„r
 = 
doc404_RTSP
;

969 
cou¡
 = 
	`°æí
(
buf„r
);

972 *
fûíame
 = 
	`ã°2fûe
(
ªq
->
ã°no
);

974 if(0 !
ªq
->
∑πno
)

975 
	`•rötf
(
∑πbuf
, "d©a%ld", 
ªq
->
∑πno
);

977 
°ªam
=
	`f›í
(
fûíame
, "rb");

978 if(!
°ªam
) {

979 
îr‹
 = 
î∫o
;

980 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

981 
	`logmsg
("Eº‹ o≥nög fûe: %s", 
fûíame
);

982 
	`logmsg
("Couldn't openÅest file");

986 
îr‹
 = 
	`gë∑π
(&
±r
, &
cou¡
, "ª∂y", 
∑πbuf
, 
°ªam
);

987 
	`f˛o£
(
°ªam
);

988 if(
îr‹
) {

989 
	`logmsg
("gë∑π(ËÁûed wôhÉº‹: %d", 
îr‹
);

992 
buf„r
 = 
±r
;

995 if(
gŸ_exô_sig«l
) {

996 if(
±r
)

997 
	`‰ì
(
±r
);

1002 
°ªam
=
	`f›í
(
fûíame
, "rb");

1003 if(!
°ªam
) {

1004 
îr‹
 = 
î∫o
;

1005 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

1006 
	`logmsg
("Eº‹ o≥nög fûe: %s", 
fûíame
);

1007 
	`logmsg
("Couldn't openÅest file");

1008 if(
±r
)

1009 
	`‰ì
(
±r
);

1014 
îr‹
 = 
	`gë∑π
(&
cmd
, &
cmdsize
, "ª∂y", "po°cmd", 
°ªam
);

1015 
	`f˛o£
(
°ªam
);

1016 if(
îr‹
) {

1017 
	`logmsg
("gë∑π(ËÁûed wôhÉº‹: %d", 
îr‹
);

1018 if(
±r
)

1019 
	`‰ì
(
±r
);

1025 if(
gŸ_exô_sig«l
) {

1026 if(
±r
)

1027 
	`‰ì
(
±r
);

1028 if(
cmd
)

1029 
	`‰ì
(
cmd
);

1036 if(
	`°r°r
(
buf„r
, "sws˛o£"Ë|| !
cou¡
) {

1037 
≥rsi°™t
 = 
FALSE
;

1038 
	`logmsg
("connection close instruction \"swsclose\" found inÑesponse");

1040 if(
	`°r°r
(
buf„r
, "swsbounce")) {

1041 
¥evboun˚
 = 
TRUE
;

1042 
	`logmsg
("enable \"swsbounce\" inÅheÇextÑequest");

1045 
¥evboun˚
 = 
FALSE
;

1047 
dump
 = 
	`f›í
(
RESPONSE_DUMP
, "ab");

1048 if(!
dump
) {

1049 
îr‹
 = 
î∫o
;

1050 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

1051 
	`logmsg
("Eº‹ o≥nög fûe: %s", 
RESPONSE_DUMP
);

1052 
	`logmsg
("couldn'à¸óãÜogfûe: " 
RESPONSE_DUMP
);

1053 if(
±r
)

1054 
	`‰ì
(
±r
);

1055 if(
cmd
)

1056 
	`‰ì
(
cmd
);

1060 
ª•⁄£size
 = 
cou¡
;

1065 
size_t
 
num
 = 
cou¡
;

1066 if(
num
 > 200)

1067 
num
 = 200;

1068 
wrôãn
 = 
	`swrôe
(
sock
, 
buf„r
, 
num
);

1069 i‡(
wrôãn
 < 0) {

1070 
£ndÁûuª
 = 
TRUE
;

1074 
	`logmsg
("Síàof‡%zd byãs", 
wrôãn
);

1077 
	`fwrôe
(
buf„r
, 1, (
size_t
)
wrôãn
, 
dump
);

1078 if(
gŸ_exô_sig«l
)

1081 
cou¡
 -
wrôãn
;

1082 
buf„r
 +
wrôãn
;

1083 } 
cou¡
>0);

1086 if(
ªq
->
πp_buf„r
) {

1087 
	`logmsg
("Abouàtÿwrôê%zu RTP byãs", 
ªq
->
πp_buf„rsize
);

1088 
cou¡
 = 
ªq
->
πp_buf„rsize
;

1090 
size_t
 
num
 = 
cou¡
;

1091 if(
num
 > 200)

1092 
num
 = 200;

1093 
wrôãn
 = 
	`swrôe
(
sock
, 
ªq
->
πp_buf„r
 + (ªq->
πp_buf„rsize
 - 
cou¡
), 
num
);

1094 if(
wrôãn
 < 0) {

1095 
£ndÁûuª
 = 
TRUE
;

1098 
cou¡
 -
wrôãn
;

1099 } 
cou¡
 > 0);

1101 
	`‰ì
(
ªq
->
πp_buf„r
);

1102 
ªq
->
πp_buf„rsize
 = 0;

1106 
ªs
 = 
	`f˛o£
(
dump
);

1107 } 
ªs
 && ((
îr‹
 = 
î∫o
Ë=
EINTR
));

1108 if(
ªs
)

1109 
	`logmsg
("Error closing file %sÉrror: %d %s",

1110 
RESPONSE_DUMP
, 
îr‹
, 
	`°ªº‹
(error));

1112 if(
gŸ_exô_sig«l
) {

1113 if(
±r
)

1114 
	`‰ì
(
±r
);

1115 if(
cmd
)

1116 
	`‰ì
(
cmd
);

1120 if(
£ndÁûuª
) {

1121 
	`logmsg
("SendingÑesponse failed. Only (%zu bytes) of (%zu bytes) were sent",

1122 
ª•⁄£size
-
cou¡
,Ñesponsesize);

1123 if(
±r
)

1124 
	`‰ì
(
±r
);

1125 if(
cmd
)

1126 
	`‰ì
(
cmd
);

1130 
	`logmsg
("Re•⁄£ síà(%zu byãsË™d wrôã¿tÿ" 
RESPONSE_DUMP
,

1131 
ª•⁄£size
);

1133 if(
±r
)

1134 
	`‰ì
(
±r
);

1136 if(
cmdsize
 > 0 ) {

1137 
comm™d
[32];

1138 
qu¨ãrs
;

1139 
num
;

1140 
±r
=
cmd
;

1142 if(2 =
	`ssˇnf
(
±r
, "%31†%d", 
comm™d
, &
num
)) {

1143 if(!
	`°rcmp
("waô", 
comm™d
)) {

1144 
	`logmsg
("TﬁdÅÿ¶ì∞f‹ %d sec⁄ds", 
num
);

1145 
qu¨ãrs
 = 
num
 * 4;

1146 
qu¨ãrs
 > 0) {

1147 
qu¨ãrs
--;

1148 
ªs
 = 
	`waô_ms
(250);

1149 if(
gŸ_exô_sig«l
)

1151 if(
ªs
) {

1153 
îr‹
 = 
î∫o
;

1154 
	`logmsg
("wait_ms() failed withÉrror: (%d) %s",

1155 
îr‹
, 
	`°ªº‹
(error));

1159 if(!
qu¨ãrs
)

1160 
	`logmsg
("C⁄töuögá·î sÀïög %d sec⁄ds", 
num
);

1163 
	`logmsg
("Unknown command inÑeply command section");

1165 
±r
 = 
	`°rchr
(ptr, '\n');

1166 if(
±r
)

1167 
±r
++;

1169 
±r
 = 
NULL
;

1170 } 
±r
 && *ptr);

1172 if(
cmd
)

1173 
	`‰ì
(
cmd
);

1175 
ªq
->
›í
 = 
≥rsi°™t
;

1177 
¥evã°no
 = 
ªq
->
ã°no
;

1178 
¥ev∑πno
 = 
ªq
->
∑πno
;

1181 
	}
}

1184 
	$maö
(
¨gc
, *
¨gv
[])

1186 
§vr_sockaddr_uni⁄_t
 
me
;

1187 
cuæ_sockë_t
 
sock
 = 
CURL_SOCKET_BAD
;

1188 
cuæ_sockë_t
 
msgsock
 = 
CURL_SOCKET_BAD
;

1189 
wrŸïidfûe
 = 0;

1190 
Êag
;

1191 
p‹t
 = 
DEFAULT_PORT
;

1192 *
pid«me
= (*)".rtsp.pid";

1193 
hâ¥eque°
 
ªq
;

1194 
rc
;

1195 
îr‹
;

1196 
¨g
=1;

1197 
pid
;

1199 
¨gc
>
¨g
) {

1200 if(!
	`°rcmp
("--vîsi⁄", 
¨gv
[
¨g
])) {

1201 
	`¥ötf
("rtspd IPv4%s"

1204 #ifde‡
ENABLE_IPV6


1212 if(!
	`°rcmp
("--pidfûe", 
¨gv
[
¨g
])) {

1213 
¨g
++;

1214 if(
¨gc
>
¨g
)

1215 
pid«me
 = 
¨gv
[
¨g
++];

1217 if(!
	`°rcmp
("--logfûe", 
¨gv
[
¨g
])) {

1218 
¨g
++;

1219 if(
¨gc
>
¨g
)

1220 
£rvîlogfûe
 = 
¨gv
[
¨g
++];

1222 if(!
	`°rcmp
("--ùv4", 
¨gv
[
¨g
])) {

1223 #ifde‡
ENABLE_IPV6


1224 
ùv_öu£
 = "IPv4";

1225 
u£_ùv6
 = 
FALSE
;

1227 
¨g
++;

1229 if(!
	`°rcmp
("--ùv6", 
¨gv
[
¨g
])) {

1230 #ifde‡
ENABLE_IPV6


1231 
ùv_öu£
 = "IPv6";

1232 
u£_ùv6
 = 
TRUE
;

1234 
¨g
++;

1236 if(!
	`°rcmp
("--p‹t", 
¨gv
[
¨g
])) {

1237 
¨g
++;

1238 if(
¨gc
>
¨g
) {

1239 *
íd±r
;

1240 
u um
 = 
	`°πoul
(
¨gv
[
¨g
], &
íd±r
, 10);

1241 if((
íd±r
 !
¨gv
[
¨g
] + 
	`°æí
(argv[arg])) ||

1242 (
u um
 < 1025UL) || (ulnum > 65535UL)) {

1243 
	`Ârötf
(
°dîr
, "rtspd: invalid --portárgument (%s)\n",

1244 
¨gv
[
¨g
]);

1247 
p‹t
 = 
	`cuæx_u…ous
(
u um
);

1248 
¨g
++;

1251 if(!
	`°rcmp
("--§cdú", 
¨gv
[
¨g
])) {

1252 
¨g
++;

1253 if(
¨gc
>
¨g
) {

1254 
∑th
 = 
¨gv
[
¨g
];

1255 
¨g
++;

1259 
	`puts
("Usage:Ñtspd [option]\n"

1271 #ifde‡
WIN32


1272 
	`wö32_öô
();

1273 
	`©exô
(
wö32_˛ónup
);

1276 
	`ö°Æl_sig«l_h™dÀrs
();

1278 
pid
 = ()
	`gëpid
();

1280 #ifde‡
ENABLE_IPV6


1281 if(!
u£_ùv6
)

1283 
sock
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0);

1284 #ifde‡
ENABLE_IPV6


1286 
sock
 = 
	`sockë
(
AF_INET6
, 
SOCK_STREAM
, 0);

1289 if(
CURL_SOCKET_BAD
 =
sock
) {

1290 
îr‹
 = 
SOCKERRNO
;

1291 
	`logmsg
("Error creating socket: (%d) %s",

1292 
îr‹
, 
	`°ªº‹
(error));

1293 
£rvî_˛ónup
;

1296 
Êag
 = 1;

1297 i‡(0 !
	`£tsock›t
(
sock
, 
SOL_SOCKET
, 
SO_REUSEADDR
,

1298 (*)&
Êag
, (flag))) {

1299 
îr‹
 = 
SOCKERRNO
;

1300 
	`logmsg
("setsockopt(SO_REUSEADDR) failed withÉrror: (%d) %s",

1301 
îr‹
, 
	`°ªº‹
(error));

1302 
£rvî_˛ónup
;

1305 #ifde‡
ENABLE_IPV6


1306 if(!
u£_ùv6
) {

1308 
	`mem£t
(&
me
.
ß4
, 0, (me.sa4));

1309 
me
.
ß4
.
sö_Ámûy
 = 
AF_INET
;

1310 
me
.
ß4
.
sö_addr
.
s_addr
 = 
INADDR_ANY
;

1311 
me
.
ß4
.
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

1312 
rc
 = 
	`böd
(
sock
, &
me
.
ß
, (me.
ß4
));

1313 #ifde‡
ENABLE_IPV6


1316 
	`mem£t
(&
me
.
ß6
, 0, (me.sa6));

1317 
me
.
ß6
.
sö6_Ámûy
 = 
AF_INET6
;

1318 
me
.
ß6
.
sö6_addr
 = 
ö6addr_™y
;

1319 
me
.
ß6
.
sö6_p‹t
 = 
	`ht⁄s
(
p‹t
);

1320 
rc
 = 
	`böd
(
sock
, &
me
.
ß
, (me.
ß6
));

1323 if(0 !
rc
) {

1324 
îr‹
 = 
SOCKERRNO
;

1325 
	`logmsg
("Error binding socket onÖort %hu: (%d) %s",

1326 
p‹t
, 
îr‹
, 
	`°ªº‹
(error));

1327 
£rvî_˛ónup
;

1330 
	`logmsg
("Ru¬ög %†vîsi⁄ o¿p‹à%d", 
ùv_öu£
, ()
p‹t
);

1333 
rc
 = 
	`li°í
(
sock
, 5);

1334 if(0 !
rc
) {

1335 
îr‹
 = 
SOCKERRNO
;

1336 
	`logmsg
("listen() failed withÉrror: (%d) %s",

1337 
îr‹
, 
	`°ªº‹
(error));

1338 
£rvî_˛ónup
;

1346 
wrŸïidfûe
 = 
	`wrôe_pidfûe
(
pid«me
);

1347 if(!
wrŸïidfûe
)

1348 
£rvî_˛ónup
;

1351 
msgsock
 = 
	`ac˚±
(
sock
, 
NULL
, NULL);

1353 if(
gŸ_exô_sig«l
)

1355 i‡(
CURL_SOCKET_BAD
 =
msgsock
) {

1356 
îr‹
 = 
SOCKERRNO
;

1357 
	`logmsg
("MAJOR ERROR:áccept() failed withÉrror: (%d) %s",

1358 
îr‹
, 
	`°ªº‹
(error));

1368 
	`£t_advis‹_ªad_lock
(
SERVERLOGS_LOCK
);

1369 
£rvîlog¶ocked
 = 1;

1371 
	`logmsg
("====> Client connect");

1373 #ifde‡
TCP_NODELAY


1378 
Êag
 = 1;

1379 i‡(
	`£tsock›t
(
msgsock
, 
IPPROTO_TCP
, 
TCP_NODELAY
,

1380 (*)&
Êag
, (flag)) == -1) {

1381 
	`logmsg
("====> TCP_NODELAY failed");

1389 
ªq
.
pùñöög
 = 
FALSE
;

1392 if(
gŸ_exô_sig«l
)

1395 if(
	`gë_ªque°
(
msgsock
, &
ªq
))

1399 if(
¥evboun˚
) {

1401 if((
ªq
.
ã°no
 =
¥evã°no
) &&

1402 (
ªq
.
∑πno
 =
¥ev∑πno
)) {

1403 
ªq
.
∑πno
++;

1404 
	`logmsg
("BOUNCEÖ¨ànumbîÅÿ%ld", 
ªq
.
∑πno
);

1407 
¥evboun˚
 = 
FALSE
;

1408 
¥evã°no
 = -1;

1409 
¥ev∑πno
 = -1;

1413 
	`£nd_doc
(
msgsock
, &
ªq
);

1414 if(
gŸ_exô_sig«l
)

1417 if((
ªq
.
ã°no
 < 0Ë&& (ªq.ã°nÿ!
DOCNUMBER_CONNECT
)) {

1418 
	`logmsg
("specialÑequestÑeceived,ÇoÖersistency");

1421 if(!
ªq
.
›í
) {

1422 
	`logmsg
("instructedÅo close connectionáfter server-reply");

1426 if(
ªq
.
›í
)

1427 
	`logmsg
("=>Öersistant connectionÑequestÉnded,áwaitsÇewÑequest");

1429 } 
ªq
.
›í
 || (ªq.
ã°no
 =
DOCNUMBER_CONNECT
));

1431 if(
gŸ_exô_sig«l
)

1434 
	`logmsg
("====> Client disconnect");

1435 
	`s˛o£
(
msgsock
);

1436 
msgsock
 = 
CURL_SOCKET_BAD
;

1438 if(
£rvîlog¶ocked
) {

1439 
£rvîlog¶ocked
 = 0;

1440 
	`˛ór_advis‹_ªad_lock
(
SERVERLOGS_LOCK
);

1443 i‡(
ªq
.
ã°no
 =
DOCNUMBER_QUIT
)

1447 
£rvî_˛ónup
:

1449 if((
msgsock
 !
sock
Ë&& (msgsock !
CURL_SOCKET_BAD
))

1450 
	`s˛o£
(
msgsock
);

1452 if(
sock
 !
CURL_SOCKET_BAD
)

1453 
	`s˛o£
(
sock
);

1455 if(
gŸ_exô_sig«l
)

1456 
	`logmsg
("signalledÅo die");

1458 if(
wrŸïidfûe
)

1459 
	`u∆ök
(
pid«me
);

1461 if(
£rvîlog¶ocked
) {

1462 
£rvîlog¶ocked
 = 0;

1463 
	`˛ór_advis‹_ªad_lock
(
SERVERLOGS_LOCK
);

1466 
	`ª°‹e_sig«l_h™dÀrs
();

1468 if(
gŸ_exô_sig«l
) {

1469 
	`logmsg
("========> %sÑtspd (port: %dÖid: %ld)Éxits with signal (%d)",

1470 
ùv_öu£
, ()
p‹t
, 
pid
, 
exô_sig«l
);

1476 
	`øi£
(
exô_sig«l
);

1479 
	`logmsg
("========>Ñtspd quits");

1481 
	}
}

	@tests/server/server_setup.h

1 #i‚de‡
HEADER_CURL_SERVER_SETUP_H


2 
	#HEADER_CURL_SERVER_SETUP_H


	)

25 
	#CURL_NO_OLDIES


	)

27 
	~"cuæ_£tup.h
"

	@tests/server/server_sockaddr.h

1 #i‚de‡
HEADER_CURL_SERVER_SOCKADDR_H


2 
	#HEADER_CURL_SERVER_SOCKADDR_H


	)

24 
	~"£rvî_£tup.h
"

27 
sockaddr
 
	mß
;

28 
sockaddr_ö
 
	mß4
;

29 #ifde‡
ENABLE_IPV6


30 
sockaddr_ö6
 
	mß6
;

32 } 
	t§vr_sockaddr_uni⁄_t
;

	@tests/server/sockfilt.c

22 
	~"£rvî_£tup.h
"

83 #ifde‡
HAVE_SIGNAL_H


84 
	~<sig«l.h
>

86 #ifde‡
HAVE_NETINET_IN_H


87 
	~<√töë/ö.h
>

89 #ifde‡
HAVE_ARPA_INET_H


90 
	~<¨∑/öë.h
>

92 #ifde‡
HAVE_NETDB_H


93 
	~<√tdb.h
>

96 
	#ENABLE_CURLX_PRINTF


	)

99 
	~"cuæx.h
"

100 
	~"gë∑π.h
"

101 
	~"öë_±⁄.h
"

102 
	~"utû.h
"

103 
	~"£rvî_sockaddr.h
"

104 
	~"w¨∆ess.h
"

107 
	~"memdebug.h
"

109 #ifde‡
USE_WINSOCK


110 #unde‡
EINTR


111 
	#EINTR
 4

	)

112 #unde‡
EAGAIN


113 
	#EAGAIN
 11

	)

114 #unde‡
ENOMEM


115 
	#ENOMEM
 12

	)

116 #unde‡
EINVAL


117 
	#EINVAL
 22

	)

120 
	#DEFAULT_PORT
 8999

	)

122 #i‚de‡
DEFAULT_LOGFILE


123 
	#DEFAULT_LOGFILE
 "log/sockfût.log"

	)

126 c⁄° *
	g£rvîlogfûe
 = 
DEFAULT_LOGFILE
;

128 
boﬁ
 
	gvîbo£
 = 
FALSE
;

129 
boﬁ
 
	gböd_⁄ly
 = 
FALSE
;

130 #ifde‡
ENABLE_IPV6


131 
boﬁ
 
	gu£_ùv6
 = 
FALSE
;

133 c⁄° *
	gùv_öu£
 = "IPv4";

134 
	gp‹t
 = 
DEFAULT_PORT
;

135 
	gc⁄√˘p‹t
 = 0;

137 
	esockmode
 {

138 
	mPASSIVE_LISTEN
,

139 
	mPASSIVE_CONNECT
,

140 
	mACTIVE
,

141 
	mACTIVE_DISCONNECT


146 #i‚de‡
HAVE_SIGINTERRUPT


147 
	#sigöãºu±
(
x
,
y
Ëdÿ{} 0)

	)

152 
	$RETSIGTYPE
 (*
	tSIGHANDLER_T
)();

154 #ifde‡
SIGHUP


155 
SIGHANDLER_T
 
ﬁd_sighup_h™dÀr
 = 
SIG_ERR
;

158 #ifde‡
SIGPIPE


159 
SIGHANDLER_T
 
ﬁd_sigpùe_h™dÀr
 = 
SIG_ERR
;

162 #ifde‡
SIGALRM


163 
SIGHANDLER_T
 
ﬁd_sigÆrm_h™dÀr
 = 
SIG_ERR
;

166 #ifde‡
SIGINT


167 
SIGHANDLER_T
 
ﬁd_sigöt_h™dÀr
 = 
SIG_ERR
;

170 #ifde‡
SIGTERM


171 
SIGHANDLER_T
 
ﬁd_sigãrm_h™dÀr
 = 
SIG_ERR
;

174 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

175 
SIGHANDLER_T
 
ﬁd_sigbªak_h™dÀr
 = 
SIG_ERR
;

180 
SIG_ATOMIC_T
 
gŸ_exô_sig«l
 = 0;

184 vﬁ©ûê
exô_sig«l
 = 0;

191 
RETSIGTYPE
 
	$exô_sig«l_h™dÀr
(
signum
)

193 
ﬁd_î∫o
 = 
î∫o
;

194 if(
gŸ_exô_sig«l
 == 0) {

195 
gŸ_exô_sig«l
 = 1;

196 
exô_sig«l
 = 
signum
;

198 ()
	`sig«l
(
signum
, 
exô_sig«l_h™dÀr
);

199 
î∫o
 = 
ﬁd_î∫o
;

200 
	}
}

202 
	$ö°Æl_sig«l_h™dÀrs
()

204 #ifde‡
SIGHUP


206 if((
ﬁd_sighup_h™dÀr
 = 
	`sig«l
(
SIGHUP
, 
SIG_IGN
)Ë=
SIG_ERR
)

207 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGHUP h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

209 #ifde‡
SIGPIPE


211 if((
ﬁd_sigpùe_h™dÀr
 = 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
)Ë=
SIG_ERR
)

212 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGPIPE h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

214 #ifde‡
SIGALRM


216 if((
ﬁd_sigÆrm_h™dÀr
 = 
	`sig«l
(
SIGALRM
, 
SIG_IGN
)Ë=
SIG_ERR
)

217 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGALRM h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

219 #ifde‡
SIGINT


221 if((
ﬁd_sigöt_h™dÀr
 = 
	`sig«l
(
SIGINT
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

222 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGINT h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

224 
	`sigöãºu±
(
SIGINT
, 1);

226 #ifde‡
SIGTERM


228 if((
ﬁd_sigãrm_h™dÀr
 = 
	`sig«l
(
SIGTERM
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

229 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGTERM h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

231 
	`sigöãºu±
(
SIGTERM
, 1);

233 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

235 if((
ﬁd_sigbªak_h™dÀr
 = 
	`sig«l
(
SIGBREAK
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

236 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGBREAK h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

238 
	`sigöãºu±
(
SIGBREAK
, 1);

240 
	}
}

242 
	$ª°‹e_sig«l_h™dÀrs
()

244 #ifde‡
SIGHUP


245 if(
SIG_ERR
 !
ﬁd_sighup_h™dÀr
)

246 ()
	`sig«l
(
SIGHUP
, 
ﬁd_sighup_h™dÀr
);

248 #ifde‡
SIGPIPE


249 if(
SIG_ERR
 !
ﬁd_sigpùe_h™dÀr
)

250 ()
	`sig«l
(
SIGPIPE
, 
ﬁd_sigpùe_h™dÀr
);

252 #ifde‡
SIGALRM


253 if(
SIG_ERR
 !
ﬁd_sigÆrm_h™dÀr
)

254 ()
	`sig«l
(
SIGALRM
, 
ﬁd_sigÆrm_h™dÀr
);

256 #ifde‡
SIGINT


257 if(
SIG_ERR
 !
ﬁd_sigöt_h™dÀr
)

258 ()
	`sig«l
(
SIGINT
, 
ﬁd_sigöt_h™dÀr
);

260 #ifde‡
SIGTERM


261 if(
SIG_ERR
 !
ﬁd_sigãrm_h™dÀr
)

262 ()
	`sig«l
(
SIGTERM
, 
ﬁd_sigãrm_h™dÀr
);

264 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

265 if(
SIG_ERR
 !
ﬁd_sigbªak_h™dÀr
)

266 ()
	`sig«l
(
SIGBREAK
, 
ﬁd_sigbªak_h™dÀr
);

268 
	}
}

270 #ifde‡
WIN32


274 
ssize_t
 
	$ªad_wöc⁄
(
fd
, *
buf
, 
size_t
 
cou¡
)

276 
HANDLE
 
h™dÀ
 = 
NULL
;

277 
DWORD
 
mode
, 
rcou¡
 = 0;

278 
BOOL
 
suc˚ss
;

280 if(
fd
 =
	`fûío
(
°dö
)) {

281 
h™dÀ
 = 
	`GëStdH™dÀ
(
STD_INPUT_HANDLE
);

284  
	`ªad
(
fd
, 
buf
, 
cou¡
);

287 if(
	`GëC⁄sﬁeMode
(
h™dÀ
, &
mode
)) {

288 
suc˚ss
 = 
	`RódC⁄sﬁe
(
h™dÀ
, 
buf
, 
cou¡
, &
rcou¡
, 
NULL
);

291 
suc˚ss
 = 
	`RódFûe
(
h™dÀ
, 
buf
, 
cou¡
, &
rcou¡
, 
NULL
);

293 if(
suc˚ss
) {

294  
rcou¡
;

297 
î∫o
 = 
	`GëLa°Eº‹
();

299 
	}
}

300 #unde‡
ªad


301 
	#ªad
(
a
,
b
,
c
Ë
	`ªad_wöc⁄
◊,b,c)

	)

306 
ssize_t
 
	$wrôe_wöc⁄
(
fd
, c⁄° *
buf
, 
size_t
 
cou¡
)

308 
HANDLE
 
h™dÀ
 = 
NULL
;

309 
DWORD
 
mode
, 
wcou¡
 = 0;

310 
BOOL
 
suc˚ss
;

312 if(
fd
 =
	`fûío
(
°dout
)) {

313 
h™dÀ
 = 
	`GëStdH™dÀ
(
STD_OUTPUT_HANDLE
);

315 if(
fd
 =
	`fûío
(
°dîr
)) {

316 
h™dÀ
 = 
	`GëStdH™dÀ
(
STD_ERROR_HANDLE
);

319  
	`wrôe
(
fd
, 
buf
, 
cou¡
);

322 if(
	`GëC⁄sﬁeMode
(
h™dÀ
, &
mode
)) {

323 
suc˚ss
 = 
	`WrôeC⁄sﬁe
(
h™dÀ
, 
buf
, 
cou¡
, &
wcou¡
, 
NULL
);

326 
suc˚ss
 = 
	`WrôeFûe
(
h™dÀ
, 
buf
, 
cou¡
, &
wcou¡
, 
NULL
);

328 if(
suc˚ss
) {

329  
wcou¡
;

332 
î∫o
 = 
	`GëLa°Eº‹
();

334 
	}
}

335 #unde‡
wrôe


336 
	#wrôe
(
a
,
b
,
c
Ë
	`wrôe_wöc⁄
◊,b,c)

	)

346 
ssize_t
 
	$fuŒªad
(
fûedes
, *
buf„r
, 
size_t
 
nbyãs
)

348 
îr‹
;

349 
ssize_t
 
rc
;

350 
ssize_t
 
ƒód
 = 0;

353 
rc
 = 
	`ªad
(
fûedes
, (*)
buf„r
 + 
ƒód
, 
nbyãs
 -Çread);

355 if(
gŸ_exô_sig«l
) {

356 
	`logmsg
("signalledÅo die");

360 if(
rc
 < 0) {

361 
îr‹
 = 
î∫o
;

362 if((
îr‹
 =
EINTR
Ë|| (îr‹ =
EAGAIN
))

364 
	`logmsg
("ªadög from fûêdes¸ùt‹: %d,", 
fûedes
);

365 
	`logmsg
("unrecoverableÑead() failure: (%d) %s",

366 
îr‹
, 
	`°ªº‹
(error));

370 if(
rc
 == 0) {

371 
	`logmsg
("got 0Ñeading from stdin");

375 
ƒód
 +
rc
;

377 } (
size_t
)
ƒód
 < 
nbyãs
);

379 if(
vîbo£
)

380 
	`logmsg
("ªad %zd byãs", 
ƒód
);

382  
ƒód
;

383 
	}
}

392 
ssize_t
 
	$fuŒwrôe
(
fûedes
, c⁄° *
buf„r
, 
size_t
 
nbyãs
)

394 
îr‹
;

395 
ssize_t
 
wc
;

396 
ssize_t
 
nwrôe
 = 0;

399 
wc
 = 
	`wrôe
(
fûedes
, (*)
buf„r
 + 
nwrôe
, 
nbyãs
 -Çwrite);

401 if(
gŸ_exô_sig«l
) {

402 
	`logmsg
("signalledÅo die");

406 if(
wc
 < 0) {

407 
îr‹
 = 
î∫o
;

408 if((
îr‹
 =
EINTR
Ë|| (îr‹ =
EAGAIN
))

410 
	`logmsg
("wrôögÅÿfûêdes¸ùt‹: %d,", 
fûedes
);

411 
	`logmsg
("unrecoverable write() failure: (%d) %s",

412 
îr‹
, 
	`°ªº‹
(error));

416 if(
wc
 == 0) {

417 
	`logmsg
("put 0 writingÅo stdout");

421 
nwrôe
 +
wc
;

423 } (
size_t
)
nwrôe
 < 
nbyãs
);

425 if(
vîbo£
)

426 
	`logmsg
("wrŸê%zd byãs", 
nwrôe
);

428  
nwrôe
;

429 
	}
}

438 
boﬁ
 
	$ªad_°dö
(*
buf„r
, 
size_t
 
nbyãs
)

440 
ssize_t
 
ƒód
 = 
	`fuŒªad
(
	`fûío
(
°dö
), 
buf„r
, 
nbyãs
);

441 if(
ƒód
 !(
ssize_t
)
nbyãs
) {

442 
	`logmsg
("exiting...");

443  
FALSE
;

445  
TRUE
;

446 
	}
}

455 
boﬁ
 
	$wrôe_°dout
(c⁄° *
buf„r
, 
size_t
 
nbyãs
)

457 
ssize_t
 
nwrôe
 = 
	`fuŒwrôe
(
	`fûío
(
°dout
), 
buf„r
, 
nbyãs
);

458 if(
nwrôe
 !(
ssize_t
)
nbyãs
) {

459 
	`logmsg
("exiting...");

460  
FALSE
;

462  
TRUE
;

463 
	}
}

465 
	$logøw
(*
buf„r
, 
ssize_t
 
Àn
)

467 
d©a
[120];

468 
ssize_t
 
i
;

469 *
±r
 = 
buf„r
;

470 *
›å
 = 
d©a
;

471 
ssize_t
 
width
=0;

473 
i
=0; i<
Àn
; i++) {

474 
±r
[
i
]) {

476 
	`•rötf
(
›å
, "\\n");

477 
width
 += 2;

478 
›å
 += 2;

481 
	`•rötf
(
›å
, "\\r");

482 
width
 += 2;

483 
›å
 += 2;

486 
	`•rötf
(
›å
, "%c", (
	`ISGRAPH
(
±r
[
i
]) ||Ötr[i]==0x20) ?ptr[i]:'.');

487 
width
++;

488 
›å
++;

492 if(
width
>60) {

493 
	`logmsg
("'%s'", 
d©a
);

494 
width
 = 0;

495 
›å
 = 
d©a
;

498 if(
width
)

499 
	`logmsg
("'%s'", 
d©a
);

500 
	}
}

502 #ifde‡
USE_WINSOCK


515 
	s£À˘_ws_waô_d©a
 {

516 
HANDLE
 
	mh™dÀ
;

517 
HANDLE
 
	mevít
;

519 
DWORD
 
WINAPI
 
	$£À˘_ws_waô_thªad
(
LPVOID
 
ÕP¨amëî
)

521 
£À˘_ws_waô_d©a
 *
d©a
;

522 
HANDLE
 
h™dÀ
, 
h™dÀs
[2];

523 
INPUT_RECORD
 
öpuåec‹d
;

524 
LARGE_INTEGER
 
size
, 
pos
;

525 
DWORD
 
ty≥
, 
Àngth
;

528 
d©a
 = (
£À˘_ws_waô_d©a
 *Ë
ÕP¨amëî
;

529 if(
d©a
) {

530 
h™dÀ
 = 
d©a
->handle;

531 
h™dÀs
[0] = 
d©a
->
evít
;

532 
h™dÀs
[1] = 
h™dÀ
;

533 
	`‰ì
(
d©a
);

539 
ty≥
 = 
	`GëFûeTy≥
(
h™dÀ
);

540 
ty≥
) {

541 
FILE_TYPE_DISK
:

550 
	`WaôF‹Mu…ùÀObje˘sEx
(2, 
h™dÀs
, 
FALSE
, 
INFINITE
, FALSE)

551 =
WAIT_OBJECT_0
 + 1) {

553 
size
.
QuadP¨t
 = 0;

554 if(
	`GëFûeSizeEx
(
h™dÀ
, &
size
)) {

556 
pos
.
QuadP¨t
 = 0;

557 if(
	`SëFûePoöãrEx
(
h™dÀ
, 
pos
, &pos, 
FILE_CURRENT
)) {

559 if(
size
.
QuadP¨t
 =
pos
.QuadPart) {

561 
	`SÀïEx
(100, 
FALSE
);

571 
FILE_TYPE_CHAR
:

579 
	`WaôF‹Mu…ùÀObje˘sEx
(2, 
h™dÀs
, 
FALSE
, 
INFINITE
, FALSE)

580 =
WAIT_OBJECT_0
 + 1) {

582 if(
	`GëC⁄sﬁeMode
(
h™dÀ
, &
Àngth
)) {

584 
Àngth
 = 0;

585 if(
	`PìkC⁄sﬁeI≈ut
(
h™dÀ
, &
öpuåec‹d
, 1, &
Àngth
)) {

587 if(
Àngth
 =1 && 
öpuåec‹d
.
EvítTy≥
 !
KEY_EVENT
) {

589 
	`RódC⁄sﬁeI≈ut
(
h™dÀ
, &
öpuåec‹d
, 1, &
Àngth
);

599 
FILE_TYPE_PIPE
:

607 
	`WaôF‹Mu…ùÀObje˘sEx
(2, 
h™dÀs
, 
FALSE
, 
INFINITE
, FALSE)

608 =
WAIT_OBJECT_0
 + 1) {

610 if(
	`PìkNamedPùe
(
h™dÀ
, 
NULL
, 0, NULL, &
Àngth
, NULL)) {

612 if(
Àngth
 == 0) {

613 
	`SÀïEx
(100, 
FALSE
);

619 if(
	`GëLa°Eº‹
(Ë=
ERROR_BROKEN_PIPE
) {

620 
	`SÀïEx
(100, 
FALSE
);

631 
	`WaôF‹Mu…ùÀObje˘sEx
(2, 
h™dÀs
, 
FALSE
, 
INFINITE
, FALSE);

636 
	}
}

637 
HANDLE
 
	$£À˘_ws_waô
(
HANDLE
 
h™dÀ
, HANDLE 
evít
)

639 
£À˘_ws_waô_d©a
 *
d©a
;

640 
HANDLE
 
thªad
 = 
NULL
;

643 
d©a
 = 
	`mÆloc
((
£À˘_ws_waô_d©a
));

644 if(
d©a
) {

645 
d©a
->
h™dÀ
 = handle;

646 
d©a
->
evít
 =Évent;

649 
thªad
 = 
	`Cª©eThªad
(
NULL
, 0,

650 &
£À˘_ws_waô_thªad
,

651 
d©a
, 0, 
NULL
);

654 if(!
thªad
) {

655 
	`‰ì
(
d©a
);

659  
thªad
;

660 
	}
}

661 
	$£À˘_ws
(
nfds
, 
fd_£t
 *
ªadfds
, fd_£à*
wrôefds
,

662 
fd_£t
 *
ex˚±fds
, 
timevÆ
 *
timeout
)

664 
DWORD
 
mûli£c⁄ds
, 
waô
, 
idx
;

665 
WSAEVENT
 
wßevít
, *
wßevíts
;

666 
WSANETWORKEVENTS
 
wß√ãvíts
;

667 
HANDLE
 
h™dÀ
, *
h™dÀs
, *
thªads
;

668 
cuæ_sockë_t
 
sock
, *
fd¨r
, *
wßsocks
;

669 
√tw‹kevíts
;

670 
îr‹
, 
fds
;

671 
HANDLE
 
waôevít
 = 
NULL
;

672 
DWORD
 
nfd
 = 0, 
thd
 = 0, 
wß
 = 0;

673 
ªt
 = 0;

676 if(
nfds
 < 0) {

677 
î∫o
 = 
EINVAL
;

682 if(!
nfds
) {

683 
	`SÀï
((
timeout
->
tv_£c
 * 1000Ë+ (timeout->
tv_u£c
 / 1000));

688 
waôevít
 = 
	`Cª©eEvít
(
NULL
, 
TRUE
, 
FALSE
, NULL);

689 if(!
waôevít
) {

690 
î∫o
 = 
ENOMEM
;

695 
fd¨r
 = 
	`mÆloc
(
nfds
 * (
cuæ_sockë_t
));

696 if(
fd¨r
 =
NULL
) {

697 
î∫o
 = 
ENOMEM
;

702 
h™dÀs
 = 
	`mÆloc
(
nfds
 * (
HANDLE
));

703 if(
h™dÀs
 =
NULL
) {

704 
	`‰ì
(
fd¨r
);

705 
î∫o
 = 
ENOMEM
;

710 
thªads
 = 
	`mÆloc
(
nfds
 * (
HANDLE
));

711 if(
thªads
 =
NULL
) {

712 
	`‰ì
(
h™dÀs
);

713 
	`‰ì
(
fd¨r
);

714 
î∫o
 = 
ENOMEM
;

719 
wßsocks
 = 
	`mÆloc
(
nfds
 * (
cuæ_sockë_t
));

720 if(
wßsocks
 =
NULL
) {

721 
	`‰ì
(
thªads
);

722 
	`‰ì
(
h™dÀs
);

723 
	`‰ì
(
fd¨r
);

724 
î∫o
 = 
ENOMEM
;

729 
wßevíts
 = 
	`mÆloc
(
nfds
 * (
WSAEVENT
));

730 if(
wßevíts
 =
NULL
) {

731 
	`‰ì
(
thªads
);

732 
	`‰ì
(
wßsocks
);

733 
	`‰ì
(
h™dÀs
);

734 
	`‰ì
(
fd¨r
);

735 
î∫o
 = 
ENOMEM
;

740 
fds
 = 0; fd†< 
nfds
; fds++) {

741 
√tw‹kevíts
 = 0;

742 
h™dÀs
[
nfd
] = 0;

744 if(
	`FD_ISSET
(
fds
, 
ªadfds
))

745 
√tw‹kevíts
 |
FD_READ
|
FD_ACCEPT
|
FD_CLOSE
;

747 if(
	`FD_ISSET
(
fds
, 
wrôefds
))

748 
√tw‹kevíts
 |
FD_WRITE
|
FD_CONNECT
;

750 if(
	`FD_ISSET
(
fds
, 
ex˚±fds
))

751 
√tw‹kevíts
 |
FD_OOB
|
FD_CLOSE
;

754 if(
√tw‹kevíts
) {

755 
fd¨r
[
nfd
] = 
	`cuæx_sôosk
(
fds
);

756 if(
fds
 =
	`fûío
(
°dö
)) {

757 
h™dÀ
 = 
	`GëStdH™dÀ
(
STD_INPUT_HANDLE
);

758 
h™dÀ
 = 
	`£À˘_ws_waô
(h™dÀ, 
waôevít
);

759 
h™dÀs
[
nfd
] = 
h™dÀ
;

760 
thªads
[
thd
] = 
h™dÀ
;

761 
thd
++;

763 if(
fds
 =
	`fûío
(
°dout
)) {

764 
h™dÀs
[
nfd
] = 
	`GëStdH™dÀ
(
STD_OUTPUT_HANDLE
);

766 if(
fds
 =
	`fûío
(
°dîr
)) {

767 
h™dÀs
[
nfd
] = 
	`GëStdH™dÀ
(
STD_ERROR_HANDLE
);

770 
wßevít
 = 
	`WSACª©eEvít
();

771 if(
wßevít
 !
WSA_INVALID_EVENT
) {

772 
îr‹
 = 
	`WSAEvítSñe˘
(
fds
, 
wßevít
, 
√tw‹kevíts
);

773 if(
îr‹
 !
SOCKET_ERROR
) {

774 
h™dÀ
 = (
HANDLE
Ë
wßevít
;

775 
h™dÀs
[
nfd
] = 
h™dÀ
;

776 
wßsocks
[
wß
] = 
	`cuæx_sôosk
(
fds
);

777 
wßevíts
[
wß
] = 
wßevít
;

778 
wß
++;

781 
	`WSAClo£Evít
(
wßevít
);

782 
h™dÀ
 = (
HANDLE
Ë
	`cuæx_sôosk
(
fds
);

783 
h™dÀ
 = 
	`£À˘_ws_waô
(h™dÀ, 
waôevít
);

784 
h™dÀs
[
nfd
] = 
h™dÀ
;

785 
thªads
[
thd
] = 
h™dÀ
;

786 
thd
++;

790 
nfd
++;

795 if(
timeout
) {

796 
mûli£c⁄ds
 = ((
timeout
->
tv_£c
 * 1000Ë+ (timeout->
tv_u£c
 / 1000));

799 
mûli£c⁄ds
 = 
INFINITE
;

803 
waô
 = 
	`WaôF‹Mu…ùÀObje˘sEx
(
nfd
, 
h™dÀs
, 
FALSE
, 
mûli£c⁄ds
, FALSE);

806 
	`SëEvít
(
waôevít
);

809 
idx
 = 0; idx < 
nfd
; idx++) {

810 
h™dÀ
 = 
h™dÀs
[
idx
];

811 
sock
 = 
fd¨r
[
idx
];

812 
fds
 = 
	`cuæx_sktosi
(
sock
);

815 if(
waô
 !
WAIT_FAILED
 && (waô - 
WAIT_OBJECT_0
Ë<
idx
 &&

816 
	`WaôF‹SögÀObje˘Ex
(
h™dÀ
, 0, 
FALSE
Ë=
WAIT_OBJECT_0
) {

818 if(
fds
 =
	`fûío
(
°dö
)) {

820 
	`FD_CLR
(
sock
, 
wrôefds
);

821 
	`FD_CLR
(
sock
, 
ex˚±fds
);

823 if(
fds
 =
	`fûío
(
°dout
Ë|| fd†=fûío(
°dîr
)) {

825 
	`FD_CLR
(
sock
, 
ªadfds
);

826 
	`FD_CLR
(
sock
, 
ex˚±fds
);

830 
wß√ãvíts
.
lNëw‹kEvíts
 = 0;

831 
îr‹
 = 
	`WSAEnumNëw‹kEvíts
(
fds
, 
h™dÀ
, &
wß√ãvíts
);

832 if(
îr‹
 !
SOCKET_ERROR
) {

834 if(!(
wß√ãvíts
.
lNëw‹kEvíts
 & (
FD_READ
|
FD_ACCEPT
|
FD_CLOSE
)))

835 
	`FD_CLR
(
sock
, 
ªadfds
);

838 if(!(
wß√ãvíts
.
lNëw‹kEvíts
 & (
FD_WRITE
|
FD_CONNECT
)))

839 
	`FD_CLR
(
sock
, 
wrôefds
);

851 if(!(
wß√ãvíts
.
lNëw‹kEvíts
 & (
FD_OOB
|
FD_CLOSE
)))

852 
	`FD_CLR
(
sock
, 
ex˚±fds
);

857 if(
	`FD_ISSET
(
sock
, 
ªadfds
Ë|| FD_ISSET(sock, 
wrôefds
) ||

858 
	`FD_ISSET
(
sock
, 
ex˚±fds
)) {

859 
ªt
++;

864 
	`FD_CLR
(
sock
, 
ªadfds
);

865 
	`FD_CLR
(
sock
, 
wrôefds
);

866 
	`FD_CLR
(
sock
, 
ex˚±fds
);

870 
idx
 = 0; idx < 
wß
; idx++) {

871 
	`WSAEvítSñe˘
(
wßsocks
[
idx
], 
NULL
, 0);

872 
	`WSAClo£Evít
(
wßevíts
[
idx
]);

875 
idx
 = 0; idx < 
thd
; idx++) {

876 
	`WaôF‹SögÀObje˘
(
thªads
[
thd
], 
INFINITE
);

877 
	`Clo£H™dÀ
(
thªads
[
thd
]);

880 
	`Clo£H™dÀ
(
waôevít
);

882 
	`‰ì
(
wßevíts
);

883 
	`‰ì
(
wßsocks
);

884 
	`‰ì
(
thªads
);

885 
	`‰ì
(
h™dÀs
);

886 
	`‰ì
(
fd¨r
);

888  
ªt
;

889 
	}
}

890 
	#£À˘
(
a
,
b
,
c
,
d
,
e
Ë
	`£À˘_ws
◊,b,c,d,e)

	)

899 
boﬁ
 
	$juggÀ
(
cuæ_sockë_t
 *
sockfdp
,

900 
cuæ_sockë_t
 
li°ífd
,

901 
sockmode
 *
mode
)

903 
timevÆ
 
timeout
;

904 
fd_£t
 
fds_ªad
;

905 
fd_£t
 
fds_wrôe
;

906 
fd_£t
 
fds_îr
;

907 
cuæ_sockë_t
 
sockfd
 = 
CURL_SOCKET_BAD
;

908 
maxfd
 = -99;

909 
ssize_t
 
rc
;

910 
ssize_t
 
ƒód_sockë
;

911 
ssize_t
 
byãs_wrôãn
;

912 
ssize_t
 
buf„r_Àn
;

913 
îr‹
 = 0;

917 
buf„r
[17010];

918 
d©a
[16];

920 if(
gŸ_exô_sig«l
) {

921 
	`logmsg
("signalledÅo die,Éxiting...");

922  
FALSE
;

925 #ifde‡
HAVE_GETPPID


928 if(
	`gëµid
() <= 1) {

929 
	`logmsg
("process becomes orphan,Éxiting");

930  
FALSE
;

934 
timeout
.
tv_£c
 = 120;

935 
timeout
.
tv_u£c
 = 0;

937 
	`FD_ZERO
(&
fds_ªad
);

938 
	`FD_ZERO
(&
fds_wrôe
);

939 
	`FD_ZERO
(&
fds_îr
);

941 
	`FD_SET
((
cuæ_sockë_t
)
	`fûío
(
°dö
), &
fds_ªad
);

943 *
mode
) {

945 
PASSIVE_LISTEN
:

948 
sockfd
 = 
li°ífd
;

950 
	`FD_SET
(
sockfd
, &
fds_ªad
);

951 
maxfd
 = ()
sockfd
;

954 
PASSIVE_CONNECT
:

956 
sockfd
 = *
sockfdp
;

957 if(
CURL_SOCKET_BAD
 =
sockfd
) {

959 
	`logmsg
("sockë i†-1! o¿%s:%d", 
__FILE__
, 
__LINE__
);

960 
maxfd
 = 0;

964 
	`FD_SET
(
sockfd
, &
fds_ªad
);

965 #ifde‡
USE_WINSOCK


966 
	`FD_SET
(
sockfd
, &
fds_îr
);

968 
maxfd
 = ()
sockfd
;

972 
ACTIVE
:

974 
sockfd
 = *
sockfdp
;

976 if(
CURL_SOCKET_BAD
 !
sockfd
) {

977 
	`FD_SET
(
sockfd
, &
fds_ªad
);

978 #ifde‡
USE_WINSOCK


979 
	`FD_SET
(
sockfd
, &
fds_îr
);

981 
maxfd
 = ()
sockfd
;

984 
	`logmsg
("No socketÅoÑead on");

985 
maxfd
 = 0;

989 
ACTIVE_DISCONNECT
:

991 
	`logmsg
("disconnected,Ço socketÅoÑead on");

992 
maxfd
 = 0;

993 
sockfd
 = 
CURL_SOCKET_BAD
;

1003 
rc
 = 
	`£À˘
(
maxfd
 + 1, &
fds_ªad
, &
fds_wrôe
, &
fds_îr
, &
timeout
);

1005 if(
gŸ_exô_sig«l
) {

1006 
	`logmsg
("signalledÅo die,Éxiting...");

1007  
FALSE
;

1010 } (
rc
 =-1Ë&& ((
îr‹
 = 
î∫o
Ë=
EINTR
));

1012 if(
rc
 < 0) {

1013 
	`logmsg
("select() failed withÉrror: (%d) %s",

1014 
îr‹
, 
	`°ªº‹
(error));

1015  
FALSE
;

1018 if(
rc
 == 0)

1020  
TRUE
;

1023 if(
	`FD_ISSET
(
	`fûío
(
°dö
), &
fds_ªad
)) {

1039 if(!
	`ªad_°dö
(
buf„r
, 5))

1040  
FALSE
;

1042 
	`logmsg
("Received %c%c%c%c (on stdin)",

1043 
buf„r
[0], buffer[1], buffer[2], buffer[3] );

1045 if(!
	`memcmp
("PING", 
buf„r
, 4)) {

1047 if(!
	`wrôe_°dout
("PONG\n", 5))

1048  
FALSE
;

1051 if(!
	`memcmp
("PORT", 
buf„r
, 4)) {

1054 
	`•rötf
((*)
buf„r
, "%s/%hu\n", 
ùv_öu£
, 
p‹t
);

1055 
buf„r_Àn
 = (
ssize_t
)
	`°æí
((*)
buf„r
);

1056 
	`¢¥ötf
(
d©a
, (d©a), "PORT\n%04zx\n", 
buf„r_Àn
);

1057 if(!
	`wrôe_°dout
(
d©a
, 10))

1058  
FALSE
;

1059 if(!
	`wrôe_°dout
(
buf„r
, 
buf„r_Àn
))

1060  
FALSE
;

1062 if(!
	`memcmp
("QUIT", 
buf„r
, 4)) {

1064 
	`logmsg
("quits");

1065  
FALSE
;

1067 if(!
	`memcmp
("DATA", 
buf„r
, 4)) {

1070 if(!
	`ªad_°dö
(
buf„r
, 5))

1071  
FALSE
;

1073 
buf„r
[5] = '\0';

1075 
buf„r_Àn
 = (
ssize_t
)
	`°πﬁ
((*)
buf„r
, 
NULL
, 16);

1076 i‡(
buf„r_Àn
 > (
ssize_t
)(
buf„r
)) {

1077 
	`logmsg
("ERROR: Buffer size (%zu bytes)Åoo small for data size "

1078 "(%zd byãs)", (
buf„r
), 
buf„r_Àn
);

1079  
FALSE
;

1081 
	`logmsg
("> %zd byã†d©a, sîvî => clõ¡", 
buf„r_Àn
);

1083 if(!
	`ªad_°dö
(
buf„r
, 
buf„r_Àn
))

1084  
FALSE
;

1086 
	`logøw
(
buf„r
, 
buf„r_Àn
);

1088 if(*
mode
 =
PASSIVE_LISTEN
) {

1089 
	`logmsg
("*** Weáre disconnected!");

1090 if(!
	`wrôe_°dout
("DISC\n", 5))

1091  
FALSE
;

1095 
byãs_wrôãn
 = 
	`swrôe
(
sockfd
, 
buf„r
, 
buf„r_Àn
);

1096 if(
byãs_wrôãn
 !
buf„r_Àn
) {

1097 
	`logmsg
("Notáll data was sent. BytesÅo send: %zd sent: %zd",

1098 
buf„r_Àn
, 
byãs_wrôãn
);

1102 if(!
	`memcmp
("DISC", 
buf„r
, 4)) {

1104 if(!
	`wrôe_°dout
("DISC\n", 5))

1105  
FALSE
;

1106 if(
sockfd
 !
CURL_SOCKET_BAD
) {

1107 
	`logmsg
("====> Client forcibly disconnected");

1108 
	`s˛o£
(
sockfd
);

1109 *
sockfdp
 = 
CURL_SOCKET_BAD
;

1110 if(*
mode
 =
PASSIVE_CONNECT
)

1111 *
mode
 = 
PASSIVE_LISTEN
;

1113 *
mode
 = 
ACTIVE_DISCONNECT
;

1116 
	`logmsg
("attemptÅo closeálready dead connection");

1117  
TRUE
;

1122 if((
sockfd
 !
CURL_SOCKET_BAD
Ë&& (
	`FD_ISSET
(sockfd, &
fds_ªad
)) ) {

1124 
cuæ_sockë_t
 
√wfd
 = 
CURL_SOCKET_BAD
;

1126 if(*
mode
 =
PASSIVE_LISTEN
) {

1129 
√wfd
 = 
	`ac˚±
(
sockfd
, 
NULL
, NULL);

1130 if(
CURL_SOCKET_BAD
 =
√wfd
) {

1131 
îr‹
 = 
SOCKERRNO
;

1132 
	`logmsg
("accept(%d, NULL, NULL) failed withÉrror: (%d) %s",

1133 
sockfd
, 
îr‹
, 
	`°ªº‹
(error));

1136 
	`logmsg
("====> Client connect");

1137 if(!
	`wrôe_°dout
("CNCT\n", 5))

1138  
FALSE
;

1139 *
sockfdp
 = 
√wfd
;

1140 *
mode
 = 
PASSIVE_CONNECT
;

1142  
TRUE
;

1146 
ƒód_sockë
 = 
	`§ód
(
sockfd
, 
buf„r
, (buffer));

1148 if(
ƒód_sockë
 > 0) {

1149 
	`¢¥ötf
(
d©a
, (d©a), "DATA\n%04zx\n", 
ƒód_sockë
);

1150 if(!
	`wrôe_°dout
(
d©a
, 10))

1151  
FALSE
;

1152 if(!
	`wrôe_°dout
(
buf„r
, 
ƒód_sockë
))

1153  
FALSE
;

1155 
	`logmsg
("< %zd byã†d©a, clõ¡ => sîvî", 
ƒód_sockë
);

1156 
	`logøw
(
buf„r
, 
ƒód_sockë
);

1159 if(
ƒód_sockë
 <= 0

1160 #ifde‡
USE_WINSOCK


1161 || 
	`FD_ISSET
(
sockfd
, &
fds_îr
)

1164 
	`logmsg
("====> Client disconnect");

1165 if(!
	`wrôe_°dout
("DISC\n", 5))

1166  
FALSE
;

1167 
	`s˛o£
(
sockfd
);

1168 *
sockfdp
 = 
CURL_SOCKET_BAD
;

1169 if(*
mode
 =
PASSIVE_CONNECT
)

1170 *
mode
 = 
PASSIVE_LISTEN
;

1172 *
mode
 = 
ACTIVE_DISCONNECT
;

1173  
TRUE
;

1177  
TRUE
;

1178 
	}
}

1180 
cuæ_sockë_t
 
	$sockd´m⁄
(
cuæ_sockë_t
 
sock
,

1181 *
li°íp‹t
)

1184 
§vr_sockaddr_uni⁄_t
 
li°íî
;

1185 
Êag
;

1186 
rc
;

1187 
tŸdñay
 = 0;

1188 
maxªå
 = 10;

1189 
dñay
= 20;

1190 
©ãm±
 = 0;

1191 
îr‹
 = 0;

1194 
©ãm±
++;

1195 
Êag
 = 1;

1196 
rc
 = 
	`£tsock›t
(
sock
, 
SOL_SOCKET
, 
SO_REUSEADDR
,

1197 (*)&
Êag
, (flag));

1198 if(
rc
) {

1199 
îr‹
 = 
SOCKERRNO
;

1200 
	`logmsg
("setsockopt(SO_REUSEADDR) failed withÉrror: (%d) %s",

1201 
îr‹
, 
	`°ªº‹
(error));

1202 if(
maxªå
) {

1203 
rc
 = 
	`waô_ms
(
dñay
);

1204 if(
rc
) {

1206 
îr‹
 = 
î∫o
;

1207 
	`logmsg
("wait_ms() failed withÉrror: (%d) %s",

1208 
îr‹
, 
	`°ªº‹
(error));

1209 
	`s˛o£
(
sock
);

1210  
CURL_SOCKET_BAD
;

1212 if(
gŸ_exô_sig«l
) {

1213 
	`logmsg
("signalledÅo die,Éxiting...");

1214 
	`s˛o£
(
sock
);

1215  
CURL_SOCKET_BAD
;

1217 
tŸdñay
 +
dñay
;

1218 
dñay
 *= 2;

1221 } 
rc
 && 
maxªå
--);

1223 if(
rc
) {

1224 
	`logmsg
("setsockopt(SO_REUSEADDR) failed %dÅimes in %d ms. Error: (%d) %s",

1225 
©ãm±
, 
tŸdñay
, 
îr‹
, 
	`°ªº‹
(error));

1226 
	`logmsg
("Continuingányway...");

1232 #ifde‡
ENABLE_IPV6


1233 if(!
u£_ùv6
) {

1235 
	`mem£t
(&
li°íî
.
ß4
, 0, (listener.sa4));

1236 
li°íî
.
ß4
.
sö_Ámûy
 = 
AF_INET
;

1237 
li°íî
.
ß4
.
sö_addr
.
s_addr
 = 
INADDR_ANY
;

1238 
li°íî
.
ß4
.
sö_p‹t
 = 
	`ht⁄s
(*
li°íp‹t
);

1239 
rc
 = 
	`böd
(
sock
, &
li°íî
.
ß
, ÷i°íî.
ß4
));

1240 #ifde‡
ENABLE_IPV6


1243 
	`mem£t
(&
li°íî
.
ß6
, 0, (listener.sa6));

1244 
li°íî
.
ß6
.
sö6_Ámûy
 = 
AF_INET6
;

1245 
li°íî
.
ß6
.
sö6_addr
 = 
ö6addr_™y
;

1246 
li°íî
.
ß6
.
sö6_p‹t
 = 
	`ht⁄s
(*
li°íp‹t
);

1247 
rc
 = 
	`böd
(
sock
, &
li°íî
.
ß
, ÷i°íî.
ß6
));

1250 if(
rc
) {

1251 
îr‹
 = 
SOCKERRNO
;

1252 
	`logmsg
("Error binding socket onÖort %hu: (%d) %s",

1253 *
li°íp‹t
, 
îr‹
, 
	`°ªº‹
(error));

1254 
	`s˛o£
(
sock
);

1255  
CURL_SOCKET_BAD
;

1258 if(!*
li°íp‹t
) {

1261 
cuæ_sockÀn_t
 
œ_size
;

1262 
§vr_sockaddr_uni⁄_t
 
loˇœddr
;

1263 #ifde‡
ENABLE_IPV6


1264 if(!
u£_ùv6
)

1266 
œ_size
 = (
loˇœddr
.
ß4
);

1267 #ifde‡
ENABLE_IPV6


1269 
œ_size
 = (
loˇœddr
.
ß6
);

1271 
	`mem£t
(&
loˇœddr
.
ß
, 0, (
size_t
)
œ_size
);

1272 if(
	`gësock«me
(
sock
, &
loˇœddr
.
ß
, &
œ_size
) < 0) {

1273 
îr‹
 = 
SOCKERRNO
;

1274 
	`logmsg
("getsockname() failed withÉrror: (%d) %s",

1275 
îr‹
, 
	`°ªº‹
(error));

1276 
	`s˛o£
(
sock
);

1277  
CURL_SOCKET_BAD
;

1279 
loˇœddr
.
ß
.
ß_Ámûy
) {

1280 
AF_INET
:

1281 *
li°íp‹t
 = 
	`¡ohs
(
loˇœddr
.
ß4
.
sö_p‹t
);

1283 #ifde‡
ENABLE_IPV6


1284 
AF_INET6
:

1285 *
li°íp‹t
 = 
	`¡ohs
(
loˇœddr
.
ß6
.
sö6_p‹t
);

1291 if(!*
li°íp‹t
) {

1293 
	`logmsg
("Apparently getsockname() succeeded, withÜistenerÖort zero.");

1294 
	`logmsg
("A validÑeason forÅhis failure isá binary built without");

1295 
	`logmsg
("properÇetworkÜibraryÜinkage. This mightÇot beÅhe only");

1296 
	`logmsg
("reason, but double check it beforeánythingÉlse.");

1297 
	`s˛o£
(
sock
);

1298  
CURL_SOCKET_BAD
;

1303 if(
böd_⁄ly
) {

1304 
	`logmsg
("instructedÅo bindÖort withoutÜistening");

1305  
sock
;

1309 
rc
 = 
	`li°í
(
sock
, 5);

1310 if(0 !
rc
) {

1311 
îr‹
 = 
SOCKERRNO
;

1312 
	`logmsg
("listen(%d, 5) failed withÉrror: (%d) %s",

1313 
sock
, 
îr‹
, 
	`°ªº‹
(error));

1314 
	`s˛o£
(
sock
);

1315  
CURL_SOCKET_BAD
;

1318  
sock
;

1319 
	}
}

1322 
	$maö
(
¨gc
, *
¨gv
[])

1324 
§vr_sockaddr_uni⁄_t
 
me
;

1325 
cuæ_sockë_t
 
sock
 = 
CURL_SOCKET_BAD
;

1326 
cuæ_sockë_t
 
msgsock
 = 
CURL_SOCKET_BAD
;

1327 
wrŸïidfûe
 = 0;

1328 *
pid«me
= (*)".sockfilt.pid";

1329 
boﬁ
 
juggÀ_agaö
;

1330 
rc
;

1331 
îr‹
;

1332 
¨g
=1;

1333 
sockmode
 
mode
 = 
PASSIVE_LISTEN
;

1334 c⁄° *
addr
 = 
NULL
;

1336 
¨gc
>
¨g
) {

1337 if(!
	`°rcmp
("--vîsi⁄", 
¨gv
[
¨g
])) {

1338 
	`¥ötf
("sockfilt IPv4%s\n",

1339 #ifde‡
ENABLE_IPV6


1347 if(!
	`°rcmp
("--vîbo£", 
¨gv
[
¨g
])) {

1348 
vîbo£
 = 
TRUE
;

1349 
¨g
++;

1351 if(!
	`°rcmp
("--pidfûe", 
¨gv
[
¨g
])) {

1352 
¨g
++;

1353 if(
¨gc
>
¨g
)

1354 
pid«me
 = 
¨gv
[
¨g
++];

1356 if(!
	`°rcmp
("--logfûe", 
¨gv
[
¨g
])) {

1357 
¨g
++;

1358 if(
¨gc
>
¨g
)

1359 
£rvîlogfûe
 = 
¨gv
[
¨g
++];

1361 if(!
	`°rcmp
("--ùv6", 
¨gv
[
¨g
])) {

1362 #ifde‡
ENABLE_IPV6


1363 
ùv_öu£
 = "IPv6";

1364 
u£_ùv6
 = 
TRUE
;

1366 
¨g
++;

1368 if(!
	`°rcmp
("--ùv4", 
¨gv
[
¨g
])) {

1370 #ifde‡
ENABLE_IPV6


1371 
ùv_öu£
 = "IPv4";

1372 
u£_ùv6
 = 
FALSE
;

1374 
¨g
++;

1376 if(!
	`°rcmp
("--böd⁄ly", 
¨gv
[
¨g
])) {

1377 
böd_⁄ly
 = 
TRUE
;

1378 
¨g
++;

1380 if(!
	`°rcmp
("--p‹t", 
¨gv
[
¨g
])) {

1381 
¨g
++;

1382 if(
¨gc
>
¨g
) {

1383 *
íd±r
;

1384 
u um
 = 
	`°πoul
(
¨gv
[
¨g
], &
íd±r
, 10);

1385 if((
íd±r
 !
¨gv
[
¨g
] + 
	`°æí
(argv[arg])) ||

1386 ((
u um
 != 0UL) && ((ulnum < 1025UL) || (ulnum > 65535UL)))) {

1387 
	`Ârötf
(
°dîr
, "sockfilt: invalid --portárgument (%s)\n",

1388 
¨gv
[
¨g
]);

1391 
p‹t
 = 
	`cuæx_u…ous
(
u um
);

1392 
¨g
++;

1395 if(!
	`°rcmp
("--c⁄√˘", 
¨gv
[
¨g
])) {

1398 
¨g
++;

1399 if(
¨gc
>
¨g
) {

1400 *
íd±r
;

1401 
u um
 = 
	`°πoul
(
¨gv
[
¨g
], &
íd±r
, 10);

1402 if((
íd±r
 !
¨gv
[
¨g
] + 
	`°æí
(argv[arg])) ||

1403 (
u um
 < 1025UL) || (ulnum > 65535UL)) {

1404 
	`Ârötf
(
°dîr
, "sockfilt: invalid --connectárgument (%s)\n",

1405 
¨gv
[
¨g
]);

1408 
c⁄√˘p‹t
 = 
	`cuæx_u…ous
(
u um
);

1409 
¨g
++;

1412 if(!
	`°rcmp
("--addr", 
¨gv
[
¨g
])) {

1414 
¨g
++;

1415 if(
¨gc
>
¨g
) {

1416 
addr
 = 
¨gv
[
¨g
];

1417 
¨g
++;

1421 
	`puts
("Usage: sockfilt [option]\n"

1436 #ifde‡
WIN32


1437 
	`wö32_öô
();

1438 
	`©exô
(
wö32_˛ónup
);

1440 
	`£tmode
(
	`fûío
(
°dö
), 
O_BINARY
);

1441 
	`£tmode
(
	`fûío
(
°dout
), 
O_BINARY
);

1442 
	`£tmode
(
	`fûío
(
°dîr
), 
O_BINARY
);

1445 
	`ö°Æl_sig«l_h™dÀrs
();

1447 #ifde‡
ENABLE_IPV6


1448 if(!
u£_ùv6
)

1450 
sock
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0);

1451 #ifde‡
ENABLE_IPV6


1453 
sock
 = 
	`sockë
(
AF_INET6
, 
SOCK_STREAM
, 0);

1456 if(
CURL_SOCKET_BAD
 =
sock
) {

1457 
îr‹
 = 
SOCKERRNO
;

1458 
	`logmsg
("Error creating socket: (%d) %s",

1459 
îr‹
, 
	`°ªº‹
(error));

1460 
	`wrôe_°dout
("FAIL\n", 5);

1461 
sockfût_˛ónup
;

1464 if(
c⁄√˘p‹t
) {

1466 
mode
 = 
ACTIVE
;

1467 #ifde‡
ENABLE_IPV6


1468 if(!
u£_ùv6
) {

1470 
	`mem£t
(&
me
.
ß4
, 0, (me.sa4));

1471 
me
.
ß4
.
sö_Ámûy
 = 
AF_INET
;

1472 
me
.
ß4
.
sö_p‹t
 = 
	`ht⁄s
(
c⁄√˘p‹t
);

1473 
me
.
ß4
.
sö_addr
.
s_addr
 = 
INADDR_ANY
;

1474 i‡(!
addr
)

1475 
addr
 = "127.0.0.1";

1476 
	`Cuæ_öë_±⁄
(
AF_INET
, 
addr
, &
me
.
ß4
.
sö_addr
);

1478 
rc
 = 
	`c⁄√˘
(
sock
, &
me
.
ß
, (me.
ß4
));

1479 #ifde‡
ENABLE_IPV6


1482 
	`mem£t
(&
me
.
ß6
, 0, (me.sa6));

1483 
me
.
ß6
.
sö6_Ámûy
 = 
AF_INET6
;

1484 
me
.
ß6
.
sö6_p‹t
 = 
	`ht⁄s
(
c⁄√˘p‹t
);

1485 i‡(!
addr
)

1486 
addr
 = "::1";

1487 
	`Cuæ_öë_±⁄
(
AF_INET6
, 
addr
, &
me
.
ß6
.
sö6_addr
);

1489 
rc
 = 
	`c⁄√˘
(
sock
, &
me
.
ß
, (me.
ß6
));

1492 if(
rc
) {

1493 
îr‹
 = 
SOCKERRNO
;

1494 
	`logmsg
("Error connectingÅoÖort %hu: (%d) %s",

1495 
c⁄√˘p‹t
, 
îr‹
, 
	`°ªº‹
(error));

1496 
	`wrôe_°dout
("FAIL\n", 5);

1497 
sockfût_˛ónup
;

1499 
	`logmsg
("====> Client connect");

1500 
msgsock
 = 
sock
;

1504 
sock
 = 
	`sockd´m⁄
(sock, &
p‹t
);

1505 if(
CURL_SOCKET_BAD
 =
sock
) {

1506 
	`wrôe_°dout
("FAIL\n", 5);

1507 
sockfût_˛ónup
;

1509 
msgsock
 = 
CURL_SOCKET_BAD
;

1512 
	`logmsg
("Ru¬ög %†vîsi⁄", 
ùv_öu£
);

1514 if(
c⁄√˘p‹t
)

1515 
	`logmsg
("C⁄√˘edÅÿp‹à%hu", 
c⁄√˘p‹t
);

1516 if(
böd_⁄ly
)

1517 
	`logmsg
("Bound wôhouàli°íög o¿p‹à%hu", 
p‹t
);

1519 
	`logmsg
("Li°íög o¿p‹à%hu", 
p‹t
);

1521 
wrŸïidfûe
 = 
	`wrôe_pidfûe
(
pid«me
);

1522 if(!
wrŸïidfûe
) {

1523 
	`wrôe_°dout
("FAIL\n", 5);

1524 
sockfût_˛ónup
;

1528 
juggÀ_agaö
 = 
	`juggÀ
(&
msgsock
, 
sock
, &
mode
);

1529 } 
juggÀ_agaö
);

1531 
sockfût_˛ónup
:

1533 if((
msgsock
 !
sock
Ë&& (msgsock !
CURL_SOCKET_BAD
))

1534 
	`s˛o£
(
msgsock
);

1536 if(
sock
 !
CURL_SOCKET_BAD
)

1537 
	`s˛o£
(
sock
);

1539 if(
wrŸïidfûe
)

1540 
	`u∆ök
(
pid«me
);

1542 
	`ª°‹e_sig«l_h™dÀrs
();

1544 if(
gŸ_exô_sig«l
) {

1545 
	`logmsg
("============> sockfûàexô†wôh sig«»(%d)", 
exô_sig«l
);

1551 
	`øi£
(
exô_sig«l
);

1554 
	`logmsg
("============> sockfilt quits");

1556 
	}
}

	@tests/server/sws.c

22 
	~"£rvî_£tup.h
"

31 #ifde‡
HAVE_SIGNAL_H


32 
	~<sig«l.h
>

34 #ifde‡
HAVE_NETINET_IN_H


35 
	~<√töë/ö.h
>

37 #ifde‡
HAVE_ARPA_INET_H


38 
	~<¨∑/öë.h
>

40 #ifde‡
HAVE_NETDB_H


41 
	~<√tdb.h
>

43 #ifde‡
HAVE_NETINET_TCP_H


44 
	~<√töë/t˝.h
>

47 
	#ENABLE_CURLX_PRINTF


	)

50 
	~"cuæx.h
"

51 
	~"gë∑π.h
"

52 
	~"öë_±⁄.h
"

53 
	~"utû.h
"

54 
	~"£rvî_sockaddr.h
"

57 
	~"memdebug.h
"

59 #ifde‡
USE_WINSOCK


60 #unde‡
EINTR


61 
	#EINTR
 4

	)

62 #unde‡
EAGAIN


63 
	#EAGAIN
 11

	)

64 #unde‡
ERANGE


65 
	#ERANGE
 34

	)

68 #ifde‡
ENABLE_IPV6


69 
boﬁ
 
	gu£_ùv6
 = 
FALSE
;

71 
boﬁ
 
	gu£_g›hî
 = 
FALSE
;

72 c⁄° *
	gùv_öu£
 = "IPv4";

73 
	g£rvîlog¶ocked
 = 0;

74 
boﬁ
 
	gis_¥oxy
 = 
FALSE
;

76 
	#REQBUFSIZ
 150000

	)

77 
	#REQBUFSIZ_TXT
 "149999"

	)

79 
	g¥evã°no
=-1;

80 
	g¥ev∑πno
=-1;

81 
boﬁ
 
	g¥evboun˚
=
FALSE
;

85 
	#RCMD_NORMALREQ
 0

	)

86 
	#RCMD_IDLE
 1

	)

87 
	#RCMD_STREAM
 2

	)

89 
	shâ¥eque°
 {

90 
	mªqbuf
[
REQBUFSIZ
];

91 
boﬁ
 
	mc⁄√˘_ªque°
;

92 
	mc⁄√˘_p‹t
;

93 
size_t
 
	mchecködex
;

94 
size_t
 
	moff£t
;

95 
	mã°no
;

96 
	m∑πno
;

97 
boﬁ
 
	m›í
;

98 
boﬁ
 
	mauth_ªq
;

100 
boﬁ
 
	mauth
;

101 
size_t
 
	m˛
;

102 
boﬁ
 
	mdige°
;

103 
boﬁ
 
	m¡lm
;

104 
	mwrôedñay
;

106 
	mpùe
;

108 
	mskù
;

112 
	mrcmd
;

113 
	m¥Ÿ_vîsi⁄
;

114 
boﬁ
 
	mpùñöög
;

115 
	mˇŒcou¡
;

116 
boﬁ
 
	mc⁄nm⁄
;

117 
	md⁄e_¥o˚ssög
;

120 
	#MAX_SOCKETS
 1024

	)

122 
cuæ_sockë_t
 
	gÆl_sockës
[
MAX_SOCKETS
];

123 
size_t
 
	gnum_sockës
 = 0;

125 
Pro˚ssReque°
(
hâ¥eque°
 *
ªq
);

126 
°‹îeque°
(*
ªqbuf
, 
size_t
 
tŸÆsize
);

128 
	#DEFAULT_PORT
 8999

	)

130 #i‚de‡
DEFAULT_LOGFILE


131 
	#DEFAULT_LOGFILE
 "log/sws.log"

	)

134 c⁄° *
	g£rvîlogfûe
 = 
DEFAULT_LOGFILE
;

136 
	#SWSVERSION
 "cURLÅe° suôêHTTP sîvî/0.1"

	)

138 
	#REQUEST_DUMP
 "log/£rvî.öput"

	)

139 
	#RESPONSE_DUMP
 "log/£rvî.ª•⁄£"

	)

143 
	#REQUEST_PROXY_DUMP
 "log/¥oxy.öput"

	)

144 
	#RESPONSE_PROXY_DUMP
 "log/¥oxy.ª•⁄£"

	)

147 
	#MAXDOCNAMELEN
 140000

	)

148 
	#MAXDOCNAMELEN_TXT
 "139999"

	)

150 
	#REQUEST_KEYWORD_SIZE
 256

	)

151 
	#REQUEST_KEYWORD_SIZE_TXT
 "255"

	)

153 
	#CMD_AUTH_REQUIRED
 "auth_ªquúed"

	)

157 
	#CMD_IDLE
 "idÀ"

	)

160 
	#CMD_STREAM
 "°ªam"

	)

165 
	#CMD_CONNECTIONMONITOR
 "c⁄√˘i⁄-m⁄ô‹"

	)

167 
	#END_OF_HEADERS
 "\r\n\r\n"

	)

170 
	mDOCNUMBER_NOTHING
 = -4,

171 
	mDOCNUMBER_QUIT
 = -3,

172 
	mDOCNUMBER_WERULEZ
 = -2,

173 
	mDOCNUMBER_404
 = -1

176 c⁄° *
	gíd_of_hódîs
 = 
END_OF_HEADERS
;

179 c⁄° *
	gdocquô
 =

180 "HTTP/1.1 200 Goodbye" 
END_OF_HEADERS
;

183 c⁄° *
	gdoc404
 = "HTTP/1.1 404 Not Found\r\n"

184 "Sîvî: " 
SWSVERSION
 "\r\n"

187 
END_OF_HEADERS


194 "<P><HR><ADDRESS>" 
SWSVERSION
 "</ADDRESS>\n" "</BODY></HTML>\n";

198 #i‚de‡
HAVE_SIGINTERRUPT


199 
	#sigöãºu±
(
x
,
y
Ëdÿ{} 0)

	)

204 
	$RETSIGTYPE
 (*
	tSIGHANDLER_T
)();

206 #ifde‡
SIGHUP


207 
SIGHANDLER_T
 
ﬁd_sighup_h™dÀr
 = 
SIG_ERR
;

210 #ifde‡
SIGPIPE


211 
SIGHANDLER_T
 
ﬁd_sigpùe_h™dÀr
 = 
SIG_ERR
;

214 #ifde‡
SIGALRM


215 
SIGHANDLER_T
 
ﬁd_sigÆrm_h™dÀr
 = 
SIG_ERR
;

218 #ifde‡
SIGINT


219 
SIGHANDLER_T
 
ﬁd_sigöt_h™dÀr
 = 
SIG_ERR
;

222 #ifde‡
SIGTERM


223 
SIGHANDLER_T
 
ﬁd_sigãrm_h™dÀr
 = 
SIG_ERR
;

226 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

227 
SIGHANDLER_T
 
ﬁd_sigbªak_h™dÀr
 = 
SIG_ERR
;

232 
SIG_ATOMIC_T
 
gŸ_exô_sig«l
 = 0;

236 vﬁ©ûê
exô_sig«l
 = 0;

243 
RETSIGTYPE
 
	$exô_sig«l_h™dÀr
(
signum
)

245 
ﬁd_î∫o
 = 
î∫o
;

246 if(
gŸ_exô_sig«l
 == 0) {

247 
gŸ_exô_sig«l
 = 1;

248 
exô_sig«l
 = 
signum
;

250 ()
	`sig«l
(
signum
, 
exô_sig«l_h™dÀr
);

251 
î∫o
 = 
ﬁd_î∫o
;

252 
	}
}

254 
	$ö°Æl_sig«l_h™dÀrs
()

256 #ifde‡
SIGHUP


258 if((
ﬁd_sighup_h™dÀr
 = 
	`sig«l
(
SIGHUP
, 
SIG_IGN
)Ë=
SIG_ERR
)

259 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGHUP h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

261 #ifde‡
SIGPIPE


263 if((
ﬁd_sigpùe_h™dÀr
 = 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
)Ë=
SIG_ERR
)

264 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGPIPE h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

266 #ifde‡
SIGALRM


268 if((
ﬁd_sigÆrm_h™dÀr
 = 
	`sig«l
(
SIGALRM
, 
SIG_IGN
)Ë=
SIG_ERR
)

269 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGALRM h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

271 #ifde‡
SIGINT


273 if((
ﬁd_sigöt_h™dÀr
 = 
	`sig«l
(
SIGINT
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

274 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGINT h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

276 
	`sigöãºu±
(
SIGINT
, 1);

278 #ifde‡
SIGTERM


280 if((
ﬁd_sigãrm_h™dÀr
 = 
	`sig«l
(
SIGTERM
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

281 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGTERM h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

283 
	`sigöãºu±
(
SIGTERM
, 1);

285 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

287 if((
ﬁd_sigbªak_h™dÀr
 = 
	`sig«l
(
SIGBREAK
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

288 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGBREAK h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

290 
	`sigöãºu±
(
SIGBREAK
, 1);

292 
	}
}

294 
	$ª°‹e_sig«l_h™dÀrs
()

296 #ifde‡
SIGHUP


297 if(
SIG_ERR
 !
ﬁd_sighup_h™dÀr
)

298 ()
	`sig«l
(
SIGHUP
, 
ﬁd_sighup_h™dÀr
);

300 #ifde‡
SIGPIPE


301 if(
SIG_ERR
 !
ﬁd_sigpùe_h™dÀr
)

302 ()
	`sig«l
(
SIGPIPE
, 
ﬁd_sigpùe_h™dÀr
);

304 #ifde‡
SIGALRM


305 if(
SIG_ERR
 !
ﬁd_sigÆrm_h™dÀr
)

306 ()
	`sig«l
(
SIGALRM
, 
ﬁd_sigÆrm_h™dÀr
);

308 #ifde‡
SIGINT


309 if(
SIG_ERR
 !
ﬁd_sigöt_h™dÀr
)

310 ()
	`sig«l
(
SIGINT
, 
ﬁd_sigöt_h™dÀr
);

312 #ifde‡
SIGTERM


313 if(
SIG_ERR
 !
ﬁd_sigãrm_h™dÀr
)

314 ()
	`sig«l
(
SIGTERM
, 
ﬁd_sigãrm_h™dÀr
);

316 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

317 if(
SIG_ERR
 !
ﬁd_sigbªak_h™dÀr
)

318 ()
	`sig«l
(
SIGBREAK
, 
ﬁd_sigbªak_h™dÀr
);

320 
	}
}

323 
	$∑r£_£rvîcmd
(
hâ¥eque°
 *
ªq
)

325 
FILE
 *
°ªam
;

326 *
fûíame
;

327 
îr‹
;

329 
fûíame
 = 
	`ã°2fûe
(
ªq
->
ã°no
);

331 
°ªam
=
	`f›í
(
fûíame
, "rb");

332 if(!
°ªam
) {

333 
îr‹
 = 
î∫o
;

334 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

335 
	`logmsg
(" [1] Eº‹ o≥nög fûe: %s", 
fûíame
);

336 
	`logmsg
(" Couldn'à›íÅe° fûê%ld", 
ªq
->
ã°no
);

337 
ªq
->
›í
 = 
FALSE
;

341 *
‹gcmd
 = 
NULL
;

342 *
cmd
 = 
NULL
;

343 
size_t
 
cmdsize
 = 0;

344 
num
=0;

347 
îr‹
 = 
	`gë∑π
(&
‹gcmd
, &
cmdsize
, "ª∂y", "£rvîcmd", 
°ªam
);

348 
	`f˛o£
(
°ªam
);

349 if(
îr‹
) {

350 
	`logmsg
("gë∑π(ËÁûed wôhÉº‹: %d", 
îr‹
);

351 
ªq
->
›í
 = 
FALSE
;

355 
ªq
->
c⁄nm⁄
 = 
FALSE
;

357 
cmd
 = 
‹gcmd
;

358 
cmd
 && 
cmdsize
) {

359 *
check
;

361 if(!
	`°∫cmp
(
CMD_AUTH_REQUIRED
, 
cmd
, 
	`°æí
(CMD_AUTH_REQUIRED))) {

362 
	`logmsg
("instructedÅoÑequireáuthorization header");

363 
ªq
->
auth_ªq
 = 
TRUE
;

365 if(!
	`°∫cmp
(
CMD_IDLE
, 
cmd
, 
	`°æí
(CMD_IDLE))) {

366 
	`logmsg
("instructedÅo idle");

367 
ªq
->
rcmd
 = 
RCMD_IDLE
;

368 
ªq
->
›í
 = 
TRUE
;

370 if(!
	`°∫cmp
(
CMD_STREAM
, 
cmd
, 
	`°æí
(CMD_STREAM))) {

371 
	`logmsg
("instructedÅo stream");

372 
ªq
->
rcmd
 = 
RCMD_STREAM
;

374 if(!
	`°∫cmp
(
CMD_CONNECTIONMONITOR
, 
cmd
,

375 
	`°æí
(
CMD_CONNECTIONMONITOR
))) {

376 
	`logmsg
("enabled connection monitoring");

377 
ªq
->
c⁄nm⁄
 = 
TRUE
;

379 if(1 =
	`ssˇnf
(
cmd
, "pùe: %d", &
num
)) {

380 
	`logmsg
("ö°ru˘edÅÿÆlowáÖùêsizêo‡%d", 
num
);

381 if(
num
 < 0)

382 
	`logmsg
("negativeÖipe size ignored");

383 if(
num
 > 0)

384 
ªq
->
pùe
 = 
num
-1;

387 if(1 =
	`ssˇnf
(
cmd
, "skù: %d", &
num
)) {

388 
	`logmsg
("ö°ru˘edÅÿskùÅhi†numbî o‡byã†%d", 
num
);

389 
ªq
->
skù
 = 
num
;

391 if(1 =
	`ssˇnf
(
cmd
, "wrôedñay: %d", &
num
)) {

392 
	`logmsg
("ö°ru˘edÅÿdñay %d sec†bëwì¿∑ckës", 
num
);

393 
ªq
->
wrôedñay
 = 
num
;

396 
	`logmsg
("Unknow¿<£rvîcmd> in°ru˘i⁄ found: %s", 
cmd
);

399 
check
 = 
	`°rchr
(
cmd
, '\r');

400 if(!
check
)

401 
check
 = 
	`°rchr
(
cmd
, '\n');

403 if(
check
) {

405 (*
check
 == '\r') || (*check == '\n'))

406 
check
++;

408 if(!*
check
)

411 
cmd
 = 
check
;

416 if(
‹gcmd
)

417 
	`‰ì
(
‹gcmd
);

421 
	}
}

423 
	$Pro˚ssReque°
(
hâ¥eque°
 *
ªq
)

425 *
löe
=&
ªq
->
ªqbuf
[ªq->
checködex
];

426 
boﬁ
 
chunked
 = 
FALSE
;

427 
ªque°
[
REQUEST_KEYWORD_SIZE
];

428 
doc
[
MAXDOCNAMELEN
];

429 
logbuf
[456];

430 
¥Ÿ_maj‹
, 
¥Ÿ_mö‹
;

431 *
íd
 = 
	`°r°r
(
löe
, 
íd_of_hódîs
);

433 
ªq
->
ˇŒcou¡
++;

435 
	`logmsg
("Pro˚s†%d byã†ªque°%s", 
ªq
->
off£t
,

436 
ªq
->
ˇŒcou¡
 > 1?" [CONTINUED]":"");

441 if(
u£_g›hî
 &&

442 (
ªq
->
ã°no
 =
DOCNUMBER_NOTHING
) &&

443 !
	`°∫cmp
("/vîifõd£rvî", 
löe
, 15)) {

444 
	`logmsg
("Are-we-friendly questionÑeceived");

445 
ªq
->
ã°no
 = 
DOCNUMBER_WERULEZ
;

449 if((
ªq
->
ã°no
 =
DOCNUMBER_NOTHING
) &&

450 
	`ssˇnf
(
löe
,

451 "%" 
REQUEST_KEYWORD_SIZE_TXT
"†%" 
MAXDOCNAMELEN_TXT
 "s HTTP/%d.%d",

452 
ªque°
,

453 
doc
,

454 &
¥Ÿ_maj‹
,

455 &
¥Ÿ_mö‹
) == 4) {

456 *
±r
;

458 
ªq
->
¥Ÿ_vîsi⁄
 = 
¥Ÿ_maj‹
*10 + 
¥Ÿ_mö‹
;

461 
±r
 = 
	`°ºchr
(
doc
, '/');

464 if(
±r
) {

465 if((
	`°æí
(
doc
Ë+ såÀn(
ªque°
)) < 400)

466 
	`•rötf
(
logbuf
, "GotÑequest: %s %s HTTP/%d.%d",

467 
ªque°
, 
doc
, 
¥Ÿ_maj‹
, 
¥Ÿ_mö‹
);

469 
	`•rötf
(
logbuf
, "Gotá *HUGE*Ñequest HTTP/%d.%d",

470 
¥Ÿ_maj‹
, 
¥Ÿ_mö‹
);

471 
	`logmsg
("%s", 
logbuf
);

473 if(!
	`°∫cmp
("/vîifõd£rvî", 
±r
, 15)) {

474 
	`logmsg
("Are-we-friendly questionÑeceived");

475 
ªq
->
ã°no
 = 
DOCNUMBER_WERULEZ
;

479 if(!
	`°∫cmp
("/quô", 
±r
, 5)) {

480 
	`logmsg
("Request-to-quitÑeceived");

481 
ªq
->
ã°no
 = 
DOCNUMBER_QUIT
;

485 
±r
++;

488 *
±r
 && !
	`ISDIGIT
(*ptr))

489 
±r
++;

491 
ªq
->
ã°no
 = 
	`°πﬁ
(
±r
, &ptr, 10);

493 if(
ªq
->
ã°no
 > 10000) {

494 
ªq
->
∑πno
 =Ñeq->
ã°no
 % 10000;

495 
ªq
->
ã°no
 /= 10000;

498 
ªq
->
∑πno
 = 0;

500 if(
ªq
->
ã°no
) {

502 
	`•rötf
(
logbuf
, "RequestedÅestÇumber %ldÖart %ld",

503 
ªq
->
ã°no
,Ñeq->
∑πno
);

504 
	`logmsg
("%s", 
logbuf
);

507 
	`∑r£_£rvîcmd
(
ªq
);

510 
ªq
->
ã°no
 = 
DOCNUMBER_NOTHING
;

514 if(
ªq
->
ã°no
 =
DOCNUMBER_NOTHING
) {

518 if(
	`ssˇnf
(
ªq
->
ªqbuf
, "CONNECT %" 
MAXDOCNAMELEN_TXT
 "s HTTP/%d.%d",

519 
doc
, &
¥Ÿ_maj‹
, &
¥Ÿ_mö‹
) == 3) {

520 *
p‹ç
 = 
NULL
;

521 
∑π
=0;

523 
	`•rötf
(
logbuf
, "Receivedá CONNECT %s HTTP/%d.%dÑequest",

524 
doc
, 
¥Ÿ_maj‹
, 
¥Ÿ_mö‹
);

525 
	`logmsg
("%s", 
logbuf
);

527 
ªq
->
c⁄√˘_ªque°
 = 
TRUE
;

529 if(
ªq
->
¥Ÿ_vîsi⁄
 == 10)

530 
ªq
->
›í
 = 
FALSE
;

532 if(
doc
[0] == '[') {

533 *
p
 = &
doc
[1];

536 *
p
 && (
	`ISXDIGIT
(*p) || (*p == ':') || (*p == '.'))) {

537 *
ídp
;

538 
∑π
 = 
	`°πoul
(
p
, &
ídp
, 16);

539 if(
	`ISXDIGIT
(*
p
))

540 
p
 = 
ídp
;

542 
p
++;

544 if(*
p
 != ']')

545 
	`logmsg
("Invalid CONNECT IPv6áddress format");

546 i‡(*(
p
+1) != ':')

547 
	`logmsg
("Invalid CONNECT IPv6Öort format");

549 
p‹ç
 = 
p
+1;

551 
ªq
->
ã°no
 = 
∑π
;

554 
p‹ç
 = 
	`°rchr
(
doc
, ':');

556 if(
p‹ç
 && (*’‹ç+1Ë!'\0'Ë&& 
	`ISDIGIT
(*(portp+1))) {

557 
u um
 = 
	`°πoul
(
p‹ç
+1, 
NULL
, 10);

558 if(!
u um
 || (ulnum > 65535UL))

559 
	`logmsg
("Invalid CONNECTÖortÑeceived");

561 
ªq
->
c⁄√˘_p‹t
 = 
	`cuæx_u…ous
(
u um
);

564 
	`logmsg
("PortÇumber: %d,Åest caseÇumber: %ld",

565 
ªq
->
c⁄√˘_p‹t
,Ñeq->
ã°no
);

569 if(
ªq
->
ã°no
 =
DOCNUMBER_NOTHING
) {

575 
±r
 = 
	`°ºchr
(
doc
, '.');

578 if(
±r
) {

579 
±r
++;

581 
ªq
->
ã°no
 = 
	`°πﬁ
(
±r
, &ptr, 10);

583 if(
ªq
->
ã°no
 > 10000) {

584 
ªq
->
∑πno
 =Ñeq->
ã°no
 % 10000;

585 
ªq
->
ã°no
 /= 10000;

587 
	`logmsg
("foundÅe° %d i¿ªque°ed ho°Çame", 
ªq
->
ã°no
);

591 
ªq
->
∑πno
 = 0;

593 
	`•rötf
(
logbuf
, "RequestedÅestÇumber %ldÖart %ld (from hostÇame)",

594 
ªq
->
ã°no
,Ñeq->
∑πno
);

595 
	`logmsg
("%s", 
logbuf
);

599 if(!
ªq
->
ã°no
) {

600 
	`logmsg
("DidÇot findÅestÇumber in PATH");

601 
ªq
->
ã°no
 = 
DOCNUMBER_404
;

604 
	`∑r£_£rvîcmd
(
ªq
);

607 if((
ªq
->
off£t
 >3Ë&& (ªq->
ã°no
 =
DOCNUMBER_NOTHING
)) {

608 
	`logmsg
("** UnusualÑequest. Starts with %02x %02x %02x",

609 
löe
[0],Üine[1],Üine[2]);

612 if(!
íd
) {

614 
	`logmsg
("requestÇot complete yet");

617 
	`logmsg
("-Ñequest foundÅo be complete");

619 if(
u£_g›hî
) {

622 *
±r
;

625 
±r
 = 
	`°ºchr
(
löe
, '/');

627 if(
±r
) {

628 
±r
++;

631 *
±r
 && !
	`ISDIGIT
(*ptr))

632 
±r
++;

634 
ªq
->
ã°no
 = 
	`°πﬁ
(
±r
, &ptr, 10);

636 if(
ªq
->
ã°no
 > 10000) {

637 
ªq
->
∑πno
 =Ñeq->
ã°no
 % 10000;

638 
ªq
->
ã°no
 /= 10000;

641 
ªq
->
∑πno
 = 0;

643 
	`•rötf
(
logbuf
, "Requested GOPHERÅestÇumber %ldÖart %ld",

644 
ªq
->
ã°no
,Ñeq->
∑πno
);

645 
	`logmsg
("%s", 
logbuf
);

649 if(
ªq
->
pùe
)

652 
ªq
->
checködex
 +(
íd
 - 
löe
Ë+ 
	`°æí
(
íd_of_hódîs
);

666 if(
gŸ_exô_sig«l
)

669 if((
ªq
->
˛
==0Ë&& 
	`cuæx_°∫equÆ
("C⁄ã¡-Lígth:", 
löe
, 15)) {

674 *
íd±r
;

675 *
±r
 = 
löe
 + 15;

676 
˛í
 = 0;

677 *
±r
 && 
	`ISSPACE
(*ptr))

678 
±r
++;

679 
íd±r
 = 
±r
;

680 
î∫o
 = 0;

681 
˛í
 = 
	`°πoul
(
±r
, &
íd±r
, 10);

682 if((
±r
 =
íd±r
Ë|| !
	`ISSPACE
(*íd±rË|| (
ERANGE
 =
î∫o
)) {

684 
	`logmsg
("Found invÆid C⁄ã¡-Lígth: (%sËöÅhêªque°", 
±r
);

685 
ªq
->
›í
 = 
FALSE
;

688 
ªq
->
˛
 = 
˛í
 -Ñeq->
skù
;

690 
	`logmsg
("Found C⁄ã¡-Lígth: %lu i¿thêªque°", 
˛í
);

691 if(
ªq
->
skù
)

692 
	`logmsg
("... buàwû»ab‹àa·î %zu byãs", 
ªq
->
˛
);

695 if(
	`cuæx_°∫equÆ
("Tøns„r-Encodög: chunked", 
löe
,

696 
	`°æí
("Transfer-Encoding: chunked"))) {

698 
chunked
 = 
TRUE
;

701 if(
chunked
) {

702 if(
	`°r°r
(
ªq
->
ªqbuf
, "\r\n0\r\n\r\n"))

709 
löe
 = 
	`°rchr
(line, '\n');

710 if(
löe
)

711 
löe
++;

713 } 
löe
);

715 if(!
ªq
->
auth
 && 
	`°r°r
‘eq->
ªqbuf
, "Authorization:")) {

716 
ªq
->
auth
 = 
TRUE
;

717 if(
ªq
->
auth_ªq
)

718 
	`logmsg
("Authorization header found,ásÑequired");

721 if(!
ªq
->
dige°
 && 
	`°r°r
‘eq->
ªqbuf
, "Authorization: Digest")) {

725 
ªq
->
∑πno
 += 1000;

726 
ªq
->
dige°
 = 
TRUE
;

727 
	`logmsg
("Re˚ived Dige°Ñeque°, sídög back d©®%ld", 
ªq
->
∑πno
);

729 if(!
ªq
->
¡lm
 &&

730 
	`°r°r
(
ªq
->
ªqbuf
, "Authorization: NTLM TlRMTVNTUAAD")) {

732 
ªq
->
∑πno
 += 1002;

733 
ªq
->
¡lm
 = 
TRUE
;

734 
	`logmsg
("Re˚ived NTLMÅy≥-3, sídög back d©®%ld", 
ªq
->
∑πno
);

735 if(
ªq
->
˛
) {

736 
	`logmsg
(" Ex≥˘ög %zu POSTed byãs", 
ªq
->
˛
);

739 if(!
ªq
->
¡lm
 &&

740 
	`°r°r
(
ªq
->
ªqbuf
, "Authorization: NTLM TlRMTVNTUAAB")) {

742 
ªq
->
∑πno
 += 1001;

743 
ªq
->
¡lm
 = 
TRUE
;

744 
	`logmsg
("Re˚ived NTLMÅy≥-1, sídög back d©®%ld", 
ªq
->
∑πno
);

746 if((
ªq
->
∑πno
 >= 1000) &&

747 
	`°r°r
(
ªq
->
ªqbuf
, "Authorization: Basic")) {

751 
ªq
->
∑πno
 += 1;

752 
	`logmsg
("Re˚ived Basi¯ªque°, sídög back d©®%ld", 
ªq
->
∑πno
);

754 if(
	`°r°r
(
ªq
->
ªqbuf
, "Connection: close"))

755 
ªq
->
›í
 = 
FALSE
;

757 if(!
ªq
->
pùe
 &&

758 
ªq
->
›í
 &&

759 
ªq
->
¥Ÿ_vîsi⁄
 >= 11 &&

760 
íd
 &&

761 
ªq
->
ªqbuf
 +Ñeq->
off£t
 > 
íd
 + 
	`°æí
(
íd_of_hódîs
) &&

762 !
ªq
->
˛
 &&

763 (!
	`°∫cmp
(
ªq
->
ªqbuf
, "GET", 
	`°æí
("GET")) ||

764 !
	`°∫cmp
(
ªq
->
ªqbuf
, "HEAD", 
	`°æí
("HEAD")))) {

767 
ªq
->
checködex
 = (
íd
 -Ñeq->
ªqbuf
Ë+ 
	`°æí
(
íd_of_hódîs
);

768 
ªq
->
pùñöög
 = 
TRUE
;

771 
ªq
->
pùe
) {

772 if(
gŸ_exô_sig«l
)

775 
löe
 = &
ªq
->
ªqbuf
[ªq->
checködex
];

776 
íd
 = 
	`°r°r
(
löe
, 
íd_of_hódîs
);

777 if(!
íd
)

779 
ªq
->
checködex
 +(
íd
 - 
löe
Ë+ 
	`°æí
(
íd_of_hódîs
);

780 
ªq
->
pùe
--;

787 if(
ªq
->
auth_ªq
 && !ªq->
auth
) {

788 
	`logmsg
("ReturnÉarly dueÅoáuthÑequested byÇoneÖrovided");

792 if(
ªq
->
˛
 > 0) {

793 if(
ªq
->
˛
 <ªq->
off£t
 - (
íd
 -Ñeq->
ªqbuf
Ë- 
	`°æí
(
íd_of_hódîs
))

800 
	}
}

803 
	$°‹îeque°
(*
ªqbuf
, 
size_t
 
tŸÆsize
)

805 
ªs
;

806 
îr‹
 = 0;

807 
size_t
 
wrôãn
;

808 
size_t
 
wrôñe·
;

809 
FILE
 *
dump
;

810 c⁄° *
dumpfûe
=
is_¥oxy
?
REQUEST_PROXY_DUMP
:
REQUEST_DUMP
;

812 i‡(
ªqbuf
 =
NULL
)

814 i‡(
tŸÆsize
 == 0)

818 
dump
 = 
	`f›í
(
dumpfûe
, "ab");

819 } (
dump
 =
NULL
Ë&& ((
îr‹
 = 
î∫o
Ë=
EINTR
));

820 i‡(
dump
 =
NULL
) {

821 
	`logmsg
("[2] Error opening file %sÉrror: %d %s",

822 
dumpfûe
, 
îr‹
, 
	`°ªº‹
(error));

823 
	`logmsg
("FailedÅo writeÑequest input ");

827 
wrôñe·
 = 
tŸÆsize
;

829 
wrôãn
 = 
	`fwrôe
(&
ªqbuf
[
tŸÆsize
-
wrôñe·
],

830 1, 
wrôñe·
, 
dump
);

831 if(
gŸ_exô_sig«l
)

832 
°‹îeque°_˛ónup
;

833 if(
wrôãn
 > 0)

834 
wrôñe·
 -
wrôãn
;

835 } (
wrôñe·
 > 0Ë&& ((
îr‹
 = 
î∫o
Ë=
EINTR
));

837 if(
wrôñe·
 == 0)

838 
	`logmsg
("WrŸêªque° (%zu byãsËöpuàtÿ%s", 
tŸÆsize
, 
dumpfûe
);

839 if(
wrôñe·
 > 0) {

840 
	`logmsg
("Error writing file %sÉrror: %d %s",

841 
dumpfûe
, 
îr‹
, 
	`°ªº‹
(error));

842 
	`logmsg
("Wrote only (%zu bytes) of (%zu bytes)Ñequest inputÅo %s",

843 
tŸÆsize
-
wrôñe·
,ÅŸÆsize, 
dumpfûe
);

846 
°‹îeque°_˛ónup
:

849 
ªs
 = 
	`f˛o£
(
dump
);

850 } 
ªs
 && ((
îr‹
 = 
î∫o
Ë=
EINTR
));

851 if(
ªs
)

852 
	`logmsg
("Error closing file %sÉrror: %d %s",

853 
dumpfûe
, 
îr‹
, 
	`°ªº‹
(error));

854 
	}
}

856 
	$öô_hâ¥eque°
(
hâ¥eque°
 *
ªq
)

861 if(!
ªq
->
pùñöög
) {

862 
ªq
->
checködex
 = 0;

863 
ªq
->
off£t
 = 0;

865 
ªq
->
ã°no
 = 
DOCNUMBER_NOTHING
;

866 
ªq
->
∑πno
 = 0;

867 
ªq
->
c⁄√˘_ªque°
 = 
FALSE
;

868 
ªq
->
›í
 = 
TRUE
;

869 
ªq
->
auth_ªq
 = 
FALSE
;

870 
ªq
->
auth
 = 
FALSE
;

871 
ªq
->
˛
 = 0;

872 
ªq
->
dige°
 = 
FALSE
;

873 
ªq
->
¡lm
 = 
FALSE
;

874 
ªq
->
pùe
 = 0;

875 
ªq
->
skù
 = 0;

876 
ªq
->
wrôedñay
 = 0;

877 
ªq
->
rcmd
 = 
RCMD_NORMALREQ
;

878 
ªq
->
¥Ÿ_vîsi⁄
 = 0;

879 
ªq
->
ˇŒcou¡
 = 0;

880 
ªq
->
c⁄√˘_p‹t
 = 0;

881 
ªq
->
d⁄e_¥o˚ssög
 = 0;

882 
	}
}

886 
	$gë_ªque°
(
cuæ_sockë_t
 
sock
, 
hâ¥eque°
 *
ªq
)

888 
îr‹
;

889 
Áû
 = 0;

890 *
ªqbuf
 = 
ªq
->reqbuf;

891 
ssize_t
 
gŸ
 = 0;

892 
ovîÊow
 = 0;

894 *
pùîeq
 = 
NULL
;

895 
size_t
 
pùîeq_Àngth
 = 0;

897 if(
ªq
->
pùñöög
) {

898 
pùîeq
 = 
ªqbuf
 + 
ªq
->
checködex
;

899 
pùîeq_Àngth
 = 
ªq
->
off£t
 -Ñeq->
checködex
;

903 
ªq
->
pùñöög
 = 
FALSE
;

904 
ªq
->
checködex
 = 0;

905 
ªq
->
off£t
 = 0;

908 if(
ªq
->
off£t
 >
REQBUFSIZ
-1) {

910 
ovîÊow
 = 1;

913 if(
pùîeq_Àngth
 && 
pùîeq
) {

914 
	`memmove
(
ªqbuf
, 
pùîeq
, 
pùîeq_Àngth
);

915 
gŸ
 = 
	`cuæx_uztosz
(
pùîeq_Àngth
);

916 
pùîeq_Àngth
 = 0;

919 if(
ªq
->
skù
)

923 
gŸ
 = 
	`§ód
(
sock
, 
ªqbuf
 + 
ªq
->
off£t
,Ñeq->
˛
);

925 
gŸ
 = 
	`§ód
(
sock
, 
ªqbuf
 + 
ªq
->
off£t
, 
REQBUFSIZ
-1 -Ñeq->offset);

927 if(
gŸ_exô_sig«l
)

929 if(
gŸ
 == 0) {

930 
	`logmsg
("Connection closed by client");

931 
Áû
 = 1;

933 if(
gŸ
 < 0) {

934 
îr‹
 = 
SOCKERRNO
;

935 i‡(
EAGAIN
 =
îr‹
 || 
EWOULDBLOCK
 ==Érror) {

939 
	`logmsg
("ªcv(Ëªtu∫edÉº‹: (%dË%s", 
îr‹
, 
	`°ªº‹
(error));

940 
Áû
 = 1;

942 if(
Áû
) {

944 
ªqbuf
[
ªq
->
off£t
] = '\0';

945 
	`°‹îeque°
(
ªqbuf
, 
ªq
->
off£t
);

949 
	`logmsg
("Ród %zd byãs", 
gŸ
);

951 
ªq
->
off£t
 +(
size_t
)
gŸ
;

952 
ªqbuf
[
ªq
->
off£t
] = '\0';

954 
ªq
->
d⁄e_¥o˚ssög
 = 
	`Pro˚ssReque°
(req);

955 if(
gŸ_exô_sig«l
)

957 if(
ªq
->
d⁄e_¥o˚ssög
 &&Ñeq->
pùe
) {

958 
	`logmsg
("Waiting foránotherÖipedÑequest");

959 
ªq
->
d⁄e_¥o˚ssög
 = 0;

960 
ªq
->
pùe
--;

964 if(
ovîÊow
 || (
ªq
->
off£t
 =
REQBUFSIZ
-1 && 
gŸ
 > 0)) {

965 
	`logmsg
("Request would overflow buffer, closing connection");

967 
ªqbuf
[
REQBUFSIZ
-1] = '\0';

968 
Áû
 = 1;

970 if(
ªq
->
off£t
 > 
REQBUFSIZ
-1) {

971 
	`logmsg
("Request buffer overflow, closing connection");

973 
ªqbuf
[
REQBUFSIZ
-1] = '\0';

974 
Áû
 = 1;

977 
ªqbuf
[
ªq
->
off£t
] = '\0';

980 i‡(
Áû
 || 
ªq
->
d⁄e_¥o˚ssög
)

981 
	`°‹îeque°
(
ªqbuf
, 
ªq
->
pùñöög
 ?Ñeq->
checködex
 :Ñeq->
off£t
);

982 if(
gŸ_exô_sig«l
)

985  
Áû
 ? -1 : 1;

986 
	}
}

989 
	$£nd_doc
(
cuæ_sockë_t
 
sock
, 
hâ¥eque°
 *
ªq
)

991 
ssize_t
 
wrôãn
;

992 
size_t
 
cou¡
;

993 c⁄° *
buf„r
;

994 *
±r
=
NULL
;

995 
FILE
 *
°ªam
;

996 *
cmd
=
NULL
;

997 
size_t
 
cmdsize
=0;

998 
FILE
 *
dump
;

999 
boﬁ
 
≥rsi°™t
 = 
TRUE
;

1000 
boﬁ
 
£ndÁûuª
 = 
FALSE
;

1001 
size_t
 
ª•⁄£size
;

1002 
îr‹
 = 0;

1003 
ªs
;

1004 c⁄° *
ª•⁄£dump
 = 
is_¥oxy
?
RESPONSE_PROXY_DUMP
:
RESPONSE_DUMP
;

1005 
wóª
[256];

1007 
ªq
->
rcmd
) {

1009 
RCMD_NORMALREQ
:

1011 
RCMD_STREAM
:

1012 
	#STREAMTHIS
 "®°rögÅÿ°ªam 01234567890\n"

	)

1013 
cou¡
 = 
	`°æí
(
STREAMTHIS
);

1015 
wrôãn
 = 
	`swrôe
(
sock
, 
STREAMTHIS
, 
cou¡
);

1016 if(
gŸ_exô_sig«l
)

1018 if(
wrôãn
 !(
ssize_t
)
cou¡
) {

1019 
	`logmsg
("Stopped streaming");

1024 
RCMD_IDLE
:

1029 
ªq
->
›í
 = 
FALSE
;

1031 if(
ªq
->
ã°no
 < 0) {

1032 
size_t
 
msgÀn
;

1033 
msgbuf
[64];

1035 
ªq
->
ã°no
) {

1036 
DOCNUMBER_QUIT
:

1037 
	`logmsg
("ReplyingÅo QUIT");

1038 
buf„r
 = 
docquô
;

1040 
DOCNUMBER_WERULEZ
:

1042 
	`logmsg
("Identifying ourselvesás friends");

1043 
	`•rötf
(
msgbuf
, "WE ROOLZ: %ld\r\n", ()
	`gëpid
());

1044 
msgÀn
 = 
	`°æí
(
msgbuf
);

1045 if(
u£_g›hî
)

1046 
	`•rötf
(
wóª
, "%s", 
msgbuf
);

1048 
	`•rötf
(
wóª
, "HTTP/1.1 200 OK\r\nContent-Length: %zu\r\n\r\n%s",

1049 
msgÀn
, 
msgbuf
);

1050 
buf„r
 = 
wóª
;

1052 
DOCNUMBER_404
:

1054 
	`logmsg
("ReplyingÅo withá 404");

1055 
buf„r
 = 
doc404
;

1059 
cou¡
 = 
	`°æí
(
buf„r
);

1062 
∑πbuf
[80];

1063 *
fûíame
 = 
	`ã°2fûe
(
ªq
->
ã°no
);

1067 c⁄° *
£˘i⁄

ªq
->
c⁄√˘_ªque°
?"connect":"data";

1069 if(
ªq
->
∑πno
)

1070 
	`•rötf
(
∑πbuf
, "%s%ld", 
£˘i⁄
, 
ªq
->
∑πno
);

1072 
	`•rötf
(
∑πbuf
, "%s", 
£˘i⁄
);

1074 
	`logmsg
("SídÑe•⁄£Åe°%ld se˘i⁄ <%s>", 
ªq
->
ã°no
, 
∑πbuf
);

1076 
°ªam
=
	`f›í
(
fûíame
, "rb");

1077 if(!
°ªam
) {

1078 
îr‹
 = 
î∫o
;

1079 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

1080 
	`logmsg
(" [3] Eº‹ o≥nög fûe: %s", 
fûíame
);

1084 
îr‹
 = 
	`gë∑π
(&
±r
, &
cou¡
, "ª∂y", 
∑πbuf
, 
°ªam
);

1085 
	`f˛o£
(
°ªam
);

1086 if(
îr‹
) {

1087 
	`logmsg
("gë∑π(ËÁûed wôhÉº‹: %d", 
îr‹
);

1090 
buf„r
 = 
±r
;

1093 if(
gŸ_exô_sig«l
) {

1094 if(
±r
)

1095 
	`‰ì
(
±r
);

1100 
°ªam
=
	`f›í
(
fûíame
, "rb");

1101 if(!
°ªam
) {

1102 
îr‹
 = 
î∫o
;

1103 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

1104 
	`logmsg
(" [4] Eº‹ o≥nög fûe: %s", 
fûíame
);

1105 if(
±r
)

1106 
	`‰ì
(
±r
);

1111 
îr‹
 = 
	`gë∑π
(&
cmd
, &
cmdsize
, "ª∂y", "po°cmd", 
°ªam
);

1112 
	`f˛o£
(
°ªam
);

1113 if(
îr‹
) {

1114 
	`logmsg
("gë∑π(ËÁûed wôhÉº‹: %d", 
îr‹
);

1115 if(
±r
)

1116 
	`‰ì
(
±r
);

1122 if(
gŸ_exô_sig«l
) {

1123 if(
±r
)

1124 
	`‰ì
(
±r
);

1125 if(
cmd
)

1126 
	`‰ì
(
cmd
);

1133 if(
	`°r°r
(
buf„r
, "sws˛o£"Ë|| !
cou¡
) {

1134 
≥rsi°™t
 = 
FALSE
;

1135 
	`logmsg
("connection close instruction \"swsclose\" found inÑesponse");

1137 if(
	`°r°r
(
buf„r
, "swsbounce")) {

1138 
¥evboun˚
 = 
TRUE
;

1139 
	`logmsg
("enable \"swsbounce\" inÅheÇextÑequest");

1142 
¥evboun˚
 = 
FALSE
;

1144 
dump
 = 
	`f›í
(
ª•⁄£dump
, "ab");

1145 if(!
dump
) {

1146 
îr‹
 = 
î∫o
;

1147 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

1148 
	`logmsg
(" [5] Eº‹ o≥nög fûe: %s", 
ª•⁄£dump
);

1149 if(
±r
)

1150 
	`‰ì
(
±r
);

1151 if(
cmd
)

1152 
	`‰ì
(
cmd
);

1156 
ª•⁄£size
 = 
cou¡
;

1161 
size_t
 
num
 = 
cou¡
;

1162 if(
num
 > 200)

1163 
num
 = 200;

1164 
wrôãn
 = 
	`swrôe
(
sock
, 
buf„r
, 
num
);

1165 i‡(
wrôãn
 < 0) {

1166 
£ndÁûuª
 = 
TRUE
;

1170 
	`logmsg
("Síàof‡%zd byãs", 
wrôãn
);

1173 
	`fwrôe
(
buf„r
, 1, (
size_t
)
wrôãn
, 
dump
);

1175 
cou¡
 -
wrôãn
;

1176 
buf„r
 +
wrôãn
;

1178 if(
ªq
->
wrôedñay
) {

1179 
qu¨ãrs
 = 
ªq
->
wrôedñay
 * 4;

1180 
	`logmsg
("Pausög %d sec⁄ds", 
ªq
->
wrôedñay
);

1181 (
qu¨ãrs
 > 0Ë&& !
gŸ_exô_sig«l
) {

1182 
qu¨ãrs
--;

1183 
	`waô_ms
(250);

1186 } (
cou¡
 > 0Ë&& !
gŸ_exô_sig«l
);

1189 
ªs
 = 
	`f˛o£
(
dump
);

1190 } 
ªs
 && ((
îr‹
 = 
î∫o
Ë=
EINTR
));

1191 if(
ªs
)

1192 
	`logmsg
("Error closing file %sÉrror: %d %s",

1193 
ª•⁄£dump
, 
îr‹
, 
	`°ªº‹
(error));

1195 if(
gŸ_exô_sig«l
) {

1196 if(
±r
)

1197 
	`‰ì
(
±r
);

1198 if(
cmd
)

1199 
	`‰ì
(
cmd
);

1203 if(
£ndÁûuª
) {

1204 
	`logmsg
("SendingÑesponse failed. Only (%zu bytes) of (%zu bytes) were sent",

1205 
ª•⁄£size
-
cou¡
,Ñesponsesize);

1206 if(
±r
)

1207 
	`‰ì
(
±r
);

1208 if(
cmd
)

1209 
	`‰ì
(
cmd
);

1213 
	`logmsg
("Response sent (%zu bytes)ánd writtenÅo %s",

1214 
ª•⁄£size
, 
ª•⁄£dump
);

1216 if(
±r
)

1217 
	`‰ì
(
±r
);

1219 if(
cmdsize
 > 0 ) {

1220 
comm™d
[32];

1221 
qu¨ãrs
;

1222 
num
;

1223 
±r
=
cmd
;

1225 if(2 =
	`ssˇnf
(
±r
, "%31†%d", 
comm™d
, &
num
)) {

1226 if(!
	`°rcmp
("waô", 
comm™d
)) {

1227 
	`logmsg
("TﬁdÅÿ¶ì∞f‹ %d sec⁄ds", 
num
);

1228 
qu¨ãrs
 = 
num
 * 4;

1229 (
qu¨ãrs
 > 0Ë&& !
gŸ_exô_sig«l
) {

1230 
qu¨ãrs
--;

1231 
ªs
 = 
	`waô_ms
(250);

1232 if(
ªs
) {

1234 
îr‹
 = 
î∫o
;

1235 
	`logmsg
("wait_ms() failed withÉrror: (%d) %s",

1236 
îr‹
, 
	`°ªº‹
(error));

1240 if(!
qu¨ãrs
)

1241 
	`logmsg
("C⁄töuögá·î sÀïög %d sec⁄ds", 
num
);

1244 
	`logmsg
("Unknown command inÑeply command section");

1246 
±r
 = 
	`°rchr
(ptr, '\n');

1247 if(
±r
)

1248 
±r
++;

1250 
±r
 = 
NULL
;

1251 } 
±r
 && *ptr);

1253 if(
cmd
)

1254 
	`‰ì
(
cmd
);

1256 
ªq
->
›í
 = 
u£_g›hî
?
FALSE
:
≥rsi°™t
;

1258 
¥evã°no
 = 
ªq
->
ã°no
;

1259 
¥ev∑πno
 = 
ªq
->
∑πno
;

1262 
	}
}

1264 
cuæ_sockë_t
 
	$c⁄√˘_to
(c⁄° *
ùaddr
, 
p‹t
)

1266 
§vr_sockaddr_uni⁄_t
 
£rvîaddr
;

1267 
cuæ_sockë_t
 
£rvîfd
;

1268 
îr‹
;

1269 
rc
;

1270 c⁄° *
›_br
 = "";

1271 c⁄° *
˛_br
 = "";

1272 #ifde‡
TCP_NODELAY


1273 
cuæ_sockÀn_t
 
Êag
;

1276 #ifde‡
ENABLE_IPV6


1277 if(
u£_ùv6
) {

1278 
›_br
 = "[";

1279 
˛_br
 = "]";

1283 if(!
ùaddr
)

1284  
CURL_SOCKET_BAD
;

1286 
	`logmsg
("aboutÅo connectÅo %s%s%s:%hu",

1287 
›_br
, 
ùaddr
, 
˛_br
, 
p‹t
);

1289 #ifde‡
ENABLE_IPV6


1290 if(!
u£_ùv6
)

1292 
£rvîfd
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0);

1293 #ifde‡
ENABLE_IPV6


1295 
£rvîfd
 = 
	`sockë
(
AF_INET6
, 
SOCK_STREAM
, 0);

1297 if(
CURL_SOCKET_BAD
 =
£rvîfd
) {

1298 
îr‹
 = 
SOCKERRNO
;

1299 
	`logmsg
("Error creating socket for server conection: (%d) %s",

1300 
îr‹
, 
	`°ªº‹
(error));

1301  
CURL_SOCKET_BAD
;

1304 #ifde‡
TCP_NODELAY


1306 
Êag
 = 1;

1307 if(0 !
	`£tsock›t
(
£rvîfd
, 
IPPROTO_TCP
, 
TCP_NODELAY
,

1308 (*)&
Êag
, (flag)))

1309 
	`logmsg
("====> TCP_NODELAY for server conection failed");

1311 
	`logmsg
("TCP_NODELAY set for server conection");

1314 #ifde‡
ENABLE_IPV6


1315 if(!
u£_ùv6
) {

1317 
	`mem£t
(&
£rvîaddr
.
ß4
, 0, (serveraddr.sa4));

1318 
£rvîaddr
.
ß4
.
sö_Ámûy
 = 
AF_INET
;

1319 
£rvîaddr
.
ß4
.
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

1320 if(
	`Cuæ_öë_±⁄
(
AF_INET
, 
ùaddr
, &
£rvîaddr
.
ß4
.
sö_addr
) < 1) {

1321 
	`logmsg
("Eº‹ i√t_±⁄ faûed AF_INET c⁄vîsi⁄ o‡'%s'", 
ùaddr
);

1322 
	`s˛o£
(
£rvîfd
);

1323  
CURL_SOCKET_BAD
;

1326 
rc
 = 
	`c⁄√˘
(
£rvîfd
, &
£rvîaddr
.
ß
, (£rvîaddr.
ß4
));

1327 #ifde‡
ENABLE_IPV6


1330 
	`mem£t
(&
£rvîaddr
.
ß6
, 0, (serveraddr.sa6));

1331 
£rvîaddr
.
ß6
.
sö6_Ámûy
 = 
AF_INET6
;

1332 
£rvîaddr
.
ß6
.
sö6_p‹t
 = 
	`ht⁄s
(
p‹t
);

1333 if(
	`Cuæ_öë_±⁄
(
AF_INET6
, 
ùaddr
, &
£rvîaddr
.
ß6
.
sö6_addr
) < 1) {

1334 
	`logmsg
("Eº‹ i√t_±⁄ faûed AF_INET6 c⁄vîsi⁄ o‡'%s'", 
ùaddr
);

1335 
	`s˛o£
(
£rvîfd
);

1336  
CURL_SOCKET_BAD
;

1339 
rc
 = 
	`c⁄√˘
(
£rvîfd
, &
£rvîaddr
.
ß
, (£rvîaddr.
ß6
));

1343 if(
gŸ_exô_sig«l
) {

1344 
	`s˛o£
(
£rvîfd
);

1345  
CURL_SOCKET_BAD
;

1348 if(
rc
) {

1349 
îr‹
 = 
SOCKERRNO
;

1350 
	`logmsg
("Error connectingÅo serverÖort %hu: (%d) %s",

1351 
p‹t
, 
îr‹
, 
	`°ªº‹
(error));

1352 
	`s˛o£
(
£rvîfd
);

1353  
CURL_SOCKET_BAD
;

1356 
	`logmsg
("connected fineÅo %s%s%s:%hu,ÇowÅunnel",

1357 
›_br
, 
ùaddr
, 
˛_br
, 
p‹t
);

1359  
£rvîfd
;

1360 
	}
}

1374 
	#d©a_‹_˘æ
(
x
Ë((x)?"DATA":"CTRL")

	)

1376 
	#CTRL
 0

	)

1377 
	#DATA
 1

	)

1379 
	$hâp_c⁄√˘
(
cuæ_sockë_t
 *
öfdp
,

1380 
cuæ_sockë_t
 
roŸfd
,

1381 c⁄° *
ùaddr
,

1382 
ùp‹t
)

1384 
cuæ_sockë_t
 
£rvîfd
[2] = {
CURL_SOCKET_BAD
, CURL_SOCKET_BAD};

1385 
cuæ_sockë_t
 
˛õ¡fd
[2] = {
CURL_SOCKET_BAD
, CURL_SOCKET_BAD};

1386 
ssize_t
 
toc
[2] = {0, 0};

1387 
ssize_t
 
tos
[2] = {0, 0};

1388 
ªad˛õ¡
[2][256];

1389 
ªad£rvî
[2][256];

1390 
boﬁ
 
pﬁl_˛õ¡_rd
[2] = { 
TRUE
, TRUE };

1391 
boﬁ
 
pﬁl_£rvî_rd
[2] = { 
TRUE
, TRUE };

1392 
boﬁ
 
pﬁl_˛õ¡_wr
[2] = { 
TRUE
, TRUE };

1393 
boﬁ
 
pﬁl_£rvî_wr
[2] = { 
TRUE
, TRUE };

1394 #ifde‡
TCP_NODELAY


1395 
cuæ_sockÀn_t
 
Êag
;

1397 
boﬁ
 
¥im¨y
 = 
FALSE
;

1398 
boﬁ
 
£c⁄d¨y
 = 
FALSE
;

1399 
max_tu¬ñ_idx
;

1400 
lo›
;

1401 
i
;

1404 
˛õ¡fd
[
CTRL
] = *
öfdp
;

1409 
lo›
 = 2; (lo› > 0Ë&& !
gŸ_exô_sig«l
;Üoop--)

1410 
	`waô_ms
(250);

1411 if(
gŸ_exô_sig«l
)

1412 
hâp_c⁄√˘_˛ónup
;

1414 
£rvîfd
[
CTRL
] = 
	`c⁄√˘_to
(
ùaddr
, 
ùp‹t
);

1415 if(
£rvîfd
[
CTRL
] =
CURL_SOCKET_BAD
)

1416 
hâp_c⁄√˘_˛ónup
;

1423 
max_tu¬ñ_idx
 = 
CTRL
;

1424 
¥im¨y
 = 
TRUE
;

1426 !
gŸ_exô_sig«l
) {

1428 
fd_£t
 
öput
;

1429 
fd_£t
 
ouçut
;

1430 
timevÆ
 
timeout
 = {0, 250000L};

1431 
ssize_t
 
rc
;

1432 
cuæ_sockë_t
 
maxfd
 = (curl_socket_t)-1;

1434 
	`FD_ZERO
(&
öput
);

1435 
	`FD_ZERO
(&
ouçut
);

1437 if((
˛õ¡fd
[
DATA
] =
CURL_SOCKET_BAD
) &&

1438 (
£rvîfd
[
DATA
] =
CURL_SOCKET_BAD
) &&

1439 
pﬁl_˛õ¡_rd
[
CTRL
] && 
pﬁl_˛õ¡_wr
[CTRL] &&

1440 
pﬁl_£rvî_rd
[
CTRL
] && 
pﬁl_£rvî_wr
[CTRL]) {

1444 
	`FD_SET
(
roŸfd
, &
öput
);

1445 
maxfd
 = 
roŸfd
;

1449 
i
 = 0; i <
max_tu¬ñ_idx
; i++) {

1451 if(
˛õ¡fd
[
i
] !
CURL_SOCKET_BAD
) {

1452 if(
pﬁl_˛õ¡_rd
[
i
]) {

1454 
	`FD_SET
(
˛õ¡fd
[
i
], &
öput
);

1455 if(
˛õ¡fd
[
i
] > 
maxfd
)

1456 
maxfd
 = 
˛õ¡fd
[
i
];

1458 if(
pﬁl_˛õ¡_wr
[
i
] && 
toc
[i]) {

1461 
	`FD_SET
(
˛õ¡fd
[
i
], &
ouçut
);

1462 if(
˛õ¡fd
[
i
] > 
maxfd
)

1463 
maxfd
 = 
˛õ¡fd
[
i
];

1467 if(
£rvîfd
[
i
] !
CURL_SOCKET_BAD
) {

1468 if(
pﬁl_£rvî_rd
[
i
]) {

1470 
	`FD_SET
(
£rvîfd
[
i
], &
öput
);

1471 if(
£rvîfd
[
i
] > 
maxfd
)

1472 
maxfd
 = 
£rvîfd
[
i
];

1474 if(
pﬁl_£rvî_wr
[
i
] && 
tos
[i]) {

1477 
	`FD_SET
(
£rvîfd
[
i
], &
ouçut
);

1478 if(
£rvîfd
[
i
] > 
maxfd
)

1479 
maxfd
 = 
£rvîfd
[
i
];

1483 if(
gŸ_exô_sig«l
)

1486 
rc
 = 
	`£À˘
(()
maxfd
 + 1, &
öput
, &
ouçut
, 
NULL
, &
timeout
);

1488 if(
rc
 > 0) {

1490 
boﬁ
 
t˝_fö_wr
;

1492 if(
gŸ_exô_sig«l
)

1495 
t˝_fö_wr
 = 
FALSE
;

1500 if((
˛õ¡fd
[
DATA
] =
CURL_SOCKET_BAD
) &&

1501 (
£rvîfd
[
DATA
] =
CURL_SOCKET_BAD
Ë&& 
	`FD_ISSET
(
roŸfd
, &
öput
)) {

1503 
cuæ_sockë_t
 
d©afd
 = 
	`ac˚±
(
roŸfd
, 
NULL
, NULL);

1504 if(
d©afd
 !
CURL_SOCKET_BAD
) {

1505 
hâ¥eque°
 
ªq2
;

1506 
îr
 = 0;

1507 
	`mem£t
(&
ªq2
, 0, (req2));

1508 
	`logmsg
("====> Client connect DATA");

1509 #ifde‡
TCP_NODELAY


1511 
Êag
 = 1;

1512 if(0 !
	`£tsock›t
(
d©afd
, 
IPPROTO_TCP
, 
TCP_NODELAY
,

1513 (*)&
Êag
, (flag)))

1514 
	`logmsg
("====> TCP_NODELAY for client DATA conection failed");

1516 
	`logmsg
("TCP_NODELAY set for client DATA conection");

1518 
ªq2
.
pùñöög
 = 
FALSE
;

1519 
	`öô_hâ¥eque°
(&
ªq2
);

1520 !
ªq2
.
d⁄e_¥o˚ssög
) {

1521 
îr
 = 
	`gë_ªque°
(
d©afd
, &
ªq2
);

1522 if(
îr
 < 0) {

1529 if(
îr
 >= 0) {

1530 
îr
 = 
	`£nd_doc
(
d©afd
, &
ªq2
);

1531 if(!
îr
 && 
ªq2
.
c⁄√˘_ªque°
) {

1533 
lo›
 = 2; (lo› > 0Ë&& !
gŸ_exô_sig«l
;Üoop--)

1534 
	`waô_ms
(250);

1535 if(!
gŸ_exô_sig«l
) {

1537 
£rvîfd
[
DATA
] = 
	`c⁄√˘_to
(
ùaddr
, 
ªq2
.
c⁄√˘_p‹t
);

1538 if(
£rvîfd
[
DATA
] !
CURL_SOCKET_BAD
) {

1540 
pﬁl_˛õ¡_rd
[
DATA
] = 
TRUE
;

1541 
pﬁl_˛õ¡_wr
[
DATA
] = 
TRUE
;

1542 
pﬁl_£rvî_rd
[
DATA
] = 
TRUE
;

1543 
pﬁl_£rvî_wr
[
DATA
] = 
TRUE
;

1544 
max_tu¬ñ_idx
 = 
DATA
;

1545 
£c⁄d¨y
 = 
TRUE
;

1546 
toc
[
DATA
] = 0;

1547 
tos
[
DATA
] = 0;

1548 
˛õ¡fd
[
DATA
] = 
d©afd
;

1549 
d©afd
 = 
CURL_SOCKET_BAD
;

1554 if(
d©afd
 !
CURL_SOCKET_BAD
) {

1556 
	`shutdown
(
d©afd
, 
SHUT_RDWR
);

1557 
	`s˛o£
(
d©afd
);

1560 if(
gŸ_exô_sig«l
)

1567 
i
 = 0; i <
max_tu¬ñ_idx
; i++) {

1568 
size_t
 
Àn
;

1569 if(
˛õ¡fd
[
i
] !
CURL_SOCKET_BAD
) {

1570 
Àn
 = (
ªad˛õ¡
[
i
]Ë- 
tos
[i];

1571 if(
Àn
 && 
	`FD_ISSET
(
˛õ¡fd
[
i
], &
öput
)) {

1573 
rc
 = 
	`§ód
(
˛õ¡fd
[
i
], &
ªad˛õ¡
[i][
tos
[i]], 
Àn
);

1574 if(
rc
 <= 0) {

1575 
	`logmsg
("[%s] gŸ %zd, STOP READING clõ¡", 
	`d©a_‹_˘æ
(
i
), 
rc
);

1576 
	`shutdown
(
˛õ¡fd
[
i
], 
SHUT_RD
);

1577 
pﬁl_˛õ¡_rd
[
i
] = 
FALSE
;

1580 
	`logmsg
("[%s] READ %zd byã†‰om clõ¡", 
	`d©a_‹_˘æ
(
i
), 
rc
);

1581 
	`logmsg
("[%s] READ \"%s\"", 
	`d©a_‹_˘æ
(
i
),

1582 
	`d©a_to_hex
(&
ªad˛õ¡
[
i
][
tos
[i]], 
rc
));

1583 
tos
[
i
] +
rc
;

1587 if(
£rvîfd
[
i
] !
CURL_SOCKET_BAD
) {

1588 
Àn
 = (
ªad£rvî
[
i
])-
toc
[i];

1589 if(
Àn
 && 
	`FD_ISSET
(
£rvîfd
[
i
], &
öput
)) {

1591 
rc
 = 
	`§ód
(
£rvîfd
[
i
], &
ªad£rvî
[i][
toc
[i]], 
Àn
);

1592 if(
rc
 <= 0) {

1593 
	`logmsg
("[%s] gŸ %zd, STOP READING sîvî", 
	`d©a_‹_˘æ
(
i
), 
rc
);

1594 
	`shutdown
(
£rvîfd
[
i
], 
SHUT_RD
);

1595 
pﬁl_£rvî_rd
[
i
] = 
FALSE
;

1598 
	`logmsg
("[%s] READ %zd byã†‰om sîvî", 
	`d©a_‹_˘æ
(
i
), 
rc
);

1599 
	`logmsg
("[%s] READ \"%s\"", 
	`d©a_‹_˘æ
(
i
),

1600 
	`d©a_to_hex
(&
ªad£rvî
[
i
][
toc
[i]], 
rc
));

1601 
toc
[
i
] +
rc
;

1605 if(
˛õ¡fd
[
i
] !
CURL_SOCKET_BAD
) {

1606 if(
toc
[
i
] && 
	`FD_ISSET
(
˛õ¡fd
[i], &
ouçut
)) {

1608 
rc
 = 
	`swrôe
(
˛õ¡fd
[
i
], 
ªad£rvî
[i], 
toc
[i]);

1609 if(
rc
 <= 0) {

1610 
	`logmsg
("[%s] gŸ %zd, STOP WRITING clõ¡", 
	`d©a_‹_˘æ
(
i
), 
rc
);

1611 
	`shutdown
(
˛õ¡fd
[
i
], 
SHUT_WR
);

1612 
pﬁl_˛õ¡_wr
[
i
] = 
FALSE
;

1613 
t˝_fö_wr
 = 
TRUE
;

1616 
	`logmsg
("[%s] SENT %zd byã†tÿ˛õ¡", 
	`d©a_‹_˘æ
(
i
), 
rc
);

1617 
	`logmsg
("[%s] SENT \"%s\"", 
	`d©a_‹_˘æ
(
i
),

1618 
	`d©a_to_hex
(
ªad£rvî
[
i
], 
rc
));

1619 if(
toc
[
i
] - 
rc
)

1620 
	`memmove
(&
ªad£rvî
[
i
][0], &ªad£rvî[i][
rc
], 
toc
[i]-rc);

1621 
toc
[
i
] -
rc
;

1625 if(
£rvîfd
[
i
] !
CURL_SOCKET_BAD
) {

1626 if(
tos
[
i
] && 
	`FD_ISSET
(
£rvîfd
[i], &
ouçut
)) {

1628 
rc
 = 
	`swrôe
(
£rvîfd
[
i
], 
ªad˛õ¡
[i], 
tos
[i]);

1629 if(
rc
 <= 0) {

1630 
	`logmsg
("[%s] gŸ %zd, STOP WRITING sîvî", 
	`d©a_‹_˘æ
(
i
), 
rc
);

1631 
	`shutdown
(
£rvîfd
[
i
], 
SHUT_WR
);

1632 
pﬁl_£rvî_wr
[
i
] = 
FALSE
;

1633 
t˝_fö_wr
 = 
TRUE
;

1636 
	`logmsg
("[%s] SENT %zd byã†tÿ£rvî", 
	`d©a_‹_˘æ
(
i
), 
rc
);

1637 
	`logmsg
("[%s] SENT \"%s\"", 
	`d©a_‹_˘æ
(
i
),

1638 
	`d©a_to_hex
(
ªad˛õ¡
[
i
], 
rc
));

1639 if(
tos
[
i
] - 
rc
)

1640 
	`memmove
(&
ªad˛õ¡
[
i
][0], &ªad˛õ¡[i][
rc
], 
tos
[i]-rc);

1641 
tos
[
i
] -
rc
;

1646 if(
gŸ_exô_sig«l
)

1652 
i
 = 0; i <
max_tu¬ñ_idx
; i++) {

1653 
lo›
 = 2;Üoop > 0;Üoop--) {

1656 if(
˛õ¡fd
[
i
] !
CURL_SOCKET_BAD
) {

1657 if(
pﬁl_˛õ¡_rd
[
i
] && !
pﬁl_£rvî_wr
[i]) {

1658 
	`logmsg
("[%s] DISABLED READING clõ¡", 
	`d©a_‹_˘æ
(
i
));

1659 
	`shutdown
(
˛õ¡fd
[
i
], 
SHUT_RD
);

1660 
pﬁl_˛õ¡_rd
[
i
] = 
FALSE
;

1662 if(
pﬁl_˛õ¡_wr
[
i
] && !
pﬁl_£rvî_rd
[i] && !
toc
[i]) {

1663 
	`logmsg
("[%s] DISABLED WRITING clõ¡", 
	`d©a_‹_˘æ
(
i
));

1664 
	`shutdown
(
˛õ¡fd
[
i
], 
SHUT_WR
);

1665 
pﬁl_˛õ¡_wr
[
i
] = 
FALSE
;

1666 
t˝_fö_wr
 = 
TRUE
;

1669 if(
£rvîfd
[
i
] !
CURL_SOCKET_BAD
) {

1670 if(
pﬁl_£rvî_rd
[
i
] && !
pﬁl_˛õ¡_wr
[i]) {

1671 
	`logmsg
("[%s] DISABLED READING sîvî", 
	`d©a_‹_˘æ
(
i
));

1672 
	`shutdown
(
£rvîfd
[
i
], 
SHUT_RD
);

1673 
pﬁl_£rvî_rd
[
i
] = 
FALSE
;

1675 if(
pﬁl_£rvî_wr
[
i
] && !
pﬁl_˛õ¡_rd
[i] && !
tos
[i]) {

1676 
	`logmsg
("[%s] DISABLED WRITING sîvî", 
	`d©a_‹_˘æ
(
i
));

1677 
	`shutdown
(
£rvîfd
[
i
], 
SHUT_WR
);

1678 
pﬁl_£rvî_wr
[
i
] = 
FALSE
;

1679 
t˝_fö_wr
 = 
TRUE
;

1685 if(
t˝_fö_wr
)

1687 
	`waô_ms
(250);

1690 
i
 = 0; i <
max_tu¬ñ_idx
; i++) {

1691 
lo›
 = 2;Üoop > 0;Üoop--) {

1692 if(
˛õ¡fd
[
i
] !
CURL_SOCKET_BAD
) {

1693 if(!
pﬁl_˛õ¡_wr
[
i
] && !
pﬁl_˛õ¡_rd
[i]) {

1694 
	`logmsg
("[%s] CLOSING clõ¡ sockë", 
	`d©a_‹_˘æ
(
i
));

1695 
	`s˛o£
(
˛õ¡fd
[
i
]);

1696 
˛õ¡fd
[
i
] = 
CURL_SOCKET_BAD
;

1697 if(
£rvîfd
[
i
] =
CURL_SOCKET_BAD
) {

1698 
	`logmsg
("[%s] ENDING", 
	`d©a_‹_˘æ
(
i
));

1699 if(
i
 =
DATA
)

1700 
£c⁄d¨y
 = 
FALSE
;

1702 
¥im¨y
 = 
FALSE
;

1706 if(
£rvîfd
[
i
] !
CURL_SOCKET_BAD
) {

1707 if(!
pﬁl_£rvî_wr
[
i
] && !
pﬁl_£rvî_rd
[i]) {

1708 
	`logmsg
("[%s] CLOSING sîvî sockë", 
	`d©a_‹_˘æ
(
i
));

1709 
	`s˛o£
(
£rvîfd
[
i
]);

1710 
£rvîfd
[
i
] = 
CURL_SOCKET_BAD
;

1711 if(
˛õ¡fd
[
i
] =
CURL_SOCKET_BAD
) {

1712 
	`logmsg
("[%s] ENDING", 
	`d©a_‹_˘æ
(
i
));

1713 if(
i
 =
DATA
)

1714 
£c⁄d¨y
 = 
FALSE
;

1716 
¥im¨y
 = 
FALSE
;

1725 
max_tu¬ñ_idx
 = 
£c⁄d¨y
 ? 
DATA
 : 
CTRL
;

1727 if(!
¥im¨y
)

1735 
hâp_c⁄√˘_˛ónup
:

1737 
i
 = 
DATA
; i >
CTRL
; i--) {

1738 if(
£rvîfd
[
i
] !
CURL_SOCKET_BAD
) {

1739 
	`logmsg
("[%s] CLOSING sîvî sockë (˛ónup)", 
	`d©a_‹_˘æ
(
i
));

1740 
	`shutdown
(
£rvîfd
[
i
], 
SHUT_RDWR
);

1741 
	`s˛o£
(
£rvîfd
[
i
]);

1743 if(
˛õ¡fd
[
i
] !
CURL_SOCKET_BAD
) {

1744 
	`logmsg
("[%s] CLOSING clõ¡ sockë (˛ónup)", 
	`d©a_‹_˘æ
(
i
));

1745 
	`shutdown
(
˛õ¡fd
[
i
], 
SHUT_RDWR
);

1746 
	`s˛o£
(
˛õ¡fd
[
i
]);

1748 if((
£rvîfd
[
i
] !
CURL_SOCKET_BAD
) ||

1749 (
˛õ¡fd
[
i
] !
CURL_SOCKET_BAD
)) {

1750 
	`logmsg
("[%s] ABORTING", 
	`d©a_‹_˘æ
(
i
));

1754 *
öfdp
 = 
CURL_SOCKET_BAD
;

1755 
	}
}

1759 
cuæ_sockë_t
 
	$ac˚±_c⁄√˘i⁄
(
cuæ_sockë_t
 
sock
)

1761 
cuæ_sockë_t
 
msgsock
 = 
CURL_SOCKET_BAD
;

1762 
îr‹
;

1763 
Êag
 = 1;

1765 if(
MAX_SOCKETS
 =
num_sockës
) {

1766 
	`logmsg
("Too many open sockets!");

1767  
CURL_SOCKET_BAD
;

1770 
msgsock
 = 
	`ac˚±
(
sock
, 
NULL
, NULL);

1772 if(
gŸ_exô_sig«l
) {

1773 if(
CURL_SOCKET_BAD
 !
msgsock
)

1774 
	`s˛o£
(
msgsock
);

1775  
CURL_SOCKET_BAD
;

1778 if(
CURL_SOCKET_BAD
 =
msgsock
) {

1779 
îr‹
 = 
SOCKERRNO
;

1780 if(
EAGAIN
 =
îr‹
 || 
EWOULDBLOCK
 ==Érror) {

1784 
	`logmsg
("MAJOR ERROR:áccept() failed withÉrror: (%d) %s",

1785 
îr‹
, 
	`°ªº‹
(error));

1786  
CURL_SOCKET_BAD
;

1789 if(0 !
	`cuæx_n⁄block
(
msgsock
, 
TRUE
)) {

1790 
îr‹
 = 
SOCKERRNO
;

1791 
	`logmsg
("curlx_nonblock failed withÉrror: (%d) %s",

1792 
îr‹
, 
	`°ªº‹
(error));

1793 
	`s˛o£
(
msgsock
);

1794  
CURL_SOCKET_BAD
;

1797 if(0 !
	`£tsock›t
(
msgsock
, 
SOL_SOCKET
, 
SO_KEEPALIVE
,

1798 (*)&
Êag
, (flag))) {

1799 
îr‹
 = 
SOCKERRNO
;

1800 
	`logmsg
("setsockopt(SO_KEEPALIVE) failed withÉrror: (%d) %s",

1801 
îr‹
, 
	`°ªº‹
(error));

1802 
	`s˛o£
(
msgsock
);

1803  
CURL_SOCKET_BAD
;

1812 if(!
£rvîlog¶ocked
)

1813 
	`£t_advis‹_ªad_lock
(
SERVERLOGS_LOCK
);

1814 
£rvîlog¶ocked
 += 1;

1816 
	`logmsg
("====> Client connect");

1818 
Æl_sockës
[
num_sockës
] = 
msgsock
;

1819 
num_sockës
 += 1;

1821 #ifde‡
TCP_NODELAY


1826 if(0 !
	`£tsock›t
(
msgsock
, 
IPPROTO_TCP
, 
TCP_NODELAY
,

1827 (*)&
Êag
, (flag)))

1828 
	`logmsg
("====> TCP_NODELAY failed");

1830 
	`logmsg
("TCP_NODELAY set");

1833  
msgsock
;

1834 
	}
}

1838 
	$£rvi˚_c⁄√˘i⁄
(
cuæ_sockë_t
 
msgsock
, 
hâ¥eque°
 *
ªq
,

1839 
cuæ_sockë_t
 
li°ísock
,

1840 c⁄° *
c⁄√˘ho°
)

1842 if(
gŸ_exô_sig«l
)

1845 !
ªq
->
d⁄e_¥o˚ssög
) {

1846 
rc
 = 
	`gë_ªque°
(
msgsock
, 
ªq
);

1847 i‡(
rc
 <= 0) {

1849  
rc
;

1853 if(
¥evboun˚
) {

1855 if((
ªq
->
ã°no
 =
¥evã°no
) &&

1856 (
ªq
->
∑πno
 =
¥ev∑πno
)) {

1857 
ªq
->
∑πno
++;

1858 
	`logmsg
("BOUNCEÖ¨ànumbîÅÿ%ld", 
ªq
->
∑πno
);

1861 
¥evboun˚
 = 
FALSE
;

1862 
¥evã°no
 = -1;

1863 
¥ev∑πno
 = -1;

1867 
	`£nd_doc
(
msgsock
, 
ªq
);

1868 if(
gŸ_exô_sig«l
)

1871 if(
ªq
->
ã°no
 < 0) {

1872 
	`logmsg
("specialÑequestÑeceived,ÇoÖersistency");

1875 if(!
ªq
->
›í
) {

1876 
	`logmsg
("instructedÅo close connectionáfter server-reply");

1880 if(
ªq
->
c⁄√˘_ªque°
) {

1882 if(!
is_¥oxy
) {

1883 
	`logmsg
("received CONNECT but isn'tÑunningásÖroxy!");

1887 
	`hâp_c⁄√˘
(&
msgsock
, 
li°ísock
, 
c⁄√˘ho°
, 
ªq
->
c⁄√˘_p‹t
);

1894 if(
ªq
->
›í
) {

1895 
	`logmsg
("=>Öersistant connectionÑequestÉnded,áwaitsÇewÑequest\n");

1900 
	}
}

1902 
	$maö
(
¨gc
, *
¨gv
[])

1904 
§vr_sockaddr_uni⁄_t
 
me
;

1905 
cuæ_sockë_t
 
sock
 = 
CURL_SOCKET_BAD
;

1906 
wrŸïidfûe
 = 0;

1907 
Êag
;

1908 
p‹t
 = 
DEFAULT_PORT
;

1909 *
pid«me
= (*)".http.pid";

1910 
hâ¥eque°
 
ªq
;

1911 
rc
;

1912 
îr‹
;

1913 
¨g
=1;

1914 
pid
;

1915 c⁄° *
c⁄√˘ho°
 = "127.0.0.1";

1918 
size_t
 
sockë_idx
;

1920 
	`mem£t
(&
ªq
, 0, (req));

1922 
¨gc
>
¨g
) {

1923 if(!
	`°rcmp
("--vîsi⁄", 
¨gv
[
¨g
])) {

1924 
	`¥ötf
("sws IPv4%s"

1927 #ifde‡
ENABLE_IPV6


1935 if(!
	`°rcmp
("--pidfûe", 
¨gv
[
¨g
])) {

1936 
¨g
++;

1937 if(
¨gc
>
¨g
)

1938 
pid«me
 = 
¨gv
[
¨g
++];

1940 if(!
	`°rcmp
("--logfûe", 
¨gv
[
¨g
])) {

1941 
¨g
++;

1942 if(
¨gc
>
¨g
)

1943 
£rvîlogfûe
 = 
¨gv
[
¨g
++];

1945 if(!
	`°rcmp
("--g›hî", 
¨gv
[
¨g
])) {

1946 
¨g
++;

1947 
u£_g›hî
 = 
TRUE
;

1948 
íd_of_hódîs
 = "\r\n";

1950 if(!
	`°rcmp
("--ùv4", 
¨gv
[
¨g
])) {

1951 #ifde‡
ENABLE_IPV6


1952 
ùv_öu£
 = "IPv4";

1953 
u£_ùv6
 = 
FALSE
;

1955 
¨g
++;

1957 if(!
	`°rcmp
("--ùv6", 
¨gv
[
¨g
])) {

1958 #ifde‡
ENABLE_IPV6


1959 
ùv_öu£
 = "IPv6";

1960 
u£_ùv6
 = 
TRUE
;

1962 
¨g
++;

1964 if(!
	`°rcmp
("--p‹t", 
¨gv
[
¨g
])) {

1965 
¨g
++;

1966 if(
¨gc
>
¨g
) {

1967 *
íd±r
;

1968 
u um
 = 
	`°πoul
(
¨gv
[
¨g
], &
íd±r
, 10);

1969 if((
íd±r
 !
¨gv
[
¨g
] + 
	`°æí
(argv[arg])) ||

1970 (
u um
 < 1025UL) || (ulnum > 65535UL)) {

1971 
	`Ârötf
(
°dîr
, "sws: invalid --portárgument (%s)\n",

1972 
¨gv
[
¨g
]);

1975 
p‹t
 = 
	`cuæx_u…ous
(
u um
);

1976 
¨g
++;

1979 if(!
	`°rcmp
("--§cdú", 
¨gv
[
¨g
])) {

1980 
¨g
++;

1981 if(
¨gc
>
¨g
) {

1982 
∑th
 = 
¨gv
[
¨g
];

1983 
¨g
++;

1986 if(!
	`°rcmp
("--c⁄√˘", 
¨gv
[
¨g
])) {

1990 
¨g
++;

1991 if(
¨gc
>
¨g
) {

1992 
c⁄√˘ho°
 = 
¨gv
[
¨g
];

1993 
¨g
++;

1994 
is_¥oxy
 = 
TRUE
;

1995 
	`logmsg
("Ru¿a†¥oxy, CONNECTÅÿho° %s", 
c⁄√˘ho°
);

1999 
	`puts
("Usage: sws [option]\n"

2013 #ifde‡
WIN32


2014 
	`wö32_öô
();

2015 
	`©exô
(
wö32_˛ónup
);

2018 
	`ö°Æl_sig«l_h™dÀrs
();

2020 
pid
 = ()
	`gëpid
();

2022 #ifde‡
ENABLE_IPV6


2023 if(!
u£_ùv6
)

2025 
sock
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0);

2026 #ifde‡
ENABLE_IPV6


2028 
sock
 = 
	`sockë
(
AF_INET6
, 
SOCK_STREAM
, 0);

2031 
Æl_sockës
[0] = 
sock
;

2032 
num_sockës
 = 1;

2034 if(
CURL_SOCKET_BAD
 =
sock
) {

2035 
îr‹
 = 
SOCKERRNO
;

2036 
	`logmsg
("Error creating socket: (%d) %s",

2037 
îr‹
, 
	`°ªº‹
(error));

2038 
sws_˛ónup
;

2041 
Êag
 = 1;

2042 if(0 !
	`£tsock›t
(
sock
, 
SOL_SOCKET
, 
SO_REUSEADDR
,

2043 (*)&
Êag
, (flag))) {

2044 
îr‹
 = 
SOCKERRNO
;

2045 
	`logmsg
("setsockopt(SO_REUSEADDR) failed withÉrror: (%d) %s",

2046 
îr‹
, 
	`°ªº‹
(error));

2047 
sws_˛ónup
;

2049 if(0 !
	`cuæx_n⁄block
(
sock
, 
TRUE
)) {

2050 
îr‹
 = 
SOCKERRNO
;

2051 
	`logmsg
("curlx_nonblock failed withÉrror: (%d) %s",

2052 
îr‹
, 
	`°ªº‹
(error));

2053 
sws_˛ónup
;

2056 #ifde‡
ENABLE_IPV6


2057 if(!
u£_ùv6
) {

2059 
	`mem£t
(&
me
.
ß4
, 0, (me.sa4));

2060 
me
.
ß4
.
sö_Ámûy
 = 
AF_INET
;

2061 
me
.
ß4
.
sö_addr
.
s_addr
 = 
INADDR_ANY
;

2062 
me
.
ß4
.
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

2063 
rc
 = 
	`böd
(
sock
, &
me
.
ß
, (me.
ß4
));

2064 #ifde‡
ENABLE_IPV6


2067 
	`mem£t
(&
me
.
ß6
, 0, (me.sa6));

2068 
me
.
ß6
.
sö6_Ámûy
 = 
AF_INET6
;

2069 
me
.
ß6
.
sö6_addr
 = 
ö6addr_™y
;

2070 
me
.
ß6
.
sö6_p‹t
 = 
	`ht⁄s
(
p‹t
);

2071 
rc
 = 
	`böd
(
sock
, &
me
.
ß
, (me.
ß6
));

2074 if(0 !
rc
) {

2075 
îr‹
 = 
SOCKERRNO
;

2076 
	`logmsg
("Error binding socket onÖort %hu: (%d) %s",

2077 
p‹t
, 
îr‹
, 
	`°ªº‹
(error));

2078 
sws_˛ónup
;

2081 
	`logmsg
("Running %s %s version onÖort %d",

2082 
u£_g›hî
?"GOPHER":"HTTP", 
ùv_öu£
, ()
p‹t
);

2085 
rc
 = 
	`li°í
(
sock
, 5);

2086 if(0 !
rc
) {

2087 
îr‹
 = 
SOCKERRNO
;

2088 
	`logmsg
("listen() failed withÉrror: (%d) %s",

2089 
îr‹
, 
	`°ªº‹
(error));

2090 
sws_˛ónup
;

2098 
wrŸïidfûe
 = 
	`wrôe_pidfûe
(
pid«me
);

2099 if(!
wrŸïidfûe
)

2100 
sws_˛ónup
;

2106 
ªq
.
pùñöög
 = 
FALSE
;

2107 
	`öô_hâ¥eque°
(&
ªq
);

2110 
fd_£t
 
öput
;

2111 
fd_£t
 
ouçut
;

2112 
timevÆ
 
timeout
 = {0, 250000L};

2113 
cuæ_sockë_t
 
maxfd
 = (curl_socket_t)-1;

2116 
sockë_idx
 = 
num_sockës
 - 1; socket_idx >= 1; --socket_idx) {

2117 i‡(
CURL_SOCKET_BAD
 =
Æl_sockës
[
sockë_idx
]) {

2118 * 
d°
 = (*Ë(
Æl_sockës
 + 
sockë_idx
);

2119 * 
§c
 = (*Ë(
Æl_sockës
 + 
sockë_idx
 + 1);

2120 * 
íd
 = (*Ë(
Æl_sockës
 + 
num_sockës
);

2121 
	`memmove
(
d°
, 
§c
, 
íd
 - src);

2122 
num_sockës
 -= 1;

2126 if(
gŸ_exô_sig«l
)

2127 
sws_˛ónup
;

2130 
	`FD_ZERO
(&
öput
);

2131 
	`FD_ZERO
(&
ouçut
);

2133 
sockë_idx
 = 0; sockë_idx < 
num_sockës
; ++socket_idx) {

2135 
	`FD_SET
(
Æl_sockës
[
sockë_idx
], &
öput
);

2136 if(
Æl_sockës
[
sockë_idx
] > 
maxfd
)

2137 
maxfd
 = 
Æl_sockës
[
sockë_idx
];

2140 if(
gŸ_exô_sig«l
)

2141 
sws_˛ónup
;

2143 
rc
 = 
	`£À˘
(()
maxfd
 + 1, &
öput
, &
ouçut
, 
NULL
, &
timeout
);

2144 i‡(
rc
 < 0) {

2145 
îr‹
 = 
SOCKERRNO
;

2146 
	`logmsg
("select() failed withÉrror: (%d) %s",

2147 
îr‹
, 
	`°ªº‹
(error));

2148 
sws_˛ónup
;

2151 if(
gŸ_exô_sig«l
)

2152 
sws_˛ónup
;

2154 i‡(
rc
 == 0) {

2160 i‡(
	`FD_ISSET
(
Æl_sockës
[0], &
öput
)) {

2162 
cuæ_sockë_t
 
msgsock
;

2164 
msgsock
 = 
	`ac˚±_c⁄√˘i⁄
(
sock
);

2165 
	`logmsg
("ac˚±_c⁄√˘i⁄ %dÑëu∫ed %d", 
sock
, 
msgsock
);

2166 i‡(
CURL_SOCKET_BAD
 =
msgsock
)

2167 
sws_˛ónup
;

2168 } 
msgsock
 > 0);

2172 
sockë_idx
 = 1; sockë_idx < 
num_sockës
; ++socket_idx) {

2173 i‡(
	`FD_ISSET
(
Æl_sockës
[
sockë_idx
], &
öput
)) {

2174 if(
gŸ_exô_sig«l
)

2175 
sws_˛ónup
;

2179 
rc
 = 
	`£rvi˚_c⁄√˘i⁄
(
Æl_sockës
[
sockë_idx
], &
ªq
, 
sock
,

2180 
c⁄√˘ho°
);

2181 if(
gŸ_exô_sig«l
)

2182 
sws_˛ónup
;

2184 i‡(
rc
 < 0) {

2185 
	`logmsg
("====> Clõ¡ disc⁄√˘ %d", 
ªq
.
c⁄nm⁄
);

2187 if(
ªq
.
c⁄nm⁄
) {

2188 c⁄° *
kìp›í
="[DISCONNECT]\n";

2189 
	`°‹îeque°
((*)
kìp›í
, 
	`°æí
(keepopen));

2192 if(!
ªq
.
›í
)

2197 
	`waô_ms
(50);

2199 if(
Æl_sockës
[
sockë_idx
] !
CURL_SOCKET_BAD
) {

2200 
	`s˛o£
(
Æl_sockës
[
sockë_idx
]);

2201 
Æl_sockës
[
sockë_idx
] = 
CURL_SOCKET_BAD
;

2204 
£rvîlog¶ocked
 -= 1;

2205 if(!
£rvîlog¶ocked
)

2206 
	`˛ór_advis‹_ªad_lock
(
SERVERLOGS_LOCK
);

2208 i‡(
ªq
.
ã°no
 =
DOCNUMBER_QUIT
)

2209 
sws_˛ónup
;

2213 i‡(
rc
 != 0)

2214 
	`öô_hâ¥eque°
(&
ªq
);

2215 } 
rc
 > 0);

2219 if(
gŸ_exô_sig«l
)

2220 
sws_˛ónup
;

2223 
sws_˛ónup
:

2225 
sockë_idx
 = 1; sockë_idx < 
num_sockës
; ++socket_idx)

2226 if((
Æl_sockës
[
sockë_idx
] !
sock
) &&

2227 (
Æl_sockës
[
sockë_idx
] !
CURL_SOCKET_BAD
))

2228 
	`s˛o£
(
Æl_sockës
[
sockë_idx
]);

2230 if(
sock
 !
CURL_SOCKET_BAD
)

2231 
	`s˛o£
(
sock
);

2233 if(
gŸ_exô_sig«l
)

2234 
	`logmsg
("signalledÅo die");

2236 if(
wrŸïidfûe
)

2237 
	`u∆ök
(
pid«me
);

2239 if(
£rvîlog¶ocked
) {

2240 
£rvîlog¶ocked
 = 0;

2241 
	`˛ór_advis‹_ªad_lock
(
SERVERLOGS_LOCK
);

2244 
	`ª°‹e_sig«l_h™dÀrs
();

2246 if(
gŸ_exô_sig«l
) {

2247 
	`logmsg
("========> %s sws (port: %dÖid: %ld)Éxits with signal (%d)",

2248 
ùv_öu£
, ()
p‹t
, 
pid
, 
exô_sig«l
);

2254 
	`øi£
(
exô_sig«l
);

2257 
	`logmsg
("========> sws quits");

2259 
	}
}

	@tests/server/testpart.c

22 
	~"£rvî_£tup.h
"

24 
	~"gë∑π.h
"

26 
	#_MPRINTF_REPLACE


	)

27 
	~<cuæ/m¥ötf.h
>

30 
	~"memdebug.h
"

32 
	$maö
(
¨gc
, **
¨gv
)

34 
rc
;

35 *
∑π
;

36 
size_t
 
∑πÀn
, 
i
;

38 if(
¨gc
< 3) {

39 
	`¥ötf
("./testpart main sub\n");

42 
rc
 = 
	`gë∑π
(&
∑π
, &
∑πÀn
, 
¨gv
[1],árgv[2], 
°dö
);

43 if(
rc
)

44 (
rc
);

45 
i
 = 0; i < 
∑πÀn
; i++)

46 
	`¥ötf
("%c", 
∑π
[
i
]);

47 
	`‰ì
(
∑π
);

50 
	}
}

	@tests/server/tftp.h

1 #i‚de‡
HEADER_CURL_SERVER_TFTP_H


2 
	#HEADER_CURL_SERVER_TFTP_H


	)

24 
	~"£rvî_£tup.h
"

29 
	#SEGSIZE
 512

	)

31 #i‡
deföed
(
__GNUC__
) && ((__GNUC__ >= 3) || \

32 ((
	g__GNUC__
 =2Ë&& 
deföed
(
__GNUC_MINOR__
) && (__GNUC_MINOR__ >= 7)))

33 
	#PACKED_STRUCT
 
	`__©åibuã__
((
__∑cked__
))

	)

35 
	#PACKED_STRUCT


	)

42 
	st·phdr
 {

43 
th_›code
;

44 
	mth_block
;

45 
	mth_d©a
[1];

46 } 
	gPACKED_STRUCT
;

48 
	#th_°uff
 
th_block


	)

49 
	#th_code
 
th_block


	)

50 
	#th_msg
 
th_d©a


	)

52 
	#EUNDEF
 0

	)

53 
	#ENOTFOUND
 1

	)

54 
	#EACCESS
 2

	)

55 
	#ENOSPACE
 3

	)

56 
	#EBADOP
 4

	)

57 
	#EBADID
 5

	)

58 
	#EEXISTS
 6

	)

59 
	#ENOUSER
 7

	)

	@tests/server/tftpd.c

50 
	~"£rvî_£tup.h
"

52 #ifde‡
HAVE_SYS_IOCTL_H


53 
	~<sys/io˘l.h
>

55 #ifde‡
HAVE_SIGNAL_H


56 
	~<sig«l.h
>

58 #ifde‡
HAVE_FCNTL_H


59 
	~<f˙é.h
>

61 #ifde‡
HAVE_NETINET_IN_H


62 
	~<√töë/ö.h
>

64 #ifde‡
HAVE_ARPA_INET_H


65 
	~<¨∑/öë.h
>

67 #ifde‡
HAVE_ARPA_TFTP_H


68 
	~<¨∑/t·p.h
>

70 
	~"t·p.h
"

72 #ifde‡
HAVE_NETDB_H


73 
	~<√tdb.h
>

75 #ifde‡
HAVE_SYS_FILIO_H


77 
	~<sys/fûio.h
>

80 
	~<£tjmp.h
>

82 #ifde‡
HAVE_PWD_H


83 
	~<pwd.h
>

86 
	#ENABLE_CURLX_PRINTF


	)

89 
	~"cuæx.h
"

90 
	~"gë∑π.h
"

91 
	~"utû.h
"

92 
	~"£rvî_sockaddr.h
"

95 
	~"memdebug.h
"

101 #i‚de‡
PKTSIZE


102 
	#PKTSIZE
 (
SEGSIZE
 + 4Ë

	)

105 
	sã°ˇ£
 {

106 *
	mbuf„r
;

107 
size_t
 
	mbufsize
;

108 *
	mΩå
;

109 
size_t
 
	mrcou¡
;

110 
	mã°no
;

111 
	mofûe
;

113 
	mwrôedñay
;

116 
	sf‹m©s
 {

117 c⁄° *
	mf_mode
;

118 
	mf_c⁄vît
;

121 
	sîrmsg
 {

122 
	me_code
;

123 c⁄° *
	me_msg
;

127 
t·phdr
 
	mhdr
;

128 
	m°‹age
[
PKTSIZE
];

129 } 
	tt·phdr_°‹age_t
;

136 
	sbf
 {

137 
	mcou¡î
;

138 
t·phdr_°‹age_t
 
	mbuf
;

141 
	#BF_ALLOC
 -3

	)

142 
	#BF_FREE
 -2

	)

144 
	#›code_RRQ
 1

	)

145 
	#›code_WRQ
 2

	)

146 
	#›code_DATA
 3

	)

147 
	#›code_ACK
 4

	)

148 
	#›code_ERROR
 5

	)

150 
	#TIMEOUT
 5

	)

152 #unde‡
MIN


153 
	#MIN
(
x
,
y
Ë((x)<(y)?(x):(y))

	)

155 #i‚de‡
DEFAULT_LOGFILE


156 
	#DEFAULT_LOGFILE
 "log/t·pd.log"

	)

159 
	#REQUEST_DUMP
 "log/£rvî.öput"

	)

161 
	#DEFAULT_PORT
 8999

	)

167 
îrmsg
 
	gîrmsgs
[] = {

168 { 
EUNDEF
, "UndefinedÉrror code" },

169 { 
ENOTFOUND
, "FileÇot found" },

170 { 
EACCESS
, "Access violation" },

171 { 
ENOSPACE
, "Disk full orállocationÉxceeded" },

172 { 
EBADOP
, "Illegal TFTP operation" },

173 { 
EBADID
, "UnknownÅransfer ID" },

174 { 
EEXISTS
, "FileálreadyÉxists" },

175 { 
ENOUSER
, "No such user" },

179 
f‹m©s
 
	gf‹m©a
[] = {

182 { 
NULL
, 0 }

185 
bf
 
	gbfs
[2];

187 
	g√xt⁄e
;

188 
	gcuºít
;

191 
	g√wlöe
 = 0;

192 
	g¥evch¨
 = -1;

194 
t·phdr_°‹age_t
 
	gbuf
;

195 
t·phdr_°‹age_t
 
	gackbuf
;

197 
§vr_sockaddr_uni⁄_t
 
	g‰om
;

198 
cuæ_sockÀn_t
 
	g‰omÀn
;

200 
cuæ_sockë_t
 
	g≥î
 = 
CURL_SOCKET_BAD
;

202 
	gtimeout
;

203 
	gmaxtimeout
 = 5 * 
TIMEOUT
;

205 #ifde‡
ENABLE_IPV6


206 
boﬁ
 
	gu£_ùv6
 = 
FALSE
;

208 c⁄° *
	gùv_öu£
 = "IPv4";

210 c⁄° *
	g£rvîlogfûe
 = 
DEFAULT_LOGFILE
;

211 *
	gpid«me
= (*)".tftpd.pid";

212 
	g£rvîlog¶ocked
 = 0;

213 
	gwrŸïidfûe
 = 0;

215 #ifde‡
HAVE_SIGSETJMP


216 
sigjmp_buf
 
	gtimeoutbuf
;

219 #i‡
deföed
(
HAVE_ALARM
Ë&& deföed(
SIGALRM
)

220 
	gªxmtvÆ
 = 
TIMEOUT
;

225 #i‚de‡
HAVE_SIGINTERRUPT


226 
	#sigöãºu±
(
x
,
y
Ëdÿ{} 0)

	)

231 
	$RETSIGTYPE
 (*
	tSIGHANDLER_T
)();

233 #ifde‡
SIGHUP


234 
SIGHANDLER_T
 
ﬁd_sighup_h™dÀr
 = 
SIG_ERR
;

237 #ifde‡
SIGPIPE


238 
SIGHANDLER_T
 
ﬁd_sigpùe_h™dÀr
 = 
SIG_ERR
;

241 #ifde‡
SIGINT


242 
SIGHANDLER_T
 
ﬁd_sigöt_h™dÀr
 = 
SIG_ERR
;

245 #ifde‡
SIGTERM


246 
SIGHANDLER_T
 
ﬁd_sigãrm_h™dÀr
 = 
SIG_ERR
;

249 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

250 
SIGHANDLER_T
 
ﬁd_sigbªak_h™dÀr
 = 
SIG_ERR
;

255 
SIG_ATOMIC_T
 
gŸ_exô_sig«l
 = 0;

259 vﬁ©ûê
exô_sig«l
 = 0;

265 
t·phdr
 *
	`rw_öô
();

267 
t·phdr
 *
	`w_öô
();

269 
t·phdr
 *
	`r_öô
();

271 
	`ªad_ahód
(
ã°ˇ£
 *
ã°
, 
c⁄vît
);

273 
ssize_t
 
	`wrôe_behöd
(
ã°ˇ£
 *
ã°
, 
c⁄vît
);

275 
	`synch√t
(
cuæ_sockë_t
);

277 
	`do_t·p
(
ã°ˇ£
 *
ã°
, 
t·phdr
 *
ç
, 
ssize_t
 
size
);

279 
	`vÆid©e_ac˚ss
(
ã°ˇ£
 *
ã°
, c⁄° *
‚ame
, 
mode
);

281 
	`£ndt·p
(
ã°ˇ£
 *
ã°
, 
f‹m©s
 *
pf
);

283 
	`ªcvt·p
(
ã°ˇ£
 *
ã°
, 
f‹m©s
 *
pf
);

285 
	`«k
(
îr‹
);

287 #i‡
	`deföed
(
HAVE_ALARM
Ë&& deföed(
SIGALRM
)

289 
	`mysig«l
(
sig
, (*
h™dÀr
)());

291 
	`timî
(
signum
);

293 
	`ju°timeout
(
signum
);

297 
RETSIGTYPE
 
	`exô_sig«l_h™dÀr
(
signum
);

299 
	`ö°Æl_sig«l_h™dÀrs
();

301 
	`ª°‹e_sig«l_h™dÀrs
();

307 #i‡
	`deföed
(
HAVE_ALARM
Ë&& deföed(
SIGALRM
)

312 
	`mysig«l
(
sig
, (*
h™dÀr
)())

314 
siga˘i⁄
 
ß
;

315 
	`mem£t
(&
ß
, 0, (sa));

316 
ß
.
ß_h™dÀr
 = 
h™dÀr
;

317 
	`siga˘i⁄
(
sig
, &
ß
, 
NULL
);

318 
	}
}

320 
	$timî
(
signum
)

322 ()
signum
;

324 
	`logmsg
("alarm!");

326 
timeout
 +
ªxmtvÆ
;

327 if(
timeout
 >
maxtimeout
) {

328 if(
wrŸïidfûe
) {

329 
wrŸïidfûe
 = 0;

330 
	`u∆ök
(
pid«me
);

332 if(
£rvîlog¶ocked
) {

333 
£rvîlog¶ocked
 = 0;

334 
	`˛ór_advis‹_ªad_lock
(
SERVERLOGS_LOCK
);

336 
	`exô
(1);

338 #ifde‡
HAVE_SIGSETJMP


339 
	`sigl⁄gjmp
(
timeoutbuf
, 1);

341 
	}
}

343 
	$ju°timeout
(
signum
)

345 ()
signum
;

346 
	}
}

355 
RETSIGTYPE
 
	$exô_sig«l_h™dÀr
(
signum
)

357 
ﬁd_î∫o
 = 
î∫o
;

358 if(
gŸ_exô_sig«l
 == 0) {

359 
gŸ_exô_sig«l
 = 1;

360 
exô_sig«l
 = 
signum
;

362 ()
	`sig«l
(
signum
, 
exô_sig«l_h™dÀr
);

363 
î∫o
 = 
ﬁd_î∫o
;

364 
	}
}

366 
	$ö°Æl_sig«l_h™dÀrs
()

368 #ifde‡
SIGHUP


370 if((
ﬁd_sighup_h™dÀr
 = 
	`sig«l
(
SIGHUP
, 
SIG_IGN
)Ë=
SIG_ERR
)

371 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGHUP h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

373 #ifde‡
SIGPIPE


375 if((
ﬁd_sigpùe_h™dÀr
 = 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
)Ë=
SIG_ERR
)

376 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGPIPE h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

378 #ifde‡
SIGINT


380 if((
ﬁd_sigöt_h™dÀr
 = 
	`sig«l
(
SIGINT
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

381 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGINT h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

383 
	`sigöãºu±
(
SIGINT
, 1);

385 #ifde‡
SIGTERM


387 if((
ﬁd_sigãrm_h™dÀr
 = 
	`sig«l
(
SIGTERM
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

388 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGTERM h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

390 
	`sigöãºu±
(
SIGTERM
, 1);

392 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

394 if((
ﬁd_sigbªak_h™dÀr
 = 
	`sig«l
(
SIGBREAK
, 
exô_sig«l_h™dÀr
)Ë=
SIG_ERR
)

395 
	`logmsg
("ˇ¬Ÿ in°Æ»SIGBREAK h™dÀr: %s", 
	`°ªº‹
(
î∫o
));

397 
	`sigöãºu±
(
SIGBREAK
, 1);

399 
	}
}

401 
	$ª°‹e_sig«l_h™dÀrs
()

403 #ifde‡
SIGHUP


404 if(
SIG_ERR
 !
ﬁd_sighup_h™dÀr
)

405 ()
	`sig«l
(
SIGHUP
, 
ﬁd_sighup_h™dÀr
);

407 #ifde‡
SIGPIPE


408 if(
SIG_ERR
 !
ﬁd_sigpùe_h™dÀr
)

409 ()
	`sig«l
(
SIGPIPE
, 
ﬁd_sigpùe_h™dÀr
);

411 #ifde‡
SIGINT


412 if(
SIG_ERR
 !
ﬁd_sigöt_h™dÀr
)

413 ()
	`sig«l
(
SIGINT
, 
ﬁd_sigöt_h™dÀr
);

415 #ifde‡
SIGTERM


416 if(
SIG_ERR
 !
ﬁd_sigãrm_h™dÀr
)

417 ()
	`sig«l
(
SIGTERM
, 
ﬁd_sigãrm_h™dÀr
);

419 #i‡
	`deföed
(
SIGBREAK
Ë&& deföed(
WIN32
)

420 if(
SIG_ERR
 !
ﬁd_sigbªak_h™dÀr
)

421 ()
	`sig«l
(
SIGBREAK
, 
ﬁd_sigbªak_h™dÀr
);

423 
	}
}

429 
t·phdr
 *
	$rw_öô
(
x
)

431 
√wlöe
 = 0;

432 
¥evch¨
 = -1;

433 
bfs
[0].
cou¡î
 = 
BF_ALLOC
;

434 
cuºít
 = 0;

435 
bfs
[1].
cou¡î
 = 
BF_FREE
;

436 
√xt⁄e
 = 
x
;

437  &
bfs
[0].
buf
.
hdr
;

438 
	}
}

440 
t·phdr
 *
	$w_öô
()

442  
	`rw_öô
(0);

443 
	}
}

445 
t·phdr
 *
	$r_öô
()

447  
	`rw_öô
(1);

448 
	}
}

453 
	$ªadô
(
ã°ˇ£
 *
ã°
, 
t·phdr
 **
dµ
,

454 
c⁄vît
 )

456 
bf
 *
b
;

458 
bfs
[
cuºít
].
cou¡î
 = 
BF_FREE
;

459 
cuºít
 = !current;

461 
b
 = &
bfs
[
cuºít
];

462 i‡(
b
->
cou¡î
 =
BF_FREE
)

463 
	`ªad_ahód
(
ã°
, 
c⁄vît
);

465 *
dµ
 = &
b
->
buf
.
hdr
;

466  
b
->
cou¡î
;

467 
	}
}

473 
	$ªad_ahód
(
ã°ˇ£
 *
ã°
,

474 
c⁄vît
 )

476 
i
;

477 *
p
;

478 
c
;

479 
bf
 *
b
;

480 
t·phdr
 *
dp
;

482 
b
 = &
bfs
[
√xt⁄e
];

483 i‡(
b
->
cou¡î
 !
BF_FREE
)

485 
√xt⁄e
 = !nextone;

487 
dp
 = &
b
->
buf
.
hdr
;

489 i‡(
c⁄vît
 == 0) {

492 
size_t
 
c›y_n
 = 
	`MIN
(
SEGSIZE
, 
ã°
->
rcou¡
);

493 
	`mem˝y
(
dp
->
th_d©a
, 
ã°
->
Ωå
, 
c›y_n
);

496 
ã°
->
rcou¡
 -
c›y_n
;

497 
ã°
->
Ωå
 +
c›y_n
;

498 
b
->
cou¡î
 = ()
c›y_n
;

502 
p
 = 
dp
->
th_d©a
;

503 
i
 = 0 ; i < 
SEGSIZE
; i++) {

504 i‡(
√wlöe
) {

505 i‡(
¥evch¨
 == '\n')

506 
c
 = '\n';

508 
c
 = '\0';

509 
√wlöe
 = 0;

512 if(
ã°
->
rcou¡
) {

513 
c
=
ã°
->
Ωå
[0];

514 
ã°
->
Ωå
++;

515 
ã°
->
rcou¡
--;

519 i‡(
c
 == '\n' || c == '\r') {

520 
¥evch¨
 = 
c
;

521 
c
 = '\r';

522 
√wlöe
 = 1;

525 *
p
++ = ()
c
;

527 
b
->
cou¡î
 = ()(
p
 - 
dp
->
th_d©a
);

528 
	}
}

533 
	$wrôeô
(
ã°ˇ£
 *
ã°
, 
t·phdr
 * vﬁ©ûê*
dµ
,

534 
˘
, 
c⁄vît
)

536 
bfs
[
cuºít
].
cou¡î
 = 
˘
;

537 
cuºít
 = !current;

538 i‡(
bfs
[
cuºít
].
cou¡î
 !
BF_FREE
)

539 
	`wrôe_behöd
(
ã°
, 
c⁄vît
);

540 
bfs
[
cuºít
].
cou¡î
 = 
BF_ALLOC
;

541 *
dµ
 = &
bfs
[
cuºít
].
buf
.
hdr
;

542  
˘
;

543 
	}
}

551 
ssize_t
 
	$wrôe_behöd
(
ã°ˇ£
 *
ã°
, 
c⁄vît
)

553 *
wrôebuf
;

554 
cou¡
;

555 
˘
;

556 *
p
;

557 
c
;

558 
bf
 *
b
;

559 
t·phdr
 *
dp
;

561 
b
 = &
bfs
[
√xt⁄e
];

562 i‡(
b
->
cou¡î
 < -1)

565 if(!
ã°
->
ofûe
) {

566 
outfûe
[256];

567 
	`¢¥ötf
(
outfûe
, (outfûe), "log/u∂ﬂd.%ld", 
ã°
->
ã°no
);

568 
ã°
->
ofûe
=
	`›í
(
outfûe
, 
O_CREAT
|
O_RDWR
, 0777);

569 if(
ã°
->
ofûe
 == -1) {

570 
	`logmsg
("Couldn'à¸óãánd/‹ o≥¿fûê%†f‹ u∂ﬂd!", 
outfûe
);

575 
cou¡
 = 
b
->
cou¡î
;

576 
b
->
cou¡î
 = 
BF_FREE
;

577 
dp
 = &
b
->
buf
.
hdr
;

578 
√xt⁄e
 = !nextone;

579 
wrôebuf
 = 
dp
->
th_d©a
;

581 i‡(
cou¡
 <= 0)

584 i‡(
c⁄vît
 == 0)

585  
	`wrôe
(
ã°
->
ofûe
, 
wrôebuf
, 
cou¡
);

587 
p
 = 
wrôebuf
;

588 
˘
 = 
cou¡
;

589 
˘
--) {

590 
c
 = *
p
++;

591 i‡(
¥evch¨
 == '\r') {

592 i‡(
c
 == '\n')

593 
	`l£ek
(
ã°
->
ofûe
, -1, 
SEEK_CUR
);

595 i‡(
c
 == '\0')

596 
skùô
;

601 if(1 !
	`wrôe
(
ã°
->
ofûe
, &
c
, 1))

603 
skùô
:

604 
¥evch¨
 = 
c
;

606  
cou¡
;

607 
	}
}

620 
	$synch√t
(
cuæ_sockë_t
 
f
 )

623 #i‡
	`deföed
(
HAVE_IOCTLSOCKET
)

624 
i
;

626 
i
;

628 
j
 = 0;

629 
rbuf
[
PKTSIZE
];

630 
§vr_sockaddr_uni⁄_t
 
‰omaddr
;

631 
cuæ_sockÀn_t
 
‰omaddæí
;

634 #i‡
	`deföed
(
HAVE_IOCTLSOCKET
)

635 (Ë
	`io˘lsockë
(
f
, 
FIONREAD
, &
i
);

637 (Ë
	`io˘l
(
f
, 
FIONREAD
, &
i
);

639 i‡(
i
) {

640 
j
++;

641 #ifde‡
ENABLE_IPV6


642 if(!
u£_ùv6
)

644 
‰omaddæí
 = (
‰omaddr
.
ß4
);

645 #ifde‡
ENABLE_IPV6


647 
‰omaddæí
 = (
‰omaddr
.
ß6
);

649 (Ë
	`ªcv‰om
(
f
, 
rbuf
, (rbuf), 0,

650 &
‰omaddr
.
ß
, &
‰omaddæí
);

655  
j
;

656 
	}
}

658 
	$maö
(
¨gc
, **
¨gv
)

660 
§vr_sockaddr_uni⁄_t
 
me
;

661 
t·phdr
 *
ç
;

662 
ssize_t
 
n
 = 0;

663 
¨g
 = 1;

664 
p‹t
 = 
DEFAULT_PORT
;

665 
cuæ_sockë_t
 
sock
 = 
CURL_SOCKET_BAD
;

666 
Êag
;

667 
rc
;

668 
îr‹
;

669 
pid
;

670 
ã°ˇ£
 
ã°
;

671 
ªsu…
 = 0;

673 
	`mem£t
(&
ã°
, 0, (test));

675 
¨gc
>
¨g
) {

676 if(!
	`°rcmp
("--vîsi⁄", 
¨gv
[
¨g
])) {

677 
	`¥ötf
("tftpd IPv4%s\n",

678 #ifde‡
ENABLE_IPV6


686 if(!
	`°rcmp
("--pidfûe", 
¨gv
[
¨g
])) {

687 
¨g
++;

688 if(
¨gc
>
¨g
)

689 
pid«me
 = 
¨gv
[
¨g
++];

691 if(!
	`°rcmp
("--logfûe", 
¨gv
[
¨g
])) {

692 
¨g
++;

693 if(
¨gc
>
¨g
)

694 
£rvîlogfûe
 = 
¨gv
[
¨g
++];

696 if(!
	`°rcmp
("--ùv4", 
¨gv
[
¨g
])) {

697 #ifde‡
ENABLE_IPV6


698 
ùv_öu£
 = "IPv4";

699 
u£_ùv6
 = 
FALSE
;

701 
¨g
++;

703 if(!
	`°rcmp
("--ùv6", 
¨gv
[
¨g
])) {

704 #ifde‡
ENABLE_IPV6


705 
ùv_öu£
 = "IPv6";

706 
u£_ùv6
 = 
TRUE
;

708 
¨g
++;

710 if(!
	`°rcmp
("--p‹t", 
¨gv
[
¨g
])) {

711 
¨g
++;

712 if(
¨gc
>
¨g
) {

713 *
íd±r
;

714 
u um
 = 
	`°πoul
(
¨gv
[
¨g
], &
íd±r
, 10);

715 if((
íd±r
 !
¨gv
[
¨g
] + 
	`°æí
(argv[arg])) ||

716 (
u um
 < 1025UL) || (ulnum > 65535UL)) {

717 
	`Ârötf
(
°dîr
, "tftpd: invalid --portárgument (%s)\n",

718 
¨gv
[
¨g
]);

721 
p‹t
 = 
	`cuæx_u…ous
(
u um
);

722 
¨g
++;

725 if(!
	`°rcmp
("--§cdú", 
¨gv
[
¨g
])) {

726 
¨g
++;

727 if(
¨gc
>
¨g
) {

728 
∑th
 = 
¨gv
[
¨g
];

729 
¨g
++;

733 
	`puts
("Usage:Åftpd [option]\n"

745 #ifde‡
WIN32


746 
	`wö32_öô
();

747 
	`©exô
(
wö32_˛ónup
);

750 
	`ö°Æl_sig«l_h™dÀrs
();

752 
pid
 = ()
	`gëpid
();

754 #ifde‡
ENABLE_IPV6


755 if(!
u£_ùv6
)

757 
sock
 = 
	`sockë
(
AF_INET
, 
SOCK_DGRAM
, 0);

758 #ifde‡
ENABLE_IPV6


760 
sock
 = 
	`sockë
(
AF_INET6
, 
SOCK_DGRAM
, 0);

763 if(
CURL_SOCKET_BAD
 =
sock
) {

764 
îr‹
 = 
SOCKERRNO
;

765 
	`logmsg
("Error creating socket: (%d) %s",

766 
îr‹
, 
	`°ªº‹
(error));

767 
ªsu…
 = 1;

768 
t·pd_˛ónup
;

771 
Êag
 = 1;

772 i‡(0 !
	`£tsock›t
(
sock
, 
SOL_SOCKET
, 
SO_REUSEADDR
,

773 (*)&
Êag
, (flag))) {

774 
îr‹
 = 
SOCKERRNO
;

775 
	`logmsg
("setsockopt(SO_REUSEADDR) failed withÉrror: (%d) %s",

776 
îr‹
, 
	`°ªº‹
(error));

777 
ªsu…
 = 1;

778 
t·pd_˛ónup
;

781 #ifde‡
ENABLE_IPV6


782 if(!
u£_ùv6
) {

784 
	`mem£t
(&
me
.
ß4
, 0, (me.sa4));

785 
me
.
ß4
.
sö_Ámûy
 = 
AF_INET
;

786 
me
.
ß4
.
sö_addr
.
s_addr
 = 
INADDR_ANY
;

787 
me
.
ß4
.
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

788 
rc
 = 
	`böd
(
sock
, &
me
.
ß
, (me.
ß4
));

789 #ifde‡
ENABLE_IPV6


792 
	`mem£t
(&
me
.
ß6
, 0, (me.sa6));

793 
me
.
ß6
.
sö6_Ámûy
 = 
AF_INET6
;

794 
me
.
ß6
.
sö6_addr
 = 
ö6addr_™y
;

795 
me
.
ß6
.
sö6_p‹t
 = 
	`ht⁄s
(
p‹t
);

796 
rc
 = 
	`böd
(
sock
, &
me
.
ß
, (me.
ß6
));

799 if(0 !
rc
) {

800 
îr‹
 = 
SOCKERRNO
;

801 
	`logmsg
("Error binding socket onÖort %hu: (%d) %s",

802 
p‹t
, 
îr‹
, 
	`°ªº‹
(error));

803 
ªsu…
 = 1;

804 
t·pd_˛ónup
;

807 
wrŸïidfûe
 = 
	`wrôe_pidfûe
(
pid«me
);

808 if(!
wrŸïidfûe
) {

809 
ªsu…
 = 1;

810 
t·pd_˛ónup
;

813 
	`logmsg
("Ru¬ög %†vîsi⁄ o¿p‹àUDP/%d", 
ùv_öu£
, ()
p‹t
);

816 
‰omÀn
 = (
‰om
);

817 #ifde‡
ENABLE_IPV6


818 if(!
u£_ùv6
)

820 
‰omÀn
 = (
‰om
.
ß4
);

821 #ifde‡
ENABLE_IPV6


823 
‰omÀn
 = (
‰om
.
ß6
);

825 
n
 = (
ssize_t
)
	`ªcv‰om
(
sock
, &
buf
.
°‹age
[0], (buf.storage), 0,

826 &
‰om
.
ß
, &
‰omÀn
);

827 if(
gŸ_exô_sig«l
)

829 i‡(
n
 < 0) {

830 
	`logmsg
("recvfrom");

831 
ªsu…
 = 3;

835 
	`£t_advis‹_ªad_lock
(
SERVERLOGS_LOCK
);

836 
£rvîlog¶ocked
 = 1;

838 #ifde‡
ENABLE_IPV6


839 if(!
u£_ùv6
) {

841 
‰om
.
ß4
.
sö_Ámûy
 = 
AF_INET
;

842 
≥î
 = 
	`sockë
(
AF_INET
, 
SOCK_DGRAM
, 0);

843 if(
CURL_SOCKET_BAD
 =
≥î
) {

844 
	`logmsg
("socket");

845 
ªsu…
 = 2;

848 if(
	`c⁄√˘
(
≥î
, &
‰om
.
ß
, (‰om.
ß4
)) < 0) {

849 
	`logmsg
("connect: fail");

850 
ªsu…
 = 1;

853 #ifde‡
ENABLE_IPV6


856 
‰om
.
ß6
.
sö6_Ámûy
 = 
AF_INET6
;

857 
≥î
 = 
	`sockë
(
AF_INET6
, 
SOCK_DGRAM
, 0);

858 if(
CURL_SOCKET_BAD
 =
≥î
) {

859 
	`logmsg
("socket");

860 
ªsu…
 = 2;

863 if(
	`c⁄√˘
(
≥î
, &
‰om
.
ß
, (‰om.
ß6
)) < 0) {

864 
	`logmsg
("connect: fail");

865 
ªsu…
 = 1;

871 
maxtimeout
 = 5*
TIMEOUT
;

873 
ç
 = &
buf
.
hdr
;

874 
ç
->
th_›code
 = 
	`¡ohs
(tp->th_opcode);

875 i‡(
ç
->
th_›code
 =
›code_RRQ
 ||Åp->th_›codê=
›code_WRQ
) {

876 
	`mem£t
(&
ã°
, 0, (test));

877 i‡(
	`do_t·p
(&
ã°
, 
ç
, 
n
) < 0)

879 if(
ã°
.
buf„r
)

880 
	`‰ì
(
ã°
.
buf„r
);

882 
	`s˛o£
(
≥î
);

883 
≥î
 = 
CURL_SOCKET_BAD
;

885 if(
ã°
.
ofûe
 > 0) {

886 
	`˛o£
(
ã°
.
ofûe
);

887 
ã°
.
ofûe
 = 0;

890 if(
gŸ_exô_sig«l
)

893 if(
£rvîlog¶ocked
) {

894 
£rvîlog¶ocked
 = 0;

895 
	`˛ór_advis‹_ªad_lock
(
SERVERLOGS_LOCK
);

898 
	`logmsg
("end of oneÅransfer");

902 
t·pd_˛ónup
:

904 if(
ã°
.
ofûe
 > 0)

905 
	`˛o£
(
ã°
.
ofûe
);

907 if((
≥î
 !
sock
Ë&& (≥î !
CURL_SOCKET_BAD
))

908 
	`s˛o£
(
≥î
);

910 if(
sock
 !
CURL_SOCKET_BAD
)

911 
	`s˛o£
(
sock
);

913 if(
gŸ_exô_sig«l
)

914 
	`logmsg
("signalledÅo die");

916 if(
wrŸïidfûe
)

917 
	`u∆ök
(
pid«me
);

919 if(
£rvîlog¶ocked
) {

920 
£rvîlog¶ocked
 = 0;

921 
	`˛ór_advis‹_ªad_lock
(
SERVERLOGS_LOCK
);

924 
	`ª°‹e_sig«l_h™dÀrs
();

926 if(
gŸ_exô_sig«l
) {

927 
	`logmsg
("========> %sÅftpd (port: %dÖid: %ld)Éxits with signal (%d)",

928 
ùv_öu£
, ()
p‹t
, 
pid
, 
exô_sig«l
);

934 
	`øi£
(
exô_sig«l
);

937 
	`logmsg
("========>Åftpd quits");

938  
ªsu…
;

939 
	}
}

944 
	$do_t·p
(
ã°ˇ£
 *
ã°
, 
t·phdr
 *
ç
, 
ssize_t
 
size
)

946 *
˝
;

947 
fú°
 = 1, 
ecode
;

948 
f‹m©s
 *
pf
;

949 *
fûíame
, *
mode
 = 
NULL
;

950 
îr‹
;

951 
FILE
 *
£rvî
;

952 #ifde‡
USE_WINSOCK


953 
DWORD
 
ªcvtimeout
, 
ªcvtimeoutbak
;

957 
£rvî
 = 
	`f›í
(
REQUEST_DUMP
, "ab");

958 if(!
£rvî
) {

959 
îr‹
 = 
î∫o
;

960 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

961 
	`logmsg
("Eº‹ o≥nög fûe: %s", 
REQUEST_DUMP
);

966 
	`Ârötf
(
£rvî
, "›code: %x\n", 
ç
->
th_›code
);

968 
˝
 = (*)&
ç
->
th_°uff
;

969 
fûíame
 = 
˝
;

970 
agaö
:

971 
˝
 < &
buf
.
°‹age
[
size
]) {

972 i‡(*
˝
 == '\0')

974 
˝
++;

976 i‡(*
˝
) {

977 
	`«k
(
EBADOP
);

978 
	`f˛o£
(
£rvî
);

981 i‡(
fú°
) {

982 
mode
 = ++
˝
;

983 
fú°
 = 0;

984 
agaö
;

987 
	`Ârötf
(
£rvî
, "fûíame: %s\n", 
fûíame
);

989 
˝
 = 
mode
; cp && *cp; cp++)

990 if(
	`ISUPPER
(*
˝
))

991 *
˝
 = ()
	`tﬁowî
(()*cp);

994 
	`Ârötf
(
£rvî
, "mode: %s\n", 
mode
);

995 
	`f˛o£
(
£rvî
);

997 
pf
 = 
f‹m©a
;Öf->
f_mode
;Öf++)

998 i‡(
	`°rcmp
(
pf
->
f_mode
, 
mode
) == 0)

1000 i‡(!
pf
->
f_mode
) {

1001 
	`«k
(
EBADOP
);

1004 
ecode
 = 
	`vÆid©e_ac˚ss
(
ã°
, 
fûíame
, 
ç
->
th_›code
);

1005 i‡(
ecode
) {

1006 
	`«k
(
ecode
);

1010 #ifde‡
USE_WINSOCK


1011 
ªcvtimeout
 = (
ªcvtimeoutbak
);

1012 
	`gësock›t
(
≥î
, 
SOL_SOCKET
, 
SO_RCVTIMEO
,

1013 (*)&
ªcvtimeoutbak
, (*)&
ªcvtimeout
);

1014 
ªcvtimeout
 = 
TIMEOUT
*1000;

1015 
	`£tsock›t
(
≥î
, 
SOL_SOCKET
, 
SO_RCVTIMEO
,

1016 (c⁄° *)&
ªcvtimeout
, (recvtimeout));

1019 i‡(
ç
->
th_›code
 =
›code_WRQ
)

1020 
	`ªcvt·p
(
ã°
, 
pf
);

1022 
	`£ndt·p
(
ã°
, 
pf
);

1024 #ifde‡
USE_WINSOCK


1025 
ªcvtimeout
 = 
ªcvtimeoutbak
;

1026 
	`£tsock›t
(
≥î
, 
SOL_SOCKET
, 
SO_RCVTIMEO
,

1027 (c⁄° *)&
ªcvtimeout
, (recvtimeout));

1031 
	}
}

1034 
	$∑r£_£rvîcmd
(
ã°ˇ£
 *
ªq
)

1036 
FILE
 *
°ªam
;

1037 *
fûíame
;

1038 
îr‹
;

1040 
fûíame
 = 
	`ã°2fûe
(
ªq
->
ã°no
);

1042 
°ªam
=
	`f›í
(
fûíame
, "rb");

1043 if(!
°ªam
) {

1044 
îr‹
 = 
î∫o
;

1045 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

1046 
	`logmsg
(" [1] Eº‹ o≥nög fûe: %s", 
fûíame
);

1047 
	`logmsg
(" Couldn'à›íÅe° fûê%ld", 
ªq
->
ã°no
);

1051 *
‹gcmd
 = 
NULL
;

1052 *
cmd
 = 
NULL
;

1053 
size_t
 
cmdsize
 = 0;

1054 
num
=0;

1057 
îr‹
 = 
	`gë∑π
(&
‹gcmd
, &
cmdsize
, "ª∂y", "£rvîcmd", 
°ªam
);

1058 
	`f˛o£
(
°ªam
);

1059 if(
îr‹
) {

1060 
	`logmsg
("gë∑π(ËÁûed wôhÉº‹: %d", 
îr‹
);

1064 
cmd
 = 
‹gcmd
;

1065 
cmd
 && 
cmdsize
) {

1066 *
check
;

1067 if(1 =
	`ssˇnf
(
cmd
, "wrôedñay: %d", &
num
)) {

1068 
	`logmsg
("ö°ru˘edÅÿdñay %d sec†bëwì¿∑ckës", 
num
);

1069 
ªq
->
wrôedñay
 = 
num
;

1072 
	`logmsg
("Unknow¿<£rvîcmd> in°ru˘i⁄ found: %s", 
cmd
);

1075 
check
 = 
	`°rchr
(
cmd
, '\r');

1076 if(!
check
)

1077 
check
 = 
	`°rchr
(
cmd
, '\n');

1079 if(
check
) {

1081 (*
check
 == '\r') || (*check == '\n'))

1082 
check
++;

1084 if(!*
check
)

1087 
cmd
 = 
check
;

1092 if(
‹gcmd
)

1093 
	`‰ì
(
‹gcmd
);

1097 
	}
}

1103 
	$vÆid©e_ac˚ss
(
ã°ˇ£
 *
ã°
,

1104 c⁄° *
fûíame
, 
mode
)

1106 *
±r
;

1107 
ã°no
, 
∑πno
;

1108 
îr‹
;

1109 
∑πbuf
[80]="data";

1111 
	`logmsg
("åyögÅÿgë fûe: %†modê%x", 
fûíame
, 
mode
);

1113 if(!
	`°∫cmp
("vîifõd£rvî", 
fûíame
, 14)) {

1114 
wóª
[128];

1115 
size_t
 
cou¡
 = 
	`•rötf
(
wóª
, "WE ROOLZ: %ld\r\n", ()
	`gëpid
());

1117 
	`logmsg
("Are-we-friendly questionÑeceived");

1118 
ã°
->
buf„r
 = 
	`°rdup
(
wóª
);

1119 
ã°
->
Ωå
 =Åe°->
buf„r
;

1120 
ã°
->
bufsize
 = 
cou¡
;

1121 
ã°
->
rcou¡
 = 
cou¡
;

1126 
±r
 = 
	`°ºchr
(
fûíame
, '/');

1128 if(
±r
) {

1129 *
fûe
;

1131 
±r
++;

1134 *
±r
 && !
	`ISDIGIT
(*ptr))

1135 
±r
++;

1138 
ã°no
 = 
	`°πﬁ
(
±r
, &ptr, 10);

1140 if(
ã°no
 > 10000) {

1141 
∑πno
 = 
ã°no
 % 10000;

1142 
ã°no
 /= 10000;

1145 
∑πno
 = 0;

1148 
	`logmsg
("ªque°edÅe°Çumbî %ldÖ¨à%ld", 
ã°no
, 
∑πno
);

1150 
ã°
->
ã°no
 =Åestno;

1152 ()
	`∑r£_£rvîcmd
(
ã°
);

1154 
fûe
 = 
	`ã°2fûe
(
ã°no
);

1156 if(0 !
∑πno
)

1157 
	`•rötf
(
∑πbuf
, "d©a%ld", 
∑πno
);

1159 if(
fûe
) {

1160 
FILE
 *
°ªam
=
	`f›í
(
fûe
, "rb");

1161 if(!
°ªam
) {

1162 
îr‹
 = 
î∫o
;

1163 
	`logmsg
("f›í(ËÁûed wôhÉº‹: %d %s", 
îr‹
, 
	`°ªº‹
(error));

1164 
	`logmsg
("Eº‹ o≥nög fûe: %s", 
fûe
);

1165 
	`logmsg
("Couldn'à›íÅe° fûe: %s", 
fûe
);

1166  
EACCESS
;

1169 
size_t
 
cou¡
;

1170 
îr‹
 = 
	`gë∑π
(&
ã°
->
buf„r
, &
cou¡
, "ª∂y", 
∑πbuf
, 
°ªam
);

1171 
	`f˛o£
(
°ªam
);

1172 if(
îr‹
) {

1173 
	`logmsg
("gë∑π(ËÁûed wôhÉº‹: %d", 
îr‹
);

1174  
EACCESS
;

1176 if(
ã°
->
buf„r
) {

1177 
ã°
->
Ωå
 =Åe°->
buf„r
;

1178 
ã°
->
bufsize
 = 
cou¡
;

1179 
ã°
->
rcou¡
 = 
cou¡
;

1182  
EACCESS
;

1187  
EACCESS
;

1190 
	`logmsg
("no slash found inÖath");

1191  
EACCESS
;

1194 
	`logmsg
("file openedándáll is good");

1196 
	}
}

1201 
	$£ndt·p
(
ã°ˇ£
 *
ã°
, 
f‹m©s
 *
pf
)

1203 
size
;

1204 
ssize_t
 
n
;

1206 vﬁ©ûê
£ndblock
;

1207 
t·phdr
 *
sdp
;

1208 
t·phdr
 *
ßp
;

1210 
£ndblock
 = 1;

1211 #i‡
	`deföed
(
HAVE_ALARM
Ë&& deföed(
SIGALRM
)

1212 
	`mysig«l
(
SIGALRM
, 
timî
);

1214 
sdp
 = 
	`r_öô
();

1215 
ßp
 = &
ackbuf
.
hdr
;

1217 
size
 = 
	`ªadô
(
ã°
, &
sdp
, 
pf
->
f_c⁄vît
);

1218 i‡(
size
 < 0) {

1219 
	`«k
(
î∫o
 + 100);

1222 
sdp
->
th_›code
 = 
	`ht⁄s
(()
›code_DATA
);

1223 
sdp
->
th_block
 = 
	`ht⁄s
(
£ndblock
);

1224 
timeout
 = 0;

1225 #ifde‡
HAVE_SIGSETJMP


1226 (Ë
	`sig£tjmp
(
timeoutbuf
, 1);

1228 if(
ã°
->
wrôedñay
) {

1229 
	`logmsg
("Pausög %d sec⁄d†bef‹ê%d byãs", 
ã°
->
wrôedñay
,

1230 
size
);

1231 
	`waô_ms
(1000*
ã°
->
wrôedñay
);

1234 
£nd_d©a
:

1235 i‡(
	`swrôe
(
≥î
, 
sdp
, 
size
 + 4) != size + 4) {

1236 
	`logmsg
("write");

1239 
	`ªad_ahód
(
ã°
, 
pf
->
f_c⁄vît
);

1241 #ifde‡
HAVE_ALARM


1242 
	`Æ¨m
(
ªxmtvÆ
);

1244 
n
 = 
	`§ód
(
≥î
, &
ackbuf
.
°‹age
[0], (ackbuf.storage));

1245 #ifde‡
HAVE_ALARM


1246 
	`Æ¨m
(0);

1248 if(
gŸ_exô_sig«l
)

1250 i‡(
n
 < 0) {

1251 
	`logmsg
("read: fail");

1254 
ßp
->
th_›code
 = 
	`¡ohs
(()sap->th_opcode);

1255 
ßp
->
th_block
 = 
	`¡ohs
(sap->th_block);

1257 i‡(
ßp
->
th_›code
 =
›code_ERROR
) {

1258 
	`logmsg
("got ERROR");

1262 i‡(
ßp
->
th_›code
 =
›code_ACK
) {

1263 i‡(
ßp
->
th_block
 =
£ndblock
) {

1267 (Ë
	`synch√t
(
≥î
);

1268 i‡(
ßp
->
th_block
 =(
£ndblock
-1)) {

1269 
£nd_d©a
;

1274 
£ndblock
++;

1275 } 
size
 =
SEGSIZE
);

1276 
	}
}

1281 
	$ªcvt·p
(
ã°ˇ£
 *
ã°
, 
f‹m©s
 *
pf
)

1283 
ssize_t
 
n
, 
size
;

1285 vﬁ©ûê
ªcvblock
;

1286 
t·phdr
 * vﬁ©ûê
rdp
;

1287 
t·phdr
 *
øp
;

1289 
ªcvblock
 = 0;

1290 
rdp
 = 
	`w_öô
();

1291 #i‡
	`deföed
(
HAVE_ALARM
Ë&& deföed(
SIGALRM
)

1292 
	`mysig«l
(
SIGALRM
, 
timî
);

1294 
øp
 = &
ackbuf
.
hdr
;

1296 
timeout
 = 0;

1297 
øp
->
th_›code
 = 
	`ht⁄s
(()
›code_ACK
);

1298 
øp
->
th_block
 = 
	`ht⁄s
(
ªcvblock
);

1299 
ªcvblock
++;

1300 #ifde‡
HAVE_SIGSETJMP


1301 (Ë
	`sig£tjmp
(
timeoutbuf
, 1);

1303 
£nd_ack
:

1304 i‡(
	`swrôe
(
≥î
, &
ackbuf
.
°‹age
[0], 4) != 4) {

1305 
	`logmsg
("write: fail\n");

1306 
ab‹t
;

1308 
	`wrôe_behöd
(
ã°
, 
pf
->
f_c⁄vît
);

1310 #ifde‡
HAVE_ALARM


1311 
	`Æ¨m
(
ªxmtvÆ
);

1313 
n
 = 
	`§ód
(
≥î
, 
rdp
, 
PKTSIZE
);

1314 #ifde‡
HAVE_ALARM


1315 
	`Æ¨m
(0);

1317 if(
gŸ_exô_sig«l
)

1318 
ab‹t
;

1319 i‡(
n
 < 0) {

1320 
	`logmsg
("read: fail\n");

1321 
ab‹t
;

1323 
rdp
->
th_›code
 = 
	`¡ohs
(()rdp->th_opcode);

1324 
rdp
->
th_block
 = 
	`¡ohs
(rdp->th_block);

1325 i‡(
rdp
->
th_›code
 =
›code_ERROR
)

1326 
ab‹t
;

1327 i‡(
rdp
->
th_›code
 =
›code_DATA
) {

1328 i‡(
rdp
->
th_block
 =
ªcvblock
) {

1332 (Ë
	`synch√t
(
≥î
);

1333 i‡(
rdp
->
th_block
 =(
ªcvblock
-1))

1334 
£nd_ack
;

1338 
size
 = 
	`wrôeô
(
ã°
, &
rdp
, ()(
n
 - 4), 
pf
->
f_c⁄vît
);

1339 i‡(
size
 !(
n
-4)) {

1340 i‡(
size
 < 0)

1341 
	`«k
(
î∫o
 + 100);

1343 
	`«k
(
ENOSPACE
);

1344 
ab‹t
;

1346 } 
size
 =
SEGSIZE
);

1347 
	`wrôe_behöd
(
ã°
, 
pf
->
f_c⁄vît
);

1349 
øp
->
th_›code
 = 
	`ht⁄s
(()
›code_ACK
);

1350 
øp
->
th_block
 = 
	`ht⁄s
(
ªcvblock
);

1351 (Ë
	`swrôe
(
≥î
, &
ackbuf
.
°‹age
[0], 4);

1352 #i‡
	`deföed
(
HAVE_ALARM
Ë&& deföed(
SIGALRM
)

1353 
	`mysig«l
(
SIGALRM
, 
ju°timeout
);

1354 
	`Æ¨m
(
ªxmtvÆ
);

1357 
n
 = 
	`§ód
(
≥î
, &
buf
.
°‹age
[0], (buf.storage));

1358 #ifde‡
HAVE_ALARM


1359 
	`Æ¨m
(0);

1361 if(
gŸ_exô_sig«l
)

1362 
ab‹t
;

1363 i‡(
n
 >= 4 &&

1364 
rdp
->
th_›code
 =
›code_DATA
 &&

1365 
ªcvblock
 =
rdp
->
th_block
) {

1366 (Ë
	`swrôe
(
≥î
, &
ackbuf
.
°‹age
[0], 4);

1368 
ab‹t
:

1370 
	}
}

1376 
	$«k
(
îr‹
)

1378 
t·phdr
 *
ç
;

1379 
Àngth
;

1380 
îrmsg
 *
≥
;

1382 
ç
 = &
buf
.
hdr
;

1383 
ç
->
th_›code
 = 
	`ht⁄s
(()
›code_ERROR
);

1384 
ç
->
th_code
 = 
	`ht⁄s
(()
îr‹
);

1385 
≥
 = 
îrmsgs
;Öe->
e_code
 >= 0;Öe++)

1386 i‡(
≥
->
e_code
 =
îr‹
)

1388 i‡(
≥
->
e_code
 < 0) {

1389 
≥
->
e_msg
 = 
	`°ªº‹
(
îr‹
 - 100);

1390 
ç
->
th_code
 = 
EUNDEF
;

1392 
Àngth
 = ()
	`°æí
(
≥
->
e_msg
);

1396 
	`mem˝y
(
ç
->
th_msg
, 
≥
->
e_msg
, 
Àngth
 + 1);

1397 
Àngth
 += 5;

1398 i‡(
	`swrôe
(
≥î
, &
buf
.
°‹age
[0], 
Àngth
) !=Üength)

1399 
	`logmsg
("nak: fail\n");

1400 
	}
}

	@tests/server/util.c

22 
	~"£rvî_£tup.h
"

24 #ifde‡
HAVE_SIGNAL_H


25 
	~<sig«l.h
>

27 #ifde‡
HAVE_NETINET_IN_H


28 
	~<√töë/ö.h
>

30 #ifde‡
_XOPEN_SOURCE_EXTENDED


32 
	~<¨∑/öë.h
>

34 #ifde‡
HAVE_NETDB_H


35 
	~<√tdb.h
>

37 #ifde‡
HAVE_SYS_POLL_H


38 
	~<sys/pﬁl.h
>

39 #ñi‡
deföed
(
HAVE_POLL_H
)

40 
	~<pﬁl.h
>

43 
	#ENABLE_CURLX_PRINTF


	)

46 
	~"cuæx.h
"

47 
	~"gë∑π.h
"

48 
	~"utû.h
"

49 
	~"timevÆ.h
"

51 #ifde‡
USE_WINSOCK


52 #unde‡
EINTR


53 
	#EINTR
 4

	)

54 #unde‡
EINVAL


55 
	#EINVAL
 22

	)

58 #i‡
deföed
(
ENABLE_IPV6
Ë&& deföed(
__MINGW32__
)

59 c⁄° 
ö6_addr
 
	gö6addr_™y
 = {{ 
IN6ADDR_ANY_INIT
 }};

66 *
	$d©a_to_hex
(*
d©a
, 
size_t
 
Àn
)

68 
buf
[256*3];

69 
size_t
 
i
;

70 *
›å
 = 
buf
;

71 *
ùå
 = 
d©a
;

73 if(
Àn
 > 255)

74 
Àn
 = 255;

76 
i
=0; i < 
Àn
; i++) {

77 if((
d©a
[
i
] >= 0x20) && (data[i] < 0x7f))

78 *
›å
++ = *
ùå
++;

80 
	`•rötf
(
›å
, "%%%02x", *
ùå
++);

81 
›å
+=3;

84 *
›å
=0;

86  
buf
;

87 
	}
}

89 
	$logmsg
(c⁄° *
msg
, ...)

91 
va_li°
 
≠
;

92 
buf„r
[2048 + 1];

93 
FILE
 *
logÂ
;

94 
îr‹
;

95 
timevÆ
 
tv
;

96 
time_t
 
£c
;

97 
tm
 *
now
;

98 
timebuf
[20];

99 
time_t
 
ïoch_off£t
;

100 
known_off£t
;

102 i‡(!
£rvîlogfûe
) {

103 
	`Ârötf
(
°dîr
, "Error: serverlogfileÇot set\n");

107 
tv
 = 
	`cuæx_tvnow
();

108 if(!
known_off£t
) {

109 
ïoch_off£t
 = 
	`time
(
NULL
Ë- 
tv
.
tv_£c
;

110 
known_off£t
 = 1;

112 
£c
 = 
ïoch_off£t
 + 
tv
.
tv_£c
;

113 
now
 = 
	`loˇ…ime
(&
£c
);

115 
	`¢¥ötf
(
timebuf
, (timebuf), "%02d:%02d:%02d.%06ld",

116 ()
now
->
tm_hour
, (Íow->
tm_mö
, (Íow->
tm_£c
, ()
tv
.
tv_u£c
);

118 
	`va_°¨t
(
≠
, 
msg
);

119 
	`v¢¥ötf
(
buf„r
, (buf„r), 
msg
, 
≠
);

120 
	`va_íd
(
≠
);

122 
logÂ
 = 
	`f›í
(
£rvîlogfûe
, "ab");

123 if(
logÂ
) {

124 
	`Ârötf
(
logÂ
, "%†%s\n", 
timebuf
, 
buf„r
);

125 
	`f˛o£
(
logÂ
);

128 
îr‹
 = 
î∫o
;

129 
	`Ârötf
(
°dîr
, "fopen() failed withÉrror: %d %s\n",

130 
îr‹
, 
	`°ªº‹
(error));

131 
	`Ârötf
(
°dîr
, "Eº‹ o≥nög fûe: %s\n", 
£rvîlogfûe
);

132 
	`Ârötf
(
°dîr
, "MsgÇŸÜogged: %†%s\n", 
timebuf
, 
buf„r
);

134 
	}
}

136 #ifde‡
WIN32


138 
	$wö32_≥º‹
 (c⁄° *
msg
)

140 
buf
[512];

141 
DWORD
 
îr
 = 
SOCKERRNO
;

143 i‡(!
	`F‹m©Mesßge
(
FORMAT_MESSAGE_FROM_SYSTEM
, 
NULL
, 
îr
,

144 
LANG_NEUTRAL
, 
buf
, (buf), 
NULL
))

145 
	`¢¥ötf
(
buf
, (buf), "Unknow¿îr‹ %lu (%#lx)", 
îr
,Érr);

146 i‡(
msg
)

147 
	`Ârötf
(
°dîr
, "%s: ", 
msg
);

148 
	`Ârötf
(
°dîr
, "%s\n", 
buf
);

149 
	}
}

152 #ifde‡
USE_WINSOCK


153 
	$wö32_öô
()

155 
WORD
 
wVîsi⁄Reque°ed
;

156 
WSADATA
 
wßD©a
;

157 
îr
;

158 
wVîsi⁄Reque°ed
 = 
	`MAKEWORD
(
USE_WINSOCK
, USE_WINSOCK);

160 
îr
 = 
	`WSASèπup
(
wVîsi⁄Reque°ed
, &
wßD©a
);

162 i‡(
îr
 != 0) {

163 
	`≥º‹
("Winsock init failed");

164 
	`logmsg
("Error initialising winsock --áborting");

165 
	`exô
(1);

168 i‡–
	`LOBYTE
–
wßD©a
.
wVîsi⁄
 ) !
USE_WINSOCK
 ||

169 
	`HIBYTE
–
wßD©a
.
wVîsi⁄
 ) !
USE_WINSOCK
 ) {

171 
	`WSACÀ™up
();

172 
	`≥º‹
("Winsock init failed");

173 
	`logmsg
("No suitable winsock.dll found --áborting");

174 
	`exô
(1);

176 
	}
}

178 
	$wö32_˛ónup
()

180 
	`WSACÀ™up
();

181 
	}
}

185 c⁄° *
	g∑th
=".";

187 *
	$ã°2fûe
(
ã°no
)

189 
fûíame
[256];

190 
	`¢¥ötf
(
fûíame
, (fûíame), 
TEST_DATA_PATH
, 
∑th
, 
ã°no
);

191  
fûíame
;

192 
	}
}

203 
	$waô_ms
(
timeout_ms
)

205 #i‡!
	`deföed
(
MSDOS
Ë&& !deföed(
USE_WINSOCK
)

206 #i‚de‡
HAVE_POLL_FINE


207 
timevÆ
 
≥ndög_tv
;

209 
timevÆ
 
öôül_tv
;

210 
≥ndög_ms
;

211 
îr‹
;

213 
r
 = 0;

215 if(!
timeout_ms
)

217 if(
timeout_ms
 < 0) {

218 
î∫o
 = 
EINVAL
;

221 #i‡
	`deföed
(
MSDOS
)

222 
	`dñay
(
timeout_ms
);

223 #ñi‡
	`deföed
(
USE_WINSOCK
)

224 
	`SÀï
(
timeout_ms
);

226 
≥ndög_ms
 = 
timeout_ms
;

227 
öôül_tv
 = 
	`cuæx_tvnow
();

229 #i‡
	`deföed
(
HAVE_POLL_FINE
)

230 
r
 = 
	`pﬁl
(
NULL
, 0, 
≥ndög_ms
);

232 
≥ndög_tv
.
tv_£c
 = 
≥ndög_ms
 / 1000;

233 
≥ndög_tv
.
tv_u£c
 = (
≥ndög_ms
 % 1000) * 1000;

234 
r
 = 
	`£À˘
(0, 
NULL
, NULL, NULL, &
≥ndög_tv
);

236 if(
r
 != -1)

238 
îr‹
 = 
î∫o
;

239 if(
îr‹
 && (îr‹ !
EINTR
))

241 
≥ndög_ms
 = 
timeout_ms
 - ()
	`cuæx_tvdiff
(
	`cuæx_tvnow
(), 
öôül_tv
);

242 if(
≥ndög_ms
 <= 0)

244 } 
r
 == -1);

246 if(
r
)

247 
r
 = -1;

248  
r
;

249 
	}
}

251 
	$wrôe_pidfûe
(c⁄° *
fûíame
)

253 
FILE
 *
pidfûe
;

254 
pid
;

256 
pid
 = ()
	`gëpid
();

257 
pidfûe
 = 
	`f›í
(
fûíame
, "wb");

258 if(!
pidfûe
) {

259 
	`logmsg
("Couldn'àwrôêpid fûe: %†%s", 
fûíame
, 
	`°ªº‹
(
î∫o
));

262 
	`Ârötf
(
pidfûe
, "%ld\n", 
pid
);

263 
	`f˛o£
(
pidfûe
);

264 
	`logmsg
("WrŸêpid %ldÅÿ%s", 
pid
, 
fûíame
);

266 
	}
}

268 
	$£t_advis‹_ªad_lock
(c⁄° *
fûíame
)

270 
FILE
 *
lockfûe
;

271 
îr‹
 = 0;

272 
ªs
;

275 
lockfûe
 = 
	`f›í
(
fûíame
, "wb");

276 } (
lockfûe
 =
NULL
Ë&& ((
îr‹
 = 
î∫o
Ë=
EINTR
));

277 if(
lockfûe
 =
NULL
) {

278 
	`logmsg
("Error creatingÜock file %sÉrror: %d %s",

279 
fûíame
, 
îr‹
, 
	`°ªº‹
(error));

284 
ªs
 = 
	`f˛o£
(
lockfûe
);

285 } 
ªs
 && ((
îr‹
 = 
î∫o
Ë=
EINTR
));

286 if(
ªs
)

287 
	`logmsg
("Error closingÜock file %sÉrror: %d %s",

288 
fûíame
, 
îr‹
, 
	`°ªº‹
(error));

289 
	}
}

291 
	$˛ór_advis‹_ªad_lock
(c⁄° *
fûíame
)

293 
îr‹
 = 0;

294 
ªs
;

303 
ªs
 = 
	`u∆ök
(
fûíame
);

304 } 
ªs
 && ((
îr‹
 = 
î∫o
Ë=
EINTR
));

305 if(
ªs
)

306 
	`logmsg
("ErrorÑemovingÜock file %sÉrror: %d %s",

307 
fûíame
, 
îr‹
, 
	`°ªº‹
(error));

308 
	}
}

	@tests/server/util.h

1 #i‚de‡
HEADER_CURL_SERVER_UTIL_H


2 
	#HEADER_CURL_SERVER_UTIL_H


	)

24 
	~"£rvî_£tup.h
"

26 *
d©a_to_hex
(*
d©a
, 
size_t
 
Àn
);

27 
logmsg
(c⁄° *
msg
, ...);

29 
	#TEST_DATA_PATH
 "%s/d©a/ã°%ld"

	)

31 
	#SERVERLOGS_LOCK
 "log/£rvîlogs.lock"

	)

34 c⁄° *
∑th
;

37 c⁄° *
£rvîlogfûe
;

39 #ifde‡
WIN32


40 
	~<¥o˚ss.h
>

41 
	~<f˙é.h
>

43 
	#¶ìp
(
£c
Ë
	`SÀï
 ((£c)*1000)

	)

45 #unde‡
≥º‹


46 
	#≥º‹
(
m
Ë
	`wö32_≥º‹
(m)

	)

47 
wö32_≥º‹
 (c⁄° *
msg
);

50 #ifde‡
USE_WINSOCK


51 
wö32_öô
();

52 
wö32_˛ónup
();

56 *
ã°2fûe
(
ã°no
);

58 
waô_ms
(
timeout_ms
);

60 
wrôe_pidfûe
(c⁄° *
fûíame
);

62 
£t_advis‹_ªad_lock
(c⁄° *
fûíame
);

64 
˛ór_advis‹_ªad_lock
(c⁄° *
fûíame
);

	@tests/unit/curlcheck.h

22 
	~"ã°.h
"

25 
	#Áû_if
(
ex¥
, 
msg
) \

26 if(
ex¥
) { \

27 
	`Ârötf
(
°dîr
, "%s:%d Assertion '%s' met: %s\n" , \

28 
__FILE__
, 
__LINE__
, #ex¥, 
msg
); \

29 
unôÁû
++; \

30 }

	)

32 
	#Áû_u∆ess
(
ex¥
, 
msg
) \

33 if(!(
ex¥
)) { \

34 
	`Ârötf
(
°dîr
, "%s:%d Assertion '%s' failed: %s\n", \

35 
__FILE__
, 
__LINE__
, #ex¥, 
msg
); \

36 
unôÁû
++; \

37 }

	)

39 
	#vîify_mem‹y
(
dy«mic
, 
check
, 
Àn
) \

40 if(
dy«mic
 && 
	`memcmp
(dy«mic, 
check
, 
Àn
)) { \

41 
	`Ârötf
(
°dîr
, "%s:%d The dynamic string didn't match '%s'\n", \

42 
__FILE__
, 
__LINE__
, 
check
); \

43 
unôÁû
++; \

44 }

	)

48 
	#Áû
(
msg
) do { \

49 
	`Ârötf
(
°dîr
, "%s:%dÅest failed: '%s'\n", \

50 
__FILE__
, 
__LINE__
, 
msg
); \

51 
unôÁû
++; \

52 } 
WHILE_FALSE


	)

56 
	#ab‹t_if
(
ex¥
, 
msg
) \

57 if(
ex¥
) { \

58 
	`Ârötf
(
°dîr
, "%s:%d Abortássertion '%s' met: %s\n" , \

59 
__FILE__
, 
__LINE__
, #ex¥, 
msg
); \

60 
unôÁû
++; \

61 
unô_ã°_ab‹t
; \

62 }

	)

64 
	#ab‹t_u∆ess
(
ex¥
, 
msg
) \

65 if(!(
ex¥
)) { \

66 
	`Ârötf
(
°dîr
, "%s:%d Abortássertion '%s' failed: %s\n", \

67 
__FILE__
, 
__LINE__
, #ex¥, 
msg
); \

68 
unôÁû
++; \

69 
unô_ã°_ab‹t
; \

70 }

	)

72 
	#ab‹t_ã°
(
msg
) do { \

73 
	`Ârötf
(
°dîr
, "%s:%dÅestáborted: '%s'\n", \

74 
__FILE__
, 
__LINE__
, 
msg
); \

75 
unôÁû
++; \

76 
unô_ã°_ab‹t
; \

77 } 
WHILE_FALSE


	)

81 
unôÁû
;

83 
	#UNITTEST_START
 \

84 
	`ã°
(*
¨g
) \

86 ()
¨g
; \

87 i‡(
	`unô_£tup
()) { \

88 
	`Áû
("unit_setup() failure"); \

89 } {

	)

91 
	#UNITTEST_STOP
 \

92 
unô_ã°_ab‹t
; \

93 
unô_ã°_ab‹t
: \

94 
	`unô_°›
(); \

96  
unôÁû
; \

97 }

	)

	@tests/unit/unit1300.c

22 
	~"cuæcheck.h
"

24 
	~"Œi°.h
"

26 
cuæ_Œi°
 *
	gŒi°
;

28 
cuæ_Œi°
 *
	gŒi°_de°ö©i⁄
;

30 
	$ã°_cuæ_Œi°_dt‹
(*
key
, *
vÆue
)

33 ()
key
;

34 ()
vÆue
;

35 
	}
}

37 
CURLcode
 
	$unô_£tup
()

39 
Œi°
 = 
	`Cuæ_Œi°_Æloc
(
ã°_cuæ_Œi°_dt‹
);

40 if(!
Œi°
)

41  
CURLE_OUT_OF_MEMORY
;

42 
Œi°_de°ö©i⁄
 = 
	`Cuæ_Œi°_Æloc
(
ã°_cuæ_Œi°_dt‹
);

43 if(!
Œi°_de°ö©i⁄
) {

44 
	`Cuæ_Œi°_de°roy
(
Œi°
, 
NULL
);

45  
CURLE_OUT_OF_MEMORY
;

48  
CURLE_OK
;

49 
	}
}

51 
	$unô_°›
()

53 
	`Cuæ_Œi°_de°roy
(
Œi°
, 
NULL
);

54 
	`Cuæ_Œi°_de°roy
(
Œi°_de°ö©i⁄
, 
NULL
);

55 
	}
}

57 
UNITTEST_START


58 
	gunu£dD©a_ˇ£1
 = 1;

59 
	gunu£dD©a_ˇ£2
 = 2;

60 
	gunu£dD©a_ˇ£3
 = 3;

61 
cuæ_Œi°_ñemít
 *
	ghód
;

62 
cuæ_Œi°_ñemít
 *
	gñemít_√xt
;

63 
cuæ_Œi°_ñemít
 *
	gñemít_¥ev
;

64 
cuæ_Œi°_ñemít
 *
	gto_ªmove
;

65 
size_t
 
	gŒi°_size
 = 
Cuæ_Œi°_cou¡
(
Œi°
);

66 
	gcuæEºCode
 = 0;

79 
Áû_u∆ess
(
Œi°
->
size
 == 0, "list initial size should be zero");

80 
Áû_u∆ess
(
Œi°
->
hód
 =
NULL
, "list head should initiateÅo NULL");

81 
Áû_u∆ess
(
Œi°
->
èû
 =
NULL
, "listÅail should intiateÅo NULL");

82 
Áû_u∆ess
(
Œi°
->
dt‹
 =
ã°_cuæ_Œi°_dt‹
,

95 
	gcuæEºCode
 = 
Cuæ_Œi°_ö£π_√xt
(
Œi°
,Üli°->
hód
, &
unu£dD©a_ˇ£1
);

96 if(
	gcuæEºCode
 == 1) {

97 
Áû_u∆ess
(
Cuæ_Œi°_cou¡
(
Œi°
) == 1,

100 
Áû_u∆ess
(
Œi°
->
hód
->
±r
 =&
unu£dD©a_ˇ£1
,

103 
Áû_u∆ess
(
Œi°
->
èû
 =Œi°->
hód
,

115 
	gcuæEºCode
 = 
Cuæ_Œi°_ö£π_√xt
(
Œi°
,Üli°->
hód
,

116 &
unu£dD©a_ˇ£3
);

117 if(
	gcuæEºCode
 == 1) {

118 
Áû_u∆ess
(
Œi°
->
hód
->
√xt
->
±r
 =&
unu£dD©a_ˇ£3
,

120 
Áû_u∆ess
(
Œi°
->
èû
->
±r
 =&
unu£dD©a_ˇ£3
,

124 
¥ötf
("skipping Curl_llist_insert_nextásáÇon "

137 
	gcuæEºCode
 = 
Cuæ_Œi°_ö£π_√xt
(
Œi°
,Üli°->
hód
,

138 &
unu£dD©a_ˇ£2
);

139 if(
	gcuæEºCode
 == 1) {

140 
Áû_u∆ess
(
Œi°
->
hód
->
√xt
->
±r
 =&
unu£dD©a_ˇ£2
,

143 
Áû_u∆ess
(
Œi°
->
èû
->
±r
 !&
unu£dD©a_ˇ£2
,

147 
¥ötf
("skipping Curl_llist_insert_nextásáÇon "

153 
¥ötf
("skipping Curl_llist_insert_nextásáÇon "

168 
	ghód
=
Œi°
->
hód
;

169 
ab‹t_u∆ess
(
hód
, "llist->head is NULL");

170 
	gñemít_√xt
 = 
hód
->
√xt
;

171 
	gŒi°_size
 = 
Cuæ_Œi°_cou¡
(
Œi°
);

173 
Cuæ_Œi°_ªmove
(
Œi°
,Üli°->
hód
, 
NULL
);

175 
Áû_u∆ess
(
Cuæ_Œi°_cou¡
(
Œi°
Ë=(
Œi°_size
-1),

177 
Áû_u∆ess
(
Œi°
->
hód
 =
ñemít_√xt
,

179 
ab‹t_u∆ess
(
Œi°
->
hód
, "llist->head is NULL");

180 
Áû_u∆ess
(
Œi°
->
hód
->
¥ev
 =
NULL
,

193 
Cuæ_Œi°_ö£π_√xt
(
Œi°
,Üli°->
hód
, &
unu£dD©a_ˇ£3
);

194 
	gŒi°_size
 = 
Cuæ_Œi°_cou¡
(
Œi°
);

195 
	gto_ªmove
 = 
Œi°
->
hód
->
√xt
;

196 
ab‹t_u∆ess
(
to_ªmove
, "to_remove is NULL");

197 
	gñemít_√xt
 = 
to_ªmove
->
√xt
;

198 
	gñemít_¥ev
 = 
to_ªmove
->
¥ev
;

199 
Cuæ_Œi°_ªmove
(
Œi°
, 
to_ªmove
, 
NULL
);

200 
Áû_u∆ess
(
ñemít_¥ev
->
√xt
 =
ñemít_√xt
,

202 
ab‹t_u∆ess
(
ñemít_√xt
, "element_next is NULL");

203 
Áû_u∆ess
(
ñemít_√xt
->
¥ev
 =
ñemít_¥ev
,

216 
	gto_ªmove
 = 
Œi°
->
èû
;

217 
	gñemít_¥ev
 = 
to_ªmove
->
¥ev
;

218 
Cuæ_Œi°_ªmove
(
Œi°
, 
to_ªmove
, 
NULL
);

219 
Áû_u∆ess
(
Œi°
->
èû
 =
ñemít_¥ev
,

231 
	gto_ªmove
 = 
Œi°
->
hód
;

232 
Cuæ_Œi°_ªmove
(
Œi°
, 
to_ªmove
, 
NULL
);

233 
Áû_u∆ess
(
Œi°
->
hód
 =
NULL
,

235 
Áû_u∆ess
(
Œi°
->
èû
 =
NULL
,

258 
	gcuæEºCode
 = 
Cuæ_Œi°_ö£π_√xt
(
Œi°
,Üli°->
hód
, &
unu£dD©a_ˇ£1
);

261 
ab‹t_u∆ess
(
cuæEºCode
 == 1,

263 
ab‹t_u∆ess
(
Cuæ_Œi°_cou¡
(
Œi°
) == 1,

265 
ab‹t_u∆ess
(
Cuæ_Œi°_cou¡
(
Œi°_de°ö©i⁄
) == 0,

269 
	gcuæEºCode
 = 
Cuæ_Œi°_move
(
Œi°
,Üli°->
hód
, 
Œi°_de°ö©i⁄
, 
NULL
);

270 
ab‹t_u∆ess
(
cuæEºCode
 == 1,

272 
Áû_u∆ess
(
Cuæ_Œi°_cou¡
(
Œi°
) == 0,

275 
Áû_u∆ess
(
Cuæ_Œi°_cou¡
(
Œi°_de°ö©i⁄
) == 1,

278 
Áû_u∆ess
(
Œi°
->
hód
 =
NULL
,

281 
Áû_u∆ess
(
Œi°_de°ö©i⁄
->
hód
 !
NULL
,

284 
Áû_u∆ess
(
Œi°_de°ö©i⁄
->
èû
 !
NULL
,

287 
Áû_u∆ess
(
Œi°_de°ö©i⁄
->
èû
 ==Ülist_destination->tail,

292 
	gUNITTEST_STOP


	@tests/unit/unit1301.c

22 
	~"cuæcheck.h
"

24 
	~"°ªquÆ.h
"

26 
CURLcode
 
	$unô_£tup
–Ë{ 
CURLE_OK
;
	}
}

27 
	$unô_°›
–Ë{
	}
}

29 
UNITTEST_START


31 
	grc
;

33 
	grc
 = 
cuæ_°ªquÆ
("iii", "III");

34 
Áû_u∆ess
–
rc
 != 0 , "return code should be zero" );

36 
	grc
 = 
cuæ_°ªquÆ
("iiia", "III");

37 
Áû_u∆ess
–
rc
 == 0 , "return code should be zero" );

39 
	grc
 = 
cuæ_°ªquÆ
("iii", "IIIa");

40 
Áû_u∆ess
–
rc
 == 0 , "return code should be zero" );

42 
	grc
 = 
cuæ_°ªquÆ
("iiiA", "IIIa");

43 
Áû_u∆ess
–
rc
 != 0 , "return code should beÇon-zero" );

45 
	grc
 = 
cuæ_°∫equÆ
("iii", "III", 3);

46 
Áû_u∆ess
–
rc
 != 0 , "return code should beÇon-zero" );

48 
	grc
 = 
cuæ_°∫equÆ
("iiiABC", "IIIcba", 3);

49 
Áû_u∆ess
–
rc
 != 0 , "return code should beÇon-zero" );

51 
	grc
 = 
cuæ_°∫equÆ
("ii", "II", 3);

52 
Áû_u∆ess
–
rc
 != 0 , "return code should beÇon-zero" );

54 
	gUNITTEST_STOP


	@tests/unit/unit1302.c

22 
	~"cuæcheck.h
"

24 
	~"uæd©a.h
"

25 
	~"uæ.h
"

26 
	~"cuæ_ba£64.h
"

27 
	~"memdebug.h
"

29 
Sessi⁄H™dÀ
 *
	gd©a
;

31 
CURLcode
 
	$unô_£tup
( )

33 
d©a
 = 
	`cuæ_ósy_öô
();

34 if(!
d©a
)

35  
CURLE_OUT_OF_MEMORY
;

36  
CURLE_OK
;

37 
	}
}

39 
	$unô_°›
( )

41 
	`cuæ_ósy_˛ónup
(
d©a
);

42 
	}
}

44 
UNITTEST_START


46 *
	gouçut
;

47 *
	gdecoded
;

48 
size_t
 
	gsize
 = 0;

49 
	g™ych¨
 = 'x';

50 
CURLcode
 
	grc
;

52 
	grc
 = 
Cuæ_ba£64_ícode
(
d©a
, "i", 1, &
ouçut
, &
size
);

53 
Áû_u∆ess
(
rc
 =
CURLE_OK
, "return code should be CURLE_OK");

54 
Áû_u∆ess
(
size
 == 4, "size should be 4");

55 
vîify_mem‹y
–
ouçut
, "aQ==", 4);

56 
Cuæ_ß„‰ì
(
ouçut
);

58 
	grc
 = 
Cuæ_ba£64_ícode
(
d©a
, "ii", 2, &
ouçut
, &
size
);

59 
Áû_u∆ess
(
rc
 =
CURLE_OK
, "return code should be CURLE_OK");

60 
Áû_u∆ess
(
size
 == 4, "size should be 4");

61 
vîify_mem‹y
–
ouçut
, "aWk=", 4);

62 
Cuæ_ß„‰ì
(
ouçut
);

64 
	grc
 = 
Cuæ_ba£64_ícode
(
d©a
, "iii", 3, &
ouçut
, &
size
);

65 
Áû_u∆ess
(
rc
 =
CURLE_OK
, "return code should be CURLE_OK");

66 
Áû_u∆ess
(
size
 == 4, "size should be 4");

67 
vîify_mem‹y
–
ouçut
, "aWlp", 4);

68 
Cuæ_ß„‰ì
(
ouçut
);

70 
	grc
 = 
Cuæ_ba£64_ícode
(
d©a
, "iiii", 4, &
ouçut
, &
size
);

71 
Áû_u∆ess
(
rc
 =
CURLE_OK
, "return code should be CURLE_OK");

72 
Áû_u∆ess
(
size
 == 8, "size should be 8");

73 
vîify_mem‹y
–
ouçut
, "aWlpaQ==", 8);

74 
Cuæ_ß„‰ì
(
ouçut
);

77 
	grc
 = 
Cuæ_ba£64_ícode
(
d©a
, "iiii", 0, &
ouçut
, &
size
);

78 
Áû_u∆ess
(
rc
 =
CURLE_OK
, "return code should be CURLE_OK");

79 
Áû_u∆ess
(
size
 == 8, "size should be 8");

80 
vîify_mem‹y
–
ouçut
, "aWlpaQ==", 8);

81 
Cuæ_ß„‰ì
(
ouçut
);

83 
	grc
 = 
Cuæ_ba£64_decode
("aWÕaQ==", &
decoded
, &
size
);

84 
Áû_u∆ess
(
rc
 =
CURLE_OK
, "return code should be CURLE_OK");

85 
Áû_u∆ess
(
size
 == 4, "size should be 4");

86 
vîify_mem‹y
(
decoded
, "iiii", 4);

87 
Cuæ_ß„‰ì
(
decoded
);

89 
	grc
 = 
Cuæ_ba£64_decode
("aWÕ", &
decoded
, &
size
);

90 
Áû_u∆ess
(
rc
 =
CURLE_OK
, "return code should be CURLE_OK");

91 
Áû_u∆ess
(
size
 == 3, "size should be 3");

92 
vîify_mem‹y
(
decoded
, "iii", 3);

93 
Cuæ_ß„‰ì
(
decoded
);

95 
	grc
 = 
Cuæ_ba£64_decode
("aWk=", &
decoded
, &
size
);

96 
Áû_u∆ess
(
rc
 =
CURLE_OK
, "return code should be CURLE_OK");

97 
Áû_u∆ess
(
size
 == 2, "size should be 2");

98 
vîify_mem‹y
(
decoded
, "ii", 2);

99 
Cuæ_ß„‰ì
(
decoded
);

101 
	grc
 = 
Cuæ_ba£64_decode
("aQ==", &
decoded
, &
size
);

102 
Áû_u∆ess
(
rc
 =
CURLE_OK
, "return code should be CURLE_OK");

103 
Áû_u∆ess
(
size
 == 1, "size should be 1");

104 
vîify_mem‹y
(
decoded
, "i", 2);

105 
Cuæ_ß„‰ì
(
decoded
);

108 
	gsize
 = 1;

109 
	gdecoded
 = &
™ych¨
;

110 
	grc
 = 
Cuæ_ba£64_decode
("aQ", &
decoded
, &
size
);

111 
Áû_u∆ess
(
rc
 =
CURLE_BAD_CONTENT_ENCODING
, "return code should be CURLE_BAD_CONTENT_ENCODING");

112 
Áû_u∆ess
(
size
 == 0, "size should be 0");

113 
Áû_if
(
decoded
, "returnedÖointer should be NULL");

116 
	gsize
 = 1;

117 
	gdecoded
 = &
™ych¨
;

118 
	grc
 = 
Cuæ_ba£64_decode
("a===", &
decoded
, &
size
);

119 
Áû_u∆ess
(
rc
 =
CURLE_BAD_CONTENT_ENCODING
, "return code should be CURLE_BAD_CONTENT_ENCODING");

120 
Áû_u∆ess
(
size
 == 0, "size should be 0");

121 
Áû_if
(
decoded
, "returnedÖointer should be NULL");

124 
	gsize
 = 1;

125 
	gdecoded
 = &
™ych¨
;

126 
	grc
 = 
Cuæ_ba£64_decode
("a=Q=", &
decoded
, &
size
);

127 
Áû_u∆ess
(
rc
 =
CURLE_BAD_CONTENT_ENCODING
, "return code should be CURLE_BAD_CONTENT_ENCODING");

128 
Áû_u∆ess
(
size
 == 0, "size should be 0");

129 
Áû_if
(
decoded
, "returnedÖointer should be NULL");

132 
	gsize
 = 1;

133 
	gdecoded
 = &
™ych¨
;

134 
	grc
 = 
Cuæ_ba£64_decode
("a\x1f==", &
decoded
, &
size
);

135 
Áû_u∆ess
(
rc
 =
CURLE_BAD_CONTENT_ENCODING
, "return code should be CURLE_BAD_CONTENT_ENCODING");

136 
Áû_u∆ess
(
size
 == 0, "size should be 0");

137 
Áû_if
(
decoded
, "returnedÖointer should be NULL");

139 
	gUNITTEST_STOP


	@tests/unit/unit1303.c

22 
	~"cuæcheck.h
"

24 
	~"uæd©a.h
"

25 
	~"c⁄√˘.h
"

26 
	~"memdebug.h
"

28 
Sessi⁄H™dÀ
 *
	gd©a
;

30 
CURLcode
 
	$unô_£tup
( )

32 
d©a
 = 
	`cuæ_ósy_öô
();

33 i‡(!
d©a
)

34  
CURLE_OUT_OF_MEMORY
;

35  
CURLE_OK
;

36 
	}
}

38 
	$unô_°›
( )

40 
	`cuæ_ósy_˛ónup
(
d©a
);

41 
	}
}

45 
	#BASE
 1000000

	)

48 
	#NOW
(
x
,
y
Ë
now
.
tv_£c
 = x;Çow.
tv_u£c
 = 
	)
y

50 
	#TIMEOUTS
(
x
,
y
Ë
d©a
->
£t
.
timeout
 = x; d©a->£t.
c⁄√˘timeout
 = 
	)
y

61 
	stimëe°
 {

62 
	mnow_s
;

63 
	mnow_us
;

64 
	mtimeout_ms
;

65 
	mc⁄√˘timeout_ms
;

66 
boﬁ
 
	mc⁄√˘ög
;

67 
	mªsu…
;

68 c⁄° *
	mcommít
;

71 
UNITTEST_START


73 
timevÆ
 
	gnow
;

74 
	gtimeout
;

75 
	gi
;

77 c⁄° 
timëe°
 
	grun
[] = {

79 {
BASE
 + 4, 0, 10000, 8000, 
FALSE
, 6000, "6 seconds should beÜeft"},

80 {
BASE
 + 4, 990000, 10000, 8000, 
FALSE
, 5010, "5010 ms should beÜeft"},

81 {
BASE
 + 10, 0, 10000, 8000, 
FALSE
, -1, "timeout is -1,Éxpired"},

82 {
BASE
 + 12, 0, 10000, 8000, 
FALSE
, -2000, "-2000, overdue 2 seconds"},

85 {
BASE
 + 4, 0, 10000, 8000, 
TRUE
, 4000, "4 seconds should beÜeft"},

86 {
BASE
 + 4, 990000, 10000, 8000, 
TRUE
, 3010, "3010 ms should beÜeft"},

87 {
BASE
 + 8, 0, 10000, 8000, 
TRUE
, -1, "timeout is -1,Éxpired"},

88 {
BASE
 + 10, 0, 10000, 8000, 
TRUE
, -2000, "-2000, overdue 2 seconds"},

91 {
BASE
 + 4, 0, 10000, 0, 
FALSE
, 6000, "6 seconds should beÜeft"},

92 {
BASE
 + 4, 990000, 10000, 0, 
FALSE
, 5010, "5010 ms should beÜeft"},

93 {
BASE
 + 10, 0, 10000, 0, 
FALSE
, -1, "timeout is -1,Éxpired"},

94 {
BASE
 + 12, 0, 10000, 0, 
FALSE
, -2000, "-2000, overdue 2 seconds"},

97 {
BASE
 + 4, 0, 10000, 0, 
FALSE
, 6000, "6 seconds should beÜeft"},

98 {
BASE
 + 4, 990000, 10000, 0, 
FALSE
, 5010, "5010 ms should beÜeft"},

99 {
BASE
 + 10, 0, 10000, 0, 
FALSE
, -1, "timeout is -1,Éxpired"},

100 {
BASE
 + 12, 0, 10000, 0, 
FALSE
, -2000, "-2000, overdue 2 seconds"},

103 {
BASE
 + 4, 0, 0, 10000, 
FALSE
, 0, "noÅimeoutáctive"},

104 {
BASE
 + 4, 990000, 0, 10000, 
FALSE
, 0, "noÅimeoutáctive"},

105 {
BASE
 + 10, 0, 0, 10000, 
FALSE
, 0, "noÅimeoutáctive"},

106 {
BASE
 + 12, 0, 0, 10000, 
FALSE
, 0, "noÅimeoutáctive"},

109 {
BASE
 + 4, 0, 0, 10000, 
TRUE
, 6000, "6 seconds should beÜeft"},

110 {
BASE
 + 4, 990000, 0, 10000, 
TRUE
, 5010, "5010 ms should beÜeft"},

111 {
BASE
 + 10, 0, 0, 10000, 
TRUE
, -1, "timeout is -1,Éxpired"},

112 {
BASE
 + 12, 0, 0, 10000, 
TRUE
, -2000, "-2000, overdue 2 seconds"},

115 {
BASE
 + 4, 0, 0, 0, 
FALSE
, 0, "noÅimeoutáctive"},

116 {
BASE
 + 4, 990000, 0, 0, 
FALSE
, 0, "noÅimeoutáctive"},

117 {
BASE
 + 10, 0, 0, 0, 
FALSE
, 0, "noÅimeoutáctive"},

118 {
BASE
 + 12, 0, 0, 0, 
FALSE
, 0, "noÅimeoutáctive"},

121 {
BASE
 + 4, 0, 0, 0, 
TRUE
, 296000, "noÅimeoutáctive"},

122 {
BASE
 + 4, 990000, 0, 0, 
TRUE
, 295010, "noÅimeoutáctive"},

123 {
BASE
 + 10, 0, 0, 0, 
TRUE
, 290000, "noÅimeoutáctive"},

124 {
BASE
 + 12, 0, 0, 0, 
TRUE
, 288000, "noÅimeoutáctive"},

127 {
BASE
 + 4, 0, 10000, 12000, 
TRUE
, 6000, "6 seconds should beÜeft"},

132 
	gd©a
->
	g¥ogªss
.
	gt_°¨tsögÀ
.
	gtv_£c
 = 
BASE
;

133 
	gd©a
->
	g¥ogªss
.
	gt_°¨tsögÀ
.
	gtv_u£c
 = 0;

134 
	gd©a
->
	g¥ogªss
.
	gt_°¨t›
.
	gtv_£c
 = 
BASE
;

135 
	gd©a
->
	g¥ogªss
.
	gt_°¨t›
.
	gtv_u£c
 = 0;

137 
	gi
=0; i < (
	grun
)/(run[0]); i++) {

138 
NOW
(
run
[
i
].
now_s
,Ñun[i].
now_us
);

139 
TIMEOUTS
(
run
[
i
].
timeout_ms
,Ñun[i].
c⁄√˘timeout_ms
);

140 
	gtimeout
 = 
Cuæ_timñe·
(
d©a
, &
now
, 
run
[
i
].
c⁄√˘ög
);

141 if(
	gtimeout
 !
run
[
i
].
ªsu…
)

142 
Áû
(
run
[
i
].
commít
);

146 
	gUNITTEST_STOP


	@tests/unit/unit1304.c

22 
	~"cuæcheck.h
"

23 
	~"√åc.h
"

24 
	~"memdebug.h
"

26 *
	glogö
;

27 *
	g∑ssw‹d
;

28 
	gfûíame
[64];

30 
CURLcode
 
	$unô_£tup
()

32 
∑ssw‹d
 = 
	`°rdup
("");

33 
logö
 = 
	`°rdup
("");

34 i‡(!
∑ssw‹d
 || !
logö
) {

35 
	`Cuæ_ß„‰ì
(
∑ssw‹d
);

36 
	`Cuæ_ß„‰ì
(
logö
);

37  
CURLE_OUT_OF_MEMORY
;

39  
CURLE_OK
;

40 
	}
}

42 
	$unô_°›
()

44 
	`Cuæ_ß„‰ì
(
∑ssw‹d
);

45 
	`Cuæ_ß„‰ì
(
logö
);

46 
	}
}

48 
UNITTEST_START


49 
	gªsu…
;

51 c⁄° * c⁄° 
	gfûíame1
 = "log/netrc1304";

52 
mem˝y
(
fûíame
, 
fûíame1
, 
°æí
(filename1));

57 
	gªsu…
 = 
Cuæ_∑r£√åc
("ã°.exam∂e.com", &
logö
, &
∑ssw‹d
, 
fûíame
);

58 
Áû_u∆ess
(
ªsu…
 == 1, "HostÇot found shouldÑeturn 1");

59 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

60 
Áû_u∆ess
(
∑ssw‹d
[0] == 0, "password shouldÇot have been changed");

61 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

62 
Áû_u∆ess
(
logö
[0] == 0, "login shouldÇot have been changed");

67 
‰ì
(
logö
);

68 
	glogö
 = 
°rdup
("me");

69 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

70 
	gªsu…
 = 
Cuæ_∑r£√åc
("exam∂e.com", &
logö
, &
∑ssw‹d
, 
fûíame
);

71 
Áû_u∆ess
(
ªsu…
 == 0, "Host should be found");

72 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

73 
Áû_u∆ess
(
∑ssw‹d
[0] == 0, "password shouldÇot have been changed");

74 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

75 
Áû_u∆ess
(
°∫cmp
(
logö
, "me", 2) == 0, "login shouldÇot have been changed");

80 
‰ì
(
logö
);

81 
	glogö
 = 
°rdup
("me");

82 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

83 
	gªsu…
 = 
Cuæ_∑r£√åc
("ã°.exam∂e.com", &
logö
, &
∑ssw‹d
, 
fûíame
);

84 
Áû_u∆ess
(
ªsu…
 == 1, "Host should be found");

85 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

86 
Áû_u∆ess
(
∑ssw‹d
[0] == 0, "password shouldÇot have been changed");

87 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

88 
Áû_u∆ess
(
°∫cmp
(
logö
, "me", 2) == 0, "login shouldÇot have been changed");

94 
‰ì
(
logö
);

95 
	glogö
 = 
°rdup
("admi");

96 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

97 
	gªsu…
 = 
Cuæ_∑r£√åc
("exam∂e.com", &
logö
, &
∑ssw‹d
, 
fûíame
);

98 
Áû_u∆ess
(
ªsu…
 == 0, "Host should be found");

99 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

100 
Áû_u∆ess
(
∑ssw‹d
[0] == 0, "password shouldÇot have been changed");

101 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

102 
Áû_u∆ess
(
°∫cmp
(
logö
, "admi", 4) == 0, "login shouldÇot have been changed");

108 
‰ì
(
logö
);

109 
	glogö
 = 
°rdup
("adminn");

110 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

111 
	gªsu…
 = 
Cuæ_∑r£√åc
("exam∂e.com", &
logö
, &
∑ssw‹d
, 
fûíame
);

112 
Áû_u∆ess
(
ªsu…
 == 0, "Host should be found");

113 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

114 
Áû_u∆ess
(
∑ssw‹d
[0] == 0, "password shouldÇot have been changed");

115 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

116 
Áû_u∆ess
(
°∫cmp
(
logö
, "adminn", 6) == 0, "login shouldÇot have been changed");

122 
‰ì
(
logö
);

123 
	glogö
 = 
°rdup
("");

124 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

125 
	gªsu…
 = 
Cuæ_∑r£√åc
("exam∂e.com", &
logö
, &
∑ssw‹d
, 
fûíame
);

126 
Áû_u∆ess
(
ªsu…
 == 0, "Host should have been found");

127 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

128 
Áû_u∆ess
(
°∫cmp
(
∑ssw‹d
, "passwd", 6) == 0,

130 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

131 
Áû_u∆ess
(
°∫cmp
(
logö
, "admin", 5) == 0, "login should be 'admin'");

137 
‰ì
(
∑ssw‹d
);

138 
	g∑ssw‹d
 = 
°rdup
("");

139 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

140 
	gªsu…
 = 
Cuæ_∑r£√åc
("exam∂e.com", &
logö
, &
∑ssw‹d
, 
fûíame
);

141 
Áû_u∆ess
(
ªsu…
 == 0, "Host should have been found");

142 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

143 
Áû_u∆ess
(
°∫cmp
(
∑ssw‹d
, "passwd", 6) == 0,

145 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

146 
Áû_u∆ess
(
°∫cmp
(
logö
, "admin", 5) == 0, "login should be 'admin'");

152 
‰ì
(
∑ssw‹d
);

153 
	g∑ssw‹d
 = 
°rdup
("");

154 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

155 
‰ì
(
logö
);

156 
	glogö
 = 
°rdup
("");

157 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

158 
	gªsu…
 = 
Cuæ_∑r£√åc
("cuæ.exam∂e.com", &
logö
, &
∑ssw‹d
, 
fûíame
);

159 
Áû_u∆ess
(
ªsu…
 == 0, "Host should have been found");

160 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

161 
Áû_u∆ess
(
°∫cmp
(
∑ssw‹d
, "none", 4) == 0,

163 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

164 
Áû_u∆ess
(
°∫cmp
(
logö
, "none", 4) == 0, "login should be 'none'");

170 
‰ì
(
∑ssw‹d
);

171 
	g∑ssw‹d
 = 
°rdup
("");

172 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

173 
	gªsu…
 = 
Cuæ_∑r£√åc
("cuæ.exam∂e.com", &
logö
, &
∑ssw‹d
, 
fûíame
);

174 
Áû_u∆ess
(
ªsu…
 == 0, "Host should have been found");

175 
ab‹t_u∆ess
(
∑ssw‹d
 !
NULL
, "returned NULL!");

176 
Áû_u∆ess
(
°∫cmp
(
∑ssw‹d
, "none", 4) == 0,

178 
ab‹t_u∆ess
(
logö
 !
NULL
, "returned NULL!");

179 
Áû_u∆ess
(
°∫cmp
(
logö
, "none", 4) == 0, "login should be 'none'");

185 
	gUNITTEST_STOP


	@tests/unit/unit1305.c

22 
	~"cuæcheck.h
"

24 #ifde‡
HAVE_NETINET_IN_H


25 
	~<√töë/ö.h
>

27 #ifde‡
HAVE_NETDB_H


28 
	~<√tdb.h
>

30 #ifde‡
HAVE_ARPA_INET_H


31 
	~<¨∑/öë.h
>

34 
	#ENABLE_CURLX_PRINTF


	)

35 
	~"cuæx.h
"

37 
	~"hash.h
"

38 
	~"ho°ù.h
"

40 
	~"memdebug.h
"

42 
Sessi⁄H™dÀ
 *
	gd©a
;

43 
cuæ_hash
 *
	ghp
;

44 *
	gd©a_key
;

45 
Cuæ_dns_íåy
 *
	gd©a_node
;

47 
CURLcode
 
	$unô_£tup
( )

49 
d©a
 = 
	`cuæ_ósy_öô
();

50 i‡(!
d©a
)

51  
CURLE_OUT_OF_MEMORY
;

53 
hp
 = 
	`Cuæ_mk_dnsˇche
();

54 if(!
hp
) {

55 
	`cuæ_ósy_˛ónup
(
d©a
);

56 
	`cuæ_globÆ_˛ónup
();

57  
CURLE_OUT_OF_MEMORY
;

59  
CURLE_OK
;

60 
	}
}

62 
	$unô_°›
( )

64 i‡(
d©a_node
) {

65 
	`Cuæ_‰ìaddröfo
(
d©a_node
->
addr
);

66 
	`‰ì
(
d©a_node
);

68 i‡(
d©a_key
)

69 
	`‰ì
(
d©a_key
);

71 
	`Cuæ_hash_de°roy
(
hp
);

73 
	`cuæ_ósy_˛ónup
(
d©a
);

74 
	`cuæ_globÆ_˛ónup
();

75 
	}
}

77 
Cuæ_addröfo
 *
	$Áke_ai
()

79 
Cuæ_addröfo
 *
ai
;

80 
ss_size
;

82 
ss_size
 =  (
sockaddr_ö
);

84 if((
ai
 = 
	`ˇŒoc
(1, (
Cuæ_addröfo
))Ë=
NULL
)

85  
NULL
;

87 if((
ai
->
ai_ˇn⁄«me
 = 
	`°rdup
("dummy")Ë=
NULL
) {

88 
	`‰ì
(
ai
);

89  
NULL
;

92 if((
ai
->
ai_addr
 = 
	`ˇŒoc
(1, 
ss_size
)Ë=
NULL
) {

93 
	`‰ì
(
ai
->
ai_ˇn⁄«me
);

94 
	`‰ì
(
ai
);

95  
NULL
;

98 
ai
->
ai_Ámûy
 = 
AF_INET
;

99 
ai
->
ai_addæí
 = 
ss_size
;

101  
ai
;

102 
	}
}

104 
CURLcode
 
	$¸óã_node
()

106 
d©a_key
 = 
	`≠rötf
("%s:%d", "dummy", 0);

107 i‡(!
d©a_key
)

108  
CURLE_OUT_OF_MEMORY
;

110 
d©a_node
 = 
	`ˇŒoc
(1, (
Cuæ_dns_íåy
));

111 i‡(!
d©a_node
)

112  
CURLE_OUT_OF_MEMORY
;

114 
d©a_node
->
addr
 = 
	`Áke_ai
();

115 i‡(!
d©a_node
->
addr
)

116  
CURLE_OUT_OF_MEMORY
;

118  
CURLE_OK
;

119 
	}
}

122 
UNITTEST_START


124 
Cuæ_dns_íåy
 *
	gnodï
;

125 
size_t
 
	gkey_Àn
;

128 i‡(
°rcmp
(
¨g
, "1305") != 0) {

129 
CURLcode
 
rc
 = 
¸óã_node
();

130 
ab‹t_u∆ess
(
rc
 =
CURLE_OK
, "dataÇode creation failed");

131 
	gkey_Àn
 = 
°æí
(
d©a_key
);

133 
	gnodï
 = 
Cuæ_hash_add
(
hp
, 
d©a_key
, 
key_Àn
+1, 
d©a_node
);

134 
ab‹t_u∆ess
(
nodï
, "insertion into hash failed");

136 
	gd©a_node
 = 
NULL
;

141 
	gUNITTEST_STOP


	@tests/unit/unit1307.c

22 
	~"cuæcheck.h
"

24 
	~"cuæ_‚m©ch.h
"

26 
	#MATCH
 
CURL_FNMATCH_MATCH


	)

27 
	#NOMATCH
 
CURL_FNMATCH_NOMATCH


	)

28 
	#RE_ERR
 
CURL_FNMATCH_FAIL


	)

30 
	#MAX_PATTERN_L
 100

	)

31 
	#MAX_STRING_L
 100

	)

33 
	sã°ˇ£
 {

34 
	m∑âîn
[
MAX_PATTERN_L
];

35 
	m°rög
[
MAX_STRING_L
];

36 
	mªsu…
;

39 c⁄° 
ã°ˇ£
 
	gã°s
[] = {

41 { "\\[", "[", 
MATCH
 },

42 { "[", "[", 
RE_ERR
 },

43 { "[]", "[]", 
RE_ERR
 },

44 { "[][]", "[", 
MATCH
 },

45 { "[][]", "]", 
MATCH
 },

46 { "[[]", "[", 
MATCH
 },

47 { "[[[]", "[", 
MATCH
 },

48 { "[[[[]", "[", 
MATCH
 },

49 { "[[[[]", "[", 
MATCH
 },

51 { "[][[]", "]", 
MATCH
 },

52 { "[][[[]", "[", 
MATCH
 },

53 { "[[]", "]", 
NOMATCH
 },

55 { "[a-z]", "a", 
MATCH
 },

56 { "[a-z]", "A", 
NOMATCH
 },

57 { "?[a-z]", "?Z", 
NOMATCH
 },

58 { "[A-Z]", "C", 
MATCH
 },

59 { "[A-Z]", "c", 
NOMATCH
 },

60 { "[0-9]", "7", 
MATCH
 },

61 { "[7-8]", "7", 
MATCH
 },

62 { "[7-]", "7", 
MATCH
 },

63 { "[7-]", "-", 
MATCH
 },

64 { "[7-]", "[", 
NOMATCH
 },

65 { "[a-bA-F]", "F", 
MATCH
 },

66 { "[a-bA-B9]", "9", 
MATCH
 },

67 { "[a-bA-B98]", "8", 
MATCH
 },

68 { "[a-bA-B98]", "C", 
NOMATCH
 },

69 { "[a-bA-Z9]", "F", 
MATCH
 },

70 { "[a-bA-Z9]îo*", "Zîÿch™˚.", 
MATCH
 },

71 { "S[a-][x]›ho*", "Sax›h⁄e", 
MATCH
 },

72 { "S[a-][x]›ho*", "SaX›h⁄e", 
NOMATCH
 },

73 { "S[a-][x]*.txt", "S-x.txt", 
MATCH
 },

74 { "[\\a-\\b]", "a", 
MATCH
 },

75 { "[\\a-\\b]", "b", 
MATCH
 },

76 { "[?*[][?*[][?*[]", "?*[", 
MATCH
 },

77 { "[][?*-]", "]", 
MATCH
 },

78 { "[][?*-]", "[", 
MATCH
 },

79 { "[][?*-]", "?", 
MATCH
 },

80 { "[][?*-]", "*", 
MATCH
 },

81 { "[][?*-]", "-", 
MATCH
 },

82 { "[]?*-]", "-", 
MATCH
 },

83 { "?/b/c", "a/b/c", 
MATCH
 },

84 { "^_{}~", "^_{}~", 
MATCH
 },

85 { "!#%+,-./01234567889", "!#%+,-./01234567889", 
MATCH
 },

86 { "PQRSTUVWXYZ]abcdefg", "PQRSTUVWXYZ]abcdefg", 
MATCH
 },

87 { ":;=@ABCDEFGHIJKLMNO", ":;=@ABCDEFGHIJKLMNO", 
MATCH
 },

90 { "[!a]", "b", 
MATCH
 },

91 { "[!a]", "a", 
NOMATCH
 },

92 { "[^a]", "b", 
MATCH
 },

93 { "[^a]", "a", 
NOMATCH
 },

94 { "[^a-z0-9A-Z]", "a", 
NOMATCH
 },

95 { "[^a-z0-9A-Z]", "-", 
MATCH
 },

96 { "cuæ[!a-z]lib", "cuæÜib", 
MATCH
 },

97 { "cuæ[! ]lib", "cuæÜib", 
NOMATCH
 },

98 { "[! ][ ]", " ", 
NOMATCH
 },

99 { "[! ][ ]", "®", 
MATCH
 },

100 { "*[^a].t?t", "a.txt", 
NOMATCH
 },

101 { "*[^a].t?t", "ba.txt", 
NOMATCH
 },

102 { "*[^a].t?t", "ab.txt", 
MATCH
 },

103 { "[!?*[]", "?", 
NOMATCH
 },

104 { "[!!]", "!", 
NOMATCH
 },

105 { "[!!]", "x", 
MATCH
 },

107 { "[[:Æpha:]]", "a", 
MATCH
 },

108 { "[[:Æpha:]]", "9", 
NOMATCH
 },

109 { "[[:Ænum:]]", "a", 
MATCH
 },

110 { "[[:Ænum:]]", "[", 
NOMATCH
 },

111 { "[[:Ænum:]]", "]", 
NOMATCH
 },

112 { "[[:Ænum:]]", "9", 
MATCH
 },

113 { "[[:digô:]]", "9", 
MATCH
 },

114 { "[[:xdigô:]]", "9", 
MATCH
 },

115 { "[[:xdigô:]]", "F", 
MATCH
 },

116 { "[[:xdigô:]]", "G", 
NOMATCH
 },

117 { "[[:uµî:]]", "U", 
MATCH
 },

118 { "[[:uµî:]]", "u", 
NOMATCH
 },

119 { "[[:lowî:]]", "l", 
MATCH
 },

120 { "[[:lowî:]]", "L", 
NOMATCH
 },

121 { "[[:¥öt:]]", "L", 
MATCH
 },

122 { "[[:¥öt:]]", {'\10'}, 
NOMATCH
 },

123 { "[[:¥öt:]]", {'\10'}, 
NOMATCH
 },

124 { "[[:•a˚:]]", " ", 
MATCH
 },

125 { "[[:•a˚:]]", "x", 
NOMATCH
 },

126 { "[[:gøph:]]", " ", 
NOMATCH
 },

127 { "[[:gøph:]]", "x", 
MATCH
 },

128 { "[[:bœnk:]]", {'\t'}, 
MATCH
 },

129 { "[[:bœnk:]]", {' '}, 
MATCH
 },

130 { "[[:bœnk:]]", {'\r'}, 
NOMATCH
 },

131 { "[^[:bœnk:]]", {'\t'}, 
NOMATCH
 },

132 { "[^[:¥öt:]]", {'\10'}, 
MATCH
 },

133 { "[[:lowî:]][[:lowî:]]", "Œ", 
MATCH
 },

135 { "Cuæ[[:bœnk:]];-)", "Cuæ ;-)", 
MATCH
 },

136 { "*[[:bœnk:]]*", " ", 
MATCH
 },

137 { "*[[:bœnk:]]*", "", 
NOMATCH
 },

138 { "*[[:bœnk:]]*", "hi, im_Pavñ", 
MATCH
 },

141 { "fûíame.d©", "fûíame.d©", 
MATCH
 },

142 { "*cuæ*", "Àt†u£ cuæ!!", 
MATCH
 },

143 { "fûíame.txt", "fûíame.d©", 
NOMATCH
 },

144 { "*.txt", "ãxt.txt", 
MATCH
 },

145 { "*.txt", "a.txt", 
MATCH
 },

146 { "*.txt", ".txt", 
MATCH
 },

147 { "*.txt", "txt", 
NOMATCH
 },

148 { "??.txt", "99.txt", 
MATCH
 },

149 { "??.txt", "a99.txt", 
NOMATCH
 },

150 { "?.???", "a.txt", 
MATCH
 },

151 { "*.???", "somefûe.d©", 
MATCH
 },

152 { "*.???", "phŸo.j≥g", 
NOMATCH
 },

153 { ".*", ".hèc˚ss", 
MATCH
 },

154 { ".*", ".", 
MATCH
 },

155 { ".*", "..", 
MATCH
 },

158 { "**.txt", "ãxt.txt", 
MATCH
 },

159 { "***.txt", "t.txt", 
MATCH
 },

160 { "****.txt", ".txt", 
MATCH
 },

163 { "", "", 
MATCH
 } ,

164 { "", "hñlo", 
NOMATCH
 },

165 { "fûe", "", 
NOMATCH
 },

166 { "?", "", 
NOMATCH
 },

167 { "*", "", 
MATCH
 },

168 { "x", "", 
NOMATCH
 },

171 { "\\", "\\", 
RE_ERR
 },

172 { "\\\\", "\\", 
MATCH
 },

173 { "\\\\", "\\\\", 
NOMATCH
 },

174 { "\\?", "?", 
MATCH
 },

175 { "\\*", "*", 
MATCH
 },

176 { "?.txt", "?.txt", 
MATCH
 },

177 { "*.txt", "*.txt", 
MATCH
 },

178 { "\\?.txt", "?.txt", 
MATCH
 },

179 { "\\*.txt", "*.txt", 
MATCH
 },

180 { "\\?.txt", "x.txt", 
NOMATCH
 },

181 { "\\*.txt", "x.txt", 
NOMATCH
 },

182 { "\\*\\\\.txt", "*\\.txt", 
MATCH
 },

183 { "*\\**\\?*\\\\*", "cc*cc?cc\\cc*cc", 
MATCH
 },

184 { "*\\**\\?*\\\\*", "cc*cc?cccc", 
NOMATCH
 },

185 { "*\\**\\?*\\\\*", "cc*cc?cc\\cc*cc", 
MATCH
 },

186 { "*\\?*\\**", "cc?c*c", 
MATCH
 },

187 { "*\\?*\\**cuæ*", "cc?c*cuæ", 
MATCH
 },

188 { "*\\?*\\**", "cc?cc", 
NOMATCH
 },

189 { "\\\"\\$\\&\\'\\(\\)", "\"$&'()", 
MATCH
 },

190 { "\\*\\?\\[\\\\\\`\\|", "*?[\\`|", 
MATCH
 },

191 { "[\\a\\b]c", "ac", 
MATCH
 },

192 { "[\\a\\b]c", "bc", 
MATCH
 },

193 { "[\\a\\b]d", "bc", 
NOMATCH
 },

194 { "[a-bA-B\\?]", "?", 
MATCH
 },

195 { "cu[a-ab-b\\r]l", "cuæ", 
MATCH
 },

196 { "[\\a-z]", "c", 
MATCH
 },

198 { "?*?*?.*?*", "abc.c", 
MATCH
 },

199 { "?*?*?.*?*", "abcc", 
NOMATCH
 },

200 { "?*?*?.*?*", "abc.", 
NOMATCH
 },

201 { "?*?*?.*?*", "abc.c++", 
MATCH
 },

202 { "?*?*?.*?*", "abcdef.c++", 
MATCH
 },

203 { "?*?*?.?", "abcdef.c", 
MATCH
 },

204 { "?*?*?.?", "abcdef.cd", 
NOMATCH
 },

206 { "Lödm√§èrv", "Lödm√§èrv", 
MATCH
 },

208 { "", "", 
MATCH
 }

211 
CURLcode
 
	$unô_£tup
( )

213  
CURLE_OK
;

214 
	}
}

216 
	$unô_°›
( )

218 
	}
}

220 
UNITTEST_START


222 
	gã°num
 = (
ã°s
Ë/ (
ã°ˇ£
);

223 
	gi
, 
	grc
;

225 
	gi
 = 0; i < 
	gã°num
; i++) {

226 
	grc
 = 
Cuæ_‚m©ch
(
NULL
, 
ã°s
[
i
].
∑âîn
,Åe°s[i].
°rög
);

227 if(
	grc
 !
ã°s
[
i
].
ªsu…
) {

228 
¥ötf
("Curl_fnmatch(\"%s\", \"%s\") shouldÑeturn %d (returns %d)\n",

229 
ã°s
[
i
].
∑âîn
,Åe°s[i].
°rög
,Åe°s[i].
ªsu…
, 
rc
);

230 
Áû
("pattern mismatch");

234 
	gUNITTEST_STOP


	@tests/unit/unit1308.c

22 
	~"cuæcheck.h
"

24 
	~<cuæ/cuæ.h
>

26 
CURLcode
 
	$unô_£tup
()

28  
CURLE_OK
;

29 
	}
}

31 
	$unô_°›
()

34 
	}
}

36 
size_t
 
	$¥öt_hâµo°_ˇŒback
(*
¨g
, c⁄° *
buf
, 
size_t
 
Àn
)

38 
	`fwrôe
(
buf
, 
Àn
, 1, 
°dout
);

39 (*(
size_t
 *Ë
¨g
Ë+
Àn
;

40  
Àn
;

41 
	}
}

43 
UNITTEST_START


44 
	grc
;

45 
cuæ_hâµo°
* 
	gpo°
 = 
NULL
;

46 
cuæ_hâµo°
* 
	gœ°
 = 
NULL
;

47 
size_t
 
	gtŸÆ_size
 = 0;

48 
	gbuf„r
[] = "test buffer";

50 
	grc
 = 
cuæ_f‹madd
(&
po°
, &
œ°
, 
CURLFORM_COPYNAME
, "name",

51 
CURLFORM_COPYCONTENTS
, "c⁄ã¡", 
CURLFORM_END
);

53 
Áû_u∆ess
(
rc
 == 0, "curl_formaddÑeturnedÉrror");

57 
Áû_u∆ess
(
po°
 =
œ°
, "postándÜast weren'tÅhe same");

59 
	grc
 = 
cuæ_f‹madd
(&
po°
, &
œ°
, 
CURLFORM_COPYNAME
, "htmlcode",

60 
CURLFORM_COPYCONTENTS
, "<HTML></HTML>",

61 
CURLFORM_CONTENTTYPE
, "ãxt/html", 
CURLFORM_END
);

63 
Áû_u∆ess
(
rc
 == 0, "curl_formaddÑeturnedÉrror");

65 
	grc
 = 
cuæ_f‹madd
(&
po°
, &
œ°
, 
CURLFORM_COPYNAME
, "name_for_ptrcontent",

66 
CURLFORM_PTRCONTENTS
, 
buf„r
, 
CURLFORM_END
);

68 
Áû_u∆ess
(
rc
 == 0, "curl_formaddÑeturnedÉrror");

70 
	grc
 = 
cuæ_f‹mgë
(
po°
, &
tŸÆ_size
, 
¥öt_hâµo°_ˇŒback
);

72 
Áû_u∆ess
(
rc
 == 0, "curl_formgetÑeturnedÉrror");

74 
Áû_u∆ess
(
tŸÆ_size
 == 486, "curl_formget got wrong size back");

76 
cuæ_f‹m‰ì
(
po°
);

79 
	gpo°
 = 
œ°
 = 
NULL
;

81 
	grc
 = 
cuæ_f‹madd
(&
po°
, &
œ°
,

82 
CURLFORM_PTRNAME
, "name of file field",

83 
CURLFORM_FILE
, "log/test-1308",

84 
CURLFORM_FILENAME
, "customÇamed file",

85 
CURLFORM_END
);

87 
Áû_u∆ess
(
rc
 == 0, "curl_formaddÑeturnedÉrror");

89 
	grc
 = 
cuæ_f‹mgë
(
po°
, &
tŸÆ_size
, 
¥öt_hâµo°_ˇŒback
);

90 
Áû_u∆ess
(
rc
 == 0, "curl_formgetÑeturnedÉrror");

91 
Áû_u∆ess
(
tŸÆ_size
 == 847, "curl_formget got wrong size back");

93 
cuæ_f‹m‰ì
(
po°
);

95 
	gUNITTEST_STOP


	@tests/unit/unit1309.c

22 
	~"cuæcheck.h
"

24 
	~"•œy.h
"

27 
CURLcode
 
	$unô_£tup
()

29  
CURLE_OK
;

30 
	}
}

32 
	$unô_°›
()

35 
	}
}

37 
	$•œy¥öt
(
Cuæ_åì
 * 
t
, 
d
, 
ouçut
)

39 
Cuæ_åì
 *
node
;

40 
i
;

41 
cou¡
;

42 if(
t
 =
NULL
)

45 
	`•œy¥öt
(
t
->
œrgî
, 
d
+1, 
ouçut
);

46 
i
=0; i<
d
; i++)

47 if(
ouçut
)

48 
	`¥ötf
(" ");

50 if(
ouçut
) {

51 
	`¥ötf
("%ld.%ld[%d]", ()
t
->
key
.
tv_£c
,

52 ()
t
->
key
.
tv_u£c
, 
i
);

55 
cou¡
=0, 
node
 = 
t
->
ßme
;Çode;Çode =Çode->same, count++)

58 if(
ouçut
) {

59 if(
cou¡
)

60 
	`¥ötf
(" [%d m‹e]\n", 
cou¡
);

62 
	`¥ötf
("\n");

65 
	`•œy¥öt
(
t
->
smÆÀr
, 
d
+1, 
ouçut
);

66 
	}
}

68 
	gUNITTEST_START


71 
	#NUM_NODES
 50

	)

73 
Cuæ_åì
 *
	groŸ
;

74 
Cuæ_åì
 
	gnodes
[
NUM_NODES
];

75 
	grc
;

76 
	gi
;

77 
	groŸ
 = 
NULL
;

79 
	gi
 = 0; i < 
	gNUM_NODES
; i++) {

80 
timevÆ
 
	gkey
;

82 
	gkey
.
	gtv_£c
 = 0;

83 
	gkey
.
	gtv_u£c
 = (541*
i
)%1023;

85 
	gnodes
[
i
].
	g∑ylﬂd
 = (*)
key
.
tv_u£c
;

86 
	groŸ
 = 
Cuæ_•œyö£π
(
key
, 
roŸ
, &
nodes
[
i
]);

89 
puts
("Result:");

90 
•œy¥öt
(
roŸ
, 0, 1);

92 
	gi
 = 0; i < 
	gNUM_NODES
; i++) {

93 
	gªm
 = (
i
+7)%
NUM_NODES
;

94 
¥ötf
("TreeÜook:\n");

95 
•œy¥öt
(
roŸ
, 0, 1);

96 
¥ötf
("ªmovêpoöã∏%d,Öaylﬂd %ld\n", 
ªm
,

97 ()(
nodes
[
ªm
].
∑ylﬂd
));

98 
	grc
 = 
Cuæ_•œyªmovebyaddr
(
roŸ
, &
nodes
[
ªm
], &root);

99 if(
	grc
) {

101 
¥ötf
("ªmovê%d faûed!\n", 
ªm
);

102 
Áû
("remove");

106 
	gUNITTEST_STOP


	@tests/unit/unit1330.c

22 
	~"cuæcheck.h
"

24 
	~"memdebug.h
"

27 
CURLcode
 
	$unô_£tup
()

29  
CURLE_OK
;

30 
	}
}

32 
	$unô_°›
()

34 
	}
}

36 
UNITTEST_START


38 *
	g±r
 = 
mÆloc
(1330);

39 
Cuæ_ß„‰ì
(
±r
);

41 
	gUNITTEST_STOP


	@tests/unit/unit1394.c

22 
	~"cuæcheck.h
"

24 
	~"toﬁ_gë∑øm.h
"

26 
	~<°dio.h
>

27 
	~<°dlib.h
>

28 
	~<°rög.h
>

30 
	~"memdebug.h
"

32 
CURLcode
 
	$unô_£tup
()

34  
CURLE_OK
;

35 
	}
}

37 
	$unô_°›
()

40 
	}
}

42 
UNITTEST_START


44 c⁄° *
	gvÆues
[] = {

51 "foo\\b¨\\baz", "foo\\b¨\\baz", 
NULL
,

52 "foo\\\\b¨\\\\baz", "foo\\b¨\\baz", 
NULL
,

53 "foo\\", "foo\\", 
NULL
,

54 "foo\\\\", "foo\\", 
NULL
,

59 #ifde‡
WIN32


65 "c:\\foo\\b¨\\baz", "c:\\foo\\b¨\\baz", 
NULL
,

66 "c:\\foo\\\\b¨\\\\baz", "c:\\foo\\b¨\\baz", 
NULL
,

67 "c:\\foo\\", "c:\\foo\\", 
NULL
,

68 "c:\\foo\\\\", "c:\\foo\\", 
NULL
,

74 
NULL
, NULL, NULL,

76 c⁄° **
	gp
;

77 *
	g˚π«me
, *
	g∑s•hø£
;

78 
	gp
 = 
vÆues
; *p;Ö += 3) {

79 
∑r£_˚π_∑ømëî
(
p
[0], &
˚π«me
, &
∑s•hø£
);

80 if(
	gp
[1]) {

81 if(
	g˚π«me
) {

82 if(
°rcmp
(
p
[1], 
˚π«me
)) {

83 
¥ötf
("expected certname '%s' but got '%s' "

84 "f‹ -EÖ¨am '%s'\n", 
p
[1], 
˚π«me
,Ö[0]);

85 
Áû
("assertion failure");

88 
¥ötf
("expected certname '%s' but got NULL "

89 "f‹ -EÖ¨am '%s'\n", 
p
[1],Ö[0]);

90 
Áû
("assertion failure");

93 if(
	g˚π«me
) {

94 
¥ötf
("expected certname NULL but got '%s' "

95 "f‹ -EÖ¨am '%s'\n", 
˚π«me
, 
p
[0]);

96 
Áû
("assertion failure");

99 if(
	gp
[2]) {

100 if(
	g∑s•hø£
) {

101 if(
°rcmp
(
p
[2], 
∑s•hø£
)) {

102 
¥ötf
("expectedÖassphrase '%s' but got '%s'"

103 "f‹ -EÖ¨am '%s'\n", 
p
[2], 
∑s•hø£
,Ö[0]);

104 
Áû
("assertion failure");

107 
¥ötf
("expectedÖassphrase '%s' but got NULL "

108 "f‹ -EÖ¨am '%s'\n", 
p
[2],Ö[0]);

109 
Áû
("assertion failure");

112 if(
	g∑s•hø£
) {

113 
¥ötf
("expectedÖassphrase NULL but got '%s' "

114 "f‹ -EÖ¨am '%s'\n", 
∑s•hø£
, 
p
[0]);

115 
Áû
("assertion failure");

118 if(
	g˚π«me
Ë
‰ì
(
˚π«me
);

119 if(
	g∑s•hø£
Ë
‰ì
(
∑s•hø£
);

122 
	gUNITTEST_STOP


	@tests/unit/unit1395.c

22 
	~"cuæcheck.h
"

24 
	~"dŸdŸ.h
"

26 
	~"memdebug.h
"

28 
CURLcode
 
	$unô_£tup
()

30  
CURLE_OK
;

31 
	}
}

33 
	$unô_°›
()

36 
	}
}

38 
	sdŸdŸ
 {

39 c⁄° *
	möput
;

40 c⁄° *
	mouçut
;

43 
UNITTEST_START


45 
	gi
;

46 
	gÁûs
=0;

47 c⁄° 
dŸdŸ
 
	g∑ús
[] = {

67 
	gi
=0; i < (
	g∑ús
)/(pairs[0]); i++) {

68 *
	gout
 = 
Cuæ_dedŸdŸify
((*)
∑ús
[
i
].
öput
);

69 
ab‹t_u∆ess
(
out
 !
NULL
, "returned NULL!");

71 if(
°rcmp
(
out
, 
∑ús
[
i
].
ouçut
)) {

72 
Ârötf
(
°dîr
, "Test %d: '%s' gave '%s' instead of '%s'\n",

73 
i
, 
∑ús
[i].
öput
, 
out
,Öaús[i].
ouçut
);

74 
Áû
("Test case output mismatched");

75 
	gÁûs
++;

78 
Ârötf
(
°dîr
, "Te° %d: OK\n", 
i
);

79 
‰ì
(
out
);

82 
Áû_if
(
Áûs
, "output mismatched");

84 
	gUNITTEST_STOP


	@tests/unit/unit1396.c

22 
	~"cuæcheck.h
"

24 
CURL
 *
	ghnd
;

26 
CURLcode
 
	$unô_£tup
()

28  
CURLE_OK
;

29 
	}
}

31 
	$unô_°›
()

33 i‡(
hnd
)

34 
	`cuæ_ósy_˛ónup
(
hnd
);

35 
	}
}

37 
	sã°
 {

38 c⁄° *
	mö
;

39 
	möÀn
;

40 c⁄° *
	mout
;

41 
	mouéí
;

44 
	gUNITTEST_START


47 c⁄° 
ã°
 
	gli°1
[]={

60 {
NULL
, 0, NULL, 0}

63 c⁄° 
ã°
 
	gli°2
[]={

74 {
NULL
, 0, NULL, 0}

76 
	gi
;

78 
	ghnd
 = 
cuæ_ósy_öô
();

79 
ab‹t_u∆ess
(
hnd
 !
NULL
, "returned NULL!");

80 
	gi
=0; 
	gli°1
[
i
].
	gö
; i++) {

81 
	gouéí
;

82 *
	gout
 = 
cuæ_ósy_u√sˇ≥
(
hnd
,

83 
li°1
[
i
].
ö
,Üi°1[i].
öÀn
,

84 &
ouéí
);

86 
ab‹t_u∆ess
(
out
 !
NULL
, "returned NULL!");

87 
Áû_u∆ess
(
ouéí
 =
li°1
[
i
].outlen, "wrong outputÜengthÑeturned");

88 
Áû_u∆ess
(!
memcmp
(
out
, 
li°1
[
i
].out,Üi°1[i].
ouéí
),

91 
¥ötf
("cuæ_ósy_u√sˇ≥Åe° %d DONE\n", 
i
);

93 
cuæ_‰ì
(
out
);

96 
	gi
=0; 
	gli°2
[
i
].
	gö
; i++) {

97 
	gouéí
;

98 *
	gout
 = 
cuæ_ósy_esˇ≥
(
hnd
, 
li°2
[
i
].
ö
,Üi°2[i].
öÀn
);

99 
ab‹t_u∆ess
(
out
 !
NULL
, "returned NULL!");

101 
	gouéí
 = ()
°æí
(
out
);

102 
Áû_u∆ess
(
ouéí
 =
li°2
[
i
].outlen, "wrong outputÜengthÑeturned");

103 
Áû_u∆ess
(!
memcmp
(
out
, 
li°2
[
i
].out,Üi°2[i].
ouéí
),

106 
¥ötf
("cuæ_ósy_esˇ≥Åe° %d DONE (%s)\n", 
i
, 
out
);

108 
cuæ_‰ì
(
out
);

111 
	gUNITTEST_STOP


	@tests/unit/unit1397.c

1 
	~"cuæcheck.h
"

3 
	~"ho°check.h
"

5 
CURLcode
 
	$unô_£tup
()

7  
CURLE_OK
;

8 
	}
}

10 
	$unô_°›
( )

13 
	}
}

15 
	gUNITTEST_START


18 #i‡
deföed
(
USE_SSLEAY
Ë|| deföed(
USE_AXTLS
Ë|| deföed(
USE_QSOSSL
) || \

19 
	$deföed
(
USE_GSKIT
)

23 
	`Áû_u∆ess
–
	`Cuæ_˚π_ho°check
("www.example.com", "www.example.com"), "good 1" );

24 
	`Áû_u∆ess
–
	`Cuæ_˚π_ho°check
("*.example.com", "www.example.com"), "good 2" );

25 
	`Áû_u∆ess
–
	`Cuæ_˚π_ho°check
("xxx*.example.com", "xxxwww.example.com"), "good 3" );

26 
	`Áû_u∆ess
–
	`Cuæ_˚π_ho°check
("f*.example.com", "foo.example.com"), "good 4" );

27 
	`Áû_u∆ess
–
	`Cuæ_˚π_ho°check
("192.168.0.0", "192.168.0.0"), "good 5" );

29 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("xxx.example.com", "www.example.com"), "bad 1" );

30 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("*", "www.example.com"), "bad 2" );

31 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("*.*.com", "www.example.com"), "bad 3" );

32 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("*.example.com", "baa.foo.example.com"), "bad 4" );

33 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("f*.example.com", "baa.example.com"), "bad 5" );

34 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("*.com", "example.com"), "bad 6" );

35 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("*fail.com", "example.com"), "bad 7" );

36 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("*.example.", "www.example."), "bad 8" );

37 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("*.example.", "www.example"), "bad 9" );

38 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("", "www"), "bad 10" );

39 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("*", "www"), "bad 11" );

40 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("*.168.0.0", "192.168.0.0"), "bad 12" );

41 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("www.example.com", "192.168.0.0"), "bad 13" );

43 #ifde‡
ENABLE_IPV6


44 
	`Áû_if
–
	`Cuæ_˚π_ho°check
("*::3285:a9ff:fe46:b619", "fe80::3285:a9ff:fe46:b619"), "bad 14" );

45 
	`Áû_u∆ess
–
	`Cuæ_˚π_ho°check
("fe80::3285:a9ff:fe46:b619", "fe80::3285:a9ff:fe46:b619"), "good 6" );

52 
UNITTEST_STOP


	@tests/unit/unit1398.c

22 
	~"cuæcheck.h
"

24 
	~"cuæ/m¥ötf.h
"

26 
CURLcode
 
	$unô_£tup
–Ë{ 
CURLE_OK
;
	}
}

27 
	$unô_°›
–Ë{
	}
}

29 
UNITTEST_START


31 
	grc
;

32 
	gbuf
[3] = {'b', 'u', 'g'};

33 c⁄° *
	g°r
="bug";

34 
	gwidth
 = 3;

35 
	gouçut
[24];

40 
	grc
 = 
cuæ_m¢¥ötf
(
ouçut
, 4, "%.*s", 
width
, 
buf
);

41 
Áû_u∆ess
–
rc
 == 3 , "return code should be 3" );

42 
Áû_u∆ess
(!
°rcmp
(
ouçut
, "bug"), "wrong output");

45 
	grc
 = 
cuæ_m¢¥ötf
(
ouçut
, 4, "%.*s", 
width
, 
°r
);

46 
Áû_u∆ess
–
rc
 == 3 , "return code should be 3" );

47 
Áû_u∆ess
(!
°rcmp
(
ouçut
, "bug"), "wrong output");

49 
	gwidth
 = 2;

51 
	grc
 = 
cuæ_m¢¥ötf
(
ouçut
, 4, "%.*s", 
width
, 
buf
);

52 
Áû_u∆ess
–
rc
 == 2 , "return code should be 2" );

53 
Áû_u∆ess
(!
°rcmp
(
ouçut
, "bu"), "wrong output");

56 
	grc
 = 
cuæ_m¢¥ötf
(
ouçut
, 8, "%.8s", 
°r
);

57 
Áû_u∆ess
–
rc
 == 3 , "return code should be 3" );

58 
Áû_u∆ess
(!
°rcmp
(
ouçut
, "bug"), "wrong output");

61 
	grc
 = 
cuæ_m¢¥ötf
(
ouçut
, 8, "%.3s", "0123456789");

62 
Áû_u∆ess
–
rc
 == 3 , "return code should be 3" );

63 
Áû_u∆ess
(!
°rcmp
(
ouçut
, "012"), "wrong output");

66 
	grc
 = 
cuæ_m¢¥ötf
(
ouçut
, 8, "%-8s", 
°r
);

67 
Áû_u∆ess
–
rc
 == 8 , "return code should be 8" );

68 
Áû_u∆ess
(!
°rcmp
(
ouçut
, "bug "), "wrong output");

71 
	grc
 = 
cuæ_m¢¥ötf
(
ouçut
, 8, "%8s", 
°r
);

72 
Áû_u∆ess
–
rc
 == 8 , "return code should be 8" );

73 
Áû_u∆ess
(!
°rcmp
(
ouçut
, " bu"), "wrong output");

76 
	grc
 = 
cuæ_m¢¥ötf
(
ouçut
, 4, "%d", 10240);

78 
Áû_u∆ess
–
rc
 == 4 , "return code should be 4" );

79 
Áû_u∆ess
(!
°rcmp
(
ouçut
, "102"), "wrong output");

82 
	grc
 = 
cuæ_m¢¥ötf
(
ouçut
, 16, "%8s%8s", 
°r
, str);

83 
Áû_u∆ess
–
rc
 == 16 , "return code should be 16" );

84 
Áû_u∆ess
(!
°rcmp
(
ouçut
, " bug bu"), "wrong output");

87 
	grc
 = 
cuæ_m¢¥ötf
(
ouçut
, 16, "%8d%8d", 1234, 5678);

88 
Áû_u∆ess
–
rc
 == 16 , "return code should be 16" );

89 
Áû_u∆ess
(!
°rcmp
(
ouçut
, " 1234 567"), "wrong output");

91 
	gUNITTEST_STOP


	@/usr/include/arpa/inet.h

18 #i‚de‡
_ARPA_INET_H


19 
	#_ARPA_INET_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<√töë/ö.h
>

25 #i‚de‡
__sockÀn_t_deföed


26 
__sockÀn_t
 
	tsockÀn_t
;

27 
	#__sockÀn_t_deföed


	)

30 
__BEGIN_DECLS


34 
ö_addr_t
 
	$öë_addr
 (c⁄° *
__˝
Ë
__THROW
;

37 
ö_addr_t
 
	$öë_ aof
 (
ö_addr
 
__ö
Ë
__THROW
;

41 
ö_addr
 
	$öë_makóddr
 (
ö_addr_t
 
__√t
, in_addr_à
__ho°
)

42 
__THROW
;

45 
ö_addr_t
 
	$öë_√tof
 (
ö_addr
 
__ö
Ë
__THROW
;

49 
ö_addr_t
 
	$öë_√tw‹k
 (c⁄° *
__˝
Ë
__THROW
;

53 *
	$öë_¡ﬂ
 (
ö_addr
 
__ö
Ë
__THROW
;

58 
	$öë_±⁄
 (
__af
, c⁄° *
__ª°ri˘
 
__˝
,

59 *
__ª°ri˘
 
__buf
Ë
__THROW
;

64 c⁄° *
	$öë_¡›
 (
__af
, c⁄° *
__ª°ri˘
 
__˝
,

65 *
__ª°ri˘
 
__buf
, 
sockÀn_t
 
__Àn
)

66 
__THROW
;

70 #ifde‡
__USE_MISC


73 
	$öë_©⁄
 (c⁄° *
__˝
, 
ö_addr
 *
__öp
Ë
__THROW
;

77 *
	$öë_√è
 (
ö_addr_t
 
__√t
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

82 *
	$öë_√t_¡›
 (
__af
, c⁄° *
__˝
, 
__bôs
,

83 *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

88 
	$öë_√t_±⁄
 (
__af
, c⁄° *
__˝
,

89 *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

94 
	$öë_nßp_addr
 (c⁄° *
__˝
,

95 *
__buf
, 
__Àn
Ë
__THROW
;

99 *
	$öë_nßp_¡ﬂ
 (
__Àn
, c⁄° *
__˝
,

100 *
__buf
Ë
__THROW
;

103 
__END_DECLS


	@/usr/include/arpa/tftp.h

32 #i‚de‡
_ARPA_TFTP_H


33 
	#_ARPA_TFTP_H
 1

	)

38 
	#SEGSIZE
 512

	)

43 
	#RRQ
 01

	)

44 
	#WRQ
 02

	)

45 
	#DATA
 03

	)

46 
	#ACK
 04

	)

47 
	#ERROR
 05

	)

49 
	st·phdr
 {

50 
	mth_›code
;

52 
	mtu_∑ddög
[3];

55 
	mtu_block
;

56 
	mtu_code
;

57 } 
__©åibuã__
 ((
__∑cked__
)Ë
	mth_u3
;

58 
	mtu_d©a
[0];

59 } 
__©åibuã__
 ((
__∑cked__
)Ë
	mth_u2
;

60 
	mtu_°uff
[0];

61 } 
__©åibuã__
 ((
__∑cked__
)Ë
	mth_u1
;

62 } 
__©åibuã__
 ((
__∑cked__
));

64 
	#th_block
 
th_u1
.
th_u2
.
th_u3
.
tu_block


	)

65 
	#th_code
 
th_u1
.
th_u2
.
th_u3
.
tu_code


	)

66 
	#th_°uff
 
th_u1
.
tu_°uff


	)

67 
	#th_d©a
 
th_u1
.
th_u2
.
tu_d©a


	)

68 
	#th_msg
 
th_u1
.
th_u2
.
tu_d©a


	)

73 
	#EUNDEF
 0

	)

74 
	#ENOTFOUND
 1

	)

75 
	#EACCESS
 2

	)

76 
	#ENOSPACE
 3

	)

77 
	#EBADOP
 4

	)

78 
	#EBADID
 5

	)

79 
	#EEXISTS
 6

	)

80 
	#ENOUSER
 7

	)

	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #unde‡
_ASSERT_H


25 #unde‡
as£π


26 #unde‡
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #unde‡
as£π_≥º‹


34 
	#_ASSERT_H
 1

	)

35 
	~<„©uªs.h
>

37 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
°©ic_ˇ°
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£π
(
ex¥
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£π_≥º‹
(
î∫um
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

64 #i‚de‡
_ASSERT_H_DECLS


65 
	#_ASSERT_H_DECLS


	)

66 
__BEGIN_DECLS


69 
	$__as£π_Áû
 (c⁄° *
__as£πi⁄
, c⁄° *
__fûe
,

70 
__löe
, c⁄° *
__fun˘i⁄
)

71 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

74 
	$__as£π_≥º‹_Áû
 (
__î∫um
, c⁄° *
__fûe
,

75 
__löe
, c⁄° *
__fun˘i⁄
)

76 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

81 
	$__as£π
 (c⁄° *
__as£πi⁄
, c⁄° *
__fûe
, 
__löe
)

82 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

85 
__END_DECLS


88 
	#as£π
(
ex¥
) \

89 ((
ex¥
) \

90 ? 
	`__ASSERT_VOID_CAST
 (0) \

91 : 
	`__as£π_Áû
 (
	`__STRING
(
ex¥
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

93 #ifdef 
__USE_GNU


94 
	#as£π_≥º‹
(
î∫um
) \

95 (!(
î∫um
) \

96 ? 
	`__ASSERT_VOID_CAST
 (0) \

97 : 
	`__as£π_≥º‹_Áû
 ((
î∫um
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

105 #i‡
deföed
 
__˝lu•lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

106 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

108 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

109 
	#__ASSERT_FUNCTION
 
__func__


	)

111 
	#__ASSERT_FUNCTION
 ((c⁄° *Ë0)

	)

118 #i‡
deföed
 
__USE_ISOC11
 && !deföed 
__˝lu•lus


120 #unde‡
°©ic_as£π


121 
	#°©ic_as£π
 
_Sètic_as£π


	)

	@/usr/include/ctype.h

22 #i‚def 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 
	g__BEGIN_DECLS


30 #i‚de‡
_ISbô


39 
	~<ídün.h
>

40 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


41 
	#_ISbô
(
bô
Ë(1 << (bô))

	)

43 
	#_ISbô
(
bô
Ë((bôË< 8 ? ((1 << (bô)Ë<< 8Ë: ((1 << (bô)Ë>> 8))

	)

48 
	m_ISuµî
 = 
_ISbô
 (0),

49 
	m_ISlowî
 = 
_ISbô
 (1),

50 
	m_ISÆpha
 = 
_ISbô
 (2),

51 
	m_ISdigô
 = 
_ISbô
 (3),

52 
	m_ISxdigô
 = 
_ISbô
 (4),

53 
	m_IS•a˚
 = 
_ISbô
 (5),

54 
	m_IS¥öt
 = 
_ISbô
 (6),

55 
	m_ISgøph
 = 
_ISbô
 (7),

56 
	m_ISbœnk
 = 
_ISbô
 (8),

57 
	m_IS˙ål
 = 
_ISbô
 (9),

58 
	m_ISpun˘
 = 
_ISbô
 (10),

59 
	m_ISÆnum
 = 
_ISbô
 (11)

79 c⁄° **
	$__˘y≥_b_loc
 ()

80 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

81 c⁄° 
__öt32_t
 **
	$__˘y≥_tﬁowî_loc
 ()

82 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

83 c⁄° 
__öt32_t
 **
	$__˘y≥_touµî_loc
 ()

84 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

87 #i‚de‡
__˝lu•lus


88 
	#__is˘y≥
(
c
, 
ty≥
) \

89 ((*
	`__˘y≥_b_loc
 ())[(Ë(
c
)] & (Ë
ty≥
)

	)

90 #ñi‡
deföed
 
__USE_EXTERN_INLINES


91 
	#__is˘y≥_f
(
ty≥
) \

92 
__exã∫_ölöe
 \

93 
is
##
	`ty≥
 (
__c
Ë
__THROW
 \

95  (*
	`__˘y≥_b_loc
 ())[(Ë(
__c
)] & (Ë
_IS
##
ty≥
; \

96 
	}

	)
}

99 
	#__ißscii
(
c
Ë(((cË& ~0x7fË=0Ë

	)

100 
	#__tﬂscii
(
c
Ë((cË& 0x7fË

	)

102 
	#__ex˘y≥
(
«me
Ë
	`«me
 (Ë
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__ex˘y≥
 (
iß um
);

111 
__ex˘y≥
 (
ißÕha
);

112 
__ex˘y≥
 (
is˙ål
);

113 
__ex˘y≥
 (
isdigô
);

114 
__ex˘y≥
 (
i¶owî
);

115 
__ex˘y≥
 (
isgøph
);

116 
__ex˘y≥
 (
i•röt
);

117 
__ex˘y≥
 (
i•un˘
);

118 
__ex˘y≥
 (
is•a˚
);

119 
__ex˘y≥
 (
isuµî
);

120 
__ex˘y≥
 (
isxdigô
);

124 
	$tﬁowî
 (
__c
Ë
__THROW
;

127 
	$touµî
 (
__c
Ë
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__ex˘y≥
 (
isbœnk
);

138 
__END_NAMESPACE_C99


141 #ifde‡
__USE_GNU


143 
	$is˘y≥
 (
__c
, 
__mask
Ë
__THROW
;

146 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


150 
	$ißscii
 (
__c
Ë
__THROW
;

154 
	$tﬂscii
 (
__c
Ë
__THROW
;

158 
	`__ex˘y≥
 (
_touµî
);

159 
	`__ex˘y≥
 (
_tﬁowî
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¨gs
) \

164 (
__exãnsi⁄__
 \

165 ({ 
__ªs
; \

166 i‡( (
c
) > 1) \

168 i‡(
	`__buûtö_c⁄°™t_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__ªs
 = 
__c
 < -128 || __¯> 255 ? __¯: (
a
)[__c]; \

174 
__ªs
 = 
f
 
¨gs
; \

177 
__ªs
 = (
a
)[(Ë(
c
)]; \

178 
__ªs
; 
	}
}))

	)

180 #i‡!
deföed
 
__NO_CTYPE


181 #ifde‡
__is˘y≥_f


182 
	$__is˘y≥_f
 (
Ænum
)

183 
	$__is˘y≥_f
 (
Æpha
)

184 
	$__is˘y≥_f
 (
˙ål
)

185 
	$__is˘y≥_f
 (
digô
)

186 
	$__is˘y≥_f
 (
lowî
)

187 
	$__is˘y≥_f
 (
gøph
)

188 
	$__is˘y≥_f
 (
¥öt
)

189 
	$__is˘y≥_f
 (
pun˘
)

190 
	$__is˘y≥_f
 (
•a˚
)

191 
	$__is˘y≥_f
 (
uµî
)

192 
	$__is˘y≥_f
 (
xdigô
)

193 #ifde‡
__USE_ISOC99


194 
	$__is˘y≥_f
 (
bœnk
)

196 #ñi‡
deföed
 
__is˘y≥


197 
	#iß um
(
c
Ë
	`__is˘y≥
((c), 
_ISÆnum
)

	)

198 
	#ißÕha
(
c
Ë
	`__is˘y≥
((c), 
_ISÆpha
)

	)

199 
	#is˙ål
(
c
Ë
	`__is˘y≥
((c), 
_IS˙ål
)

	)

200 
	#isdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISdigô
)

	)

201 
	#i¶owî
(
c
Ë
	`__is˘y≥
((c), 
_ISlowî
)

	)

202 
	#isgøph
(
c
Ë
	`__is˘y≥
((c), 
_ISgøph
)

	)

203 
	#i•röt
(
c
Ë
	`__is˘y≥
((c), 
_IS¥öt
)

	)

204 
	#i•un˘
(
c
Ë
	`__is˘y≥
((c), 
_ISpun˘
)

	)

205 
	#is•a˚
(
c
Ë
	`__is˘y≥
((c), 
_IS•a˚
)

	)

206 
	#isuµî
(
c
Ë
	`__is˘y≥
((c), 
_ISuµî
)

	)

207 
	#isxdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISxdigô
)

	)

208 #ifde‡
__USE_ISOC99


209 
	#isbœnk
(
c
Ë
	`__is˘y≥
((c), 
_ISbœnk
)

	)

213 #ifde‡
__USE_EXTERN_INLINES


214 
__exã∫_ölöe
 

215 
	`__NTH
 (
	$tﬁowî
 (
__c
))

217  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_tﬁowî_loc
 ())[__c] : __c;

218 
	}
}

220 
__exã∫_ölöe
 

221 
__NTH
 (
	$touµî
 (
__c
))

223  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_touµî_loc
 ())[__c] : __c;

224 
	}
}

227 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


228 
	#tﬁowî
(
c
Ë
	`__tobody
 (c, 
tﬁowî
, *
	`__˘y≥_tﬁowî_loc
 (), (c))

	)

229 
	#touµî
(
c
Ë
	`__tobody
 (c, 
touµî
, *
	`__˘y≥_touµî_loc
 (), (c))

	)

232 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


233 
	#ißscii
(
c
Ë
	`__ißscii
 (c)

	)

234 
	#tﬂscii
(
c
Ë
	`__tﬂscii
 (c)

	)

236 
	#_tﬁowî
(
c
Ë((Ë(*
	`__˘y≥_tﬁowî_loc
 ())[(Ë(c)])

	)

237 
	#_touµî
(
c
Ë((Ë(*
	`__˘y≥_touµî_loc
 ())[(Ë(c)])

	)

243 #ifde‡
__USE_XOPEN2K8


257 
	~<xloˇÀ.h
>

261 
	#__is˘y≥_l
(
c
, 
ty≥
, 
loˇÀ
) \

262 ((
loˇÀ
)->
__˘y≥_b
[(Ë(
c
)] & (Ë
ty≥
)

	)

264 
	#__ex˘y≥_l
(
«me
) \

265 
	`«me
 (, 
__loˇÀ_t
Ë
__THROW


	)

271 
__ex˘y≥_l
 (
iß um_l
);

272 
__ex˘y≥_l
 (
ißÕha_l
);

273 
__ex˘y≥_l
 (
is˙ål_l
);

274 
__ex˘y≥_l
 (
isdigô_l
);

275 
__ex˘y≥_l
 (
i¶owî_l
);

276 
__ex˘y≥_l
 (
isgøph_l
);

277 
__ex˘y≥_l
 (
i•röt_l
);

278 
__ex˘y≥_l
 (
i•un˘_l
);

279 
__ex˘y≥_l
 (
is•a˚_l
);

280 
__ex˘y≥_l
 (
isuµî_l
);

281 
__ex˘y≥_l
 (
isxdigô_l
);

283 
__ex˘y≥_l
 (
isbœnk_l
);

287 
	$__tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

288 
	$tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

291 
	$__touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

292 
	$touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

294 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


295 
	#__tﬁowî_l
(
c
, 
loˇÀ
) \

296 
	`__tobody
 (
c
, 
__tﬁowî_l
, (
loˇÀ
)->
__˘y≥_tﬁowî
, (c,ÜoˇÀ))

	)

297 
	#__touµî_l
(
c
, 
loˇÀ
) \

298 
	`__tobody
 (
c
, 
__touµî_l
, (
loˇÀ
)->
__˘y≥_touµî
, (c,ÜoˇÀ))

	)

299 
	#tﬁowî_l
(
c
, 
loˇÀ
Ë
	`__tﬁowî_l
 ((c), (loˇÀ))

	)

300 
	#touµî_l
(
c
, 
loˇÀ
Ë
	`__touµî_l
 ((c), (loˇÀ))

	)

304 #i‚de‡
__NO_CTYPE


305 
	#__iß um_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆnum
, (l))

	)

306 
	#__ißÕha_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆpha
, (l))

	)

307 
	#__is˙ål_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS˙ål
, (l))

	)

308 
	#__isdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISdigô
, (l))

	)

309 
	#__i¶owî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISlowî
, (l))

	)

310 
	#__isgøph_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISgøph
, (l))

	)

311 
	#__i•röt_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS¥öt
, (l))

	)

312 
	#__i•un˘_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISpun˘
, (l))

	)

313 
	#__is•a˚_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS•a˚
, (l))

	)

314 
	#__isuµî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISuµî
, (l))

	)

315 
	#__isxdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISxdigô
, (l))

	)

317 
	#__isbœnk_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISbœnk
, (l))

	)

319 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC


320 
	#__ißscii_l
(
c
,
l
Ë(÷), 
	`__ißscii
 (c))

	)

321 
	#__tﬂscii_l
(
c
,
l
Ë(÷), 
	`__tﬂscii
 (c))

	)

324 
	#iß um_l
(
c
,
l
Ë
	`__iß um_l
 ((c), (l))

	)

325 
	#ißÕha_l
(
c
,
l
Ë
	`__ißÕha_l
 ((c), (l))

	)

326 
	#is˙ål_l
(
c
,
l
Ë
	`__is˙ål_l
 ((c), (l))

	)

327 
	#isdigô_l
(
c
,
l
Ë
	`__isdigô_l
 ((c), (l))

	)

328 
	#i¶owî_l
(
c
,
l
Ë
	`__i¶owî_l
 ((c), (l))

	)

329 
	#isgøph_l
(
c
,
l
Ë
	`__isgøph_l
 ((c), (l))

	)

330 
	#i•röt_l
(
c
,
l
Ë
	`__i•röt_l
 ((c), (l))

	)

331 
	#i•un˘_l
(
c
,
l
Ë
	`__i•un˘_l
 ((c), (l))

	)

332 
	#is•a˚_l
(
c
,
l
Ë
	`__is•a˚_l
 ((c), (l))

	)

333 
	#isuµî_l
(
c
,
l
Ë
	`__isuµî_l
 ((c), (l))

	)

334 
	#isxdigô_l
(
c
,
l
Ë
	`__isxdigô_l
 ((c), (l))

	)

336 
	#isbœnk_l
(
c
,
l
Ë
	`__isbœnk_l
 ((c), (l))

	)

338 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC


339 
	#ißscii_l
(
c
,
l
Ë
	`__ißscii_l
 ((c), (l))

	)

340 
	#tﬂscii_l
(
c
,
l
Ë
	`__tﬂscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/dlfcn.h

19 #i‚def 
_DLFCN_H


20 
	#_DLFCN_H
 1

	)

22 
	~<„©uªs.h
>

23 
	#__√ed_size_t


	)

24 
	~<°ddef.h
>

27 
	~<bôs/dlf˙.h
>

30 #ifde‡
__USE_GNU


35 
	#RTLD_NEXT
 ((*Ë-1l)

	)

40 
	#RTLD_DEFAULT
 ((*Ë0)

	)

44 
	tLmid_t
;

47 
	#LM_ID_BASE
 0

	)

48 
	#LM_ID_NEWLM
 -1

	)

52 
__BEGIN_DECLS


56 *
	$dl›í
 (c⁄° *
__fûe
, 
__mode
Ë
__THROWNL
;

60 
	$dl˛o£
 (*
__h™dÀ
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1));

64 *
	$dlsym
 (*
__ª°ri˘
 
__h™dÀ
,

65 c⁄° *
__ª°ri˘
 
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

67 #ifde‡
__USE_GNU


69 *
	$dlm›í
 (
Lmid_t
 
__nsid
, c⁄° *
__fûe
, 
__mode
Ë
__THROWNL
;

73 *
	$dlvsym
 (*
__ª°ri˘
 
__h™dÀ
,

74 c⁄° *
__ª°ri˘
 
__«me
,

75 c⁄° *
__ª°ri˘
 
__vîsi⁄
)

76 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

82 *
	$dÀº‹
 (Ë
__THROW
;

85 #ifde‡
__USE_GNU


90 c⁄° *
dli_‚ame
;

91 *
dli_fba£
;

92 c⁄° *
dli_¢ame
;

93 *
dli_ßddr
;

94 } 
	tDl_öfo
;

98 
	$dœddr
 (c⁄° *
__addªss
, 
Dl_öfo
 *
__öfo
)

99 
__THROW
 
	`__n⁄nuŒ
 ((2));

102 
	$dœddr1
 (c⁄° *
__addªss
, 
Dl_öfo
 *
__öfo
,

103 **
__exåa_öfo
, 
__Êags
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

111 
RTLD_DL_SYMENT
 = 1,

114 
RTLD_DL_LINKMAP
 = 2

123 
	$dlöfo
 (*
__ª°ri˘
 
__h™dÀ
,

124 
__ªque°
, *
__ª°ri˘
 
__¨g
)

125 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

131 
RTLD_DI_LMID
 = 1,

135 
RTLD_DI_LINKMAP
 = 2,

137 
RTLD_DI_CONFIGADDR
 = 3,

144 
RTLD_DI_SERINFO
 = 4,

145 
RTLD_DI_SERINFOSIZE
 = 5,

149 
RTLD_DI_ORIGIN
 = 6,

151 
RTLD_DI_PROFILENAME
 = 7,

152 
RTLD_DI_PROFILEOUT
 = 8,

157 
RTLD_DI_TLS_MODID
 = 9,

163 
RTLD_DI_TLS_DATA
 = 10,

165 
RTLD_DI_MAX
 = 10

173 *
dls_«me
;

174 
dls_Êags
;

175 } 
	tDl_£Ω©h
;

181 
size_t
 
dls_size
;

182 
dls_˙t
;

183 
Dl_£Ω©h
 
dls_£Ω©h
[1];

184 } 
	tDl_£röfo
;

188 
__END_DECLS


	@/usr/include/err.h

19 #i‚def 
_ERR_H


20 
	#_ERR_H
 1

	)

22 
	~<„©uªs.h
>

24 
	#__√ed___va_li°


	)

25 
	~<°d¨g.h
>

26 #i‚def 
__GNUC_VA_LIST


27 
	#__gnuc_va_li°
 
__±r_t


	)

30 
__BEGIN_DECLS


34 
	$w¨n
 (c⁄° *
__f‹m©
, ...)

35 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 1, 2)));

36 
	$vw¨n
 (c⁄° *
__f‹m©
, 
__gnuc_va_li°
)

37 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 1, 0)));

40 
	$w¨nx
 (c⁄° *
__f‹m©
, ...)

41 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 1, 2)));

42 
	$vw¨nx
 (c⁄° *
__f‹m©
, 
__gnuc_va_li°
)

43 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 1, 0)));

46 
	$îr
 (
__°©us
, c⁄° *
__f‹m©
, ...)

47 
	`__©åibuã__
 ((
__n‹ëu∫__
, 
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

48 
	$vîr
 (
__°©us
, c⁄° *
__f‹m©
, 
__gnuc_va_li°
)

49 
	`__©åibuã__
 ((
__n‹ëu∫__
, 
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

50 
	$îrx
 (
__°©us
, c⁄° *
__f‹m©
, ...)

51 
	`__©åibuã__
 ((
__n‹ëu∫__
, 
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

52 
	$vîrx
 (
__°©us
, c⁄° *, 
__gnuc_va_li°
)

53 
	`__©åibuã__
 ((
__n‹ëu∫__
, 
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

55 
__END_DECLS


	@/usr/include/errno.h

22 #i‚def 
_ERRNO_H


26 #i‚def 
__√ed_Em©h


27 
	#_ERRNO_H
 1

	)

28 
	~<„©uªs.h
>

31 
	g__BEGIN_DECLS


35 
	~<bôs/î∫o.h
>

36 #unde‡
__√ed_Em©h


38 #ifdef 
_ERRNO_H


45 #i‚def 
î∫o


46 
î∫o
;

49 #ifde‡
__USE_GNU


54 *
¥ogøm_övoˇti⁄_«me
, *
¥ogøm_övoˇti⁄_sh‹t_«me
;

58 
	g__END_DECLS


66 #i‡
deföed
 
__USE_GNU
 || deföed 
__√ed_îr‹_t


67 #i‚de‡
__îr‹_t_deföed


68 
	tîr‹_t
;

69 
	#__îr‹_t_deföed
 1

	)

71 #unde‡
__√ed_îr‹_t


	@/usr/include/fcntl.h

22 #i‚def 
_FCNTL_H


23 
	#_FCNTL_H
 1

	)

25 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


31 
	~<bôs/ty≥s.h
>

35 
	~<bôs/f˙é.h
>

40 #i‚de‡
__mode_t_deföed


41 
__mode_t
 
	tmode_t
;

42 
	#__mode_t_deföed


	)

45 #i‚de‡
__off_t_deföed


46 #i‚de‡
__USE_FILE_OFFSET64


47 
__off_t
 
	toff_t
;

49 
__off64_t
 
	toff_t
;

51 
	#__off_t_deföed


	)

54 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


55 
__off64_t
 
	toff64_t
;

56 
	#__off64_t_deföed


	)

59 #i‚de‡
__pid_t_deföed


60 
__pid_t
 
	tpid_t
;

61 
	#__pid_t_deföed


	)

65 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


66 
	#__√ed_time•ec


	)

67 
	~<time.h
>

68 
	~<bôs/°©.h
>

70 
	#S_IFMT
 
__S_IFMT


	)

71 
	#S_IFDIR
 
__S_IFDIR


	)

72 
	#S_IFCHR
 
__S_IFCHR


	)

73 
	#S_IFBLK
 
__S_IFBLK


	)

74 
	#S_IFREG
 
__S_IFREG


	)

75 #ifde‡
__S_IFIFO


76 
	#S_IFIFO
 
__S_IFIFO


	)

78 #ifde‡
__S_IFLNK


79 
	#S_IFLNK
 
__S_IFLNK


	)

81 #i‡(
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8
Ë&& deföed 
__S_IFSOCK


82 
	#S_IFSOCK
 
__S_IFSOCK


	)

87 
	#S_ISUID
 
__S_ISUID


	)

88 
	#S_ISGID
 
__S_ISGID


	)

90 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN


92 
	#S_ISVTX
 
__S_ISVTX


	)

95 
	#S_IRUSR
 
__S_IREAD


	)

96 
	#S_IWUSR
 
__S_IWRITE


	)

97 
	#S_IXUSR
 
__S_IEXEC


	)

99 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

101 
	#S_IRGRP
 (
S_IRUSR
 >> 3Ë

	)

102 
	#S_IWGRP
 (
S_IWUSR
 >> 3Ë

	)

103 
	#S_IXGRP
 (
S_IXUSR
 >> 3Ë

	)

105 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

107 
	#S_IROTH
 (
S_IRGRP
 >> 3Ë

	)

108 
	#S_IWOTH
 (
S_IWGRP
 >> 3Ë

	)

109 
	#S_IXOTH
 (
S_IXGRP
 >> 3Ë

	)

111 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

114 #ifdef 
__USE_MISC


115 #i‚de‡
R_OK


118 
	#R_OK
 4

	)

119 
	#W_OK
 2

	)

120 
	#X_OK
 1

	)

121 
	#F_OK
 0

	)

126 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


127 
	#SEEK_SET
 0

	)

128 
	#SEEK_CUR
 1

	)

129 
	#SEEK_END
 2

	)

137 
f˙é
 (
__fd
, 
__cmd
, ...);

145 #i‚de‡
__USE_FILE_OFFSET64


146 
	$›í
 (c⁄° *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

148 #ifde‡
__REDIRECT


149 
	`__REDIRECT
 (
›í
, (c⁄° *
__fûe
, 
__oÊag
, ...), 
›í64
)

150 
	`__n⁄nuŒ
 ((1));

152 
	#›í
 
›í64


	)

155 #ifde‡
__USE_LARGEFILE64


156 
	$›í64
 (c⁄° *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

159 #ifde‡
__USE_ATFILE


169 #i‚de‡
__USE_FILE_OFFSET64


170 
	$›í©
 (
__fd
, c⁄° *
__fûe
, 
__oÊag
, ...)

171 
	`__n⁄nuŒ
 ((2));

173 #ifde‡
__REDIRECT


174 
	`__REDIRECT
 (
›í©
, (
__fd
, c⁄° *
__fûe
, 
__oÊag
,

175 ...), 
›í©64
Ë
	`__n⁄nuŒ
 ((2));

177 
	#›í©
 
›í©64


	)

180 #ifde‡
__USE_LARGEFILE64


181 
	$›í©64
 (
__fd
, c⁄° *
__fûe
, 
__oÊag
, ...)

182 
	`__n⁄nuŒ
 ((2));

191 #i‚de‡
__USE_FILE_OFFSET64


192 
	$¸ót
 (c⁄° *
__fûe
, 
mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

194 #ifde‡
__REDIRECT


195 
	`__REDIRECT
 (
¸ót
, (c⁄° *
__fûe
, 
mode_t
 
__mode
),

196 
¸ót64
Ë
	`__n⁄nuŒ
 ((1));

198 
	#¸ót
 
¸ót64


	)

201 #ifde‡
__USE_LARGEFILE64


202 
	$¸ót64
 (c⁄° *
__fûe
, 
mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

205 #i‡!
deföed
 
F_LOCK
 && (deföed 
__USE_MISC
 || (deföed 
__USE_XOPEN_EXTENDED
 \

206 && !
deföed
 
__USE_POSIX
))

215 
	#F_ULOCK
 0

	)

216 
	#F_LOCK
 1

	)

217 
	#F_TLOCK
 2

	)

218 
	#F_TEST
 3

	)

220 #i‚de‡
__USE_FILE_OFFSET64


221 
	`lockf
 (
__fd
, 
__cmd
, 
off_t
 
__Àn
);

223 #ifde‡
__REDIRECT


224 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
), 
lockf64
);

226 
	#lockf
 
lockf64


	)

229 #ifde‡
__USE_LARGEFILE64


230 
	`lockf64
 (
__fd
, 
__cmd
, 
off64_t
 
__Àn
);

234 #ifde‡
__USE_XOPEN2K


237 #i‚de‡
__USE_FILE_OFFSET64


238 
	$posix_Ádvi£
 (
__fd
, 
off_t
 
__off£t
, off_à
__Àn
,

239 
__advi£
Ë
__THROW
;

241 #ifde‡
__REDIRECT_NTH


242 
	`__REDIRECT_NTH
 (
posix_Ádvi£
, (
__fd
, 
__off64_t
 
__off£t
,

243 
__off64_t
 
__Àn
, 
__advi£
),

244 
posix_Ádvi£64
);

246 
	#posix_Ádvi£
 
posix_Ádvi£64


	)

249 #ifde‡
__USE_LARGEFILE64


250 
	$posix_Ádvi£64
 (
__fd
, 
off64_t
 
__off£t
, off64_à
__Àn
,

251 
__advi£
Ë
__THROW
;

259 #i‚de‡
__USE_FILE_OFFSET64


260 
	`posix_ÁŒoˇã
 (
__fd
, 
off_t
 
__off£t
, off_à
__Àn
);

262 #ifde‡
__REDIRECT


263 
	`__REDIRECT
 (
posix_ÁŒoˇã
, (
__fd
, 
__off64_t
 
__off£t
,

264 
__off64_t
 
__Àn
),

265 
posix_ÁŒoˇã64
);

267 
	#posix_ÁŒoˇã
 
posix_ÁŒoˇã64


	)

270 #ifde‡
__USE_LARGEFILE64


271 
	`posix_ÁŒoˇã64
 (
__fd
, 
off64_t
 
__off£t
, off64_à
__Àn
);

277 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄
 \

278 && 
deföed
 
__va_¨g_∑ck_Àn


279 
	~<bôs/f˙é2.h
>

282 
__END_DECLS


	@/usr/include/iconv.h

18 #i‚de‡
_ICONV_H


19 
	#_ICONV_H
 1

	)

21 
	~<„©uªs.h
>

22 
	#__√ed_size_t


	)

23 
	~<°ddef.h
>

26 
__BEGIN_DECLS


29 *
	tic⁄v_t
;

37 
ic⁄v_t
 
ic⁄v_›í
 (c⁄° *
__tocode
, c⁄° *
__‰omcode
);

42 
size_t
 
ic⁄v
 (
ic⁄v_t
 
__cd
, **
__ª°ri˘
 
__öbuf
,

43 
size_t
 *
__ª°ri˘
 
__öbyã¶e·
,

44 **
__ª°ri˘
 
__outbuf
,

45 
size_t
 *
__ª°ri˘
 
__outbyã¶e·
);

51 
ic⁄v_˛o£
 (
ic⁄v_t
 
__cd
);

53 
	g__END_DECLS


	@/usr/include/ifaddrs.h

19 #i‚de‡
_IFADDRS_H


20 
	#_IFADDRS_H
 1

	)

22 
	~<„©uªs.h
>

23 
	~<sys/sockë.h
>

25 
__BEGIN_DECLS


29 
	siÁddrs


31 
iÁddrs
 *
	miÁ_√xt
;

33 *
	miÁ_«me
;

34 
	miÁ_Êags
;

36 
sockaddr
 *
	miÁ_addr
;

37 
sockaddr
 *
	miÁ_√tmask
;

44 
sockaddr
 *
	mifu_brﬂdaddr
;

45 
sockaddr
 *
	mifu_d°addr
;

46 } 
	miÁ_ifu
;

49 #i‚de‡
iÁ_brﬂdaddr


50 
	#iÁ_brﬂdaddr
 
iÁ_ifu
.
ifu_brﬂdaddr


	)

52 #i‚de‡
iÁ_d°addr


53 
	#iÁ_d°addr
 
iÁ_ifu
.
ifu_d°addr


	)

56 *
	miÁ_d©a
;

66 
	$gëiÁddrs
 (
iÁddrs
 **
__iÁp
Ë
__THROW
;

69 
	$‰ìiÁddrs
 (
iÁddrs
 *
__iÁ
Ë
__THROW
;

71 
__END_DECLS


	@/usr/include/inttypes.h

22 #i‚de‡
_INTTYPES_H


23 
	#_INTTYPES_H
 1

	)

25 
	~<„©uªs.h
>

27 
	~<°döt.h
>

30 #i‚de‡
____gwch¨_t_deföed


31 #ifde‡
__˝lu•lus


32 
	#__gwch¨_t
 
wch¨_t


	)

33 #ñi‡
deföed
 
__WCHAR_TYPE__


34 
__WCHAR_TYPE__
 
	t__gwch¨_t
;

36 
	#__√ed_wch¨_t


	)

37 
	~<°ddef.h
>

38 
wch¨_t
 
	t__gwch¨_t
;

40 
	#____gwch¨_t_deföed
 1

	)

43 #i‡
__WORDSIZE
 == 64

44 
	#__PRI64_PREFIX
 "l"

	)

45 
	#__PRIPTR_PREFIX
 "l"

	)

47 
	#__PRI64_PREFIX
 "Œ"

	)

48 
	#__PRIPTR_PREFIX


	)

54 
	#PRId8
 "d"

	)

55 
	#PRId16
 "d"

	)

56 
	#PRId32
 "d"

	)

57 
	#PRId64
 
__PRI64_PREFIX
 "d"

	)

59 
	#PRIdLEAST8
 "d"

	)

60 
	#PRIdLEAST16
 "d"

	)

61 
	#PRIdLEAST32
 "d"

	)

62 
	#PRIdLEAST64
 
__PRI64_PREFIX
 "d"

	)

64 
	#PRIdFAST8
 "d"

	)

65 
	#PRIdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

66 
	#PRIdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

67 
	#PRIdFAST64
 
__PRI64_PREFIX
 "d"

	)

70 
	#PRIi8
 "i"

	)

71 
	#PRIi16
 "i"

	)

72 
	#PRIi32
 "i"

	)

73 
	#PRIi64
 
__PRI64_PREFIX
 "i"

	)

75 
	#PRIiLEAST8
 "i"

	)

76 
	#PRIiLEAST16
 "i"

	)

77 
	#PRIiLEAST32
 "i"

	)

78 
	#PRIiLEAST64
 
__PRI64_PREFIX
 "i"

	)

80 
	#PRIiFAST8
 "i"

	)

81 
	#PRIiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

82 
	#PRIiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

83 
	#PRIiFAST64
 
__PRI64_PREFIX
 "i"

	)

86 
	#PRIo8
 "o"

	)

87 
	#PRIo16
 "o"

	)

88 
	#PRIo32
 "o"

	)

89 
	#PRIo64
 
__PRI64_PREFIX
 "o"

	)

91 
	#PRIoLEAST8
 "o"

	)

92 
	#PRIoLEAST16
 "o"

	)

93 
	#PRIoLEAST32
 "o"

	)

94 
	#PRIoLEAST64
 
__PRI64_PREFIX
 "o"

	)

96 
	#PRIoFAST8
 "o"

	)

97 
	#PRIoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

98 
	#PRIoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

99 
	#PRIoFAST64
 
__PRI64_PREFIX
 "o"

	)

102 
	#PRIu8
 "u"

	)

103 
	#PRIu16
 "u"

	)

104 
	#PRIu32
 "u"

	)

105 
	#PRIu64
 
__PRI64_PREFIX
 "u"

	)

107 
	#PRIuLEAST8
 "u"

	)

108 
	#PRIuLEAST16
 "u"

	)

109 
	#PRIuLEAST32
 "u"

	)

110 
	#PRIuLEAST64
 
__PRI64_PREFIX
 "u"

	)

112 
	#PRIuFAST8
 "u"

	)

113 
	#PRIuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

114 
	#PRIuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

115 
	#PRIuFAST64
 
__PRI64_PREFIX
 "u"

	)

118 
	#PRIx8
 "x"

	)

119 
	#PRIx16
 "x"

	)

120 
	#PRIx32
 "x"

	)

121 
	#PRIx64
 
__PRI64_PREFIX
 "x"

	)

123 
	#PRIxLEAST8
 "x"

	)

124 
	#PRIxLEAST16
 "x"

	)

125 
	#PRIxLEAST32
 "x"

	)

126 
	#PRIxLEAST64
 
__PRI64_PREFIX
 "x"

	)

128 
	#PRIxFAST8
 "x"

	)

129 
	#PRIxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

130 
	#PRIxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

131 
	#PRIxFAST64
 
__PRI64_PREFIX
 "x"

	)

134 
	#PRIX8
 "X"

	)

135 
	#PRIX16
 "X"

	)

136 
	#PRIX32
 "X"

	)

137 
	#PRIX64
 
__PRI64_PREFIX
 "X"

	)

139 
	#PRIXLEAST8
 "X"

	)

140 
	#PRIXLEAST16
 "X"

	)

141 
	#PRIXLEAST32
 "X"

	)

142 
	#PRIXLEAST64
 
__PRI64_PREFIX
 "X"

	)

144 
	#PRIXFAST8
 "X"

	)

145 
	#PRIXFAST16
 
__PRIPTR_PREFIX
 "X"

	)

146 
	#PRIXFAST32
 
__PRIPTR_PREFIX
 "X"

	)

147 
	#PRIXFAST64
 
__PRI64_PREFIX
 "X"

	)

151 
	#PRIdMAX
 
__PRI64_PREFIX
 "d"

	)

152 
	#PRIiMAX
 
__PRI64_PREFIX
 "i"

	)

153 
	#PRIoMAX
 
__PRI64_PREFIX
 "o"

	)

154 
	#PRIuMAX
 
__PRI64_PREFIX
 "u"

	)

155 
	#PRIxMAX
 
__PRI64_PREFIX
 "x"

	)

156 
	#PRIXMAX
 
__PRI64_PREFIX
 "X"

	)

160 
	#PRIdPTR
 
__PRIPTR_PREFIX
 "d"

	)

161 
	#PRIiPTR
 
__PRIPTR_PREFIX
 "i"

	)

162 
	#PRIoPTR
 
__PRIPTR_PREFIX
 "o"

	)

163 
	#PRIuPTR
 
__PRIPTR_PREFIX
 "u"

	)

164 
	#PRIxPTR
 
__PRIPTR_PREFIX
 "x"

	)

165 
	#PRIXPTR
 
__PRIPTR_PREFIX
 "X"

	)

171 
	#SCNd8
 "hhd"

	)

172 
	#SCNd16
 "hd"

	)

173 
	#SCNd32
 "d"

	)

174 
	#SCNd64
 
__PRI64_PREFIX
 "d"

	)

176 
	#SCNdLEAST8
 "hhd"

	)

177 
	#SCNdLEAST16
 "hd"

	)

178 
	#SCNdLEAST32
 "d"

	)

179 
	#SCNdLEAST64
 
__PRI64_PREFIX
 "d"

	)

181 
	#SCNdFAST8
 "hhd"

	)

182 
	#SCNdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

183 
	#SCNdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

184 
	#SCNdFAST64
 
__PRI64_PREFIX
 "d"

	)

187 
	#SCNi8
 "hhi"

	)

188 
	#SCNi16
 "hi"

	)

189 
	#SCNi32
 "i"

	)

190 
	#SCNi64
 
__PRI64_PREFIX
 "i"

	)

192 
	#SCNiLEAST8
 "hhi"

	)

193 
	#SCNiLEAST16
 "hi"

	)

194 
	#SCNiLEAST32
 "i"

	)

195 
	#SCNiLEAST64
 
__PRI64_PREFIX
 "i"

	)

197 
	#SCNiFAST8
 "hhi"

	)

198 
	#SCNiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

199 
	#SCNiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

200 
	#SCNiFAST64
 
__PRI64_PREFIX
 "i"

	)

203 
	#SCNu8
 "hhu"

	)

204 
	#SCNu16
 "hu"

	)

205 
	#SCNu32
 "u"

	)

206 
	#SCNu64
 
__PRI64_PREFIX
 "u"

	)

208 
	#SCNuLEAST8
 "hhu"

	)

209 
	#SCNuLEAST16
 "hu"

	)

210 
	#SCNuLEAST32
 "u"

	)

211 
	#SCNuLEAST64
 
__PRI64_PREFIX
 "u"

	)

213 
	#SCNuFAST8
 "hhu"

	)

214 
	#SCNuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

215 
	#SCNuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

216 
	#SCNuFAST64
 
__PRI64_PREFIX
 "u"

	)

219 
	#SCNo8
 "hho"

	)

220 
	#SCNo16
 "ho"

	)

221 
	#SCNo32
 "o"

	)

222 
	#SCNo64
 
__PRI64_PREFIX
 "o"

	)

224 
	#SCNoLEAST8
 "hho"

	)

225 
	#SCNoLEAST16
 "ho"

	)

226 
	#SCNoLEAST32
 "o"

	)

227 
	#SCNoLEAST64
 
__PRI64_PREFIX
 "o"

	)

229 
	#SCNoFAST8
 "hho"

	)

230 
	#SCNoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

231 
	#SCNoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

232 
	#SCNoFAST64
 
__PRI64_PREFIX
 "o"

	)

235 
	#SCNx8
 "hhx"

	)

236 
	#SCNx16
 "hx"

	)

237 
	#SCNx32
 "x"

	)

238 
	#SCNx64
 
__PRI64_PREFIX
 "x"

	)

240 
	#SCNxLEAST8
 "hhx"

	)

241 
	#SCNxLEAST16
 "hx"

	)

242 
	#SCNxLEAST32
 "x"

	)

243 
	#SCNxLEAST64
 
__PRI64_PREFIX
 "x"

	)

245 
	#SCNxFAST8
 "hhx"

	)

246 
	#SCNxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

247 
	#SCNxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

248 
	#SCNxFAST64
 
__PRI64_PREFIX
 "x"

	)

252 
	#SCNdMAX
 
__PRI64_PREFIX
 "d"

	)

253 
	#SCNiMAX
 
__PRI64_PREFIX
 "i"

	)

254 
	#SCNoMAX
 
__PRI64_PREFIX
 "o"

	)

255 
	#SCNuMAX
 
__PRI64_PREFIX
 "u"

	)

256 
	#SCNxMAX
 
__PRI64_PREFIX
 "x"

	)

259 
	#SCNdPTR
 
__PRIPTR_PREFIX
 "d"

	)

260 
	#SCNiPTR
 
__PRIPTR_PREFIX
 "i"

	)

261 
	#SCNoPTR
 
__PRIPTR_PREFIX
 "o"

	)

262 
	#SCNuPTR
 
__PRIPTR_PREFIX
 "u"

	)

263 
	#SCNxPTR
 
__PRIPTR_PREFIX
 "x"

	)

266 
	g__BEGIN_DECLS


268 #i‡
__WORDSIZE
 == 64

273 
	mquŸ
;

274 
	mªm
;

275 } 
	timaxdiv_t
;

282 
__exãnsi⁄__
 
	mquŸ
;

283 
__exãnsi⁄__
 
	mªm
;

284 } 
	timaxdiv_t
;

290 
ötmax_t
 
	$imaxabs
 (
ötmax_t
 
__n
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

293 
imaxdiv_t
 
	$imaxdiv
 (
ötmax_t
 
__numî
, i¡max_à
__díom
)

294 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

297 
ötmax_t
 
	$°πoimax
 (c⁄° *
__ª°ri˘
 
__≈å
,

298 **
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

301 
uötmax_t
 
	$°πoumax
 (c⁄° *
__ª°ri˘
 
__≈å
,

302 ** 
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

305 
ötmax_t
 
	$wc°oimax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
__≈å
,

306 
__gwch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

307 
__THROW
;

310 
uötmax_t
 
	$wc°oumax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
__≈å
,

311 
__gwch¨_t
 ** 
__ª°ri˘
 
__íd±r
, 
__ba£
)

312 
__THROW
;

314 #ifde‡
__USE_EXTERN_INLINES


316 #i‡
__WORDSIZE
 == 64

318 
	$__°πﬁ_öã∫Æ
 (c⁄° *
__ª°ri˘
 
__≈å
,

319 **
__ª°ri˘
 
__íd±r
,

320 
__ba£
, 
__group
)

321 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

323 
__exã∫_ölöe
 
ötmax_t


324 
	`__NTH
 (
	$°πoimax
 (c⁄° *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

325 
ba£
))

327  
	`__°πﬁ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

328 
	}
}

330 
	$__°πoul_öã∫Æ
 (c⁄° *
__ª°ri˘
 
__≈å
,

331 ** 
__ª°ri˘
 
__íd±r
,

332 
__ba£
, 
__group
)

333 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

335 
__exã∫_ölöe
 
uötmax_t


336 
	`__NTH
 (
	$°πoumax
 (c⁄° *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

337 
ba£
))

339  
	`__°πoul_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

340 
	}
}

342 
	$__wc°ﬁ_öã∫Æ
 (c⁄° 
__gwch¨_t
 * 
__ª°ri˘
 
__≈å
,

343 
__gwch¨_t
 **
__ª°ri˘
 
__íd±r
,

344 
__ba£
, 
__group
)

345 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

347 
__exã∫_ölöe
 
ötmax_t


348 
	`__NTH
 (
	$wc°oimax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

349 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

351  
	`__wc°ﬁ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

352 
	}
}

354 
	$__wc°oul_öã∫Æ
 (c⁄° 
__gwch¨_t
 *

355 
__ª°ri˘
 
__≈å
,

356 
__gwch¨_t
 **

357 
__ª°ri˘
 
__íd±r
,

358 
__ba£
, 
__group
)

359 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

361 
__exã∫_ölöe
 
uötmax_t


362 
	`__NTH
 (
	$wc°oumax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

363 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

365  
	`__wc°oul_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

366 
	}
}

370 
__exãnsi⁄__


371 
	$__°πﬁl_öã∫Æ
 (c⁄° *
__ª°ri˘
 
__≈å
,

372 **
__ª°ri˘
 
__íd±r
,

373 
__ba£
, 
__group
)

374 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

376 
__exã∫_ölöe
 
ötmax_t


377 
	`__NTH
 (
	$°πoimax
 (c⁄° *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

378 
ba£
))

380  
	`__°πﬁl_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

381 
	}
}

383 
__exãnsi⁄__


384 
	$__°πouŒ_öã∫Æ
 (const *

385 
__ª°ri˘
 
__≈å
,

387 
__ª°ri˘
 
__íd±r
,

388 
__ba£
,

389 
__group
)

390 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

392 
__exã∫_ölöe
 
uötmax_t


393 
	`__NTH
 (
	$°πoumax
 (c⁄° *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

394 
ba£
))

396  
	`__°πouŒ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

397 
	}
}

399 
__exãnsi⁄__


400 
	$__wc°ﬁl_öã∫Æ
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
__≈å
,

401 
__gwch¨_t
 **
__ª°ri˘
 
__íd±r
,

402 
__ba£
, 
__group
)

403 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

405 
__exã∫_ölöe
 
ötmax_t


406 
	`__NTH
 (
	$wc°oimax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

407 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

409  
	`__wc°ﬁl_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

410 
	}
}

413 
__exãnsi⁄__


414 
	$__wc°ouŒ_öã∫Æ
 (c⁄° 
__gwch¨_t
 *

415 
__ª°ri˘
 
__≈å
,

416 
__gwch¨_t
 **

417 
__ª°ri˘
 
__íd±r
,

418 
__ba£
,

419 
__group
)

420 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

422 
__exã∫_ölöe
 
uötmax_t


423 
	`__NTH
 (
	$wc°oumax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

424 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

426  
	`__wc°ouŒ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

427 
	}
}

432 
	g__END_DECLS


	@/usr/include/libgen.h

18 #i‚de‡
_LIBGEN_H


19 
	#_LIBGEN_H
 1

	)

21 
	~<„©uªs.h
>

23 
__BEGIN_DECLS


26 *
	$dú«me
 (*
__∑th
Ë
__THROW
;

34 *
	$__xpg_ba£«me
 (*
__∑th
Ë
__THROW
;

35 
	#ba£«me
 
__xpg_ba£«me


	)

37 
__END_DECLS


	@/usr/include/limits.h

22 #i‚de‡
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<„©uªs.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

41 #i‚de‡
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<bôs/w‹dsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifde‡
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #i‡
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #i‡
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifde‡
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #i‡
deföed
 
__GNUC__
 && !deföed 
_GCC_LIMITS_H_


123 #ö˛ude_√xà<
limôs
.
h
>

129 #i‡
deföed
 
__USE_ISOC99
 && deföed 
__GNUC__


130 #i‚de‡
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #i‚de‡
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #i‚de‡
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<bôs/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<bôs/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<bôs/x›í_lim.h
>

	@/usr/include/locale.h

22 #i‚def 
_LOCALE_H


23 
	#_LOCALE_H
 1

	)

25 
	~<„©uªs.h
>

27 
	#__√ed_NULL


	)

28 
	~<°ddef.h
>

29 
	~<bôs/loˇÀ.h
>

31 
	g__BEGIN_DECLS


35 
	#LC_CTYPE
 
__LC_CTYPE


	)

36 
	#LC_NUMERIC
 
__LC_NUMERIC


	)

37 
	#LC_TIME
 
__LC_TIME


	)

38 
	#LC_COLLATE
 
__LC_COLLATE


	)

39 
	#LC_MONETARY
 
__LC_MONETARY


	)

40 
	#LC_MESSAGES
 
__LC_MESSAGES


	)

41 
	#LC_ALL
 
__LC_ALL


	)

42 
	#LC_PAPER
 
__LC_PAPER


	)

43 
	#LC_NAME
 
__LC_NAME


	)

44 
	#LC_ADDRESS
 
__LC_ADDRESS


	)

45 
	#LC_TELEPHONE
 
__LC_TELEPHONE


	)

46 
	#LC_MEASUREMENT
 
__LC_MEASUREMENT


	)

47 
	#LC_IDENTIFICATION
 
__LC_IDENTIFICATION


	)

50 
__BEGIN_NAMESPACE_STD


53 
	slc⁄v


57 *
	mdecimÆ_poöt
;

58 *
	mthoußnds_£p
;

64 *
	mgroupög
;

70 *
	möt_cuº_symbﬁ
;

71 *
	mcuºícy_symbﬁ
;

72 *
	mm⁄_decimÆ_poöt
;

73 *
	mm⁄_thoußnds_£p
;

74 *
	mm⁄_groupög
;

75 *
	mposôive_sign
;

76 *
	m√g©ive_sign
;

77 
	möt_‰ac_digôs
;

78 
	m‰ac_digôs
;

80 
	mp_cs_¥e˚des
;

82 
	mp_£p_by_•a˚
;

84 
	mn_cs_¥e˚des
;

86 
	mn_£p_by_•a˚
;

93 
	mp_sign_po¢
;

94 
	mn_sign_po¢
;

95 #ifde‡
__USE_ISOC99


97 
	möt_p_cs_¥e˚des
;

99 
	möt_p_£p_by_•a˚
;

101 
	möt_n_cs_¥e˚des
;

103 
	möt_n_£p_by_•a˚
;

110 
	möt_p_sign_po¢
;

111 
	möt_n_sign_po¢
;

113 
	m__öt_p_cs_¥e˚des
;

114 
	m__öt_p_£p_by_•a˚
;

115 
	m__öt_n_cs_¥e˚des
;

116 
	m__öt_n_£p_by_•a˚
;

117 
	m__öt_p_sign_po¢
;

118 
	m__öt_n_sign_po¢
;

124 *
	$£éoˇÀ
 (
__ˇãg‹y
, c⁄° *
__loˇÀ
Ë
__THROW
;

127 
lc⁄v
 *
	$loˇÀc⁄v
 (Ë
__THROW
;

129 
__END_NAMESPACE_STD


132 #ifdef 
__USE_XOPEN2K8


145 
	~<xloˇÀ.h
>

151 
__loˇÀ_t
 
	$√wloˇÀ
 (
__ˇãg‹y_mask
, c⁄° *
__loˇÀ
,

152 
__loˇÀ_t
 
__ba£
Ë
__THROW
;

158 
	#LC_CTYPE_MASK
 (1 << 
__LC_CTYPE
)

	)

159 
	#LC_NUMERIC_MASK
 (1 << 
__LC_NUMERIC
)

	)

160 
	#LC_TIME_MASK
 (1 << 
__LC_TIME
)

	)

161 
	#LC_COLLATE_MASK
 (1 << 
__LC_COLLATE
)

	)

162 
	#LC_MONETARY_MASK
 (1 << 
__LC_MONETARY
)

	)

163 
	#LC_MESSAGES_MASK
 (1 << 
__LC_MESSAGES
)

	)

164 
	#LC_PAPER_MASK
 (1 << 
__LC_PAPER
)

	)

165 
	#LC_NAME_MASK
 (1 << 
__LC_NAME
)

	)

166 
	#LC_ADDRESS_MASK
 (1 << 
__LC_ADDRESS
)

	)

167 
	#LC_TELEPHONE_MASK
 (1 << 
__LC_TELEPHONE
)

	)

168 
	#LC_MEASUREMENT_MASK
 (1 << 
__LC_MEASUREMENT
)

	)

169 
	#LC_IDENTIFICATION_MASK
 (1 << 
__LC_IDENTIFICATION
)

	)

170 
	#LC_ALL_MASK
 (
LC_CTYPE_MASK
 \

171 | 
LC_NUMERIC_MASK
 \

172 | 
LC_TIME_MASK
 \

173 | 
LC_COLLATE_MASK
 \

174 | 
LC_MONETARY_MASK
 \

175 | 
LC_MESSAGES_MASK
 \

176 | 
LC_PAPER_MASK
 \

177 | 
LC_NAME_MASK
 \

178 | 
LC_ADDRESS_MASK
 \

179 | 
LC_TELEPHONE_MASK
 \

180 | 
LC_MEASUREMENT_MASK
 \

181 | 
LC_IDENTIFICATION_MASK
 \

182 )

	)

186 
__loˇÀ_t
 
	$du∂oˇÀ
 (
__loˇÀ_t
 
__d©a£t
Ë
__THROW
;

190 
	$‰ìloˇÀ
 (
__loˇÀ_t
 
__d©a£t
Ë
__THROW
;

197 
__loˇÀ_t
 
	$u£loˇÀ
 (
__loˇÀ_t
 
__d©a£t
Ë
__THROW
;

201 
	#LC_GLOBAL_LOCALE
 ((
__loˇÀ_t
Ë-1L)

	)

205 
__END_DECLS


	@/usr/include/malloc.h

19 #i‚de‡
_MALLOC_H


20 
	#_MALLOC_H
 1

	)

22 
	~<„©uªs.h
>

23 
	~<°ddef.h
>

24 
	~<°dio.h
>

26 #ifde‡
_LIBC


27 
	#__MALLOC_HOOK_VOLATILE


	)

28 
	#__MALLOC_DEPRECATED


	)

30 
	#__MALLOC_HOOK_VOLATILE
 vﬁ©ûe

	)

31 
	#__MALLOC_DEPRECATED
 
__©åibuã_dïªˇãd__


	)

35 
__BEGIN_DECLS


38 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

41 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

42 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

49 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

50 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
;

53 
	$‰ì
 (*
__±r
Ë
__THROW
;

56 
	$c‰ì
 (*
__±r
Ë
__THROW
;

59 *
	$memÆign
 (
size_t
 
__Æignmít
, size_à
__size
)

60 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

63 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

67 *
	$pvÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

71 *(*
__m‹ec‹e
Ë(
±rdiff_t
 
__size
);

74 *
	$__deÁu…_m‹ec‹e
 (
±rdiff_t
 
__size
)

75 
__THROW
 
__©åibuã_mÆloc__
;

79 
	smÆlöfo


81 
¨ía
;

82 
‹dblks
;

83 
smblks
;

84 
hblks
;

85 
hblkhd
;

86 
usmblks
;

87 
fsmblks
;

88 
u‹dblks
;

89 
f‹dblks
;

90 
kìpco°
;

94 
mÆlöfo
 
	$mÆlöfo
 (Ë
__THROW
;

97 #i‚de‡
M_MXFAST


98 
	#M_MXFAST
 1

	)

100 #i‚de‡
M_NLBLKS


101 
	#M_NLBLKS
 2

	)

103 #i‚de‡
M_GRAIN


104 
	#M_GRAIN
 3

	)

106 #i‚de‡
M_KEEP


107 
	#M_KEEP
 4

	)

111 
	#M_TRIM_THRESHOLD
 -1

	)

112 
	#M_TOP_PAD
 -2

	)

113 
	#M_MMAP_THRESHOLD
 -3

	)

114 
	#M_MMAP_MAX
 -4

	)

115 
	#M_CHECK_ACTION
 -5

	)

116 
	#M_PERTURB
 -6

	)

117 
	#M_ARENA_TEST
 -7

	)

118 
	#M_ARENA_MAX
 -8

	)

121 
	$mÆl›t
 (
__∑øm
, 
__vÆ
Ë
__THROW
;

125 
	$mÆloc_åim
 (
size_t
 
__∑d
Ë
__THROW
;

129 
size_t
 
	$mÆloc_ußbÀ_size
 (*
__±r
Ë
__THROW
;

132 
	$mÆloc_°©s
 (Ë
__THROW
;

135 
	$mÆloc_öfo
 (
__›ti⁄s
, 
FILE
 *
__Â
Ë
__THROW
;

138 *
	$mÆloc_gë_°©e
 (Ë
__THROW
;

142 
	$mÆloc_£t_°©e
 (*
__±r
Ë
__THROW
;

147 (*
__MALLOC_HOOK_VOLATILE
 
__mÆloc_öôülize_hook
) ()

148 
__MALLOC_DEPRECATED
;

150 (*
__MALLOC_HOOK_VOLATILE
 
__‰ì_hook
Ë(*
__±r
,

152 
__MALLOC_DEPRECATED
;

153 *(*
__MALLOC_HOOK_VOLATILE
 
__mÆloc_hook
)(
size_t
 
__size
,

155 
__MALLOC_DEPRECATED
;

156 *(*
__MALLOC_HOOK_VOLATILE
 
__ªÆloc_hook
)(*
__±r
,

157 
size_t
 
__size
,

159 
__MALLOC_DEPRECATED
;

160 *(*
__MALLOC_HOOK_VOLATILE
 
__memÆign_hook
)(
size_t
 
__Æignmít
,

161 
size_t
 
__size
,

163 
__MALLOC_DEPRECATED
;

164 (*
__MALLOC_HOOK_VOLATILE
 
__a·î_m‹ec‹e_hook
) ();

167 
	$__mÆloc_check_öô
 (Ë
__THROW
 
__MALLOC_DEPRECATED
;

170 
__END_DECLS


	@/usr/include/memory.h

22 #i‚def 
_MEMORY_H


23 
	#_MEMORY_H
 1

	)

25 
	~<„©uªs.h
>

28 #i‚def 
_STRING_H


29 
	~<°rög.h
>

	@/usr/include/net/if.h

19 #i‚de‡
_NET_IF_H


20 
	#_NET_IF_H
 1

	)

22 
	~<„©uªs.h
>

24 #ifde‡
__USE_MISC


25 
	~<sys/ty≥s.h
>

26 
	~<sys/sockë.h
>

31 
	#IF_NAMESIZE
 16

	)

33 
	sif_«meödex


35 
	mif_ödex
;

36 *
	mif_«me
;

40 #ifde‡
__USE_MISC


44 
	mIFF_UP
 = 0x1,

45 
	#IFF_UP
 
IFF_UP


	)

46 
	mIFF_BROADCAST
 = 0x2,

47 
	#IFF_BROADCAST
 
IFF_BROADCAST


	)

48 
	mIFF_DEBUG
 = 0x4,

49 
	#IFF_DEBUG
 
IFF_DEBUG


	)

50 
	mIFF_LOOPBACK
 = 0x8,

51 
	#IFF_LOOPBACK
 
IFF_LOOPBACK


	)

52 
	mIFF_POINTOPOINT
 = 0x10,

53 
	#IFF_POINTOPOINT
 
IFF_POINTOPOINT


	)

54 
	mIFF_NOTRAILERS
 = 0x20,

55 
	#IFF_NOTRAILERS
 
IFF_NOTRAILERS


	)

56 
	mIFF_RUNNING
 = 0x40,

57 
	#IFF_RUNNING
 
IFF_RUNNING


	)

58 
	mIFF_NOARP
 = 0x80,

59 
	#IFF_NOARP
 
IFF_NOARP


	)

60 
	mIFF_PROMISC
 = 0x100,

61 
	#IFF_PROMISC
 
IFF_PROMISC


	)

64 
	mIFF_ALLMULTI
 = 0x200,

65 
	#IFF_ALLMULTI
 
IFF_ALLMULTI


	)

67 
	mIFF_MASTER
 = 0x400,

68 
	#IFF_MASTER
 
IFF_MASTER


	)

69 
	mIFF_SLAVE
 = 0x800,

70 
	#IFF_SLAVE
 
IFF_SLAVE


	)

72 
	mIFF_MULTICAST
 = 0x1000,

73 
	#IFF_MULTICAST
 
IFF_MULTICAST


	)

75 
	mIFF_PORTSEL
 = 0x2000,

76 
	#IFF_PORTSEL
 
IFF_PORTSEL


	)

77 
	mIFF_AUTOMEDIA
 = 0x4000,

78 
	#IFF_AUTOMEDIA
 
IFF_AUTOMEDIA


	)

79 
	mIFF_DYNAMIC
 = 0x8000

80 
	#IFF_DYNAMIC
 
IFF_DYNAMIC


	)

88 
	siÁddr


90 
sockaddr
 
	miÁ_addr
;

93 
sockaddr
 
	mifu_brﬂdaddr
;

94 
sockaddr
 
	mifu_d°addr
;

95 } 
	miÁ_ifu
;

96 
iÁ˚
 *
	miÁ_iÂ
;

97 
iÁddr
 *
	miÁ_√xt
;

100 
	#iÁ_brﬂdaddr
 
iÁ_ifu
.
ifu_brﬂdaddr


	)

101 
	#iÁ_d°addr
 
iÁ_ifu
.
ifu_d°addr


	)

111 
	sifm≠


113 
	mmem_°¨t
;

114 
	mmem_íd
;

115 
	mba£_addr
;

116 
	múq
;

117 
	mdma
;

118 
	mp‹t
;

126 
	si‰eq


128 
	#IFHWADDRLEN
 6

	)

129 
	#IFNAMSIZ
 
IF_NAMESIZE


	)

132 
	mi‰n_«me
[
IFNAMSIZ
];

133 } 
	mi‰_i‰n
;

137 
sockaddr
 
	mi‰u_addr
;

138 
sockaddr
 
	mi‰u_d°addr
;

139 
sockaddr
 
	mi‰u_brﬂdaddr
;

140 
sockaddr
 
	mi‰u_√tmask
;

141 
sockaddr
 
	mi‰u_hwaddr
;

142 
	mi‰u_Êags
;

143 
	mi‰u_ivÆue
;

144 
	mi‰u_mtu
;

145 
ifm≠
 
	mi‰u_m≠
;

146 
	mi‰u_¶ave
[
IFNAMSIZ
];

147 
	mi‰u_√w«me
[
IFNAMSIZ
];

148 
__ˇddr_t
 
	mi‰u_d©a
;

149 } 
	mi‰_i‰u
;

151 
	#i‰_«me
 
i‰_i‰n
.
i‰n_«me


	)

152 
	#i‰_hwaddr
 
i‰_i‰u
.
i‰u_hwaddr


	)

153 
	#i‰_addr
 
i‰_i‰u
.
i‰u_addr


	)

154 
	#i‰_d°addr
 
i‰_i‰u
.
i‰u_d°addr


	)

155 
	#i‰_brﬂdaddr
 
i‰_i‰u
.
i‰u_brﬂdaddr


	)

156 
	#i‰_√tmask
 
i‰_i‰u
.
i‰u_√tmask


	)

157 
	#i‰_Êags
 
i‰_i‰u
.
i‰u_Êags


	)

158 
	#i‰_mëric
 
i‰_i‰u
.
i‰u_ivÆue


	)

159 
	#i‰_mtu
 
i‰_i‰u
.
i‰u_mtu


	)

160 
	#i‰_m≠
 
i‰_i‰u
.
i‰u_m≠


	)

161 
	#i‰_¶ave
 
i‰_i‰u
.
i‰u_¶ave


	)

162 
	#i‰_d©a
 
i‰_i‰u
.
i‰u_d©a


	)

163 
	#i‰_ifödex
 
i‰_i‰u
.
i‰u_ivÆue


	)

164 
	#i‰_b™dwidth
 
i‰_i‰u
.
i‰u_ivÆue


	)

165 
	#i‰_qÀn
 
i‰_i‰u
.
i‰u_ivÆue


	)

166 
	#i‰_√w«me
 
i‰_i‰u
.
i‰u_√w«me


	)

167 
	#_IOT_i‰eq
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),16,0,0)

	)

168 
	#_IOT_i‰eq_sh‹t
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),1,0,0)

	)

169 
	#_IOT_i‰eq_öt
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),1,0,0)

	)

176 
	sifc⁄f


178 
	mifc_Àn
;

181 
__ˇddr_t
 
	mifcu_buf
;

182 
i‰eq
 *
	mifcu_ªq
;

183 } 
	mifc_ifcu
;

185 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

186 
	#ifc_ªq
 
ifc_ifcu
.
ifcu_ªq


	)

187 
	#_IOT_ifc⁄f
 
	`_IOT
(
	`_IOTS
(
ifc⁄f
),1,0,0,0,0Ë

	)

190 
__BEGIN_DECLS


193 
	$if_«mëoödex
 (c⁄° *
__i‚ame
Ë
__THROW
;

194 *
	$if_ödext⁄ame
 (
__ifödex
, *
__i‚ame
Ë
__THROW
;

197 
if_«meödex
 *
	$if_«meödex
 (Ë
__THROW
;

200 
	$if_‰ì«meödex
 (
if_«meödex
 *
__±r
Ë
__THROW
;

202 
__END_DECLS


	@/usr/include/netdb.h

22 #i‚def 
_NETDB_H


23 
	#_NETDB_H
 1

	)

25 
	~<„©uªs.h
>

27 
	~<√töë/ö.h
>

28 
	~<°döt.h
>

29 #ifde‡
__USE_MISC


32 
	~<Ωc/√tdb.h
>

35 #ifde‡
__USE_GNU


36 
	#__√ed_sigevít_t


	)

37 
	~<bôs/sigöfo.h
>

38 
	#__√ed_time•ec


	)

39 
	~<time.h
>

42 
	~<bôs/√tdb.h
>

45 
	#_PATH_HEQUIV
 "/ëc/ho°s.equiv"

	)

46 
	#_PATH_HOSTS
 "/ëc/ho°s"

	)

47 
	#_PATH_NETWORKS
 "/ëc/√tw‹ks"

	)

48 
	#_PATH_NSSWITCH_CONF
 "/ëc/nsswôch.c⁄f"

	)

49 
	#_PATH_PROTOCOLS
 "/ëc/¥Ÿocﬁs"

	)

50 
	#_PATH_SERVICES
 "/ëc/£rvi˚s"

	)

53 
	g__BEGIN_DECLS


55 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


58 
	#h_î∫o
 (*
	`__h_î∫o_loˇti⁄
 ())

	)

61 *
	$__h_î∫o_loˇti⁄
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

65 
	#HOST_NOT_FOUND
 1

	)

66 
	#TRY_AGAIN
 2

	)

68 
	#NO_RECOVERY
 3

	)

70 
	#NO_DATA
 4

	)

73 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


74 
	#NETDB_INTERNAL
 -1

	)

75 
	#NETDB_SUCCESS
 0

	)

76 
	#NO_ADDRESS
 
NO_DATA


	)

79 #i‡
deföed
 
__USE_XOPEN2K
 || deföed 
__USE_XOPEN_EXTENDED


81 
	#IPPORT_RESERVED
 1024

	)

84 #ifde‡
__USE_GNU


86 
	#SCOPE_DELIMITER
 '%'

	)

89 #ifde‡
__USE_MISC


92 
	$hîr‹
 (c⁄° *
__°r
Ë
__THROW
;

95 c⁄° *
	$h°ªº‹
 (
__îr_num
Ë
__THROW
;

100 
	sho°ít


102 *
h_«me
;

103 **
h_Æü£s
;

104 
h_addπy≥
;

105 
h_Àngth
;

106 **
h_addr_li°
;

107 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


108 
	#h_addr
 
h_addr_li°
[0]

	)

117 
	`£tho°ít
 (
__°ay_›í
);

123 
	`ídho°ít
 ();

130 
ho°ít
 *
	`gëho°ít
 ();

137 
ho°ít
 *
	`gëho°byaddr
 (c⁄° *
__addr
, 
__sockÀn_t
 
__Àn
,

138 
__ty≥
);

144 
ho°ít
 *
	`gëho°by«me
 (c⁄° *
__«me
);

146 #ifde‡
__USE_MISC


155 
ho°ít
 *
	`gëho°by«me2
 (c⁄° *
__«me
, 
__af
);

167 
	`gëho°ít_r
 (
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

168 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

169 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

170 *
__ª°ri˘
 
__h_î∫›
);

172 
	`gëho°byaddr_r
 (c⁄° *
__ª°ri˘
 
__addr
, 
__sockÀn_t
 
__Àn
,

173 
__ty≥
,

174 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

175 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

176 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

177 *
__ª°ri˘
 
__h_î∫›
);

179 
	`gëho°by«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

180 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

181 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

182 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

183 *
__ª°ri˘
 
__h_î∫›
);

185 
	`gëho°by«me2_r
 (c⁄° *
__ª°ri˘
 
__«me
, 
__af
,

186 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

187 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

188 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

189 *
__ª°ri˘
 
__h_î∫›
);

198 
	`£äëít
 (
__°ay_›í
);

204 
	`íd√ã¡
 ();

211 
√ã¡
 *
	`gë√ã¡
 ();

218 
√ã¡
 *
	`gë√tbyaddr
 (
uöt32_t
 
__√t
, 
__ty≥
);

224 
√ã¡
 *
	`gë√tby«me
 (c⁄° *
__«me
);

226 #ifdef 
__USE_MISC


237 
	`gë√ã¡_r
 (
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

238 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

239 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

240 *
__ª°ri˘
 
__h_î∫›
);

242 
	`gë√tbyaddr_r
 (
uöt32_t
 
__√t
, 
__ty≥
,

243 
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

244 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

245 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

246 *
__ª°ri˘
 
__h_î∫›
);

248 
	`gë√tby«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

249 
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

250 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

251 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

252 *
__ª°ri˘
 
__h_î∫›
);

257 
	s£rvít


259 *
s_«me
;

260 **
s_Æü£s
;

261 
s_p‹t
;

262 *
s_¥Ÿo
;

270 
	`£t£rvít
 (
__°ay_›í
);

276 
	`íd£rvít
 ();

283 
£rvít
 *
	`gë£rvít
 ();

290 
£rvít
 *
	`gë£rvby«me
 (c⁄° *
__«me
, c⁄° *
__¥Ÿo
);

297 
£rvít
 *
	`gë£rvbyp‹t
 (
__p‹t
, c⁄° *
__¥Ÿo
);

300 #ifdef 
__USE_MISC


308 
	`gë£rvít_r
 (
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

309 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

310 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

312 
	`gë£rvby«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

313 c⁄° *
__ª°ri˘
 
__¥Ÿo
,

314 
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

315 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

316 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

318 
	`gë£rvbyp‹t_r
 (
__p‹t
, c⁄° *
__ª°ri˘
 
__¥Ÿo
,

319 
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

320 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

321 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

326 
	s¥Ÿ€¡


328 *
p_«me
;

329 **
p_Æü£s
;

330 
p_¥Ÿo
;

338 
	`£çrŸ€¡
 (
__°ay_›í
);

344 
	`íd¥Ÿ€¡
 ();

351 
¥Ÿ€¡
 *
	`gë¥Ÿ€¡
 ();

357 
¥Ÿ€¡
 *
	`gë¥Ÿoby«me
 (c⁄° *
__«me
);

363 
¥Ÿ€¡
 *
	`gë¥Ÿobynumbî
 (
__¥Ÿo
);

366 #ifdef 
__USE_MISC


374 
	`gë¥Ÿ€¡_r
 (
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

375 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

376 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

378 
	`gë¥Ÿoby«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

379 
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

380 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

381 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

383 
	`gë¥Ÿobynumbî_r
 (
__¥Ÿo
,

384 
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

385 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

386 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

395 
	`£äëgª¡
 (c⁄° *
__√tgroup
);

403 
	`íd√tgª¡
 ();

412 
	`gë√tgª¡
 (**
__ª°ri˘
 
__ho°p
,

413 **
__ª°ri˘
 
__u£Ω
,

414 **
__ª°ri˘
 
__domaöp
);

423 
	`ö√tgr
 (c⁄° *
__√tgroup
, c⁄° *
__ho°
,

424 c⁄° *
__u£r
, c⁄° *
__domaö
);

432 
	`gë√tgª¡_r
 (**
__ª°ri˘
 
__ho°p
,

433 **
__ª°ri˘
 
__u£Ω
,

434 **
__ª°ri˘
 
__domaöp
,

435 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
);

439 #ifde‡
__USE_BSD


451 
	`rcmd
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

452 c⁄° *
__ª°ri˘
 
__locu£r
,

453 c⁄° *
__ª°ri˘
 
__ªmu£r
,

454 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
);

463 
	`rcmd_af
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

464 c⁄° *
__ª°ri˘
 
__locu£r
,

465 c⁄° *
__ª°ri˘
 
__ªmu£r
,

466 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
,

467 
ß_Ámûy_t
 
__af
);

479 
	`ªxec
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

480 c⁄° *
__ª°ri˘
 
__«me
,

481 c⁄° *
__ª°ri˘
 
__∑ss
,

482 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
);

491 
	`ªxec_af
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

492 c⁄° *
__ª°ri˘
 
__«me
,

493 c⁄° *
__ª°ri˘
 
__∑ss
,

494 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
,

495 
ß_Ámûy_t
 
__af
);

505 
	`ru£rok
 (c⁄° *
__rho°
, 
__su£r
,

506 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
);

515 
	`ru£rok_af
 (c⁄° *
__rho°
, 
__su£r
,

516 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
,

517 
ß_Ámûy_t
 
__af
);

528 
	`úu£rok
 (
uöt32_t
 
__øddr
, 
__su£r
,

529 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
);

539 
	`úu£rok_af
 (c⁄° *
__øddr
, 
__su£r
,

540 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
,

541 
ß_Ámûy_t
 
__af
);

551 
	`ºesvp‹t
 (*
__Æp‹t
);

560 
	`ºesvp‹t_af
 (*
__Æp‹t
, 
ß_Ámûy_t
 
__af
);

565 #ifdef 
__USE_POSIX


567 
	saddröfo


569 
ai_Êags
;

570 
ai_Ámûy
;

571 
ai_sockty≥
;

572 
ai_¥Ÿocﬁ
;

573 
sockÀn_t
 
ai_addæí
;

574 
sockaddr
 *
ai_addr
;

575 *
ai_ˇn⁄«me
;

576 
addröfo
 *
ai_√xt
;

579 #ifde‡
__USE_GNU


581 
	sgaicb


583 c⁄° *
¨_«me
;

584 c⁄° *
¨_£rvi˚
;

585 c⁄° 
addröfo
 *
¨_ªque°
;

586 
addröfo
 *
¨_ªsu…
;

588 
__ªtu∫
;

589 
__glibc_ª£rved
[5];

593 
	#GAI_WAIT
 0

	)

594 
	#GAI_NOWAIT
 1

	)

598 
	#AI_PASSIVE
 0x0001

	)

599 
	#AI_CANONNAME
 0x0002

	)

600 
	#AI_NUMERICHOST
 0x0004

	)

601 
	#AI_V4MAPPED
 0x0008

	)

602 
	#AI_ALL
 0x0010

	)

603 
	#AI_ADDRCONFIG
 0x0020

	)

605 #ifde‡
__USE_GNU


606 
	#AI_IDN
 0x0040

	)

609 
	#AI_CANONIDN
 0x0080

	)

610 
	#AI_IDN_ALLOW_UNASSIGNED
 0x0100

	)

612 
	#AI_IDN_USE_STD3_ASCII_RULES
 0x0200

	)

615 
	#AI_NUMERICSERV
 0x0400

	)

618 
	#EAI_BADFLAGS
 -1

	)

619 
	#EAI_NONAME
 -2

	)

620 
	#EAI_AGAIN
 -3

	)

621 
	#EAI_FAIL
 -4

	)

622 
	#EAI_FAMILY
 -6

	)

623 
	#EAI_SOCKTYPE
 -7

	)

624 
	#EAI_SERVICE
 -8

	)

625 
	#EAI_MEMORY
 -10

	)

626 
	#EAI_SYSTEM
 -11

	)

627 
	#EAI_OVERFLOW
 -12

	)

628 #ifde‡
__USE_GNU


629 
	#EAI_NODATA
 -5

	)

630 
	#EAI_ADDRFAMILY
 -9

	)

631 
	#EAI_INPROGRESS
 -100

	)

632 
	#EAI_CANCELED
 -101

	)

633 
	#EAI_NOTCANCELED
 -102

	)

634 
	#EAI_ALLDONE
 -103

	)

635 
	#EAI_INTR
 -104

	)

636 
	#EAI_IDN_ENCODE
 -105

	)

639 #ifde‡
__USE_MISC


640 
	#NI_MAXHOST
 1025

	)

641 
	#NI_MAXSERV
 32

	)

644 
	#NI_NUMERICHOST
 1

	)

645 
	#NI_NUMERICSERV
 2

	)

646 
	#NI_NOFQDN
 4

	)

647 
	#NI_NAMEREQD
 8

	)

648 
	#NI_DGRAM
 16

	)

649 #ifde‡
__USE_GNU


650 
	#NI_IDN
 32

	)

651 
	#NI_IDN_ALLOW_UNASSIGNED
 64

	)

653 
	#NI_IDN_USE_STD3_ASCII_RULES
 128

	)

662 
	`gëaddröfo
 (c⁄° *
__ª°ri˘
 
__«me
,

663 c⁄° *
__ª°ri˘
 
__£rvi˚
,

664 c⁄° 
addröfo
 *
__ª°ri˘
 
__ªq
,

665 
addröfo
 **
__ª°ri˘
 
__∑i
);

668 
	$‰ìaddröfo
 (
addröfo
 *
__ai
Ë
__THROW
;

671 c⁄° *
	$gai_°ªº‹
 (
__ecode
Ë
__THROW
;

677 
	`gë«meöfo
 (c⁄° 
sockaddr
 *
__ª°ri˘
 
__ß
,

678 
sockÀn_t
 
__ßÀn
, *
__ª°ri˘
 
__ho°
,

679 
sockÀn_t
 
__ho°Àn
, *
__ª°ri˘
 
__£rv
,

680 
sockÀn_t
 
__£rvÀn
, 
__Êags
);

683 #ifde‡
__USE_GNU


692 
	`gëaddröfo_a
 (
__mode
, 
gaicb
 *
__li°
[
__ª°ri˘_¨r
],

693 
__ít
, 
sigevít
 *
__ª°ri˘
 
__sig
);

703 
	`gai_su•íd
 (c⁄° 
gaicb
 *c⁄° 
__li°
[], 
__ít
,

704 c⁄° 
time•ec
 *
__timeout
);

707 
	$gai_îr‹
 (
gaicb
 *
__ªq
Ë
__THROW
;

710 
	$gai_ˇn˚l
 (
gaicb
 *
__gaicbp
Ë
__THROW
;

713 
__END_DECLS


	@/usr/include/netinet/in.h

18 #i‚def 
_NETINET_IN_H


19 
	#_NETINET_IN_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<°döt.h
>

23 
	~<sys/sockë.h
>

24 
	~<bôs/ty≥s.h
>

27 
__BEGIN_DECLS


30 
uöt32_t
 
	tö_addr_t
;

31 
	sö_addr


33 
ö_addr_t
 
	ms_addr
;

37 
	~<bôs/ö.h
>

42 
	mIPPROTO_IP
 = 0,

43 
	#IPPROTO_IP
 
IPPROTO_IP


	)

44 
	mIPPROTO_ICMP
 = 1,

45 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

46 
	mIPPROTO_IGMP
 = 2,

47 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

48 
	mIPPROTO_IPIP
 = 4,

49 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

50 
	mIPPROTO_TCP
 = 6,

51 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

52 
	mIPPROTO_EGP
 = 8,

53 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

54 
	mIPPROTO_PUP
 = 12,

55 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

56 
	mIPPROTO_UDP
 = 17,

57 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

58 
	mIPPROTO_IDP
 = 22,

59 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

60 
	mIPPROTO_TP
 = 29,

61 
	#IPPROTO_TP
 
IPPROTO_TP


	)

62 
	mIPPROTO_DCCP
 = 33,

63 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

64 
	mIPPROTO_IPV6
 = 41,

65 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

66 
	mIPPROTO_RSVP
 = 46,

67 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

68 
	mIPPROTO_GRE
 = 47,

69 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

70 
	mIPPROTO_ESP
 = 50,

71 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

72 
	mIPPROTO_AH
 = 51,

73 
	#IPPROTO_AH
 
IPPROTO_AH


	)

74 
	mIPPROTO_MTP
 = 92,

75 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

76 
	mIPPROTO_BEETPH
 = 94,

77 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

78 
	mIPPROTO_ENCAP
 = 98,

79 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

80 
	mIPPROTO_PIM
 = 103,

81 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

82 
	mIPPROTO_COMP
 = 108,

83 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

84 
	mIPPROTO_SCTP
 = 132,

85 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

86 
	mIPPROTO_UDPLITE
 = 136,

87 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

88 
	mIPPROTO_RAW
 = 255,

89 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

90 
	mIPPROTO_MAX


96 #i‚de‡
__USE_KERNEL_IPV6_DEFS


99 
	mIPPROTO_HOPOPTS
 = 0,

100 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

101 
	mIPPROTO_ROUTING
 = 43,

102 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

103 
	mIPPROTO_FRAGMENT
 = 44,

104 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

105 
	mIPPROTO_ICMPV6
 = 58,

106 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

107 
	mIPPROTO_NONE
 = 59,

108 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

109 
	mIPPROTO_DSTOPTS
 = 60,

110 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

111 
	mIPPROTO_MH
 = 135

112 
	#IPPROTO_MH
 
IPPROTO_MH


	)

117 
uöt16_t
 
	tö_p‹t_t
;

122 
	mIPPORT_ECHO
 = 7,

123 
	mIPPORT_DISCARD
 = 9,

124 
	mIPPORT_SYSTAT
 = 11,

125 
	mIPPORT_DAYTIME
 = 13,

126 
	mIPPORT_NETSTAT
 = 15,

127 
	mIPPORT_FTP
 = 21,

128 
	mIPPORT_TELNET
 = 23,

129 
	mIPPORT_SMTP
 = 25,

130 
	mIPPORT_TIMESERVER
 = 37,

131 
	mIPPORT_NAMESERVER
 = 42,

132 
	mIPPORT_WHOIS
 = 43,

133 
	mIPPORT_MTP
 = 57,

135 
	mIPPORT_TFTP
 = 69,

136 
	mIPPORT_RJE
 = 77,

137 
	mIPPORT_FINGER
 = 79,

138 
	mIPPORT_TTYLINK
 = 87,

139 
	mIPPORT_SUPDUP
 = 95,

142 
	mIPPORT_EXECSERVER
 = 512,

143 
	mIPPORT_LOGINSERVER
 = 513,

144 
	mIPPORT_CMDSERVER
 = 514,

145 
	mIPPORT_EFSSERVER
 = 520,

148 
	mIPPORT_BIFFUDP
 = 512,

149 
	mIPPORT_WHOSERVER
 = 513,

150 
	mIPPORT_ROUTESERVER
 = 520,

153 
	mIPPORT_RESERVED
 = 1024,

156 
	mIPPORT_USERRESERVED
 = 5000

164 
	#IN_CLASSA
(
a
Ë((((
ö_addr_t
)◊)Ë& 0x80000000Ë=0)

	)

165 
	#IN_CLASSA_NET
 0xff000000

	)

166 
	#IN_CLASSA_NSHIFT
 24

	)

167 
	#IN_CLASSA_HOST
 (0xfffffff‡& ~
IN_CLASSA_NET
)

	)

168 
	#IN_CLASSA_MAX
 128

	)

170 
	#IN_CLASSB
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xc0000000Ë=0x80000000)

	)

171 
	#IN_CLASSB_NET
 0xffff0000

	)

172 
	#IN_CLASSB_NSHIFT
 16

	)

173 
	#IN_CLASSB_HOST
 (0xfffffff‡& ~
IN_CLASSB_NET
)

	)

174 
	#IN_CLASSB_MAX
 65536

	)

176 
	#IN_CLASSC
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xe0000000Ë=0xc0000000)

	)

177 
	#IN_CLASSC_NET
 0xffffff00

	)

178 
	#IN_CLASSC_NSHIFT
 8

	)

179 
	#IN_CLASSC_HOST
 (0xfffffff‡& ~
IN_CLASSC_NET
)

	)

181 
	#IN_CLASSD
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xf0000000Ë=0xe0000000)

	)

182 
	#IN_MULTICAST
(
a
Ë
	`IN_CLASSD
◊)

	)

184 
	#IN_EXPERIMENTAL
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xe0000000Ë=0xe0000000)

	)

185 
	#IN_BADCLASS
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xf0000000Ë=0xf0000000)

	)

188 
	#INADDR_ANY
 ((
ö_addr_t
Ë0x00000000)

	)

190 
	#INADDR_BROADCAST
 ((
ö_addr_t
Ë0xffffffff)

	)

192 
	#INADDR_NONE
 ((
ö_addr_t
Ë0xffffffff)

	)

195 
	#IN_LOOPBACKNET
 127

	)

197 #i‚de‡
INADDR_LOOPBACK


198 
	#INADDR_LOOPBACK
 ((
ö_addr_t
Ë0x7f000001Ë

	)

202 
	#INADDR_UNSPEC_GROUP
 ((
ö_addr_t
Ë0xe0000000Ë

	)

203 
	#INADDR_ALLHOSTS_GROUP
 ((
ö_addr_t
Ë0xe0000001Ë

	)

204 
	#INADDR_ALLRTRS_GROUP
 ((
ö_addr_t
Ë0xe0000002Ë

	)

205 
	#INADDR_MAX_LOCAL_GROUP
 ((
ö_addr_t
Ë0xe00000ffË

	)

207 #i‚de‡
__USE_KERNEL_IPV6_DEFS


209 
	sö6_addr


213 
uöt8_t
 
	m__u6_addr8
[16];

214 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


215 
uöt16_t
 
	m__u6_addr16
[8];

216 
uöt32_t
 
	m__u6_addr32
[4];

218 } 
	m__ö6_u
;

219 
	#s6_addr
 
__ö6_u
.
__u6_addr8


	)

220 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


221 
	#s6_addr16
 
__ö6_u
.
__u6_addr16


	)

222 
	#s6_addr32
 
__ö6_u
.
__u6_addr32


	)

227 c⁄° 
ö6_addr
 
ö6addr_™y
;

228 c⁄° 
ö6_addr
 
ö6addr_lo›back
;

229 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

230 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

232 
	#INET_ADDRSTRLEN
 16

	)

233 
	#INET6_ADDRSTRLEN
 46

	)

237 
	ssockaddr_ö


239 
__SOCKADDR_COMMON
 (
sö_
);

240 
ö_p‹t_t
 
	msö_p‹t
;

241 
ö_addr
 
	msö_addr
;

244 
	msö_zîo
[ (
sockaddr
) -

245 
__SOCKADDR_COMMON_SIZE
 -

246  (
ö_p‹t_t
) -

247  (
ö_addr
)];

250 #i‚de‡
__USE_KERNEL_IPV6_DEFS


252 
	ssockaddr_ö6


254 
__SOCKADDR_COMMON
 (
sö6_
);

255 
ö_p‹t_t
 
	msö6_p‹t
;

256 
uöt32_t
 
	msö6_Êowöfo
;

257 
ö6_addr
 
	msö6_addr
;

258 
uöt32_t
 
	msö6_sc›e_id
;

262 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


264 
	sù_mªq


267 
ö_addr
 
	mimr_mu…üddr
;

270 
ö_addr
 
	mimr_öãrÁ˚
;

273 
	sù_mªq_sour˚


276 
ö_addr
 
	mimr_mu…üddr
;

279 
ö_addr
 
	mimr_öãrÁ˚
;

282 
ö_addr
 
	mimr_sour˚addr
;

286 #i‚de‡
__USE_KERNEL_IPV6_DEFS


288 
	sùv6_mªq


291 
ö6_addr
 
	mùv6mr_mu…üddr
;

294 
	mùv6mr_öãrÁ˚
;

298 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


300 
	sgroup_ªq


303 
uöt32_t
 
	mgr_öãrÁ˚
;

306 
sockaddr_°‹age
 
	mgr_group
;

309 
	sgroup_sour˚_ªq


312 
uöt32_t
 
	mg§_öãrÁ˚
;

315 
sockaddr_°‹age
 
	mg§_group
;

318 
sockaddr_°‹age
 
	mg§_sour˚
;

323 
	sù_msfûãr


326 
ö_addr
 
	mimsf_mu…üddr
;

329 
ö_addr
 
	mimsf_öãrÁ˚
;

332 
uöt32_t
 
	mimsf_fmode
;

335 
uöt32_t
 
	mimsf_num§c
;

337 
ö_addr
 
	mimsf_¶i°
[1];

340 
	#IP_MSFILTER_SIZE
(
num§c
Ë( (
ù_msfûãr
) \

341 -  (
ö_addr
) \

342 + (
num§c
Ë*  (
ö_addr
))

	)

344 
	sgroup_fûãr


347 
uöt32_t
 
	mgf_öãrÁ˚
;

350 
sockaddr_°‹age
 
	mgf_group
;

353 
uöt32_t
 
	mgf_fmode
;

356 
uöt32_t
 
	mgf_num§c
;

358 
sockaddr_°‹age
 
	mgf_¶i°
[1];

361 
	#GROUP_FILTER_SIZE
(
num§c
Ë( (
group_fûãr
) \

362 -  (
sockaddr_°‹age
) \

363 + ((
num§c
) \

364 *  (
sockaddr_°‹age
)))

	)

374 
uöt32_t
 
	$¡ohl
 (
uöt32_t
 
__√é⁄g
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

375 
uöt16_t
 
	$¡ohs
 (
uöt16_t
 
__√tsh‹t
)

376 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

377 
uöt32_t
 
	$ht⁄l
 (
uöt32_t
 
__ho°l⁄g
)

378 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

379 
uöt16_t
 
	$ht⁄s
 (
uöt16_t
 
__ho°sh‹t
)

380 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

382 
	~<ídün.h
>

385 
	~<bôs/byãsw≠.h
>

387 #ifde‡
__OPTIMIZE__


391 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


394 
	#¡ohl
(
x
Ë(x)

	)

395 
	#¡ohs
(
x
Ë(x)

	)

396 
	#ht⁄l
(
x
Ë(x)

	)

397 
	#ht⁄s
(
x
Ë(x)

	)

399 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


400 
	#¡ohl
(
x
Ë
	`__bsw≠_32
 (x)

	)

401 
	#¡ohs
(
x
Ë
	`__bsw≠_16
 (x)

	)

402 
	#ht⁄l
(
x
Ë
	`__bsw≠_32
 (x)

	)

403 
	#ht⁄s
(
x
Ë
	`__bsw≠_16
 (x)

	)

408 #ifde‡
__GNUC__


409 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

410 (
__exãnsi⁄__
 \

411 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

412 
__a
->
s6_addr32
[0] == 0 \

413 && 
__a
->
s6_addr32
[1] == 0 \

414 && 
__a
->
s6_addr32
[2] == 0 \

415 && 
__a
->
s6_addr32
[3] =0; 
	}
}))

	)

417 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

418 (
__exãnsi⁄__
 \

419 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

420 
__a
->
s6_addr32
[0] == 0 \

421 && 
__a
->
s6_addr32
[1] == 0 \

422 && 
__a
->
s6_addr32
[2] == 0 \

423 && 
__a
->
s6_addr32
[3] =
	`ht⁄l
 (1); }))

	)

425 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

426 (
__exãnsi⁄__
 \

427 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

428 (
__a
->
s6_addr32
[0] & 
	`ht⁄l
 (0xffc00000)Ë=ht⁄»(0x„800000); }))

	)

430 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

431 (
__exãnsi⁄__
 \

432 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

433 (
__a
->
s6_addr32
[0] & 
	`ht⁄l
 (0xffc00000)Ë=ht⁄»(0x„c00000); }))

	)

435 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

436 (
__exãnsi⁄__
 \

437 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

438 
__a
->
s6_addr32
[0] == 0 \

439 && 
__a
->
s6_addr32
[1] == 0 \

440 && 
__a
->
s6_addr32
[2] =
	`ht⁄l
 (0xffff); }))

	)

442 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

443 (
__exãnsi⁄__
 \

444 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

445 
__a
->
s6_addr32
[0] == 0 \

446 && 
__a
->
s6_addr32
[1] == 0 \

447 && 
__a
->
s6_addr32
[2] == 0 \

448 && 
	`¡ohl
 (
__a
->
s6_addr32
[3]Ë> 1; }))

	)

450 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

451 (
__exãnsi⁄__
 \

452 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

453 c⁄° 
ö6_addr
 *
__b
 = (c⁄° ö6_add∏*Ë(
b
); \

454 
__a
->
s6_addr32
[0] =
__b
->s6_addr32[0] \

455 && 
__a
->
s6_addr32
[1] =
__b
->s6_addr32[1] \

456 && 
__a
->
s6_addr32
[2] =
__b
->s6_addr32[2] \

457 && 
__a
->
s6_addr32
[3] =
__b
->s6_addr32[3]; }))

	)

459 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

460 (((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0 \

461 && ((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0 \

462 && ((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0 \

463 && ((c⁄° 
uöt32_t
 *Ë(
a
))[3] =0)

	)

465 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

466 (((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0 \

467 && ((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0 \

468 && ((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0 \

469 && ((c⁄° 
uöt32_t
 *Ë(
a
))[3] =
	`ht⁄l
 (1))

	)

471 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

472 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] & 
	`ht⁄l
 (0xffc00000)) \

473 =
	`ht⁄l
 (0x„800000))

	)

475 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

476 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] & 
	`ht⁄l
 (0xffc00000)) \

477 =
	`ht⁄l
 (0x„c00000))

	)

479 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

480 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0) \

481 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0) \

482 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] =
	`ht⁄l
 (0xffff)))

	)

484 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

485 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0) \

486 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0) \

487 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0) \

488 && (
	`¡ohl
 (((c⁄° 
uöt32_t
 *Ë(
a
))[3]Ë> 1))

	)

490 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

491 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] =((c⁄° uöt32_à*Ë(
b
))[0]) \

492 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] =((c⁄° uöt32_à*Ë(
b
))[1]) \

493 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] =((c⁄° uöt32_à*Ë(
b
))[2]) \

494 && (((c⁄° 
uöt32_t
 *Ë(
a
))[3] =((c⁄° uöt32_à*Ë(
b
))[3]))

	)

497 
	#IN6_IS_ADDR_MULTICAST
(
a
Ë(((c⁄° 
uöt8_t
 *Ë◊))[0] =0xff)

	)

499 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_GNU


501 
	$bödªsvp‹t
 (
__sockfd
, 
sockaddr_ö
 *
__sock_ö
Ë
__THROW
;

504 
	$bödªsvp‹t6
 (
__sockfd
, 
sockaddr_ö6
 *
__sock_ö
)

505 
__THROW
;

509 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

510 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

511 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x1))

	)

513 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

514 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

515 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x2))

	)

517 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

518 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

519 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x5))

	)

521 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

522 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

523 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x8))

	)

525 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

526 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

527 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0xe))

	)

530 #ifde‡
__USE_GNU


531 
cmsghdr
;

534 
	sö6_pktöfo


536 
ö6_addr
 
ùi6_addr
;

537 
ùi6_ifödex
;

541 
	sù6_mtuöfo


543 
sockaddr_ö6
 
ù6m_addr
;

544 
uöt32_t
 
ù6m_mtu
;

549 
	$öë6_›ti⁄_•a˚
 (
__nbyãs
)

550 
__THROW
 
__©åibuã_dïªˇãd__
;

551 
	$öë6_›ti⁄_öô
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

552 
__ty≥
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

553 
	$öë6_›ti⁄_≠≥nd
 (
cmsghdr
 *
__cmsg
,

554 c⁄° 
uöt8_t
 *
__ty≥p
, 
__mu…x
,

555 
__∂usy
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

556 
uöt8_t
 *
	$öë6_›ti⁄_Æloc
 (
cmsghdr
 *
__cmsg
, 
__d©Æí
,

557 
__mu…x
, 
__∂usy
)

558 
__THROW
 
__©åibuã_dïªˇãd__
;

559 
	$öë6_›ti⁄_√xt
 (c⁄° 
cmsghdr
 *
__cmsg
,

560 
uöt8_t
 **
__çåp
)

561 
__THROW
 
__©åibuã_dïªˇãd__
;

562 
	$öë6_›ti⁄_föd
 (c⁄° 
cmsghdr
 *
__cmsg
,

563 
uöt8_t
 **
__çåp
, 
__ty≥
)

564 
__THROW
 
__©åibuã_dïªˇãd__
;

568 
	$öë6_›t_öô
 (*
__extbuf
, 
sockÀn_t
 
__exéí
Ë
__THROW
;

569 
	$öë6_›t_≠≥nd
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

570 
uöt8_t
 
__ty≥
, 
sockÀn_t
 
__Àn
, uöt8_à
__Æign
,

571 **
__d©abuÂ
Ë
__THROW
;

572 
	$öë6_›t_föish
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
)

573 
__THROW
;

574 
	$öë6_›t_£t_vÆ
 (*
__d©abuf
, 
__off£t
, *
__vÆ
,

575 
sockÀn_t
 
__vÆÀn
Ë
__THROW
;

576 
	$öë6_›t_√xt
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

577 
uöt8_t
 *
__ty≥p
, 
sockÀn_t
 *
__À≈
,

578 **
__d©abuÂ
Ë
__THROW
;

579 
	$öë6_›t_föd
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

580 
uöt8_t
 
__ty≥
, 
sockÀn_t
 *
__À≈
,

581 **
__d©abuÂ
Ë
__THROW
;

582 
	$öë6_›t_gë_vÆ
 (*
__d©abuf
, 
__off£t
, *
__vÆ
,

583 
sockÀn_t
 
__vÆÀn
Ë
__THROW
;

587 
sockÀn_t
 
	$öë6_πh_•a˚
 (
__ty≥
, 
__£gmíts
Ë
__THROW
;

588 *
	$öë6_πh_öô
 (*
__bp
, 
sockÀn_t
 
__bp_Àn
, 
__ty≥
,

589 
__£gmíts
Ë
__THROW
;

590 
	$öë6_πh_add
 (*
__bp
, c⁄° 
ö6_addr
 *
__addr
Ë
__THROW
;

591 
	$öë6_πh_ªvî£
 (c⁄° *
__ö
, *
__out
Ë
__THROW
;

592 
	$öë6_πh_£gmíts
 (c⁄° *
__bp
Ë
__THROW
;

593 
ö6_addr
 *
	$öë6_πh_gëaddr
 (c⁄° *
__bp
, 
__ödex
)

594 
__THROW
;

600 
	$gëùv4sour˚fûãr
 (
__s
, 
ö_addr
 
__öãrÁ˚_addr
,

601 
ö_addr
 
__group
, 
uöt32_t
 *
__fmode
,

602 
uöt32_t
 *
__num§c
, 
ö_addr
 *
__¶i°
)

603 
__THROW
;

606 
	$£tùv4sour˚fûãr
 (
__s
, 
ö_addr
 
__öãrÁ˚_addr
,

607 
ö_addr
 
__group
, 
uöt32_t
 
__fmode
,

608 
uöt32_t
 
__num§c
,

609 c⁄° 
ö_addr
 *
__¶i°
)

610 
__THROW
;

614 
	$gësour˚fûãr
 (
__s
, 
uöt32_t
 
__öãrÁ˚_addr
,

615 c⁄° 
sockaddr
 *
__group
,

616 
sockÀn_t
 
__grou∂í
, 
uöt32_t
 *
__fmode
,

617 
uöt32_t
 *
__num§c
,

618 
sockaddr_°‹age
 *
__¶i°
Ë
__THROW
;

621 
	$£tsour˚fûãr
 (
__s
, 
uöt32_t
 
__öãrÁ˚_addr
,

622 c⁄° 
sockaddr
 *
__group
,

623 
sockÀn_t
 
__grou∂í
, 
uöt32_t
 
__fmode
,

624 
uöt32_t
 
__num§c
,

625 c⁄° 
sockaddr_°‹age
 *
__¶i°
Ë
__THROW
;

628 
__END_DECLS


	@/usr/include/netinet/tcp.h

32 #i‚de‡
_NETINET_TCP_H


33 
	#_NETINET_TCP_H
 1

	)

35 
	~<„©uªs.h
>

40 
	#TCP_NODELAY
 1

	)

41 
	#TCP_MAXSEG
 2

	)

42 
	#TCP_CORK
 3

	)

43 
	#TCP_KEEPIDLE
 4

	)

44 
	#TCP_KEEPINTVL
 5

	)

45 
	#TCP_KEEPCNT
 6

	)

46 
	#TCP_SYNCNT
 7

	)

47 
	#TCP_LINGER2
 8

	)

48 
	#TCP_DEFER_ACCEPT
 9

	)

49 
	#TCP_WINDOW_CLAMP
 10

	)

50 
	#TCP_INFO
 11

	)

51 
	#TCP_QUICKACK
 12

	)

52 
	#TCP_CONGESTION
 13

	)

53 
	#TCP_MD5SIG
 14

	)

54 
	#TCP_COOKIE_TRANSACTIONS
 15

	)

55 
	#TCP_THIN_LINEAR_TIMEOUTS
 16

	)

56 
	#TCP_THIN_DUPACK
 17

	)

57 
	#TCP_USER_TIMEOUT
 18

	)

58 
	#TCP_REPAIR
 19

	)

59 
	#TCP_REPAIR_QUEUE
 20

	)

60 
	#TCP_QUEUE_SEQ
 21

	)

61 
	#TCP_REPAIR_OPTIONS
 22

	)

62 
	#TCP_FASTOPEN
 23

	)

63 
	#TCP_TIMESTAMP
 24

	)

65 #ifde‡
__USE_MISC


66 
	~<sys/ty≥s.h
>

67 
	~<sys/sockë.h
>

69 
u_öt32_t
 
	tt˝_£q
;

74 
	st˝hdr


76 
__exãnsi⁄__
 union

80 
u_öt16_t
 
	mth_•‹t
;

81 
u_öt16_t
 
	mth_dp‹t
;

82 
t˝_£q
 
	mth_£q
;

83 
t˝_£q
 
	mth_ack
;

84 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


85 
u_öt8_t
 
	mth_x2
:4;

86 
u_öt8_t
 
	mth_off
:4;

88 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


89 
u_öt8_t
 
	mth_off
:4;

90 
u_öt8_t
 
	mth_x2
:4;

92 
u_öt8_t
 
	mth_Êags
;

93 
	#TH_FIN
 0x01

	)

94 
	#TH_SYN
 0x02

	)

95 
	#TH_RST
 0x04

	)

96 
	#TH_PUSH
 0x08

	)

97 
	#TH_ACK
 0x10

	)

98 
	#TH_URG
 0x20

	)

99 
u_öt16_t
 
	mth_wö
;

100 
u_öt16_t
 
	mth_sum
;

101 
u_öt16_t
 
	mth_uΩ
;

105 
u_öt16_t
 
	msour˚
;

106 
u_öt16_t
 
	mde°
;

107 
u_öt32_t
 
	m£q
;

108 
u_öt32_t
 
	mack_£q
;

109 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


110 
u_öt16_t
 
	mªs1
:4;

111 
u_öt16_t
 
	mdoff
:4;

112 
u_öt16_t
 
	mfö
:1;

113 
u_öt16_t
 
	msyn
:1;

114 
u_öt16_t
 
	mr°
:1;

115 
u_öt16_t
 
	mpsh
:1;

116 
u_öt16_t
 
	mack
:1;

117 
u_öt16_t
 
	murg
:1;

118 
u_öt16_t
 
	mªs2
:2;

119 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


120 
u_öt16_t
 
	mdoff
:4;

121 
u_öt16_t
 
	mªs1
:4;

122 
u_öt16_t
 
	mªs2
:2;

123 
u_öt16_t
 
	murg
:1;

124 
u_öt16_t
 
	mack
:1;

125 
u_öt16_t
 
	mpsh
:1;

126 
u_öt16_t
 
	mr°
:1;

127 
u_öt16_t
 
	msyn
:1;

128 
u_öt16_t
 
	mfö
:1;

132 
u_öt16_t
 
	mwödow
;

133 
u_öt16_t
 
	mcheck
;

134 
u_öt16_t
 
	murg_±r
;

141 
	mTCP_ESTABLISHED
 = 1,

142 
	mTCP_SYN_SENT
,

143 
	mTCP_SYN_RECV
,

144 
	mTCP_FIN_WAIT1
,

145 
	mTCP_FIN_WAIT2
,

146 
	mTCP_TIME_WAIT
,

147 
	mTCP_CLOSE
,

148 
	mTCP_CLOSE_WAIT
,

149 
	mTCP_LAST_ACK
,

150 
	mTCP_LISTEN
,

151 
	mTCP_CLOSING


154 
	#TCPOPT_EOL
 0

	)

155 
	#TCPOPT_NOP
 1

	)

156 
	#TCPOPT_MAXSEG
 2

	)

157 
	#TCPOLEN_MAXSEG
 4

	)

158 
	#TCPOPT_WINDOW
 3

	)

159 
	#TCPOLEN_WINDOW
 3

	)

160 
	#TCPOPT_SACK_PERMITTED
 4

	)

161 
	#TCPOLEN_SACK_PERMITTED
 2

	)

162 
	#TCPOPT_SACK
 5

	)

163 
	#TCPOPT_TIMESTAMP
 8

	)

164 
	#TCPOLEN_TIMESTAMP
 10

	)

165 
	#TCPOLEN_TSTAMP_APPA
 (
TCPOLEN_TIMESTAMP
+2Ë

	)

167 
	#TCPOPT_TSTAMP_HDR
 \

168 (
TCPOPT_NOP
<<24|TCPOPT_NOP<<16|
TCPOPT_TIMESTAMP
<<8|
TCPOLEN_TIMESTAMP
)

	)

176 
	#TCP_MSS
 512

	)

178 
	#TCP_MAXWIN
 65535

	)

180 
	#TCP_MAX_WINSHIFT
 14

	)

182 
	#SOL_TCP
 6

	)

185 
	#TCPI_OPT_TIMESTAMPS
 1

	)

186 
	#TCPI_OPT_SACK
 2

	)

187 
	#TCPI_OPT_WSCALE
 4

	)

188 
	#TCPI_OPT_ECN
 8

	)

189 
	#TCPI_OPT_ECN_SEEN
 16

	)

190 
	#TCPI_OPT_SYN_DATA
 32

	)

193 
	et˝_ˇ_°©e


195 
	mTCP_CA_O≥n
 = 0,

196 
	mTCP_CA_Dis‹dî
 = 1,

197 
	mTCP_CA_CWR
 = 2,

198 
	mTCP_CA_Recovîy
 = 3,

199 
	mTCP_CA_Loss
 = 4

202 
	st˝_öfo


204 
u_öt8_t
 
	mt˝i_°©e
;

205 
u_öt8_t
 
	mt˝i_ˇ_°©e
;

206 
u_öt8_t
 
	mt˝i_ªå™smôs
;

207 
u_öt8_t
 
	mt˝i_¥obes
;

208 
u_öt8_t
 
	mt˝i_backoff
;

209 
u_öt8_t
 
	mt˝i_›ti⁄s
;

210 
u_öt8_t
 
	mt˝i_¢d_wsˇÀ
 : 4, 
	mt˝i_rcv_wsˇÀ
 : 4;

212 
u_öt32_t
 
	mt˝i_πo
;

213 
u_öt32_t
 
	mt˝i_©o
;

214 
u_öt32_t
 
	mt˝i_¢d_mss
;

215 
u_öt32_t
 
	mt˝i_rcv_mss
;

217 
u_öt32_t
 
	mt˝i_u«cked
;

218 
u_öt32_t
 
	mt˝i_ßcked
;

219 
u_öt32_t
 
	mt˝i_lo°
;

220 
u_öt32_t
 
	mt˝i_ªå™s
;

221 
u_öt32_t
 
	mt˝i_Áckës
;

224 
u_öt32_t
 
	mt˝i_œ°_d©a_£¡
;

225 
u_öt32_t
 
	mt˝i_œ°_ack_£¡
;

226 
u_öt32_t
 
	mt˝i_œ°_d©a_ªcv
;

227 
u_öt32_t
 
	mt˝i_œ°_ack_ªcv
;

230 
u_öt32_t
 
	mt˝i_pmtu
;

231 
u_öt32_t
 
	mt˝i_rcv_s°hªsh
;

232 
u_öt32_t
 
	mt˝i_πt
;

233 
u_öt32_t
 
	mt˝i_πtv¨
;

234 
u_öt32_t
 
	mt˝i_¢d_s°hªsh
;

235 
u_öt32_t
 
	mt˝i_¢d_cwnd
;

236 
u_öt32_t
 
	mt˝i_advmss
;

237 
u_öt32_t
 
	mt˝i_ª‹dîög
;

239 
u_öt32_t
 
	mt˝i_rcv_πt
;

240 
u_öt32_t
 
	mt˝i_rcv_•a˚
;

242 
u_öt32_t
 
	mt˝i_tŸÆ_ªå™s
;

247 
	#TCP_MD5SIG_MAXKEYLEN
 80

	)

249 
	st˝_md5sig


251 
sockaddr_°‹age
 
	mt˝m_addr
;

252 
u_öt16_t
 
	m__t˝m_∑d1
;

253 
u_öt16_t
 
	mt˝m_keyÀn
;

254 
u_öt32_t
 
	m__t˝m_∑d2
;

255 
u_öt8_t
 
	mt˝m_key
[
TCP_MD5SIG_MAXKEYLEN
];

259 
	st˝_ª∑ú_›t


261 
u_öt32_t
 
	m›t_code
;

262 
u_öt32_t
 
	m›t_vÆ
;

268 
	mTCP_NO_QUEUE
,

269 
	mTCP_RECV_QUEUE
,

270 
	mTCP_SEND_QUEUE
,

271 
	mTCP_QUEUES_NR
,

275 
	#TCP_COOKIE_MIN
 8

	)

276 
	#TCP_COOKIE_MAX
 16

	)

277 
	#TCP_COOKIE_PAIR_SIZE
 (2*
TCP_COOKIE_MAX
)

	)

280 
	#TCP_COOKIE_IN_ALWAYS
 (1 << 0Ë

	)

281 
	#TCP_COOKIE_OUT_NEVER
 (1 << 1Ë

	)

285 
	#TCP_S_DATA_IN
 (1 << 2Ë

	)

286 
	#TCP_S_DATA_OUT
 (1 << 3Ë

	)

288 
	#TCP_MSS_DEFAULT
 536U

	)

289 
	#TCP_MSS_DESIRED
 1220U

	)

291 
	st˝_cookõ_å™ß˘i⁄s


293 
u_öt16_t
 
	mt˝˘_Êags
;

294 
u_öt8_t
 
	m__t˝˘_∑d1
;

295 
u_öt8_t
 
	mt˝˘_cookõ_desúed
;

296 
u_öt16_t
 
	mt˝˘_s_d©a_desúed
;

297 
u_öt16_t
 
	mt˝˘_u£d
;

298 
u_öt8_t
 
	mt˝˘_vÆue
[
TCP_MSS_DEFAULT
];

	@/usr/include/nss.h

21 #i‚de‡
_NSS_H


22 
	#_NSS_H
 1

	)

24 
	~<„©uªs.h
>

25 
	~<°döt.h
>

28 
__BEGIN_DECLS


31 
	enss_°©us


33 
	mNSS_STATUS_TRYAGAIN
 = -2,

34 
	mNSS_STATUS_UNAVAIL
,

35 
	mNSS_STATUS_NOTFOUND
,

36 
	mNSS_STATUS_SUCCESS
,

37 
	mNSS_STATUS_RETURN


42 
	sgaih_addπu∂e


44 
gaih_addπu∂e
 *
	m√xt
;

45 *
	m«me
;

46 
	mÁmûy
;

47 
uöt32_t
 
	maddr
[4];

48 
uöt32_t
 
	msc›eid
;

58 
	$__nss_c⁄figuª_lookup
 (c⁄° *
__db«me
,

59 c⁄° *
__°rög
Ë
__THROW
;

61 
__END_DECLS


	@/usr/include/poll.h

1 
	~<sys/pﬁl.h
>

	@/usr/include/pthread.h

18 #i‚de‡
_PTHREAD_H


19 
	#_PTHREAD_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<ídün.h
>

23 
	~<sched.h
>

24 
	~<time.h
>

26 
	~<bôs/±hªadty≥s.h
>

27 
	~<bôs/£tjmp.h
>

28 
	~<bôs/w‹dsize.h
>

34 
	mPTHREAD_CREATE_JOINABLE
,

35 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

36 
	mPTHREAD_CREATE_DETACHED


37 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

44 
	mPTHREAD_MUTEX_TIMED_NP
,

45 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

46 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

47 
	mPTHREAD_MUTEX_ADAPTIVE_NP


48 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


50 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

51 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

52 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

53 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


55 #ifde‡
__USE_GNU


57 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


62 #ifde‡
__USE_XOPEN2K


66 
	mPTHREAD_MUTEX_STALLED
,

67 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

68 
	mPTHREAD_MUTEX_ROBUST
,

69 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


74 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


78 
	mPTHREAD_PRIO_NONE
,

79 
	mPTHREAD_PRIO_INHERIT
,

80 
	mPTHREAD_PRIO_PROTECT


86 #i‡
__PTHREAD_MUTEX_HAVE_ELISION
 == 1

87 
	#__PTHREAD_SPINS
 0, 0

	)

88 #ñi‡
__PTHREAD_MUTEX_HAVE_ELISION
 == 2

89 
	#__PTHREAD_SPINS
 { 0, 0 }

	)

91 
	#__PTHREAD_SPINS
 0

	)

94 #ifde‡
__PTHREAD_MUTEX_HAVE_PREV


95 
	#PTHREAD_MUTEX_INITIALIZER
 \

96 { { 0, 0, 0, 0, 0, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

97 #ifde‡
__USE_GNU


98 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

99 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

100 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

101 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

102 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

103 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

104 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

105 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

109 
	#PTHREAD_MUTEX_INITIALIZER
 \

110 { { 0, 0, 0, 0, 0, { 
__PTHREAD_SPINS
 } } }

	)

111 #ifde‡
__USE_GNU


112 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

113 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

114 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

115 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

116 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

117 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

124 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


127 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

128 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

129 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

130 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


136 #i‚de‡
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


137 #i‡
__WORDSIZE
 == 64

138 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

143 
	#PTHREAD_RWLOCK_INITIALIZER
 \

144 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 } }

	)

145 #ifde‡
__USE_GNU


146 #ifde‡
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


147 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

149 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

151 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


152 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

153 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

154 0, 0, 0, 0 } }

	)

156 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

157 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

158 0 } }

	)

168 
	mPTHREAD_INHERIT_SCHED
,

169 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

170 
	mPTHREAD_EXPLICIT_SCHED


171 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

178 
	mPTHREAD_SCOPE_SYSTEM
,

179 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

180 
	mPTHREAD_SCOPE_PROCESS


181 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

188 
	mPTHREAD_PROCESS_PRIVATE
,

189 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

190 
	mPTHREAD_PROCESS_SHARED


191 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

197 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*Ë0, 0, 0 } }

	)

201 
	s_±hªad_˛ónup_buf„r


203 (*
	m__routöe
) (*);

204 *
	m__¨g
;

205 
	m__ˇn˚…y≥
;

206 
_±hªad_˛ónup_buf„r
 *
	m__¥ev
;

212 
	mPTHREAD_CANCEL_ENABLE
,

213 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

214 
	mPTHREAD_CANCEL_DISABLE


215 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

219 
	mPTHREAD_CANCEL_DEFERRED
,

220 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

221 
	mPTHREAD_CANCEL_ASYNCHRONOUS


222 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

224 
	#PTHREAD_CANCELED
 ((*Ë-1)

	)

228 
	#PTHREAD_ONCE_INIT
 0

	)

231 #ifde‡
__USE_XOPEN2K


235 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

239 
__BEGIN_DECLS


244 
±hªad_¸óã
 (
±hªad_t
 *
__ª°ri˘
 
__√wthªad
,

245 c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

246 *(*
__°¨t_routöe
) (*),

247 *
__ª°ri˘
 
__¨g
Ë
__THROWNL
 
__n⁄nuŒ
 ((1, 3));

253 
	$±hªad_exô
 (*
__ªtvÆ
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

261 
	`±hªad_joö
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
);

263 #ifde‡
__USE_GNU


266 
	$±hªad_åyjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
Ë
__THROW
;

274 
	`±hªad_timedjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
,

275 c⁄° 
time•ec
 *
__ab°ime
);

282 
	$±hªad_dëach
 (
±hªad_t
 
__th
Ë
__THROW
;

286 
±hªad_t
 
	$±hªad_£lf
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

289 
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
)

290 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

298 
	$±hªad_©å_öô
 (
±hªad_©å_t
 *
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

301 
	$±hªad_©å_de°roy
 (
±hªad_©å_t
 *
__©å
)

302 
__THROW
 
	`__n⁄nuŒ
 ((1));

305 
	$±hªad_©å_gëdëach°©e
 (c⁄° 
±hªad_©å_t
 *
__©å
,

306 *
__dëach°©e
)

307 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

310 
	$±hªad_©å_£tdëach°©e
 (
±hªad_©å_t
 *
__©å
,

311 
__dëach°©e
)

312 
__THROW
 
	`__n⁄nuŒ
 ((1));

316 
	$±hªad_©å_gëgu¨dsize
 (c⁄° 
±hªad_©å_t
 *
__©å
,

317 
size_t
 *
__gu¨dsize
)

318 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

321 
	$±hªad_©å_£tgu¨dsize
 (
±hªad_©å_t
 *
__©å
,

322 
size_t
 
__gu¨dsize
)

323 
__THROW
 
	`__n⁄nuŒ
 ((1));

327 
	$±hªad_©å_gësched∑øm
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

328 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

329 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

332 
	$±hªad_©å_£tsched∑øm
 (
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

333 c⁄° 
sched_∑øm
 *
__ª°ri˘


334 
__∑øm
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

337 
	$±hªad_©å_gëschedpﬁicy
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


338 
__©å
, *
__ª°ri˘
 
__pﬁicy
)

339 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

342 
	$±hªad_©å_£tschedpﬁicy
 (
±hªad_©å_t
 *
__©å
, 
__pﬁicy
)

343 
__THROW
 
	`__n⁄nuŒ
 ((1));

346 
	$±hªad_©å_gëöhîôsched
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


347 
__©å
, *
__ª°ri˘
 
__öhîô
)

348 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

351 
	$±hªad_©å_£töhîôsched
 (
±hªad_©å_t
 *
__©å
,

352 
__öhîô
)

353 
__THROW
 
	`__n⁄nuŒ
 ((1));

357 
	$±hªad_©å_gësc›e
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

358 *
__ª°ri˘
 
__sc›e
)

359 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

362 
	$±hªad_©å_£tsc›e
 (
±hªad_©å_t
 *
__©å
, 
__sc›e
)

363 
__THROW
 
	`__n⁄nuŒ
 ((1));

366 
	$±hªad_©å_gë°ackaddr
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


367 
__©å
, **
__ª°ri˘
 
__°ackaddr
)

368 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__©åibuã_dïªˇãd__
;

374 
	$±hªad_©å_£t°ackaddr
 (
±hªad_©å_t
 *
__©å
,

375 *
__°ackaddr
)

376 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
;

379 
	$±hªad_©å_gë°acksize
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


380 
__©å
, 
size_t
 *
__ª°ri˘
 
__°acksize
)

381 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

386 
	$±hªad_©å_£t°acksize
 (
±hªad_©å_t
 *
__©å
,

387 
size_t
 
__°acksize
)

388 
__THROW
 
	`__n⁄nuŒ
 ((1));

390 #ifde‡
__USE_XOPEN2K


392 
	$±hªad_©å_gë°ack
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

393 **
__ª°ri˘
 
__°ackaddr
,

394 
size_t
 *
__ª°ri˘
 
__°acksize
)

395 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

400 
	$±hªad_©å_£t°ack
 (
±hªad_©å_t
 *
__©å
, *
__°ackaddr
,

401 
size_t
 
__°acksize
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

404 #ifde‡
__USE_GNU


407 
	$±hªad_©å_£èfföôy_≈
 (
±hªad_©å_t
 *
__©å
,

408 
size_t
 
__˝u£tsize
,

409 c⁄° 
˝u_£t_t
 *
__˝u£t
)

410 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

414 
	$±hªad_©å_gëafföôy_≈
 (c⁄° 
±hªad_©å_t
 *
__©å
,

415 
size_t
 
__˝u£tsize
,

416 
˝u_£t_t
 *
__˝u£t
)

417 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

420 
	$±hªad_gë©å_deÁu…_≈
 (
±hªad_©å_t
 *
__©å
)

421 
__THROW
 
	`__n⁄nuŒ
 ((1));

425 
	$±hªad_£èâr_deÁu…_≈
 (c⁄° 
±hªad_©å_t
 *
__©å
)

426 
__THROW
 
	`__n⁄nuŒ
 ((1));

431 
	$±hªad_gë©å_≈
 (
±hªad_t
 
__th
, 
±hªad_©å_t
 *
__©å
)

432 
__THROW
 
	`__n⁄nuŒ
 ((2));

440 
	$±hªad_£tsched∑øm
 (
±hªad_t
 
__èrgë_thªad
, 
__pﬁicy
,

441 c⁄° 
sched_∑øm
 *
__∑øm
)

442 
__THROW
 
	`__n⁄nuŒ
 ((3));

445 
	$±hªad_gësched∑øm
 (
±hªad_t
 
__èrgë_thªad
,

446 *
__ª°ri˘
 
__pﬁicy
,

447 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

448 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

451 
	$±hªad_£tsched¥io
 (
±hªad_t
 
__èrgë_thªad
, 
__¥io
)

452 
__THROW
;

455 #ifde‡
__USE_GNU


457 
	$±hªad_gë«me_≈
 (
±hªad_t
 
__èrgë_thªad
, *
__buf
,

458 
size_t
 
__buÊí
)

459 
__THROW
 
	`__n⁄nuŒ
 ((2));

462 
	$±hªad_£äame_≈
 (
±hªad_t
 
__èrgë_thªad
, c⁄° *
__«me
)

463 
__THROW
 
	`__n⁄nuŒ
 ((2));

467 #ifde‡
__USE_UNIX98


469 
	$±hªad_gëc⁄cuºícy
 (Ë
__THROW
;

472 
	$±hªad_£tc⁄cuºícy
 (
__Àvñ
Ë
__THROW
;

475 #ifde‡
__USE_GNU


480 
	$±hªad_yõld
 (Ë
__THROW
;

485 
	$±hªad_£èfföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

486 c⁄° 
˝u_£t_t
 *
__˝u£t
)

487 
__THROW
 
	`__n⁄nuŒ
 ((3));

490 
	$±hªad_gëafföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

491 
˝u_£t_t
 *
__˝u£t
)

492 
__THROW
 
	`__n⁄nuŒ
 ((3));

505 
	`±hªad_⁄˚
 (
±hªad_⁄˚_t
 *
__⁄˚_c⁄åﬁ
,

506 (*
__öô_routöe
Ë()Ë
	`__n⁄nuŒ
 ((1, 2));

517 
	`±hªad_£tˇn˚l°©e
 (
__°©e
, *
__ﬁd°©e
);

521 
	`±hªad_£tˇn˚…y≥
 (
__ty≥
, *
__ﬁdty≥
);

524 
	`±hªad_ˇn˚l
 (
±hªad_t
 
__th
);

529 
	`±hªad_ã°ˇn˚l
 ();

538 
__jmp_buf
 
__ˇn˚l_jmp_buf
;

539 
__mask_was_ßved
;

540 } 
__ˇn˚l_jmp_buf
[1];

541 *
__∑d
[4];

542 } 
	t__±hªad_unwöd_buf_t
 
	t__©åibuã__
 ((
	t__Æig√d__
));

545 #i‚de‡
__˛ónup_f˘_©åibuã


546 
	#__˛ónup_f˘_©åibuã


	)

551 
	s__±hªad_˛ónup_‰ame


553 (*
__ˇn˚l_routöe
) (*);

554 *
__ˇn˚l_¨g
;

555 
__do_ô
;

556 
__ˇn˚l_ty≥
;

559 #i‡
deföed
 
__GNUC__
 && deföed 
__EXCEPTIONS


560 #ifde‡
__˝lu•lus


562 ˛as†
	c__±hªad_˛ónup_˛ass


564 (*
__ˇn˚l_routöe
) (*);

565 *
__ˇn˚l_¨g
;

566 
__do_ô
;

567 
__ˇn˚l_ty≥
;

569 
public
:

570 
	`__±hªad_˛ónup_˛ass
 ((*
__f˘
Ë(*), *
__¨g
)

571 : 
	`__ˇn˚l_routöe
 (
__f˘
), 
	`__ˇn˚l_¨g
 (
__¨g
), 
	$__do_ô
 (1) { }

572 ~
	$__±hªad_˛ónup_˛ass
 (Ë{ i‡(
__do_ô
Ë
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); 
	}
}

573 
	$__£tdoô
 (
__√wvÆ
Ë{ 
__do_ô
 = __√wvÆ; 
	}
}

574 
	$__de„r
 (Ë{ 
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
,

575 &
__ˇn˚l_ty≥
); 
	}
}

576 
	$__ª°‹e
 (Ëc⁄° { 
	`±hªad_£tˇn˚…y≥
 (
__ˇn˚l_ty≥
, 0); 
	}
}

586 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

588 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
)

	)

592 
	#±hªad_˛ónup_p›
(
execuã
) \

593 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

594 } 0)

	)

596 #ifde‡
__USE_GNU


600 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

602 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
); \

603 
__˛‰ame
.
	`__de„r
 ()

	)

608 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

609 
__˛‰ame
.
	`__ª°‹e
 (); \

610 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

611 } 0)

	)

618 
__exã∫_ölöe
 

619 
	$__±hªad_˛ónup_routöe
 (
__±hªad_˛ónup_‰ame
 *
__‰ame
)

621 i‡(
__‰ame
->
__do_ô
)

622 
__‰ame
->
	`__ˇn˚l_routöe
 (__‰ame->
__ˇn˚l_¨g
);

623 
	}
}

632 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

634 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

635 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

636 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

637 .
__do_ô
 = 1 };

	)

641 
	#±hªad_˛ónup_p›
(
execuã
) \

642 
__˛‰ame
.
__do_ô
 = (
execuã
); \

643 } 0)

	)

645 #ifde‡
__USE_GNU


649 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

651 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

652 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

653 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

654 .
__do_ô
 = 1 }; \

655 (Ë
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
, \

656 &
__˛‰ame
.
__ˇn˚l_ty≥
)

	)

661 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

662 (Ë
	`±hªad_£tˇn˚…y≥
 (
__˛‰ame
.
__ˇn˚l_ty≥
, 
NULL
); \

663 
__˛‰ame
.
__do_ô
 = (
execuã
); \

664 } 0)

	)

675 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

677 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

678 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

679 *
__ˇn˚l_¨g
 = (
¨g
); \

680 
__nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

681 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

682 i‡(
	`__glibc_u∆ikñy
 (
__nŸ_fú°_ˇŒ
)) \

684 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

685 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

689 
	`__±hªad_ªgi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

690 dÿ{

	)

691 
__±hªad_ªgi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

692 
__˛ónup_f˘_©åibuã
;

696 
	#±hªad_˛ónup_p›
(
execuã
) \

699 
	`__±hªad_uƒegi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

700 i‡(
execuã
) \

701 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

702 } 0)

	)

703 
	$__±hªad_uƒegi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

704 
__˛ónup_f˘_©åibuã
;

706 #ifde‡
__USE_GNU


710 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

712 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

713 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

714 *
__ˇn˚l_¨g
 = (
¨g
); \

715 
__nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

716 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

717 i‡(
	`__glibc_u∆ikñy
 (
__nŸ_fú°_ˇŒ
)) \

719 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

720 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

724 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (&
__ˇn˚l_buf
); \

725 dÿ{

	)

726 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (
__±hªad_unwöd_buf_t
 *
__buf
)

727 
__˛ónup_f˘_©åibuã
;

732 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

735 
	`__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (&
__ˇn˚l_buf
); \

736 i‡(
execuã
) \

737 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

738 
	}
} 0)

	)

739 
	$__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (
__±hªad_unwöd_buf_t
 *
__buf
)

740 
__˛ónup_f˘_©åibuã
;

744 
	$__±hªad_unwöd_√xt
 (
__±hªad_unwöd_buf_t
 *
__buf
)

745 
__˛ónup_f˘_©åibuã
 
	`__©åibuã__
 ((
__n‹ëu∫__
))

746 #i‚de‡
SHARED


747 
	`__©åibuã__
 ((
__wók__
))

753 
__jmp_buf_èg
;

754 
	$__sig£tjmp
 (
__jmp_buf_èg
 *
__ív
, 
__ßvemask
Ë
__THROWNL
;

760 
	$±hªad_muãx_öô
 (
±hªad_muãx_t
 *
__muãx
,

761 c⁄° 
±hªad_muãx©å_t
 *
__muãx©å
)

762 
__THROW
 
	`__n⁄nuŒ
 ((1));

765 
	$±hªad_muãx_de°roy
 (
±hªad_muãx_t
 *
__muãx
)

766 
__THROW
 
	`__n⁄nuŒ
 ((1));

769 
	$±hªad_muãx_åylock
 (
±hªad_muãx_t
 *
__muãx
)

770 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

773 
	$±hªad_muãx_lock
 (
±hªad_muãx_t
 *
__muãx
)

774 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

776 #ifde‡
__USE_XOPEN2K


778 
	$±hªad_muãx_timedlock
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

779 c⁄° 
time•ec
 *
__ª°ri˘


780 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

784 
	$±hªad_muãx_u∆ock
 (
±hªad_muãx_t
 *
__muãx
)

785 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

789 
	$±hªad_muãx_gë¥io˚ûög
 (c⁄° 
±hªad_muãx_t
 *

790 
__ª°ri˘
 
__muãx
,

791 *
__ª°ri˘
 
__¥io˚ûög
)

792 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

796 
	$±hªad_muãx_£çrio˚ûög
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

797 
__¥io˚ûög
,

798 *
__ª°ri˘
 
__ﬁd_˚ûög
)

799 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

802 #ifde‡
__USE_XOPEN2K8


804 
	$±hªad_muãx_c⁄si°ít
 (
±hªad_muãx_t
 *
__muãx
)

805 
__THROW
 
	`__n⁄nuŒ
 ((1));

806 #ifde‡
__USE_GNU


807 
	$±hªad_muãx_c⁄si°ít_≈
 (
±hªad_muãx_t
 *
__muãx
)

808 
__THROW
 
	`__n⁄nuŒ
 ((1));

817 
	$±hªad_muãx©å_öô
 (
±hªad_muãx©å_t
 *
__©å
)

818 
__THROW
 
	`__n⁄nuŒ
 ((1));

821 
	$±hªad_muãx©å_de°roy
 (
±hªad_muãx©å_t
 *
__©å
)

822 
__THROW
 
	`__n⁄nuŒ
 ((1));

825 
	$±hªad_muãx©å_gëpsh¨ed
 (c⁄° 
±hªad_muãx©å_t
 *

826 
__ª°ri˘
 
__©å
,

827 *
__ª°ri˘
 
__psh¨ed
)

828 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

831 
	$±hªad_muãx©å_£çsh¨ed
 (
±hªad_muãx©å_t
 *
__©å
,

832 
__psh¨ed
)

833 
__THROW
 
	`__n⁄nuŒ
 ((1));

835 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


837 
	$±hªad_muãx©å_gëty≥
 (c⁄° 
±hªad_muãx©å_t
 *
__ª°ri˘


838 
__©å
, *
__ª°ri˘
 
__köd
)

839 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

844 
	$±hªad_muãx©å_£ây≥
 (
±hªad_muãx©å_t
 *
__©å
, 
__köd
)

845 
__THROW
 
	`__n⁄nuŒ
 ((1));

849 
	$±hªad_muãx©å_gë¥Ÿocﬁ
 (c⁄° 
±hªad_muãx©å_t
 *

850 
__ª°ri˘
 
__©å
,

851 *
__ª°ri˘
 
__¥Ÿocﬁ
)

852 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

856 
	$±hªad_muãx©å_£çrŸocﬁ
 (
±hªad_muãx©å_t
 *
__©å
,

857 
__¥Ÿocﬁ
)

858 
__THROW
 
	`__n⁄nuŒ
 ((1));

861 
	$±hªad_muãx©å_gë¥io˚ûög
 (c⁄° 
±hªad_muãx©å_t
 *

862 
__ª°ri˘
 
__©å
,

863 *
__ª°ri˘
 
__¥io˚ûög
)

864 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

867 
	$±hªad_muãx©å_£çrio˚ûög
 (
±hªad_muãx©å_t
 *
__©å
,

868 
__¥io˚ûög
)

869 
__THROW
 
	`__n⁄nuŒ
 ((1));

871 #ifde‡
__USE_XOPEN2K


873 
	$±hªad_muãx©å_gërobu°
 (c⁄° 
±hªad_muãx©å_t
 *
__©å
,

874 *
__robu°√ss
)

875 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

876 #ifde‡
__USE_GNU


877 
	$±hªad_muãx©å_gërobu°_≈
 (c⁄° 
±hªad_muãx©å_t
 *
__©å
,

878 *
__robu°√ss
)

879 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

883 
	$±hªad_muãx©å_£åobu°
 (
±hªad_muãx©å_t
 *
__©å
,

884 
__robu°√ss
)

885 
__THROW
 
	`__n⁄nuŒ
 ((1));

886 #ifde‡
__USE_GNU


887 
	$±hªad_muãx©å_£åobu°_≈
 (
±hªad_muãx©å_t
 *
__©å
,

888 
__robu°√ss
)

889 
__THROW
 
	`__n⁄nuŒ
 ((1));

894 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


899 
	$±hªad_rwlock_öô
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

900 c⁄° 
±hªad_rwlock©å_t
 *
__ª°ri˘


901 
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

904 
	$±hªad_rwlock_de°roy
 (
±hªad_rwlock_t
 *
__rwlock
)

905 
__THROW
 
	`__n⁄nuŒ
 ((1));

908 
	$±hªad_rwlock_rdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

909 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

912 
	$±hªad_rwlock_åyrdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

913 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

915 #ifde‡
__USE_XOPEN2K


917 
	$±hªad_rwlock_timedrdlock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

918 c⁄° 
time•ec
 *
__ª°ri˘


919 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

923 
	$±hªad_rwlock_wæock
 (
±hªad_rwlock_t
 *
__rwlock
)

924 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

927 
	$±hªad_rwlock_åywæock
 (
±hªad_rwlock_t
 *
__rwlock
)

928 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

930 #ifde‡
__USE_XOPEN2K


932 
	$±hªad_rwlock_timedwæock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

933 c⁄° 
time•ec
 *
__ª°ri˘


934 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

938 
	$±hªad_rwlock_u∆ock
 (
±hªad_rwlock_t
 *
__rwlock
)

939 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

945 
	$±hªad_rwlock©å_öô
 (
±hªad_rwlock©å_t
 *
__©å
)

946 
__THROW
 
	`__n⁄nuŒ
 ((1));

949 
	$±hªad_rwlock©å_de°roy
 (
±hªad_rwlock©å_t
 *
__©å
)

950 
__THROW
 
	`__n⁄nuŒ
 ((1));

953 
	$±hªad_rwlock©å_gëpsh¨ed
 (c⁄° 
±hªad_rwlock©å_t
 *

954 
__ª°ri˘
 
__©å
,

955 *
__ª°ri˘
 
__psh¨ed
)

956 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

959 
	$±hªad_rwlock©å_£çsh¨ed
 (
±hªad_rwlock©å_t
 *
__©å
,

960 
__psh¨ed
)

961 
__THROW
 
	`__n⁄nuŒ
 ((1));

964 
	$±hªad_rwlock©å_gëköd_≈
 (c⁄° 
±hªad_rwlock©å_t
 *

965 
__ª°ri˘
 
__©å
,

966 *
__ª°ri˘
 
__¥ef
)

967 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

970 
	$±hªad_rwlock©å_£tköd_≈
 (
±hªad_rwlock©å_t
 *
__©å
,

971 
__¥ef
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

979 
	$±hªad_c⁄d_öô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

980 c⁄° 
±hªad_c⁄d©å_t
 *
__ª°ri˘
 
__c⁄d_©å
)

981 
__THROW
 
	`__n⁄nuŒ
 ((1));

984 
	$±hªad_c⁄d_de°roy
 (
±hªad_c⁄d_t
 *
__c⁄d
)

985 
__THROW
 
	`__n⁄nuŒ
 ((1));

988 
	$±hªad_c⁄d_sig«l
 (
±hªad_c⁄d_t
 *
__c⁄d
)

989 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

992 
	$±hªad_c⁄d_brﬂdˇ°
 (
±hªad_c⁄d_t
 *
__c⁄d
)

993 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1000 
	$±hªad_c⁄d_waô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

1001 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
)

1002 
	`__n⁄nuŒ
 ((1, 2));

1011 
	$±hªad_c⁄d_timedwaô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

1012 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

1013 c⁄° 
time•ec
 *
__ª°ri˘
 
__ab°ime
)

1014 
	`__n⁄nuŒ
 ((1, 2, 3));

1019 
	$±hªad_c⁄d©å_öô
 (
±hªad_c⁄d©å_t
 *
__©å
)

1020 
__THROW
 
	`__n⁄nuŒ
 ((1));

1023 
	$±hªad_c⁄d©å_de°roy
 (
±hªad_c⁄d©å_t
 *
__©å
)

1024 
__THROW
 
	`__n⁄nuŒ
 ((1));

1027 
	$±hªad_c⁄d©å_gëpsh¨ed
 (c⁄° 
±hªad_c⁄d©å_t
 *

1028 
__ª°ri˘
 
__©å
,

1029 *
__ª°ri˘
 
__psh¨ed
)

1030 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1033 
	$±hªad_c⁄d©å_£çsh¨ed
 (
±hªad_c⁄d©å_t
 *
__©å
,

1034 
__psh¨ed
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

1036 #ifde‡
__USE_XOPEN2K


1038 
	$±hªad_c⁄d©å_gë˛ock
 (c⁄° 
±hªad_c⁄d©å_t
 *

1039 
__ª°ri˘
 
__©å
,

1040 
__˛ockid_t
 *
__ª°ri˘
 
__˛ock_id
)

1041 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1044 
	$±hªad_c⁄d©å_£t˛ock
 (
±hªad_c⁄d©å_t
 *
__©å
,

1045 
__˛ockid_t
 
__˛ock_id
)

1046 
__THROW
 
	`__n⁄nuŒ
 ((1));

1050 #ifde‡
__USE_XOPEN2K


1055 
	$±hªad_•ö_öô
 (
±hªad_•ölock_t
 *
__lock
, 
__psh¨ed
)

1056 
__THROW
 
	`__n⁄nuŒ
 ((1));

1059 
	$±hªad_•ö_de°roy
 (
±hªad_•ölock_t
 *
__lock
)

1060 
__THROW
 
	`__n⁄nuŒ
 ((1));

1063 
	$±hªad_•ö_lock
 (
±hªad_•ölock_t
 *
__lock
)

1064 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1067 
	$±hªad_•ö_åylock
 (
±hªad_•ölock_t
 *
__lock
)

1068 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1071 
	$±hªad_•ö_u∆ock
 (
±hªad_•ölock_t
 *
__lock
)

1072 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1079 
	$±hªad_b¨rõr_öô
 (
±hªad_b¨rõr_t
 *
__ª°ri˘
 
__b¨rõr
,

1080 c⁄° 
±hªad_b¨rõøâr_t
 *
__ª°ri˘


1081 
__©å
, 
__cou¡
)

1082 
__THROW
 
	`__n⁄nuŒ
 ((1));

1085 
	$±hªad_b¨rõr_de°roy
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1086 
__THROW
 
	`__n⁄nuŒ
 ((1));

1089 
	$±hªad_b¨rõr_waô
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1090 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1094 
	$±hªad_b¨rõøâr_öô
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1095 
__THROW
 
	`__n⁄nuŒ
 ((1));

1098 
	$±hªad_b¨rõøâr_de°roy
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1099 
__THROW
 
	`__n⁄nuŒ
 ((1));

1102 
	$±hªad_b¨rõøâr_gëpsh¨ed
 (c⁄° 
±hªad_b¨rõøâr_t
 *

1103 
__ª°ri˘
 
__©å
,

1104 *
__ª°ri˘
 
__psh¨ed
)

1105 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1108 
	$±hªad_b¨rõøâr_£çsh¨ed
 (
±hªad_b¨rõøâr_t
 *
__©å
,

1109 
__psh¨ed
)

1110 
__THROW
 
	`__n⁄nuŒ
 ((1));

1122 
	`±hªad_key_¸óã
 (
±hªad_key_t
 *
__key
,

1123 (*
__de°r_fun˘i⁄
) (*))

1124 
__THROW
 
	`__n⁄nuŒ
 ((1));

1127 
	$±hªad_key_dñëe
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1130 *
	$±hªad_gë•ecific
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1133 
	$±hªad_£t•ecific
 (
±hªad_key_t
 
__key
,

1134 c⁄° *
__poöãr
Ë
__THROW
 ;

1137 #ifde‡
__USE_XOPEN2K


1139 
	$±hªad_gë˝u˛ockid
 (
±hªad_t
 
__thªad_id
,

1140 
__˛ockid_t
 *
__˛ock_id
)

1141 
__THROW
 
	`__n⁄nuŒ
 ((2));

1156 
	`±hªad_©f‹k
 ((*
__¥ï¨e
) (),

1157 (*
__∑ª¡
) (),

1158 (*
__chûd
Ë()Ë
__THROW
;

1161 #ifde‡
__USE_EXTERN_INLINES


1163 
__exã∫_ölöe
 

1164 
	`__NTH
 (
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
))

1166  
__thªad1
 =
__thªad2
;

1167 
	}
}

1170 
	g__END_DECLS


	@/usr/include/pwd.h

22 #i‚def 
_PWD_H


23 
	#_PWD_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


29 
	~<bôs/ty≥s.h
>

31 
	#__√ed_size_t


	)

32 
	~<°ddef.h
>

34 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


37 #i‚de‡
__gid_t_deföed


38 
__gid_t
 
	tgid_t
;

39 
	#__gid_t_deföed


	)

42 #i‚de‡
__uid_t_deföed


43 
__uid_t
 
	tuid_t
;

44 
	#__uid_t_deföed


	)

49 
	s∑sswd


51 *
	mpw_«me
;

52 *
	mpw_∑sswd
;

53 
__uid_t
 
	mpw_uid
;

54 
__gid_t
 
	mpw_gid
;

55 *
	mpw_gecos
;

56 *
	mpw_dú
;

57 *
	mpw_shñl
;

61 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_GNU


62 
	#__√ed_FILE


	)

63 
	~<°dio.h
>

67 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


72 
£çwít
 ();

78 
ídpwít
 ();

84 
∑sswd
 *
gëpwít
 ();

87 #ifdef 
__USE_SVID


94 
∑sswd
 *
fgëpwít
 (
FILE
 *
__°ªam
);

102 
puçwít
 (c⁄° 
∑sswd
 *
__ª°ri˘
 
__p
,

103 
FILE
 *
__ª°ri˘
 
__f
);

110 
∑sswd
 *
gëpwuid
 (
__uid_t
 
__uid
);

116 
∑sswd
 *
gëpw«m
 (c⁄° *
__«me
);

118 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


120 #ifde‡
__USE_MISC


123 
	#NSS_BUFLEN_PASSWD
 1024

	)

134 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC


139 
gëpwít_r
 (
∑sswd
 *
__ª°ri˘
 
__ªsu…buf
,

140 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
,

141 
∑sswd
 **
__ª°ri˘
 
__ªsu…
);

144 
gëpwuid_r
 (
__uid_t
 
__uid
,

145 
∑sswd
 *
__ª°ri˘
 
__ªsu…buf
,

146 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
,

147 
∑sswd
 **
__ª°ri˘
 
__ªsu…
);

149 
gëpw«m_r
 (c⁄° *
__ª°ri˘
 
__«me
,

150 
∑sswd
 *
__ª°ri˘
 
__ªsu…buf
,

151 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
,

152 
∑sswd
 **
__ª°ri˘
 
__ªsu…
);

155 #ifdef 
__USE_SVID


163 
fgëpwít_r
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

164 
∑sswd
 *
__ª°ri˘
 
__ªsu…buf
,

165 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
,

166 
∑sswd
 **
__ª°ri˘
 
__ªsu…
);

171 #ifde‡
__USE_GNU


180 
gëpw
 (
__uid_t
 
__uid
, *
__buf„r
);

183 
	g__END_DECLS


	@/usr/include/setjmp.h

22 #i‚def 
_SETJMP_H


23 
	#_SETJMP_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


29 
	~<bôs/£tjmp.h
>

30 
	~<bôs/sig£t.h
>

34 
	s__jmp_buf_èg


40 
__jmp_buf
 
	m__jmpbuf
;

41 
	m__mask_was_ßved
;

42 
__sig£t_t
 
	m__ßved_mask
;

46 
__BEGIN_NAMESPACE_STD


48 
__jmp_buf_èg
 
	tjmp_buf
[1];

52 
	$£tjmp
 (
jmp_buf
 
__ív
Ë
__THROWNL
;

54 
__END_NAMESPACE_STD


59 
	$__sig£tjmp
 (
__jmp_buf_èg
 
__ív
[1], 
__ßvemask
Ë
__THROWNL
;

63 
	$_£tjmp
 (
__jmp_buf_èg
 
__ív
[1]Ë
__THROWNL
;

67 
	#£tjmp
(
ív
Ë
	`_£tjmp
 (ív)

	)

70 
__BEGIN_NAMESPACE_STD


74 
	$l⁄gjmp
 (
__jmp_buf_èg
 
__ív
[1], 
__vÆ
)

75 
__THROWNL
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

77 
__END_NAMESPACE_STD


79 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN


83 
	$_l⁄gjmp
 (
__jmp_buf_èg
 
__ív
[1], 
__vÆ
)

84 
__THROWNL
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

88 #ifdef 
__USE_POSIX


92 
__jmp_buf_èg
 
	tsigjmp_buf
[1];

96 
	#sig£tjmp
(
ív
, 
ßvemask
Ë
	`__sig£tjmp
 (ív, savemask)

	)

102 
	$sigl⁄gjmp
 (
sigjmp_buf
 
__ív
, 
__vÆ
)

103 
__THROWNL
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

108 #i‡
__USE_FORTIFY_LEVEL
 > 0

109 
	~<bôs/£tjmp2.h
>

112 
__END_DECLS


	@/usr/include/signal.h

22 #i‚def 
_SIGNAL_H


24 #i‡!
deföed
 
__√ed_sig_©omic_t
 && !deföed 
__√ed_sig£t_t


25 
	#_SIGNAL_H


	)

28 
	~<„©uªs.h
>

30 
	g__BEGIN_DECLS


32 
	~<bôs/sig£t.h
>

36 #i‡
deföed
 
__√ed_sig_©omic_t
 || deföed 
_SIGNAL_H


37 #i‚de‡
__sig_©omic_t_deföed


38 
	#__sig_©omic_t_deföed


	)

39 
__BEGIN_NAMESPACE_STD


40 
__sig_©omic_t
 
	tsig_©omic_t
;

41 
	g__END_NAMESPACE_STD


43 #unde‡
__√ed_sig_©omic_t


46 #i‡
deföed
 
__√ed_sig£t_t
 || (deföed 
_SIGNAL_H
 && deföed 
__USE_POSIX
)

47 #i‚de‡
__sig£t_t_deföed


48 
	#__sig£t_t_deföed


	)

49 
__sig£t_t
 
	tsig£t_t
;

51 #unde‡
__√ed_sig£t_t


54 #ifde‡
_SIGNAL_H


56 
	~<bôs/ty≥s.h
>

57 
	~<bôs/signum.h
>

59 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


60 #i‚de‡
__pid_t_deföed


61 
__pid_t
 
	tpid_t
;

62 
	#__pid_t_deföed


	)

64 #ifde‡
__USE_XOPEN


66 #i‚de‡
__uid_t_deföed


67 
__uid_t
 
	tuid_t
;

68 
	#__uid_t_deföed


	)

72 #ifde‡
__USE_POSIX199309


74 
	#__√ed_time•ec


	)

75 
	~<time.h
>

78 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_XOPEN_EXTENDED


80 
	~<bôs/sigöfo.h
>

85 (*
	t__sigh™dÀr_t
) ();

90 
__sigh™dÀr_t
 
	$__sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

91 
__THROW
;

92 #ifde‡
__USE_GNU


93 
__sigh™dÀr_t
 
	$sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

94 
__THROW
;

100 
__BEGIN_NAMESPACE_STD


101 #ifde‡
__USE_BSD


102 
__sigh™dÀr_t
 
	$sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

103 
__THROW
;

106 #ifde‡
__REDIRECT_NTH


107 
__sigh™dÀr_t
 
	`__REDIRECT_NTH
 (
sig«l
,

108 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
),

109 
__sysv_sig«l
);

111 
	#sig«l
 
__sysv_sig«l


	)

114 
__END_NAMESPACE_STD


116 #ifde‡
__USE_XOPEN


119 
__sigh™dÀr_t
 
	$bsd_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

120 
__THROW
;

126 #ifde‡
__USE_POSIX


127 
	$kûl
 (
__pid_t
 
__pid
, 
__sig
Ë
__THROW
;

130 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


134 
	$kûÕg
 (
__pid_t
 
__pgΩ
, 
__sig
Ë
__THROW
;

137 
__BEGIN_NAMESPACE_STD


139 
	$øi£
 (
__sig
Ë
__THROW
;

140 
__END_NAMESPACE_STD


142 #ifde‡
__USE_SVID


144 
__sigh™dÀr_t
 
	$ssig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

145 
__THROW
;

146 
	$gsig«l
 (
__sig
Ë
__THROW
;

149 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN2K


151 
	`psig«l
 (
__sig
, c⁄° *
__s
);

154 #ifde‡
__USE_XOPEN2K


156 
	`psigöfo
 (c⁄° 
sigöfo_t
 *
__pöfo
, c⁄° *
__s
);

167 
	`__sig∑u£
 (
__sig_‹_mask
, 
__is_sig
);

169 #ifde‡
__USE_XOPEN


170 #ifde‡
__GNUC__


171 
	$sig∑u£
 (
__sig
Ë
	`__asm__
 ("__xpg_sigpause");

174 
	#sig∑u£
(
sig
Ë
	`__sig∑u£
 ((sig), 1)

	)

179 #ifde‡
__USE_BSD


186 
	#sigmask
(
sig
Ë
	`__sigmask
(sig)

	)

189 
	$sigblock
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

192 
	$sig£tmask
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

195 
	$siggëmask
 (Ë
__THROW
 
__©åibuã_dïªˇãd__
;

199 #ifde‡
__USE_MISC


200 
	#NSIG
 
_NSIG


	)

203 #ifde‡
__USE_GNU


204 
__sigh™dÀr_t
 
	tsigh™dÀr_t
;

208 #ifde‡
__USE_BSD


209 
__sigh™dÀr_t
 
	tsig_t
;

212 #ifde‡
__USE_POSIX


215 
	$sigem±y£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

218 
	$sigfûl£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

221 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

224 
	$sigdñ£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

227 
	$sigismembî
 (c⁄° 
sig£t_t
 *
__£t
, 
__signo
)

228 
__THROW
 
	`__n⁄nuŒ
 ((1));

230 #ifde‡
__USE_GNU


232 
	$sigi£m±y£t
 (c⁄° 
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

235 
	$sig™d£t
 (
sig£t_t
 *
__£t
, c⁄° sig£t_à*
__À·
,

236 c⁄° 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

239 
	$sig‹£t
 (
sig£t_t
 *
__£t
, c⁄° sig£t_à*
__À·
,

240 c⁄° 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

245 
	~<bôs/siga˘i⁄.h
>

248 
	$sig¥ocmask
 (
__how
, c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

249 
sig£t_t
 *
__ª°ri˘
 
__o£t
Ë
__THROW
;

256 
	$sigsu•íd
 (c⁄° 
sig£t_t
 *
__£t
Ë
	`__n⁄nuŒ
 ((1));

259 
	$siga˘i⁄
 (
__sig
, c⁄° 
siga˘i⁄
 *
__ª°ri˘
 
__a˘
,

260 
siga˘i⁄
 *
__ª°ri˘
 
__ﬂ˘
Ë
__THROW
;

263 
	$sig≥ndög
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

270 
	$sigwaô
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
, *__ª°ri˘ 
__sig
)

271 
	`__n⁄nuŒ
 ((1, 2));

273 #ifde‡
__USE_POSIX199309


278 
	$sigwaôöfo
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

279 
sigöfo_t
 *
__ª°ri˘
 
__öfo
Ë
	`__n⁄nuŒ
 ((1));

286 
	$sigtimedwaô
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

287 
sigöfo_t
 *
__ª°ri˘
 
__öfo
,

288 c⁄° 
time•ec
 *
__ª°ri˘
 
__timeout
)

289 
	`__n⁄nuŒ
 ((1));

293 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, c⁄° 
sigvÆ
 
__vÆ
)

294 
__THROW
;

299 #ifde‡
__USE_BSD


303 c⁄° *c⁄° 
_sys_sigli°
[
_NSIG
];

304 c⁄° *c⁄° 
sys_sigli°
[
_NSIG
];

307 
	ssigvec


309 
__sigh™dÀr_t
 
sv_h™dÀr
;

310 
sv_mask
;

312 
sv_Êags
;

313 
	#sv_⁄°ack
 
sv_Êags


	)

317 
	#SV_ONSTACK
 (1 << 0)

	)

318 
	#SV_INTERRUPT
 (1 << 1)

	)

319 
	#SV_RESETHAND
 (1 << 2)

	)

327 
	$sigvec
 (
__sig
, c⁄° 
sigvec
 *
__vec
,

328 
sigvec
 *
__ovec
Ë
__THROW
;

332 
	~<bôs/sigc⁄ãxt.h
>

335 
	$sigªtu∫
 (
sigc⁄ãxt
 *
__s˝
Ë
__THROW
;

340 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


341 
	#__√ed_size_t


	)

342 
	~<°ddef.h
>

347 
	$sigöãºu±
 (
__sig
, 
__öãºu±
Ë
__THROW
;

349 
	~<bôs/sig°ack.h
>

350 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


352 
	~<sys/uc⁄ãxt.h
>

358 
	$sig°ack
 (
sig°ack
 *
__ss
, sig°ack *
__oss
)

359 
__THROW
 
__©åibuã_dïªˇãd__
;

363 
	$sigÆt°ack
 (c⁄° 
sigÆt°ack
 *
__ª°ri˘
 
__ss
,

364 
sigÆt°ack
 *
__ª°ri˘
 
__oss
Ë
__THROW
;

368 #ifde‡
__USE_XOPEN_EXTENDED


372 
	$sighﬁd
 (
__sig
Ë
__THROW
;

375 
	$sigªl£
 (
__sig
Ë
__THROW
;

378 
	$sigign‹e
 (
__sig
Ë
__THROW
;

381 
__sigh™dÀr_t
 
	$sig£t
 (
__sig
, 
__sigh™dÀr_t
 
__di•
Ë
__THROW
;

384 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


387 
	~<bôs/±hªadty≥s.h
>

388 
	~<bôs/sigthªad.h
>

395 
	$__libc_cuºít_sigπmö
 (Ë
__THROW
;

397 
	$__libc_cuºít_sigπmax
 (Ë
__THROW
;

401 
__END_DECLS


	@/usr/include/stdint.h

22 #i‚de‡
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	~<„©uªs.h
>

26 
	~<bôs/wch¨.h
>

27 
	~<bôs/w‹dsize.h
>

34 #i‚de‡
__öt8_t_deföed


35 
	#__öt8_t_deföed


	)

36 sig√d 
	töt8_t
;

37 
	töt16_t
;

38 
	töt32_t
;

39 #i‡
__WORDSIZE
 == 64

40 
	töt64_t
;

42 
__exãnsi⁄__


43 
	töt64_t
;

48 
	tuöt8_t
;

49 
	tuöt16_t
;

50 #i‚de‡
__uöt32_t_deföed


51 
	tuöt32_t
;

52 
	#__uöt32_t_deföed


	)

54 #i‡
__WORDSIZE
 == 64

55 
	tuöt64_t
;

57 
__exãnsi⁄__


58 
	tuöt64_t
;

65 sig√d 
	töt_Àa°8_t
;

66 
	töt_Àa°16_t
;

67 
	töt_Àa°32_t
;

68 #i‡
__WORDSIZE
 == 64

69 
	töt_Àa°64_t
;

71 
__exãnsi⁄__


72 
	töt_Àa°64_t
;

76 
	tuöt_Àa°8_t
;

77 
	tuöt_Àa°16_t
;

78 
	tuöt_Àa°32_t
;

79 #i‡
__WORDSIZE
 == 64

80 
	tuöt_Àa°64_t
;

82 
__exãnsi⁄__


83 
	tuöt_Àa°64_t
;

90 sig√d 
	töt_Á°8_t
;

91 #i‡
__WORDSIZE
 == 64

92 
	töt_Á°16_t
;

93 
	töt_Á°32_t
;

94 
	töt_Á°64_t
;

96 
	töt_Á°16_t
;

97 
	töt_Á°32_t
;

98 
__exãnsi⁄__


99 
	töt_Á°64_t
;

103 
	tuöt_Á°8_t
;

104 #i‡
__WORDSIZE
 == 64

105 
	tuöt_Á°16_t
;

106 
	tuöt_Á°32_t
;

107 
	tuöt_Á°64_t
;

109 
	tuöt_Á°16_t
;

110 
	tuöt_Á°32_t
;

111 
__exãnsi⁄__


112 
	tuöt_Á°64_t
;

117 #i‡
__WORDSIZE
 == 64

118 #i‚de‡
__öçå_t_deföed


119 
	töçå_t
;

120 
	#__öçå_t_deföed


	)

122 
	tuöçå_t
;

124 #i‚de‡
__öçå_t_deföed


125 
	töçå_t
;

126 
	#__öçå_t_deföed


	)

128 
	tuöçå_t
;

133 #i‡
__WORDSIZE
 == 64

134 
	tötmax_t
;

135 
	tuötmax_t
;

137 
__exãnsi⁄__


138 
	tötmax_t
;

139 
__exãnsi⁄__


140 
	tuötmax_t
;

144 #i‡
__WORDSIZE
 == 64

145 
	#__INT64_C
(
c
Ë¯## 
L


	)

146 
	#__UINT64_C
(
c
Ë¯## 
UL


	)

148 
	#__INT64_C
(
c
Ë¯## 
LL


	)

149 
	#__UINT64_C
(
c
Ë¯## 
ULL


	)

155 
	#INT8_MIN
 (-128)

	)

156 
	#INT16_MIN
 (-32767-1)

	)

157 
	#INT32_MIN
 (-2147483647-1)

	)

158 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

160 
	#INT8_MAX
 (127)

	)

161 
	#INT16_MAX
 (32767)

	)

162 
	#INT32_MAX
 (2147483647)

	)

163 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

166 
	#UINT8_MAX
 (255)

	)

167 
	#UINT16_MAX
 (65535)

	)

168 
	#UINT32_MAX
 (4294967295U)

	)

169 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

173 
	#INT_LEAST8_MIN
 (-128)

	)

174 
	#INT_LEAST16_MIN
 (-32767-1)

	)

175 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

176 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

178 
	#INT_LEAST8_MAX
 (127)

	)

179 
	#INT_LEAST16_MAX
 (32767)

	)

180 
	#INT_LEAST32_MAX
 (2147483647)

	)

181 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

184 
	#UINT_LEAST8_MAX
 (255)

	)

185 
	#UINT_LEAST16_MAX
 (65535)

	)

186 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

187 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

191 
	#INT_FAST8_MIN
 (-128)

	)

192 #i‡
__WORDSIZE
 == 64

193 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

194 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

196 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

197 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

199 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

201 
	#INT_FAST8_MAX
 (127)

	)

202 #i‡
__WORDSIZE
 == 64

203 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

204 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

206 
	#INT_FAST16_MAX
 (2147483647)

	)

207 
	#INT_FAST32_MAX
 (2147483647)

	)

209 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINT_FAST8_MAX
 (255)

	)

213 #i‡
__WORDSIZE
 == 64

214 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

215 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

217 
	#UINT_FAST16_MAX
 (4294967295U)

	)

218 
	#UINT_FAST32_MAX
 (4294967295U)

	)

220 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

224 #i‡
__WORDSIZE
 == 64

225 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

226 
	#INTPTR_MAX
 (9223372036854775807L)

	)

227 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

229 
	#INTPTR_MIN
 (-2147483647-1)

	)

230 
	#INTPTR_MAX
 (2147483647)

	)

231 
	#UINTPTR_MAX
 (4294967295U)

	)

236 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

238 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

241 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

247 #i‡
__WORDSIZE
 == 64

248 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

249 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

251 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

252 
	#PTRDIFF_MAX
 (2147483647)

	)

256 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

257 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

260 #i‡
__WORDSIZE
 == 64

261 
	#SIZE_MAX
 (18446744073709551615UL)

	)

263 
	#SIZE_MAX
 (4294967295U)

	)

267 #i‚de‡
WCHAR_MIN


269 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

270 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

274 
	#WINT_MIN
 (0u)

	)

275 
	#WINT_MAX
 (4294967295u)

	)

278 
	#INT8_C
(
c
Ë
	)
c

279 
	#INT16_C
(
c
Ë
	)
c

280 
	#INT32_C
(
c
Ë
	)
c

281 #i‡
__WORDSIZE
 == 64

282 
	#INT64_C
(
c
Ë¯## 
L


	)

284 
	#INT64_C
(
c
Ë¯## 
LL


	)

288 
	#UINT8_C
(
c
Ë
	)
c

289 
	#UINT16_C
(
c
Ë
	)
c

290 
	#UINT32_C
(
c
Ë¯## 
U


	)

291 #i‡
__WORDSIZE
 == 64

292 
	#UINT64_C
(
c
Ë¯## 
UL


	)

294 
	#UINT64_C
(
c
Ë¯## 
ULL


	)

298 #i‡
__WORDSIZE
 == 64

299 
	#INTMAX_C
(
c
Ë¯## 
L


	)

300 
	#UINTMAX_C
(
c
Ë¯## 
UL


	)

302 
	#INTMAX_C
(
c
Ë¯## 
LL


	)

303 
	#UINTMAX_C
(
c
Ë¯## 
ULL


	)

	@/usr/include/stdio.h

23 #i‚de‡
_STDIO_H


25 #i‡!
deföed
 
__√ed_FILE
 && !deföed 
__√ed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


31 
	#__√ed_size_t


	)

32 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

35 
	~<bôs/ty≥s.h
>

36 
	#__√ed_FILE


	)

37 
	#__√ed___FILE


	)

41 #i‡!
deföed
 
__FILE_deföed
 && deföed 
__√ed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #i‡
deföed
 
__USE_LARGEFILE64
 || deföed 
__USE_SVID
 || deföed 
__USE_POSIX
 \

51 || 
deföed
 
	g__USE_BSD
 || deföed 
	g__USE_ISOC99
 || deföed 
	g__USE_XOPEN
 \

52 || 
deföed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_deföed
 1

	)

58 #unde‡
__√ed_FILE


61 #i‡!
deföed
 
____FILE_deföed
 && deföed 
__√ed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_deföed
 1

	)

68 #unde‡
__√ed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


77 #ifde‡
__GNUC__


78 #i‚de‡
_VA_LIST_DEFINED


79 
_G_va_li°
 
	tva_li°
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<°d¨g.h
>

87 #ifde‡
__USE_XOPEN2K8


88 #i‚de‡
__off_t_deföed


89 #i‚de‡
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_deföed


	)

96 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_deföed


	)

101 #i‚de‡
__ssize_t_deföed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_deföed


	)

108 
__BEGIN_NAMESPACE_STD


109 #i‚de‡
__USE_FILE_OFFSET64


110 
_G_Âos_t
 
	tÂos_t
;

112 
_G_Âos64_t
 
	tÂos_t
;

114 
__END_NAMESPACE_STD


115 #ifde‡
__USE_LARGEFILE64


116 
_G_Âos64_t
 
	tÂos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #i‚de‡
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #i‚de‡
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifde‡
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


151 
	#P_tmpdú
 "/tmp"

	)

164 
	~<bôs/°dio_lim.h
>

168 
_IO_FILE
 *
°dö
;

169 
_IO_FILE
 *
°dout
;

170 
_IO_FILE
 *
°dîr
;

172 
	#°dö
 
°dö


	)

173 
	#°dout
 
°dout


	)

174 
	#°dîr
 
°dîr


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$ªmove
 (c⁄° *
__fûíame
Ë
__THROW
;

180 
	$ª«me
 (c⁄° *
__ﬁd
, c⁄° *
__√w
Ë
__THROW
;

181 
__END_NAMESPACE_STD


183 #ifde‡
__USE_ATFILE


185 
	$ª«mót
 (
__ﬁdfd
, c⁄° *
__ﬁd
, 
__√wfd
,

186 c⁄° *
__√w
Ë
__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #i‚de‡
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfûe
 (Ë
__wur
;

197 #ifde‡
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfûe
, (), 
tmpfûe64
Ë
__wur
;

200 
	#tmpfûe
 
tmpfûe64


	)

204 #ifde‡
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfûe64
 (Ë
__wur
;

209 *
	$tm≤am
 (*
__s
Ë
__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifde‡
__USE_MISC


215 *
	$tm≤am_r
 (*
__s
Ë
__THROW
 
__wur
;

219 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


227 *
	$ãm≤am
 (c⁄° *
__dú
, c⁄° *
__pfx
)

228 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`f˛o£
 (
FILE
 *
__°ªam
);

242 
	`fÊush
 (
FILE
 *
__°ªam
);

243 
__END_NAMESPACE_STD


245 #ifde‡
__USE_MISC


252 
	`fÊush_u∆ocked
 (
FILE
 *
__°ªam
);

255 #ifde‡
__USE_GNU


262 
	`f˛o£Æl
 ();

266 
__BEGIN_NAMESPACE_STD


267 #i‚de‡
__USE_FILE_OFFSET64


272 
FILE
 *
	$f›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

273 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

278 
FILE
 *
	$‰e›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

279 c⁄° *
__ª°ri˘
 
__modes
,

280 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

282 #ifde‡
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
f›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

284 c⁄° *
__ª°ri˘
 
__modes
), 
f›í64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
‰e›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

287 c⁄° *
__ª°ri˘
 
__modes
,

288 
FILE
 *
__ª°ri˘
 
__°ªam
), 
‰e›í64
)

289 
__wur
;

291 
	#f›í
 
f›í64


	)

292 
	#‰e›í
 
‰e›í64


	)

295 
__END_NAMESPACE_STD


296 #ifde‡
__USE_LARGEFILE64


297 
FILE
 *
	$f›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

298 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

299 
FILE
 *
	$‰e›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

300 c⁄° *
__ª°ri˘
 
__modes
,

301 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fd›í
 (
__fd
, c⁄° *
__modes
Ë
__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$f›ícookõ
 (*
__ª°ri˘
 
__magic_cookõ
,

313 c⁄° *
__ª°ri˘
 
__modes
,

314 
_IO_cookõ_io_fun˘i⁄s_t
 
__io_funcs
Ë
__THROW
 
__wur
;

317 #ifde‡
__USE_XOPEN2K8


319 
FILE
 *
	$fmem›í
 (*
__s
, 
size_t
 
__Àn
, c⁄° *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$›í_mem°ªam
 (**
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$£tbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
Ë
__THROW
;

336 
	$£tvbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

337 
__modes
, 
size_t
 
__n
Ë
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_BSD


343 
	$£tbuf„r
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

344 
size_t
 
__size
Ë
__THROW
;

347 
	$£éöebuf
 (
FILE
 *
__°ªam
Ë
__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`Ârötf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

357 c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

362 
	`¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

364 
	$•rötf
 (*
__ª°ri˘
 
__s
,

365 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROWNL
;

371 
	`vÂrötf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

372 
_G_va_li°
 
__¨g
);

377 
	`v¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
);

379 
	$v•rötf
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

380 
_G_va_li°
 
__¨g
Ë
__THROWNL
;

381 
__END_NAMESPACE_STD


383 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_ISOC99
 || deföed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

387 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

388 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 4)));

390 
	$v¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

391 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

392 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifde‡
__USE_GNU


399 
	$va•rötf
 (**
__ª°ri˘
 
__±r
, c⁄° *__ª°ri˘ 
__f
,

400 
_G_va_li°
 
__¨g
)

401 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 0))Ë
__wur
;

402 
	$__a•rötf
 (**
__ª°ri˘
 
__±r
,

403 c⁄° *
__ª°ri˘
 
__fmt
, ...)

404 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

405 
	$a•rötf
 (**
__ª°ri˘
 
__±r
,

406 c⁄° *
__ª°ri˘
 
__fmt
, ...)

407 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

410 #ifde‡
__USE_XOPEN2K8


412 
	$vd¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
,

413 
_G_va_li°
 
__¨g
)

414 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

415 
	$d¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
, ...)

416 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

426 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

431 
	$sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

433 
	$ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

434 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

436 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

437 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

438 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

439 #ifde‡
__REDIRECT


443 
	`__REDIRECT
 (
fsˇnf
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

444 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

445 
__isoc99_fsˇnf
Ë
__wur
;

446 
	`__REDIRECT
 (
sˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

447 
__isoc99_sˇnf
Ë
__wur
;

448 
	`__REDIRECT_NTH
 (
ssˇnf
, (c⁄° *
__ª°ri˘
 
__s
,

449 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

450 
__isoc99_ssˇnf
);

452 
	$__isoc99_fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

453 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

454 
	$__isoc99_sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

455 
	$__isoc99_ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

456 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

457 
	#fsˇnf
 
__isoc99_fsˇnf


	)

458 
	#sˇnf
 
__isoc99_sˇnf


	)

459 
	#ssˇnf
 
__isoc99_ssˇnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

472 
_G_va_li°
 
__¨g
)

473 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

479 
	$vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

480 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

483 
	$vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

484 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

485 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

487 #i‡!
deföed
 
__USE_GNU
 \

488 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

489 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

490 #ifde‡
__REDIRECT


494 
	`__REDIRECT
 (
vfsˇnf
,

495 (
FILE
 *
__ª°ri˘
 
__s
,

496 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
),

497 
__isoc99_vfsˇnf
)

498 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

499 
	`__REDIRECT
 (
vsˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
,

500 
_G_va_li°
 
__¨g
), 
__isoc99_vsˇnf
)

501 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

502 
	`__REDIRECT_NTH
 (
vssˇnf
,

503 (c⁄° *
__ª°ri˘
 
__s
,

504 c⁄° *
__ª°ri˘
 
__f‹m©
,

505 
_G_va_li°
 
__¨g
), 
__isoc99_vssˇnf
)

506 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

508 
	$__isoc99_vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
,

509 c⁄° *
__ª°ri˘
 
__f‹m©
,

510 
_G_va_li°
 
__¨g
Ë
__wur
;

511 
	$__isoc99_vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
,

512 
_G_va_li°
 
__¨g
Ë
__wur
;

513 
	$__isoc99_vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

514 c⁄° *
__ª°ri˘
 
__f‹m©
,

515 
_G_va_li°
 
__¨g
Ë
__THROW
;

516 
	#vfsˇnf
 
__isoc99_vfsˇnf


	)

517 
	#vsˇnf
 
__isoc99_vsˇnf


	)

518 
	#vssˇnf
 
__isoc99_vssˇnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fgëc
 (
FILE
 *
__°ªam
);

532 
	`gëc
 (
FILE
 *
__°ªam
);

538 
	`gëch¨
 ();

539 
__END_NAMESPACE_STD


543 
	#gëc
(
_Â
Ë
	`_IO_gëc
 (_Â)

	)

545 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


550 
	`gëc_u∆ocked
 (
FILE
 *
__°ªam
);

551 
	`gëch¨_u∆ocked
 ();

554 #ifde‡
__USE_MISC


561 
	`fgëc_u∆ocked
 (
FILE
 *
__°ªam
);

565 
__BEGIN_NAMESPACE_STD


573 
	`Âutc
 (
__c
, 
FILE
 *
__°ªam
);

574 
	`putc
 (
__c
, 
FILE
 *
__°ªam
);

580 
	`putch¨
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_Â
Ë
	`_IO_putc
 (_ch, _Â)

	)

587 #ifde‡
__USE_MISC


594 
	`Âutc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

597 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


602 
	`putc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

603 
	`putch¨_u∆ocked
 (
__c
);

607 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_MISC
 \

608 || (
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

610 
	`gëw
 (
FILE
 *
__°ªam
);

613 
	`putw
 (
__w
, 
FILE
 *
__°ªam
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fgës
 (*
__ª°ri˘
 
__s
, 
__n
, 
FILE
 *__ª°ri˘ 
__°ªam
)

623 
__wur
;

625 #i‡!
deföed
 
__USE_ISOC11
 \

626 || (
deföed
 
__˝lu•lus
 && __cplusplus <= 201103L)

638 *
	$gës
 (*
__s
Ë
__wur
 
__©åibuã_dïªˇãd__
;

640 
__END_NAMESPACE_STD


642 #ifde‡
__USE_GNU


649 *
	$fgës_u∆ocked
 (*
__ª°ri˘
 
__s
, 
__n
,

650 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__gëdñim
 (**
__ª°ri˘
 
__löïå
,

666 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

667 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

668 
_IO_ssize_t
 
	$gëdñim
 (**
__ª°ri˘
 
__löïå
,

669 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

670 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

678 
_IO_ssize_t
 
	$gëlöe
 (**
__ª°ri˘
 
__löïå
,

679 
size_t
 *
__ª°ri˘
 
__n
,

680 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`Âuts
 (c⁄° *
__ª°ri˘
 
__s
, 
FILE
 *__ª°ri˘ 
__°ªam
);

695 
	`puts
 (c⁄° *
__s
);

702 
	`ungëc
 (
__c
, 
FILE
 *
__°ªam
);

709 
size_t
 
	$‰ód
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

715 
size_t
 
	`fwrôe
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

716 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifde‡
__USE_GNU


726 
	`Âuts_u∆ocked
 (c⁄° *
__ª°ri˘
 
__s
,

727 
FILE
 *
__ª°ri˘
 
__°ªam
);

730 #ifde‡
__USE_MISC


737 
size_t
 
	$‰ód_u∆ocked
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

739 
size_t
 
	`fwrôe_u∆ocked
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

740 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
);

744 
__BEGIN_NAMESPACE_STD


749 
	`f£ek
 (
FILE
 *
__°ªam
, 
__off
, 
__whí˚
);

754 
	$·ñl
 (
FILE
 *
__°ªam
Ë
__wur
;

759 
	`ªwöd
 (
FILE
 *
__°ªam
);

760 
__END_NAMESPACE_STD


767 #i‡
deföed
 
__USE_LARGEFILE
 || deföed 
__USE_XOPEN2K


768 #i‚de‡
__USE_FILE_OFFSET64


773 
	`f£eko
 (
FILE
 *
__°ªam
, 
__off_t
 
__off
, 
__whí˚
);

778 
__off_t
 
	$·ñlo
 (
FILE
 *
__°ªam
Ë
__wur
;

780 #ifde‡
__REDIRECT


781 
	`__REDIRECT
 (
f£eko
,

782 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
),

783 
f£eko64
);

784 
__off64_t
 
	`__REDIRECT
 (
·ñlo
, (
FILE
 *
__°ªam
), 
·ñlo64
);

786 
	#f£eko
 
f£eko64


	)

787 
	#·ñlo
 
·ñlo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #i‚de‡
__USE_FILE_OFFSET64


798 
	`fgëpos
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos_t
 *__ª°ri˘ 
__pos
);

803 
	`f£ços
 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
);

805 #ifde‡
__REDIRECT


806 
	`__REDIRECT
 (
fgëpos
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

807 
Âos_t
 *
__ª°ri˘
 
__pos
), 
fgëpos64
);

808 
	`__REDIRECT
 (
f£ços
,

809 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
), 
f£ços64
);

811 
	#fgëpos
 
fgëpos64


	)

812 
	#f£ços
 
f£ços64


	)

815 
__END_NAMESPACE_STD


817 #ifde‡
__USE_LARGEFILE64


818 
	`f£eko64
 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
);

819 
__off64_t
 
	$·ñlo64
 (
FILE
 *
__°ªam
Ë
__wur
;

820 
	`fgëpos64
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos64_t
 *__ª°ri˘ 
__pos
);

821 
	`f£ços64
 (
FILE
 *
__°ªam
, c⁄° 
Âos64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$˛óªº
 (
FILE
 *
__°ªam
Ë
__THROW
;

828 
	$„of
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

830 
	$„º‹
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifde‡
__USE_MISC


835 
	$˛óªº_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
;

836 
	$„of_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

837 
	$„º‹_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`≥º‹
 (c⁄° *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<bôs/sys_îæi°.h
>

856 #ifdef 
__USE_POSIX


858 
	$fûío
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

861 #ifde‡
__USE_MISC


863 
	$fûío_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

867 #i‡(
deföed
 
__USE_POSIX2
 || deföed 
__USE_SVID
 || deföed 
__USE_BSD
 || \

868 
deföed
 
__USE_MISC
)

873 
FILE
 *
	$p›í
 (c⁄° *
__comm™d
, c⁄° *
__modes
Ë
__wur
;

879 
	`p˛o£
 (
FILE
 *
__°ªam
);

883 #ifdef 
__USE_POSIX


885 *
	$˘îmid
 (*
__s
Ë
__THROW
;

889 #ifde‡
__USE_XOPEN


891 *
	`cu£rid
 (*
__s
);

895 #ifdef 
__USE_GNU


896 
ob°ack
;

899 
	$ob°ack_¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

900 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

901 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

902 
	$ob°ack_v¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

903 c⁄° *
__ª°ri˘
 
__f‹m©
,

904 
_G_va_li°
 
__¨gs
)

905 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

909 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


913 
	$Êockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

917 
	$·rylockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

920 
	$fu∆ockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

923 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


927 
	#__√ed_gë›t


	)

928 
	~<gë›t.h
>

933 #ifde‡
__USE_EXTERN_INLINES


934 
	~<bôs/°dio.h
>

936 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__exã∫_Æways_ölöe


937 
	~<bôs/°dio2.h
>

939 #ifde‡
__LDBL_COMPAT


940 
	~<bôs/°dio-ldbl.h
>

943 
__END_DECLS


	@/usr/include/stdlib.h

22 #i‚def 
_STDLIB_H


24 
	~<„©uªs.h
>

27 
	#__√ed_size_t


	)

28 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


29 
	#__√ed_wch¨_t


	)

30 
	#__√ed_NULL


	)

32 
	~<°ddef.h
>

34 
	g__BEGIN_DECLS


36 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


37 
	#_STDLIB_H
 1

	)

39 #i‡(
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8
Ë&& !deföed 
_SYS_WAIT_H


41 
	~<bôs/waôÊags.h
>

42 
	~<bôs/waô°©us.h
>

44 #ifde‡
__USE_BSD


49 #i‡
deföed
 
__GNUC__
 && !deföed 
__˝lu•lus


50 
	#__WAIT_INT
(
°©us
) \

51 (
	`__exãnsi⁄__
 (((uni⁄ { 
	`__ty≥of
(
°©us
Ë
__ö
; 
__i
; }) \

52 { .
__ö
 = (
°©us
Ë}).
__i
))

	)

54 
	#__WAIT_INT
(
°©us
Ë(*(*Ë&(°©us))

	)

62 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2 || deföed 
__˝lu•lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
waô
 *
	m__u±r
;

70 *
	m__ùå
;

71 } 
	t__WAIT_STATUS
 
	t__©åibuã__
 ((
	t__å™•¨ít_uni⁄__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
°©us
Ë(°©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
°©us
Ë
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (°©us))

	)

85 
	#WTERMSIG
(
°©us
Ë
	`__WTERMSIG
 (
	`__WAIT_INT
 (°©us))

	)

86 
	#WSTOPSIG
(
°©us
Ë
	`__WSTOPSIG
 (
	`__WAIT_INT
 (°©us))

	)

87 
	#WIFEXITED
(
°©us
Ë
	`__WIFEXITED
 (
	`__WAIT_INT
 (°©us))

	)

88 
	#WIFSIGNALED
(
°©us
Ë
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (°©us))

	)

89 
	#WIFSTOPPED
(
°©us
Ë
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (°©us))

	)

90 #ifde‡
__WIFCONTINUED


91 
	#WIFCONTINUED
(
°©us
Ë
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (°©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquŸ
;

100 
	mªm
;

101 } 
	tdiv_t
;

104 #i‚de‡
__ldiv_t_deföed


107 
	mquŸ
;

108 
	mªm
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_deföed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__Œdiv_t_deföed


115 
__BEGIN_NAMESPACE_C99


117 
__exãnsi⁄__
 struct

119 
	mquŸ
;

120 
	mªm
;

121 } 
	tŒdiv_t
;

122 
	#__Œdiv_t_deföed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__˘y≥_gë_mb_cur_max
 ())

	)

139 
size_t
 
	$__˘y≥_gë_mb_cur_max
 (Ë
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (c⁄° *
__≈å
)

145 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

147 
	$©oi
 (c⁄° *
__≈å
)

148 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

150 
	$©ﬁ
 (c⁄° *
__≈å
)

151 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

152 
__END_NAMESPACE_STD


154 #i‡
deföed
 
__USE_ISOC99
 || deföed 
__USE_MISC


155 
__BEGIN_NAMESPACE_C99


157 
__exãnsi⁄__
 
	$©ﬁl
 (c⁄° *
__≈å
)

158 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$°πod
 (c⁄° *
__ª°ri˘
 
__≈å
,

165 **
__ª°ri˘
 
__íd±r
)

166 
__THROW
 
	`__n⁄nuŒ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$°πof
 (c⁄° *
__ª°ri˘
 
__≈å
,

173 **
__ª°ri˘
 
__íd±r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

175 
	$°πﬁd
 (c⁄° *
__ª°ri˘
 
__≈å
,

176 **
__ª°ri˘
 
__íd±r
)

177 
__THROW
 
	`__n⁄nuŒ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$°πﬁ
 (c⁄° *
__ª°ri˘
 
__≈å
,

184 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

185 
__THROW
 
	`__n⁄nuŒ
 ((1));

187 
	$°πoul
 (c⁄° *
__ª°ri˘
 
__≈å
,

188 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

189 
__THROW
 
	`__n⁄nuŒ
 ((1));

190 
__END_NAMESPACE_STD


192 #ifde‡
__USE_BSD


194 
__exãnsi⁄__


195 
	$°πoq
 (c⁄° *
__ª°ri˘
 
__≈å
,

196 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

197 
__THROW
 
	`__n⁄nuŒ
 ((1));

199 
__exãnsi⁄__


200 
	$°πouq
 (c⁄° *
__ª°ri˘
 
__≈å
,

201 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

202 
__THROW
 
	`__n⁄nuŒ
 ((1));

205 #i‡
deföed
 
__USE_ISOC99
 || deföed 
__USE_MISC


206 
__BEGIN_NAMESPACE_C99


208 
__exãnsi⁄__


209 
	$°πﬁl
 (c⁄° *
__ª°ri˘
 
__≈å
,

210 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

211 
__THROW
 
	`__n⁄nuŒ
 ((1));

213 
__exãnsi⁄__


214 
	$°πouŒ
 (c⁄° *
__ª°ri˘
 
__≈å
,

215 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

216 
__THROW
 
	`__n⁄nuŒ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifde‡
__USE_GNU


235 
	~<xloˇÀ.h
>

239 
	$°πﬁ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

240 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

241 
__loˇÀ_t
 
__loc
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

243 
	$°πoul_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

244 **
__ª°ri˘
 
__íd±r
,

245 
__ba£
, 
__loˇÀ_t
 
__loc
)

246 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

248 
__exãnsi⁄__


249 
	$°πﬁl_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

250 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

251 
__loˇÀ_t
 
__loc
)

252 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

254 
__exãnsi⁄__


255 
	$°πouŒ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

256 **
__ª°ri˘
 
__íd±r
,

257 
__ba£
, 
__loˇÀ_t
 
__loc
)

258 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

260 
	$°πod_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

261 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

262 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

264 
	$°πof_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

265 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

266 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

268 
	$°πﬁd_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

269 **
__ª°ri˘
 
__íd±r
,

270 
__loˇÀ_t
 
__loc
)

271 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

275 #ifde‡
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__exã∫_ölöe
 

278 
	`__NTH
 (
	$©oi
 (c⁄° *
__≈å
))

280  (Ë
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

281 
	}
}

282 
__exã∫_ölöe
 

283 
__NTH
 (
	$©ﬁ
 (c⁄° *
__≈å
))

285  
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__exãnsi⁄__
 
__exã∫_ölöe
 

292 
__NTH
 (
	$©ﬁl
 (c⁄° *
__≈å
))

294  
	`°πﬁl
 (
__≈å
, (**Ë
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
Ë
__THROW
 
__wur
;

308 
	$a64l
 (c⁄° *
__s
)

309 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

313 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_BSD


314 
	~<sys/ty≥s.h
>

321 
	$øndom
 (Ë
__THROW
;

324 
	$§™dom
 (
__£ed
Ë
__THROW
;

330 *
	$öô°©e
 (
__£ed
, *
__°©ebuf
,

331 
size_t
 
__°©ñí
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

335 *
	$£t°©e
 (*
__°©ebuf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

338 #ifde‡
__USE_MISC


343 
	søndom_d©a


345 
öt32_t
 *
Âå
;

346 
öt32_t
 *
Ωå
;

347 
öt32_t
 *
°©e
;

348 
ønd_ty≥
;

349 
ønd_deg
;

350 
ønd_£p
;

351 
öt32_t
 *
íd_±r
;

354 
	$øndom_r
 (
øndom_d©a
 *
__ª°ri˘
 
__buf
,

355 
öt32_t
 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

357 
	$§™dom_r
 (
__£ed
, 
øndom_d©a
 *
__buf
)

358 
__THROW
 
	`__n⁄nuŒ
 ((2));

360 
	$öô°©e_r
 (
__£ed
, *
__ª°ri˘
 
__°©ebuf
,

361 
size_t
 
__°©ñí
,

362 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

363 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

365 
	$£t°©e_r
 (*
__ª°ri˘
 
__°©ebuf
,

366 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

367 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$ønd
 (Ë
__THROW
;

376 
	$§™d
 (
__£ed
Ë
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifde‡
__USE_POSIX


381 
	$ønd_r
 (*
__£ed
Ë
__THROW
;

385 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


389 
	$dønd48
 (Ë
__THROW
;

390 
	$î™d48
 (
__xsubi
[3]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

393 
	$Ã™d48
 (Ë
__THROW
;

394 
	$ƒ™d48
 (
__xsubi
[3])

395 
__THROW
 
	`__n⁄nuŒ
 ((1));

398 
	$mønd48
 (Ë
__THROW
;

399 
	$jønd48
 (
__xsubi
[3])

400 
__THROW
 
	`__n⁄nuŒ
 ((1));

403 
	$§™d48
 (
__£edvÆ
Ë
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__n⁄nuŒ
 ((1));

406 
	$lc⁄g48
 (
__∑øm
[7]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

408 #ifde‡
__USE_MISC


412 
	sdønd48_d©a


414 
__x
[3];

415 
__ﬁd_x
[3];

416 
__c
;

417 
__öô
;

418 
__exãnsi⁄__
 
__a
;

423 
	$dønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

424 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

425 
	$î™d48_r
 (
__xsubi
[3],

426 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

427 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

430 
	$Ã™d48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

431 *
__ª°ri˘
 
__ªsu…
)

432 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

433 
	$ƒ™d48_r
 (
__xsubi
[3],

434 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

435 *
__ª°ri˘
 
__ªsu…
)

436 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

439 
	$mønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

440 *
__ª°ri˘
 
__ªsu…
)

441 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

442 
	$jønd48_r
 (
__xsubi
[3],

443 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

444 *
__ª°ri˘
 
__ªsu…
)

445 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

448 
	$§™d48_r
 (
__£edvÆ
, 
dønd48_d©a
 *
__buf„r
)

449 
__THROW
 
	`__n⁄nuŒ
 ((2));

451 
	$£ed48_r
 (
__£ed16v
[3],

452 
dønd48_d©a
 *
__buf„r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

454 
	$lc⁄g48_r
 (
__∑øm
[7],

455 
dønd48_d©a
 *
__buf„r
)

456 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

462 #i‚de‡
__mÆloc_™d_ˇŒoc_deföed


463 
	#__mÆloc_™d_ˇŒoc_deföed


	)

464 
__BEGIN_NAMESPACE_STD


466 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

468 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

469 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

470 
__END_NAMESPACE_STD


473 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


474 
__BEGIN_NAMESPACE_STD


480 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

481 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
;

483 
	$‰ì
 (*
__±r
Ë
__THROW
;

484 
__END_NAMESPACE_STD


486 #ifdef 
__USE_MISC


488 
	$c‰ì
 (*
__±r
Ë
__THROW
;

491 #i‡
deföed
 
__USE_GNU
 || deföed 
__USE_BSD
 || deföed 
__USE_MISC


492 
	~<Æloˇ.h
>

495 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

496 || 
deföed
 
__USE_BSD


498 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

501 #ifde‡
__USE_XOPEN2K


503 
	$posix_memÆign
 (**
__mem±r
, 
size_t
 
__Æignmít
, size_à
__size
)

504 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

507 #ifde‡
__USE_ISOC11


509 *
	$Æig√d_Æloc
 (
size_t
 
__Æignmít
, size_à
__size
)

510 
__THROW
 
__©åibuã_mÆloc__
 
	`__©åibuã_Æloc_size__
 ((2)Ë
__wur
;

513 
__BEGIN_NAMESPACE_STD


515 
	$ab‹t
 (Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

519 
	`©exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

521 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


523 #ifde‡
__˝lu•lus


524 "C++" 
	`©_quick_exô
 ((*
__func
) ())

525 
__THROW
 
	`__asm
 ("©_quick_exô"Ë
	`__n⁄nuŒ
 ((1));

527 
	`©_quick_exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

530 
__END_NAMESPACE_STD


532 #ifdef 
__USE_MISC


535 
	`⁄_exô
 ((*
__func
Ë(
__°©us
, *
__¨g
), *__arg)

536 
__THROW
 
	`__n⁄nuŒ
 ((1));

539 
__BEGIN_NAMESPACE_STD


543 
	$exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

545 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


549 
	$quick_exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

551 
__END_NAMESPACE_STD


553 #ifde‡
__USE_ISOC99


554 
__BEGIN_NAMESPACE_C99


557 
	$_Exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

558 
__END_NAMESPACE_C99


562 
__BEGIN_NAMESPACE_STD


564 *
	$gëív
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

565 
__END_NAMESPACE_STD


567 #ifde‡
__USE_GNU


570 *
	$£cuª_gëív
 (c⁄° *
__«me
)

571 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

574 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


578 
	$puãnv
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

581 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


584 
	$£ãnv
 (c⁄° *
__«me
, c⁄° *
__vÆue
, 
__ª∂a˚
)

585 
__THROW
 
	`__n⁄nuŒ
 ((2));

588 
	$un£ãnv
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

591 #ifdef 
__USE_MISC


595 
	$˛óªnv
 (Ë
__THROW
;

599 #i‡
deföed
 
__USE_MISC
 \

600 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
)

606 *
	$mkãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

609 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
 \

610 || 
deföed
 
__USE_XOPEN2K8


619 #i‚de‡
__USE_FILE_OFFSET64


620 
	$mk°emp
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

622 #ifde‡
__REDIRECT


623 
	`__REDIRECT
 (
mk°emp
, (*
__ãm∂©e
), 
mk°emp64
)

624 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

626 
	#mk°emp
 
mk°emp64


	)

629 #ifde‡
__USE_LARGEFILE64


630 
	$mk°emp64
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

634 #ifde‡
__USE_MISC


641 #i‚de‡
__USE_FILE_OFFSET64


642 
	$mk°emps
 (*
__ãm∂©e
, 
__suffixÀn
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

644 #ifde‡
__REDIRECT


645 
	`__REDIRECT
 (
mk°emps
, (*
__ãm∂©e
, 
__suffixÀn
),

646 
mk°emps64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

648 
	#mk°emps
 
mk°emps64


	)

651 #ifde‡
__USE_LARGEFILE64


652 
	$mk°emps64
 (*
__ãm∂©e
, 
__suffixÀn
)

653 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

657 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K8


663 *
	$mkdãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

666 #ifde‡
__USE_GNU


673 #i‚de‡
__USE_FILE_OFFSET64


674 
	$mko°emp
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

676 #ifde‡
__REDIRECT


677 
	`__REDIRECT
 (
mko°emp
, (*
__ãm∂©e
, 
__Êags
), 
mko°emp64
)

678 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

680 
	#mko°emp
 
mko°emp64


	)

683 #ifde‡
__USE_LARGEFILE64


684 
	$mko°emp64
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

693 #i‚de‡
__USE_FILE_OFFSET64


694 
	$mko°emps
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

695 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

697 #ifde‡
__REDIRECT


698 
	`__REDIRECT
 (
mko°emps
, (*
__ãm∂©e
, 
__suffixÀn
,

699 
__Êags
), 
mko°emps64
)

700 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

702 
	#mko°emps
 
mko°emps64


	)

705 #ifde‡
__USE_LARGEFILE64


706 
	$mko°emps64
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

707 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy°em
 (c⁄° *
__comm™d
Ë
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ˇn⁄iˇlize_fûe_«me
 (c⁄° *
__«me
)

725 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

728 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


734 *
	$ªÆ∑th
 (c⁄° *
__ª°ri˘
 
__«me
,

735 *
__ª°ri˘
 
__ªsﬁved
Ë
__THROW
 
__wur
;

740 #i‚de‡
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com∑r_‚_t
) (const *, const *);

744 #ifdef 
__USE_GNU


745 
__com∑r_‚_t
 
	tcom∑ris⁄_‚_t
;

748 #ifde‡
__USE_GNU


749 (*
	t__com∑r_d_‚_t
) (const *, const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¨ch
 (c⁄° *
__key
, c⁄° *
__ba£
,

756 
size_t
 
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
)

757 
	`__n⁄nuŒ
 ((1, 2, 5)Ë
__wur
;

759 #ifde‡
__USE_EXTERN_INLINES


760 
	~<bôs/°dlib-b£¨ch.h
>

765 
	$qs‹t
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

766 
__com∑r_‚_t
 
__com∑r
Ë
	`__n⁄nuŒ
 ((1, 4));

767 #ifde‡
__USE_GNU


768 
	$qs‹t_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

769 
__com∑r_d_‚_t
 
__com∑r
, *
__¨g
)

770 
	`__n⁄nuŒ
 ((1, 4));

775 
	$abs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

776 
	$œbs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

777 
__END_NAMESPACE_STD


779 #ifde‡
__USE_ISOC99


780 
__exãnsi⁄__
 
	$Œabs
 (
__x
)

781 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

785 
__BEGIN_NAMESPACE_STD


789 
div_t
 
	$div
 (
__numî
, 
__díom
)

790 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

791 
ldiv_t
 
	$ldiv
 (
__numî
, 
__díom
)

792 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

793 
__END_NAMESPACE_STD


795 #ifde‡
__USE_ISOC99


796 
__BEGIN_NAMESPACE_C99


797 
__exãnsi⁄__
 
Œdiv_t
 
	$Œdiv
 (
__numî
,

798 
__díom
)

799 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

800 
__END_NAMESPACE_C99


804 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

805 || 
deföed
 
__USE_SVID


812 *
	$ecvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

813 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

818 *
	$fcvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

819 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

824 *
	$gcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

825 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

828 #ifde‡
__USE_MISC


830 *
	$qecvt
 (
__vÆue
, 
__ndigô
,

831 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

832 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

833 *
	$qfcvt
 (
__vÆue
, 
__ndigô
,

834 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

835 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

836 *
	$qgcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

837 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

842 
	$ecvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

843 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

844 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

845 
	$fcvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

846 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

847 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

849 
	$qecvt_r
 (
__vÆue
, 
__ndigô
,

850 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

851 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

852 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

853 
	$qfcvt_r
 (
__vÆue
, 
__ndigô
,

854 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

855 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

856 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

860 
__BEGIN_NAMESPACE_STD


863 
	$mbÀn
 (c⁄° *
__s
, 
size_t
 
__n
Ë
__THROW
;

866 
	$mbtowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

867 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

870 
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
Ë
__THROW
;

874 
size_t
 
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__pwcs
,

875 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

877 
size_t
 
	$wc°ombs
 (*
__ª°ri˘
 
__s
,

878 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__pwcs
, 
size_t
 
__n
)

879 
__THROW
;

880 
__END_NAMESPACE_STD


883 #ifde‡
__USE_SVID


888 
	$Ωm©ch
 (c⁄° *
__ª•⁄£
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

892 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


899 
	$gësub›t
 (**
__ª°ri˘
 
__›ti⁄p
,

900 *c⁄° *
__ª°ri˘
 
__tokís
,

901 **
__ª°ri˘
 
__vÆuï
)

902 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3)Ë
__wur
;

906 #ifde‡
__USE_XOPEN


908 
	$£tkey
 (c⁄° *
__key
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

914 #ifde‡
__USE_XOPEN2KXSI


916 
	$posix_›í±
 (
__oÊag
Ë
__wur
;

919 #ifde‡
__USE_XOPEN


924 
	$gø¡±
 (
__fd
Ë
__THROW
;

928 
	$u∆ock±
 (
__fd
Ë
__THROW
;

933 *
	$±¢ame
 (
__fd
Ë
__THROW
 
__wur
;

936 #ifde‡
__USE_GNU


940 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

941 
__THROW
 
	`__n⁄nuŒ
 ((2));

944 
	`gë±
 ();

947 #ifde‡
__USE_BSD


951 
	$gëlﬂdavg
 (
__lﬂdavg
[], 
__√Àm
)

952 
__THROW
 
	`__n⁄nuŒ
 ((1));

955 
	~<bôs/°dlib-Êﬂt.h
>

958 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


959 
	~<bôs/°dlib.h
>

961 #ifde‡
__LDBL_COMPAT


962 
	~<bôs/°dlib-ldbl.h
>

966 #unde‡
__√ed_mÆloc_™d_ˇŒoc


968 
__END_DECLS


	@/usr/include/string.h

22 #i‚def 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


30 
	#__√ed_size_t


	)

31 
	#__√ed_NULL


	)

32 
	~<°ddef.h
>

39 #i‡
deföed
 
__˝lu•lus
 && (__˝lu•lu†>199711L || 
__GNUC_PREREQ
 (4, 4))

40 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

44 
__BEGIN_NAMESPACE_STD


46 *
	$mem˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

47 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

50 *
	$memmove
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

51 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

52 
__END_NAMESPACE_STD


57 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN


58 *
	$memc˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

59 
__c
, 
size_t
 
__n
)

60 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

64 
__BEGIN_NAMESPACE_STD


66 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

69 
	$memcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

70 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

73 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


76 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

77 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

78 c⁄° *
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

79 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

81 #ifde‡
__OPTIMIZE__


82 
__exã∫_Æways_ölöe
 *

83 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


85  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

88 
__exã∫_Æways_ölöe
 const *

89 
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


91  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

94 
	}
}

96 *
	$memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

97 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

99 
__END_NAMESPACE_STD


101 #ifde‡
__USE_GNU


104 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


105 "C++" *
	$øwmemchr
 (*
__s
, 
__c
)

106 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

107 "C++" c⁄° *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

108 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

110 *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

111 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

115 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


116 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

117 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

118 "C++" c⁄° *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

119 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

121 *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

122 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

127 
__BEGIN_NAMESPACE_STD


129 *
	$°r˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

130 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

132 *
	$°∫˝y
 (*
__ª°ri˘
 
__de°
,

133 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

134 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

137 *
	$°rˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

138 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

140 *
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

141 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

144 
	$°rcmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

145 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

147 
	$°∫cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

148 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

151 
	$°rcﬁl
 (c⁄° *
__s1
, c⁄° *
__s2
)

152 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

154 
size_t
 
	$°rx‰m
 (*
__ª°ri˘
 
__de°
,

155 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

156 
__THROW
 
	`__n⁄nuŒ
 ((2));

157 
__END_NAMESPACE_STD


159 #ifde‡
__USE_XOPEN2K8


163 
	~<xloˇÀ.h
>

166 
	$°rcﬁl_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
__loˇÀ_t
 
__l
)

167 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

169 
size_t
 
	$°rx‰m_l
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
,

170 
__loˇÀ_t
 
__l
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

173 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 \

174 || 
deföed
 
__USE_XOPEN2K8


176 *
	$°rdup
 (c⁄° *
__s
)

177 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

183 #i‡
deföed
 
__USE_XOPEN2K8


184 *
	$°∫dup
 (c⁄° *
__°rög
, 
size_t
 
__n
)

185 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

188 #i‡
deföed
 
__USE_GNU
 && deföed 
__GNUC__


190 
	#°rdu∑
(
s
) \

191 (
__exãnsi⁄__
 \

193 c⁄° *
__ﬁd
 = (
s
); \

194 
size_t
 
__Àn
 = 
	`°æí
 (
__ﬁd
) + 1; \

195 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
); \

196 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

197 
	}
}))

	)

200 
	#°∫du∑
(
s
, 
n
) \

201 (
__exãnsi⁄__
 \

203 c⁄° *
__ﬁd
 = (
s
); \

204 
size_t
 
__Àn
 = 
	`°∫Àn
 (
__ﬁd
, (
n
)); \

205 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
 + 1); \

206 
__√w
[
__Àn
] = '\0'; \

207 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

208 }))

	)

211 
	g__BEGIN_NAMESPACE_STD


213 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


216 *
°rchr
 (*
__s
, 
__c
)

217 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

218 c⁄° *
°rchr
 (c⁄° *
__s
, 
__c
)

219 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

221 #ifde‡
__OPTIMIZE__


222 
__exã∫_Æways_ölöe
 *

223 
°rchr
 (*
__s
, 
__c
Ë
	g__THROW


225  
__buûtö_°rchr
 (
__s
, 
__c
);

228 
__exã∫_Æways_ölöe
 const *

229 
°rchr
 (c⁄° *
__s
, 
__c
Ë
	g__THROW


231  
__buûtö_°rchr
 (
__s
, 
__c
);

236 *
	$°rchr
 (c⁄° *
__s
, 
__c
)

237 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

240 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


243 *
	`°ºchr
 (*
__s
, 
__c
)

244 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

245 c⁄° *
	`°ºchr
 (c⁄° *
__s
, 
__c
)

246 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

248 #ifde‡
__OPTIMIZE__


249 
__exã∫_Æways_ölöe
 *

250 
	`°ºchr
 (*
__s
, 
__c
Ë
__THROW


252  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

255 
__exã∫_Æways_ölöe
 const *

256 
	`°ºchr
 (c⁄° *
__s
, 
__c
Ë
__THROW


258  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

261 
	}
}

263 *
	$°ºchr
 (c⁄° *
__s
, 
__c
)

264 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

266 
__END_NAMESPACE_STD


268 #ifde‡
__USE_GNU


271 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


272 "C++" *
	$°rch∫ul
 (*
__s
, 
__c
)

273 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

274 "C++" c⁄° *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

275 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

277 *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

278 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

282 
__BEGIN_NAMESPACE_STD


285 
size_t
 
	$°rc•n
 (c⁄° *
__s
, c⁄° *
__ªje˘
)

286 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

289 
size_t
 
	$°r•n
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

290 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

292 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


295 *
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
)

296 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

297 c⁄° *
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

298 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

300 #ifde‡
__OPTIMIZE__


301 
__exã∫_Æways_ölöe
 *

302 
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
Ë
__THROW


304  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

307 
__exã∫_Æways_ölöe
 const *

308 
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
Ë
__THROW


310  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

313 
	}
}

315 *
	$°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

316 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

319 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


322 *
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

323 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

324 c⁄° *
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

325 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

327 #ifde‡
__OPTIMIZE__


328 
__exã∫_Æways_ölöe
 *

329 
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


331  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

334 
__exã∫_Æways_ölöe
 const *

335 
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


337  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

340 
	}
}

342 *
	$°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

343 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

348 *
	$°πok
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
)

349 
__THROW
 
	`__n⁄nuŒ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__°πok_r
 (*
__ª°ri˘
 
__s
,

355 c⁄° *
__ª°ri˘
 
__dñim
,

356 **
__ª°ri˘
 
__ßve_±r
)

357 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

358 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


359 *
	$°πok_r
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
,

360 **
__ª°ri˘
 
__ßve_±r
)

361 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

364 #ifde‡
__USE_GNU


366 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$°rˇ£°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

368 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

369 "C++" c⁄° *
	$°rˇ£°r
 (c⁄° *
__hay°ack
,

370 c⁄° *
__√edÀ
)

371 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

373 *
	$°rˇ£°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

374 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

378 #ifde‡
__USE_GNU


382 *
	$memmem
 (c⁄° *
__hay°ack
, 
size_t
 
__hay°ackÀn
,

383 c⁄° *
__√edÀ
, 
size_t
 
__√edÀÀn
)

384 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 3));

388 *
	$__memp˝y
 (*
__ª°ri˘
 
__de°
,

389 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

390 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

391 *
	$memp˝y
 (*
__ª°ri˘
 
__de°
,

392 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

393 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$°æí
 (c⁄° *
__s
)

400 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$°∫Àn
 (c⁄° *
__°rög
, 
size_t
 
__maxÀn
)

407 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$°ªº‹
 (
__î∫um
Ë
__THROW
;

414 
__END_NAMESPACE_STD


415 #i‡
deföed
 
__USE_XOPEN2K
 || deföed 
__USE_MISC


423 #i‡
deföed
 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


426 #ifde‡
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
°ªº‹_r
,

428 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
),

429 
__xpg_°ªº‹_r
Ë
	`__n⁄nuŒ
 ((2));

431 
	$__xpg_°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

432 
__THROW
 
	`__n⁄nuŒ
 ((2));

433 
	#°ªº‹_r
 
__xpg_°ªº‹_r


	)

438 *
	$°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

439 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

443 #ifde‡
__USE_XOPEN2K8


445 *
	$°ªº‹_l
 (
__î∫um
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

451 
	$__bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

453 #ifde‡
__USE_BSD


455 
	$bc›y
 (c⁄° *
__§c
, *
__de°
, 
size_t
 
__n
)

456 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

459 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

462 
	$bcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

466 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`ödex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

471 c⁄° *
	`ödex
 (c⁄° *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

474 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__exã∫_Æways_ölöe
 *

476 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


478  
	`__buûtö_ödex
 (
__s
, 
__c
);

481 
__exã∫_Æways_ölöe
 const *

482 
	`ödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


484  
	`__buûtö_ödex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$ödex
 (c⁄° *
__s
, 
__c
)

490 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

494 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`rödex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

499 c⁄° *
	`rödex
 (c⁄° *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

502 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__exã∫_Æways_ölöe
 *

504 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


506  
	`__buûtö_rödex
 (
__s
, 
__c
);

509 
__exã∫_Æways_ölöe
 const *

510 
	`rödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


512  
	`__buûtö_rödex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$rödex
 (c⁄° *
__s
, 
__c
)

518 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

523 
	$ffs
 (
__i
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

527 #ifdef 
__USE_GNU


528 
	$ff¶
 (
__l
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

529 
__exãnsi⁄__
 
	$ff¶l
 (
__Œ
)

530 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

534 
	$°rˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

535 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

538 
	$°∫ˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

539 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

542 #ifdef 
__USE_GNU


545 
	$°rˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

546 
__loˇÀ_t
 
__loc
)

547 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

549 
	$°∫ˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

550 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
)

551 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

554 #ifdef 
__USE_BSD


557 *
	$°r£p
 (**
__ª°ri˘
 
__°rögp
,

558 c⁄° *
__ª°ri˘
 
__dñim
)

559 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

562 #ifdef 
__USE_XOPEN2K8


564 *
	$°rsig«l
 (
__sig
Ë
__THROW
;

567 *
	$__°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

568 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

569 *
	$°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

570 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

574 *
	$__°≤˝y
 (*
__ª°ri˘
 
__de°
,

575 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

576 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

577 *
	$°≤˝y
 (*
__ª°ri˘
 
__de°
,

578 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

579 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

582 #ifdef 
__USE_GNU


584 
	$°rvîscmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

585 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

588 *
	$°r‰y
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

591 *
	$mem‰ob
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

593 #i‚de‡
ba£«me


598 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


599 "C++" *
	$ba£«me
 (*
__fûíame
)

600 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

601 "C++" c⁄° *
	$ba£«me
 (c⁄° *
__fûíame
)

602 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

604 *
	$ba£«me
 (c⁄° *
__fûíame
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

610 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

611 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__OPTIMIZE_SIZE__
 \

612 && !
deföed
 
__NO_INLINE__
 && !deföed 
__˝lu•lus


632 
	~<bôs/°rög.h
>

635 
	~<bôs/°rög2.h
>

638 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


640 
	~<bôs/°rög3.h
>

644 
__END_DECLS


	@/usr/include/strings.h

18 #i‚def 
_STRINGS_H


19 
	#_STRINGS_H
 1

	)

24 #i‡!
deföed
 
_STRING_H
 || !deföed 
__USE_BSD


26 
	~<„©uªs.h
>

27 
	#__√ed_size_t


	)

28 
	~<°ddef.h
>

35 #i‡
deföed
 
__˝lu•lus
 && (__˝lu•lu†>199711L || 
__GNUC_PREREQ
 (4, 4))

36 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

39 
	g__BEGIN_DECLS


41 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


43 
	$bcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

44 
__THROW
 
__©åibuã_puª__
;

47 
	$bc›y
 (c⁄° *
__§c
, *
__de°
, 
size_t
 
__n
Ë
__THROW
;

50 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
;

53 #ifde‡
__CORRECT_ISO_CPP_STRINGS_H_PROTO


56 *
	`ödex
 (*
__s
, 
__c
)

57 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

58 c⁄° *
	`ödex
 (c⁄° *
__s
, 
__c
)

59 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

61 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRING_H_PROTO


62 
__exã∫_Æways_ölöe
 *

63 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


65  
	`__buûtö_ödex
 (
__s
, 
__c
);

68 
__exã∫_Æways_ölöe
 const *

69 
	`ödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


71  
	`__buûtö_ödex
 (
__s
, 
__c
);

74 
	}
}

76 *
	$ödex
 (c⁄° *
__s
, 
__c
)

77 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

81 #ifde‡
__CORRECT_ISO_CPP_STRINGS_H_PROTO


84 *
	`rödex
 (*
__s
, 
__c
)

85 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

86 c⁄° *
	`rödex
 (c⁄° *
__s
, 
__c
)

87 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

89 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRING_H_PROTO


90 
__exã∫_Æways_ölöe
 *

91 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


93  
	`__buûtö_rödex
 (
__s
, 
__c
);

96 
__exã∫_Æways_ölöe
 const *

97 
	`rödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


99  
	`__buûtö_rödex
 (
__s
, 
__c
);

102 
	}
}

104 *
	$rödex
 (c⁄° *
__s
, 
__c
)

105 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

109 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8
 || deföed 
__USE_XOPEN2K8XSI


112 
	$ffs
 (
__i
Ë
__THROW
 
	`__©åibuã__
 ((const));

116 
	$°rˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

117 
__THROW
 
__©åibuã_puª__
;

120 
	$°∫ˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

121 
__THROW
 
__©åibuã_puª__
;

123 #ifdef 
__USE_XOPEN2K8


127 
	~<xloˇÀ.h
>

131 
	$°rˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
__loˇÀ_t
 
__loc
)

132 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

134 
	$°∫ˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

135 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
)

136 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

139 
__END_DECLS


	@/usr/include/stropts.h

18 #i‚de‡
_STROPTS_H


19 
	#_STROPTS_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<bôs/ty≥s.h
>

23 
	~<bôs/xtôy≥s.h
>

25 #i‚de‡
__gid_t_deföed


26 
__gid_t
 
	tgid_t
;

27 
	#__gid_t_deföed


	)

30 #i‚de‡
__uid_t_deföed


31 
__uid_t
 
	tuid_t
;

32 
	#__uid_t_deföed


	)

35 
__t_sˇœr_t
 
	tt_sˇœr_t
;

36 
__t_usˇœr_t
 
	tt_usˇœr_t
;

39 
	~<bôs/°r›ts.h
>

42 
__BEGIN_DECLS


45 
	$iß°ªam
 (
__fûdes
Ë
__THROW
;

51 
	`gëmsg
 (
__fûdes
, 
°rbuf
 *
__ª°ri˘
 
__˘Õå
,

52 
°rbuf
 *
__ª°ri˘
 
__d©≠å
,

53 *
__ª°ri˘
 
__Êag•
);

60 
	`gëpmsg
 (
__fûdes
, 
°rbuf
 *
__ª°ri˘
 
__˘Õå
,

61 
°rbuf
 *
__ª°ri˘
 
__d©≠å
,

62 *
__ª°ri˘
 
__b™dp
, *__ª°ri˘ 
__Êag•
);

67 
	$io˘l
 (
__fd
, 
__ªque°
, ...Ë
__THROW
;

73 
	`putmsg
 (
__fûdes
, c⁄° 
°rbuf
 *
__˘Õå
,

74 c⁄° 
°rbuf
 *
__d©≠å
, 
__Êags
);

80 
	`puçmsg
 (
__fûdes
, c⁄° 
°rbuf
 *
__˘Õå
,

81 c⁄° 
°rbuf
 *
__d©≠å
, 
__b™d
, 
__Êags
);

85 
	$Áâach
 (
__fûdes
, c⁄° *
__∑th
Ë
__THROW
;

88 
	$fdëach
 (c⁄° *
__∑th
Ë
__THROW
;

90 
__END_DECLS


	@/usr/include/termio.h

5 
	~<ãrmios.h
>

6 
	~<sys/io˘l.h
>

	@/usr/include/termios.h

22 #i‚def 
_TERMIOS_H


23 
	#_TERMIOS_H
 1

	)

25 
	~<„©uªs.h
>

26 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


28 
	~<bôs/ty≥s.h
>

29 #i‚de‡
__pid_t_deföed


30 
__pid_t
 
	tpid_t
;

31 
	#__pid_t_deföed


	)

35 
	g__BEGIN_DECLS


39 
	~<bôs/ãrmios.h
>

41 #ifde‡
__USE_BSD


44 
	#CCEQ
(
vÆ
, 
c
Ë((cË=(vÆË&& (vÆË!
_POSIX_VDISABLE
)

	)

48 
•ìd_t
 
	$cfgëo•ìd
 (c⁄° 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

51 
•ìd_t
 
	$cfgëi•ìd
 (c⁄° 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

54 
	$cf£to•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

57 
	$cf£ti•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

59 #ifdef 
__USE_BSD


61 
	$cf£t•ìd
 (
ãrmios
 *
__ãrmios_p
, 
•ìd_t
 
__•ìd
Ë
__THROW
;

66 
	$tcgë©å
 (
__fd
, 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

70 
	$tc£èâr
 (
__fd
, 
__›ti⁄Æ_a˘i⁄s
,

71 c⁄° 
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

74 #ifdef 
__USE_BSD


76 
	$cfmakîaw
 (
ãrmios
 *
__ãrmios_p
Ë
__THROW
;

80 
	$tc£ndbªak
 (
__fd
, 
__duøti⁄
Ë
__THROW
;

86 
	`tcdøö
 (
__fd
);

90 
	$tcÊush
 (
__fd
, 
__queue_£À˘‹
Ë
__THROW
;

94 
	$tcÊow
 (
__fd
, 
__a˘i⁄
Ë
__THROW
;

97 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


99 
__pid_t
 
	$tcgësid
 (
__fd
Ë
__THROW
;

103 #ifde‡
__USE_BSD


104 
	~<sys/âydeÁu…s.h
>

107 
__END_DECLS


	@/usr/include/time.h

22 #i‚def 
_TIME_H


24 #i‡(! 
deföed
 
__√ed_time_t
 && !deföed 
__√ed_˛ock_t
 && \

25 ! 
deföed
 
	g__√ed_time•ec
)

26 
	#_TIME_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__√ed_size_t


	)

36 
	#__√ed_NULL


	)

37 
	~<°ddef.h
>

41 
	~<bôs/time.h
>

44 #i‡!
deföed
 
__STRICT_ANSI__
 && !deföed 
__USE_XOPEN2K


45 #i‚de‡
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #i‡!
deföed
 
__˛ock_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_˛ock_t
)

53 
	#__˛ock_t_deföed
 1

	)

55 
	~<bôs/ty≥s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__˛ock_t
 
	t˛ock_t
;

60 
	g__END_NAMESPACE_STD


61 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX
 || deföed 
__USE_MISC


62 
	$__USING_NAMESPACE_STD
(
˛ock_t
)

66 #unde‡
__√ed_˛ock_t


68 #i‡!
deföed
 
__time_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_time_t
)

69 
	#__time_t_deföed
 1

	)

71 
	~<bôs/ty≥s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC
 || deföed 
__USE_SVID


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #unde‡
__√ed_time_t


84 #i‡!
deföed
 
__˛ockid_t_deföed
 && \

85 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_˛ockid_t
)

86 
	#__˛ockid_t_deföed
 1

	)

88 
	~<bôs/ty≥s.h
>

91 
__˛ockid_t
 
	t˛ockid_t
;

94 #unde‡
__˛ockid_time_t


96 #i‡!
deföed
 
__timî_t_deföed
 && \

97 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_timî_t
)

98 
	#__timî_t_deföed
 1

	)

100 
	~<bôs/ty≥s.h
>

103 
__timî_t
 
	ttimî_t
;

106 #unde‡
__√ed_timî_t


109 #i‡(!
deföed
 
__time•ec_deföed
 \

110 && ((
deföed
 
_TIME_H
 \

111 && (
deföed
 
__USE_POSIX199309
 || deföed 
__USE_MISC
 \

112 || 
deföed
 
__USE_ISOC11
)) \

113 || 
deföed
 
__√ed_time•ec
))

114 
	#__time•ec_deföed
 1

	)

116 
	~<bôs/ty≥s.h
>

120 
	stime•ec


122 
__time_t
 
tv_£c
;

123 
__sysˇŒ_¶⁄g_t
 
tv_n£c
;

127 #unde‡
__√ed_time•ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mö
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_m⁄
;

140 
tm_yór
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd°
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 c⁄° *
tm_z⁄e
;

149 
__tm_gmtoff
;

150 c⁄° *
__tm_z⁄e
;

153 
__END_NAMESPACE_STD


154 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX
 || deföed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifde‡
__USE_POSIX199309


161 
	sôimî•ec


163 
time•ec
 
ô_öãrvÆ
;

164 
time•ec
 
ô_vÆue
;

168 
sigevít
;

172 #ifde‡
__USE_XOPEN2K


173 #i‚de‡
__pid_t_deföed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_deföed


	)

180 #ifde‡
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
˛ock_t
 
	$˛ock
 (Ë
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__timî
Ë
__THROW
;

195 
	$dif·ime
 (
time_t
 
__time1
,Åime_à
__time0
)

196 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

199 
time_t
 
	$mktime
 (
tm
 *
__ç
Ë
__THROW
;

205 
size_t
 
	$°r·ime
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

206 c⁄° *
__ª°ri˘
 
__f‹m©
,

207 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifde‡
__USE_XOPEN


213 *
	$°Ωtime
 (c⁄° *
__ª°ri˘
 
__s
,

214 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
)

215 
__THROW
;

218 #ifde‡
__USE_XOPEN2K8


221 
	~<xloˇÀ.h
>

223 
size_t
 
	$°r·ime_l
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

224 c⁄° *
__ª°ri˘
 
__f‹m©
,

225 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

226 
__loˇÀ_t
 
__loc
Ë
__THROW
;

229 #ifde‡
__USE_GNU


230 *
	$°Ωtime_l
 (c⁄° *
__ª°ri˘
 
__s
,

231 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
,

232 
__loˇÀ_t
 
__loc
Ë
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

243 
tm
 *
	$loˇ…ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

244 
__END_NAMESPACE_STD


246 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


249 
tm
 *
	$gmtime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

250 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

254 
tm
 *
	$loˇ…ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

255 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$as˘ime
 (c⁄° 
tm
 *
__ç
Ë
__THROW
;

264 *
	$˘ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

265 
__END_NAMESPACE_STD


267 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


272 *
	$as˘ime_r
 (c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

273 *
__ª°ri˘
 
__buf
Ë
__THROW
;

276 *
	$˘ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

277 *
__ª°ri˘
 
__buf
Ë
__THROW
;

282 *
__tz«me
[2];

283 
__daylight
;

284 
__timez⁄e
;

287 #ifdef 
__USE_POSIX


289 *
tz«me
[2];

293 
	$tz£t
 (Ë
__THROW
;

296 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


297 
daylight
;

298 
timez⁄e
;

301 #ifde‡
__USE_SVID


304 
	$°ime
 (c⁄° 
time_t
 *
__whí
Ë
__THROW
;

310 
	#__i¶óp
(
yór
) \

311 ((
yór
Ë% 4 =0 && ((yórË% 100 !0 || (yórË% 400 =0))

	)

314 #ifde‡
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__ç
Ë
__THROW
;

322 
time_t
 
	$timñoˇl
 (
tm
 *
__ç
Ë
__THROW
;

325 
	$dysize
 (
__yór
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

329 #ifde‡
__USE_POSIX199309


334 
	`«no¶ìp
 (c⁄° 
time•ec
 *
__ªque°ed_time
,

335 
time•ec
 *
__ªmaöög
);

339 
	$˛ock_gëªs
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ªs
Ë
__THROW
;

342 
	$˛ock_gëtime
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ç
Ë
__THROW
;

345 
	$˛ock_£âime
 (
˛ockid_t
 
__˛ock_id
, c⁄° 
time•ec
 *
__ç
)

346 
__THROW
;

348 #ifde‡
__USE_XOPEN2K


353 
	`˛ock_«no¶ìp
 (
˛ockid_t
 
__˛ock_id
, 
__Êags
,

354 c⁄° 
time•ec
 *
__ªq
,

355 
time•ec
 *
__ªm
);

358 
	$˛ock_gë˝u˛ockid
 (
pid_t
 
__pid
, 
˛ockid_t
 *
__˛ock_id
Ë
__THROW
;

363 
	$timî_¸óã
 (
˛ockid_t
 
__˛ock_id
,

364 
sigevít
 *
__ª°ri˘
 
__evp
,

365 
timî_t
 *
__ª°ri˘
 
__timîid
Ë
__THROW
;

368 
	$timî_dñëe
 (
timî_t
 
__timîid
Ë
__THROW
;

371 
	$timî_£âime
 (
timî_t
 
__timîid
, 
__Êags
,

372 c⁄° 
ôimî•ec
 *
__ª°ri˘
 
__vÆue
,

373 
ôimî•ec
 *
__ª°ri˘
 
__ovÆue
Ë
__THROW
;

376 
	$timî_gëtime
 (
timî_t
 
__timîid
, 
ôimî•ec
 *
__vÆue
)

377 
__THROW
;

380 
	$timî_gëovîrun
 (
timî_t
 
__timîid
Ë
__THROW
;

384 #ifde‡
__USE_ISOC11


386 
	$time•ec_gë
 (
time•ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__n⁄nuŒ
 ((1));

391 #ifde‡
__USE_XOPEN_EXTENDED


403 
gëd©e_îr
;

412 
tm
 *
	`gëd©e
 (c⁄° *
__°rög
);

415 #ifde‡
__USE_GNU


426 
	`gëd©e_r
 (c⁄° *
__ª°ri˘
 
__°rög
,

427 
tm
 *
__ª°ri˘
 
__ªsbuÂ
);

430 
__END_DECLS


	@/usr/include/unistd.h

22 #i‚def 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


32 #ifde‡
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #ñi‡
deföed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #ñi‡
deföed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #ñi‡
deföed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifde‡
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #ñi‡
deföed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #ñi‡
deföed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

71 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

75 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

79 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

83 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

86 #ifde‡
__USE_XOPEN2K8


87 
	#_XOPEN_VERSION
 700

	)

88 #ñi‡
deföed
 
__USE_XOPEN2K


89 
	#_XOPEN_VERSION
 600

	)

90 #ñi‡
deföed
 
__USE_UNIX98


91 
	#_XOPEN_VERSION
 500

	)

93 
	#_XOPEN_VERSION
 4

	)

97 
	#_XOPEN_XCU_VERSION
 4

	)

100 
	#_XOPEN_XPG2
 1

	)

101 
	#_XOPEN_XPG3
 1

	)

102 
	#_XOPEN_XPG4
 1

	)

105 
	#_XOPEN_UNIX
 1

	)

108 
	#_XOPEN_CRYPT
 1

	)

112 
	#_XOPEN_ENH_I18N
 1

	)

115 
	#_XOPEN_LEGACY
 1

	)

202 
	~<bôs/posix_›t.h
>

205 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


206 
	~<bôs/ívú⁄míts.h
>

210 
	#STDIN_FILENO
 0

	)

211 
	#STDOUT_FILENO
 1

	)

212 
	#STDERR_FILENO
 2

	)

217 
	~<bôs/ty≥s.h
>

219 #i‚def 
__ssize_t_deföed


220 
__ssize_t
 
	tssize_t
;

221 
	#__ssize_t_deföed


	)

224 
	#__√ed_size_t


	)

225 
	#__√ed_NULL


	)

226 
	~<°ddef.h
>

228 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


231 #i‚de‡
__gid_t_deföed


232 
__gid_t
 
	tgid_t
;

233 
	#__gid_t_deföed


	)

236 #i‚de‡
__uid_t_deföed


237 
__uid_t
 
	tuid_t
;

238 
	#__uid_t_deföed


	)

241 #i‚de‡
__off_t_deföed


242 #i‚de‡
__USE_FILE_OFFSET64


243 
__off_t
 
	toff_t
;

245 
__off64_t
 
	toff_t
;

247 
	#__off_t_deföed


	)

249 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


250 
__off64_t
 
	toff64_t
;

251 
	#__off64_t_deföed


	)

254 #i‚de‡
__u£c⁄ds_t_deföed


255 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

256 
	#__u£c⁄ds_t_deföed


	)

259 #i‚de‡
__pid_t_deföed


260 
__pid_t
 
	tpid_t
;

261 
	#__pid_t_deföed


	)

265 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


266 #i‚de‡
__öçå_t_deföed


267 
__öçå_t
 
	töçå_t
;

268 
	#__öçå_t_deföed


	)

272 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN


273 #i‚de‡
__sockÀn_t_deföed


274 
__sockÀn_t
 
	tsockÀn_t
;

275 
	#__sockÀn_t_deföed


	)

281 
	#R_OK
 4

	)

282 
	#W_OK
 2

	)

283 
	#X_OK
 1

	)

284 
	#F_OK
 0

	)

287 
	$ac˚ss
 (c⁄° *
__«me
, 
__ty≥
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

289 #ifde‡
__USE_GNU


292 
	$euidac˚ss
 (c⁄° *
__«me
, 
__ty≥
)

293 
__THROW
 
	`__n⁄nuŒ
 ((1));

296 
	$óc˚ss
 (c⁄° *
__«me
, 
__ty≥
)

297 
__THROW
 
	`__n⁄nuŒ
 ((1));

300 #ifde‡
__USE_ATFILE


304 
	$Ác˚sßt
 (
__fd
, c⁄° *
__fûe
, 
__ty≥
, 
__Êag
)

305 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

310 #i‚def 
_STDIO_H


311 
	#SEEK_SET
 0

	)

312 
	#SEEK_CUR
 1

	)

313 
	#SEEK_END
 2

	)

314 #ifde‡
__USE_GNU


315 
	#SEEK_DATA
 3

	)

316 
	#SEEK_HOLE
 4

	)

320 #i‡
deföed
 
__USE_BSD
 && !deföed 
L_SET


322 
	#L_SET
 
SEEK_SET


	)

323 
	#L_INCR
 
SEEK_CUR


	)

324 
	#L_XTND
 
SEEK_END


	)

333 #i‚de‡
__USE_FILE_OFFSET64


334 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__whí˚
Ë
__THROW
;

336 #ifde‡
__REDIRECT_NTH


337 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

338 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
),

339 
l£ek64
);

341 
	#l£ek
 
l£ek64


	)

344 #ifde‡
__USE_LARGEFILE64


345 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
)

346 
__THROW
;

353 
	`˛o£
 (
__fd
);

360 
ssize_t
 
	$ªad
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
Ë
__wur
;

366 
ssize_t
 
	$wrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
Ë
__wur
;

368 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


369 #i‚de‡
__USE_FILE_OFFSET64


376 
ssize_t
 
	$¥ód
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

377 
__off_t
 
__off£t
Ë
__wur
;

384 
ssize_t
 
	$pwrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

385 
__off_t
 
__off£t
Ë
__wur
;

387 #ifde‡
__REDIRECT


388 
ssize_t
 
	`__REDIRECT
 (
¥ód
, (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

389 
__off64_t
 
__off£t
),

390 
¥ód64
Ë
__wur
;

391 
ssize_t
 
	`__REDIRECT
 (
pwrôe
, (
__fd
, c⁄° *
__buf
,

392 
size_t
 
__nbyãs
, 
__off64_t
 
__off£t
),

393 
pwrôe64
Ë
__wur
;

395 
	#¥ód
 
¥ód64


	)

396 
	#pwrôe
 
pwrôe64


	)

400 #ifde‡
__USE_LARGEFILE64


404 
ssize_t
 
	$¥ód64
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

405 
__off64_t
 
__off£t
Ë
__wur
;

408 
ssize_t
 
	$pwrôe64
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

409 
__off64_t
 
__off£t
Ë
__wur
;

417 
	$pùe
 (
__pùedes
[2]Ë
__THROW
 
__wur
;

419 #ifde‡
__USE_GNU


422 
	$pùe2
 (
__pùedes
[2], 
__Êags
Ë
__THROW
 
__wur
;

432 
	$Æ¨m
 (
__£c⁄ds
Ë
__THROW
;

444 
	`¶ìp
 (
__£c⁄ds
);

446 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

447 || 
deföed
 
__USE_BSD


452 
__u£c⁄ds_t
 
	$uÆ¨m
 (
__u£c⁄ds_t
 
__vÆue
, __u£c⁄ds_à
__öãrvÆ
)

453 
__THROW
;

460 
	`u¶ìp
 (
__u£c⁄ds_t
 
__u£c⁄ds
);

469 
	`∑u£
 ();

473 
	$chown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

474 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

476 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


478 
	$fchown
 (
__fd
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
Ë
__THROW
 
__wur
;

483 
	$lchown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

484 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

488 #ifde‡
__USE_ATFILE


491 
	$fchow«t
 (
__fd
, c⁄° *
__fûe
, 
__uid_t
 
__ow√r
,

492 
__gid_t
 
__group
, 
__Êag
)

493 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

497 
	$chdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

499 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


501 
	$fchdú
 (
__fd
Ë
__THROW
 
__wur
;

511 *
	$gëcwd
 (*
__buf
, 
size_t
 
__size
Ë
__THROW
 
__wur
;

513 #ifdef 
__USE_GNU


517 *
	$gë_cuºít_dú_«me
 (Ë
__THROW
;

520 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

521 || 
deföed
 
__USE_BSD


525 *
	$gëwd
 (*
__buf
)

526 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
 
__wur
;

531 
	$dup
 (
__fd
Ë
__THROW
 
__wur
;

534 
	$dup2
 (
__fd
, 
__fd2
Ë
__THROW
;

536 #ifde‡
__USE_GNU


539 
	$dup3
 (
__fd
, 
__fd2
, 
__Êags
Ë
__THROW
;

543 **
__ívú⁄
;

544 #ifde‡
__USE_GNU


545 **
ívú⁄
;

551 
	$execve
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[],

552 *c⁄° 
__ívp
[]Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

554 #ifde‡
__USE_XOPEN2K8


557 
	$„xecve
 (
__fd
, *c⁄° 
__¨gv
[], *c⁄° 
__ívp
[])

558 
__THROW
 
	`__n⁄nuŒ
 ((2));

563 
	$execv
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[])

564 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

568 
	$exe˛e
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

569 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

573 
	$exe˛
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

574 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

578 
	$execvp
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[])

579 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

584 
	$exe˛p
 (c⁄° *
__fûe
, c⁄° *
__¨g
, ...)

585 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

587 #ifde‡
__USE_GNU


590 
	$execv≥
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[],

591 *c⁄° 
__ívp
[])

592 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

596 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


598 
	$ni˚
 (
__öc
Ë
__THROW
 
__wur
;

603 
	$_exô
 (
__°©us
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

609 
	~<bôs/c⁄‚ame.h
>

612 
	$∑thc⁄f
 (c⁄° *
__∑th
, 
__«me
)

613 
__THROW
 
	`__n⁄nuŒ
 ((1));

616 
	$Â©hc⁄f
 (
__fd
, 
__«me
Ë
__THROW
;

619 
	$sysc⁄f
 (
__«me
Ë
__THROW
;

621 #ifdef 
__USE_POSIX2


623 
size_t
 
	$c⁄f°r
 (
__«me
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

628 
__pid_t
 
	$gëpid
 (Ë
__THROW
;

631 
__pid_t
 
	$gëµid
 (Ë
__THROW
;

634 
__pid_t
 
	$gëpgΩ
 (Ë
__THROW
;

637 
__pid_t
 
	$__gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

638 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


639 
__pid_t
 
	$gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

646 
	$£çgid
 (
__pid_t
 
__pid
, __pid_à
__pgid
Ë
__THROW
;

648 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


660 
	$£çgΩ
 (Ë
__THROW
;

667 
__pid_t
 
	$£tsid
 (Ë
__THROW
;

669 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


671 
__pid_t
 
	$gësid
 (
__pid_t
 
__pid
Ë
__THROW
;

675 
__uid_t
 
	$gëuid
 (Ë
__THROW
;

678 
__uid_t
 
	$gëeuid
 (Ë
__THROW
;

681 
__gid_t
 
	$gëgid
 (Ë
__THROW
;

684 
__gid_t
 
	$gëegid
 (Ë
__THROW
;

689 
	$gëgroups
 (
__size
, 
__gid_t
 
__li°
[]Ë
__THROW
 
__wur
;

691 #ifdef 
__USE_GNU


693 
	$group_membî
 (
__gid_t
 
__gid
Ë
__THROW
;

700 
	$£tuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

702 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


705 
	$£åeuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
Ë
__THROW
 
__wur
;

708 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


710 
	$£ãuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

717 
	$£tgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

719 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


722 
	$£åegid
 (
__gid_t
 
__rgid
, __gid_à
__egid
Ë
__THROW
 
__wur
;

725 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


727 
	$£ãgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

730 #ifde‡
__USE_GNU


733 
	$gëªsuid
 (
__uid_t
 *
__ruid
, __uid_à*
__euid
, __uid_à*
__suid
)

734 
__THROW
;

738 
	$gëªsgid
 (
__gid_t
 *
__rgid
, __gid_à*
__egid
, __gid_à*
__sgid
)

739 
__THROW
;

743 
	$£åesuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
, __uid_à
__suid
)

744 
__THROW
 
__wur
;

748 
	$£åesgid
 (
__gid_t
 
__rgid
, __gid_à
__egid
, __gid_à
__sgid
)

749 
__THROW
 
__wur
;

756 
__pid_t
 
	$f‹k
 (Ë
__THROWNL
;

758 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

759 || 
deföed
 
__USE_BSD


764 
__pid_t
 
	$vf‹k
 (Ë
__THROW
;

770 *
	$ây«me
 (
__fd
Ë
__THROW
;

774 
	$ây«me_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

775 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

779 
	$ißây
 (
__fd
Ë
__THROW
;

781 #i‡
deföed
 
__USE_BSD
 \

782 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_UNIX98
)

785 
	$ây¶Ÿ
 (Ë
__THROW
;

790 
	$lök
 (c⁄° *
__‰om
, c⁄° *
__to
)

791 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

793 #ifde‡
__USE_ATFILE


796 
	$lök©
 (
__‰omfd
, c⁄° *
__‰om
, 
__tofd
,

797 c⁄° *
__to
, 
__Êags
)

798 
__THROW
 
	`__n⁄nuŒ
 ((2, 4)Ë
__wur
;

801 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


803 
	$symlök
 (c⁄° *
__‰om
, c⁄° *
__to
)

804 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

809 
ssize_t
 
	$ªadlök
 (c⁄° *
__ª°ri˘
 
__∑th
,

810 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

811 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

814 #ifde‡
__USE_ATFILE


816 
	$symlök©
 (c⁄° *
__‰om
, 
__tofd
,

817 c⁄° *
__to
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

820 
ssize_t
 
	$ªadlök©
 (
__fd
, c⁄° *
__ª°ri˘
 
__∑th
,

821 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

822 
__THROW
 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
;

826 
	$u∆ök
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

828 #ifde‡
__USE_ATFILE


830 
	$u∆ök©
 (
__fd
, c⁄° *
__«me
, 
__Êag
)

831 
__THROW
 
	`__n⁄nuŒ
 ((2));

835 
	$rmdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

839 
__pid_t
 
	$tcgëpgΩ
 (
__fd
Ë
__THROW
;

842 
	$tc£çgΩ
 (
__fd
, 
__pid_t
 
__pgΩ_id
Ë
__THROW
;

849 *
	`gëlogö
 ();

850 #i‡
deföed
 
__USE_REENTRANT
 || deföed 
__USE_POSIX199506


857 
	$gëlogö_r
 (*
__«me
, 
size_t
 
__«me_Àn
Ë
	`__n⁄nuŒ
 ((1));

860 #ifdef 
__USE_BSD


862 
	$£éogö
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

866 #ifdef 
__USE_POSIX2


870 
	#__√ed_gë›t


	)

871 
	~<gë›t.h
>

875 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


879 
	$gëho°«me
 (*
__«me
, 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

883 #i‡
deföed
 
__USE_BSD
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_UNIX98
)

886 
	$£tho°«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

887 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

891 
	$£tho°id
 (
__id
Ë
__THROW
 
__wur
;

897 
	$gëdomaö«me
 (*
__«me
, 
size_t
 
__Àn
)

898 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

899 
	$£tdomaö«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

900 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

906 
	$vh™gup
 (Ë
__THROW
;

909 
	$ªvoke
 (c⁄° *
__fûe
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

917 
	$¥ofû
 (*
__ßm∂e_buf„r
, 
size_t
 
__size
,

918 
size_t
 
__off£t
, 
__sˇÀ
)

919 
__THROW
 
	`__n⁄nuŒ
 ((1));

925 
	$ac˘
 (c⁄° *
__«me
Ë
__THROW
;

929 *
	$gëu£rshñl
 (Ë
__THROW
;

930 
	$ídu£rshñl
 (Ë
__THROW
;

931 
	$£tu£rshñl
 (Ë
__THROW
;

937 
	$d´m⁄
 (
__nochdú
, 
__no˛o£
Ë
__THROW
 
__wur
;

941 #i‡
deföed
 
__USE_BSD
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

944 
	$chroŸ
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

948 *
	$gë∑ss
 (c⁄° *
__¥om±
Ë
	`__n⁄nuŒ
 ((1));

956 
	`fsync
 (
__fd
);

959 #ifde‡
__USE_GNU


962 
	$syncfs
 (
__fd
Ë
__THROW
;

966 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


969 
	`gëho°id
 ();

972 
	$sync
 (Ë
__THROW
;

975 #i‡
deföed
 
__USE_BSD
 || !deföed 
__USE_XOPEN2K


978 
	$gë∑gesize
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

983 
	$gëdèbÀsize
 (Ë
__THROW
;

989 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


992 #i‚de‡
__USE_FILE_OFFSET64


993 
	$åunˇã
 (c⁄° *
__fûe
, 
__off_t
 
__Àngth
)

994 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

996 #ifde‡
__REDIRECT_NTH


997 
	`__REDIRECT_NTH
 (
åunˇã
,

998 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
),

999 
åunˇã64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1001 
	#åunˇã
 
åunˇã64


	)

1004 #ifde‡
__USE_LARGEFILE64


1005 
	$åunˇã64
 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
)

1006 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1011 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_POSIX199309
 \

1012 || 
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


1015 #i‚de‡
__USE_FILE_OFFSET64


1016 
	$·runˇã
 (
__fd
, 
__off_t
 
__Àngth
Ë
__THROW
 
__wur
;

1018 #ifde‡
__REDIRECT_NTH


1019 
	`__REDIRECT_NTH
 (
·runˇã
, (
__fd
, 
__off64_t
 
__Àngth
),

1020 
·runˇã64
Ë
__wur
;

1022 
	#·runˇã
 
·runˇã64


	)

1025 #ifde‡
__USE_LARGEFILE64


1026 
	$·runˇã64
 (
__fd
, 
__off64_t
 
__Àngth
Ë
__THROW
 
__wur
;

1032 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

1033 || 
deföed
 
__USE_MISC


1037 
	$brk
 (*
__addr
Ë
__THROW
 
__wur
;

1043 *
	$sbrk
 (
öçå_t
 
__dñè
Ë
__THROW
;

1047 #ifde‡
__USE_MISC


1058 
	$sysˇŒ
 (
__sy¢o
, ...Ë
__THROW
;

1063 #i‡(
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
Ë&& !deföed 
F_LOCK


1075 
	#F_ULOCK
 0

	)

1076 
	#F_LOCK
 1

	)

1077 
	#F_TLOCK
 2

	)

1078 
	#F_TEST
 3

	)

1080 #i‚de‡
__USE_FILE_OFFSET64


1081 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Àn
Ë
__wur
;

1083 #ifde‡
__REDIRECT


1084 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
),

1085 
lockf64
Ë
__wur
;

1087 
	#lockf
 
lockf64


	)

1090 #ifde‡
__USE_LARGEFILE64


1091 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
Ë
__wur
;

1096 #ifde‡
__USE_GNU


1101 
	#TEMP_FAILURE_RETRY
(
ex¥essi⁄
) \

1102 (
__exãnsi⁄__
 \

1103 ({ 
__ªsu…
; \

1104 dÿ
__ªsu…
 = (Ë(
ex¥essi⁄
); \

1105 
__ªsu…
 =-1L && 
î∫o
 =
EINTR
); \

1106 
__ªsu…
; 
	}
}))

	)

1109 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_UNIX98


1112 
fd©async
 (
__fûdes
);

1118 #ifdef 
__USE_XOPEN


1120 *
	$¸y±
 (c⁄° *
__key
, c⁄° *
__ß…
)

1121 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1125 
	$í¸y±
 (*
__glibc_block
, 
__edÊag
)

1126 
__THROW
 
	`__n⁄nuŒ
 ((1));

1133 
	$swab
 (c⁄° *
__ª°ri˘
 
__‰om
, *__ª°ri˘ 
__to
,

1134 
ssize_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1140 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K


1142 *
	$˘îmid
 (*
__s
Ë
__THROW
;

1147 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


1148 
	~<bôs/uni°d.h
>

1151 
__END_DECLS


	@/usr/include/utime.h

22 #i‚def 
_UTIME_H


23 
	#_UTIME_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


29 
	~<bôs/ty≥s.h
>

31 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


32 
	#__√ed_time_t


	)

33 
	~<time.h
>

37 
	sutimbuf


39 
__time_t
 
	ma˘ime
;

40 
__time_t
 
	mmodtime
;

45 
	$utime
 (c⁄° *
__fûe
,

46 c⁄° 
utimbuf
 *
__fûe_times
)

47 
__THROW
 
	`__n⁄nuŒ
 ((1));

49 
__END_DECLS


	@/usr/include/alloca.h

18 #i‚def 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<„©uªs.h
>

23 
	#__√ed_size_t


	)

24 
	~<°ddef.h
>

26 
	g__BEGIN_DECLS


29 #unde‡
Æloˇ


32 *
	$Æloˇ
 (
size_t
 
__size
Ë
__THROW
;

34 #ifdef 
__GNUC__


35 
	#Æloˇ
(
size
Ë
	`__buûtö_Æloˇ
 (size)

	)

38 
__END_DECLS


	@/usr/include/endian.h

18 #i‚def 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<„©uªs.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<bôs/ídün.h
>

40 #i‚de‡
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_BSD


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËLO, 
	)
HI

53 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËHI, 
	)
LO

58 #i‡
deföed
 
__USE_BSD
 && !deföed 
__ASSEMBLER__


60 
	~<bôs/byãsw≠.h
>

62 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


63 
	#htobe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

64 
	#htﬁe16
(
x
Ë(x)

	)

65 
	#be16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

66 
	#À16toh
(
x
Ë(x)

	)

68 
	#htobe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

69 
	#htﬁe32
(
x
Ë(x)

	)

70 
	#be32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

71 
	#À32toh
(
x
Ë(x)

	)

73 
	#htobe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

74 
	#htﬁe64
(
x
Ë(x)

	)

75 
	#be64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

76 
	#À64toh
(
x
Ë(x)

	)

79 
	#htobe16
(
x
Ë(x)

	)

80 
	#htﬁe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

81 
	#be16toh
(
x
Ë(x)

	)

82 
	#À16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

84 
	#htobe32
(
x
Ë(x)

	)

85 
	#htﬁe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

86 
	#be32toh
(
x
Ë(x)

	)

87 
	#À32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

89 
	#htobe64
(
x
Ë(x)

	)

90 
	#htﬁe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

91 
	#be64toh
(
x
Ë(x)

	)

92 
	#À64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

	@/usr/include/features.h

18 #i‚def 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

101 #unde‡
__USE_ISOC11


102 #unde‡
__USE_ISOC99


103 #unde‡
__USE_ISOC95


104 #unde‡
__USE_ISOCXX11


105 #unde‡
__USE_POSIX


106 #unde‡
__USE_POSIX2


107 #unde‡
__USE_POSIX199309


108 #unde‡
__USE_POSIX199506


109 #unde‡
__USE_XOPEN


110 #unde‡
__USE_XOPEN_EXTENDED


111 #unde‡
__USE_UNIX98


112 #unde‡
__USE_XOPEN2K


113 #unde‡
__USE_XOPEN2KXSI


114 #unde‡
__USE_XOPEN2K8


115 #unde‡
__USE_XOPEN2K8XSI


116 #unde‡
__USE_LARGEFILE


117 #unde‡
__USE_LARGEFILE64


118 #unde‡
__USE_FILE_OFFSET64


119 #unde‡
__USE_BSD


120 #unde‡
__USE_SVID


121 #unde‡
__USE_MISC


122 #unde‡
__USE_ATFILE


123 #unde‡
__USE_GNU


124 #unde‡
__USE_REENTRANT


125 #unde‡
__USE_FORTIFY_LEVEL


126 #unde‡
__KERNEL_STRICT_NAMES


130 #i‚de‡
_LOOSE_KERNEL_NAMES


131 
	#__KERNEL_STRICT_NAMES


	)

141 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


142 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

143 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

145 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

150 #ifde‡
_GNU_SOURCE


151 #unde‡
_ISOC95_SOURCE


152 
	#_ISOC95_SOURCE
 1

	)

153 #unde‡
_ISOC99_SOURCE


154 
	#_ISOC99_SOURCE
 1

	)

155 #unde‡
_ISOC11_SOURCE


156 
	#_ISOC11_SOURCE
 1

	)

157 #unde‡
_POSIX_SOURCE


158 
	#_POSIX_SOURCE
 1

	)

159 #unde‡
_POSIX_C_SOURCE


160 
	#_POSIX_C_SOURCE
 200809L

	)

161 #unde‡
_XOPEN_SOURCE


162 
	#_XOPEN_SOURCE
 700

	)

163 #unde‡
_XOPEN_SOURCE_EXTENDED


164 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

165 #unde‡
_LARGEFILE64_SOURCE


166 
	#_LARGEFILE64_SOURCE
 1

	)

167 #unde‡
_DEFAULT_SOURCE


168 
	#_DEFAULT_SOURCE
 1

	)

169 #unde‡
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #unde‡
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #unde‡
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #i‡(
deföed
 
_DEFAULT_SOURCE
 \

180 || (!
deföed
 
	g__STRICT_ANSI__
 \

181 && !
deföed
 
	g_ISOC99_SOURCE
 \

182 && !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 \

183 && !
deföed
 
	g_XOPEN_SOURCE
 \

184 && !
deföed
 
	g_BSD_SOURCE
 && !deföed 
	g_SVID_SOURCE
))

185 #unde‡
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

187 #unde‡
_BSD_SOURCE


188 
	#_BSD_SOURCE
 1

	)

189 #unde‡
_SVID_SOURCE


190 
	#_SVID_SOURCE
 1

	)

194 #i‡(
deföed
 
_ISOC11_SOURCE
 \

195 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

196 
	#__USE_ISOC11
 1

	)

200 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

201 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

202 
	#__USE_ISOC99
 1

	)

206 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

207 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

208 
	#__USE_ISOC95
 1

	)

215 #i‡((
deföed
 
__˝lu•lus
 && __cplusplus >= 201103L) \

216 || 
deföed
 
__GXX_EXPERIMENTAL_CXX0X__
)

217 
	#__USE_ISOCXX11
 1

	)

223 #ifde‡
_DEFAULT_SOURCE


224 #i‡!
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE


225 
	#__USE_POSIX_IMPLICITLY
 1

	)

227 #unde‡
_POSIX_SOURCE


228 
	#_POSIX_SOURCE
 1

	)

229 #unde‡
_POSIX_C_SOURCE


230 
	#_POSIX_C_SOURCE
 200809L

	)

232 #i‡((!
deföed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

233 !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

234 
	#_POSIX_SOURCE
 1

	)

235 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

236 
	#_POSIX_C_SOURCE
 2

	)

237 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

238 
	#_POSIX_C_SOURCE
 199506L

	)

239 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

240 
	#_POSIX_C_SOURCE
 200112L

	)

242 
	#_POSIX_C_SOURCE
 200809L

	)

244 
	#__USE_POSIX_IMPLICITLY
 1

	)

247 #i‡
deföed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >1 || deföed 
_XOPEN_SOURCE


248 
	#__USE_POSIX
 1

	)

251 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


252 
	#__USE_POSIX2
 1

	)

255 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199309L

256 
	#__USE_POSIX199309
 1

	)

259 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199506L

260 
	#__USE_POSIX199506
 1

	)

263 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200112L

264 
	#__USE_XOPEN2K
 1

	)

265 #unde‡
__USE_ISOC95


266 
	#__USE_ISOC95
 1

	)

267 #unde‡
__USE_ISOC99


268 
	#__USE_ISOC99
 1

	)

271 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200809L

272 
	#__USE_XOPEN2K8
 1

	)

273 #unde‡
_ATFILE_SOURCE


274 
	#_ATFILE_SOURCE
 1

	)

277 #ifdef 
_XOPEN_SOURCE


278 
	#__USE_XOPEN
 1

	)

279 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

280 
	#__USE_XOPEN_EXTENDED
 1

	)

281 
	#__USE_UNIX98
 1

	)

282 #unde‡
_LARGEFILE_SOURCE


283 
	#_LARGEFILE_SOURCE
 1

	)

284 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

285 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

286 
	#__USE_XOPEN2K8
 1

	)

287 
	#__USE_XOPEN2K8XSI
 1

	)

289 
	#__USE_XOPEN2K
 1

	)

290 
	#__USE_XOPEN2KXSI
 1

	)

291 #unde‡
__USE_ISOC95


292 
	#__USE_ISOC95
 1

	)

293 #unde‡
__USE_ISOC99


294 
	#__USE_ISOC99
 1

	)

297 #ifde‡
_XOPEN_SOURCE_EXTENDED


298 
	#__USE_XOPEN_EXTENDED
 1

	)

303 #ifde‡
_LARGEFILE_SOURCE


304 
	#__USE_LARGEFILE
 1

	)

307 #ifde‡
_LARGEFILE64_SOURCE


308 
	#__USE_LARGEFILE64
 1

	)

311 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

312 
	#__USE_FILE_OFFSET64
 1

	)

315 #i‡
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE


316 
	#__USE_MISC
 1

	)

319 #ifdef 
_BSD_SOURCE


320 
	#__USE_BSD
 1

	)

323 #ifdef 
_SVID_SOURCE


324 
	#__USE_SVID
 1

	)

327 #ifdef 
_ATFILE_SOURCE


328 
	#__USE_ATFILE
 1

	)

331 #ifdef 
_GNU_SOURCE


332 
	#__USE_GNU
 1

	)

335 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


336 
	#__USE_REENTRANT
 1

	)

339 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

340 && 
__GNUC_PREREQ
 (4, 1Ë&& 
deföed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

341 #i‡
_FORTIFY_SOURCE
 > 1

342 
	#__USE_FORTIFY_LEVEL
 2

	)

344 
	#__USE_FORTIFY_LEVEL
 1

	)

347 
	#__USE_FORTIFY_LEVEL
 0

	)

352 
	~<°dc-¥edef.h
>

360 #unde‡
__GNU_LIBRARY__


361 
	#__GNU_LIBRARY__
 6

	)

365 
	#__GLIBC__
 2

	)

366 
	#__GLIBC_MINOR__
 19

	)

368 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

369 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

372 #i‚de‡
__ASSEMBLER__


373 #i‚de‡
_SYS_CDEFS_H


374 
	~<sys/cdefs.h
>

379 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


380 
	#__USE_LARGEFILE
 1

	)

381 
	#__USE_LARGEFILE64
 1

	)

387 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

388 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

389 && 
deföed
 
	g__exã∫_ölöe


390 
	#__USE_EXTERN_INLINES
 1

	)

398 
	~<gnu/°ubs.h
>

	@/usr/include/getopt.h

19 #i‚de‡
_GETOPT_H


21 #i‚de‡
__√ed_gë›t


22 
	#_GETOPT_H
 1

	)

32 #i‡!
deföed
 
__GNU_LIBRARY__


33 
	~<˘y≥.h
>

36 #i‚de‡
__THROW


37 #i‚de‡
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë(0)

	)

40 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__˝lu•lus


57 *
›èrg
;

71 
›töd
;

76 
›ãº
;

80 
›t›t
;

82 #i‚de‡
__√ed_gë›t


104 
	s›ti⁄


106 c⁄° *
	g«me
;

109 
	ghas_¨g
;

110 *
	gÊag
;

111 
	gvÆ
;

116 
	#no_¨gumít
 0

	)

117 
	#ªquúed_¨gumít
 1

	)

118 
	#›ti⁄Æ_¨gumít
 2

	)

146 #ifde‡
__GNU_LIBRARY__


150 
gë›t
 (
___¨gc
, *c⁄° *
___¨gv
, c⁄° *
__sh‹t›ts
)

151 
__THROW
;

153 #i‡
deföed
 
__√ed_gë›t
 && deföed 
__USE_POSIX2
 \

154 && !
deföed
 
	g__USE_POSIX_IMPLICITLY
 && !deföed 
	g__USE_GNU


158 #ifde‡
__REDIRECT


159 
__REDIRECT_NTH
 (
gë›t
, (
___¨gc
, *c⁄° *
___¨gv
,

160 c⁄° *
__sh‹t›ts
),

161 
__posix_gë›t
);

163 
__posix_gë›t
 (
___¨gc
, *c⁄° *
___¨gv
,

164 c⁄° *
__sh‹t›ts
Ë
__THROW
;

165 
	#gë›t
 
__posix_gë›t


	)

169 
gë›t
 ();

172 #i‚de‡
__√ed_gë›t


173 
gë›t_l⁄g
 (
___¨gc
, *c⁄° *
___¨gv
,

174 c⁄° *
__sh‹t›ts
,

175 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

176 
__THROW
;

177 
gë›t_l⁄g_⁄ly
 (
___¨gc
, *c⁄° *
___¨gv
,

178 c⁄° *
__sh‹t›ts
,

179 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

180 
__THROW
;

184 #ifdef 
__˝lu•lus


189 #unde‡
__√ed_gë›t


	@/usr/include/libio.h

28 #i‚de‡
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_c⁄fig.h
>

33 
	#_IO_Âos_t
 
_G_Âos_t


	)

34 
	#_IO_Âos64_t
 
_G_Âos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_ic⁄v_t
 
_G_ic⁄v_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li°
 
_G_va_li°


	)

45 
	#_IO_wöt_t
 
wöt_t


	)

48 
	#__√ed___va_li°


	)

49 
	~<°d¨g.h
>

50 #ifde‡
__GNUC_VA_LIST


51 #unde‡
_IO_va_li°


52 
	#_IO_va_li°
 
__gnuc_va_li°


	)

55 #i‚de‡
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #i‚de‡
EOF


62 
	#EOF
 (-1)

	)

64 #i‚de‡
NULL


65 #i‡
deföed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuŒ
)

	)

69 #i‡!
deföed
(
__˝lu•lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifde‡
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifde‡
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifde‡
_IO_MTSAFE_IO


148 #i‡
deföed
 
__GLIBC__
 && __GLIBC__ >= 2

149 
	~<bôs/°dio-lock.h
>

154 
	t_IO_lock_t
;

160 
	s_IO_m¨kî
 {

161 
_IO_m¨kî
 *
	m_√xt
;

162 
_IO_FILE
 *
	m_sbuf
;

166 
	m_pos
;

168 
£t_°ªampos
(
°ªampos
 
•
Ë{ 
	m_•os
 = sp; }

169 
£t_off£t
(
off£t
Ë{ 
	m_pos
 = off£t; 
	m_•os
 = (
°ªampos
)(-2); }

170 
	mpublic
:

171 
°ªamm¨kî
(
°ªambuf
 *
sb
);

172 ~
°ªamm¨kî
();

173 
ßvög
(Ë{  
	m_•os
 == -2; }

174 
dñè
(
°ªamm¨kî
&);

175 
dñè
();

180 
	e__codecvt_ªsu…


182 
	m__codecvt_ok
,

183 
	m__codecvt_∑πül
,

184 
	m__codecvt_îr‹
,

185 
	m__codecvt_noc⁄v


188 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


191 
	s_IO_codecvt


193 (*
	m__codecvt_de°r
Ë(
	m_IO_codecvt
 *);

194 
__codecvt_ªsu…
 (*
__codecvt_do_out
Ë(
	m_IO_codecvt
 *,

195 
	m__mb°©e_t
 *,

196 c⁄° 
	mwch¨_t
 *,

197 c⁄° 
	mwch¨_t
 *,

198 c⁄° 
	mwch¨_t
 **, *,

200 
__codecvt_ªsu…
 (*
__codecvt_do_unshi·
Ë(
	m_IO_codecvt
 *,

201 
	m__mb°©e_t
 *, *,

203 
__codecvt_ªsu…
 (*
__codecvt_do_ö
Ë(
	m_IO_codecvt
 *,

204 
	m__mb°©e_t
 *,

206 c⁄° **, 
	mwch¨_t
 *,

207 
	mwch¨_t
 *, wchar_t **);

208 (*
	m__codecvt_do_ícodög
Ë(
	m_IO_codecvt
 *);

209 (*
	m__codecvt_do_Æways_noc⁄v
Ë(
	m_IO_codecvt
 *);

210 (*
	m__codecvt_do_Àngth
Ë(
	m_IO_codecvt
 *, 
	m__mb°©e_t
 *,

211 c⁄° *, c⁄° *, 
	m_IO_size_t
);

212 (*
	m__codecvt_do_max_Àngth
Ë(
	m_IO_codecvt
 *);

214 
_IO_ic⁄v_t
 
	m__cd_ö
;

215 
_IO_ic⁄v_t
 
	m__cd_out
;

219 
	s_IO_wide_d©a


221 
wch¨_t
 *
	m_IO_ªad_±r
;

222 
wch¨_t
 *
	m_IO_ªad_íd
;

223 
wch¨_t
 *
	m_IO_ªad_ba£
;

224 
wch¨_t
 *
	m_IO_wrôe_ba£
;

225 
wch¨_t
 *
	m_IO_wrôe_±r
;

226 
wch¨_t
 *
	m_IO_wrôe_íd
;

227 
wch¨_t
 *
	m_IO_buf_ba£
;

228 
wch¨_t
 *
	m_IO_buf_íd
;

230 
wch¨_t
 *
	m_IO_ßve_ba£
;

231 
wch¨_t
 *
	m_IO_backup_ba£
;

233 
wch¨_t
 *
	m_IO_ßve_íd
;

235 
__mb°©e_t
 
	m_IO_°©e
;

236 
__mb°©e_t
 
	m_IO_œ°_°©e
;

237 
_IO_codecvt
 
	m_codecvt
;

239 
wch¨_t
 
	m_sh‹tbuf
[1];

241 c⁄° 
_IO_jump_t
 *
	m_wide_vèbÀ
;

245 
	s_IO_FILE
 {

246 
	m_Êags
;

247 
	#_IO_fûe_Êags
 
_Êags


	)

251 * 
	m_IO_ªad_±r
;

252 * 
	m_IO_ªad_íd
;

253 * 
	m_IO_ªad_ba£
;

254 * 
	m_IO_wrôe_ba£
;

255 * 
	m_IO_wrôe_±r
;

256 * 
	m_IO_wrôe_íd
;

257 * 
	m_IO_buf_ba£
;

258 * 
	m_IO_buf_íd
;

260 *
	m_IO_ßve_ba£
;

261 *
	m_IO_backup_ba£
;

262 *
	m_IO_ßve_íd
;

264 
_IO_m¨kî
 *
	m_m¨kîs
;

266 
_IO_FILE
 *
	m_chaö
;

268 
	m_fûío
;

270 
	m_blksize
;

272 
	m_Êags2
;

274 
_IO_off_t
 
	m_ﬁd_off£t
;

276 
	#__HAVE_COLUMN


	)

278 
	m_cur_cﬁumn
;

279 sig√d 
	m_vèbÀ_off£t
;

280 
	m_sh‹tbuf
[1];

284 
_IO_lock_t
 *
	m_lock
;

285 #ifde‡
_IO_USE_OLD_IO_FILE


288 
	s_IO_FILE_com∂ëe


290 
_IO_FILE
 
	m_fûe
;

292 #i‡
deföed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

293 
_IO_off64_t
 
	m_off£t
;

294 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


296 
_IO_codecvt
 *
	m_codecvt
;

297 
_IO_wide_d©a
 *
	m_wide_d©a
;

298 
_IO_FILE
 *
	m_‰ìªs_li°
;

299 *
	m_‰ìªs_buf
;

300 
size_t
 
	m_‰ìªs_size
;

302 *
	m__∑d1
;

303 *
	m__∑d2
;

304 *
	m__∑d3
;

305 *
	m__∑d4
;

306 
size_t
 
	m__∑d5
;

308 
	m_mode
;

310 
	m_unu£d2
[15 *  (Ë- 4 *  (*Ë-  (
size_t
)];

314 #i‚de‡
__˝lu•lus


315 
_IO_FILE
 
	t_IO_FILE
;

318 
	g_IO_FILE_∂us
;

320 
_IO_FILE_∂us
 
_IO_2_1_°dö_
;

321 
_IO_FILE_∂us
 
_IO_2_1_°dout_
;

322 
_IO_FILE_∂us
 
_IO_2_1_°dîr_
;

323 #i‚de‡
_LIBC


324 
	#_IO_°dö
 ((
_IO_FILE
*)(&
_IO_2_1_°dö_
))

	)

325 
	#_IO_°dout
 ((
_IO_FILE
*)(&
_IO_2_1_°dout_
))

	)

326 
	#_IO_°dîr
 ((
_IO_FILE
*)(&
_IO_2_1_°dîr_
))

	)

328 
_IO_FILE
 *
_IO_°dö
 
©åibuã_hiddí
;

329 
_IO_FILE
 *
_IO_°dout
 
©åibuã_hiddí
;

330 
_IO_FILE
 *
_IO_°dîr
 
©åibuã_hiddí
;

338 
__ssize_t
 
	t__io_ªad_‚
 (*
	t__cookõ
, *
	t__buf
, 
	tsize_t
 
	t__nbyãs
);

346 
__ssize_t
 
	t__io_wrôe_‚
 (*
	t__cookõ
, c⁄° *
	t__buf
,

347 
	tsize_t
 
	t__n
);

355 
	t__io_£ek_‚
 (*
	t__cookõ
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

358 
	t__io_˛o£_‚
 (*
	t__cookõ
);

361 #ifde‡
_GNU_SOURCE


363 
__io_ªad_‚
 
	tcookõ_ªad_fun˘i⁄_t
;

364 
__io_wrôe_‚
 
	tcookõ_wrôe_fun˘i⁄_t
;

365 
__io_£ek_‚
 
	tcookõ_£ek_fun˘i⁄_t
;

366 
__io_˛o£_‚
 
	tcookõ_˛o£_fun˘i⁄_t
;

371 
__io_ªad_‚
 *
	mªad
;

372 
__io_wrôe_‚
 *
	mwrôe
;

373 
__io_£ek_‚
 *
	m£ek
;

374 
__io_˛o£_‚
 *
	m˛o£
;

375 } 
	t_IO_cookõ_io_fun˘i⁄s_t
;

376 
_IO_cookõ_io_fun˘i⁄s_t
 
	tcookõ_io_fun˘i⁄s_t
;

378 
	g_IO_cookõ_fûe
;

381 
_IO_cookõ_öô
 (
_IO_cookõ_fûe
 *
__cfûe
, 
__ªad_wrôe
,

382 *
__cookõ
, 
_IO_cookõ_io_fun˘i⁄s_t
 
__‚s
);

386 #ifde‡
__˝lu•lus


390 
__undîÊow
 (
_IO_FILE
 *);

391 
__uÊow
 (
_IO_FILE
 *);

392 
__ovîÊow
 (
_IO_FILE
 *, );

393 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


394 
_IO_wöt_t
 
__wundîÊow
 (
_IO_FILE
 *);

395 
_IO_wöt_t
 
__wuÊow
 (
_IO_FILE
 *);

396 
_IO_wöt_t
 
__wovîÊow
 (
_IO_FILE
 *, _IO_wint_t);

399 #i‡ 
__GNUC__
 >= 3

400 
	#_IO_BE
(
ex¥
, 
ªs
Ë
	`__buûtö_ex≥˘
 (”x¥),Ñes)

	)

402 
	#_IO_BE
(
ex¥
, 
ªs
Ë”x¥)

	)

405 
	#_IO_gëc_u∆ocked
(
_Â
) \

406 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

407 ? 
	`__uÊow
 (
_Â
Ë: *(*Ë(_Â)->
_IO_ªad_±r
++)

	)

408 
	#_IO_≥ekc_u∆ocked
(
_Â
) \

409 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

410 && 
	`__undîÊow
 (
_Â
Ë=
EOF
 ? EOF \

411 : *(*Ë(
_Â
)->
_IO_ªad_±r
)

	)

412 
	#_IO_putc_u∆ocked
(
_ch
, 
_Â
) \

413 (
	`_IO_BE
 ((
_Â
)->
_IO_wrôe_±r
 >(_Â)->
_IO_wrôe_íd
, 0) \

414 ? 
	`__ovîÊow
 (
_Â
, (Ë(
_ch
)) \

415 : (Ë(*(
_Â
)->
_IO_wrôe_±r
++ = (
_ch
)))

	)

417 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


418 
	#_IO_gëwc_u∆ocked
(
_Â
) \

419 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

420 || ((
_Â
)->
_wide_d©a
->
_IO_ªad_±r
 \

421 >(
_Â
)->
_wide_d©a
->
_IO_ªad_íd
), 0) \

422 ? 
	`__wuÊow
 (
_Â
Ë: (
_IO_wöt_t
Ë*(_Â)->
_wide_d©a
->
_IO_ªad_±r
++)

	)

423 
	#_IO_putwc_u∆ocked
(
_wch
, 
_Â
) \

424 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

425 || ((
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
 \

426 >(
_Â
)->
_wide_d©a
->
_IO_wrôe_íd
), 0) \

427 ? 
	`__wovîÊow
 (
_Â
, 
_wch
) \

428 : (
_IO_wöt_t
Ë(*(
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
++ = (
_wch
)))

	)

431 
	#_IO_„of_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_EOF_SEEN
Ë!0)

	)

432 
	#_IO_„º‹_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_ERR_SEEN
Ë!0)

	)

434 
_IO_gëc
 (
_IO_FILE
 *
__Â
);

435 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__Â
);

436 
_IO_„of
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

437 
_IO_„º‹
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

439 
_IO_≥ekc_locked
 (
_IO_FILE
 *
__Â
);

442 
	#_IO_PENDING_OUTPUT_COUNT
(
_Â
) \

443 ((
_Â
)->
_IO_wrôe_±r
 - (_Â)->
_IO_wrôe_ba£
)

	)

445 
_IO_Êockfûe
 (
_IO_FILE
 *Ë
__THROW
;

446 
_IO_fu∆ockfûe
 (
_IO_FILE
 *Ë
__THROW
;

447 
_IO_·rylockfûe
 (
_IO_FILE
 *Ë
__THROW
;

449 #ifde‡
_IO_MTSAFE_IO


450 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_locked
 (_Â)

	)

451 
	#_IO_Êockfûe
(
_Â
) \

452 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_Êockfûe
 (_Â)

	)

453 
	#_IO_fu∆ockfûe
(
_Â
) \

454 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_fu∆ockfûe
 (_Â)

	)

456 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_u∆ocked
 (_Â)

	)

457 
	#_IO_Êockfûe
(
_Â
Ë

	)

458 
	#_IO_fu∆ockfûe
(
_Â
Ë

	)

459 
	#_IO_·rylockfûe
(
_Â
Ë

	)

460 
	#_IO_˛ónup_ªgi⁄_°¨t
(
_f˘
, 
_Â
Ë

	)

461 
	#_IO_˛ónup_ªgi⁄_íd
(
_Doô
Ë

	)

464 
_IO_vfsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, const * __restrict,

465 
_IO_va_li°
, *
__ª°ri˘
);

466 
_IO_vÂrötf
 (
_IO_FILE
 *
__ª°ri˘
, const *__restrict,

467 
_IO_va_li°
);

468 
_IO_ssize_t
 
_IO_∑dn
 (
_IO_FILE
 *, , _IO_ssize_t);

469 
_IO_size_t
 
_IO_sgën
 (
_IO_FILE
 *, *, _IO_size_t);

471 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

472 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

474 
_IO_‰ì_backup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

476 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


477 
_IO_wöt_t
 
_IO_gëwc
 (
_IO_FILE
 *
__Â
);

478 
_IO_wöt_t
 
_IO_putwc
 (
wch¨_t
 
__wc
, 
_IO_FILE
 *
__Â
);

479 
_IO_fwide
 (
_IO_FILE
 *
__Â
, 
__mode
Ë
__THROW
;

480 #i‡
__GNUC__
 >= 2

483 #i‡
deföed
 
_LIBC
 && deföed 
SHARED


484 
	~<shlib-com∑t.h
>

485 #i‡
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

486 
	#_IO_fwide_maybe_öcom∑tibÀ
 \

487 (
	`__buûtö_ex≥˘
 (&
_IO_°dö_u£d
 =
NULL
, 0))

	)

488 c⁄° 
_IO_°dö_u£d
;

489 
wók_exã∫
 (
_IO_°dö_u£d
);

492 #i‚de‡
_IO_fwide_maybe_öcom∑tibÀ


493 
	#_IO_fwide_maybe_öcom∑tibÀ
 (0)

	)

497 
	#_IO_fwide
(
__Â
, 
__mode
) \

498 ({ 
__ªsu…
 = (
__mode
); \

499 i‡(
__ªsu…
 < 0 && ! 
_IO_fwide_maybe_öcom∑tibÀ
) \

501 i‡((
__Â
)->
_mode
 == 0) \

503 (
__Â
)->
_mode
 = -1; \

504 
__ªsu…
 = (
__Â
)->
_mode
; \

506 i‡(
	`__buûtö_c⁄°™t_p
 (
__mode
) && (__mode) == 0) \

507 
__ªsu…
 = 
_IO_fwide_maybe_öcom∑tibÀ
 ? -1 : (
__Â
)->
_mode
; \

509 
__ªsu…
 = 
	`_IO_fwide
 (
__Â
, __result); \

510 
__ªsu…
; })

	)

513 
_IO_vfwsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, c⁄° 
wch¨_t
 * __restrict,

514 
_IO_va_li°
, *
__ª°ri˘
);

515 
_IO_vfw¥ötf
 (
_IO_FILE
 *
__ª°ri˘
, c⁄° 
wch¨_t
 *__restrict,

516 
_IO_va_li°
);

517 
_IO_ssize_t
 
_IO_w∑dn
 (
_IO_FILE
 *, 
wöt_t
, _IO_ssize_t);

518 
_IO_‰ì_wbackup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

521 #ifde‡
__LDBL_COMPAT


522 
	~<bôs/libio-ldbl.h
>

525 #ifde‡
__˝lu•lus


	@/usr/include/rpc/netdb.h

36 #i‚de‡
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<„©uªs.h
>

41 
	#__√ed_size_t


	)

42 
	~<°ddef.h
>

44 
__BEGIN_DECLS


46 
	sΩ˚¡


48 *
	mr_«me
;

49 **
	mr_Æü£s
;

50 
	mr_numbî
;

53 
	$£åp˚¡
 (
__°ay›í
Ë
__THROW
;

54 
	$ídΩ˚¡
 (Ë
__THROW
;

55 
Ω˚¡
 *
	$gëΩcby«me
 (c⁄° *
__«me
Ë
__THROW
;

56 
Ω˚¡
 *
	$gëΩcbynumbî
 (
__numbî
Ë
__THROW
;

57 
Ω˚¡
 *
	$gëΩ˚¡
 (Ë
__THROW
;

59 #ifde‡
__USE_MISC


60 
	$gëΩcby«me_r
 (c⁄° *
__«me
, 
Ω˚¡
 *
__ªsu…_buf
,

61 *
__buf„r
, 
size_t
 
__buÊí
,

62 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

64 
	$gëΩcbynumbî_r
 (
__numbî
, 
Ω˚¡
 *
__ªsu…_buf
,

65 *
__buf„r
, 
size_t
 
__buÊí
,

66 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

68 
	$gëΩ˚¡_r
 (
Ω˚¡
 *
__ªsu…_buf
, *
__buf„r
,

69 
size_t
 
__buÊí
, 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

72 
__END_DECLS


	@/usr/include/sched.h

19 #i‚def 
_SCHED_H


20 
	#_SCHED_H
 1

	)

22 
	~<„©uªs.h
>

25 
	~<bôs/ty≥s.h
>

27 
	#__√ed_size_t


	)

28 
	~<°ddef.h
>

30 
	#__√ed_time_t


	)

31 
	#__√ed_time•ec


	)

32 
	~<time.h
>

34 #i‚de‡
__pid_t_deföed


35 
__pid_t
 
	tpid_t
;

36 
	#__pid_t_deföed


	)

41 
	~<bôs/sched.h
>

43 
	#sched_¥i‹ôy
 
__sched_¥i‹ôy


	)

46 
__BEGIN_DECLS


49 
	$sched_£ç¨am
 (
__pid_t
 
__pid
, c⁄° 
sched_∑øm
 *
__∑øm
)

50 
__THROW
;

53 
	$sched_gë∑øm
 (
__pid_t
 
__pid
, 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

56 
	$sched_£tscheduÀr
 (
__pid_t
 
__pid
, 
__pﬁicy
,

57 c⁄° 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

60 
	$sched_gëscheduÀr
 (
__pid_t
 
__pid
Ë
__THROW
;

63 
	$sched_yõld
 (Ë
__THROW
;

66 
	$sched_gë_¥i‹ôy_max
 (
__Æg‹ôhm
Ë
__THROW
;

69 
	$sched_gë_¥i‹ôy_mö
 (
__Æg‹ôhm
Ë
__THROW
;

72 
	$sched_º_gë_öãrvÆ
 (
__pid_t
 
__pid
, 
time•ec
 *
__t
Ë
__THROW
;

75 #ifde‡
__USE_GNU


77 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

78 
	#CPU_SET
(
˝u
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

79 
	#CPU_CLR
(
˝u
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

80 
	#CPU_ISSET
(
˝u
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (˝u,  (
˝u_£t_t
), \

81 
˝u£ç
)

	)

82 
	#CPU_ZERO
(
˝u£ç
Ë
	`__CPU_ZERO_S
 ( (
˝u_£t_t
), cpu£ç)

	)

83 
	#CPU_COUNT
(
˝u£ç
Ë
	`__CPU_COUNT_S
 ( (
˝u_£t_t
), cpu£ç)

	)

85 
	#CPU_SET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u, sësize, cpu£ç)

	)

86 
	#CPU_CLR_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u, sësize, cpu£ç)

	)

87 
	#CPU_ISSET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (cpu, setsize, \

88 
˝u£ç
)

	)

89 
	#CPU_ZERO_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_ZERO_S
 (£tsize, cpu£ç)

	)

90 
	#CPU_COUNT_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_COUNT_S
 (£tsize, cpu£ç)

	)

92 
	#CPU_EQUAL
(
˝u£ç1
, 
˝u£ç2
) \

93 
	`__CPU_EQUAL_S
 ( (
˝u_£t_t
), 
˝u£ç1
, 
˝u£ç2
)

	)

94 
	#CPU_EQUAL_S
(
£tsize
, 
˝u£ç1
, 
˝u£ç2
) \

95 
	`__CPU_EQUAL_S
 (
£tsize
, 
˝u£ç1
, 
˝u£ç2
)

	)

97 
	#CPU_AND
(
de°£t
, 
§c£t1
, 
§c£t2
) \

98 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

99 
	#CPU_OR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

100 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

101 
	#CPU_XOR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

102 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

103 
	#CPU_AND_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

104 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

105 
	#CPU_OR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

107 
	#CPU_XOR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

110 
	#CPU_ALLOC_SIZE
(
cou¡
Ë
	`__CPU_ALLOC_SIZE
 (cou¡)

	)

111 
	#CPU_ALLOC
(
cou¡
Ë
	`__CPU_ALLOC
 (cou¡)

	)

112 
	#CPU_FREE
(
˝u£t
Ë
	`__CPU_FREE
 (˝u£t)

	)

116 
	$sched_£èfföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

117 c⁄° 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

120 
	$sched_gëafföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

121 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

124 
__END_DECLS


	@/usr/include/xlocale.h

20 #i‚de‡
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loˇÀ_°ru˘


30 
__loˇÀ_d©a
 *
	m__loˇÀs
[13];

33 c⁄° *
	m__˘y≥_b
;

34 c⁄° *
	m__˘y≥_tﬁowî
;

35 c⁄° *
	m__˘y≥_touµî
;

38 c⁄° *
	m__«mes
[13];

39 } *
	t__loˇÀ_t
;

42 
__loˇÀ_t
 
	tloˇÀ_t
;

	@/usr/include/_G_config.h

4 #i‚de‡
_G_c⁄fig_h


5 
	#_G_c⁄fig_h
 1

	)

9 
	~<bôs/ty≥s.h
>

10 
	#__√ed_size_t


	)

11 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


12 
	#__√ed_wch¨_t


	)

14 
	#__√ed_NULL


	)

15 
	~<°ddef.h
>

16 
	#__√ed_mb°©e_t


	)

17 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


18 
	#__√ed_wöt_t


	)

20 
	~<wch¨.h
>

23 
__off_t
 
	m__pos
;

24 
__mb°©e_t
 
	m__°©e
;

25 } 
	t_G_Âos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb°©e_t
 
	m__°©e
;

30 } 
	t_G_Âos64_t
;

31 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gc⁄v.h
>

35 
__gc⁄v_öfo
 
	m__cd
;

38 
__gc⁄v_öfo
 
	m__cd
;

39 
__gc⁄v_°ï_d©a
 
	m__d©a
;

40 } 
	m__comböed
;

41 } 
	t_G_ic⁄v_t
;

46 
	#_G_va_li°
 
__gnuc_va_li°


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`deföed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/stdc-predef.h

18 #i‚def 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifde‡
__GCC_IEC_559


37 #i‡
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifde‡
__GCC_IEC_559_COMPLEX


45 #i‡
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

54 
	#__STDC_ISO_10646__
 201103L

	)

57 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/gconv.h

22 #i‚de‡
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<„©uªs.h
>

26 
	#__√ed_mb°©e_t


	)

27 
	#__√ed_wöt_t


	)

28 
	~<wch¨.h
>

29 
	#__√ed_size_t


	)

30 
	#__√ed_wch¨_t


	)

31 
	~<°ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¨_t
Ë0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004

64 
	g__gc⁄v_°ï
;

65 
	g__gc⁄v_°ï_d©a
;

66 
	g__gc⁄v_lﬂded_obje˘
;

67 
	g__gc⁄v_å™s_d©a
;

71 (*
	t__gc⁄v_f˘
Ë(
	t__gc⁄v_°ï
 *, 
	t__gc⁄v_°ï_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wöt_t
 (*
	t__gc⁄v_btowc_f˘
Ë(
	t__gc⁄v_°ï
 *, );

79 (*
	t__gc⁄v_öô_f˘
Ë(
	t__gc⁄v_°ï
 *);

80 (*
	t__gc⁄v_íd_f˘
Ë(
	t__gc⁄v_°ï
 *);

84 (*
	t__gc⁄v_å™s_f˘
Ë(
	t__gc⁄v_°ï
 *,

85 
	t__gc⁄v_°ï_d©a
 *, *,

89 
	tsize_t
 *);

92 (*
	t__gc⁄v_å™s_c⁄ãxt_f˘
) (*, const *,

97 (*
	t__gc⁄v_å™s_quîy_f˘
) (const *, const ***,

98 
	tsize_t
 *);

101 (*
	t__gc⁄v_å™s_öô_f˘
) (**, const *);

102 (*
	t__gc⁄v_å™s_íd_f˘
) (*);

104 
	s__gc⁄v_å™s_d©a


107 
__gc⁄v_å™s_f˘
 
__å™s_f˘
;

108 
__gc⁄v_å™s_c⁄ãxt_f˘
 
__å™s_c⁄ãxt_f˘
;

109 
__gc⁄v_å™s_íd_f˘
 
__å™s_íd_f˘
;

110 *
__d©a
;

111 
__gc⁄v_å™s_d©a
 *
__√xt
;

116 
	s__gc⁄v_°ï


118 
__gc⁄v_lﬂded_obje˘
 *
__shlib_h™dÀ
;

119 c⁄° *
__mod«me
;

121 
__cou¡î
;

123 *
__‰om_«me
;

124 *
__to_«me
;

126 
__gc⁄v_f˘
 
__f˘
;

127 
__gc⁄v_btowc_f˘
 
__btowc_f˘
;

128 
__gc⁄v_öô_f˘
 
__öô_f˘
;

129 
__gc⁄v_íd_f˘
 
__íd_f˘
;

133 
__mö_√eded_‰om
;

134 
__max_√eded_‰om
;

135 
__mö_√eded_to
;

136 
__max_√eded_to
;

139 
__°©eful
;

141 *
__d©a
;

146 
	s__gc⁄v_°ï_d©a


148 *
__outbuf
;

149 *
__outbu„nd
;

153 
__Êags
;

157 
__övoˇti⁄_cou¡î
;

161 
__öã∫Æ_u£
;

163 
__mb°©e_t
 *
__°©ï
;

164 
__mb°©e_t
 
__°©e
;

168 
__gc⁄v_å™s_d©a
 *
__å™s
;

173 
	s__gc⁄v_öfo


175 
size_t
 
__n°ïs
;

176 
__gc⁄v_°ï
 *
__°ïs
;

177 
__exãnsi⁄__
 
__gc⁄v_°ï_d©a
 
__d©a
 
__Êex¨r
;

178 } *
	t__gc⁄v_t
;

	@/usr/include/wchar.h

23 #i‚de‡
_WCHAR_H


25 #i‡!
deföed
 
__√ed_mb°©e_t
 && !deföed 
__√ed_wöt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<„©uªs.h
>

30 #ifde‡
_WCHAR_H


32 
	#__√ed___FILE


	)

33 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


34 
	#__√ed_FILE


	)

36 
	~<°dio.h
>

38 
	#__√ed___va_li°


	)

39 
	~<°d¨g.h
>

41 
	~<bôs/wch¨.h
>

44 
	#__√ed_size_t


	)

45 
	#__√ed_wch¨_t


	)

46 
	#__√ed_NULL


	)

48 #i‡
deföed
 
_WCHAR_H
 || deföed 
__√ed_wöt_t
 || !deföed 
__WINT_TYPE__


49 #unde‡
__√ed_wöt_t


50 
	#__√ed_wöt_t


	)

51 
	~<°ddef.h
>

55 #i‚de‡
_WINT_T


60 
	#_WINT_T


	)

61 
	twöt_t
;

65 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
deföed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twöt_t
;

69 
	g__END_NAMESPACE_STD


74 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #i‡(
deföed
 
_WCHAR_H
 || deföed 
__√ed_mb°©e_t
Ë&& !deföed 
____mb°©e_t_deföed


80 
	#____mb°©e_t_deföed
 1

	)

84 
	m__cou¡
;

87 #ifde‡
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wöt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__vÆue
;

94 } 
	t__mb°©e_t
;

96 #unde‡
__√ed_mb°©e_t


101 #ifde‡
_WCHAR_H


103 #i‚de‡
__mb°©e_t_deföed


104 
__BEGIN_NAMESPACE_C99


106 
__mb°©e_t
 
	tmb°©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb°©e_t_deföed
 1

	)

111 #ifde‡
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb°©e_t
)

115 #i‚de‡
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #i‚de‡
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_UNIX98


128 
	~<w˘y≥.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¨_t
 *
	$wcs˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

148 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

150 
wch¨_t
 *
	$wc¢˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

151 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

152 
__THROW
;

155 
wch¨_t
 *
	$wcsˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

156 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

158 
wch¨_t
 *
	$wc¢ˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

159 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

160 
__THROW
;

163 
	$wcscmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
)

164 
__THROW
 
__©åibuã_puª__
;

166 
	$wc¢cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

167 
__THROW
 
__©åibuã_puª__
;

168 
__END_NAMESPACE_STD


170 #ifde‡
__USE_XOPEN2K8


172 
	$wcsˇ£cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
Ë
__THROW
;

175 
	$wc¢ˇ£cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

176 
size_t
 
__n
Ë
__THROW
;

180 
	~<xloˇÀ.h
>

182 
	$wcsˇ£cmp_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

183 
__loˇÀ_t
 
__loc
Ë
__THROW
;

185 
	$wc¢ˇ£cmp_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

186 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

189 
__BEGIN_NAMESPACE_STD


192 
	$wcscﬁl
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
Ë
__THROW
;

196 
size_t
 
	$wcsx‰m
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

197 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

198 
__END_NAMESPACE_STD


200 #ifde‡
__USE_XOPEN2K8


206 
	$wcscﬁl_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

207 
__loˇÀ_t
 
__loc
Ë
__THROW
;

212 
size_t
 
	$wcsx‰m_l
 (
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

213 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

216 
wch¨_t
 *
	$wcsdup
 (c⁄° 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_mÆloc__
;

219 
__BEGIN_NAMESPACE_STD


221 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


222 "C++" 
wch¨_t
 *
	$wcschr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

223 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

224 "C++" c⁄° 
wch¨_t
 *
	$wcschr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

225 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

227 
wch¨_t
 *
	$wcschr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

228 
__THROW
 
__©åibuã_puª__
;

231 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


232 "C++" 
wch¨_t
 *
	$wc§chr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

233 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

234 "C++" c⁄° 
wch¨_t
 *
	$wc§chr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

235 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

237 
wch¨_t
 *
	$wc§chr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

238 
__THROW
 
__©åibuã_puª__
;

240 
__END_NAMESPACE_STD


242 #ifde‡
__USE_GNU


245 
wch¨_t
 *
	$wcsch∫ul
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__wc
)

246 
__THROW
 
__©åibuã_puª__
;

249 
__BEGIN_NAMESPACE_STD


252 
size_t
 
	$wcsc•n
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ªje˘
)

253 
__THROW
 
__©åibuã_puª__
;

256 
size_t
 
	$wcs•n
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

257 
__THROW
 
__©åibuã_puª__
;

259 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


260 "C++" 
wch¨_t
 *
	$wc•brk
 (
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

261 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

262 "C++" c⁄° 
wch¨_t
 *
	$wc•brk
 (c⁄° 
wch¨_t
 *
__wcs
,

263 c⁄° 
wch¨_t
 *
__ac˚±
)

264 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

266 
wch¨_t
 *
	$wc•brk
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

267 
__THROW
 
__©åibuã_puª__
;

270 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


271 "C++" 
wch¨_t
 *
	$wcs°r
 (
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

272 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

273 "C++" c⁄° 
wch¨_t
 *
	$wcs°r
 (c⁄° 
wch¨_t
 *
__hay°ack
,

274 c⁄° 
wch¨_t
 *
__√edÀ
)

275 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

277 
wch¨_t
 *
	$wcs°r
 (c⁄° 
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

278 
__THROW
 
__©åibuã_puª__
;

282 
wch¨_t
 *
	$wc°ok
 (
wch¨_t
 *
__ª°ri˘
 
__s
,

283 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__dñim
,

284 
wch¨_t
 **
__ª°ri˘
 
__±r
Ë
__THROW
;

287 
size_t
 
	$wc¶í
 (c⁄° 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_puª__
;

288 
__END_NAMESPACE_STD


290 #ifde‡
__USE_XOPEN


292 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


293 "C++" 
wch¨_t
 *
	$wcswcs
 (
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

294 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

295 "C++" c⁄° 
wch¨_t
 *
	$wcswcs
 (c⁄° 
wch¨_t
 *
__hay°ack
,

296 c⁄° 
wch¨_t
 *
__√edÀ
)

297 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

299 
wch¨_t
 *
	$wcswcs
 (c⁄° 
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

300 
__THROW
 
__©åibuã_puª__
;

304 #ifde‡
__USE_XOPEN2K8


306 
size_t
 
	$wc¢Àn
 (c⁄° 
wch¨_t
 *
__s
, 
size_t
 
__maxÀn
)

307 
__THROW
 
__©åibuã_puª__
;

311 
__BEGIN_NAMESPACE_STD


313 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


314 "C++" 
wch¨_t
 *
	$wmemchr
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

316 "C++" c⁄° 
wch¨_t
 *
	$wmemchr
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__c
,

317 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

320 
wch¨_t
 *
	$wmemchr
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

321 
__THROW
 
__©åibuã_puª__
;

325 
	$wmemcmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

326 
__THROW
 
__©åibuã_puª__
;

329 
wch¨_t
 *
	$wmem˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

330 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

334 
wch¨_t
 *
	$wmemmove
 (
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

335 
__THROW
;

338 
wch¨_t
 *
	$wmem£t
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
Ë
__THROW
;

339 
__END_NAMESPACE_STD


341 #ifde‡
__USE_GNU


344 
wch¨_t
 *
	$wmemp˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

345 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
)

346 
__THROW
;

350 
__BEGIN_NAMESPACE_STD


353 
wöt_t
 
	$btowc
 (
__c
Ë
__THROW
;

357 
	$w˘ob
 (
wöt_t
 
__c
Ë
__THROW
;

361 
	$mbsöô
 (c⁄° 
mb°©e_t
 *
__ps
Ë
__THROW
 
__©åibuã_puª__
;

365 
size_t
 
	$mbπowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

366 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

367 
mb°©e_t
 *
__ª°ri˘
 
__p
Ë
__THROW
;

370 
size_t
 
	$w¸tomb
 (*
__ª°ri˘
 
__s
, 
wch¨_t
 
__wc
,

371 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

374 
size_t
 
	$__mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

375 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

376 
size_t
 
	$mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

377 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

378 
__END_NAMESPACE_STD


380 #ifde‡
__USE_EXTERN_INLINES


386 
wöt_t
 
	$__btowc_Æüs
 (
__c
Ë
	`__asm
 ("btowc");

387 
__exã∫_ölöe
 
wöt_t


388 
	`__NTH
 (
	$btowc
 (
__c
))

389 {  (
	`__buûtö_c⁄°™t_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

390 ? (
wöt_t
Ë
__c
 : 
	`__btowc_Æüs
 (__c)); 
	}
}

392 
	$__w˘ob_Æüs
 (
wöt_t
 
__c
Ë
	`__asm
 ("wctob");

393 
__exã∫_ölöe
 

394 
	`__NTH
 (
	$w˘ob
 (
wöt_t
 
__wc
))

395 {  (
	`__buûtö_c⁄°™t_p
 (
__wc
Ë&& __w¯>
L
'\0' && __wc <= L'\x7f'

396 ? (Ë
__wc
 : 
	`__w˘ob_Æüs
 (__wc)); 
	}
}

398 
__exã∫_ölöe
 
size_t


399 
__NTH
 (
	$mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

400 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

401 {  (
__ps
 !
NULL


402 ? 
	`mbπowc
 (
NULL
, 
__s
, 
__n
, 
__ps
Ë: 
	`__mbæí
 (__s, __n, NULL)); 
	}
}

405 
__BEGIN_NAMESPACE_STD


408 
size_t
 
	$mb§towcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

409 c⁄° **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

410 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

414 
size_t
 
	$wc§tombs
 (*
__ª°ri˘
 
__d°
,

415 c⁄° 
wch¨_t
 **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

416 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

417 
__END_NAMESPACE_STD


420 #ifdef 
__USE_XOPEN2K8


423 
size_t
 
	$mb¢πowcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

424 c⁄° **
__ª°ri˘
 
__§c
, 
size_t
 
__nmc
,

425 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

429 
size_t
 
	$wc¢πombs
 (*
__ª°ri˘
 
__d°
,

430 c⁄° 
wch¨_t
 **
__ª°ri˘
 
__§c
,

431 
size_t
 
__nwc
, size_à
__Àn
,

432 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

437 #ifde‡
__USE_XOPEN


439 
	$wcwidth
 (
wch¨_t
 
__c
Ë
__THROW
;

443 
	$wcswidth
 (c⁄° 
wch¨_t
 *
__s
, 
size_t
 
__n
Ë
__THROW
;

447 
__BEGIN_NAMESPACE_STD


450 
	$wc°od
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

451 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

452 
__END_NAMESPACE_STD


454 #ifde‡
__USE_ISOC99


455 
__BEGIN_NAMESPACE_C99


457 
	$wc°of
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

458 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

459 
	$wc°ﬁd
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

460 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

461 
__END_NAMESPACE_C99


465 
__BEGIN_NAMESPACE_STD


468 
	$wc°ﬁ
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

469 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

473 
	$wc°oul
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

474 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

475 
__THROW
;

476 
__END_NAMESPACE_STD


478 #ifde‡
__USE_ISOC99


479 
__BEGIN_NAMESPACE_C99


482 
__exãnsi⁄__


483 
	$wc°ﬁl
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

484 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

485 
__THROW
;

489 
__exãnsi⁄__


490 
	$wc°ouŒ
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

491 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

492 
__ba£
Ë
__THROW
;

493 
__END_NAMESPACE_C99


496 #ifde‡
__USE_GNU


499 
__exãnsi⁄__


500 
	$wc°oq
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

501 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

502 
__THROW
;

506 
__exãnsi⁄__


507 
	$wc°ouq
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

508 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

509 
__ba£
Ë
__THROW
;

512 #ifde‡
__USE_GNU


526 
	~<xloˇÀ.h
>

530 
	$wc°ﬁ_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

531 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

532 
__loˇÀ_t
 
__loc
Ë
__THROW
;

534 
	$wc°oul_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

535 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

536 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

538 
__exãnsi⁄__


539 
	$wc°ﬁl_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

540 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

541 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

543 
__exãnsi⁄__


544 
	$wc°ouŒ_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

545 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

546 
__ba£
, 
__loˇÀ_t
 
__loc
)

547 
__THROW
;

549 
	$wc°od_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

550 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

551 
__THROW
;

553 
	$wc°of_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

554 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

555 
__THROW
;

557 
	$wc°ﬁd_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

558 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

559 
__loˇÀ_t
 
__loc
Ë
__THROW
;

563 #ifde‡
__USE_XOPEN2K8


566 
wch¨_t
 *
	$w˝˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

567 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

571 
wch¨_t
 *
	$w˝n˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

572 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

573 
__THROW
;

580 
__FILE
 *
	$›í_wmem°ªam
 (
wch¨_t
 **
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
;

583 #i‡
deföed
 
__USE_ISOC95
 || deföed 
__USE_UNIX98


584 
__BEGIN_NAMESPACE_STD


587 
	$fwide
 (
__FILE
 *
__Â
, 
__mode
Ë
__THROW
;

594 
	`fw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

595 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

601 
	`w¥ötf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

604 
	$sw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

605 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

606 
__THROW
 ;

612 
	`vfw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__s
,

613 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

614 
__gnuc_va_li°
 
__¨g
)

620 
	`vw¥ötf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

621 
__gnuc_va_li°
 
__¨g
)

625 
	$vsw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

626 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

627 
__gnuc_va_li°
 
__¨g
)

628 
__THROW
 ;

635 
	`fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

636 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

642 
	`wsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

645 
	$swsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

646 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

647 
__THROW
 ;

649 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

650 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

651 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

652 #ifde‡
__REDIRECT


656 
	`__REDIRECT
 (
fwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__°ªam
,

657 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

658 
__isoc99_fwsˇnf
)

660 
	`__REDIRECT
 (
wsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

661 
__isoc99_wsˇnf
)

663 
	`__REDIRECT_NTH
 (
swsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

664 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

665 ...), 
__isoc99_swsˇnf
)

668 
	`__isoc99_fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

669 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

670 
	`__isoc99_wsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

671 
	$__isoc99_swsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

672 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

673 
__THROW
;

674 
	#fwsˇnf
 
__isoc99_fwsˇnf


	)

675 
	#wsˇnf
 
__isoc99_wsˇnf


	)

676 
	#swsˇnf
 
__isoc99_swsˇnf


	)

680 
__END_NAMESPACE_STD


683 #ifde‡
__USE_ISOC99


684 
__BEGIN_NAMESPACE_C99


689 
	`vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

690 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

691 
__gnuc_va_li°
 
__¨g
)

697 
	`vwsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

698 
__gnuc_va_li°
 
__¨g
)

701 
	$vswsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

702 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

703 
__gnuc_va_li°
 
__¨g
)

704 
__THROW
 ;

706 #i‡!
deföed
 
__USE_GNU
 \

707 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

708 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

709 #ifde‡
__REDIRECT


710 
	`__REDIRECT
 (
vfwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__s
,

711 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

712 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vfwsˇnf
)

714 
	`__REDIRECT
 (
vwsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

715 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vwsˇnf
)

717 
	`__REDIRECT_NTH
 (
vswsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

718 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

719 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vswsˇnf
)

722 
	`__isoc99_vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

723 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

724 
__gnuc_va_li°
 
__¨g
);

725 
	`__isoc99_vwsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

726 
__gnuc_va_li°
 
__¨g
);

727 
	$__isoc99_vswsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

728 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

729 
__gnuc_va_li°
 
__¨g
Ë
__THROW
;

730 
	#vfwsˇnf
 
__isoc99_vfwsˇnf


	)

731 
	#vwsˇnf
 
__isoc99_vwsˇnf


	)

732 
	#vswsˇnf
 
__isoc99_vswsˇnf


	)

736 
__END_NAMESPACE_C99


740 
__BEGIN_NAMESPACE_STD


745 
wöt_t
 
	`fgëwc
 (
__FILE
 *
__°ªam
);

746 
wöt_t
 
	`gëwc
 (
__FILE
 *
__°ªam
);

752 
wöt_t
 
	`gëwch¨
 ();

759 
wöt_t
 
	`Âutwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

760 
wöt_t
 
	`putwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

766 
wöt_t
 
	`putwch¨
 (
wch¨_t
 
__wc
);

774 
wch¨_t
 *
	`fgëws
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

775 
__FILE
 *
__ª°ri˘
 
__°ªam
);

781 
	`Âutws
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__ws
,

782 
__FILE
 *
__ª°ri˘
 
__°ªam
);

789 
wöt_t
 
	`ungëwc
 (wöt_à
__wc
, 
__FILE
 *
__°ªam
);

790 
__END_NAMESPACE_STD


793 #ifde‡
__USE_GNU


801 
wöt_t
 
	`gëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

802 
wöt_t
 
	`gëwch¨_u∆ocked
 ();

810 
wöt_t
 
	`fgëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

818 
wöt_t
 
	`Âutwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

827 
wöt_t
 
	`putwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

828 
wöt_t
 
	`putwch¨_u∆ocked
 (
wch¨_t
 
__wc
);

837 
wch¨_t
 *
	`fgëws_u∆ocked
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

838 
__FILE
 *
__ª°ri˘
 
__°ªam
);

846 
	`Âutws_u∆ocked
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__ws
,

847 
__FILE
 *
__ª°ri˘
 
__°ªam
);

851 
__BEGIN_NAMESPACE_C99


855 
size_t
 
	$wcs·ime
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

856 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

857 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

858 
__END_NAMESPACE_C99


860 #ifde‡
__USE_GNU


861 
	~<xloˇÀ.h
>

865 
size_t
 
	$wcs·ime_l
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

866 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

867 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

868 
__loˇÀ_t
 
__loc
Ë
__THROW
;

877 #i‡
deföed
 
__USE_UNIX98
 && !deföed 
__USE_GNU


878 
	#__√ed_iswxxx


	)

879 
	~<w˘y≥.h
>

883 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


884 
	~<bôs/wch¨2.h
>

887 #ifde‡
__LDBL_COMPAT


888 
	~<bôs/wch¨-ldbl.h
>

891 
__END_DECLS


899 #unde‡
__√ed_mb°©e_t


900 #unde‡
__√ed_wöt_t


	@/usr/include/wctype.h

23 #i‚de‡
_WCTYPE_H


25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 #i‚de‡
__√ed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__√ed_wöt_t


	)

33 
	~<wch¨.h
>

37 #i‚de‡
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #unde‡
__√ed_iswxxx


46 #i‚de‡
__iswxxx_deföed


47 
	#__iswxxx_deföed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	tw˘y≥_t
;

53 
	g__END_NAMESPACE_C99


55 #i‚de‡
_ISwbô


60 
	~<ídün.h
>

61 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


62 
	#_ISwbô
(
bô
Ë(1 << (bô))

	)

64 
	#_ISwbô
(
bô
) \

65 ((
bô
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
bô
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
bô
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (Ë((1UL << (
bô
)Ë>> 24))))

	)

73 
	m__ISwuµî
 = 0,

74 
	m__ISwlowî
 = 1,

75 
	m__ISwÆpha
 = 2,

76 
	m__ISwdigô
 = 3,

77 
	m__ISwxdigô
 = 4,

78 
	m__ISw•a˚
 = 5,

79 
	m__ISw¥öt
 = 6,

80 
	m__ISwgøph
 = 7,

81 
	m__ISwbœnk
 = 8,

82 
	m__ISw˙ål
 = 9,

83 
	m__ISwpun˘
 = 10,

84 
	m__ISwÆnum
 = 11,

86 
	m_ISwuµî
 = 
_ISwbô
 (
__ISwuµî
),

87 
	m_ISwlowî
 = 
_ISwbô
 (
__ISwlowî
),

88 
	m_ISwÆpha
 = 
_ISwbô
 (
__ISwÆpha
),

89 
	m_ISwdigô
 = 
_ISwbô
 (
__ISwdigô
),

90 
	m_ISwxdigô
 = 
_ISwbô
 (
__ISwxdigô
),

91 
	m_ISw•a˚
 = 
_ISwbô
 (
__ISw•a˚
),

92 
	m_ISw¥öt
 = 
_ISwbô
 (
__ISw¥öt
),

93 
	m_ISwgøph
 = 
_ISwbô
 (
__ISwgøph
),

94 
	m_ISwbœnk
 = 
_ISwbô
 (
__ISwbœnk
),

95 
	m_ISw˙ål
 = 
_ISwbô
 (
__ISw˙ål
),

96 
	m_ISwpun˘
 = 
_ISwbô
 (
__ISwpun˘
),

97 
	m_ISwÆnum
 = 
_ISwbô
 (
__ISwÆnum
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$iswÆnum
 (
wöt_t
 
__wc
Ë
__THROW
;

117 
	$iswÆpha
 (
wöt_t
 
__wc
Ë
__THROW
;

120 
	$isw˙ål
 (
wöt_t
 
__wc
Ë
__THROW
;

124 
	$iswdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

128 
	$iswgøph
 (
wöt_t
 
__wc
Ë
__THROW
;

133 
	$iswlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

136 
	$isw¥öt
 (
wöt_t
 
__wc
Ë
__THROW
;

141 
	$iswpun˘
 (
wöt_t
 
__wc
Ë
__THROW
;

146 
	$isw•a˚
 (
wöt_t
 
__wc
Ë
__THROW
;

151 
	$iswuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

156 
	$iswxdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

161 #ifde‡
__USE_ISOC99


162 
	$iswbœnk
 (
wöt_t
 
__wc
Ë
__THROW
;

171 
w˘y≥_t
 
	$w˘y≥
 (c⁄° *
__¥›îty
Ë
__THROW
;

175 
	$isw˘y≥
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
Ë
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 c⁄° 
	t__öt32_t
 *
	tw˘øns_t
;

187 
__END_NAMESPACE_C99


188 #ifde‡
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
w˘øns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wöt_t
 
	$towlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

197 
wöt_t
 
	$towuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifde‡
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
w˘øns_t
 
	$w˘øns
 (c⁄° *
__¥›îty
Ë
__THROW
;

221 
wöt_t
 
	$tow˘øns
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
Ë
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifde‡
__USE_XOPEN2K8


226 
	~<xloˇÀ.h
>

230 
	$iswÆnum_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

236 
	$iswÆpha_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

239 
	$isw˙ål_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

243 
	$iswdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

247 
	$iswgøph_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

252 
	$iswlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

255 
	$isw¥öt_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

260 
	$iswpun˘_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

265 
	$isw•a˚_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

270 
	$iswuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

275 
	$iswxdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

280 
	$iswbœnk_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

284 
w˘y≥_t
 
	$w˘y≥_l
 (c⁄° *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

285 
__THROW
;

289 
	$isw˘y≥_l
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
, 
__loˇÀ_t
 
__loˇÀ
)

290 
__THROW
;

298 
wöt_t
 
	$towlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

301 
wöt_t
 
	$towuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

305 
w˘øns_t
 
	$w˘øns_l
 (c⁄° *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

306 
__THROW
;

309 
wöt_t
 
	$tow˘øns_l
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
,

310 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

314 
__END_DECLS


	@
1
.
1
/usr/include
605
12195
CMake/CurlTests.c
docs/examples/10-at-a-time.c
docs/examples/anyauthput.c
docs/examples/asiohiper.cpp
docs/examples/cacertinmem.c
docs/examples/certinfo.c
docs/examples/chkspeed.c
docs/examples/cookie_interface.c
docs/examples/curlgtk.c
docs/examples/curlx.c
docs/examples/debug.c
docs/examples/evhiperfifo.c
docs/examples/externalsocket.c
docs/examples/fileupload.c
docs/examples/fopen.c
docs/examples/ftp-wildcard.c
docs/examples/ftpget.c
docs/examples/ftpgetinfo.c
docs/examples/ftpgetresp.c
docs/examples/ftpsget.c
docs/examples/ftpupload.c
docs/examples/ftpuploadresume.c
docs/examples/getinfo.c
docs/examples/getinmemory.c
docs/examples/ghiper.c
docs/examples/hiperfifo.c
docs/examples/href_extractor.c
docs/examples/htmltidy.c
docs/examples/htmltitle.cpp
docs/examples/http-post.c
docs/examples/httpcustomheader.c
docs/examples/httpput.c
docs/examples/https.c
docs/examples/imap-append.c
docs/examples/imap-copy.c
docs/examples/imap-create.c
docs/examples/imap-delete.c
docs/examples/imap-examine.c
docs/examples/imap-fetch.c
docs/examples/imap-list.c
docs/examples/imap-lsub.c
docs/examples/imap-multi.c
docs/examples/imap-noop.c
docs/examples/imap-search.c
docs/examples/imap-ssl.c
docs/examples/imap-store.c
docs/examples/imap-tls.c
docs/examples/multi-app.c
docs/examples/multi-debugcallback.c
docs/examples/multi-double.c
docs/examples/multi-post.c
docs/examples/multi-single.c
docs/examples/multi-uv.c
docs/examples/multithread.c
docs/examples/opensslthreadlock.c
docs/examples/persistant.c
docs/examples/pop3-dele.c
docs/examples/pop3-list.c
docs/examples/pop3-multi.c
docs/examples/pop3-noop.c
docs/examples/pop3-retr.c
docs/examples/pop3-ssl.c
docs/examples/pop3-stat.c
docs/examples/pop3-tls.c
docs/examples/pop3-top.c
docs/examples/pop3-uidl.c
docs/examples/post-callback.c
docs/examples/postinmemory.c
docs/examples/postit2.c
docs/examples/progressfunc.c
docs/examples/resolve.c
docs/examples/rtsp.c
docs/examples/sampleconv.c
docs/examples/sendrecv.c
docs/examples/sepheaders.c
docs/examples/sessioninfo.c
docs/examples/sftpget.c
docs/examples/simple.c
docs/examples/simplepost.c
docs/examples/simplessl.c
docs/examples/smooth-gtk-thread.c
docs/examples/smtp-expn.c
docs/examples/smtp-mail.c
docs/examples/smtp-multi.c
docs/examples/smtp-ssl.c
docs/examples/smtp-tls.c
docs/examples/smtp-vrfy.c
docs/examples/synctime.c
docs/examples/threaded-ssl.c
docs/examples/url2file.c
docs/examples/usercertinmem.c
docs/examples/xmlstream.c
include/curl/curl.h
include/curl/curlbuild.h
include/curl/curlrules.h
include/curl/curlver.h
include/curl/easy.h
include/curl/mprintf.h
include/curl/multi.h
include/curl/stdcheaders.h
include/curl/typecheck-gcc.h
lib/amigaos.c
lib/amigaos.h
lib/arpa_telnet.h
lib/asyn-ares.c
lib/asyn-thread.c
lib/asyn.h
lib/base64.c
lib/bundles.c
lib/bundles.h
lib/config-amigaos.h
lib/config-dos.h
lib/config-mac.h
lib/config-os400.h
lib/config-riscos.h
lib/config-symbian.h
lib/config-tpf.h
lib/config-vxworks.h
lib/config-win32.h
lib/config-win32ce.h
lib/conncache.c
lib/conncache.h
lib/connect.c
lib/connect.h
lib/content_encoding.c
lib/content_encoding.h
lib/cookie.c
lib/cookie.h
lib/curl_addrinfo.c
lib/curl_addrinfo.h
lib/curl_base64.h
lib/curl_config.h
lib/curl_fnmatch.c
lib/curl_fnmatch.h
lib/curl_gethostname.c
lib/curl_gethostname.h
lib/curl_gssapi.c
lib/curl_gssapi.h
lib/curl_hmac.h
lib/curl_ldap.h
lib/curl_md4.h
lib/curl_md5.h
lib/curl_memory.h
lib/curl_memrchr.c
lib/curl_memrchr.h
lib/curl_multibyte.c
lib/curl_multibyte.h
lib/curl_ntlm.c
lib/curl_ntlm.h
lib/curl_ntlm_core.c
lib/curl_ntlm_core.h
lib/curl_ntlm_msgs.c
lib/curl_ntlm_msgs.h
lib/curl_ntlm_wb.c
lib/curl_ntlm_wb.h
lib/curl_rtmp.c
lib/curl_rtmp.h
lib/curl_sasl.c
lib/curl_sasl.h
lib/curl_sasl_sspi.c
lib/curl_sec.h
lib/curl_setup.h
lib/curl_setup_once.h
lib/curl_sspi.c
lib/curl_sspi.h
lib/curl_threads.c
lib/curl_threads.h
lib/curlx.h
lib/dict.c
lib/dict.h
lib/dotdot.c
lib/dotdot.h
lib/easy.c
lib/easyif.h
lib/escape.c
lib/escape.h
lib/file.c
lib/file.h
lib/fileinfo.c
lib/fileinfo.h
lib/formdata.c
lib/formdata.h
lib/ftp.c
lib/ftp.h
lib/ftplistparser.c
lib/ftplistparser.h
lib/getenv.c
lib/getinfo.c
lib/getinfo.h
lib/gopher.c
lib/gopher.h
lib/hash.c
lib/hash.h
lib/hmac.c
lib/hostasyn.c
lib/hostcheck.c
lib/hostcheck.h
lib/hostip.c
lib/hostip.h
lib/hostip4.c
lib/hostip6.c
lib/hostsyn.c
lib/http.c
lib/http.h
lib/http2.c
lib/http2.h
lib/http_chunks.c
lib/http_chunks.h
lib/http_digest.c
lib/http_digest.h
lib/http_negotiate.c
lib/http_negotiate.h
lib/http_negotiate_sspi.c
lib/http_proxy.c
lib/http_proxy.h
lib/idn_win32.c
lib/if2ip.c
lib/if2ip.h
lib/imap.c
lib/imap.h
lib/inet_ntop.c
lib/inet_ntop.h
lib/inet_pton.c
lib/inet_pton.h
lib/krb5.c
lib/ldap.c
lib/llist.c
lib/llist.h
lib/md4.c
lib/md5.c
lib/memdebug.c
lib/memdebug.h
lib/mprintf.c
lib/multi.c
lib/multihandle.h
lib/multiif.h
lib/netrc.c
lib/netrc.h
lib/non-ascii.c
lib/non-ascii.h
lib/nonblock.c
lib/nonblock.h
lib/nwlib.c
lib/nwos.c
lib/openldap.c
lib/parsedate.c
lib/parsedate.h
lib/pingpong.c
lib/pingpong.h
lib/pipeline.c
lib/pipeline.h
lib/pop3.c
lib/pop3.h
lib/progress.c
lib/progress.h
lib/rawstr.c
lib/rawstr.h
lib/rtsp.c
lib/rtsp.h
lib/security.c
lib/select.c
lib/select.h
lib/sendf.c
lib/sendf.h
lib/setup-os400.h
lib/setup-vms.h
lib/share.c
lib/share.h
lib/sigpipe.h
lib/slist.c
lib/slist.h
lib/smtp.c
lib/smtp.h
lib/sockaddr.h
lib/socks.c
lib/socks.h
lib/socks_gssapi.c
lib/socks_sspi.c
lib/speedcheck.c
lib/speedcheck.h
lib/splay.c
lib/splay.h
lib/ssh.c
lib/ssh.h
lib/strdup.c
lib/strdup.h
lib/strequal.c
lib/strequal.h
lib/strerror.c
lib/strerror.h
lib/strtok.c
lib/strtok.h
lib/strtoofft.c
lib/strtoofft.h
lib/telnet.c
lib/telnet.h
lib/tftp.c
lib/tftp.h
lib/timeval.c
lib/timeval.h
lib/transfer.c
lib/transfer.h
lib/url.c
lib/url.h
lib/urldata.h
lib/version.c
lib/vtls/axtls.c
lib/vtls/axtls.h
lib/vtls/curl_darwinssl.c
lib/vtls/curl_darwinssl.h
lib/vtls/curl_schannel.c
lib/vtls/curl_schannel.h
lib/vtls/cyassl.c
lib/vtls/cyassl.h
lib/vtls/gskit.c
lib/vtls/gskit.h
lib/vtls/gtls.c
lib/vtls/gtls.h
lib/vtls/nss.c
lib/vtls/nssg.h
lib/vtls/openssl.c
lib/vtls/openssl.h
lib/vtls/polarssl.c
lib/vtls/polarssl.h
lib/vtls/polarssl_threadlock.c
lib/vtls/polarssl_threadlock.h
lib/vtls/qssl.c
lib/vtls/qssl.h
lib/vtls/vtls.c
lib/vtls/vtls.h
lib/warnless.c
lib/warnless.h
lib/wildcard.c
lib/wildcard.h
lib/x509asn1.c
lib/x509asn1.h
packages/OS400/ccsidcurl.c
packages/OS400/ccsidcurl.h
packages/OS400/os400sys.c
packages/OS400/os400sys.h
packages/vms/curl_crtl_init.c
packages/vms/curlmsg.h
packages/vms/curlmsg_vms.h
packages/vms/report_openssl_version.c
packages/vms/vms_eco_level.h
src/macos/src/curl_GUSIConfig.cpp
src/macos/src/macos_main.cpp
src/tool_binmode.c
src/tool_binmode.h
src/tool_bname.c
src/tool_bname.h
src/tool_cb_dbg.c
src/tool_cb_dbg.h
src/tool_cb_hdr.c
src/tool_cb_hdr.h
src/tool_cb_prg.c
src/tool_cb_prg.h
src/tool_cb_rea.c
src/tool_cb_rea.h
src/tool_cb_see.c
src/tool_cb_see.h
src/tool_cb_wrt.c
src/tool_cb_wrt.h
src/tool_cfgable.c
src/tool_cfgable.h
src/tool_convert.c
src/tool_convert.h
src/tool_dirhie.c
src/tool_dirhie.h
src/tool_doswin.c
src/tool_doswin.h
src/tool_easysrc.c
src/tool_easysrc.h
src/tool_formparse.c
src/tool_formparse.h
src/tool_getparam.c
src/tool_getparam.h
src/tool_getpass.c
src/tool_getpass.h
src/tool_help.c
src/tool_help.h
src/tool_helpers.c
src/tool_helpers.h
src/tool_homedir.c
src/tool_homedir.h
src/tool_hugehelp.c
src/tool_hugehelp.h
src/tool_libinfo.c
src/tool_libinfo.h
src/tool_main.c
src/tool_main.h
src/tool_metalink.c
src/tool_metalink.h
src/tool_mfiles.c
src/tool_mfiles.h
src/tool_msgs.c
src/tool_msgs.h
src/tool_operate.c
src/tool_operate.h
src/tool_operhlp.c
src/tool_operhlp.h
src/tool_panykey.c
src/tool_panykey.h
src/tool_paramhlp.c
src/tool_paramhlp.h
src/tool_parsecfg.c
src/tool_parsecfg.h
src/tool_sdecls.h
src/tool_setopt.c
src/tool_setopt.h
src/tool_setup.h
src/tool_sleep.c
src/tool_sleep.h
src/tool_urlglob.c
src/tool_urlglob.h
src/tool_util.c
src/tool_util.h
src/tool_version.h
src/tool_vms.c
src/tool_vms.h
src/tool_writeenv.c
src/tool_writeenv.h
src/tool_writeout.c
src/tool_writeout.h
src/tool_xattr.c
src/tool_xattr.h
src/version.h
tests/libtest/chkhostname.c
tests/libtest/first.c
tests/libtest/lib1500.c
tests/libtest/lib1501.c
tests/libtest/lib1502.c
tests/libtest/lib1506.c
tests/libtest/lib1507.c
tests/libtest/lib1508.c
tests/libtest/lib1509.c
tests/libtest/lib1510.c
tests/libtest/lib1511.c
tests/libtest/lib1512.c
tests/libtest/lib1513.c
tests/libtest/lib1514.c
tests/libtest/lib1515.c
tests/libtest/lib1525.c
tests/libtest/lib1526.c
tests/libtest/lib1527.c
tests/libtest/lib1528.c
tests/libtest/lib1900.c
tests/libtest/lib500.c
tests/libtest/lib501.c
tests/libtest/lib502.c
tests/libtest/lib503.c
tests/libtest/lib504.c
tests/libtest/lib505.c
tests/libtest/lib506.c
tests/libtest/lib507.c
tests/libtest/lib508.c
tests/libtest/lib509.c
tests/libtest/lib510.c
tests/libtest/lib511.c
tests/libtest/lib512.c
tests/libtest/lib513.c
tests/libtest/lib514.c
tests/libtest/lib515.c
tests/libtest/lib516.c
tests/libtest/lib517.c
tests/libtest/lib518.c
tests/libtest/lib519.c
tests/libtest/lib520.c
tests/libtest/lib521.c
tests/libtest/lib523.c
tests/libtest/lib524.c
tests/libtest/lib525.c
tests/libtest/lib526.c
tests/libtest/lib530.c
tests/libtest/lib533.c
tests/libtest/lib536.c
tests/libtest/lib537.c
tests/libtest/lib539.c
tests/libtest/lib540.c
tests/libtest/lib541.c
tests/libtest/lib542.c
tests/libtest/lib543.c
tests/libtest/lib544.c
tests/libtest/lib547.c
tests/libtest/lib549.c
tests/libtest/lib552.c
tests/libtest/lib553.c
tests/libtest/lib554.c
tests/libtest/lib555.c
tests/libtest/lib556.c
tests/libtest/lib557.c
tests/libtest/lib558.c
tests/libtest/lib560.c
tests/libtest/lib562.c
tests/libtest/lib564.c
tests/libtest/lib566.c
tests/libtest/lib567.c
tests/libtest/lib568.c
tests/libtest/lib569.c
tests/libtest/lib570.c
tests/libtest/lib571.c
tests/libtest/lib572.c
tests/libtest/lib573.c
tests/libtest/lib574.c
tests/libtest/lib575.c
tests/libtest/lib576.c
tests/libtest/lib578.c
tests/libtest/lib579.c
tests/libtest/lib582.c
tests/libtest/lib583.c
tests/libtest/lib586.c
tests/libtest/lib590.c
tests/libtest/lib591.c
tests/libtest/lib597.c
tests/libtest/lib598.c
tests/libtest/lib599.c
tests/libtest/libauthretry.c
tests/libtest/libntlmconnect.c
tests/libtest/sethostname.c
tests/libtest/sethostname.h
tests/libtest/test.h
tests/libtest/testtrace.c
tests/libtest/testtrace.h
tests/libtest/testutil.c
tests/libtest/testutil.h
tests/server/fake_ntlm.c
tests/server/getpart.c
tests/server/getpart.h
tests/server/resolve.c
tests/server/rtspd.c
tests/server/server_setup.h
tests/server/server_sockaddr.h
tests/server/sockfilt.c
tests/server/sws.c
tests/server/testpart.c
tests/server/tftp.h
tests/server/tftpd.c
tests/server/util.c
tests/server/util.h
tests/unit/curlcheck.h
tests/unit/unit1300.c
tests/unit/unit1301.c
tests/unit/unit1302.c
tests/unit/unit1303.c
tests/unit/unit1304.c
tests/unit/unit1305.c
tests/unit/unit1307.c
tests/unit/unit1308.c
tests/unit/unit1309.c
tests/unit/unit1330.c
tests/unit/unit1394.c
tests/unit/unit1395.c
tests/unit/unit1396.c
tests/unit/unit1397.c
tests/unit/unit1398.c
/usr/include/arpa/inet.h
/usr/include/arpa/tftp.h
/usr/include/assert.h
/usr/include/ctype.h
/usr/include/dlfcn.h
/usr/include/err.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/iconv.h
/usr/include/ifaddrs.h
/usr/include/inttypes.h
/usr/include/libgen.h
/usr/include/limits.h
/usr/include/locale.h
/usr/include/malloc.h
/usr/include/memory.h
/usr/include/net/if.h
/usr/include/netdb.h
/usr/include/netinet/in.h
/usr/include/netinet/tcp.h
/usr/include/nss.h
/usr/include/poll.h
/usr/include/pthread.h
/usr/include/pwd.h
/usr/include/setjmp.h
/usr/include/signal.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/strings.h
/usr/include/stropts.h
/usr/include/termio.h
/usr/include/termios.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/utime.h
/usr/include/alloca.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/rpc/netdb.h
/usr/include/sched.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/stdc-predef.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
